# Issue 22191: update ECL to 20.4.24

archive/issues_021954.json:
```json
{
    "body": "ECL-20.4.24 has been released (on 2020/04/24)\n\nhttps://common-lisp.net/project/ecl/posts/ECL-20424-release.html\n\nWe should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n\n**Tarball**: see checksums.ini [upstream_url].\n(To configure Sage to download from the upstream URL, use `./configure --enable-download-from-upstream-url`)\n\n**CC:**  @rwst @kiwifb @jdemeyer @EmmanuelCharpentier jpflori @antonio-rojas @timokau @saraedum @infinity0 @slel @tobihan @embray @orlitzky\n\n**Keywords:** upgrade, ecl\n\n**Branch:** [f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)\n\n**Upstream:** Fixed upstream, but not in a stable release.\n\n**Reviewer:** Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey, Emmanuel Charpentier, Matthias Koeppe\n\n**Author:** Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/22191\n\n",
    "closed_at": "2020-07-10T19:34:39Z",
    "created_at": "2017-01-15T18:43:45Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "update ECL to 20.4.24",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22191",
    "user": "https://github.com/dimpase"
}
```
ECL-20.4.24 has been released (on 2020/04/24)

https://common-lisp.net/project/ecl/posts/ECL-20424-release.html

We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.

**Tarball**: see checksums.ini [upstream_url].
(To configure Sage to download from the upstream URL, use `./configure --enable-download-from-upstream-url`)

**CC:**  @rwst @kiwifb @jdemeyer @EmmanuelCharpentier jpflori @antonio-rojas @timokau @saraedum @infinity0 @slel @tobihan @embray @orlitzky

**Keywords:** upgrade, ecl

**Branch:** [f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)

**Upstream:** Fixed upstream, but not in a stable release.

**Reviewer:** Dima Pasechnik, Nils Bruin, Fran√ßois Bissey, Emmanuel Charpentier, Matthias Koeppe

**Author:** Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/22191





---

archive/issue_comments_330258.json:
```json
{
    "body": "**Branch:** [u/dimpase/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ecl16.1.3)",
    "created_at": "2017-01-16T12:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330258",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [u/dimpase/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ecl16.1.3)



---

archive/issue_comments_330259.json:
```json
{
    "body": "**Commit:** [33e59cb6e6d5b6b16f0b23eacc566d613ffccd07](https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07)",
    "created_at": "2017-01-16T12:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330259",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [33e59cb6e6d5b6b16f0b23eacc566d613ffccd07](https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07)



---

archive/issue_comments_330260.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ed32fb9839aa0462522e341f69ab2fb37ab706c\">3ed32fb</a></td><td><code>Upgrade Jupyter packages, add enum34</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72993f2f2489f36f229a31349d6e60b7ed5d8f34\">72993f2</a></td><td><code>Merge branch 'u/jdemeyer/upgrade_jupyter_packages' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a291ab3c485ce3ea84c1b4bd4495efdb10379c0\">2a291ab</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd5a04f3491d6565eb7481b7b0bdb9bec2393b04\">bd5a04f</a></td><td><code>Update source to 2.11.0, fix checksum.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8356446023194b6c7cc4813f0097db222a970c64\">8356446</a></td><td><code>Merge branch 'u/charpent/upgrade_git_to_2_10_2__or_2_11___' of trac.sagemath.org:sage into newgit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07\">33e59cb</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr></table>\n",
    "created_at": "2017-01-16T12:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330260",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ed32fb9839aa0462522e341f69ab2fb37ab706c">3ed32fb</a></td><td><code>Upgrade Jupyter packages, add enum34</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72993f2f2489f36f229a31349d6e60b7ed5d8f34">72993f2</a></td><td><code>Merge branch 'u/jdemeyer/upgrade_jupyter_packages' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a291ab3c485ce3ea84c1b4bd4495efdb10379c0">2a291ab</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd5a04f3491d6565eb7481b7b0bdb9bec2393b04">bd5a04f</a></td><td><code>Update source to 2.11.0, fix checksum.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8356446023194b6c7cc4813f0097db222a970c64">8356446</a></td><td><code>Merge branch 'u/charpent/upgrade_git_to_2_10_2__or_2_11___' of trac.sagemath.org:sage into newgit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07">33e59cb</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr></table>




---

archive/issue_comments_330261.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n \n We should update, as it will resolve some Maxima bugs, and is essential for resolving other\n Maxima bugs.\n+\n+The tarball is [here](https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz)\n``````\n",
    "created_at": "2017-01-16T12:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330261",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other
 Maxima bugs.
+
+The tarball is [here](https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz)
``````




---

archive/issue_comments_330262.json:
```json
{
    "body": "<a id='comment:2'></a>\noops, somewhat wrong branch... testing anyway",
    "created_at": "2017-01-16T12:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330262",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
oops, somewhat wrong branch... testing anyway



---

archive/issue_comments_330263.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac\">eff6081</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr></table>\n",
    "created_at": "2017-01-16T12:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac">eff6081</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr></table>




---

archive/issue_comments_330264.json:
```json
{
    "body": "**Changing commit** from \"[33e59cb6e6d5b6b16f0b23eacc566d613ffccd07](https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07)\" to \"[eff60815383ca3b3120a7a26e98e1712072c70ac](https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac)\".",
    "created_at": "2017-01-16T12:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[33e59cb6e6d5b6b16f0b23eacc566d613ffccd07](https://github.com/sagemath/sagetrac-mirror/commit/33e59cb6e6d5b6b16f0b23eacc566d613ffccd07)" to "[eff60815383ca3b3120a7a26e98e1712072c70ac](https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac)".



---

archive/issue_events_198391.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-16T12:44:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198391"
}
```



---

archive/issue_comments_330265.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2017-01-16T12:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330265",
    "user": "https://github.com/dimpase"
}
```

**Author:** Dima Pasechnik



---

archive/issue_comments_330266.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe FPE problem on #18920 in comment 99 might be due to \nECL 16.1.3 throwing an FPE exception at\n\n```\n> (/ 1.0 0.0)\n\nCondition of type: DIVISION-BY-ZERO\n#<a DIVISION-BY-ZERO>\n```\nwhile 16.1.2 happily returns\n\n```\n#.ext::single-float-positive-infinity\n```",
    "created_at": "2017-01-16T23:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330266",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
The FPE problem on #18920 in comment 99 might be due to 
ECL 16.1.3 throwing an FPE exception at

```
> (/ 1.0 0.0)

Condition of type: DIVISION-BY-ZERO
#<a DIVISION-BY-ZERO>
```
while 16.1.2 happily returns

```
#.ext::single-float-positive-infinity
```



---

archive/issue_comments_330267.json:
```json
{
    "body": "<a id='comment:7'></a>\nwith 6.1.3 there is apparently new `--no-trap-fpe` which emulates the old behaviour. So we somehow have to figure out where to put this option.",
    "created_at": "2017-01-16T23:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330267",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
with 6.1.3 there is apparently new `--no-trap-fpe` which emulates the old behaviour. So we somehow have to figure out where to put this option.



---

archive/issue_comments_330268.json:
```json
{
    "body": "<a id='comment:8'></a>\nIf it is an option for `ecl` then somewhere in `sage/libs/ecl.pyx` is the place, probably in `ecl_init` but I have to dig a bit.",
    "created_at": "2017-01-16T23:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330268",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
If it is an option for `ecl` then somewhere in `sage/libs/ecl.pyx` is the place, probably in `ecl_init` but I have to dig a bit.



---

archive/issue_comments_330269.json:
```json
{
    "body": "<a id='comment:9'></a>\nThere is already an option `ECL_OPT_TRAP_SIGFPE` is it equivalent?",
    "created_at": "2017-01-16T23:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330269",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
There is already an option `ECL_OPT_TRAP_SIGFPE` is it equivalent?



---

archive/issue_comments_330270.json:
```json
{
    "body": "crash gdb log",
    "created_at": "2017-01-17T00:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330270",
    "user": "https://github.com/dimpase"
}
```

crash gdb log



---

archive/attachments_020864.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "cra.log",
    "asset_url": "tarball://root/attachments/some-uuid/ticket22191/cra.log",
    "created_at": "2017-01-17T00:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.log",
    "user": "https://github.com/dimpase"
}
```



---

archive/issue_comments_330271.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [fbissey](#comment%3A9):\n> There is already an option `ECL_OPT_TRAP_SIGFPE` is it equivalent?\n\n\nI guess it should be. Perhaps it's something more subtle... I attach the crash dump.",
    "created_at": "2017-01-17T00:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330271",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
Replying to [fbissey](#comment%3A9):
> There is already an option `ECL_OPT_TRAP_SIGFPE` is it equivalent?


I guess it should be. Perhaps it's something more subtle... I attach the crash dump.



---

archive/issue_comments_330272.json:
```json
{
    "body": "**Changing commit** from \"[eff60815383ca3b3120a7a26e98e1712072c70ac](https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac)\" to \"[ac8348c462b11a67ee22f77e265afc0ce0572620](https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620)\".",
    "created_at": "2017-01-17T10:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[eff60815383ca3b3120a7a26e98e1712072c70ac](https://github.com/sagemath/sagetrac-mirror/commit/eff60815383ca3b3120a7a26e98e1712072c70ac)" to "[ac8348c462b11a67ee22f77e265afc0ce0572620](https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620)".



---

archive/issue_comments_330273.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62b5825544b467e481c7a752604b8d45c64d9752\">62b5825</a></td><td><code>some more easy doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c280228256c02dcba6e6a8df2bcb98625031613\">3c28022</a></td><td><code>more easy doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d864132139af098f417debdf28c2e4c83cd1d75\">5d86413</a></td><td><code>Merge branch 'public/t18920' of trac.sagemath.org:sage into max5381</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/100d9d6516e4bcfbb93ee979f086f52072ace786\">100d9d6</a></td><td><code>workaround for #<a ARITHMETIC-ERROR> (18920#comment:60</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79eb82fe1db9479550ca27f37571291c18df0884\">79eb82f</a></td><td><code>fix for maxima bug #3236</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/814e8edc2eb51ba9706c122a39bf75d3c77e141c\">814e8ed</a></td><td><code>reflect patch's dependence on an earlier maxima tree commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af7e5ff2e30dfed8bcb4c597403a6a23eb93b86a\">af7e5ff</a></td><td><code>new scaling of dynatomic polynomial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68da1e44b83e21dc5673e66b5f4af8f27a91181b\">68da1e4</a></td><td><code>Merge branch 'public/t18920' of trac.sagemath.org:sage into ecl1613</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bae4b1c1c95c08233c8b36a62baaff1bbc9a428\">6bae4b1</a></td><td><code>bumped up for 5.39.0. Sage builds (with ecl 16.1.3)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620\">ac8348c</a></td><td><code>disable SIGFPE traps</code></td></tr></table>\n",
    "created_at": "2017-01-17T10:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62b5825544b467e481c7a752604b8d45c64d9752">62b5825</a></td><td><code>some more easy doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c280228256c02dcba6e6a8df2bcb98625031613">3c28022</a></td><td><code>more easy doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d864132139af098f417debdf28c2e4c83cd1d75">5d86413</a></td><td><code>Merge branch 'public/t18920' of trac.sagemath.org:sage into max5381</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/100d9d6516e4bcfbb93ee979f086f52072ace786">100d9d6</a></td><td><code>workaround for #<a ARITHMETIC-ERROR> (18920#comment:60</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79eb82fe1db9479550ca27f37571291c18df0884">79eb82f</a></td><td><code>fix for maxima bug #3236</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/814e8edc2eb51ba9706c122a39bf75d3c77e141c">814e8ed</a></td><td><code>reflect patch's dependence on an earlier maxima tree commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af7e5ff2e30dfed8bcb4c597403a6a23eb93b86a">af7e5ff</a></td><td><code>new scaling of dynatomic polynomial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68da1e44b83e21dc5673e66b5f4af8f27a91181b">68da1e4</a></td><td><code>Merge branch 'public/t18920' of trac.sagemath.org:sage into ecl1613</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bae4b1c1c95c08233c8b36a62baaff1bbc9a428">6bae4b1</a></td><td><code>bumped up for 5.39.0. Sage builds (with ecl 16.1.3)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620">ac8348c</a></td><td><code>disable SIGFPE traps</code></td></tr></table>




---

archive/issue_comments_330274.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ed32fb9839aa0462522e341f69ab2fb37ab706c\">3ed32fb</a></td><td><code>Upgrade Jupyter packages, add enum34</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72993f2f2489f36f229a31349d6e60b7ed5d8f34\">72993f2</a></td><td><code>Merge branch 'u/jdemeyer/upgrade_jupyter_packages' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a291ab3c485ce3ea84c1b4bd4495efdb10379c0\">2a291ab</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6027df9979eafcc02e8253481911afdd9b6bd4a1\">6027df9</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9ee72d8ba684e2836ed40dbdce5454fca134e3d\">b9ee72d</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538\">a06f002</a></td><td><code>disable SIGFPE traps</code></td></tr></table>\n",
    "created_at": "2017-01-17T23:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ed32fb9839aa0462522e341f69ab2fb37ab706c">3ed32fb</a></td><td><code>Upgrade Jupyter packages, add enum34</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72993f2f2489f36f229a31349d6e60b7ed5d8f34">72993f2</a></td><td><code>Merge branch 'u/jdemeyer/upgrade_jupyter_packages' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a291ab3c485ce3ea84c1b4bd4495efdb10379c0">2a291ab</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6027df9979eafcc02e8253481911afdd9b6bd4a1">6027df9</a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9ee72d8ba684e2836ed40dbdce5454fca134e3d">b9ee72d</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538">a06f002</a></td><td><code>disable SIGFPE traps</code></td></tr></table>




---

archive/issue_comments_330275.json:
```json
{
    "body": "**Changing commit** from \"[ac8348c462b11a67ee22f77e265afc0ce0572620](https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620)\" to \"[a06f00245bfb652270eeea78248348777d006538](https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538)\".",
    "created_at": "2017-01-17T23:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ac8348c462b11a67ee22f77e265afc0ce0572620](https://github.com/sagemath/sagetrac-mirror/commit/ac8348c462b11a67ee22f77e265afc0ce0572620)" to "[a06f00245bfb652270eeea78248348777d006538](https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538)".



---

archive/issue_comments_330276.json:
```json
{
    "body": "**Changing commit** from \"[a06f00245bfb652270eeea78248348777d006538](https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538)\" to \"[ad25254d3445265211081b50501af670daf4dade](https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade)\".",
    "created_at": "2017-01-17T23:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a06f00245bfb652270eeea78248348777d006538](https://github.com/sagemath/sagetrac-mirror/commit/a06f00245bfb652270eeea78248348777d006538)" to "[ad25254d3445265211081b50501af670daf4dade](https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade)".



---

archive/issue_comments_330277.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/377e0ede3699d11f11706f59b20f72312e8374e5\">377e0ed</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade\">ad25254</a></td><td><code>disable SIGFPE traps</code></td></tr></table>\n",
    "created_at": "2017-01-17T23:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/377e0ede3699d11f11706f59b20f72312e8374e5">377e0ed</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade">ad25254</a></td><td><code>disable SIGFPE traps</code></td></tr></table>




---

archive/issue_comments_330278.json:
```json
{
    "body": "**Work_Issues:** sort out SIGFPE",
    "created_at": "2017-01-17T23:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330278",
    "user": "https://github.com/dimpase"
}
```

**Work_Issues:** sort out SIGFPE



---

archive/issue_comments_330279.json:
```json
{
    "body": "<a id='comment:14'></a>\nthis is a clean update branch for ECL 16.1.3 - needs work to sort out SIGFPE.",
    "created_at": "2017-01-17T23:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330279",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
this is a clean update branch for ECL 16.1.3 - needs work to sort out SIGFPE.



---

archive/issue_events_198392.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-17T23:36:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198392"
}
```



---

archive/issue_events_198393.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-17T23:36:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198393"
}
```



---

archive/issue_comments_330280.json:
```json
{
    "body": "<a id='comment:15'></a>\nI'm pretty sure the change in behaviour comes from this check-in on ECL: https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71\n\nClearly, this code will be setting FPE generation flags in more places than before. Probably ECL doesn't go out of its way to reset FPE flags when ECL is exiting. So probably, after executing ECL code, it is now the case that (often?) the FPE flags are set the way ECL wants; not the way we want. So in addition to restoring the SIG handlers, we should probably sprinkle an appropriate amount of fesetenv calls around the ECL entry and exit wrappers.",
    "created_at": "2017-01-17T23:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330280",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:15'></a>
I'm pretty sure the change in behaviour comes from this check-in on ECL: https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71

Clearly, this code will be setting FPE generation flags in more places than before. Probably ECL doesn't go out of its way to reset FPE flags when ECL is exiting. So probably, after executing ECL code, it is now the case that (often?) the FPE flags are set the way ECL wants; not the way we want. So in addition to restoring the SIG handlers, we should probably sprinkle an appropriate amount of fesetenv calls around the ECL entry and exit wrappers.



---

archive/issue_comments_330281.json:
```json
{
    "body": "<a id='comment:16'></a>\nUpstream [tells me](https://gitlab.com/embeddable-common-lisp/ecl/issues/317) that https://gitlab.com/embeddable-common-lisp/ecl/blob/develop/src/lsp/top.lsp#L1456 makes `write-error` patch unnecessary.\nSo we should remove it too.",
    "created_at": "2017-01-18T08:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330281",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
Upstream [tells me](https://gitlab.com/embeddable-common-lisp/ecl/issues/317) that https://gitlab.com/embeddable-common-lisp/ecl/blob/develop/src/lsp/top.lsp#L1456 makes `write-error` patch unnecessary.
So we should remove it too.



---

archive/issue_comments_330282.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [nbruin](#comment%3A15):\n> I'm pretty sure the change in behaviour comes from this check-in on ECL: https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71\n> \n> Clearly, this code will be setting FPE generation flags in more places than before.\n\n\nbut this ECL macro is not about the case at hand, as I believe we do have fenv.h available. Or you mean that Sage does not use fenv.h?\n\n> Probably ECL doesn't go out of its way to reset FPE flags when ECL is exiting. So probably, after executing ECL code, it is now the case that (often?) the FPE flags are set the way ECL wants; not the way we want. So in addition to restoring the SIG handlers, we should probably sprinkle an appropriate amount of fesetenv calls around the ECL entry and exit wrappers.\n\n\nthis does not explain why simply setting ECL_OPT_TRAP_SIGFPE to 0 solves the issue for division by 0, but not for FP overflow.\n\nHowever, I don't understand why doing anything with ECL_OPT_TRAP_SIGFPE has any effect whatsoever (assuming we do not preserve it among other ECL's interrupts such as SIGINT).\nShouldn't \n\n```\n    #and put the Sage signal handlers back\n    for i in range(1,32):\n        sigaction(i, &sage_action[i], NULL)\n```\nin ecl.pyx be overriding whatever ECL did with SIGFPE?",
    "created_at": "2017-01-18T09:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330282",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Replying to [nbruin](#comment%3A15):
> I'm pretty sure the change in behaviour comes from this check-in on ECL: https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71
> 
> Clearly, this code will be setting FPE generation flags in more places than before.


but this ECL macro is not about the case at hand, as I believe we do have fenv.h available. Or you mean that Sage does not use fenv.h?

> Probably ECL doesn't go out of its way to reset FPE flags when ECL is exiting. So probably, after executing ECL code, it is now the case that (often?) the FPE flags are set the way ECL wants; not the way we want. So in addition to restoring the SIG handlers, we should probably sprinkle an appropriate amount of fesetenv calls around the ECL entry and exit wrappers.


this does not explain why simply setting ECL_OPT_TRAP_SIGFPE to 0 solves the issue for division by 0, but not for FP overflow.

However, I don't understand why doing anything with ECL_OPT_TRAP_SIGFPE has any effect whatsoever (assuming we do not preserve it among other ECL's interrupts such as SIGINT).
Shouldn't 

```
    #and put the Sage signal handlers back
    for i in range(1,32):
        sigaction(i, &sage_action[i], NULL)
```
in ecl.pyx be overriding whatever ECL did with SIGFPE?



---

archive/issue_comments_330283.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe experimental branch using ECLs SIGFPE handler is on girt trac: u/dimpase/ecl16.1.3exp\nSo you can have a look --- it also doesn't work.",
    "created_at": "2017-01-18T11:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330283",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
The experimental branch using ECLs SIGFPE handler is on girt trac: u/dimpase/ecl16.1.3exp
So you can have a look --- it also doesn't work.



---

archive/issue_comments_330284.json:
```json
{
    "body": "<a id='comment:19'></a>\nI am not very familiar with this kind of coding issues and/or with SIG handling in general.\n\nIf we're doing our sig handler setting properly then it shouldn't matter what sig handlers ECL installs when we run non-ECL code, because we switch them out. As far as I can see this is the case. I see no evidence that an ECL sig handler is interfering with our work. The trace-back doesn't mention ECL code at all. Just an uncaught signal.\n\nIt seems that the sage action for SIGFPE is to coredump. That's what we're seeing.\n\nThere are flags that govern when SIGFPE is raised (rather than propagating a NaN or something similar). The ECL macro I pointed at will be inserted in ECL generated code quite a bit, so I expect that macro to be executed ALL THE TIME. Plus, the patch was made exactly to fix an issue of unraised SIGFPEs (CL apparently prefers the exceptions over NaNs by default).\n\nWe are not taking measures to set fenv to our liking after executing ECL, and one change in the new ECL version is certainly to change fenv more often. So I think it's worth a try to save & restore's sage's own fenv across ECL calls.\n\nIt could be that ECL changes its FPE raise mask depending on the value of ECL_OPT_TRAP_SIGFPE. I haven't checked. That would be consistent with observed behaviour.",
    "created_at": "2017-01-18T16:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330284",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:19'></a>
I am not very familiar with this kind of coding issues and/or with SIG handling in general.

If we're doing our sig handler setting properly then it shouldn't matter what sig handlers ECL installs when we run non-ECL code, because we switch them out. As far as I can see this is the case. I see no evidence that an ECL sig handler is interfering with our work. The trace-back doesn't mention ECL code at all. Just an uncaught signal.

It seems that the sage action for SIGFPE is to coredump. That's what we're seeing.

There are flags that govern when SIGFPE is raised (rather than propagating a NaN or something similar). The ECL macro I pointed at will be inserted in ECL generated code quite a bit, so I expect that macro to be executed ALL THE TIME. Plus, the patch was made exactly to fix an issue of unraised SIGFPEs (CL apparently prefers the exceptions over NaNs by default).

We are not taking measures to set fenv to our liking after executing ECL, and one change in the new ECL version is certainly to change fenv more often. So I think it's worth a try to save & restore's sage's own fenv across ECL calls.

It could be that ECL changes its FPE raise mask depending on the value of ECL_OPT_TRAP_SIGFPE. I haven't checked. That would be consistent with observed behaviour.



---

archive/issue_comments_330285.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [nbruin](#comment%3A19):\n> I am not very familiar with this kind of coding issues and/or with SIG handling in general.\n> \n> If we're doing our sig handler setting properly then it shouldn't matter what sig handlers ECL installs when we run non-ECL code, because we switch them out. As far as I can see this is the case. I see no evidence that an ECL sig handler is interfering with our work. The trace-back doesn't mention ECL code at all. Just an uncaught signal.\n\n\nBut why do we get an uncaught FP overflow signal? That's because booting ECL up destroys Sages' sig handler, even if we switch ECLs SIGFPE handler off. How exactly this is possible is not clear to me.\n\n> \n> It seems that the sage action for SIGFPE is to coredump. That's what we're seeing.\n\n\nno, it is not. Sage's action on FP overflow is to return infinity. Why does ECL continue to mess around with it, even if told not to? In fact, ECL 16.1.3 has a new command line switch, `-no-trap-fp`, and it works.\n(i.e. you get ECLs infinity if you try to convert a too big number to float if this switch is on, and you get an interrupt if that switch is off)\n\n> \n> There are flags that govern when SIGFPE is raised (rather than propagating a NaN or something similar). The ECL macro I pointed at will be inserted in ECL generated code quite a bit, so I expect that macro to be executed ALL THE TIME. Plus, the patch was made exactly to fix an issue of unraised SIGFPEs (CL apparently prefers the exceptions over NaNs by default).\n\n\n\n> \n> We are not taking measures to set fenv to our liking after executing ECL, and one change in the new ECL version is certainly to change fenv more often. So I think it's worth a try to save & restore's sage's own fenv across ECL calls.\n> \n> It could be that ECL changes its FPE raise mask depending on the value of ECL_OPT_TRAP_SIGFPE. I haven't checked. That would be consistent with observed behaviour.\n",
    "created_at": "2017-01-18T20:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330285",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [nbruin](#comment%3A19):
> I am not very familiar with this kind of coding issues and/or with SIG handling in general.
> 
> If we're doing our sig handler setting properly then it shouldn't matter what sig handlers ECL installs when we run non-ECL code, because we switch them out. As far as I can see this is the case. I see no evidence that an ECL sig handler is interfering with our work. The trace-back doesn't mention ECL code at all. Just an uncaught signal.


But why do we get an uncaught FP overflow signal? That's because booting ECL up destroys Sages' sig handler, even if we switch ECLs SIGFPE handler off. How exactly this is possible is not clear to me.

> 
> It seems that the sage action for SIGFPE is to coredump. That's what we're seeing.


no, it is not. Sage's action on FP overflow is to return infinity. Why does ECL continue to mess around with it, even if told not to? In fact, ECL 16.1.3 has a new command line switch, `-no-trap-fp`, and it works.
(i.e. you get ECLs infinity if you try to convert a too big number to float if this switch is on, and you get an interrupt if that switch is off)

> 
> There are flags that govern when SIGFPE is raised (rather than propagating a NaN or something similar). The ECL macro I pointed at will be inserted in ECL generated code quite a bit, so I expect that macro to be executed ALL THE TIME. Plus, the patch was made exactly to fix an issue of unraised SIGFPEs (CL apparently prefers the exceptions over NaNs by default).



> 
> We are not taking measures to set fenv to our liking after executing ECL, and one change in the new ECL version is certainly to change fenv more often. So I think it's worth a try to save & restore's sage's own fenv across ECL calls.
> 
> It could be that ECL changes its FPE raise mask depending on the value of ECL_OPT_TRAP_SIGFPE. I haven't checked. That would be consistent with observed behaviour.




---

archive/issue_comments_330286.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ecl16.1.3)\" to \"[u/nbruin/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ecl16.1.3)\".",
    "created_at": "2017-01-18T20:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330286",
    "user": "https://github.com/nbruin"
}
```

**Changing branch** from "[u/dimpase/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ecl16.1.3)" to "[u/nbruin/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ecl16.1.3)".



---

archive/issue_comments_330287.json:
```json
{
    "body": "**Changing commit** from \"[ad25254d3445265211081b50501af670daf4dade](https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade)\" to \"[a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451](https://github.com/sagemath/sagetrac-mirror/commit/a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451)\".",
    "created_at": "2017-01-18T21:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330287",
    "user": "https://github.com/nbruin"
}
```

**Changing commit** from "[ad25254d3445265211081b50501af670daf4dade](https://github.com/sagemath/sagetrac-mirror/commit/ad25254d3445265211081b50501af670daf4dade)" to "[a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451](https://github.com/sagemath/sagetrac-mirror/commit/a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451)".



---

archive/issue_comments_330288.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [dimpase](#comment%3A20):\n> In fact, ECL 16.1.3 has a new command line switch, `-no-trap-fp`, and it works.\n\n\nThe corresponding ECL command is `(si::trap-fpe t nil)`, so we could just pass that to ECL just after cl_boot. That might be easier/more efficient than passing it in the argv.\n\nThis should put ECL in agreement about what the fenv FPE raise flags are supposed to be (and then it also doesn't matter what SIGFPE handler ECL uses, because the signals will not occur, so we don't need to restore ECL's SIGFPE handler for ECL code either.",
    "created_at": "2017-01-18T21:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330288",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:22'></a>
Replying to [dimpase](#comment%3A20):
> In fact, ECL 16.1.3 has a new command line switch, `-no-trap-fp`, and it works.


The corresponding ECL command is `(si::trap-fpe t nil)`, so we could just pass that to ECL just after cl_boot. That might be easier/more efficient than passing it in the argv.

This should put ECL in agreement about what the fenv FPE raise flags are supposed to be (and then it also doesn't matter what SIGFPE handler ECL uses, because the signals will not occur, so we don't need to restore ECL's SIGFPE handler for ECL code either.



---

archive/issue_comments_330289.json:
```json
{
    "body": "**Changing commit** from \"[a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451](https://github.com/sagemath/sagetrac-mirror/commit/a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451)\" to \"[ea11dd53248462bf2859fb3cbe34bfd47f006682](https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682)\".",
    "created_at": "2017-01-18T21:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451](https://github.com/sagemath/sagetrac-mirror/commit/a2cadc04eb91409ad1f88b5f4d6ad80d5dfc3451)" to "[ea11dd53248462bf2859fb3cbe34bfd47f006682](https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682)".



---

archive/issue_comments_330290.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682\">ea11dd5</a></td><td><code>Restore \"fenv\" upon entry and exit of ECL code</code></td></tr></table>\n",
    "created_at": "2017-01-18T21:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682">ea11dd5</a></td><td><code>Restore "fenv" upon entry and exit of ECL code</code></td></tr></table>




---

archive/issue_comments_330291.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [git](#comment%3A23):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682\">ea11dd5</a></td><td><code>Restore \"fenv\" upon entry and exit of ECL code</code></td></tr></table>\n\nOK, committing the change before pushing is probably helpful.",
    "created_at": "2017-01-18T21:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330291",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:24'></a>
Replying to [git](#comment%3A23):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682">ea11dd5</a></td><td><code>Restore "fenv" upon entry and exit of ECL code</code></td></tr></table>

OK, committing the change before pushing is probably helpful.



---

archive/issue_comments_330292.json:
```json
{
    "body": "**Changing commit** from \"[ea11dd53248462bf2859fb3cbe34bfd47f006682](https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682)\" to \"[35e9d3d1610bade7ae7d5fac735244be25e009eb](https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb)\".",
    "created_at": "2017-01-18T22:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330292",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ea11dd53248462bf2859fb3cbe34bfd47f006682](https://github.com/sagemath/sagetrac-mirror/commit/ea11dd53248462bf2859fb3cbe34bfd47f006682)" to "[35e9d3d1610bade7ae7d5fac735244be25e009eb](https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb)".



---

archive/issue_comments_330293.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/377e0ede3699d11f11706f59b20f72312e8374e5\">377e0ed</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb\">35e9d3d</a></td><td><code>set ECL to not trap floating point exceptions, so that SIGFPE will not occur</code></td></tr></table>\n",
    "created_at": "2017-01-18T22:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/377e0ede3699d11f11706f59b20f72312e8374e5">377e0ed</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb">35e9d3d</a></td><td><code>set ECL to not trap floating point exceptions, so that SIGFPE will not occur</code></td></tr></table>




---

archive/issue_comments_330294.json:
```json
{
    "body": "<a id='comment:26'></a>\nOK, that should do the trick! I guess ECL_OPT_TRAP_SIGFPE doesn't have much to do with what we need because it's supposed to control what happens with SIGFPE if ECL is catching signals, whereas we're interested in preventing FP exceptions from generating signals at all. the routine `si:trap-fpe` is exactly the one to set that behaviour, in a way that is maintained in ECL's environment tracking as well.",
    "created_at": "2017-01-18T22:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330294",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:26'></a>
OK, that should do the trick! I guess ECL_OPT_TRAP_SIGFPE doesn't have much to do with what we need because it's supposed to control what happens with SIGFPE if ECL is catching signals, whereas we're interested in preventing FP exceptions from generating signals at all. the routine `si:trap-fpe` is exactly the one to set that behaviour, in a way that is maintained in ECL's environment tracking as well.



---

archive/issue_comments_330295.json:
```json
{
    "body": "<a id='comment:27'></a>\nJust as a memento for future testing :\n\nWith the current ECL Maxima 5.39.0 gives :\n\n```\n(%i3) taylor(integrate(f(x),x),x,x_0,2); \n\ntaylor: unable to expand at a point specified in:\n'integrate(f(x),x)\n -- an error. To debug this try: debugmode(true);\n```\n\nwhereas :\n\n```\n%i2) taylor(integrate(f(x),x),x,x_0,2);\n\n(%o2) 'at('integrate(f(x),x),x = x_0)+f(x_0)*(x-x_0)\n                                     +(('at('diff(f(x),x,1),x = x_0))\n                                      *(x-x_0)^2)\n                                      /2\n```\n\nis expected since Maxima 5.38.1 at the latest...",
    "created_at": "2017-01-18T23:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330295",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:27'></a>
Just as a memento for future testing :

With the current ECL Maxima 5.39.0 gives :

```
(%i3) taylor(integrate(f(x),x),x,x_0,2); 

taylor: unable to expand at a point specified in:
'integrate(f(x),x)
 -- an error. To debug this try: debugmode(true);
```

whereas :

```
%i2) taylor(integrate(f(x),x),x,x_0,2);

(%o2) 'at('integrate(f(x),x),x = x_0)+f(x_0)*(x-x_0)
                                     +(('at('diff(f(x),x,1),x = x_0))
                                      *(x-x_0)^2)
                                      /2
```

is expected since Maxima 5.38.1 at the latest...



---

archive/issue_comments_330296.json:
```json
{
    "body": "<a id='comment:28'></a>\n*DISCLAIMER*: I just found out that all my testing was on 16.1.2. While I expect that my fix should work, I haven't actually successfully tested this. Other people who do have easy access to 16.1.3 can verify this easily.",
    "created_at": "2017-01-18T23:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330296",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'></a>
*DISCLAIMER*: I just found out that all my testing was on 16.1.2. While I expect that my fix should work, I haven't actually successfully tested this. Other people who do have easy access to 16.1.3 can verify this easily.



---

archive/issue_comments_330297.json:
```json
{
    "body": "<a id='comment:29'></a>\nOK, this appears to work. `make ptest` with this ECL 16.1.3 branch and Maxima from #18920 passes without any errors.",
    "created_at": "2017-01-19T01:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330297",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
OK, this appears to work. `make ptest` with this ECL 16.1.3 branch and Maxima from #18920 passes without any errors.



---

archive/issue_comments_330298.json:
```json
{
    "body": "<a id='comment:30'></a>\nDaniel Kochma\u0144ski (ECL lead dev) invited me to open an [issue #347](https://gitlab.com/embeddable-common-lisp/ecl/issues/347) on this.",
    "created_at": "2017-01-19T10:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
Daniel Kochma≈Ñski (ECL lead dev) invited me to open an [issue #347](https://gitlab.com/embeddable-common-lisp/ecl/issues/347) on this.



---

archive/issue_comments_330299.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2017-01-19T10:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330299",
    "user": "https://github.com/dimpase"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_330300.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [charpent](#comment%3A27):\n> Just as a memento for future testing :\n> \n> With the current ECL Maxima 5.39.0 gives :\n> \n> ```\n> (%i3) taylor(integrate(f(x),x),x,x_0,2); \n> \n> taylor: unable to expand at a point specified in:\n> 'integrate(f(x),x)\n>  -- an error. To debug this try: debugmode(true);\n> ```\n> \n\n\nthis unfortunately stays the same with ECL 16.1.3. This is for Maxima/ECL\npeople to fix, not for us.",
    "created_at": "2017-01-19T11:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330300",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [charpent](#comment%3A27):
> Just as a memento for future testing :
> 
> With the current ECL Maxima 5.39.0 gives :
> 
> ```
> (%i3) taylor(integrate(f(x),x),x,x_0,2); 
> 
> taylor: unable to expand at a point specified in:
> 'integrate(f(x),x)
>  -- an error. To debug this try: debugmode(true);
> ```
> 


this unfortunately stays the same with ECL 16.1.3. This is for Maxima/ECL
people to fix, not for us.



---

archive/issue_comments_330301.json:
```json
{
    "body": "<a id='comment:32'></a>\nIt would be really good to explain *on this ticket* what the `SIGFPE` issue is all about.",
    "created_at": "2017-01-19T14:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330301",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
It would be really good to explain *on this ticket* what the `SIGFPE` issue is all about.



---

archive/issue_comments_330302.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n ECL 6.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). \n \n-We should update, as it will resolve some Maxima bugs, and is essential for resolving other\n-Maxima bugs.\n+We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n-The tarball is [here](https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz)\n+**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz\n``````\n",
    "created_at": "2017-01-19T14:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330302",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
 ECL 6.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). 
 
-We should update, as it will resolve some Maxima bugs, and is essential for resolving other
-Maxima bugs.
+We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
-The tarball is [here](https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz)
+**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz
``````




---

archive/issue_comments_330303.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A32):\n> It would be really good to explain *on this ticket* what the `SIGFPE` issue is all about.\n\n\nexamples can be found on #18920. More specifically, in Sage Maxima built with ECL 16.1.3 and unpatched `libs/ecl.pyx` gives crash dumps like\n\n```\nsage: g(x)=taylor(log(x),x,1,6) # this initialises ECL/Maxima\nsage: q = (2^53) * 2^971/1\nsage: float(q) # boom, instead of \"inf\" as the answer.\n...\nUnhandled SIGFPE: An unhandled floating point exception occurred.\n...\n```\nand\n\n```\nsage: g(x)=taylor(log(x),x,1,6); g\nx |--> -1/6*(x - 1)^6 + 1/5*(x - 1)^5 - 1/4*(x - 1)^4 + 1/3*(x - 1)^3 - 1/2*(x - 1)^2 + x - 1\nsage: plot(log(x),(x,0,2))\n...\nUnhandled SIGFPE: An unhandled floating point exception occurred.\n...\n```",
    "created_at": "2017-01-19T16:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330303",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A32):
> It would be really good to explain *on this ticket* what the `SIGFPE` issue is all about.


examples can be found on #18920. More specifically, in Sage Maxima built with ECL 16.1.3 and unpatched `libs/ecl.pyx` gives crash dumps like

```
sage: g(x)=taylor(log(x),x,1,6) # this initialises ECL/Maxima
sage: q = (2^53) * 2^971/1
sage: float(q) # boom, instead of "inf" as the answer.
...
Unhandled SIGFPE: An unhandled floating point exception occurred.
...
```
and

```
sage: g(x)=taylor(log(x),x,1,6); g
x |--> -1/6*(x - 1)^6 + 1/5*(x - 1)^5 - 1/4*(x - 1)^4 + 1/3*(x - 1)^3 - 1/2*(x - 1)^2 + x - 1
sage: plot(log(x),(x,0,2))
...
Unhandled SIGFPE: An unhandled floating point exception occurred.
...
```



---

archive/issue_comments_330304.json:
```json
{
    "body": "<a id='comment:35'></a>\nThe *mechanics* of why SIGFPE is a problem with ECL 6.1.3 by default:\n* Apparently it is desirable in CL to raise floating point exceptions rather than propagate Inf and NaN by default (CL is a formally specified language, so it probably states that FP exceptions should be handled that way)\n* This is most easily done by using fenv.h functionality to configure floating point arithmetic to raise SIGFPE when these things arise. So, ECL does that, and has a SIGFPE handler in place.\n* We switch the ECL sighandlers in/out whenever we're entering/exiting significant ECL code. Sage is not expecting floating point exceptions to raise SIGFPE, so sage does not have a SIGFPE handler.\n* In order to fix a bug elsewhere in ECL, https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71 changed ECL to much more often update the fenv to reflect its desired state (previously, they were not doing this at all). ECL is not actually written to be called as a library, so it doesn't take any precautions to set/restore global state such as fenv upon entry/exit. Hence, after running ECL in its default configuration, you're liable to end up with an fenv in which SIGFPE can be raised. This is what was happening.\n\nFor solutions:\n* it's possible to tell ECL to NOT let floating point exceptions raise SIGFPE. Then ECL's SIGFPE handler is irrelevant, and the fenv state ECL wants is basically consistent with what we want. This is the solution currently used.\n* alternatively, we could let ECL do what it wants and set/restore fenv upon entry/exit of ECL code. `fesetenv` and `fegetenv` are the relevant routines from `fenv.h`. In addition, though, we should restore ECL's SIGFPE handler during ECL code execution, if we go that route (currently we don't).\n\nThis was one of these issues that's really easy to resolve, once you understand the problem.\n\nThe main confusion is that there are two components: *whether* floating point exceptions should raise SIGFPE, and how SIGFPE gets handled once it's raised. You might think these two components are controlled via the same mechanism, but they are not. It looks like ECL might be investigating if its configuration can be streamlined on these two issues: https://gitlab.com/embeddable-common-lisp/ecl/issues/347\n\nCurrently there are two options that seem relevant: ECL_OPT_TRAP_SIGFPE and `--no-trap-fpe` that feed into different places and control different aspects.",
    "created_at": "2017-01-19T17:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330304",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:35'></a>
The *mechanics* of why SIGFPE is a problem with ECL 6.1.3 by default:
* Apparently it is desirable in CL to raise floating point exceptions rather than propagate Inf and NaN by default (CL is a formally specified language, so it probably states that FP exceptions should be handled that way)
* This is most easily done by using fenv.h functionality to configure floating point arithmetic to raise SIGFPE when these things arise. So, ECL does that, and has a SIGFPE handler in place.
* We switch the ECL sighandlers in/out whenever we're entering/exiting significant ECL code. Sage is not expecting floating point exceptions to raise SIGFPE, so sage does not have a SIGFPE handler.
* In order to fix a bug elsewhere in ECL, https://gitlab.com/embeddable-common-lisp/ecl/commit/c2b2941768f39544f45f24e19a30081d316eeb71 changed ECL to much more often update the fenv to reflect its desired state (previously, they were not doing this at all). ECL is not actually written to be called as a library, so it doesn't take any precautions to set/restore global state such as fenv upon entry/exit. Hence, after running ECL in its default configuration, you're liable to end up with an fenv in which SIGFPE can be raised. This is what was happening.

For solutions:
* it's possible to tell ECL to NOT let floating point exceptions raise SIGFPE. Then ECL's SIGFPE handler is irrelevant, and the fenv state ECL wants is basically consistent with what we want. This is the solution currently used.
* alternatively, we could let ECL do what it wants and set/restore fenv upon entry/exit of ECL code. `fesetenv` and `fegetenv` are the relevant routines from `fenv.h`. In addition, though, we should restore ECL's SIGFPE handler during ECL code execution, if we go that route (currently we don't).

This was one of these issues that's really easy to resolve, once you understand the problem.

The main confusion is that there are two components: *whether* floating point exceptions should raise SIGFPE, and how SIGFPE gets handled once it's raised. You might think these two components are controlled via the same mechanism, but they are not. It looks like ECL might be investigating if its configuration can be streamlined on these two issues: https://gitlab.com/embeddable-common-lisp/ecl/issues/347

Currently there are two options that seem relevant: ECL_OPT_TRAP_SIGFPE and `--no-trap-fpe` that feed into different places and control different aspects.



---

archive/issue_comments_330305.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [nbruin](#comment%3A35):\n> This was one of these issues that's really easy to resolve, once you understand the problem.\n\n\nSo the issue is solved now?",
    "created_at": "2017-01-19T18:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330305",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>
Replying to [nbruin](#comment%3A35):
> This was one of these issues that's really easy to resolve, once you understand the problem.


So the issue is solved now?



---

archive/issue_comments_330306.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [jdemeyer](#comment%3A36):\n> Replying to [nbruin](#comment%3A35):\n> > This was one of these issues that's really easy to resolve, once you understand the problem.\n\n> \n> So the issue is solved now?\n\n\nit is desirable to tell ECL to NOT let floating point exceptions raise SIGFPE\n**before** booting it up, not during the bootup, for this leaves a time window where SIGFPE can be raised. How can this be done?",
    "created_at": "2017-01-19T18:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330306",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
Replying to [jdemeyer](#comment%3A36):
> Replying to [nbruin](#comment%3A35):
> > This was one of these issues that's really easy to resolve, once you understand the problem.

> 
> So the issue is solved now?


it is desirable to tell ECL to NOT let floating point exceptions raise SIGFPE
**before** booting it up, not during the bootup, for this leaves a time window where SIGFPE can be raised. How can this be done?



---

archive/issue_comments_330307.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [dimpase](#comment%3A37):\n> it is desirable to tell ECL to NOT let floating point exceptions raise SIGFPE\n> **before** booting it up, not during the bootup, for this leaves a time window where SIGFPE can be raised. How can this be done?\n\n\nI think this is an academic issue, because in our current setting, no fp exceptions will occur in the window, and hence the way SIGFPE is handled is irrelevant. Anyway:\n\nI assume ECL installs its SIGFPE handler before it executes any FP instructions and/or sets the fenv. The ECL's SIGFPE handler greatly eases the effect of SIGFPE. So if `(si::trap-fpe T NIL)` is executed right after `cl_boot`; before switching the SIGhandlers, I think the risk is smaller (I don't think there is a risk at all because no FP work occurs in this process, so it's hard to make an accurate estimate of the relative risks here).\n\nAlternatively, you could trust that ECL knows what it's doing and execute cl_boot with an argv that contains `--no-trap-fpe`. With any luck, that should just get processed in the same way as command line options upon startup. It is then ECL's responsibility to do this before a SIGFPE actually occurs. In reality, this is essentially the same as just feeding ECL `(si::trap-fpe T NIL)` just after boot.\n\nfenv is supposed to be thread-specific, so concurrency issues should not come into play, even if sage were ever to grow multiple threads.",
    "created_at": "2017-01-19T19:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330307",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:38'></a>
Replying to [dimpase](#comment%3A37):
> it is desirable to tell ECL to NOT let floating point exceptions raise SIGFPE
> **before** booting it up, not during the bootup, for this leaves a time window where SIGFPE can be raised. How can this be done?


I think this is an academic issue, because in our current setting, no fp exceptions will occur in the window, and hence the way SIGFPE is handled is irrelevant. Anyway:

I assume ECL installs its SIGFPE handler before it executes any FP instructions and/or sets the fenv. The ECL's SIGFPE handler greatly eases the effect of SIGFPE. So if `(si::trap-fpe T NIL)` is executed right after `cl_boot`; before switching the SIGhandlers, I think the risk is smaller (I don't think there is a risk at all because no FP work occurs in this process, so it's hard to make an accurate estimate of the relative risks here).

Alternatively, you could trust that ECL knows what it's doing and execute cl_boot with an argv that contains `--no-trap-fpe`. With any luck, that should just get processed in the same way as command line options upon startup. It is then ECL's responsibility to do this before a SIGFPE actually occurs. In reality, this is essentially the same as just feeding ECL `(si::trap-fpe T NIL)` just after boot.

fenv is supposed to be thread-specific, so concurrency issues should not come into play, even if sage were ever to grow multiple threads.



---

archive/issue_comments_330308.json:
```json
{
    "body": "<a id='comment:39'></a>\nNeeds review?",
    "created_at": "2017-01-23T20:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330308",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:39'></a>
Needs review?



---

archive/issue_comments_330309.json:
```json
{
    "body": "**Changing work_issues** from \"sort out SIGFPE\" to \"\".",
    "created_at": "2017-01-23T20:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330309",
    "user": "https://github.com/nbruin"
}
```

**Changing work_issues** from "sort out SIGFPE" to "".



---

archive/issue_events_198394.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-01-23T20:18:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198394"
}
```



---

archive/issue_events_198395.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-01-23T20:18:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198395"
}
```



---

archive/issue_comments_330310.json:
```json
{
    "body": "<a id='comment:40'></a>\nthere is now https://gitlab.com/embeddable-common-lisp/ecl/issues/349\nand also still `write_error` patch to remove.",
    "created_at": "2017-01-23T22:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330310",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>
there is now https://gitlab.com/embeddable-common-lisp/ecl/issues/349
and also still `write_error` patch to remove.



---

archive/issue_events_198396.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-24T08:13:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198396"
}
```



---

archive/issue_events_198397.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-24T08:13:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198397"
}
```



---

archive/issue_comments_330311.json:
```json
{
    "body": "<a id='comment:41'></a>\nYou should document the change to `src/sage/libs/ecl.pyx`. At a minimum, there should be a link to this ticket.",
    "created_at": "2017-01-24T08:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330311",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
You should document the change to `src/sage/libs/ecl.pyx`. At a minimum, there should be a link to this ticket.



---

archive/issue_comments_330312.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [jdemeyer](#comment%3A41):\n> You should document the change to `src/sage/libs/ecl.pyx`. At a minimum, there should be a link to this ticket.\n\n\nSure. I didn't set it up for review, Nils did. IMHO upstream is still working on this.",
    "created_at": "2017-01-24T11:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330312",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>
Replying to [jdemeyer](#comment%3A41):
> You should document the change to `src/sage/libs/ecl.pyx`. At a minimum, there should be a link to this ticket.


Sure. I didn't set it up for review, Nils did. IMHO upstream is still working on this.



---

archive/issue_comments_330313.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [dimpase](#comment%3A40):\n> there is now https://gitlab.com/embeddable-common-lisp/ecl/issues/349\n> and also still `write_error` patch to remove.\n\n\nThat ticket has now been closed and its fix was to change a test.\n\nNo movement on https://gitlab.com/embeddable-common-lisp/ecl/issues/347, so if updating ECL is relevant then doing so with the `(si::trap-fpe T NIL)` given here is probably a good way to go.",
    "created_at": "2017-05-17T19:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330313",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:44'></a>
Replying to [dimpase](#comment%3A40):
> there is now https://gitlab.com/embeddable-common-lisp/ecl/issues/349
> and also still `write_error` patch to remove.


That ticket has now been closed and its fix was to change a test.

No movement on https://gitlab.com/embeddable-common-lisp/ecl/issues/347, so if updating ECL is relevant then doing so with the `(si::trap-fpe T NIL)` given here is probably a good way to go.



---

archive/issue_events_198398.json:
```json
{
    "actor": "https://github.com/tobihan",
    "created_at": "2018-04-10T20:28:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "rename": {
        "from": "update ECL to 6.1.3",
        "to": "update ECL to 16.1.3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198398"
}
```



---

archive/issue_comments_330314.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-ECL 6.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). \n+ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). \n \n We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n``````\n",
    "created_at": "2018-04-10T20:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330314",
    "user": "https://github.com/tobihan"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-ECL 6.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). 
+ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). 
 
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
``````




---

archive/issue_comments_330315.json:
```json
{
    "body": "<a id='comment:46'></a>\nAny chance this could be finished soon? Some of the ECL maintainers in Debian would like to update the ECL package.",
    "created_at": "2018-04-10T20:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330315",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:46'></a>
Any chance this could be finished soon? Some of the ECL maintainers in Debian would like to update the ECL package.



---

archive/issue_comments_330316.json:
```json
{
    "body": "<a id='comment:47'></a>\nIf I am being honest we want a brand new release of ECL. It won't fix everything but we may be in a better position.",
    "created_at": "2018-04-10T22:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330316",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>
If I am being honest we want a brand new release of ECL. It won't fix everything but we may be in a better position.



---

archive/issue_comments_330317.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [fbissey](#comment%3A47):\n> If I am being honest we want a brand new release of ECL. It won't fix everything but we may be in a better position.\n\n\nI second this. 16.1.3 introduced tricky changes, and the upcoming release (they wanted to get something in late 2017, but OK...) is going again to be much different in the way exceptions are handled.",
    "created_at": "2018-04-11T07:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330317",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
Replying to [fbissey](#comment%3A47):
> If I am being honest we want a brand new release of ECL. It won't fix everything but we may be in a better position.


I second this. 16.1.3 introduced tricky changes, and the upcoming release (they wanted to get something in late 2017, but OK...) is going again to be much different in the way exceptions are handled.



---

archive/issue_comments_330318.json:
```json
{
    "body": "<a id='comment:53'></a>\nIn case we're really waiting for the next ecl release, here is the [gitlab milestone](https://gitlab.com/embeddable-common-lisp/ecl/milestones/8) and the [rc testing issue](https://gitlab.com/embeddable-common-lisp/ecl/issues/333) (which was opened a year ago and got practically no attention).",
    "created_at": "2018-08-24T09:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330318",
    "user": "https://github.com/timokau"
}
```

<a id='comment:53'></a>
In case we're really waiting for the next ecl release, here is the [gitlab milestone](https://gitlab.com/embeddable-common-lisp/ecl/milestones/8) and the [rc testing issue](https://gitlab.com/embeddable-common-lisp/ecl/issues/333) (which was opened a year ago and got practically no attention).



---

archive/issue_comments_330319.json:
```json
{
    "body": "<a id='comment:54'></a>\nDoes it help with this ticket that upstream issue 347 was closed a month ago:\n\n- https://gitlab.com/embeddable-common-lisp/ecl/issues/347",
    "created_at": "2018-12-16T21:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330319",
    "user": "https://github.com/slel"
}
```

<a id='comment:54'></a>
Does it help with this ticket that upstream issue 347 was closed a month ago:

- https://gitlab.com/embeddable-common-lisp/ecl/issues/347



---

archive/issue_events_198399.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-16T21:11:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198399"
}
```



---

archive/issue_events_198400.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-16T21:11:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198400"
}
```



---

archive/issue_comments_330320.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"upgrade, ecl\".",
    "created_at": "2018-12-16T21:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330320",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "upgrade, ecl".



---

archive/issue_comments_330321.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2018-12-16T21:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330321",
    "user": "https://github.com/slel"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_330322.json:
```json
{
    "body": "<a id='comment:55'></a>\nNote: debian-science-sagemath discussion about upgrading to ECL 16.1.3:\n\n- https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-December/001366.html",
    "created_at": "2018-12-16T21:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330322",
    "user": "https://github.com/slel"
}
```

<a id='comment:55'></a>
Note: debian-science-sagemath discussion about upgrading to ECL 16.1.3:

- https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-December/001366.html



---

archive/issue_comments_330323.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [slelievre](#comment%3A54):\n> Does it help with this ticket that upstream issue 347 was closed a month ago:\n> \n> - https://gitlab.com/embeddable-common-lisp/ecl/issues/347\n\n\nIt is unclear why it was closed. Possibly because no one was caring. As far as it goes, some of the fix we need would be hard to rebase on top of 16.1.3 - we may just as well try a snapshot from git with all the uncertainty that it entails.",
    "created_at": "2018-12-16T23:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330323",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>
Replying to [slelievre](#comment%3A54):
> Does it help with this ticket that upstream issue 347 was closed a month ago:
> 
> - https://gitlab.com/embeddable-common-lisp/ecl/issues/347


It is unclear why it was closed. Possibly because no one was caring. As far as it goes, some of the fix we need would be hard to rebase on top of 16.1.3 - we may just as well try a snapshot from git with all the uncertainty that it entails.



---

archive/issue_comments_330324.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [fbissey](#comment%3A57):\n \n> It is unclear why it was closed. Possibly because no one was caring. As far as it goes, some of the fix we need would be hard to rebase on top of 16.1.3 - we may just as well try a snapshot from git with all the uncertainty that it entails.\n\n\nIf I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59\n\nBeckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.",
    "created_at": "2018-12-16T23:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330324",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:58'></a>
Replying to [fbissey](#comment%3A57):
 
> It is unclear why it was closed. Possibly because no one was caring. As far as it goes, some of the fix we need would be hard to rebase on top of 16.1.3 - we may just as well try a snapshot from git with all the uncertainty that it entails.


If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59

Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.



---

archive/issue_comments_330325.json:
```json
{
    "body": "<a id='comment:59'></a>\nOh right. I am obviously not used to gitlab UI for those. Did you also manage to backport the fix for https://gitlab.com/embeddable-common-lisp/ecl/issues/317 ?",
    "created_at": "2018-12-16T23:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330325",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:59'></a>
Oh right. I am obviously not used to gitlab UI for those. Did you also manage to backport the fix for https://gitlab.com/embeddable-common-lisp/ecl/issues/317 ?



---

archive/issue_comments_330326.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [fbissey](#comment%3A59):\n> Oh right. I am obviously not used to gitlab UI for those. Did you also manage to backport the fix for https://gitlab.com/embeddable-common-lisp/ecl/issues/317 ?\n\n\nI did now, still no improvement.",
    "created_at": "2018-12-16T23:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330326",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:60'></a>
Replying to [fbissey](#comment%3A59):
> Oh right. I am obviously not used to gitlab UI for those. Did you also manage to backport the fix for https://gitlab.com/embeddable-common-lisp/ecl/issues/317 ?


I did now, still no improvement.



---

archive/issue_comments_330327.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [arojas](#comment%3A58):\n> \n> If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59\n> \n> Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.\n\n\nAs the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.",
    "created_at": "2018-12-18T16:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330327",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:61'></a>
Replying to [arojas](#comment%3A58):
> 
> If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59
> 
> Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.


As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.



---

archive/issue_comments_330328.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [gh-spaghettisalat](#comment%3A61):\n> Replying to [arojas](#comment%3A58):\n> > \n> > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59\n> > \n> > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.\n\n> \n> As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.\n\n\nYes, still no difference",
    "created_at": "2018-12-18T21:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330328",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:62'></a>
Replying to [gh-spaghettisalat](#comment%3A61):
> Replying to [arojas](#comment%3A58):
> > 
> > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59
> > 
> > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.

> 
> As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.


Yes, still no difference



---

archive/issue_comments_330329.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [arojas](#comment%3A62):\n> Replying to [gh-spaghettisalat](#comment%3A61):\n> > Replying to [arojas](#comment%3A58):\n> > > \n> > > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59\n> > > \n> > > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.\n\n> > \n> > As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.\n\n> \n> Yes, still no difference\n\n\nIs the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.",
    "created_at": "2018-12-18T21:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330329",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:63'></a>
Replying to [arojas](#comment%3A62):
> Replying to [gh-spaghettisalat](#comment%3A61):
> > Replying to [arojas](#comment%3A58):
> > > 
> > > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59
> > > 
> > > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.

> > 
> > As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.

> 
> Yes, still no difference


Is the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.



---

archive/issue_comments_330330.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [fbissey](#comment%3A63):\n> Is the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.\n\n\nHere it is: http://pkgbuild.com/~arojas/sagemath-ecl-sigfpe.patch\n\necl version is 16.1.3 with 2a9084b1 and c2b29417 backported",
    "created_at": "2018-12-18T21:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330330",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:64'></a>
Replying to [fbissey](#comment%3A63):
> Is the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.


Here it is: http://pkgbuild.com/~arojas/sagemath-ecl-sigfpe.patch

ecl version is 16.1.3 with 2a9084b1 and c2b29417 backported



---

archive/issue_comments_330331.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [arojas](#comment%3A64):\n> Replying to [fbissey](#comment%3A63):\n> > Is the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.\n\n> \n> Here it is: http://pkgbuild.com/~arojas/sagemath-ecl-sigfpe.patch\n> \n> ecl version is 16.1.3 with 2a9084b1 and c2b29417 backported\n\n\nI was thinking of the backport patches as well actually.",
    "created_at": "2018-12-18T21:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330331",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:65'></a>
Replying to [arojas](#comment%3A64):
> Replying to [fbissey](#comment%3A63):
> > Is the patch set you are working with available somewhere? I would like to try what you have done myself. May be more eyeballs can detect an issue that escaped you.

> 
> Here it is: http://pkgbuild.com/~arojas/sagemath-ecl-sigfpe.patch
> 
> ecl version is 16.1.3 with 2a9084b1 and c2b29417 backported


I was thinking of the backport patches as well actually.



---

archive/issue_comments_330332.json:
```json
{
    "body": "<a id='comment:66'></a>\nhttp://pkgbuild.com/~arojas/2a9084b1.diff\n\nhttp://pkgbuild.com/~arojas/c2b29417.diff",
    "created_at": "2018-12-18T21:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330332",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:66'></a>
http://pkgbuild.com/~arojas/2a9084b1.diff

http://pkgbuild.com/~arojas/c2b29417.diff



---

archive/issue_comments_330333.json:
```json
{
    "body": "<a id='comment:67'></a>\nThank you. I must say my memory of that conversation - started more than a year ago - was making the backport patches way more complicated.",
    "created_at": "2018-12-18T21:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330333",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:67'></a>
Thank you. I must say my memory of that conversation - started more than a year ago - was making the backport patches way more complicated.



---

archive/issue_comments_330334.json:
```json
{
    "body": "<a id='comment:69'></a>\nIs this something we should also try to get done for 8.6, along with the GAP 4.10 upgrade?  ISTM that would be best from the Debian perspective.",
    "created_at": "2018-12-20T09:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330334",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>
Is this something we should also try to get done for 8.6, along with the GAP 4.10 upgrade?  ISTM that would be best from the Debian perspective.



---

archive/issue_comments_330335.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [embray](#comment%3A69):\n> Is this something we should also try to get done for 8.6, along with the GAP 4.10 upgrade?  ISTM that would be best from the Debian perspective.\n\n\necl 16.1.3 has been out for a while. Us in the distro world have been stumped for a bit. If you can move it, it would be very much appreciated. Everyone has their own timetable and that would be more interesting to me in Gentoo than gap 4.10 (because I am literally in charge of gap amongst other things - and don't get me wrong getting gap 4.10 is important especially getting rid of libgap).",
    "created_at": "2018-12-20T09:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330335",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:70'></a>
Replying to [embray](#comment%3A69):
> Is this something we should also try to get done for 8.6, along with the GAP 4.10 upgrade?  ISTM that would be best from the Debian perspective.


ecl 16.1.3 has been out for a while. Us in the distro world have been stumped for a bit. If you can move it, it would be very much appreciated. Everyone has their own timetable and that would be more interesting to me in Gentoo than gap 4.10 (because I am literally in charge of gap amongst other things - and don't get me wrong getting gap 4.10 is important especially getting rid of libgap).



---

archive/issue_comments_330336.json:
```json
{
    "body": "<a id='comment:71'></a>\nECL has not done a new release in years. We were hoping their next release would address some of problems with signals and exceptions we found in 16.1.3 - something that needed tricky work on Sage side, only to be thrown away, as ECL is going to change in this area a lot...",
    "created_at": "2018-12-20T09:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330336",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:71'></a>
ECL has not done a new release in years. We were hoping their next release would address some of problems with signals and exceptions we found in 16.1.3 - something that needed tricky work on Sage side, only to be thrown away, as ECL is going to change in this area a lot...



---

archive/issue_comments_330337.json:
```json
{
    "body": "<a id='comment:72'></a>\nNote: the ECL release manager tells me the current estimate for the ECL 16.2.0\nrelease date is \"first quarter of 2019\".",
    "created_at": "2018-12-20T10:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330337",
    "user": "https://github.com/slel"
}
```

<a id='comment:72'></a>
Note: the ECL release manager tells me the current estimate for the ECL 16.2.0
release date is "first quarter of 2019".



---

archive/issue_comments_330338.json:
```json
{
    "body": "<a id='comment:73'></a>\nSo they should have a beta soon, no?",
    "created_at": "2018-12-20T10:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330338",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:73'></a>
So they should have a beta soon, no?



---

archive/issue_comments_330339.json:
```json
{
    "body": "<a id='comment:74'></a>\nWell they have been \"release candidate testing\" without any activity for a year now (https://gitlab.com/embeddable-common-lisp/ecl/issues/333). I wouldn't bet on the Q1 2019 release.",
    "created_at": "2018-12-20T10:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330339",
    "user": "https://github.com/timokau"
}
```

<a id='comment:74'></a>
Well they have been "release candidate testing" without any activity for a year now (https://gitlab.com/embeddable-common-lisp/ecl/issues/333). I wouldn't bet on the Q1 2019 release.



---

archive/issue_comments_330340.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [arojas](#comment%3A62):\n> Replying to [gh-spaghettisalat](#comment%3A61):\n> > Replying to [arojas](#comment%3A58):\n> > > \n> > > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59\n> > > \n> > > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.\n\n> > \n> > As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.\n\n> \n> Yes, still no difference\n\nThen I'm guessing, the branch at https://github.com/sagemath/sagetrac-mirror/commits/u/nbruin/ecl16.1.3 also failed for you? Because all the patch of \u200bhttps://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59 does is to call `(si::trap-fpe t nil)` during startup if the `ECL_OPT_TRAP_SIGFPE` option is false.\n\nAnyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course). This is also consistent with the observation in https://gitlab.com/embeddable-common-lisp/ecl/issues/317 that floating point overflows behaved differently than the other floating point exceptions.",
    "created_at": "2018-12-23T20:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330340",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:75'></a>
Replying to [arojas](#comment%3A62):
> Replying to [gh-spaghettisalat](#comment%3A61):
> > Replying to [arojas](#comment%3A58):
> > > 
> > > If I'm reading it correctly it was closed by https://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59
> > > 
> > > Beckporting that commit to 16.1.3 still doesn't fix the SIGFPE crashes on Arch unfortunately.

> > 
> > As the ECL developer that made this change: Did you also set the ECL_OPT_TRAP_SIGFPE option to false, i.e. put an extra line `ecl_set_option(ECL_OPT_TRAP_SIGFPE, 0);` into the ecl.pyx file before testing this? Because otherwise if you use the default value of true, you still instruct ECL to generate and catch floating point exceptions.

> 
> Yes, still no difference

Then I'm guessing, the branch at https://github.com/sagemath/sagetrac-mirror/commits/u/nbruin/ecl16.1.3 also failed for you? Because all the patch of ‚Äãhttps://gitlab.com/embeddable-common-lisp/ecl/commit/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59 does is to call `(si::trap-fpe t nil)` during startup if the `ECL_OPT_TRAP_SIGFPE` option is false.

Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course). This is also consistent with the observation in https://gitlab.com/embeddable-common-lisp/ecl/issues/317 that floating point overflows behaved differently than the other floating point exceptions.



---

archive/issue_comments_330341.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [gh-spaghettisalat](#comment%3A75):\n> Then I'm guessing, the branch at https://github.com/sagemath/sagetrac-mirror/commits/u/nbruin/ecl16.1.3 also failed for you? \n\n\nYou're right, the branch never worked for me\n\n> Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).\n\n\nAnd you're right again. Removed that line in maxima and there are no more crashes.",
    "created_at": "2018-12-23T21:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330341",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:76'></a>
Replying to [gh-spaghettisalat](#comment%3A75):
> Then I'm guessing, the branch at https://github.com/sagemath/sagetrac-mirror/commits/u/nbruin/ecl16.1.3 also failed for you? 


You're right, the branch never worked for me

> Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).


And you're right again. Removed that line in maxima and there are no more crashes.



---

archive/issue_comments_330342.json:
```json
{
    "body": "<a id='comment:77'></a>\nReplying to [gh-spaghettisalat](#comment%3A75):\n> Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).\n\n\nIn that case, I suspect that for us the right place to fix it is to revert the effect of the line in `ecl-port.lisp` after initialization in `maxima_lib`. Then we don't have to patch maxima. Also, maxima may have a good reason to do this under normal operation, and sagemath does build maxima both for stand-alone use and for library use (and it uses the same `fas` for both!). Unless we have a good reason, we should probably not modify the stand-alone behaviour.\n\nThe relevant file would be `sage/interfaces/maxima_lib.py`, somewhere after the `(require 'maxima)`. It already has a lot of lisp commands that go digging in the internals of maxima. The short window where `maxima` turns on fpe exceptions and we turn them off again shouldn't be a problem.",
    "created_at": "2018-12-23T21:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330342",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:77'></a>
Replying to [gh-spaghettisalat](#comment%3A75):
> Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).


In that case, I suspect that for us the right place to fix it is to revert the effect of the line in `ecl-port.lisp` after initialization in `maxima_lib`. Then we don't have to patch maxima. Also, maxima may have a good reason to do this under normal operation, and sagemath does build maxima both for stand-alone use and for library use (and it uses the same `fas` for both!). Unless we have a good reason, we should probably not modify the stand-alone behaviour.

The relevant file would be `sage/interfaces/maxima_lib.py`, somewhere after the `(require 'maxima)`. It already has a lot of lisp commands that go digging in the internals of maxima. The short window where `maxima` turns on fpe exceptions and we turn them off again shouldn't be a problem.



---

archive/issue_comments_330343.json:
```json
{
    "body": "<a id='comment:78'></a>\nWith this [1] patch in sagemath it no longer crashes for me, with unmodified ecl and maxima\n\n[1] https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ecl-sigfpe.patch?h=packages/sagemath",
    "created_at": "2018-12-23T22:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330343",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:78'></a>
With this [1] patch in sagemath it no longer crashes for me, with unmodified ecl and maxima

[1] https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ecl-sigfpe.patch?h=packages/sagemath



---

archive/issue_comments_330344.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [nbruin](#comment%3A77):\n> Replying to [gh-spaghettisalat](#comment%3A75):\n> > Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).\n\n> \n> In that case, I suspect that for us the right place to fix it is to revert the effect of the line in `ecl-port.lisp` after initialization in `maxima_lib`. Then we don't have to patch maxima. Also, maxima may have a good reason to do this under normal operation, and sagemath does build maxima both for stand-alone use and for library use (and it uses the same `fas` for both!). Unless we have a good reason, we should probably not modify the stand-alone behaviour.\n> \n> The relevant file would be `sage/interfaces/maxima_lib.py`, somewhere after the `(require 'maxima)`. It already has a lot of lisp commands that go digging in the internals of maxima. The short window where `maxima` turns on fpe exceptions and we turn them off again shouldn't be a problem.\n\n\n+1 Sage should not depend on non-standard functionality supplied via patch in order to work.",
    "created_at": "2018-12-28T14:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330344",
    "user": "https://github.com/embray"
}
```

<a id='comment:79'></a>
Replying to [nbruin](#comment%3A77):
> Replying to [gh-spaghettisalat](#comment%3A75):
> > Anyway, I think the real issue is that maxima enables floating point overflow exceptions during startup (see the last line in the src/ecl-port.lisp file of the maxima source directory). Removing this line should fix the observed crashes also with an unpatched ECL 16.1.3 and without the need to explicitely call `(si::trap-fpe t nil)` in ecl.pyx (as long as the `ECL_OPT_TRAP_SIGFPE` option is false of course).

> 
> In that case, I suspect that for us the right place to fix it is to revert the effect of the line in `ecl-port.lisp` after initialization in `maxima_lib`. Then we don't have to patch maxima. Also, maxima may have a good reason to do this under normal operation, and sagemath does build maxima both for stand-alone use and for library use (and it uses the same `fas` for both!). Unless we have a good reason, we should probably not modify the stand-alone behaviour.
> 
> The relevant file would be `sage/interfaces/maxima_lib.py`, somewhere after the `(require 'maxima)`. It already has a lot of lisp commands that go digging in the internals of maxima. The short window where `maxima` turns on fpe exceptions and we turn them off again shouldn't be a problem.


+1 Sage should not depend on non-standard functionality supplied via patch in order to work.



---

archive/issue_comments_330345.json:
```json
{
    "body": "<a id='comment:80'></a>\nOf the patches we still include for our ECL build, are there any that haven't been submitted upstream, or at least that still need upstream issues?\n\nI know that I got `flisten-bug.patch` fixed here: https://gitlab.com/embeddable-common-lisp/ecl/merge_requests/51  so that patch can probably be backported to 16.1.3 if need be (and in any case, the bug it fixes was only, to my knowledge, affecting Cygwin, so I don't care about it for Linux).",
    "created_at": "2018-12-31T11:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330345",
    "user": "https://github.com/embray"
}
```

<a id='comment:80'></a>
Of the patches we still include for our ECL build, are there any that haven't been submitted upstream, or at least that still need upstream issues?

I know that I got `flisten-bug.patch` fixed here: https://gitlab.com/embeddable-common-lisp/ecl/merge_requests/51  so that patch can probably be backported to 16.1.3 if need be (and in any case, the bug it fixes was only, to my knowledge, affecting Cygwin, so I don't care about it for Linux).



---

archive/issue_comments_330346.json:
```json
{
    "body": "<a id='comment:81'></a>\nAlso, are we still doing the tarball patching with `spkg-src`?  I did not do that, so I'm guessing it's obsolete.",
    "created_at": "2018-12-31T15:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330346",
    "user": "https://github.com/embray"
}
```

<a id='comment:81'></a>
Also, are we still doing the tarball patching with `spkg-src`?  I did not do that, so I'm guessing it's obsolete.



---

archive/issue_comments_330347.json:
```json
{
    "body": "<a id='comment:82'></a>\nThe difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.\n\nThe only effect of setting `ECL_OPT_TRAP_SIGFPE = 0` is that ECL's signal handler won't be installed (actually this setting could be avoided entirely by saving/restoring ECL's SIGFPE handler like we do some of its other signal handlers).\n\nHowever, `(si::trap-fpe t nil)` still results now in unhandled `SIGFPE`s in random places where previously floating point exceptions were just ignored, or handled manually.",
    "created_at": "2018-12-31T17:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330347",
    "user": "https://github.com/embray"
}
```

<a id='comment:82'></a>
The difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.

The only effect of setting `ECL_OPT_TRAP_SIGFPE = 0` is that ECL's signal handler won't be installed (actually this setting could be avoided entirely by saving/restoring ECL's SIGFPE handler like we do some of its other signal handlers).

However, `(si::trap-fpe t nil)` still results now in unhandled `SIGFPE`s in random places where previously floating point exceptions were just ignored, or handled manually.



---

archive/issue_comments_330348.json:
```json
{
    "body": "<a id='comment:83'></a>\nReplying to [embray](#comment%3A82):\n> The difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.\n\n\nNo, the effect of `(si::trap-fpe t nil)` is to call `feenableexcept(0)`. What you're describing happens with `(si::trap-fpe t t)`.\n\n> The only effect of setting `ECL_OPT_TRAP_SIGFPE = 0` is that ECL's signal handler won't be installed (actually this setting could be avoided entirely by saving/restoring ECL's SIGFPE handler like we do some of its other signal handlers).\n\n\nThe effect of `ECL_OPT_TRAP_SIGFPE = 0` in ECL 16.1.3 is a) that no signal handler for SIGFPE exceptions is installed and b) that in contrast to `ECL_OPT_TRAP_SIGFPE = 1` no floating point exceptions are enabled (i.e. feenableexcept is not called). Because of the feature request https://gitlab.com/embeddable-common-lisp/ecl/issues/347, the next ECL release changes this behaviour to call `feenableexcept(0)` during startup if `ECL_OPT_TRAP_SIGFPE` is 0.\n\n> However, `(si::trap-fpe t nil)` still results now in unhandled `SIGFPE`s in random places where previously floating point exceptions were just ignored, or handled manually.\n\n\nNo, it doesn't, as explained above.",
    "created_at": "2018-12-31T17:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330348",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:83'></a>
Replying to [embray](#comment%3A82):
> The difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.


No, the effect of `(si::trap-fpe t nil)` is to call `feenableexcept(0)`. What you're describing happens with `(si::trap-fpe t t)`.

> The only effect of setting `ECL_OPT_TRAP_SIGFPE = 0` is that ECL's signal handler won't be installed (actually this setting could be avoided entirely by saving/restoring ECL's SIGFPE handler like we do some of its other signal handlers).


The effect of `ECL_OPT_TRAP_SIGFPE = 0` in ECL 16.1.3 is a) that no signal handler for SIGFPE exceptions is installed and b) that in contrast to `ECL_OPT_TRAP_SIGFPE = 1` no floating point exceptions are enabled (i.e. feenableexcept is not called). Because of the feature request https://gitlab.com/embeddable-common-lisp/ecl/issues/347, the next ECL release changes this behaviour to call `feenableexcept(0)` during startup if `ECL_OPT_TRAP_SIGFPE` is 0.

> However, `(si::trap-fpe t nil)` still results now in unhandled `SIGFPE`s in random places where previously floating point exceptions were just ignored, or handled manually.


No, it doesn't, as explained above.



---

archive/issue_comments_330349.json:
```json
{
    "body": "<a id='comment:84'></a>\nReplying to [arojas](#comment%3A78):\n> With this [1] patch in sagemath it no longer crashes for me, with unmodified ecl and maxima\n> \n> [1] https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ecl-sigfpe.patch?h=packages/sagemath\n\n\nThis patch also works for me.  It's not ideal but it's okay as a temporary workaround.",
    "created_at": "2018-12-31T18:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330349",
    "user": "https://github.com/embray"
}
```

<a id='comment:84'></a>
Replying to [arojas](#comment%3A78):
> With this [1] patch in sagemath it no longer crashes for me, with unmodified ecl and maxima
> 
> [1] https://git.archlinux.org/svntogit/community.git/tree/trunk/sagemath-ecl-sigfpe.patch?h=packages/sagemath


This patch also works for me.  It's not ideal but it's okay as a temporary workaround.



---

archive/issue_comments_330350.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [gh-spaghettisalat](#comment%3A83):\n> Replying to [embray](#comment%3A82):\n> > The difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.\n\n> \n> No, the effect of `(si::trap-fpe t nil)` is to call `feenableexcept(0)`. What you're describing happens with `(si::trap-fpe t t)`.\n\n\nYou're right: I was having trouble understanding exactly how this code works.  The problem doesn't come from `(si::trap-fpe t nil)`, but rather the fact that maxima later enables traps for overflows (which then needs to be subsequently disabled, per the patch in [comment:78](#comment%3A78)).\n\nI guess, what I would want, would be an option to effectively turn `trap-fpe` into a no-op, because it's still modifying the global floating point environment in a way that's rather opaque and detrimental when embedding.\n\nAnyways, since we identified for now the one place where this was happening--loading maxima--I'm content for now to step away, though we should probably change our `ecl_sig_on/off()` to save/restore the floating point environment and clear any floating point exceptions.\n\nHappy New Year and have a good night!",
    "created_at": "2018-12-31T18:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330350",
    "user": "https://github.com/embray"
}
```

<a id='comment:85'></a>
Replying to [gh-spaghettisalat](#comment%3A83):
> Replying to [embray](#comment%3A82):
> > The difficulty/problem here is that ECL's `si_trap_fpe` still uncondtionally (when available) calls feenableexcept.  The effect of `(si::trap-fpe t nil)` is effectively to call `feenableexcept(FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID)` which means now `SIGFPE`s will be sent to the program that weren't otherwise.

> 
> No, the effect of `(si::trap-fpe t nil)` is to call `feenableexcept(0)`. What you're describing happens with `(si::trap-fpe t t)`.


You're right: I was having trouble understanding exactly how this code works.  The problem doesn't come from `(si::trap-fpe t nil)`, but rather the fact that maxima later enables traps for overflows (which then needs to be subsequently disabled, per the patch in [comment:78](#comment%3A78)).

I guess, what I would want, would be an option to effectively turn `trap-fpe` into a no-op, because it's still modifying the global floating point environment in a way that's rather opaque and detrimental when embedding.

Anyways, since we identified for now the one place where this was happening--loading maxima--I'm content for now to step away, though we should probably change our `ecl_sig_on/off()` to save/restore the floating point environment and clear any floating point exceptions.

Happy New Year and have a good night!



---

archive/issue_comments_330351.json:
```json
{
    "body": "<a id='comment:86'></a>\nHere's my attempt to patch this more generally.  It appears to work, but I'm not sure how robust it is.  With this, it's not necessary to manually call `si::trap-fpe` anywhere, because ECL's FPE traps are saved/restored alongside its signal handlers by `ecl_sig_on/off()`:\n\n\n```diff\ndiff --git a/src/sage/libs/ecl.pyx b/src/sage/libs/ecl.pyx\nindex 8dd2895..fa24ac0 100644\n--- a/src/sage/libs/ecl.pyx\n+++ b/src/sage/libs/ecl.pyx\n@@ -16,7 +16,7 @@ from __future__ import print_function, absolute_import\n #adapted to work with pure Python types.\n\n from libc.stdlib cimport abort\n-from libc.signal cimport SIGINT, SIGBUS, SIGSEGV, SIGCHLD\n+from libc.signal cimport SIGINT, SIGBUS, SIGSEGV, SIGCHLD, SIGFPE\n from libc.signal cimport raise_ as signal_raise\n from posix.signal cimport sigaction, sigaction_t\n cimport cysignals.signals\n@@ -48,9 +48,14 @@ cdef extern from \"eclsig.h\":\n     void ecl_sig_off()\n     cdef sigaction_t ecl_sigint_handler\n     cdef sigaction_t ecl_sigbus_handler\n+    cdef sigaction_t ecl_sigfpe_handler\n     cdef sigaction_t ecl_sigsegv_handler\n     cdef mpz_t ecl_mpz_from_bignum(cl_object obj)\n     cdef cl_object ecl_bignum_from_mpz(mpz_t num)\n+    cdef int fegetexcept()\n+    cdef int feenableexcept(int)\n+    cdef int fedisableexcept(int)\n+    cdef int ecl_feflags\n\n cdef cl_object string_to_object(char * s):\n     return ecl_read_from_cstring(s)\n@@ -239,6 +244,7 @@ def init_ecl():\n     global ecl_has_booted\n     cdef char *argv[1]\n     cdef sigaction_t sage_action[32]\n+    cdef int sage_fpes\n     cdef int i\n\n     if ecl_has_booted:\n@@ -258,6 +264,8 @@ def init_ecl():\n     for i in range(1,32):\n         sigaction(i, NULL, &sage_action[i])\n\n+    sage_fpes = fegetexcept()\n+\n     #initialize ECL\n     ecl_set_option(ECL_OPT_SIGNAL_HANDLING_THREAD, 0)\n     cl_boot(1, argv)\n@@ -265,8 +273,12 @@ def init_ecl():\n     #save signal handler from ECL\n     sigaction(SIGINT, NULL, &ecl_sigint_handler)\n     sigaction(SIGBUS, NULL, &ecl_sigbus_handler)\n+    sigaction(SIGFPE, NULL, &ecl_sigfpe_handler)\n     sigaction(SIGSEGV, NULL, &ecl_sigsegv_handler)\n\n+    #save ECL's floating point exception flags\n+    ecl_feflags = fegetexcept()\n+\n     #verify that no SIGCHLD handler was installed\n     cdef sigaction_t sig_test\n     sigaction(SIGCHLD, NULL, &sig_test)\n@@ -277,6 +289,9 @@ def init_ecl():\n     for i in range(1,32):\n         sigaction(i, &sage_action[i], NULL)\n\n+    fedisableexcept(ecl_feflags)\n+    feenableexcept(sage_fpes)\n+\n     #initialise list of objects and bind to global variable\n     # *SAGE-LIST-OF-OBJECTS* to make it rooted in the reachable tree for the GC\n     list_of_objects=cl_cons(Cnil,cl_cons(Cnil,Cnil))\n@@ -320,8 +335,6 @@ def init_ecl():\n                     (values nil (princ-to-string cnd)))))\n         \"\"\"))\n     safe_funcall_clobj=cl_eval(string_to_object(b\"(symbol-function 'sage-safe-funcall)\"))\n-\n-    cl_eval(string_to_object(\"(si::trap-fpe T NIL)\"))\n     ecl_has_booted = 1\n\n cdef cl_object ecl_safe_eval(cl_object form) except NULL:\ndiff --git a/src/sage/libs/eclsig.h b/src/sage/libs/eclsig.h\nindex f9f2690..c1d5244 100644\n--- a/src/sage/libs/eclsig.h\n+++ b/src/sage/libs/eclsig.h\n@@ -9,25 +9,59 @@\n\n\n #include <signal.h>\n+\n+/* Rummage around to determine how ECL was configured */\n+#define ECL_AVOID_FPE_H  /* Prevent some local includes */\n+#include <ecl/config-internal.h>\n+\n+#ifdef HAVE_FENV_H\n+#include <fenv.h>\n+#ifndef FE_ALL_EXCEPT\n+#define FE_ALL_EXCEPT FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID\n+#endif\n+#else\n+#ifndef FE_ALL_EXCEPT\n+#define FE_ALL_EXCEPT 0\n+#endif\n+#endif\n+\n+#ifndef HAVE_FEENABLEEXCEPT\n+/* These are GNU extensions */\n+#define fegetexcept() 0\n+#define feenablexcept(flags)\n+#define fdisableexcept(flags)\n+#endif\n+\n static struct sigaction ecl_sigint_handler;\n static struct sigaction ecl_sigbus_handler;\n+static struct sigaction ecl_sigfpe_handler;\n static struct sigaction ecl_sigsegv_handler;\n static struct sigaction sage_sigint_handler;\n static struct sigaction sage_sigbus_handler;\n+static struct sigaction sage_sigfpe_handler;\n static struct sigaction sage_sigsegv_handler;\n+static int ecl_feflags;\n+static int sage_feflags;\n\n static inline void set_ecl_signal_handler(void)\n {\n     sigaction(SIGINT, &ecl_sigint_handler, &sage_sigint_handler);\n     sigaction(SIGBUS, &ecl_sigbus_handler, &sage_sigbus_handler);\n+    sigaction(SIGFPE, &ecl_sigfpe_handler, &sage_sigfpe_handler);\n     sigaction(SIGSEGV, &ecl_sigsegv_handler, &sage_sigsegv_handler);\n+    /* sage_feflags should be 0; we don't set them otherwise */\n+    sage_feflags = fedisableexcept(FE_ALL_EXCEPT);\n+    feenableexcept(ecl_feflags);\n }\n\n static inline void unset_ecl_signal_handler(void)\n {\n     sigaction(SIGINT, &sage_sigint_handler, NULL);\n     sigaction(SIGBUS, &sage_sigbus_handler, NULL);\n+    sigaction(SIGFPE, &sage_sigfpe_handler, NULL);\n     sigaction(SIGSEGV, &sage_sigsegv_handler, NULL);\n+    ecl_feflags = fedisableexcept(FE_ALL_EXCEPT);\n+    feenableexcept(sage_feflags);\n }\n\n /* This MUST be a macro because sig_on() must be in the same\n```",
    "created_at": "2018-12-31T18:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330351",
    "user": "https://github.com/embray"
}
```

<a id='comment:86'></a>
Here's my attempt to patch this more generally.  It appears to work, but I'm not sure how robust it is.  With this, it's not necessary to manually call `si::trap-fpe` anywhere, because ECL's FPE traps are saved/restored alongside its signal handlers by `ecl_sig_on/off()`:


```diff
diff --git a/src/sage/libs/ecl.pyx b/src/sage/libs/ecl.pyx
index 8dd2895..fa24ac0 100644
--- a/src/sage/libs/ecl.pyx
+++ b/src/sage/libs/ecl.pyx
@@ -16,7 +16,7 @@ from __future__ import print_function, absolute_import
 #adapted to work with pure Python types.

 from libc.stdlib cimport abort
-from libc.signal cimport SIGINT, SIGBUS, SIGSEGV, SIGCHLD
+from libc.signal cimport SIGINT, SIGBUS, SIGSEGV, SIGCHLD, SIGFPE
 from libc.signal cimport raise_ as signal_raise
 from posix.signal cimport sigaction, sigaction_t
 cimport cysignals.signals
@@ -48,9 +48,14 @@ cdef extern from "eclsig.h":
     void ecl_sig_off()
     cdef sigaction_t ecl_sigint_handler
     cdef sigaction_t ecl_sigbus_handler
+    cdef sigaction_t ecl_sigfpe_handler
     cdef sigaction_t ecl_sigsegv_handler
     cdef mpz_t ecl_mpz_from_bignum(cl_object obj)
     cdef cl_object ecl_bignum_from_mpz(mpz_t num)
+    cdef int fegetexcept()
+    cdef int feenableexcept(int)
+    cdef int fedisableexcept(int)
+    cdef int ecl_feflags

 cdef cl_object string_to_object(char * s):
     return ecl_read_from_cstring(s)
@@ -239,6 +244,7 @@ def init_ecl():
     global ecl_has_booted
     cdef char *argv[1]
     cdef sigaction_t sage_action[32]
+    cdef int sage_fpes
     cdef int i

     if ecl_has_booted:
@@ -258,6 +264,8 @@ def init_ecl():
     for i in range(1,32):
         sigaction(i, NULL, &sage_action[i])

+    sage_fpes = fegetexcept()
+
     #initialize ECL
     ecl_set_option(ECL_OPT_SIGNAL_HANDLING_THREAD, 0)
     cl_boot(1, argv)
@@ -265,8 +273,12 @@ def init_ecl():
     #save signal handler from ECL
     sigaction(SIGINT, NULL, &ecl_sigint_handler)
     sigaction(SIGBUS, NULL, &ecl_sigbus_handler)
+    sigaction(SIGFPE, NULL, &ecl_sigfpe_handler)
     sigaction(SIGSEGV, NULL, &ecl_sigsegv_handler)

+    #save ECL's floating point exception flags
+    ecl_feflags = fegetexcept()
+
     #verify that no SIGCHLD handler was installed
     cdef sigaction_t sig_test
     sigaction(SIGCHLD, NULL, &sig_test)
@@ -277,6 +289,9 @@ def init_ecl():
     for i in range(1,32):
         sigaction(i, &sage_action[i], NULL)

+    fedisableexcept(ecl_feflags)
+    feenableexcept(sage_fpes)
+
     #initialise list of objects and bind to global variable
     # *SAGE-LIST-OF-OBJECTS* to make it rooted in the reachable tree for the GC
     list_of_objects=cl_cons(Cnil,cl_cons(Cnil,Cnil))
@@ -320,8 +335,6 @@ def init_ecl():
                     (values nil (princ-to-string cnd)))))
         """))
     safe_funcall_clobj=cl_eval(string_to_object(b"(symbol-function 'sage-safe-funcall)"))
-
-    cl_eval(string_to_object("(si::trap-fpe T NIL)"))
     ecl_has_booted = 1

 cdef cl_object ecl_safe_eval(cl_object form) except NULL:
diff --git a/src/sage/libs/eclsig.h b/src/sage/libs/eclsig.h
index f9f2690..c1d5244 100644
--- a/src/sage/libs/eclsig.h
+++ b/src/sage/libs/eclsig.h
@@ -9,25 +9,59 @@


 #include <signal.h>
+
+/* Rummage around to determine how ECL was configured */
+#define ECL_AVOID_FPE_H  /* Prevent some local includes */
+#include <ecl/config-internal.h>
+
+#ifdef HAVE_FENV_H
+#include <fenv.h>
+#ifndef FE_ALL_EXCEPT
+#define FE_ALL_EXCEPT FE_DIVBYZERO | FE_OVERFLOW | FE_UNDERFLOW | FE_INVALID
+#endif
+#else
+#ifndef FE_ALL_EXCEPT
+#define FE_ALL_EXCEPT 0
+#endif
+#endif
+
+#ifndef HAVE_FEENABLEEXCEPT
+/* These are GNU extensions */
+#define fegetexcept() 0
+#define feenablexcept(flags)
+#define fdisableexcept(flags)
+#endif
+
 static struct sigaction ecl_sigint_handler;
 static struct sigaction ecl_sigbus_handler;
+static struct sigaction ecl_sigfpe_handler;
 static struct sigaction ecl_sigsegv_handler;
 static struct sigaction sage_sigint_handler;
 static struct sigaction sage_sigbus_handler;
+static struct sigaction sage_sigfpe_handler;
 static struct sigaction sage_sigsegv_handler;
+static int ecl_feflags;
+static int sage_feflags;

 static inline void set_ecl_signal_handler(void)
 {
     sigaction(SIGINT, &ecl_sigint_handler, &sage_sigint_handler);
     sigaction(SIGBUS, &ecl_sigbus_handler, &sage_sigbus_handler);
+    sigaction(SIGFPE, &ecl_sigfpe_handler, &sage_sigfpe_handler);
     sigaction(SIGSEGV, &ecl_sigsegv_handler, &sage_sigsegv_handler);
+    /* sage_feflags should be 0; we don't set them otherwise */
+    sage_feflags = fedisableexcept(FE_ALL_EXCEPT);
+    feenableexcept(ecl_feflags);
 }

 static inline void unset_ecl_signal_handler(void)
 {
     sigaction(SIGINT, &sage_sigint_handler, NULL);
     sigaction(SIGBUS, &sage_sigbus_handler, NULL);
+    sigaction(SIGFPE, &sage_sigfpe_handler, NULL);
     sigaction(SIGSEGV, &sage_sigsegv_handler, NULL);
+    ecl_feflags = fedisableexcept(FE_ALL_EXCEPT);
+    feenableexcept(sage_feflags);
 }

 /* This MUST be a macro because sig_on() must be in the same
```



---

archive/issue_comments_330352.json:
```json
{
    "body": "**Changing commit** from \"[35e9d3d1610bade7ae7d5fac735244be25e009eb](https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb)\" to \"\".",
    "created_at": "2019-01-02T11:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330352",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[35e9d3d1610bade7ae7d5fac735244be25e009eb](https://github.com/sagemath/sagetrac-mirror/commit/35e9d3d1610bade7ae7d5fac735244be25e009eb)" to "".



---

archive/issue_comments_330353.json:
```json
{
    "body": "<a id='comment:87'></a>\nNew branch based on the original one, rebased on 8.6.beta0, and including my floating point exception handling fixes.  These non-standard FPE APIs are woefully underdocumented and confusing, but I think this has the right idea and all tests pass for me, docs build, etc.  It should be a non-issue on platforms that don't have `feenableexcept()`, so we just treat it there as a no-op.",
    "created_at": "2019-01-02T11:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330353",
    "user": "https://github.com/embray"
}
```

<a id='comment:87'></a>
New branch based on the original one, rebased on 8.6.beta0, and including my floating point exception handling fixes.  These non-standard FPE APIs are woefully underdocumented and confusing, but I think this has the right idea and all tests pass for me, docs build, etc.  It should be a non-issue on platforms that don't have `feenableexcept()`, so we just treat it there as a no-op.



---

archive/issue_comments_330354.json:
```json
{
    "body": "**Changing branch** from \"[u/nbruin/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ecl16.1.3)\" to \"[public/ticket-22191](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket-22191)\".",
    "created_at": "2019-01-02T11:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330354",
    "user": "https://github.com/embray"
}
```

**Changing branch** from "[u/nbruin/ecl16.1.3](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ecl16.1.3)" to "[public/ticket-22191](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket-22191)".



---

archive/issue_comments_330355.json:
```json
{
    "body": "**Changing author** from \"Dima Pasechnik\" to \"Dima Pasechnik, Erik Bray\".",
    "created_at": "2019-01-02T11:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330355",
    "user": "https://github.com/embray"
}
```

**Changing author** from "Dima Pasechnik" to "Dima Pasechnik, Erik Bray".



---

archive/issue_events_198401.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-02T11:39:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198401"
}
```



---

archive/issue_events_198402.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-02T11:39:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198402"
}
```



---

archive/issue_comments_330356.json:
```json
{
    "body": "**Commit:** [f2eea3db4ce90cb5743033c32753b9d9ade75703](https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703)",
    "created_at": "2019-01-02T11:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [f2eea3db4ce90cb5743033c32753b9d9ade75703](https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703)



---

archive/issue_comments_330357.json:
```json
{
    "body": "<a id='comment:88'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/615b29fd1a32c0904d078d78e36c5e5f4d076019\">615b29f</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a643fa5996001a01a858607aaf726b73bbc1855\">1a643fa</a></td><td><code>set ECL to not trap floating point exceptions, so that SIGFPE will not occur</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703\">f2eea3d</a></td><td><code>improve save/restore of floating point exception handling when entering/leaving libecl</code></td></tr></table>\n",
    "created_at": "2019-01-02T11:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:88'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/615b29fd1a32c0904d078d78e36c5e5f4d076019">615b29f</a></td><td><code>update ECL to 16.1.3 - most of our patches are obsolete</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a643fa5996001a01a858607aaf726b73bbc1855">1a643fa</a></td><td><code>set ECL to not trap floating point exceptions, so that SIGFPE will not occur</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703">f2eea3d</a></td><td><code>improve save/restore of floating point exception handling when entering/leaving libecl</code></td></tr></table>




---

archive/issue_comments_330358.json:
```json
{
    "body": "<a id='comment:89'></a>\nsome patches don't apply\n\n```\nSetting up build directory for ecl-16.1.3.p0\nFinished extraction\nApplying patches from ../patches...\nApplying ../patches/flisten-bug.patch\npatching file src/c/file.d\nHunk #1 FAILED at 5317.\n1 out of 1 hunk FAILED -- saving rejects to file src/c/file.d.rej\nError applying '../patches/flisten-bug.patch'\n************************************************************************\nError applying patches\n```",
    "created_at": "2019-01-04T03:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330358",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:89'></a>
some patches don't apply

```
Setting up build directory for ecl-16.1.3.p0
Finished extraction
Applying patches from ../patches...
Applying ../patches/flisten-bug.patch
patching file src/c/file.d
Hunk #1 FAILED at 5317.
1 out of 1 hunk FAILED -- saving rejects to file src/c/file.d.rej
Error applying '../patches/flisten-bug.patch'
************************************************************************
Error applying patches
```



---

archive/issue_events_198403.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-01-04T03:16:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198403"
}
```



---

archive/issue_events_198404.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-01-04T03:16:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198404"
}
```



---

archive/issue_comments_330359.json:
```json
{
    "body": "<a id='comment:91'></a>\nI had renamed that patch while updating, but looks like I didn't push the updated patch.",
    "created_at": "2019-01-04T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330359",
    "user": "https://github.com/embray"
}
```

<a id='comment:91'></a>
I had renamed that patch while updating, but looks like I didn't push the updated patch.



---

archive/issue_comments_330360.json:
```json
{
    "body": "**Changing commit** from \"[f2eea3db4ce90cb5743033c32753b9d9ade75703](https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703)\" to \"[ee5a10b5781f825b4da678f54c8b5589d152e438](https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438)\".",
    "created_at": "2019-01-04T12:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f2eea3db4ce90cb5743033c32753b9d9ade75703](https://github.com/sagemath/sagetrac-mirror/commit/f2eea3db4ce90cb5743033c32753b9d9ade75703)" to "[ee5a10b5781f825b4da678f54c8b5589d152e438](https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438)".



---

archive/issue_comments_330361.json:
```json
{
    "body": "<a id='comment:92'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438\">ee5a10b</a></td><td><code>updated this patch to apply cleanly to ECL 16.1.3</code></td></tr></table>\n",
    "created_at": "2019-01-04T12:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:92'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438">ee5a10b</a></td><td><code>updated this patch to apply cleanly to ECL 16.1.3</code></td></tr></table>




---

archive/issue_events_198405.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-04T13:01:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198405"
}
```



---

archive/issue_events_198406.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-04T13:01:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198406"
}
```



---

archive/issue_comments_330362.json:
```json
{
    "body": "**Changing author** from \"Dima Pasechnik, Erik Bray\" to \"Nils Bruin, Dima Pasechnik, Erik Bray\".",
    "created_at": "2019-01-06T02:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330362",
    "user": "https://github.com/dimpase"
}
```

**Changing author** from "Dima Pasechnik, Erik Bray" to "Nils Bruin, Dima Pasechnik, Erik Bray".



---

archive/issue_comments_330363.json:
```json
{
    "body": "<a id='comment:94'></a>\nNils, could you have a look at this?",
    "created_at": "2019-01-06T02:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330363",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:94'></a>
Nils, could you have a look at this?



---

archive/issue_comments_330364.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2019-01-06T02:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330364",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_330365.json:
```json
{
    "body": "<a id='comment:95'></a>\nIt seems to me that the `fedisableexcept/feenableexcept` dance is supposed to switch between \"ecl\" FPE state and \"sage\" FPE state. However, that is not what those commands do. According to the documentation, `fedisableexcept` just disables the given exceptions (and leaves the other ones the way they were) and `feenableexcept` enables them. Furthermore, it seems these are supposedly glibc extensions.\n\nWhen I look at the relevant manpage, it seems to indicate that `fegetenv` and `fesetenv` are defined in C99 and do set the FPE environment wholesale. So, would it be better to do:\n\n```\nfegetenv(&sage_fe_env)\nfesetenv(&ecl_fe_env)\n<do ecl stuff>\nfegetenv(&ecl_fe_env)\nfesetenv(&sagel_fe_env)\n```\nthat might do a more comprehensive capture ...",
    "created_at": "2019-01-06T07:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330365",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:95'></a>
It seems to me that the `fedisableexcept/feenableexcept` dance is supposed to switch between "ecl" FPE state and "sage" FPE state. However, that is not what those commands do. According to the documentation, `fedisableexcept` just disables the given exceptions (and leaves the other ones the way they were) and `feenableexcept` enables them. Furthermore, it seems these are supposedly glibc extensions.

When I look at the relevant manpage, it seems to indicate that `fegetenv` and `fesetenv` are defined in C99 and do set the FPE environment wholesale. So, would it be better to do:

```
fegetenv(&sage_fe_env)
fesetenv(&ecl_fe_env)
<do ecl stuff>
fegetenv(&ecl_fe_env)
fesetenv(&sagel_fe_env)
```
that might do a more comprehensive capture ...



---

archive/issue_comments_330366.json:
```json
{
    "body": "<a id='comment:96'></a>\nI thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234\n\nIt's not clear to me or well documented how feenable/disableexcept interact with fesetenv.  Presumably the latter should encompass the former, but I have not looked into it in more detail.  I agree that the get/setenv functions look better overall and more portable.\n\nSo for now I'd be more comfortable just doing exactly the converse to what ECL is doing.  In this code I use `fedisableexcept(FE_ALL_EXCEPT)` to just disable all floating point exceptions, followed by `feenableexcept(...)` for just the ECL flags, or just the Sage flags (which should be 0, since I'm not aware of anything in Sage or any of its other dependencies that, at least by default, sets FPE traps, but we save/restore it anyways just in case).",
    "created_at": "2019-01-07T13:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330366",
    "user": "https://github.com/embray"
}
```

<a id='comment:96'></a>
I thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234

It's not clear to me or well documented how feenable/disableexcept interact with fesetenv.  Presumably the latter should encompass the former, but I have not looked into it in more detail.  I agree that the get/setenv functions look better overall and more portable.

So for now I'd be more comfortable just doing exactly the converse to what ECL is doing.  In this code I use `fedisableexcept(FE_ALL_EXCEPT)` to just disable all floating point exceptions, followed by `feenableexcept(...)` for just the ECL flags, or just the Sage flags (which should be 0, since I'm not aware of anything in Sage or any of its other dependencies that, at least by default, sets FPE traps, but we save/restore it anyways just in case).



---

archive/issue_comments_330367.json:
```json
{
    "body": "<a id='comment:97'></a>\nI don\u2019t recall whether numpy sets FPE traps, or merely monitors for FPEs, but this did cause us trouble in the past, see #22799.",
    "created_at": "2019-01-07T17:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330367",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:97'></a>
I don‚Äôt recall whether numpy sets FPE traps, or merely monitors for FPEs, but this did cause us trouble in the past, see #22799.



---

archive/issue_comments_330368.json:
```json
{
    "body": "<a id='comment:98'></a>\nReplying to [embray](#comment%3A96):\n> I thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234\n\n\nOK, that makes sense. There is one point of concern: as far as I can see, these routines change which exceptions raise a signal. It doesn't change which flags are set. Can it be that sage or ecl get exception flag states they are not expecting because the state arose under a signal regime they are not used to? (getenv/setenv would take care of that because they'd swap the *entire* FP state)\n\nAlso: can we do something so that the patchbot can test this ticket? It looks like it can't find the ecl tarball at the moment.",
    "created_at": "2019-01-07T20:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330368",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:98'></a>
Replying to [embray](#comment%3A96):
> I thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234


OK, that makes sense. There is one point of concern: as far as I can see, these routines change which exceptions raise a signal. It doesn't change which flags are set. Can it be that sage or ecl get exception flag states they are not expecting because the state arose under a signal regime they are not used to? (getenv/setenv would take care of that because they'd swap the *entire* FP state)

Also: can we do something so that the patchbot can test this ticket? It looks like it can't find the ecl tarball at the moment.



---

archive/issue_comments_330369.json:
```json
{
    "body": "<a id='comment:99'></a>\nReplying to [nbruin](#comment%3A98):\n> Replying to [embray](#comment%3A96):\n> > I thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234\n\n> \n> OK, that makes sense. There is one point of concern: as far as I can see, these routines change which exceptions raise a signal. It doesn't change which flags are set. Can it be that sage or ecl get exception flag states they are not expecting because the state arose under a signal regime they are not used to? (getenv/setenv would take care of that because they'd swap the *entire* FP state)\n\n\nI'm afraid I don't exactly follow you here.  Maybe you'd have to describe a specific case.  However, the answer is probably \"Yes, that's possible, but I don't currently have a case where that's occurring so I'm not going to worry about it until I do.\"\n\n> Also: can we do something so that the patchbot can test this ticket? It looks like it can't find the ecl tarball at the moment.\n\n\nI don't know.  The patchbot has some code for divining a link to the upstream tarball from the ticket description and downloading it, so I don't know why it's not working in this case.",
    "created_at": "2019-01-08T13:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330369",
    "user": "https://github.com/embray"
}
```

<a id='comment:99'></a>
Replying to [nbruin](#comment%3A98):
> Replying to [embray](#comment%3A96):
> > I thought of using feget/setenv, but the reason I didn't is simply because ECL does not use them, and rather uses `fedisableexcept` and `feenableexcept`.  See: https://gitlab.com/embeddable-common-lisp/ecl/blob/2a9084b105caf26c89bb16ed4dd0bf5aa7ceab59/src/c/unixint.d#L1234

> 
> OK, that makes sense. There is one point of concern: as far as I can see, these routines change which exceptions raise a signal. It doesn't change which flags are set. Can it be that sage or ecl get exception flag states they are not expecting because the state arose under a signal regime they are not used to? (getenv/setenv would take care of that because they'd swap the *entire* FP state)


I'm afraid I don't exactly follow you here.  Maybe you'd have to describe a specific case.  However, the answer is probably "Yes, that's possible, but I don't currently have a case where that's occurring so I'm not going to worry about it until I do."

> Also: can we do something so that the patchbot can test this ticket? It looks like it can't find the ecl tarball at the moment.


I don't know.  The patchbot has some code for divining a link to the upstream tarball from the ticket description and downloading it, so I don't know why it's not working in this case.



---

archive/issue_comments_330370.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [embray](#comment%3A99):\n> I'm afraid I don't exactly follow you here.  Maybe you'd have to describe a specific case.\n\n\nI'd expect that signalling-based code would clear exception flags as it goes along, expecting a clear set of exception flags as normal state.\n\nWith NaN-producing code, the exception flags would usually pile up. Entering signalling-based code could therefore easily be confused if you feed it a state attained by NaN-producing code (it would be hard to tell what exception triggered the signal if all the flags are on ...)\n\nIt might be that ECL functions reasonably well with that kind of state poorly defined ... It seems it can turn on/off signals by itself already.",
    "created_at": "2019-01-08T17:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330370",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:100'></a>
Replying to [embray](#comment%3A99):
> I'm afraid I don't exactly follow you here.  Maybe you'd have to describe a specific case.


I'd expect that signalling-based code would clear exception flags as it goes along, expecting a clear set of exception flags as normal state.

With NaN-producing code, the exception flags would usually pile up. Entering signalling-based code could therefore easily be confused if you feed it a state attained by NaN-producing code (it would be hard to tell what exception triggered the signal if all the flags are on ...)

It might be that ECL functions reasonably well with that kind of state poorly defined ... It seems it can turn on/off signals by itself already.



---

archive/issue_comments_330371.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm sorry but I'm still not following.  What do you mean by \"entering signalling-based code\"?  Do you have some specific suggestions or are you just speculating at this point?  I would like to move on here, that's all...",
    "created_at": "2019-01-08T17:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330371",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
I'm sorry but I'm still not following.  What do you mean by "entering signalling-based code"?  Do you have some specific suggestions or are you just speculating at this point?  I would like to move on here, that's all...



---

archive/issue_comments_330372.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK, I don't know enough about IEEE floats. Someone else with more expertise should take a look at this.\n\nThe fact that only part of the FP state gets swapped (which exceptions get trapped) and another part (exception state flags) does not, looks suspicious.\n\nI would normally think that a little more rigorous argument than \"it doesn't seem to cause problems right now\" would be warranted before implementing such a shortcut in an interface. Someone with more expertise in scientific computing software using IEEE floats can probably make a better assessment on whether this is something to worry about.",
    "created_at": "2019-01-08T18:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330372",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
OK, I don't know enough about IEEE floats. Someone else with more expertise should take a look at this.

The fact that only part of the FP state gets swapped (which exceptions get trapped) and another part (exception state flags) does not, looks suspicious.

I would normally think that a little more rigorous argument than "it doesn't seem to cause problems right now" would be warranted before implementing such a shortcut in an interface. Someone with more expertise in scientific computing software using IEEE floats can probably make a better assessment on whether this is something to worry about.



---

archive/issue_comments_330373.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt's not a question about IEEE floats at all per se, just the API.\n\nAnd this is literally just doing the converse of what ECL does.  I'm not worried about a \"more rigorous argument\" for a problem I don't have.  Maybe that's just the pragmatist in me but I really don't have more time to spend on this unless someone can demonstrate an actual problem.\n\nI do remember reading somewhere that `fedisableexcept` also clears any exception flags, but I forget where, so I might need to double-check that.  If it helps we could also add an explicit `feclearexcept()` but that's as far as I'm willing to go right now.  I don't think there's any point in otherwise delaying this further after...*looks*...2 **years**.",
    "created_at": "2019-01-09T12:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330373",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
It's not a question about IEEE floats at all per se, just the API.

And this is literally just doing the converse of what ECL does.  I'm not worried about a "more rigorous argument" for a problem I don't have.  Maybe that's just the pragmatist in me but I really don't have more time to spend on this unless someone can demonstrate an actual problem.

I do remember reading somewhere that `fedisableexcept` also clears any exception flags, but I forget where, so I might need to double-check that.  If it helps we could also add an explicit `feclearexcept()` but that's as far as I'm willing to go right now.  I don't think there's any point in otherwise delaying this further after...*looks*...2 **years**.



---

archive/issue_events_198407.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-01-09T13:07:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198407"
}
```



---

archive/issue_events_198408.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-01-09T13:07:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198408"
}
```



---

archive/issue_comments_330374.json:
```json
{
    "body": "<a id='comment:4'></a>\nwith numerics moving to GPUs and TPUs, it's more and more a purely academic matter of sticking, or not, to IEEE floats standard. Let's go ahead with this, and hope that a new ECL release happens soon...",
    "created_at": "2019-01-09T13:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330374",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
with numerics moving to GPUs and TPUs, it's more and more a purely academic matter of sticking, or not, to IEEE floats standard. Let's go ahead with this, and hope that a new ECL release happens soon...



---

archive/issue_comments_330375.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik\" to \"Dima Pasechnik, Nils Bruin\".",
    "created_at": "2019-01-09T13:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330375",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Dima Pasechnik" to "Dima Pasechnik, Nils Bruin".



---

archive/issue_comments_330376.json:
```json
{
    "body": "<a id='comment:105'></a>\nReplying to [embray](#comment%3A103):\n\n> I do remember reading somewhere that `fedisableexcept` also clears any exception flags, but I forget where, so I might need to double-check that.  If it helps we could also add an explicit `feclearexcept()` but that's as far as I'm willing to go right now.\n\n\nI did go ahead and check on this since now I'm thinking I must have imagined or misremembered that.  Modifying the exception masks does *not* cause any pending exceptions to be cleared, so theoretically this could result in some odd bugs I guess.\n\nNils has a point that it would be better to save/restore the entire FPU environment but my point still stands that for the present purpose it's mostly academic.  I'm really only concerned about saving/reverting exactly what ECL is (potentially) doing and nothing more.  Clearing any pending exceptions first does make sense though so I'll add that in real quick.",
    "created_at": "2019-01-09T13:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330376",
    "user": "https://github.com/embray"
}
```

<a id='comment:105'></a>
Replying to [embray](#comment%3A103):

> I do remember reading somewhere that `fedisableexcept` also clears any exception flags, but I forget where, so I might need to double-check that.  If it helps we could also add an explicit `feclearexcept()` but that's as far as I'm willing to go right now.


I did go ahead and check on this since now I'm thinking I must have imagined or misremembered that.  Modifying the exception masks does *not* cause any pending exceptions to be cleared, so theoretically this could result in some odd bugs I guess.

Nils has a point that it would be better to save/restore the entire FPU environment but my point still stands that for the present purpose it's mostly academic.  I'm really only concerned about saving/reverting exactly what ECL is (potentially) doing and nothing more.  Clearing any pending exceptions first does make sense though so I'll add that in real quick.



---

archive/issue_events_198409.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2019-01-09T13:34:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198409"
}
```



---

archive/issue_events_198410.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2019-01-09T13:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198410"
}
```



---

archive/issue_comments_330377.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537\">85fcb48</a></td><td><code>add feclearexcept to ecl_sig_on/off to clear any pending floating point status flags before modifying the traps</code></td></tr></table>\n",
    "created_at": "2019-01-09T13:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537">85fcb48</a></td><td><code>add feclearexcept to ecl_sig_on/off to clear any pending floating point status flags before modifying the traps</code></td></tr></table>




---

archive/issue_comments_330378.json:
```json
{
    "body": "**Changing commit** from \"[ee5a10b5781f825b4da678f54c8b5589d152e438](https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438)\" to \"[85fcb48922383cd1c2ac36412ed761a507cb9537](https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537)\".",
    "created_at": "2019-01-09T13:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ee5a10b5781f825b4da678f54c8b5589d152e438](https://github.com/sagemath/sagetrac-mirror/commit/ee5a10b5781f825b4da678f54c8b5589d152e438)" to "[85fcb48922383cd1c2ac36412ed761a507cb9537](https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537)".



---

archive/issue_events_198411.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-09T14:31:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198411"
}
```



---

archive/issue_events_198412.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-09T14:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198412"
}
```



---

archive/issue_comments_330379.json:
```json
{
    "body": "<a id='comment:7'></a>\nI tested the changes myself and it's not a very significant difference over what was already reviewed, so setting back to positive_review.",
    "created_at": "2019-01-09T14:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330379",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
I tested the changes myself and it's not a very significant difference over what was already reviewed, so setting back to positive_review.



---

archive/issue_comments_330380.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, I ran tests too, just to make sure, it all looks good.",
    "created_at": "2019-01-09T17:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330380",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
OK, I ran tests too, just to make sure, it all looks good.



---

archive/issue_events_198413.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:12:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198413"
}
```



---

archive/issue_events_198414.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:12:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198414"
}
```



---

archive/issue_comments_330381.json:
```json
{
    "body": "<a id='comment:9'></a>\nWell, clearly it was too late for this, though I believe this should have been part of 8.6.  Changing milestone since it wasn't (and it was more a nice-to-have I think than critical).\n\nIf downstream wants to use sagemath with this or a newer ECL they can simply use the patch from this branch.",
    "created_at": "2019-01-15T18:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330381",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Well, clearly it was too late for this, though I believe this should have been part of 8.6.  Changing milestone since it wasn't (and it was more a nice-to-have I think than critical).

If downstream wants to use sagemath with this or a newer ECL they can simply use the patch from this branch.



---

archive/issue_comments_330382.json:
```json
{
    "body": "<a id='comment:0'></a>\nDoesn't work on OSX, maxima then fails to build with \n\n```\nfor l in ecl; do for d in / /numerical /numerical/slatec; do .././install-sh -c -d binary-$l$d; done; done\necl -norc \\\n           -eval '(progn  (load \"../lisp-utils/defsystem.lisp\") (funcall (intern (symbol-name :operate-on-system) :mk) \"maxima\" :compile :verbose t) (build-maxima-lib))' \\\n           -eval '(ext:quit)'\ndyld: Library not loaded: @libdir@/libecl.16.1.dylib\n  Referenced from: /Users/buildslave-sage/slave/sage_git/build/local/bin/ecl\n  Reason: image not found\nmake[5]: *** [binary-ecl/maxima] Abort trap: 6\nmake[5]: Target `all' not remade because of errors.\n```",
    "created_at": "2019-01-17T23:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330382",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:0'></a>
Doesn't work on OSX, maxima then fails to build with 

```
for l in ecl; do for d in / /numerical /numerical/slatec; do .././install-sh -c -d binary-$l$d; done; done
ecl -norc \
           -eval '(progn  (load "../lisp-utils/defsystem.lisp") (funcall (intern (symbol-name :operate-on-system) :mk) "maxima" :compile :verbose t) (build-maxima-lib))' \
           -eval '(ext:quit)'
dyld: Library not loaded: @libdir@/libecl.16.1.dylib
  Referenced from: /Users/buildslave-sage/slave/sage_git/build/local/bin/ecl
  Reason: image not found
make[5]: *** [binary-ecl/maxima] Abort trap: 6
make[5]: Target `all' not remade because of errors.
```



---

archive/issue_events_198415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-17T23:40:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198415"
}
```



---

archive/issue_events_198416.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-17T23:40:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198416"
}
```



---

archive/issue_comments_330383.json:
```json
{
    "body": "<a id='comment:111'></a>\nReplying to [vbraun](#comment%3A110):\n> Doesn't work on OSX, maxima then fails to build with \n\n\nDoes building ECL actually work on OSX (what version?) ?\nIt looks as if ECL is broken in some way then.",
    "created_at": "2019-01-18T10:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330383",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:111'></a>
Replying to [vbraun](#comment%3A110):
> Doesn't work on OSX, maxima then fails to build with 


Does building ECL actually work on OSX (what version?) ?
It looks as if ECL is broken in some way then.



---

archive/issue_comments_330384.json:
```json
{
    "body": "<a id='comment:112'></a>\nReplying to [vbraun](#comment%3A110):\n> Doesn't work on OSX, maxima then fails to build with \n> \n> ```\n> for l in ecl; do for d in / /numerical /numerical/slatec; do .././install-sh -c -d binary-$l$d; done; done\n> ecl -norc \\\n>            -eval '(progn  (load \"../lisp-utils/defsystem.lisp\") (funcall (intern (symbol-name :operate-on-system) :mk) \"maxima\" :compile :verbose t) (build-maxima-lib))' \\\n>            -eval '(ext:quit)'\n> dyld: Library not loaded: @libdir@/libecl.16.1.dylib\n>   Referenced from: /Users/buildslave-sage/slave/sage_git/build/local/bin/ecl\n>   Reason: image not found\n> make[5]: *** [binary-ecl/maxima] Abort trap: 6\n> make[5]: Target `all' not remade because of errors.\n> ```\n\n\nThis is probably same as https://gitlab.com/embeddable-common-lisp/ecl/issues/398, fixed by https://gitlab.com/embeddable-common-lisp/ecl/commit/612eeb5ed1623c4c7cb71029aab39107caf1cdba",
    "created_at": "2019-01-25T20:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330384",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:112'></a>
Replying to [vbraun](#comment%3A110):
> Doesn't work on OSX, maxima then fails to build with 
> 
> ```
> for l in ecl; do for d in / /numerical /numerical/slatec; do .././install-sh -c -d binary-$l$d; done; done
> ecl -norc \
>            -eval '(progn  (load "../lisp-utils/defsystem.lisp") (funcall (intern (symbol-name :operate-on-system) :mk) "maxima" :compile :verbose t) (build-maxima-lib))' \
>            -eval '(ext:quit)'
> dyld: Library not loaded: @libdir@/libecl.16.1.dylib
>   Referenced from: /Users/buildslave-sage/slave/sage_git/build/local/bin/ecl
>   Reason: image not found
> make[5]: *** [binary-ecl/maxima] Abort trap: 6
> make[5]: Target `all' not remade because of errors.
> ```


This is probably same as https://gitlab.com/embeddable-common-lisp/ecl/issues/398, fixed by https://gitlab.com/embeddable-common-lisp/ecl/commit/612eeb5ed1623c4c7cb71029aab39107caf1cdba



---

archive/issue_comments_330385.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks like totally it.",
    "created_at": "2019-02-10T22:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330385",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Looks like totally it.



---

archive/issue_comments_330386.json:
```json
{
    "body": "**Changing commit** from \"[85fcb48922383cd1c2ac36412ed761a507cb9537](https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537)\" to \"[61d68b4a3872e3ae05e3a42f6aa6d960b7847be9](https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9)\".",
    "created_at": "2019-02-10T23:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[85fcb48922383cd1c2ac36412ed761a507cb9537](https://github.com/sagemath/sagetrac-mirror/commit/85fcb48922383cd1c2ac36412ed761a507cb9537)" to "[61d68b4a3872e3ae05e3a42f6aa6d960b7847be9](https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9)".



---

archive/issue_comments_330387.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28def8da997db66a6c524707f9f648f704f71cc2\">28def8d</a></td><td><code>Merge branch 'develop' into ticket-22191</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9\">61d68b4</a></td><td><code>Add upstream patch for OS X build</code></td></tr></table>\n",
    "created_at": "2019-02-10T23:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28def8da997db66a6c524707f9f648f704f71cc2">28def8d</a></td><td><code>Merge branch 'develop' into ticket-22191</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9">61d68b4</a></td><td><code>Add upstream patch for OS X build</code></td></tr></table>




---

archive/issue_comments_330388.json:
```json
{
    "body": "<a id='comment:5'></a>\nAdded upstream patch. It applies without problem and doesn't break things on linux. But it has to be tested on OS X.",
    "created_at": "2019-02-10T23:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330388",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Added upstream patch. It applies without problem and doesn't break things on linux. But it has to be tested on OS X.



---

archive/issue_events_198417.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-10T23:04:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198417"
}
```



---

archive/issue_events_198418.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-10T23:04:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198418"
}
```



---

archive/issue_comments_330389.json:
```json
{
    "body": "<a id='comment:6'></a>\nI wonder if #27225 will fix the darwin build bot for this ticket once it is in.",
    "created_at": "2019-02-21T09:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330389",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I wonder if #27225 will fix the darwin build bot for this ticket once it is in.



---

archive/issue_comments_330390.json:
```json
{
    "body": "**Changing commit** from \"[61d68b4a3872e3ae05e3a42f6aa6d960b7847be9](https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9)\" to \"[4b4255e39af6d1baf19ba0af9d11e924501946eb](https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb)\".",
    "created_at": "2019-02-24T02:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[61d68b4a3872e3ae05e3a42f6aa6d960b7847be9](https://github.com/sagemath/sagetrac-mirror/commit/61d68b4a3872e3ae05e3a42f6aa6d960b7847be9)" to "[4b4255e39af6d1baf19ba0af9d11e924501946eb](https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb)".



---

archive/issue_comments_330391.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb\">4b4255e</a></td><td><code>Merge branch 'develop' into ticket-22191</code></td></tr></table>\n",
    "created_at": "2019-02-24T02:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb">4b4255e</a></td><td><code>Merge branch 'develop' into ticket-22191</code></td></tr></table>




---

archive/issue_comments_330392.json:
```json
{
    "body": "<a id='comment:8'></a>\nJust rebasing on top of 8.5.beta5. Hopefully the patchbot will stop choking on python-3.7.2 and we can see if things work for real.",
    "created_at": "2019-02-24T02:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330392",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Just rebasing on top of 8.5.beta5. Hopefully the patchbot will stop choking on python-3.7.2 and we can see if things work for real.



---

archive/issue_comments_330393.json:
```json
{
    "body": "<a id='comment:9'></a>\nPatchbot still breaking on something unrelated to this ticket. Putting to positive review to have some real testing.",
    "created_at": "2019-02-24T07:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330393",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Patchbot still breaking on something unrelated to this ticket. Putting to positive review to have some real testing.



---

archive/issue_events_198419.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-24T07:56:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198419"
}
```



---

archive/issue_events_198420.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-24T07:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198420"
}
```



---

archive/issue_comments_330394.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik, Nils Bruin\" to \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\".",
    "created_at": "2019-02-24T07:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330394",
    "user": "https://github.com/kiwifb"
}
```

**Changing reviewer** from "Dima Pasechnik, Nils Bruin" to "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey".



---

archive/issue_comments_330395.json:
```json
{
    "body": "<a id='comment:0'></a>\nHow is this unrelated (see patchbot)?\n\n```\n[sagelib-8.7.beta5] build/cythonized/sage/libs/ecl.c:4814:36: error: 'ecl_sigfpe_handler' undeclared (first use in this function); did you mean 'ecl_sigbus_handler'?\n```",
    "created_at": "2019-02-24T12:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330395",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:0'></a>
How is this unrelated (see patchbot)?

```
[sagelib-8.7.beta5] build/cythonized/sage/libs/ecl.c:4814:36: error: 'ecl_sigfpe_handler' undeclared (first use in this function); did you mean 'ecl_sigbus_handler'?
```



---

archive/issue_events_198421.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-24T12:17:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198421"
}
```



---

archive/issue_events_198422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-24T12:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198422"
}
```



---

archive/issue_comments_330396.json:
```json
{
    "body": "<a id='comment:1'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330396",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_198423.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198423"
}
```



---

archive/issue_events_198424.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198424"
}
```



---

archive/issue_events_198425.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198425"
}
```



---

archive/issue_events_198426.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198426"
}
```



---

archive/issue_comments_330397.json:
```json
{
    "body": "<a id='comment:2'></a>\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330397",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_330398.json:
```json
{
    "body": "<a id='comment:3'></a>\nIs it possible to revive the current branch? It used to work at some point.",
    "created_at": "2019-06-23T13:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330398",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
Is it possible to revive the current branch? It used to work at some point.



---

archive/issue_events_198427.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198427"
}
```



---

archive/issue_events_198428.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198428"
}
```



---

archive/issue_comments_330399.json:
```json
{
    "body": "<a id='comment:4'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330399",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_330400.json:
```json
{
    "body": "<a id='comment:5'></a>\non macOS (merged with 9.1.beta3):\n\n```\nImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so, 2): Symbol not found: _fedisableexcept\n  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so\n  Expected in: flat namespace\n in /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so\n```",
    "created_at": "2020-02-10T02:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330400",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
on macOS (merged with 9.1.beta3):

```
ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so, 2): Symbol not found: _fedisableexcept
  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so
  Expected in: flat namespace
 in /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.7/site-packages/sage/libs/ecl.cpython-37m-darwin.so
```



---

archive/issue_events_198429.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-16T23:11:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198429"
}
```



---

archive/issue_events_198430.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-16T23:11:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198430"
}
```



---

archive/issue_events_198431.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-25T02:39:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "rename": {
        "from": "update ECL to 16.1.3",
        "to": "update ECL to 16.1.3 or - rather - 20.4.24"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198431"
}
```



---

archive/issue_comments_330401.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,13 @@\n+ECL-20.4.24 has been released (on 2020/04/24)\n+\n+https://common-lisp.net/project/ecl/posts/ECL-20424-release.html\n+\n+This most probably obsoletes this:\n+\n ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). \n \n We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n **Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz\n+\n+\n``````\n",
    "created_at": "2020-04-25T02:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330401",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,13 @@
+ECL-20.4.24 has been released (on 2020/04/24)
+
+https://common-lisp.net/project/ecl/posts/ECL-20424-release.html
+
+This most probably obsoletes this:
+
 ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). 
 
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
 **Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz
+
+
``````




---

archive/issue_comments_330402.json:
```json
{
    "body": "<a id='comment:8'></a>\nI have created a commit with an updated ECL and implemented a clean solution encapsulating the floating point environment changes using a new macro introduced in ECL 20.4.24 for this purpose (documented at https://common-lisp.net/project/ecl/static/manual/Embedding-ECL.html#ECL_005fWITH_005fLISP_005fFPE).\n\nI have pushed my solution to a new branch to not overwrite the previous changes from this ticket, I hope that's OK and people can see the branch to review it.",
    "created_at": "2020-05-22T19:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330402",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:8'></a>
I have created a commit with an updated ECL and implemented a clean solution encapsulating the floating point environment changes using a new macro introduced in ECL 20.4.24 for this purpose (documented at https://common-lisp.net/project/ecl/static/manual/Embedding-ECL.html#ECL_005fWITH_005fLISP_005fFPE).

I have pushed my solution to a new branch to not overwrite the previous changes from this ticket, I hope that's OK and people can see the branch to review it.



---

archive/issue_comments_330403.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket-22191](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket-22191)\" to \"[u/gh-spaghettisalat/ecl-update](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update)\".",
    "created_at": "2020-05-22T19:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330403",
    "user": "https://github.com/spaghettisalat"
}
```

**Changing branch** from "[public/ticket-22191](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket-22191)" to "[u/gh-spaghettisalat/ecl-update](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update)".



---

archive/issue_events_198432.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2020-05-22T19:29:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198432"
}
```



---

archive/issue_events_198433.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2020-05-22T19:29:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198433"
}
```



---

archive/issue_comments_330404.json:
```json
{
    "body": "**Changing commit** from \"[4b4255e39af6d1baf19ba0af9d11e924501946eb](https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb)\" to \"[3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546](https://github.com/sagemath/sagetrac-mirror/commit/3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546)\".",
    "created_at": "2020-05-22T19:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330404",
    "user": "https://github.com/spaghettisalat"
}
```

**Changing commit** from "[4b4255e39af6d1baf19ba0af9d11e924501946eb](https://github.com/sagemath/sagetrac-mirror/commit/4b4255e39af6d1baf19ba0af9d11e924501946eb)" to "[3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546](https://github.com/sagemath/sagetrac-mirror/commit/3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546)".



---

archive/issue_comments_330405.json:
```json
{
    "body": "<a id='comment:9'></a>\nyou need to rebase your branch over 9.1.\n(normally speaking it ought to be based on the current develop branch, which atm is the same as stable 9.1)\n\nnon-interactive rebase leads to a broken branch, I just checked. There were warnings about tabs and trailing spaces too. Our Python code only uses spaces.",
    "created_at": "2020-05-23T15:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330405",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
you need to rebase your branch over 9.1.
(normally speaking it ought to be based on the current develop branch, which atm is the same as stable 9.1)

non-interactive rebase leads to a broken branch, I just checked. There were warnings about tabs and trailing spaces too. Our Python code only uses spaces.



---

archive/issue_comments_330406.json:
```json
{
    "body": "<a id='comment:0'></a>\nneedless to say, your branch is most welcome!",
    "created_at": "2020-05-23T15:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330406",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
needless to say, your branch is most welcome!



---

archive/issue_comments_330407.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-spaghettisalat/ecl-update](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update)\" to \"[public/packages/ecl20](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/ecl20)\".",
    "created_at": "2020-05-24T09:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330407",
    "user": "https://github.com/dimpase"
}
```

**Changing branch** from "[u/gh-spaghettisalat/ecl-update](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update)" to "[public/packages/ecl20](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/ecl20)".



---

archive/issue_comments_330408.json:
```json
{
    "body": "**Changing commit** from \"[3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546](https://github.com/sagemath/sagetrac-mirror/commit/3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546)\" to \"[a18783e58b4874c2da4693c0443412d2541f4966](https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966)\".",
    "created_at": "2020-05-24T09:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330408",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546](https://github.com/sagemath/sagetrac-mirror/commit/3f37e8dc6801e78fa79c1cbdc4f5f9a46354c546)" to "[a18783e58b4874c2da4693c0443412d2541f4966](https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966)".



---

archive/issue_comments_330409.json:
```json
{
    "body": "<a id='comment:1'></a>\nrebased branch, with few extra touches to make ECL build with Sage 9.1. To be tested.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/677677e750b36b7d843f2511d0643ffa30c95c81\">677677e</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9bbde18cc38aa7074d7f55a63821a4943246b6c6\">9bbde18</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966\">a18783e</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr></table>\n",
    "created_at": "2020-05-24T09:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330409",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
rebased branch, with few extra touches to make ECL build with Sage 9.1. To be tested.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/677677e750b36b7d843f2511d0643ffa30c95c81">677677e</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9bbde18cc38aa7074d7f55a63821a4943246b6c6">9bbde18</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966">a18783e</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr></table>




---

archive/issue_events_198434.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-24T09:37:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198434"
}
```



---

archive/issue_events_198435.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-24T09:37:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198435"
}
```



---

archive/issue_comments_330410.json:
```json
{
    "body": "<a id='comment:2'></a>\nMaxima does not build: `There is no package with the name LISP..`:\n\n```\n...\nSummary:\nECL enabled. Executable name: \"ecl\"\ndefault lisp: ecl\nwish executable name: \"wish\"\nBuilding maxima-5.42.2\nmake[3]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src'\nMaking all in admin\nmake[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/admin'\nmake[4]: Nothing to be done for 'all'.\nmake[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/admin'\nMaking all in crosscompile-windows\nmake[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/crosscompile-windows'\nmake[4]: Nothing to be done for 'all'.\nmake[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/crosscompile-windows'\nMaking all in src\nmake[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'\necl -norc -eval '(progn (load \"../lisp-utils/defsystem.lisp\") (load \"../lisp-utils/make-depends.lisp\") (funcall (intern \"CREATE-DEPENDENCY-FILE\" :mk) \"binary-ecl/maxima\" \"ecl-depends.mk\") (quit))'\n;;; Loading \"/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp\"\n;;; Loading #P\"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas\"\nAn error occurred during initialization:\nThere is no package with the name LISP..\nmake bd\nmake[5]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'\necl -norc -eval '(progn (load \"../lisp-utils/defsystem.lisp\") (load \"../lisp-utils/make-depends.lisp\") (funcall (intern \"CREATE-DEPENDENCY-FILE\" :mk) \"binary-ecl/maxima\" \"ecl-depends.mk\") (quit))'\n;;; Loading \"/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp\"\n;;; Loading #P\"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas\"\nAn error occurred during initialization:\nThere is no package with the name LISP..\nfor l in ecl; do for d in / /numerical /numerical/slatec; do /usr/bin/mkdir -p binary-$l$d; done; done\nmake[5]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'\necl -norc \\\n           -eval '(progn  (load \"../lisp-utils/defsystem.lisp\") (funcall (intern (symbol-name :operate-on-system) :mk) \"maxima\" :compile :verbose t) (build-maxima-lib))' \\\n           -eval '(ext:quit)'\n;;; Loading \"/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp\"\n;;; Loading #P\"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas\"\nAn error occurred during initialization:\nThere is no package with the name LISP..\nmake[4]: *** [Makefile:1350: binary-ecl/maxima] Error 1\nmake[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'\nmake[3]: *** [Makefile:458: all-recursive] Error 1\nmake[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src'\n****************************************************************************************************************************************************************************************************************************************************************************************************************************\nError building maxima-5.42.2\n```",
    "created_at": "2020-05-24T10:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330410",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
Maxima does not build: `There is no package with the name LISP..`:

```
...
Summary:
ECL enabled. Executable name: "ecl"
default lisp: ecl
wish executable name: "wish"
Building maxima-5.42.2
make[3]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src'
Making all in admin
make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/admin'
make[4]: Nothing to be done for 'all'.
make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/admin'
Making all in crosscompile-windows
make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/crosscompile-windows'
make[4]: Nothing to be done for 'all'.
make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/crosscompile-windows'
Making all in src
make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'
ecl -norc -eval '(progn (load "../lisp-utils/defsystem.lisp") (load "../lisp-utils/make-depends.lisp") (funcall (intern "CREATE-DEPENDENCY-FILE" :mk) "binary-ecl/maxima" "ecl-depends.mk") (quit))'
;;; Loading "/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp"
;;; Loading #P"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas"
An error occurred during initialization:
There is no package with the name LISP..
make bd
make[5]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'
ecl -norc -eval '(progn (load "../lisp-utils/defsystem.lisp") (load "../lisp-utils/make-depends.lisp") (funcall (intern "CREATE-DEPENDENCY-FILE" :mk) "binary-ecl/maxima" "ecl-depends.mk") (quit))'
;;; Loading "/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp"
;;; Loading #P"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas"
An error occurred during initialization:
There is no package with the name LISP..
for l in ecl; do for d in / /numerical /numerical/slatec; do /usr/bin/mkdir -p binary-$l$d; done; done
make[5]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'
ecl -norc \
           -eval '(progn  (load "../lisp-utils/defsystem.lisp") (funcall (intern (symbol-name :operate-on-system) :mk) "maxima" :compile :verbose t) (build-maxima-lib))' \
           -eval '(ext:quit)'
;;; Loading "/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp"
;;; Loading #P"/home/scratch2/dimpase/sage/sage/local/lib/ecl/cmp.fas"
An error occurred during initialization:
There is no package with the name LISP..
make[4]: *** [Makefile:1350: binary-ecl/maxima] Error 1
make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'
make[3]: *** [Makefile:458: all-recursive] Error 1
make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src'
****************************************************************************************************************************************************************************************************************************************************************************************************************************
Error building maxima-5.42.2
```



---

archive/issue_comments_330411.json:
```json
{
    "body": "<a id='comment:133'></a>\nReplying to [dimpase](#comment%3A132):\n> Maxima does not build: `There is no package with the name LISP..`:\n> \n\n\nI had a patch for that in my original commit. Did it get lost during the rebase?\n\nThe error is due to maxima's copy of defsystem using a long obsolete package nickname which has been removed in ECL 20.4.24 and still needs to be reported on the maxima bugtracker.",
    "created_at": "2020-05-24T10:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330411",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:133'></a>
Replying to [dimpase](#comment%3A132):
> Maxima does not build: `There is no package with the name LISP..`:
> 


I had a patch for that in my original commit. Did it get lost during the rebase?

The error is due to maxima's copy of defsystem using a long obsolete package nickname which has been removed in ECL 20.4.24 and still needs to be reported on the maxima bugtracker.



---

archive/issue_comments_330412.json:
```json
{
    "body": "<a id='comment:134'></a>\nReplying to [gh-spaghettisalat](#comment%3A133):\n> Replying to [dimpase](#comment%3A132):\n> > Maxima does not build: `There is no package with the name LISP..`:\n> > \n\n> \n> I had a patch for that in my original commit. Did it get lost during the rebase?\n\n\nI just took the diff against 9.0 and patched 9.1 with it.\nIn the process I had to rename spkg-install to spkg-install.in, but otherwise\neverything else just applied without any problems. So it most probably was never in your branch.\n\n> \n> The error is due to maxima's copy of defsystem using a long obsolete package nickname which has been removed in ECL 20.4.24 and still needs to be reported on the maxima bugtracker.\n\n\nthe latter has been reported and fixed by Maxima, as I just found.\ncf. https://sourceforge.net/p/maxima/bugs/3629/",
    "created_at": "2020-05-24T10:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330412",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:134'></a>
Replying to [gh-spaghettisalat](#comment%3A133):
> Replying to [dimpase](#comment%3A132):
> > Maxima does not build: `There is no package with the name LISP..`:
> > 

> 
> I had a patch for that in my original commit. Did it get lost during the rebase?


I just took the diff against 9.0 and patched 9.1 with it.
In the process I had to rename spkg-install to spkg-install.in, but otherwise
everything else just applied without any problems. So it most probably was never in your branch.

> 
> The error is due to maxima's copy of defsystem using a long obsolete package nickname which has been removed in ECL 20.4.24 and still needs to be reported on the maxima bugtracker.


the latter has been reported and fixed by Maxima, as I just found.
cf. https://sourceforge.net/p/maxima/bugs/3629/



---

archive/issue_comments_330413.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17\">4f7e1a5</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr></table>\n",
    "created_at": "2020-05-24T10:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17">4f7e1a5</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr></table>




---

archive/issue_comments_330414.json:
```json
{
    "body": "**Changing commit** from \"[a18783e58b4874c2da4693c0443412d2541f4966](https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966)\" to \"[4f7e1a59e19c46896e51553190ba94d764006c17](https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17)\".",
    "created_at": "2020-05-24T10:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a18783e58b4874c2da4693c0443412d2541f4966](https://github.com/sagemath/sagetrac-mirror/commit/a18783e58b4874c2da4693c0443412d2541f4966)" to "[4f7e1a59e19c46896e51553190ba94d764006c17](https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17)".



---

archive/issue_comments_330415.json:
```json
{
    "body": "<a id='comment:6'></a>\nok, great, a bit of numerical noise, but further seems to be in order. an update soon.",
    "created_at": "2020-05-24T12:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330415",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
ok, great, a bit of numerical noise, but further seems to be in order. an update soon.



---

archive/issue_comments_330416.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\" to \"Marius Gerbershagen, Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\".",
    "created_at": "2020-05-24T21:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330416",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey" to "Marius Gerbershagen, Dima Pasechnik, Nils Bruin, Fran√ßois Bissey".



---

archive/issue_comments_330417.json:
```json
{
    "body": "**Changing author** from \"Nils Bruin, Dima Pasechnik, Erik Bray\" to \"Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray\".",
    "created_at": "2020-05-24T21:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330417",
    "user": "https://github.com/dimpase"
}
```

**Changing author** from "Nils Bruin, Dima Pasechnik, Erik Bray" to "Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray".



---

archive/issue_comments_330418.json:
```json
{
    "body": "**Changing reviewer** from \"Marius Gerbershagen, Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\" to \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\".",
    "created_at": "2020-05-24T21:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330418",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Marius Gerbershagen, Dima Pasechnik, Nils Bruin, Fran√ßois Bissey" to "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey".



---

archive/issue_comments_330419.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c\">e7e7457</a></td><td><code>doctest fixes</code></td></tr></table>\n",
    "created_at": "2020-05-24T22:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c">e7e7457</a></td><td><code>doctest fixes</code></td></tr></table>




---

archive/issue_comments_330420.json:
```json
{
    "body": "**Changing commit** from \"[4f7e1a59e19c46896e51553190ba94d764006c17](https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17)\" to \"[e7e7457622e13bb6e67a83df7ff10d36f29c7e5c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c)\".",
    "created_at": "2020-05-24T22:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4f7e1a59e19c46896e51553190ba94d764006c17](https://github.com/sagemath/sagetrac-mirror/commit/4f7e1a59e19c46896e51553190ba94d764006c17)" to "[e7e7457622e13bb6e67a83df7ff10d36f29c7e5c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c)".



---

archive/issue_comments_330421.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK, seems to work and pass all tests. Please review",
    "created_at": "2020-05-24T23:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330421",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
OK, seems to work and pass all tests. Please review



---

archive/issue_events_198436.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-24T23:02:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198436"
}
```



---

archive/issue_events_198437.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-24T23:02:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198437"
}
```



---

archive/issue_comments_330422.json:
```json
{
    "body": "<a id='comment:1'></a>\nAbsense of `makeinfo` leads to a building error, cf\nhttps://github.com/dimpase/sage/runs/704594060?check_suite_focus=true\n\n```\n[ecl-20.4.24.p0]   configure: error: Unable to build the manual: makeinfo not found.\n```",
    "created_at": "2020-05-25T08:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330422",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
Absense of `makeinfo` leads to a building error, cf
https://github.com/dimpase/sage/runs/704594060?check_suite_focus=true

```
[ecl-20.4.24.p0]   configure: error: Unable to build the manual: makeinfo not found.
```



---

archive/issue_events_198438.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-25T08:36:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198438"
}
```



---

archive/issue_events_198439.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-25T08:36:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198439"
}
```



---

archive/issue_comments_330423.json:
```json
{
    "body": "<a id='comment:142'></a>\nReplying to [dimpase](#comment%3A141):\n> Absense of `makeinfo` leads to a building error, cf\n> https://github.com/dimpase/sage/runs/704594060?check_suite_focus=true\n> \n> ```\n> [ecl-20.4.24.p0]   configure: error: Unable to build the manual: makeinfo not found.\n> ```\n\n\nSome flashback that is!",
    "created_at": "2020-05-25T08:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330423",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:142'></a>
Replying to [dimpase](#comment%3A141):
> Absense of `makeinfo` leads to a building error, cf
> https://github.com/dimpase/sage/runs/704594060?check_suite_focus=true
> 
> ```
> [ecl-20.4.24.p0]   configure: error: Unable to build the manual: makeinfo not found.
> ```


Some flashback that is!



---

archive/issue_comments_330424.json:
```json
{
    "body": "<a id='comment:3'></a>\nOh right, that was `maxima` not `ecl` that had problems before with `makeinfo`, this is different. That would make it a requirement, which may not be a bad thing (TM).",
    "created_at": "2020-05-25T08:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330424",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Oh right, that was `maxima` not `ecl` that had problems before with `makeinfo`, this is different. That would make it a requirement, which may not be a bad thing (TM).



---

archive/issue_comments_330425.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, but not in a stable release.\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2020-05-25T09:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330425",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "Fixed upstream, but not in a stable release." to "Reported upstream. No feedback yet.".



---

archive/issue_comments_330426.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis is now https://gitlab.com/embeddable-common-lisp/ecl/-/issues/593",
    "created_at": "2020-05-25T09:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330426",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
This is now https://gitlab.com/embeddable-common-lisp/ecl/-/issues/593



---

archive/issue_comments_330427.json:
```json
{
    "body": "<a id='comment:5'></a>\nTheir configure.ac is buggy, I'm fixing it...",
    "created_at": "2020-05-25T09:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330427",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Their configure.ac is buggy, I'm fixing it...



---

archive/issue_comments_330428.json:
```json
{
    "body": "<a id='comment:6'></a>\nthe submitted fix https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/210",
    "created_at": "2020-05-25T11:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330428",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
the submitted fix https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/210



---

archive/issue_comments_330429.json:
```json
{
    "body": "**Changing commit** from \"[e7e7457622e13bb6e67a83df7ff10d36f29c7e5c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c)\" to \"[4001aeb51385aaf833315c4d73f925295ecde004](https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004)\".",
    "created_at": "2020-05-25T12:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e7e7457622e13bb6e67a83df7ff10d36f29c7e5c](https://github.com/sagemath/sagetrac-mirror/commit/e7e7457622e13bb6e67a83df7ff10d36f29c7e5c)" to "[4001aeb51385aaf833315c4d73f925295ecde004](https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004)".



---

archive/issue_comments_330430.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004\">4001aeb</a></td><td><code>backport ECL PR #210</code></td></tr></table>\n",
    "created_at": "2020-05-25T12:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330430",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004">4001aeb</a></td><td><code>backport ECL PR #210</code></td></tr></table>




---

archive/issue_comments_330431.json:
```json
{
    "body": "<a id='comment:8'></a>\nre-running tests: https://github.com/dimpase/sage/actions\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004\">4001aeb</a></td><td><code>backport ECL PR #210</code></td></tr></table>\n",
    "created_at": "2020-05-25T12:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330431",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
re-running tests: https://github.com/dimpase/sage/actions

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004">4001aeb</a></td><td><code>backport ECL PR #210</code></td></tr></table>




---

archive/issue_comments_330432.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2020-05-25T19:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330432",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, in a later stable release.".



---

archive/issue_events_198440.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-25T19:22:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198440"
}
```



---

archive/issue_events_198441.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-25T19:22:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198441"
}
```



---

archive/issue_events_198442.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-25T19:27:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "rename": {
        "from": "update ECL to 16.1.3 or - rather - 20.4.24",
        "to": "update ECL to 20.4.24"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198442"
}
```



---

archive/issue_comments_330433.json:
```json
{
    "body": "**Changing commit** from \"[4001aeb51385aaf833315c4d73f925295ecde004](https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004)\" to \"[266d8c103e7a2905f5532a586e292b7e434eb25e](https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e)\".",
    "created_at": "2020-06-03T22:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4001aeb51385aaf833315c4d73f925295ecde004](https://github.com/sagemath/sagetrac-mirror/commit/4001aeb51385aaf833315c4d73f925295ecde004)" to "[266d8c103e7a2905f5532a586e292b7e434eb25e](https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e)".



---

archive/issue_comments_330434.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/469c14a4c612c792b46ca9f1f8848c7fe7a5c9ad\">469c14a</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c75887cb23ce7c1d627e53f84920470acd693c0e\">c75887c</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d71967447755f265e73c01df1d7c542850c9004\">2d71967</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe\">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b\">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e\">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr></table>\n",
    "created_at": "2020-06-03T22:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/469c14a4c612c792b46ca9f1f8848c7fe7a5c9ad">469c14a</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c75887cb23ce7c1d627e53f84920470acd693c0e">c75887c</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d71967447755f265e73c01df1d7c542850c9004">2d71967</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr></table>




---

archive/issue_comments_330435.json:
```json
{
    "body": "<a id='comment:2'></a>\nCould someone please review this? (rebased over current beta)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/469c14a4c612c792b46ca9f1f8848c7fe7a5c9ad\">469c14a</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c75887cb23ce7c1d627e53f84920470acd693c0e\">c75887c</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d71967447755f265e73c01df1d7c542850c9004\">2d71967</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe\">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b\">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e\">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr></table>\n",
    "created_at": "2020-06-03T22:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330435",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
Could someone please review this? (rebased over current beta)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/469c14a4c612c792b46ca9f1f8848c7fe7a5c9ad">469c14a</a></td><td><code>rebased over 9.1 branch u/gh-spaghettisalat/ecl-update</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c75887cb23ce7c1d627e53f84920470acd693c0e">c75887c</a></td><td><code>update checksums, add upstream URL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d71967447755f265e73c01df1d7c542850c9004">2d71967</a></td><td><code>renaming the patch, tbd if it is still needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr></table>




---

archive/issue_events_198443.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-03T22:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198443"
}
```



---

archive/issue_comments_330436.json:
```json
{
    "body": "<a id='comment:3'></a>\nUpdated the goddamn tarball address...",
    "created_at": "2020-06-04T09:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330436",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:3'></a>
Updated the goddamn tarball address...



---

archive/issue_comments_330437.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,7 @@\n \n We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n-**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz\n+//Older tarball//: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz\n \n+**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-20.4.24.tgz\n \n``````\n",
    "created_at": "2020-06-04T09:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330437",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,7 @@
 
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
-**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz
+//Older tarball//: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz
 
+**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-20.4.24.tgz
 
``````




---

archive/attachments_020865.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "chkerrs-22191.txt",
    "asset_url": "tarball://root/attachments/some-uuid/ticket22191/chkerrs-22191.txt",
    "created_at": "2020-06-04T12:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.txt",
    "user": "https://github.com/EmmanuelCharpentier"
}
```



---

archive/issue_comments_330438.json:
```json
{
    "body": "",
    "created_at": "2020-06-04T12:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330438",
    "user": "https://github.com/EmmanuelCharpentier"
}
```





---

archive/issue_comments_330439.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey\" to \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey, Emmanuel Charpentier\".",
    "created_at": "2020-06-04T12:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330439",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Changing reviewer** from "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey" to "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey, Emmanuel Charpentier".



---

archive/issue_comments_330440.json:
```json
{
    "body": "<a id='comment:4'></a>\nOn Debian testing running on core i7 + 16 GB RAM using the system packages recommended by `README.md}}, {{{ptestlong` on the present branch raises the same failures already [reported](https://groups.google.com/d/msg/sage-release/3mj1UjWf31g/uE7GqdfmAQAJ) for 5.2.beta0 on the same machine.\n\nThese failures are similar to those reported for [9.1.rc3](https://groups.google.com/d/msg/sage-release/4spsDgdYoYA/O1ZjI5VLBgAJ) and explained away by [Jonathan Kliem](https://groups.google.com/d/msg/sage-release/4spsDgdYoYA/CS8T3x4gBwAJ).\n\nRe-running the failed/timed out doctests show that the timed out one pass and all others persist to fail ; see attached `chkerrs-22191.txt`.\n\nThis branch results do not seem to differ from thos of 9.2.beta0 as far as ECL might be concerned.\n\n==> (tentative) `positive_review`. As in other cases, a check on a system using Sage packages (i. e. one on whichg `ptestlong` raises no failures) would be useful.",
    "created_at": "2020-06-04T12:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330440",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:4'></a>
On Debian testing running on core i7 + 16 GB RAM using the system packages recommended by `README.md}}, {{{ptestlong` on the present branch raises the same failures already [reported](https://groups.google.com/d/msg/sage-release/3mj1UjWf31g/uE7GqdfmAQAJ) for 5.2.beta0 on the same machine.

These failures are similar to those reported for [9.1.rc3](https://groups.google.com/d/msg/sage-release/4spsDgdYoYA/O1ZjI5VLBgAJ) and explained away by [Jonathan Kliem](https://groups.google.com/d/msg/sage-release/4spsDgdYoYA/CS8T3x4gBwAJ).

Re-running the failed/timed out doctests show that the timed out one pass and all others persist to fail ; see attached `chkerrs-22191.txt`.

This branch results do not seem to differ from thos of 9.2.beta0 as far as ECL might be concerned.

==> (tentative) `positive_review`. As in other cases, a check on a system using Sage packages (i. e. one on whichg `ptestlong` raises no failures) would be useful.



---

archive/issue_events_198444.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2020-06-04T12:36:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198444"
}
```



---

archive/issue_events_198445.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2020-06-04T12:36:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198445"
}
```



---

archive/issue_comments_330441.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,13 +2,6 @@\n \n https://common-lisp.net/project/ecl/posts/ECL-20424-release.html\n \n-This most probably obsoletes this:\n-\n-ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). \n-\n We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n-//Older tarball//: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz\n-\n-**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-20.4.24.tgz\n-\n+**Tarball**: see checksums.ini [upstream_url]\n``````\n",
    "created_at": "2020-06-04T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330441",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,13 +2,6 @@
 
 https://common-lisp.net/project/ecl/posts/ECL-20424-release.html
 
-This most probably obsoletes this:
-
-ECL 16.1.3 has been [released](https://common-lisp.net/project/ecl/posts/ECL-1613-release.html). 
-
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
-//Older tarball//: https://common-lisp.net/project/ecl/static/files/release/ecl-16.1.3.tgz
-
-**Tarball**: https://common-lisp.net/project/ecl/static/files/release/ecl-20.4.24.tgz
-
+**Tarball**: see checksums.ini [upstream_url]
``````




---

archive/issue_comments_330442.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,5 @@\n \n We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.\n \n-**Tarball**: see checksums.ini [upstream_url]\n+**Tarball**: see checksums.ini [upstream_url].\n+(To configure Sage to download from the upstream URL, use `./configure --enable-download-from-upstream-url`)\n``````\n",
    "created_at": "2020-06-04T19:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330442",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,5 @@
 
 We should update, as it will resolve some Maxima bugs, and is essential for resolving other Maxima bugs.
 
-**Tarball**: see checksums.ini [upstream_url]
+**Tarball**: see checksums.ini [upstream_url].
+(To configure Sage to download from the upstream URL, use `./configure --enable-download-from-upstream-url`)
``````




---

archive/issue_comments_330443.json:
```json
{
    "body": "<a id='comment:7'></a>\nCompile fails on macOS:\n\n```\n[ecl-20.4.24.p0] manual.txi:13: warning: unrecognized encoding name `UTF-8'.\n[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Unknown command `inlinefmtifelse'.\n[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced {.\n[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced }.\n...\n[ecl-20.4.24.p0] Too many errors!  Gave up.\n[ecl-20.4.24.p0] make[5]: *** [ecl.info.gz] Error 1\n[ecl-20.4.24.p0] make[4]: *** [info] Error 2\n[ecl-20.4.24.p0] make[3]: *** [doc] Error 2\n[ecl-20.4.24.p0] make[2]: *** [all] Error 2\n[ecl-20.4.24.p0] ********************************************************************************\n[ecl-20.4.24.p0] Error building ecl-20.4.24.p0\n[ecl-20.4.24.p0] ********************************************************************************\n```",
    "created_at": "2020-06-04T19:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330443",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Compile fails on macOS:

```
[ecl-20.4.24.p0] manual.txi:13: warning: unrecognized encoding name `UTF-8'.
[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Unknown command `inlinefmtifelse'.
[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced {.
[ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced }.
...
[ecl-20.4.24.p0] Too many errors!  Gave up.
[ecl-20.4.24.p0] make[5]: *** [ecl.info.gz] Error 1
[ecl-20.4.24.p0] make[4]: *** [info] Error 2
[ecl-20.4.24.p0] make[3]: *** [doc] Error 2
[ecl-20.4.24.p0] make[2]: *** [all] Error 2
[ecl-20.4.24.p0] ********************************************************************************
[ecl-20.4.24.p0] Error building ecl-20.4.24.p0
[ecl-20.4.24.p0] ********************************************************************************
```



---

archive/issue_events_198446.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T19:34:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198446"
}
```



---

archive/issue_events_198447.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T19:34:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198447"
}
```



---

archive/issue_comments_330444.json:
```json
{
    "body": "<a id='comment:158'></a>\nReplying to [mkoeppe](#comment%3A157):\n> Compile fails on macOS:\n> \n> ```\n> [ecl-20.4.24.p0] manual.txi:13: warning: unrecognized encoding name `UTF-8'.\n> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Unknown command `inlinefmtifelse'.\n> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced {.\n> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced }.\n> ...\n> [ecl-20.4.24.p0] Too many errors!  Gave up.\n> [ecl-20.4.24.p0] make[5]: *** [ecl.info.gz] Error 1\n> [ecl-20.4.24.p0] make[4]: *** [info] Error 2\n> [ecl-20.4.24.p0] make[3]: *** [doc] Error 2\n> [ecl-20.4.24.p0] make[2]: *** [all] Error 2\n> [ecl-20.4.24.p0] ********************************************************************************\n> [ecl-20.4.24.p0] Error building ecl-20.4.24.p0\n> [ecl-20.4.24.p0] ********************************************************************************\n> ```\n> \n\n\nWhat does makeinfo --version report?",
    "created_at": "2020-06-04T19:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330444",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:158'></a>
Replying to [mkoeppe](#comment%3A157):
> Compile fails on macOS:
> 
> ```
> [ecl-20.4.24.p0] manual.txi:13: warning: unrecognized encoding name `UTF-8'.
> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Unknown command `inlinefmtifelse'.
> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced {.
> [ecl-20.4.24.p0] /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/tmp/sage/build/ecl-20.4.24.p0/src/build/doc/manual//user-guide/invoking.txi:58: Misplaced }.
> ...
> [ecl-20.4.24.p0] Too many errors!  Gave up.
> [ecl-20.4.24.p0] make[5]: *** [ecl.info.gz] Error 1
> [ecl-20.4.24.p0] make[4]: *** [info] Error 2
> [ecl-20.4.24.p0] make[3]: *** [doc] Error 2
> [ecl-20.4.24.p0] make[2]: *** [all] Error 2
> [ecl-20.4.24.p0] ********************************************************************************
> [ecl-20.4.24.p0] Error building ecl-20.4.24.p0
> [ecl-20.4.24.p0] ********************************************************************************
> ```
> 


What does makeinfo --version report?



---

archive/issue_comments_330445.json:
```json
{
    "body": "<a id='comment:9'></a>\nIIRC I saw a similar weird  error in case of a broken texinfo installation.",
    "created_at": "2020-06-04T19:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330445",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
IIRC I saw a similar weird  error in case of a broken texinfo installation.



---

archive/issue_comments_330446.json:
```json
{
    "body": "<a id='comment:0'></a>\nWith Homebrew, a setup that works for me is with texinfo installed, and\n`/usr/local/Cellar/texinfo/6.7/bin` coming early in PATH, so that the native makeinfo is not used.",
    "created_at": "2020-06-04T20:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330446",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
With Homebrew, a setup that works for me is with texinfo installed, and
`/usr/local/Cellar/texinfo/6.7/bin` coming early in PATH, so that the native makeinfo is not used.



---

archive/issue_comments_330447.json:
```json
{
    "body": "<a id='comment:1'></a>\nTo make it accessible to more users, how about using `./configure --enable-manual=no`? Or use this if the version of `makeinfo` is too old?\n\nThe system version of makeinfo on OS X:\n\n```\n% makeinfo --version                     \nmakeinfo (GNU texinfo) 4.8\n\nCopyright (C) 2004 Free Software Foundation, Inc.\nThere is NO warranty.  You may redistribute this software\nunder the terms of the GNU General Public License.\nFor more information about these matters, see the files named COPYING.\n```",
    "created_at": "2020-06-04T21:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330447",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
To make it accessible to more users, how about using `./configure --enable-manual=no`? Or use this if the version of `makeinfo` is too old?

The system version of makeinfo on OS X:

```
% makeinfo --version                     
makeinfo (GNU texinfo) 4.8

Copyright (C) 2004 Free Software Foundation, Inc.
There is NO warranty.  You may redistribute this software
under the terms of the GNU General Public License.
For more information about these matters, see the files named COPYING.
```



---

archive/issue_comments_330448.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f\">12447bc</a></td><td><code>reject old makeinfo</code></td></tr></table>\n",
    "created_at": "2020-06-05T09:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330448",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f">12447bc</a></td><td><code>reject old makeinfo</code></td></tr></table>




---

archive/issue_comments_330449.json:
```json
{
    "body": "**Changing commit** from \"[266d8c103e7a2905f5532a586e292b7e434eb25e](https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e)\" to \"[12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f](https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f)\".",
    "created_at": "2020-06-05T09:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[266d8c103e7a2905f5532a586e292b7e434eb25e](https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e)" to "[12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f](https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f)".



---

archive/issue_events_198448.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-05T09:33:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198448"
}
```



---

archive/issue_events_198449.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-05T09:33:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198449"
}
```



---

archive/issue_comments_330450.json:
```json
{
    "body": "<a id='comment:3'></a>\nOK, this does the trick. Another question whether on Homebrew we  want to recommend installing texinfo, and do\n\n```diff\n--- a/.homebrew-build-env\n+++ b/.homebrew-build-env\n@@ -2,7 +2,7 @@\n # that activate keg-only homebrew package installations\n \n HOMEBREW=`brew --prefix` || return 1\n-for l in gettext; do\n+for l in texinfo gettext; do\n     if [ -d \"$HOMEBREW/opt/$l/bin\" ]; then\n         PATH=\"$HOMEBREW/opt/$l/bin:$PATH\"\n     fi\n```",
    "created_at": "2020-06-05T09:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330450",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
OK, this does the trick. Another question whether on Homebrew we  want to recommend installing texinfo, and do

```diff
--- a/.homebrew-build-env
+++ b/.homebrew-build-env
@@ -2,7 +2,7 @@
 # that activate keg-only homebrew package installations
 
 HOMEBREW=`brew --prefix` || return 1
-for l in gettext; do
+for l in texinfo gettext; do
     if [ -d "$HOMEBREW/opt/$l/bin" ]; then
         PATH="$HOMEBREW/opt/$l/bin:$PATH"
     fi
```



---

archive/issue_comments_330451.json:
```json
{
    "body": "<a id='comment:4'></a>\nDo you need/want another check on Debian ?",
    "created_at": "2020-06-05T11:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330451",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:4'></a>
Do you need/want another check on Debian ?



---

archive/issue_comments_330452.json:
```json
{
    "body": "<a id='comment:165'></a>\nReplying to [charpent](#comment%3A164):\n> Do you need/want another check on Debian ?\n\n\nYes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`",
    "created_at": "2020-06-05T12:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330452",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:165'></a>
Replying to [charpent](#comment%3A164):
> Do you need/want another check on Debian ?


Yes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`



---

archive/issue_comments_330453.json:
```json
{
    "body": "<a id='comment:166'></a>\nReplying to [dimpase](#comment%3A165):\n> Replying to [charpent](#comment%3A164):\n> > Do you need/want another check on Debian ?\n\n> \n> Yes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`\n\n\nUnderway. Expect about 3 hours...",
    "created_at": "2020-06-05T13:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330453",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:166'></a>
Replying to [dimpase](#comment%3A165):
> Replying to [charpent](#comment%3A164):
> > Do you need/want another check on Debian ?

> 
> Yes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`


Underway. Expect about 3 hours...



---

archive/issue_comments_330454.json:
```json
{
    "body": "<a id='comment:167'></a>\nReplying to [charpent](#comment%3A166):\n> Replying to [dimpase](#comment%3A165):\n> > Replying to [charpent](#comment%3A164):\n> > > Do you need/want another check on Debian ?\n\n> > \n> > Yes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`\n\n> \n> Underway. Expect about 3 hours...\n\n\nThe build phase of `time make ptestlong` doesn't seem to have changed anything. I'll keep it running in order to test `kenzo` (not in my initial setup...).",
    "created_at": "2020-06-05T13:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330454",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:167'></a>
Replying to [charpent](#comment%3A166):
> Replying to [dimpase](#comment%3A165):
> > Replying to [charpent](#comment%3A164):
> > > Do you need/want another check on Debian ?

> > 
> > Yes, with the optional packages dependent on ecl, please - `fricas` and `kenzo`

> 
> Underway. Expect about 3 hours...


The build phase of `time make ptestlong` doesn't seem to have changed anything. I'll keep it running in order to test `kenzo` (not in my initial setup...).



---

archive/attachments_020866.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "chkerrs-V2.txt",
    "asset_url": "tarball://root/attachments/some-uuid/ticket22191/chkerrs-V2.txt",
    "created_at": "2020-06-05T15:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.txt",
    "user": "https://github.com/EmmanuelCharpentier"
}
```



---

archive/issue_comments_330455.json:
```json
{
    "body": "<a id='comment:8'></a>\nWell,that was faster than expexcted.\n\nI get the same 11 permanent failures as reported for 2.0.beta1. See `checkerrs-V2.txt` for details.\n\n==>//Nihil obstat// for `positive_review`, but  I won't put it myself (someone testing this on a Mac might...).",
    "created_at": "2020-06-05T15:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330455",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:8'></a>
Well,that was faster than expexcted.

I get the same 11 permanent failures as reported for 2.0.beta1. See `checkerrs-V2.txt` for details.

==>//Nihil obstat// for `positive_review`, but  I won't put it myself (someone testing this on a Mac might...).



---

archive/issue_comments_330456.json:
```json
{
    "body": "<a id='comment:169'></a>\nReplying to [dimpase](#comment%3A163):\n> Another question whether on Homebrew we  want to recommend installing texinfo, and do\n> \n> ```diff\n> --- a/.homebrew-build-env\n> +++ b/.homebrew-build-env\n> @@ -2,7 +2,7 @@\n>  # that activate keg-only homebrew package installations\n>  \n>  HOMEBREW=`brew --prefix` || return 1\n> -for l in gettext; do\n> +for l in texinfo gettext; do\n>      if [ -d \"$HOMEBREW/opt/$l/bin\" ]; then\n>          PATH=\"$HOMEBREW/opt/$l/bin:$PATH\"\n>      fi\n> ```\n\n\nI think this should go to #29557 (Add script package `_recommended` and generate \"recommended system packages\" info) - having a current texinfo should be on the same footing as having an installation of texlive etc.",
    "created_at": "2020-06-05T16:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330456",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:169'></a>
Replying to [dimpase](#comment%3A163):
> Another question whether on Homebrew we  want to recommend installing texinfo, and do
> 
> ```diff
> --- a/.homebrew-build-env
> +++ b/.homebrew-build-env
> @@ -2,7 +2,7 @@
>  # that activate keg-only homebrew package installations
>  
>  HOMEBREW=`brew --prefix` || return 1
> -for l in gettext; do
> +for l in texinfo gettext; do
>      if [ -d "$HOMEBREW/opt/$l/bin" ]; then
>          PATH="$HOMEBREW/opt/$l/bin:$PATH"
>      fi
> ```


I think this should go to #29557 (Add script package `_recommended` and generate "recommended system packages" info) - having a current texinfo should be on the same footing as having an installation of texlive etc.



---

archive/issue_events_198450.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-05T17:55:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198450"
}
```



---

archive/issue_events_198451.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-05T17:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198451"
}
```



---

archive/issue_comments_330457.json:
```json
{
    "body": "<a id='comment:0'></a>\nBuilds OK now on macOS. I haven't tested or looked at anything else in this ticket. Resetting to charpent's tentative positive review.",
    "created_at": "2020-06-05T17:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330457",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>
Builds OK now on macOS. I haven't tested or looked at anything else in this ticket. Resetting to charpent's tentative positive review.



---

archive/issue_comments_330458.json:
```json
{
    "body": "<a id='comment:171'></a>\nReplying to [mkoeppe](#comment%3A170):\n> Builds OK now on macOS. I haven't tested or looked at anything else in this ticket. Resetting to charpent's tentative positive review.\n\n\nYou should add your name in the \"Reviewers\" field (I tend to forget this pretty regularly, and get reminded by `kcrisman` equally regularly...).",
    "created_at": "2020-06-05T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330458",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:171'></a>
Replying to [mkoeppe](#comment%3A170):
> Builds OK now on macOS. I haven't tested or looked at anything else in this ticket. Resetting to charpent's tentative positive review.


You should add your name in the "Reviewers" field (I tend to forget this pretty regularly, and get reminded by `kcrisman` equally regularly...).



---

archive/issue_comments_330459.json:
```json
{
    "body": "**Changing author** from \"Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray\" to \"Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray, Matthias Koeppe\".",
    "created_at": "2020-06-05T22:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330459",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray" to "Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray, Matthias Koeppe".



---

archive/issue_comments_330460.json:
```json
{
    "body": "**Changing author** from \"Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray, Matthias Koeppe\" to \"Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray\".",
    "created_at": "2020-06-05T22:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330460",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray, Matthias Koeppe" to "Marius Gerbershagen, Nils Bruin, Dima Pasechnik, Erik Bray".



---

archive/issue_comments_330461.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey, Emmanuel Charpentier\" to \"Dima Pasechnik, Nils Bruin, Fran\u00e7ois Bissey, Emmanuel Charpentier, Matthias Koeppe\".",
    "created_at": "2020-06-05T22:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330461",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey, Emmanuel Charpentier" to "Dima Pasechnik, Nils Bruin, Fran√ßois Bissey, Emmanuel Charpentier, Matthias Koeppe".



---

archive/issue_comments_330462.json:
```json
{
    "body": "<a id='comment:174'></a>\nReplying to [charpent](#comment%3A171):\n> You should add your name in the \"Reviewers\" field (I tend to forget this pretty regularly, and get reminded by `kcrisman` equally regularly...).\n\nThanks, done.",
    "created_at": "2020-06-05T22:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330462",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:174'></a>
Replying to [charpent](#comment%3A171):
> You should add your name in the "Reviewers" field (I tend to forget this pretty regularly, and get reminded by `kcrisman` equally regularly...).

Thanks, done.



---

archive/issue_events_198452.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-07T00:48:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198452"
}
```



---

archive/issue_events_198453.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-07T00:48:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198453"
}
```



---

archive/issue_comments_330463.json:
```json
{
    "body": "<a id='comment:6'></a>\nTests at https://github.com/mkoeppe/sage/runs/745921410:\n\nOn `ubuntu-trusty-standard`:\n\n```\nIn file included from /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun.d:18:0:\n/sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d: In function 'fixed_dispatch1':\n/sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d:92:3: error: 'for' loop initial declarations are only allowed in C99 mode\n   for (int i = 0; i < 1; i++)\n   ^\n```\n\nLikewise in `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/745921476)",
    "created_at": "2020-06-07T00:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330463",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Tests at https://github.com/mkoeppe/sage/runs/745921410:

On `ubuntu-trusty-standard`:

```
In file included from /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun.d:18:0:
/sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d: In function 'fixed_dispatch1':
/sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d:92:3: error: 'for' loop initial declarations are only allowed in C99 mode
   for (int i = 0; i < 1; i++)
   ^
```

Likewise in `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/745921476)



---

archive/issue_comments_330464.json:
```json
{
    "body": "<a id='comment:7'></a>\nAnd on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), `maxima` fails:\n\n```\necl -norc \\\n           -eval '(progn  (load \"../lisp-utils/defsystem.lisp\") (funcall (intern (symbol-name :operate-on-system) :mk) \"maxima\" :compile :verbose t) (build-maxima-lib))' \\\n           -eval '(ext:quit)'\n\nInternal or unrecoverable error in:\nCan't set the size of the C stack\n\n;;; ECL C Backtrace\n;;; /sage/local/lib/libecl.so.20.4(_ecl_dump_c_backtrace+0x22) [0x14564d659042]\n;;; /sage/local/lib/libecl.so.20.4(ecl_internal_error+0x41) [0x14564d647431]\n;;; /sage/local/lib/libecl.so.20.4(+0x1d0a20) [0x14564d66fa20]\n;;; /sage/local/lib/libecl.so.20.4(ecl_cs_set_org+0x5d) [0x14564d66fe9d]\n;;; /sage/local/lib/libecl.so.20.4(cl_boot+0x15c) [0x14564d53581c]\n;;; ecl() [0x40090a]\n;;; /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0) [0x14564d0f5830]\n;;; ecl() [0x4009f9]\nMakefile:1349: recipe for target 'binary-ecl/maxima' failed\nmake[3]: *** [binary-ecl/maxima] Aborted (core dumped)\n```",
    "created_at": "2020-06-07T02:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330464",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
And on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), `maxima` fails:

```
ecl -norc \
           -eval '(progn  (load "../lisp-utils/defsystem.lisp") (funcall (intern (symbol-name :operate-on-system) :mk) "maxima" :compile :verbose t) (build-maxima-lib))' \
           -eval '(ext:quit)'

Internal or unrecoverable error in:
Can't set the size of the C stack

;;; ECL C Backtrace
;;; /sage/local/lib/libecl.so.20.4(_ecl_dump_c_backtrace+0x22) [0x14564d659042]
;;; /sage/local/lib/libecl.so.20.4(ecl_internal_error+0x41) [0x14564d647431]
;;; /sage/local/lib/libecl.so.20.4(+0x1d0a20) [0x14564d66fa20]
;;; /sage/local/lib/libecl.so.20.4(ecl_cs_set_org+0x5d) [0x14564d66fe9d]
;;; /sage/local/lib/libecl.so.20.4(cl_boot+0x15c) [0x14564d53581c]
;;; ecl() [0x40090a]
;;; /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0) [0x14564d0f5830]
;;; ecl() [0x4009f9]
Makefile:1349: recipe for target 'binary-ecl/maxima' failed
make[3]: *** [binary-ecl/maxima] Aborted (core dumped)
```



---

archive/issue_comments_330465.json:
```json
{
    "body": "<a id='comment:178'></a>\nReplying to [mkoeppe](#comment%3A176):\n> Tests at https://github.com/mkoeppe/sage/runs/745921410:\n> \n> On `ubuntu-trusty-standard`:\n> \n> ```\n> In file included from /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun.d:18:0:\n> /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d: In function 'fixed_dispatch1':\n> /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d:92:3: error: 'for' loop initial declarations are only allowed in C99 mode\n>    for (int i = 0; i < 1; i++)\n>    ^\n> ```\n> \n> Likewise in `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/745921476)\n\n\nxenial is long past EOL (oops, more precisely, past End of Support). jessie is past EOL, and jessie LTS will be EOL in less than a month.\n\nIf the C compiler there defaults to c89 mode, I don't see why we should care.",
    "created_at": "2020-06-07T07:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330465",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:178'></a>
Replying to [mkoeppe](#comment%3A176):
> Tests at https://github.com/mkoeppe/sage/runs/745921410:
> 
> On `ubuntu-trusty-standard`:
> 
> ```
> In file included from /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun.d:18:0:
> /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d: In function 'fixed_dispatch1':
> /sage/local/var/tmp/sage/build/ecl-20.4.24.p0/src/src/c/cfun_dispatch.d:92:3: error: 'for' loop initial declarations are only allowed in C99 mode
>    for (int i = 0; i < 1; i++)
>    ^
> ```
> 
> Likewise in `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/745921476)


xenial is long past EOL (oops, more precisely, past End of Support). jessie is past EOL, and jessie LTS will be EOL in less than a month.

If the C compiler there defaults to c89 mode, I don't see why we should care.



---

archive/issue_comments_330466.json:
```json
{
    "body": "<a id='comment:9'></a>\nI've left a comment on https://gitlab.com/embeddable-common-lisp/ecl/-/issues/484\n(cleanup: consider removing c89 validation from buildsystem)",
    "created_at": "2020-06-07T08:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330466",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
I've left a comment on https://gitlab.com/embeddable-common-lisp/ecl/-/issues/484
(cleanup: consider removing c89 validation from buildsystem)



---

archive/issue_comments_330467.json:
```json
{
    "body": "<a id='comment:0'></a>\nhttps://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/214 adds a c99-fix upstream",
    "created_at": "2020-06-07T09:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330467",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/214 adds a c99-fix upstream



---

archive/issue_comments_330468.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, in a later stable release.\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2020-06-07T09:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330468",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "Fixed upstream, in a later stable release." to "Reported upstream. No feedback yet.".



---

archive/issue_comments_330469.json:
```json
{
    "body": "<a id='comment:181'></a>\nReplying to [mkoeppe](#comment%3A177):\n> And on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), `maxima` fails:\n> \n> ```\n> ecl -norc \\\n>            -eval '(progn  (load \"../lisp-utils/defsystem.lisp\") (funcall (intern (symbol-name :operate-on-system) :mk) \"maxima\" :compile :verbose t) (build-maxima-lib))' \\\n>            -eval '(ext:quit)'\n> \n> Internal or unrecoverable error in:\n> Can't set the size of the C stack\n> ...\n> ```\n\n\nI can reproduce this on arando buildbot - which is an Ubuntu ~~Xenial~~ Bionic 32-bit machine.\nSo this seems to do more with OS than anything else.",
    "created_at": "2020-06-07T13:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330469",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:181'></a>
Replying to [mkoeppe](#comment%3A177):
> And on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), `maxima` fails:
> 
> ```
> ecl -norc \
>            -eval '(progn  (load "../lisp-utils/defsystem.lisp") (funcall (intern (symbol-name :operate-on-system) :mk) "maxima" :compile :verbose t) (build-maxima-lib))' \
>            -eval '(ext:quit)'
> 
> Internal or unrecoverable error in:
> Can't set the size of the C stack
> ...
> ```


I can reproduce this on arando buildbot - which is an Ubuntu ~~Xenial~~ Bionic 32-bit machine.
So this seems to do more with OS than anything else.



---

archive/issue_comments_330470.json:
```json
{
    "body": "<a id='comment:2'></a>\nissue in [comment:181](#comment%3A181) is reproducble without Sage, just ECL and Maxima:\nI filed\nhttps://gitlab.com/embeddable-common-lisp/ecl/-/issues/596",
    "created_at": "2020-06-07T14:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330470",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
issue in [comment:181](#comment%3A181) is reproducble without Sage, just ECL and Maxima:
I filed
https://gitlab.com/embeddable-common-lisp/ecl/-/issues/596



---

archive/issue_comments_330471.json:
```json
{
    "body": "<a id='comment:183'></a>\nReplying to [mkoeppe](#comment%3A177):\n> And on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), \n\n\nthis says\n\n```\n2020-06-06T21:39:17.5489746Z Ubuntu\n2020-06-06T21:39:17.5489978Z 18.04.4\n```\n\nwhich is Bionic, not Xenial (cf https://wiki.ubuntu.com/Releases), so I don't know why this is mixed up.\n\n\n`maxima` fails:\n...",
    "created_at": "2020-06-07T14:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330471",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:183'></a>
Replying to [mkoeppe](#comment%3A177):
> And on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), 


this says

```
2020-06-06T21:39:17.5489746Z Ubuntu
2020-06-06T21:39:17.5489978Z 18.04.4
```

which is Bionic, not Xenial (cf https://wiki.ubuntu.com/Releases), so I don't know why this is mixed up.


`maxima` fails:
...



---

archive/issue_comments_330472.json:
```json
{
    "body": "<a id='comment:184'></a>\nReplying to [dimpase](#comment%3A183):\n> Replying to [mkoeppe](#comment%3A177):\n> > on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), \n\n> \n> this says\n> \n> ```\n> 2020-06-06T21:39:17.5489746Z Ubuntu\n> 2020-06-06T21:39:17.5489978Z 18.04.4\n> ```\n> \n> which is Bionic, not Xenial (cf https://wiki.ubuntu.com/Releases), so I don't know why this is mixed up.\n\n\nYou're looking in the wrong place. The [GitHub](GitHub) runner is on Ubuntu, but the test is in a Docker container running xenial\n\n```\nDigest: sha256:db6697a61d5679b7ca69dbde3dad6be0d17064d5b6b0e9f7be8d456ebb337209\nStatus: Downloaded newer image for ubuntu:xenial\n```",
    "created_at": "2020-06-07T18:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330472",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:184'></a>
Replying to [dimpase](#comment%3A183):
> Replying to [mkoeppe](#comment%3A177):
> > on `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/745921419), 

> 
> this says
> 
> ```
> 2020-06-06T21:39:17.5489746Z Ubuntu
> 2020-06-06T21:39:17.5489978Z 18.04.4
> ```
> 
> which is Bionic, not Xenial (cf https://wiki.ubuntu.com/Releases), so I don't know why this is mixed up.


You're looking in the wrong place. The [GitHub](GitHub) runner is on Ubuntu, but the test is in a Docker container running xenial

```
Digest: sha256:db6697a61d5679b7ca69dbde3dad6be0d17064d5b6b0e9f7be8d456ebb337209
Status: Downloaded newer image for ubuntu:xenial
```



---

archive/issue_comments_330473.json:
```json
{
    "body": "<a id='comment:5'></a>\nas mentioned in ticket:23011#comment:15\n\nsage with ecls-20.4.24/maxima-5.44.0\nfails to build because `ECL_OPT_TRAP_SIGCHLD` is gone",
    "created_at": "2020-06-11T11:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330473",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:5'></a>
as mentioned in ticket:23011#comment:15

sage with ecls-20.4.24/maxima-5.44.0
fails to build because `ECL_OPT_TRAP_SIGCHLD` is gone



---

archive/issue_comments_330474.json:
```json
{
    "body": "**Changing commit** from \"[12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f](https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f)\" to \"[a3e0eca1690d463a8aeef9cac915f9fe6ff8baea](https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea)\".",
    "created_at": "2020-06-11T15:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f](https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f)" to "[a3e0eca1690d463a8aeef9cac915f9fe6ff8baea](https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea)".



---

archive/issue_comments_330475.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea\">a3e0eca</a></td><td><code>add upstream fix from MR 215</code></td></tr></table>\n",
    "created_at": "2020-06-11T15:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea">a3e0eca</a></td><td><code>add upstream fix from MR 215</code></td></tr></table>




---

archive/issue_events_198454.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-11T16:02:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198454"
}
```



---

archive/issue_events_198455.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-11T16:02:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198455"
}
```



---

archive/issue_comments_330476.json:
```json
{
    "body": "<a id='comment:187'></a>\nReplying to [gh-sheerluck](#comment%3A185):\n> as mentioned in ticket:23011#comment:15\n> \n> sage with ecls-20.4.24/maxima-5.44.0\n> fails to build because `ECL_OPT_TRAP_SIGCHLD` is gone\n\nwe're still on Maxima 5.42.2, and it works with this ecl.\n\nUpstream fix for Ubuntu xenial is addded, please review.",
    "created_at": "2020-06-11T16:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330476",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:187'></a>
Replying to [gh-sheerluck](#comment%3A185):
> as mentioned in ticket:23011#comment:15
> 
> sage with ecls-20.4.24/maxima-5.44.0
> fails to build because `ECL_OPT_TRAP_SIGCHLD` is gone

we're still on Maxima 5.42.2, and it works with this ecl.

Upstream fix for Ubuntu xenial is addded, please review.



---

archive/issue_comments_330477.json:
```json
{
    "body": "<a id='comment:188'></a>\nReplying to [dimpase](#comment%3A178):\n> \n> If the C compiler there defaults to c89 mode, I don't see why we should care.\n\n\nCertainly we should care about the bug that our compiler flags that are part of $CC are not passed on correctly...",
    "created_at": "2020-06-11T19:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330477",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:188'></a>
Replying to [dimpase](#comment%3A178):
> 
> If the C compiler there defaults to c89 mode, I don't see why we should care.


Certainly we should care about the bug that our compiler flags that are part of $CC are not passed on correctly...



---

archive/issue_comments_330478.json:
```json
{
    "body": "<a id='comment:9'></a>\nright, I forgot the patch I made on\nhttps://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/214 - I should add it too.",
    "created_at": "2020-06-11T19:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
right, I forgot the patch I made on
https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/214 - I should add it too.



---

archive/issue_events_198456.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-11T19:59:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198456"
}
```



---

archive/issue_events_198457.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-11T19:59:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198457"
}
```



---

archive/issue_comments_330479.json:
```json
{
    "body": "<a id='comment:191'></a>\nReplying to [mkoeppe](#comment%3A188):\n> Replying to [dimpase](#comment%3A178):\n> > \n> > If the C compiler there defaults to c89 mode, I don't see why we should care.\n\n> \n> Certainly we should care about the bug that our compiler flags that are part of $CC are not passed on correctly...\n\n\nby the way, ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ?",
    "created_at": "2020-06-12T07:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330479",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:191'></a>
Replying to [mkoeppe](#comment%3A188):
> Replying to [dimpase](#comment%3A178):
> > 
> > If the C compiler there defaults to c89 mode, I don't see why we should care.

> 
> Certainly we should care about the bug that our compiler flags that are part of $CC are not passed on correctly...


by the way, ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ?



---

archive/issue_comments_330480.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e\">89b006b</a></td><td><code>add the patch from upstream MR 214</code></td></tr></table>\n",
    "created_at": "2020-06-12T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e">89b006b</a></td><td><code>add the patch from upstream MR 214</code></td></tr></table>




---

archive/issue_comments_330481.json:
```json
{
    "body": "**Changing commit** from \"[a3e0eca1690d463a8aeef9cac915f9fe6ff8baea](https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea)\" to \"[89b006b106ca050240f580cb80d2a6320e5ade2e](https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e)\".",
    "created_at": "2020-06-12T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a3e0eca1690d463a8aeef9cac915f9fe6ff8baea](https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea)" to "[89b006b106ca050240f580cb80d2a6320e5ade2e](https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e)".



---

archive/issue_events_198458.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-12T08:27:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198458"
}
```



---

archive/issue_events_198459.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-12T08:27:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198459"
}
```



---

archive/issue_comments_330482.json:
```json
{
    "body": "<a id='comment:3'></a>\nOK, now std=c99 should be enforced in ECL, too.",
    "created_at": "2020-06-12T08:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330482",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
OK, now std=c99 should be enforced in ECL, too.



---

archive/issue_events_198460.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-12T08:27:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198460"
}
```



---

archive/issue_events_198461.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-12T08:27:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198461"
}
```



---

archive/issue_comments_330483.json:
```json
{
    "body": "<a id='comment:195'></a>\nReplying to [dimpase](#comment%3A191):\n> ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ? \n\nWell, as ECL is not using automake, I guess one cannot expect automake features such as being able to pass user CFLAGS to `make` without breaking things. \nSo one needs to set user CFLAGS before running `./configure`.",
    "created_at": "2020-06-12T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330483",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:195'></a>
Replying to [dimpase](#comment%3A191):
> ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ? 

Well, as ECL is not using automake, I guess one cannot expect automake features such as being able to pass user CFLAGS to `make` without breaking things. 
So one needs to set user CFLAGS before running `./configure`.



---

archive/issue_comments_330484.json:
```json
{
    "body": "<a id='comment:196'></a>\nReplying to [mkoeppe](#comment%3A195):\n> Replying to [dimpase](#comment%3A191):\n> > ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ? \n\n> Well, as ECL is not using automake, I guess one cannot expect automake features such as being able to pass user CFLAGS to `make` without breaking things. \n> So one needs to set user CFLAGS before running `./configure`.\n> \n\nanyhow \u200b89b006b\t does the job, it's more a question of improving ECL further.",
    "created_at": "2020-06-12T13:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330484",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:196'></a>
Replying to [mkoeppe](#comment%3A195):
> Replying to [dimpase](#comment%3A191):
> > ECL sets `CFLAGS` in its `c/Makefile.in` without taking `$CFLAGS` into account, only `@CFLAGS@`. What would be the correct setting? To take `$CFLAGS` in in `Makefile`, or in `./configure` ? 

> Well, as ECL is not using automake, I guess one cannot expect automake features such as being able to pass user CFLAGS to `make` without breaking things. 
> So one needs to set user CFLAGS before running `./configure`.
> 

anyhow ‚Äã89b006b	 does the job, it's more a question of improving ECL further.



---

archive/issue_comments_330485.json:
```json
{
    "body": "<a id='comment:7'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/133280249",
    "created_at": "2020-06-12T17:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330485",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/133280249



---

archive/issue_events_198462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-13T04:00:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198462"
}
```



---

archive/issue_events_198463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-13T04:00:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198463"
}
```



---

archive/issue_comments_330486.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooking good.",
    "created_at": "2020-06-13T04:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330486",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Looking good.



---

archive/issue_comments_330487.json:
```json
{
    "body": "<a id='comment:9'></a>\nOn Linux/macOS, that is.\n\nHowever, on Cygwin (https://github.com/mkoeppe/sage/runs/765619947), I am getting:\n\n```\n;; Compiling /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/numerical/slatec/dqawc.lisp.\n;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=2\n;;;\n;;; End of Pass 1.\n;;; Finished compiling /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/numerical/slatec/dqawc.lisp.\n;;;\n      1 [main] ecl 57306 child_info_fork::abort: address space needed by 'eclcTpROy.dll' (0x190000) is already occupied\nAn error occurred during initialization:\nCould not spawn subprocess to run \"gcc\"..\nmake[3]: *** [Makefile:1350: binary-ecl/maxima] Error 1\n```",
    "created_at": "2020-06-13T04:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330487",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
On Linux/macOS, that is.

However, on Cygwin (https://github.com/mkoeppe/sage/runs/765619947), I am getting:

```
;; Compiling /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/numerical/slatec/dqawc.lisp.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=2
;;;
;;; End of Pass 1.
;;; Finished compiling /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src/numerical/slatec/dqawc.lisp.
;;;
      1 [main] ecl 57306 child_info_fork::abort: address space needed by 'eclcTpROy.dll' (0x190000) is already occupied
An error occurred during initialization:
Could not spawn subprocess to run "gcc"..
make[3]: *** [Makefile:1350: binary-ecl/maxima] Error 1
```



---

archive/issue_events_198464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-13T04:06:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198464"
}
```



---

archive/issue_events_198465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-13T04:06:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198465"
}
```



---

archive/issue_comments_330488.json:
```json
{
    "body": "<a id='comment:1'></a>\nstrange. looks like a temporary dll created for some reason. Anyhow, this could come from a BLODA routine breaking Cygwin fork.",
    "created_at": "2020-06-13T09:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
strange. looks like a temporary dll created for some reason. Anyhow, this could come from a BLODA routine breaking Cygwin fork.



---

archive/issue_comments_330489.json:
```json
{
    "body": "<a id='comment:2'></a>\nDamn, looks like changes I made after we release tested on cygwin to fix compiler issues for msvc broke cygwin compilation. Merge request https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/216 contains a fix for that.",
    "created_at": "2020-06-13T09:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330489",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:2'></a>
Damn, looks like changes I made after we release tested on cygwin to fix compiler issues for msvc broke cygwin compilation. Merge request https://gitlab.com/embeddable-common-lisp/ecl/-/merge_requests/216 contains a fix for that.



---

archive/issue_comments_330490.json:
```json
{
    "body": "<a id='comment:3'></a>\nWe should be able to use `abs tol` to future-proof tests like these,\n\n```\n-            [0.5,0.55511151231257...e-14,21,0]\n+            [0.5,5.5511151231257...e-15,21,0]\n```\n\nMore generally, there are a lot of e.g. maxima tests that check for a particular output string when a boolean comparison `(actual == expected)` that checks for `True` would be more reliable. When we start accepting system installations of maxima this will become more annoying.",
    "created_at": "2020-06-13T12:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330490",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>
We should be able to use `abs tol` to future-proof tests like these,

```
-            [0.5,0.55511151231257...e-14,21,0]
+            [0.5,5.5511151231257...e-15,21,0]
```

More generally, there are a lot of e.g. maxima tests that check for a particular output string when a boolean comparison `(actual == expected)` that checks for `True` would be more reliable. When we start accepting system installations of maxima this will become more annoying.



---

archive/issue_comments_330491.json:
```json
{
    "body": "**Changing commit** from \"[89b006b106ca050240f580cb80d2a6320e5ade2e](https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e)\" to \"[0b777377289ba21166ea8d4f647e38e8b6ea1d23](https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23)\".",
    "created_at": "2020-06-13T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[89b006b106ca050240f580cb80d2a6320e5ade2e](https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e)" to "[0b777377289ba21166ea8d4f647e38e8b6ea1d23](https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23)".



---

archive/issue_comments_330492.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23\">0b77737</a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr></table>\n",
    "created_at": "2020-06-13T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23">0b77737</a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr></table>




---

archive/issue_comments_330493.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK, I've added this patch to the branch - however, on a Gentoo box I tried this branch (with and without the last commit) running Sage tests comes to a grinding halt due to a lot of zombie Maxima  processes eating up CPU and RAM.\n\nI wonder whether this is reproducible on a mainstream Linux.",
    "created_at": "2020-06-13T20:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330493",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
OK, I've added this patch to the branch - however, on a Gentoo box I tried this branch (with and without the last commit) running Sage tests comes to a grinding halt due to a lot of zombie Maxima  processes eating up CPU and RAM.

I wonder whether this is reproducible on a mainstream Linux.



---

archive/issue_comments_330494.json:
```json
{
    "body": "<a id='comment:6'></a>\n> it looks as if after a doctest crash (or perhaps even without one)\n> a running maxima process related to it does not always get cleaned up.\n> I don't know much about sage-cleaner script - but it is active during the test run.\n\n\nThanks goodness it turned out to be a red herring. Well, almost - I had an alive instance of\nsage-cleaner from a previous test, and starting a new test run did not clean it (which probably is a bug), so a new sage-cleaner didn't start, and the old one didn't do anything useful for the current test run.",
    "created_at": "2020-06-13T21:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330494",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
> it looks as if after a doctest crash (or perhaps even without one)
> a running maxima process related to it does not always get cleaned up.
> I don't know much about sage-cleaner script - but it is active during the test run.


Thanks goodness it turned out to be a red herring. Well, almost - I had an alive instance of
sage-cleaner from a previous test, and starting a new test run did not clean it (which probably is a bug), so a new sage-cleaner didn't start, and the old one didn't do anything useful for the current test run.



---

archive/issue_comments_330495.json:
```json
{
    "body": "<a id='comment:7'></a>\nCygwin test runs at https://github.com/mkoeppe/sage/actions/runs/134541665",
    "created_at": "2020-06-13T21:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330495",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Cygwin test runs at https://github.com/mkoeppe/sage/actions/runs/134541665



---

archive/issue_comments_330496.json:
```json
{
    "body": "<a id='comment:208'></a>\nReplying to [dimpase](#comment%3A205):\n> ... on a Gentoo box I tried this branch (with and without the last commit) running Sage tests ...\n\n\nOverdue to add Gentoo to our CI infrastructure ... #29105",
    "created_at": "2020-06-13T21:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330496",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:208'></a>
Replying to [dimpase](#comment%3A205):
> ... on a Gentoo box I tried this branch (with and without the last commit) running Sage tests ...


Overdue to add Gentoo to our CI infrastructure ... #29105



---

archive/issue_comments_330497.json:
```json
{
    "body": "<a id='comment:9'></a>\nit's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.\nYes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.\nAnything short of a custom image won't work, I think.",
    "created_at": "2020-06-13T21:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330497",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
it's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.
Yes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.
Anything short of a custom image won't work, I think.



---

archive/issue_comments_330498.json:
```json
{
    "body": "<a id='comment:210'></a>\nReplying to [dimpase](#comment%3A209):\n> it's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.\n> Yes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.\n\nThat's fine - why would that take longer than the 6h that our `-minimal` builds take? Presumably the image has the compilers already?",
    "created_at": "2020-06-13T22:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330498",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:210'></a>
Replying to [dimpase](#comment%3A209):
> it's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.
> Yes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.

That's fine - why would that take longer than the 6h that our `-minimal` builds take? Presumably the image has the compilers already?



---

archive/issue_comments_330499.json:
```json
{
    "body": "<a id='comment:211'></a>\nReplying to [mkoeppe](#comment%3A210):\n> Replying to [dimpase](#comment%3A209):\n> > it's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.\n> > Yes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.\n\n> That's fine - why would that take longer than the 6h that our `-minimal` builds take? Presumably the image has the compilers already?\n\nright, I presume it has some kind of a toolchain, but how can we talk about `-standard` builds?",
    "created_at": "2020-06-13T22:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330499",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:211'></a>
Replying to [mkoeppe](#comment%3A210):
> Replying to [dimpase](#comment%3A209):
> > it's not quite clear how to add Gentoo, which is meant to be built from source, from ground up.
> > Yes, one can get an image from https://hub.docker.com/r/gentoo/stage3-amd64/ - but adding Sage dependencies means building them from source.

> That's fine - why would that take longer than the 6h that our `-minimal` builds take? Presumably the image has the compilers already?

right, I presume it has some kind of a toolchain, but how can we talk about `-standard` builds?



---

archive/issue_events_198466.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-13T22:58:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198466"
}
```



---

archive/issue_events_198467.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-13T22:58:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198467"
}
```



---

archive/issue_comments_330500.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2020-06-13T23:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330500",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_330501.json:
```json
{
    "body": "<a id='comment:214'></a>\nReplying to [dimpase](#comment%3A211):\n> but how can we talk about `-standard` builds? \n\nSame as on all other platforms: We install system packages first - it does not make difference that they are built from source rather than downloaded as a binary.",
    "created_at": "2020-06-13T23:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330501",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:214'></a>
Replying to [dimpase](#comment%3A211):
> but how can we talk about `-standard` builds? 

Same as on all other platforms: We install system packages first - it does not make difference that they are built from source rather than downloaded as a binary.



---

archive/issue_comments_330502.json:
```json
{
    "body": "<a id='comment:5'></a>\nI vote for Fran\u00e7ois Bissey aka @kiwifb aka `@`kiwifb (solo contributor to `sage-on-gentoo`) to deal with gentoo-on-docker stuff (maybe by creating stage4-amd64 image, so only `sci-mathematics/sage` package would be built from source, and all the rest would come `FROM fbissey/sage-on-gentoo-stage4:latest`)",
    "created_at": "2020-06-14T05:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330502",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:5'></a>
I vote for Fran√ßois Bissey aka @kiwifb aka `@`kiwifb (solo contributor to `sage-on-gentoo`) to deal with gentoo-on-docker stuff (maybe by creating stage4-amd64 image, so only `sci-mathematics/sage` package would be built from source, and all the rest would come `FROM fbissey/sage-on-gentoo-stage4:latest`)



---

archive/issue_comments_330503.json:
```json
{
    "body": "<a id='comment:216'></a>\nReplying to [gh-sheerluck](#comment%3A215):\n> I vote for Fran\u00e7ois Bissey aka @kiwifb aka `@`kiwifb (solo contributor to `sage-on-gentoo`) to deal with gentoo-on-docker stuff (maybe by creating stage4-amd64 image, so only `sci-mathematics/sage` package would be built from source, and all the rest would come `FROM fbissey/sage-on-gentoo-stage4:latest`)\n\n\nThanks for nominating me :(\n\nBeing solo for most (but not all) of the last 12 years has not been without its ups and downs. I could even use the word burnout for a few periods. On top of that, I don't have an academic style position and I don't have all the time I would like. I am currently a one man eResearch department (doing solo must be my things - kidding we were almost ready to get me a collaborator when a change at the top lead to cancelling all ongoing hiring processes, even for stuff like me that have a truck factor of one). I currently have to deal with stuff like strategic planning, data management, cloud provisioning, HPCCF, carpentries... I sometimes call myself an undertaker. I do all the stuff other people don't want to do. There is a moment where you learn the word \"no\".\n\nSo, thank you very much but I would very much prefer a helper.",
    "created_at": "2020-06-14T07:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330503",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:216'></a>
Replying to [gh-sheerluck](#comment%3A215):
> I vote for Fran√ßois Bissey aka @kiwifb aka `@`kiwifb (solo contributor to `sage-on-gentoo`) to deal with gentoo-on-docker stuff (maybe by creating stage4-amd64 image, so only `sci-mathematics/sage` package would be built from source, and all the rest would come `FROM fbissey/sage-on-gentoo-stage4:latest`)


Thanks for nominating me :(

Being solo for most (but not all) of the last 12 years has not been without its ups and downs. I could even use the word burnout for a few periods. On top of that, I don't have an academic style position and I don't have all the time I would like. I am currently a one man eResearch department (doing solo must be my things - kidding we were almost ready to get me a collaborator when a change at the top lead to cancelling all ongoing hiring processes, even for stuff like me that have a truck factor of one). I currently have to deal with stuff like strategic planning, data management, cloud provisioning, HPCCF, carpentries... I sometimes call myself an undertaker. I do all the stuff other people don't want to do. There is a moment where you learn the word "no".

So, thank you very much but I would very much prefer a helper.



---

archive/issue_comments_330504.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks for all you do Fran\u00e7ois. I don't even want to think about how much harder it would be to maintain sage in nixpkgs without all your work. I can attest that solo-maintaining sage can be a bunch some times. sage on nixpkgs is still stuck to 8.9 due to the not-quite-py3 switch in 9.0.\n\nSorry for derailing the topic further, but sometimes a thanks is in order. Thanks.",
    "created_at": "2020-06-14T11:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330504",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>
Thanks for all you do Fran√ßois. I don't even want to think about how much harder it would be to maintain sage in nixpkgs without all your work. I can attest that solo-maintaining sage can be a bunch some times. sage on nixpkgs is still stuck to 8.9 due to the not-quite-py3 switch in 9.0.

Sorry for derailing the topic further, but sometimes a thanks is in order. Thanks.



---

archive/issue_comments_330505.json:
```json
{
    "body": "<a id='comment:8'></a>\nFurther discussion of extending the CI to Gentoo please on #29105.\nThe corresponding ticket for nixpkgs is #29130.",
    "created_at": "2020-06-14T12:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330505",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Further discussion of extending the CI to Gentoo please on #29105.
The corresponding ticket for nixpkgs is #29130.



---

archive/issue_comments_330506.json:
```json
{
    "body": "<a id='comment:219'></a>\nReplying to [mkoeppe](#comment%3A207):\n> Cygwin test runs at https://github.com/mkoeppe/sage/actions/runs/134541665\n\nMaxima now succeeds to build on Cygwin (stage-ii-b, https://github.com/mkoeppe/sage/runs/768953492), but the Sage testsuite (stage-iv-a) fails with various Maxima-related errors. (There are also many GIAC-related failures, but that's for another ticket)\n\n```\nsage -t src/doc/en/constructions/plotting.rst  # 3 doctests failed\nsage -t src/doc/en/tutorial/tour_algebra.rst  # 2 doctests failed\nsage -t src/doc/ja/tutorial/interfaces.rst  # Timed out\nsage -t src/doc/ru/tutorial/tour_algebra.rst  # 2 doctests failed\nsage -t src/doc/ru/tutorial/interfaces.rst  # 7 doctests failed\nsage -t src/sage/calculus/desolvers.py  # 1 doctest failed\nsage -t src/sage/coding/binary_code.pyx  # Timed out\nsage -t src/sage/doctest/control.py  # 1 doctest failed\nsage -t src/sage/functions/error.py  # 1 doctest failed\nsage -t src/sage/functions/orthogonal_polys.py  # 2 doctests failed\nsage -t src/sage/groups/class_function.py  # Timed out\nsage -t src/sage/interfaces/giac.py  # 49 doctests failed\nsage -t src/sage/interfaces/quit.py  # 4 doctests failed\nsage -t src/sage/interfaces/maxima_abstract.py  # 3 doctests failed\nsage -t src/sage/libs/gap/element.pyx  # 1 doctest failed\nsage -t src/sage/libs/glpk/error.pyx  # 2 doctests failed\nsage -t src/sage/matrix/matrix1.pyx  # 1 doctest failed\nsage -t src/sage/numerical/backends/glpk_backend.pyx  # 2 doctests failed\nsage -t src/sage/repl/interpreter.py  # 2 doctests failed\nsage -t src/sage/rings/number_field/number_field_element.pyx  # Timed out\nsage -t src/sage/symbolic/assumptions.py  # 1 doctest failed\nsage -t src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t src/sage/symbolic/maxima_wrapper.py  # 2 doctests failed\nsage -t src/sage/tests/benchmark.py  # 1 doctest failed\nsage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py  # 1 doctest failed\nsage -t src/sage/tests/cmdline.py  # 3 doctests failed\n```\n\nExamples of the errors (see logs for more):\n\n```\nsage -t src/sage/functions/error.py\n**********************************************************************\nFile \"src/sage/functions/error.py\", line 149, in sage.functions.error.Function_erf\nFailed example:\n    merf = maxima(erf(x)).sage().operator()\nExpected nothing\nGot:\n    Maxima crashed -- automatically restarting.\n\n\nsage -t src/sage/functions/orthogonal_polys.py\n**********************************************************************\nFile \"src/sage/functions/orthogonal_polys.py\", line 876, in sage.functions.orthogonal_polys.Func_chebyshev_U.__init__\nFailed example:\n    maxima(chebyshev_U(2,x, hold=True))\nException raised:\n...\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 296, in __call__\n        return cls(self, x, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1157, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1469, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 501, in _create\n        self.set(name, value)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1002, in set\n        self._eval_line(cmd)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 788, in _eval_line\n        assert line_echo.strip().endswith(line.strip()), 'mismatch:\\n' + line_echo + line\n    AssertionError: mismatch:\n    \n    sage5 : chebyshev_u(2,_SAGE_VAR_x)$\n```",
    "created_at": "2020-06-14T13:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330506",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:219'></a>
Replying to [mkoeppe](#comment%3A207):
> Cygwin test runs at https://github.com/mkoeppe/sage/actions/runs/134541665

Maxima now succeeds to build on Cygwin (stage-ii-b, https://github.com/mkoeppe/sage/runs/768953492), but the Sage testsuite (stage-iv-a) fails with various Maxima-related errors. (There are also many GIAC-related failures, but that's for another ticket)

```
sage -t src/doc/en/constructions/plotting.rst  # 3 doctests failed
sage -t src/doc/en/tutorial/tour_algebra.rst  # 2 doctests failed
sage -t src/doc/ja/tutorial/interfaces.rst  # Timed out
sage -t src/doc/ru/tutorial/tour_algebra.rst  # 2 doctests failed
sage -t src/doc/ru/tutorial/interfaces.rst  # 7 doctests failed
sage -t src/sage/calculus/desolvers.py  # 1 doctest failed
sage -t src/sage/coding/binary_code.pyx  # Timed out
sage -t src/sage/doctest/control.py  # 1 doctest failed
sage -t src/sage/functions/error.py  # 1 doctest failed
sage -t src/sage/functions/orthogonal_polys.py  # 2 doctests failed
sage -t src/sage/groups/class_function.py  # Timed out
sage -t src/sage/interfaces/giac.py  # 49 doctests failed
sage -t src/sage/interfaces/quit.py  # 4 doctests failed
sage -t src/sage/interfaces/maxima_abstract.py  # 3 doctests failed
sage -t src/sage/libs/gap/element.pyx  # 1 doctest failed
sage -t src/sage/libs/glpk/error.pyx  # 2 doctests failed
sage -t src/sage/matrix/matrix1.pyx  # 1 doctest failed
sage -t src/sage/numerical/backends/glpk_backend.pyx  # 2 doctests failed
sage -t src/sage/repl/interpreter.py  # 2 doctests failed
sage -t src/sage/rings/number_field/number_field_element.pyx  # Timed out
sage -t src/sage/symbolic/assumptions.py  # 1 doctest failed
sage -t src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t src/sage/symbolic/maxima_wrapper.py  # 2 doctests failed
sage -t src/sage/tests/benchmark.py  # 1 doctest failed
sage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py  # 1 doctest failed
sage -t src/sage/tests/cmdline.py  # 3 doctests failed
```

Examples of the errors (see logs for more):

```
sage -t src/sage/functions/error.py
**********************************************************************
File "src/sage/functions/error.py", line 149, in sage.functions.error.Function_erf
Failed example:
    merf = maxima(erf(x)).sage().operator()
Expected nothing
Got:
    Maxima crashed -- automatically restarting.


sage -t src/sage/functions/orthogonal_polys.py
**********************************************************************
File "src/sage/functions/orthogonal_polys.py", line 876, in sage.functions.orthogonal_polys.Func_chebyshev_U.__init__
Failed example:
    maxima(chebyshev_U(2,x, hold=True))
Exception raised:
...
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 296, in __call__
        return cls(self, x, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1157, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1469, in __init__
        self._name = parent._create(value, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 501, in _create
        self.set(name, value)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1002, in set
        self._eval_line(cmd)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 788, in _eval_line
        assert line_echo.strip().endswith(line.strip()), 'mismatch:\n' + line_echo + line
    AssertionError: mismatch:
    
    sage5 : chebyshev_u(2,_SAGE_VAR_x)$
```



---

archive/issue_events_198468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T13:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198468"
}
```



---

archive/issue_events_198469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T13:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198469"
}
```



---

archive/issue_comments_330507.json:
```json
{
    "body": "<a id='comment:1'></a>\nthis shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows?",
    "created_at": "2020-06-15T08:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330507",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
this shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows?



---

archive/issue_comments_330508.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe workflow for Cygwin does not use Docker. There is a \"sage-local\" artifact that one can download.",
    "created_at": "2020-06-15T14:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
The workflow for Cygwin does not use Docker. There is a "sage-local" artifact that one can download.



---

archive/issue_comments_330509.json:
```json
{
    "body": "<a id='comment:3'></a>\nTrying to compile sage 9.1 with ECL 20.4.24 and Maxima 5.44.0 as external packages produces these errors:\n\n\n```\nbuild/cythonized/sage/libs/ecl.c:3734:57: error: use of undeclared identifier 'ECL_OPT_TRAP_SIGCHLD'; did you mean 'ECL_OPT_TRAP_SIGILL'?\n  __pyx_t_3 = __Pyx_PyInt_From_cl_fixnum(ecl_get_option(ECL_OPT_TRAP_SIGCHLD)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 180, __pyx_L1_error)\n                                                        ^~~~~~~~~~~~~~~~~~~~\n                                                        ECL_OPT_TRAP_SIGILL\n/usr/local/include/ecl/external.h:972:9: note: 'ECL_OPT_TRAP_SIGILL' declared here\n        ECL_OPT_TRAP_SIGILL,\n        ^\nbuild/cythonized/sage/libs/ecl.c:4406:57: error: use of undeclared identifier 'ECL_OPT_SIGALTSTACK_SIZE'\n  __pyx_t_3 = __Pyx_PyInt_From_cl_fixnum(ecl_get_option(ECL_OPT_SIGALTSTACK_SIZE)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 208, __pyx_L1_error)\n                                                        ^\nbuild/cythonized/sage/libs/ecl.c:4731:18: error: use of undeclared identifier 'ECL_OPT_TRAP_SIGCHLD'; did you mean 'ECL_OPT_TRAP_SIGILL'?\n  ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0);\n                 ^~~~~~~~~~~~~~~~~~~~\n                 ECL_OPT_TRAP_SIGILL\n/usr/local/include/ecl/external.h:972:9: note: 'ECL_OPT_TRAP_SIGILL' declared here\n        ECL_OPT_TRAP_SIGILL,\n        ^\n3 errors generated.\n\n```",
    "created_at": "2020-06-18T16:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330509",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:3'></a>
Trying to compile sage 9.1 with ECL 20.4.24 and Maxima 5.44.0 as external packages produces these errors:


```
build/cythonized/sage/libs/ecl.c:3734:57: error: use of undeclared identifier 'ECL_OPT_TRAP_SIGCHLD'; did you mean 'ECL_OPT_TRAP_SIGILL'?
  __pyx_t_3 = __Pyx_PyInt_From_cl_fixnum(ecl_get_option(ECL_OPT_TRAP_SIGCHLD)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 180, __pyx_L1_error)
                                                        ^~~~~~~~~~~~~~~~~~~~
                                                        ECL_OPT_TRAP_SIGILL
/usr/local/include/ecl/external.h:972:9: note: 'ECL_OPT_TRAP_SIGILL' declared here
        ECL_OPT_TRAP_SIGILL,
        ^
build/cythonized/sage/libs/ecl.c:4406:57: error: use of undeclared identifier 'ECL_OPT_SIGALTSTACK_SIZE'
  __pyx_t_3 = __Pyx_PyInt_From_cl_fixnum(ecl_get_option(ECL_OPT_SIGALTSTACK_SIZE)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 208, __pyx_L1_error)
                                                        ^
build/cythonized/sage/libs/ecl.c:4731:18: error: use of undeclared identifier 'ECL_OPT_TRAP_SIGCHLD'; did you mean 'ECL_OPT_TRAP_SIGILL'?
  ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0);
                 ^~~~~~~~~~~~~~~~~~~~
                 ECL_OPT_TRAP_SIGILL
/usr/local/include/ecl/external.h:972:9: note: 'ECL_OPT_TRAP_SIGILL' declared here
        ECL_OPT_TRAP_SIGILL,
        ^
3 errors generated.

```



---

archive/issue_comments_330510.json:
```json
{
    "body": "<a id='comment:4'></a>\nSeems already addressed by https://github.com/sagemath/sagetrac-mirror/commit/7250c3cd7368aaf27705c2dabe09a01e37fbd284",
    "created_at": "2020-06-18T17:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330510",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:4'></a>
Seems already addressed by https://github.com/sagemath/sagetrac-mirror/commit/7250c3cd7368aaf27705c2dabe09a01e37fbd284



---

archive/issue_comments_330511.json:
```json
{
    "body": "<a id='comment:225'></a>\nReplying to [dimpase](#comment%3A221):\n> this shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows? \n\n\nHas this been reported upstream?",
    "created_at": "2020-06-18T17:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330511",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:225'></a>
Replying to [dimpase](#comment%3A221):
> this shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows? 


Has this been reported upstream?



---

archive/issue_comments_330512.json:
```json
{
    "body": "<a id='comment:226'></a>\nReplying to [mkoeppe](#comment%3A225):\n> Replying to [dimpase](#comment%3A221):\n> > this shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows? \n\n> \n> Has this been reported upstream?\n\n\ngh-spaghettisalat (a.k.a. Marius) is a core upstream developer - but just in case I made\nhttps://gitlab.com/embeddable-common-lisp/ecl/-/issues/599",
    "created_at": "2020-06-18T19:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330512",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:226'></a>
Replying to [mkoeppe](#comment%3A225):
> Replying to [dimpase](#comment%3A221):
> > this shoud be easy to reproduce without Sage. Is there a Docker container created by GH Actions to download and try on Windows? 

> 
> Has this been reported upstream?


gh-spaghettisalat (a.k.a. Marius) is a core upstream developer - but just in case I made
https://gitlab.com/embeddable-common-lisp/ecl/-/issues/599



---

archive/issue_comments_330513.json:
```json
{
    "body": "<a id='comment:7'></a>\nCompiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite. Running the tests manually works fine. Running against system ecl used to work fine with the version of this branch pre-20.04 upgrade\n\n```\n/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x729d)[0x7f803914129d]\n/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x748c)[0x7f803914148c]\n/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x9f05)[0x7f8039143f05]\n/usr/lib/libc.so.6(+0x3c3e0)[0x7f803a6ad3e0]\n/usr/lib/libecl.so.20.4(ecl_extend_hashtable+0x11a)[0x7f7fdc1d55da]\n/usr/lib/libecl.so.20.4(+0x203947)[0x7f7fdc1d5947]\n/usr/lib/libecl.so.20.4(cl_export2+0x36c)[0x7f7fdc176aac]\n/usr/lib/libecl.so.20.4(init_all_symbols+0x29c)[0x7f7fdc071cec]\n/usr/lib/libecl.so.20.4(cl_boot+0x433)[0x7f7fdc0709c3]\n/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0xc85e)[0x7f7fdc4f585e]\n/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0xa9f4)[0x7f7fdc4f39f4]\n/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0x81b0)[0x7f7fdc4f11b0]\n/usr/lib/libpython3.8.so.1.0(PyModule_ExecDef+0x78)[0x7f803aa06ae8]\n/usr/lib/libpython3.8.so.1.0(+0x1cea50)[0x7f803aa06a50]\n/usr/lib/libpython3.8.so.1.0(+0x12dd9f)[0x7f803a965d9f]\n/usr/lib/libpython3.8.so.1.0(PyVectorcall_Call+0x6f)[0x7f803a976a7f]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x601a)[0x7f803a95b98a]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(+0x12e02f)[0x7f803a96602f]\n/usr/lib/libpython3.8.so.1.0(_PyObject_CallMethodIdObjArgs+0x126)[0x7f803a979136]\n/usr/lib/libpython3.8.so.1.0(PyImport_ImportModuleLevelObject+0x4c0)[0x7f803a977e20]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x469a)[0x7f803a95a00a]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]\n/usr/lib/libpython3.8.so.1.0(+0x1d1e0d)[0x7f803aa09e0d]\n/usr/lib/libpython3.8.so.1.0(+0x12f098)[0x7f803a967098]\n/usr/lib/libpython3.8.so.1.0(PyVectorcall_Call+0x6f)[0x7f803a976a7f]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x601a)[0x7f803a95b98a]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(+0x12e02f)[0x7f803a96602f]\n/usr/lib/libpython3.8.so.1.0(_PyObject_CallMethodIdObjArgs+0x126)[0x7f803a979136]\n/usr/lib/libpython3.8.so.1.0(PyImport_ImportModuleLevelObject+0x4c0)[0x7f803a977e20]\n/usr/lib/libpython3.8.so.1.0(+0x165b18)[0x7f803a99db18]\n/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]\n/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0x7e6a)[0x7f80393abe6a]\n/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0xc5f4)[0x7f80393b05f4]\n/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0x12f31)[0x7f80393b6f31]\n/usr/lib/python3.8/site-packages/sage/structure/sage_object.cpython-38-x86_64-linux-gnu.so(+0x16343)[0x7f8039d9d343]\n/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x3495b)[0x7f7fe6dc795b]\n/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x3df9e)[0x7f7fe6dd0f9e]\n/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]\n/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x325f7)[0x7f7fe6dc55f7]\n/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x36733)[0x7f7fe6dc9733]\n/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]\n/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x5108)[0x7f803a95aa78]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_FastCallDict+0x1f6)[0x7f803a91a392]\n/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x564f2)[0x7f7fe6de94f2]\n/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]\n/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x5108)[0x7f803a95aa78]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xc274)[0x7f80388a3274]\n/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xd4aa)[0x7f80388a44aa]\n/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xfdd6)[0x7f80388a6dd6]\n/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0x339ff)[0x7f80388ca9ff]\n/usr/lib/libpython3.8.so.1.0(+0x1965af)[0x7f803a9ce5af]\n/usr/lib/python3.8/site-packages/sage/rings/integer_ring.cpython-38-x86_64-linux-gnu.so(+0x16fc7)[0x7f7ffe8ccfc7]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0xb2b)[0x7f803a95649b]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]\n/usr/lib/libpython3.8.so.1.0(+0x1d1e0d)[0x7f803aa09e0d]\n/usr/lib/libpython3.8.so.1.0(+0x12f098)[0x7f803a967098]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(_PyObject_FastCallDict+0x225)[0x7f803a95e635]\n/usr/lib/libpython3.8.so.1.0(_PyObject_Call_Prepend+0x63)[0x7f803a971c13]\n/usr/lib/libpython3.8.so.1.0(+0x1f5e09)[0x7f803aa2de09]\n/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4bf4)[0x7f803a95a564]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(+0x13e442)[0x7f803a976442]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x117b)[0x7f803a956aeb]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyObject_FastCallDict+0x15e)[0x7f803a95e56e]\n/usr/lib/libpython3.8.so.1.0(+0x139824)[0x7f803a971824]\n/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x500)[0x7f803a95f230]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4bf4)[0x7f803a95a564]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]\n/usr/lib/libpython3.8.so.1.0(+0x13e356)[0x7f803a976356]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x7fa)[0x7f803a954b4a]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]\n/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]\n/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]\n/usr/lib/libpython3.8.so.1.0(+0x1d8248)[0x7f803aa10248]\n/usr/lib/libpython3.8.so.1.0(+0x1d2483)[0x7f803aa0a483]\n/usr/lib/libpython3.8.so.1.0(PyRun_FileExFlags+0x97)[0x7f803a8ca3f8]\n/usr/lib/libpython3.8.so.1.0(PyRun_SimpleFileExFlags+0x389)[0x7f803a8c9e8a]\n/usr/lib/libpython3.8.so.1.0(Py_RunMain+0x502)[0x7f803aa1d1e2]\n/usr/lib/libpython3.8.so.1.0(Py_BytesMain+0x39)[0x7f803a9f93d9]\n/usr/lib/libc.so.6(__libc_start_main+0xf2)[0x7f803a698002]\n/bin/python3(_start+0x2e)[0x5611ca37504e]\n```",
    "created_at": "2020-06-22T20:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330513",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>
Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite. Running the tests manually works fine. Running against system ecl used to work fine with the version of this branch pre-20.04 upgrade

```
/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x729d)[0x7f803914129d]
/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x748c)[0x7f803914148c]
/usr/lib/python3.8/site-packages/cysignals/signals.cpython-38-x86_64-linux-gnu.so(+0x9f05)[0x7f8039143f05]
/usr/lib/libc.so.6(+0x3c3e0)[0x7f803a6ad3e0]
/usr/lib/libecl.so.20.4(ecl_extend_hashtable+0x11a)[0x7f7fdc1d55da]
/usr/lib/libecl.so.20.4(+0x203947)[0x7f7fdc1d5947]
/usr/lib/libecl.so.20.4(cl_export2+0x36c)[0x7f7fdc176aac]
/usr/lib/libecl.so.20.4(init_all_symbols+0x29c)[0x7f7fdc071cec]
/usr/lib/libecl.so.20.4(cl_boot+0x433)[0x7f7fdc0709c3]
/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0xc85e)[0x7f7fdc4f585e]
/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0xa9f4)[0x7f7fdc4f39f4]
/usr/lib/python3.8/site-packages/sage/libs/ecl.cpython-38-x86_64-linux-gnu.so(+0x81b0)[0x7f7fdc4f11b0]
/usr/lib/libpython3.8.so.1.0(PyModule_ExecDef+0x78)[0x7f803aa06ae8]
/usr/lib/libpython3.8.so.1.0(+0x1cea50)[0x7f803aa06a50]
/usr/lib/libpython3.8.so.1.0(+0x12dd9f)[0x7f803a965d9f]
/usr/lib/libpython3.8.so.1.0(PyVectorcall_Call+0x6f)[0x7f803a976a7f]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x601a)[0x7f803a95b98a]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(+0x12e02f)[0x7f803a96602f]
/usr/lib/libpython3.8.so.1.0(_PyObject_CallMethodIdObjArgs+0x126)[0x7f803a979136]
/usr/lib/libpython3.8.so.1.0(PyImport_ImportModuleLevelObject+0x4c0)[0x7f803a977e20]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x469a)[0x7f803a95a00a]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]
/usr/lib/libpython3.8.so.1.0(+0x1d1e0d)[0x7f803aa09e0d]
/usr/lib/libpython3.8.so.1.0(+0x12f098)[0x7f803a967098]
/usr/lib/libpython3.8.so.1.0(PyVectorcall_Call+0x6f)[0x7f803a976a7f]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x601a)[0x7f803a95b98a]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(+0x12e02f)[0x7f803a96602f]
/usr/lib/libpython3.8.so.1.0(_PyObject_CallMethodIdObjArgs+0x126)[0x7f803a979136]
/usr/lib/libpython3.8.so.1.0(PyImport_ImportModuleLevelObject+0x4c0)[0x7f803a977e20]
/usr/lib/libpython3.8.so.1.0(+0x165b18)[0x7f803a99db18]
/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]
/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0x7e6a)[0x7f80393abe6a]
/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0xc5f4)[0x7f80393b05f4]
/usr/lib/python3.8/site-packages/sage/misc/lazy_import.cpython-38-x86_64-linux-gnu.so(+0x12f31)[0x7f80393b6f31]
/usr/lib/python3.8/site-packages/sage/structure/sage_object.cpython-38-x86_64-linux-gnu.so(+0x16343)[0x7f8039d9d343]
/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x3495b)[0x7f7fe6dc795b]
/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x3df9e)[0x7f7fe6dd0f9e]
/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]
/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x325f7)[0x7f7fe6dc55f7]
/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x36733)[0x7f7fe6dc9733]
/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]
/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x5108)[0x7f803a95aa78]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(_PyFunction_FastCallDict+0x1f6)[0x7f803a91a392]
/usr/lib/python3.8/site-packages/sage/symbolic/expression.cpython-38-x86_64-linux-gnu.so(+0x564f2)[0x7f7fe6de94f2]
/usr/lib/libpython3.8.so.1.0(PyCFunction_Call+0x7e)[0x7f803a96c8ce]
/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x5108)[0x7f803a95aa78]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xc274)[0x7f80388a3274]
/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xd4aa)[0x7f80388a44aa]
/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0xfdd6)[0x7f80388a6dd6]
/usr/lib/python3.8/site-packages/sage/structure/parent.cpython-38-x86_64-linux-gnu.so(+0x339ff)[0x7f80388ca9ff]
/usr/lib/libpython3.8.so.1.0(+0x1965af)[0x7f803a9ce5af]
/usr/lib/python3.8/site-packages/sage/rings/integer_ring.cpython-38-x86_64-linux-gnu.so(+0x16fc7)[0x7f7ffe8ccfc7]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0xb2b)[0x7f803a95649b]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]
/usr/lib/libpython3.8.so.1.0(+0x1d1e0d)[0x7f803aa09e0d]
/usr/lib/libpython3.8.so.1.0(+0x12f098)[0x7f803a967098]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x398)[0x7f803a955d08]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(_PyObject_FastCallDict+0x225)[0x7f803a95e635]
/usr/lib/libpython3.8.so.1.0(_PyObject_Call_Prepend+0x63)[0x7f803a971c13]
/usr/lib/libpython3.8.so.1.0(+0x1f5e09)[0x7f803aa2de09]
/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x45c)[0x7f803a95f18c]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4bf4)[0x7f803a95a564]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(+0x13e442)[0x7f803a976442]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x117b)[0x7f803a956aeb]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyObject_FastCallDict+0x15e)[0x7f803a95e56e]
/usr/lib/libpython3.8.so.1.0(+0x139824)[0x7f803a971824]
/usr/lib/libpython3.8.so.1.0(_PyObject_MakeTpCall+0x500)[0x7f803a95f230]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4bf4)[0x7f803a95a564]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]
/usr/lib/libpython3.8.so.1.0(+0x13e356)[0x7f803a976356]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x4cc5)[0x7f803a95a635]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x7fa)[0x7f803a954b4a]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0xa22)[0x7f803a954d72]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x19d)[0x7f803a96687d]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyFunction_Vectorcall+0x108)[0x7f803a9667e8]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalFrameDefault+0x761)[0x7f803a9560d1]
/usr/lib/libpython3.8.so.1.0(_PyEval_EvalCodeWithName+0x304)[0x7f803a954654]
/usr/lib/libpython3.8.so.1.0(PyEval_EvalCode+0x23)[0x7f803aa04b03]
/usr/lib/libpython3.8.so.1.0(+0x1d8248)[0x7f803aa10248]
/usr/lib/libpython3.8.so.1.0(+0x1d2483)[0x7f803aa0a483]
/usr/lib/libpython3.8.so.1.0(PyRun_FileExFlags+0x97)[0x7f803a8ca3f8]
/usr/lib/libpython3.8.so.1.0(PyRun_SimpleFileExFlags+0x389)[0x7f803a8c9e8a]
/usr/lib/libpython3.8.so.1.0(Py_RunMain+0x502)[0x7f803aa1d1e2]
/usr/lib/libpython3.8.so.1.0(Py_BytesMain+0x39)[0x7f803a9f93d9]
/usr/lib/libc.so.6(__libc_start_main+0xf2)[0x7f803a698002]
/bin/python3(_start+0x2e)[0x5611ca37504e]
```



---

archive/issue_comments_330514.json:
```json
{
    "body": "<a id='comment:8'></a>\nwhat will happen if you replace `--disable-threads` in the line\n`sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \\` of ecl's `spkg-install.in`\nwith `--enable-threads=yes` ?",
    "created_at": "2020-06-22T21:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330514",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
what will happen if you replace `--disable-threads` in the line
`sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \` of ecl's `spkg-install.in`
with `--enable-threads=yes` ?



---

archive/issue_comments_330515.json:
```json
{
    "body": "<a id='comment:229'></a>\nReplying to [arojas](#comment%3A227):\n> Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite. Running the tests manually works fine. Running against system ecl used to work fine with the version of this branch pre-20.04 upgrade\n\n\nAdding to the old patch only the build fixes required to compile against 20.4 (ie ECL_OPT_TRAP_SIGCHLD etc removal) makes it work fine without segfaults. So some of the later modifications to the patch is causing this, will try to figure out which (doesn't look easy since the older commit history seems to be gone)",
    "created_at": "2020-06-23T12:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330515",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:229'></a>
Replying to [arojas](#comment%3A227):
> Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite. Running the tests manually works fine. Running against system ecl used to work fine with the version of this branch pre-20.04 upgrade


Adding to the old patch only the build fixes required to compile against 20.4 (ie ECL_OPT_TRAP_SIGCHLD etc removal) makes it work fine without segfaults. So some of the later modifications to the patch is causing this, will try to figure out which (doesn't look easy since the older commit history seems to be gone)



---

archive/issue_comments_330516.json:
```json
{
    "body": "<a id='comment:230'></a>\nReplying to [dimpase](#comment%3A228):\n> what will happen if you replace `--disable-threads` in the line\n> `sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \\` of ecl's `spkg-install.in`\n> with `--enable-threads=yes` ?\n\n\nNot sure I understand - this is about distro packages, are you asking to test with sage's bundled ecl package built with threads? (FTR, the segfaults are not reproducible when using system ecl built without threads, so I expect they will happen with sage's ecl if it's built with threads)",
    "created_at": "2020-06-23T12:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330516",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:230'></a>
Replying to [dimpase](#comment%3A228):
> what will happen if you replace `--disable-threads` in the line
> `sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \` of ecl's `spkg-install.in`
> with `--enable-threads=yes` ?


Not sure I understand - this is about distro packages, are you asking to test with sage's bundled ecl package built with threads? (FTR, the segfaults are not reproducible when using system ecl built without threads, so I expect they will happen with sage's ecl if it's built with threads)



---

archive/issue_comments_330517.json:
```json
{
    "body": "<a id='comment:231'></a>\nReplying to [arojas](#comment%3A230):\n> Replying to [dimpase](#comment%3A228):\n> > what will happen if you replace `--disable-threads` in the line\n> > `sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \\` of ecl's `spkg-install.in`\n> > with `--enable-threads=yes` ?\n\n> \n> Not sure I understand - this is about distro packages, are you asking to test with sage's bundled ecl package built with threads? (FTR, the segfaults are not reproducible when using system ecl built without threads, so I expect they will happen with sage's ecl if it's built with threads)\n\n\nOK, sorry, I misunderstood what you were testing. \nRegarding multithreaded ECL 20.4.24 that you say you have a working version from an \"old\" branch, are you referring to\nhttps://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update\nor some other branch?",
    "created_at": "2020-06-23T13:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330517",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:231'></a>
Replying to [arojas](#comment%3A230):
> Replying to [dimpase](#comment%3A228):
> > what will happen if you replace `--disable-threads` in the line
> > `sdh_configure $SAGE_CONFIGURE_GMP --disable-threads \` of ecl's `spkg-install.in`
> > with `--enable-threads=yes` ?

> 
> Not sure I understand - this is about distro packages, are you asking to test with sage's bundled ecl package built with threads? (FTR, the segfaults are not reproducible when using system ecl built without threads, so I expect they will happen with sage's ecl if it's built with threads)


OK, sorry, I misunderstood what you were testing. 
Regarding multithreaded ECL 20.4.24 that you say you have a working version from an "old" branch, are you referring to
https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update
or some other branch?



---

archive/issue_comments_330518.json:
```json
{
    "body": "<a id='comment:232'></a>\nReplying to [dimpase](#comment%3A231):\n> OK, sorry, I misunderstood what you were testing. \n> Regarding multithreaded ECL 20.4.24 that you say you have a working version from an \"old\" branch, are you referring to\n> https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update\n> or some other branch?\n\n\nI mean the 'public/ticket-22191' branch that was attached to this ticket previously. To sum up:\n\nwith the current 'public/packages/ecl20' tests segfault if ecl is built with threads, work fine if ecl is built without threads\n\nwith the 'public/ticket-22191' plus the ECL_OPT_TRAP_SIGCHLD-removal part of this patch, there are no segfaults with ecl built with threads.",
    "created_at": "2020-06-23T14:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330518",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:232'></a>
Replying to [dimpase](#comment%3A231):
> OK, sorry, I misunderstood what you were testing. 
> Regarding multithreaded ECL 20.4.24 that you say you have a working version from an "old" branch, are you referring to
> https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update
> or some other branch?


I mean the 'public/ticket-22191' branch that was attached to this ticket previously. To sum up:

with the current 'public/packages/ecl20' tests segfault if ecl is built with threads, work fine if ecl is built without threads

with the 'public/ticket-22191' plus the ECL_OPT_TRAP_SIGCHLD-removal part of this patch, there are no segfaults with ecl built with threads.



---

archive/issue_comments_330519.json:
```json
{
    "body": "<a id='comment:3'></a>\nThere are two different types of error: some modules fail with `Unhandled SIGFPE` which kills the tests run. Those are fixed if I change `safe_cl_boot(1, argv)` back to `cl_boot(1, argv)`.\n\nFor other modules, I get a `FloatingPointError: Floating point exception` for some tests, but the remaining tests are run. \n\nBoth are only reproducible when running the test suite, and work fine when the relevant code is run in a regular Sage session",
    "created_at": "2020-06-23T18:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330519",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:3'></a>
There are two different types of error: some modules fail with `Unhandled SIGFPE` which kills the tests run. Those are fixed if I change `safe_cl_boot(1, argv)` back to `cl_boot(1, argv)`.

For other modules, I get a `FloatingPointError: Floating point exception` for some tests, but the remaining tests are run. 

Both are only reproducible when running the test suite, and work fine when the relevant code is run in a regular Sage session



---

archive/issue_comments_330520.json:
```json
{
    "body": "<a id='comment:234'></a>\nReplying to [arojas](#comment%3A232):\n> Replying to [dimpase](#comment%3A231):\n> > OK, sorry, I misunderstood what you were testing. \n> > Regarding multithreaded ECL 20.4.24 that you say you have a working version from an \"old\" branch, are you referring to\n> > https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update\n> > or some other branch?\n\n> \n> I mean the 'public/ticket-22191' branch that was attached to this ticket previously. To sum up:\n> \n> with the current 'public/packages/ecl20' tests segfault if ecl is built with threads, work fine if ecl is built without threads\n> \n> with the 'public/ticket-22191' \n\n\nthis branch was for ECL 16.1.3, thus it is not clear to me which multithreadef ECL  you tested.\n\nIn any case I hope gh-spaghettisalad knows what is going on, I bet it has to do with fork() called by the doctesting framework.",
    "created_at": "2020-06-23T19:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330520",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:234'></a>
Replying to [arojas](#comment%3A232):
> Replying to [dimpase](#comment%3A231):
> > OK, sorry, I misunderstood what you were testing. 
> > Regarding multithreaded ECL 20.4.24 that you say you have a working version from an "old" branch, are you referring to
> > https://github.com/sagemath/sagetrac-mirror/tree/u/gh-spaghettisalat/ecl-update
> > or some other branch?

> 
> I mean the 'public/ticket-22191' branch that was attached to this ticket previously. To sum up:
> 
> with the current 'public/packages/ecl20' tests segfault if ecl is built with threads, work fine if ecl is built without threads
> 
> with the 'public/ticket-22191' 


this branch was for ECL 16.1.3, thus it is not clear to me which multithreadef ECL  you tested.

In any case I hope gh-spaghettisalad knows what is going on, I bet it has to do with fork() called by the doctesting framework.



---

archive/issue_comments_330521.json:
```json
{
    "body": "<a id='comment:235'></a>\nReplying to [dimpase](#comment%3A234):\n> this branch was for ECL 16.1.3, thus it is not clear to me which multithreadef ECL  you tested.\n\n\nI tested 20.4:\n\nReplying to [arojas](#comment%3A229):\n> Adding to the old patch only the build fixes required to compile against 20.4 (ie ECL_OPT_TRAP_SIGCHLD etc removal) makes it work fine without segfaults.\n",
    "created_at": "2020-06-23T19:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330521",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:235'></a>
Replying to [dimpase](#comment%3A234):
> this branch was for ECL 16.1.3, thus it is not clear to me which multithreadef ECL  you tested.


I tested 20.4:

Replying to [arojas](#comment%3A229):
> Adding to the old patch only the build fixes required to compile against 20.4 (ie ECL_OPT_TRAP_SIGCHLD etc removal) makes it work fine without segfaults.




---

archive/issue_comments_330522.json:
```json
{
    "body": "**Changing commit** from \"[0b777377289ba21166ea8d4f647e38e8b6ea1d23](https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23)\" to \"[8ca1c0e5223d3e94ed36da2bfc22c9e608283074](https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074)\".",
    "created_at": "2020-06-27T22:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330522",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0b777377289ba21166ea8d4f647e38e8b6ea1d23](https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23)" to "[8ca1c0e5223d3e94ed36da2bfc22c9e608283074](https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074)".



---

archive/issue_comments_330523.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074\">8ca1c0e</a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr></table>\n",
    "created_at": "2020-06-27T22:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074">8ca1c0e</a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr></table>




---

archive/issue_comments_330524.json:
```json
{
    "body": "<a id='comment:7'></a>\n> Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite.\n\n\nThis was caused by a bug in ECL which has just been fixed (see https://gitlab.com/embeddable-common-lisp/ecl/-/commit/75877dd8f0d534552284ba4380ba65baa74f028f).",
    "created_at": "2020-06-28T09:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330524",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:7'></a>
> Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite.


This was caused by a bug in ECL which has just been fixed (see https://gitlab.com/embeddable-common-lisp/ecl/-/commit/75877dd8f0d534552284ba4380ba65baa74f028f).



---

archive/issue_comments_330525.json:
```json
{
    "body": "<a id='comment:238'></a>\nReplying to [gh-spaghettisalat](#comment%3A237):\n> > Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite.\n\n> \n> This was caused by a bug in ECL which has just been fixed (see https://gitlab.com/embeddable-common-lisp/ecl/-/commit/75877dd8f0d534552284ba4380ba65baa74f028f).\n\n\nThanks, all good with this branch and patched, threads enabled ecl.",
    "created_at": "2020-06-28T13:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330525",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:238'></a>
Replying to [gh-spaghettisalat](#comment%3A237):
> > Compiling this branch against our system threaded-enabled ecl gives multiple segfaults when running the test suite.

> 
> This was caused by a bug in ECL which has just been fixed (see https://gitlab.com/embeddable-common-lisp/ecl/-/commit/75877dd8f0d534552284ba4380ba65baa74f028f).


Thanks, all good with this branch and patched, threads enabled ecl.



---

archive/issue_comments_330526.json:
```json
{
    "body": "<a id='comment:9'></a>\nmaybe upstream will do a minor release, so that we don't carry all these patches along?",
    "created_at": "2020-06-28T14:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330526",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
maybe upstream will do a minor release, so that we don't carry all these patches along?



---

archive/issue_comments_330527.json:
```json
{
    "body": "**Changing commit** from \"[8ca1c0e5223d3e94ed36da2bfc22c9e608283074](https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074)\" to \"[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)\".",
    "created_at": "2020-06-28T23:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330527",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8ca1c0e5223d3e94ed36da2bfc22c9e608283074](https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074)" to "[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)".



---

archive/issue_comments_330528.json:
```json
{
    "body": "<a id='comment:0'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d\">f82c716</a></td><td><code>Commit 75877dd8 from upstream</code></td></tr></table>\n",
    "created_at": "2020-06-28T23:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330528",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d">f82c716</a></td><td><code>Commit 75877dd8 from upstream</code></td></tr></table>




---

archive/issue_events_198470.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-28T23:14:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198470"
}
```



---

archive/issue_events_198471.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-28T23:14:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198471"
}
```



---

archive/issue_comments_330529.json:
```json
{
    "body": "<a id='comment:1'></a>\ntests are running on https://github.com/dimpase/sage/pull/13",
    "created_at": "2020-06-28T23:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330529",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
tests are running on https://github.com/dimpase/sage/pull/13



---

archive/issue_comments_330530.json:
```json
{
    "body": "<a id='comment:242'></a>\nReplying to [dimpase](#comment%3A241):\n> tests are running on https://github.com/dimpase/sage/pull/13\n\nUnfortunately the cygwin builds didn't make it to the interesting part",
    "created_at": "2020-06-30T00:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330530",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:242'></a>
Replying to [dimpase](#comment%3A241):
> tests are running on https://github.com/dimpase/sage/pull/13

Unfortunately the cygwin builds didn't make it to the interesting part



---

archive/issue_comments_330531.json:
```json
{
    "body": "<a id='comment:3'></a>\nCould you restart https://github.com/dimpase/sage/actions/runs/150871954 ?",
    "created_at": "2020-06-30T00:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330531",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Could you restart https://github.com/dimpase/sage/actions/runs/150871954 ?



---

archive/issue_comments_330532.json:
```json
{
    "body": "<a id='comment:4'></a>\nrestarted tests, cygwin-only, on https://github.com/dimpase/sage/pull/14\n\nby the way, I noticed a few places mentioning python2 in .github/workflows\nAre they leftovers, to be removed?\nI'm testing with the following diff applied:\n\n```diff\ndiff --git a/.github/workflows/ci-cygwin-minimal.yml b/.github/workflows/ci-cygwin-minimal.yml\nindex 97734216e8..aba9db76ae 100644\n--- a/.github/workflows/ci-cygwin-minimal.yml\n+++ b/.github/workflows/ci-cygwin-minimal.yml\n@@ -11,7 +11,7 @@ env:\n   MAKE: make -j8\n   SAGE_NUM_THREADS: 3\n   SAGE_CHECK: warn\n-  SAGE_CHECK_PACKAGES: \"!cython,!r,!python3,!python2,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl\"\n+  SAGE_CHECK_PACKAGES: \"!cython,!r,!python3,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl\"\n   CYGWIN: winsymlinks:native\n   CONFIGURE_ARGS: --enable-experimental-packages --enable-download-from-upstream-url\n   SAGE_FAT_BINARY: yes\ndiff --git a/.github/workflows/ci-cygwin-standard.yml b/.github/workflows/ci-cygwin-standard.yml\nindex 8268e0e75f..f317a702f4 100644\n--- a/.github/workflows/ci-cygwin-standard.yml\n+++ b/.github/workflows/ci-cygwin-standard.yml\n@@ -11,7 +11,7 @@ env:\n   MAKE: make -j8\n   SAGE_NUM_THREADS: 3\n   SAGE_CHECK: warn\n-  SAGE_CHECK_PACKAGES: \"!cython,!r,!python3,!python2,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl\"\n+  SAGE_CHECK_PACKAGES: \"!cython,!r,!python3,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl\"\n   CYGWIN: winsymlinks:native\n   CONFIGURE_ARGS: --enable-experimental-packages --enable-download-from-upstream-url\n   SAGE_FAT_BINARY: yes\ndiff --git a/.github/workflows/update-cygwin-yml.sh b/.github/workflows/update-cygwin-yml.sh\nindex 247fe20e18..bc1d195a9f 100755\n--- a/.github/workflows/update-cygwin-yml.sh\n+++ b/.github/workflows/update-cygwin-yml.sh\n@@ -1,2 +1,2 @@\n #!/usr/bin/env bash\n-for X in standard-python2 minimal; do sed 's/\\[standard\\]/['$X']/g;s/CI cygwin-standard/CI cygwin-'$X'/g;' ci-cygwin-standard.yml > ci-cygwin-$X.yml; done\n+for X in minimal; do sed 's/\\[standard\\]/['$X']/g;s/CI cygwin-standard/CI cygwin-'$X'/g;' ci-cygwin-standard.yml > ci-cygwin-$X.yml; done\n```",
    "created_at": "2020-07-02T16:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330532",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
restarted tests, cygwin-only, on https://github.com/dimpase/sage/pull/14

by the way, I noticed a few places mentioning python2 in .github/workflows
Are they leftovers, to be removed?
I'm testing with the following diff applied:

```diff
diff --git a/.github/workflows/ci-cygwin-minimal.yml b/.github/workflows/ci-cygwin-minimal.yml
index 97734216e8..aba9db76ae 100644
--- a/.github/workflows/ci-cygwin-minimal.yml
+++ b/.github/workflows/ci-cygwin-minimal.yml
@@ -11,7 +11,7 @@ env:
   MAKE: make -j8
   SAGE_NUM_THREADS: 3
   SAGE_CHECK: warn
-  SAGE_CHECK_PACKAGES: "!cython,!r,!python3,!python2,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl"
+  SAGE_CHECK_PACKAGES: "!cython,!r,!python3,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl"
   CYGWIN: winsymlinks:native
   CONFIGURE_ARGS: --enable-experimental-packages --enable-download-from-upstream-url
   SAGE_FAT_BINARY: yes
diff --git a/.github/workflows/ci-cygwin-standard.yml b/.github/workflows/ci-cygwin-standard.yml
index 8268e0e75f..f317a702f4 100644
--- a/.github/workflows/ci-cygwin-standard.yml
+++ b/.github/workflows/ci-cygwin-standard.yml
@@ -11,7 +11,7 @@ env:
   MAKE: make -j8
   SAGE_NUM_THREADS: 3
   SAGE_CHECK: warn
-  SAGE_CHECK_PACKAGES: "!cython,!r,!python3,!python2,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl"
+  SAGE_CHECK_PACKAGES: "!cython,!r,!python3,!nose,!pathpy,!gap,!cysignals,!linbox,!git,!ppl"
   CYGWIN: winsymlinks:native
   CONFIGURE_ARGS: --enable-experimental-packages --enable-download-from-upstream-url
   SAGE_FAT_BINARY: yes
diff --git a/.github/workflows/update-cygwin-yml.sh b/.github/workflows/update-cygwin-yml.sh
index 247fe20e18..bc1d195a9f 100755
--- a/.github/workflows/update-cygwin-yml.sh
+++ b/.github/workflows/update-cygwin-yml.sh
@@ -1,2 +1,2 @@
 #!/usr/bin/env bash
-for X in standard-python2 minimal; do sed 's/\[standard\]/['$X']/g;s/CI cygwin-standard/CI cygwin-'$X'/g;' ci-cygwin-standard.yml > ci-cygwin-$X.yml; done
+for X in minimal; do sed 's/\[standard\]/['$X']/g;s/CI cygwin-standard/CI cygwin-'$X'/g;' ci-cygwin-standard.yml > ci-cygwin-$X.yml; done
```



---

archive/issue_comments_330533.json:
```json
{
    "body": "<a id='comment:245'></a>\nReplying to [dimpase](#comment%3A244):\n> restarted tests, cygwin-only, on https://github.com/dimpase/sage/pull/14\n\n\nThanks\n\n> by the way, I noticed a few places mentioning python2 in .github/workflows\n> Are they leftovers, to be removed?\n\n\nYes, these changes are OK to do. Separate ticket please",
    "created_at": "2020-07-02T18:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330533",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:245'></a>
Replying to [dimpase](#comment%3A244):
> restarted tests, cygwin-only, on https://github.com/dimpase/sage/pull/14


Thanks

> by the way, I noticed a few places mentioning python2 in .github/workflows
> Are they leftovers, to be removed?


Yes, these changes are OK to do. Separate ticket please



---

archive/issue_comments_330534.json:
```json
{
    "body": "<a id='comment:246'></a>\nReplying to [mkoeppe](#comment%3A245):\n> Replying to [dimpase](#comment%3A244):\n> > by the way, I noticed a few places mentioning python2 in .github/workflows\n> > Are they leftovers, to be removed?\n\n> \n> Yes, these changes are OK to do. Separate ticket please\n\nsee #30048",
    "created_at": "2020-07-02T18:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330534",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:246'></a>
Replying to [mkoeppe](#comment%3A245):
> Replying to [dimpase](#comment%3A244):
> > by the way, I noticed a few places mentioning python2 in .github/workflows
> > Are they leftovers, to be removed?

> 
> Yes, these changes are OK to do. Separate ticket please

see #30048



---

archive/issue_comments_330535.json:
```json
{
    "body": "<a id='comment:7'></a>\nunfortunately Cygwin GH Actions builds still fail for reasons which  have nothing to do with this ticket.\n\nIntermediate builds fail to upload.",
    "created_at": "2020-07-03T12:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330535",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
unfortunately Cygwin GH Actions builds still fail for reasons which  have nothing to do with this ticket.

Intermediate builds fail to upload.



---

archive/issue_comments_330536.json:
```json
{
    "body": "<a id='comment:8'></a>\nJust restart another time",
    "created_at": "2020-07-03T12:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330536",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Just restart another time



---

archive/issue_comments_330537.json:
```json
{
    "body": "<a id='comment:9'></a>\nProbably better to do https://gitlab.com/embeddable-common-lisp/ecl/-/issues/599#note_369508934",
    "created_at": "2020-07-03T13:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330537",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Probably better to do https://gitlab.com/embeddable-common-lisp/ecl/-/issues/599#note_369508934



---

archive/issue_comments_330538.json:
```json
{
    "body": "<a id='comment:250'></a>\nReplying to [mkoeppe](#comment%3A248):\n> Just restart another time\n\nin progress now",
    "created_at": "2020-07-03T13:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330538",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:250'></a>
Replying to [mkoeppe](#comment%3A248):
> Just restart another time

in progress now



---

archive/issue_comments_330539.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.\nShould this patch be removed or left in place?",
    "created_at": "2020-07-04T10:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330539",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:1'></a>
The diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.
Should this patch be removed or left in place?



---

archive/issue_comments_330540.json:
```json
{
    "body": "<a id='comment:252'></a>\nReplying to [pbruin](#comment%3A251):\n> The diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.\n> Should this patch be removed or left in place?\n\nremoved (needless to say it has no effect on functionality). we're still not done with this, due to Cygwin errors. I'll post details on them.",
    "created_at": "2020-07-04T10:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330540",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:252'></a>
Replying to [pbruin](#comment%3A251):
> The diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.
> Should this patch be removed or left in place?

removed (needless to say it has no effect on functionality). we're still not done with this, due to Cygwin errors. I'll post details on them.



---

archive/issue_comments_330541.json:
```json
{
    "body": "<a id='comment:253'></a>\nReplying to [dimpase](#comment%3A252):\n> Replying to [pbruin](#comment%3A251):\n> > The diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.\n> > Should this patch be removed or left in place?\n\n> removed (needless to say it has no effect on functionality). we're still not done with this, due to Cygwin errors. I'll post details on them.\nThanks.  By the way, I just opened #30063 for upgrading Maxima (though I am not planning to work on this myself).",
    "created_at": "2020-07-04T11:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330541",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:253'></a>
Replying to [dimpase](#comment%3A252):
> Replying to [pbruin](#comment%3A251):
> > The diff has a line `build/pkgs/ecl/patches/ffi_abi_libffi33.oldpatch (renamed from build/pkgs/ecl/patches/ffi_abi_libffi33.patch)`.
> > Should this patch be removed or left in place?

> removed (needless to say it has no effect on functionality). we're still not done with this, due to Cygwin errors. I'll post details on them.
Thanks.  By the way, I just opened #30063 for upgrading Maxima (though I am not planning to work on this myself).



---

archive/issue_comments_330542.json:
```json
{
    "body": "<a id='comment:4'></a>\ncygwin errors:\n\npexpect chocked? something else? \nPerhaps, redo using libmaxima?\n\n```\nsage -t src/doc/en/constructions/plotting.rst\n**********************************************************************\nFile \"src/doc/en/constructions/plotting.rst\", line 53, in doc.en.constructions.plotting\nFailed example:\n    L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))\n        for i in range(-300,300)]\nExpected nothing\nGot:\n    Maxima crashed -- automatically restarting.\n**********************************************************************\n```\n\nthe following resembles #8772 - apparently just pexpect choking under heavy load? \n\n```\nsage -t src/doc/en/tutorial/tour_algebra.rst\n**********************************************************************\nFile \"src/doc/en/tutorial/tour_algebra.rst\", line 219, in doc.en.tutorial.tour_algebra\nFailed example:\n    de1 = maxima(\"2*diff(x(t),t, 2) + 6*x(t) - 2*y(t)\")\nException raised:\n    Traceback (most recent call last):\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in <listcomp>\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 793, in _eval_line\n        self._error_check(line, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 934, in _error_check\n        self._error_msg(cmd, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 951, in _error_msg\n        raise TypeError(\"Error executing code in Maxima\\nCODE:\\n\\t%s\\nMaxima ERROR:\\n\\t%s\"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))\n    TypeError: Error executing code in Maxima\n    CODE:\n        display2d : false;\n    Maxima ERROR:\n        \n    incorrect syntax: Premature termination of input at ;.\n    ;\n     ^\n\n\n    During handling of the above exception, another exception occurred:\n...\n\nsage -t src/doc/ru/tutorial/tour_algebra.rst\n**********************************************************************\nFile \"src/doc/ru/tutorial/tour_algebra.rst\", line 202, in doc.ru.tutorial.tour_algebra\nFailed example:\n    lde1 = de1.laplace(\"t\",\"s\"); lde1\nException raised:\n    Traceback (most recent call last):\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.ru.tutorial.tour_algebra[1]>\", line 1, in <module>\n        lde1 = de1.laplace(\"t\",\"s\"); lde1\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 680, in __call__\n        return self._obj.parent().function_call(self._name, [self._obj] + list(args), kwds)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 596, in function_call\n        args, kwds = self._convert_args_kwds(args, kwds)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 557, in _convert_args_kwds\n        args[i] = self(arg)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 296, in __call__\n        return cls(self, x, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1157, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1469, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 501, in _create\n        self.set(name, value)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1002, in set\n        self._eval_line(cmd)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 793, in _eval_line\n        self._error_check(line, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 934, in _error_check\n        self._error_msg(cmd, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 951, in _error_msg\n        raise TypeError(\"Error executing code in Maxima\\nCODE:\\n\\t%s\\nMaxima ERROR:\\n\\t%s\"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))\n    TypeError: Error executing code in Maxima\n    CODE:\n        sage4 : t$\n    Maxima ERROR:\n        \n    incorrect syntax: Premature termination of input at ;.\n    ;\n     ^\n...\n\nsage -t src/doc/ru/tutorial/interfaces.rst\n**********************************************************************\nFile \"src/doc/ru/tutorial/interfaces.rst\", line 258, in doc.ru.tutorial.interfaces\nFailed example:\n    f = maxima.eval('ij_entry[i,j] := i/j')\nException raised:\n    Traceback (most recent call last):\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.ru.tutorial.interfaces[0]>\", line 1, in <module>\n        f = maxima.eval('ij_entry[i,j] := i/j')\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in <listcomp>\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 782, in _eval_line\n        self._sendline(line)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 644, in _sendline\n        self._sendstr(string)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1250, in _sendstr\n        self._start()\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 609, in _start\n        Expect._start(self)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 527, in _start\n        self.eval(X)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in <listcomp>\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 788, in _eval_line\n        assert line_echo.strip().endswith(line.strip()), 'mismatch:\\n' + line_echo + line\n    AssertionError: mismatch:\n    \n    nolabels : true;\n...\n\nFile \"src/doc/ru/tutorial/interfaces.rst\", line 259, in doc.ru.tutorial.interfaces\nFailed example:\n    A = maxima('genmatrix(ij_entry,4,4)'); A\nExpected:\n    matrix([1,1/2,1/3,1/4],[2,1,2/3,1/2],[3,3/2,1,3/4],[4,2,4/3,1])\nGot:\n    matrix([ij_entry[1,1],ij_entry[1,2],ij_entry[1,3],ij_entry[1,4]],[ij_entry[2,1],ij_entry[2,2],ij_entry[2,3],ij_entry[2,4]],[ij_entry[3,1],ij_entry[3,2],ij_entry[3,3],ij_entry[3,4]],[ij_entry[4,1],ij_entry[4,2],ij_entry[4,3],ij_entry[4,4]])\n...\n\n[and more of the same...]\n\nsage -t src/sage/symbolic/assumptions.py\n**********************************************************************\nFile \"src/sage/symbolic/assumptions.py\", line 37, in sage.symbolic.assumptions\nFailed example:\n    maxima('features')\nException raised:\n    Traceback (most recent call last):\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.assumptions[6]>\", line 1, in <module>\n        maxima('features')\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 296, in __call__\n        return cls(self, x, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1157, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1469, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 501, in _create\n        self.set(name, value)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1002, in set\n        self._eval_line(cmd)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 782, in _eval_line\n        self._sendline(line)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 644, in _sendline\n        self._sendstr(string)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1250, in _sendstr\n        self._start()\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 609, in _start\n        Expect._start(self)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 527, in _start\n        self.eval(X)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1383, in <listcomp>\n        for L in code.split('\\n') if L != ''])\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 788, in _eval_line\n        assert line_echo.strip().endswith(line.strip()), 'mismatch:\\n' + line_echo + line\n    AssertionError: mismatch:\n    \n    domain : complex;\n\n...\n```\n\nthe following - already mentioned:\n\n```\nsage -t src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 8735, in sage.symbolic.expression.Expression.arccosh\nFailed example:\n    maxima('acosh(0.5)')\nExpected:\n    1.04719755119659...*%i\nGot:\n    1.047197551196598*%i-1.110223024625157e-16\n```\nis not a big deal, just a floating point noise.\n\n\nPexpext, again (?):\n\n```\nsage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py\n**********************************************************************\nFile \"src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py\", line 53, in sage.tests.books.computational-mathematics-with-sagemath.sol.graphique_doctest\nFailed example:\n    P = desolve_system_rk4(f(x,y), [x,y],ics=[0,10,5], ivar=t, end_points=15)\nException raised:\n    Traceback (most recent call last):\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.books.computational-mathematics-with-sagemath.sol.graphique_doctest[22]>\", line 1, in <module>\n        P = desolve_system_rk4(f(x,y), [x,y],ics=[Integer(0),Integer(10),Integer(5)], ivar=t, end_points=Integer(15))\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/calculus/desolvers.py\", line 1490, in desolve_system_rk4\n        maxima(\"load('dynamics)\")\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 296, in __call__\n        return cls(self, x, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1157, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1469, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 501, in _create\n        self.set(name, value)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 1002, in set\n        self._eval_line(cmd)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 782, in _eval_line\n        self._sendline(line)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 644, in _sendline\n        self._sendstr(string)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 1250, in _sendstr\n        self._start()\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 618, in _start\n        self._eval_line('0;')\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 793, in _eval_line\n        self._error_check(line, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 934, in _error_check\n        self._error_msg(cmd, out)\n      File \"/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py\", line 951, in _error_msg\n        raise TypeError(\"Error executing code in Maxima\\nCODE:\\n\\t%s\\nMaxima ERROR:\\n\\t%s\"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))\n    TypeError: Error executing code in Maxima\n    CODE:\n        0;\n    Maxima ERROR:\n        \n    incorrect syntax: tex is not an infix operator\n    lisp (defun tex-\n                  ^\n```",
    "created_at": "2020-07-04T11:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330542",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
cygwin errors:

pexpect chocked? something else? 
Perhaps, redo using libmaxima?

```
sage -t src/doc/en/constructions/plotting.rst
**********************************************************************
File "src/doc/en/constructions/plotting.rst", line 53, in doc.en.constructions.plotting
Failed example:
    L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))
        for i in range(-300,300)]
Expected nothing
Got:
    Maxima crashed -- automatically restarting.
**********************************************************************
```

the following resembles #8772 - apparently just pexpect choking under heavy load? 

```
sage -t src/doc/en/tutorial/tour_algebra.rst
**********************************************************************
File "src/doc/en/tutorial/tour_algebra.rst", line 219, in doc.en.tutorial.tour_algebra
Failed example:
    de1 = maxima("2*diff(x(t),t, 2) + 6*x(t) - 2*y(t)")
Exception raised:
    Traceback (most recent call last):
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in eval
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in <listcomp>
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 793, in _eval_line
        self._error_check(line, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 934, in _error_check
        self._error_msg(cmd, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 951, in _error_msg
        raise TypeError("Error executing code in Maxima\nCODE:\n\t%s\nMaxima ERROR:\n\t%s"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))
    TypeError: Error executing code in Maxima
    CODE:
        display2d : false;
    Maxima ERROR:
        
    incorrect syntax: Premature termination of input at ;.
    ;
     ^


    During handling of the above exception, another exception occurred:
...

sage -t src/doc/ru/tutorial/tour_algebra.rst
**********************************************************************
File "src/doc/ru/tutorial/tour_algebra.rst", line 202, in doc.ru.tutorial.tour_algebra
Failed example:
    lde1 = de1.laplace("t","s"); lde1
Exception raised:
    Traceback (most recent call last):
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.ru.tutorial.tour_algebra[1]>", line 1, in <module>
        lde1 = de1.laplace("t","s"); lde1
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 680, in __call__
        return self._obj.parent().function_call(self._name, [self._obj] + list(args), kwds)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 596, in function_call
        args, kwds = self._convert_args_kwds(args, kwds)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 557, in _convert_args_kwds
        args[i] = self(arg)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 296, in __call__
        return cls(self, x, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1157, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1469, in __init__
        self._name = parent._create(value, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 501, in _create
        self.set(name, value)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1002, in set
        self._eval_line(cmd)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 793, in _eval_line
        self._error_check(line, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 934, in _error_check
        self._error_msg(cmd, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 951, in _error_msg
        raise TypeError("Error executing code in Maxima\nCODE:\n\t%s\nMaxima ERROR:\n\t%s"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))
    TypeError: Error executing code in Maxima
    CODE:
        sage4 : t$
    Maxima ERROR:
        
    incorrect syntax: Premature termination of input at ;.
    ;
     ^
...

sage -t src/doc/ru/tutorial/interfaces.rst
**********************************************************************
File "src/doc/ru/tutorial/interfaces.rst", line 258, in doc.ru.tutorial.interfaces
Failed example:
    f = maxima.eval('ij_entry[i,j] := i/j')
Exception raised:
    Traceback (most recent call last):
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.ru.tutorial.interfaces[0]>", line 1, in <module>
        f = maxima.eval('ij_entry[i,j] := i/j')
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in eval
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in <listcomp>
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 782, in _eval_line
        self._sendline(line)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 644, in _sendline
        self._sendstr(string)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1250, in _sendstr
        self._start()
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 609, in _start
        Expect._start(self)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 527, in _start
        self.eval(X)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in eval
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in <listcomp>
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 788, in _eval_line
        assert line_echo.strip().endswith(line.strip()), 'mismatch:\n' + line_echo + line
    AssertionError: mismatch:
    
    nolabels : true;
...

File "src/doc/ru/tutorial/interfaces.rst", line 259, in doc.ru.tutorial.interfaces
Failed example:
    A = maxima('genmatrix(ij_entry,4,4)'); A
Expected:
    matrix([1,1/2,1/3,1/4],[2,1,2/3,1/2],[3,3/2,1,3/4],[4,2,4/3,1])
Got:
    matrix([ij_entry[1,1],ij_entry[1,2],ij_entry[1,3],ij_entry[1,4]],[ij_entry[2,1],ij_entry[2,2],ij_entry[2,3],ij_entry[2,4]],[ij_entry[3,1],ij_entry[3,2],ij_entry[3,3],ij_entry[3,4]],[ij_entry[4,1],ij_entry[4,2],ij_entry[4,3],ij_entry[4,4]])
...

[and more of the same...]

sage -t src/sage/symbolic/assumptions.py
**********************************************************************
File "src/sage/symbolic/assumptions.py", line 37, in sage.symbolic.assumptions
Failed example:
    maxima('features')
Exception raised:
    Traceback (most recent call last):
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.assumptions[6]>", line 1, in <module>
        maxima('features')
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 296, in __call__
        return cls(self, x, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1157, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1469, in __init__
        self._name = parent._create(value, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 501, in _create
        self.set(name, value)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1002, in set
        self._eval_line(cmd)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 782, in _eval_line
        self._sendline(line)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 644, in _sendline
        self._sendstr(string)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1250, in _sendstr
        self._start()
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 609, in _start
        Expect._start(self)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 527, in _start
        self.eval(X)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in eval
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1383, in <listcomp>
        for L in code.split('\n') if L != ''])
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 788, in _eval_line
        assert line_echo.strip().endswith(line.strip()), 'mismatch:\n' + line_echo + line
    AssertionError: mismatch:
    
    domain : complex;

...
```

the following - already mentioned:

```
sage -t src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 8735, in sage.symbolic.expression.Expression.arccosh
Failed example:
    maxima('acosh(0.5)')
Expected:
    1.04719755119659...*%i
Got:
    1.047197551196598*%i-1.110223024625157e-16
```
is not a big deal, just a floating point noise.


Pexpext, again (?):

```
sage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py
**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py", line 53, in sage.tests.books.computational-mathematics-with-sagemath.sol.graphique_doctest
Failed example:
    P = desolve_system_rk4(f(x,y), [x,y],ics=[0,10,5], ivar=t, end_points=15)
Exception raised:
    Traceback (most recent call last):
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.books.computational-mathematics-with-sagemath.sol.graphique_doctest[22]>", line 1, in <module>
        P = desolve_system_rk4(f(x,y), [x,y],ics=[Integer(0),Integer(10),Integer(5)], ivar=t, end_points=Integer(15))
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/calculus/desolvers.py", line 1490, in desolve_system_rk4
        maxima("load('dynamics)")
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 296, in __call__
        return cls(self, x, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1157, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1469, in __init__
        self._name = parent._create(value, name=name)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 501, in _create
        self.set(name, value)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 1002, in set
        self._eval_line(cmd)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 782, in _eval_line
        self._sendline(line)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 644, in _sendline
        self._sendstr(string)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1250, in _sendstr
        self._start()
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 618, in _start
        self._eval_line('0;')
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 793, in _eval_line
        self._error_check(line, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 934, in _error_check
        self._error_msg(cmd, out)
      File "/cygdrive/d/a/sage/sage/local/lib/python3.7/site-packages/sage/interfaces/maxima.py", line 951, in _error_msg
        raise TypeError("Error executing code in Maxima\nCODE:\n\t%s\nMaxima ERROR:\n\t%s"%(cmd, out.replace('-- an error.  To debug this try debugmode(true);','')))
    TypeError: Error executing code in Maxima
    CODE:
        0;
    Maxima ERROR:
        
    incorrect syntax: tex is not an infix operator
    lisp (defun tex-
                  ^
```



---

archive/attachments_020867.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "ptest.log",
    "asset_url": "tarball://root/attachments/some-uuid/ticket22191/ptest.log",
    "created_at": "2020-07-04T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.log",
    "user": "https://github.com/dimpase"
}
```



---

archive/issue_comments_330543.json:
```json
{
    "body": "cygwin-standard run",
    "created_at": "2020-07-04T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330543",
    "user": "https://github.com/dimpase"
}
```

cygwin-standard run



---

archive/issue_comments_330544.json:
```json
{
    "body": "<a id='comment:5'></a>\nsee the attachment for complete ptest.log on Cygwin",
    "created_at": "2020-07-04T11:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330544",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
see the attachment for complete ptest.log on Cygwin



---

archive/issue_comments_330545.json:
```json
{
    "body": "<a id='comment:6'></a>\nAs we don't see errors on embedded Maxima, but only on pexpect Maxima, I am inclined to say it is OK.",
    "created_at": "2020-07-04T11:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330545",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
As we don't see errors on embedded Maxima, but only on pexpect Maxima, I am inclined to say it is OK.



---

archive/issue_comments_330546.json:
```json
{
    "body": "<a id='comment:7'></a>\nMaybe not \"OK\", but I think acceptable for the next beta. But the precise failure mode of the maxima pexpect interface should be investigated. This is clearly a regression from the older ECL.",
    "created_at": "2020-07-04T18:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330546",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Maybe not "OK", but I think acceptable for the next beta. But the precise failure mode of the maxima pexpect interface should be investigated. This is clearly a regression from the older ECL.



---

archive/issue_comments_330547.json:
```json
{
    "body": "<a id='comment:258'></a>\nReplying to [dimpase](#comment%3A254):\n> cygwin errors:\n> \n> pexpect chocked? [...]\n> \n> ```\n> sage -t src/doc/en/constructions/plotting.rst\n> **********************************************************************\n> File \"src/doc/en/constructions/plotting.rst\", line 53, in doc.en.constructions.plotting\n> Failed example:\n>     L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))\n>         for i in range(-300,300)]\n> Expected nothing\n> Got:\n>     Maxima crashed -- automatically restarting.\n> **********************************************************************\n> ```\n> \n> the following resembles #8772 - apparently just pexpect choking under heavy load? \n\n\nYes, let's reuse that old ticket to investigate this more.",
    "created_at": "2020-07-04T18:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330547",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:258'></a>
Replying to [dimpase](#comment%3A254):
> cygwin errors:
> 
> pexpect chocked? [...]
> 
> ```
> sage -t src/doc/en/constructions/plotting.rst
> **********************************************************************
> File "src/doc/en/constructions/plotting.rst", line 53, in doc.en.constructions.plotting
> Failed example:
>     L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))
>         for i in range(-300,300)]
> Expected nothing
> Got:
>     Maxima crashed -- automatically restarting.
> **********************************************************************
> ```
> 
> the following resembles #8772 - apparently just pexpect choking under heavy load? 


Yes, let's reuse that old ticket to investigate this more.



---

archive/issue_comments_330548.json:
```json
{
    "body": "<a id='comment:9'></a>\nit could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.",
    "created_at": "2020-07-04T18:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330548",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
it could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.



---

archive/issue_comments_330549.json:
```json
{
    "body": "<a id='comment:0'></a>\nIt would be really good to simulate these tests without having to build all of Sage so that this could become part of the CI in https://github.com/spaghettisalat/ecl/pull/1",
    "created_at": "2020-07-04T18:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330549",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>
It would be really good to simulate these tests without having to build all of Sage so that this could become part of the CI in https://github.com/spaghettisalat/ecl/pull/1



---

archive/issue_comments_330550.json:
```json
{
    "body": "<a id='comment:261'></a>\nReplying to [dimpase](#comment%3A259):\n> it could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.\n\n\ntests running at https://github.com/dimpase/sage/actions/runs/157700338",
    "created_at": "2020-07-04T18:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330550",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:261'></a>
Replying to [dimpase](#comment%3A259):
> it could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.


tests running at https://github.com/dimpase/sage/actions/runs/157700338



---

archive/issue_comments_330551.json:
```json
{
    "body": "<a id='comment:2'></a>\nby the way, there are also a number of giac tests failing on Cygwin, with a very similar pexpect under heavy load (see attachment ptest results); so I really think there is nothing wrong with ECL on Cygwin per se, it's pexpect that plays up in this particular testing configuration.",
    "created_at": "2020-07-04T18:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330551",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
by the way, there are also a number of giac tests failing on Cygwin, with a very similar pexpect under heavy load (see attachment ptest results); so I really think there is nothing wrong with ECL on Cygwin per se, it's pexpect that plays up in this particular testing configuration.



---

archive/issue_comments_330552.json:
```json
{
    "body": "<a id='comment:263'></a>\nReplying to [mkoeppe](#comment%3A258):\n> Replying to [dimpase](#comment%3A254):\n> > cygwin errors:\n> > \n> > pexpect chocked? [...]\n> > \n> > ```\n> > sage -t src/doc/en/constructions/plotting.rst\n> > **********************************************************************\n> > File \"src/doc/en/constructions/plotting.rst\", line 53, in doc.en.constructions.plotting\n> > Failed example:\n> >     L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))\n> >         for i in range(-300,300)]\n> > Expected nothing\n> > Got:\n> >     Maxima crashed -- automatically restarting.\n> > **********************************************************************\n> > ```\n> > \n> > the following resembles #8772 - apparently just pexpect choking under heavy load? \n\n> \n> Yes, let's reuse that old ticket to investigate this more.\n\n\nthis can be rewritten as follows,\n\n```\nsage: L = [(i/100.0, maxima_calculus.eval('jacobi_sn (%s/100.0,2.0)'%i))\n....:         for i in range(-300,300)]\n```\navoiding pexpect, I think. Indeed, it's 5 times faster:\n\n```\nsage: timeit(\"L = [(i/100.0, maxima_calculus.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]\")\n5 loops, best of 3: 110 ms per loop\nsage: timeit(\"L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]\")\n5 loops, best of 3: 556 ms per loop\n```\n\n\n> \n\n>",
    "created_at": "2020-07-04T18:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330552",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:263'></a>
Replying to [mkoeppe](#comment%3A258):
> Replying to [dimpase](#comment%3A254):
> > cygwin errors:
> > 
> > pexpect chocked? [...]
> > 
> > ```
> > sage -t src/doc/en/constructions/plotting.rst
> > **********************************************************************
> > File "src/doc/en/constructions/plotting.rst", line 53, in doc.en.constructions.plotting
> > Failed example:
> >     L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i))
> >         for i in range(-300,300)]
> > Expected nothing
> > Got:
> >     Maxima crashed -- automatically restarting.
> > **********************************************************************
> > ```
> > 
> > the following resembles #8772 - apparently just pexpect choking under heavy load? 

> 
> Yes, let's reuse that old ticket to investigate this more.


this can be rewritten as follows,

```
sage: L = [(i/100.0, maxima_calculus.eval('jacobi_sn (%s/100.0,2.0)'%i))
....:         for i in range(-300,300)]
```
avoiding pexpect, I think. Indeed, it's 5 times faster:

```
sage: timeit("L = [(i/100.0, maxima_calculus.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]")
5 loops, best of 3: 110 ms per loop
sage: timeit("L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]")
5 loops, best of 3: 556 ms per loop
```


> 

>



---

archive/issue_comments_330553.json:
```json
{
    "body": "<a id='comment:264'></a>\nReplying to [dimpase](#comment%3A263):\n\n> 5 loops, best of 3: 110 ms per loop\n> sage: timeit(\"L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]\")\n> 5 loops, best of 3: 556 ms per loop\n> }}}\n\n\nto improve this, I opened #30071.",
    "created_at": "2020-07-05T10:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330553",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:264'></a>
Replying to [dimpase](#comment%3A263):

> 5 loops, best of 3: 110 ms per loop
> sage: timeit("L = [(i/100.0, maxima.eval('jacobi_sn (%s/100.0,2.0)'%i)) for i in range(-300,300)]")
> 5 loops, best of 3: 556 ms per loop
> }}}


to improve this, I opened #30071.



---

archive/issue_comments_330554.json:
```json
{
    "body": "<a id='comment:265'></a>\nReplying to [dimpase](#comment%3A261):\n> Replying to [dimpase](#comment%3A259):\n> > it could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.\n\n> \n> tests running at https://github.com/dimpase/sage/actions/runs/157700338\n\n\nand this ran out of time limit, so no interesting tests were performed.\n\nI think we should proceed with merging this ticket, anyway, and speed up Maxima things on #30071",
    "created_at": "2020-07-06T00:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330554",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:265'></a>
Replying to [dimpase](#comment%3A261):
> Replying to [dimpase](#comment%3A259):
> > it could actually be an improvement - maxima runs faster, and on a heavily loaded host this leads to this mess. I will try another round of Cygwin tests, with tests not run in parallel.

> 
> tests running at https://github.com/dimpase/sage/actions/runs/157700338


and this ran out of time limit, so no interesting tests were performed.

I think we should proceed with merging this ticket, anyway, and speed up Maxima things on #30071



---

archive/issue_events_198472.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-06T00:18:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198472"
}
```



---

archive/issue_events_198473.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-06T00:18:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198473"
}
```



---

archive/issue_events_198474.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-10T19:34:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198474"
}
```



---

archive/issue_events_198475.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-10T19:34:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22191#event-198475"
}
```



---

archive/issue_comments_330555.json:
```json
{
    "body": "**Changing branch** from \"[public/packages/ecl20](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/ecl20)\" to \"[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)\".",
    "created_at": "2020-07-10T19:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330555",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/packages/ecl20](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/ecl20)" to "[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)".



---

archive/issue_comments_330556.json:
```json
{
    "body": "**Changing commit** from \"[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)\" to \"\".",
    "created_at": "2020-07-12T18:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330556",
    "user": "https://github.com/spaghettisalat"
}
```

**Changing commit** from "[f82c716fdf9c6e91a07166d36b6329a15ecfb41d](https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d)" to "".



---

archive/issue_comments_330557.json:
```json
{
    "body": "<a id='comment:268'></a>\nReplying to [dimpase](#comment%3A239):\n> maybe upstream will do a minor release, so that we don't carry all these patches along?\n\n\nSorry for the late reply, I've been busy. I agree that a bugfix release is needed. This will probably still take a bit though, I want to take a look at some other bugs first (https://gitlab.com/embeddable-common-lisp/ecl/-/issues/594 and https://gitlab.com/embeddable-common-lisp/ecl/-/issues/586) and then there's still tests to run.",
    "created_at": "2020-07-12T18:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22191#issuecomment-330557",
    "user": "https://github.com/spaghettisalat"
}
```

<a id='comment:268'></a>
Replying to [dimpase](#comment%3A239):
> maybe upstream will do a minor release, so that we don't carry all these patches along?


Sorry for the late reply, I've been busy. I agree that a bugfix release is needed. This will probably still take a bit though, I want to take a look at some other bugs first (https://gitlab.com/embeddable-common-lisp/ecl/-/issues/594 and https://gitlab.com/embeddable-common-lisp/ecl/-/issues/586) and then there's still tests to run.
