# Issue 22605: Better error handling of the polyhedron constructor for non-embedded NumberField and floats.

archive/issues_022368.json:
```json
{
    "body": "These error messages are not really informative of what the problem really is:\n\n```\n\nsage: K = NumberField(x^2-2,'s')\nsage: s = K.0\nsage: L = NumberField(x^3-2,'t')\nsage: t = L.0\nsage: P = Polyhedron(vertices = [[0,s],[t,0]])\nTraceback (most recent call last):\n...\nAttributeError: 'Objects_with_category' object has no attribute 'is_exact'\n\n```\n\nsimilar problem with `floats`:\n\n```\n\nsage: f = float(1.1)\nsage: f\n1.1\nsage: Polyhedron(vertices=[[f]])\nTraceback (most recent call last):\n...\nAttributeError: type object 'float' has no attribute 'is_exact'\n\n```\n\nThe constructor could try to detect the problem and return an informative message.\n\nOnce this is fixed, ticket #22552 is a follow-up ticket that should be fixed easily from the present resolution.\n\nCC:  @mo271 @mkoeppe @videlec @novoselt tmonteil @tscrim\n\nKeywords: polyhedron, base ring\n\nBranch/Commit: af03de82ed07686322db70895a0ab34973888981\n\nReviewer: Vincent Delecroix\n\nAuthor: Jean-Philippe Labb\u00e9, Vincent Delecroix, Marcelo Forets\n\nDependencies: #23345\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22605\n\n",
    "closed_at": "2017-07-29T15:30:57Z",
    "created_at": "2017-03-15T12:58:51Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Better error handling of the polyhedron constructor for non-embedded NumberField and floats.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22605",
    "user": "https://github.com/jplab"
}
```
These error messages are not really informative of what the problem really is:

```

sage: K = NumberField(x^2-2,'s')
sage: s = K.0
sage: L = NumberField(x^3-2,'t')
sage: t = L.0
sage: P = Polyhedron(vertices = [[0,s],[t,0]])
Traceback (most recent call last):
...
AttributeError: 'Objects_with_category' object has no attribute 'is_exact'

```

similar problem with `floats`:

```

sage: f = float(1.1)
sage: f
1.1
sage: Polyhedron(vertices=[[f]])
Traceback (most recent call last):
...
AttributeError: type object 'float' has no attribute 'is_exact'

```

The constructor could try to detect the problem and return an informative message.

Once this is fixed, ticket #22552 is a follow-up ticket that should be fixed easily from the present resolution.

CC:  @mo271 @mkoeppe @videlec @novoselt tmonteil @tscrim

Keywords: polyhedron, base ring

Branch/Commit: af03de82ed07686322db70895a0ab34973888981

Reviewer: Vincent Delecroix

Author: Jean-Philippe Labb√©, Vincent Delecroix, Marcelo Forets

Dependencies: #23345

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22605





---

archive/issue_comments_331044.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -21,35 +21,13 @@\n sage: f\n 1.1\n sage: Polyhedron(vertices=[[f]])\n----------------------------------------------------------------------------\n-AttributeError                            Traceback (most recent call last)\n-<ipython-input-55-aea1b8b1f057> in <module>()\n-----> 1 Polyhedron(vertices=[[f]])\n-\n-/Users/jplab/sage/sage2/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (/Users/jplab/sage/sage2/src/build/cythonized/sage/misc/lazy_import.c:4007)()\n-    387             True\n-    388         \"\"\"\n---> 389         return self._get_object()(*args, **kwds)\n-    390 \n-    391     def __repr__(self):\n-\n-/Users/jplab/sage/sage2/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc in Polyhedron(vertices, rays, lines, ieqs, eqns, ambient_dim, base_ring, minimize, verbose, backend)\n-    490     # Specific backends can override the base_ring\n-    491     from sage.geometry.polyhedron.parent import Polyhedra\n---> 492     parent = Polyhedra(base_ring, ambient_dim, backend=backend)\n-    493     base_ring = parent.base_ring()\n-    494 \n-\n-/Users/jplab/sage/sage2/local/lib/python2.7/site-packages/sage/geometry/polyhedron/parent.pyc in Polyhedra(base_ring, ambient_dim, backend)\n-     89         elif base_ring is RDF:\n-     90             backend = 'cdd'\n----> 91         elif base_ring.is_exact():\n-     92             backend = 'field'\n-     93         else:\n-\n+Traceback (most recent call last):\n+...\n AttributeError: type object 'float' has no attribute 'is_exact'\n \n ```\n+\n+The constructor could try to detect the problem and return an informative message.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-03-15T12:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331044",
    "user": "https://github.com/jplab"
}
```

Description changed:
```diff
--- 
+++ 
@@ -21,35 +21,13 @@
 sage: f
 1.1
 sage: Polyhedron(vertices=[[f]])
----------------------------------------------------------------------------
-AttributeError                            Traceback (most recent call last)
-<ipython-input-55-aea1b8b1f057> in <module>()
-----> 1 Polyhedron(vertices=[[f]])
-
-/Users/jplab/sage/sage2/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (/Users/jplab/sage/sage2/src/build/cythonized/sage/misc/lazy_import.c:4007)()
-    387             True
-    388         """
---> 389         return self._get_object()(*args, **kwds)
-    390 
-    391     def __repr__(self):
-
-/Users/jplab/sage/sage2/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc in Polyhedron(vertices, rays, lines, ieqs, eqns, ambient_dim, base_ring, minimize, verbose, backend)
-    490     # Specific backends can override the base_ring
-    491     from sage.geometry.polyhedron.parent import Polyhedra
---> 492     parent = Polyhedra(base_ring, ambient_dim, backend=backend)
-    493     base_ring = parent.base_ring()
-    494 
-
-/Users/jplab/sage/sage2/local/lib/python2.7/site-packages/sage/geometry/polyhedron/parent.pyc in Polyhedra(base_ring, ambient_dim, backend)
-     89         elif base_ring is RDF:
-     90             backend = 'cdd'
----> 91         elif base_ring.is_exact():
-     92             backend = 'field'
-     93         else:
-
+Traceback (most recent call last):
+...
 AttributeError: type object 'float' has no attribute 'is_exact'
 
 ```
+
+The constructor could try to detect the problem and return an informative message.
 
 Comment: 1
 
```




---

archive/issue_comments_331045.json:
```json
{
    "body": "<a id='comment:3'></a>Indeed. Do we want to convert `float -> RDF` these two are fully compatible?",
    "created_at": "2017-03-15T13:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331045",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Indeed. Do we want to convert `float -> RDF` these two are fully compatible?



---

archive/issue_comments_331046.json:
```json
{
    "body": "<a id='comment:4'></a>If this:\n\n```\nsage: RDF.has_coerce_map_from(float)\nTrue\n```\n\nis all we need, I guess so... It would do a similar trick as for RR with 53 bits of precision...",
    "created_at": "2017-03-15T13:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331046",
    "user": "https://github.com/jplab"
}
```

<a id='comment:4'></a>If this:

```
sage: RDF.has_coerce_map_from(float)
True
```

is all we need, I guess so... It would do a similar trick as for RR with 53 bits of precision...



---

archive/issue_comments_331047.json:
```json
{
    "body": "<a id='comment:5'></a>It is not: coercion has nothing to do with embedding\n\n```\nsage: Zmod(5).has_coerce_map_from(ZZ)\nTrue\nsage: RealField(5).has_coerce_map_from(RealField(256))\nTrue\n```",
    "created_at": "2017-03-15T13:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331047",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>It is not: coercion has nothing to do with embedding

```
sage: Zmod(5).has_coerce_map_from(ZZ)
True
sage: RealField(5).has_coerce_map_from(RealField(256))
True
```



---

archive/issue_comments_331048.json:
```json
{
    "body": "<a id='comment:6'></a>So how to check for the embedding? Simply wrap?",
    "created_at": "2017-03-17T13:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331048",
    "user": "https://github.com/jplab"
}
```

<a id='comment:6'></a>So how to check for the embedding? Simply wrap?



---

archive/issue_comments_331049.json:
```json
{
    "body": "<a id='comment:8'></a>I added a way to catch the float and set the base ring to `RDF`. Now, I'm wondering how we could handle the algebraic numbers in an efficient way. Indeed, it seems that they are automatically converted while they might not need it. \n\n---\nNew commits:",
    "created_at": "2017-03-17T14:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331049",
    "user": "https://github.com/jplab"
}
```

<a id='comment:8'></a>I added a way to catch the float and set the base ring to `RDF`. Now, I'm wondering how we could handle the algebraic numbers in an efficient way. Indeed, it seems that they are automatically converted while they might not need it. 

---
New commits:



---

archive/issue_comments_331050.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-04T14:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331051.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-04T14:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331051",
    "user": "https://github.com/jplab"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331052.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-04T14:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331053.json:
```json
{
    "body": "<a id='comment:12'></a>A polyhedron with **one** non embedded number field should already gives an error. Could you add an example involving only `L`?",
    "created_at": "2017-04-04T16:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331053",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>A polyhedron with **one** non embedded number field should already gives an error. Could you add an example involving only `L`?



---

archive/issue_comments_331054.json:
```json
{
    "body": "<a id='comment:13'></a>Instead of the manual `float -> RDF` you should use `py_scalar_parent` from `sage.structure.coercion`. By the way, where the conversion `Python int -> ZZ` is happening? This should be done at the same time.",
    "created_at": "2017-04-04T16:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331054",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Instead of the manual `float -> RDF` you should use `py_scalar_parent` from `sage.structure.coercion`. By the way, where the conversion `Python int -> ZZ` is happening? This should be done at the same time.



---

archive/issue_comments_331055.json:
```json
{
    "body": "<a id='comment:14'></a>Much more resaonable code path in my branch. Though the error message could still be elaborated.\n\n---\nNew commits:",
    "created_at": "2017-04-04T19:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331055",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>Much more resaonable code path in my branch. Though the error message could still be elaborated.

---
New commits:



---

archive/issue_comments_331056.json:
```json
{
    "body": "<a id='comment:15'></a>BTW, I think that the following would better be handled by `Polyhedra` (constructor of the parent)\n\n```\n# TODO: find a more robust way of checking that the coefficients are indeed\n# real numbers\nif base_ring not in Rings() or not RDF.has_coerce_map_from(base_ring):\n    raise ValueError(\"invalid base ring\")\n```",
    "created_at": "2017-04-04T19:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331056",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>BTW, I think that the following would better be handled by `Polyhedra` (constructor of the parent)

```
# TODO: find a more robust way of checking that the coefficients are indeed
# real numbers
if base_ring not in Rings() or not RDF.has_coerce_map_from(base_ring):
    raise ValueError("invalid base ring")
```



---

archive/issue_comments_331057.json:
```json
{
    "body": "<a id='comment:16'></a>I was also hesitating about where to put the handling of the error... But since there was not proper `base_ring` to pass to the parent, I thought it is better to stop there... But then, looking up at the documentation on top of the constructor... there is not much...\n\nI then looked at the output of `Polyhedron?` and it is there... So I guess it is a good idea to put it in the constructor?\n\nI will have a deeper look at your commit asap. I would be happy to have a cleaner and clearer constructor...",
    "created_at": "2017-04-04T20:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331057",
    "user": "https://github.com/jplab"
}
```

<a id='comment:16'></a>I was also hesitating about where to put the handling of the error... But since there was not proper `base_ring` to pass to the parent, I thought it is better to stop there... But then, looking up at the documentation on top of the constructor... there is not much...

I then looked at the output of `Polyhedron?` and it is there... So I guess it is a good idea to put it in the constructor?

I will have a deeper look at your commit asap. I would be happy to have a cleaner and clearer constructor...



---

archive/issue_comments_331058.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-05T07:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331058",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331059.json:
```json
{
    "body": "<a id='comment:17'></a>I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...\n\nIf you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?\n\nI have #22754 in mind as an example.\n\nI'll try to put some time on this, but I will look at the trac only sporadically in the next 2 weeks.",
    "created_at": "2017-04-05T07:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331059",
    "user": "https://github.com/jplab"
}
```

<a id='comment:17'></a>I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...

If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?

I have #22754 in mind as an example.

I'll try to put some time on this, but I will look at the trac only sporadically in the next 2 weeks.



---

archive/issue_comments_331060.json:
```json
{
    "body": "<a id='comment:18'></a>Overall I think the distinction of `base_ring=QQ` and `base_ring=ZZ` is completely unnecessary. The constructor could just unconditionally replace the given base ring by its fraction field.",
    "created_at": "2017-04-06T18:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331060",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Overall I think the distinction of `base_ring=QQ` and `base_ring=ZZ` is completely unnecessary. The constructor could just unconditionally replace the given base ring by its fraction field.



---

archive/issue_comments_331061.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:\n> Overall I think the distinction of `base_ring=QQ` and `base_ring=ZZ` is completely unnecessary. The constructor could just unconditionally replace the given base ring by its fraction field.\n\n\nBut this distinction is used in order to pick the proper parent isn't it? So what about the distinction of the two parent classes `_QQ` and `_ZZ`? It is true that a rational polytope has an Ehrhart quasipolynomial which is not necessarily a polynomial... Well, well...\n\nIt is true that this distinction makes life more difficult in some cases...",
    "created_at": "2017-04-06T20:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331061",
    "user": "https://github.com/jplab"
}
```

<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:
> Overall I think the distinction of `base_ring=QQ` and `base_ring=ZZ` is completely unnecessary. The constructor could just unconditionally replace the given base ring by its fraction field.


But this distinction is used in order to pick the proper parent isn't it? So what about the distinction of the two parent classes `_QQ` and `_ZZ`? It is true that a rational polytope has an Ehrhart quasipolynomial which is not necessarily a polynomial... Well, well...

It is true that this distinction makes life more difficult in some cases...



---

archive/issue_comments_331062.json:
```json
{
    "body": "<a id='comment:20'></a>Yes, that's what I mean; there is no need to distinguish the parents for QQ and ZZ. \n\nThe method for computing an ehrhart polynomial should also be available for rational polytopes; being a lattice polytope is merely a sufficient condition for getting an ehrhart polynomial. If the user asks for the ehrhart polynomial but the counting function is a quasipolynomial (with a true period), then an exception should be raised by the method.",
    "created_at": "2017-04-06T21:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331062",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Yes, that's what I mean; there is no need to distinguish the parents for QQ and ZZ. 

The method for computing an ehrhart polynomial should also be available for rational polytopes; being a lattice polytope is merely a sufficient condition for getting an ehrhart polynomial. If the user asks for the ehrhart polynomial but the counting function is a quasipolynomial (with a true period), then an exception should be raised by the method.



---

archive/issue_comments_331063.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 mkoeppe]:\n> Yes, that's what I mean; there is no need to distinguish the parents for QQ and ZZ. \n> \n> The method for computing an ehrhart polynomial should also be available for rational polytopes; being a lattice polytope is merely a sufficient condition for getting an ehrhart polynomial. If the user asks for the ehrhart polynomial but the counting function is a quasipolynomial (with a true period), then an exception should be raised by the method. \n\n\nAs far as I understand, what you propose is way beyond the scope of this ticket. The simplification I wrote keep the ancient behavior (up to the fact that rationals are now treated as rationals).",
    "created_at": "2017-04-07T06:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331063",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>Replying to [comment:20 mkoeppe]:
> Yes, that's what I mean; there is no need to distinguish the parents for QQ and ZZ. 
> 
> The method for computing an ehrhart polynomial should also be available for rational polytopes; being a lattice polytope is merely a sufficient condition for getting an ehrhart polynomial. If the user asks for the ehrhart polynomial but the counting function is a quasipolynomial (with a true period), then an exception should be raised by the method. 


As far as I understand, what you propose is way beyond the scope of this ticket. The simplification I wrote keep the ancient behavior (up to the fact that rationals are now treated as rationals).



---

archive/issue_comments_331064.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:17 jipilab]:\n> I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...\n> \n> If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?\n\n\nTrue! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.",
    "created_at": "2017-04-07T06:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331064",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>Replying to [comment:17 jipilab]:
> I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...
> 
> If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?


True! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.



---

archive/issue_comments_331065.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:\n> Replying to [comment:17 jipilab]:\n> > I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...\n> > \n> > If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?\n\n> \n> True! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.\n\n\nWhere is this happening!? I don't see the code path that you are mentioning...",
    "created_at": "2017-04-07T06:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331065",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:
> Replying to [comment:17 jipilab]:
> > I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...
> > 
> > If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?

> 
> True! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.


Where is this happening!? I don't see the code path that you are mentioning...



---

archive/issue_comments_331066.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-07T06:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331066",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331067.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 vdelecroix]:\n> Replying to [comment:22 vdelecroix]:\n> > Replying to [comment:17 jipilab]:\n> > > I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...\n> > > \n> > > If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?\n\n> > \n> > True! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.\n\n> \n> Where is this happening!? I don't see the code path that you are mentioning...\n\n\nSorry, got confused in reading the code and running an example in my head. If the user specified a `base_ring` it won't go where I thought it would because of the if, elif, else clause... So nevermind... my bad!",
    "created_at": "2017-04-07T11:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331067",
    "user": "https://github.com/jplab"
}
```

<a id='comment:25'></a>Replying to [comment:23 vdelecroix]:
> Replying to [comment:22 vdelecroix]:
> > Replying to [comment:17 jipilab]:
> > > I'm looking at the last commit and at line 488 of the constructor, I got puzzled a bit...
> > > 
> > > If you give a polyhedron with an `H`-representation and specified the `base_ring=ZZ`, then it would convert it automatically to `QQ`? What if the user is clever and knows that the `H`-representation that is given really describes a lattice polytope and would like to specify its parent to be Polyhedron_ZZ. So forcing the `base_ring` should be possible?

> > 
> > True! The constructor should not overwrite `base_ring` if it was set by the user. I will add a commit.

> 
> Where is this happening!? I don't see the code path that you are mentioning...


Sorry, got confused in reading the code and running an example in my head. If the user specified a `base_ring` it won't go where I thought it would because of the if, elif, else clause... So nevermind... my bad!



---

archive/issue_comments_331068.json:
```json
{
    "body": "<a id='comment:28'></a>Oops, sorry. Didn't want to change the branch to do the rebase. My bad...\n\nI'll change it back.\n\n---\nNew commits:",
    "created_at": "2017-05-04T10:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331068",
    "user": "https://github.com/jplab"
}
```

<a id='comment:28'></a>Oops, sorry. Didn't want to change the branch to do the rebase. My bad...

I'll change it back.

---
New commits:



---

archive/issue_comments_331069.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-04T10:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331069",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331070.json:
```json
{
    "body": "<a id='comment:30'></a>Tests passed on base.py and constructor.py with Sage-8.0.beta3.\n\nThe bots didn't have a look at this yet?!",
    "created_at": "2017-05-04T10:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331070",
    "user": "https://github.com/jplab"
}
```

<a id='comment:30'></a>Tests passed on base.py and constructor.py with Sage-8.0.beta3.

The bots didn't have a look at this yet?!



---

archive/issue_comments_331071.json:
```json
{
    "body": "<a id='comment:31'></a>The bots are not testing many things see https://github.com/sagemath/sage-patchbot/issues/76",
    "created_at": "2017-05-04T10:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331071",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>The bots are not testing many things see https://github.com/sagemath/sage-patchbot/issues/76



---

archive/issue_comments_331072.json:
```json
{
    "body": "<a id='comment:32'></a>(I just launched mine manually)",
    "created_at": "2017-05-04T10:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331072",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>(I just launched mine manually)



---

archive/issue_comments_331073.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,35 @@\n+These error messages are not really informative of what the problem really is:\n \n+```\n+\n+sage: K = NumberField(x^2-2,'s')\n+sage: s = K.0\n+sage: L = NumberField(x^3-2,'t')\n+sage: t = L.0\n+sage: P = Polyhedron(vertices = [[0,s],[t,0]])\n+Traceback (most recent call last):\n+...\n+AttributeError: 'Objects_with_category' object has no attribute 'is_exact'\n+\n+```\n+\n+similar problem with `floats`:\n+\n+```\n+\n+sage: f = float(1.1)\n+sage: f\n+1.1\n+sage: Polyhedron(vertices=[[f]])\n+Traceback (most recent call last):\n+...\n+AttributeError: type object 'float' has no attribute 'is_exact'\n+\n+```\n+\n+The constructor could try to detect the problem and return an informative message.\n+\n+Once this is fixed, ticket #22552 is a follow-up ticket that should be fixed easily from the present resolution.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-05-04T10:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331073",
    "user": "https://github.com/jplab"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,35 @@
+These error messages are not really informative of what the problem really is:
 
+```
+
+sage: K = NumberField(x^2-2,'s')
+sage: s = K.0
+sage: L = NumberField(x^3-2,'t')
+sage: t = L.0
+sage: P = Polyhedron(vertices = [[0,s],[t,0]])
+Traceback (most recent call last):
+...
+AttributeError: 'Objects_with_category' object has no attribute 'is_exact'
+
+```
+
+similar problem with `floats`:
+
+```
+
+sage: f = float(1.1)
+sage: f
+1.1
+sage: Polyhedron(vertices=[[f]])
+Traceback (most recent call last):
+...
+AttributeError: type object 'float' has no attribute 'is_exact'
+
+```
+
+The constructor could try to detect the problem and return an informative message.
+
+Once this is fixed, ticket #22552 is a follow-up ticket that should be fixed easily from the present resolution.
 
 Comment: 1
 
```




---

archive/issue_comments_331074.json:
```json
{
    "body": "<a id='comment:34'></a>`.. TESTS:` should be `TESTS:` (no `.. `)",
    "created_at": "2017-05-04T11:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331074",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'></a>`.. TESTS:` should be `TESTS:` (no `.. `)



---

archive/issue_comments_331075.json:
```json
{
    "body": "<a id='comment:35'></a>And in the doctest for float it would actually be good to also test `int` and `Fraction` (from the Python module fractions).",
    "created_at": "2017-05-04T11:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331075",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>And in the doctest for float it would actually be good to also test `int` and `Fraction` (from the Python module fractions).



---

archive/issue_comments_331076.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-10T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331076",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331077.json:
```json
{
    "body": "<a id='comment:36'></a>Some MIP's tests are broken by the code. I will look into this and correct the docstring too.",
    "created_at": "2017-05-10T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331077",
    "user": "https://github.com/jplab"
}
```

<a id='comment:36'></a>Some MIP's tests are broken by the code. I will look into this and correct the docstring too.



---

archive/issue_comments_331078.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-06-30T09:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331078",
    "user": "https://github.com/mforets"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_331079.json:
```json
{
    "body": "<a id='comment:37'></a>hi, \n\ni've adjusted the doctests in MIP and added the `int` construction test to JP's branch.\n\ni had trouble with Python's `Fraction` though:\n\n```\nsage:\u00a0from\u00a0fractions\u00a0import\u00a0Fraction\nsage:\u00a0Polyhedron(vertices=[[Fraction(int(8),\u00a0int(6))]])\n---------------------------------------------------------------------------\nValueError\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Traceback\u00a0(most\u00a0recent\u00a0call\u00a0last)\n<ipython-input-27-199a9229f10f>\u00a0in\u00a0<module>()\n---->\u00a01\u00a0Polyhedron(vertices=[[Fraction(int(Integer(8)),\u00a0int(Integer(6)))]])\n\n\u00a0\n/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc\u00a0in\u00a0Polyhedron(vertices,\u00a0rays,\u00a0lines,\u00a0ieqs,\u00a0eqns,\u00a0ambient_dim,\u00a0base_ring,\u00a0minimi\nze,\u00a0verbose,\u00a0backend)\n\u00a0\u00a0\u00a0\u00a0497\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0real\u00a0numbers\n\u00a0\u00a0\u00a0\u00a0498\u00a0\u00a0\u00a0\u00a0\u00a0if\u00a0base_ring\u00a0not\u00a0in\u00a0Rings()\u00a0or\u00a0not\u00a0RDF.has_coerce_map_from(base_ring):\n-->\u00a0499\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0raise\u00a0ValueError(\"invalid\u00a0base\u00a0ring\")\n\u00a0\u00a0\u00a0\u00a0500\n\u00a0\u00a0\u00a0\u00a0501\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0TODO:\u00a0remove\u00a0this\u00a0hack\n\u00a0\nValueError:\u00a0invalid\u00a0base\u00a0ring\n```\n\nany ideas? \n\n---\nNew commits:",
    "created_at": "2017-06-30T09:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331079",
    "user": "https://github.com/mforets"
}
```

<a id='comment:37'></a>hi, 

i've adjusted the doctests in MIP and added the `int` construction test to JP's branch.

i had trouble with Python's `Fraction` though:

```
sage:¬†from¬†fractions¬†import¬†Fraction
sage:¬†Polyhedron(vertices=[[Fraction(int(8),¬†int(6))]])
---------------------------------------------------------------------------
ValueError¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†Traceback¬†(most¬†recent¬†call¬†last)
<ipython-input-27-199a9229f10f>¬†in¬†<module>()
---->¬†1¬†Polyhedron(vertices=[[Fraction(int(Integer(8)),¬†int(Integer(6)))]])

¬†
/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc¬†in¬†Polyhedron(vertices,¬†rays,¬†lines,¬†ieqs,¬†eqns,¬†ambient_dim,¬†base_ring,¬†minimi
ze,¬†verbose,¬†backend)
¬†¬†¬†¬†497¬†¬†¬†¬†¬†#¬†real¬†numbers
¬†¬†¬†¬†498¬†¬†¬†¬†¬†if¬†base_ring¬†not¬†in¬†Rings()¬†or¬†not¬†RDF.has_coerce_map_from(base_ring):
-->¬†499¬†¬†¬†¬†¬†¬†¬†¬†¬†raise¬†ValueError("invalid¬†base¬†ring")
¬†¬†¬†¬†500
¬†¬†¬†¬†501¬†¬†¬†¬†¬†#¬†TODO:¬†remove¬†this¬†hack
¬†
ValueError:¬†invalid¬†base¬†ring
```

any ideas? 

---
New commits:



---

archive/issue_events_058980.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-06-30T09:22:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22605#event-58980"
}
```



---

archive/issue_comments_331080.json:
```json
{
    "body": "<a id='comment:38'></a>I think that those two functions should be fixed to work with `Fraction`\n\n```\nsage: from sage.structure.coerce import py_scalar_to_element, py_scalar_parent\nsage: f = fractions.Fraction(2r, 3r)\nsage: py_scalar_parent(type(f))    # should be QQ\nsage: py_scalar_to_element(f)      # should be Rational\nFraction(2, 3)\n```\n(could be a dependency ticket)",
    "created_at": "2017-06-30T10:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331080",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>I think that those two functions should be fixed to work with `Fraction`

```
sage: from sage.structure.coerce import py_scalar_to_element, py_scalar_parent
sage: f = fractions.Fraction(2r, 3r)
sage: py_scalar_parent(type(f))    # should be QQ
sage: py_scalar_to_element(f)      # should be Rational
Fraction(2, 3)
```
(could be a dependency ticket)



---

archive/issue_comments_331081.json:
```json
{
    "body": "<a id='comment:39'></a>see #23345",
    "created_at": "2017-06-30T14:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331081",
    "user": "https://github.com/videlec"
}
```

<a id='comment:39'></a>see #23345



---

archive/issue_comments_331082.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-08T11:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331083.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-07-12T08:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331083",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_331084.json:
```json
{
    "body": "<a id='comment:41'></a>Hi all,\n\nI believe that the last issues have been addressed by Marcelo, so I set this to \"needs review\".\n\nWhat is the error given by the bot? A time-out? Yet again, some unknown behavior to me.",
    "created_at": "2017-07-12T08:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331084",
    "user": "https://github.com/jplab"
}
```

<a id='comment:41'></a>Hi all,

I believe that the last issues have been addressed by Marcelo, so I set this to "needs review".

What is the error given by the bot? A time-out? Yet again, some unknown behavior to me.



---

archive/issue_comments_331085.json:
```json
{
    "body": "<a id='comment:42'></a>Two problems from the doctest need to be fixed\n\n```\n$ sage -t geometry/polyhedron/constructor.py\nRunning doctests with ID 2017-07-13-19-29-08-cb0892b4.\nGit branch: 22605-8.0.rc1\nUsing --optional=bliss,lrslib,mpir,pandoc_attributes,pandocfilters,python2,rst2ipynb,sage\nDoctesting 1 file.\nsage -t --warn-long 75.0 geometry/polyhedron/constructor.py\n**********************************************************************\nFile \"geometry/polyhedron/constructor.py\", line 443, in sage.geometry.polyhedron.constructor.?\nFailed example:\n    Polyhedron(vertices=[[f]])\nException raised:\n    Traceback (most recent call last):\n    ...\n    ValueError: invalid base ring\n**********************************************************************\n1 item had failures:\n   1 of  27 in sage.geometry.polyhedron.constructor.?\n    [59 tests, 1 failure, 0.55 s]\n----------------------------------------------------------------------\nsage -t --warn-long 75.0 geometry/polyhedron/constructor.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n```\n$ sage -t categories/finite_coxeter_groups.py\nRunning doctests with ID 2017-07-13-19-30-14-e608e41e.\nGit branch: 22605-8.0.rc1\nUsing --optional=bliss,lrslib,mpir,pandoc_attributes,pandocfilters,python2,rst2ipynb,sage\nDoctesting 1 file.\nsage -t --warn-long 75.0 categories/finite_coxeter_groups.py\n**********************************************************************\nFile \"categories/finite_coxeter_groups.py\", line 720, in sage.categories.finite_coxeter_groups.FiniteCoxeterGroups.ParentMethods.permutahedron\nFailed example:\n    W.permutahedron()\nException raised:\n    Traceback (most recent call last):\n    ...\n    ValueError: invalid base ring\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.categories.finite_coxeter_groups.FiniteCoxeterGroups.ParentMethods.permutahedron\n    [151 tests, 1 failure, 5.21 s]\n----------------------------------------------------------------------\nsage -t --warn-long 75.0 categories/finite_coxeter_groups.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2017-07-13T17:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331085",
    "user": "https://github.com/videlec"
}
```

<a id='comment:42'></a>Two problems from the doctest need to be fixed

```
$ sage -t geometry/polyhedron/constructor.py
Running doctests with ID 2017-07-13-19-29-08-cb0892b4.
Git branch: 22605-8.0.rc1
Using --optional=bliss,lrslib,mpir,pandoc_attributes,pandocfilters,python2,rst2ipynb,sage
Doctesting 1 file.
sage -t --warn-long 75.0 geometry/polyhedron/constructor.py
**********************************************************************
File "geometry/polyhedron/constructor.py", line 443, in sage.geometry.polyhedron.constructor.?
Failed example:
    Polyhedron(vertices=[[f]])
Exception raised:
    Traceback (most recent call last):
    ...
    ValueError: invalid base ring
**********************************************************************
1 item had failures:
   1 of  27 in sage.geometry.polyhedron.constructor.?
    [59 tests, 1 failure, 0.55 s]
----------------------------------------------------------------------
sage -t --warn-long 75.0 geometry/polyhedron/constructor.py  # 1 doctest failed
----------------------------------------------------------------------
```

```
$ sage -t categories/finite_coxeter_groups.py
Running doctests with ID 2017-07-13-19-30-14-e608e41e.
Git branch: 22605-8.0.rc1
Using --optional=bliss,lrslib,mpir,pandoc_attributes,pandocfilters,python2,rst2ipynb,sage
Doctesting 1 file.
sage -t --warn-long 75.0 categories/finite_coxeter_groups.py
**********************************************************************
File "categories/finite_coxeter_groups.py", line 720, in sage.categories.finite_coxeter_groups.FiniteCoxeterGroups.ParentMethods.permutahedron
Failed example:
    W.permutahedron()
Exception raised:
    Traceback (most recent call last):
    ...
    ValueError: invalid base ring
**********************************************************************
1 item had failures:
   1 of   6 in sage.categories.finite_coxeter_groups.FiniteCoxeterGroups.ParentMethods.permutahedron
    [151 tests, 1 failure, 5.21 s]
----------------------------------------------------------------------
sage -t --warn-long 75.0 categories/finite_coxeter_groups.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_331086.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-13T17:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331086",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331087.json:
```json
{
    "body": "<a id='comment:43'></a>The following comment in the test block `Check that giving ``float`` and ``int`` input gets converted to `\\RDF`` should be modified since int are converted to elements of ZZ and not RDF. Furthermore, replace ``\\RDF`` by ```RDF```.",
    "created_at": "2017-07-13T17:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331087",
    "user": "https://github.com/videlec"
}
```

<a id='comment:43'></a>The following comment in the test block `Check that giving ``float`` and ``int`` input gets converted to `\RDF`` should be modified since int are converted to elements of ZZ and not RDF. Furthermore, replace ``\RDF`` by ```RDF```.



---

archive/issue_comments_331088.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-23T19:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331089.json:
```json
{
    "body": "<a id='comment:45'></a>- comment:42, doctest in `constructor.py`, done (upon merging with #23345)\n- comment:42, doctest in `finite_coxeter_groups.py` : i'm confused. the UniversalCyclotomicField should still be supported in the constructor, right? in this case:\n\n    - the base ring is `UniversalCyclotomicField()`, and `base_ring not in Rings()` is False\n    - `RDF.has_coerce_map_from(UniversalCyclotomicField())` is also False\n- comment:43, done",
    "created_at": "2017-07-23T19:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331089",
    "user": "https://github.com/mforets"
}
```

<a id='comment:45'></a>- comment:42, doctest in `constructor.py`, done (upon merging with #23345)
- comment:42, doctest in `finite_coxeter_groups.py` : i'm confused. the UniversalCyclotomicField should still be supported in the constructor, right? in this case:

    - the base ring is `UniversalCyclotomicField()`, and `base_ring not in Rings()` is False
    - `RDF.has_coerce_map_from(UniversalCyclotomicField())` is also False
- comment:43, done



---

archive/issue_comments_331090.json:
```json
{
    "body": "<a id='comment:46'></a>The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?",
    "created_at": "2017-07-23T21:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331090",
    "user": "https://github.com/videlec"
}
```

<a id='comment:46'></a>The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?



---

archive/issue_comments_331091.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 vdelecroix]:\n> The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?\n\n\nOk, thanks for the clarification. i look forward to suggestions on that choice (since i don't have one).",
    "created_at": "2017-07-25T14:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331091",
    "user": "https://github.com/mforets"
}
```

<a id='comment:47'></a>Replying to [comment:46 vdelecroix]:
> The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?


Ok, thanks for the clarification. i look forward to suggestions on that choice (since i don't have one).



---

archive/issue_comments_331092.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 mforets]:\n> Replying to [comment:46 vdelecroix]:\n> > The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?\n\n> \n> Ok, thanks for the clarification. i look forward to suggestions on that choice (since i don't have one).\n\n\nI think an error is safer. The code in Coxeter group that constructs the polytope should call `Polyhedron` with an appropriate base ring (like `AA` or `QQ[cos(pi/q)]`).",
    "created_at": "2017-07-25T14:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331092",
    "user": "https://github.com/videlec"
}
```

<a id='comment:48'></a>Replying to [comment:47 mforets]:
> Replying to [comment:46 vdelecroix]:
> > The universal cyclotomic field is the **complex** field generated by all roots of unity! We don't want to deal with that in polyhedron constructor (as we don't for `QQbar`). For both `QQbar` and `UCF` we can either try conversion to `AA` or raise an error. Which one do you prefer?

> 
> Ok, thanks for the clarification. i look forward to suggestions on that choice (since i don't have one).


I think an error is safer. The code in Coxeter group that constructs the polytope should call `Polyhedron` with an appropriate base ring (like `AA` or `QQ[cos(pi/q)]`).



---

archive/issue_comments_331093.json:
```json
{
    "body": "<a id='comment:49'></a>The following does work\n\n```\nsage: W = CoxeterGroup(['I',7])\nsage: n = W.one().canonical_matrix().rank()\nsage: weights = W.fundamental_weights()\nsage: point = [ZZ.one()] * n\nsage: v = sum(point[i-1] * weights[i] for i in weights.keys())\nsage: vertices = [(v*w).change_ring(AA) for w in W]\nsage: Polyhedron(vertices)\n```\nIt is perhaps not optimal, but fixes the issue with Coxeter groups.",
    "created_at": "2017-07-25T14:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331093",
    "user": "https://github.com/videlec"
}
```

<a id='comment:49'></a>The following does work

```
sage: W = CoxeterGroup(['I',7])
sage: n = W.one().canonical_matrix().rank()
sage: weights = W.fundamental_weights()
sage: point = [ZZ.one()] * n
sage: v = sum(point[i-1] * weights[i] for i in weights.keys())
sage: vertices = [(v*w).change_ring(AA) for w in W]
sage: Polyhedron(vertices)
```
It is perhaps not optimal, but fixes the issue with Coxeter groups.



---

archive/issue_comments_331094.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-25T16:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331095.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-25T16:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331095",
    "user": "https://github.com/mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331096.json:
```json
{
    "body": "<a id='comment:52'></a>disclaimer: i didn't run those tests which require the optional GAP3 package 'chevie'. if someone has it installed already, could you try it please?",
    "created_at": "2017-07-25T16:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331096",
    "user": "https://github.com/mforets"
}
```

<a id='comment:52'></a>disclaimer: i didn't run those tests which require the optional GAP3 package 'chevie'. if someone has it installed already, could you try it please?



---

archive/issue_comments_331097.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:52 mforets]:\n> disclaimer: i didn't run those tests which require the optional GAP3 package 'chevie'. if someone has it installed already, could you try it please? \n\n\nTravis: After this ticket, it will be forbidden to use `UCF` and `QQbar` as ground fields for polytopes. I believe that you have GAP3 installed. Could you check that we do not break anything for generating the polyhedra related to Coxeter groups?",
    "created_at": "2017-07-26T07:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331097",
    "user": "https://github.com/videlec"
}
```

<a id='comment:53'></a>Replying to [comment:52 mforets]:
> disclaimer: i didn't run those tests which require the optional GAP3 package 'chevie'. if someone has it installed already, could you try it please? 


Travis: After this ticket, it will be forbidden to use `UCF` and `QQbar` as ground fields for polytopes. I believe that you have GAP3 installed. Could you check that we do not break anything for generating the polyhedra related to Coxeter groups?



---

archive/issue_comments_331098.json:
```json
{
    "body": "<a id='comment:54'></a>i was getting:\n\n```\nsage: W = ReflectionGroup(['A',3])\n...\nImportError: the GAP3 package 'chevie' is needed to work with (complex) reflection groups\nsage: is_package_installed(\"gap3\")\nFalse\n```\n\nand got scared with the message below.. but installing turned out to be very fast!\n\n```\n===========================\u00a0WARNING\u00a0===========================\nYou\u00a0are\u00a0about\u00a0to\u00a0download\u00a0and\u00a0install\u00a0the\u00a0experimental\u00a0package\ngap3-01may17.\u00a0\u00a0This\u00a0probably\u00a0won't\u00a0work\u00a0at\u00a0all\u00a0for\u00a0you!\u00a0There\nis\u00a0no\u00a0guarantee\u00a0that\u00a0it\u00a0will\u00a0build\u00a0correctly,\u00a0or\u00a0behave\u00a0as\nexpected.\u00a0Use\u00a0at\u00a0your\u00a0own\u00a0risk!\n===============================================================\n...\n```\n\nanyway, testing with `--optional=gap3` flag i do find problems. those tests with the `ReflectionGroup` and integer base ring were failing. \n\nin the new commit, i'm 'hardcoding' the base ring that is passed to the constructor to be QQ in those cases (before, this was guessed from the vertices). what do you think?",
    "created_at": "2017-07-26T08:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331098",
    "user": "https://github.com/mforets"
}
```

<a id='comment:54'></a>i was getting:

```
sage: W = ReflectionGroup(['A',3])
...
ImportError: the GAP3 package 'chevie' is needed to work with (complex) reflection groups
sage: is_package_installed("gap3")
False
```

and got scared with the message below.. but installing turned out to be very fast!

```
===========================¬†WARNING¬†===========================
You¬†are¬†about¬†to¬†download¬†and¬†install¬†the¬†experimental¬†package
gap3-01may17.¬†¬†This¬†probably¬†won't¬†work¬†at¬†all¬†for¬†you!¬†There
is¬†no¬†guarantee¬†that¬†it¬†will¬†build¬†correctly,¬†or¬†behave¬†as
expected.¬†Use¬†at¬†your¬†own¬†risk!
===============================================================
...
```

anyway, testing with `--optional=gap3` flag i do find problems. those tests with the `ReflectionGroup` and integer base ring were failing. 

in the new commit, i'm 'hardcoding' the base ring that is passed to the constructor to be QQ in those cases (before, this was guessed from the vertices). what do you think?



---

archive/issue_comments_331099.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-26T09:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331100.json:
```json
{
    "body": "<a id='comment:56'></a>with respect to the tests, it also works to infer the base ring from the sum over weights v, that is:\n\n```\nif base_ring is None:\n    base_ring = v.base_ring()\n```\n\ninstead of\n\n```\nif base_ring is None:\n    base_ring = self.base_ring()\n    if base_ring is ZZ:\n        base_ring = QQ\n```",
    "created_at": "2017-07-26T09:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331100",
    "user": "https://github.com/mforets"
}
```

<a id='comment:56'></a>with respect to the tests, it also works to infer the base ring from the sum over weights v, that is:

```
if base_ring is None:
    base_ring = v.base_ring()
```

instead of

```
if base_ring is None:
    base_ring = self.base_ring()
    if base_ring is ZZ:
        base_ring = QQ
```



---

archive/issue_comments_331101.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-26T12:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331101",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331102.json:
```json
{
    "body": "<a id='comment:57'></a>`@`Marcelo: this beahvior is bad\n\n```\nsage: W = CoxeterGroup(['I',7])\nsage: W.permutahedron(base_ring=QQbar).base_ring() is QQbar\nFalse\n```\nIf the user supplies explicitely a `base_ring` in the method `permutahedron()` then it should be used. The above example should be an error (that would be raised by the polyhedron constructor). The automatic conversion `QQbar -> AA` and `UCF -> AA` should only be done when the user calls `permutahedron()` without specifying the base ring.",
    "created_at": "2017-07-26T12:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331102",
    "user": "https://github.com/videlec"
}
```

<a id='comment:57'></a>`@`Marcelo: this beahvior is bad

```
sage: W = CoxeterGroup(['I',7])
sage: W.permutahedron(base_ring=QQbar).base_ring() is QQbar
False
```
If the user supplies explicitely a `base_ring` in the method `permutahedron()` then it should be used. The above example should be an error (that would be raised by the polyhedron constructor). The automatic conversion `QQbar -> AA` and `UCF -> AA` should only be done when the user calls `permutahedron()` without specifying the base ring.



---

archive/issue_comments_331103.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-26T18:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331104.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-26T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331104",
    "user": "https://github.com/mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331105.json:
```json
{
    "body": "<a id='comment:60'></a>Here\n\n```\n+            if base_ring is None and v.base_ring() in [UniversalCyclotomicField(), QQbar]:\n+                    vertices = [(v*w).change_ring(AA) for w in self]\n```\nyou have an identation with 8 spaces!",
    "created_at": "2017-07-27T10:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331105",
    "user": "https://github.com/videlec"
}
```

<a id='comment:60'></a>Here

```
+            if base_ring is None and v.base_ring() in [UniversalCyclotomicField(), QQbar]:
+                    vertices = [(v*w).change_ring(AA) for w in self]
```
you have an identation with 8 spaces!



---

archive/issue_comments_331106.json:
```json
{
    "body": "<a id='comment:61'></a>And concerning the same piece of code, it would be simpler to do\n\n```\nvertices = [v*w for w in self]\nif base_ring is None and v.base_ring() in [UniversalCyclotomicField(), QQbar]:\n    vertices = [v.change_ring(AA) for v in vertices]\n    base_ring = AA\n```",
    "created_at": "2017-07-27T10:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331106",
    "user": "https://github.com/videlec"
}
```

<a id='comment:61'></a>And concerning the same piece of code, it would be simpler to do

```
vertices = [v*w for w in self]
if base_ring is None and v.base_ring() in [UniversalCyclotomicField(), QQbar]:
    vertices = [v.change_ring(AA) for v in vertices]
    base_ring = AA
```



---

archive/issue_comments_331107.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-27T11:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331108.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:62 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                     |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n> |[af03de8](https://git.sagemath.org/sage.git/commit/?id=af03de82ed07686322db70895a0ab34973888981)|`fix indentation issue, and simplify`|\n\n\n`@`vdelec: you're right, thanks.",
    "created_at": "2017-07-27T11:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331108",
    "user": "https://github.com/mforets"
}
```

<a id='comment:63'></a>Replying to [comment:62 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                     |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
> |[af03de8](https://git.sagemath.org/sage.git/commit/?id=af03de82ed07686322db70895a0ab34973888981)|`fix indentation issue, and simplify`|


`@`vdelec: you're right, thanks.



---

archive/issue_comments_331109.json:
```json
{
    "body": "<a id='comment:64'></a>This is a great improvement! Thank you!",
    "created_at": "2017-07-27T13:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331109",
    "user": "https://github.com/videlec"
}
```

<a id='comment:64'></a>This is a great improvement! Thank you!



---

archive/issue_comments_331110.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-27T13:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331110",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331111.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-29T15:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22605#issuecomment-331111",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058981.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T15:30:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22605#event-58981"
}
```
