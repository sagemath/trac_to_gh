# Issue 22391: Always use PPL for facet normals of lattice polytopes

archive/issues_022154.json:
```json
{
    "body": "Keywords: sd91, sd90\n\nA follow up to #22310. As promised there, this switch makes even full-dimensional polytopes faster, on the same example we now get\n\n```\nsage: timeit(\"LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()\")\n625 loops, best of 3: 976 \u00b5s per loop\n```\nThe reason is that dimension computation used to be quite complicated.\n\nNext in the chain of lattice polytope improvements is #22524\n\nIssue created by migration from https://trac.sagemath.org/ticket/22391\n\n",
    "closed_at": "2017-10-29T10:32:11Z",
    "created_at": "2017-02-18T22:22:15Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Always use PPL for facet normals of lattice polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22391",
    "user": "https://github.com/novoselt"
}
```
Keywords: sd91, sd90

A follow up to #22310. As promised there, this switch makes even full-dimensional polytopes faster, on the same example we now get

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
625 loops, best of 3: 976 Âµs per loop
```
The reason is that dimension computation used to be quite complicated.

Next in the chain of lattice polytope improvements is #22524

Issue created by migration from https://trac.sagemath.org/ticket/22391





---

archive/issue_comments_307437.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-18T22:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307437",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_307438.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-02-18T22:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307438",
    "user": "https://github.com/novoselt"
}
```

Last 10 new commits:



---

archive/issue_comments_307439.json:
```json
{
    "body": "I successfully installed this patch and tried some variants on the example.  Speed seems to work as advertised:\n\n```\nsage: sim = ReflexivePolytope(3,0)\nsage: timeit(\"sim.facet_normals()\")\n625 loops, best of 3: 576 ns per loop\n```",
    "created_at": "2017-09-28T16:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307439",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

I successfully installed this patch and tried some variants on the example.  Speed seems to work as advertised:

```
sage: sim = ReflexivePolytope(3,0)
sage: timeit("sim.facet_normals()")
625 loops, best of 3: 576 ns per loop
```



---

archive/issue_comments_307440.json:
```json
{
    "body": "Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.",
    "created_at": "2017-09-29T06:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307440",
    "user": "https://github.com/videlec"
}
```

Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.



---

archive/issue_comments_307441.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.\n\n\nThe interest here is mostly in polytopes of dimensions 3-4-5, when the bottleneck is often the interface between programs. Also, the old code was quite convoluted for many reasons and adding different algorithms would be tricky. One of the goals of this and related tickets was to clean up the mess to indeed allow using different backends for certain operations.",
    "created_at": "2017-09-29T16:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307441",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:5 vdelecroix]:
> Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.


The interest here is mostly in polytopes of dimensions 3-4-5, when the bottleneck is often the interface between programs. Also, the old code was quite convoluted for many reasons and adding different algorithms would be tricky. One of the goals of this and related tickets was to clean up the mess to indeed allow using different backends for certain operations.



---

archive/issue_comments_307442.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd91\".",
    "created_at": "2017-09-30T22:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307442",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "sd91".



---

archive/issue_comments_307443.json:
```json
{
    "body": "Changing keywords from \"sd91\" to \"sd91, sd90\".",
    "created_at": "2017-10-24T20:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307443",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing keywords from "sd91" to "sd91, sd90".



---

archive/issue_comments_307444.json:
```json
{
    "body": "I tried building again, and now this patch fails, with errors involving `sage-ursula/src/build/cythonized/sage/`.  My guess is that the transition from Sage 7.6 to the current development branch is too great.  Do you mind updating the patch?",
    "created_at": "2017-10-24T23:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307444",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

I tried building again, and now this patch fails, with errors involving `sage-ursula/src/build/cythonized/sage/`.  My guess is that the transition from Sage 7.6 to the current development branch is too great.  Do you mind updating the patch?



---

archive/issue_comments_307445.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-24T23:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307445",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_307446.json:
```json
{
    "body": "Can you please be more specific in how it fails? The branch merges cleanly and passes tests according to the patchbot.",
    "created_at": "2017-10-25T00:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307446",
    "user": "https://github.com/novoselt"
}
```

Can you please be more specific in how it fails? The branch merges cleanly and passes tests according to the patchbot.



---

archive/issue_comments_307447.json:
```json
{
    "body": "It also works for me. I am guessing what happened is `@`ursula just used the branch, effectively downgrading her version of Sage to that of the branch, and ran `sage -b`, which does not rebuild the necessary parts of Sage. In general, I always make sure to merge it ontop of (my version of) `develop` to avoid regressing Sage (which will include long compilation time). If that is not what [`@`ursula] did, then try running `make build` and then `sage -t`.",
    "created_at": "2017-10-25T00:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307447",
    "user": "https://github.com/tscrim"
}
```

It also works for me. I am guessing what happened is `@`ursula just used the branch, effectively downgrading her version of Sage to that of the branch, and ran `sage -b`, which does not rebuild the necessary parts of Sage. In general, I always make sure to merge it ontop of (my version of) `develop` to avoid regressing Sage (which will include long compilation time). If that is not what [`@`ursula] did, then try running `make build` and then `sage -t`.



---

archive/issue_comments_307448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-25T00:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307448",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_058621.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-25T00:56:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22391#event-58621"
}
```



---

archive/issue_comments_307449.json:
```json
{
    "body": "I made some small formatting changes to more match our style guide. If my changes look good, then positive review.\n\n---\nNew commits:",
    "created_at": "2017-10-25T00:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307449",
    "user": "https://github.com/tscrim"
}
```

I made some small formatting changes to more match our style guide. If my changes look good, then positive review.

---
New commits:



---

archive/issue_comments_307450.json:
```json
{
    "body": "Thank you!!!\n\nOf course your changes look good - anything to get it in ;-) A small question however:\n\n```\n         TypeError: the point M(1, 1) and\n-        2-d cone in 2-d lattice N have incompatible lattices!\n+         2-d cone in 2-d lattice N have incompatible lattices\n```\nYour new line apart from dropping the exclamation point due to exception formatting change also adds a space in front of the second part of the broken line. Is this also the style recommended somewhere? I can't recall ever reading it.",
    "created_at": "2017-10-25T01:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307450",
    "user": "https://github.com/novoselt"
}
```

Thank you!!!

Of course your changes look good - anything to get it in ;-) A small question however:

```
         TypeError: the point M(1, 1) and
-        2-d cone in 2-d lattice N have incompatible lattices!
+         2-d cone in 2-d lattice N have incompatible lattices
```
Your new line apart from dropping the exclamation point due to exception formatting change also adds a space in front of the second part of the broken line. Is this also the style recommended somewhere? I can't recall ever reading it.



---

archive/issue_comments_307451.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-25T01:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307451",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_307452.json:
```json
{
    "body": "Not really, but I feel its gives better grouping that it is part of the error message and not some new line of output, similar to indenting function blocks.",
    "created_at": "2017-10-25T02:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307452",
    "user": "https://github.com/tscrim"
}
```

Not really, but I feel its gives better grouping that it is part of the error message and not some new line of output, similar to indenting function blocks.



---

archive/issue_comments_307453.json:
```json
{
    "body": "Also, Python does not use sentence ending punctuation for any exceptions (or initial uppercase letters).",
    "created_at": "2017-10-25T02:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307453",
    "user": "https://github.com/tscrim"
}
```

Also, Python does not use sentence ending punctuation for any exceptions (or initial uppercase letters).



---

archive/issue_comments_307454.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-29T10:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22391#issuecomment-307454",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-29T10:32:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22391#event-58622"
}
```
