# Issue 22856: Upgrade libhomfly

archive/issues_022619.json:
```json
{
    "assignees": [],
    "body": "We need to upgrade libhomfly to build on Cygwin\n\nErrors out with messages like this when trying to build the corresponding Cython file:\n\n```\n/home/Travis/sage/local/var/tmp/sage/build/libhomfly-1.0/src/lib/control.c:209:(.text+0x7a9): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `GC_malloc'\n```\n\nUpstream tarball: \u200bhttps://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz\n\nCC:  @embray @jpflori @sagetrac-gouezel @miguelmarco\n\nComponent: **porting: Cygwin**\n\nKeywords: **libhomfly cygwin**\n\nAuthor: **Erik Bray, Travis Scrimshaw**\n\nBranch/Commit: **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**\n\nReviewer: **Travis Scrimshaw, Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22856_\n\n",
    "closed_at": "2017-04-28T23:55:00Z",
    "created_at": "2017-04-22T01:57:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade libhomfly",
    "type": "issue",
    "updated_at": "2017-04-28T23:55:00Z",
    "url": "https://github.com/sagemath/sage/issues/22856",
    "user": "https://github.com/tscrim"
}
```
We need to upgrade libhomfly to build on Cygwin

Errors out with messages like this when trying to build the corresponding Cython file:

```
/home/Travis/sage/local/var/tmp/sage/build/libhomfly-1.0/src/lib/control.c:209:(.text+0x7a9): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `GC_malloc'
```

Upstream tarball: ​https://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz

CC:  @embray @jpflori @sagetrac-gouezel @miguelmarco

Component: **porting: Cygwin**

Keywords: **libhomfly cygwin**

Author: **Erik Bray, Travis Scrimshaw**

Branch/Commit: **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**

Reviewer: **Travis Scrimshaw, Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/22856_





---

archive/issue_events_316124.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-22T01:57:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316124"
}
```



---

archive/issue_events_316125.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-22T01:57:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "0000b0",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316125"
}
```



---

archive/issue_events_316126.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-22T01:57:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316126"
}
```



---

archive/issue_events_316127.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-22T01:57:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316127"
}
```



---

archive/issue_comments_340864.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThat seems to be rellated to boehm_gc. A version mismatch maybe?",
    "created_at": "2017-04-22T09:56:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340864",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:1" align="right">comment:1</div>

That seems to be rellated to boehm_gc. A version mismatch maybe?



---

archive/issue_comments_340865.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI forgot to check if `boehm_gc` was installed. I will do that. Although IIRC, Cygwin can be more picky about linking order, and I saw a similar error coming from this.",
    "created_at": "2017-04-22T13:21:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340865",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

I forgot to check if `boehm_gc` was installed. I will do that. Although IIRC, Cygwin can be more picky about linking order, and I saw a similar error coming from this.



---

archive/issue_comments_340866.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIs this an optional package?  Definitely a blocker if you're using it but not in general.  I can probably fix this; linking problems are very common.",
    "created_at": "2017-04-24T11:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340866",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Is this an optional package?  Definitely a blocker if you're using it but not in general.  I can probably fix this; linking problems are very common.



---

archive/issue_comments_340867.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n(Lazyweb question: Is there an easy way to just install *all* optional packages, and better still run tests that use them?  Or is it entirely piecemeal?)",
    "created_at": "2017-04-24T11:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340867",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

(Lazyweb question: Is there an easy way to just install *all* optional packages, and better still run tests that use them?  Or is it entirely piecemeal?)



---

archive/issue_comments_340868.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@embray](#comment%3A3):\n> Is this an optional package?  Definitely a blocker if you're using it but not in general.  I can probably fix this; linking problems are very common.\n\n\nIt is optional now, but has been for almost a year and I was planning to propose to promote it to standard after the one year period.",
    "created_at": "2017-04-24T11:06:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340868",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@embray](#comment%3A3):
> Is this an optional package?  Definitely a blocker if you're using it but not in general.  I can probably fix this; linking problems are very common.


It is optional now, but has been for almost a year and I was planning to propose to promote it to standard after the one year period.



---

archive/issue_comments_340869.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOkay--either way I do want all optional packages to work too of course.  It's just lower priority than getting the standard build fully working.  But now that it is we can start looking at more of the optional packages too.",
    "created_at": "2017-04-24T11:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340869",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Okay--either way I do want all optional packages to work too of course.  It's just lower priority than getting the standard build fully working.  But now that it is we can start looking at more of the optional packages too.



---

archive/issue_comments_340870.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSo libhomfly did build for me (just ran `make libhomfly`).  Though it only built a static library, not shared, and I do have a warning:\n\n```\n[libhomfly-1.0] /bin/sh ../libtool  --tag=CC   --mode=link gcc  -g -O2 -lgc -export-symbols-regex '(c_)?homfly' -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib  -o libhomfly.la -rpath /home/embray/src/sagemath/sage-cygwin/local/lib bound.lo control.lo dllink.lo homfly.lo knot.lo model.lo order.lo poly.lo\n[libhomfly-1.0] libtool: warning: undefined symbols not allowed in x86_64-unknown-cygwin shared libraries; building static only\n[libhomfly-1.0] libtool: link: ar cru .libs/libhomfly.a  bound.o control.o dllink.o homfly.o knot.o model.o order.o poly.o\n[libhomfly-1.0] libtool: link: ranlib .libs/libhomfly.a\n[libhomfly-1.0] libtool: link: ( cd \".libs\" && rm -f \"libhomfly.la\" && ln -s \"../libhomfly.la\" \"libhomfly.la\" )\n[libhomfly-1.0] make[3]: Leaving directory '/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/libhomfly-1.0/src/lib'\n```\n\nWhich it was usually happens with my libtool if there are undefined symbols when linking a shared library (is it possible you have different default settings for libtool?)\n\nI haven't investigated further yet, but I've found a lot of automake packages don't have the necessary bits to get DLLs building properly on Windows.  See for example #21957, and I think some others I've worked on.",
    "created_at": "2017-04-24T11:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340870",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

So libhomfly did build for me (just ran `make libhomfly`).  Though it only built a static library, not shared, and I do have a warning:

```
[libhomfly-1.0] /bin/sh ../libtool  --tag=CC   --mode=link gcc  -g -O2 -lgc -export-symbols-regex '(c_)?homfly' -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib  -o libhomfly.la -rpath /home/embray/src/sagemath/sage-cygwin/local/lib bound.lo control.lo dllink.lo homfly.lo knot.lo model.lo order.lo poly.lo
[libhomfly-1.0] libtool: warning: undefined symbols not allowed in x86_64-unknown-cygwin shared libraries; building static only
[libhomfly-1.0] libtool: link: ar cru .libs/libhomfly.a  bound.o control.o dllink.o homfly.o knot.o model.o order.o poly.o
[libhomfly-1.0] libtool: link: ranlib .libs/libhomfly.a
[libhomfly-1.0] libtool: link: ( cd ".libs" && rm -f "libhomfly.la" && ln -s "../libhomfly.la" "libhomfly.la" )
[libhomfly-1.0] make[3]: Leaving directory '/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/libhomfly-1.0/src/lib'
```

Which it was usually happens with my libtool if there are undefined symbols when linking a shared library (is it possible you have different default settings for libtool?)

I haven't investigated further yet, but I've found a lot of automake packages don't have the necessary bits to get DLLs building properly on Windows.  See for example #21957, and I think some others I've worked on.



---

archive/issue_comments_340871.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nBasically the same boilerplate that I described [here](https://github.com/sagemath/sage/issues/15872#comment:5) should work here too; I will give it a try.",
    "created_at": "2017-04-24T11:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340871",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Basically the same boilerplate that I described [here](https://github.com/sagemath/sage/issues/15872#comment:5) should work here too; I will give it a try.



---

archive/issue_comments_340872.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[win32-dll.patch.gz](https://github.com/sagemath/sage/files/ticket22856/win32-dll.patch.gz)**\n\nThe attached patch should fix it.  I will add a branch with a version of this patch that *only* patches the generated files (and not the source files like configure.ac) so that applying the patch doesn't cause autotools invocation.\n\nI also noted that even with this patch, a static library is created by default.  Unless we *specifically* want a static version of libhomfly for some reason it would be good to disable this, just for disk space savings if nothing else.",
    "created_at": "2017-04-24T12:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340872",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[win32-dll.patch.gz](https://github.com/sagemath/sage/files/ticket22856/win32-dll.patch.gz)**

The attached patch should fix it.  I will add a branch with a version of this patch that *only* patches the generated files (and not the source files like configure.ac) so that applying the patch doesn't cause autotools invocation.

I also noted that even with this patch, a static library is created by default.  Unless we *specifically* want a static version of libhomfly for some reason it would be good to disable this, just for disk space savings if nothing else.



---

archive/issue_comments_340873.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a\"><code>cbf7a7a</code></a></td><td><code>Patch libhomfly to build a shared library on Cygwin</code></td></tr></table>\n",
    "created_at": "2017-04-24T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340873",
    "user": "https://github.com/embray"
}
```

<div id="comment:10"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a"><code>cbf7a7a</code></a></td><td><code>Patch libhomfly to build a shared library on Cygwin</code></td></tr></table>




---

archive/issue_comments_340874.json:
```json
{
    "body": "Changed keywords from **libhomfly** to **libhomfly cygwin**",
    "created_at": "2017-04-24T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340874",
    "user": "https://github.com/embray"
}
```

Changed keywords from **libhomfly** to **libhomfly cygwin**



---

archive/issue_comments_340875.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2017-04-24T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340875",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_340876.json:
```json
{
    "body": "Commit: **[`cbf7a7a`](https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a)**",
    "created_at": "2017-04-24T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340876",
    "user": "https://github.com/embray"
}
```

Commit: **[`cbf7a7a`](https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a)**



---

archive/issue_events_316128.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-24T12:35:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316128"
}
```



---

archive/issue_comments_340877.json:
```json
{
    "body": "Branch: **[u/embray/cygwin/ticket-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/ticket-22856)**",
    "created_at": "2017-04-24T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340877",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/cygwin/ticket-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/ticket-22856)**



---

archive/issue_comments_340878.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI install libhomfly as part of my usual optional packages, so that is my interest.\n\nThe library built okay for me too, but the problem (for me) comes from when you try to run `sage -b` to build the necessary Cython bindings. Did you also try this too? I also didn't change any libtool settings, so I doubt that is the problem.\n\nMiguel, would you merge this upstream (provided it builds on your systems too)?",
    "created_at": "2017-04-24T14:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340878",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

I install libhomfly as part of my usual optional packages, so that is my interest.

The library built okay for me too, but the problem (for me) comes from when you try to run `sage -b` to build the necessary Cython bindings. Did you also try this too? I also didn't change any libtool settings, so I doubt that is the problem.

Miguel, would you merge this upstream (provided it builds on your systems too)?



---

archive/issue_comments_340879.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe patch should probably fix it.  The reason linking failed for you was that libhomfly was only being built as a static library.",
    "created_at": "2017-04-24T14:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340879",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

The patch should probably fix it.  The reason linking failed for you was that libhomfly was only being built as a static library.



---

archive/issue_comments_340880.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI re-ran `./sage -b` after installing libhomfly and successfully ran what appeared to be the most relevant tests:\n\n```\n$ ./sage -t --long src/sage/knots/ src/sage/libs/homfly.pyx\nRunning doctests with ID 2017-04-24-16-26-16-363ee458.\nGit branch: u/embray/develop-cygwin\nUsing --optional=atlas,ccache,libhomfly,mpir,python2,sage\nDoctesting 5 files.\nsage -t --long --warn-long 177.9 src/sage/knots/all.py\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 177.9 src/sage/knots/knot.py\n    [42 tests, 14.08 s]\nsage -t --long --warn-long 177.9 src/sage/knots/link.py\n    [407 tests, 21.00 s]\nsage -t --long --warn-long 177.9 src/sage/knots/__init__.py\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 177.9 src/sage/libs/homfly.pyx\n    [6 tests, 1.77 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 38.3 seconds\n    cpu time: 28.2 seconds\n    cumulative wall time: 36.9 seconds\n```",
    "created_at": "2017-04-24T14:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340880",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

I re-ran `./sage -b` after installing libhomfly and successfully ran what appeared to be the most relevant tests:

```
$ ./sage -t --long src/sage/knots/ src/sage/libs/homfly.pyx
Running doctests with ID 2017-04-24-16-26-16-363ee458.
Git branch: u/embray/develop-cygwin
Using --optional=atlas,ccache,libhomfly,mpir,python2,sage
Doctesting 5 files.
sage -t --long --warn-long 177.9 src/sage/knots/all.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 177.9 src/sage/knots/knot.py
    [42 tests, 14.08 s]
sage -t --long --warn-long 177.9 src/sage/knots/link.py
    [407 tests, 21.00 s]
sage -t --long --warn-long 177.9 src/sage/knots/__init__.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 177.9 src/sage/libs/homfly.pyx
    [6 tests, 1.77 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 38.3 seconds
    cpu time: 28.2 seconds
    cumulative wall time: 36.9 seconds
```



---

archive/issue_comments_340881.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThanks. I'm building the `8.0.beta3` right now, and this is my next test afterwards.",
    "created_at": "2017-04-24T14:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340881",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Thanks. I'm building the `8.0.beta3` right now, and this is my next test afterwards.



---

archive/issue_comments_340882.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI could apply the patch upstream and make a new release (so we would need to update the libhomfly version in Sage). But I don't have a windows machine to test it on.\n\nAnother option is to just apply Eric's patch in Sage's install script.\n\nWhat option do you think would be better?",
    "created_at": "2017-04-24T18:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340882",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:15" align="right">comment:15</div>

I could apply the patch upstream and make a new release (so we would need to update the libhomfly version in Sage). But I don't have a windows machine to test it on.

Another option is to just apply Eric's patch in Sage's install script.

What option do you think would be better?



---

archive/issue_comments_340883.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI think it would be better to make this a version bump of libhomfly. Erik has tested it on Cygwin, and I am in the process of testing it (since I've gone to beta3, I'm stuck at Python3). So if it works on Linux (which I can test) and/or OSX (which I would be surprised if it didn't), then version bump is definitely the way to go IMO.",
    "created_at": "2017-04-24T19:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340883",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

I think it would be better to make this a version bump of libhomfly. Erik has tested it on Cygwin, and I am in the process of testing it (since I've gone to beta3, I'm stuck at Python3). So if it works on Linux (which I can test) and/or OSX (which I would be surprised if it didn't), then version bump is definitely the way to go IMO.



---

archive/issue_comments_340884.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYes, an upstream fix would be best.",
    "created_at": "2017-04-25T07:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340884",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Yes, an upstream fix would be best.



---

archive/issue_comments_340885.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCan you please check that this tarball:\n\nhttps://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz\n\nbuilds correctly and passes the `make check` test?",
    "created_at": "2017-04-25T08:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340885",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:18" align="right">comment:18</div>

Can you please check that this tarball:

https://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz

builds correctly and passes the `make check` test?



---

archive/issue_comments_340886.json:
```json
{
    "body": "Changed branch from **[u/embray/cygwin/ticket-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/ticket-22856)** to **[u/tscrim/libhomfly_1_0r2-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/libhomfly_1_0r2-22856)**",
    "created_at": "2017-04-25T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340886",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/embray/cygwin/ticket-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/ticket-22856)** to **[u/tscrim/libhomfly_1_0r2-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/libhomfly_1_0r2-22856)**



---

archive/issue_comments_340887.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-04-25T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340887",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_316129.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-25T13:30:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316129"
}
```



---

archive/issue_events_316130.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-25T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316130"
}
```



---

archive/issue_comments_340888.json:
```json
{
    "body": "Changed commit from **[`cbf7a7a`](https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a)** to **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**",
    "created_at": "2017-04-25T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340888",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`cbf7a7a`](https://github.com/sagemath/sagetrac-mirror/commit/cbf7a7a388d93b1f1821becbc1a8931952bbf78a)** to **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**



---

archive/issue_comments_340889.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI've checked on Linux. I'm still fighting the 8.0.beta3 build on Cygwin, but since it built for Erik, I'm setting a positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809\"><code>b4c2ac9</code></a></td><td><code>Version bump of libhomfly.</code></td></tr></table>\n",
    "created_at": "2017-04-25T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340889",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

I've checked on Linux. I'm still fighting the 8.0.beta3 build on Cygwin, but since it built for Erik, I'm setting a positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809"><code>b4c2ac9</code></a></td><td><code>Version bump of libhomfly.</code></td></tr></table>




---

archive/issue_comments_340890.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nCorrection, once someone checks my changes, then it can be set to positive review.",
    "created_at": "2017-04-25T13:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340890",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Correction, once someone checks my changes, then it can be set to positive review.



---

archive/issue_events_316131.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-25T13:30:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316131"
}
```



---

archive/issue_events_316132.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-25T13:30:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316132"
}
```



---

archive/issue_events_316133.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-25T13:31:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "title_is": "Upgrade libhomfly",
    "title_was": "libhomfly doesn't build on Cygwin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316133"
}
```



---

archive/issue_comments_340891.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,9 @@\n+We need to upgrade libhomfly to build on Cygwin\n+\n Errors out with messages like this when trying to build the corresponding Cython file:\n \n ```\n /home/Travis/sage/local/var/tmp/sage/build/libhomfly-1.0/src/lib/control.c:209:(.text+0x7a9): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `GC_malloc'\n ```\n+\n+Upstream tarball: \u200bhttps://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz\n``````\n",
    "created_at": "2017-04-25T13:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340891",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,9 @@
+We need to upgrade libhomfly to build on Cygwin
+
 Errors out with messages like this when trying to build the corresponding Cython file:
 
 ```
 /home/Travis/sage/local/var/tmp/sage/build/libhomfly-1.0/src/lib/control.c:209:(.text+0x7a9): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `GC_malloc'
 ```
+
+Upstream tarball: ​https://riemann.unizar.es/~mmarco/libhomfly-1.0r2.tar.gz
``````




---

archive/issue_comments_340892.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nEverything seems ok on Linux. If it solves the problem in cygwin, set it to positive review.",
    "created_at": "2017-04-26T06:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340892",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:22" align="right">comment:22</div>

Everything seems ok on Linux. If it solves the problem in cygwin, set it to positive review.



---

archive/issue_comments_340893.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Erik Bray**",
    "created_at": "2017-04-26T08:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340893",
    "user": "https://github.com/embray"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Erik Bray**



---

archive/issue_comments_340894.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Travis Scrimshaw**",
    "created_at": "2017-04-26T08:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340894",
    "user": "https://github.com/embray"
}
```

Changed author from **Erik Bray** to **Erik Bray, Travis Scrimshaw**



---

archive/issue_events_316134.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-26T08:11:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316134"
}
```



---

archive/issue_events_316135.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-26T08:11:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316135"
}
```



---

archive/issue_comments_340895.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nNow I can (finally, thanks to Erik) confirm this works on my cygwin as well.",
    "created_at": "2017-04-26T15:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340895",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Now I can (finally, thanks to Erik) confirm this works on my cygwin as well.



---

archive/issue_events_316136.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-28T23:55:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316136"
}
```



---

archive/issue_events_316137.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6b9461b47ac357a57cac15596493fa495ccac044",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-28T23:55:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22856#event-316137"
}
```



---

archive/issue_comments_340896.json:
```json
{
    "body": "Changed branch from **[u/tscrim/libhomfly_1_0r2-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/libhomfly_1_0r2-22856)** to **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**",
    "created_at": "2017-04-28T23:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22856#issuecomment-340896",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tscrim/libhomfly_1_0r2-22856](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/libhomfly_1_0r2-22856)** to **[`b4c2ac9`](https://github.com/sagemath/sagetrac-mirror/commit/b4c2ac935a80d4f6526a78096cac10205ed5f809)**
