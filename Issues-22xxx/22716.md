# Issue 22716: Faster Posets.SetPartitions()

archive/issues_022479.json:
```json
{
    "body": "Before this one-line patch:\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 482 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 5.63 s per loop\n```\n\nand after\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 175 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 1.04 s per loop\n```\n\n\nCC:  @tscrim\n\nReviewer: Travis Scrimshaw, Jori M\u00e4ntysalo\n\nAuthor: Jori M\u00e4ntysalo, Travis Scrimshaw\n\nBranch: 5ffc2be9938464b80778920654c0fb8f5ab7eb3c\n\nCommit: 5ffc2be9938464b80778920654c0fb8f5ab7eb3c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22716\n\n",
    "closed_at": "2017-04-05T19:37:41Z",
    "created_at": "2017-03-30T11:56:40Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Faster Posets.SetPartitions()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22716",
    "user": "https://github.com/jm58660"
}
```
Before this one-line patch:

```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 482 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 5.63 s per loop
```

and after

```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 175 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 1.04 s per loop
```


CC:  @tscrim

Reviewer: Travis Scrimshaw, Jori Mäntysalo

Author: Jori Mäntysalo, Travis Scrimshaw

Branch: 5ffc2be9938464b80778920654c0fb8f5ab7eb3c

Commit: 5ffc2be9938464b80778920654c0fb8f5ab7eb3c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22716





---

archive/issue_comments_312922.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-03-30T17:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312922",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_312923.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-30T17:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312923",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312924.json:
```json
{
    "body": "<a id='comment:3'></a>Wouldn't it be better to explicitly build the cover relations by:\n\n```sage\nsage: def covers(x):\n....:     SP = x.parent()\n....:     for i,s in enumerate(x):\n....:         for j in range(i+1, len(x)):\n....:             L = list(x)\n....:             L[i] = s.union(x[j])\n....:             L.pop(j)\n....:             yield SP(L)\n....:             \nsage: list(covers(x))\n[{{1, 2, 5}, {3, 4}}, {{1, 3, 4}, {2, 5}}, {{1}, {2, 3, 4, 5}}]\n```\nThat way you can use the `cover_relations=True` arg to `LatticePoset`.",
    "created_at": "2017-03-30T17:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312924",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Wouldn't it be better to explicitly build the cover relations by:

```sage
sage: def covers(x):
....:     SP = x.parent()
....:     for i,s in enumerate(x):
....:         for j in range(i+1, len(x)):
....:             L = list(x)
....:             L[i] = s.union(x[j])
....:             L.pop(j)
....:             yield SP(L)
....:             
sage: list(covers(x))
[{{1, 2, 5}, {3, 4}}, {{1, 3, 4}, {2, 5}}, {{1}, {2, 3, 4, 5}}]
```
That way you can use the `cover_relations=True` arg to `LatticePoset`.



---

archive/issue_comments_312925.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-30T19:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312925",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312926.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 tscrim]:\n\n> Wouldn't it be better to explicitly build the cover relations - -\n\n\nOf course, but I was too lazy for that. `:=)`. Thanks. After this\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 66.7 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 304 ms per loop\n```",
    "created_at": "2017-03-30T19:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312926",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>Replying to [comment:3 tscrim]:

> Wouldn't it be better to explicitly build the cover relations - -


Of course, but I was too lazy for that. `:=)`. Thanks. After this

```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 66.7 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 304 ms per loop
```



---

archive/issue_comments_312927.json:
```json
{
    "body": "<a id='comment:7'></a>You could just do\n\n```\nL = LatticePoset({x: list(covers(x)) for x in S}, cover_relations=True)\n```\nas this avoids extra processing on the poset (specifically the call to `transitive_reduction_acyclic`) and the extra conversion call. You can also replace `SP` by `S` in the internal function (and delete `SP = x.parent()`).",
    "created_at": "2017-03-30T19:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312927",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>You could just do

```
L = LatticePoset({x: list(covers(x)) for x in S}, cover_relations=True)
```
as this avoids extra processing on the poset (specifically the call to `transitive_reduction_acyclic`) and the extra conversion call. You can also replace `SP` by `S` in the internal function (and delete `SP = x.parent()`).



---

archive/issue_comments_312928.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-31T04:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312929.json:
```json
{
    "body": "<a id='comment:9'></a>As you wish. This does not make so big difference anymore:\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 64 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 298 ms per loop\n```",
    "created_at": "2017-03-31T04:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312929",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>As you wish. This does not make so big difference anymore:

```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 64 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 298 ms per loop
```



---

archive/issue_comments_312930.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-31T14:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312930",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312931.json:
```json
{
    "body": "<a id='comment:10'></a>But it does help a little bit. Thanks.",
    "created_at": "2017-03-31T14:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312931",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>But it does help a little bit. Thanks.



---

archive/issue_comments_312932.json:
```json
{
    "body": "<a id='comment:11'></a>FYI: I went through other simple examples on the poset catalog, and found no other slow examples; that is, all other posets and lattices of size at least 100 were created in less than a second in our server.",
    "created_at": "2017-04-01T05:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312932",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>FYI: I went through other simple examples on the poset catalog, and found no other slow examples; that is, all other posets and lattices of size at least 100 were created in less than a second in our server.



---

archive/issue_events_059183.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-05T19:37:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22716#event-59183"
}
```



---

archive/issue_comments_312933.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-05T19:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22716#issuecomment-312933",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
