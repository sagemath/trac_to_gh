# Issue 22999: update cmake to version 3.8.1

archive/issues_022762.json:
```json
{
    "assignees": [],
    "body": "it has been released, and is the current stable version.\n\nhere is the tarball: https://cmake.org/files/v3.8/cmake-3.8.1.tar.gz\n\nCC:  @kiwifb @embray @seblabbe @isuruf\n\nKeywords: **thursdaysbdx**\n\nBranch: **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Dima Pasechnik, Fran\u00e7ois Bissey, Thierry Monteil**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22999_\n\n",
    "closed_at": "2017-05-31T22:25:32Z",
    "created_at": "2017-05-14T22:35:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "update cmake to version 3.8.1",
    "type": "issue",
    "updated_at": "2017-06-03T10:57:10Z",
    "url": "https://github.com/sagemath/sage/issues/22999",
    "user": "https://github.com/dimpase"
}
```
it has been released, and is the current stable version.

here is the tarball: https://cmake.org/files/v3.8/cmake-3.8.1.tar.gz

CC:  @kiwifb @embray @seblabbe @isuruf

Keywords: **thursdaysbdx**

Branch: **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**

Upstream: **Reported upstream. Developers acknowledge bug.**

Reviewer: **Sébastien Labbé**

Author: **Dima Pasechnik, François Bissey, Thierry Monteil**

_Issue created by migration from https://trac.sagemath.org/ticket/22999_





---

archive/issue_events_302810.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-05-14T22:35:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302810"
}
```



---

archive/issue_events_302811.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-05-14T22:35:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302811"
}
```



---

archive/issue_events_302812.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-05-14T22:35:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302812"
}
```



---

archive/issue_events_302813.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-05-14T22:35:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302813"
}
```



---

archive/issue_comments_346631.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nwith SAGE_CHECK=yes I get, on Gentoo Linux,\n\n```\n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1] \t409 - GTK2Components.gtk (Failed)\n[cmake-3.8.1] \t419 - GTK2Targets.pangocairo (Failed)\n[cmake-3.8.1] \t420 - GTK2Targets.pangoxft (Failed)\n[cmake-3.8.1] \t421 - GTK2Targets.pangoft2 (Failed)\n[cmake-3.8.1] \t422 - GTK2Targets.gdk (Failed)\n[cmake-3.8.1] \t423 - GTK2Targets.gtk (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\nwhich probably can be ignored, as this is something GTK-specific?",
    "created_at": "2017-05-14T23:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346631",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">Comment 2</div>

with SAGE_CHECK=yes I get, on Gentoo Linux,

```
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1] 	409 - GTK2Components.gtk (Failed)
[cmake-3.8.1] 	419 - GTK2Targets.pangocairo (Failed)
[cmake-3.8.1] 	420 - GTK2Targets.pangoxft (Failed)
[cmake-3.8.1] 	421 - GTK2Targets.pangoft2 (Failed)
[cmake-3.8.1] 	422 - GTK2Targets.gdk (Failed)
[cmake-3.8.1] 	423 - GTK2Targets.gtk (Failed)
[cmake-3.8.1] Errors while running CTest
```
which probably can be ignored, as this is something GTK-specific?



---

archive/issue_comments_346632.json:
```json
{
    "body": "Dependencies: **u/dimpase/cmakeupd**",
    "created_at": "2017-05-14T23:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346632",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **u/dimpase/cmakeupd**



---

archive/issue_events_302814.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-05-14T23:08:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302814"
}
```



---

archive/issue_comments_346633.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2017-05-14T23:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346633",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_346634.json:
```json
{
    "body": "Changed dependencies from **u/dimpase/cmakeupd** to none",
    "created_at": "2017-05-14T23:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346634",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **u/dimpase/cmakeupd** to none



---

archive/issue_comments_346635.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de\">addf5a7</a></td><td><code>cmake update to 3.8.1</code></td></tr></table>\n",
    "created_at": "2017-05-14T23:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346635",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">Comment 4</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de">addf5a7</a></td><td><code>cmake update to 3.8.1</code></td></tr></table>




---

archive/issue_comments_346636.json:
```json
{
    "body": "Branch: **[u/dimpase/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/cmakeupd)**",
    "created_at": "2017-05-14T23:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346636",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/cmakeupd)**



---

archive/issue_comments_346637.json:
```json
{
    "body": "Commit: **[addf5a7](https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de)**",
    "created_at": "2017-05-14T23:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346637",
    "user": "https://github.com/dimpase"
}
```

Commit: **[addf5a7](https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de)**



---

archive/issue_comments_346638.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nOptional packages should pass their test suite. This is curious, it obviously picked up stuff from your system, why is it then failing? Thanks for the branch, I'll have a look here.",
    "created_at": "2017-05-14T23:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346638",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">Comment 5</div>

Optional packages should pass their test suite. This is curious, it obviously picked up stuff from your system, why is it then failing? Thanks for the branch, I'll have a look here.



---

archive/issue_comments_346639.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nNo idea. I can only say that on my system I have cmake version 3.7.2, and it fails, with some weird error, to build http://hg.mrzv.org/Dionysus/ that I can build with cmake 3.8.1.\n\nPerhaps cmake should be built with some correct options to avoid this testing error?",
    "created_at": "2017-05-14T23:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346639",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">Comment 6</div>

No idea. I can only say that on my system I have cmake version 3.7.2, and it fails, with some weird error, to build http://hg.mrzv.org/Dionysus/ that I can build with cmake 3.8.1.

Perhaps cmake should be built with some correct options to avoid this testing error?



---

archive/issue_comments_346640.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI think the tests are slightly broken... I have more of them\n\n```\n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1]   136 - Qt5Autogen (Failed)\n[cmake-3.8.1]   138 - Qt4Autogen (Failed)\n[cmake-3.8.1]   140 - Qt4Targets (Failed)\n[cmake-3.8.1]   142 - Qt4And5AutomocReverse (Failed)\n[cmake-3.8.1]   417 - GTK2Components.gtk (Failed)\n[cmake-3.8.1]   425 - GTK2Targets.cairo (Failed)\n[cmake-3.8.1]   427 - GTK2Targets.pangocairo (Failed)\n[cmake-3.8.1]   428 - GTK2Targets.pangoxft (Failed)\n[cmake-3.8.1]   429 - GTK2Targets.pangoft2 (Failed)\n[cmake-3.8.1]   430 - GTK2Targets.gdk (Failed)\n[cmake-3.8.1]   431 - GTK2Targets.gtk (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\nbut I think they all boil down to the linking errors with libpng and libharfbuzz, messages like\n\n```\n/usr/lib64/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'\n```\nand \n\n```\n/usr/lib64/libharfbuzz.so.0: undefined reference to `FT_Get_Var_Blend_Coordinates'\n```\nWhy do we get those? Very simple, the version of `zlib` and `freetype` in the sage build tree are older then the one on the system. But enforced runpath in sage means that the version in `$SAGE_LOCAL/lib/` are the one being loaded instead of the system one.\n\nThe upgrade to `zlib-1.2.11` will bring relief to the libpng linking. freetype 2.7.1 is the current stable in a gentoo system, 2.6.3 is the one in sage.\n\nWe could somewhat solve the the problem by upping zlib (why isn't this already merged?) and freetype but that won't prevent a recurrence down the line when some dependency gets out of sync again between system tree and sage tree. \n\nI'll think about what to do next. Suppressing tests will just result in a n ever growing list.",
    "created_at": "2017-05-14T23:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346640",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

I think the tests are slightly broken... I have more of them

```
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1]   136 - Qt5Autogen (Failed)
[cmake-3.8.1]   138 - Qt4Autogen (Failed)
[cmake-3.8.1]   140 - Qt4Targets (Failed)
[cmake-3.8.1]   142 - Qt4And5AutomocReverse (Failed)
[cmake-3.8.1]   417 - GTK2Components.gtk (Failed)
[cmake-3.8.1]   425 - GTK2Targets.cairo (Failed)
[cmake-3.8.1]   427 - GTK2Targets.pangocairo (Failed)
[cmake-3.8.1]   428 - GTK2Targets.pangoxft (Failed)
[cmake-3.8.1]   429 - GTK2Targets.pangoft2 (Failed)
[cmake-3.8.1]   430 - GTK2Targets.gdk (Failed)
[cmake-3.8.1]   431 - GTK2Targets.gtk (Failed)
[cmake-3.8.1] Errors while running CTest
```
but I think they all boil down to the linking errors with libpng and libharfbuzz, messages like

```
/usr/lib64/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'
```
and 

```
/usr/lib64/libharfbuzz.so.0: undefined reference to `FT_Get_Var_Blend_Coordinates'
```
Why do we get those? Very simple, the version of `zlib` and `freetype` in the sage build tree are older then the one on the system. But enforced runpath in sage means that the version in `$SAGE_LOCAL/lib/` are the one being loaded instead of the system one.

The upgrade to `zlib-1.2.11` will bring relief to the libpng linking. freetype 2.7.1 is the current stable in a gentoo system, 2.6.3 is the one in sage.

We could somewhat solve the the problem by upping zlib (why isn't this already merged?) and freetype but that won't prevent a recurrence down the line when some dependency gets out of sync again between system tree and sage tree. 

I'll think about what to do next. Suppressing tests will just result in a n ever growing list.



---

archive/issue_comments_346641.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI get exactly the same errors with 3.8.0, so this is probably either my system, or it a \"feature\" of cmake---for they cannot use autoconf for ideological reasons, I guess :-)",
    "created_at": "2017-05-15T00:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346641",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">Comment 8</div>

I get exactly the same errors with 3.8.0, so this is probably either my system, or it a "feature" of cmake---for they cannot use autoconf for ideological reasons, I guess :-)



---

archive/issue_comments_346642.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nin my case it's linking errors like\n\n```\n422: /usr/lib64/libharfbuzz.so.0: undefined reference to `FT_Get_Var_Blend_Coor\ndinates'\n```\n- no idea what this `harfbuzz` is all about, some hardcore GTK stuff I guess.",
    "created_at": "2017-05-15T00:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346642",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

in my case it's linking errors like

```
422: /usr/lib64/libharfbuzz.so.0: undefined reference to `FT_Get_Var_Blend_Coor
dinates'
```
- no idea what this `harfbuzz` is all about, some hardcore GTK stuff I guess.



---

archive/issue_comments_346643.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nIt is a bit more than that. IT find QT/GTK on the system - we don't prevent that, and historically we don't want to. The problem is that the qt and gtk library used have dependency on libraries that are now conflicting with the sage installed ones.\n\nI guess I didn't try on Gentoo when I was working on 3.8.0 - I focused on OS X leaving the linux stuff to other.\n\nautoconf would marginally help I guess, in that you wouldn't test for stuff if you have configured them out. That would mean no automagic in configure and us explicitly disabling it. Here we may have automagic on gtk - possibly decoupled between configuration and tests.\n\nChecking things....",
    "created_at": "2017-05-15T00:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346643",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">Comment 10</div>

It is a bit more than that. IT find QT/GTK on the system - we don't prevent that, and historically we don't want to. The problem is that the qt and gtk library used have dependency on libraries that are now conflicting with the sage installed ones.

I guess I didn't try on Gentoo when I was working on 3.8.0 - I focused on OS X leaving the linux stuff to other.

autoconf would marginally help I guess, in that you wouldn't test for stuff if you have configured them out. That would mean no automagic in configure and us explicitly disabling it. Here we may have automagic on gtk - possibly decoupled between configuration and tests.

Checking things....



---

archive/issue_comments_346644.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nYes that's what I thought. No way of controlling gtk stuff from the base of the build system.\n\nIn any case even if I suppress the tests, it means that anyone wanting to build a gtk/qt program on top of sage using cmake is at risk of getting something broken because of library conflict between system and sage libraries. autoconf is not immune to the problem either, you are likely to face exactly the same problems.",
    "created_at": "2017-05-15T00:18:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346644",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">Comment 11</div>

Yes that's what I thought. No way of controlling gtk stuff from the base of the build system.

In any case even if I suppress the tests, it means that anyone wanting to build a gtk/qt program on top of sage using cmake is at risk of getting something broken because of library conflict between system and sage libraries. autoconf is not immune to the problem either, you are likely to face exactly the same problems.



---

archive/issue_comments_346645.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nAnother point: the problem here wouldn't happen if `zlib` and `freetype` had incremented the soname for their libraries. The libraries are obviously backward compatible but not forward compatible which is killing us here.",
    "created_at": "2017-05-15T01:29:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346645",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

Another point: the problem here wouldn't happen if `zlib` and `freetype` had incremented the soname for their libraries. The libraries are obviously backward compatible but not forward compatible which is killing us here.



---

archive/issue_comments_346646.json:
```json
{
    "body": "Changed branch from **[u/dimpase/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/cmakeupd)** to **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)**",
    "created_at": "2017-05-15T02:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346646",
    "user": "https://github.com/kiwifb"
}
```

Changed branch from **[u/dimpase/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/cmakeupd)** to **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)**



---

archive/issue_comments_346647.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nAll tests suppressed in the attached branch.\n\nOther idea way out there:\nthat kind of conflict is not a first. This is a consequence of having runpath set. runpath have been selected as a cleaner way to deal with selecting the right libraries from the sage tree over the system ones.\nWe used to have `{DY,}LD_LIBRARY_PATH` set and now we do runpath. `LD_LIBRARY_PATH` can still be used to over-rule runpath but we have moved from putting the path information in an environment variable loaded at runtime to putting it in the binary itself (executable and dynamic libraries).\n\nIt guarantee we use the sage tree over anything else but it still doesn't prevent conflict as seen above.\n\nTo totally avoid conflict you need to go one step further: **brand the libraries**\n\nWhat do I mean by that? Take `zlib`, it installs the following library objects\n\n```\nlrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so -> libz.so.1.2.8\nlrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so.1 -> libz.so.1.2.8\n-rwxr-xr-x 1 fbissey fbissey 111K May 11 10:54 local/lib/libz.so.1.2.8\n```\nand we have \n\n```\nfbissey@moonloop ~/sandbox/git-fork/sage $ readelf -d local/lib/libz.so.1.2.8\n\nDynamic section at offset 0x18dd0 contains 28 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000e (SONAME)             Library soname: [libz.so.1]\n 0x000000000000001d (RUNPATH)            Library runpath: [/home/fbissey/sandbox/git-fork/sage/local/lib]\n```\nI suggest we change the soname to `libz.so.1_sage` (or something similar) and install\n\n```\nlrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so -> libz.so.1.2.8\nlrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so.1_sage -> libz.so.1.2.8\n-rwxr-xr-x 1 fbissey fbissey 111K May 11 10:54 local/lib/libz.so.1.2.8\n```\nIt may look strange but with the right soname it is sufficient. That would be a lot of work, but I believe this is the only true way to avoid any conflict: runpath+branding.\n\nThe `install_name` mechanism on OS X is slightly better in that regard. If you don't mess up with it, the library name recorded in MACH-O object is fully qualified (full path) rather than just an object name. The fully qualified path can still be over-ridden by application of a runpath in situ or by environment variable.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c\">3251968</a></td><td><code>supress tests failing due mix match of libraries between host and sage</code></td></tr></table>\n",
    "created_at": "2017-05-15T02:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346647",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">Comment 13</div>

All tests suppressed in the attached branch.

Other idea way out there:
that kind of conflict is not a first. This is a consequence of having runpath set. runpath have been selected as a cleaner way to deal with selecting the right libraries from the sage tree over the system ones.
We used to have `{DY,}LD_LIBRARY_PATH` set and now we do runpath. `LD_LIBRARY_PATH` can still be used to over-rule runpath but we have moved from putting the path information in an environment variable loaded at runtime to putting it in the binary itself (executable and dynamic libraries).

It guarantee we use the sage tree over anything else but it still doesn't prevent conflict as seen above.

To totally avoid conflict you need to go one step further: **brand the libraries**

What do I mean by that? Take `zlib`, it installs the following library objects

```
lrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so -> libz.so.1.2.8
lrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so.1 -> libz.so.1.2.8
-rwxr-xr-x 1 fbissey fbissey 111K May 11 10:54 local/lib/libz.so.1.2.8
```
and we have 

```
fbissey@moonloop ~/sandbox/git-fork/sage $ readelf -d local/lib/libz.so.1.2.8

Dynamic section at offset 0x18dd0 contains 28 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000e (SONAME)             Library soname: [libz.so.1]
 0x000000000000001d (RUNPATH)            Library runpath: [/home/fbissey/sandbox/git-fork/sage/local/lib]
```
I suggest we change the soname to `libz.so.1_sage` (or something similar) and install

```
lrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so -> libz.so.1.2.8
lrwxrwxrwx 1 fbissey fbissey   13 May 11 10:54 local/lib/libz.so.1_sage -> libz.so.1.2.8
-rwxr-xr-x 1 fbissey fbissey 111K May 11 10:54 local/lib/libz.so.1.2.8
```
It may look strange but with the right soname it is sufficient. That would be a lot of work, but I believe this is the only true way to avoid any conflict: runpath+branding.

The `install_name` mechanism on OS X is slightly better in that regard. If you don't mess up with it, the library name recorded in MACH-O object is fully qualified (full path) rather than just an object name. The fully qualified path can still be over-ridden by application of a runpath in situ or by environment variable.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c">3251968</a></td><td><code>supress tests failing due mix match of libraries between host and sage</code></td></tr></table>




---

archive/issue_comments_346648.json:
```json
{
    "body": "Changed commit from **[addf5a7](https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de)** to **[3251968](https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c)**",
    "created_at": "2017-05-15T02:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346648",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[addf5a7](https://github.com/sagemath/sagetrac-mirror/commit/addf5a7f264cc0ee8e4e5b1857eff92bf621c9de)** to **[3251968](https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c)**



---

archive/issue_comments_346649.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nI wonder how this would play out on cygwin. Potentially it might help avoid DLL clashes there, if it flies at all.",
    "created_at": "2017-05-15T08:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346649",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">Comment 14</div>

I wonder how this would play out on cygwin. Potentially it might help avoid DLL clashes there, if it flies at all.



---

archive/issue_comments_346650.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nwith your branch, it works on Linux, while on FreeBSD I get\n\n```\n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1]   298 - RunCMake.GNUInstallDirs (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\nlog attached. Something to do with `stderr`...",
    "created_at": "2017-05-15T10:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346650",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">Comment 15</div>

with your branch, it works on Linux, while on FreeBSD I get

```
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1]   298 - RunCMake.GNUInstallDirs (Failed)
[cmake-3.8.1] Errors while running CTest
```
log attached. Something to do with `stderr`...



---

archive/issue_comments_346651.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nExtremely stupid. Should be an upstream issue.\n\nExpected\n\n```\nexpect-err> CMAKE_INSTALL_MANDIR='share/man'\n```\ngot\n\n```\nactual-err> CMAKE_INSTALL_MANDIR='man'\n```\nand there is another entry relating to `MANDIR` that is incorrect in the output. And this is repeated over several subtests. I think I could make a patch for that, rather than suppressing it.",
    "created_at": "2017-05-15T11:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346651",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">Comment 16</div>

Extremely stupid. Should be an upstream issue.

Expected

```
expect-err> CMAKE_INSTALL_MANDIR='share/man'
```
got

```
actual-err> CMAKE_INSTALL_MANDIR='man'
```
and there is another entry relating to `MANDIR` that is incorrect in the output. And this is repeated over several subtests. I think I could make a patch for that, rather than suppressing it.



---

archive/issue_comments_346652.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThis is now https://gitlab.kitware.com/cmake/cmake/issues/16887",
    "created_at": "2017-05-15T11:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346652",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">Comment 17</div>

This is now https://gitlab.kitware.com/cmake/cmake/issues/16887



---

archive/issue_comments_346653.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2017-05-15T11:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346653",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_346654.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThanks. I was unable to spot where the differences there are.\nPerhaps it's about `GNUInstallDirs` vs nonGNU (why would they expect FreeBSD to adhere to GNU standards?)",
    "created_at": "2017-05-15T11:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346654",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">Comment 18</div>

Thanks. I was unable to spot where the differences there are.
Perhaps it's about `GNUInstallDirs` vs nonGNU (why would they expect FreeBSD to adhere to GNU standards?)



---

archive/issue_comments_346655.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@dimpase](#comment%3A18):\n> Thanks. I was unable to spot where the differences there are.\n> Perhaps it's about `GNUInstallDirs` vs nonGNU (why would they expect FreeBSD to adhere to GNU standards?)\n\nIn that regards, it may be misleading. While the module is called `GNUInstallDirs` it clearly defines stuff in BSD's case, the fact that it is different from linux is the root cause of the problem. The person who wrote the test didn't realise that it wouldn't pass on *BSD [although the test has a bizarre clause for OpenBSD that I haven't seen anywhere else]. The test stresses the output of the CMake module found at `Modules/GNUInstallDirs.cmake` in the cmake sources and it contains the following\n\n```\nif(CMAKE_SYSTEM_NAME MATCHES \"^(.*BSD|DragonFly)$\")\n  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_INFODIR \"info\"\n    \"Info documentation (info)\")\n  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_MANDIR \"man\"\n    \"Man documentation (man)\")\nelse()\n  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_INFODIR \"${CMAKE_INSTALL_DATAROOTDIR}/info\"\n    \"Info documentation (DATAROOTDIR/info)\")\n  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_MANDIR \"${CMAKE_INSTALL_DATAROOTDIR}/man\"\n    \"Man documentation (DATAROOTDIR/man)\")\nendif()\n```\nThere is only one other `CMAKE_SYSTEM_NAME` variation and the test deals with it properly in all cases I think.",
    "created_at": "2017-05-15T12:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346655",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@dimpase](#comment%3A18):
> Thanks. I was unable to spot where the differences there are.
> Perhaps it's about `GNUInstallDirs` vs nonGNU (why would they expect FreeBSD to adhere to GNU standards?)

In that regards, it may be misleading. While the module is called `GNUInstallDirs` it clearly defines stuff in BSD's case, the fact that it is different from linux is the root cause of the problem. The person who wrote the test didn't realise that it wouldn't pass on *BSD [although the test has a bizarre clause for OpenBSD that I haven't seen anywhere else]. The test stresses the output of the CMake module found at `Modules/GNUInstallDirs.cmake` in the cmake sources and it contains the following

```
if(CMAKE_SYSTEM_NAME MATCHES "^(.*BSD|DragonFly)$")
  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_INFODIR "info"
    "Info documentation (info)")
  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_MANDIR "man"
    "Man documentation (man)")
else()
  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_INFODIR "${CMAKE_INSTALL_DATAROOTDIR}/info"
    "Info documentation (DATAROOTDIR/info)")
  _GNUInstallDirs_cache_path_fallback(CMAKE_INSTALL_MANDIR "${CMAKE_INSTALL_DATAROOTDIR}/man"
    "Man documentation (DATAROOTDIR/man)")
endif()
```
There is only one other `CMAKE_SYSTEM_NAME` variation and the test deals with it properly in all cases I think.



---

archive/issue_comments_346656.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nOK, so I can technically make this pass on freeBSD with an easy patch to the current test. Upstream doesn't like that approach, to them the test should be made platform specific. Right now, I don't know how to do that.",
    "created_at": "2017-05-17T23:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346656",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">Comment 20</div>

OK, so I can technically make this pass on freeBSD with an easy patch to the current test. Upstream doesn't like that approach, to them the test should be made platform specific. Right now, I don't know how to do that.



---

archive/issue_comments_346657.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nWhat does `UNAME` get set to on freeBSD? I could skip the test based on OS.",
    "created_at": "2017-05-17T23:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346657",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">Comment 21</div>

What does `UNAME` get set to on freeBSD? I could skip the test based on OS.



---

archive/issue_comments_346658.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\n\n```\n$ uname -a\nFreeBSD dimpase-bsd.x.y.z 11.0-RELEASE-p1 FreeBSD 11.0-RELEASE-p1 #0 r306420: Thu Sep 29 01:43:23 UTC 2016     root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64\n\n$ uname\nFreeBSD\n\n```",
    "created_at": "2017-05-18T07:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346658",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">Comment 22</div>


```
$ uname -a
FreeBSD dimpase-bsd.x.y.z 11.0-RELEASE-p1 FreeBSD 11.0-RELEASE-p1 #0 r306420: Thu Sep 29 01:43:23 UTC 2016     root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64

$ uname
FreeBSD

```



---

archive/issue_comments_346659.json:
```json
{
    "body": "Changed commit from **[3251968](https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c)** to **[43aec08](https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403)**",
    "created_at": "2017-05-18T07:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346659",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3251968](https://github.com/sagemath/sagetrac-mirror/commit/325196871a69703ede67aca5b85b5f5f6785f09c)** to **[43aec08](https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403)**



---

archive/issue_comments_346660.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403\">43aec08</a></td><td><code>make an exception for freeBSD</code></td></tr></table>\n",
    "created_at": "2017-05-18T07:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346660",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23" align="right">Comment 23</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403">43aec08</a></td><td><code>make an exception for freeBSD</code></td></tr></table>




---

archive/issue_comments_346661.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nAlright! Can you test with that last commit please.",
    "created_at": "2017-05-18T07:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346661",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:24" align="right">Comment 24</div>

Alright! Can you test with that last commit please.



---

archive/issue_comments_346662.json:
```json
{
    "body": "see failing test 298 (2nd try)",
    "created_at": "2017-05-18T10:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346662",
    "user": "https://github.com/dimpase"
}
```

see failing test 298 (2nd try)



---

archive/issue_comments_346663.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nAttachment: **[freebsd-cmake.log.gz](https://github.com/sagemath/sage/files/ticket22999/freebsd-cmake.log.gz)**\n\nnope, still the same test that is failing",
    "created_at": "2017-05-18T10:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346663",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">Comment 25</div>

Attachment: **[freebsd-cmake.log.gz](https://github.com/sagemath/sage/files/ticket22999/freebsd-cmake.log.gz)**

nope, still the same test that is failing



---

archive/issue_comments_346664.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b\">8fbe406</a></td><td><code>make exception for correct OS, FreeBSD not Darwin.</code></td></tr></table>\n",
    "created_at": "2017-05-18T11:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346664",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b">8fbe406</a></td><td><code>make exception for correct OS, FreeBSD not Darwin.</code></td></tr></table>




---

archive/issue_comments_346665.json:
```json
{
    "body": "Changed commit from **[43aec08](https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403)** to **[8fbe406](https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b)**",
    "created_at": "2017-05-18T11:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346665",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[43aec08](https://github.com/sagemath/sagetrac-mirror/commit/43aec08aad49fe98bc2d79e74b71836b3dcc8403)** to **[8fbe406](https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b)**



---

archive/issue_comments_346666.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nI am a dummy. I copy pasted from somewhere but forgot to change the essential bit identifying freeBSD. Should work now.",
    "created_at": "2017-05-18T11:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346666",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">Comment 27</div>

I am a dummy. I copy pasted from somewhere but forgot to change the essential bit identifying freeBSD. Should work now.



---

archive/issue_comments_346667.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nAll the selftests now pass on FreeBSD.\nHow about OSX?",
    "created_at": "2017-05-18T12:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346667",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">Comment 28</div>

All the selftests now pass on FreeBSD.
How about OSX?



---

archive/issue_comments_346668.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nNote that the current cmake 3.8.0 does not build on OSX, see [#22817 comment:9](https://github.com/sagemath/sage/issues/22817#comment:9)",
    "created_at": "2017-05-18T13:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346668",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:29" align="right">Comment 29</div>

Note that the current cmake 3.8.0 does not build on OSX, see [#22817 comment:9](https://github.com/sagemath/sage/issues/22817#comment:9)



---

archive/issue_comments_346669.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nOn OSX Yosemite 10.10.2, I can't compile cmake 3.8.1 (same error as cmake 3.8.0 I reported in #22817):\n\n```\n$ MAKE='make -j2' sage -i cmake\n\n...\n\n[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_ar.c.o\n[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_by_name.c.o\n[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_cpio.c.o\n[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_cpio_newc.c.o\n[cmake-3.8.1] [ 32%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_filter_by_ext.c.o\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:358:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:387:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/CPack/OSXScriptLauncher.cxx.o] Error 1\n[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/all] Error 2\n[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....\n\n...\n\n[cmake-3.8.1] make[2]: *** [all] Error 2\n[cmake-3.8.1] Error installing CMake.\n[cmake-3.8.1] \n[cmake-3.8.1] real\t3m12.199s\n[cmake-3.8.1] user\t1m45.730s\n[cmake-3.8.1] sys\t1m13.808s\n[cmake-3.8.1] ************************************************************************\n[cmake-3.8.1] Error installing package cmake-3.8.1\n[cmake-3.8.1] ************************************************************************\n\n...\n```\nI will upload the log file in a moment.\n\nI am using:\n\n```\n$ xcodebuild -version\nXcode 6.3\nBuild version 6D570\n```",
    "created_at": "2017-05-18T13:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346669",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:30" align="right">Comment 30</div>

On OSX Yosemite 10.10.2, I can't compile cmake 3.8.1 (same error as cmake 3.8.0 I reported in #22817):

```
$ MAKE='make -j2' sage -i cmake

...

[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_ar.c.o
[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_by_name.c.o
[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_cpio.c.o
[cmake-3.8.1] [ 31%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_cpio_newc.c.o
[cmake-3.8.1] [ 32%] Building C object Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_filter_by_ext.c.o
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:358:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:387:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/CPack/OSXScriptLauncher.cxx.o] Error 1
[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/all] Error 2
[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....

...

[cmake-3.8.1] make[2]: *** [all] Error 2
[cmake-3.8.1] Error installing CMake.
[cmake-3.8.1] 
[cmake-3.8.1] real	3m12.199s
[cmake-3.8.1] user	1m45.730s
[cmake-3.8.1] sys	1m13.808s
[cmake-3.8.1] ************************************************************************
[cmake-3.8.1] Error installing package cmake-3.8.1
[cmake-3.8.1] ************************************************************************

...
```
I will upload the log file in a moment.

I am using:

```
$ xcodebuild -version
Xcode 6.3
Build version 6D570
```



---

archive/issue_comments_346670.json:
```json
{
    "body": "On OSX 10.10.2 Yosemite with XCode 6.3",
    "created_at": "2017-05-18T13:15:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346670",
    "user": "https://github.com/seblabbe"
}
```

On OSX 10.10.2 Yosemite with XCode 6.3



---

archive/issue_comments_346671.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nAttachment: **[cmake-3.8.1.log](https://github.com/sagemath/sage/files/ticket22999/cmake-3.8.1.log)**\n\nA similar error was reported in [#18078 comment:10](https://github.com/sagemath/sage/issues/18078#comment:10)\n\nand the following patch (deleted in #22814 : update cmake to 3.8.0) was used to fix the issue: \n\n`git show c73f9e2a65d7bf25506db176b0832c2d2cb73edd`",
    "created_at": "2017-05-18T13:27:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346671",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:31" align="right">Comment 31</div>

Attachment: **[cmake-3.8.1.log](https://github.com/sagemath/sage/files/ticket22999/cmake-3.8.1.log)**

A similar error was reported in [#18078 comment:10](https://github.com/sagemath/sage/issues/18078#comment:10)

and the following patch (deleted in #22814 : update cmake to 3.8.0) was used to fix the issue: 

`git show c73f9e2a65d7bf25506db176b0832c2d2cb73edd`



---

archive/issue_comments_346672.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nI tried to reuse the same `osx10.10.patch`, but it does not apply on `cmake-3.8.1` anymore.",
    "created_at": "2017-05-18T13:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346672",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:32" align="right">Comment 32</div>

I tried to reuse the same `osx10.10.patch`, but it does not apply on `cmake-3.8.1` anymore.



---

archive/issue_comments_346673.json:
```json
{
    "body": "Changed branch from **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)** to **[u/tmonteil/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/cmakeupd)**",
    "created_at": "2017-05-18T14:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346673",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed branch from **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)** to **[u/tmonteil/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/cmakeupd)**



---

archive/issue_comments_346674.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@seblabbe](#comment%3A32):\n> I tried to reuse the same `osx10.10.patch`, but it does not apply on `cmake-3.8.1` anymore.\n\nI rewrote the patch so that it applies on `cmake-3.8.1`, and add it to the branch, does this fix the issue ?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13\">15d1b35</a></td><td><code>#21668 : rewrite osx10.10.patch for cmake 3.8.1.</code></td></tr></table>\n",
    "created_at": "2017-05-18T14:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346674",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@seblabbe](#comment%3A32):
> I tried to reuse the same `osx10.10.patch`, but it does not apply on `cmake-3.8.1` anymore.

I rewrote the patch so that it applies on `cmake-3.8.1`, and add it to the branch, does this fix the issue ?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13">15d1b35</a></td><td><code>#21668 : rewrite osx10.10.patch for cmake 3.8.1.</code></td></tr></table>




---

archive/issue_comments_346675.json:
```json
{
    "body": "Changed commit from **[8fbe406](https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b)** to **[15d1b35](https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13)**",
    "created_at": "2017-05-18T14:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346675",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed commit from **[8fbe406](https://github.com/sagemath/sagetrac-mirror/commit/8fbe406aa71fbeeeb07477f307e98cc71c56a15b)** to **[15d1b35](https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13)**



---

archive/issue_comments_346676.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nFWIW, the current branch compiles and self-tests pass on my x86_64 laptop.",
    "created_at": "2017-05-18T14:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346676",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:35" align="right">Comment 35</div>

FWIW, the current branch compiles and self-tests pass on my x86_64 laptop.



---

archive/issue_comments_346677.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nSorry, my internet connection is not working or very slow...\n\nI still get an error:\n\n```\n[cmake-3.8.1] [ 88%] Building CXX object Source/CMakeFiles/CTestLib.dir/CTest/cmParseMumpsCoverage.cxx.o\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:358:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:387:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx: In member function 'virtual int cmCPackDragNDropGenerator::PackageFiles()':\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:181:3: error: 'sort' is not a member of 'std'\n[cmake-3.8.1]    std::sort(package_files.begin(), package_files.end());\n[cmake-3.8.1]    ^\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:182:23: error: 'unique' is not a member of 'std'\n[cmake-3.8.1]    package_files.erase(std::unique(package_files.begin(), package_files.end()),\n[cmake-3.8.1]                        ^\n[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/CPackLib.dir/CPack/cmCPackDragNDropGenerator.cxx.o] Error 1\n[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/CPackLib.dir/all] Error 2\n[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....\n```",
    "created_at": "2017-05-18T16:57:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346677",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:36" align="right">Comment 36</div>

Sorry, my internet connection is not working or very slow...

I still get an error:

```
[cmake-3.8.1] [ 88%] Building CXX object Source/CMakeFiles/CTestLib.dir/CTest/cmParseMumpsCoverage.cxx.o
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:358:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:387:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:50:0,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
[cmake-3.8.1]                  from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
[cmake-3.8.1]                  from CPack/cmCPackDragNDropGenerator.cxx:16:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx: In member function 'virtual int cmCPackDragNDropGenerator::PackageFiles()':
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:181:3: error: 'sort' is not a member of 'std'
[cmake-3.8.1]    std::sort(package_files.begin(), package_files.end());
[cmake-3.8.1]    ^
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:182:23: error: 'unique' is not a member of 'std'
[cmake-3.8.1]    package_files.erase(std::unique(package_files.begin(), package_files.end()),
[cmake-3.8.1]                        ^
[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/CPackLib.dir/CPack/cmCPackDragNDropGenerator.cxx.o] Error 1
[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/CPackLib.dir/all] Error 2
[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....
```



---

archive/issue_comments_346678.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nMaybe the patch should contain one more fix?\n\n```\n$ cd local/var/tmp/sage/build/cmake-3.8.1\n$ grep CoreFoundation src/Source/*.cxx\nsrc/Source/cmFindProgramCommand.cxx:#include <CoreFoundation/CFBundle.h>\nsrc/Source/cmXCodeObject.cxx:#include <CoreFoundation/CFUUID.h>\n$ grep CoreFoundation src/Source/CPack/*.cxx\nsrc/Source/CPack/OSXScriptLauncher.cxx:#include <CoreFoundation/CFBundle.h>\nsrc/Source/CPack/cmCPackDragNDropGenerator.cxx:#include <CoreFoundation/CoreFoundation.h>\n```",
    "created_at": "2017-05-18T17:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346678",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:37" align="right">Comment 37</div>

Maybe the patch should contain one more fix?

```
$ cd local/var/tmp/sage/build/cmake-3.8.1
$ grep CoreFoundation src/Source/*.cxx
src/Source/cmFindProgramCommand.cxx:#include <CoreFoundation/CFBundle.h>
src/Source/cmXCodeObject.cxx:#include <CoreFoundation/CFUUID.h>
$ grep CoreFoundation src/Source/CPack/*.cxx
src/Source/CPack/OSXScriptLauncher.cxx:#include <CoreFoundation/CFBundle.h>
src/Source/CPack/cmCPackDragNDropGenerator.cxx:#include <CoreFoundation/CoreFoundation.h>
```



---

archive/issue_comments_346679.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nAdding Isuru Fernando who wrote the first OSX patch in CC.",
    "created_at": "2017-05-18T18:24:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346679",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:38" align="right">Comment 38</div>

Adding Isuru Fernando who wrote the first OSX patch in CC.



---

archive/issue_comments_346680.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nYes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.\n\nBtw, #12426 makes this patch unnecessary, but I guess it will take time before that ticket is merged.",
    "created_at": "2017-05-18T18:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346680",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:39" align="right">Comment 39</div>

Yes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.

Btw, #12426 makes this patch unnecessary, but I guess it will take time before that ticket is merged.



---

archive/issue_comments_346681.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93\">3a48f27</a></td><td><code>#21668 : update osx10.10.patch w.r.t. comment 39.</code></td></tr></table>\n",
    "created_at": "2017-05-18T18:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346681",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40" align="right">Comment 40</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93">3a48f27</a></td><td><code>#21668 : update osx10.10.patch w.r.t. comment 39.</code></td></tr></table>




---

archive/issue_comments_346682.json:
```json
{
    "body": "Changed commit from **[15d1b35](https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13)** to **[3a48f27](https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93)**",
    "created_at": "2017-05-18T18:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346682",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[15d1b35](https://github.com/sagemath/sagetrac-mirror/commit/15d1b3566e74ae8e832385d21685a88155d2bb13)** to **[3a48f27](https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93)**



---

archive/issue_comments_346683.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nReplying to [@isuruf](#comment%3A39):\n> Yes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.\n\nThanks for the hint, i updated the patch.\n\nNote that the following files still refer to `<CoreFoundation/CoreFoundation.h>`\n\n```\nUtilities/cmlibuv/src/unix/darwin-proctitle.c\nUtilities/cmcurl/lib/vtls/darwinssl.c\nTests/BundleTest/BundleTest.cxx\nTests/BundleTest/BundleLib.cxx\n```\n\nShould we update them too (and by what should `CoreFoundation.h` be replaced there ?) ?",
    "created_at": "2017-05-18T18:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346683",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:41" align="right">Comment 41</div>

Replying to [@isuruf](#comment%3A39):
> Yes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.

Thanks for the hint, i updated the patch.

Note that the following files still refer to `<CoreFoundation/CoreFoundation.h>`

```
Utilities/cmlibuv/src/unix/darwin-proctitle.c
Utilities/cmcurl/lib/vtls/darwinssl.c
Tests/BundleTest/BundleTest.cxx
Tests/BundleTest/BundleLib.cxx
```

Should we update them too (and by what should `CoreFoundation.h` be replaced there ?) ?



---

archive/issue_comments_346684.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nReplying to [@isuruf](#comment%3A39):\n> Yes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.\n> \n> Btw, #12426 makes this patch unnecessary, but I guess it will take time before that ticket is merged.\n\nWould it make sense then to get rid of the patch and to build cmake with clang, even without #12426? We already do this with several other packages (Python, R, and I think others). So we could add to the spkg-install script:\n\n```\nif [ \"$UNAME\" = Darwin ]; then\n    CC=clang\n    CXX=clang++\nfi\n```\nThat works for me with the version of cmake on this ticket.",
    "created_at": "2017-05-18T18:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346684",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">Comment 42</div>

Replying to [@isuruf](#comment%3A39):
> Yes, looks like `Source/CPack/cmCPackDragNDropGenerator.cxx` needs to replace `<CoreFoundation/CoreFoundation.h>` with `<CoreFoundation/CFString.h>`. I don't have access to OSX to check this though.
> 
> Btw, #12426 makes this patch unnecessary, but I guess it will take time before that ticket is merged.

Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426? We already do this with several other packages (Python, R, and I think others). So we could add to the spkg-install script:

```
if [ "$UNAME" = Darwin ]; then
    CC=clang
    CXX=clang++
fi
```
That works for me with the version of cmake on this ticket.



---

archive/issue_comments_346685.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\n> Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426?\n\nIf you are going in that path, you'd have to use the bundled dependencies instead of the ones in the Sage tree. Sage's packages like curl, xz are built with gcc and mixing them with clang is never a good idea.\n\n> Should we update them too (and by what should `CoreFoundation.h` be replaced there ?) ?\n\nSome of those headers uses lots of functions starting with `CF`. Somebody with access to OSX 10.10 would have to figure out what headers are actually needed.",
    "created_at": "2017-05-18T19:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346685",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:43" align="right">Comment 43</div>

> Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426?

If you are going in that path, you'd have to use the bundled dependencies instead of the ones in the Sage tree. Sage's packages like curl, xz are built with gcc and mixing them with clang is never a good idea.

> Should we update them too (and by what should `CoreFoundation.h` be replaced there ?) ?

Some of those headers uses lots of functions starting with `CF`. Somebody with access to OSX 10.10 would have to figure out what headers are actually needed.



---

archive/issue_comments_346686.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\n... just got my internet connection back.\n\nI managed to\n\n```\n[cmake-3.8.1] Successfully installed cmake-3.8.1\n```\n\non OSX 10.10 with this patch:\n\n```\ndiff -dru src/Source/CPack/cmCPackDragNDropGenerator.cxx new/Source/CPack/cmCPackDragNDropGenerator.cxx\n--- src/Source/CPack/cmCPackDragNDropGenerator.cxx  2017-05-02 14:59:43.000000000 +0200\n+++ new/Source/CPack/cmCPackDragNDropGenerator.cxx  2017-05-18 20:00:39.000000000 +0200\n@@ -12,8 +12,9 @@\n #include <iomanip>\n #include <map>\n #include <stdlib.h>\n+#include <algorithm>\n \n-#include <CoreFoundation/CoreFoundation.h>\n+#include <CoreFoundation/CFBundle.h>\n \n #ifdef HAVE_CoreServices\n // For the old LocaleStringToLangAndRegionCodes() function, to convert\n```\n\nThe `include <algorithm>` was to avoid `error: 'sort' is not a member of 'std'` according to stackoverflow. I will now test `CFString.h` approach.",
    "created_at": "2017-05-18T19:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346686",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:44" align="right">Comment 44</div>

... just got my internet connection back.

I managed to

```
[cmake-3.8.1] Successfully installed cmake-3.8.1
```

on OSX 10.10 with this patch:

```
diff -dru src/Source/CPack/cmCPackDragNDropGenerator.cxx new/Source/CPack/cmCPackDragNDropGenerator.cxx
--- src/Source/CPack/cmCPackDragNDropGenerator.cxx  2017-05-02 14:59:43.000000000 +0200
+++ new/Source/CPack/cmCPackDragNDropGenerator.cxx  2017-05-18 20:00:39.000000000 +0200
@@ -12,8 +12,9 @@
 #include <iomanip>
 #include <map>
 #include <stdlib.h>
+#include <algorithm>
 
-#include <CoreFoundation/CoreFoundation.h>
+#include <CoreFoundation/CFBundle.h>
 
 #ifdef HAVE_CoreServices
 // For the old LocaleStringToLangAndRegionCodes() function, to convert
```

The `include <algorithm>` was to avoid `error: 'sort' is not a member of 'std'` according to stackoverflow. I will now test `CFString.h` approach.



---

archive/issue_comments_346687.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nWith the recently updated branch, no more `error: 'DISPATCH_UNAVAILABLE' does not name a type` but I still get:\n\n```\n$ MAKE='make -j2' sage -f cmake\n\n...\n\n[cmake-3.8.1] [ 96%] Linking CXX executable ../bin/ccmake\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx: In member function 'virtual int cmCPackDragNDropGenerator::PackageFiles()':\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:181:3: error: 'sort' is not a member of 'std'\n[cmake-3.8.1]    std::sort(package_files.begin(), package_files.end());\n[cmake-3.8.1]    ^\n[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:182:23: error: 'unique' is not a member of 'std'\n[cmake-3.8.1]    package_files.erase(std::unique(package_files.begin(), package_files.end()),\n[cmake-3.8.1]                        ^\n[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/CPackLib.dir/CPack/cmCPackDragNDropGenerator.cxx.o] Error 1\n[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/CPackLib.dir/all] Error 2\n[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....\n[cmake-3.8.1] [ 96%] Built target ccmake\n[cmake-3.8.1] make[2]: *** [all] Error 2\n[cmake-3.8.1] Error installing CMake.\n[cmake-3.8.1] \n[cmake-3.8.1] real\t2m53.137s\n[cmake-3.8.1] user\t1m19.425s\n[cmake-3.8.1] sys\t1m3.994s\n[cmake-3.8.1] ************************************************************************\n[cmake-3.8.1] Error installing package cmake-3.8.1\n[cmake-3.8.1] ************************************************************************\n```\n\nTherefore, the `CFBundle.h` or `CFString.h` both work. But `#include <algorithm>` seems to be necessary.",
    "created_at": "2017-05-18T19:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346687",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:45" align="right">Comment 45</div>

With the recently updated branch, no more `error: 'DISPATCH_UNAVAILABLE' does not name a type` but I still get:

```
$ MAKE='make -j2' sage -f cmake

...

[cmake-3.8.1] [ 96%] Linking CXX executable ../bin/ccmake
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx: In member function 'virtual int cmCPackDragNDropGenerator::PackageFiles()':
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:181:3: error: 'sort' is not a member of 'std'
[cmake-3.8.1]    std::sort(package_files.begin(), package_files.end());
[cmake-3.8.1]    ^
[cmake-3.8.1] CPack/cmCPackDragNDropGenerator.cxx:182:23: error: 'unique' is not a member of 'std'
[cmake-3.8.1]    package_files.erase(std::unique(package_files.begin(), package_files.end()),
[cmake-3.8.1]                        ^
[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/CPackLib.dir/CPack/cmCPackDragNDropGenerator.cxx.o] Error 1
[cmake-3.8.1] make[3]: *** [Source/CMakeFiles/CPackLib.dir/all] Error 2
[cmake-3.8.1] make[3]: *** Waiting for unfinished jobs....
[cmake-3.8.1] [ 96%] Built target ccmake
[cmake-3.8.1] make[2]: *** [all] Error 2
[cmake-3.8.1] Error installing CMake.
[cmake-3.8.1] 
[cmake-3.8.1] real	2m53.137s
[cmake-3.8.1] user	1m19.425s
[cmake-3.8.1] sys	1m3.994s
[cmake-3.8.1] ************************************************************************
[cmake-3.8.1] Error installing package cmake-3.8.1
[cmake-3.8.1] ************************************************************************
```

Therefore, the `CFBundle.h` or `CFString.h` both work. But `#include <algorithm>` seems to be necessary.



---

archive/issue_comments_346688.json:
```json
{
    "body": "Changed commit from **[3a48f27](https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93)** to **[f5ce853](https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486)**",
    "created_at": "2017-05-18T20:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346688",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3a48f27](https://github.com/sagemath/sagetrac-mirror/commit/3a48f272dba4fbc693eaf77db69c9adb4cc9af93)** to **[f5ce853](https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486)**



---

archive/issue_comments_346689.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486\">f5ce853</a></td><td><code>#21668 : update osx10.10.patch w.r.t. comment 45.</code></td></tr></table>\n",
    "created_at": "2017-05-18T20:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346689",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46" align="right">Comment 46</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486">f5ce853</a></td><td><code>#21668 : update osx10.10.patch w.r.t. comment 45.</code></td></tr></table>




---

archive/issue_comments_346690.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@seblabbe](#comment%3A45):\n> Therefore, the `CFBundle.h` or `CFString.h` both work. But `#include <algorithm>` seems to be necessary.\n\nPatch updated.",
    "created_at": "2017-05-18T20:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346690",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@seblabbe](#comment%3A45):
> Therefore, the `CFBundle.h` or `CFString.h` both work. But `#include <algorithm>` seems to be necessary.

Patch updated.



---

archive/issue_comments_346691.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nCould you also test with `sage -f -c cmake` to see if self-tests pass ?",
    "created_at": "2017-05-18T20:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346691",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:48" align="right">Comment 48</div>

Could you also test with `sage -f -c cmake` to see if self-tests pass ?



---

archive/issue_comments_346692.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nI confirm that it now works on OSX 10.10:\n\n```\n$ MAKE='make -j2' sage -f cmake\n...\n[cmake-3.8.1] Successfully installed cmake-3.8.1\n[cmake-3.8.1] Deleting temporary build directory\n[cmake-3.8.1] /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1\n[cmake-3.8.1] Finished installing cmake-3.8.1.spkg\n```\n\n(why .spkg?)\n\nI will now do the `-f -c` and report back.",
    "created_at": "2017-05-18T20:19:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346692",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:49" align="right">Comment 49</div>

I confirm that it now works on OSX 10.10:

```
$ MAKE='make -j2' sage -f cmake
...
[cmake-3.8.1] Successfully installed cmake-3.8.1
[cmake-3.8.1] Deleting temporary build directory
[cmake-3.8.1] /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1
[cmake-3.8.1] Finished installing cmake-3.8.1.spkg
```

(why .spkg?)

I will now do the `-f -c` and report back.



---

archive/issue_comments_346693.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nStill running the tests...\n\n```\n[cmake-3.8.1] 126/448 Test #126: CPackComponentsForAll-DragNDrop-OnePackPerGroup ......   Passed   50.00 sec\n```\n\nI just saw this typo in the branch:\n\n`acknoledged`\n\nAlso, the last three commits refer erroneously to 21668. I think the commit messages should be edited to 22999 to avoid possible confusion.",
    "created_at": "2017-05-18T20:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346693",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:50" align="right">Comment 50</div>

Still running the tests...

```
[cmake-3.8.1] 126/448 Test #126: CPackComponentsForAll-DragNDrop-OnePackPerGroup ......   Passed   50.00 sec
```

I just saw this typo in the branch:

`acknoledged`

Also, the last three commits refer erroneously to 21668. I think the commit messages should be edited to 22999 to avoid possible confusion.



---

archive/issue_comments_346694.json:
```json
{
    "body": "Changed commit from **[f5ce853](https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486)** to **[ef2291b](https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b)**",
    "created_at": "2017-05-18T20:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346694",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f5ce853](https://github.com/sagemath/sagetrac-mirror/commit/f5ce853024e444bc29680e935e3a8435e7f4a486)** to **[ef2291b](https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b)**



---

archive/issue_comments_346695.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8de5fc7b1670198b87738ce120679d37ad1ac262\">8de5fc7</a></td><td><code>Trac #22999 : rewrite osx10.10.patch for cmake 3.8.1.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ca4ce5e40d43e8cc62f819d198a8721de5d4488\">5ca4ce5</a></td><td><code>Trac #22999 : update osx10.10.patch w.r.t. comment 39.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b\">ef2291b</a></td><td><code>Trac #22999 : update osx10.10.patch w.r.t. comment 45.</code></td></tr></table>\n",
    "created_at": "2017-05-18T20:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346695",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51" align="right">Comment 51</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8de5fc7b1670198b87738ce120679d37ad1ac262">8de5fc7</a></td><td><code>Trac #22999 : rewrite osx10.10.patch for cmake 3.8.1.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ca4ce5e40d43e8cc62f819d198a8721de5d4488">5ca4ce5</a></td><td><code>Trac #22999 : update osx10.10.patch w.r.t. comment 39.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b">ef2291b</a></td><td><code>Trac #22999 : update osx10.10.patch w.r.t. comment 45.</code></td></tr></table>




---

archive/issue_comments_346696.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nReplying to [@seblabbe](#comment%3A50):\n> Also, the last three commits refer erroneously to 21668. I think the commit messages should be edited to 22999 to avoid possible confusion.\n\nFor some reason i ignore, my branch was called `t/22999/21668`, then i copy/pasted the wrong number. Should be fixed now, sorry for the noise.",
    "created_at": "2017-05-18T21:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346696",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:52" align="right">Comment 52</div>

Replying to [@seblabbe](#comment%3A50):
> Also, the last three commits refer erroneously to 21668. I think the commit messages should be edited to 22999 to avoid possible confusion.

For some reason i ignore, my branch was called `t/22999/21668`, then i copy/pasted the wrong number. Should be fixed now, sorry for the noise.



---

archive/issue_comments_346697.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nReplying to [@isuruf](#comment%3A43):\n> > Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426?\n\n> \n> If you are going in that path, you'd have to use the bundled dependencies instead of the ones in the Sage tree. Sage's packages like curl, xz are built with gcc and mixing them with clang is never a good idea.\n\nNot necessarily. It depends if they are pure C library or if they have C++ in them. If is OK to mix compiler for pure C code (standard compliant code, most of the time) mainly thanks to the fact that the C language is well established and that in both gcc and clang case you will use the OS' libc. As a matter of fact we already compile several packages on OS X with clang instead of gcc to avoid the system header problem. The most troublesome being python itself (and then you compile all the python modules with gcc and yet it works!). And you should also note that `curl` is actually a clang compile on OS X too.\n\nSo I'd only build libraries that cmake links too containing c++. At the present time I believe it is none, so it is quite safe.",
    "created_at": "2017-05-18T21:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346697",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:53" align="right">Comment 53</div>

Replying to [@isuruf](#comment%3A43):
> > Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426?

> 
> If you are going in that path, you'd have to use the bundled dependencies instead of the ones in the Sage tree. Sage's packages like curl, xz are built with gcc and mixing them with clang is never a good idea.

Not necessarily. It depends if they are pure C library or if they have C++ in them. If is OK to mix compiler for pure C code (standard compliant code, most of the time) mainly thanks to the fact that the C language is well established and that in both gcc and clang case you will use the OS' libc. As a matter of fact we already compile several packages on OS X with clang instead of gcc to avoid the system header problem. The most troublesome being python itself (and then you compile all the python modules with gcc and yet it works!). And you should also note that `curl` is actually a clang compile on OS X too.

So I'd only build libraries that cmake links too containing c++. At the present time I believe it is none, so it is quite safe.



---

archive/issue_comments_346698.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nOk, so I get:\n\n```\n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1] \t168 - XCTest (Failed)\n[cmake-3.8.1] \t177 - ObjC++ (Failed)\n[cmake-3.8.1] \t386 - RunCMake.FindGTK2 (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\n\nThe first two have such error line:\n\n```\ngcc: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest/CocoaExample/main.m: Objective-C compiler not installed on this system\n```\n\nI am not able to understand test 386, so I paste all of it:\n\n```\ntest 386\n        Start 386: RunCMake.FindGTK2\n\n386: Test command: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/bin/cmake \"-DCMAKE_MODULE_PATH=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake\" \"-DRunCMake_GENERATOR=Unix Makefiles\" \"-DRunCMake_GENERATOR_PLATFORM=\" \"-DRunCMake_GENERATOR_TOOLSET=\" \"-DRunCMake_MAKE_PROGRAM=/usr/bin/make\" \"-DRunCMake_SOURCE_DIR=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2\" \"-DRunCMake_BINARY_DIR=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2\" \"-P\" \"/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2/RunCMakeTest.cmake\"\n386: Test timeout computed to be: 1500\n386: CMake Error at RunCMake.cmake:132 (message):\n386:   FindGTK2RunTwice - FAILED:\n386: \n386:   Result is [1], not [0].\n386: \n386:   stderr does not match that expected.\n386: \n386:   Actual stdout:\n386: \n386:    actual-out> Not searching for unused variables given on the command line.\n386:    actual-out> -- The C compiler identification is GNU 4.9.3\n386:    actual-out> -- Checking whether C compiler has -isysroot\n386:    actual-out> -- Checking whether C compiler has -isysroot - yes\n386:    actual-out> -- Checking whether C compiler supports OSX deployment target flag\n386:    actual-out> -- Checking whether C compiler supports OSX deployment target flag - yes\n386:    actual-out> -- Check for working C compiler: /Users/slabbe/Applications/sage-git/local/libexec/ccache/gcc\n386:    actual-out> -- Check for working C compiler: /Users/slabbe/Applications/sage-git/local/libexec/ccache/gcc -- works\n386:    actual-out> -- Detecting C compiler ABI info\n386:    actual-out> -- Detecting C compiler ABI info - done\n386:    actual-out> -- Detecting C compile features\n386:    actual-out> -- Detecting C compile features - done\n386:    actual-out> -- Found GTK2_GTK: /opt/local/lib/libgtk-x11-2.0.dylib  \n386:    actual-out> -- Configuring incomplete, errors occurred!\n386:    actual-out> See also \"/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2/FindGTK2RunTwice-build/CMakeFiles/CMakeOutput.log\".\n386: \n386:   Expected stderr to match:\n386: \n386:    expect-err> ^$\n386: \n386:   Actual stderr:\n386: \n386:    actual-err> CMake Error at FindGTK2RunTwice.cmake:16 (message):\n386:    actual-err>   GTK2_LIBRARIES is different:\n386:    actual-err> \n386:    actual-err>   before:\n386:    actual-err>   /opt/local/lib/libglib-2.0.dylib;/opt/local/lib/libgobject-2.0.dylib;/opt/local/lib/libatk-1.0.dylib;/opt/local/lib/libgio-2.0.dylib;/opt/local/lib/libgthread-2.0.dylib;/opt/local/lib/libgmodule-2.0.dylib;/opt/local/lib/libgdk_pixbuf-2.0.dylib;/opt/local/lib/libcairo.dylib;/opt/local/lib/libpango-1.0.dylib;/opt/local/lib/libpangocairo-1.0.dylib;/opt/local/lib/libpangoft2-1.0.dylib;/opt/local/lib/libpangoxft-1.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib\n386:    actual-err> \n386:    actual-err> \n386:    actual-err>   after:\n386:    actual-err>   /opt/local/lib/libglib-2.0.dylib;/opt/local/lib/libgobject-2.0.dylib;/opt/local/lib/libatk-1.0.dylib;/opt/local/lib/libgio-2.0.dylib;/opt/local/lib/libgthread-2.0.dylib;/opt/local/lib/libgmodule-2.0.dylib;/opt/local/lib/libgdk_pixbuf-2.0.dylib;/opt/local/lib/libcairo.dylib;/opt/local/lib/libpango-1.0.dylib;/opt/local/lib/libpangocairo-1.0.dylib;/opt/local/lib/libpangoft2-1.0.dylib;/opt/local/lib/libpangoxft-1.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib\n386:    actual-err> Call Stack (most recent call first):\n386:    actual-err>   CMakeLists.txt:3 (include)\n386: \n386: Call Stack (most recent call first):\n386:   FindGTK2/RunCMakeTest.cmake:3 (run_cmake)\n386: \n386: \n386/448 Test #386: RunCMake.FindGTK2 ....................................***Failed    8.61 sec\n```",
    "created_at": "2017-05-18T21:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346698",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:54" align="right">Comment 54</div>

Ok, so I get:

```
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1] 	168 - XCTest (Failed)
[cmake-3.8.1] 	177 - ObjC++ (Failed)
[cmake-3.8.1] 	386 - RunCMake.FindGTK2 (Failed)
[cmake-3.8.1] Errors while running CTest
```

The first two have such error line:

```
gcc: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest/CocoaExample/main.m: Objective-C compiler not installed on this system
```

I am not able to understand test 386, so I paste all of it:

```
test 386
        Start 386: RunCMake.FindGTK2

386: Test command: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/bin/cmake "-DCMAKE_MODULE_PATH=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake" "-DRunCMake_GENERATOR=Unix Makefiles" "-DRunCMake_GENERATOR_PLATFORM=" "-DRunCMake_GENERATOR_TOOLSET=" "-DRunCMake_MAKE_PROGRAM=/usr/bin/make" "-DRunCMake_SOURCE_DIR=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2" "-DRunCMake_BINARY_DIR=/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2" "-P" "/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2/RunCMakeTest.cmake"
386: Test timeout computed to be: 1500
386: CMake Error at RunCMake.cmake:132 (message):
386:   FindGTK2RunTwice - FAILED:
386: 
386:   Result is [1], not [0].
386: 
386:   stderr does not match that expected.
386: 
386:   Actual stdout:
386: 
386:    actual-out> Not searching for unused variables given on the command line.
386:    actual-out> -- The C compiler identification is GNU 4.9.3
386:    actual-out> -- Checking whether C compiler has -isysroot
386:    actual-out> -- Checking whether C compiler has -isysroot - yes
386:    actual-out> -- Checking whether C compiler supports OSX deployment target flag
386:    actual-out> -- Checking whether C compiler supports OSX deployment target flag - yes
386:    actual-out> -- Check for working C compiler: /Users/slabbe/Applications/sage-git/local/libexec/ccache/gcc
386:    actual-out> -- Check for working C compiler: /Users/slabbe/Applications/sage-git/local/libexec/ccache/gcc -- works
386:    actual-out> -- Detecting C compiler ABI info
386:    actual-out> -- Detecting C compiler ABI info - done
386:    actual-out> -- Detecting C compile features
386:    actual-out> -- Detecting C compile features - done
386:    actual-out> -- Found GTK2_GTK: /opt/local/lib/libgtk-x11-2.0.dylib  
386:    actual-out> -- Configuring incomplete, errors occurred!
386:    actual-out> See also "/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/RunCMake/FindGTK2/FindGTK2RunTwice-build/CMakeFiles/CMakeOutput.log".
386: 
386:   Expected stderr to match:
386: 
386:    expect-err> ^$
386: 
386:   Actual stderr:
386: 
386:    actual-err> CMake Error at FindGTK2RunTwice.cmake:16 (message):
386:    actual-err>   GTK2_LIBRARIES is different:
386:    actual-err> 
386:    actual-err>   before:
386:    actual-err>   /opt/local/lib/libglib-2.0.dylib;/opt/local/lib/libgobject-2.0.dylib;/opt/local/lib/libatk-1.0.dylib;/opt/local/lib/libgio-2.0.dylib;/opt/local/lib/libgthread-2.0.dylib;/opt/local/lib/libgmodule-2.0.dylib;/opt/local/lib/libgdk_pixbuf-2.0.dylib;/opt/local/lib/libcairo.dylib;/opt/local/lib/libpango-1.0.dylib;/opt/local/lib/libpangocairo-1.0.dylib;/opt/local/lib/libpangoft2-1.0.dylib;/opt/local/lib/libpangoxft-1.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib
386:    actual-err> 
386:    actual-err> 
386:    actual-err>   after:
386:    actual-err>   /opt/local/lib/libglib-2.0.dylib;/opt/local/lib/libgobject-2.0.dylib;/opt/local/lib/libatk-1.0.dylib;/opt/local/lib/libgio-2.0.dylib;/opt/local/lib/libgthread-2.0.dylib;/opt/local/lib/libgmodule-2.0.dylib;/opt/local/lib/libgdk_pixbuf-2.0.dylib;/opt/local/lib/libcairo.dylib;/opt/local/lib/libpango-1.0.dylib;/opt/local/lib/libpangocairo-1.0.dylib;/opt/local/lib/libpangoft2-1.0.dylib;/opt/local/lib/libpangoxft-1.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgdk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib;/opt/local/lib/libgtk-x11-2.0.dylib
386:    actual-err> Call Stack (most recent call first):
386:    actual-err>   CMakeLists.txt:3 (include)
386: 
386: Call Stack (most recent call first):
386:   FindGTK2/RunCMakeTest.cmake:3 (run_cmake)
386: 
386: 
386/448 Test #386: RunCMake.FindGTK2 ....................................***Failed    8.61 sec
```



---

archive/issue_comments_346699.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nIt looks like you have a local install of gtk2 on OS X and cmake has trouble figuring out your install. I am not sure how it looks for the libraries (I think .pc files) but your install has a library in triplicate compared to what is expected. I would presume that it is done to an error in configuration of your local gtk2 package.\n\nThe other 2 are a bit puzzling. Yes gcc/g++ was not built as an objective-C/objective-C++ compiler. But we set those to clang/clang++ in sage-env so there is a different problem. I wonder if cmake is trying to use CC/CXX as objective compilers rather than using the correct OBJC/OBJCXX. \n\nIn any case I think we should just compile cmake with clang/clang++. As I said before it shouldn't be a problem at this time. That wouldn't solve your gtk2 problem because I think your gtk2 install is at fault here.",
    "created_at": "2017-05-18T21:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346699",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:55" align="right">Comment 55</div>

It looks like you have a local install of gtk2 on OS X and cmake has trouble figuring out your install. I am not sure how it looks for the libraries (I think .pc files) but your install has a library in triplicate compared to what is expected. I would presume that it is done to an error in configuration of your local gtk2 package.

The other 2 are a bit puzzling. Yes gcc/g++ was not built as an objective-C/objective-C++ compiler. But we set those to clang/clang++ in sage-env so there is a different problem. I wonder if cmake is trying to use CC/CXX as objective compilers rather than using the correct OBJC/OBJCXX. 

In any case I think we should just compile cmake with clang/clang++. As I said before it shouldn't be a problem at this time. That wouldn't solve your gtk2 problem because I think your gtk2 install is at fault here.



---

archive/issue_comments_346700.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nIn case it helps, here are more context for the first two failing tests:\n\n```\n168: Run Build Command:\"/usr/bin/make\"\n168: -- Configuring done\n168: -- Generating done\n168: -- Build files have been written to: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest\n168: Scanning dependencies of target CocoaExample\n168: [ 11%] Building C object CMakeFiles/CocoaExample.dir/CocoaExample/main.m.o\n168: gcc: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest/CocoaExample/main.m: Objective-C compiler not installed on this system\n168: make[4]: *** [CMakeFiles/CocoaExample.dir/CocoaExample/main.m.o] Error 1\n168: make[3]: *** [CMakeFiles/CocoaExample.dir/all] Error 2\n168: make[2]: *** [all] Error 2\n168/448 Test #168: XCTest ...............................................***Failed   11.06 sec\n```\n\n```\n177: Run Build Command:\"/usr/bin/make\"\n177: Scanning dependencies of target ObjC++\n177: [ 50%] Building CXX object CMakeFiles/ObjC++.dir/objc++.mm.o\n177: g++: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/ObjC++/objc++.mm: Objective-C++ compiler not installed on this system\n177: make[4]: *** [CMakeFiles/ObjC++.dir/objc++.mm.o] Error 1\n177: make[3]: *** [CMakeFiles/ObjC++.dir/all] Error 2\n177: make[2]: *** [all] Error 2\n177/448 Test #177: ObjC++ ...............................................***Failed    9.65 sec\n```",
    "created_at": "2017-05-18T22:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346700",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:56" align="right">Comment 56</div>

In case it helps, here are more context for the first two failing tests:

```
168: Run Build Command:"/usr/bin/make"
168: -- Configuring done
168: -- Generating done
168: -- Build files have been written to: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest
168: Scanning dependencies of target CocoaExample
168: [ 11%] Building C object CMakeFiles/CocoaExample.dir/CocoaExample/main.m.o
168: gcc: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/XCTest/CocoaExample/main.m: Objective-C compiler not installed on this system
168: make[4]: *** [CMakeFiles/CocoaExample.dir/CocoaExample/main.m.o] Error 1
168: make[3]: *** [CMakeFiles/CocoaExample.dir/all] Error 2
168: make[2]: *** [all] Error 2
168/448 Test #168: XCTest ...............................................***Failed   11.06 sec
```

```
177: Run Build Command:"/usr/bin/make"
177: Scanning dependencies of target ObjC++
177: [ 50%] Building CXX object CMakeFiles/ObjC++.dir/objc++.mm.o
177: g++: error: /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/cmake-3.8.1/src/Tests/ObjC++/objc++.mm: Objective-C++ compiler not installed on this system
177: make[4]: *** [CMakeFiles/ObjC++.dir/objc++.mm.o] Error 1
177: make[3]: *** [CMakeFiles/ObjC++.dir/all] Error 2
177: make[2]: *** [all] Error 2
177/448 Test #177: ObjC++ ...............................................***Failed    9.65 sec
```



---

archive/issue_comments_346701.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nReplying to [@kiwifb](#comment%3A55):\n> I think your gtk2 install is at fault here.\n\nOk, so what should I do to fix the installation of gtk2? Uninstall and reinstall? With `sudo port ...`? I never directly used/installed gtk before...",
    "created_at": "2017-05-18T22:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346701",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:57" align="right">Comment 57</div>

Replying to [@kiwifb](#comment%3A55):
> I think your gtk2 install is at fault here.

Ok, so what should I do to fix the installation of gtk2? Uninstall and reinstall? With `sudo port ...`? I never directly used/installed gtk before...



---

archive/issue_comments_346702.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nCould be a cmake upstream mistake. It shouldn't be C/CXX objects if it has objective C/C++ bits in it. I may dig it a bit, but it looks like it expect CC and CXX to be \"objective\" capable without checking first.\n\nI cannot say about gtk2. I have never installed it either. All I know from your logs is you have it under `/opt`. Let's see what is under `/opt/local/lib/pkgconfig` on your system.",
    "created_at": "2017-05-18T22:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346702",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:58" align="right">Comment 58</div>

Could be a cmake upstream mistake. It shouldn't be C/CXX objects if it has objective C/C++ bits in it. I may dig it a bit, but it looks like it expect CC and CXX to be "objective" capable without checking first.

I cannot say about gtk2. I have never installed it either. All I know from your logs is you have it under `/opt`. Let's see what is under `/opt/local/lib/pkgconfig` on your system.



---

archive/issue_comments_346703.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\n\n```\n$ ls /opt/local/lib/pkgconfig/gtk*\n/opt/local/lib/pkgconfig/gtk+-2.0.pc\t\n/opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc\t\n/opt/local/lib/pkgconfig/gtk+-x11-2.0.pc\n```\n\nand their content is:\n\n```\n$ cat /opt/local/lib/pkgconfig/gtk+-2.0.pc \nprefix=/opt/local\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincludedir=${prefix}/include\ntarget=x11\n\ngtk_binary_version=2.10.0\ngtk_host=x86_64-apple-darwin14.5.0\n\nName: GTK+\nDescription: GTK+ Graphical UI Library (${target} target)\nVersion: 2.24.28\nRequires: gdk-${target}-2.0 atk cairo gdk-pixbuf-2.0 gio-2.0 pangoft2\nLibs: -L${libdir} -lgtk-${target}-2.0 \nCflags: -I${includedir}/gtk-2.0 \n\n$ cat /opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc\nprefix=/opt/local\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincludedir=${prefix}/include\ntarget=x11\n\ngtk_binary_version=2.10.0\ngtk_host=x86_64-apple-darwin14.5.0\n\nName: GTK+\nDescription: GTK+ Unix print support\nVersion: 2.24.28\nRequires: gtk+-${target}-2.0 atk cairo gdk-pixbuf-2.0 gio-2.0 pangoft2\nCflags: -I${includedir}/gtk-unix-print-2.0\n\n$ diff /opt/local/lib/pkgconfig/gtk+-2.0.pc /opt/local/lib/pkgconfig/gtk+-x11-2.0.pc\n$\n```",
    "created_at": "2017-05-18T22:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346703",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:59" align="right">Comment 59</div>


```
$ ls /opt/local/lib/pkgconfig/gtk*
/opt/local/lib/pkgconfig/gtk+-2.0.pc	
/opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc	
/opt/local/lib/pkgconfig/gtk+-x11-2.0.pc
```

and their content is:

```
$ cat /opt/local/lib/pkgconfig/gtk+-2.0.pc 
prefix=/opt/local
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include
target=x11

gtk_binary_version=2.10.0
gtk_host=x86_64-apple-darwin14.5.0

Name: GTK+
Description: GTK+ Graphical UI Library (${target} target)
Version: 2.24.28
Requires: gdk-${target}-2.0 atk cairo gdk-pixbuf-2.0 gio-2.0 pangoft2
Libs: -L${libdir} -lgtk-${target}-2.0 
Cflags: -I${includedir}/gtk-2.0 

$ cat /opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc
prefix=/opt/local
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include
target=x11

gtk_binary_version=2.10.0
gtk_host=x86_64-apple-darwin14.5.0

Name: GTK+
Description: GTK+ Unix print support
Version: 2.24.28
Requires: gtk+-${target}-2.0 atk cairo gdk-pixbuf-2.0 gio-2.0 pangoft2
Cflags: -I${includedir}/gtk-unix-print-2.0

$ diff /opt/local/lib/pkgconfig/gtk+-2.0.pc /opt/local/lib/pkgconfig/gtk+-x11-2.0.pc
$
```



---

archive/issue_comments_346704.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nBy the way how did it get there? What installed it?",
    "created_at": "2017-05-18T22:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346704",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:60" align="right">Comment 60</div>

By the way how did it get there? What installed it?



---

archive/issue_comments_346705.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nDo you have a `pkg-config` command that see that folder as part of it configuration path - I would image so but we never know. `pkg-config --libs-only-l gtk+2.0` should tell us what is the normal output.",
    "created_at": "2017-05-18T22:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346705",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:61" align="right">Comment 61</div>

Do you have a `pkg-config` command that see that folder as part of it configuration path - I would image so but we never know. `pkg-config --libs-only-l gtk+2.0` should tell us what is the normal output.



---

archive/issue_comments_346706.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nI do not remember, but the files are dating:\n\n```\n$ ll /opt/local/lib/pkgconfig/gtk*\n-rw-r--r--  1 root  admin  397 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-2.0.pc\n-rw-r--r--  1 root  admin  348 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc\n-rw-r--r--  1 root  admin  397 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-x11-2.0.pc\n```\n\nI do not have `pkg-config` command, but it is available in `sage-sh` :\n\n```\n$ pkg-config --libs-only-l gtk+2.0\n-bash: pkg-config: command not found\n$ sage -sh\n(sage-sh) $ pkg-config --libs-only-l gtk+2.0\nPackage gtk+2.0 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `gtk+2.0.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'gtk+2.0', required by 'world', not found\n```",
    "created_at": "2017-05-18T22:43:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346706",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:62" align="right">Comment 62</div>

I do not remember, but the files are dating:

```
$ ll /opt/local/lib/pkgconfig/gtk*
-rw-r--r--  1 root  admin  397 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-2.0.pc
-rw-r--r--  1 root  admin  348 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-unix-print-2.0.pc
-rw-r--r--  1 root  admin  397 14 oct  2015 /opt/local/lib/pkgconfig/gtk+-x11-2.0.pc
```

I do not have `pkg-config` command, but it is available in `sage-sh` :

```
$ pkg-config --libs-only-l gtk+2.0
-bash: pkg-config: command not found
$ sage -sh
(sage-sh) $ pkg-config --libs-only-l gtk+2.0
Package gtk+2.0 was not found in the pkg-config search path.
Perhaps you should add the directory containing `gtk+2.0.pc'
to the PKG_CONFIG_PATH environment variable
Package 'gtk+2.0', required by 'world', not found
```



---

archive/issue_comments_346707.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nNot sure how cmake finds it then, I'll have to inspect. `PKG_CONFIG_PATH= PKG_CONFIG_PATH pkg-config --libs-only-l gtk+2.0` would work but I don't think that cmake uses that if it is not found by default.",
    "created_at": "2017-05-18T22:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346707",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:63" align="right">Comment 63</div>

Not sure how cmake finds it then, I'll have to inspect. `PKG_CONFIG_PATH= PKG_CONFIG_PATH pkg-config --libs-only-l gtk+2.0` would work but I don't think that cmake uses that if it is not found by default.



---

archive/issue_comments_346708.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nThere was a typo. It is `gtk+-2.0` not `gtk+2.0`:\n\n```\n$ /opt/local/bin/pkg-config --libs-only-l gtk+-2.0\n-lgtk-x11-2.0 -lgdk-x11-2.0 -lpangocairo-1.0 -lgio-2.0 -lXrender -lXinerama -lXi \n-lXrandr -lXcursor -lXcomposite -lXdamage -lXfixes -lX11 -lXext -latk-1.0 -lcairo \n-lgdk_pixbuf-2.0 -lgio-2.0 -lpangoft2-1.0 -lpango-1.0 -lgobject-2.0 -lglib-2.0 \n-lintl -lfontconfig -lfreetype \n```",
    "created_at": "2017-05-18T22:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346708",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:64" align="right">Comment 64</div>

There was a typo. It is `gtk+-2.0` not `gtk+2.0`:

```
$ /opt/local/bin/pkg-config --libs-only-l gtk+-2.0
-lgtk-x11-2.0 -lgdk-x11-2.0 -lpangocairo-1.0 -lgio-2.0 -lXrender -lXinerama -lXi 
-lXrandr -lXcursor -lXcomposite -lXdamage -lXfixes -lX11 -lXext -latk-1.0 -lcairo 
-lgdk_pixbuf-2.0 -lgio-2.0 -lpangoft2-1.0 -lpango-1.0 -lgobject-2.0 -lglib-2.0 
-lintl -lfontconfig -lfreetype 
```



---

archive/issue_comments_346709.json:
```json
{
    "body": "Changed keywords from **** to **thursdaysbdx**",
    "created_at": "2017-05-18T22:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346709",
    "user": "https://github.com/seblabbe"
}
```

Changed keywords from **** to **thursdaysbdx**



---

archive/issue_comments_346710.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [@jhpalmieri](#comment%3A42):\n> Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426? We already do this with several other packages (Python, R, and I think others). So we could add to the spkg-install script:\n> \n> ```\n> if [ \"$UNAME\" = Darwin ]; then\n>     CC=clang\n>     CXX=clang++\n> fi\n> ```\n> That works for me with the version of cmake on this ticket.\n\nWhat is next for this ticket? Do we keep the osx patch, or should we test the other option mentionned in [jhpalmieri](#comment%3A42) for using `clang`?",
    "created_at": "2017-05-24T21:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346710",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [@jhpalmieri](#comment%3A42):
> Would it make sense then to get rid of the patch and to build cmake with clang, even without #12426? We already do this with several other packages (Python, R, and I think others). So we could add to the spkg-install script:
> 
> ```
> if [ "$UNAME" = Darwin ]; then
>     CC=clang
>     CXX=clang++
> fi
> ```
> That works for me with the version of cmake on this ticket.

What is next for this ticket? Do we keep the osx patch, or should we test the other option mentionned in [jhpalmieri](#comment%3A42) for using `clang`?



---

archive/issue_comments_346711.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nMy vote is to go `clang` simpler, easier to maintain. Open to revision if there are C++ problems. In fact I'd say we should try with only `CC=clang` and leave `CXX` alone. The only problems are usually related to the C language because apple uses a clang extension to C, with no equivalent in gcc, in OS X's libc and headers. C++ should be safe.",
    "created_at": "2017-05-24T21:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346711",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:67" align="right">Comment 67</div>

My vote is to go `clang` simpler, easier to maintain. Open to revision if there are C++ problems. In fact I'd say we should try with only `CC=clang` and leave `CXX` alone. The only problems are usually related to the C language because apple uses a clang extension to C, with no equivalent in gcc, in OS X's libc and headers. C++ should be safe.



---

archive/issue_comments_346712.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nI originally tried with just `CC=clang` but the build failed. It succeeded when I added `CXX=clang++`. But I may have made mistakes, so please try it both ways.",
    "created_at": "2017-05-24T22:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346712",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:68" align="right">Comment 68</div>

I originally tried with just `CC=clang` but the build failed. It succeeded when I added `CXX=clang++`. But I may have made mistakes, so please try it both ways.



---

archive/issue_comments_346713.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nReplying to [@jhpalmieri](#comment%3A68):\n> I originally tried with just `CC=clang` but the build failed. It succeeded when I added `CXX=clang++`. But I may have made mistakes, so please try it both ways.\n\nYou can get into such problems if at some point the C compiler is used to compile C++ code, which happens more often than it should. I will have a look when I have time, I have to inspect a gf2x patch first (should have done so yesterday). Setting `CXX` is not a big deal if\n* you don't depend on libraries that are compiled with another C++ compiler (current situation)\n* you only produce executable and no libraries to be consumed down the line (current situation with cmake)",
    "created_at": "2017-05-24T22:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346713",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:69" align="right">Comment 69</div>

Replying to [@jhpalmieri](#comment%3A68):
> I originally tried with just `CC=clang` but the build failed. It succeeded when I added `CXX=clang++`. But I may have made mistakes, so please try it both ways.

You can get into such problems if at some point the C compiler is used to compile C++ code, which happens more often than it should. I will have a look when I have time, I have to inspect a gf2x patch first (should have done so yesterday). Setting `CXX` is not a big deal if
* you don't depend on libraries that are compiled with another C++ compiler (current situation)
* you only produce executable and no libraries to be consumed down the line (current situation with cmake)



---

archive/issue_comments_346714.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nI forgot! I don't have gcc build of sage on my little laptop anymore. Much too stressing compared to the result of my work with clang at #12426.",
    "created_at": "2017-05-24T22:46:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346714",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:70" align="right">Comment 70</div>

I forgot! I don't have gcc build of sage on my little laptop anymore. Much too stressing compared to the result of my work with clang at #12426.



---

archive/issue_comments_346715.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nI think we should go with clang on OSX, full stop.\nWhat else is holding up this?",
    "created_at": "2017-05-25T09:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346715",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:71" align="right">Comment 71</div>

I think we should go with clang on OSX, full stop.
What else is holding up this?



---

archive/issue_comments_346716.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nI can provide accounts on a 32-bit system (arando buildbot) for anyone who wants to do a 32-bit Linux test.",
    "created_at": "2017-05-25T09:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346716",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">Comment 72</div>

I can provide accounts on a 32-bit system (arando buildbot) for anyone who wants to do a 32-bit Linux test.



---

archive/issue_comments_346717.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nI shall try to compare my an Thierry's branch and put things in the proper order. I don't think I can solve Sebastien's failure with gtk2, but that's an uncommon configuration that will be rare.",
    "created_at": "2017-05-25T09:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346717",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:73" align="right">Comment 73</div>

I shall try to compare my an Thierry's branch and put things in the proper order. I don't think I can solve Sebastien's failure with gtk2, but that's an uncommon configuration that will be rare.



---

archive/issue_comments_346718.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nOn OSX 10.10, deleting file `build/pkgs/cmake/patches/osx10.10.patch` and with this modif on top of the current branch:\n\n```diff\ndiff --git a/build/pkgs/cmake/spkg-install b/build/pkgs/cmake/spkg-install\nindex 413effc..93579b9 100755\n--- a/build/pkgs/cmake/spkg-install\n+++ b/build/pkgs/cmake/spkg-install\n@@ -1,5 +1,10 @@\n #!/usr/bin/env bash\n \n+if [ \"$UNAME\" = Darwin ]; then\n+    CC=clang\n+    #CXX=clang++\n+fi\n+\n cd src\n \n ./bootstrap --prefix=$SAGE_LOCAL \\\n```\nI get a similar error as before without the osx patch:\n\n```\n[cmake-3.8.1] ---------------------------------------------\n[cmake-3.8.1] CMake 3.8.1, Copyright 2000-2017 Kitware, Inc. and Contributors\n[cmake-3.8.1] C compiler on this system is: clang\n[cmake-3.8.1] C++ compiler on this system is: g++\n...\n[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type\n[cmake-3.8.1]  DISPATCH_UNAVAILABLE\n[cmake-3.8.1]  ^\n```\nFull log is at https://pastebin.com/L0CEd4hd\n\nSetting both `CC` and `CXX`,\n\n```diff\ndiff --git a/build/pkgs/cmake/spkg-install b/build/pkgs/cmake/spkg-install\nindex 413effc..d3e5ab9 100755\n--- a/build/pkgs/cmake/spkg-install\n+++ b/build/pkgs/cmake/spkg-install\n@@ -1,5 +1,10 @@\n #!/usr/bin/env bash\n \n+if [ \"$UNAME\" = Darwin ]; then\n+    CC=clang\n+    CXX=clang++\n+fi\n+\n cd src\n \n ./bootstrap --prefix=$SAGE_LOCAL \\\n```\nI get again:\n\n```\n[cmake-3.8.1] ---------------------------------------------\n[cmake-3.8.1] CMake 3.8.1, Copyright 2000-2017 Kitware, Inc. and Contributors\n[cmake-3.8.1] C compiler on this system is: clang\n[cmake-3.8.1] C++ compiler on this system is: clang++\n...\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: unknown type name 'DISPATCH_UNAVAILABLE'\n[cmake-3.8.1] DISPATCH_UNAVAILABLE\n[cmake-3.8.1] ^\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:419:1: error: expected unqualified-id\n[cmake-3.8.1] extern __attribute__((visibility(\"default\"))) __attribute__((__nonnull__)) __attribute__((__warn_unused_result__)) __attribute__((__pure__))\n[cmake-3.8.1] ^\n[cmake-3.8.1] In file included from CPack/OSXScriptLauncher.cxx:11:\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55:\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13:\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15:\n[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:52:\n[cmake-3.8.1] /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/queue.h:111:16: error: typedef redefinition with different types ('void (^)()' vs 'void *')\n[cmake-3.8.1] typedef void (^dispatch_block_t)(void);\n[cmake-3.8.1]                ^\n[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:143:15: note: previous definition is here\n[cmake-3.8.1] typedef void* dispatch_block_t;\n[cmake-3.8.1]               ^\n[cmake-3.8.1] 9 errors generated.\n[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/CPack/OSXScriptLauncher.cxx.o] Error 1\n```\nFull log is at https://pastebin.com/052tS36d\n\nSo unless I did something wrong in the `spkg-install`, the osx patch seems to be needed.",
    "created_at": "2017-05-25T19:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346718",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:74" align="right">Comment 74</div>

On OSX 10.10, deleting file `build/pkgs/cmake/patches/osx10.10.patch` and with this modif on top of the current branch:

```diff
diff --git a/build/pkgs/cmake/spkg-install b/build/pkgs/cmake/spkg-install
index 413effc..93579b9 100755
--- a/build/pkgs/cmake/spkg-install
+++ b/build/pkgs/cmake/spkg-install
@@ -1,5 +1,10 @@
 #!/usr/bin/env bash
 
+if [ "$UNAME" = Darwin ]; then
+    CC=clang
+    #CXX=clang++
+fi
+
 cd src
 
 ./bootstrap --prefix=$SAGE_LOCAL \
```
I get a similar error as before without the osx patch:

```
[cmake-3.8.1] ---------------------------------------------
[cmake-3.8.1] CMake 3.8.1, Copyright 2000-2017 Kitware, Inc. and Contributors
[cmake-3.8.1] C compiler on this system is: clang
[cmake-3.8.1] C++ compiler on this system is: g++
...
[cmake-3.8.1]                  from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:321:1: error: 'DISPATCH_UNAVAILABLE' does not name a type
[cmake-3.8.1]  DISPATCH_UNAVAILABLE
[cmake-3.8.1]  ^
```
Full log is at https://pastebin.com/L0CEd4hd

Setting both `CC` and `CXX`,

```diff
diff --git a/build/pkgs/cmake/spkg-install b/build/pkgs/cmake/spkg-install
index 413effc..d3e5ab9 100755
--- a/build/pkgs/cmake/spkg-install
+++ b/build/pkgs/cmake/spkg-install
@@ -1,5 +1,10 @@
 #!/usr/bin/env bash
 
+if [ "$UNAME" = Darwin ]; then
+    CC=clang
+    CXX=clang++
+fi
+
 cd src
 
 ./bootstrap --prefix=$SAGE_LOCAL \
```
I get again:

```
[cmake-3.8.1] ---------------------------------------------
[cmake-3.8.1] CMake 3.8.1, Copyright 2000-2017 Kitware, Inc. and Contributors
[cmake-3.8.1] C compiler on this system is: clang
[cmake-3.8.1] C++ compiler on this system is: clang++
...
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:418:1: error: unknown type name 'DISPATCH_UNAVAILABLE'
[cmake-3.8.1] DISPATCH_UNAVAILABLE
[cmake-3.8.1] ^
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:419:1: error: expected unqualified-id
[cmake-3.8.1] extern __attribute__((visibility("default"))) __attribute__((__nonnull__)) __attribute__((__warn_unused_result__)) __attribute__((__pure__))
[cmake-3.8.1] ^
[cmake-3.8.1] In file included from CPack/OSXScriptLauncher.cxx:11:
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55:
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13:
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15:
[cmake-3.8.1] In file included from /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/dispatch.h:52:
[cmake-3.8.1] /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/usr/include/dispatch/queue.h:111:16: error: typedef redefinition with different types ('void (^)()' vs 'void *')
[cmake-3.8.1] typedef void (^dispatch_block_t)(void);
[cmake-3.8.1]                ^
[cmake-3.8.1] ../../../../../../../include/dispatch/object.h:143:15: note: previous definition is here
[cmake-3.8.1] typedef void* dispatch_block_t;
[cmake-3.8.1]               ^
[cmake-3.8.1] 9 errors generated.
[cmake-3.8.1] make[4]: *** [Source/CMakeFiles/OSXScriptLauncher.dir/CPack/OSXScriptLauncher.cxx.o] Error 1
```
Full log is at https://pastebin.com/052tS36d

So unless I did something wrong in the `spkg-install`, the osx patch seems to be needed.



---

archive/issue_comments_346719.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nI only have access to OS X 10.12, not 10.10. For me, I just confirmed that only setting `CC=clang` is not good enough: I also need `CXX=clang++`. This is true with or without the patch.",
    "created_at": "2017-05-25T20:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346719",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:75" align="right">Comment 75</div>

I only have access to OS X 10.12, not 10.10. For me, I just confirmed that only setting `CC=clang` is not good enough: I also need `CXX=clang++`. This is true with or without the patch.



---

archive/issue_comments_346720.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nWith `CC=clang` and `CXX=clang++` with the osx patch on OSX 10.10, `sage -f -c cmake` gives:\n\n```\n...\n[cmake-3.8.1] Successfully installed cmake-3.8.1\n[cmake-3.8.1] Running the test suite for cmake-3.8.1...\n...\n[cmake-3.8.1] Total Test time (real) = 3537.39 sec\n[cmake-3.8.1] \n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1] \t167 - XCTest (Failed)\n[cmake-3.8.1] \t176 - ObjC++ (Failed)\n[cmake-3.8.1] \t385 - RunCMake.FindGTK2 (Failed)\n[cmake-3.8.1] \t386 - RunCMake.Framework (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\n\nFailed test log available at https://pastebin.com/wRZMB3v2",
    "created_at": "2017-05-25T21:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346720",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:76" align="right">Comment 76</div>

With `CC=clang` and `CXX=clang++` with the osx patch on OSX 10.10, `sage -f -c cmake` gives:

```
...
[cmake-3.8.1] Successfully installed cmake-3.8.1
[cmake-3.8.1] Running the test suite for cmake-3.8.1...
...
[cmake-3.8.1] Total Test time (real) = 3537.39 sec
[cmake-3.8.1] 
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1] 	167 - XCTest (Failed)
[cmake-3.8.1] 	176 - ObjC++ (Failed)
[cmake-3.8.1] 	385 - RunCMake.FindGTK2 (Failed)
[cmake-3.8.1] 	386 - RunCMake.Framework (Failed)
[cmake-3.8.1] Errors while running CTest
```

Failed test log available at https://pastebin.com/wRZMB3v2



---

archive/issue_comments_346721.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nSharing my `CC=clang` and `CXX=clang++` for Darwin branch.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c4d94e2ad84dc4a579c7ccf741a9d9a42fbb30d\">3c4d94e</a></td><td><code>Merge branch 'u/tmonteil/cmakeupd' of trac.sagemath.org:sage into 8.0.beta7</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444\">0754341</a></td><td><code>22999: Using CC=clang and CXX=clang++ on Darwin</code></td></tr></table>\n",
    "created_at": "2017-05-25T21:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346721",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:77" align="right">Comment 77</div>

Sharing my `CC=clang` and `CXX=clang++` for Darwin branch.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c4d94e2ad84dc4a579c7ccf741a9d9a42fbb30d">3c4d94e</a></td><td><code>Merge branch 'u/tmonteil/cmakeupd' of trac.sagemath.org:sage into 8.0.beta7</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444">0754341</a></td><td><code>22999: Using CC=clang and CXX=clang++ on Darwin</code></td></tr></table>




---

archive/issue_comments_346722.json:
```json
{
    "body": "Changed branch from **[u/tmonteil/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/cmakeupd)** to **[u/slabbe/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/cmakeupd)**",
    "created_at": "2017-05-25T21:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346722",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[u/tmonteil/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/cmakeupd)** to **[u/slabbe/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/cmakeupd)**



---

archive/issue_comments_346723.json:
```json
{
    "body": "Changed commit from **[ef2291b](https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b)** to **[0754341](https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444)**",
    "created_at": "2017-05-25T21:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346723",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[ef2291b](https://github.com/sagemath/sagetrac-mirror/commit/ef2291b63e154205a5f5586fb04b5bef925b5e1b)** to **[0754341](https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444)**



---

archive/issue_comments_346724.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nReplying to [@seblabbe](#comment%3A76):\n> With `CC=clang` and `CXX=clang++` with the osx patch on OSX 10.10, `sage -f -c cmake` gives:\n> \n> ```\n> ...\n> [cmake-3.8.1] Successfully installed cmake-3.8.1\n> [cmake-3.8.1] Running the test suite for cmake-3.8.1...\n> ...\n> [cmake-3.8.1] Total Test time (real) = 3537.39 sec\n> [cmake-3.8.1] \n> [cmake-3.8.1] The following tests FAILED:\n> [cmake-3.8.1] \t167 - XCTest (Failed)\n> [cmake-3.8.1] \t176 - ObjC++ (Failed)\n> [cmake-3.8.1] \t385 - RunCMake.FindGTK2 (Failed)\n> [cmake-3.8.1] \t386 - RunCMake.Framework (Failed)\n> [cmake-3.8.1] Errors while running CTest\n> ```\n> \n> Failed test log available at https://pastebin.com/wRZMB3v2\n\nThe compilers also also need to be set in `spkg-check`. That should take of everything except the gtk2 test which is in its own basket.\n\nIt looks like the patch is needed for older version of OS X. I would have expected upstream cmake to do something about it. May be they abandoned the bug since it is fixed in newer version of OS X.",
    "created_at": "2017-05-25T21:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346724",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:78" align="right">Comment 78</div>

Replying to [@seblabbe](#comment%3A76):
> With `CC=clang` and `CXX=clang++` with the osx patch on OSX 10.10, `sage -f -c cmake` gives:
> 
> ```
> ...
> [cmake-3.8.1] Successfully installed cmake-3.8.1
> [cmake-3.8.1] Running the test suite for cmake-3.8.1...
> ...
> [cmake-3.8.1] Total Test time (real) = 3537.39 sec
> [cmake-3.8.1] 
> [cmake-3.8.1] The following tests FAILED:
> [cmake-3.8.1] 	167 - XCTest (Failed)
> [cmake-3.8.1] 	176 - ObjC++ (Failed)
> [cmake-3.8.1] 	385 - RunCMake.FindGTK2 (Failed)
> [cmake-3.8.1] 	386 - RunCMake.Framework (Failed)
> [cmake-3.8.1] Errors while running CTest
> ```
> 
> Failed test log available at https://pastebin.com/wRZMB3v2

The compilers also also need to be set in `spkg-check`. That should take of everything except the gtk2 test which is in its own basket.

It looks like the patch is needed for older version of OS X. I would have expected upstream cmake to do something about it. May be they abandoned the bug since it is fixed in newer version of OS X.



---

archive/issue_comments_346725.json:
```json
{
    "body": "Changed commit from **[0754341](https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444)** to **[0a16efc](https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a)**",
    "created_at": "2017-05-25T21:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346725",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0754341](https://github.com/sagemath/sagetrac-mirror/commit/07543417c56eccca464077371644ff147f181444)** to **[0a16efc](https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a)**



---

archive/issue_comments_346726.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">Comment 79</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a\">0a16efc</a></td><td><code>22999: Using CC=clang and CXX=clang++ on Darwin for spkg-check too</code></td></tr></table>\n",
    "created_at": "2017-05-25T21:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346726",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79" align="right">Comment 79</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a">0a16efc</a></td><td><code>22999: Using CC=clang and CXX=clang++ on Darwin for spkg-check too</code></td></tr></table>




---

archive/issue_comments_346727.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nWill rerun `sage -f -c cmake` on my osx 10.10 overnight and will report back tomorrow.",
    "created_at": "2017-05-25T21:23:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346727",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:80" align="right">Comment 80</div>

Will rerun `sage -f -c cmake` on my osx 10.10 overnight and will report back tomorrow.



---

archive/issue_comments_346728.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nI think the redefinition failure is due to, https://github.com/sagemath/sage/blob/8.0.beta8/build/pkgs/gcc/spkg-install#L67-L68",
    "created_at": "2017-05-26T03:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346728",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:81" align="right">Comment 81</div>

I think the redefinition failure is due to, https://github.com/sagemath/sage/blob/8.0.beta8/build/pkgs/gcc/spkg-install#L67-L68



---

archive/issue_comments_346729.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\n> The compilers also also need to be set in spkg-check. That should take of everything except the gtk2 test which is in its own basket. \n\nIndeed, with `CC=clang` and `CXX=clang++` inside of `spkg-check` with the osx patch on OSX 10.10, sage -f -c cmake gives:\n\n```\n...\n[cmake-3.8.1] 99% tests passed, 1 tests failed out of 448\n[cmake-3.8.1] \n[cmake-3.8.1] Total Test time (real) = 2768.32 sec\n[cmake-3.8.1] \n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1] \t385 - RunCMake.FindGTK2 (Failed)\n[cmake-3.8.1] Errors while running CTest\n...\n```",
    "created_at": "2017-05-26T06:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346729",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:82" align="right">Comment 82</div>

> The compilers also also need to be set in spkg-check. That should take of everything except the gtk2 test which is in its own basket. 

Indeed, with `CC=clang` and `CXX=clang++` inside of `spkg-check` with the osx patch on OSX 10.10, sage -f -c cmake gives:

```
...
[cmake-3.8.1] 99% tests passed, 1 tests failed out of 448
[cmake-3.8.1] 
[cmake-3.8.1] Total Test time (real) = 2768.32 sec
[cmake-3.8.1] 
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1] 	385 - RunCMake.FindGTK2 (Failed)
[cmake-3.8.1] Errors while running CTest
...
```



---

archive/issue_comments_346730.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nIndeed, this `sed` command is done on my system:\n\n```\n$ diff local/include/dispatch/object.h /usr/include/dispatch/object.h \n143c143\n< typedef void* dispatch_block_t;\n---\n> typedef void (^dispatch_block_t)(void);\n```\n\nThe two commits that introduced this fix in #17169 are:\n\n```\ncommit f62f6c37abbc7dbbfc68a9e8faa7d2e81eb48ca9\nAuthor: Volker Braun\nDate:   Sat Oct 18 20:24:02 2014 +0100\n\n    Evil workaround for broken OSX system header\n\ncommit 71b40c25588244fd022b9cc697fa62626bdab3b2\nAuthor: Volker Braun\nDate:   Wed Oct 29 10:32:28 2014 +0000\n\n    Check if dispatch/object.h is present\n```",
    "created_at": "2017-05-26T06:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346730",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:83" align="right">Comment 83</div>

Indeed, this `sed` command is done on my system:

```
$ diff local/include/dispatch/object.h /usr/include/dispatch/object.h 
143c143
< typedef void* dispatch_block_t;
---
> typedef void (^dispatch_block_t)(void);
```

The two commits that introduced this fix in #17169 are:

```
commit f62f6c37abbc7dbbfc68a9e8faa7d2e81eb48ca9
Author: Volker Braun
Date:   Sat Oct 18 20:24:02 2014 +0100

    Evil workaround for broken OSX system header

commit 71b40c25588244fd022b9cc697fa62626bdab3b2
Author: Volker Braun
Date:   Wed Oct 29 10:32:28 2014 +0000

    Check if dispatch/object.h is present
```



---

archive/issue_comments_346731.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\nWith osx 10.10 + 8.0.beta7 + #22999 + the following changes:\n\n```\n$ mv local/include/dispatch/object.h local/include/dispatch/object.h.no\n$ git rm build/pkgs/cmake/patches/osx10.10.patch \n```\nI get\n\n```\n$ sage -f cmake\n...\n[cmake-3.8.1] Successfully installed cmake-3.8.1\n```\nWhat was the `Evil workaround` for?",
    "created_at": "2017-05-26T07:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346731",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:84" align="right">Comment 84</div>

With osx 10.10 + 8.0.beta7 + #22999 + the following changes:

```
$ mv local/include/dispatch/object.h local/include/dispatch/object.h.no
$ git rm build/pkgs/cmake/patches/osx10.10.patch 
```
I get

```
$ sage -f cmake
...
[cmake-3.8.1] Successfully installed cmake-3.8.1
```
What was the `Evil workaround` for?



---

archive/issue_comments_346732.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nIf memory serves me right, gcc would fail to compile without it. The header probably has some of that enum extension clang uses. Since I don't use gcc anymore on OS X I didn't suffer from that problem.",
    "created_at": "2017-05-26T07:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346732",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:85" align="right">Comment 85</div>

If memory serves me right, gcc would fail to compile without it. The header probably has some of that enum extension clang uses. Since I don't use gcc anymore on OS X I didn't suffer from that problem.



---

archive/issue_comments_346733.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nProblem with that patching with sed was that it only changed `/usr/include/dispatch/object.h`. I think it makes sense to copy the entire contents of `/usr/include/dispatch/*` and patch them. This might make building with gcc also possible without the osx10.10 patch.",
    "created_at": "2017-05-26T07:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346733",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:86" align="right">Comment 86</div>

Problem with that patching with sed was that it only changed `/usr/include/dispatch/object.h`. I think it makes sense to copy the entire contents of `/usr/include/dispatch/*` and patch them. This might make building with gcc also possible without the osx10.10 patch.



---

archive/issue_comments_346734.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2017-05-26T09:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346734",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_346735.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nWhat about\n\n- keeping the sed of the gcc spkg-install patching the local/include/dispatch/object.h\n- keeping the osx 10.10 patch for cmake-3.8.1\n- keeping C=clang and CXX=clang++ for cmake spkg-install and spkg-check \n- (maybe) change type of cmake from experimental to optional?\n- giving this ticket a positive review. \n\nThen, leave sed improvements to spkg-install of gcc to another ticket?",
    "created_at": "2017-05-26T09:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346735",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:87" align="right">Comment 87</div>

What about

- keeping the sed of the gcc spkg-install patching the local/include/dispatch/object.h
- keeping the osx 10.10 patch for cmake-3.8.1
- keeping C=clang and CXX=clang++ for cmake spkg-install and spkg-check 
- (maybe) change type of cmake from experimental to optional?
- giving this ticket a positive review. 

Then, leave sed improvements to spkg-install of gcc to another ticket?



---

archive/issue_comments_346736.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">Comment 88</div>\n\nReplying to [@seblabbe](#comment%3A87):\n> What about \n> - keeping the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`\n> - keeping the osx 10.10 patch for cmake-3.8.1\n> - keeping `C=clang` and `CXX=clang++` for cmake `spkg-install`  and `spkg-check`\n> - (maybe) change type of cmake from experimental to optional?\n> - giving this ticket a positive review.\n> \n> Then, leave sed improvements to `spkg-install` of gcc to another ticket?\n\nI was actually writing something similar. +1 to all the above.",
    "created_at": "2017-05-26T09:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346736",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:88" align="right">Comment 88</div>

Replying to [@seblabbe](#comment%3A87):
> What about 
> - keeping the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`
> - keeping the osx 10.10 patch for cmake-3.8.1
> - keeping `C=clang` and `CXX=clang++` for cmake `spkg-install`  and `spkg-check`
> - (maybe) change type of cmake from experimental to optional?
> - giving this ticket a positive review.
> 
> Then, leave sed improvements to `spkg-install` of gcc to another ticket?

I was actually writing something similar. +1 to all the above.



---

archive/issue_comments_346737.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dima Pasechnik, Fran\u00e7ois Bissey, Thierry Monteil**",
    "created_at": "2017-05-26T09:19:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346737",
    "user": "https://github.com/seblabbe"
}
```

Changed author from **Dima Pasechnik** to **Dima Pasechnik, François Bissey, Thierry Monteil**



---

archive/issue_comments_346738.json:
```json
{
    "body": "Changed commit from **[0a16efc](https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a)** to **[40dc987](https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903)**",
    "created_at": "2017-05-26T09:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346738",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0a16efc](https://github.com/sagemath/sagetrac-mirror/commit/0a16efcb77eeba1977361c6f6c268e7db6edd60a)** to **[40dc987](https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903)**



---

archive/issue_comments_346739.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903\">40dc987</a></td><td><code>22999: cmake pkg type from optional to experimental</code></td></tr></table>\n",
    "created_at": "2017-05-26T09:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346739",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90" align="right">Comment 90</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903">40dc987</a></td><td><code>22999: cmake pkg type from optional to experimental</code></td></tr></table>




---

archive/issue_comments_346740.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">Comment 91</div>\n\nThat commit comment is backwards :)",
    "created_at": "2017-05-26T09:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346740",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:91" align="right">Comment 91</div>

That commit comment is backwards :)



---

archive/issue_comments_346741.json:
```json
{
    "body": "Changed commit from **[40dc987](https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903)** to **[719acc3](https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc)**",
    "created_at": "2017-05-26T09:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346741",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[40dc987](https://github.com/sagemath/sagetrac-mirror/commit/40dc98701432c8bd4e3165fcdf8e77b83becf903)** to **[719acc3](https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc)**



---

archive/issue_comments_346742.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">Comment 92</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc\">719acc3</a></td><td><code>22999: cmake pkg type from optional to experimental</code></td></tr></table>\n",
    "created_at": "2017-05-26T09:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346742",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92" align="right">Comment 92</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc">719acc3</a></td><td><code>22999: cmake pkg type from optional to experimental</code></td></tr></table>




---

archive/issue_comments_346743.json:
```json
{
    "body": "Changed commit from **[719acc3](https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc)** to **[a4ad8d4](https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85)**",
    "created_at": "2017-05-26T09:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346743",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[719acc3](https://github.com/sagemath/sagetrac-mirror/commit/719acc302e533f123bc0d738bc82a0a436da89bc)** to **[a4ad8d4](https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85)**



---

archive/issue_comments_346744.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">Comment 93</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85\">a4ad8d4</a></td><td><code>22999: cmake pkg type from experimental to optional</code></td></tr></table>\n",
    "created_at": "2017-05-26T09:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:93" align="right">Comment 93</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85">a4ad8d4</a></td><td><code>22999: cmake pkg type from experimental to optional</code></td></tr></table>




---

archive/issue_events_302815.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-05-26T09:36:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302815"
}
```



---

archive/issue_events_302816.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-05-26T09:36:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302816"
}
```



---

archive/issue_comments_346745.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">Comment 94</div>\n\n...sorry for the noise\n\nTo me this ticket is positive review. I let somebody else change the status because I did the last commit changing type from *experimental* to *optional*.",
    "created_at": "2017-05-26T09:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346745",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:94" align="right">Comment 94</div>

...sorry for the noise

To me this ticket is positive review. I let somebody else change the status because I did the last commit changing type from *experimental* to *optional*.



---

archive/issue_events_302817.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-05-26T09:52:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302817"
}
```



---

archive/issue_events_302818.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-05-26T09:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302818"
}
```



---

archive/issue_comments_346746.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2017-05-26T09:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346746",
    "user": "https://github.com/kiwifb"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_346747.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">Comment 95</div>\n\nI am happy with the content of the ticket. Positive review.",
    "created_at": "2017-05-26T09:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346747",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:95" align="right">Comment 95</div>

I am happy with the content of the ticket. Positive review.



---

archive/issue_comments_346748.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">Comment 96</div>\n\nOn my 32bit VM, i have 5 failing doctests:\n\n```\nThe following tests FAILED:\n\t 77 - BundleUtilities (Failed)\n\t132 - CPackComponentsDEB-components-source (Failed)\n\t133 - CPackComponentsDEB-components-shlibdeps1 (Failed)\n\t135 - CPackComponentsDEB-components-depend2 (Failed)\n\t401 - RunCMake.CPack_DEB (Failed)\nErrors while running CTest\n```\n\nThe full log is too big to be uploaded, but you can download it at https://sagedebianlive.metelu.net/pastebin/cmake-3.8.1.log\n\nIf you see how to fix this, this would be awesome, otherwise i am fine if the ticket gets merged anyway.",
    "created_at": "2017-05-26T12:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346748",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:96" align="right">Comment 96</div>

On my 32bit VM, i have 5 failing doctests:

```
The following tests FAILED:
	 77 - BundleUtilities (Failed)
	132 - CPackComponentsDEB-components-source (Failed)
	133 - CPackComponentsDEB-components-shlibdeps1 (Failed)
	135 - CPackComponentsDEB-components-depend2 (Failed)
	401 - RunCMake.CPack_DEB (Failed)
Errors while running CTest
```

The full log is too big to be uploaded, but you can download it at https://sagedebianlive.metelu.net/pastebin/cmake-3.8.1.log

If you see how to fix this, this would be awesome, otherwise i am fine if the ticket gets merged anyway.



---

archive/issue_events_302819.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-26T12:41:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302819"
}
```



---

archive/issue_events_302820.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-26T12:41:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302820"
}
```



---

archive/issue_comments_346749.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">Comment 97</div>\n\nNote that i also get those syslogs (from dmesg):\n\n```\n[92750.312181] cmsysTestProces[26596]: segfault at 4 ip 08049a94 sp bfc5b940 error 6 in cmsysTestProcess[8048000+a000]\n[92750.315028] cmsysTestProces[26599]: segfault at 4 ip 08049a94 sp bfeea5b0 error 6 in cmsysTestProcess[8048000+a000]\n[93156.430420] Crash[17110]: segfault at 0 ip 0804861b sp bf9be638 error 6 in Crash[8048000+1000]\n```",
    "created_at": "2017-05-26T15:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346749",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:97" align="right">Comment 97</div>

Note that i also get those syslogs (from dmesg):

```
[92750.312181] cmsysTestProces[26596]: segfault at 4 ip 08049a94 sp bfc5b940 error 6 in cmsysTestProcess[8048000+a000]
[92750.315028] cmsysTestProces[26599]: segfault at 4 ip 08049a94 sp bfeea5b0 error 6 in cmsysTestProcess[8048000+a000]
[93156.430420] Crash[17110]: segfault at 0 ip 0804861b sp bf9be638 error 6 in Crash[8048000+1000]
```



---

archive/issue_comments_346750.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">Comment 98</div>\n\nDependency. According to all the tests output I inspected the program \"file\" is not available and that throw off the tests. Can you check if \"file\" is present on the VM and if not install it and try again?",
    "created_at": "2017-05-26T20:48:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346750",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:98" align="right">Comment 98</div>

Dependency. According to all the tests output I inspected the program "file" is not available and that throw off the tests. Can you check if "file" is present on the VM and if not install it and try again?



---

archive/issue_comments_346751.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">Comment 99</div>\n\nReplying to [@kiwifb](#comment%3A98):\n> Dependency. According to all the tests output I inspected the program \"file\" is not available and that throw off the tests. Can you check if \"file\" is present on the VM and if not install it and try again?\n\nThanks for the hint, this fixed most tests, but the following is still there:\n\n```\n[cmake-3.8.1] The following tests FAILED:\n[cmake-3.8.1]    77 - BundleUtilities (Failed)\n[cmake-3.8.1] Errors while running CTest\n```\n\nThe new log can be found at https://sagedebianlive.metelu.net/pastebin/cmake-3.8.1.log.2",
    "created_at": "2017-05-26T22:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346751",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:99" align="right">Comment 99</div>

Replying to [@kiwifb](#comment%3A98):
> Dependency. According to all the tests output I inspected the program "file" is not available and that throw off the tests. Can you check if "file" is present on the VM and if not install it and try again?

Thanks for the hint, this fixed most tests, but the following is still there:

```
[cmake-3.8.1] The following tests FAILED:
[cmake-3.8.1]    77 - BundleUtilities (Failed)
[cmake-3.8.1] Errors while running CTest
```

The new log can be found at https://sagedebianlive.metelu.net/pastebin/cmake-3.8.1.log.2



---

archive/issue_comments_346752.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nI need a bit more time to dig that one. The log doesn't quite give me enough details on the failure. I suspect something but then I don't know why it happens. I need to inspect the source of the test.",
    "created_at": "2017-05-26T22:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346752",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:0" align="right">Comment 0</div>

I need a bit more time to dig that one. The log doesn't quite give me enough details on the failure. I suspect something but then I don't know why it happens. I need to inspect the source of the test.



---

archive/issue_comments_346753.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAh, not an explanation but I suddenly had the memory that the gentoo ebuild skips that test:\n\n```\n\t# Excluded tests:\n\t#    BootstrapTest: we actualy bootstrap it every time so why test it.\n\t#    BundleUtilities: bundle creation broken\n\t#    CTest.updatecvs: which fails to commit as root\n\t#    Fortran: requires fortran\n\t#    Qt4Deploy, which tries to break sandbox and ignores prefix\n\t#    TestUpload, which requires network access\n\t\"${BUILD_DIR}\"/bin/ctest ${ctestargs} \\\n\t\t-E \"(BootstrapTest|BundleUtilities|CTest.UpdateCVS|Fortran|Qt4Deploy|TestUpload)\" \\\n\t\t|| die \"Tests failed\"\n```\nand that's exactly what I think happened to you, the bundle was broken. It clearly says that it doesn't include the binaries at the beginning, why??? I just wish there was an upstream ticket number attached to this. I will add a line to skip that test when I can.",
    "created_at": "2017-05-26T23:04:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346753",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">Comment 1</div>

Ah, not an explanation but I suddenly had the memory that the gentoo ebuild skips that test:

```
	# Excluded tests:
	#    BootstrapTest: we actualy bootstrap it every time so why test it.
	#    BundleUtilities: bundle creation broken
	#    CTest.updatecvs: which fails to commit as root
	#    Fortran: requires fortran
	#    Qt4Deploy, which tries to break sandbox and ignores prefix
	#    TestUpload, which requires network access
	"${BUILD_DIR}"/bin/ctest ${ctestargs} \
		-E "(BootstrapTest|BundleUtilities|CTest.UpdateCVS|Fortran|Qt4Deploy|TestUpload)" \
		|| die "Tests failed"
```
and that's exactly what I think happened to you, the bundle was broken. It clearly says that it doesn't include the binaries at the beginning, why??? I just wish there was an upstream ticket number attached to this. I will add a line to skip that test when I can.



---

archive/issue_events_302821.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-05-28T22:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302821"
}
```



---

archive/issue_events_302822.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-05-28T22:26:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302822"
}
```



---

archive/issue_comments_346754.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nOK \"fix\" is in.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02\">a307700</a></td><td><code>skip over BundleUtilities test has it is broken on some platforms</code></td></tr></table>\n",
    "created_at": "2017-05-28T22:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346754",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">Comment 2</div>

OK "fix" is in.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02">a307700</a></td><td><code>skip over BundleUtilities test has it is broken on some platforms</code></td></tr></table>




---

archive/issue_comments_346755.json:
```json
{
    "body": "Changed commit from **[a4ad8d4](https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85)** to **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**",
    "created_at": "2017-05-28T22:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346755",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[a4ad8d4](https://github.com/sagemath/sagetrac-mirror/commit/a4ad8d40e86e0d417226d809d1eb5f928be49c85)** to **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**



---

archive/issue_comments_346756.json:
```json
{
    "body": "Changed branch from **[u/slabbe/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/cmakeupd)** to **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)**",
    "created_at": "2017-05-28T22:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346756",
    "user": "https://github.com/kiwifb"
}
```

Changed branch from **[u/slabbe/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/cmakeupd)** to **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)**



---

archive/issue_comments_346757.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nAh, may be the issue https://cmake.org/Bug/view.php?id=13364 , can you tell us a bit more about your 32bit VM Thierry?",
    "created_at": "2017-05-28T23:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346757",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

Ah, may be the issue https://cmake.org/Bug/view.php?id=13364 , can you tell us a bit more about your 32bit VM Thierry?



---

archive/issue_comments_346758.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">Comment 104</div>\n\nReplying to [@kiwifb](#comment%3A103):\n> Ah, may be the issue https://cmake.org/Bug/view.php?id=13364 , can you tell us a bit more about your 32bit VM Thierry?\n\nIt is a minimalist qemu image where i installed (with `debootstrap`) a Debian jessie, i attach the creation script.\n\nIt is run with the command:\n\n`sudo qemu-system-i386 -cpu pentium3 -enable-kvm /tempo/monteil/qemu_images/qemu_debian_jessie_32.qcow2 -m 7G -hdb /tempo/monteil/common_disk -display none -net nic,model=virtio -net user -redir tcp:10022::22`",
    "created_at": "2017-05-29T07:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346758",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:104" align="right">Comment 104</div>

Replying to [@kiwifb](#comment%3A103):
> Ah, may be the issue https://cmake.org/Bug/view.php?id=13364 , can you tell us a bit more about your 32bit VM Thierry?

It is a minimalist qemu image where i installed (with `debootstrap`) a Debian jessie, i attach the creation script.

It is run with the command:

`sudo qemu-system-i386 -cpu pentium3 -enable-kvm /tempo/monteil/qemu_images/qemu_debian_jessie_32.qcow2 -m 7G -hdb /tempo/monteil/common_disk -display none -net nic,model=virtio -net user -redir tcp:10022::22`



---

archive/issue_events_302823.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-29T07:24:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302823"
}
```



---

archive/issue_events_302824.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-29T07:24:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302824"
}
```



---

archive/issue_comments_346759.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nAttachment: **[make_qemu_image.gz](https://github.com/sagemath/sage/files/ticket22999/make_qemu_image.gz)**\n\n\n```\n[cmake-3.8.1] 100% tests passed, 0 tests failed out of 442\n```\n\nThanks !",
    "created_at": "2017-05-29T07:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346759",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:5" align="right">Comment 5</div>

Attachment: **[make_qemu_image.gz](https://github.com/sagemath/sage/files/ticket22999/make_qemu_image.gz)**


```
[cmake-3.8.1] 100% tests passed, 0 tests failed out of 442
```

Thanks !



---

archive/issue_comments_346760.json:
```json
{
    "body": "Changed branch from **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)** to **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**",
    "created_at": "2017-05-31T22:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346760",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/cmakeupd](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/cmakeupd)** to **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)**



---

archive/issue_events_302825.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-31T22:25:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302825"
}
```



---

archive/issue_events_302826.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "75d85ccbfb00673008ed46f1955ad678dcd6af85",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-05-31T22:25:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22999#event-302826"
}
```



---

archive/issue_comments_346761.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n> What about \n> - keeping the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`\n\nOn osx 10.10, with 8.0.beta9, I get problem building python2-2.7.13.p1 with errors in the log related to the fact that I moved `local/include/dispatch/object.h` to `local/include/dispatch/object.h.no`. Therefore, it seems that \"the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`\" is necessary.\n\n```\n[python2-2.7.13.p1] Python build finished, but the necessary bits to build these modules were not found:\n[python2-2.7.13.p1] bsddb185           dl                 gdbm           \n[python2-2.7.13.p1] imageop            linuxaudiodev      ossaudiodev    \n[python2-2.7.13.p1] spwd               sunaudiodev                       \n[python2-2.7.13.p1] To find the necessary bits, look in setup.py in detect_modules() for the module's name.\n[python2-2.7.13.p1]\n[python2-2.7.13.p1]\n[python2-2.7.13.p1] Failed to build these modules:\n[python2-2.7.13.p1] _scproxy                                             \n[python2-2.7.13.p1]\n[python2-2.7.13.p1] running build_scripts\n[python2-2.7.13.p1] creating build/scripts-2.7\n[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/pydoc -> build/scripts-2.7\n[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/idle -> build/scripts-2.7\n[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/2to3 -> build/scripts-2.7\n[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/smtpd.py -> build/scripts-2.7\n[python2-2.7.13.p1] changing mode of build/scripts-2.7/pydoc from 644 to 755\n[python2-2.7.13.p1] changing mode of build/scripts-2.7/idle from 644 to 755\n[python2-2.7.13.p1] changing mode of build/scripts-2.7/2to3 from 644 to 755\n[python2-2.7.13.p1] changing mode of build/scripts-2.7/smtpd.py from 644 to 755\n[python2-2.7.13.p1] /usr/bin/install -c -m 644 ./Tools/gdb/libpython.py python.exe-gdb.py\n[python2-2.7.13.p1] Error: the _scproxy module failed to build.\n[python2-2.7.13.p1]\n[python2-2.7.13.p1] real    1m2.132s\n[python2-2.7.13.p1] user    0m25.040s\n[python2-2.7.13.p1] sys    0m28.191s\n[python2-2.7.13.p1] ************************************************************************\n[python2-2.7.13.p1] Error installing package python2-2.7.13.p1\n[python2-2.7.13.p1] ************************************************************************\n[python2-2.7.13.p1] Please email sage-devel (http://groups.google.com/group/sage-devel)\n```",
    "created_at": "2017-06-02T07:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346761",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:7" align="right">Comment 7</div>

> What about 
> - keeping the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`

On osx 10.10, with 8.0.beta9, I get problem building python2-2.7.13.p1 with errors in the log related to the fact that I moved `local/include/dispatch/object.h` to `local/include/dispatch/object.h.no`. Therefore, it seems that "the sed of the gcc `spkg-install` patching the `local/include/dispatch/object.h`" is necessary.

```
[python2-2.7.13.p1] Python build finished, but the necessary bits to build these modules were not found:
[python2-2.7.13.p1] bsddb185           dl                 gdbm           
[python2-2.7.13.p1] imageop            linuxaudiodev      ossaudiodev    
[python2-2.7.13.p1] spwd               sunaudiodev                       
[python2-2.7.13.p1] To find the necessary bits, look in setup.py in detect_modules() for the module's name.
[python2-2.7.13.p1]
[python2-2.7.13.p1]
[python2-2.7.13.p1] Failed to build these modules:
[python2-2.7.13.p1] _scproxy                                             
[python2-2.7.13.p1]
[python2-2.7.13.p1] running build_scripts
[python2-2.7.13.p1] creating build/scripts-2.7
[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/pydoc -> build/scripts-2.7
[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/idle -> build/scripts-2.7
[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Tools/scripts/2to3 -> build/scripts-2.7
[python2-2.7.13.p1] copying and adjusting /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/smtpd.py -> build/scripts-2.7
[python2-2.7.13.p1] changing mode of build/scripts-2.7/pydoc from 644 to 755
[python2-2.7.13.p1] changing mode of build/scripts-2.7/idle from 644 to 755
[python2-2.7.13.p1] changing mode of build/scripts-2.7/2to3 from 644 to 755
[python2-2.7.13.p1] changing mode of build/scripts-2.7/smtpd.py from 644 to 755
[python2-2.7.13.p1] /usr/bin/install -c -m 644 ./Tools/gdb/libpython.py python.exe-gdb.py
[python2-2.7.13.p1] Error: the _scproxy module failed to build.
[python2-2.7.13.p1]
[python2-2.7.13.p1] real    1m2.132s
[python2-2.7.13.p1] user    0m25.040s
[python2-2.7.13.p1] sys    0m28.191s
[python2-2.7.13.p1] ************************************************************************
[python2-2.7.13.p1] Error installing package python2-2.7.13.p1
[python2-2.7.13.p1] ************************************************************************
[python2-2.7.13.p1] Please email sage-devel (http://groups.google.com/group/sage-devel)
```



---

archive/issue_comments_346762.json:
```json
{
    "body": "Changed commit from **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)** to none",
    "created_at": "2017-06-02T07:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346762",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[a307700](https://github.com/sagemath/sagetrac-mirror/commit/a307700da45d6c8552014e0f4715eeecaa3b3c02)** to none



---

archive/issue_comments_346763.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nAren't you building `python` with `clang`?",
    "created_at": "2017-06-02T07:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346763",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">Comment 8</div>

Aren't you building `python` with `clang`?



---

archive/issue_comments_346764.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">Comment 109</div>\n\nReplying to [@kiwifb](#comment%3A108):\n> Aren't you building `python` with `clang`?\n\nI think no.\n\nIf I do `sage -f python2`, I get:\n\n```\n...\n[python2-2.7.13.p1] ****************************************************\n[python2-2.7.13.p1] C compiler: gcc\n[python2-2.7.13.p1] C compiler version:\n[python2-2.7.13.p1] Using built-in specs.\n[python2-2.7.13.p1] COLLECT_GCC=/Users/slabbe/Applications/sage-git/local/bin/gcc\n[python2-2.7.13.p1] COLLECT_LTO_WRAPPER=/Users/slabbe/Applications/sage-git/local/libexec/gcc/x86_64-apple-darwin14.1.0/4.9.3/lto-wrapper\n[python2-2.7.13.p1] Target: x86_64-apple-darwin14.1.0\n[python2-2.7.13.p1] Configured with: ../src/configure --prefix=/Users/slabbe/Applications/sage-git/local --with-local-prefix=/Users/slabbe/Applications/sage-git/local --with-gmp=/Users/slabbe/Applications/sage-git/local --with-mpfr=/Users/slabbe/Applications/sage-git/local --with-mpc=/Users/slabbe/Applications/sage-git/local --with-system-zlib --disable-multilib --disable-nls --enable-languages=c,c++,fortran --disable-libitm --with-build-config=bootstrap-debug --without-isl --without-cloog  \n[python2-2.7.13.p1] Thread model: posix\n[python2-2.7.13.p1] gcc version 4.9.3 (GCC) \n[python2-2.7.13.p1] ****************************************************\n...\n```",
    "created_at": "2017-06-02T19:30:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346764",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:109" align="right">Comment 109</div>

Replying to [@kiwifb](#comment%3A108):
> Aren't you building `python` with `clang`?

I think no.

If I do `sage -f python2`, I get:

```
...
[python2-2.7.13.p1] ****************************************************
[python2-2.7.13.p1] C compiler: gcc
[python2-2.7.13.p1] C compiler version:
[python2-2.7.13.p1] Using built-in specs.
[python2-2.7.13.p1] COLLECT_GCC=/Users/slabbe/Applications/sage-git/local/bin/gcc
[python2-2.7.13.p1] COLLECT_LTO_WRAPPER=/Users/slabbe/Applications/sage-git/local/libexec/gcc/x86_64-apple-darwin14.1.0/4.9.3/lto-wrapper
[python2-2.7.13.p1] Target: x86_64-apple-darwin14.1.0
[python2-2.7.13.p1] Configured with: ../src/configure --prefix=/Users/slabbe/Applications/sage-git/local --with-local-prefix=/Users/slabbe/Applications/sage-git/local --with-gmp=/Users/slabbe/Applications/sage-git/local --with-mpfr=/Users/slabbe/Applications/sage-git/local --with-mpc=/Users/slabbe/Applications/sage-git/local --with-system-zlib --disable-multilib --disable-nls --enable-languages=c,c++,fortran --disable-libitm --with-build-config=bootstrap-debug --without-isl --without-cloog  
[python2-2.7.13.p1] Thread model: posix
[python2-2.7.13.p1] gcc version 4.9.3 (GCC) 
[python2-2.7.13.p1] ****************************************************
...
```



---

archive/issue_comments_346765.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nYou would have to look later in the log for building python. This is a standard header spouted by sage-skpg and it only tells you the compiler that sage has been configured to use. If you change CC in spkg-install this is done after that banner is printed.",
    "created_at": "2017-06-02T20:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346765",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:0" align="right">Comment 0</div>

You would have to look later in the log for building python. This is a standard header spouted by sage-skpg and it only tells you the compiler that sage has been configured to use. If you change CC in spkg-install this is done after that banner is printed.



---

archive/issue_comments_346766.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nMy `python2-2.7.13.p1.log` file as more than 30000 lines for the last call to `sage -f python2` which was succesfull with\n\n```\n$ ls local/include/dispatch/\nobject.h\n```\n\nand\n\n```\n$ grep gcc logs/pkgs/python2-2.7.13.p1.log | wc\n     324    6389  173447\n$ grep clang logs/pkgs/python2-2.7.13.p1.log | wc\n       6      34     457\n```\n\nwith the 6 occurences of clang being in between to call to gcc:\n\n```\n...\ngcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I_ctypes/darwin -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/x86/x86-ffi64.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/x86/x86-ffi64.o -DMACOSX\nModules/_ctypes/libffi_osx/x86/x86-ffi64.c:615:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]\n #pragma clang diagnostic push\n ^\nModules/_ctypes/libffi_osx/x86/x86-ffi64.c:616:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]\n #pragma clang diagnostic ignored \"-Wmissing-prototypes\"\n ^\nModules/_ctypes/libffi_osx/x86/x86-ffi64.c:623:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]\n #pragma clang diagnostic pop\n ^\ngcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I_ctypes/darwin -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.S -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.o -DMACOSX\n...\nSuccessfully installed python2-2.7.13.p1\n...\n```",
    "created_at": "2017-06-03T10:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346766",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1" align="right">Comment 1</div>

My `python2-2.7.13.p1.log` file as more than 30000 lines for the last call to `sage -f python2` which was succesfull with

```
$ ls local/include/dispatch/
object.h
```

and

```
$ grep gcc logs/pkgs/python2-2.7.13.p1.log | wc
     324    6389  173447
$ grep clang logs/pkgs/python2-2.7.13.p1.log | wc
       6      34     457
```

with the 6 occurences of clang being in between to call to gcc:

```
...
gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I_ctypes/darwin -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/x86/x86-ffi64.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/x86/x86-ffi64.o -DMACOSX
Modules/_ctypes/libffi_osx/x86/x86-ffi64.c:615:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]
 #pragma clang diagnostic push
 ^
Modules/_ctypes/libffi_osx/x86/x86-ffi64.c:616:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]
 #pragma clang diagnostic ignored "-Wmissing-prototypes"
 ^
Modules/_ctypes/libffi_osx/x86/x86-ffi64.c:623:0: warning: ignoring #pragma clang diagnostic [-Wunknown-pragmas]
 #pragma clang diagnostic pop
 ^
gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I_ctypes/darwin -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.S -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.o -DMACOSX
...
Successfully installed python2-2.7.13.p1
...
```



---

archive/issue_comments_346767.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nBut if I redo:\n\n```\n$ mv local/include/dispatch/object.h local/include/dispatch/object.h.no\n```\nthen `sage -f python2` gives (and we see that gcc is involved here, not clang):\n\n```\n...\nbuilding '_scproxy' extension\ncreating build/temp.macosx-10.9-x86_64-2.7/Mac\ncreating build/temp.macosx-10.9-x86_64-2.7/Mac/Modules\ngcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c ./Mac/Modules/_scproxy.c -o build/temp.macosx-10.9-x86_64-2.7/./Mac/Modules/_scproxy.o\nIn file included from /usr/include/dispatch/dispatch.h:51:0,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n                 from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:29,\n                 from ./Mac/Modules/_scproxy.c:6:\n/usr/include/dispatch/object.h:143:15: error: expected identifier or '(' before '^' token\n typedef void (^dispatch_block_t)(void);\n               ^\nIn file included from /usr/include/dispatch/dispatch.h:51:0,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,\n                 from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:29,\n                 from ./Mac/Modules/_scproxy.c:6:\n/usr/include/dispatch/object.h:362:3: error: unknown type name 'dispatch_block_t'\n   dispatch_block_t notification_block);\n   ^\n./Mac/Modules/_scproxy.c: In function 'get_proxy_settings':\n./Mac/Modules/_scproxy.c:67:50: warning: the comparison will always evaluate as 'true' for the address of 'kSCPropNetProxiesExcludeSimpleHostnames' will never be NULL [-Waddress]\n     if (&kSCPropNetProxiesExcludeSimpleHostnames != NULL) {\n                                                  ^\nbuilding '_tkinter' extension\ngcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DWITH_APPINIT=1 -I/System/Library/Frameworks/Tcl.framework/Headers -I/System/Library/Frameworks/Tcl.framework/Versions/Current/PrivateHeaders -I/System/Library/Frameworks/Tk.framework/Headers -I/System/Library/Frameworks/Tk.framework/Versions/Current/PrivateHeaders -I/usr/X11R6/include -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.o -framework Tk\nModules/_tkinter.c: In function 'AsObj':\nModules/_tkinter.c:1178:38: warning: passing argument 1 of 'Tcl_NewUnicodeObj' from incompatible pointer type\n             return Tcl_NewUnicodeObj(inbuf, size);\n                                      ^\nIn file included from /System/Library/Frameworks/Tcl.framework/Headers/tcl.h:2246:0,\n                 from Modules/_tkinter.c:70:/System/Library/Frameworks/Tcl.framework/Headers/tclDecls.h:2238:18: note: expected 'const Tcl_UniChar *' but argument is of type 'Py_UNICODE *' EXTERN Tcl_Obj * Tcl_NewUnicodeObj(CONST Tcl_UniChar *unicode,                  ^gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DWITH_APPINIT=1 -I/System/Library/Frameworks/Tcl.framework/Headers -I/System/Library/Frameworks/Tcl.framework/Versions/Current/PrivateHeaders -I/System/Library/Frameworks/Tk.framework/Headers -I/System/Library/Frameworks/Tk.framework/Versions/Current/PrivateHeaders -I/usr/X11R6/include -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.o -framework Tk\ngcc -bundle -undefined dynamic_lookup -L/Users/slabbe/Applications/sage-git/local/lib -Wl,-rpath,/Users/slabbe/Applications/sage-git/local/lib -L/Users/slabbe/Applications/sage-git/local/lib -Wl,-rpath,/Users/slabbe/Applications/sage-git/local/lib -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.o -L/Users/slabbe/Applications/sage-git/local/lib -L/usr/local/lib -L. -o build/lib.macosx-10.9-x86_64-2.7/_tkinter.so -framework Tcl -framework Tk\nbuilding '_ctypes' extension\n...\n************************************************************************\nError installing package python2-2.7.13.p1\n************************************************************************\n...\n```",
    "created_at": "2017-06-03T10:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346767",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:2" align="right">Comment 2</div>

But if I redo:

```
$ mv local/include/dispatch/object.h local/include/dispatch/object.h.no
```
then `sage -f python2` gives (and we see that gcc is involved here, not clang):

```
...
building '_scproxy' extension
creating build/temp.macosx-10.9-x86_64-2.7/Mac
creating build/temp.macosx-10.9-x86_64-2.7/Mac/Modules
gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c ./Mac/Modules/_scproxy.c -o build/temp.macosx-10.9-x86_64-2.7/./Mac/Modules/_scproxy.o
In file included from /usr/include/dispatch/dispatch.h:51:0,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
                 from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:29,
                 from ./Mac/Modules/_scproxy.c:6:
/usr/include/dispatch/object.h:143:15: error: expected identifier or '(' before '^' token
 typedef void (^dispatch_block_t)(void);
               ^
In file included from /usr/include/dispatch/dispatch.h:51:0,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:15,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:55,
                 from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:29,
                 from ./Mac/Modules/_scproxy.c:6:
/usr/include/dispatch/object.h:362:3: error: unknown type name 'dispatch_block_t'
   dispatch_block_t notification_block);
   ^
./Mac/Modules/_scproxy.c: In function 'get_proxy_settings':
./Mac/Modules/_scproxy.c:67:50: warning: the comparison will always evaluate as 'true' for the address of 'kSCPropNetProxiesExcludeSimpleHostnames' will never be NULL [-Waddress]
     if (&kSCPropNetProxiesExcludeSimpleHostnames != NULL) {
                                                  ^
building '_tkinter' extension
gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DWITH_APPINIT=1 -I/System/Library/Frameworks/Tcl.framework/Headers -I/System/Library/Frameworks/Tcl.framework/Versions/Current/PrivateHeaders -I/System/Library/Frameworks/Tk.framework/Headers -I/System/Library/Frameworks/Tk.framework/Versions/Current/PrivateHeaders -I/usr/X11R6/include -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.o -framework Tk
Modules/_tkinter.c: In function 'AsObj':
Modules/_tkinter.c:1178:38: warning: passing argument 1 of 'Tcl_NewUnicodeObj' from incompatible pointer type
             return Tcl_NewUnicodeObj(inbuf, size);
                                      ^
In file included from /System/Library/Frameworks/Tcl.framework/Headers/tcl.h:2246:0,
                 from Modules/_tkinter.c:70:/System/Library/Frameworks/Tcl.framework/Headers/tclDecls.h:2238:18: note: expected 'const Tcl_UniChar *' but argument is of type 'Py_UNICODE *' EXTERN Tcl_Obj * Tcl_NewUnicodeObj(CONST Tcl_UniChar *unicode,                  ^gcc -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DWITH_APPINIT=1 -I/System/Library/Frameworks/Tcl.framework/Headers -I/System/Library/Frameworks/Tcl.framework/Versions/Current/PrivateHeaders -I/System/Library/Frameworks/Tk.framework/Headers -I/System/Library/Frameworks/Tk.framework/Versions/Current/PrivateHeaders -I/usr/X11R6/include -I/Users/slabbe/Applications/sage-git/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Include -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src -c /Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.c -o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.o -framework Tk
gcc -bundle -undefined dynamic_lookup -L/Users/slabbe/Applications/sage-git/local/lib -Wl,-rpath,/Users/slabbe/Applications/sage-git/local/lib -L/Users/slabbe/Applications/sage-git/local/lib -Wl,-rpath,/Users/slabbe/Applications/sage-git/local/lib -fno-strict-aliasing -I/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/_tkinter.o build/temp.macosx-10.9-x86_64-2.7/Users/slabbe/Applications/sage-git/local/var/tmp/sage/build/python2-2.7.13.p1/src/Modules/tkappinit.o -L/Users/slabbe/Applications/sage-git/local/lib -L/usr/local/lib -L. -o build/lib.macosx-10.9-x86_64-2.7/_tkinter.so -framework Tcl -framework Tk
building '_ctypes' extension
...
************************************************************************
Error installing package python2-2.7.13.p1
************************************************************************
...
```



---

archive/issue_comments_346768.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHum, from spkg-install for python2\n\n```\n    if [ $MACOSX_VERSION -ge 16 ]; then\n        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n        CC=clang\n```\nso it is only built with clang on OS X 10.12 and over. Probably should be extended but it is a separate issue. The calls to clang in your build is when python2 needs an objective C compiler. This is set to clang in sage-env.",
    "created_at": "2017-06-03T10:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22999#issuecomment-346768",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

Hum, from spkg-install for python2

```
    if [ $MACOSX_VERSION -ge 16 ]; then
        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
        CC=clang
```
so it is only built with clang on OS X 10.12 and over. Probably should be extended but it is a separate issue. The calls to clang in your build is when python2 needs an objective C compiler. This is set to clang in sage-env.
