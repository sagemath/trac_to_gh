# Issue 22617: Make the cython example using singular works in distros too

archive/issues_022380.json:
```json
{
    "body": "There is currently an old cython example in `cython.py` that relies on the location of the header has installed in sage (which is different from upstream - at least in singular-4.1.0.p1). Gentoo and probably other distro respect upstream layout which causes doctest to fail.\n\n```\n        sage: code = [\n        ....: \"#clang C++\",\n        ....: \"#clib m readline Singular givaro ntl gmpxx gmp\",\n        ....: \"from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsingular\",\n        ....: \"from sage.libs.singular.polynomial cimport singular_polynomial_pow\",\n        ....: \"def test(MPolynomial_libsingular p):\",\n        ....: \"    singular_polynomial_pow(&p._poly, p._poly, 2, p._parent_ring)\"]\n        sage: cython(os.linesep.join(code))\n```\n\nSince singular provides a .pc file it can be made irrelevant by calling pkgconfig. We can also use the opportunity to clean the libraries used, some of which are not relevant anymore.\n\nCC:  @jdemeyer\n\nBranch/Commit: 3017fa97330850d81b666d9d312d68590894fc7a\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22617\n\n",
    "closed_at": "2017-03-30T22:34:41Z",
    "created_at": "2017-03-16T08:52:01Z",
    "labels": [
        "component: cython"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Make the cython example using singular works in distros too",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22617",
    "user": "https://github.com/kiwifb"
}
```
There is currently an old cython example in `cython.py` that relies on the location of the header has installed in sage (which is different from upstream - at least in singular-4.1.0.p1). Gentoo and probably other distro respect upstream layout which causes doctest to fail.

```
        sage: code = [
        ....: "#clang C++",
        ....: "#clib m readline Singular givaro ntl gmpxx gmp",
        ....: "from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsingular",
        ....: "from sage.libs.singular.polynomial cimport singular_polynomial_pow",
        ....: "def test(MPolynomial_libsingular p):",
        ....: "    singular_polynomial_pow(&p._poly, p._poly, 2, p._parent_ring)"]
        sage: cython(os.linesep.join(code))
```

Since singular provides a .pc file it can be made irrelevant by calling pkgconfig. We can also use the opportunity to clean the libraries used, some of which are not relevant anymore.

CC:  @jdemeyer

Branch/Commit: 3017fa97330850d81b666d9d312d68590894fc7a

Reviewer: Jeroen Demeyer

Author: Fran√ßois Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22617





---

archive/issue_comments_331232.json:
```json
{
    "body": "<a id='comment:1'></a>`@` Jeroen I had a moment of uncertainty when reviewing the upgrade to singular 4.1.0.p1 because of the location of the headers if you remember. This makes it all irrelevant and I believe introduce better practice if you link to something that provides a .pc file.\n\n---\nNew commits:",
    "created_at": "2017-03-16T08:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331232",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>`@` Jeroen I had a moment of uncertainty when reviewing the upgrade to singular 4.1.0.p1 because of the location of the headers if you remember. This makes it all irrelevant and I believe introduce better practice if you link to something that provides a .pc file.

---
New commits:



---

archive/issue_comments_331233.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-16T08:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331233",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331234.json:
```json
{
    "body": "<a id='comment:2'></a>Please add a comment in the code that this is just a temporary hack and that #22461 should fix a lot of issues like this one with `cython()`.",
    "created_at": "2017-03-16T09:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331234",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Please add a comment in the code that this is just a temporary hack and that #22461 should fix a lot of issues like this one with `cython()`.



---

archive/issue_comments_331235.json:
```json
{
    "body": "<a id='comment:3'></a>Didn't know about #22461. Will update ASAP.",
    "created_at": "2017-03-16T09:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331235",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>Didn't know about #22461. Will update ASAP.



---

archive/issue_comments_331236.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:1 fbissey]:\n> I believe introduce better practice if you link to something that provides a .pc file.\n\n\nI totally *disagree* that using Sage-specific things like `#cargs` is a better practice, but I can live with it as temporary work-around.",
    "created_at": "2017-03-16T09:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331236",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Replying to [comment:1 fbissey]:
> I believe introduce better practice if you link to something that provides a .pc file.


I totally *disagree* that using Sage-specific things like `#cargs` is a better practice, but I can live with it as temporary work-around.



---

archive/issue_comments_331237.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:\n> Replying to [comment:1 fbissey]:\n> > I believe introduce better practice if you link to something that provides a .pc file.\n\n> \n> I totally *disagree* that using Sage-specific things like `#cargs` is a better practice, but I can live with it as temporary work-around.\n\n\nIt may be a bit hacky but it is the better option. Passing the macros is a pita and `pkgconfig.cflags` give them in the right format. I could isolate the macros from the include one way or another. But ultimately `cinclude` will feed into distutils `include_dirs` which in my opinion has a defect that make it unsuitable for \"programatic use\". If you give `include_dirs` and it's value is empty the generated compile line will include a naked \"-I \" which will usually break compilation. You don't have those problems using `cargs`.\n\nI'll grant you that's a hack , but it is still better practice to use the .pc file when it is available rather than sprinkling random libraries and include dir. That's the \"better practice\" I am talking about :)",
    "created_at": "2017-03-16T10:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331237",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:
> Replying to [comment:1 fbissey]:
> > I believe introduce better practice if you link to something that provides a .pc file.

> 
> I totally *disagree* that using Sage-specific things like `#cargs` is a better practice, but I can live with it as temporary work-around.


It may be a bit hacky but it is the better option. Passing the macros is a pita and `pkgconfig.cflags` give them in the right format. I could isolate the macros from the include one way or another. But ultimately `cinclude` will feed into distutils `include_dirs` which in my opinion has a defect that make it unsuitable for "programatic use". If you give `include_dirs` and it's value is empty the generated compile line will include a naked "-I " which will usually break compilation. You don't have those problems using `cargs`.

I'll grant you that's a hack , but it is still better practice to use the .pc file when it is available rather than sprinkling random libraries and include dir. That's the "better practice" I am talking about :)



---

archive/issue_comments_331238.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-16T10:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331239.json:
```json
{
    "body": "<a id='comment:7'></a>Comment added.",
    "created_at": "2017-03-16T10:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331239",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>Comment added.



---

archive/issue_comments_331240.json:
```json
{
    "body": "<a id='comment:8'></a>If the patchbot tests pass, this is good for me.",
    "created_at": "2017-03-16T14:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331240",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>If the patchbot tests pass, this is good for me.



---

archive/issue_comments_331241.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-21T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331241",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331242.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-30T22:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22617#issuecomment-331242",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058995.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-30T22:34:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22617",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22617#event-58995"
}
```
