# Issue 22488: Make Three.js work offline in Jupyter notebooks

archive/issues_022251.json:
```json
{
    "assignees": [],
    "body": "Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.\n\nThis ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.\n\nFor Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.\n\nCC:  @novoselt @egourgoulhon @kcrisman tmonteil\n\nBranch: **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**\n\nReviewer: **Eric Gourgoulhon**\n\nAuthor: **Paul Masson**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22488_\n\n",
    "closed_at": "2017-03-08T18:46:01Z",
    "created_at": "2017-03-02T01:38:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make Three.js work offline in Jupyter notebooks",
    "type": "issue",
    "updated_at": "2017-09-26T07:25:32Z",
    "url": "https://github.com/sagemath/sage/issues/22488",
    "user": "https://github.com/paulmasson"
}
```
Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.

This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.

For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.

CC:  @novoselt @egourgoulhon @kcrisman tmonteil

Branch: **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**

Reviewer: **Eric Gourgoulhon**

Author: **Paul Masson**

_Issue created by migration from https://trac.sagemath.org/ticket/22488_





---

archive/issue_events_285712.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-02T01:38:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285712"
}
```



---

archive/issue_events_285713.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-02T01:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285713"
}
```



---

archive/issue_events_285714.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-02T01:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285714"
}
```



---

archive/issue_events_285715.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-02T01:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285715"
}
```



---

archive/issue_comments_335556.json:
```json
{
    "body": "Branch: **[u/paulmasson/22488](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22488)**",
    "created_at": "2017-03-02T23:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335556",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/22488](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22488)**



---

archive/issue_events_285716.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-02T23:27:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285716"
}
```



---

archive/issue_comments_335557.json:
```json
{
    "body": "Commit: **[7c0c9cf](https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780)**",
    "created_at": "2017-03-02T23:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335557",
    "user": "https://github.com/paulmasson"
}
```

Commit: **[7c0c9cf](https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780)**



---

archive/issue_comments_335558.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.\n \n+This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.\n+\n+For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.\n``````\n",
    "created_at": "2017-03-02T23:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335558",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.
 
+This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.
+
+For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.
``````




---

archive/issue_comments_335559.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efbd87751b8fd5b384c563026e3470bdb42429c2\">efbd877</a></td><td><code>Add symlink to threejs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780\">7c0c9cf</a></td><td><code>Add local Jupyter path</code></td></tr></table>\n",
    "created_at": "2017-03-02T23:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335559",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efbd87751b8fd5b384c563026e3470bdb42429c2">efbd877</a></td><td><code>Add symlink to threejs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780">7c0c9cf</a></td><td><code>Add local Jupyter path</code></td></tr></table>




---

archive/issue_comments_335560.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nSince I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.",
    "created_at": "2017-03-02T23:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335560",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:3'>Comment 3:</a>
Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.



---

archive/issue_events_285717.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T07:02:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285717"
}
```



---

archive/issue_events_285718.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T07:02:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285718"
}
```



---

archive/issue_events_285719.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T12:47:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285719"
}
```



---

archive/issue_events_285720.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T12:47:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285720"
}
```



---

archive/issue_comments_335561.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@paulmasson](#comment%3A3):\n> Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.\n\nI agree.\n\nThanks for this ticket; I've tested it in console mode and in Jupyter notebooks, both with and without internet connection. Everything seems OK.",
    "created_at": "2017-03-03T12:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335561",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@paulmasson](#comment%3A3):
> Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.

I agree.

Thanks for this ticket; I've tested it in console mode and in Jupyter notebooks, both with and without internet connection. Everything seems OK.



---

archive/issue_comments_335562.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon**",
    "created_at": "2017-03-03T12:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335562",
    "user": "https://github.com/egourgoulhon"
}
```

Reviewer: **Eric Gourgoulhon**



---

archive/issue_events_285721.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T17:05:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285721"
}
```



---

archive/issue_events_285722.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-03T17:05:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285722"
}
```



---

archive/issue_comments_335563.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI've just noticed some regression with respect to Sage 7.5.1: with the latter, the three.js output could be rendered by http://nbviewer.jupyter.org from a notebook publicly available (for instance stored on GitHub), which is pretty cool! Here is [an example](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.5.1.ipynb). This does no longer work for a notebook produced with the current branch: see the same sphere example [here](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488.ipynb). Can this be corrected in the current ticket?",
    "created_at": "2017-03-03T17:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335563",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'>Comment 6:</a>
I've just noticed some regression with respect to Sage 7.5.1: with the latter, the three.js output could be rendered by http://nbviewer.jupyter.org from a notebook publicly available (for instance stored on GitHub), which is pretty cool! Here is [an example](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.5.1.ipynb). This does no longer work for a notebook produced with the current branch: see the same sphere example [here](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488.ipynb). Can this be corrected in the current ticket?



---

archive/issue_comments_335564.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThe Three.js backend creates a standalone HTML file that requires `<script>` tags linking to the JavaScript files. The changes in #22389 default this to the local standard package, since that was requested by a couple reviewers. The current ticket changes the `<script>` tags to link to the local standard package via Jupyter's `/nbextensions` directory, which you can see by inspecting the generated output in your brower's console.\n\nIf the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.\n\nIf the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.\n\nA third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\nI can go either way on this, and in fact I really prefer just using the CDN all the time. Input from others would be appreciated.",
    "created_at": "2017-03-03T21:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335564",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:7'>Comment 7:</a>
The Three.js backend creates a standalone HTML file that requires `<script>` tags linking to the JavaScript files. The changes in #22389 default this to the local standard package, since that was requested by a couple reviewers. The current ticket changes the `<script>` tags to link to the local standard package via Jupyter's `/nbextensions` directory, which you can see by inspecting the generated output in your brower's console.

If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.

If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.

A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?

I can go either way on this, and in fact I really prefer just using the CDN all the time. Input from others would be appreciated.



---

archive/issue_events_285723.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-03T21:07:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "title_is": "Make Three.js work offline in Jupyter notebooks",
    "title_was": "Make Three.js work offline in notebooks",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285723"
}
```



---

archive/issue_comments_335565.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@paulmasson](#comment%3A7):\n> \n> If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.\n\nI did not realize this, thanks! [It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488-online.ipynb)\n> \n> If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.\n\nIndeed...\n\n> \n> A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\nI would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...\nEven if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection.",
    "created_at": "2017-03-03T21:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335565",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@paulmasson](#comment%3A7):
> 
> If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.

I did not realize this, thanks! [It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488-online.ipynb)
> 
> If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.

Indeed...

> 
> A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?

I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...
Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection.



---

archive/issue_comments_335566.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@egourgoulhon](#comment%3A9):\n> Replying to [@paulmasson](#comment%3A7):\n> > A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\n> \n> I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...\n> Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection. \n\nThen the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:\n\n1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.\n\n2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.\n\nI favor the latter. And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?",
    "created_at": "2017-03-03T22:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335566",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@egourgoulhon](#comment%3A9):
> Replying to [@paulmasson](#comment%3A7):
> > A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?

> 
> I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...
> Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection. 

Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:

1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.

2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.

I favor the latter. And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?



---

archive/issue_comments_335567.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@paulmasson](#comment%3A10):\n> Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:\n> \n> 1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.\n> \n> 2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.\n> \n> I favor the latter.\n\nYes, this seems a good idea.\n\n> And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?\n\nSince Jupyter will be the default notebook soon (Sage 8.0, immediately after Sage 7.6), with a converter from legacy notebooks, I don't see the point in publishing legacy notebooks. But probably, this should be discussed in another ticket.",
    "created_at": "2017-03-04T13:24:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335567",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@paulmasson](#comment%3A10):
> Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:
> 
> 1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.
> 
> 2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.
> 
> I favor the latter.

Yes, this seems a good idea.

> And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?

Since Jupyter will be the default notebook soon (Sage 8.0, immediately after Sage 7.6), with a converter from legacy notebooks, I don't see the point in publishing legacy notebooks. But probably, this should be discussed in another ticket.



---

archive/issue_comments_335568.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff\">63f725d</a></td><td><code>Fallback to CDN when online</code></td></tr></table>\n",
    "created_at": "2017-03-06T22:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335568",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff">63f725d</a></td><td><code>Fallback to CDN when online</code></td></tr></table>




---

archive/issue_comments_335569.json:
```json
{
    "body": "Changed commit from **[7c0c9cf](https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780)** to **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**",
    "created_at": "2017-03-06T22:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335569",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7c0c9cf](https://github.com/sagemath/sagetrac-mirror/commit/7c0c9cf8e7ccb3d9b09020ddf11615fcfac61780)** to **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**



---

archive/issue_comments_335570.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThis should take care of the outstanding issue. Please try publishing a notebook without the `online` keyword.\n\nI've also added a few double quotes, to prevent a possible future error and to make things read consistently.",
    "created_at": "2017-03-06T22:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335570",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:13'>Comment 13:</a>
This should take care of the outstanding issue. Please try publishing a notebook without the `online` keyword.

I've also added a few double quotes, to prevent a possible future error and to make things read consistently.



---

archive/issue_events_285724.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-06T22:25:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285724"
}
```



---

archive/issue_events_285725.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-06T22:25:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285725"
}
```



---

archive/issue_events_285726.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-06T23:16:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285726"
}
```



---

archive/issue_events_285727.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-03-06T23:16:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285727"
}
```



---

archive/issue_comments_335571.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@paulmasson](#comment%3A13):\n> This should take care of the outstanding issue. \n\nThanks!\n>Please try publishing a notebook without the `online` keyword.\n\n[It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta6-22488-2.ipynb)\n\n> I've also added a few double quotes, to prevent a possible future error and to make things read consistently.\n\nVery good.\n\nI've performed a few other checks (online/offline in console/Jupyter notebook); everything seems OK. Thank you!",
    "created_at": "2017-03-06T23:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335571",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@paulmasson](#comment%3A13):
> This should take care of the outstanding issue. 

Thanks!
>Please try publishing a notebook without the `online` keyword.

[It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta6-22488-2.ipynb)

> I've also added a few double quotes, to prevent a possible future error and to make things read consistently.

Very good.

I've performed a few other checks (online/offline in console/Jupyter notebook); everything seems OK. Thank you!



---

archive/issue_comments_335572.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/22488](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22488)** to **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**",
    "created_at": "2017-03-08T18:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335572",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/22488](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22488)** to **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)**



---

archive/issue_events_285728.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-08T18:46:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285728"
}
```



---

archive/issue_events_285729.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "cc54d99b8210b90c7d5f7a74279255c3ede50648",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-03-08T18:46:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22488#event-285729"
}
```



---

archive/issue_comments_335573.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nSorry for not looking at this closer when it was still for review.\n\nI very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line\n\n```\nbackend = get_display_manager()._backend\n```\ntogether with dependent ones and instead have something like\n\n```\nscripts = get_display_manager().threejs_scripts(options['online'])\n```\nwith default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](../wiki/SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?",
    "created_at": "2017-03-19T17:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335573",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'>Comment 16:</a>
Sorry for not looking at this closer when it was still for review.

I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line

```
backend = get_display_manager()._backend
```
together with dependent ones and instead have something like

```
scripts = get_display_manager().threejs_scripts(options['online'])
```
with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](../wiki/SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?



---

archive/issue_comments_335574.json:
```json
{
    "body": "Changed commit from **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)** to none",
    "created_at": "2017-03-19T17:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335574",
    "user": "https://github.com/novoselt"
}
```

Changed commit from **[63f725d](https://github.com/sagemath/sagetrac-mirror/commit/63f725d65fcd99c3a8669534efdd3114e31bf1ff)** to none



---

archive/issue_comments_335575.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nNo clue why commit got deleted...",
    "created_at": "2017-03-19T17:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335575",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'>Comment 17:</a>
No clue why commit got deleted...



---

archive/issue_comments_335576.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@novoselt](#comment%3A17):\n> No clue why commit got deleted...\n\nI think this is harmless; it seems to occur anytime a comment is added to a closed ticket.",
    "created_at": "2017-03-21T11:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335576",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@novoselt](#comment%3A17):
> No clue why commit got deleted...

I think this is harmless; it seems to occur anytime a comment is added to a closed ticket.



---

archive/issue_comments_335577.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@novoselt](#comment%3A16):\n> Sorry for not looking at this closer when it was still for review.\n> \n> I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line\n> \n> ```\n> backend = get_display_manager()._backend\n> ```\n> together with dependent ones and instead have something like\n> \n> ```\n> scripts = get_display_manager().threejs_scripts(options['online'])\n> ```\n> with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](../wiki/SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?\n\nPoint well taken. Discussion moved to #22670.",
    "created_at": "2017-03-21T23:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335577",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@novoselt](#comment%3A16):
> Sorry for not looking at this closer when it was still for review.
> 
> I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line
> 
> ```
> backend = get_display_manager()._backend
> ```
> together with dependent ones and instead have something like
> 
> ```
> scripts = get_display_manager().threejs_scripts(options['online'])
> ```
> with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](../wiki/SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?

Point well taken. Discussion moved to #22670.



---

archive/issue_comments_335578.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nAfter these changes threejs does not work any more with jupyterhub. I tried some workarounds whitout success. It is probably difficult to have a solution for both offline jupyter notebook and jupyterhub, but a hint would help. Thanks.",
    "created_at": "2017-09-24T19:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335578",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:20'>Comment 20:</a>
After these changes threejs does not work any more with jupyterhub. I tried some workarounds whitout success. It is probably difficult to have a solution for both offline jupyter notebook and jupyterhub, but a hint would help. Thanks.



---

archive/issue_comments_335579.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThe behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.\n\nDoes Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?",
    "created_at": "2017-09-25T20:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335579",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:21'>Comment 21:</a>
The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.

Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?



---

archive/issue_comments_335580.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@paulmasson](#comment%3A21):\n> The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.\n> \n> Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?\n\nNo, Jupyterhub is not blocking internet access (it is done in order to offer internet access to jupyter notebook); the problem is that it looks for the scripts in \"https://ip_address:port/nbextensions/threejs/three.min.js\" and it fails to find them (no problem if jupyter is launched locally). I found a workaround redefining the function threejs_offline_scripts (which appears twice in backend_ipython.py) asking jupyter to look for the scripts in rawgit. Maybe a global solution should not be done here but in jupyterhub.",
    "created_at": "2017-09-26T07:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22488#issuecomment-335580",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@paulmasson](#comment%3A21):
> The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.
> 
> Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?

No, Jupyterhub is not blocking internet access (it is done in order to offer internet access to jupyter notebook); the problem is that it looks for the scripts in "https://ip_address:port/nbextensions/threejs/three.min.js" and it fails to find them (no problem if jupyter is launched locally). I found a workaround redefining the function threejs_offline_scripts (which appears twice in backend_ipython.py) asking jupyter to look for the scripts in rawgit. Maybe a global solution should not be done here but in jupyterhub.
