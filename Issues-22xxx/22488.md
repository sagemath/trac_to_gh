# Issue 22488: Make Three.js work offline in Jupyter notebooks

archive/issues_022251.json:
```json
{
    "body": "Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.\n\nThis ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.\n\nFor Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.\n\nCC:  @novoselt @egourgoulhon @kcrisman tmonteil\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Paul Masson\n\nBranch: 63f725d65fcd99c3a8669534efdd3114e31bf1ff\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22488\n\n",
    "closed_at": "2017-03-08T18:46:01Z",
    "created_at": "2017-03-02T01:38:46Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Make Three.js work offline in Jupyter notebooks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22488",
    "user": "https://github.com/paulmasson"
}
```
Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.

This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.

For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.

CC:  @novoselt @egourgoulhon @kcrisman tmonteil

Reviewer: Eric Gourgoulhon

Author: Paul Masson

Branch: 63f725d65fcd99c3a8669534efdd3114e31bf1ff

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22488





---

archive/issue_comments_329125.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-02T23:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329125",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_329126.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.\n \n+This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.\n+\n+For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.\n \n Author: Paul Masson\n \n```\n",
    "created_at": "2017-03-02T23:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329126",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+Both the Jupyter and legacy Sage notebooks display files from a local web server that does not have access by default to the file system.
 
+This ticket adds a symbolic link to allow Jupyter notebooks access to the Three.js files and updates the links in the generated HTML according to the current Sage backend.
+
+For Sage notebooks a [pull request](https://github.com/sagemath/sagenb/pull/424) has been created to add the server link. In the meantime Sage notebooks default to using the CDN.
 
 Author: Paul Masson
 
```




---

archive/issue_comments_329127.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-03-02T23:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329127",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_329128.json:
```json
{
    "body": "<a id='comment:3'></a>Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.",
    "created_at": "2017-03-02T23:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329128",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:3'></a>Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.



---

archive/issue_comments_329129.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2017-03-03T07:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329129",
    "user": "https://github.com/egourgoulhon"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_329130.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-03T12:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329130",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329131.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 paulmasson]:\n> Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.\n\n\nI agree.\n\nThanks for this ticket; I've tested it in console mode and in Jupyter notebooks, both with and without internet connection. Everything seems OK.",
    "created_at": "2017-03-03T12:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329131",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>Replying to [comment:3 paulmasson]:
> Since I'm unsure as to when a new version of the legacy notebook will be available, the ticket could be restricted to getting the viewer working in Jupyter notebooks.


I agree.

Thanks for this ticket; I've tested it in console mode and in Jupyter notebooks, both with and without internet connection. Everything seems OK.



---

archive/issue_comments_329132.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2017-03-03T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329132",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_329133.json:
```json
{
    "body": "<a id='comment:6'></a>I've just noticed some regression with respect to Sage 7.5.1: with the latter, the three.js output could be rendered by http://nbviewer.jupyter.org from a notebook publicly available (for instance stored on GitHub), which is pretty cool! Here is [an example](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.5.1.ipynb). This does no longer work for a notebook produced with the current branch: see the same sphere example [here](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488.ipynb). Can this be corrected in the current ticket?",
    "created_at": "2017-03-03T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329133",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>I've just noticed some regression with respect to Sage 7.5.1: with the latter, the three.js output could be rendered by http://nbviewer.jupyter.org from a notebook publicly available (for instance stored on GitHub), which is pretty cool! Here is [an example](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.5.1.ipynb). This does no longer work for a notebook produced with the current branch: see the same sphere example [here](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488.ipynb). Can this be corrected in the current ticket?



---

archive/issue_comments_329134.json:
```json
{
    "body": "<a id='comment:7'></a>The Three.js backend creates a standalone HTML file that requires `<script>` tags linking to the JavaScript files. The changes in #22389 default this to the local standard package, since that was requested by a couple reviewers. The current ticket changes the `<script>` tags to link to the local standard package via Jupyter's `/nbextensions` directory, which you can see by inspecting the generated output in your brower's console.\n\nIf the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.\n\nIf the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.\n\nA third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\nI can go either way on this, and in fact I really prefer just using the CDN all the time. Input from others would be appreciated.",
    "created_at": "2017-03-03T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329134",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:7'></a>The Three.js backend creates a standalone HTML file that requires `<script>` tags linking to the JavaScript files. The changes in #22389 default this to the local standard package, since that was requested by a couple reviewers. The current ticket changes the `<script>` tags to link to the local standard package via Jupyter's `/nbextensions` directory, which you can see by inspecting the generated output in your brower's console.

If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.

If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.

A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?

I can go either way on this, and in fact I really prefer just using the CDN all the time. Input from others would be appreciated.



---

archive/issue_comments_329135.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 paulmasson]:\n> \n> If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.\n\n\nI did not realize this, thanks! [It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488-online.ipynb)\n> \n> If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.\n\n\nIndeed...\n\n> \n> A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\n\nI would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...\nEven if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection.",
    "created_at": "2017-03-03T21:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329135",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>Replying to [comment:7 paulmasson]:
> 
> If the user knows ahead of time that the generated HTML will be viewed online, where this is no access to the local standard package, there is now a keyword option `online=true` that alters the `<script>` tags to use a publicly available content delivery network (CDN). If you know you will publish a notebook, you can add that keyword to a dictionary of options for all 3D plots.


I did not realize this, thanks! [It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta5-22488-online.ipynb)
> 
> If the notebook publishing site has an equivalent to `/nbextensions`, then you could alternately copy the two JavaScript files to a directory `/threejs` under it and things would work, but you probably aren't given access like that to their server.


Indeed...

> 
> A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?


I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...
Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection.



---

archive/issue_comments_329136.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 egourgoulhon]:\n> Replying to [comment:7 paulmasson]:\n> > A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible \"leak\" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?\n\n> \n> I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...\n> Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection. \n\nThen the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:\n\n1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.\n\n2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.\n\nI favor the latter. And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?",
    "created_at": "2017-03-03T22:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329136",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:10'></a>Replying to [comment:9 egourgoulhon]:
> Replying to [comment:7 paulmasson]:
> > A third option (but a bit messier) is to add two sets of `<script>` tags to the generated HTML. Then the page would fall back on the CDN when the local standard package is unavailable. That would make your notebook publishing process work transparently, but would quietly add a possible "leak" to the Internet that another reviewer wanted me to avoid. Is it worth doing this rather than use the `online=true` keyword?

> 
> I would vote for this one, since it sounds awkward to create multiple versions of a notebook or to have to know in advance that you will publish it at some point...
> Even if you know that and have added `online=True` everywhere, this becomes very annoying if you work on the notebook and for some reason you don't have any internet connection. 

Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:

1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.

2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.

I favor the latter. And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?



---

archive/issue_comments_329137.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 paulmasson]:\n> Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:\n> \n> 1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.\n> \n> 2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.\n> \n> I favor the latter.\n\n\nYes, this seems a good idea.\n\n> And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?\n\n\nSince Jupyter will be the default notebook soon (Sage 8.0, immediately after Sage 7.6), with a converter from legacy notebooks, I don't see the point in publishing legacy notebooks. But probably, this should be discussed in another ticket.",
    "created_at": "2017-03-04T13:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329137",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>Replying to [comment:10 paulmasson]:
> Then the question arises as to whether to do this in all cases or just for the Jupyter notebooks. That is:
> 
> 1) Remove the `online` keyword and always provide two sets of tags in all generated content. For command-line users this would potentially expose some local file system information without their knowledge, but would make the HTML files immediately portable.
> 
> 2) Keep the `online` keyword to allow command-line users to explicitly generate public online files without any local computer information embedded, but have the two-set fallback for Jupyter notebook users. The `/nbextensions` link is generic and reveals nothing about the local computer.
> 
> I favor the latter.


Yes, this seems a good idea.

> And for future reference, can Sage legacy notebooks be published in the same way or do they always stay on the local server?


Since Jupyter will be the default notebook soon (Sage 8.0, immediately after Sage 7.6), with a converter from legacy notebooks, I don't see the point in publishing legacy notebooks. But probably, this should be discussed in another ticket.



---

archive/issue_comments_329138.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-06T22:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329139.json:
```json
{
    "body": "<a id='comment:13'></a>This should take care of the outstanding issue. Please try publishing a notebook without the `online` keyword.\n\nI've also added a few double quotes, to prevent a possible future error and to make things read consistently.",
    "created_at": "2017-03-06T22:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329139",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:13'></a>This should take care of the outstanding issue. Please try publishing a notebook without the `online` keyword.

I've also added a few double quotes, to prevent a possible future error and to make things read consistently.



---

archive/issue_comments_329140.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-03-06T22:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329140",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_329141.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-06T23:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329141",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329142.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 paulmasson]:\n> This should take care of the outstanding issue. \n\n\nThanks!\n>Please try publishing a notebook without the `online` keyword.\n\n\n[It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta6-22488-2.ipynb)\n\n> I've also added a few double quotes, to prevent a possible future error and to make things read consistently.\n\n\nVery good.\n\nI've performed a few other checks (online/offline in console/Jupyter notebook); everything seems OK. Thank you!",
    "created_at": "2017-03-06T23:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329142",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>Replying to [comment:13 paulmasson]:
> This should take care of the outstanding issue. 


Thanks!
>Please try publishing a notebook without the `online` keyword.


[It works!](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/sphere_threejs_7.6.beta6-22488-2.ipynb)

> I've also added a few double quotes, to prevent a possible future error and to make things read consistently.


Very good.

I've performed a few other checks (online/offline in console/Jupyter notebook); everything seems OK. Thank you!



---

archive/issue_events_058792.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-08T18:46:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22488#event-58792"
}
```



---

archive/issue_comments_329143.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-08T18:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329143",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_329144.json:
```json
{
    "body": "<a id='comment:16'></a>Sorry for not looking at this closer when it was still for review.\n\nI very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line\n\n```\nbackend = get_display_manager()._backend\n```\ntogether with dependent ones and instead have something like\n\n```\nscripts = get_display_manager().threejs_scripts(options['online'])\n```\nwith default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?",
    "created_at": "2017-03-19T17:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329144",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'></a>Sorry for not looking at this closer when it was still for review.

I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line

```
backend = get_display_manager()._backend
```
together with dependent ones and instead have something like

```
scripts = get_display_manager().threejs_scripts(options['online'])
```
with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?



---

archive/issue_comments_329145.json:
```json
{
    "body": "<a id='comment:17'></a>No clue why commit got deleted...",
    "created_at": "2017-03-19T17:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329145",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'></a>No clue why commit got deleted...



---

archive/issue_comments_329146.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 novoselt]:\n> No clue why commit got deleted...\n\nI think this is harmless; it seems to occur anytime a comment is added to a closed ticket.",
    "created_at": "2017-03-21T11:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329146",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>Replying to [comment:17 novoselt]:
> No clue why commit got deleted...

I think this is harmless; it seems to occur anytime a comment is added to a closed ticket.



---

archive/issue_comments_329147.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 novoselt]:\n> Sorry for not looking at this closer when it was still for review.\n> \n> I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line\n> \n> ```\n> backend = get_display_manager()._backend\n> ```\n> together with dependent ones and instead have something like\n> \n> ```\n> scripts = get_display_manager().threejs_scripts(options['online'])\n> ```\n> with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?\n\nPoint well taken. Discussion moved to #22670.",
    "created_at": "2017-03-21T23:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329147",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:19'></a>Replying to [comment:16 novoselt]:
> Sorry for not looking at this closer when it was still for review.
> 
> I very much dislike the logic for generating different files relying on instance check of the backend. These backend-specific things should be written in the backend files and pulled via the same methods here. So I would very much like to get rid of this line
> 
> ```
> backend = get_display_manager()._backend
> ```
> together with dependent ones and instead have something like
> 
> ```
> scripts = get_display_manager().threejs_scripts(options['online'])
> ```
> with default behaviour of serving CDN links for `True` and failing for `False` but letting individual backends override `False` however they wish. In particular it will allow me to has [SageMathCell](SageMathCell) backend do what is needed without making tweaks to Sage itself. Thoughts?

Point well taken. Discussion moved to #22670.



---

archive/issue_comments_329148.json:
```json
{
    "body": "<a id='comment:20'></a>After these changes threejs does not work any more with jupyterhub. I tried some workarounds whitout success. It is probably difficult to have a solution for both offline jupyter notebook and jupyterhub, but a hint would help. Thanks.",
    "created_at": "2017-09-24T19:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329148",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:20'></a>After these changes threejs does not work any more with jupyterhub. I tried some workarounds whitout success. It is probably difficult to have a solution for both offline jupyter notebook and jupyterhub, but a hint would help. Thanks.



---

archive/issue_comments_329149.json:
```json
{
    "body": "<a id='comment:21'></a>The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.\n\nDoes Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?",
    "created_at": "2017-09-25T20:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329149",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:21'></a>The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.

Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?



---

archive/issue_comments_329150.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 paulmasson]:\n> The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.\n> \n> Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?\n\n\nNo, Jupyterhub is not blocking internet access (it is done in order to offer internet access to jupyter notebook); the problem is that it looks for the scripts in \"https://ip_address:port/nbextensions/threejs/three.min.js\" and it fails to find them (no problem if jupyter is launched locally). I found a workaround redefining the function threejs_offline_scripts (which appears twice in backend_ipython.py) asking jupyter to look for the scripts in rawgit. Maybe a global solution should not be done here but in jupyterhub.",
    "created_at": "2017-09-26T07:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22488#issuecomment-329150",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:22'></a>Replying to [comment:21 paulmasson]:
> The behavior for Jupyter notebooks includes a fallback to an online CDN when the offline JavaScript files are unavailable. This was tested in Comment 14 above.
> 
> Does Jupyterhub block access to the Internet? Are you deliberately blocking Internet access?


No, Jupyterhub is not blocking internet access (it is done in order to offer internet access to jupyter notebook); the problem is that it looks for the scripts in "https://ip_address:port/nbextensions/threejs/three.min.js" and it fails to find them (no problem if jupyter is launched locally). I found a workaround redefining the function threejs_offline_scripts (which appears twice in backend_ipython.py) asking jupyter to look for the scripts in rawgit. Maybe a global solution should not be done here but in jupyterhub.
