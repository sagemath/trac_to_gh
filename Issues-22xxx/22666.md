# Issue 22666: Fix python3 build on Cygwin

archive/issues_022429.json:
```json
{
    "body": "Since #22354, Python 3 is now installed unconditionally as a standard package.  That's fine, but the last Python 3 version known to work on Cygwin is Python 3.4 (though I have been working with Python upstream to fix that).\n\nIn the meantime, here is a patch set needed to get the Python 3 currently in Sage (3.5.1) to at least build, and nominally work.\n\nBranch/Commit: 5031e422023459fdbe3a48cb5159abc63ec57cf2\n\nReviewer: Travis Scrimshaw, Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22666\n\n",
    "closed_at": "2017-04-23T12:58:00Z",
    "created_at": "2017-03-21T14:39:15Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Fix python3 build on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22666",
    "user": "https://github.com/embray"
}
```
Since #22354, Python 3 is now installed unconditionally as a standard package.  That's fine, but the last Python 3 version known to work on Cygwin is Python 3.4 (though I have been working with Python upstream to fix that).

In the meantime, here is a patch set needed to get the Python 3 currently in Sage (3.5.1) to at least build, and nominally work.

Branch/Commit: 5031e422023459fdbe3a48cb5159abc63ec57cf2

Reviewer: Travis Scrimshaw, Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22666





---

archive/issue_comments_416693.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-21T14:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416693",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416694.json:
```json
{
    "body": "<a id='comment:2'></a>\nI can confirm that Python 3 builds for me with the patch (and does not without).",
    "created_at": "2017-03-22T21:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416694",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:2'></a>
I can confirm that Python 3 builds for me with the patch (and does not without).



---

archive/issue_comments_416695.json:
```json
{
    "body": "<a id='comment:3'></a>\nThere may still be runtime issues that impact Sage, but I will address those as they come.  This at least addresses building without error.",
    "created_at": "2017-03-23T11:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416695",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
There may still be runtime issues that impact Sage, but I will address those as they come.  This at least addresses building without error.



---

archive/issue_comments_416696.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhat's the upstream status of these patches? I always like when patches have some kind of pointer to an upstream ticket or commit or whatever...\n\nFor this reason, I consider the renaming `ncurses-issue_14438.patch` -> `2.6.5-ncurses-abi6.patch` a regression.",
    "created_at": "2017-03-28T10:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416696",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
What's the upstream status of these patches? I always like when patches have some kind of pointer to an upstream ticket or commit or whatever...

For this reason, I consider the renaming `ncurses-issue_14438.patch` -> `2.6.5-ncurses-abi6.patch` a regression.



---

archive/issue_comments_416697.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt's just for consistency's sake with the rest of my patch set, who cares what the file is called?  I can put in a reference to the issue it addresses.",
    "created_at": "2017-03-28T14:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416697",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
It's just for consistency's sake with the rest of my patch set, who cares what the file is called?  I can put in a reference to the issue it addresses.



---

archive/issue_comments_416698.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [embray](#comment%3A5):\n> I can put in a reference to the issue it addresses.\n\n\nPlease do (to be clear: renaming the file is fine in that case).",
    "created_at": "2017-03-28T15:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416698",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [embray](#comment%3A5):
> I can put in a reference to the issue it addresses.


Please do (to be clear: renaming the file is fine in that case).



---

archive/issue_comments_416699.json:
```json
{
    "body": "<a id='comment:7'></a>\nYeah, no a problem.  I'm pretty sure all of these patches are upstream already, but there might be one or two that aren't for various reasons.  Need to double-check.",
    "created_at": "2017-03-28T15:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416699",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Yeah, no a problem.  I'm pretty sure all of these patches are upstream already, but there might be one or two that aren't for various reasons.  Need to double-check.



---

archive/issue_comments_416700.json:
```json
{
    "body": "<a id='comment:8'></a>\nDid you double-check the patch status Erik? I'm ready to set a positive review unless Jeoren has any other comments (Python3 builds for me with this on Cygwin64).",
    "created_at": "2017-04-19T19:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416700",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Did you double-check the patch status Erik? I'm ready to set a positive review unless Jeoren has any other comments (Python3 builds for me with this on Cygwin64).



---

archive/issue_comments_416701.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-04-19T19:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416701",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_416702.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"None of the above - read trac for reasoning.\"",
    "created_at": "2017-04-19T19:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416702",
    "user": "https://github.com/tscrim"
}
```

Changing upstream from "N/A" to "None of the above - read trac for reasoning."



---

archive/issue_comments_416703.json:
```json
{
    "body": "Changing upstream from \"None of the above - read trac for reasoning.\" to \"N/A\"",
    "created_at": "2017-04-19T19:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416703",
    "user": "https://github.com/tscrim"
}
```

Changing upstream from "None of the above - read trac for reasoning." to "N/A"



---

archive/issue_comments_416704.json:
```json
{
    "body": "<a id='comment:11'></a>\nNo, I'll work on that now...",
    "created_at": "2017-04-20T09:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416704",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
No, I'll work on that now...



---

archive/issue_comments_416705.json:
```json
{
    "body": "Changing commit from \"133ae6a2a5ba29c992d8af14905a7052474ca028\" to \"1618c0f0d26c989df228b28db45c714fbc281178\"",
    "created_at": "2017-04-20T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "133ae6a2a5ba29c992d8af14905a7052474ca028" to "1618c0f0d26c989df228b28db45c714fbc281178"



---

archive/issue_comments_416706.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|\n|[a55e734](https://github.com/sagemath/sagetrac-mirror/commit/a55e73411211516d6ab69cb8ba0edb694c597688)|`This is fixed, for now, in sage by #21399 so we can live without this patch.`|\n|[90e46fd](https://github.com/sagemath/sagetrac-mirror/commit/90e46fd1f8769a256cd122c5972a60dabe7b047c)|`This patch has been part of the Cygwin port of Python since Python 2.6, but it has not been needed in Sage.`|\n|[cd51023](https://github.com/sagemath/sagetrac-mirror/commit/cd51023705656562733d4330264eab6e8d82a9f3)|`This patch seems to have been part of Cygwin's Python for a long time, but I'm not actually sure what case it's for and can't find anything referencing it.`|\n|[eb02004](https://github.com/sagemath/sagetrac-mirror/commit/eb020040775c73abdfd94906a6c63d41c82c9fa7)|`This patch was needed for the tkinter module to build.  But we don't guarantee`|\n|[46df7dc](https://github.com/sagemath/sagetrac-mirror/commit/46df7dca8f45df271960ccb1d9922b9851d17f6c)|`Rewrote this patch to the actual fix to the issue that was accepted upstream`|\n|[f7f4535](https://github.com/sagemath/sagetrac-mirror/commit/f7f4535fd94051c7232b07edc5d0c6161d603589)|`This patch has been part of Cygwin's Python for a long time, but I don't think it's still needed.`|\n|[1618c0f](https://github.com/sagemath/sagetrac-mirror/commit/1618c0f0d26c989df228b28db45c714fbc281178)|`Adds descriptions of more of the new patches`|",
    "created_at": "2017-04-20T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
|[a55e734](https://github.com/sagemath/sagetrac-mirror/commit/a55e73411211516d6ab69cb8ba0edb694c597688)|`This is fixed, for now, in sage by #21399 so we can live without this patch.`|
|[90e46fd](https://github.com/sagemath/sagetrac-mirror/commit/90e46fd1f8769a256cd122c5972a60dabe7b047c)|`This patch has been part of the Cygwin port of Python since Python 2.6, but it has not been needed in Sage.`|
|[cd51023](https://github.com/sagemath/sagetrac-mirror/commit/cd51023705656562733d4330264eab6e8d82a9f3)|`This patch seems to have been part of Cygwin's Python for a long time, but I'm not actually sure what case it's for and can't find anything referencing it.`|
|[eb02004](https://github.com/sagemath/sagetrac-mirror/commit/eb020040775c73abdfd94906a6c63d41c82c9fa7)|`This patch was needed for the tkinter module to build.  But we don't guarantee`|
|[46df7dc](https://github.com/sagemath/sagetrac-mirror/commit/46df7dca8f45df271960ccb1d9922b9851d17f6c)|`Rewrote this patch to the actual fix to the issue that was accepted upstream`|
|[f7f4535](https://github.com/sagemath/sagetrac-mirror/commit/f7f4535fd94051c7232b07edc5d0c6161d603589)|`This patch has been part of Cygwin's Python for a long time, but I don't think it's still needed.`|
|[1618c0f](https://github.com/sagemath/sagetrac-mirror/commit/1618c0f0d26c989df228b28db45c714fbc281178)|`Adds descriptions of more of the new patches`|



---

archive/issue_comments_416707.json:
```json
{
    "body": "<a id='comment:13'></a>\nI removed a handful of patches that didn't actually seem to be needed, and added better descriptions for the rest.  With this, Python 3 still builds, and at least nominally works.  I should stress that that is the only goal of this ticket.  Any other patches needed to Python 3 specifically for Sage features to work (if there are any at all) should be held off until those specific issues come up.",
    "created_at": "2017-04-20T13:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416707",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
I removed a handful of patches that didn't actually seem to be needed, and added better descriptions for the rest.  With this, Python 3 still builds, and at least nominally works.  I should stress that that is the only goal of this ticket.  Any other patches needed to Python 3 specifically for Sage features to work (if there are any at all) should be held off until those specific issues come up.



---

archive/issue_comments_416708.json:
```json
{
    "body": "<a id='comment:14'></a>\nJeroen, do you have any more comments? Otherwise, I will set a positive review.",
    "created_at": "2017-04-20T14:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416708",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Jeroen, do you have any more comments? Otherwise, I will set a positive review.



---

archive/issue_comments_416709.json:
```json
{
    "body": "<a id='comment:15'></a>\n[comment:6]",
    "created_at": "2017-04-20T15:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416709",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
[comment:6]



---

archive/issue_comments_416710.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-20T15:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416710",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_416711.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[5031e42](https://github.com/sagemath/sagetrac-mirror/commit/5031e422023459fdbe3a48cb5159abc63ec57cf2)|`Added a brief description of the ncurses patch with link to the original issue.`|",
    "created_at": "2017-04-21T14:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[5031e42](https://github.com/sagemath/sagetrac-mirror/commit/5031e422023459fdbe3a48cb5159abc63ec57cf2)|`Added a brief description of the ncurses patch with link to the original issue.`|



---

archive/issue_comments_416712.json:
```json
{
    "body": "Changing commit from \"1618c0f0d26c989df228b28db45c714fbc281178\" to \"5031e422023459fdbe3a48cb5159abc63ec57cf2\"",
    "created_at": "2017-04-21T14:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1618c0f0d26c989df228b28db45c714fbc281178" to "5031e422023459fdbe3a48cb5159abc63ec57cf2"



---

archive/issue_comments_416713.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-04-21T14:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416713",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_416714.json:
```json
{
    "body": "<a id='comment:18'></a>\nFeel free to disagree, but this addresses Jeroen's only comment.",
    "created_at": "2017-04-21T14:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416714",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Feel free to disagree, but this addresses Jeroen's only comment.



---

archive/issue_comments_416715.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Jeroen Demeyer\"",
    "created_at": "2017-04-21T14:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416715",
    "user": "https://github.com/embray"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Jeroen Demeyer"



---

archive/issue_comments_416716.json:
```json
{
    "body": "<a id='comment:20'></a>\nThanks!",
    "created_at": "2017-04-21T15:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416716",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Thanks!



---

archive/issue_comments_416717.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416717",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_416718.json:
```json
{
    "body": "Changing branch from \"u/embray/cygwin/python3-build\" to \"5031e422023459fdbe3a48cb5159abc63ec57cf2\"",
    "created_at": "2017-04-23T12:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22666#issuecomment-416718",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/cygwin/python3-build" to "5031e422023459fdbe3a48cb5159abc63ec57cf2"



---

archive/issue_events_075014.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:58:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22666",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22666#event-75014"
}
```
