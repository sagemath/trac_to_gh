# Issue 22037: Upgrade to Python 2.7.13

archive/issues_021800.json:
```json
{
    "assignees": [],
    "body": "**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgz\n\nNote: upgrade to Python 2.7.12 done in #19735.\n\nCC:  @simon-king-jena @hivert @slel @EmmanuelCharpentier\n\nBranch/Commit: **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**\n\nReviewer: **Volker Braun**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22037_\n\n",
    "closed_at": "2017-01-08T00:54:39Z",
    "created_at": "2016-12-07T13:44:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to Python 2.7.13",
    "type": "issue",
    "updated_at": "2017-01-08T00:54:39Z",
    "url": "https://github.com/sagemath/sage/issues/22037",
    "user": "https://github.com/jdemeyer"
}
```
**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgz

Note: upgrade to Python 2.7.12 done in #19735.

CC:  @simon-king-jena @hivert @slel @EmmanuelCharpentier

Branch/Commit: **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**

Reviewer: **Volker Braun**

Author: **Jeroen Demeyer**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/22037_





---

archive/issue_events_305891.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-07T13:44:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305891"
}
```



---

archive/issue_events_305892.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-07T13:44:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305892"
}
```



---

archive/issue_events_305893.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-07T13:44:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305893"
}
```



---

archive/issue_events_305894.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-07T13:44:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305894"
}
```



---

archive/issue_comments_324687.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+Python 2.7.13rc1 leads to problems with sage related to __new__. It is likely related to this change that was included in Python:\n+https://bugs.python.org/issue5322\n \n+See the following discussion on sage-devel:\n+https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E\n``````\n",
    "created_at": "2016-12-07T17:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324687",
    "user": "https://github.com/tobihan"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+Python 2.7.13rc1 leads to problems with sage related to __new__. It is likely related to this change that was included in Python:
+https://bugs.python.org/issue5322
 
+See the following discussion on sage-devel:
+https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E
``````




---

archive/issue_comments_324688.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Python 2.7.13rc1 leads to problems with sage related to __new__. It is likely related to this change that was included in Python:\n+Python 2.7.13rc1 leads to problems with sage related to `__new__`. It is likely related to this change that was included in Python:\n https://bugs.python.org/issue5322\n \n See the following discussion on sage-devel:\n``````\n",
    "created_at": "2016-12-07T17:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324688",
    "user": "https://github.com/tobihan"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Python 2.7.13rc1 leads to problems with sage related to __new__. It is likely related to this change that was included in Python:
+Python 2.7.13rc1 leads to problems with sage related to `__new__`. It is likely related to this change that was included in Python:
 https://bugs.python.org/issue5322
 
 See the following discussion on sage-devel:
``````




---

archive/issue_comments_324689.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n \n See the following discussion on sage-devel:\n https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E\n+\n+But first we should upgrade to Python 2.7.12: #19735\n``````\n",
    "created_at": "2016-12-07T18:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324689",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 
 See the following discussion on sage-devel:
 https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E
+
+But first we should upgrade to Python 2.7.12: #19735
``````




---

archive/issue_comments_324690.json:
```json
{
    "body": "Attachment: **[example.tar.gz](https://github.com/sagemath/sage/files/ticket22037/example.tar.gz)**\n\nThis is a small example showing how the ClasscallMetaclass leads to the error.",
    "created_at": "2016-12-08T23:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324690",
    "user": "https://github.com/tobihan"
}
```

Attachment: **[example.tar.gz](https://github.com/sagemath/sage/files/ticket22037/example.tar.gz)**

This is a small example showing how the ClasscallMetaclass leads to the error.



---

archive/issue_comments_324691.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSo we have \n\n`class UniqueRepresentation(CachedRepresentation, WithEqualityById)`\n\nwhere `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.\n\nIf I change that to\n\n`class UniqueRepresentation(WithEqualityById, CachedRepresentation)`\n\nthe error goes away. I don't know if that would be a correct fix though.",
    "created_at": "2016-12-09T00:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324691",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:4" align="right">comment:4</div>

So we have 

`class UniqueRepresentation(CachedRepresentation, WithEqualityById)`

where `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.

If I change that to

`class UniqueRepresentation(WithEqualityById, CachedRepresentation)`

the error goes away. I don't know if that would be a correct fix though.



---

archive/issue_comments_324692.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@tobihan](#comment%3A4):\n> So we have \n> \n> `class UniqueRepresentation(CachedRepresentation, WithEqualityById)`\n> \n> where `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.\n> \n> If I change that to\n> \n> `class UniqueRepresentation(WithEqualityById, CachedRepresentation)`\n> \n> the error goes away. I don't know if that would be a correct fix though.\n\nIn principle, the features provided by the two super classes are\northogonal (equality vs construction). Right now, I don't remember\nenough the details to see whether there could be subtleties due to one\nclass being cdef. I'll dig further.\n\nSimon, any opinion?\n\nCheers,\n                                 Nicolas",
    "created_at": "2016-12-09T22:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324692",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@tobihan](#comment%3A4):
> So we have 
> 
> `class UniqueRepresentation(CachedRepresentation, WithEqualityById)`
> 
> where `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.
> 
> If I change that to
> 
> `class UniqueRepresentation(WithEqualityById, CachedRepresentation)`
> 
> the error goes away. I don't know if that would be a correct fix though.

In principle, the features provided by the two super classes are
orthogonal (equality vs construction). Right now, I don't remember
enough the details to see whether there could be subtleties due to one
class being cdef. I'll dig further.

Simon, any opinion?

Cheers,
                                 Nicolas



---

archive/issue_comments_324693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E\n \n But first we should upgrade to Python 2.7.12: #19735\n+\n+See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.\n``````\n",
    "created_at": "2016-12-09T22:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324693",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E
 
 But first we should upgrade to Python 2.7.12: #19735
+
+See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.
``````




---

archive/issue_comments_324694.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIndeed Juliens example from https://bugs.python.org/issue25731 also exposes this issue:\n\n```\n$ cat foo.pxd \ncdef class B:\n    cdef object b\n$ cat foo.pyx \ncdef class A:\n    pass\n\ncdef class B:\n    def __init__(self, b):\n        self.b = b\n$ cat bar.py\nfrom foo import A, B\n\nclass C(A, B):\n    def __init__(self):\n        B.__init__(self, 1)\n\nC()\n$ cython foo.pyx && gcc -I/usr/include/python2.7 -Wall -shared -fPIC -o foo.so foo.c\n$ python -c 'import bar'\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"bar.py\", line 7, in <module>\n    C()\nTypeError: foo.A.__new__(C) is not safe, use foo.B.__new__()\n```",
    "created_at": "2016-12-10T13:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324694",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:8" align="right">comment:8</div>

Indeed Juliens example from https://bugs.python.org/issue25731 also exposes this issue:

```
$ cat foo.pxd 
cdef class B:
    cdef object b
$ cat foo.pyx 
cdef class A:
    pass

cdef class B:
    def __init__(self, b):
        self.b = b
$ cat bar.py
from foo import A, B

class C(A, B):
    def __init__(self):
        B.__init__(self, 1)

C()
$ cython foo.pyx && gcc -I/usr/include/python2.7 -Wall -shared -fPIC -o foo.so foo.c
$ python -c 'import bar'
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "bar.py", line 7, in <module>
    C()
TypeError: foo.A.__new__(C) is not safe, use foo.B.__new__()
```



---

archive/issue_comments_324695.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tobihan](#comment%3A4):\n> So we have \n> \n> `class UniqueRepresentation(CachedRepresentation, WithEqualityById)`\n> \n> where `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.\n> \n> If I change that to\n> \n> `class UniqueRepresentation(WithEqualityById, CachedRepresentation)`\n> \n> the error goes away. I don't know if that would be a correct fix though.\n\nLooking back at the code, this still feels rather harmless.\n\nI ran all long Sage tests; beside trivial doctests failures due to mro\nprintouts, the only errors all boil down to the following:\n\n```\nsage -t --long src/sage/combinat/root_system/cartan_type.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/cartan_type.py\", line 2999, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__\nFailed example:\n    unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage-git2/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 3014, in __setstate__\n        self.__class__ = T.__class__\n    TypeError: __class__ assignment: 'CartanType_simple_finite' object layout differs from 'CartanType'\n```\n\nThis is in a stub class whose only purpose is to support unpickling\nrather old pickles (Sage <= 4.0). It's a stub for an old class that\ndoes not exist anymore; upon unpickling an object, the `set_state`\nmethod substitutes its stub class by the appropriate new class. This\nis unsurprisingly fragile. I am unsure why it did not fail before and\nfails now.\n\nIn any cases, making the stub class derive from `UniqueRepresentation`\nensures that the two classes have the same layout, which is slightly\ncleaner than it was earlier. So that sounds like an acceptable fix.\n\nI am about to push a branch with this fix and trivially updated\ndoctests where needed. Let's see if the patchbot confirms that all\ntest pass.\n\nStill would be happy to have feedback from Simon.\n\nCheers,\n                               Nicolas",
    "created_at": "2016-12-10T22:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324695",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tobihan](#comment%3A4):
> So we have 
> 
> `class UniqueRepresentation(CachedRepresentation, WithEqualityById)`
> 
> where `CachedRepresentation` uses `ClasscallMetaclass` and `WithEqualityById` is a cdef class.
> 
> If I change that to
> 
> `class UniqueRepresentation(WithEqualityById, CachedRepresentation)`
> 
> the error goes away. I don't know if that would be a correct fix though.

Looking back at the code, this still feels rather harmless.

I ran all long Sage tests; beside trivial doctests failures due to mro
printouts, the only errors all boil down to the following:

```
sage -t --long src/sage/combinat/root_system/cartan_type.py
**********************************************************************
File "src/sage/combinat/root_system/cartan_type.py", line 2999, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__
Failed example:
    unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage-git2/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py", line 3014, in __setstate__
        self.__class__ = T.__class__
    TypeError: __class__ assignment: 'CartanType_simple_finite' object layout differs from 'CartanType'
```

This is in a stub class whose only purpose is to support unpickling
rather old pickles (Sage <= 4.0). It's a stub for an old class that
does not exist anymore; upon unpickling an object, the `set_state`
method substitutes its stub class by the appropriate new class. This
is unsurprisingly fragile. I am unsure why it did not fail before and
fails now.

In any cases, making the stub class derive from `UniqueRepresentation`
ensures that the two classes have the same layout, which is slightly
cleaner than it was earlier. So that sounds like an acceptable fix.

I am about to push a branch with this fix and trivially updated
doctests where needed. Let's see if the patchbot confirms that all
test pass.

Still would be happy to have feedback from Simon.

Cheers,
                               Nicolas



---

archive/issue_comments_324696.json:
```json
{
    "body": "Branch: **[u/nthiery/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/upgrade_to_python_2_7_13)**",
    "created_at": "2016-12-10T22:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324696",
    "user": "https://github.com/nthiery"
}
```

Branch: **[u/nthiery/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/upgrade_to_python_2_7_13)**



---

archive/issue_comments_324697.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNote: not being super familiar with the process, the above branch does *not* do the upgrade to Python 2.7.13; just the workaround suggested by Tobbias.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8968314bec3ce7545da7465274494d9dd5be0dc3\"><code>8968314</code></a></td><td><code>22037: switch order of the bases of the class UniqueRepresentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc\"><code>b7bd459</code></a></td><td><code>22037: more robust backward-compatibility stub class CartanType_simple_finite</code></td></tr></table>\n",
    "created_at": "2016-12-10T22:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324697",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:11" align="right">comment:11</div>

Note: not being super familiar with the process, the above branch does *not* do the upgrade to Python 2.7.13; just the workaround suggested by Tobbias.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8968314bec3ce7545da7465274494d9dd5be0dc3"><code>8968314</code></a></td><td><code>22037: switch order of the bases of the class UniqueRepresentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc"><code>b7bd459</code></a></td><td><code>22037: more robust backward-compatibility stub class CartanType_simple_finite</code></td></tr></table>




---

archive/issue_comments_324698.json:
```json
{
    "body": "Commit: **[`b7bd459`](https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc)**",
    "created_at": "2016-12-10T22:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324698",
    "user": "https://github.com/nthiery"
}
```

Commit: **[`b7bd459`](https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc)**



---

archive/issue_comments_324699.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThere are several places that need to be changed. The problem is that the errors are discovered one by one. Is there a standard way to rebuild just a single .pyx file? Right now I have to do a rebuild of sagelib everytime I change one. This is my patch right now, and there are still new errors coming up:\n\n```\n--- a/src/sage/structure/unique_representation.py\n+++ b/src/sage/structure/unique_representation.py\n@@ -1176,7 +1176,7 @@\n     return cls(*args, **keywords)\n \n \n-class UniqueRepresentation(CachedRepresentation, WithEqualityById):\n+class UniqueRepresentation(WithEqualityById, CachedRepresentation):\n     r\"\"\"\n     Classes derived from UniqueRepresentation inherit a unique\n     representation behavior for their instances.\n--- a/src/sage/categories/cartesian_product.py\n+++ b/src/sage/categories/cartesian_product.py\n@@ -18,7 +18,7 @@\n \n native_python_containers   = set([tuple, list, set, frozenset])\n \n-class CartesianProductFunctor(CovariantFunctorialConstruction, MultivariateConstructionFunctor):\n+class CartesianProductFunctor(MultivariateConstructionFunctor, CovariantFunctorialConstruction):\n     \"\"\"\n     A singleton class for the Cartesian product functor.\n \n--- a/src/sage/rings/infinity.py\n+++ b/src/sage/rings/infinity.py\n@@ -544,7 +544,7 @@\n \n \n class UnsignedInfinityRing_class(Singleton, Ring):\n-\n+    __new__ = Ring.__new__\n     def __init__(self):\n         \"\"\"\n         Initialize ``self``.\n@@ -950,6 +950,7 @@\n     pass\n \n class InfinityRing_class(Singleton, Ring):\n+    __new__ = Ring.__new__\n     def __init__(self):\n         \"\"\"\n         Initialize ``self``.\n--- a/src/sage/structure/formal_sum.py\n+++ b/src/sage/structure/formal_sum.py\n@@ -314,7 +314,7 @@\n             w.append((coeff,last))\n         self._data = w\n \n-class FormalSums(UniqueRepresentation, Module):\n+class FormalSums(Module, UniqueRepresentation):\n     \"\"\"\n     The R-module of finite formal sums with coefficients in some ring R.\n \n--- a/src/sage/misc/inherit_comparison.pyx\n+++ b/src/sage/misc/inherit_comparison.pyx\n@@ -83,5 +83,5 @@\n                 t.tp_compare = b.tp_compare\n         super(InheritComparisonMetaclass, self).__init__(*args)\n \n-class InheritComparisonClasscallMetaclass(InheritComparisonMetaclass, ClasscallMetaclass):\n+class InheritComparisonClasscallMetaclass(ClasscallMetaclass, InheritComparisonMetaclass):\n     pass\n--- a/src/sage/rings/polynomial/polynomial_ring.py\n+++ b/src/sage/rings/polynomial/polynomial_ring.py\n@@ -1439,7 +1439,7 @@\n             return self._monics_max( max_degree )\n         raise ValueError(\"you should pass exactly one of of_degree and max_degree\")\n \n-class PolynomialRing_commutative(PolynomialRing_general, commutative_algebra.CommutativeAlgebra):\n+class PolynomialRing_commutative(commutative_algebra.CommutativeAlgebra, PolynomialRing_general):\n     \"\"\"\n     Univariate polynomial ring over a commutative ring.\n     \"\"\"\n--- a/src/sage/rings/real_arb.pyx\n+++ b/src/sage/rings/real_arb.pyx\n@@ -355,7 +355,7 @@\n     if _do_sig(myprec): sig_off()\n     return 0\n \n-class RealBallField(UniqueRepresentation, Field):\n+class RealBallField(Field, UniqueRepresentation):\n     r\"\"\"\n     An approximation of the field of real numbers using mid-rad intervals, also\n     known as balls.\n```",
    "created_at": "2016-12-10T22:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324699",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:12" align="right">comment:12</div>

There are several places that need to be changed. The problem is that the errors are discovered one by one. Is there a standard way to rebuild just a single .pyx file? Right now I have to do a rebuild of sagelib everytime I change one. This is my patch right now, and there are still new errors coming up:

```
--- a/src/sage/structure/unique_representation.py
+++ b/src/sage/structure/unique_representation.py
@@ -1176,7 +1176,7 @@
     return cls(*args, **keywords)
 
 
-class UniqueRepresentation(CachedRepresentation, WithEqualityById):
+class UniqueRepresentation(WithEqualityById, CachedRepresentation):
     r"""
     Classes derived from UniqueRepresentation inherit a unique
     representation behavior for their instances.
--- a/src/sage/categories/cartesian_product.py
+++ b/src/sage/categories/cartesian_product.py
@@ -18,7 +18,7 @@
 
 native_python_containers   = set([tuple, list, set, frozenset])
 
-class CartesianProductFunctor(CovariantFunctorialConstruction, MultivariateConstructionFunctor):
+class CartesianProductFunctor(MultivariateConstructionFunctor, CovariantFunctorialConstruction):
     """
     A singleton class for the Cartesian product functor.
 
--- a/src/sage/rings/infinity.py
+++ b/src/sage/rings/infinity.py
@@ -544,7 +544,7 @@
 
 
 class UnsignedInfinityRing_class(Singleton, Ring):
-
+    __new__ = Ring.__new__
     def __init__(self):
         """
         Initialize ``self``.
@@ -950,6 +950,7 @@
     pass
 
 class InfinityRing_class(Singleton, Ring):
+    __new__ = Ring.__new__
     def __init__(self):
         """
         Initialize ``self``.
--- a/src/sage/structure/formal_sum.py
+++ b/src/sage/structure/formal_sum.py
@@ -314,7 +314,7 @@
             w.append((coeff,last))
         self._data = w
 
-class FormalSums(UniqueRepresentation, Module):
+class FormalSums(Module, UniqueRepresentation):
     """
     The R-module of finite formal sums with coefficients in some ring R.
 
--- a/src/sage/misc/inherit_comparison.pyx
+++ b/src/sage/misc/inherit_comparison.pyx
@@ -83,5 +83,5 @@
                 t.tp_compare = b.tp_compare
         super(InheritComparisonMetaclass, self).__init__(*args)
 
-class InheritComparisonClasscallMetaclass(InheritComparisonMetaclass, ClasscallMetaclass):
+class InheritComparisonClasscallMetaclass(ClasscallMetaclass, InheritComparisonMetaclass):
     pass
--- a/src/sage/rings/polynomial/polynomial_ring.py
+++ b/src/sage/rings/polynomial/polynomial_ring.py
@@ -1439,7 +1439,7 @@
             return self._monics_max( max_degree )
         raise ValueError("you should pass exactly one of of_degree and max_degree")
 
-class PolynomialRing_commutative(PolynomialRing_general, commutative_algebra.CommutativeAlgebra):
+class PolynomialRing_commutative(commutative_algebra.CommutativeAlgebra, PolynomialRing_general):
     """
     Univariate polynomial ring over a commutative ring.
     """
--- a/src/sage/rings/real_arb.pyx
+++ b/src/sage/rings/real_arb.pyx
@@ -355,7 +355,7 @@
     if _do_sig(myprec): sig_off()
     return 0
 
-class RealBallField(UniqueRepresentation, Field):
+class RealBallField(Field, UniqueRepresentation):
     r"""
     An approximation of the field of real numbers using mid-rad intervals, also
     known as balls.
```



---

archive/issue_comments_324700.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOuch, this is getting more annoying. Let's see how big the list grows. It's more worrying to have to move UniqueRepresentation to second place.\n\n`sage -b` rebuilds just the Sage library. This is usually good enough when only a single pyx file needs to be rebuilt.\n\nHave a good night,",
    "created_at": "2016-12-10T22:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324700",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:13" align="right">comment:13</div>

Ouch, this is getting more annoying. Let's see how big the list grows. It's more worrying to have to move UniqueRepresentation to second place.

`sage -b` rebuilds just the Sage library. This is usually good enough when only a single pyx file needs to be rebuilt.

Have a good night,



---

archive/issue_comments_324701.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIs better not to change the order of base classes and instead just define `__new__` everywhere like I did for example for InfinityRing_class?",
    "created_at": "2016-12-10T22:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324701",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:14" align="right">comment:14</div>

Is better not to change the order of base classes and instead just define `__new__` everywhere like I did for example for InfinityRing_class?



---

archive/issue_comments_324702.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAh, I had missed that. If this works, this would be acceptable as a temporary workaround.\nMy first guess is that this would break the CachedRepresentation; but I'll give it a try.\n\nAnyone available for making a branch with Python 2.7.13, so that we can all easilly experiment with it? Otherwise, I'll try to squeeze this sometime today, but really no promise.\n\nThanks Tobias for investigating this hard!",
    "created_at": "2016-12-11T07:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324702",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:15" align="right">comment:15</div>

Ah, I had missed that. If this works, this would be acceptable as a temporary workaround.
My first guess is that this would break the CachedRepresentation; but I'll give it a try.

Anyone available for making a branch with Python 2.7.13, so that we can all easilly experiment with it? Otherwise, I'll try to squeeze this sometime today, but really no promise.

Thanks Tobias for investigating this hard!



---

archive/issue_comments_324703.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,7 @@\n See the following discussion on sage-devel:\n https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E\n \n-But first we should upgrade to Python 2.7.12: #19735\n+See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.\n \n-See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.\n+Note: upgrade to Python 2.7.12 done in #19735.\n+\n``````\n",
    "created_at": "2016-12-11T09:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324703",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,7 @@
 See the following discussion on sage-devel:
 https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E
 
-But first we should upgrade to Python 2.7.12: #19735
+See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.
 
-See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.
+Note: upgrade to Python 2.7.12 done in #19735.
+
``````




---

archive/issue_comments_324704.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n#19735 \"Upgrade to Python 2.7.12\" was just closed.",
    "created_at": "2016-12-11T09:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324704",
    "user": "https://github.com/slel"
}
```

<div id="comment:17" align="right">comment:17</div>

#19735 "Upgrade to Python 2.7.12" was just closed.



---

archive/issue_comments_324705.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@nthiery](#comment%3A13):\n> `sage -b` rebuilds just the Sage library. This is usually good enough when only a single pyx file needs to be rebuilt.\n\nAlthough it should be said that `sage -b` should be used only if you \"know what you are doing\". It's safer to run `make sagelib` (build Sage library) or `make build` (build all Sage packages) or plain `make` (build Sage + documentation). The `make` commands have dependency checking, so an outdated library will be rebuilt if needed. When you only run `sage -b`, you might get into trouble when switching branches because some dependencies might not be updated.",
    "created_at": "2016-12-11T12:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324705",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@nthiery](#comment%3A13):
> `sage -b` rebuilds just the Sage library. This is usually good enough when only a single pyx file needs to be rebuilt.

Although it should be said that `sage -b` should be used only if you "know what you are doing". It's safer to run `make sagelib` (build Sage library) or `make build` (build all Sage packages) or plain `make` (build Sage + documentation). The `make` commands have dependency checking, so an outdated library will be rebuilt if needed. When you only run `sage -b`, you might get into trouble when switching branches because some dependencies might not be updated.



---

archive/issue_comments_324706.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThanks. I'm using Debian packages for the dependencies so I'm just rebuilding sagelib anyway. I was asking if it was possible to rebuild just a single .pyx file.\n\nMeanwhile the patch is getting bigger and bigger. I think I need to add `__new__ = Parent.__new__` to all classes that have the base classes \"Uniquerepresentation, Parent\", which are many. And others. At least now sage starts and one can run the tests to uncover more errors. Should I keep going on with this?\n\n```\n--- a/src/sage/structure/unique_representation.py\n+++ b/src/sage/structure/unique_representation.py\n@@ -1342,3 +1342,4 @@\n         ....:\n         sage: b = bla()\n     \"\"\"\n+    __new__ = object.__new__\n--- a/src/sage/categories/cartesian_product.py\n+++ b/src/sage/categories/cartesian_product.py\n@@ -105,6 +105,7 @@\n     :class:`CartesianProductsCategory`.\n \n     \"\"\"\n+    __new__ = MultivariateConstructionFunctor.__new__\n     _functor_name = \"cartesian_product\"\n     _functor_category = \"CartesianProducts\"\n     symbol = \" (+) \"\n--- a/src/sage/rings/infinity.py\n+++ b/src/sage/rings/infinity.py\n@@ -544,7 +544,7 @@\n \n \n class UnsignedInfinityRing_class(Singleton, Ring):\n-\n+    __new__ = Ring.__new__\n     def __init__(self):\n         \"\"\"\n         Initialize ``self``.\n@@ -950,6 +950,7 @@\n     pass\n \n class InfinityRing_class(Singleton, Ring):\n+    __new__ = Ring.__new__\n     def __init__(self):\n         \"\"\"\n         Initialize ``self``.\n--- a/src/sage/structure/formal_sum.py\n+++ b/src/sage/structure/formal_sum.py\n@@ -336,6 +336,7 @@\n         sage: TestSuite(FormalSums(QQ)).run()\n \n     \"\"\"\n+    __new__ = Module.__new__\n     Element = FormalSum\n     @staticmethod\n     def __classcall__(cls, base_ring = ZZ):\n--- a/src/sage/misc/inherit_comparison.pyx\n+++ b/src/sage/misc/inherit_comparison.pyx\n@@ -84,4 +84,5 @@\n         super(InheritComparisonMetaclass, self).__init__(*args)\n \n class InheritComparisonClasscallMetaclass(InheritComparisonMetaclass, ClasscallMetaclass):\n+    __new__ = ClasscallMetaclass.__new__\n     pass\n--- a/src/sage/rings/polynomial/polynomial_ring.py\n+++ b/src/sage/rings/polynomial/polynomial_ring.py\n@@ -1443,6 +1443,7 @@\n     \"\"\"\n     Univariate polynomial ring over a commutative ring.\n     \"\"\"\n+    __new__ = commutative_algebra.CommutativeAlgebra.__new__\n     def __init__(self, base_ring, name=None, sparse=False, element_class=None, category=None):\n         if base_ring not in _CommutativeRings:\n             raise TypeError(\"Base ring %s must be a commutative ring.\"%repr(base_ring))\n--- a/src/sage/rings/real_arb.pyx\n+++ b/src/sage/rings/real_arb.pyx\n@@ -398,6 +398,7 @@\n         sage: RBF.zero()\n         0\n     \"\"\"\n+    __new__ = Field.__new__\n     Element = RealBall\n \n     @staticmethod\n--- a/src/sage/structure/dynamic_class.py\n+++ b/src/sage/structure/dynamic_class.py\n@@ -460,6 +460,7 @@\n     pass\n \n class DynamicInheritComparisonMetaclass(DynamicMetaclass, InheritComparisonMetaclass):\n+    __new__ = type.__new__\n     pass\n \n class DynamicInheritComparisonClasscallMetaclass(DynamicMetaclass, InheritComparisonClasscallMetaclass):\n--- a/src/sage/rings/complex_arb.pyx\n+++ b/src/sage/rings/complex_arb.pyx\n@@ -234,6 +234,7 @@\n         ...\n         ValueError: Precision must be at least 2.\n     \"\"\"\n+    __new__ = Field.__new__\n     Element = ComplexBall\n \n     @staticmethod\n--- a/src/sage/rings/pari_ring.py\n+++ b/src/sage/rings/pari_ring.py\n@@ -165,6 +165,7 @@\n         sage: loads(R.dumps()) is R\n         True\n     \"\"\"\n+    __new__ = ring.Ring.__new__\n     Element = Pari\n \n     def __init__(self):\n--- a/src/sage/rings/contfrac.py\n+++ b/src/sage/rings/contfrac.py\n@@ -78,6 +78,7 @@\n         sage: CFF.category()\n         Category of fields\n     \"\"\"\n+    __new__ = Field.__new__\n     class Element(ContinuedFraction_periodic,FieldElement):\n         r\"\"\"\n         A continued fraction of a rational number.\n--- a/src/sage/rings/number_field/number_field.py\n+++ b/src/sage/rings/number_field/number_field.py\n@@ -1264,6 +1264,7 @@\n         ....:         assert elt.is_integral()\n \n     \"\"\"\n+    __new__ = number_field_base.NumberField.__new__\n     def __init__(self, polynomial, name, latex_name,\n                  check=True, embedding=None, category=None,\n                  assume_disc_small=False, maximize_at_primes=None, structure=None):\n--- a/src/sage/matrix/matrix_space.py\n+++ b/src/sage/matrix/matrix_space.py\n@@ -137,6 +137,7 @@\n         ...\n         ValueError: number of rows and columns may be at most...\n     \"\"\"\n+    __new__ = parent_gens.ParentWithGens.__new__\n     _no_generic_basering_coercion = True\n \n     @staticmethod\n--- a/src/sage/schemes/generic/scheme.py\n+++ b/src/sage/schemes/generic/scheme.py\n@@ -791,6 +791,7 @@\n         :class:`sage.schemes.generic.algebraic_scheme.AffineSpace`.\n \n     \"\"\"\n+    __new__ = Scheme.__new__\n     def __init__(self, R, S=None, category=None):\n         \"\"\"\n         Construct the affine scheme with coordinate ring `R`.\n--- a/src/sage/combinat/partition.py\n+++ b/src/sage/combinat/partition.py\n@@ -5061,6 +5061,7 @@\n         sage: P.list()\n         [[3, 2]]\n     \"\"\"\n+    __new__ = Parent.__new__\n     @staticmethod\n     def __classcall_private__(cls, n=None, **kwargs):\n         \"\"\"\n--- a/src/sage/sets/non_negative_integers.py\n+++ b/src/sage/sets/non_negative_integers.py\n@@ -67,7 +67,7 @@\n     TODO: do not use ``NN`` any more in the doctests for\n     ``NonNegativeIntegers``.\n     \"\"\"\n-\n+    __new__ = Parent.__new__\n     def __init__(self, category=None):\n         \"\"\"\n         TESTS::\n--- a/src/sage/structure/sequence.py\n+++ b/src/sage/structure/sequence.py\n@@ -410,6 +410,7 @@\n         Finite Field of size 5\n \n     \"\"\"\n+    __new__ = list.__new__\n     def __init__(self, x, universe=None, check=True, immutable=False,\n                  cr=False, cr_str=None, use_sage_types=False):\n         \"\"\"\n--- a/src/sage/structure/list_clone_demo.pyx\n+++ b/src/sage/structure/list_clone_demo.pyx\n@@ -61,7 +61,7 @@\n         sage: IncreasingArrays().element_class\n         <type 'sage.structure.list_clone_demo.IncreasingArray'>\n     \"\"\"\n-\n+    __new__ = Parent.__new__\n     def __init__(self):\n         \"\"\"\n         TESTS::\n--- a/src/sage/sets/finite_enumerated_set.py\n+++ b/src/sage/sets/finite_enumerated_set.py\n@@ -80,7 +80,7 @@\n         sage: S.first().parent()\n         Integer Ring\n     \"\"\"\n-\n+    __new__ = Parent.__new__\n     @staticmethod\n     def __classcall__(cls, iterable):\n         \"\"\"\n--- a/src/sage/combinat/derangements.py\n+++ b/src/sage/combinat/derangements.py\n@@ -130,6 +130,7 @@\n         sage: D2.random_element() # random\n         [2, 3, 1, 3, 1, 2]\n     \"\"\"\n+    __new__ = Parent.__new__\n     @staticmethod\n     def __classcall_private__(cls, x):\n         \"\"\"\n--- a/src/sage/combinat/permutation.py\n+++ b/src/sage/combinat/permutation.py\n@@ -5003,6 +5003,7 @@\n         sage: p.random_element()\n         [5, 1, 2, 4, 3]\n     \"\"\"\n+    __new__ = Parent.__new__\n     @staticmethod\n     def __classcall_private__(cls, n=None, k=None, **kwargs):\n         \"\"\"\n--- a/src/sage/categories/examples/infinite_enumerated_sets.py\n+++ b/src/sage/categories/examples/infinite_enumerated_sets.py\n@@ -73,7 +73,7 @@\n         running ._test_pickling() . . . pass\n         running ._test_some_elements() . . . pass\n     \"\"\"\n-\n+    __new__ = Parent.__new__\n     def __init__(self):\n         \"\"\"\n         TESTS::\n--- a/src/sage/categories/examples/sets_with_grading.py\n+++ b/src/sage/categories/examples/sets_with_grading.py\n@@ -23,6 +23,7 @@\n         sage: E.graded_component(100)\n         {100}\n     \"\"\"\n+    __new__ = Parent.__new__\n     def __init__(self):\n         r\"\"\"\n         TESTS::\n--- a/src/sage/sets/cartesian_product.py\n+++ b/src/sage/sets/cartesian_product.py\n@@ -53,6 +53,7 @@\n \n     .. automethod:: _cartesian_product_of_elements\n     \"\"\"\n+    __new__ = Parent.__new__\n     def __init__(self, sets, category, flatten=False):\n         r\"\"\"\n         INPUT:\n```",
    "created_at": "2016-12-11T13:04:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324706",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:19" align="right">comment:19</div>

Thanks. I'm using Debian packages for the dependencies so I'm just rebuilding sagelib anyway. I was asking if it was possible to rebuild just a single .pyx file.

Meanwhile the patch is getting bigger and bigger. I think I need to add `__new__ = Parent.__new__` to all classes that have the base classes "Uniquerepresentation, Parent", which are many. And others. At least now sage starts and one can run the tests to uncover more errors. Should I keep going on with this?

```
--- a/src/sage/structure/unique_representation.py
+++ b/src/sage/structure/unique_representation.py
@@ -1342,3 +1342,4 @@
         ....:
         sage: b = bla()
     """
+    __new__ = object.__new__
--- a/src/sage/categories/cartesian_product.py
+++ b/src/sage/categories/cartesian_product.py
@@ -105,6 +105,7 @@
     :class:`CartesianProductsCategory`.
 
     """
+    __new__ = MultivariateConstructionFunctor.__new__
     _functor_name = "cartesian_product"
     _functor_category = "CartesianProducts"
     symbol = " (+) "
--- a/src/sage/rings/infinity.py
+++ b/src/sage/rings/infinity.py
@@ -544,7 +544,7 @@
 
 
 class UnsignedInfinityRing_class(Singleton, Ring):
-
+    __new__ = Ring.__new__
     def __init__(self):
         """
         Initialize ``self``.
@@ -950,6 +950,7 @@
     pass
 
 class InfinityRing_class(Singleton, Ring):
+    __new__ = Ring.__new__
     def __init__(self):
         """
         Initialize ``self``.
--- a/src/sage/structure/formal_sum.py
+++ b/src/sage/structure/formal_sum.py
@@ -336,6 +336,7 @@
         sage: TestSuite(FormalSums(QQ)).run()
 
     """
+    __new__ = Module.__new__
     Element = FormalSum
     @staticmethod
     def __classcall__(cls, base_ring = ZZ):
--- a/src/sage/misc/inherit_comparison.pyx
+++ b/src/sage/misc/inherit_comparison.pyx
@@ -84,4 +84,5 @@
         super(InheritComparisonMetaclass, self).__init__(*args)
 
 class InheritComparisonClasscallMetaclass(InheritComparisonMetaclass, ClasscallMetaclass):
+    __new__ = ClasscallMetaclass.__new__
     pass
--- a/src/sage/rings/polynomial/polynomial_ring.py
+++ b/src/sage/rings/polynomial/polynomial_ring.py
@@ -1443,6 +1443,7 @@
     """
     Univariate polynomial ring over a commutative ring.
     """
+    __new__ = commutative_algebra.CommutativeAlgebra.__new__
     def __init__(self, base_ring, name=None, sparse=False, element_class=None, category=None):
         if base_ring not in _CommutativeRings:
             raise TypeError("Base ring %s must be a commutative ring."%repr(base_ring))
--- a/src/sage/rings/real_arb.pyx
+++ b/src/sage/rings/real_arb.pyx
@@ -398,6 +398,7 @@
         sage: RBF.zero()
         0
     """
+    __new__ = Field.__new__
     Element = RealBall
 
     @staticmethod
--- a/src/sage/structure/dynamic_class.py
+++ b/src/sage/structure/dynamic_class.py
@@ -460,6 +460,7 @@
     pass
 
 class DynamicInheritComparisonMetaclass(DynamicMetaclass, InheritComparisonMetaclass):
+    __new__ = type.__new__
     pass
 
 class DynamicInheritComparisonClasscallMetaclass(DynamicMetaclass, InheritComparisonClasscallMetaclass):
--- a/src/sage/rings/complex_arb.pyx
+++ b/src/sage/rings/complex_arb.pyx
@@ -234,6 +234,7 @@
         ...
         ValueError: Precision must be at least 2.
     """
+    __new__ = Field.__new__
     Element = ComplexBall
 
     @staticmethod
--- a/src/sage/rings/pari_ring.py
+++ b/src/sage/rings/pari_ring.py
@@ -165,6 +165,7 @@
         sage: loads(R.dumps()) is R
         True
     """
+    __new__ = ring.Ring.__new__
     Element = Pari
 
     def __init__(self):
--- a/src/sage/rings/contfrac.py
+++ b/src/sage/rings/contfrac.py
@@ -78,6 +78,7 @@
         sage: CFF.category()
         Category of fields
     """
+    __new__ = Field.__new__
     class Element(ContinuedFraction_periodic,FieldElement):
         r"""
         A continued fraction of a rational number.
--- a/src/sage/rings/number_field/number_field.py
+++ b/src/sage/rings/number_field/number_field.py
@@ -1264,6 +1264,7 @@
         ....:         assert elt.is_integral()
 
     """
+    __new__ = number_field_base.NumberField.__new__
     def __init__(self, polynomial, name, latex_name,
                  check=True, embedding=None, category=None,
                  assume_disc_small=False, maximize_at_primes=None, structure=None):
--- a/src/sage/matrix/matrix_space.py
+++ b/src/sage/matrix/matrix_space.py
@@ -137,6 +137,7 @@
         ...
         ValueError: number of rows and columns may be at most...
     """
+    __new__ = parent_gens.ParentWithGens.__new__
     _no_generic_basering_coercion = True
 
     @staticmethod
--- a/src/sage/schemes/generic/scheme.py
+++ b/src/sage/schemes/generic/scheme.py
@@ -791,6 +791,7 @@
         :class:`sage.schemes.generic.algebraic_scheme.AffineSpace`.
 
     """
+    __new__ = Scheme.__new__
     def __init__(self, R, S=None, category=None):
         """
         Construct the affine scheme with coordinate ring `R`.
--- a/src/sage/combinat/partition.py
+++ b/src/sage/combinat/partition.py
@@ -5061,6 +5061,7 @@
         sage: P.list()
         [[3, 2]]
     """
+    __new__ = Parent.__new__
     @staticmethod
     def __classcall_private__(cls, n=None, **kwargs):
         """
--- a/src/sage/sets/non_negative_integers.py
+++ b/src/sage/sets/non_negative_integers.py
@@ -67,7 +67,7 @@
     TODO: do not use ``NN`` any more in the doctests for
     ``NonNegativeIntegers``.
     """
-
+    __new__ = Parent.__new__
     def __init__(self, category=None):
         """
         TESTS::
--- a/src/sage/structure/sequence.py
+++ b/src/sage/structure/sequence.py
@@ -410,6 +410,7 @@
         Finite Field of size 5
 
     """
+    __new__ = list.__new__
     def __init__(self, x, universe=None, check=True, immutable=False,
                  cr=False, cr_str=None, use_sage_types=False):
         """
--- a/src/sage/structure/list_clone_demo.pyx
+++ b/src/sage/structure/list_clone_demo.pyx
@@ -61,7 +61,7 @@
         sage: IncreasingArrays().element_class
         <type 'sage.structure.list_clone_demo.IncreasingArray'>
     """
-
+    __new__ = Parent.__new__
     def __init__(self):
         """
         TESTS::
--- a/src/sage/sets/finite_enumerated_set.py
+++ b/src/sage/sets/finite_enumerated_set.py
@@ -80,7 +80,7 @@
         sage: S.first().parent()
         Integer Ring
     """
-
+    __new__ = Parent.__new__
     @staticmethod
     def __classcall__(cls, iterable):
         """
--- a/src/sage/combinat/derangements.py
+++ b/src/sage/combinat/derangements.py
@@ -130,6 +130,7 @@
         sage: D2.random_element() # random
         [2, 3, 1, 3, 1, 2]
     """
+    __new__ = Parent.__new__
     @staticmethod
     def __classcall_private__(cls, x):
         """
--- a/src/sage/combinat/permutation.py
+++ b/src/sage/combinat/permutation.py
@@ -5003,6 +5003,7 @@
         sage: p.random_element()
         [5, 1, 2, 4, 3]
     """
+    __new__ = Parent.__new__
     @staticmethod
     def __classcall_private__(cls, n=None, k=None, **kwargs):
         """
--- a/src/sage/categories/examples/infinite_enumerated_sets.py
+++ b/src/sage/categories/examples/infinite_enumerated_sets.py
@@ -73,7 +73,7 @@
         running ._test_pickling() . . . pass
         running ._test_some_elements() . . . pass
     """
-
+    __new__ = Parent.__new__
     def __init__(self):
         """
         TESTS::
--- a/src/sage/categories/examples/sets_with_grading.py
+++ b/src/sage/categories/examples/sets_with_grading.py
@@ -23,6 +23,7 @@
         sage: E.graded_component(100)
         {100}
     """
+    __new__ = Parent.__new__
     def __init__(self):
         r"""
         TESTS::
--- a/src/sage/sets/cartesian_product.py
+++ b/src/sage/sets/cartesian_product.py
@@ -53,6 +53,7 @@
 
     .. automethod:: _cartesian_product_of_elements
     """
+    __new__ = Parent.__new__
     def __init__(self, sets, category, flatten=False):
         r"""
         INPUT:
```



---

archive/issue_comments_324707.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,6 @@\n \n See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.\n \n+**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13rc1.tgz\n+\n Note: upgrade to Python 2.7.12 done in #19735.\n-\n``````\n",
    "created_at": "2016-12-11T13:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324707",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,6 @@
 
 See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.
 
+**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13rc1.tgz
+
 Note: upgrade to Python 2.7.12 done in #19735.
-
``````




---

archive/issue_comments_324708.json:
```json
{
    "body": "Changed branch from **[u/nthiery/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/upgrade_to_python_2_7_13)** to **[u/jdemeyer/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/upgrade_to_python_2_7_13)**",
    "created_at": "2016-12-11T13:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324708",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/nthiery/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/upgrade_to_python_2_7_13)** to **[u/jdemeyer/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/upgrade_to_python_2_7_13)**



---

archive/issue_comments_324709.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis branch now contains both the upgrade to Python 2.7.13rc1 as well as the commits by Nicolas.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c35ea3cbcef6c1ae9f6a939af853ac339fcd691c\"><code>c35ea3c</code></a></td><td><code>Upgrade python2 to 2.7.12 and update tinfo and uuid patches</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85e931baf9d76af3b4f011d6b499227b6dd4aea7\"><code>85e931b</code></a></td><td><code>fix sage_timeit and word.py for python 2.7.12</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a119bf7eb0597ef25016b070f5eaedbb280f4ed4\"><code>a119bf7</code></a></td><td><code>Upgrade to Python 2.7.13rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a735fa5dc3ea81bc316f8a9cdcb013160382f770\"><code>a735fa5</code></a></td><td><code>22037: switch order of the bases of the class UniqueRepresentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d\"><code>ba486e1</code></a></td><td><code>22037: more robust backward-compatibility stub class CartanType_simple_finite</code></td></tr></table>\n",
    "created_at": "2016-12-11T13:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324709",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

This branch now contains both the upgrade to Python 2.7.13rc1 as well as the commits by Nicolas.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c35ea3cbcef6c1ae9f6a939af853ac339fcd691c"><code>c35ea3c</code></a></td><td><code>Upgrade python2 to 2.7.12 and update tinfo and uuid patches</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85e931baf9d76af3b4f011d6b499227b6dd4aea7"><code>85e931b</code></a></td><td><code>fix sage_timeit and word.py for python 2.7.12</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a119bf7eb0597ef25016b070f5eaedbb280f4ed4"><code>a119bf7</code></a></td><td><code>Upgrade to Python 2.7.13rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a735fa5dc3ea81bc316f8a9cdcb013160382f770"><code>a735fa5</code></a></td><td><code>22037: switch order of the bases of the class UniqueRepresentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d"><code>ba486e1</code></a></td><td><code>22037: more robust backward-compatibility stub class CartanType_simple_finite</code></td></tr></table>




---

archive/issue_comments_324710.json:
```json
{
    "body": "Changed commit from **[`b7bd459`](https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc)** to **[`ba486e1`](https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d)**",
    "created_at": "2016-12-11T13:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324710",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`b7bd459`](https://github.com/sagemath/sagetrac-mirror/commit/b7bd4597e18af490dd9e6225e47b16d5ec8d79dc)** to **[`ba486e1`](https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d)**



---

archive/issue_comments_324711.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI now have a patch that changes more than 100 files and that's still not all. I don't think fixing this case-by-case in this way is viable. In any case this would be just a temporary fix. If we could find a simpler workaround in Sage that would be great, otherwise we'll have to try to get the Python change reverted I guess.",
    "created_at": "2016-12-11T17:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324711",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:23" align="right">comment:23</div>

I now have a patch that changes more than 100 files and that's still not all. I don't think fixing this case-by-case in this way is viable. In any case this would be just a temporary fix. If we could find a simpler workaround in Sage that would be great, otherwise we'll have to try to get the Python change reverted I guess.



---

archive/issue_comments_324712.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@tobihan](#comment%3A23):\n> we'll have to try to get the Python change reverted I guess.\n\nI have no idea how feasible that is, but that would be the best solution. There is clearly a backwards-incompatible change being done, so that would be a good argument to revert the change.",
    "created_at": "2016-12-11T18:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324712",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@tobihan](#comment%3A23):
> we'll have to try to get the Python change reverted I guess.

I have no idea how feasible that is, but that would be the best solution. There is clearly a backwards-incompatible change being done, so that would be a good argument to revert the change.



---

archive/issue_comments_324713.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@tobihan](#comment%3A23):\n> I now have a patch that changes more than 100 files and that's still not all. I don't think fixing this case-by-case in this way is viable.\n\nSounds like it indeed.\n\n> In any case this would be just a temporary fix. If we could find a simpler workaround in Sage that would be great, otherwise we'll have to try to get the Python change reverted I guess.\n\nI assume you have tried to do this `xxx.__new__` change in the `UniqueRepresentation` base class, and that did not work, right? Plausibly because which `xxx` shall be used depends from one case to the other. Maybe the `ClassCallMetaclass.__init__` method could handle this upon class creation, figuring out the proper `xxx` to use.\n\nI am currently recompiling Sage with the new branch (thanks Jeroen), and will try to look at this later tonight.\n\nI tchated with Florent earlier today; he was sitting next to Julien last Spring when they investigated this. He will have a look as well and try to remember and post the details.",
    "created_at": "2016-12-11T18:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324713",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@tobihan](#comment%3A23):
> I now have a patch that changes more than 100 files and that's still not all. I don't think fixing this case-by-case in this way is viable.

Sounds like it indeed.

> In any case this would be just a temporary fix. If we could find a simpler workaround in Sage that would be great, otherwise we'll have to try to get the Python change reverted I guess.

I assume you have tried to do this `xxx.__new__` change in the `UniqueRepresentation` base class, and that did not work, right? Plausibly because which `xxx` shall be used depends from one case to the other. Maybe the `ClassCallMetaclass.__init__` method could handle this upon class creation, figuring out the proper `xxx` to use.

I am currently recompiling Sage with the new branch (thanks Jeroen), and will try to look at this later tonight.

I tchated with Florent earlier today; he was sitting next to Julien last Spring when they investigated this. He will have a look as well and try to remember and post the details.



---

archive/issue_comments_324714.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment%3A24):\n> Replying to [@tobihan](#comment%3A23):\n> > we'll have to try to get the Python change reverted I guess.\n\n> \n> I have no idea how feasible that is, but that would be the best solution. There is clearly a backwards-incompatible change being done, so that would be a good argument to revert the change.\n\n+1\n\n(revert or possibly ammend the change so that it would not break the backward compatibility, but still achieve the desired feature they wanted)",
    "created_at": "2016-12-11T18:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324714",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment%3A24):
> Replying to [@tobihan](#comment%3A23):
> > we'll have to try to get the Python change reverted I guess.

> 
> I have no idea how feasible that is, but that would be the best solution. There is clearly a backwards-incompatible change being done, so that would be a good argument to revert the change.

+1

(revert or possibly ammend the change so that it would not break the backward compatibility, but still achieve the desired feature they wanted)



---

archive/issue_comments_324715.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nIf we can revert this in the Python package in Debian in time depends on what the maintainer thinks and if he responds quickly.\n\nIt would help if the change would break another software that is already in Debian. In that case the bug would have a higher severity (RC bug) and that would force the maintainer to do something or allow us to upload a change. I already rebuilt some packages to see if they are affected (numpy, scipy, etc) but they all seem to be fine. If someone knows software that uses inheritance with cdef classes and is in Debian let me know.",
    "created_at": "2016-12-11T18:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324715",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:27" align="right">comment:27</div>

If we can revert this in the Python package in Debian in time depends on what the maintainer thinks and if he responds quickly.

It would help if the change would break another software that is already in Debian. In that case the bug would have a higher severity (RC bug) and that would force the maintainer to do something or allow us to upload a change. I already rebuilt some packages to see if they are affected (numpy, scipy, etc) but they all seem to be fine. If someone knows software that uses inheritance with cdef classes and is in Debian let me know.



---

archive/issue_comments_324716.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nHere is a more minimal breaking example:\n\n**obj.pyx**:\n\n```\ncdef class OBJ(object):\n    pass\n```\n\nCompile this (within Sage) with\n\n```\n./sage --sh -c \"cython obj.pyx && gcc -Ilocal/include/python2.7 -Wall -shared -fPIC obj.c -o obj.so\"\n```\n\nWith Python 2.7.13rc1, this gives\n\n```\nIn [1]: from obj import OBJ\n\nIn [2]: class X(OBJ, dict):\n   ...:     pass\n   ...: \n\nIn [3]: X()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-a7d4f7b89654> in <module>()\n----> 1 X()\n\nTypeError: obj.OBJ.__new__(X) is not safe, use dict.__new__()\n```",
    "created_at": "2016-12-11T19:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324716",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Here is a more minimal breaking example:

**obj.pyx**:

```
cdef class OBJ(object):
    pass
```

Compile this (within Sage) with

```
./sage --sh -c "cython obj.pyx && gcc -Ilocal/include/python2.7 -Wall -shared -fPIC obj.c -o obj.so"
```

With Python 2.7.13rc1, this gives

```
In [1]: from obj import OBJ

In [2]: class X(OBJ, dict):
   ...:     pass
   ...: 

In [3]: X()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-a7d4f7b89654> in <module>()
----> 1 X()

TypeError: obj.OBJ.__new__(X) is not safe, use dict.__new__()
```



---

archive/issue_comments_324717.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment%3A28):\n> Here is a more minimal breaking example:\n\nHi there,\n\nHere is what I understand:\n\n- When creating a class, Python has to decide which function needs to be called\n  to allocate (`__new__` method) an object. As the C-level, the function is\n  put in a particular field called tp_new of the C-struct corresponding to the\n  class.\n- In case of multiple inheritance, this is only possible if the two classes\n  has a compatible memory layout. In this case, if one of the class has a\n  specific extra C-attribute, its `__new__` must be called (if both classes have\n  extra attributes then they are not layout compatible).\n- Before the change of https://bugs.python.org/issue25731, CPython had a slow\n  way to determine which must be called (see comment at\n  https://hg.python.org/cpython/rev/e7062dd9085e/). When trying to optimize\n  that, they introduced a bug, which Julien investigate with my help. As a\n  consequence the change was reverted.\n- In https://hg.python.org/cpython/rev/a37cc3d926ec, they reintroduced the\n  fast method issuing a warning if the wrong `__new__` is called. As far as I\n  understand, this means that in case of multiple inheritance with Cython\n  code, only the first class can extend the C-struct.\n\nNote that I have to investigate further to be sure of this last point.",
    "created_at": "2016-12-11T22:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324717",
    "user": "https://github.com/hivert"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment%3A28):
> Here is a more minimal breaking example:

Hi there,

Here is what I understand:

- When creating a class, Python has to decide which function needs to be called
  to allocate (`__new__` method) an object. As the C-level, the function is
  put in a particular field called tp_new of the C-struct corresponding to the
  class.
- In case of multiple inheritance, this is only possible if the two classes
  has a compatible memory layout. In this case, if one of the class has a
  specific extra C-attribute, its `__new__` must be called (if both classes have
  extra attributes then they are not layout compatible).
- Before the change of https://bugs.python.org/issue25731, CPython had a slow
  way to determine which must be called (see comment at
  https://hg.python.org/cpython/rev/e7062dd9085e/). When trying to optimize
  that, they introduced a bug, which Julien investigate with my help. As a
  consequence the change was reverted.
- In https://hg.python.org/cpython/rev/a37cc3d926ec, they reintroduced the
  fast method issuing a warning if the wrong `__new__` is called. As far as I
  understand, this means that in case of multiple inheritance with Cython
  code, only the first class can extend the C-struct.

Note that I have to investigate further to be sure of this last point.



---

archive/issue_comments_324718.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@nthiery](#comment%3A25):\n\n> I assume you have tried to do this `xxx.__new__` change in the\n> `UniqueRepresentation` base class, and that did not work, right?\n> Plausibly because which `xxx` shall be used depends from one case to\n> the other. Maybe the `ClassCallMetaclass.__init__` method could\n> handle this upon class creation, figuring out the proper `xxx` to\n> use.\n\nI investigated this a bit further. First I believe we don't override\n`object.__new__` in any of our Cython classes, and in only very few of\nour Python classes:\n\n```\nmistral-/opt/sage/src/sage>grep \"def __new__\" **/*.py*\ncombinat/shard_order.py:    def __new__(cls, p):\ncombinat/words/alphabet.py:    def __new__(self, alphabet=None, name=None):\ncombinat/words/finite_word.py:    def __new__(cls, words):\nmisc/classcall_metaclass.pyx:        def __new__(*args):\nmisc/classcall_metaclass.pyx:            ....:     def __new__(cls):\nmisc/sage_input.py:    def __new__(cls, cmds, expr, locals=None):\nmisc/six.py:        def __new__(cls, name, _, __dict__):\nrings/infinity.py:    def __new__(cls, *args):\nrings/qqbar.py:    def __new__(cls):\nrings/qqbar.py:    def __new__(cls):\nrings/qqbar.py:    def __new__(self, generator, value):\nrings/qqbar.py:    def __new__(self, a, b):\nrings/rational_field.py:    def __new__(cls):\n```\n\nTherefore, resetting `cls.__new__` to be just `object.__new__` for all\nour classes in the `ClassCallMetaclass` should be safe. So I added\njust that at the end of `ClassCallMetaclass.__init__`:\n\n```\n     self.__new__ = object.__new__\n```\n\nThis seems to do the job for e.g. `Unknown` and a couple others.\n\nHowever this does not seem to be quite what we want: it sounds like\n`object.__new__` is \"bound\" to the class object, and I believe that's\nwhat forced Tobias to use e.g. `__new__ = Functor.__new__` in his\npatch. Instead, what we would want to do is the analog of plain\nPython's\n\n```\n    self.__new__ = object.__new__.im_func\n```\n\nto make sure that `self.__new__` is bound to `self` and not to\n`object`. I have tried to play around with what we do in a similar\ncontext in `sage.structure.misc.getattr_from_other_class`, but did not\nquite manage to. Trying to fetch `object.__new__.__get__` with\n`Py_TYPE(attribute).tp_descr_get` returns null.\n\nFlorent, Jeroen, or anyone with good knowledge of the CPython API,\ncould you have a look? At the end of the day, this is all probably\nemulating the proper initialization of the `tp_new` attribute that's\nbeen broken by Python's change. Maybe it's in fact just enough to\nemulate this initialization for the `WithEqualityById` class. Or just\ndefine a trivial `WithEqualityById.__new__`?\n\nFlorent: will you be at LRI tomorrow? If yes, we can have a sprint\ntogether on this.\n\nWhile I am fairly optimistic on having a workaround soon, it still\nwould be good to investigate in parallel getting this fixed / patched\nin Python.\n\nTobias: to answer your question, on my side, I haven't heard of other\nsoft using inheritance from multiple Cython classes.\n\nCheers,\n                        Nicolas",
    "created_at": "2016-12-12T22:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324718",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@nthiery](#comment%3A25):

> I assume you have tried to do this `xxx.__new__` change in the
> `UniqueRepresentation` base class, and that did not work, right?
> Plausibly because which `xxx` shall be used depends from one case to
> the other. Maybe the `ClassCallMetaclass.__init__` method could
> handle this upon class creation, figuring out the proper `xxx` to
> use.

I investigated this a bit further. First I believe we don't override
`object.__new__` in any of our Cython classes, and in only very few of
our Python classes:

```
mistral-/opt/sage/src/sage>grep "def __new__" **/*.py*
combinat/shard_order.py:    def __new__(cls, p):
combinat/words/alphabet.py:    def __new__(self, alphabet=None, name=None):
combinat/words/finite_word.py:    def __new__(cls, words):
misc/classcall_metaclass.pyx:        def __new__(*args):
misc/classcall_metaclass.pyx:            ....:     def __new__(cls):
misc/sage_input.py:    def __new__(cls, cmds, expr, locals=None):
misc/six.py:        def __new__(cls, name, _, __dict__):
rings/infinity.py:    def __new__(cls, *args):
rings/qqbar.py:    def __new__(cls):
rings/qqbar.py:    def __new__(cls):
rings/qqbar.py:    def __new__(self, generator, value):
rings/qqbar.py:    def __new__(self, a, b):
rings/rational_field.py:    def __new__(cls):
```

Therefore, resetting `cls.__new__` to be just `object.__new__` for all
our classes in the `ClassCallMetaclass` should be safe. So I added
just that at the end of `ClassCallMetaclass.__init__`:

```
     self.__new__ = object.__new__
```

This seems to do the job for e.g. `Unknown` and a couple others.

However this does not seem to be quite what we want: it sounds like
`object.__new__` is "bound" to the class object, and I believe that's
what forced Tobias to use e.g. `__new__ = Functor.__new__` in his
patch. Instead, what we would want to do is the analog of plain
Python's

```
    self.__new__ = object.__new__.im_func
```

to make sure that `self.__new__` is bound to `self` and not to
`object`. I have tried to play around with what we do in a similar
context in `sage.structure.misc.getattr_from_other_class`, but did not
quite manage to. Trying to fetch `object.__new__.__get__` with
`Py_TYPE(attribute).tp_descr_get` returns null.

Florent, Jeroen, or anyone with good knowledge of the CPython API,
could you have a look? At the end of the day, this is all probably
emulating the proper initialization of the `tp_new` attribute that's
been broken by Python's change. Maybe it's in fact just enough to
emulate this initialization for the `WithEqualityById` class. Or just
define a trivial `WithEqualityById.__new__`?

Florent: will you be at LRI tomorrow? If yes, we can have a sprint
together on this.

While I am fairly optimistic on having a workaround soon, it still
would be good to investigate in parallel getting this fixed / patched
in Python.

Tobias: to answer your question, on my side, I haven't heard of other
soft using inheritance from multiple Cython classes.

Cheers,
                        Nicolas



---

archive/issue_comments_324719.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@nthiery](#comment%3A30):\n> First I believe we don't override\n> `object.__new__` in any of our Cython classes\n\nNot in the literal sense. However, Cython always implements a custom `tp_new` (which is the C version of `__new__`) for any `cdef class`. So effectively, we are overriding `__new__` in every `cdef class`.\n\n> Therefore, resetting `cls.__new__` to be just `object.__new__` for all\n> our classes in the `ClassCallMetaclass` should be safe.\n\nBecause of the above, I am afraid this is not true.",
    "created_at": "2016-12-13T08:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324719",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@nthiery](#comment%3A30):
> First I believe we don't override
> `object.__new__` in any of our Cython classes

Not in the literal sense. However, Cython always implements a custom `tp_new` (which is the C version of `__new__`) for any `cdef class`. So effectively, we are overriding `__new__` in every `cdef class`.

> Therefore, resetting `cls.__new__` to be just `object.__new__` for all
> our classes in the `ClassCallMetaclass` should be safe.

Because of the above, I am afraid this is not true.



---

archive/issue_comments_324720.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nAs I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.",
    "created_at": "2016-12-13T08:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324720",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

As I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.



---

archive/issue_comments_324721.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nFlorent: for whatever it's worth (not much) I pushed some changes I experimented with using `ClassCallMetaclass.__init__`:\n\nhttps://github.com/sagemath/sagetrac-mirror/commits/u/nthiery/22037/upgrade_to_python_2_7_13_classcall_workaround",
    "created_at": "2016-12-14T22:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324721",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:33" align="right">comment:33</div>

Florent: for whatever it's worth (not much) I pushed some changes I experimented with using `ClassCallMetaclass.__init__`:

https://github.com/sagemath/sagetrac-mirror/commits/u/nthiery/22037/upgrade_to_python_2_7_13_classcall_workaround



---

archive/issue_comments_324722.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment%3A32):\n> As I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.\n\nThat would be the ideal solution indeed!\n\nAm I interpreting it correctly that the hunk causing trouble for us as just been reverted? \n\nhttps://bugs.python.org/issue5322#msg283170\n\nIf yes, does that resolve our issue for the Debian packaging?",
    "created_at": "2016-12-14T22:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324722",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment%3A32):
> As I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.

That would be the ideal solution indeed!

Am I interpreting it correctly that the hunk causing trouble for us as just been reverted? 

https://bugs.python.org/issue5322#msg283170

If yes, does that resolve our issue for the Debian packaging?



---

archive/issue_comments_324723.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nOtherwise, worst comes to worst, we could consider the following tentative workaround: making `WithEqualityById` into a plain Cython class. This should be easy and only result in a speed regression, presumably not critical.\n\nCheers,",
    "created_at": "2016-12-14T22:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324723",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:35" align="right">comment:35</div>

Otherwise, worst comes to worst, we could consider the following tentative workaround: making `WithEqualityById` into a plain Cython class. This should be easy and only result in a speed regression, presumably not critical.

Cheers,



---

archive/issue_comments_324724.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@nthiery](#comment%3A34):\n> Replying to [@jdemeyer](#comment%3A32):\n> > As I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.\n\n> \n> That would be the ideal solution indeed!\n> \n> Am I interpreting it correctly that the hunk causing trouble for us as just been reverted? \n> \n> https://bugs.python.org/issue5322#msg283170\n> \n> If yes, does that resolve our issue for the Debian packaging?\n\nYes it has been reverted upstream. It probably solves the problem. The maintainer of the Python package said he hopes a new Python version will be released this weekend and in this case he will upload it quickly to Debian. If no new Python is released we don't have a statement from him but I hope he would apply a patch to revert the change then.",
    "created_at": "2016-12-14T22:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324724",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@nthiery](#comment%3A34):
> Replying to [@jdemeyer](#comment%3A32):
> > As I mentioned in https://bugs.python.org/issue5322, I think that breaking multiple inheritance of `__new__` is a side-effect of the fix and not a fundamental feature needed to fix that bug. So there might be some hope of fixing https://bugs.python.org/issue5322 without breaking multiple inheritance of `__new__`.

> 
> That would be the ideal solution indeed!
> 
> Am I interpreting it correctly that the hunk causing trouble for us as just been reverted? 
> 
> https://bugs.python.org/issue5322#msg283170
> 
> If yes, does that resolve our issue for the Debian packaging?

Yes it has been reverted upstream. It probably solves the problem. The maintainer of the Python package said he hopes a new Python version will be released this weekend and in this case he will upload it quickly to Debian. If no new Python is released we don't have a statement from him but I hope he would apply a patch to revert the change then.



---

archive/issue_comments_324725.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nNice! Crossing my fingers ...",
    "created_at": "2016-12-14T22:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324725",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:37" align="right">comment:37</div>

Nice! Crossing my fingers ...



---

archive/issue_comments_324726.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nJust for the record: in the meantime, I had made a quick experiment with `WithEqualityById` as plain Python class, and got confused, as I still get the same error as before:\n\n```\n    Unknown = UnknownClass()\n    ...\n    TypeError: sage.structure.sage_object.SageObject.__new__(UnknownClass) is not safe, use object.__new__()\n```\n\nwhereas `UnknowClass` now has only one Cython base class; here is its mro:\n\n```\n(<class 'sage.misc.unknown.UnknownClass'>, <class 'sage.structure.unique_representation.UniqueRepresentation'>, <class 'sage.structure.unique_representation.CachedRepresentation'>, <class 'sage.misc.fast_methods.WithEqualityById'>, <type 'sage.structure.sage_object.SageObject'>, <type 'object'>)\n```",
    "created_at": "2016-12-14T22:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324726",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:38" align="right">comment:38</div>

Just for the record: in the meantime, I had made a quick experiment with `WithEqualityById` as plain Python class, and got confused, as I still get the same error as before:

```
    Unknown = UnknownClass()
    ...
    TypeError: sage.structure.sage_object.SageObject.__new__(UnknownClass) is not safe, use object.__new__()
```

whereas `UnknowClass` now has only one Cython base class; here is its mro:

```
(<class 'sage.misc.unknown.UnknownClass'>, <class 'sage.structure.unique_representation.UniqueRepresentation'>, <class 'sage.structure.unique_representation.CachedRepresentation'>, <class 'sage.misc.fast_methods.WithEqualityById'>, <type 'sage.structure.sage_object.SageObject'>, <type 'object'>)
```



---

archive/issue_comments_324727.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nPython 2.7.13 was released without this change that breaks Sage, and already uploaded to Debian. So this is no longer an issue, unless Python really applies this change in a major version update one day. Thanks everybody for helping on this unexpected last minute obstruction!\n\nBTW, Sage just hit Debian experimental today and we will upload it to unstable probably Wednesday or so. Cross your fingers!",
    "created_at": "2016-12-19T11:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324727",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:39" align="right">comment:39</div>

Python 2.7.13 was released without this change that breaks Sage, and already uploaded to Debian. So this is no longer an issue, unless Python really applies this change in a major version update one day. Thanks everybody for helping on this unexpected last minute obstruction!

BTW, Sage just hit Debian experimental today and we will upload it to unstable probably Wednesday or so. Cross your fingers!



---

archive/issue_comments_324728.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI'd like to point people following this ticket to [this thread](https://groups.google.com/forum/#!topic/sage-devel/jdLfIKQ1M18) which explains that the present ticket has some urgency. I attempted a workaround in #22089 and failed miserably.\n\nCould you let us know what remains to be done to have this ticket completed ?",
    "created_at": "2017-01-03T22:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324728",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:40" align="right">comment:40</div>

I'd like to point people following this ticket to [this thread](https://groups.google.com/forum/#!topic/sage-devel/jdLfIKQ1M18) which explains that the present ticket has some urgency. I attempted a workaround in #22089 and failed miserably.

Could you let us know what remains to be done to have this ticket completed ?



---

archive/issue_comments_324729.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@EmmanuelCharpentier](#comment%3A40):\n> Could you let us know what remains to be done to have this ticket completed ?\n\nNothing special, just do the upgrade.",
    "created_at": "2017-01-04T08:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324729",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@EmmanuelCharpentier](#comment%3A40):
> Could you let us know what remains to be done to have this ticket completed ?

Nothing special, just do the upgrade.



---

archive/issue_comments_324730.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOK, I'll work on this.",
    "created_at": "2017-01-04T11:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324730",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

OK, I'll work on this.



---

archive/issue_comments_324731.json:
```json
{
    "body": "Changed dependencies from **#19735** to none",
    "created_at": "2017-01-04T11:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324731",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19735** to none



---

archive/issue_comments_324732.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-01-04T11:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324732",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_324733.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,3 @@\n-Python 2.7.13rc1 leads to problems with sage related to `__new__`. It is likely related to this change that was included in Python:\n-https://bugs.python.org/issue5322\n-\n-See the following discussion on sage-devel:\n-https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E\n-\n-See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.\n-\n-**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13rc1.tgz\n+**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgz\n \n Note: upgrade to Python 2.7.12 done in #19735.\n``````\n",
    "created_at": "2017-01-04T11:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324733",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,3 @@
-Python 2.7.13rc1 leads to problems with sage related to `__new__`. It is likely related to this change that was included in Python:
-https://bugs.python.org/issue5322
-
-See the following discussion on sage-devel:
-https://groups.google.com/forum/#!topic/sage-devel/IbugChsM26E
-
-See also https://bugs.python.org/issue25731, where a patch at the same location was reverted as backward incompatible after causing a failure in Sage.
-
-**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13rc1.tgz
+**Tarball**: https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgz
 
 Note: upgrade to Python 2.7.12 done in #19735.
``````




---

archive/issue_comments_324734.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9\"><code>5aeaf5c</code></a></td><td><code>Upgrade to Python 2.7.13</code></td></tr></table>\n",
    "created_at": "2017-01-04T11:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324734",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9"><code>5aeaf5c</code></a></td><td><code>Upgrade to Python 2.7.13</code></td></tr></table>




---

archive/issue_comments_324735.json:
```json
{
    "body": "Changed commit from **[`ba486e1`](https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d)** to **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**",
    "created_at": "2017-01-04T11:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ba486e1`](https://github.com/sagemath/sagetrac-mirror/commit/ba486e12515ad417e2aa747dc5e525e0bedd3d4d)** to **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**



---

archive/issue_comments_324736.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nAh, I think Florent was telling me about this a couple weeks ago.  Wish I had been CC'd on this--I've spent a lot of time in Python's class initialization code and probably could have helped.  Let me know if I can still help on this.\n\n(Ah, I see now the issue was fixed upstream too--funny that Armin raised this issue back in 2009 and *now* it gets fixed :)",
    "created_at": "2017-01-04T13:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324736",
    "user": "https://github.com/embray"
}
```

<div id="comment:44" align="right">comment:44</div>

Ah, I think Florent was telling me about this a couple weeks ago.  Wish I had been CC'd on this--I've spent a lot of time in Python's class initialization code and probably could have helped.  Let me know if I can still help on this.

(Ah, I see now the issue was fixed upstream too--funny that Armin raised this issue back in 2009 and *now* it gets fixed :)



---

archive/issue_comments_324737.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nMy first impression is that this new version of Python is significantly slower than 2.7.12: I'm seeing several doctest timeouts on a system where I usually don't get any. Granted, my system is loaded from doing things so it might be a false positive. Need to check...",
    "created_at": "2017-01-04T13:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324737",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

My first impression is that this new version of Python is significantly slower than 2.7.12: I'm seeing several doctest timeouts on a system where I usually don't get any. Granted, my system is loaded from doing things so it might be a false positive. Need to check...



---

archive/issue_comments_324738.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@embray](#comment%3A44):\n> Ah, I think Florent was telling me about this a couple weeks ago.  Wish I had been CC'd on this--I've spent a lot of time in Python's class initialization code and probably could have helped.  Let me know if I can still help on this.\n\nThe main question remains: did they break `tp_new` on other Python versions? The patch got reverted for 2.7.13 but it's not clear whether or not it was applied to some 3.y.x version.",
    "created_at": "2017-01-04T13:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324738",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@embray](#comment%3A44):
> Ah, I think Florent was telling me about this a couple weeks ago.  Wish I had been CC'd on this--I've spent a lot of time in Python's class initialization code and probably could have helped.  Let me know if I can still help on this.

The main question remains: did they break `tp_new` on other Python versions? The patch got reverted for 2.7.13 but it's not clear whether or not it was applied to some 3.y.x version.



---

archive/issue_comments_324739.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nIt worries me that nothing in the Python docs nor in any PEP describes how `tp_new` is inherited. In my opinion, https://bugs.python.org/issue5322 makes a significant change which should be subject to a PEP. However, neither the old nor new behaviour is described anywhere. This makes it harder to argue which behaviour is correct.",
    "created_at": "2017-01-04T14:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324739",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

It worries me that nothing in the Python docs nor in any PEP describes how `tp_new` is inherited. In my opinion, https://bugs.python.org/issue5322 makes a significant change which should be subject to a PEP. However, neither the old nor new behaviour is described anywhere. This makes it harder to argue which behaviour is correct.



---

archive/issue_comments_324740.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nPart of the problem is that `tp_new` is a detail of the CPython API, and while there are PEPs that deal with CPython there aren't many (not enough IMO given that it *is* the reference implementation).  Point being though, this code is very particular to the C API and doesn't particularly impact how Python should work from a pure language design perspective.  But I agree, this should be better documented.\n\nMy guess is just that in the wild there aren't that many hand-written C types outside of Numpy and ones generated by Cython.  And it's even less common for them to be used in a multiple inheritance scenario.  But just because it isn't common doesn't mean it should be broken or undocumented, so I completely agree.  After all this problem was pointed out in 2009 so it's not exactly unheard of.",
    "created_at": "2017-01-04T14:13:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324740",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

Part of the problem is that `tp_new` is a detail of the CPython API, and while there are PEPs that deal with CPython there aren't many (not enough IMO given that it *is* the reference implementation).  Point being though, this code is very particular to the C API and doesn't particularly impact how Python should work from a pure language design perspective.  But I agree, this should be better documented.

My guess is just that in the wild there aren't that many hand-written C types outside of Numpy and ones generated by Cython.  And it's even less common for them to be used in a multiple inheritance scenario.  But just because it isn't common doesn't mean it should be broken or undocumented, so I completely agree.  After all this problem was pointed out in 2009 so it's not exactly unheard of.



---

archive/issue_comments_324741.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nFWIW the most relevant PEP to this https://www.python.org/dev/peps/pep-0253/, but I haven't read it in a long time so I forget whether or not it addresses this specific issue, especially given:\n\n> The PEP no longer accurately describes the implementation.",
    "created_at": "2017-01-04T14:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324741",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

FWIW the most relevant PEP to this https://www.python.org/dev/peps/pep-0253/, but I haven't read it in a long time so I forget whether or not it addresses this specific issue, especially given:

> The PEP no longer accurately describes the implementation.



---

archive/issue_comments_324742.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nYes, I found that PEP when the discussion about https://bugs.python.org/issue5322 started but it doesn't answer that specific question.",
    "created_at": "2017-01-04T14:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324742",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Yes, I found that PEP when the discussion about https://bugs.python.org/issue5322 started but it doesn't answer that specific question.



---

archive/issue_comments_324743.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nAh, okay.  Not surprising--it also says in the PEP:\n\n> While the details of initializing a PyTypeObject structure haven't\n> been documented as such, they are easily gleaned from the examples\n> in the source code, and I am assuming that the reader is\n> sufficiently familiar with the traditional way of creating new\n> Python types in C.\n\nIn fairness, those details predate the PEP process in the first place so it's not surprising that there's no PEP for it.  But it would be nice to have something better documented in the C-API docs.  It *should* be part of the API.",
    "created_at": "2017-01-04T14:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324743",
    "user": "https://github.com/embray"
}
```

<div id="comment:51" align="right">comment:51</div>

Ah, okay.  Not surprising--it also says in the PEP:

> While the details of initializing a PyTypeObject structure haven't
> been documented as such, they are easily gleaned from the examples
> in the source code, and I am assuming that the reader is
> sufficiently familiar with the traditional way of creating new
> Python types in C.

In fairness, those details predate the PEP process in the first place so it's not surprising that there's no PEP for it.  But it would be nice to have something better documented in the C-API docs.  It *should* be part of the API.



---

archive/issue_events_305895.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-04T15:49:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305895"
}
```



---

archive/issue_comments_324744.json:
```json
{
    "body": "First attempt at installing Python 2.7.13",
    "created_at": "2017-01-04T18:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324744",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

First attempt at installing Python 2.7.13



---

archive/issue_comments_324745.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAttachment: **[python2-2.7.13.p0.log.gz](https://github.com/sagemath/sage/files/ticket22037/python2-2.7.13.p0.log.gz)**\n\nNo good, alas... After merging the relevant branch in my current branch (containing R 3.3.2 and the necessary helper packages for xz and pcre), I tried `time ./sage -i -c python2`. This took a long time, mostly spent on waiting on failing tests :\n\n```\nreal\t48m11,852s\nuser\t6m46,312s\nsys\t1m12,012s\n```\n\nAt the end of the log file (see attached file), I get :\n\n```\n353 tests OK.\n6 tests failed:\n    test_gdb test_site test_ssl test_sysconfig test_urllib2\n    test_urllib2_localnet\n1 test altered the execution environment:\n    test_import\n41 tests skipped:\n    test_aepack test_al test_applesingle test_bsddb test_bsddb185\n    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk\n    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses\n    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile\n    test_kqueue test_linuxaudiodev test_macos test_macostools\n    test_msilib test_ossaudiodev test_pep277 test_scriptpackages\n    test_smtpnet test_socketserver test_startfile test_sunaudiodev\n    test_timeout test_tk test_ttk_guionly test_unicode_file\n    test_urllib2net test_urllibnet test_winreg test_winsound\n    test_zipfile64\n4 skips unexpected on linux2:\n    test_bsddb test_bsddb3 test_dbm test_gdbm\nMakefile:877: recipe for target 'test' failed\n```\n\nCuriously, notwhithstanding the reported problems on the ssl module, pip seems to be able to function somehow :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -pip search tralala\nYou are using pip version 8.1.2, however version 9.0.1 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\ncharpent@asus16-ec:/usr/local/sage-7$ sage -pip search terminado\nterminado (0.6)  - Terminals served to term.js using Tornado websockets\n  INSTALLED: 0.6 (latest)\nYou are using pip version 8.1.2, however version 9.0.1 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\n```\n\n(and I get pip advertisements again, source of pseudo-failures in tests...)\n\nI doubt that it is worth `make ptestlong` (which monopolizes my machine for a long nice hour, nowadays...).\n\nI do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.\n\nI'll keep my branch in this tate for a while to see what may crop up.\n\nHTH,",
    "created_at": "2017-01-04T18:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324745",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:53" align="right">comment:53</div>

Attachment: **[python2-2.7.13.p0.log.gz](https://github.com/sagemath/sage/files/ticket22037/python2-2.7.13.p0.log.gz)**

No good, alas... After merging the relevant branch in my current branch (containing R 3.3.2 and the necessary helper packages for xz and pcre), I tried `time ./sage -i -c python2`. This took a long time, mostly spent on waiting on failing tests :

```
real	48m11,852s
user	6m46,312s
sys	1m12,012s
```

At the end of the log file (see attached file), I get :

```
353 tests OK.
6 tests failed:
    test_gdb test_site test_ssl test_sysconfig test_urllib2
    test_urllib2_localnet
1 test altered the execution environment:
    test_import
41 tests skipped:
    test_aepack test_al test_applesingle test_bsddb test_bsddb185
    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk
    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses
    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile
    test_kqueue test_linuxaudiodev test_macos test_macostools
    test_msilib test_ossaudiodev test_pep277 test_scriptpackages
    test_smtpnet test_socketserver test_startfile test_sunaudiodev
    test_timeout test_tk test_ttk_guionly test_unicode_file
    test_urllib2net test_urllibnet test_winreg test_winsound
    test_zipfile64
4 skips unexpected on linux2:
    test_bsddb test_bsddb3 test_dbm test_gdbm
Makefile:877: recipe for target 'test' failed
```

Curiously, notwhithstanding the reported problems on the ssl module, pip seems to be able to function somehow :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -pip search tralala
You are using pip version 8.1.2, however version 9.0.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
charpent@asus16-ec:/usr/local/sage-7$ sage -pip search terminado
terminado (0.6)  - Terminals served to term.js using Tornado websockets
  INSTALLED: 0.6 (latest)
You are using pip version 8.1.2, however version 9.0.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
```

(and I get pip advertisements again, source of pseudo-failures in tests...)

I doubt that it is worth `make ptestlong` (which monopolizes my machine for a long nice hour, nowadays...).

I do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.

I'll keep my branch in this tate for a while to see what may crop up.

HTH,



---

archive/issue_comments_324746.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@EmmanuelCharpentier](#comment%3A53):\n> I do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.\n\nPlease elaborate. Does this ticket break anything?",
    "created_at": "2017-01-04T19:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324746",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@EmmanuelCharpentier](#comment%3A53):
> I do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.

Please elaborate. Does this ticket break anything?



---

archive/issue_comments_324747.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@jdemeyer](#comment%3A54):\n> Replying to [@EmmanuelCharpentier](#comment%3A53):\n> > I do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.\n\n> \n> Please elaborate. Does this ticket break anything?\n\nA cursory, extremely superficial, test(a couple lines in Sage, a bit more in IPython + sympy) didn't show major immediate problems shuch as a crash. But the six bailed test units make me wary.\n\nI just launched `make ptestlong` and I see sage recompiling python2 and brial. Answer in a couple of hours...",
    "created_at": "2017-01-04T19:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324747",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@jdemeyer](#comment%3A54):
> Replying to [@EmmanuelCharpentier](#comment%3A53):
> > I do not know enough about the specifics of Python in Sage to fel justified in positioning ths ticket as `needs_wokj`, but I'm sorely tempted.

> 
> Please elaborate. Does this ticket break anything?

A cursory, extremely superficial, test(a couple lines in Sage, a bit more in IPython + sympy) didn't show major immediate problems shuch as a crash. But the six bailed test units make me wary.

I just launched `make ptestlong` and I see sage recompiling python2 and brial. Answer in a couple of hours...



---

archive/issue_comments_324748.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nAt some times in the past, the `python2` package has not passed its test suite. Does the current version pass? That is, are you seeing a regression or the status quo?",
    "created_at": "2017-01-04T20:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324748",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">comment:56</div>

At some times in the past, the `python2` package has not passed its test suite. Does the current version pass? That is, are you seeing a regression or the status quo?



---

archive/issue_comments_324749.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nIt might be a regression, but I'm not sure :\n\n`make ptestlong` is currently stalled, with a suspicious number of defunct (zombie) subprocesses. From `ps axf`, I get (extract) :\n\n```\n26497 ?        Ssl    1:03  \\_ /usr/lib/gnome-terminal/gnome-terminal-server\n14353 pts/3    Ss     0:00  |   \\_ bash\n20219 pts/3    S+     0:00  |   |   \\_ make ptestlong\n 3447 pts/3    S+     0:34  |   |       \\_ python /usr/local/sage-7/src/bin/sage-runtests -p --all --long --logfile=logs/ptestlong.log\n 3486 pts/3    S+     0:01  |   |           \\_ python /usr/local/sage-7/src/bin/sage-cleaner\n15843 pts/3    S      0:01  |   |           \\_ python /usr/local/sage-7/src/bin/sage-runtests -p --all --long --logfile=logs/ptestlong.log\n15844 pts/0    Ssl+   0:06  |   |               \\_ /usr/local/sage-7/local/bin/giac --sage\n15845 pts/3    Z      0:00  |   |               \\_ [python] <defunct>\n16021 ?        Zs     0:00  |   |               \\_ [giac] <defunct>\n16022 pts/3    Z      0:00  |   |               \\_ [python] <defunct>\n16032 pts/3    Z      0:00  |   |               \\_ [python] <defunct>\n16033 ?        Zs     0:00  |   |               \\_ [giac] <defunct>\n16034 pts/3    Z      0:00  |   |               \\_ [python] <defunct>\n16043 pts/3    Z      0:00  |   |               \\_ [python] <defunct>\n17896 pts/4    Ss     0:00  |   \\_ bash\n25263 pts/4    R+     0:00  |       \\_ ps axf\n```\n\nI'll let it go for a while, and kill it, say, tomorrow morning (it's about 22:05 locally).\n\nBut this smells. A look at the log (from another terminal) gives me some known bugs, and some new :\n\n```\nFile \"src/sage/rings/polynomial/multi_polynomial_ideal.py\", line 3532, in sage.r\nings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis\nFailed example:\n    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage\nExpected:\n    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\nGot:\n    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]\n```\n\nThis one is already known.\n\n```\nFile \"src/sage/homology/simplicial_complex.py\", line 2812, in sage.homology.simp\nlicial_complex.SimplicialComplex.is_cohen_macaulay\nFailed example:\n    X.is_cohen_macaulay(ZZ)\nExpected:\n    False\nGot:\n    [Errno 2] No such file or directory: '/home/charpent/.sage/temp/asus16-ec/17311/dir_ZhULbV/17421.out'\n    False\n```\n\nMight be a race condition : from yet another terminal :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/homology/simplicial_complex.py\nRunning doctests with ID 2017-01-04-22-08-34-3e41af20.\nGit branch: testR\nUsing --optional=database_gap,giacpy_sage,mpir,python2,sage,xz\nDoctesting 1 file.\nsage -t --long --warn-long 109.9 src/sage/homology/simplicial_complex.py\n    [588 tests, 3.25 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 3.4 seconds\n    cpu time: 3.0 seconds\n    cumulative wall time: 3.3 seconds\n```\n\n```\nsage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py\n    Bad exit: 2\n**********************************************************************\nTests run before process (pid=17761) failed:\nsage: T = CartanType(['A', 4]) ## line 18 ##\nsage: T ## line 19 ##\n['A', 4]\nsage: DynkinDiagram(T) ## line 24 ##\nO---O---O---O\n1   2   3   4   \nA4\nsage: DynkinDiagram(['A',4]) ## line 33 ##\nO---O---O---O\n1   2   3   4   \nA4\nsage: DynkinDiagram('A4') ## line 37 ##\nO---O---O---O\n1   2   3   4   \nA4\nsage: T.dynkin_diagram() ## line 41 ##\nO---O---O---O\n1   2   3   4   \nA4\nsage: RootSystem(T) ## line 52 ##\nRoot system of type ['A', 4]\nsage: W = WeylGroup(T) ## line 57 ##\n```\n\nThis one is new to me. But again, it might be a race condition :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py\nRunning doctests with ID 2017-01-04-22-10-59-8ee52f1c.\nGit branch: testR\nUsing --optional=database_gap,giacpy_sage,mpir,python2,sage,xz\nDoctesting 1 file.\nsage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py\n    [446 tests, 1.36 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.5 seconds\n    cpu time: 1.1 seconds\n    cumulative wall time: 1.4 seconds\n```\n\nAnd that's all for now. But `make ptestlong` is still stalled at :\n\n```\nsage -t --long --warn-long 109.9 local/lib/python2.7/site-packages/sagenb/testing/selenium/__init__.py\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 109.9 src/sage/interfaces/giac.py\n```\n\nIf you feel it useful, I'll attach the resulting ptestlong.log after tomorrow's `kill`.",
    "created_at": "2017-01-04T21:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324749",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:57" align="right">comment:57</div>

It might be a regression, but I'm not sure :

`make ptestlong` is currently stalled, with a suspicious number of defunct (zombie) subprocesses. From `ps axf`, I get (extract) :

```
26497 ?        Ssl    1:03  \_ /usr/lib/gnome-terminal/gnome-terminal-server
14353 pts/3    Ss     0:00  |   \_ bash
20219 pts/3    S+     0:00  |   |   \_ make ptestlong
 3447 pts/3    S+     0:34  |   |       \_ python /usr/local/sage-7/src/bin/sage-runtests -p --all --long --logfile=logs/ptestlong.log
 3486 pts/3    S+     0:01  |   |           \_ python /usr/local/sage-7/src/bin/sage-cleaner
15843 pts/3    S      0:01  |   |           \_ python /usr/local/sage-7/src/bin/sage-runtests -p --all --long --logfile=logs/ptestlong.log
15844 pts/0    Ssl+   0:06  |   |               \_ /usr/local/sage-7/local/bin/giac --sage
15845 pts/3    Z      0:00  |   |               \_ [python] <defunct>
16021 ?        Zs     0:00  |   |               \_ [giac] <defunct>
16022 pts/3    Z      0:00  |   |               \_ [python] <defunct>
16032 pts/3    Z      0:00  |   |               \_ [python] <defunct>
16033 ?        Zs     0:00  |   |               \_ [giac] <defunct>
16034 pts/3    Z      0:00  |   |               \_ [python] <defunct>
16043 pts/3    Z      0:00  |   |               \_ [python] <defunct>
17896 pts/4    Ss     0:00  |   \_ bash
25263 pts/4    R+     0:00  |       \_ ps axf
```

I'll let it go for a while, and kill it, say, tomorrow morning (it's about 22:05 locally).

But this smells. A look at the log (from another terminal) gives me some known bugs, and some new :

```
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 3532, in sage.r
ings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
Failed example:
    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage
Expected:
    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
Got:
    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]
```

This one is already known.

```
File "src/sage/homology/simplicial_complex.py", line 2812, in sage.homology.simp
licial_complex.SimplicialComplex.is_cohen_macaulay
Failed example:
    X.is_cohen_macaulay(ZZ)
Expected:
    False
Got:
    [Errno 2] No such file or directory: '/home/charpent/.sage/temp/asus16-ec/17311/dir_ZhULbV/17421.out'
    False
```

Might be a race condition : from yet another terminal :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/homology/simplicial_complex.py
Running doctests with ID 2017-01-04-22-08-34-3e41af20.
Git branch: testR
Using --optional=database_gap,giacpy_sage,mpir,python2,sage,xz
Doctesting 1 file.
sage -t --long --warn-long 109.9 src/sage/homology/simplicial_complex.py
    [588 tests, 3.25 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 3.4 seconds
    cpu time: 3.0 seconds
    cumulative wall time: 3.3 seconds
```

```
sage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py
    Bad exit: 2
**********************************************************************
Tests run before process (pid=17761) failed:
sage: T = CartanType(['A', 4]) ## line 18 ##
sage: T ## line 19 ##
['A', 4]
sage: DynkinDiagram(T) ## line 24 ##
O---O---O---O
1   2   3   4   
A4
sage: DynkinDiagram(['A',4]) ## line 33 ##
O---O---O---O
1   2   3   4   
A4
sage: DynkinDiagram('A4') ## line 37 ##
O---O---O---O
1   2   3   4   
A4
sage: T.dynkin_diagram() ## line 41 ##
O---O---O---O
1   2   3   4   
A4
sage: RootSystem(T) ## line 52 ##
Root system of type ['A', 4]
sage: W = WeylGroup(T) ## line 57 ##
```

This one is new to me. But again, it might be a race condition :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py
Running doctests with ID 2017-01-04-22-10-59-8ee52f1c.
Git branch: testR
Using --optional=database_gap,giacpy_sage,mpir,python2,sage,xz
Doctesting 1 file.
sage -t --long --warn-long 109.9 src/sage/combinat/root_system/cartan_type.py
    [446 tests, 1.36 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.5 seconds
    cpu time: 1.1 seconds
    cumulative wall time: 1.4 seconds
```

And that's all for now. But `make ptestlong` is still stalled at :

```
sage -t --long --warn-long 109.9 local/lib/python2.7/site-packages/sagenb/testing/selenium/__init__.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 109.9 src/sage/interfaces/giac.py
```

If you feel it useful, I'll attach the resulting ptestlong.log after tomorrow's `kill`.



---

archive/issue_comments_324750.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@jhpalmieri](#comment%3A56):\n> At some times in the past, the `python2` package has not passed its test suite. Does the current version pass?\n\nNo. Six test units failed (see above) .\n\n> That is, are you seeing a regression or the status quo?\n\nI don't know if these test units used to pass before...\n\nHTH,",
    "created_at": "2017-01-04T21:23:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324750",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@jhpalmieri](#comment%3A56):
> At some times in the past, the `python2` package has not passed its test suite. Does the current version pass?

No. Six test units failed (see above) .

> That is, are you seeing a regression or the status quo?

I don't know if these test units used to pass before...

HTH,



---

archive/issue_comments_324751.json:
```json
{
    "body": "Attachment: **[ptestlong.log.gz](https://github.com/sagemath/sage/files/ticket22037/ptestlong.log.gz)**\n\nresult of make ptestlong, first attempt on 2.7.13",
    "created_at": "2017-01-04T21:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324751",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Attachment: **[ptestlong.log.gz](https://github.com/sagemath/sage/files/ticket22037/ptestlong.log.gz)**

result of make ptestlong, first attempt on 2.7.13



---

archive/issue_comments_324752.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nNew data point : after about 1 hour, the test of `giac` inteface timed out, liberating the whole thing (the zombie processes disappeared).\n\nThe resulting `ptestlong.log` has been attached, just in case...\n\nInterestingly, this may be a race condition : the very same test passes standalone in about 1.33 seconds :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/interfaces/giac.py\nRunning doctests with ID 2017-01-04-22-51-02-b275d916.\nGit branch: testR\nUsing --optional=database_gap,giacpy_sage,mpir,python2,sage,xz\nDoctesting 1 file.\nsage -t --long --warn-long 109.9 src/sage/interfaces/giac.py\n    [157 tests, 1.33 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 6.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 1.3 seconds\n```\n\nSo we have two, possibly three problems :\n* failed test units in Python's own test suite ;\n* transient errors (race conditions) in `ptestlong` ;\n* an unfixed known \"error\" (not mathematically an error, bit, asufar as I understand, a different expression of the same result).\n\nAdvice ?",
    "created_at": "2017-01-04T21:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324752",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:59" align="right">comment:59</div>

New data point : after about 1 hour, the test of `giac` inteface timed out, liberating the whole thing (the zombie processes disappeared).

The resulting `ptestlong.log` has been attached, just in case...

Interestingly, this may be a race condition : the very same test passes standalone in about 1.33 seconds :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.9 src/sage/interfaces/giac.py
Running doctests with ID 2017-01-04-22-51-02-b275d916.
Git branch: testR
Using --optional=database_gap,giacpy_sage,mpir,python2,sage,xz
Doctesting 1 file.
sage -t --long --warn-long 109.9 src/sage/interfaces/giac.py
    [157 tests, 1.33 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 1.3 seconds
```

So we have two, possibly three problems :
* failed test units in Python's own test suite ;
* transient errors (race conditions) in `ptestlong` ;
* an unfixed known "error" (not mathematically an error, bit, asufar as I understand, a different expression of the same result).

Advice ?



---

archive/issue_comments_324753.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@EmmanuelCharpentier](#comment%3A58):\n> Replying to [@jhpalmieri](#comment%3A56):\n> > At some times in the past, the `python2` package has not passed its test suite. Does the current version pass?\n\n> \n> No. Six test units failed (see above) .\n\nI meant, do the unit tests pass for 2.7.10 (= the current version)?",
    "created_at": "2017-01-04T23:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324753",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@EmmanuelCharpentier](#comment%3A58):
> Replying to [@jhpalmieri](#comment%3A56):
> > At some times in the past, the `python2` package has not passed its test suite. Does the current version pass?

> 
> No. Six test units failed (see above) .

I meant, do the unit tests pass for 2.7.10 (= the current version)?



---

archive/issue_comments_324754.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@jhpalmieri](#comment%3A60):\n\n[ Snip...]\n> I meant, do the unit tests pass for 2.7.10 (= the current version)?\n\nCurrent is 2.7.12 (since 7.5rc0).\n\n```\n354 tests OK.\n5 tests failed:\n    test_gdb test_site test_sysconfig test_urllib2\n    test_urllib2_localnet\n42 tests skipped:\n    test_aepack test_al test_applesingle test_bsddb test_bsddb185\n    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk\n    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses\n    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile\n    test_kqueue test_linuxaudiodev test_macos test_macostools\n    test_msilib test_ossaudiodev test_pep277 test_scriptpackages\n    test_smtpnet test_socketserver test_ssl test_startfile\n    test_sunaudiodev test_timeout test_tk test_ttk_guionly\n    test_unicode_file test_urllib2net test_urllibnet test_winreg\n    test_winsound test_zipfile64\n5 skips unexpected on linux2:\n    test_bsddb test_bsddb3 test_dbm test_gdbm test_ssl\n```\n\nSo there is more lossage (`test_ssl` passed in 2.7.12).",
    "created_at": "2017-01-05T01:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324754",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@jhpalmieri](#comment%3A60):

[ Snip...]
> I meant, do the unit tests pass for 2.7.10 (= the current version)?

Current is 2.7.12 (since 7.5rc0).

```
354 tests OK.
5 tests failed:
    test_gdb test_site test_sysconfig test_urllib2
    test_urllib2_localnet
42 tests skipped:
    test_aepack test_al test_applesingle test_bsddb test_bsddb185
    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk
    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses
    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile
    test_kqueue test_linuxaudiodev test_macos test_macostools
    test_msilib test_ossaudiodev test_pep277 test_scriptpackages
    test_smtpnet test_socketserver test_ssl test_startfile
    test_sunaudiodev test_timeout test_tk test_ttk_guionly
    test_unicode_file test_urllib2net test_urllibnet test_winreg
    test_winsound test_zipfile64
5 skips unexpected on linux2:
    test_bsddb test_bsddb3 test_dbm test_gdbm test_ssl
```

So there is more lossage (`test_ssl` passed in 2.7.12).



---

archive/issue_comments_324755.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@EmmanuelCharpentier](#comment%3A61):\n\nGoing back to 7.5beta6 (which had 2.7.10, I get :\n\n```\n4 tests failed:\n    test_gdb test_site test_sysconfig test_urllib2_localnet\n42 tests skipped:\n    test_aepack test_al test_applesingle test_bsddb test_bsddb185\n    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk\n    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses\n    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile\n    test_kqueue test_linuxaudiodev test_macos test_macostools\n    test_msilib test_ossaudiodev test_pep277 test_scriptpackages\n    test_smtpnet test_socketserver test_ssl test_startfile\n    test_sunaudiodev test_timeout test_tk test_ttk_guionly\n    test_unicode_file test_urllib2net test_urllibnet test_winreg\n    test_winsound test_zipfile64\n5 skips unexpected on linux2:\n    test_bsddb test_bsddb3 test_dbm test_gdbm test_ssl\n```\n\nSo test_urllib2 was lost between 2.7.10 and 2.7.12. And, BTW, test_ssl didn't pass in 2.7.12 : it was marked as unexpected.\n\nHTH,",
    "created_at": "2017-01-05T02:19:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324755",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@EmmanuelCharpentier](#comment%3A61):

Going back to 7.5beta6 (which had 2.7.10, I get :

```
4 tests failed:
    test_gdb test_site test_sysconfig test_urllib2_localnet
42 tests skipped:
    test_aepack test_al test_applesingle test_bsddb test_bsddb185
    test_bsddb3 test_cd test_cl test_codecmaps_cn test_codecmaps_hk
    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses
    test_dbm test_dl test_gdbm test_gl test_imageop test_imgfile
    test_kqueue test_linuxaudiodev test_macos test_macostools
    test_msilib test_ossaudiodev test_pep277 test_scriptpackages
    test_smtpnet test_socketserver test_ssl test_startfile
    test_sunaudiodev test_timeout test_tk test_ttk_guionly
    test_unicode_file test_urllib2net test_urllibnet test_winreg
    test_winsound test_zipfile64
5 skips unexpected on linux2:
    test_bsddb test_bsddb3 test_dbm test_gdbm test_ssl
```

So test_urllib2 was lost between 2.7.10 and 2.7.12. And, BTW, test_ssl didn't pass in 2.7.12 : it was marked as unexpected.

HTH,



---

archive/issue_comments_324756.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nThere is some significant speed regression going from 2.7.12 to 2.7.13.\n\nI doctested the directory `src/sage/manifolds` 3 times with each Python version on an otherwise idle system.\n\nWith 2.7.12, I got\n\n```\nmanifolds-2.7.12.log:Total time for all tests: 619.3 seconds\nmanifolds-2.7.12.log:Total time for all tests: 625.6 seconds\nmanifolds-2.7.12.log:Total time for all tests: 616.8 seconds\n```\nWith 2.7.13:\n\n```\nmanifolds-2.7.13.log:Total time for all tests: 645.1 seconds\nmanifolds-2.7.13.log:Total time for all tests: 640.7 seconds\nmanifolds-2.7.13.log:Total time for all tests: 646.0 seconds\n```\n\nI don't know what to think of this...",
    "created_at": "2017-01-05T07:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324756",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

There is some significant speed regression going from 2.7.12 to 2.7.13.

I doctested the directory `src/sage/manifolds` 3 times with each Python version on an otherwise idle system.

With 2.7.12, I got

```
manifolds-2.7.12.log:Total time for all tests: 619.3 seconds
manifolds-2.7.12.log:Total time for all tests: 625.6 seconds
manifolds-2.7.12.log:Total time for all tests: 616.8 seconds
```
With 2.7.13:

```
manifolds-2.7.13.log:Total time for all tests: 645.1 seconds
manifolds-2.7.13.log:Total time for all tests: 640.7 seconds
manifolds-2.7.13.log:Total time for all tests: 646.0 seconds
```

I don't know what to think of this...



---

archive/issue_events_305896.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-07T11:46:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305896"
}
```



---

archive/issue_events_305897.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-07T11:46:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305897"
}
```



---

archive/issue_comments_324757.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nBlocker because of #22147.",
    "created_at": "2017-01-07T11:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324757",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Blocker because of #22147.



---

archive/issue_events_305898.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-07T14:30:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305898"
}
```



---

archive/issue_events_305899.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-07T14:30:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305899"
}
```



---

archive/issue_comments_324758.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2017-01-07T14:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324758",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_324759.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nSince we need this to compile on OSX...\n\nremaining issues should be moved to separate tickets.",
    "created_at": "2017-01-07T14:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324759",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:65" align="right">comment:65</div>

Since we need this to compile on OSX...

remaining issues should be moved to separate tickets.



---

archive/issue_comments_324760.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/upgrade_to_python_2_7_13)** to **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**",
    "created_at": "2017-01-08T00:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22037#issuecomment-324760",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/upgrade_to_python_2_7_13](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/upgrade_to_python_2_7_13)** to **[`5aeaf5c`](https://github.com/sagemath/sagetrac-mirror/commit/5aeaf5c9f396c297dbd1c1c9b60d0bf5a972e0c9)**



---

archive/issue_events_305900.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-08T00:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305900"
}
```



---

archive/issue_events_305901.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "71f185562aa5659555f0a8ee554da6be74018443",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-08T00:54:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22037",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22037#event-305901"
}
```
