# Issue 22116: installation of gap_packages fails with bash 4.4

archive/issues_021879.json:
```json
{
    "assignees": [],
    "body": "The symptom is the error at the line `cd leon make` coming from a `Makefile` in `guava` package.\n\n```\nmake[3]: Entering directory '/home/dima/Sage/sage-dev/local/gap/gap-4.8.3/pkg/guava-3.13/src'\ngcc  -O2 -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib  -o leonconv leonconv.c\ncd leon make\n/bin/sh: line 0: cd: too many arguments\nmake[3]: *** [Makefile:14: all] Error 1\n```\n\nThis happens when `/bin/sh` is bash 4.4.5(1). New bash versions like this one do not silently ignore extra arguments to `cd` (even though it is documented as ignored). So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.\n\nGuava readme on its [homepage](https://github.com/osj1961/guava) lists Leon's programs as a part, so they should be built, in fact.\n\nSee also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).\n\nBranch/Commit: **[u/fbissey/leon](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/leon) @ [d3ae650](https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Fran\u00e7ois Bissey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22116_\n\n",
    "closed_at": "2017-07-12T11:54:34Z",
    "created_at": "2016-12-31T22:31:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "installation of gap_packages fails with bash 4.4",
    "type": "issue",
    "updated_at": "2017-07-12T11:54:34Z",
    "url": "https://github.com/sagemath/sage/issues/22116",
    "user": "https://github.com/dimpase"
}
```
The symptom is the error at the line `cd leon make` coming from a `Makefile` in `guava` package.

```
make[3]: Entering directory '/home/dima/Sage/sage-dev/local/gap/gap-4.8.3/pkg/guava-3.13/src'
gcc  -O2 -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib  -o leonconv leonconv.c
cd leon make
/bin/sh: line 0: cd: too many arguments
make[3]: *** [Makefile:14: all] Error 1
```

This happens when `/bin/sh` is bash 4.4.5(1). New bash versions like this one do not silently ignore extra arguments to `cd` (even though it is documented as ignored). So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.

Guava readme on its [homepage](https://github.com/osj1961/guava) lists Leon's programs as a part, so they should be built, in fact.

See also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).

Branch/Commit: **[u/fbissey/leon](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/leon) @ [d3ae650](https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Dima Pasechnik**

Author: **François Bissey**

_Issue created by migration from https://trac.sagemath.org/ticket/22116_





---

archive/issue_events_281250.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-12-31T22:31:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281250"
}
```



---

archive/issue_events_281251.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-12-31T22:31:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281251"
}
```



---

archive/issue_events_281252.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-12-31T22:31:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281252"
}
```



---

archive/issue_comments_328884.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nLike I said on github I have no idea why it works in the first place on most system. The code is __bad__.",
    "created_at": "2017-01-01T21:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328884",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'>Comment 1:</a>
Like I said on github I have no idea why it works in the first place on most system. The code is __bad__.



---

archive/issue_events_281253.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-01-01T21:46:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281253"
}
```



---

archive/issue_comments_328885.json:
```json
{
    "body": "Branch: **[u/fbissey/leon](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/leon)**",
    "created_at": "2017-01-01T21:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328885",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/leon](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/leon)**



---

archive/issue_comments_328886.json:
```json
{
    "body": "Commit: **[abb06b5](https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099)**",
    "created_at": "2017-01-01T21:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328886",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[abb06b5](https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099)**



---

archive/issue_comments_328887.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2017-01-01T21:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328887",
    "user": "https://github.com/kiwifb"
}
```

Author: **François Bissey**



---

archive/issue_comments_328888.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAs, also mentioned in github, my own gentoo systems are quite unaffected by the bug - one day I may understand why that is. In any case, can you pass it upstream Dima?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099\">abb06b5</a></td><td><code>Fix guava's src/Makefile for #22116</code></td></tr></table>\n",
    "created_at": "2017-01-01T21:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328888",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'>Comment 2:</a>
As, also mentioned in github, my own gentoo systems are quite unaffected by the bug - one day I may understand why that is. In any case, can you pass it upstream Dima?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099">abb06b5</a></td><td><code>Fix guava's src/Makefile for #22116</code></td></tr></table>




---

archive/issue_comments_328889.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nHum... Apart from not doing exactly the same thing as in sage-on-gentoo (not woken yet may be) there is the issue that autoreconf is called in `src/leon`. Do you see that on other systems? It fails miserably in any case but that's not normal or wanted.",
    "created_at": "2017-01-01T21:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328889",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>Comment 3:</a>
Hum... Apart from not doing exactly the same thing as in sage-on-gentoo (not woken yet may be) there is the issue that autoreconf is called in `src/leon`. Do you see that on other systems? It fails miserably in any case but that's not normal or wanted.



---

archive/issue_comments_328890.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@kiwifb](#comment%3A3):\n> Hum... Apart from not doing exactly the same thing as in sage-on-gentoo (not woken yet may be) there is the issue that autoreconf is called in `src/leon`. Do you see that on other systems? It fails miserably in any case but that's not normal or wanted.\n\nI don't understand how your patch would make it work; there is no makefile in src/leon/",
    "created_at": "2017-01-02T09:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328890",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@kiwifb](#comment%3A3):
> Hum... Apart from not doing exactly the same thing as in sage-on-gentoo (not woken yet may be) there is the issue that autoreconf is called in `src/leon`. Do you see that on other systems? It fails miserably in any case but that's not normal or wanted.

I don't understand how your patch would make it work; there is no makefile in src/leon/



---

archive/issue_comments_328891.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIMHO it should be\n\n```\n-       cd leon make\n+       cd leon && ./configure && $(MAKE)\n```",
    "created_at": "2017-01-02T09:54:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328891",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'>Comment 5:</a>
IMHO it should be

```
-       cd leon make
+       cd leon && ./configure && $(MAKE)
```



---

archive/issue_comments_328892.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThe build system is a right mess. \n\n```\nSRCDIR  = ./src/leon\nCJSRCDIR= ./src/ctjhai\nBINDIR = bin/$(GAPARCH)\n#GAP_PATH=../..\n#PKG_PATH=.\n#SRCDISTFILE=guava\n\ntargets: default\n\ndefault: bindir minimum-weight leonconv desauto install\n\n# this target creates a bin-directory\nbindir:\n\tif test ! -d $(BINDIR);  then mkdir -p $(BINDIR);  fi\n\nminimum-weight: $(CJSRCDIR)/minimum-weight.o $(CJSRCDIR)/minimum-weight-gf2.o $(CJSRCDIR)/minimum-weight-gf3.o $(CJSRCDIR)/popcount.o\n\t$(CC) $(LDFLAGS) -o $(CJSRCDIR)/minimum-weight \\\n$(CJSRCDIR)/minimum-weight.o $(CJSRCDIR)/minimum-weight-gf2.o \\\n$(CJSRCDIR)/minimum-weight-gf3.o $(CJSRCDIR)/popcount.o -lm\n\nleonconv: \n\tcd ./src; $(MAKE) CC=\"$(CC)\" CPPFLAGS=\"$(CPPFLAGS)\" CFLAGS=\"$(CFLAGS)\" LDFLAGS=\"$(LDFLAGS)\";\n\ndesauto: \n\tcd $(SRCDIR); autoreconf --install --force || true ; ./configure; $(MAKE) CC=\"$(CC)\" CPPFLAGS=\"$(CPPFLAGS)\" CFLAGS=\"$(CFLAGS)\" LDFLAGS=\"$(LDFLAGS)\";\n```\nso the `desauto` target will produce a makefile in `src/leon` and run make. In effect that little bit in `src/Makefile` would be \"useful\" if the `desauto` target was run before `leonconv`. As it is, it indeed does nothing.",
    "created_at": "2017-01-02T10:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328892",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'>Comment 6:</a>
The build system is a right mess. 

```
SRCDIR  = ./src/leon
CJSRCDIR= ./src/ctjhai
BINDIR = bin/$(GAPARCH)
#GAP_PATH=../..
#PKG_PATH=.
#SRCDISTFILE=guava

targets: default

default: bindir minimum-weight leonconv desauto install

# this target creates a bin-directory
bindir:
	if test ! -d $(BINDIR);  then mkdir -p $(BINDIR);  fi

minimum-weight: $(CJSRCDIR)/minimum-weight.o $(CJSRCDIR)/minimum-weight-gf2.o $(CJSRCDIR)/minimum-weight-gf3.o $(CJSRCDIR)/popcount.o
	$(CC) $(LDFLAGS) -o $(CJSRCDIR)/minimum-weight \
$(CJSRCDIR)/minimum-weight.o $(CJSRCDIR)/minimum-weight-gf2.o \
$(CJSRCDIR)/minimum-weight-gf3.o $(CJSRCDIR)/popcount.o -lm

leonconv: 
	cd ./src; $(MAKE) CC="$(CC)" CPPFLAGS="$(CPPFLAGS)" CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)";

desauto: 
	cd $(SRCDIR); autoreconf --install --force || true ; ./configure; $(MAKE) CC="$(CC)" CPPFLAGS="$(CPPFLAGS)" CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)";
```
so the `desauto` target will produce a makefile in `src/leon` and run make. In effect that little bit in `src/Makefile` would be "useful" if the `desauto` target was run before `leonconv`. As it is, it indeed does nothing.



---

archive/issue_comments_328893.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nIt probably fails for me due to a race condition (with make -jX with X>>1).",
    "created_at": "2017-01-02T10:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328893",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
It probably fails for me due to a race condition (with make -jX with X>>1).



---

archive/issue_comments_328894.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThis should be reported upstream",
    "created_at": "2017-01-02T10:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328894",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
This should be reported upstream



---

archive/issue_comments_328895.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nIndeed you could fail because you try to run make while it is being produced. That makes the bit of my gentoo patch where I make the `leoconv` target depend on `desauto` the real resolution. I think the dependencies of the `install` target should be fixed as I did in Gentoo as well.",
    "created_at": "2017-01-02T10:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328895",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'>Comment 9:</a>
Indeed you could fail because you try to run make while it is being produced. That makes the bit of my gentoo patch where I make the `leoconv` target depend on `desauto` the real resolution. I think the dependencies of the `install` target should be fixed as I did in Gentoo as well.



---

archive/issue_comments_328896.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nWhich version of `bash` are you using?\n\nWith\n\n```\nGNU bash, version 4.2.49(1)-release (x86_64-pc-linux-gnu)\n```\nit seems that extra arguments to `cd` are silently ignored.",
    "created_at": "2017-01-02T10:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328896",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Which version of `bash` are you using?

With

```
GNU bash, version 4.2.49(1)-release (x86_64-pc-linux-gnu)
```
it seems that extra arguments to `cd` are silently ignored.



---

archive/issue_comments_328897.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@jdemeyer](#comment%3A10):\n> Which version of `bash` are you using?\n> \n> With\n> \n> ```\n> GNU bash, version 4.2.49(1)-release (x86_64-pc-linux-gnu)\n> ```\n> it seems that extra arguments to `cd` are silently ignored.\n\nI'm on bash 4.4.5(1) (according to manpages of bash, the args of cd after dir are ignored). If I merely use the branch I still cannot build, I need to run configure in src/leon first. I need to check that this can be replaced by adding\nthe explicit dependency (but I guess it will do).\n\nI'm experimenting with stock GAP 4.8.6 now, same issues.",
    "created_at": "2017-01-02T10:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328897",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@jdemeyer](#comment%3A10):
> Which version of `bash` are you using?
> 
> With
> 
> ```
> GNU bash, version 4.2.49(1)-release (x86_64-pc-linux-gnu)
> ```
> it seems that extra arguments to `cd` are silently ignored.

I'm on bash 4.4.5(1) (according to manpages of bash, the args of cd after dir are ignored). If I merely use the branch I still cannot build, I need to run configure in src/leon first. I need to check that this can be replaced by adding
the explicit dependency (but I guess it will do).

I'm experimenting with stock GAP 4.8.6 now, same issues.



---

archive/issue_comments_328898.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nAnd I am on bash 4.3 myself. It could indeed be down to behavior depending on the bash version, and once you fix the problem with `src/Makefile` we need to fix the dependencies.",
    "created_at": "2017-01-02T10:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328898",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'>Comment 12:</a>
And I am on bash 4.3 myself. It could indeed be down to behavior depending on the bash version, and once you fix the problem with `src/Makefile` we need to fix the dependencies.



---

archive/issue_events_281254.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-02T10:32:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281254"
}
```



---

archive/issue_events_281255.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-02T10:32:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281255"
}
```



---

archive/issue_comments_328899.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nGiven that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?",
    "created_at": "2017-01-02T10:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328899",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Given that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?



---

archive/issue_comments_328900.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@jdemeyer](#comment%3A13):\n> Given that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?\n\nthis is not the original intention, of course. Although it's very old code there.",
    "created_at": "2017-01-02T10:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328900",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@jdemeyer](#comment%3A13):
> Given that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?

this is not the original intention, of course. Although it's very old code there.



---

archive/issue_events_281256.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-02T10:35:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "title_is": "installation of gap_packages fails with bash 4.4",
    "title_was": "installation of gap_packages fails on some gentoo systems",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281256"
}
```



---

archive/issue_comments_328901.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,7 @@\n /bin/sh: line 0: cd: too many arguments\n make[3]: *** [Makefile:14: all] Error 1\n ```\n+\n+This happens when `/bin/sh` is bash 4.4.5(1). Older bash versions silently ignore extra arguments to `cd`. So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.\n+\n See also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).\n-\n-On a system I see this error, `/bin/sh` is a link to `bash`.\n``````\n",
    "created_at": "2017-01-02T10:35:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328901",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,7 @@
 /bin/sh: line 0: cd: too many arguments
 make[3]: *** [Makefile:14: all] Error 1
 ```
+
+This happens when `/bin/sh` is bash 4.4.5(1). Older bash versions silently ignore extra arguments to `cd`. So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.
+
 See also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).
-
-On a system I see this error, `/bin/sh` is a link to `bash`.
``````




---

archive/issue_comments_328902.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@dimpase](#comment%3A14):\n> this is not the original intention, of course. Although it's very old code there. \n\nGiven that guava has worked for years with that broken line, I think it's best to keep the behaviour (i.e. doing nothing).",
    "created_at": "2017-01-02T10:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328902",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@dimpase](#comment%3A14):
> this is not the original intention, of course. Although it's very old code there. 

Given that guava has worked for years with that broken line, I think it's best to keep the behaviour (i.e. doing nothing).



---

archive/issue_comments_328903.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@dimpase](#comment%3A14):\n> Replying to [@jdemeyer](#comment%3A13):\n> > Given that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?\n\n> \n> this is not the original intention, of course. Although it's very old code there. \n\nVery organic. Lots of stuff is decrepit and not used. So excision, as suggested by Jeroen, is warranted.",
    "created_at": "2017-01-02T10:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328903",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@dimpase](#comment%3A14):
> Replying to [@jdemeyer](#comment%3A13):
> > Given that the line `cd leon make` is essentially a no-op (it behaves like `cd leon`), maybe it should be removed?

> 
> this is not the original intention, of course. Although it's very old code there. 

Very organic. Lots of stuff is decrepit and not used. So excision, as suggested by Jeroen, is warranted.



---

archive/issue_comments_328904.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nNo, it must be fixed (upstream as well) and preserved. It is working code.",
    "created_at": "2017-01-02T10:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328904",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'>Comment 18:</a>
No, it must be fixed (upstream as well) and preserved. It is working code.



---

archive/issue_comments_328905.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,8 @@\n make[3]: *** [Makefile:14: all] Error 1\n ```\n \n-This happens when `/bin/sh` is bash 4.4.5(1). Older bash versions silently ignore extra arguments to `cd`. So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.\n+This happens when `/bin/sh` is bash 4.4.5(1). New bash versions like this one do not silently ignore extra arguments to `cd` (even though it is documented as ignored). So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.\n+\n+Guava readme on its [homepage](https://github.com/osj1961/guava) lists Leon's programs as a part, so they should be built, in fact.\n \n See also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).\n``````\n",
    "created_at": "2017-01-02T10:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328905",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,8 @@
 make[3]: *** [Makefile:14: all] Error 1
 ```
 
-This happens when `/bin/sh` is bash 4.4.5(1). Older bash versions silently ignore extra arguments to `cd`. So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.
+This happens when `/bin/sh` is bash 4.4.5(1). New bash versions like this one do not silently ignore extra arguments to `cd` (even though it is documented as ignored). So the line `cd leon make` behaves like `cd leon` which is a no-op since no other commands follow that `cd` command.
+
+Guava readme on its [homepage](https://github.com/osj1961/guava) lists Leon's programs as a part, so they should be built, in fact.
 
 See also the corresponding gentoo [github thread](https://github.com/cschwan/sage-on-gentoo/issues/447).
``````




---

archive/issue_comments_328906.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2017-01-02T10:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328906",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_328907.json:
```json
{
    "body": "Changed commit from **[abb06b5](https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099)** to **[d3ae650](https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1)**",
    "created_at": "2017-01-02T10:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328907",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[abb06b5](https://github.com/sagemath/sagetrac-mirror/commit/abb06b5ba62e5f9c838804b3312d023a99972099)** to **[d3ae650](https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1)**



---

archive/issue_comments_328908.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1\">d3ae650</a></td><td><code>improve patch to make sure parallel make work as well as not fail with bash 4.4</code></td></tr></table>\n",
    "created_at": "2017-01-02T10:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328908",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ae65082dc0bfc5a2f240e77882632cbef8e8d1">d3ae650</a></td><td><code>improve patch to make sure parallel make work as well as not fail with bash 4.4</code></td></tr></table>




---

archive/issue_events_281257.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-01-02T10:52:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281257"
}
```



---

archive/issue_events_281258.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-01-02T10:52:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281258"
}
```



---

archive/issue_comments_328909.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThis is closer to what I do in Gentoo and make sure it will work properly with parallel make.",
    "created_at": "2017-01-02T10:52:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328909",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'>Comment 21:</a>
This is closer to what I do in Gentoo and make sure it will work properly with parallel make.



---

archive/issue_comments_328910.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI would only accept this patch if upstream accepts it.\n\nI would accept removing the line `cd leon make` (with no further changes) unconditionally.",
    "created_at": "2017-01-02T10:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328910",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
I would only accept this patch if upstream accepts it.

I would accept removing the line `cd leon make` (with no further changes) unconditionally.



---

archive/issue_comments_328911.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@jdemeyer](#comment%3A22):\n> I would only accept this patch if upstream accepts it.\n\nI am pretty much OK with accepting it, as this seems to be a general GAP(packages) slackness with not fixing obvious things for years.",
    "created_at": "2017-01-02T11:01:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328911",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@jdemeyer](#comment%3A22):
> I would only accept this patch if upstream accepts it.

I am pretty much OK with accepting it, as this seems to be a general GAP(packages) slackness with not fixing obvious things for years.



---

archive/issue_comments_328912.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@jdemeyer](#comment%3A22):\n> I would only accept this patch if upstream accepts it.\n> \n> I would accept removing the line `cd leon make` (with no further changes) unconditionally.\n\nConsidering the cruft, I would suggest more invasive changes upstream. `src/Makefile` is really full of unused stuff beside that line. Once it is done the target dependencies in the top makefile could be pushed to the `install` target only. And finally could we get rid of running `autoreconf` (note the artful way things are handled on line 29 of `Makefile.in` so that absence of `autoreconf` or its failure is not a problem - and because there is an automake statement in `src/leon/configure.ac` and no `Makefile.am`, `autoreconf` will fail if run).",
    "created_at": "2017-01-02T11:05:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328912",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@jdemeyer](#comment%3A22):
> I would only accept this patch if upstream accepts it.
> 
> I would accept removing the line `cd leon make` (with no further changes) unconditionally.

Considering the cruft, I would suggest more invasive changes upstream. `src/Makefile` is really full of unused stuff beside that line. Once it is done the target dependencies in the top makefile could be pushed to the `install` target only. And finally could we get rid of running `autoreconf` (note the artful way things are handled on line 29 of `Makefile.in` so that absence of `autoreconf` or its failure is not a problem - and because there is an automake statement in `src/leon/configure.ac` and no `Makefile.am`, `autoreconf` will fail if run).



---

archive/issue_comments_328913.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@kiwifb](#comment%3A24):\n> Considering the cruft, I would suggest more invasive changes upstream.\n\nI don't care.\n\nFor Sage for now, why not do the minimal change which is needed to fix the problem with bash 4.4? We can leave further changes for the future, after discussing with upstream.",
    "created_at": "2017-01-02T11:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328913",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@kiwifb](#comment%3A24):
> Considering the cruft, I would suggest more invasive changes upstream.

I don't care.

For Sage for now, why not do the minimal change which is needed to fix the problem with bash 4.4? We can leave further changes for the future, after discussing with upstream.



---

archive/issue_comments_328914.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@jdemeyer](#comment%3A25):\n> Replying to [@kiwifb](#comment%3A24):\n> > Considering the cruft, I would suggest more invasive changes upstream.\n\n> \n> I don't care.\n> \n> For Sage for now, why not do the minimal change which is needed to fix the problem with bash 4.4? We can leave further changes for the future, after discussing with upstream.\n\nSure. My only other changes on that branch are considerations that parallel make will fail for someone sooner or later.",
    "created_at": "2017-01-02T11:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328914",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@jdemeyer](#comment%3A25):
> Replying to [@kiwifb](#comment%3A24):
> > Considering the cruft, I would suggest more invasive changes upstream.

> 
> I don't care.
> 
> For Sage for now, why not do the minimal change which is needed to fix the problem with bash 4.4? We can leave further changes for the future, after discussing with upstream.

Sure. My only other changes on that branch are considerations that parallel make will fail for someone sooner or later.



---

archive/issue_comments_328915.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI've put the patch into the branch on #20914. Thanks :-)",
    "created_at": "2017-01-23T19:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328915",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'>Comment 27:</a>
I've put the patch into the branch on #20914. Thanks :-)



---

archive/issue_events_281259.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-23T19:20:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281259"
}
```



---

archive/issue_comments_328916.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Dima Pasechnik**",
    "created_at": "2017-01-23T19:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328916",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Jeroen Demeyer, Dima Pasechnik**



---

archive/issue_events_281260.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-23T19:20:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281260"
}
```



---

archive/issue_events_281261.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-01-23T19:20:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281261"
}
```



---

archive/issue_comments_328917.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nFor the record: I **disagree** with that patch (but if other people are happy with it, I will not object).",
    "created_at": "2017-01-23T21:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328917",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
For the record: I **disagree** with that patch (but if other people are happy with it, I will not object).



---

archive/issue_comments_328918.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer, Dima Pasechnik** to **Dima Pasechnik**",
    "created_at": "2017-01-24T08:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328918",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer, Dima Pasechnik** to **Dima Pasechnik**



---

archive/issue_comments_328919.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nI think that this bug is important enough that it should be fixed independently of #20914. However, again, I don't want to interfere with what you guys are doing...",
    "created_at": "2017-01-24T08:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328919",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
I think that this bug is important enough that it should be fixed independently of #20914. However, again, I don't want to interfere with what you guys are doing...



---

archive/issue_comments_328920.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2017-01-24T11:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328920",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Fixed upstream, in a later stable release.**



---

archive/issue_events_281262.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-12T11:54:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281262"
}
```



---

archive/issue_comments_328921.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nSince this is duplicate/invalid/wontfix I guess it can be closed?",
    "created_at": "2017-07-12T11:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22116#issuecomment-328921",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'>Comment 32:</a>
Since this is duplicate/invalid/wontfix I guess it can be closed?



---

archive/issue_events_281263.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-12T11:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281263"
}
```



---

archive/issue_events_281264.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-12T11:54:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22116",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22116#event-281264"
}
```
