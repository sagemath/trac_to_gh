# Issue 22079: New implementation of floor()/ceil()

archive/issues_021842.json:
```json
{
    "body": "The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n\n```\nsage: ceil(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: ceil(Infinity)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\nand\n\n```\nsage: ceil(NaN)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\n\nOne consequence is that conversion to `int` is also an infinite loop:\n\n```\nsage: int(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: int(NaN)\n...\nTypeError: maximum recursion depth exceeded in __instancecheck__\n```\n\nI propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n\nThis fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n\n**CC:**  @videlec @mezzarobba\n\n**Branch/Commit:** [8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)\n\n**Reviewer:** Ralf Stephan\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/22079\n\n",
    "closed_at": "2017-12-11T01:04:00Z",
    "created_at": "2016-12-19T16:36:36Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "New implementation of floor()/ceil()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22079",
    "user": "https://github.com/rwst"
}
```
The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.

```
sage: ceil(SR(2^20000+1))
(no answer....)
```
and

```
sage: ceil(Infinity)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```
and

```
sage: ceil(NaN)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```

One consequence is that conversion to `int` is also an infinite loop:

```
sage: int(SR(2^20000+1))
(no answer....)
```
and

```
sage: int(NaN)
...
TypeError: maximum recursion depth exceeded in __instancecheck__
```

I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.

This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.

**CC:**  @videlec @mezzarobba

**Branch/Commit:** [8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)

**Reviewer:** Ralf Stephan

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/22079





---

archive/issue_comments_390514.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: RealBallField(NaN)\n+sage: int(NaN)\n ...\n-TypeError: maximum recursion depth exceeded while calling a Python object\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n``````\n",
    "created_at": "2016-12-19T19:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390514",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: RealBallField(NaN)
+sage: int(NaN)
 ...
-TypeError: maximum recursion depth exceeded while calling a Python object
+TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
``````




---

archive/issue_events_066339.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "rename": {
        "from": "Arb NaN infinite loop",
        "to": "NaN -> int infinite loop"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66339"
}
```



---

archive/issue_comments_390515.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.",
    "created_at": "2016-12-19T19:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390515",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
This had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.



---

archive/issue_events_066340.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "rename": {
        "from": "NaN -> int infinite loop",
        "to": "ceil(NaN) infinite loop"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66340"
}
```



---

archive/issue_comments_390516.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: int(NaN)\n+sage: ceil(NaN)\n ...\n-TypeError: maximum recursion depth exceeded in __instancecheck__\n+TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n``````\n",
    "created_at": "2016-12-19T19:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390516",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: int(NaN)
+sage: ceil(NaN)
 ...
-TypeError: maximum recursion depth exceeded in __instancecheck__
+TypeError: maximum recursion depth exceeded while calling a Python object
 ```
``````




---

archive/issue_events_066341.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "rename": {
        "from": "ceil(NaN) infinite loop",
        "to": "Infinite loop in ceil() function"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66341"
}
```



---

archive/issue_comments_390517.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n+\n+```\n+sage: ceil(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n \n ```\n sage: ceil(NaN)\n``````\n",
    "created_at": "2016-12-19T19:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390517",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.
+
+```
+sage: ceil(SR(2^20000+1))
+(no answer....)
+```
+and
 
 ```
 sage: ceil(NaN)
``````




---

archive/issue_comments_390518.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,13 @@\n and\n \n ```\n+sage: ceil(Infinity)\n+...\n+TypeError: maximum recursion depth exceeded while calling a Python object\n+```\n+and\n+\n+```\n sage: ceil(NaN)\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n``````\n",
    "created_at": "2016-12-19T19:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390518",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,13 @@
 and
 
 ```
+sage: ceil(Infinity)
+...
+TypeError: maximum recursion depth exceeded while calling a Python object
+```
+and
+
+```
 sage: ceil(NaN)
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
``````




---

archive/issue_comments_390519.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -18,3 +18,17 @@\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n+\n+One consequence is that conversion to `int` is also an infinite loop:\n+\n+```\n+sage: int(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n+\n+```\n+sage: int(NaN)\n+...\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n+```\n``````\n",
    "created_at": "2016-12-19T19:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390519",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -18,3 +18,17 @@
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
 ```
+
+One consequence is that conversion to `int` is also an infinite loop:
+
+```
+sage: int(SR(2^20000+1))
+(no answer....)
+```
+and
+
+```
+sage: int(NaN)
+...
+TypeError: maximum recursion depth exceeded in __instancecheck__
+```
``````




---

archive/issue_comments_390520.json:
```json
{
    "body": "<a id='comment:7'></a>\nWill hopefully be fixed by the rewrite in progress at #12121.",
    "created_at": "2016-12-19T19:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390520",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>
Will hopefully be fixed by the rewrite in progress at #12121.



---

archive/issue_comments_390521.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mmezzarobba](#comment%3A7):\n> Will hopefully be fixed by the rewrite in progress at #12121.\n\n\n... which is still not fixed.\n\nI just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?",
    "created_at": "2017-09-04T12:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390521",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [mmezzarobba](#comment%3A7):
> Will hopefully be fixed by the rewrite in progress at #12121.


... which is still not fixed.

I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?



---

archive/issue_comments_390522.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -32,3 +32,5 @@\n ...\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n+\n+The same happens with `floor()`\n``````\n",
    "created_at": "2017-09-04T12:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390522",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -32,3 +32,5 @@
 ...
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
+
+The same happens with `floor()`
``````




---

archive/issue_comments_390523.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A8):\n> I just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?\n\n\nI don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)",
    "created_at": "2017-09-04T14:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390523",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A8):
> I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?


I don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)



---

archive/issue_comments_390524.json:
```json
{
    "body": "<a id='comment:10'></a>\nI am also working on a proper solution both for this ticket and for #12121. Hang on...",
    "created_at": "2017-09-04T14:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390524",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
I am also working on a proper solution both for this ticket and for #12121. Hang on...



---

archive/issue_comments_390525.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A10):\n> I am also working on a proper solution both for this ticket and for #12121. Hang on...\n\n\nOk. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.",
    "created_at": "2017-09-04T14:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390525",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A10):
> I am also working on a proper solution both for this ticket and for #12121. Hang on...


Ok. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.



---

archive/issue_comments_390526.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)",
    "created_at": "2017-09-04T15:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390526",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)



---

archive/issue_comments_390527.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -33,4 +33,4 @@\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n \n-The same happens with `floor()`\n+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n``````\n",
    "created_at": "2017-09-04T15:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390527",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -33,4 +33,4 @@
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
 
-The same happens with `floor()`
+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
``````




---

archive/issue_comments_390528.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-09-04T15:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390528",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_390529.json:
```json
{
    "body": "<a id='comment:13'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3\">4e1cd2c</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-04T15:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390529",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3">4e1cd2c</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_390530.json:
```json
{
    "body": "**Commit:** [4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)",
    "created_at": "2017-09-04T15:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390530",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)



---

archive/issue_events_066342.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "rename": {
        "from": "Infinite loop in ceil() function",
        "to": "New implementation of floor()/ceil()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66342"
}
```



---

archive/issue_comments_390531.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2017-09-04T15:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390531",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_390532.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -34,3 +34,5 @@\n ```\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n+\n+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390532",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -34,3 +34,5 @@
 ```
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
+
+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_comments_390533.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,4 +35,4 @@\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n \n-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390533",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,4 +35,4 @@
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
 
-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_comments_390534.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-09-05T07:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390534",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_events_066343.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66343"
}
```



---

archive/issue_comments_390535.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83\">b11c9ce</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-05T08:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83">b11c9ce</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_390536.json:
```json
{
    "body": "**Changing commit** from \"[4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)\" to \"[b11c9ce31e4e4866a9a9bdd140e1fc7600369a83](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)\".",
    "created_at": "2017-09-05T08:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)" to "[b11c9ce31e4e4866a9a9bdd140e1fc7600369a83](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)".



---

archive/issue_comments_390537.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-09-05T08:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390537",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_390538.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis passes tests on the patchbot.",
    "created_at": "2017-09-05T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390538",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
This passes tests on the patchbot.



---

archive/issue_comments_390539.json:
```json
{
    "body": "<a id='comment:21'></a>\nHow is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...\n\nI just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number\n\n```\nsage: n = continued_fraction(pi).convergent(20)\nsage: num = n.numerator()\nsage: den = n.denominator()\nsage: print bool(den*pi == num)\n```",
    "created_at": "2017-09-05T21:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390539",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
How is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...

I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number

```
sage: n = continued_fraction(pi).convergent(20)
sage: num = n.numerator()
sage: den = n.denominator()
sage: print bool(den*pi == num)
```



---

archive/issue_comments_390540.json:
```json
{
    "body": "<a id='comment:22'></a>\nHave you opened a bug ticket?",
    "created_at": "2017-09-06T04:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390540",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Have you opened a bug ticket?



---

archive/issue_comments_390541.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [vdelecroix](#comment%3A21):\n> It would be definitely more coherent to work on only one ticket...\n\n\nRight. It was not really my intention to start a \"competing\" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.",
    "created_at": "2017-09-06T07:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390541",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [vdelecroix](#comment%3A21):
> It would be definitely more coherent to work on only one ticket...


Right. It was not really my intention to start a "competing" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.



---

archive/issue_comments_390542.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vdelecroix](#comment%3A21):\n> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.\n\n\nMy branch doesn't require equality tests in the symbolic ring.",
    "created_at": "2017-09-06T07:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390542",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [vdelecroix](#comment%3A21):
> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.


My branch doesn't require equality tests in the symbolic ring.



---

archive/issue_comments_390543.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [vdelecroix](#comment%3A21):\n> that proposes a useful `maximum_bits` argument\n\n\nRight, I do see the point of that.",
    "created_at": "2017-09-06T07:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390543",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [vdelecroix](#comment%3A21):
> that proposes a useful `maximum_bits` argument


Right, I do see the point of that.



---

archive/issue_comments_390544.json:
```json
{
    "body": "**Changing commit** from \"[b11c9ce31e4e4866a9a9bdd140e1fc7600369a83](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)\" to \"[554fa6211ad06bdc54fd944080e69cb53ef62680](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)\".",
    "created_at": "2017-09-19T11:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b11c9ce31e4e4866a9a9bdd140e1fc7600369a83](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)" to "[554fa6211ad06bdc54fd944080e69cb53ef62680](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)".



---

archive/issue_comments_390545.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680\">554fa62</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T11:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680">554fa62</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_390546.json:
```json
{
    "body": "<a id='comment:27'></a>\nNow with a `bits` argument (easier to type and less confusing than `maximum_bits`)\n\nSorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.",
    "created_at": "2017-09-19T11:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390546",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Now with a `bits` argument (easier to type and less confusing than `maximum_bits`)

Sorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.



---

archive/issue_comments_390547.json:
```json
{
    "body": "<a id='comment:28'></a>\ntypo `the taregt number`",
    "created_at": "2017-09-19T12:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390547",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>
typo `the taregt number`



---

archive/issue_comments_390548.json:
```json
{
    "body": "<a id='comment:29'></a>\nAbout\n\n```\nif isinstance(x, (float, complex)):\n    m = getattr(math, method)\n    return Integer(m(x))\n```\nTwo questions:\n\n- with complex inputs, the `math` library gives an error\n\n```\nsage: \nsage: math.floor(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\nsage: math.ceil(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\n```\n   hence there is a bit of contradiction here.\n\n- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point\n\n```\nsage: cos(1.0r)\n0.5403023058681398\nsage: type(_)\n<type 'float'>\n```",
    "created_at": "2017-09-19T12:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390548",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>
About

```
if isinstance(x, (float, complex)):
    m = getattr(math, method)
    return Integer(m(x))
```
Two questions:

- with complex inputs, the `math` library gives an error

```
sage: 
sage: math.floor(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
sage: math.ceil(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
```
   hence there is a bit of contradiction here.

- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point

```
sage: cos(1.0r)
0.5403023058681398
sage: type(_)
<type 'float'>
```



---

archive/issue_comments_390549.json:
```json
{
    "body": "<a id='comment:30'></a>\nYou may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.",
    "created_at": "2017-09-19T12:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390549",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
You may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.



---

archive/issue_comments_390550.json:
```json
{
    "body": "**Changing commit** from \"[554fa6211ad06bdc54fd944080e69cb53ef62680](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)\" to \"[5f6b9984d500aed37ed8a8b618dcc70df5f97739](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)\".",
    "created_at": "2017-09-19T13:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[554fa6211ad06bdc54fd944080e69cb53ef62680](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)" to "[5f6b9984d500aed37ed8a8b618dcc70df5f97739](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)".



---

archive/issue_comments_390551.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739\">5f6b998</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T13:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739">5f6b998</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_390552.json:
```json
{
    "body": "<a id='comment:32'></a>\nDoes not apply.",
    "created_at": "2017-11-28T07:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390552",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'></a>
Does not apply.



---

archive/issue_comments_390553.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-11-28T07:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390553",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_390554.json:
```json
{
    "body": "<a id='comment:33'></a>\nDo you plan to review this ticket if I fix the conflict?",
    "created_at": "2017-11-28T08:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390554",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Do you plan to review this ticket if I fix the conflict?



---

archive/issue_comments_390555.json:
```json
{
    "body": "<a id='comment:34'></a>\nYes. It's time to get that done.",
    "created_at": "2017-11-28T09:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390555",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
Yes. It's time to get that done.



---

archive/issue_comments_390556.json:
```json
{
    "body": "**Changing commit** from \"[5f6b9984d500aed37ed8a8b618dcc70df5f97739](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)\" to \"[3678400db638d01a6447a1d8a2cef7e354e2bc72](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)\".",
    "created_at": "2017-11-28T09:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5f6b9984d500aed37ed8a8b618dcc70df5f97739](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)" to "[3678400db638d01a6447a1d8a2cef7e354e2bc72](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)".



---

archive/issue_comments_390557.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72\">3678400</a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72">3678400</a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_390558.json:
```json
{
    "body": "**Changing commit** from \"[3678400db638d01a6447a1d8a2cef7e354e2bc72](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)\" to \"[740930b09b183c439ae422f176a5f23f93a7ad19](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)\".",
    "created_at": "2017-11-28T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3678400db638d01a6447a1d8a2cef7e354e2bc72](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)" to "[740930b09b183c439ae422f176a5f23f93a7ad19](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)".



---

archive/issue_comments_390559.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19\">740930b</a></td><td><code>Fix comment</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19">740930b</a></td><td><code>Fix comment</code></td></tr></table>




---

archive/issue_comments_390560.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-11-28T09:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390560",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_390561.json:
```json
{
    "body": "<a id='comment:38'></a>\nPatchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:\n- there is one typo (`immediatly`)\n- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest\n\n```\nsage: floor(log(4) / log(2))\n2\nsage: a = floor(5.4 + x); a\nfloor(x + 5.40000000000000)\nsage: a.subs(x==2)\n7\nsage: floor(log(2**(3/2)) / log(2) + 1/2)\n2\nsage: floor(log(2**(-3/2)) / log(2) + 1/2)\n-1\nsage: e1 = pi - continued_fraction(pi).convergent(2785)\nsage: e2 = e - continued_fraction(e).convergent(1500)\nsage: f = e1/e2\nsage: f = 1 / (f - continued_fraction(f).convergent(1000))\nsage: f = f - continued_fraction(f).convergent(1)\nsage: floor(f, bits=40000)\n-1\nsage: ceil(f, bits=40000)\n0\n```\nYou can set positive after the above changes. If you don't agree with my above criterion however then don't.\n\nFinally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:\n\n```\nsage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1\nsage: ceil(z, bits=400000)\n...fails\n```\nThis is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.",
    "created_at": "2017-11-28T15:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390561",
    "user": "https://github.com/rwst"
}
```

<a id='comment:38'></a>
Patchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:
- there is one typo (`immediatly`)
- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest

```
sage: floor(log(4) / log(2))
2
sage: a = floor(5.4 + x); a
floor(x + 5.40000000000000)
sage: a.subs(x==2)
7
sage: floor(log(2**(3/2)) / log(2) + 1/2)
2
sage: floor(log(2**(-3/2)) / log(2) + 1/2)
-1
sage: e1 = pi - continued_fraction(pi).convergent(2785)
sage: e2 = e - continued_fraction(e).convergent(1500)
sage: f = e1/e2
sage: f = 1 / (f - continued_fraction(f).convergent(1000))
sage: f = f - continued_fraction(f).convergent(1)
sage: floor(f, bits=40000)
-1
sage: ceil(f, bits=40000)
0
```
You can set positive after the above changes. If you don't agree with my above criterion however then don't.

Finally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:

```
sage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1
sage: ceil(z, bits=400000)
...fails
```
This is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.



---

archive/issue_events_066344.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66344"
}
```



---

archive/issue_events_066345.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66345"
}
```



---

archive/issue_comments_390562.json:
```json
{
    "body": "**Reviewer:** Ralf Stephan",
    "created_at": "2017-11-28T15:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390562",
    "user": "https://github.com/rwst"
}
```

**Reviewer:** Ralf Stephan



---

archive/issue_comments_390563.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac\">727b99c</a></td><td><code>Fix comments and add tests</code></td></tr></table>\n",
    "created_at": "2017-11-29T15:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390563",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac">727b99c</a></td><td><code>Fix comments and add tests</code></td></tr></table>




---

archive/issue_comments_390564.json:
```json
{
    "body": "**Changing commit** from \"[740930b09b183c439ae422f176a5f23f93a7ad19](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)\" to \"[727b99caf6f7b28728f42260b5f64ba2835957ac](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)\".",
    "created_at": "2017-11-29T15:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390564",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[740930b09b183c439ae422f176a5f23f93a7ad19](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)" to "[727b99caf6f7b28728f42260b5f64ba2835957ac](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)".



---

archive/issue_comments_390565.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-11-29T15:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390565",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_390566.json:
```json
{
    "body": "<a id='comment:41'></a>\nconflicts with #22024",
    "created_at": "2017-12-02T23:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390566",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'></a>
conflicts with #22024



---

archive/issue_comments_390567.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-12-02T23:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390567",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_390568.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)\" to \"[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)\".",
    "created_at": "2017-12-03T15:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390568",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)" to "[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)".



---

archive/issue_comments_390569.json:
```json
{
    "body": "**Changing commit** from \"[727b99caf6f7b28728f42260b5f64ba2835957ac](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)\" to \"[8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)\".",
    "created_at": "2017-12-03T15:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390569",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[727b99caf6f7b28728f42260b5f64ba2835957ac](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)" to "[8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)".



---

archive/issue_comments_390570.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-12-03T15:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390570",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_390571.json:
```json
{
    "body": "<a id='comment:43'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d\">7f79a2d</a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36\">ba171aa</a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e\">8fddcfd</a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-12-03T15:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390571",
    "user": "https://github.com/rwst"
}
```

<a id='comment:43'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d">7f79a2d</a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36">ba171aa</a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e">8fddcfd</a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_390572.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)\" to \"[8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)\".",
    "created_at": "2017-12-11T01:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22079#issuecomment-390572",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)" to "[8fddcfd99c77664454e283390379aa2118c5f45e](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)".



---

archive/issue_events_066346.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:04:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22079",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22079#event-66346"
}
```
