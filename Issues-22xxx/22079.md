# Issue 22079: New implementation of floor()/ceil()

archive/issues_021842.json:
```json
{
    "assignees": [],
    "body": "The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n\n```\nsage: ceil(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: ceil(Infinity)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\nand\n\n```\nsage: ceil(NaN)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\n\nOne consequence is that conversion to `int` is also an infinite loop:\n\n```\nsage: int(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: int(NaN)\n...\nTypeError: maximum recursion depth exceeded in __instancecheck__\n```\n\nI propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n\nThis fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n\nCC:  @videlec @mezzarobba\n\nBranch/Commit: **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22079_\n\n",
    "closed_at": "2017-12-11T01:04:00Z",
    "created_at": "2016-12-19T16:36:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "New implementation of floor()/ceil()",
    "type": "issue",
    "updated_at": "2017-12-11T01:04:00Z",
    "url": "https://github.com/sagemath/sage/issues/22079",
    "user": "https://github.com/rwst"
}
```
The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.

```
sage: ceil(SR(2^20000+1))
(no answer....)
```
and

```
sage: ceil(Infinity)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```
and

```
sage: ceil(NaN)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```

One consequence is that conversion to `int` is also an infinite loop:

```
sage: int(SR(2^20000+1))
(no answer....)
```
and

```
sage: int(NaN)
...
TypeError: maximum recursion depth exceeded in __instancecheck__
```

I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.

This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.

CC:  @videlec @mezzarobba

Branch/Commit: **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**

Reviewer: **Ralf Stephan**

Author: **Jeroen Demeyer**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/22079_





---

archive/issue_events_309189.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309189"
}
```



---

archive/issue_events_309190.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309190"
}
```



---

archive/issue_events_309191.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309191"
}
```



---

archive/issue_events_309192.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309192"
}
```



---

archive/issue_comments_325616.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: RealBallField(NaN)\n+sage: int(NaN)\n ...\n-TypeError: maximum recursion depth exceeded while calling a Python object\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n``````\n",
    "created_at": "2016-12-19T19:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325616",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: RealBallField(NaN)
+sage: int(NaN)
 ...
-TypeError: maximum recursion depth exceeded while calling a Python object
+TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
``````




---

archive/issue_events_309193.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:16:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "NaN -> int infinite loop",
    "title_was": "Arb NaN infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309193"
}
```



---

archive/issue_comments_325617.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.",
    "created_at": "2016-12-19T19:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325617",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

This had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.



---

archive/issue_events_309194.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:22:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "ceil(NaN) infinite loop",
    "title_was": "NaN -> int infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309194"
}
```



---

archive/issue_comments_325618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: int(NaN)\n+sage: ceil(NaN)\n ...\n-TypeError: maximum recursion depth exceeded in __instancecheck__\n+TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n``````\n",
    "created_at": "2016-12-19T19:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325618",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: int(NaN)
+sage: ceil(NaN)
 ...
-TypeError: maximum recursion depth exceeded in __instancecheck__
+TypeError: maximum recursion depth exceeded while calling a Python object
 ```
``````




---

archive/issue_events_309195.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:29:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "Infinite loop in ceil() function",
    "title_was": "ceil(NaN) infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309195"
}
```



---

archive/issue_comments_325619.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n+\n+```\n+sage: ceil(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n \n ```\n sage: ceil(NaN)\n``````\n",
    "created_at": "2016-12-19T19:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325619",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.
+
+```
+sage: ceil(SR(2^20000+1))
+(no answer....)
+```
+and
 
 ```
 sage: ceil(NaN)
``````




---

archive/issue_comments_325620.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,13 @@\n and\n \n ```\n+sage: ceil(Infinity)\n+...\n+TypeError: maximum recursion depth exceeded while calling a Python object\n+```\n+and\n+\n+```\n sage: ceil(NaN)\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n``````\n",
    "created_at": "2016-12-19T19:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325620",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,13 @@
 and
 
 ```
+sage: ceil(Infinity)
+...
+TypeError: maximum recursion depth exceeded while calling a Python object
+```
+and
+
+```
 sage: ceil(NaN)
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
``````




---

archive/issue_comments_325621.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,17 @@\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n+\n+One consequence is that conversion to `int` is also an infinite loop:\n+\n+```\n+sage: int(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n+\n+```\n+sage: int(NaN)\n+...\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n+```\n``````\n",
    "created_at": "2016-12-19T19:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325621",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,17 @@
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
 ```
+
+One consequence is that conversion to `int` is also an infinite loop:
+
+```
+sage: int(SR(2^20000+1))
+(no answer....)
+```
+and
+
+```
+sage: int(NaN)
+...
+TypeError: maximum recursion depth exceeded in __instancecheck__
+```
``````




---

archive/issue_comments_325622.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWill hopefully be fixed by the rewrite in progress at #12121.",
    "created_at": "2016-12-19T19:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325622",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:7" align="right">comment:7</div>

Will hopefully be fixed by the rewrite in progress at #12121.



---

archive/issue_comments_325623.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mezzarobba](#comment:7):\n> Will hopefully be fixed by the rewrite in progress at #12121.\n\n... which is still not fixed.\n\nI just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?",
    "created_at": "2017-09-04T12:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325623",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mezzarobba](#comment:7):
> Will hopefully be fixed by the rewrite in progress at #12121.

... which is still not fixed.

I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?



---

archive/issue_comments_325624.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,3 +32,5 @@\n ...\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n+\n+The same happens with `floor()`\n``````\n",
    "created_at": "2017-09-04T12:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325624",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,3 +32,5 @@
 ...
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
+
+The same happens with `floor()`
``````




---

archive/issue_comments_325625.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:8):\n> I just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?\n\nI don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)",
    "created_at": "2017-09-04T14:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325625",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:8):
> I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?

I don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)



---

archive/issue_comments_325626.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI am also working on a proper solution both for this ticket and for #12121. Hang on...",
    "created_at": "2017-09-04T14:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325626",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

I am also working on a proper solution both for this ticket and for #12121. Hang on...



---

archive/issue_comments_325627.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jdemeyer](#comment:10):\n> I am also working on a proper solution both for this ticket and for #12121. Hang on...\n\nOk. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.",
    "created_at": "2017-09-04T14:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325627",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jdemeyer](#comment:10):
> I am also working on a proper solution both for this ticket and for #12121. Hang on...

Ok. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.



---

archive/issue_comments_325628.json:
```json
{
    "body": "Branch: **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)**",
    "created_at": "2017-09-04T15:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325628",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)**



---

archive/issue_comments_325629.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -33,4 +33,4 @@\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n \n-The same happens with `floor()`\n+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n``````\n",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325629",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -33,4 +33,4 @@
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
 
-The same happens with `floor()`
+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
``````




---

archive/issue_events_309196.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-04T15:04:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309196"
}
```



---

archive/issue_comments_325630.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3\"><code>4e1cd2c</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325630",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3"><code>4e1cd2c</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_325631.json:
```json
{
    "body": "Commit: **[`4e1cd2c`](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)**",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325631",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`4e1cd2c`](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)**



---

archive/issue_events_309197.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-04T15:04:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "New implementation of floor()/ceil()",
    "title_was": "Infinite loop in ceil() function",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309197"
}
```



---

archive/issue_comments_325632.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325632",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_325633.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,5 @@\n ```\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n+\n+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:06:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325633",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,5 @@
 ```
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
+
+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_comments_325634.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,4 +35,4 @@\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n \n-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325634",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,4 +35,4 @@
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
 
-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_events_309198.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309198"
}
```



---

archive/issue_events_309199.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309199"
}
```



---

archive/issue_events_309200.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309200"
}
```



---

archive/issue_events_309201.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309201"
}
```



---

archive/issue_comments_325635.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83\"><code>b11c9ce</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-05T08:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325635",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83"><code>b11c9ce</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_325636.json:
```json
{
    "body": "Changed commit from **[`4e1cd2c`](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)** to **[`b11c9ce`](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)**",
    "created_at": "2017-09-05T08:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325636",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e1cd2c`](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)** to **[`b11c9ce`](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)**



---

archive/issue_events_309202.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T08:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309202"
}
```



---

archive/issue_events_309203.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T08:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309203"
}
```



---

archive/issue_comments_325637.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis passes tests on the patchbot.",
    "created_at": "2017-09-05T11:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325637",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

This passes tests on the patchbot.



---

archive/issue_comments_325638.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHow is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...\n\nI just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number\n\n```\nsage: n = continued_fraction(pi).convergent(20)\nsage: num = n.numerator()\nsage: den = n.denominator()\nsage: print bool(den*pi == num)\n```",
    "created_at": "2017-09-05T21:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325638",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

How is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...

I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number

```
sage: n = continued_fraction(pi).convergent(20)
sage: num = n.numerator()
sage: den = n.denominator()
sage: print bool(den*pi == num)
```



---

archive/issue_comments_325639.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nHave you opened a bug ticket?",
    "created_at": "2017-09-06T04:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325639",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

Have you opened a bug ticket?



---

archive/issue_comments_325640.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@videlec](#comment:21):\n> It would be definitely more coherent to work on only one ticket...\n\nRight. It was not really my intention to start a \"competing\" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.",
    "created_at": "2017-09-06T07:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325640",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@videlec](#comment:21):
> It would be definitely more coherent to work on only one ticket...

Right. It was not really my intention to start a "competing" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.



---

archive/issue_comments_325641.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@videlec](#comment:21):\n> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.\n\nMy branch doesn't require equality tests in the symbolic ring.",
    "created_at": "2017-09-06T07:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325641",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@videlec](#comment:21):
> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.

My branch doesn't require equality tests in the symbolic ring.



---

archive/issue_comments_325642.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@videlec](#comment:21):\n> that proposes a useful `maximum_bits` argument\n\nRight, I do see the point of that.",
    "created_at": "2017-09-06T07:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325642",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@videlec](#comment:21):
> that proposes a useful `maximum_bits` argument

Right, I do see the point of that.



---

archive/issue_comments_325643.json:
```json
{
    "body": "Changed commit from **[`b11c9ce`](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)** to **[`554fa62`](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)**",
    "created_at": "2017-09-19T11:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325643",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b11c9ce`](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)** to **[`554fa62`](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)**



---

archive/issue_comments_325644.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680\"><code>554fa62</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T11:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325644",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680"><code>554fa62</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_325645.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nNow with a `bits` argument (easier to type and less confusing than `maximum_bits`)\n\nSorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.",
    "created_at": "2017-09-19T11:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325645",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Now with a `bits` argument (easier to type and less confusing than `maximum_bits`)

Sorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.



---

archive/issue_comments_325646.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\ntypo `the taregt number`",
    "created_at": "2017-09-19T12:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325646",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">comment:28</div>

typo `the taregt number`



---

archive/issue_comments_325647.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAbout\n\n```\nif isinstance(x, (float, complex)):\n    m = getattr(math, method)\n    return Integer(m(x))\n```\nTwo questions:\n\n- with complex inputs, the `math` library gives an error\n\n```\nsage: \nsage: math.floor(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\nsage: math.ceil(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\n```\n   hence there is a bit of contradiction here.\n\n- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point\n\n```\nsage: cos(1.0r)\n0.5403023058681398\nsage: type(_)\n<type 'float'>\n```",
    "created_at": "2017-09-19T12:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325647",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

About

```
if isinstance(x, (float, complex)):
    m = getattr(math, method)
    return Integer(m(x))
```
Two questions:

- with complex inputs, the `math` library gives an error

```
sage: 
sage: math.floor(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
sage: math.ceil(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
```
   hence there is a bit of contradiction here.

- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point

```
sage: cos(1.0r)
0.5403023058681398
sage: type(_)
<type 'float'>
```



---

archive/issue_comments_325648.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nYou may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.",
    "created_at": "2017-09-19T12:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325648",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

You may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.



---

archive/issue_comments_325649.json:
```json
{
    "body": "Changed commit from **[`554fa62`](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)** to **[`5f6b998`](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)**",
    "created_at": "2017-09-19T13:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325649",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`554fa62`](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)** to **[`5f6b998`](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)**



---

archive/issue_comments_325650.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739\"><code>5f6b998</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T13:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325650",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739"><code>5f6b998</code></a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_325651.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nDoes not apply.",
    "created_at": "2017-11-28T07:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325651",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">comment:32</div>

Does not apply.



---

archive/issue_events_309204.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T07:11:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309204"
}
```



---

archive/issue_events_309205.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T07:11:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309205"
}
```



---

archive/issue_comments_325652.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nDo you plan to review this ticket if I fix the conflict?",
    "created_at": "2017-11-28T08:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325652",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Do you plan to review this ticket if I fix the conflict?



---

archive/issue_comments_325653.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nYes. It's time to get that done.",
    "created_at": "2017-11-28T09:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325653",
    "user": "https://github.com/rwst"
}
```

<div id="comment:34" align="right">comment:34</div>

Yes. It's time to get that done.



---

archive/issue_comments_325654.json:
```json
{
    "body": "Changed commit from **[`5f6b998`](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)** to **[`3678400`](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)**",
    "created_at": "2017-11-28T09:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325654",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f6b998`](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)** to **[`3678400`](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)**



---

archive/issue_comments_325655.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72\"><code>3678400</code></a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325655",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72"><code>3678400</code></a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_325656.json:
```json
{
    "body": "Changed commit from **[`3678400`](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)** to **[`740930b`](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)**",
    "created_at": "2017-11-28T09:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325656",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3678400`](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)** to **[`740930b`](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)**



---

archive/issue_comments_325657.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19\"><code>740930b</code></a></td><td><code>Fix comment</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325657",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19"><code>740930b</code></a></td><td><code>Fix comment</code></td></tr></table>




---

archive/issue_events_309206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T09:35:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309206"
}
```



---

archive/issue_events_309207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T09:35:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309207"
}
```



---

archive/issue_comments_325658.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nPatchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:\n- there is one typo (`immediatly`)\n- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest\n\n```\nsage: floor(log(4) / log(2))\n2\nsage: a = floor(5.4 + x); a\nfloor(x + 5.40000000000000)\nsage: a.subs(x==2)\n7\nsage: floor(log(2**(3/2)) / log(2) + 1/2)\n2\nsage: floor(log(2**(-3/2)) / log(2) + 1/2)\n-1\nsage: e1 = pi - continued_fraction(pi).convergent(2785)\nsage: e2 = e - continued_fraction(e).convergent(1500)\nsage: f = e1/e2\nsage: f = 1 / (f - continued_fraction(f).convergent(1000))\nsage: f = f - continued_fraction(f).convergent(1)\nsage: floor(f, bits=40000)\n-1\nsage: ceil(f, bits=40000)\n0\n```\nYou can set positive after the above changes. If you don't agree with my above criterion however then don't.\n\nFinally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:\n\n```\nsage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1\nsage: ceil(z, bits=400000)\n...fails\n```\nThis is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.",
    "created_at": "2017-11-28T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325658",
    "user": "https://github.com/rwst"
}
```

<div id="comment:38" align="right">comment:38</div>

Patchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:
- there is one typo (`immediatly`)
- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest

```
sage: floor(log(4) / log(2))
2
sage: a = floor(5.4 + x); a
floor(x + 5.40000000000000)
sage: a.subs(x==2)
7
sage: floor(log(2**(3/2)) / log(2) + 1/2)
2
sage: floor(log(2**(-3/2)) / log(2) + 1/2)
-1
sage: e1 = pi - continued_fraction(pi).convergent(2785)
sage: e2 = e - continued_fraction(e).convergent(1500)
sage: f = e1/e2
sage: f = 1 / (f - continued_fraction(f).convergent(1000))
sage: f = f - continued_fraction(f).convergent(1)
sage: floor(f, bits=40000)
-1
sage: ceil(f, bits=40000)
0
```
You can set positive after the above changes. If you don't agree with my above criterion however then don't.

Finally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:

```
sage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1
sage: ceil(z, bits=400000)
...fails
```
This is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.



---

archive/issue_events_309208.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309208"
}
```



---

archive/issue_events_309209.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309209"
}
```



---

archive/issue_comments_325659.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2017-11-28T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325659",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_325660.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac\"><code>727b99c</code></a></td><td><code>Fix comments and add tests</code></td></tr></table>\n",
    "created_at": "2017-11-29T15:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325660",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac"><code>727b99c</code></a></td><td><code>Fix comments and add tests</code></td></tr></table>




---

archive/issue_comments_325661.json:
```json
{
    "body": "Changed commit from **[`740930b`](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)** to **[`727b99c`](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)**",
    "created_at": "2017-11-29T15:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325661",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`740930b`](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)** to **[`727b99c`](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)**



---

archive/issue_events_309210.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T15:47:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309210"
}
```



---

archive/issue_events_309211.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T15:47:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309211"
}
```



---

archive/issue_comments_325662.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nconflicts with #22024",
    "created_at": "2017-12-02T23:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325662",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:41" align="right">comment:41</div>

conflicts with #22024



---

archive/issue_events_309212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-02T23:38:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309212"
}
```



---

archive/issue_events_309213.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-02T23:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309213"
}
```



---

archive/issue_comments_325663.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)** to **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)**",
    "created_at": "2017-12-03T15:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325663",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)** to **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)**



---

archive/issue_comments_325664.json:
```json
{
    "body": "Changed commit from **[`727b99c`](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)** to **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**",
    "created_at": "2017-12-03T15:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325664",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`727b99c`](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)** to **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**



---

archive/issue_events_309214.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-03T15:54:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309214"
}
```



---

archive/issue_events_309215.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-03T15:54:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309215"
}
```



---

archive/issue_comments_325665.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d\"><code>7f79a2d</code></a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36\"><code>ba171aa</code></a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e\"><code>8fddcfd</code></a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-12-03T15:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325665",
    "user": "https://github.com/rwst"
}
```

<div id="comment:43"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d"><code>7f79a2d</code></a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36"><code>ba171aa</code></a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e"><code>8fddcfd</code></a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_325666.json:
```json
{
    "body": "Changed branch from **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)** to **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**",
    "created_at": "2017-12-11T01:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-325666",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)** to **[`8fddcfd`](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**



---

archive/issue_events_309216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:04:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309216"
}
```



---

archive/issue_events_309217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "81af5ce824486bef0bf4e5564fd604570a5c93c8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-11T01:04:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-309217"
}
```
