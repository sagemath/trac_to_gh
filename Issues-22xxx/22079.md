# Issue 22079: New implementation of floor()/ceil()

archive/issues_021842.json:
```json
{
    "assignees": [],
    "body": "The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n\n```\nsage: ceil(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: ceil(Infinity)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\nand\n\n```\nsage: ceil(NaN)\n...\nTypeError: maximum recursion depth exceeded while calling a Python object\n```\n\nOne consequence is that conversion to `int` is also an infinite loop:\n\n```\nsage: int(SR(2^20000+1))\n(no answer....)\n```\nand\n\n```\nsage: int(NaN)\n...\nTypeError: maximum recursion depth exceeded in __instancecheck__\n```\n\nI propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n\nThis fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n\nCC:  @videlec @mezzarobba\n\nBranch/Commit: **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22079_\n\n",
    "closed_at": "2017-12-11T01:04:00Z",
    "created_at": "2016-12-19T16:36:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "New implementation of floor()/ceil()",
    "type": "issue",
    "updated_at": "2017-12-11T01:04:00Z",
    "url": "https://github.com/sagemath/sage/issues/22079",
    "user": "https://github.com/rwst"
}
```
The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.

```
sage: ceil(SR(2^20000+1))
(no answer....)
```
and

```
sage: ceil(Infinity)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```
and

```
sage: ceil(NaN)
...
TypeError: maximum recursion depth exceeded while calling a Python object
```

One consequence is that conversion to `int` is also an infinite loop:

```
sage: int(SR(2^20000+1))
(no answer....)
```
and

```
sage: int(NaN)
...
TypeError: maximum recursion depth exceeded in __instancecheck__
```

I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.

This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.

CC:  @videlec @mezzarobba

Branch/Commit: **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**

Reviewer: **Ralf Stephan**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/22079_





---

archive/issue_events_291235.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291235"
}
```



---

archive/issue_events_291236.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291236"
}
```



---

archive/issue_events_291237.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291237"
}
```



---

archive/issue_events_291238.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-19T16:36:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291238"
}
```



---

archive/issue_comments_328206.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: RealBallField(NaN)\n+sage: int(NaN)\n ...\n-TypeError: maximum recursion depth exceeded while calling a Python object\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n``````\n",
    "created_at": "2016-12-19T19:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328206",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: RealBallField(NaN)
+sage: int(NaN)
 ...
-TypeError: maximum recursion depth exceeded while calling a Python object
+TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
``````




---

archive/issue_events_291239.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:16:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "NaN -> int infinite loop",
    "title_was": "Arb NaN infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291239"
}
```



---

archive/issue_comments_328207.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.",
    "created_at": "2016-12-19T19:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328207",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'>Comment 2:</a>
This had nothing to do with arb. The problem is the conversion `NaN` -> Python `int`.



---

archive/issue_events_291240.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:22:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "ceil(NaN) infinite loop",
    "title_was": "NaN -> int infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291240"
}
```



---

archive/issue_comments_328208.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n \n ```\n-sage: int(NaN)\n+sage: ceil(NaN)\n ...\n-TypeError: maximum recursion depth exceeded in __instancecheck__\n+TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n``````\n",
    "created_at": "2016-12-19T19:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328208",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 
 ```
-sage: int(NaN)
+sage: ceil(NaN)
 ...
-TypeError: maximum recursion depth exceeded in __instancecheck__
+TypeError: maximum recursion depth exceeded while calling a Python object
 ```
``````




---

archive/issue_events_291241.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-19T19:29:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "Infinite loop in ceil() function",
    "title_was": "ceil(NaN) infinite loop",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291241"
}
```



---

archive/issue_comments_328209.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.\n+\n+```\n+sage: ceil(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n \n ```\n sage: ceil(NaN)\n``````\n",
    "created_at": "2016-12-19T19:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328209",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
+The `ceil` function calls itself if 20000 bits of precision is not enough, which is an obvious infinite loop.
+
+```
+sage: ceil(SR(2^20000+1))
+(no answer....)
+```
+and
 
 ```
 sage: ceil(NaN)
``````




---

archive/issue_comments_328210.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,13 @@\n and\n \n ```\n+sage: ceil(Infinity)\n+...\n+TypeError: maximum recursion depth exceeded while calling a Python object\n+```\n+and\n+\n+```\n sage: ceil(NaN)\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n``````\n",
    "created_at": "2016-12-19T19:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328210",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,13 @@
 and
 
 ```
+sage: ceil(Infinity)
+...
+TypeError: maximum recursion depth exceeded while calling a Python object
+```
+and
+
+```
 sage: ceil(NaN)
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
``````




---

archive/issue_comments_328211.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,17 @@\n ...\n TypeError: maximum recursion depth exceeded while calling a Python object\n ```\n+\n+One consequence is that conversion to `int` is also an infinite loop:\n+\n+```\n+sage: int(SR(2^20000+1))\n+(no answer....)\n+```\n+and\n+\n+```\n+sage: int(NaN)\n+...\n+TypeError: maximum recursion depth exceeded in __instancecheck__\n+```\n``````\n",
    "created_at": "2016-12-19T19:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328211",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,17 @@
 ...
 TypeError: maximum recursion depth exceeded while calling a Python object
 ```
+
+One consequence is that conversion to `int` is also an infinite loop:
+
+```
+sage: int(SR(2^20000+1))
+(no answer....)
+```
+and
+
+```
+sage: int(NaN)
+...
+TypeError: maximum recursion depth exceeded in __instancecheck__
+```
``````




---

archive/issue_comments_328212.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nWill hopefully be fixed by the rewrite in progress at #12121.",
    "created_at": "2016-12-19T19:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328212",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'>Comment 7:</a>
Will hopefully be fixed by the rewrite in progress at #12121.



---

archive/issue_comments_328213.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@mezzarobba](#comment%3A7):\n> Will hopefully be fixed by the rewrite in progress at #12121.\n\n... which is still not fixed.\n\nI just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?",
    "created_at": "2017-09-04T12:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@mezzarobba](#comment%3A7):
> Will hopefully be fixed by the rewrite in progress at #12121.

... which is still not fixed.

I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?



---

archive/issue_comments_328214.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,3 +32,5 @@\n ...\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n+\n+The same happens with `floor()`\n``````\n",
    "created_at": "2017-09-04T12:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328214",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,3 +32,5 @@
 ...
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
+
+The same happens with `floor()`
``````




---

archive/issue_comments_328215.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@jdemeyer](#comment%3A8):\n> I just got hit by this again. Do you have any objections to just remove the \"infinite loop\" block from `ceil()` and `floor()`?\n\nI don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)",
    "created_at": "2017-09-04T14:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328215",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@jdemeyer](#comment%3A8):
> I just got hit by this again. Do you have any objections to just remove the "infinite loop" block from `ceil()` and `floor()`?

I don't, but maybe you should ask Vincent. (I just rebased his code from #12121 to see how far we are from a solution there, more news on that hopefully after I run the tests!)



---

archive/issue_comments_328216.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI am also working on a proper solution both for this ticket and for #12121. Hang on...",
    "created_at": "2017-09-04T14:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328216",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
I am also working on a proper solution both for this ticket and for #12121. Hang on...



---

archive/issue_comments_328217.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@jdemeyer](#comment%3A10):\n> I am also working on a proper solution both for this ticket and for #12121. Hang on...\n\nOk. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.",
    "created_at": "2017-09-04T14:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328217",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@jdemeyer](#comment%3A10):
> I am also working on a proper solution both for this ticket and for #12121. Hang on...

Ok. I pushed the rebased branch (builds, not tested) to `u/mmezzarobba/ticket/12121-rebased` just in case.



---

archive/issue_comments_328218.json:
```json
{
    "body": "Branch: **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)**",
    "created_at": "2017-09-04T15:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328218",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)**



---

archive/issue_comments_328219.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -33,4 +33,4 @@\n TypeError: maximum recursion depth exceeded in __instancecheck__\n ```\n \n-The same happens with `floor()`\n+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n``````\n",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328219",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -33,4 +33,4 @@
 TypeError: maximum recursion depth exceeded in __instancecheck__
 ```
 
-The same happens with `floor()`
+I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
``````




---

archive/issue_events_291242.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-04T15:04:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291242"
}
```



---

archive/issue_comments_328220.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3\">4e1cd2c</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328220",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3">4e1cd2c</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_328221.json:
```json
{
    "body": "Commit: **[4e1cd2c](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)**",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328221",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[4e1cd2c](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)**



---

archive/issue_events_291243.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-04T15:04:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "title_is": "New implementation of floor()/ceil()",
    "title_was": "Infinite loop in ceil() function",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291243"
}
```



---

archive/issue_comments_328222.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-09-04T15:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328222",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_328223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,5 @@\n ```\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n+\n+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:06:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328223",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,5 @@
 ```
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
+
+This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_comments_328224.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,4 +35,4 @@\n \n I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.\n \n-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.\n``````\n",
    "created_at": "2017-09-04T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328224",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,4 +35,4 @@
 
 I propose a new implementation of `floor()` and `ceil()`. The basic idea is to remove the limit on the number of bits and instead put a limit on the number of attempts of computing the floor/ceil. In each attempt, the algorithm tries to determine *why* computing the floor/ceil did not work.
 
-This fixes all issues that I know with `floor()`/`ceil()`. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
+This fixes all issues that I know with the `floor()`/`ceil()` algorithm. Of course, the algorithm is still heuristic, so there will always be corner cases that won't work.
``````




---

archive/issue_events_291244.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291244"
}
```



---

archive/issue_events_291245.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291245"
}
```



---

archive/issue_events_291246.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291246"
}
```



---

archive/issue_events_291247.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T07:57:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291247"
}
```



---

archive/issue_comments_328225.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83\">b11c9ce</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-05T08:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328225",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83">b11c9ce</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_328226.json:
```json
{
    "body": "Changed commit from **[4e1cd2c](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)** to **[b11c9ce](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)**",
    "created_at": "2017-09-05T08:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328226",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4e1cd2c](https://github.com/sagemath/sagetrac-mirror/commit/4e1cd2cdeaa05a07fee8aabbcdb97b96266a17b3)** to **[b11c9ce](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)**



---

archive/issue_events_291248.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T08:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291248"
}
```



---

archive/issue_events_291249.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-05T08:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291249"
}
```



---

archive/issue_comments_328227.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nThis passes tests on the patchbot.",
    "created_at": "2017-09-05T11:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328227",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
This passes tests on the patchbot.



---

archive/issue_comments_328228.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nHow is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...\n\nI just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number\n\n```\nsage: n = continued_fraction(pi).convergent(20)\nsage: num = n.numerator()\nsage: den = n.denominator()\nsage: print bool(den*pi == num)\n```",
    "created_at": "2017-09-05T21:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328228",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>Comment 21:</a>
How is this different from the function `incremental_rounding` of #12121 (that proposes a useful `maximum_bits` argument)!? It would be definitely more coherent to work on only one ticket...

I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring. Did you know that pi was a rational number

```
sage: n = continued_fraction(pi).convergent(20)
sage: num = n.numerator()
sage: den = n.denominator()
sage: print bool(den*pi == num)
```



---

archive/issue_comments_328229.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nHave you opened a bug ticket?",
    "created_at": "2017-09-06T04:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328229",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'>Comment 22:</a>
Have you opened a bug ticket?



---

archive/issue_comments_328230.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@videlec](#comment%3A21):\n> It would be definitely more coherent to work on only one ticket...\n\nRight. It was not really my intention to start a \"competing\" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.",
    "created_at": "2017-09-06T07:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328230",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@videlec](#comment%3A21):
> It would be definitely more coherent to work on only one ticket...

Right. It was not really my intention to start a "competing" implementation. I initially intented to do a simple fix but then realized that a simple fix wasn't possible. So I continue working on my initially-simple fix until I ended up with this.



---

archive/issue_comments_328231.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@videlec](#comment%3A21):\n> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.\n\nMy branch doesn't require equality tests in the symbolic ring.",
    "created_at": "2017-09-06T07:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328231",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@videlec](#comment%3A21):
> I just stopped working on #12121 because of the unreliable equality tests of the symbolic ring.

My branch doesn't require equality tests in the symbolic ring.



---

archive/issue_comments_328232.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@videlec](#comment%3A21):\n> that proposes a useful `maximum_bits` argument\n\nRight, I do see the point of that.",
    "created_at": "2017-09-06T07:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328232",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@videlec](#comment%3A21):
> that proposes a useful `maximum_bits` argument

Right, I do see the point of that.



---

archive/issue_comments_328233.json:
```json
{
    "body": "Changed commit from **[b11c9ce](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)** to **[554fa62](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)**",
    "created_at": "2017-09-19T11:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328233",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b11c9ce](https://github.com/sagemath/sagetrac-mirror/commit/b11c9ce31e4e4866a9a9bdd140e1fc7600369a83)** to **[554fa62](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)**



---

archive/issue_comments_328234.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680\">554fa62</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T11:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328234",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680">554fa62</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_328235.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nNow with a `bits` argument (easier to type and less confusing than `maximum_bits`)\n\nSorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.",
    "created_at": "2017-09-19T11:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328235",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Now with a `bits` argument (easier to type and less confusing than `maximum_bits`)

Sorry for duplicating part of #12121. I did not intend to do that, it just ended up that way. Anyway, this ticket here fixes real problems so please consider it for review.



---

archive/issue_comments_328236.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\ntypo `the taregt number`",
    "created_at": "2017-09-19T12:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328236",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'>Comment 28:</a>
typo `the taregt number`



---

archive/issue_comments_328237.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nAbout\n\n```\nif isinstance(x, (float, complex)):\n    m = getattr(math, method)\n    return Integer(m(x))\n```\nTwo questions:\n\n- with complex inputs, the `math` library gives an error\n\n```\nsage: \nsage: math.floor(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\nsage: math.ceil(0jr)\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\n```\n   hence there is a bit of contradiction here.\n\n- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point\n\n```\nsage: cos(1.0r)\n0.5403023058681398\nsage: type(_)\n<type 'float'>\n```",
    "created_at": "2017-09-19T12:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328237",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'>Comment 29:</a>
About

```
if isinstance(x, (float, complex)):
    m = getattr(math, method)
    return Integer(m(x))
```
Two questions:

- with complex inputs, the `math` library gives an error

```
sage: 
sage: math.floor(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
sage: math.ceil(0jr)
Traceback (most recent call last):
...
TypeError: can't convert complex to float
```
   hence there is a bit of contradiction here.

- why would you convert to an `Integer` and not just use the result of whatever `math.floor`, `math.ceil` is actually giving you. That would be more Python friendly. As an example the result of `cos` is not a Sage floating point

```
sage: cos(1.0r)
0.5403023058681398
sage: type(_)
<type 'float'>
```



---

archive/issue_comments_328238.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nYou may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.",
    "created_at": "2017-09-19T12:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328238",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
You may or may not be right, but I consider that outside the scope of this ticket. I am not changing the return types or handling of complex numbers here.



---

archive/issue_comments_328239.json:
```json
{
    "body": "Changed commit from **[554fa62](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)** to **[5f6b998](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)**",
    "created_at": "2017-09-19T13:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328239",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[554fa62](https://github.com/sagemath/sagetrac-mirror/commit/554fa6211ad06bdc54fd944080e69cb53ef62680)** to **[5f6b998](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)**



---

archive/issue_comments_328240.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739\">5f6b998</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>\n",
    "created_at": "2017-09-19T13:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328240",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>Comment 31:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739">5f6b998</a></td><td><code>New implementation of floor/ceil</code></td></tr></table>




---

archive/issue_comments_328241.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nDoes not apply.",
    "created_at": "2017-11-28T07:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328241",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'>Comment 32:</a>
Does not apply.



---

archive/issue_events_291250.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T07:11:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291250"
}
```



---

archive/issue_events_291251.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T07:11:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291251"
}
```



---

archive/issue_comments_328242.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nDo you plan to review this ticket if I fix the conflict?",
    "created_at": "2017-11-28T08:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328242",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>Comment 33:</a>
Do you plan to review this ticket if I fix the conflict?



---

archive/issue_comments_328243.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nYes. It's time to get that done.",
    "created_at": "2017-11-28T09:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328243",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'>Comment 34:</a>
Yes. It's time to get that done.



---

archive/issue_comments_328244.json:
```json
{
    "body": "Changed commit from **[5f6b998](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)** to **[3678400](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)**",
    "created_at": "2017-11-28T09:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328244",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5f6b998](https://github.com/sagemath/sagetrac-mirror/commit/5f6b9984d500aed37ed8a8b618dcc70df5f97739)** to **[3678400](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)**



---

archive/issue_comments_328245.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72\">3678400</a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328245",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:35'>Comment 35:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72">3678400</a></td><td><code>Merge tag '8.1.rc3' into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_328246.json:
```json
{
    "body": "Changed commit from **[3678400](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)** to **[740930b](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)**",
    "created_at": "2017-11-28T09:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328246",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3678400](https://github.com/sagemath/sagetrac-mirror/commit/3678400db638d01a6447a1d8a2cef7e354e2bc72)** to **[740930b](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)**



---

archive/issue_comments_328247.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19\">740930b</a></td><td><code>Fix comment</code></td></tr></table>\n",
    "created_at": "2017-11-28T09:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328247",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19">740930b</a></td><td><code>Fix comment</code></td></tr></table>




---

archive/issue_events_291252.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T09:35:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291252"
}
```



---

archive/issue_events_291253.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T09:35:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291253"
}
```



---

archive/issue_comments_328248.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nPatchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:\n- there is one typo (`immediatly`)\n- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest\n\n```\nsage: floor(log(4) / log(2))\n2\nsage: a = floor(5.4 + x); a\nfloor(x + 5.40000000000000)\nsage: a.subs(x==2)\n7\nsage: floor(log(2**(3/2)) / log(2) + 1/2)\n2\nsage: floor(log(2**(-3/2)) / log(2) + 1/2)\n-1\nsage: e1 = pi - continued_fraction(pi).convergent(2785)\nsage: e2 = e - continued_fraction(e).convergent(1500)\nsage: f = e1/e2\nsage: f = 1 / (f - continued_fraction(f).convergent(1000))\nsage: f = f - continued_fraction(f).convergent(1)\nsage: floor(f, bits=40000)\n-1\nsage: ceil(f, bits=40000)\n0\n```\nYou can set positive after the above changes. If you don't agree with my above criterion however then don't.\n\nFinally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:\n\n```\nsage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1\nsage: ceil(z, bits=400000)\n...fails\n```\nThis is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.",
    "created_at": "2017-11-28T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328248",
    "user": "https://github.com/rwst"
}
```

<a id='comment:38'>Comment 38:</a>
Patchbot is green, the documentation looks good. The code is well documented and improves the present implementation. This all represents my minimum criterion to include code in Sage. There are a few things I'd ask you to change/add:
- there is one typo (`immediatly`)
- the ticket makes #12121 mostly a duplicate, and it would be nice if you could add the most relevant doctests from there, I'd suggest

```
sage: floor(log(4) / log(2))
2
sage: a = floor(5.4 + x); a
floor(x + 5.40000000000000)
sage: a.subs(x==2)
7
sage: floor(log(2**(3/2)) / log(2) + 1/2)
2
sage: floor(log(2**(-3/2)) / log(2) + 1/2)
-1
sage: e1 = pi - continued_fraction(pi).convergent(2785)
sage: e2 = e - continued_fraction(e).convergent(1500)
sage: f = e1/e2
sage: f = 1 / (f - continued_fraction(f).convergent(1000))
sage: f = f - continued_fraction(f).convergent(1)
sage: floor(f, bits=40000)
-1
sage: ceil(f, bits=40000)
0
```
You can set positive after the above changes. If you don't agree with my above criterion however then don't.

Finally for a later ticket, one doctest from #12121 cannot be solved. I agree not everything can be solved. This one however would be easy if you had some heuristic to call QQbar on algebraic expressions:

```
sage: z = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1
sage: ceil(z, bits=400000)
...fails
```
This is still better than current Sage so we should think of a way to limit or predict the effort QQbar is making, e.g. by predicting the degree of the minimal polynomial involved and calling QQbar from `floor()` when it does not take forever.



---

archive/issue_events_291254.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291254"
}
```



---

archive/issue_events_291255.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-28T15:21:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291255"
}
```



---

archive/issue_comments_328249.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2017-11-28T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328249",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_328250.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac\">727b99c</a></td><td><code>Fix comments and add tests</code></td></tr></table>\n",
    "created_at": "2017-11-29T15:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328250",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac">727b99c</a></td><td><code>Fix comments and add tests</code></td></tr></table>




---

archive/issue_comments_328251.json:
```json
{
    "body": "Changed commit from **[740930b](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)** to **[727b99c](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)**",
    "created_at": "2017-11-29T15:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328251",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[740930b](https://github.com/sagemath/sagetrac-mirror/commit/740930b09b183c439ae422f176a5f23f93a7ad19)** to **[727b99c](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)**



---

archive/issue_events_291256.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T15:47:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291256"
}
```



---

archive/issue_events_291257.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T15:47:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291257"
}
```



---

archive/issue_comments_328252.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nconflicts with #22024",
    "created_at": "2017-12-02T23:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328252",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'>Comment 41:</a>
conflicts with #22024



---

archive/issue_events_291258.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-02T23:38:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291258"
}
```



---

archive/issue_events_291259.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-02T23:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291259"
}
```



---

archive/issue_comments_328253.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)** to **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)**",
    "created_at": "2017-12-03T15:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328253",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/jdemeyer/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/infinite_loop_in_ceil___function)** to **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)**



---

archive/issue_comments_328254.json:
```json
{
    "body": "Changed commit from **[727b99c](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)** to **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**",
    "created_at": "2017-12-03T15:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328254",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[727b99c](https://github.com/sagemath/sagetrac-mirror/commit/727b99caf6f7b28728f42260b5f64ba2835957ac)** to **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**



---

archive/issue_events_291260.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-03T15:54:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291260"
}
```



---

archive/issue_events_291261.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-03T15:54:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291261"
}
```



---

archive/issue_comments_328255.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d\">7f79a2d</a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36\">ba171aa</a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e\">8fddcfd</a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>\n",
    "created_at": "2017-12-03T15:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328255",
    "user": "https://github.com/rwst"
}
```

<a id='comment:43'>Comment 43:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f79a2d6689340fd67dbb437d68386ce783f829d">7f79a2d</a></td><td><code>Merge branch 'u/rws/24062' of git://trac.sagemath.org/sage into t/22024/symbolic_placeholder_for_complex_root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba171aa7029e35a6c444691376cad801e082ab36">ba171aa</a></td><td><code>22024: symbolic placeholder for complex root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e">8fddcfd</a></td><td><code>Merge branch 'u/rws/symbolic_placeholder_for_complex_root' of git://trac.sagemath.org/sage into t/22079/infinite_loop_in_ceil___function</code></td></tr></table>




---

archive/issue_comments_328256.json:
```json
{
    "body": "Changed branch from **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)** to **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**",
    "created_at": "2017-12-11T01:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22079#issuecomment-328256",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/infinite_loop_in_ceil___function](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/infinite_loop_in_ceil___function)** to **[8fddcfd](https://github.com/sagemath/sagetrac-mirror/commit/8fddcfd99c77664454e283390379aa2118c5f45e)**



---

archive/issue_events_291262.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:04:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291262"
}
```



---

archive/issue_events_291263.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "81af5ce824486bef0bf4e5564fd604570a5c93c8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-11T01:04:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22079",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22079#event-291263"
}
```
