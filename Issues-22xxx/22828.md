# Issue 22828: py3: rich comparison for asymptotic term monoid

archive/issues_022591.json:
```json
{
    "body": "as another step towards python3\n\nThe asymptotic/ folder needs a clean-up of its handling of comparison, for correct insertion in the coercion framework and compatibility with python3 (use of rich comparison)\n\n**CC:**  @cheuberg @behackl @dkrenn\n\n**Branch/Commit:** [69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)\n\n**Reviewer:** Daniel Krenn, Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Daniel Krenn\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22828\n\n",
    "closed_at": "2017-05-02T22:12:36Z",
    "created_at": "2017-04-18T19:46:38Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "py3: rich comparison for asymptotic term monoid",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22828",
    "user": "https://github.com/fchapoton"
}
```
as another step towards python3

The asymptotic/ folder needs a clean-up of its handling of comparison, for correct insertion in the coercion framework and compatibility with python3 (use of rich comparison)

**CC:**  @cheuberg @behackl @dkrenn

**Branch/Commit:** [69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)

**Reviewer:** Daniel Krenn, Frédéric Chapoton

**Author:** Frédéric Chapoton, Daniel Krenn

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/22828





---

archive/issue_comments_428898.json:
```json
{
    "body": "**Commit:** [0e790b08aab3898c846faab3f29f6ce45b83df71](https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71)",
    "created_at": "2017-04-18T19:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428898",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [0e790b08aab3898c846faab3f29f6ce45b83df71](https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71)



---

archive/issue_comments_428899.json:
```json
{
    "body": "<a id='comment:1'></a>\nwork in progress\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71\">0e790b0</a></td><td><code>rich comparison for asymptotic term monoid</code></td></tr></table>\n",
    "created_at": "2017-04-18T19:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428899",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
work in progress

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71">0e790b0</a></td><td><code>rich comparison for asymptotic term monoid</code></td></tr></table>




---

archive/issue_comments_428900.json:
```json
{
    "body": "**Branch:** [u/chapoton/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22828)",
    "created_at": "2017-04-18T19:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428900",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22828)



---

archive/issue_comments_428901.json:
```json
{
    "body": "**Changing commit** from \"[0e790b08aab3898c846faab3f29f6ce45b83df71](https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71)\" to \"[7497d362f39547dff48c526b17561c2836dad761](https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761)\".",
    "created_at": "2017-04-19T19:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0e790b08aab3898c846faab3f29f6ce45b83df71](https://github.com/sagemath/sagetrac-mirror/commit/0e790b08aab3898c846faab3f29f6ce45b83df71)" to "[7497d362f39547dff48c526b17561c2836dad761](https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761)".



---

archive/issue_comments_428902.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761\">7497d36</a></td><td><code>trac 22828 more work, not yet finished</code></td></tr></table>\n",
    "created_at": "2017-04-19T19:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761">7497d36</a></td><td><code>trac 22828 more work, not yet finished</code></td></tr></table>




---

archive/issue_comments_428903.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339\">4c8c318</a></td><td><code>trac 22828 even more work, not yet ok</code></td></tr></table>\n",
    "created_at": "2017-04-19T19:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339">4c8c318</a></td><td><code>trac 22828 even more work, not yet ok</code></td></tr></table>




---

archive/issue_comments_428904.json:
```json
{
    "body": "**Changing commit** from \"[7497d362f39547dff48c526b17561c2836dad761](https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761)\" to \"[4c8c3180e1e5ab42c3d2df1a188bc14234816339](https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339)\".",
    "created_at": "2017-04-19T19:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7497d362f39547dff48c526b17561c2836dad761](https://github.com/sagemath/sagetrac-mirror/commit/7497d362f39547dff48c526b17561c2836dad761)" to "[4c8c3180e1e5ab42c3d2df1a188bc14234816339](https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339)".



---

archive/issue_comments_428905.json:
```json
{
    "body": "**Changing commit** from \"[4c8c3180e1e5ab42c3d2df1a188bc14234816339](https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339)\" to \"[efd771d1245275d6a02df85d6681e8063dfc2e8e](https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e)\".",
    "created_at": "2017-04-19T19:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4c8c3180e1e5ab42c3d2df1a188bc14234816339](https://github.com/sagemath/sagetrac-mirror/commit/4c8c3180e1e5ab42c3d2df1a188bc14234816339)" to "[efd771d1245275d6a02df85d6681e8063dfc2e8e](https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e)".



---

archive/issue_comments_428906.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e\">efd771d</a></td><td><code>trac 22828 work again, not the end</code></td></tr></table>\n",
    "created_at": "2017-04-19T19:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e">efd771d</a></td><td><code>trac 22828 work again, not the end</code></td></tr></table>




---

archive/issue_comments_428907.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n as another step towards python3\n+\n+The asymptotic/ folder needs a clean-up of its handling of comparison, for correct insertion in the coercion framework and compatibility with python3 (use of rich comparison)\n``````\n",
    "created_at": "2017-04-19T19:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428907",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 as another step towards python3
+
+The asymptotic/ folder needs a clean-up of its handling of comparison, for correct insertion in the coercion framework and compatibility with python3 (use of rich comparison)
``````




---

archive/issue_comments_428908.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82\">3660668</a></td><td><code>trac 22828 fix imports</code></td></tr></table>\n",
    "created_at": "2017-04-19T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82">3660668</a></td><td><code>trac 22828 fix imports</code></td></tr></table>




---

archive/issue_comments_428909.json:
```json
{
    "body": "**Changing commit** from \"[efd771d1245275d6a02df85d6681e8063dfc2e8e](https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e)\" to \"[366066890786c51cacdfda64edafe82bb2bd9e82](https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82)\".",
    "created_at": "2017-04-19T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[efd771d1245275d6a02df85d6681e8063dfc2e8e](https://github.com/sagemath/sagetrac-mirror/commit/efd771d1245275d6a02df85d6681e8063dfc2e8e)" to "[366066890786c51cacdfda64edafe82bb2bd9e82](https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82)".



---

archive/issue_comments_428910.json:
```json
{
    "body": "<a id='comment:7'></a>\nI'll have a look at the changes in the next days.",
    "created_at": "2017-04-20T08:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428910",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:7'></a>
I'll have a look at the changes in the next days.



---

archive/issue_comments_428911.json:
```json
{
    "body": "<a id='comment:8'></a>\nA quick question ahead: Why is something like\n\n```\ndef _richcmp_(self, other, op):\n    if not isinstance(other, GenericGrowthElement):\n        return op == op_NE\n```\nneeded? Shouldn't `_richcmp_` always get elements with the same parent (by the coercion model), thus elements that are already directly comparable (and the code not needed)?",
    "created_at": "2017-04-20T14:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428911",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:8'></a>
A quick question ahead: Why is something like

```
def _richcmp_(self, other, op):
    if not isinstance(other, GenericGrowthElement):
        return op == op_NE
```
needed? Shouldn't `_richcmp_` always get elements with the same parent (by the coercion model), thus elements that are already directly comparable (and the code not needed)?



---

archive/issue_comments_428912.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22828)\" to \"[u/dkrenn/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/22828)\".",
    "created_at": "2017-04-21T06:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428912",
    "user": "https://github.com/dkrenn"
}
```

**Changing branch** from "[u/chapoton/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22828)" to "[u/dkrenn/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/22828)".



---

archive/issue_comments_428913.json:
```json
{
    "body": "**Reviewer:** Daniel Krenn",
    "created_at": "2017-04-21T06:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428913",
    "user": "https://github.com/dkrenn"
}
```

**Reviewer:** Daniel Krenn



---

archive/issue_comments_428914.json:
```json
{
    "body": "**Changing commit** from \"[366066890786c51cacdfda64edafe82bb2bd9e82](https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82)\" to \"[9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf](https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf)\".",
    "created_at": "2017-04-21T06:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428914",
    "user": "https://github.com/dkrenn"
}
```

**Changing commit** from "[366066890786c51cacdfda64edafe82bb2bd9e82](https://github.com/sagemath/sagetrac-mirror/commit/366066890786c51cacdfda64edafe82bb2bd9e82)" to "[9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf](https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf)".



---

archive/issue_comments_428915.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Daniel Krenn\".",
    "created_at": "2017-04-21T06:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428915",
    "user": "https://github.com/dkrenn"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Daniel Krenn".



---

archive/issue_comments_428916.json:
```json
{
    "body": "<a id='comment:10'></a>\nDear Fr\u00e9d\u00e9ric, I've reviewed your changes, but see comments below this list for a possible future of this ticket:\n\n- Some doctests did not pass (see also the following comments); however, as this ticket was not set to \"needs review\", I assume that these were just not investigated yet.\n\n- asymptotics_multi...: LGTM, but see comment below this list.\n\n- growth_group.py, line 1196:\n\n```\nreturn richcmp(self._raw_element_, other._raw_element_, op)\n```\nThis does not make sense for a `GenericGrowthElement` (as there is no `<` on it defined).\n\n- growth_group.py, line 3643: The following was rewritten, but the new code is not equivalent to the old:\n\n```\n        return bool(abs(self.base) < abs(other.base)) or \\\n               bool(self.base == other.base)\n```\nvs\n\n```\n        if not isinstance(other, ExponentialGrowthElement):\n            return op == op_NE\n\n        lx = self.base\n        ly = other.base\n        if lx == ly:\n            return rich_to_bool(op, 0)\n\n        return richcmp(abs(lx), abs(ly), op)\n```\nFor example: `self.base=1`, `other.base=-1`, `op=op_LE` would incorrectly return `True`.\nI think, that this is the origin of the failing doctests.\n\n- term_monoid.py, lines 2915-2933: Maybe a matter of taste, but it looks like the code has blown up quite much (there is even some code doubling); this does not improve readability.\n\n- The patchbot reports also this:\n\n```\nFile \"src/sage/calculus/calculus.py\", line 1406, in sage.calculus.calculus.laplace\nFailed example:\n    laplace(t^n, t, s, algorithm='giac')\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: Unable to parse Giac output: integrate(t^n*exp(-s*t),t,0,+infinity)\nGot:\n    integration(t^n*e^(-s*t), t, 0, +Infinity)\n```\nI have no glue why this is failing. I cannot imagine that this comes from the changes of this ticket. Any ideas?\n\nWhen the asymptotic expansion module was written, I had the change in comparison in my mind and tried to prepare everything for it, so that it will be easy at one point. This point seems to be now; I've partially reverted your changes and have prepared a own patch to address the issues of this ticket.\nOverall, the code now is much cleaner (compared to the original code) and I am satisified with it.\n\n- Can you please check: Is this is now still Python3 comparision-compatible? (I think so, but it is surely easier for you to tell. ;)\n\n- The main change was to introduce a kind of low-level `_richcmp_` which can be used more broadly. As a consequence only high-level `_eq_` and `_lt_` (very close to the Python 3 recommendation on how to implement comparison, but single underscores to use SageMath's convention on coercion) have to be implemented. I think this is a very convenient to implement new partial orders.\n\n- In asymptotics_multi..., I've deleted the the comparison `<`, as it is mathematically not meaningful and only needed in filtering out multiple factors in the denominator. There is now used a key, where this sorting is needed.\n \n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a7c31092db1213987020cac7aedc66434c2f49e\">9a7c310</a></td><td><code>Revert \"trac 22828 more work, not yet finished\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24df411ec6fb676fd79027e9889285e2edacad02\">24df411</a></td><td><code>Revert \"rich comparison for asymptotic term monoid\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8841fbb8ac452fdd840baa26cf5cea9739ecd1e\">d8841fb</a></td><td><code>Trac #22828: richcmp via _lt_ and _eq_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78938a522b5abae6a2c949a6c343d5a2f1ab4b2c\">78938a5</a></td><td><code>Trac #22828: re-do and revert reverted clean-up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b33fe1d880b3a6bbe8ad7993a5d4ae5cb6daf399\">b33fe1d</a></td><td><code>Trac #22828: rewrite to use _richcmp_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77f9f96dc5401318cb355fcb2a7ecb9f62817b8b\">77f9f96</a></td><td><code>Trac #22828: use _richcmp_ in asymptotics_multivariate_generating_functions and get rid of mathematically senseless __lt__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b497604e328966539b4e18bf5298e466c0565362\">b497604</a></td><td><code>Trac #22828: test that no < comparison is possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ada528c89fc3c3fea04c22a910b107665f716e3\">6ada528</a></td><td><code>Trac #22828: newlines according to PEP8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ee6f0b30d9c67a8f423db31bbf47e923b81bac4\">1ee6f0b</a></td><td><code>Trac #22828: update docs of _total_order_key_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf\">9b2a790</a></td><td><code>Trac #22828: write docs and doctests for richcmp_by_eq_and_lt</code></td></tr></table>\n",
    "created_at": "2017-04-21T06:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428916",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:10'></a>
Dear Frédéric, I've reviewed your changes, but see comments below this list for a possible future of this ticket:

- Some doctests did not pass (see also the following comments); however, as this ticket was not set to "needs review", I assume that these were just not investigated yet.

- asymptotics_multi...: LGTM, but see comment below this list.

- growth_group.py, line 1196:

```
return richcmp(self._raw_element_, other._raw_element_, op)
```
This does not make sense for a `GenericGrowthElement` (as there is no `<` on it defined).

- growth_group.py, line 3643: The following was rewritten, but the new code is not equivalent to the old:

```
        return bool(abs(self.base) < abs(other.base)) or \
               bool(self.base == other.base)
```
vs

```
        if not isinstance(other, ExponentialGrowthElement):
            return op == op_NE

        lx = self.base
        ly = other.base
        if lx == ly:
            return rich_to_bool(op, 0)

        return richcmp(abs(lx), abs(ly), op)
```
For example: `self.base=1`, `other.base=-1`, `op=op_LE` would incorrectly return `True`.
I think, that this is the origin of the failing doctests.

- term_monoid.py, lines 2915-2933: Maybe a matter of taste, but it looks like the code has blown up quite much (there is even some code doubling); this does not improve readability.

- The patchbot reports also this:

```
File "src/sage/calculus/calculus.py", line 1406, in sage.calculus.calculus.laplace
Failed example:
    laplace(t^n, t, s, algorithm='giac')
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Unable to parse Giac output: integrate(t^n*exp(-s*t),t,0,+infinity)
Got:
    integration(t^n*e^(-s*t), t, 0, +Infinity)
```
I have no glue why this is failing. I cannot imagine that this comes from the changes of this ticket. Any ideas?

When the asymptotic expansion module was written, I had the change in comparison in my mind and tried to prepare everything for it, so that it will be easy at one point. This point seems to be now; I've partially reverted your changes and have prepared a own patch to address the issues of this ticket.
Overall, the code now is much cleaner (compared to the original code) and I am satisified with it.

- Can you please check: Is this is now still Python3 comparision-compatible? (I think so, but it is surely easier for you to tell. ;)

- The main change was to introduce a kind of low-level `_richcmp_` which can be used more broadly. As a consequence only high-level `_eq_` and `_lt_` (very close to the Python 3 recommendation on how to implement comparison, but single underscores to use SageMath's convention on coercion) have to be implemented. I think this is a very convenient to implement new partial orders.

- In asymptotics_multi..., I've deleted the the comparison `<`, as it is mathematically not meaningful and only needed in filtering out multiple factors in the denominator. There is now used a key, where this sorting is needed.
 
---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a7c31092db1213987020cac7aedc66434c2f49e">9a7c310</a></td><td><code>Revert "trac 22828 more work, not yet finished"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24df411ec6fb676fd79027e9889285e2edacad02">24df411</a></td><td><code>Revert "rich comparison for asymptotic term monoid"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8841fbb8ac452fdd840baa26cf5cea9739ecd1e">d8841fb</a></td><td><code>Trac #22828: richcmp via _lt_ and _eq_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78938a522b5abae6a2c949a6c343d5a2f1ab4b2c">78938a5</a></td><td><code>Trac #22828: re-do and revert reverted clean-up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b33fe1d880b3a6bbe8ad7993a5d4ae5cb6daf399">b33fe1d</a></td><td><code>Trac #22828: rewrite to use _richcmp_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77f9f96dc5401318cb355fcb2a7ecb9f62817b8b">77f9f96</a></td><td><code>Trac #22828: use _richcmp_ in asymptotics_multivariate_generating_functions and get rid of mathematically senseless __lt__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b497604e328966539b4e18bf5298e466c0565362">b497604</a></td><td><code>Trac #22828: test that no < comparison is possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ada528c89fc3c3fea04c22a910b107665f716e3">6ada528</a></td><td><code>Trac #22828: newlines according to PEP8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ee6f0b30d9c67a8f423db31bbf47e923b81bac4">1ee6f0b</a></td><td><code>Trac #22828: update docs of _total_order_key_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf">9b2a790</a></td><td><code>Trac #22828: write docs and doctests for richcmp_by_eq_and_lt</code></td></tr></table>




---

archive/issue_comments_428917.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-04-21T06:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428917",
    "user": "https://github.com/dkrenn"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_428918.json:
```json
{
    "body": "**Changing commit** from \"[9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf](https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf)\" to \"[12eb632931b23787b8dc5597e05ff5bfc91aed0c](https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c)\".",
    "created_at": "2017-04-25T12:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf](https://github.com/sagemath/sagetrac-mirror/commit/9b2a790c5cb6ce7ef776056ecba0f31af62ad1bf)" to "[12eb632931b23787b8dc5597e05ff5bfc91aed0c](https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c)".



---

archive/issue_comments_428919.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c\">12eb632</a></td><td><code>Trac #22828: remove meaningless doctest</code></td></tr></table>\n",
    "created_at": "2017-04-25T12:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c">12eb632</a></td><td><code>Trac #22828: remove meaningless doctest</code></td></tr></table>




---

archive/issue_comments_428920.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [git](#comment%3A11):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c\">12eb632</a></td><td><code>Trac #22828: remove meaningless doctest</code></td></tr></table>\n\n\nIs again at needs_review.",
    "created_at": "2017-04-25T12:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428920",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:12'></a>
Replying to [git](#comment%3A11):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c">12eb632</a></td><td><code>Trac #22828: remove meaningless doctest</code></td></tr></table>


Is again at needs_review.



---

archive/issue_comments_428921.json:
```json
{
    "body": "<a id='comment:13'></a>\nProbably you should not care about the rubik failure, it should be a random thing.\n\nCould you please check that all tests pass in the asymptotic folder with this branch + the current branch of ticket #22297 ?",
    "created_at": "2017-04-27T15:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428921",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Probably you should not care about the rubik failure, it should be a random thing.

Could you please check that all tests pass in the asymptotic folder with this branch + the current branch of ticket #22297 ?



---

archive/issue_comments_428922.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [chapoton](#comment%3A13):\n> Probably you should not care about the rubik failure, it should be a random thing.\n\n\nI would guess so. I just find random failing doctests not very pleasing (from a global-SageMath-point-of-view).\n\n> Could you please check that all tests pass in the asymptotic folder with this branch + the current branch of ticket #22297 ?\n\n\nTests passed.",
    "created_at": "2017-04-27T17:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428922",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:14'></a>
Replying to [chapoton](#comment%3A13):
> Probably you should not care about the rubik failure, it should be a random thing.


I would guess so. I just find random failing doctests not very pleasing (from a global-SageMath-point-of-view).

> Could you please check that all tests pass in the asymptotic folder with this branch + the current branch of ticket #22297 ?


Tests passed.



---

archive/issue_comments_428923.json:
```json
{
    "body": "<a id='comment:15'></a>\nlooks ok, but you should not do that:\n\n```\n-from __future__ import absolute_import\n```\nplease add them back (at least twice), then you can set a positive review on my behalf.",
    "created_at": "2017-04-27T20:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428923",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
looks ok, but you should not do that:

```
-from __future__ import absolute_import
```
please add them back (at least twice), then you can set a positive review on my behalf.



---

archive/issue_comments_428924.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [chapoton](#comment%3A15):\n> looks ok, but you should not do that:\n> \n> ```\n> -from __future__ import absolute_import\n> ```\n> please add them back (at least twice), then you can set a positive review on my behalf.\n\n\nThey are just moved below the copyright notice. (I've taken this change just as it was in the original patch provided by you...)",
    "created_at": "2017-04-28T06:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428924",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:16'></a>
Replying to [chapoton](#comment%3A15):
> looks ok, but you should not do that:
> 
> ```
> -from __future__ import absolute_import
> ```
> please add them back (at least twice), then you can set a positive review on my behalf.


They are just moved below the copyright notice. (I've taken this change just as it was in the original patch provided by you...)



---

archive/issue_comments_428925.json:
```json
{
    "body": "<a id='comment:17'></a>\nok, indeed. sorry for the noise.\n\nThen let it be.",
    "created_at": "2017-04-28T06:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428925",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>
ok, indeed. sorry for the noise.

Then let it be.



---

archive/issue_comments_428926.json:
```json
{
    "body": "**Changing reviewer** from \"Daniel Krenn\" to \"Daniel Krenn, Fr\u00e9d\u00e9ric Chapoton\".",
    "created_at": "2017-04-28T06:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428926",
    "user": "https://github.com/fchapoton"
}
```

**Changing reviewer** from "Daniel Krenn" to "Daniel Krenn, Frédéric Chapoton".



---

archive/issue_comments_428927.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-04-28T06:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428927",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_428928.json:
```json
{
    "body": "<a id='comment:18'></a>\nPDF docs don't build",
    "created_at": "2017-04-29T08:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428928",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
PDF docs don't build



---

archive/issue_comments_428929.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-04-29T08:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428929",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_428930.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [vbraun](#comment%3A18):\n> PDF docs don't build\n\n\nThis is not caused by this ticket. Building the Pdf (tried for reference/asymptotic) fails in a clean 8.0.beta4. Moreover, it fails already in 8.0.beta2, but seems to work in 7.6.\nWhat has changed?",
    "created_at": "2017-04-29T09:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428930",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:19'></a>
Replying to [vbraun](#comment%3A18):
> PDF docs don't build


This is not caused by this ticket. Building the Pdf (tried for reference/asymptotic) fails in a clean 8.0.beta4. Moreover, it fails already in 8.0.beta2, but seems to work in 7.6.
What has changed?



---

archive/issue_comments_428931.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2017-04-29T09:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428931",
    "user": "https://github.com/dkrenn"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_428932.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[bb711eb](https://github.com/sagemath/sagetrac-mirror/commit/bb711ebf03261b90faac2ae6d7446d8d68b7b137)|`Merge tag '8.0.beta4' into t/22828/22828`|\n|[69ac798](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)|<code>Trac #22828: correct quotes: `...` by ``...`</code>|",
    "created_at": "2017-04-29T11:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428932",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[bb711eb](https://github.com/sagemath/sagetrac-mirror/commit/bb711ebf03261b90faac2ae6d7446d8d68b7b137)|`Merge tag '8.0.beta4' into t/22828/22828`|
|[69ac798](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)|<code>Trac #22828: correct quotes: `...` by ``...`</code>|



---

archive/issue_comments_428933.json:
```json
{
    "body": "**Changing commit** from \"[12eb632931b23787b8dc5597e05ff5bfc91aed0c](https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c)\" to \"[69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)\".",
    "created_at": "2017-04-29T11:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[12eb632931b23787b8dc5597e05ff5bfc91aed0c](https://github.com/sagemath/sagetrac-mirror/commit/12eb632931b23787b8dc5597e05ff5bfc91aed0c)" to "[69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)".



---

archive/issue_comments_428934.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2017-04-29T11:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428934",
    "user": "https://github.com/dkrenn"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_428935.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dkrenn](#comment%3A19):\n> Replying to [vbraun](#comment%3A18):\n> > PDF docs don't build\n\n> \n> This is not caused by this ticket. Building the Pdf (tried for reference/asymptotic) fails in a clean 8.0.beta4. Moreover, it fails already in 8.0.beta2, but seems to work in 7.6.\n> What has changed?\n\n\nOk, as this `iftex`-issue is now not anymore on my machine, I saw the true error (it is related to this ticket, sorry for my wrong assertion above) and changed it.",
    "created_at": "2017-04-29T11:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428935",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:21'></a>
Replying to [dkrenn](#comment%3A19):
> Replying to [vbraun](#comment%3A18):
> > PDF docs don't build

> 
> This is not caused by this ticket. Building the Pdf (tried for reference/asymptotic) fails in a clean 8.0.beta4. Moreover, it fails already in 8.0.beta2, but seems to work in 7.6.
> What has changed?


Ok, as this `iftex`-issue is now not anymore on my machine, I saw the true error (it is related to this ticket, sorry for my wrong assertion above) and changed it.



---

archive/issue_comments_428936.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-04-29T11:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428936",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_428937.json:
```json
{
    "body": "<a id='comment:22'></a>\nok, then",
    "created_at": "2017-04-29T11:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428937",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>
ok, then



---

archive/issue_comments_428938.json:
```json
{
    "body": "**Changing branch** from \"[u/dkrenn/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/22828)\" to \"[69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)\".",
    "created_at": "2017-05-02T22:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428938",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/dkrenn/22828](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/22828)" to "[69ac798f10445e8c30db25707531ef61a0aaba97](https://github.com/sagemath/sagetrac-mirror/commit/69ac798f10445e8c30db25707531ef61a0aaba97)".



---

archive/issue_events_067492.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-02T22:12:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22828#event-67492"
}
```



---

archive/issue_comments_428939.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-05-02T22:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22828#issuecomment-428939",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
