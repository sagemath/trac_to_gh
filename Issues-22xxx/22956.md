# Issue 22956: p-adic completions/Henselizations backed by exact rings

archive/issues_022719.json:
```json
{
    "body": "All p-adic rings currently available in Sage are backed by elements that consist of an approximation and a precision. It can sometimes be tedious to work with such elements since error propagation needs to be analyzed and many algorithms in Sage don't play nice with such inexact elements.\n\nThis ticket implements an exact alternative where p-adic rings are backed by absolute number fields. The idea is to use exact elements in number fields where possible and describe algebraic elements as limits of Mac Lane valuations (see #21869). Since computations in number fields (and in particular in relative extensions) are slow in Sage, extensions are always rewritten as isomorphic rings defined by an absolute number field with defining (Eisenstein) polynomials with small coefficients.\n\nA prototype of this exists as a standalone project https://github.com/saraedum/completion. The idea of this ticket is not necessarily to get this prototype into Sage but to track the few things that need to change in Sage for it to work (fast).\n\nOne can of course not expect arithmetic to be as fast as in the inexact p-adic rings but the approach seems to have its merits. With a few tweaks in Sage, this implementation can compute the degree 384 splitting field (unramified of degree 2) of a degree 12 polynomial over Q2 in less than three minutes.\n\n**Required changes to Sage** (~~that can not be monkey-patched;~~ the ones in parentheses are for better performance):\n\n**The attached branch contains all these changes.**\n\n1. Polynomials should not require coefficients to implement `__nonzero__` for printing. (#23020)\n2. Orders are not unique parents. (#24934)\n3. `PolynomialQuotientRing` should be a unique parent. (#22983)\n4. Do not sort factorizations (#25226)\n5. More polynomials need to be irreducible (#25227)\n6. Fix initialization problems of integer polynomials (#25228)\n7. (`is_irreducible` should be cached) (#23164)\n8. (`is_squarefree` should be cached) (#23182)\n9. (`is_irreducible` should be able to call `_is_irreducible_univariate_polynomial` on the base ring.) (#23168)\n10. (`is_squarefree` should be able to call `_is_squarefree_univariate_polynomial` on the base ring.) (#23169)\n11. (Ideal generators should be more stable (i.e., the generator of a principal ideal should be exactly the element that was used to create that ideal)) (#23170)\n12. (`gcd(a,a) is a` should be true for polynomials over number fields.) (#23171)\n13. (Remove `Element._cache_key` that someone forgot to delete when taking out `Element.__hash__`.) (#23173)\n\nCC:  @roed314 @xcaruso\n\nKeywords: sd86.5, sd87, padicIMA\n\nAuthor: Julian R\u00fcth\n\nBranch: u/saraedum/22956\n\nDependencies: #21869, #22983, #23020, #23164, #23168, #23169, #23170, #23171, #23173, #23182, #24934, #24655, #25226, #25227, #25228\n\nCommit: 7520220e3739038149ee2104c329f6a19ebd667e\n\nIssue created by migration from https://trac.sagemath.org/ticket/22956\n\n",
    "created_at": "2017-05-06T23:11:42Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "p-adic completions/Henselizations backed by exact rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22956",
    "user": "https://github.com/saraedum"
}
```
All p-adic rings currently available in Sage are backed by elements that consist of an approximation and a precision. It can sometimes be tedious to work with such elements since error propagation needs to be analyzed and many algorithms in Sage don't play nice with such inexact elements.

This ticket implements an exact alternative where p-adic rings are backed by absolute number fields. The idea is to use exact elements in number fields where possible and describe algebraic elements as limits of Mac Lane valuations (see #21869). Since computations in number fields (and in particular in relative extensions) are slow in Sage, extensions are always rewritten as isomorphic rings defined by an absolute number field with defining (Eisenstein) polynomials with small coefficients.

A prototype of this exists as a standalone project https://github.com/saraedum/completion. The idea of this ticket is not necessarily to get this prototype into Sage but to track the few things that need to change in Sage for it to work (fast).

One can of course not expect arithmetic to be as fast as in the inexact p-adic rings but the approach seems to have its merits. With a few tweaks in Sage, this implementation can compute the degree 384 splitting field (unramified of degree 2) of a degree 12 polynomial over Q2 in less than three minutes.

**Required changes to Sage** (~~that can not be monkey-patched;~~ the ones in parentheses are for better performance):

**The attached branch contains all these changes.**

1. Polynomials should not require coefficients to implement `__nonzero__` for printing. (#23020)
2. Orders are not unique parents. (#24934)
3. `PolynomialQuotientRing` should be a unique parent. (#22983)
4. Do not sort factorizations (#25226)
5. More polynomials need to be irreducible (#25227)
6. Fix initialization problems of integer polynomials (#25228)
7. (`is_irreducible` should be cached) (#23164)
8. (`is_squarefree` should be cached) (#23182)
9. (`is_irreducible` should be able to call `_is_irreducible_univariate_polynomial` on the base ring.) (#23168)
10. (`is_squarefree` should be able to call `_is_squarefree_univariate_polynomial` on the base ring.) (#23169)
11. (Ideal generators should be more stable (i.e., the generator of a principal ideal should be exactly the element that was used to create that ideal)) (#23170)
12. (`gcd(a,a) is a` should be true for polynomials over number fields.) (#23171)
13. (Remove `Element._cache_key` that someone forgot to delete when taking out `Element.__hash__`.) (#23173)

CC:  @roed314 @xcaruso

Keywords: sd86.5, sd87, padicIMA

Author: Julian RÃ¼th

Branch: u/saraedum/22956

Dependencies: #21869, #22983, #23020, #23164, #23168, #23169, #23170, #23171, #23173, #23182, #24934, #24655, #25226, #25227, #25228

Commit: 7520220e3739038149ee2104c329f6a19ebd667e

Issue created by migration from https://trac.sagemath.org/ticket/22956





---

archive/issue_comments_316855.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd86.5\".",
    "created_at": "2017-06-07T15:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22956#issuecomment-316855",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "sd86.5".



---

archive/issue_comments_316856.json:
```json
{
    "body": "Changing keywords from \"sd86.5\" to \"sd86.5, sd87\".",
    "created_at": "2017-07-17T17:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22956#issuecomment-316856",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd86.5" to "sd86.5, sd87".



---

archive/issue_comments_316857.json:
```json
{
    "body": "<a id='comment:20'></a>Last 10 new commits:",
    "created_at": "2018-04-23T10:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22956#issuecomment-316857",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:20'></a>Last 10 new commits:



---

archive/issue_comments_316858.json:
```json
{
    "body": "Changing keywords from \"sd86.5, sd87\" to \"sd86.5, sd87, padicIMA\".",
    "created_at": "2018-07-22T20:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22956#issuecomment-316858",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd86.5, sd87" to "sd86.5, sd87, padicIMA".



---

archive/issue_comments_316859.json:
```json
{
    "body": "<a id='comment:24'></a>Last 10 new commits:",
    "created_at": "2018-07-22T20:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22956#issuecomment-316859",
    "user": "https://github.com/roed314"
}
```

<a id='comment:24'></a>Last 10 new commits:
