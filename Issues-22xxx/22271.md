# Issue 22271: py3 prepare some cases of zip behaviour

archive/issues_022034.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nas another step to py3\n\n* take care of a reversed(zip()) in crystals\n* make sure that factorizations can handle iterators\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22271_\n\n",
    "closed_at": "2017-02-02T22:09:10Z",
    "created_at": "2017-01-29T10:38:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3 prepare some cases of zip behaviour",
    "type": "issue",
    "updated_at": "2017-02-02T22:09:10Z",
    "url": "https://github.com/sagemath/sage/issues/22271",
    "user": "https://github.com/fchapoton"
}
```
<div id="comment:0"></div>

as another step to py3

* take care of a reversed(zip()) in crystals
* make sure that factorizations can handle iterators

Component: **python3**

Author: **Frédéric Chapoton**

Branch/Commit: **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/22271_





---

archive/issue_events_308944.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T10:38:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308944"
}
```



---

archive/issue_events_308945.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T10:38:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308945"
}
```



---

archive/issue_events_308946.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T10:38:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308946"
}
```



---

archive/issue_events_308947.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T10:38:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308947"
}
```



---

archive/issue_events_308948.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T10:39:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308948"
}
```



---

archive/issue_comments_329172.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17\"><code>3ba3a01</code></a></td><td><code>py3: handle some cases of zip behaviour</code></td></tr></table>\n",
    "created_at": "2017-01-29T10:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329172",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17"><code>3ba3a01</code></a></td><td><code>py3: handle some cases of zip behaviour</code></td></tr></table>




---

archive/issue_comments_329173.json:
```json
{
    "body": "Branch: **[u/chapoton/22271](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22271)**",
    "created_at": "2017-01-29T10:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329173",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/22271](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22271)**



---

archive/issue_comments_329174.json:
```json
{
    "body": "Commit: **[`3ba3a01`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17)**",
    "created_at": "2017-01-29T10:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329174",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`3ba3a01`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17)**



---

archive/issue_comments_329175.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs a general principle, I don't like code of the form\n\n```\ntry:\n    do_something()\nexcept E:\n    raise E(\"msg\")\n```\nEspecially if `msg` is meaningless or plain wrong. Just replace it by\n\n```\ndo_something()\n```\n(I am talking about the `raise TypeError(\"x must be a list\")` and also `raise TypeError(\"exponents of factors must be integers\")`)",
    "created_at": "2017-01-29T16:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329175",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

As a general principle, I don't like code of the form

```
try:
    do_something()
except E:
    raise E("msg")
```
Especially if `msg` is meaningless or plain wrong. Just replace it by

```
do_something()
```
(I am talking about the `raise TypeError("x must be a list")` and also `raise TypeError("exponents of factors must be integers")`)



---

archive/issue_events_308949.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-29T16:46:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308949"
}
```



---

archive/issue_events_308950.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-29T16:46:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308950"
}
```



---

archive/issue_comments_329176.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIn this case, you probably don't need the conversion to `list` at all, since `enumerate()` can handle iterables. This works without conversion to list:\n\n```\nsage: list(enumerate(xrange(5)))\n[(0, 0), (1, 1), (2, 2), (3, 3), (4, 4)]\n```",
    "created_at": "2017-01-29T16:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329176",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

In this case, you probably don't need the conversion to `list` at all, since `enumerate()` can handle iterables. This works without conversion to list:

```
sage: list(enumerate(xrange(5)))
[(0, 0), (1, 1), (2, 2), (3, 3), (4, 4)]
```



---

archive/issue_comments_329177.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThinking even more about it, why not replace this whole block\n\n```\n        if not isinstance(x, (list, tuple)):\n            try:\n                x = list(x)\n            except TypeError:\n                raise TypeError(\"x must be a list\")\n        for i, t in enumerate(x):\n            if not (isinstance(t, tuple) and len(t) == 2):\n                raise TypeError(\"x must be a list of pairs (p, e) with e an integer\")\n            try:\n                x[i] = (t[0], Integer(t[1]))\n            except TypeError:\n                raise TypeError(\"exponents of factors must be integers\")\n```\nby the one-liner\n\n```\nx = [(p, Integer(e)) for (p,e) in x]\n```",
    "created_at": "2017-01-29T17:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329177",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Thinking even more about it, why not replace this whole block

```
        if not isinstance(x, (list, tuple)):
            try:
                x = list(x)
            except TypeError:
                raise TypeError("x must be a list")
        for i, t in enumerate(x):
            if not (isinstance(t, tuple) and len(t) == 2):
                raise TypeError("x must be a list of pairs (p, e) with e an integer")
            try:
                x[i] = (t[0], Integer(t[1]))
            except TypeError:
                raise TypeError("exponents of factors must be integers")
```
by the one-liner

```
x = [(p, Integer(e)) for (p,e) in x]
```



---

archive/issue_comments_329178.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332\"><code>bbe4117</code></a></td><td><code>trac 22271 code simplified</code></td></tr></table>\n",
    "created_at": "2017-01-29T17:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329178",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332"><code>bbe4117</code></a></td><td><code>trac 22271 code simplified</code></td></tr></table>




---

archive/issue_comments_329179.json:
```json
{
    "body": "Changed commit from **[`3ba3a01`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17)** to **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**",
    "created_at": "2017-01-29T17:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329179",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3ba3a01`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3a01e150ebf53e87d8fb80a2ac73e5bab1b17)** to **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**



---

archive/issue_comments_329180.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\ngood idea, done.",
    "created_at": "2017-01-29T17:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329180",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

good idea, done.



---

archive/issue_events_308951.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T17:29:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308951"
}
```



---

archive/issue_events_308952.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-29T17:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308952"
}
```



---

archive/issue_comments_329181.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLet's wait for the patchbot.",
    "created_at": "2017-01-29T17:45:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329181",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Let's wait for the patchbot.



---

archive/issue_comments_329182.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nbot seems to be green",
    "created_at": "2017-01-29T21:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329182",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

bot seems to be green



---

archive/issue_comments_329183.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-01-30T08:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329183",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_308953.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-30T08:36:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308953"
}
```



---

archive/issue_events_308954.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-01-30T08:36:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308954"
}
```



---

archive/issue_comments_329184.json:
```json
{
    "body": "Changed branch from **[u/chapoton/22271](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22271)** to **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**",
    "created_at": "2017-02-02T22:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22271#issuecomment-329184",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/22271](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22271)** to **[`bbe4117`](https://github.com/sagemath/sagetrac-mirror/commit/bbe41176db974f43f5e28c99bb28fdb817f65332)**



---

archive/issue_events_308955.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-02T22:09:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308955"
}
```



---

archive/issue_events_308956.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "124d7f539edbbd95a5afebab64f67a22a02f2212",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-02-02T22:09:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22271",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22271#event-308956"
}
```
