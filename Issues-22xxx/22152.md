# Issue 22152: speed up generic polynomials

archive/issues_021915.json:
```json
{
    "assignees": [],
    "body": "Some hopefully representative examples:\n\n```\nQQi.<i> = QuadraticField(-1)\nPol.<x> = QQi[]\np = x + i + 1\nq = ( (8*i - 12)*x^10 + (-i + 2)*x^9 + (-i + 1)*x^8 + (-i + 7)*x^7 + (-i + 1)*x^6 + (-12*i + 2)*x^5 + (i + 1)*x^4 + (-7*i + 1)*x^3 + (2*i + 1)*x^2 + x - i - 2)\na = 42\nb = QQi(42)\nmat = matrix(QQi, [[1, i], [0,2]])\ny = polygen(Pol, 'y')\nfoo = y^2 + x + 1\nfl1 = 1.r\nRR1 = 1.\nfor cmd in [\n    'p*p',\n    'p**5',\n    'p._mul_trunc_(q, 3)',\n    'p(0)',\n    'q(0)',\n    'p(a)',\n    'p(b)',\n    'q(b)',\n    'q(fl1)',\n    'q(RR1)',\n    'q(a)',\n    'q(mat)',\n    'foo(x=1, y=2)',\n]:\n    timeit(cmd)\n```\n\n```\nsage: pol = MatrixSpace(ZZ, 1000, 1000)['x'].random_element(degree=10)\nsage: %timeit pol(42)\n```\n\nResults:\n\n```\ntest                  old      new\n--------------------------------------\np*p                   13.1 \u00b5s  8.14 \u00b5s\np**5                  53.7 \u00b5s  35.9 \u00b5s\np._mul_trunc_(q, 3)   17 \u00b5s    8.26 \u00b5s\np(0)                  3.49 \u00b5s  920 ns\nq(0)                  3.5 \u00b5s   877 ns\np(a)                  6.72 \u00b5s  3.78 \u00b5s\np(b)                  6.68 \u00b5s  2.48 \u00b5s\nq(b)                  13.8 \u00b5s  11.9 \u00b5s\nq(fl1)                7.47 ms  8.24 ms\nq(RR1)                7.48 ms  8.27 ms\nq(a)                  16.8 \u00b5s  15.8 \u00b5s\nq(mat)                290 \u00b5s   284 \u00b5s\nfoo(x=1, y=2)         64.1 \u00b5s  54 \u00b5s\n---------------------------------------\npol(42)               208 ms   202 ms\n```\n\n(Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)\n\nEdit: add up to ~0.5 \u00b5s to some of the above timings due to subsequent fixes.\n\nCC:  @JohnCremona @nbruin @simon-king-jena\n\nBranch: **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**\n\nReviewer: **Travis Scrimshaw, Marc Mezzarobba**\n\nAuthor: **Marc Mezzarobba, Travis Scrimshaw**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22152_\n\n",
    "closed_at": "2017-02-02T22:09:28Z",
    "created_at": "2017-01-08T10:21:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "speed up generic polynomials",
    "type": "issue",
    "updated_at": "2017-02-06T15:50:29Z",
    "url": "https://github.com/sagemath/sage/issues/22152",
    "user": "https://github.com/mezzarobba"
}
```
Some hopefully representative examples:

```
QQi.<i> = QuadraticField(-1)
Pol.<x> = QQi[]
p = x + i + 1
q = ( (8*i - 12)*x^10 + (-i + 2)*x^9 + (-i + 1)*x^8 + (-i + 7)*x^7 + (-i + 1)*x^6 + (-12*i + 2)*x^5 + (i + 1)*x^4 + (-7*i + 1)*x^3 + (2*i + 1)*x^2 + x - i - 2)
a = 42
b = QQi(42)
mat = matrix(QQi, [[1, i], [0,2]])
y = polygen(Pol, 'y')
foo = y^2 + x + 1
fl1 = 1.r
RR1 = 1.
for cmd in [
    'p*p',
    'p**5',
    'p._mul_trunc_(q, 3)',
    'p(0)',
    'q(0)',
    'p(a)',
    'p(b)',
    'q(b)',
    'q(fl1)',
    'q(RR1)',
    'q(a)',
    'q(mat)',
    'foo(x=1, y=2)',
]:
    timeit(cmd)
```

```
sage: pol = MatrixSpace(ZZ, 1000, 1000)['x'].random_element(degree=10)
sage: %timeit pol(42)
```

Results:

```
test                  old      new
--------------------------------------
p*p                   13.1 µs  8.14 µs
p**5                  53.7 µs  35.9 µs
p._mul_trunc_(q, 3)   17 µs    8.26 µs
p(0)                  3.49 µs  920 ns
q(0)                  3.5 µs   877 ns
p(a)                  6.72 µs  3.78 µs
p(b)                  6.68 µs  2.48 µs
q(b)                  13.8 µs  11.9 µs
q(fl1)                7.47 ms  8.24 ms
q(RR1)                7.48 ms  8.27 ms
q(a)                  16.8 µs  15.8 µs
q(mat)                290 µs   284 µs
foo(x=1, y=2)         64.1 µs  54 µs
---------------------------------------
pol(42)               208 ms   202 ms
```

(Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)

Edit: add up to ~0.5 µs to some of the above timings due to subsequent fixes.

CC:  @JohnCremona @nbruin @simon-king-jena

Branch: **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**

Reviewer: **Travis Scrimshaw, Marc Mezzarobba**

Author: **Marc Mezzarobba, Travis Scrimshaw**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/22152_





---

archive/issue_events_310143.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-08T10:21:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310143"
}
```



---

archive/issue_events_310144.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-08T10:21:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310144"
}
```



---

archive/issue_events_310145.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-08T10:21:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310145"
}
```



---

archive/issue_events_310146.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-08T10:21:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310146"
}
```



---

archive/issue_events_310147.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-08T14:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310147"
}
```



---

archive/issue_comments_326875.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06781342523a63e1476d0db63b4f0c42c006be59\"><code>0678134</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd\"><code>1fb9d27</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>\n",
    "created_at": "2017-01-11T15:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326875",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06781342523a63e1476d0db63b4f0c42c006be59"><code>0678134</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd"><code>1fb9d27</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>




---

archive/issue_comments_326876.json:
```json
{
    "body": "Changed commit from **[`9b7eec2`](https://github.com/sagemath/sagetrac-mirror/commit/9b7eec254e31c45e80cf0e81b9192e9152ccdf18)** to **[`1fb9d27`](https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd)**",
    "created_at": "2017-01-11T15:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326876",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9b7eec2`](https://github.com/sagemath/sagetrac-mirror/commit/9b7eec254e31c45e80cf0e81b9192e9152ccdf18)** to **[`1fb9d27`](https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd)**



---

archive/issue_comments_326877.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,30 +1,53 @@\n-Before:\n+Some hopefully representative examples:\n \n ```\n-sage: sage: QQi.<i> = QuadraticField(-1)\n-....: sage: Pol.<x> = QQi[]\n-....: sage: pol = x + i + 1\n-sage: %timeit pol*pol\n-The slowest run took 26.56 times longer than the fastest. This could mean that an intermediate result is being cached.\n-100000 loops, best of 3: 12.7 \u00b5s per loop\n-sage: %timeit pol**5\n-10000 loops, best of 3: 55.1 \u00b5s per loop\n-sage: %timeit pol._mul_trunc_(pol, 3)\n-The slowest run took 7.09 times longer than the fastest. This could mean that an intermediate result is being cached.\n-100000 loops, best of 3: 14.7 \u00b5s per loop\n+QQi.<i> = QuadraticField(-1)\n+Pol.<x> = QQi[]\n+p = x + i + 1\n+q = ( (8*i - 12)*x^10 + (-i + 2)*x^9 + (-i + 1)*x^8 + (-i + 7)*x^7 + (-i + 1)*x^6 + (-12*i + 2)*x^5 + (i + 1)*x^4 + (-7*i + 1)*x^3 + (2*i + 1)*x^2 + x - i - 2)\n+a = 42\n+b = QQi(42)\n+mat = matrix(QQi, [[1, i], [0,2]])\n+y = polygen(Pol, 'y')\n+foo = y^2 + x + 1\n+fl1 = 1.r\n+RR1 = 1.\n+for cmd in [\n+    'p*p',\n+    'p**5',\n+    'p._mul_trunc_(q, 3)',\n+    'p(0)',\n+    'q(0)',\n+    'p(a)',\n+    'p(b)',\n+    'q(b)',\n+    'q(fl1)',\n+    'q(RR1)',\n+    'q(a)',\n+    'q(mat)',\n+    'foo(x=1, y=2)',\n+]:\n+    timeit(cmd)\n ```\n-After:\n+\n+Results:\n \n ```\n-sage: sage: QQi.<i> = QuadraticField(-1)\n-....: sage: Pol.<x> = QQi[]\n-....: sage: pol = x + i + 1\n-sage: %timeit pol*pol\n-The slowest run took 8.00 times longer than the fastest. This could mean that an intermediate result is being cached.\n-100000 loops, best of 3: 8.14 \u00b5s per loop\n-sage: %timeit pol**5\n-10000 loops, best of 3: 34.3 \u00b5s per loop\n-sage: %timeit pol._mul_trunc_(pol, 3)\n-The slowest run took 8.56 times longer than the fastest. This could mean that an intermediate result is being cached.\n-100000 loops, best of 3: 6.88 \u00b5s per loop\n+test                  old      new\n+--------------------------------------\n+p*p                   13.1 \u00b5s  8.18 \u00b5s\n+p**5                  53.7 \u00b5s  37.4 \u00b5s\n+p._mul_trunc_(q, 3)   17 \u00b5s    8.29 \u00b5s\n+p(0)                  3.49 \u00b5s  840 ns\n+q(0)                  3.5 \u00b5s   817 ns\n+p(a)                  6.72 \u00b5s  3.33 \u00b5s\n+p(b)                  6.68 \u00b5s  2.68 \u00b5s\n+q(b)                  13.8 \u00b5s  11.8 \u00b5s\n+q(fl1)                7.47 ms  7.97 ms\n+q(RR1)                7.48 ms  7.75 ms\n+q(a)                  16.8 \u00b5s  12.3 \u00b5s\n+q(mat)                290 \u00b5s   282 \u00b5s\n+foo(x=1, y=2)         64.1 \u00b5s  53.9 \u00b5s\n ```\n+\n+(Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)\n``````\n",
    "created_at": "2017-01-11T15:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326877",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,30 +1,53 @@
-Before:
+Some hopefully representative examples:
 
 ```
-sage: sage: QQi.<i> = QuadraticField(-1)
-....: sage: Pol.<x> = QQi[]
-....: sage: pol = x + i + 1
-sage: %timeit pol*pol
-The slowest run took 26.56 times longer than the fastest. This could mean that an intermediate result is being cached.
-100000 loops, best of 3: 12.7 µs per loop
-sage: %timeit pol**5
-10000 loops, best of 3: 55.1 µs per loop
-sage: %timeit pol._mul_trunc_(pol, 3)
-The slowest run took 7.09 times longer than the fastest. This could mean that an intermediate result is being cached.
-100000 loops, best of 3: 14.7 µs per loop
+QQi.<i> = QuadraticField(-1)
+Pol.<x> = QQi[]
+p = x + i + 1
+q = ( (8*i - 12)*x^10 + (-i + 2)*x^9 + (-i + 1)*x^8 + (-i + 7)*x^7 + (-i + 1)*x^6 + (-12*i + 2)*x^5 + (i + 1)*x^4 + (-7*i + 1)*x^3 + (2*i + 1)*x^2 + x - i - 2)
+a = 42
+b = QQi(42)
+mat = matrix(QQi, [[1, i], [0,2]])
+y = polygen(Pol, 'y')
+foo = y^2 + x + 1
+fl1 = 1.r
+RR1 = 1.
+for cmd in [
+    'p*p',
+    'p**5',
+    'p._mul_trunc_(q, 3)',
+    'p(0)',
+    'q(0)',
+    'p(a)',
+    'p(b)',
+    'q(b)',
+    'q(fl1)',
+    'q(RR1)',
+    'q(a)',
+    'q(mat)',
+    'foo(x=1, y=2)',
+]:
+    timeit(cmd)
 ```
-After:
+
+Results:
 
 ```
-sage: sage: QQi.<i> = QuadraticField(-1)
-....: sage: Pol.<x> = QQi[]
-....: sage: pol = x + i + 1
-sage: %timeit pol*pol
-The slowest run took 8.00 times longer than the fastest. This could mean that an intermediate result is being cached.
-100000 loops, best of 3: 8.14 µs per loop
-sage: %timeit pol**5
-10000 loops, best of 3: 34.3 µs per loop
-sage: %timeit pol._mul_trunc_(pol, 3)
-The slowest run took 8.56 times longer than the fastest. This could mean that an intermediate result is being cached.
-100000 loops, best of 3: 6.88 µs per loop
+test                  old      new
+--------------------------------------
+p*p                   13.1 µs  8.18 µs
+p**5                  53.7 µs  37.4 µs
+p._mul_trunc_(q, 3)   17 µs    8.29 µs
+p(0)                  3.49 µs  840 ns
+q(0)                  3.5 µs   817 ns
+p(a)                  6.72 µs  3.33 µs
+p(b)                  6.68 µs  2.68 µs
+q(b)                  13.8 µs  11.8 µs
+q(fl1)                7.47 ms  7.97 ms
+q(RR1)                7.48 ms  7.75 ms
+q(a)                  16.8 µs  12.3 µs
+q(mat)                290 µs   282 µs
+foo(x=1, y=2)         64.1 µs  53.9 µs
 ```
+
+(Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)
``````




---

archive/issue_comments_326878.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe tests in `rings/` pass; I haven't yet run the whole test suite.",
    "created_at": "2017-01-11T15:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326878",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:3" align="right">comment:3</div>

The tests in `rings/` pass; I haven't yet run the whole test suite.



---

archive/issue_events_310148.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-11T15:47:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "title_is": "speed up generic polynomials",
    "title_was": "speed up generic polynomials a little",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310148"
}
```



---

archive/issue_comments_326879.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8\"><code>7488953</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>\n",
    "created_at": "2017-01-11T15:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326879",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8"><code>7488953</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>




---

archive/issue_comments_326880.json:
```json
{
    "body": "Changed commit from **[`1fb9d27`](https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd)** to **[`7488953`](https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8)**",
    "created_at": "2017-01-11T15:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326880",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1fb9d27`](https://github.com/sagemath/sagetrac-mirror/commit/1fb9d2737f5a9e454f25bf80a1eeef7b4825ccfd)** to **[`7488953`](https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8)**



---

archive/issue_comments_326881.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nLooks good overall. From a quick look through the code, it seems like the inputs to the `do_*` methods always take lists as inputs. Likewise, should we make `list` a `cpdef` method that guarantees a list being returned? This might get us some extra speed as well.",
    "created_at": "2017-01-11T18:07:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326881",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Looks good overall. From a quick look through the code, it seems like the inputs to the `do_*` methods always take lists as inputs. Likewise, should we make `list` a `cpdef` method that guarantees a list being returned? This might get us some extra speed as well.



---

archive/issue_comments_326882.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@tscrim](#comment:5):\n> Looks good overall. From a quick look through the code, it seems like the inputs to the `do_*` methods always take lists as inputs. Likewise, should we make `list` a `cpdef` method that guarantees a list being returned? This might get us some extra speed as well.\n\nThanks for the suggestion. Adding type annotations to `do_*` and brutally replacing `def list(...)` by `cdef list list(...)` everywhere actually seems to make things slower, though the difference is small. I didn't try to investigate any further. And I must confess that it is not at all clear to me what implications those `cdef` have with the relatively complex hierarchy of subclasses that override `list()` (sometimes from Cython, sometimes from Python, sometimes with additional arguments).",
    "created_at": "2017-01-11T20:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326882",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@tscrim](#comment:5):
> Looks good overall. From a quick look through the code, it seems like the inputs to the `do_*` methods always take lists as inputs. Likewise, should we make `list` a `cpdef` method that guarantees a list being returned? This might get us some extra speed as well.

Thanks for the suggestion. Adding type annotations to `do_*` and brutally replacing `def list(...)` by `cdef list list(...)` everywhere actually seems to make things slower, though the difference is small. I didn't try to investigate any further. And I must confess that it is not at all clear to me what implications those `cdef` have with the relatively complex hierarchy of subclasses that override `list()` (sometimes from Cython, sometimes from Python, sometimes with additional arguments).



---

archive/issue_comments_326883.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYou might be loosing some speed by variables not being cdef'ed as a list. Did you happen to save your current branch? I can play around with it later tonight to see if I can get some extra speed out of it.",
    "created_at": "2017-01-11T21:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326883",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

You might be loosing some speed by variables not being cdef'ed as a list. Did you happen to save your current branch? I can play around with it later tonight to see if I can get some extra speed out of it.



---

archive/issue_comments_326884.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI noticed a small problem with the last commit: it would cause terrible regression for cases like polynomials over large matrix spaces evaluated at scalars. I'll push a fix in a minute.\n\nReplying to [@tscrim](#comment:7):\n> You might be loosing some speed by variables not being cdef'ed as a list. Did you happen to save your current branch?\n\nYes, see `u/mmezzarobba/speed_up_generic_polynomials-alt`.",
    "created_at": "2017-01-12T08:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326884",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:8" align="right">comment:8</div>

I noticed a small problem with the last commit: it would cause terrible regression for cases like polynomials over large matrix spaces evaluated at scalars. I'll push a fix in a minute.

Replying to [@tscrim](#comment:7):
> You might be loosing some speed by variables not being cdef'ed as a list. Did you happen to save your current branch?

Yes, see `u/mmezzarobba/speed_up_generic_polynomials-alt`.



---

archive/issue_comments_326885.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900\"><code>25f884d</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>\n",
    "created_at": "2017-01-12T08:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326885",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900"><code>25f884d</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr></table>




---

archive/issue_comments_326886.json:
```json
{
    "body": "Changed commit from **[`7488953`](https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8)** to **[`25f884d`](https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900)**",
    "created_at": "2017-01-12T08:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326886",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7488953`](https://github.com/sagemath/sagetrac-mirror/commit/7488953070e2ee0f503c4b5a3258bc12492c9ee8)** to **[`25f884d`](https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900)**



---

archive/issue_comments_326887.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,24 +30,33 @@\n     timeit(cmd)\n ```\n \n+```\n+sage: pol = MatrixSpace(ZZ, 1000, 1000)['x'].random_element(degree=10)\n+sage: %timeit pol(42)\n+```\n+\n Results:\n \n ```\n test                  old      new\n --------------------------------------\n-p*p                   13.1 \u00b5s  8.18 \u00b5s\n-p**5                  53.7 \u00b5s  37.4 \u00b5s\n-p._mul_trunc_(q, 3)   17 \u00b5s    8.29 \u00b5s\n-p(0)                  3.49 \u00b5s  840 ns\n-q(0)                  3.5 \u00b5s   817 ns\n-p(a)                  6.72 \u00b5s  3.33 \u00b5s\n-p(b)                  6.68 \u00b5s  2.68 \u00b5s\n-q(b)                  13.8 \u00b5s  11.8 \u00b5s\n-q(fl1)                7.47 ms  7.97 ms\n-q(RR1)                7.48 ms  7.75 ms\n-q(a)                  16.8 \u00b5s  12.3 \u00b5s\n-q(mat)                290 \u00b5s   282 \u00b5s\n-foo(x=1, y=2)         64.1 \u00b5s  53.9 \u00b5s\n+p*p                   13.1 \u00b5s  8.14 \u00b5s\n+p**5                  53.7 \u00b5s  35.9 \u00b5s\n+p._mul_trunc_(q, 3)   17 \u00b5s    8.26 \u00b5s\n+p(0)                  3.49 \u00b5s  920 ns\n+q(0)                  3.5 \u00b5s   877 ns\n+p(a)                  6.72 \u00b5s  3.78 \u00b5s\n+p(b)                  6.68 \u00b5s  2.48 \u00b5s\n+q(b)                  13.8 \u00b5s  11.9 \u00b5s\n+q(fl1)                7.47 ms  8.24 ms\n+q(RR1)                7.48 ms  8.27 ms\n+q(a)                  16.8 \u00b5s  15.8 \u00b5s\n+q(mat)                290 \u00b5s   284 \u00b5s\n+foo(x=1, y=2)         64.1 \u00b5s  54 \u00b5s\n+---------------------------------------\n+pol(42)               208 ms   202 ms\n ```\n \n (Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)\n+\n+Edit: add up to ~0.5 \u00b5s to some of the above timings due to subsequent fixes.\n``````\n",
    "created_at": "2017-01-12T08:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326887",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,24 +30,33 @@
     timeit(cmd)
 ```
 
+```
+sage: pol = MatrixSpace(ZZ, 1000, 1000)['x'].random_element(degree=10)
+sage: %timeit pol(42)
+```
+
 Results:
 
 ```
 test                  old      new
 --------------------------------------
-p*p                   13.1 µs  8.18 µs
-p**5                  53.7 µs  37.4 µs
-p._mul_trunc_(q, 3)   17 µs    8.29 µs
-p(0)                  3.49 µs  840 ns
-q(0)                  3.5 µs   817 ns
-p(a)                  6.72 µs  3.33 µs
-p(b)                  6.68 µs  2.68 µs
-q(b)                  13.8 µs  11.8 µs
-q(fl1)                7.47 ms  7.97 ms
-q(RR1)                7.48 ms  7.75 ms
-q(a)                  16.8 µs  12.3 µs
-q(mat)                290 µs   282 µs
-foo(x=1, y=2)         64.1 µs  53.9 µs
+p*p                   13.1 µs  8.14 µs
+p**5                  53.7 µs  35.9 µs
+p._mul_trunc_(q, 3)   17 µs    8.26 µs
+p(0)                  3.49 µs  920 ns
+q(0)                  3.5 µs   877 ns
+p(a)                  6.72 µs  3.78 µs
+p(b)                  6.68 µs  2.48 µs
+q(b)                  13.8 µs  11.9 µs
+q(fl1)                7.47 ms  8.24 ms
+q(RR1)                7.48 ms  8.27 ms
+q(a)                  16.8 µs  15.8 µs
+q(mat)                290 µs   284 µs
+foo(x=1, y=2)         64.1 µs  54 µs
+---------------------------------------
+pol(42)               208 ms   202 ms
 ```
 
 (Evaluations at floating-point numbers are very slow, and suffer from a small regression, due to the slowness of the generic coercion map through `CLF`.)
+
+Edit: add up to ~0.5 µs to some of the above timings due to subsequent fixes.
``````




---

archive/issue_comments_326888.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI went through and made all of the `def list(self)` methods into `cpdef list list(self, bint copy=True)` to take advantage of the times when we don't have to copy the list and to specify the output type. This didn't give as much of a speed bump as I was expecting. I also made some other improvements by using `get_unsafe` and other things. Here are my timings:\n\nCurrent branch:\n\n```\n625 loops, best of 3: 6.68 \u00b5s per loop\n625 loops, best of 3: 29.2 \u00b5s per loop\n625 loops, best of 3: 6.77 \u00b5s per loop\n625 loops, best of 3: 739 ns per loop\n625 loops, best of 3: 699 ns per loop\n625 loops, best of 3: 3.3 \u00b5s per loop\n625 loops, best of 3: 2.23 \u00b5s per loop\n625 loops, best of 3: 10.4 \u00b5s per loop\n125 loops, best of 3: 7.11 ms per loop\n125 loops, best of 3: 7.1 ms per loop\n625 loops, best of 3: 13.2 \u00b5s per loop\n625 loops, best of 3: 247 \u00b5s per loop\n625 loops, best of 3: 46.7 \u00b5s per loop\n```\nvs my new branch\n\n```\n625 loops, best of 3: 6.5 \u00b5s per loop\n625 loops, best of 3: 28.6 \u00b5s per loop\n625 loops, best of 3: 6.64 \u00b5s per loop\n625 loops, best of 3: 739 ns per loop\n625 loops, best of 3: 737 ns per loop\n625 loops, best of 3: 3.13 \u00b5s per loop\n625 loops, best of 3: 2.19 \u00b5s per loop\n625 loops, best of 3: 10.6 \u00b5s per loop\n125 loops, best of 3: 6.88 ms per loop\n125 loops, best of 3: 6.84 ms per loop\n625 loops, best of 3: 13.4 \u00b5s per loop\n625 loops, best of 3: 240 \u00b5s per loop\n625 loops, best of 3: 44.4 \u00b5s per loop\n```\n\nThe small timings have too much variation to say there is a definitive regression. However, the arithmetic operations have improved.\n\nSomething else I noticed that probably could get us some speed is requiring *all* polynomials to have a `_new_constant_poly`. Currently only the dense ones have such a method. Shall we do that here?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f35563831d59ebdf36dbdd3935125244f037f5a3\"><code>f355638</code></a></td><td><code>wip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3878a287e0b77c1571db6beeed6df941275265f\"><code>b3878a2</code></a></td><td><code>Merge branch 'u/mmezzarobba/speed_up_generic_polynomials-alt' of git://trac.sagemath.org/sage into u/mmezzarobba/speed_up_generic_polynomials-alt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/526fdad08a8fefce2ac510340627bb0e2d889ae6\"><code>526fdad</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b53da5d0f2cc87a6dc0d92c51f09a40506b8b55\"><code>6b53da5</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7\"><code>a753217</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-12T21:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326888",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

I went through and made all of the `def list(self)` methods into `cpdef list list(self, bint copy=True)` to take advantage of the times when we don't have to copy the list and to specify the output type. This didn't give as much of a speed bump as I was expecting. I also made some other improvements by using `get_unsafe` and other things. Here are my timings:

Current branch:

```
625 loops, best of 3: 6.68 µs per loop
625 loops, best of 3: 29.2 µs per loop
625 loops, best of 3: 6.77 µs per loop
625 loops, best of 3: 739 ns per loop
625 loops, best of 3: 699 ns per loop
625 loops, best of 3: 3.3 µs per loop
625 loops, best of 3: 2.23 µs per loop
625 loops, best of 3: 10.4 µs per loop
125 loops, best of 3: 7.11 ms per loop
125 loops, best of 3: 7.1 ms per loop
625 loops, best of 3: 13.2 µs per loop
625 loops, best of 3: 247 µs per loop
625 loops, best of 3: 46.7 µs per loop
```
vs my new branch

```
625 loops, best of 3: 6.5 µs per loop
625 loops, best of 3: 28.6 µs per loop
625 loops, best of 3: 6.64 µs per loop
625 loops, best of 3: 739 ns per loop
625 loops, best of 3: 737 ns per loop
625 loops, best of 3: 3.13 µs per loop
625 loops, best of 3: 2.19 µs per loop
625 loops, best of 3: 10.6 µs per loop
125 loops, best of 3: 6.88 ms per loop
125 loops, best of 3: 6.84 ms per loop
625 loops, best of 3: 13.4 µs per loop
625 loops, best of 3: 240 µs per loop
625 loops, best of 3: 44.4 µs per loop
```

The small timings have too much variation to say there is a definitive regression. However, the arithmetic operations have improved.

Something else I noticed that probably could get us some speed is requiring *all* polynomials to have a `_new_constant_poly`. Currently only the dense ones have such a method. Shall we do that here?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f35563831d59ebdf36dbdd3935125244f037f5a3"><code>f355638</code></a></td><td><code>wip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3878a287e0b77c1571db6beeed6df941275265f"><code>b3878a2</code></a></td><td><code>Merge branch 'u/mmezzarobba/speed_up_generic_polynomials-alt' of git://trac.sagemath.org/sage into u/mmezzarobba/speed_up_generic_polynomials-alt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/526fdad08a8fefce2ac510340627bb0e2d889ae6"><code>526fdad</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b53da5d0f2cc87a6dc0d92c51f09a40506b8b55"><code>6b53da5</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7"><code>a753217</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326889.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-01-12T21:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326889",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_310149.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-12T21:45:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310149"
}
```



---

archive/issue_events_310150.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-12T21:45:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310150"
}
```



---

archive/issue_comments_326890.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)** to **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)**",
    "created_at": "2017-01-12T21:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326890",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)** to **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)**



---

archive/issue_comments_326891.json:
```json
{
    "body": "Changed commit from **[`25f884d`](https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900)** to **[`a753217`](https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7)**",
    "created_at": "2017-01-12T21:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326891",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`25f884d`](https://github.com/sagemath/sagetrac-mirror/commit/25f884d48ae7392c908231dfcaa1931b66cbe900)** to **[`a753217`](https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7)**



---

archive/issue_comments_326892.json:
```json
{
    "body": "Changed author from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**",
    "created_at": "2017-01-13T11:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326892",
    "user": "https://github.com/mezzarobba"
}
```

Changed author from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**



---

archive/issue_comments_326893.json:
```json
{
    "body": "Changed commit from **[`a753217`](https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7)** to **[`82554f9`](https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee)**",
    "created_at": "2017-01-13T11:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326893",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`a753217`](https://github.com/sagemath/sagetrac-mirror/commit/a75321719bd7de6637b740bf00c6f266e7acfda7)** to **[`82554f9`](https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee)**



---

archive/issue_comments_326894.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThanks for the improvements! I cleaned up the branch a little (rebased, squashed my \"wip\" commit into the following one) without changing the code.\n\nRegarding `_new_constant_poly()` for sparse polynomials: I really don't think I'll have time to make further changes until Feb.\u00a08 at best, though I'll do my best to review yours if you make some. In any case I'm happy with the current branch; you can set the ticket to positive review if you agree, assuming the patchbot doesn't find anything to complain about.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40cabedc052c1bdea258785a6217e8d8862bfd10\"><code>40cabed</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/425aa01115f074611e99a7bb50f4361587b085d4\"><code>425aa01</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edb148d6e7c4a2f797faf01c8600cc0dc0eaf620\"><code>edb148d</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4628080b239cb0cf945280a838e55f1a19b0b018\"><code>4628080</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/901e40ebb288c974351df101bf4aaa8b641c655e\"><code>901e40e</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67aadec19427bd318cf81fc16d19110795781e96\"><code>67aadec</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/856a74a7aac33f9e6a09000d97ec663ede222c64\"><code>856a74a</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bca84617f2effc4e32c47565b4b9744856c435a\"><code>6bca846</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04e89ae670d5ce91c30d14d2978c31e15aaea140\"><code>04e89ae</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee\"><code>82554f9</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-13T11:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326894",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:12" align="right">comment:12</div>

Thanks for the improvements! I cleaned up the branch a little (rebased, squashed my "wip" commit into the following one) without changing the code.

Regarding `_new_constant_poly()` for sparse polynomials: I really don't think I'll have time to make further changes until Feb. 8 at best, though I'll do my best to review yours if you make some. In any case I'm happy with the current branch; you can set the ticket to positive review if you agree, assuming the patchbot doesn't find anything to complain about.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40cabedc052c1bdea258785a6217e8d8862bfd10"><code>40cabed</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/425aa01115f074611e99a7bb50f4361587b085d4"><code>425aa01</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edb148d6e7c4a2f797faf01c8600cc0dc0eaf620"><code>edb148d</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4628080b239cb0cf945280a838e55f1a19b0b018"><code>4628080</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/901e40ebb288c974351df101bf4aaa8b641c655e"><code>901e40e</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67aadec19427bd318cf81fc16d19110795781e96"><code>67aadec</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/856a74a7aac33f9e6a09000d97ec663ede222c64"><code>856a74a</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bca84617f2effc4e32c47565b4b9744856c435a"><code>6bca846</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04e89ae670d5ce91c30d14d2978c31e15aaea140"><code>04e89ae</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee"><code>82554f9</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326895.json:
```json
{
    "body": "Changed branch from **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)** to **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)**",
    "created_at": "2017-01-13T11:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326895",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)** to **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)**



---

archive/issue_comments_326896.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Travis Scrimshaw**",
    "created_at": "2017-01-13T11:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326896",
    "user": "https://github.com/mezzarobba"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Travis Scrimshaw**



---

archive/issue_comments_326897.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw, Travis Scrimshaw** to **Travis Scrimshaw, Marc Mezzarobba**",
    "created_at": "2017-01-13T11:07:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326897",
    "user": "https://github.com/mezzarobba"
}
```

Changed reviewer from **Travis Scrimshaw, Travis Scrimshaw** to **Travis Scrimshaw, Marc Mezzarobba**



---

archive/issue_events_310151.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-13T19:14:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310151"
}
```



---

archive/issue_events_310152.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-13T19:14:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310152"
}
```



---

archive/issue_comments_326898.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLet's get this into Sage now and do further optimizations on a followup ticket.",
    "created_at": "2017-01-13T19:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326898",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Let's get this into Sage now and do further optimizations on a followup ticket.



---

archive/issue_comments_326899.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nMerge conflict...",
    "created_at": "2017-01-21T17:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326899",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Merge conflict...



---

archive/issue_events_310153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T17:59:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310153"
}
```



---

archive/issue_events_310154.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T17:59:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310154"
}
```



---

archive/issue_comments_326900.json:
```json
{
    "body": "Changed commit from **[`82554f9`](https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee)** to **[`2e6ce36`](https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871)**",
    "created_at": "2017-01-21T19:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326900",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`82554f9`](https://github.com/sagemath/sagetrac-mirror/commit/82554f906ead4a2693223115d25b20698c82e1ee)** to **[`2e6ce36`](https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871)**



---

archive/issue_comments_326901.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/232d8a245db946c68c900ecb123865f2a289a013\"><code>232d8a2</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/623fac326cbbeee87471289fd8bbeaabd3037304\"><code>623fac3</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66be984c79bff7363f471ea47aea80b9add18de4\"><code>66be984</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e56be91dbbbf46b0d334e03ebfca54b0c1410b95\"><code>e56be91</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e71c9a1b5fb64af067032e54ae2ab33298b7ae3\"><code>2e71c9a</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7023518aecae84cfd9332300d9da3b86582b6e2a\"><code>7023518</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/421e9c55c8f46902853573eb1f84e7e0f4bfed75\"><code>421e9c5</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59ab09bfde30b62ece73d2b864387653480ff21f\"><code>59ab09b</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bff90813d02dcff3d2ca67a19a70881a8a6d9e75\"><code>bff9081</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871\"><code>2e6ce36</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-21T19:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326901",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/232d8a245db946c68c900ecb123865f2a289a013"><code>232d8a2</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/623fac326cbbeee87471289fd8bbeaabd3037304"><code>623fac3</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66be984c79bff7363f471ea47aea80b9add18de4"><code>66be984</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e56be91dbbbf46b0d334e03ebfca54b0c1410b95"><code>e56be91</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e71c9a1b5fb64af067032e54ae2ab33298b7ae3"><code>2e71c9a</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7023518aecae84cfd9332300d9da3b86582b6e2a"><code>7023518</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/421e9c55c8f46902853573eb1f84e7e0f4bfed75"><code>421e9c5</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59ab09bfde30b62ece73d2b864387653480ff21f"><code>59ab09b</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bff90813d02dcff3d2ca67a19a70881a8a6d9e75"><code>bff9081</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871"><code>2e6ce36</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326902.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9076574a1d7dbf17367329e6cddfd235a7bf3f89\"><code>9076574</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bcc65dc4630f180345b9bfa69dfd9d6d61a1078\"><code>3bcc65d</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00c32eec6ee321ec87256f4e17a554eccc1abe14\"><code>00c32ee</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a507164f270162868fc920668d4b74ddc7c543b\"><code>5a50716</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7ac5d30ec093a7752d6af40f40764c9f23beb6b\"><code>f7ac5d3</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53aa45cbdae1bcd8e1d9907faf02cff78542dcf1\"><code>53aa45c</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c386fbb9790c11bc6bde34fa08704e3117434d6\"><code>9c386fb</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d91c6c4ee67036eede65bc81557e5748116bb4d\"><code>9d91c6c</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff878d6af2711f4b8802753eb4b784a46dace469\"><code>ff878d6</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3\"><code>582bc14</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-21T19:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326902",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9076574a1d7dbf17367329e6cddfd235a7bf3f89"><code>9076574</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bcc65dc4630f180345b9bfa69dfd9d6d61a1078"><code>3bcc65d</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00c32eec6ee321ec87256f4e17a554eccc1abe14"><code>00c32ee</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a507164f270162868fc920668d4b74ddc7c543b"><code>5a50716</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7ac5d30ec093a7752d6af40f40764c9f23beb6b"><code>f7ac5d3</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53aa45cbdae1bcd8e1d9907faf02cff78542dcf1"><code>53aa45c</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c386fbb9790c11bc6bde34fa08704e3117434d6"><code>9c386fb</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d91c6c4ee67036eede65bc81557e5748116bb4d"><code>9d91c6c</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff878d6af2711f4b8802753eb4b784a46dace469"><code>ff878d6</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3"><code>582bc14</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326903.json:
```json
{
    "body": "Changed commit from **[`2e6ce36`](https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871)** to **[`582bc14`](https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3)**",
    "created_at": "2017-01-21T19:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326903",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e6ce36`](https://github.com/sagemath/sagetrac-mirror/commit/2e6ce3627e8cc20b0eaf9813d725969e61089871)** to **[`582bc14`](https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3)**



---

archive/issue_comments_326904.json:
```json
{
    "body": "Changed commit from **[`582bc14`](https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3)** to **[`c4b9000`](https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126)**",
    "created_at": "2017-01-22T10:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326904",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`582bc14`](https://github.com/sagemath/sagetrac-mirror/commit/582bc1451110361c164f5af0f7c9e582bca7eba3)** to **[`c4b9000`](https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126)**



---

archive/issue_comments_326905.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce745fc37bd8b9ae9c45ed6cccf1a0cad73c2c15\"><code>ce745fc</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e86ab58c9c76d0121001aedd9eb9b35129284754\"><code>e86ab58</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25c536e79de95054540161f47097994c6ffd66f0\"><code>25c536e</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a87df2b3fa929be39fe967c03fc2427ebf3f59a3\"><code>a87df2b</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9439459821e02b7cf062b3af52a0689dc7fa2e57\"><code>9439459</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2de8e6bebe8fbcc2c4aa79e86da2b9dd3bb94529\"><code>2de8e6b</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9907674043693bfa8548c14775af898845cce5d9\"><code>9907674</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74b1d6b182c064e31e04e37643cba58131bccd29\"><code>74b1d6b</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/115876d99f7c721a10c64447c90932000882ce5d\"><code>115876d</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126\"><code>c4b9000</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-22T10:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326905",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce745fc37bd8b9ae9c45ed6cccf1a0cad73c2c15"><code>ce745fc</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e86ab58c9c76d0121001aedd9eb9b35129284754"><code>e86ab58</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25c536e79de95054540161f47097994c6ffd66f0"><code>25c536e</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a87df2b3fa929be39fe967c03fc2427ebf3f59a3"><code>a87df2b</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9439459821e02b7cf062b3af52a0689dc7fa2e57"><code>9439459</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2de8e6bebe8fbcc2c4aa79e86da2b9dd3bb94529"><code>2de8e6b</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9907674043693bfa8548c14775af898845cce5d9"><code>9907674</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74b1d6b182c064e31e04e37643cba58131bccd29"><code>74b1d6b</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/115876d99f7c721a10c64447c90932000882ce5d"><code>115876d</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126"><code>c4b9000</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326906.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nRebased.",
    "created_at": "2017-01-22T10:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326906",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:19" align="right">comment:19</div>

Rebased.



---

archive/issue_events_310155.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-22T10:28:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310155"
}
```



---

archive/issue_events_310156.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-22T10:28:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310156"
}
```



---

archive/issue_comments_326907.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nmerge conflict...",
    "created_at": "2017-01-23T23:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326907",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:20" align="right">comment:20</div>

merge conflict...



---

archive/issue_events_310157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-23T23:05:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310157"
}
```



---

archive/issue_events_310158.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-23T23:05:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310158"
}
```



---

archive/issue_comments_326908.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@vbraun](#comment:20):\n> merge conflict...\n\nAgain? With which branch? This ticket's branch (as of `c4b9000`) is based on the current `trac:develop`.",
    "created_at": "2017-01-25T08:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326908",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@vbraun](#comment:20):
> merge conflict...

Again? With which branch? This ticket's branch (as of `c4b9000`) is based on the current `trac:develop`.



---

archive/issue_comments_326909.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/660a603cb1107f894244e105b873be93916af2de\"><code>660a603</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/773036b7abdf4a1d6c201ef9390c4a148b65ba1d\"><code>773036b</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/342997743e2e2cd859e59396484f8a61871f0cea\"><code>3429977</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1925f006dbc0b4ed444ce567729beb051f485a17\"><code>1925f00</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/095bdc53a3c6e6ff273c3a6a7f034d6c618006d5\"><code>095bdc5</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74b56bae5c17cd682f42e5753eaa3d2b419f0149\"><code>74b56ba</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03e86910b66e18bc652b918a1ad8e2892ac04004\"><code>03e8691</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0f1923ca57da6341a4e6aaec7df1a90424809ae\"><code>f0f1923</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3532b340bff5061b0262ae84953c51b5406d8a2a\"><code>3532b34</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535\"><code>29bfdb5</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>\n",
    "created_at": "2017-01-26T13:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326909",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/660a603cb1107f894244e105b873be93916af2de"><code>660a603</code></a></td><td><code>don't call parent() on result from methods of base Polynomial class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/773036b7abdf4a1d6c201ef9390c4a148b65ba1d"><code>773036b</code></a></td><td><code>speed up truncated multiplication of generic polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/342997743e2e2cd859e59396484f8a61871f0cea"><code>3429977</code></a></td><td><code>cache the result of PolynomialRing.is_exact()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1925f006dbc0b4ed444ce567729beb051f485a17"><code>1925f00</code></a></td><td><code>polynomial_element: minor code simplifications/speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/095bdc53a3c6e6ff273c3a6a7f034d6c618006d5"><code>095bdc5</code></a></td><td><code>disable cython checks in generic polynomial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74b56bae5c17cd682f42e5753eaa3d2b419f0149"><code>74b56ba</code></a></td><td><code>generic Polynomials: [] -> get_unsafe() when possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03e86910b66e18bc652b918a1ad8e2892ac04004"><code>03e8691</code></a></td><td><code>speed up generic Polynomial.__call__()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0f1923ca57da6341a4e6aaec7df1a90424809ae"><code>f0f1923</code></a></td><td><code>Using cpdef list list() and some other improvements.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3532b340bff5061b0262ae84953c51b5406d8a2a"><code>3532b34</code></a></td><td><code>Making list always take a second input for the dense cases and some other speedups.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535"><code>29bfdb5</code></a></td><td><code>A few more _new_generic instead of via the coercion framework.</code></td></tr></table>




---

archive/issue_comments_326910.json:
```json
{
    "body": "Changed commit from **[`c4b9000`](https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126)** to **[`29bfdb5`](https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535)**",
    "created_at": "2017-01-26T13:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326910",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c4b9000`](https://github.com/sagemath/sagetrac-mirror/commit/c4b9000794094b9b116a15d9ab66f831f7f9d126)** to **[`29bfdb5`](https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535)**



---

archive/issue_comments_326911.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nRebased again, on top of 7.6.beta1.",
    "created_at": "2017-01-26T13:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326911",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:23" align="right">comment:23</div>

Rebased again, on top of 7.6.beta1.



---

archive/issue_events_310159.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-26T13:18:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310159"
}
```



---

archive/issue_events_310160.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-26T13:18:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310160"
}
```



---

archive/issue_comments_326912.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI am getting the same doctest failure as the patchbot:\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/padics.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/padics.py\", line 1058, in sage.schemes.elliptic_curves.padics.padic_sigma\nFailed example:\n    for N in range(3, max_N):                     # long time\n       sigma = E.padic_sigma(p, N, E2=E2)         # long time\n       assert sigma == max_sigma\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.padics.padic_sigma[19]>\", line 3, in <module>\n        assert sigma == max_sigma\n    AssertionError\n**********************************************************************\n1 item had failures:\n   1 of  21 in sage.schemes.elliptic_curves.padics.padic_sigma\n    [197 tests, 1 failure, 11.79 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/schemes/elliptic_curves/padics.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nI almost certainly did something wrong with my round of improvements. This will require some digging.",
    "created_at": "2017-01-28T17:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326912",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

I am getting the same doctest failure as the patchbot:

```
sage -t --long src/sage/schemes/elliptic_curves/padics.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/padics.py", line 1058, in sage.schemes.elliptic_curves.padics.padic_sigma
Failed example:
    for N in range(3, max_N):                     # long time
       sigma = E.padic_sigma(p, N, E2=E2)         # long time
       assert sigma == max_sigma
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.padics.padic_sigma[19]>", line 3, in <module>
        assert sigma == max_sigma
    AssertionError
**********************************************************************
1 item had failures:
   1 of  21 in sage.schemes.elliptic_curves.padics.padic_sigma
    [197 tests, 1 failure, 11.79 s]
----------------------------------------------------------------------
sage -t --long src/sage/schemes/elliptic_curves/padics.py  # 1 doctest failed
----------------------------------------------------------------------
```
I almost certainly did something wrong with my round of improvements. This will require some digging.



---

archive/issue_events_310161.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-28T17:39:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310161"
}
```



---

archive/issue_events_310162.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-28T17:39:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310162"
}
```



---

archive/issue_comments_326913.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis was introduced by me in [3532b34](https://github.com/sagemath/sagetrac-mirror/commit/3532b340bff5061b0262ae84953c51b5406d8a2a). Now to figure out exactly what the problem is...",
    "created_at": "2017-01-28T22:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326913",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

This was introduced by me in [3532b34](https://github.com/sagemath/sagetrac-mirror/commit/3532b340bff5061b0262ae84953c51b5406d8a2a). Now to figure out exactly what the problem is...



---

archive/issue_comments_326914.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOkay, so the problem was in the change I made to the `__iter__` in that iterating over the list is not the same as iterating up to the degree. I don't understand why this results in different behavior. However, for now, I think we can just let it be.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea\"><code>b846e12</code></a></td><td><code>Reverting change to __iter__.</code></td></tr></table>\n",
    "created_at": "2017-01-28T23:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326914",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

Okay, so the problem was in the change I made to the `__iter__` in that iterating over the list is not the same as iterating up to the degree. I don't understand why this results in different behavior. However, for now, I think we can just let it be.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea"><code>b846e12</code></a></td><td><code>Reverting change to __iter__.</code></td></tr></table>




---

archive/issue_events_310163.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-28T23:10:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310163"
}
```



---

archive/issue_events_310164.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-01-28T23:10:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310164"
}
```



---

archive/issue_comments_326915.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)** to **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)**",
    "created_at": "2017-01-28T23:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326915",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/mmezzarobba/speed_up_generic_polynomials](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/speed_up_generic_polynomials)** to **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)**



---

archive/issue_comments_326916.json:
```json
{
    "body": "Changed commit from **[`29bfdb5`](https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535)** to **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**",
    "created_at": "2017-01-28T23:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326916",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`29bfdb5`](https://github.com/sagemath/sagetrac-mirror/commit/29bfdb557e99262cb4c01a6915a55033a4862535)** to **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**



---

archive/issue_comments_326917.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@tscrim](#comment:26):\n> Okay, so the problem was in the change I made to the `__iter__` in that iterating over the list is not the same as iterating up to the degree. I don't understand why this results in different behavior.\n\nSince the failure has to do with p-adics, I suspect the reason may be that:\n\n```\nsage: Pol.<x> = Qp(5)[]\nsage: pol = 1 + O(5)*x\nsage: pol.degree()\n0\nsage: list(pol)\n[1 + O(5^20), O(5)]\n```\nI don't know if this is intentional, nor why the implementation of p-adics take this convention. (I'd have expected `degree()` to check that the coefficients are nonzero using `__nonzero__()`, and `__nonzero__()` to return true except when its argument is *exactly* zero, like it does for some other inexact parents.) But perhaps we need to check that our other changes don't break things like this.",
    "created_at": "2017-01-29T10:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326917",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@tscrim](#comment:26):
> Okay, so the problem was in the change I made to the `__iter__` in that iterating over the list is not the same as iterating up to the degree. I don't understand why this results in different behavior.

Since the failure has to do with p-adics, I suspect the reason may be that:

```
sage: Pol.<x> = Qp(5)[]
sage: pol = 1 + O(5)*x
sage: pol.degree()
0
sage: list(pol)
[1 + O(5^20), O(5)]
```
I don't know if this is intentional, nor why the implementation of p-adics take this convention. (I'd have expected `degree()` to check that the coefficients are nonzero using `__nonzero__()`, and `__nonzero__()` to return true except when its argument is *exactly* zero, like it does for some other inexact parents.) But perhaps we need to check that our other changes don't break things like this.



---

archive/issue_comments_326918.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI don't think we made any other functional changes as `get_unsafe` has to be consistent with `__getitem__` (for non-slices). Everything else is extending current behavior or passing type info to Cython.\n\nI'm not sure if that is intentional either. We might need to ask someone more familiar with the p-adics. Although that could be something we push to another ticket too.",
    "created_at": "2017-01-29T14:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326918",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

I don't think we made any other functional changes as `get_unsafe` has to be consistent with `__getitem__` (for non-slices). Everything else is extending current behavior or passing type info to Cython.

I'm not sure if that is intentional either. We might need to ask someone more familiar with the p-adics. Although that could be something we push to another ticket too.



---

archive/issue_events_310165.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-31T19:19:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310165"
}
```



---

archive/issue_events_310166.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2017-01-31T19:19:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310166"
}
```



---

archive/issue_comments_326919.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAgreed.",
    "created_at": "2017-01-31T19:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326919",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:29" align="right">comment:29</div>

Agreed.



---

archive/issue_comments_326920.json:
```json
{
    "body": "Changed branch from **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)** to **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**",
    "created_at": "2017-02-02T22:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326920",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tscrim/speed_up_generic_polynomials-22152](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/speed_up_generic_polynomials-22152)** to **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)**



---

archive/issue_events_310167.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-02T22:09:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310167"
}
```



---

archive/issue_events_310168.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d79fbcc1169d4db3833c37b78ddcb6dd35e3f9ec",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-02-02T22:09:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22152#event-310168"
}
```



---

archive/issue_comments_326921.json:
```json
{
    "body": "Changed commit from **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)** to none",
    "created_at": "2017-02-06T14:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326921",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`b846e12`](https://github.com/sagemath/sagetrac-mirror/commit/b846e12f17880b85c8929471308918ac572f30ea)** to none



---

archive/issue_comments_326922.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nLooks like we have another problem:\n\n```\nsage: Pol = ZZ['x']['y']['z']\n....: d = Pol.gens_dict_recursive()\n....: x, y, z = d['x'], d['y'], d['z']\n....: v = QQ(0)\n....: (x*z)(x=v)\n<BOOM>\n```",
    "created_at": "2017-02-06T14:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326922",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:31" align="right">comment:31</div>

Looks like we have another problem:

```
sage: Pol = ZZ['x']['y']['z']
....: d = Pol.gens_dict_recursive()
....: x, y, z = d['x'], d['y'], d['z']
....: v = QQ(0)
....: (x*z)(x=v)
<BOOM>
```



---

archive/issue_comments_326923.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThis is something very special about it being 0 with the coercion.",
    "created_at": "2017-02-06T15:12:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326923",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

This is something very special about it being 0 with the coercion.



---

archive/issue_comments_326924.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThis also works for `p = x*z`:\n\n```\nsage: p(1)(x=v)\n0\n```",
    "created_at": "2017-02-06T15:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326924",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">comment:33</div>

This also works for `p = x*z`:

```
sage: p(1)(x=v)
0
```



---

archive/issue_comments_326925.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nFollowup on #22317.",
    "created_at": "2017-02-06T15:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22152#issuecomment-326925",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Followup on #22317.
