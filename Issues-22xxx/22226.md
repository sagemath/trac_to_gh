# Issue 22226: Make minimal Three.js a standard package

archive/issues_021989.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThe current implementation of Three.js only needs two files to function. In order to lessen the download time for all users, only these two files plus the license will be included in the standard package.\n\nCC:  @novoselt\n\nComponent: **packages: standard**\n\nAuthor: **Paul Masson**\n\nBranch/Commit: **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**\n\nReviewer: **Andrey Novoseltsev**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22226_\n\n",
    "closed_at": "2017-01-31T20:47:13Z",
    "created_at": "2017-01-22T00:03:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make minimal Three.js a standard package",
    "type": "issue",
    "updated_at": "2017-01-31T20:47:13Z",
    "url": "https://github.com/sagemath/sage/issues/22226",
    "user": "https://github.com/paulmasson"
}
```
<div id="comment:0"></div>

The current implementation of Three.js only needs two files to function. In order to lessen the download time for all users, only these two files plus the license will be included in the standard package.

CC:  @novoselt

Component: **packages: standard**

Author: **Paul Masson**

Branch/Commit: **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**

Reviewer: **Andrey Novoseltsev**

_Issue created by migration from https://trac.sagemath.org/ticket/22226_





---

archive/issue_events_308423.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-22T00:03:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308423"
}
```



---

archive/issue_events_308424.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-22T00:03:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308424"
}
```



---

archive/issue_events_308425.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-22T00:03:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308425"
}
```



---

archive/issue_events_308426.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-22T00:03:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308426"
}
```



---

archive/issue_comments_328514.json:
```json
{
    "body": "Branch: **[u/paulmasson/22226](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22226)**",
    "created_at": "2017-01-23T01:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328514",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/22226](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22226)**



---

archive/issue_comments_328515.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795\"><code>5c9f4fb</code></a></td><td><code>Minimal Three.js</code></td></tr></table>\n",
    "created_at": "2017-01-23T01:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328515",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795"><code>5c9f4fb</code></a></td><td><code>Minimal Three.js</code></td></tr></table>




---

archive/issue_events_308427.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-23T01:15:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308427"
}
```



---

archive/issue_events_308428.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-23T01:15:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308428"
}
```



---

archive/issue_comments_328516.json:
```json
{
    "body": "Commit: **[`5c9f4fb`](https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795)**",
    "created_at": "2017-01-23T01:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328516",
    "user": "https://github.com/paulmasson"
}
```

Commit: **[`5c9f4fb`](https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795)**



---

archive/issue_events_308429.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-01-23T01:15:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308429"
}
```



---

archive/issue_comments_328517.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAndrey, the final tarball is only 130KB. I can provide a copy on GitHub if you like, but I assume you'll want to generate it yourself to be sure the `spkg-src` file works as expected.\n\nIt took me some time to realize I had to generate the tarball manually. I initially assumed that would happen automatically, so maybe I should add something to the documentation. How does the tarball get to the mirrors after someone generates it?\n\nIn `spkg-install` I simply remove any existing target and recreate the directory. I figured this would be safest for future upgrades, but feel free to give feedback on that.",
    "created_at": "2017-01-23T01:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328517",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:3" align="right">comment:3</div>

Andrey, the final tarball is only 130KB. I can provide a copy on GitHub if you like, but I assume you'll want to generate it yourself to be sure the `spkg-src` file works as expected.

It took me some time to realize I had to generate the tarball manually. I initially assumed that would happen automatically, so maybe I should add something to the documentation. How does the tarball get to the mirrors after someone generates it?

In `spkg-install` I simply remove any existing target and recreate the directory. I figured this would be safest for future upgrades, but feel free to give feedback on that.



---

archive/issue_comments_328518.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI don't see the point in modifying `spkg-install` to copy only necessary files - there should be no unnecessary files, so copying the whole `src` as before should be fine. My understanding is that the only file skipped at the moment is the license and it seems small and important enough to include.\n\nRegarding URLs - why use CDN for a one-time download? To me straight pull from github.com seems more suitable.\n\nAlso URL1/2/3 kind of ask to be put in some cycle but I am not a fan of shell programming so will not insist on it ;-)\n\nRegarding getting tarballs to mirrors - there should be one attached to the ticket and when it is positively reviewed and merged that file goes to the mirrors, it is a manual process by the release manager.",
    "created_at": "2017-01-29T00:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328518",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:4" align="right">comment:4</div>

I don't see the point in modifying `spkg-install` to copy only necessary files - there should be no unnecessary files, so copying the whole `src` as before should be fine. My understanding is that the only file skipped at the moment is the license and it seems small and important enough to include.

Regarding URLs - why use CDN for a one-time download? To me straight pull from github.com seems more suitable.

Also URL1/2/3 kind of ask to be put in some cycle but I am not a fan of shell programming so will not insist on it ;-)

Regarding getting tarballs to mirrors - there should be one attached to the ticket and when it is positively reviewed and merged that file goes to the mirrors, it is a manual process by the release manager.



---

archive/issue_comments_328519.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2017-01-29T00:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328519",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_comments_328520.json:
```json
{
    "body": "Changed commit from **[`5c9f4fb`](https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795)** to **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**",
    "created_at": "2017-01-29T02:13:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328520",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5c9f4fb`](https://github.com/sagemath/sagetrac-mirror/commit/5c9f4fb007b1aa99c269c741aaab7c36ea26d795)** to **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**



---

archive/issue_comments_328521.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8\"><code>a4f9375</code></a></td><td><code>Revert change</code></td></tr></table>\n",
    "created_at": "2017-01-29T02:13:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328521",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8"><code>a4f9375</code></a></td><td><code>Revert change</code></td></tr></table>




---

archive/issue_comments_328522.json:
```json
{
    "body": "Attachment: **[threejs-r80.tar.gz](https://github.com/sagemath/sage/files/ticket22226/threejs-r80.tar.gz)**",
    "created_at": "2017-01-29T02:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328522",
    "user": "https://github.com/paulmasson"
}
```

Attachment: **[threejs-r80.tar.gz](https://github.com/sagemath/sage/files/ticket22226/threejs-r80.tar.gz)**



---

archive/issue_comments_328523.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWith respect to URLs, when you're viewing the file on GitHub and click the \"Raw\" button, these are the URLs that GitHub returns. As far as I can tell, this is the official way to access files for download from GitHub. The domain appears in the [documentation](https://developer.github.com/v3/repos/contents/) in the `download_url`. If you know a better way then let me know.",
    "created_at": "2017-01-29T02:24:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328523",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:7" align="right">comment:7</div>

With respect to URLs, when you're viewing the file on GitHub and click the "Raw" button, these are the URLs that GitHub returns. As far as I can tell, this is the official way to access files for download from GitHub. The domain appears in the [documentation](https://developer.github.com/v3/repos/contents/) in the `download_url`. If you know a better way then let me know.



---

archive/issue_comments_328524.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMy bad, after seeing `raw` I thought it is `rawgit`! No more complains, will now test it in action.",
    "created_at": "2017-01-29T02:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328524",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:8" align="right">comment:8</div>

My bad, after seeing `raw` I thought it is `rawgit`! No more complains, will now test it in action.



---

archive/issue_comments_328525.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOK, looking closer at what [SageMathCell](../wiki/SageMathCell) is doing with threejs, we need https://github.com/mrdoob/three.js/blob/dev/examples/js/Detector.js as well - it may be useful for the new implementation in the long run as well since as I understand canvas allows saving static graphics files. Can you please add it to the new package?",
    "created_at": "2017-01-29T02:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328525",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:9" align="right">comment:9</div>

OK, looking closer at what [SageMathCell](../wiki/SageMathCell) is doing with threejs, we need https://github.com/mrdoob/three.js/blob/dev/examples/js/Detector.js as well - it may be useful for the new implementation in the long run as well since as I understand canvas allows saving static graphics files. Can you please add it to the new package?



---

archive/issue_comments_328526.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe code in Detector.js is used to determine if the user's environment supports WebGL or not. That information is typically used to fall back to a canvas renderer rather than a WebGL renderer as necessary. I haven't included that test in the template because I tend to look forward and current versions of major browsers support WebGL.\n\nRegardless of the renderer used, there will always be a `canvas` element in the HTML from which data can be extracted. That process is separate from the detector test and was a planned feature.\n\nStill want the file?",
    "created_at": "2017-01-29T03:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328526",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:10" align="right">comment:10</div>

The code in Detector.js is used to determine if the user's environment supports WebGL or not. That information is typically used to fall back to a canvas renderer rather than a WebGL renderer as necessary. I haven't included that test in the template because I tend to look forward and current versions of major browsers support WebGL.

Regardless of the renderer used, there will always be a `canvas` element in the HTML from which data can be extracted. That process is separate from the detector test and was a planned feature.

Still want the file?



---

archive/issue_comments_328527.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWell, the current implementation of threejs in [SageMathCell](../wiki/SageMathCell) uses it, and while browsers support WebGL there may be hardware (or software environment) that does not support it - my old notebook had to fall back to canvas and I believe Windows in VM had to do it as well when it at all worked.\n\nIf you think it is completely useless, I can just as well download it for [SageMathCell](../wiki/SageMathCell) during build (there are other files pulled directly from github, so another one is not a problem). The plan is to drop current threejs function anyway.",
    "created_at": "2017-01-29T03:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328527",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:11" align="right">comment:11</div>

Well, the current implementation of threejs in [SageMathCell](../wiki/SageMathCell) uses it, and while browsers support WebGL there may be hardware (or software environment) that does not support it - my old notebook had to fall back to canvas and I believe Windows in VM had to do it as well when it at all worked.

If you think it is completely useless, I can just as well download it for [SageMathCell](../wiki/SageMathCell) during build (there are other files pulled directly from github, so another one is not a problem). The plan is to drop current threejs function anyway.



---

archive/issue_events_308430.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-29T17:50:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308430"
}
```



---

archive/issue_events_308431.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-29T17:50:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308431"
}
```



---

archive/issue_comments_328528.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nLet's get it in to move on and add extra files later if we really need them!",
    "created_at": "2017-01-29T17:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328528",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:12" align="right">comment:12</div>

Let's get it in to move on and add extra files later if we really need them!



---

archive/issue_comments_328529.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/22226](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22226)** to **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**",
    "created_at": "2017-01-31T20:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22226#issuecomment-328529",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/22226](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22226)** to **[`a4f9375`](https://github.com/sagemath/sagetrac-mirror/commit/a4f93756c0c1b46b46f64c8ee41b59fd0514fec8)**



---

archive/issue_events_308432.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-31T20:47:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308432"
}
```



---

archive/issue_events_308433.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a3034da377b311a7f8df80a3d46b30345df58c4d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-31T20:47:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22226",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22226#event-308433"
}
```
