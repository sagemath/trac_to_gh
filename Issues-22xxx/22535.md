# Issue 22535: Fix bug in checking validity of coordinate values on a chart

archive/issues_022298.json:
```json
{
    "body": "The following is a bug:\n\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: X.add_restrictions((x^2+y^2<1, [x>0, abs(y)<1]))\nsage: X.valid_coordinates(2,0)\n...\nAttributeError: 'list' object has no attribute 'subs'\n```\nIt occurs because of some lack of depth in the analysis of the coordinate restrictions (here `x<sup>2+y</sup>2<1 or (x>0 and abs(y)<1)`). The current ticket fixes it by introducing a recursive function to check the coordinate restrictions. \n\n\n**CC:**  @tscrim\n\n**Keywords:** chart, manifolds\n\n**Branch/Commit:** [f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Eric Gourgoulhon\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22535\n\n",
    "closed_at": "2017-03-10T23:13:00Z",
    "created_at": "2017-03-06T19:45:21Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Fix bug in checking validity of coordinate values on a chart",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22535",
    "user": "https://github.com/egourgoulhon"
}
```
The following is a bug:

```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: X.add_restrictions((x^2+y^2<1, [x>0, abs(y)<1]))
sage: X.valid_coordinates(2,0)
...
AttributeError: 'list' object has no attribute 'subs'
```
It occurs because of some lack of depth in the analysis of the coordinate restrictions (here `x<sup>2+y</sup>2<1 or (x>0 and abs(y)<1)`). The current ticket fixes it by introducing a recursive function to check the coordinate restrictions. 


**CC:**  @tscrim

**Keywords:** chart, manifolds

**Branch/Commit:** [f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)

**Reviewer:** Travis Scrimshaw

**Author:** Eric Gourgoulhon

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/22535





---

archive/issue_comments_421294.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c\">f696a38</a></td><td><code>Fix bug in checking validity of coordinate values on a chart (#22535)</code></td></tr></table>\n",
    "created_at": "2017-03-06T19:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421294",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c">f696a38</a></td><td><code>Fix bug in checking validity of coordinate values on a chart (#22535)</code></td></tr></table>




---

archive/issue_comments_421295.json:
```json
{
    "body": "**Commit:** [f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)",
    "created_at": "2017-03-06T19:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421295",
    "user": "https://github.com/egourgoulhon"
}
```

**Commit:** [f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)



---

archive/issue_comments_421296.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-03-06T19:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421296",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_421297.json:
```json
{
    "body": "**Branch:** [public/manifolds/bug-coord-restrict-22535](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/bug-coord-restrict-22535)",
    "created_at": "2017-03-06T19:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421297",
    "user": "https://github.com/egourgoulhon"
}
```

**Branch:** [public/manifolds/bug-coord-restrict-22535](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/bug-coord-restrict-22535)



---

archive/issue_comments_421298.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-03-07T17:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421298",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_421299.json:
```json
{
    "body": "<a id='comment:2'></a>\nLGTM.",
    "created_at": "2017-03-07T17:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421299",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
LGTM.



---

archive/issue_comments_421300.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-03-07T17:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421300",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_421301.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks!",
    "created_at": "2017-03-07T17:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421301",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>
Thanks!



---

archive/issue_comments_421302.json:
```json
{
    "body": "**Changing branch** from \"[public/manifolds/bug-coord-restrict-22535](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/bug-coord-restrict-22535)\" to \"[f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)\".",
    "created_at": "2017-03-10T23:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421302",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/manifolds/bug-coord-restrict-22535](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/bug-coord-restrict-22535)" to "[f696a38cece5be4c209f4f72c24bf7893dd3317c](https://github.com/sagemath/sagetrac-mirror/commit/f696a38cece5be4c209f4f72c24bf7893dd3317c)".



---

archive/issue_comments_421303.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-03-10T23:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22535#issuecomment-421303",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_066955.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-10T23:13:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22535",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22535#event-66955"
}
```
