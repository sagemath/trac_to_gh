# Issue 29924: Zero Matrix has Inverse over Finite Field

Issue created by migration from https://trac.sagemath.org/ticket/30161

Original creator: @prismika

Original creation time: 2020-07-16 21:46:41

CC:  malb slelievre

The bug is outlined in this post: https://ask.sagemath.org/question/52487/zero-matrix-has-an-inverse-over-finite-field/

In short, the following lines of code should throw an error, but they do not.


```
M = Matrix([0], ring=GF(4))
M.inverse()
```


Instead they return the matrix [1].



---

Comment by slelievre created at 2020-07-17 15:37:52

The source code for the `__invert__` method, revealed by

```
sage: M.__invert__??
```

seems to involve `mzed_invert_newton_john` from [m4rie](https://github.com/malb/m4rie).


---

Comment by slelievre created at 2020-07-17 15:37:52

Changing keywords from "" to "m4rie".


---

Comment by malb created at 2020-07-17 16:38:34

Yep, that's a bug in m4rie:


```
mzed_t *mzed_invert_newton_john(mzed_t *B, const mzed_t *A) {
  assert(A->nrows == A->ncols);
  mzed_t *I = mzed_init(A->finite_field, A->nrows, A->ncols);
  mzed_set_ui(I, 1);
  mzed_t *T = mzed_concat(NULL, A, I);
  mzed_free(I);

  rci_t r = mzed_echelonize_newton_john(T, 1);
  if (r != A->nrows) 
    m4ri_die("mzed_invert_newton_john: input matrix does not have full rank.");
  B = mzed_submatrix(B, T, 0, A->ncols, A->nrows, T->ncols);
  mzed_free(T);
  return B;
}
```



We first add an identity matrix and then check if the whole thing has full rank, which is nonsense.


---

Comment by malb created at 2020-07-17 16:42:32

Changing status from new to needs_review.


---

Comment by malb created at 2020-07-17 16:42:32

New commits:


---

Comment by slelievre created at 2020-07-17 17:06:12

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2020-07-17 17:06:12

Thanks!


---

Comment by vbraun created at 2020-07-28 22:32:17

Resolution: fixed
