# Issue 21969: Generation of strong orientations of a graph

Issue created by migration from https://trac.sagemath.org/ticket/22206

Original creator: pvalicov

Original creation time: 2017-01-19 10:26:20




---

Comment by git created at 2017-01-19 10:44:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pvalicov created at 2017-01-19 10:51:00

Changing type from PLEASE CHANGE to enhancement.


---

Comment by pvalicov created at 2017-01-19 10:51:00

Changing keywords from "" to "graphs, orientations".


---

Comment by pvalicov created at 2017-01-19 10:53:13

Changing component from PLEASE CHANGE to graph theory.


---

Comment by chapoton created at 2017-01-19 11:02:43

Hello, welcome !

* always have a blankline after a line ending with `::`

* every function needs to have doctests


---

Comment by pvalicov created at 2017-01-19 13:00:38

Hello, thanks for pointing out. I submit the corrected version. For inner functions, there must be also a doctest or a simple description is enough?

Replying to [comment:5 chapoton]:
> Hello, welcome !
> 
> * always have a blankline after a line ending with `::`
> 
> * every function needs to have doctests
>


---

Comment by chapoton created at 2017-01-19 13:02:26

Replying to [comment:6 pvalicov]:
> Hello, thanks for pointing out. I submit the corrected version. For inner functions, there must be also a doctest or a simple description is enough?

doctests for every function that is not inside a function, as explained here :
http://doc.sagemath.org/html/en/developer/coding_basics.html

> 
> Replying to [comment:5 chapoton]:
> > Hello, welcome !
> > 
> > * always have a blankline after a line ending with `::`
> > 
> > * every function needs to have doctests
> >


---

Comment by chapoton created at 2017-01-19 14:54:37

see the patchbot report (colored icon at top right) for the coverage: 2 functions are missing documentation

patchbot also says: do not use xrange, but range (if you want an iterator, use `from six.moves import range`)


---

Comment by git created at 2017-01-19 15:19:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-19 15:26:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-19 15:30:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-21 17:28:04

- the main function still has no documentation

- when calling a reference, you must write `[CGMRV16]_` with an underscore


---

Comment by git created at 2017-01-23 10:22:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-01-24 18:04:41

Dear Kolja and Petru,

a few comments on your code:
- ticket #22247 should allow you to avoid a (costly) call to `self.edge_connectivity()`
- `Dg = DiGraph([self.vertices(), self.edges()])` could be simply `Dg = DiGraph(self)`
- when you do `treeEdges = [(edge[0],edge[1]) for edge in self.edges() if edge in te]`, all edges in `te` are in `self`. So to remove the labels, you can do `treeEdges = [(u,v) for u,v,_ in te]`
- You can initialize `existingAedges` directly using `existingAedges = [0]*len(A)`
- avoid `bitChanged >>= 1; bit += 1;` and put each instruction in a separate line
- use `yield Dg.copy()`. Indeed, the instruction `yield Dg` will in fact return a pointer. Since `Dg` is modified in your method, what you have returned will also be modified. 

Best,

David.


---

Comment by dcoudert created at 2017-01-25 12:39:25

Ticket #22254 which improves the computation of bridges might also be useful. The proposed implementation avoids a call to `strong_orientation`...


---

Comment by pvalicov created at 2017-01-25 16:56:59

Hi David,

 Thanks for the comments. Cannot use `Dg = DiGraph(self)` because it will doubly orient all the edges of self, and we want Dg to be a simple directed graph.
For ticket #22247 can I already use the code even if it was not validated yet in sage ?

Petru


---

Comment by git created at 2017-01-25 17:03:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-01-25 17:04:45

>  Thanks for the comments. Cannot use `Dg = DiGraph(self)` because it will doubly orient all the edges of self, and we want Dg to be a simple directed graph.
Right, I forgot that issue ;)

> For ticket #22247 can I already use the code even if it was not validated yet in sage ?
I'm not a git guru, but I think you can safely rebase your ticket on top of #22247 (or #22254). Don't forget to indicate the dependency.


---

Comment by git created at 2017-01-25 18:09:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-08 17:31:07

I don't know how to ensure that the last (minor) modifications made on #22247 will be taken into account in this patch. Hope someone will be able to answer that question.

You should set this ticket to `needs_review` if belive it is ready for review.


---

Comment by pvalicov created at 2017-02-08 18:41:48

Changing status from new to needs_review.


---

Comment by dcoudert created at 2017-02-09 07:44:23

some minor comments:
* Add a space in each method between the one line description of the method and the long description, e.g., after `Returns an iterator over all strong orientations of self.`
* Ensure that comments are in 80 columns mode (sorry for that).
* `Dg = DiGraph([self.vertices(), self.edges()], pos=self.get_pos())` to keep the position of nodes.
* `Dg.delete_edge((u,v))` could be `Dg.delete_edge(u,v)`
* indentation for `yield orientation` is excessive. should be 4 spaces


---

Comment by git created at 2017-02-09 10:26:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-09 14:26:16

* Line `an undirected graph. It is an adaptation of the algorithm published in [CGMRV16]_.` has length 82 and so must be cut. Sorry.
* There is an empty line after `def all_strong_orientations_iterator(self):`. Remove it. Otherwise we cannot build the documentation (use `./sage -docbuild reference/graphs html` to rebuilt only that part of the doc).
* Line `# if the graph has a bridge or is disconnected, then it cannot be strongly oriented` is too long

We have a method `strong_orientation` returning a random strong orientation, and method `all_strong_orientations_iterator`. Wouldn't it be better to rename your method `strong_orientations_iterator` ?


---

Comment by dcoudert created at 2017-02-09 14:27:32

You could also rebase on 7.6.beta2


---

Comment by git created at 2017-02-09 16:18:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-09 18:25:07

I discovered some limitations that must be fixed and may be documented (at least to recall that the number of orientations could be huge).

1- I don't know what's going on here. I tried many times and sometimes its working well, sometimes not. I have put the graph6 strings of the graphs so that you can try it and track&solve the issue.

```
sage: G = graphs.RandomBarabasiAlbert(30, 2)
sage: G.graph6_string()
']ZgZCOWg@OD?c?G@?oA?C_?D??SO?@?A??_AC??OO?A???o?G?OG@??A?A??P???A_???CC???'
sage: %time D = next(G.strong_orientations_iterator())
CPU times: user 1.39 s, sys: 663 ms, total: 2.06 s
Wall time: 2.37 s
sage:
sage: G = graphs.RandomBarabasiAlbert(30, 2)
sage: G.graph6_string()
']\\cl@_W_`_S?GA?KOC?c?GO?P?@C???`AA??C?G?_@??A?OC_??_???aO???C??@_??A???o??'
sage: %time D = next(G.strong_orientations_iterator())
---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)
...
StopIteration: 
```


2- Here we have too big numbers, but it can be easily fixed replacing the `for i in range(0, 2**(len(A)-1))` loop with a while loop. 

```
sage: G = graphs.RandomBarabasiAlbert(100, 2)
sage: %time D = next(G.strong_orientations_iterator())
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)
...
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/strong_orientations_generator.pyc in strong_orientations_iterator(self)
    131     # of G by orienting properly the tree-edges
    132     previousWord = 0
--> 133     for i in range(0, 2**(len(A)-1)):
    134         word = (i >> 1) ^ i
    135         bitChanged = word ^ previousWord

OverflowError: range() result has too many items
sage: G.graph6_string()
'b\\MOp_WGS_D?g?a?B?C?O?Q?H??OO?_?CGC?c??@A??A?@??OG?G_????G?G???P?OO??_@???A??@@O?????@?_??C@???P?????'
```


3- Concerning the `_all_strong_orientations_of_a_mixed_graph` method (you should remove the `all`), I don't know how many number of recursive calls can be done before reaching the stack limit. So we might have a problem here too. This will certainly appear after you have fixed the previous issues.


---

Comment by dcoudert created at 2017-02-09 18:25:07

Changing status from needs_review to needs_work.


---

Comment by pvalicov created at 2017-02-10 10:58:34

I changed the for loop into a while loop, as well as the name of the helper method (will submit it). The second and the third graphs in your tests are not biconnected, so there is no strong orientation possible for these graphs. That's why the next() method of the iterator throws an exception (which is the normal behaviour).
Replying to [comment:27 dcoudert]:
> I discovered some limitations that must be fixed and may be documented (at least to recall that the number of orientations could be huge).
> 
> 1- I don't know what's going on here. I tried many times and sometimes its working well, sometimes not. I have put the graph6 strings of the graphs so that you can try it and track&solve the issue.
> {{{
> sage: G = graphs.RandomBarabasiAlbert(30, 2)
> sage: G.graph6_string()
> ']ZgZCOWg`@`OD?c?G`@`?oA?C_?D??SO?`@`?A??_AC??OO?A???o?G?OG`@`??A?A??P???A_???CC???'
> sage: %time D = next(G.strong_orientations_iterator())
> CPU times: user 1.39 s, sys: 663 ms, total: 2.06 s
> Wall time: 2.37 s
> sage:
> sage: G = graphs.RandomBarabasiAlbert(30, 2)
> sage: G.graph6_string()
> ']\\cl`@`_W_`_S?GA?KOC?c?GO?P?`@`C???`AA??C?G?_`@`??A?OC_??_???aO???C??`@`_??A???o??'
> sage: %time D = next(G.strong_orientations_iterator())
> ---------------------------------------------------------------------------
> StopIteration                             Traceback (most recent call last)
> ...
> StopIteration: 
> }}}
> 
> 2- Here we have too big numbers, but it can be easily fixed replacing the `for i in range(0, 2**(len(A)-1))` loop with a while loop. 
> {{{
> sage: G = graphs.RandomBarabasiAlbert(100, 2)
> sage: %time D = next(G.strong_orientations_iterator())
> ---------------------------------------------------------------------------
> OverflowError                             Traceback (most recent call last)
> ...
> /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/strong_orientations_generator.pyc in strong_orientations_iterator(self)
>     131     # of G by orienting properly the tree-edges
>     132     previousWord = 0
> --> 133     for i in range(0, 2**(len(A)-1)):
>     134         word = (i >> 1) ^ i
>     135         bitChanged = word ^ previousWord
> 
> OverflowError: range() result has too many items
> sage: G.graph6_string()
> 'b\\MOp_WGS_D?g?a?B?C?O?Q?H??OO?_?CGC?c??`@`A??A?`@`??OG?G_????G?G???P?OO??_`@`???A??`@``@`O?????`@`?_??C`@`???P?????'
> }}}
> 
> 3- Concerning the `_all_strong_orientations_of_a_mixed_graph` method (you should remove the `all`), I don't know how many number of recursive calls can be done before reaching the stack limit. So we might have a problem here too. This will certainly appear after you have fixed the previous issues.


---

Comment by git created at 2017-02-10 11:07:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-10 16:26:49

Replying to [comment:28 pvalicov]:
> I changed the for loop into a while loop, as well as the name of the helper method (will submit it). 
> The second and the third graphs in your tests are not biconnected, so there is no strong orientation possible for these graphs. That's why the next() method of the iterator throws an exception (which is the normal behaviour).
Right, first time I realize that the BA generator could return graphs that are not  biconnected.


> > 3- Concerning the `_all_strong_orientations_of_a_mixed_graph` method (you should remove the `all`), I don't know how many number of recursive calls can be done before reaching the stack limit. So we might have a problem here too. This will certainly appear after you have fixed the previous issues.

So far no stackoverflow error, but slow on large graphs. This was expected.

```
sage: G = graphs.RandomBarabasiAlbert(100, 2)
sage: %time D = next(G.strong_orientations_iterator())
CPU times: user 81.3 ms, sys: 11.8 ms, total: 93.1 ms
Wall time: 84.6 ms
sage: G = graphs.RandomBarabasiAlbert(1000, 2)
sage: %time D = next(G.strong_orientations_iterator())
CPU times: user 1min, sys: 364 ms, total: 1min
Wall time: 1min 1s
sage: G = graphs.RandomBarabasiAlbert(2000, 2)
sage: %time D = next(G.strong_orientations_iterator())
CPU times: user 7min 53s, sys: 3.85 s, total: 7min 57s
Wall time: 8min 4s
```


The patch passes all tests on `src/sage/graphs/` but I have an issue with the documentation. I tried `make doc-clean && make` and got 

```
[dochtml] [graphs   ] reading sources... [100%] sage/graphs/weakly_chordal
[dochtml] [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:docstring of sage.graphs.graph.Graph.topological_minor:0: WARNING: Literal block expected; none found.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/Users/dcoudert/sage/local/lib/python/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/Users/dcoudert/sage/local/lib/python/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1667, in main
[dochtml]     builder()
[dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 252, in build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/Users/dcoudert/sage/local/lib/python/multiprocessing/pool.py", line 567, in get
[dochtml]     raise self._value
[dochtml] OSError: [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:docstring of sage.graphs.graph.Graph.topological_minor:0: WARNING: Literal block expected; none found.
[dochtml] 
```

Are you able to build the doc ? may be the problem comes from something else...


---

Comment by pvalicov created at 2017-02-11 11:11:52

Replying to [comment:30 dcoudert]:
> Replying to [comment:28 pvalicov]:
> > I changed the for loop into a while loop, as well as the name of the helper method (will submit it). 
> > The second and the third graphs in your tests are not biconnected, so there is no strong orientation possible for these graphs. That's why the next() method of the iterator throws an exception (which is the normal behaviour).
> Right, first time I realize that the BA generator could return graphs that are not  biconnected.
> 
> 
> > > 3- Concerning the `_all_strong_orientations_of_a_mixed_graph` method (you should remove the `all`), I don't know how many number of recursive calls can be done before reaching the stack limit. So we might have a problem here too. This will certainly appear after you have fixed the previous issues.
> 
> So far no stackoverflow error, but slow on large graphs. This was expected.
> {{{
> sage: G = graphs.RandomBarabasiAlbert(100, 2)
> sage: %time D = next(G.strong_orientations_iterator())
> CPU times: user 81.3 ms, sys: 11.8 ms, total: 93.1 ms
> Wall time: 84.6 ms
> sage: G = graphs.RandomBarabasiAlbert(1000, 2)
> sage: %time D = next(G.strong_orientations_iterator())
> CPU times: user 1min, sys: 364 ms, total: 1min
> Wall time: 1min 1s
> sage: G = graphs.RandomBarabasiAlbert(2000, 2)
> sage: %time D = next(G.strong_orientations_iterator())
> CPU times: user 7min 53s, sys: 3.85 s, total: 7min 57s
> Wall time: 8min 4s
> }}}
> 
> The patch passes all tests on `src/sage/graphs/` but I have an issue with the documentation. I tried `make doc-clean && make` and got 
> {{{
> [dochtml] [graphs   ] reading sources... [100%] sage/graphs/weakly_chordal
> [dochtml] [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:docstring of sage.graphs.graph.Graph.topological_minor:0: WARNING: Literal block expected; none found.
> [dochtml] Error building the documentation.
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python/runpy.py", line 174, in _run_module_as_main
> [dochtml]     "__main__", fname, loader, pkg_name)
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python/runpy.py", line 72, in _run_code
> [dochtml]     exec code in run_globals
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
> [dochtml]     main()
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1667, in main
> [dochtml]     builder()
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
> [dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
> [dochtml]     build_many(build_ref_doc, L)
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 252, in build_many
> [dochtml]     ret = x.get(99999)
> [dochtml]   File "/Users/dcoudert/sage/local/lib/python/multiprocessing/pool.py", line 567, in get
> [dochtml]     raise self._value
> [dochtml] OSError: [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:docstring of sage.graphs.graph.Graph.topological_minor:0: WARNING: Literal block expected; none found.
> [dochtml] 
> }}}
> Are you able to build the doc ? may be the problem comes from something else...

I get the same errors as you and as far as I see from the error message, the problem comes from the docstring of the `topological_minor`. Since it's my first submission, just to be clear: besides the file containing the function, the only changes I made in the rest of sage hierarchy was adding in sage/src/sage/graphs/graph.py an additional category and these lines of code :

```
from sage.graphs.strong_orientations_generator import strong_orientations_iterator
Graph.strong_orientations_iterator    =    strong_orientations_iterator
```


Did I forget something?


---

Comment by dcoudert created at 2017-02-11 11:43:51

Right, you should add `sage/graphs/strong_orientations_generator` to file `src/doc/en/reference/graphs/index.rst`. This way the file will be well visible in html documentation.

I have no clue where the error with `topological_minor` comes from. May be some cache has to be clear or... don't know. May be the patchbot will provide extra information after adding above line and setting the ticket to needs review.


---

Comment by git created at 2017-02-11 14:09:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pvalicov created at 2017-02-11 14:10:07

Replying to [comment:32 dcoudert]:
> Right, you should add `sage/graphs/strong_orientations_generator` to file `src/doc/en/reference/graphs/index.rst`. This way the file will be well visible in html documentation.
> 
> I have no clue where the error with `topological_minor` comes from. May be some cache has to be clear or... don't know. May be the patchbot will provide extra information after adding above line and setting the ticket to needs review.
> 
Thanks for that. There were some errors in the documentation and now it should work.


---

Comment by pvalicov created at 2017-02-11 14:10:27

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2017-02-11 15:01:31

Now everything is working well: passes all tests and the documentation builds properly and look nice.

I have only very minor comments
* at the beginning of the module, you have `O(m*n)` but O(m) is without ```
* You can check the source code of `src/sage/graphs/graph_decompositions/vertex_separation.pyx` to see how to get some titles in bold, or some titles with a blue background. This is not very important.

After that we will be done.


---

Comment by tscrim created at 2017-02-11 15:11:56

Some comments.

- `strong_orientations_iterator` should not have `self` as an input. Moreover, `self` is not listed as an input.
- You should have `strong_orientations_iterator` in the actual `graph.py` as a proper method. This makes code maintenance easier.
- References should go in the master reference file.
- I suspect your name is not `YOUR NAME`.
- You should use `.. NOTE::` blocks.
- You missed a latex formatting around an `O(m)` in the `ALGORITHM` part of `strong_orientations_generator.py`. Similarly, you should remove the `*` from the earlier one.
- The `INPUT` block should be formatted as:
  {{{
    INPUT:

    - ``D``g -- the mixed graph; the undirected edges are doubly oriented
    - ``V`` -- the set of vertices
    - ``E`` -- the set of undirected edges (these edges are oriented in both ways);
      no labels are allowed
  }}}
- All of your conditionals have an extra space, i.e., change `if cond :` to `if cond:`.
- This change needs to be reverted:
  {{{#!diff
diff --git a/src/sage/graphs/strong_orientations_generator.py b/src/sage/graphs/strong_orientations_generator.py
new file mode 100644
index 0000000..932fa85
--- /dev/null
+++ b/src/sage/graphs/strong_orientations_generator.py
`@``@` -175,7 +177,7 `@``@` def _strong_orientations_of_a_mixed_graph(Dg, V, E):
     - an iterator which will produce all strong orientations of the input
       partially directed graph.
 
-    EXAMPLES::
+    EXAMPLES:
 
         sage: from sage.graphs.strong_orientations_generator import _strong_orientations_of_a_mixed_graph
         sage: g = graphs.CycleGraph(5)
  }}}


---

Comment by git created at 2017-02-13 10:06:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pvalicov created at 2017-02-13 10:10:55

Replying to [comment:37 tscrim]:
> Some comments.
> 
> - `strong_orientations_iterator` should not have `self` as an input. Moreover, `self` is not listed as an input.
> - You should have `strong_orientations_iterator` in the actual `graph.py` as a proper method. This makes code maintenance easier.
I thought that because of the helper function `_strong_orientations_of_a_mixed_graph` will make the code in `graph.py` more polluted. I followed the same pattern as for other graph algorithms which are in the folder `src/sage/graphs'. Do you think it is still necessary to refactor the code and add it to `graph.py` ?
> - References should go in the master reference file.
> - I suspect your name is not `YOUR NAME`.
> - You should use `.. NOTE::` blocks.
> - You missed a latex formatting around an `O(m)` in the `ALGORITHM` part of `strong_orientations_generator.py`. Similarly, you should remove the `*` from the earlier one.
> - The `INPUT` block should be formatted as:
>   {{{
>     INPUT:
> 
>     - ``D``g -- the mixed graph; the undirected edges are doubly oriented
>     - ``V`` -- the set of vertices
>     - ``E`` -- the set of undirected edges (these edges are oriented in both ways);
>       no labels are allowed
>   }}}
> - All of your conditionals have an extra space, i.e., change `if cond :` to `if cond:`.
> - This change needs to be reverted:
>   {{{#!diff
> diff --git a/src/sage/graphs/strong_orientations_generator.py b/src/sage/graphs/strong_orientations_generator.py
> new file mode 100644
> index 0000000..932fa85
> --- /dev/null
> +++ b/src/sage/graphs/strong_orientations_generator.py
> `@``@` -175,7 +177,7 `@``@` def _strong_orientations_of_a_mixed_graph(Dg, V, E):
>      - an iterator which will produce all strong orientations of the input
>        partially directed graph.
>  
> -    EXAMPLES::
> +    EXAMPLES:
>  
>          sage: from sage.graphs.strong_orientations_generator import _strong_orientations_of_a_mixed_graph
>          sage: g = graphs.CycleGraph(5)
>   }}}


---

Comment by tscrim created at 2017-02-13 15:39:20

I agree that it is good to have the _helper_ function a separate file to reduce clutter. However, the main method `strong_orientations_iterator` should be in the class itself (and contain the import statement out to the helper function).


---

Comment by pvalicov created at 2017-02-13 16:30:48

Replying to [comment:40 tscrim]:
> I agree that it is good to have the _helper_ function a separate file to reduce clutter. However, the main method `strong_orientations_iterator` should be in the class itself (and contain the import statement out to the helper function).

Sorry for being too insistent (and thanks for the effort) but then I don't understand the point of having files like `tutte_polynomial.py`, `schnyder.py`, `lovasz_theta.py`, `line_graph.py`, `partial_cube.py` etc. in the `src/sage/graphs/` ?

The reason I followed the same way of coding by doing the import of the main function (i.e. `strong_orientations_iterator`) in `graph.py` is because I thought that importing the entire function makes somehow the entire code of the class `Graph` easier as this class is already quite big in terms of lines of code.


---

Comment by tscrim created at 2017-02-13 16:43:00

Replying to [comment:41 pvalicov]:
> Replying to [comment:40 tscrim]:
> > I agree that it is good to have the _helper_ function a separate file to reduce clutter. However, the main method `strong_orientations_iterator` should be in the class itself (and contain the import statement out to the helper function).
> 
> Sorry for being too insistent (and thanks for the effort) but then I don't understand the point of having files like `tutte_polynomial.py`, `schnyder.py`, `lovasz_theta.py`, `line_graph.py`, `partial_cube.py` etc. in the `src/sage/graphs/` ?

Some of them are better justified because they need larger volumes of code (such as helper classes), and even still I do not agree with the design choice of having it be a separate file. In particular, IMO the `lovasz_theta.py` does not deserve a separate file.

> The reason I followed the same way of coding by doing the import of the main function (i.e. `strong_orientations_iterator`) in `graph.py` is because I thought that importing the entire function makes somehow the entire code of the class `Graph` easier as this class is already quite big in terms of lines of code.

It's taking a bucket of water from the ocean. Plus, find (and code folding) makes this argument far less effective to me, especially compared to having to search through other seemingly random files. However, since there does seem to be some practice of doing this, I won't oppose this, but it is not a good practice IMO (and it only works because it is Python).


---

Comment by dcoudert created at 2017-02-13 16:45:32

The helper function is roughly 50 lines of codes. Putting it in a separated file while the main method is in `graph.py` makes no sense to me. Either we decide to put every thing in `graph.py`, or we agree to create this new file with the aim of gathering all methods related to orientations in it. For instance, we could move method `strong_orientation` in this file. May be it could be named `strong_orientations.py` rather than `strong_orientations_generator.py` to be more general.


---

Comment by pvalicov created at 2017-02-15 09:20:21

I am not an expert in Sage but I think that having a file like `strong_orientations.py` regrouping everything would be clearer. More generally I would say that a file like `orientations.py` containing the `orientations` method, all methods related to strong orientations and future methods that one could naturally expect like `acyclic_orientations` (I was thinking submitting it too), is a good idea. So what should I do? Do I leave my submission as it is for now ? And the factorisation, if it is accepted, will be another ticket (I don't know how to do it yet) ?


---

Comment by dcoudert created at 2017-02-15 09:54:07

I'm in favor of having a special file for all kinds of orientations.

So, unless someone has strong arguments against it, I suggest to rename the file `orientations.py`, rewrite the file header to explain that this file contains methods related to graph orientations and move the description of the strong orientation generator inside the method.

The top description of the file could be something like:

```
r"""
Orientations

This module implements several methods to compute orientations of undirected
graphs subject to specific constraints (e.g., acyclic, strongly connected,
etc.). It also implements some iterators over all these orientations.

**This module contains the following methods**

.. csv-table::
    :class: contentstable
    :widths: 30, 70
    :delim: |

    :meth:`strong_orientations_iterator` | Return an iterator over all strong orientations of a graph `G`


Authors
-------

- Kolja Knauer, Petru Valicov (2017-01-10) -- initial version


Methods
-------
"""
```

See file `src/sage/graphs/graph_decomposition/vertex_separation.pyx` for example.



In another ticket, we can move related methods to this new file, and at the same time fix minor issues such as:

```
sage: G = Graph(1)
sage: next(G.orientations())
Digraph on 0 vertices
```



---

Comment by git created at 2017-02-15 12:01:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-15 12:44:17

* you forgot to update file `src/doc/en/reference/graphs/index.rst`: `sage/graphs/strong_orientations_generator` -> `sage/graphs/orientations`. After that I can try to build the doc.

* Because we use this definition "A biconnected graph is a connected graph on two or more vertices that is not broken into disconnected pieces by deleting any single vertex.", we have the following issue:

```
sage: G = graphs.CompleteGraph(2)
sage: next(G.strong_orientations_iterator())
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-12-1a1d14901a2b> in <module>()
----> 1 next(G.strong_orientations_iterator())

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/orientations.pyc in strong_orientations_iterator(G)
    155 
    156         previousWord = word;
--> 157         if existingAedges[bit] == 0:
    158             Dg.reverse_edge(A[bit])
    159             existingAedges[bit] = 1

IndexError: list index out of range
}}} 
  To fix that you can certainly ensure that the graph has at least 3 vertices and is biconnected. Add a doctest for this case please.


---

Comment by git created at 2017-02-15 14:07:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-02-15 17:44:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-02-15 18:18:14

* Remove `REFERENCES` since references are somewhere else.
* Add an empty line after `ALGORITHM:`
* in the text, I suggest to rewrite "and then launches `_strong_orientations_of_a_mixed_graph` which is the helper function corresponding to the generation algorithm described in" as "and then launches a helper function corresponding to the generation algorithm described in". The reason is that method named like `_blah` are not displayed in the html documentation.


Almost done. Passes all tests and the rest of the doc displays nicely.


---

Comment by git created at 2017-02-15 18:43:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pvalicov created at 2017-02-15 18:47:22

Thanks, I've done everything. One comment: since we have a separate file to all kind of orientations stuff, wouldn't it be better to gather all the references in this file as it is done in other files or we keep everything in the master reference file? It is done this way in several files in `src/sage/graphs`.

Replying to [comment:50 dcoudert]:
> * Remove `REFERENCES` since references are somewhere else.
> * Add an empty line after `ALGORITHM:`
> * in the text, I suggest to rewrite "and then launches `_strong_orientations_of_a_mixed_graph` which is the helper function corresponding to the generation algorithm described in" as "and then launches a helper function corresponding to the generation algorithm described in". The reason is that method named like `_blah` are not displayed in the html documentation.
> 
> 
> Almost done. Passes all tests and the rest of the doc displays nicely.


---

Comment by dcoudert created at 2017-02-15 19:21:01

Some months ago, It has been decided to put all references in the master file. So all references that are currently in the graph module will eventually be moved to the master file. This is to avoid duplications (references and keys).

For me this patch is now good to go. Congratulation for your first contribution !


---

Comment by dcoudert created at 2017-02-15 19:21:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-21 14:35:12

Resolution: fixed
