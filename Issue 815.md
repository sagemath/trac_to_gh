# Issue 815: doctesting is broken on .sage files

Issue created by migration from https://trac.sagemath.org/ticket/815

Original creator: dmharvey

Original creation time: 2007-10-03 19:38:22

Assignee: was

Running sage -t on a `.sage` file incorrectly reports that all tests passed in the situation that a line of output is missing in the doctest. For example, the following text, in a .sage file, incorrectly produces "All tests passed!":


```
def foo():
    r"""                                                                                       
    EXAMPLES:                                                                                  
        sage: foo()                                                                            
        2                                                                                      
        sage: foo()                                                                            
        sage: foo()                                                                            
        2                                                                                      
    """
    return 2
```




---

Comment by mabshoff created at 2007-10-04 19:48:08

Changing assignee from was to failure.


---

Comment by mabshoff created at 2007-10-04 19:48:08

Changing component from algebraic geometry to doctest.


---

Comment by was created at 2007-11-03 23:42:27

Thoughts:


```
was-815: That 815 thing is because I have a completely custom script for going through .sage files and extracting docstrings and testing as it goes.
[4:29pm] was-815: That seems dumb now.
[4:29pm] was-815: Much better would be to just doctest the corresponding autogenerated .py file.
[4:30pm] was-815: I.e., (1) generate the.py file, then (2) make sure it has "from a import *" in it (where a.sage is the sage file), then (3) do whatever we do to doctest
[4:30pm] was-815: a .py file.
[4:30pm] was-815: The only other thing is to make sure the line numbers match up.
[4:31pm] was-815: nick -- what do you think of my proposal for #815.
[4:31pm] was-815: Basically, I just want to make it reduce to the case of .py.
```



---

Attachment

Lost of deleted code, a bit of modification and doctesting for .sage works as well as for the rest.

It's still of limited interest for files that are not part of the sage library, but at least it won't lie about the results anymore


---

Comment by was created at 2008-11-27 07:14:32

this replaces the above and is a REBASING AGAINST 3.1.2.alpha2.


---

Attachment

Looks good. Eliminates cruft.


---

Comment by mabshoff created at 2008-11-28 07:00:44

Merged scripts-815.patch in Sage 3.2.1.rc0


---

Comment by mabshoff created at 2008-11-28 07:00:44

Resolution: fixed
