# Issue 815: doctesting is broken on .sage files

archive/issues_000815.json:
```json
{
    "body": "Assignee: was\n\nRunning sage -t on a `.sage` file incorrectly reports that all tests passed in the situation that a line of output is missing in the doctest. For example, the following text, in a .sage file, incorrectly produces \"All tests passed!\":\n\n\n```\ndef foo():\n    r\"\"\"                                                                                       \n    EXAMPLES:                                                                                  \n        sage: foo()                                                                            \n        2                                                                                      \n        sage: foo()                                                                            \n        sage: foo()                                                                            \n        2                                                                                      \n    \"\"\"\n    return 2\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/815\n\n",
    "created_at": "2007-10-03T19:38:22Z",
    "labels": [
        "algebraic geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2.1",
    "title": "doctesting is broken on .sage files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/815",
    "user": "dmharvey"
}
```
Assignee: was

Running sage -t on a `.sage` file incorrectly reports that all tests passed in the situation that a line of output is missing in the doctest. For example, the following text, in a .sage file, incorrectly produces "All tests passed!":


```
def foo():
    r"""                                                                                       
    EXAMPLES:                                                                                  
        sage: foo()                                                                            
        2                                                                                      
        sage: foo()                                                                            
        sage: foo()                                                                            
        2                                                                                      
    """
    return 2
```



Issue created by migration from https://trac.sagemath.org/ticket/815





---

archive/issue_comments_005065.json:
```json
{
    "body": "Changing assignee from was to failure.",
    "created_at": "2007-10-04T19:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5065",
    "user": "mabshoff"
}
```

Changing assignee from was to failure.



---

archive/issue_comments_005066.json:
```json
{
    "body": "Changing component from algebraic geometry to doctest.",
    "created_at": "2007-10-04T19:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5066",
    "user": "mabshoff"
}
```

Changing component from algebraic geometry to doctest.



---

archive/issue_comments_005067.json:
```json
{
    "body": "Thoughts:\n\n\n```\nwas-815: That 815 thing is because I have a completely custom script for going through .sage files and extracting docstrings and testing as it goes.\n[4:29pm] was-815: That seems dumb now.\n[4:29pm] was-815: Much better would be to just doctest the corresponding autogenerated .py file.\n[4:30pm] was-815: I.e., (1) generate the.py file, then (2) make sure it has \"from a import *\" in it (where a.sage is the sage file), then (3) do whatever we do to doctest\n[4:30pm] was-815: a .py file.\n[4:30pm] was-815: The only other thing is to make sure the line numbers match up.\n[4:31pm] was-815: nick -- what do you think of my proposal for #815.\n[4:31pm] was-815: Basically, I just want to make it reduce to the case of .py.\n```\n",
    "created_at": "2007-11-03T23:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5067",
    "user": "was"
}
```

Thoughts:


```
was-815: That 815 thing is because I have a completely custom script for going through .sage files and extracting docstrings and testing as it goes.
[4:29pm] was-815: That seems dumb now.
[4:29pm] was-815: Much better would be to just doctest the corresponding autogenerated .py file.
[4:30pm] was-815: I.e., (1) generate the.py file, then (2) make sure it has "from a import *" in it (where a.sage is the sage file), then (3) do whatever we do to doctest
[4:30pm] was-815: a .py file.
[4:30pm] was-815: The only other thing is to make sure the line numbers match up.
[4:31pm] was-815: nick -- what do you think of my proposal for #815.
[4:31pm] was-815: Basically, I just want to make it reduce to the case of .py.
```




---

archive/issue_comments_005068.json:
```json
{
    "body": "Attachment [trac_815.patch](tarball://root/attachments/some-uuid/ticket815/trac_815.patch) by anakha created at 2008-10-24 02:20:59\n\nLost of deleted code, a bit of modification and doctesting for .sage works as well as for the rest.\n\nIt's still of limited interest for files that are not part of the sage library, but at least it won't lie about the results anymore",
    "created_at": "2008-10-24T02:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5068",
    "user": "anakha"
}
```

Attachment [trac_815.patch](tarball://root/attachments/some-uuid/ticket815/trac_815.patch) by anakha created at 2008-10-24 02:20:59

Lost of deleted code, a bit of modification and doctesting for .sage works as well as for the rest.

It's still of limited interest for files that are not part of the sage library, but at least it won't lie about the results anymore



---

archive/issue_comments_005069.json:
```json
{
    "body": "this replaces the above and is a REBASING AGAINST 3.1.2.alpha2.",
    "created_at": "2008-11-27T07:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5069",
    "user": "was"
}
```

this replaces the above and is a REBASING AGAINST 3.1.2.alpha2.



---

archive/issue_comments_005070.json:
```json
{
    "body": "Attachment [scripts-815.patch](tarball://root/attachments/some-uuid/ticket815/scripts-815.patch) by was created at 2008-11-27 07:14:54\n\nLooks good. Eliminates cruft.",
    "created_at": "2008-11-27T07:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5070",
    "user": "was"
}
```

Attachment [scripts-815.patch](tarball://root/attachments/some-uuid/ticket815/scripts-815.patch) by was created at 2008-11-27 07:14:54

Looks good. Eliminates cruft.



---

archive/issue_comments_005071.json:
```json
{
    "body": "Merged scripts-815.patch in Sage 3.2.1.rc0",
    "created_at": "2008-11-28T07:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5071",
    "user": "mabshoff"
}
```

Merged scripts-815.patch in Sage 3.2.1.rc0



---

archive/issue_comments_005072.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-11-28T07:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/815#issuecomment-5072",
    "user": "mabshoff"
}
```

Resolution: fixed
