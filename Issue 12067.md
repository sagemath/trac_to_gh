# Issue 12067: Better conversion to/from ECL bignums

archive/issues_012067.json:
```json
{
    "body": "Assignee: @williamstein\n\nPreviously, python <-> ECL conversion of bigints went via (decimal!) string representation. This ticket fixes this. Timings before:\n\n```\nsage: from sage.libs.ecl import *\nsage: i = 10^(10^5)\nsage: o = EclObject(i)\nsage: timeit('EclObject(i)')\n5 loops, best of 3: 331 ms per loop\nsage: timeit('o.python()')\n25 loops, best of 3: 18.6 ms per loop\n```\n\nafter:\n\n```\nsage: timeit('EclObject(i)')\n625 loops, best of 3: 44.2 \u00b5s per loop\nsage: timeit('o.python()')\n625 loops, best of 3: 4.49 \u00b5s per loop\n```\n\nThese conversions will benefit symbolic routines that call maxima via the binary interface (integrate, limit, sum) but obviously not the ones that use all-string conversion. Most symbolic work does not involve large integers anyway.\n\nNOTE: Current implementation copies the bitstring twice for python -> ECL. In principle this could be avoided but needs reaching into ECL's internals. The \"ecl_big_register\" routines are exported, but the other routines are \"static\". This is because there are some subtleties with how ECL avoids GMPs memory reallocation to step in. Therefore, the present solution is probably the safest. Should this ever become a bottleneck, we can reconsider.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12239\n\n",
    "created_at": "2011-12-31T01:11:36Z",
    "labels": [
        "component: interfaces",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Better conversion to/from ECL bignums",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12067",
    "user": "https://github.com/nbruin"
}
```
Assignee: @williamstein

Previously, python <-> ECL conversion of bigints went via (decimal!) string representation. This ticket fixes this. Timings before:

```
sage: from sage.libs.ecl import *
sage: i = 10^(10^5)
sage: o = EclObject(i)
sage: timeit('EclObject(i)')
5 loops, best of 3: 331 ms per loop
sage: timeit('o.python()')
25 loops, best of 3: 18.6 ms per loop
```

after:

```
sage: timeit('EclObject(i)')
625 loops, best of 3: 44.2 µs per loop
sage: timeit('o.python()')
625 loops, best of 3: 4.49 µs per loop
```

These conversions will benefit symbolic routines that call maxima via the binary interface (integrate, limit, sum) but obviously not the ones that use all-string conversion. Most symbolic work does not involve large integers anyway.

NOTE: Current implementation copies the bitstring twice for python -> ECL. In principle this could be avoided but needs reaching into ECL's internals. The "ecl_big_register" routines are exported, but the other routines are "static". This is because there are some subtleties with how ECL avoids GMPs memory reallocation to step in. Therefore, the present solution is probably the safest. Should this ever become a bottleneck, we can reconsider.

Issue created by migration from https://trac.sagemath.org/ticket/12239





---

archive/issue_comments_139734.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-31T01:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139734",
    "user": "https://github.com/nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_139735.json:
```json
{
    "body": "Attachment [trac_12239.patch](tarball://root/attachments/some-uuid/ticket12239/trac_12239.patch) by @nbruin created at 2011-12-31 01:56:33",
    "created_at": "2011-12-31T01:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139735",
    "user": "https://github.com/nbruin"
}
```

Attachment [trac_12239.patch](tarball://root/attachments/some-uuid/ticket12239/trac_12239.patch) by @nbruin created at 2011-12-31 01:56:33



---

archive/issue_comments_139736.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-03T14:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139736",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_139737.json:
```json
{
    "body": "Attachment [trac_12239-ecl_bignum.patch](tarball://root/attachments/some-uuid/ticket12239/trac_12239-ecl_bignum.patch) by @burcin created at 2012-01-03 14:02:54\n\nPatch looks good. Applies cleanly to 4.8.alpha4. Tests pass on symbolics related files (`sage/{symbolics,functions,calculus}` etc.). Positive review.\n\nI attached a new patch which also removes the comments that refer to the previous string conversion code and say that this can be done more efficiently.\n\nApply attachment:trac_12239-ecl_bignum.patch only.",
    "created_at": "2012-01-03T14:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139737",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_12239-ecl_bignum.patch](tarball://root/attachments/some-uuid/ticket12239/trac_12239-ecl_bignum.patch) by @burcin created at 2012-01-03 14:02:54

Patch looks good. Applies cleanly to 4.8.alpha4. Tests pass on symbolics related files (`sage/{symbolics,functions,calculus}` etc.). Positive review.

I attached a new patch which also removes the comments that refer to the previous string conversion code and say that this can be done more efficiently.

Apply attachment:trac_12239-ecl_bignum.patch only.



---

archive/issue_comments_139738.json:
```json
{
    "body": "Changing keywords from \"\" to \"ecl, maxima\".",
    "created_at": "2012-01-03T14:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139738",
    "user": "https://github.com/burcin"
}
```

Changing keywords from "" to "ecl, maxima".



---

archive/issue_comments_139739.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-18T08:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12067#issuecomment-139739",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_012092.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-01-18T08:16:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12067",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12067#event-12092"
}
```
