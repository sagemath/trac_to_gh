# Issue 12067: Better conversion to/from ECL bignums

Issue created by migration from Trac.

Original creator: nbruin

Original creation time: 2011-12-31 01:11:36

Assignee: was

Previously, python <-> ECL conversion of bigints went via (decimal!) string representation. This ticket fixes this. Timings before:

```
sage: from sage.libs.ecl import *
sage: i = 10^(10^5)
sage: o = EclObject(i)
sage: timeit('EclObject(i)')
5 loops, best of 3: 331 ms per loop
sage: timeit('o.python()')
25 loops, best of 3: 18.6 ms per loop
```

after:

```
sage: timeit('EclObject(i)')
625 loops, best of 3: 44.2 µs per loop
sage: timeit('o.python()')
625 loops, best of 3: 4.49 µs per loop
```

These conversions will benefit symbolic routines that call maxima via the binary interface (integrate, limit, sum) but obviously not the ones that use all-string conversion. Most symbolic work does not involve large integers anyway.

NOTE: Current implementation copies the bitstring twice for python -> ECL. In principle this could be avoided but needs reaching into ECL's internals. The "ecl_big_register" routines are exported, but the other routines are "static". This is because there are some subtleties with how ECL avoids GMPs memory reallocation to step in. Therefore, the present solution is probably the safest. Should this ever become a bottleneck, we can reconsider.


---

Comment by nbruin created at 2011-12-31 01:56:33

Changing status from new to needs_review.


---

Attachment


---

Comment by burcin created at 2012-01-03 14:02:54

Changing status from needs_review to positive_review.


---

Attachment

Patch looks good. Applies cleanly to 4.8.alpha4. Tests pass on symbolics related files (`sage/{symbolics,functions,calculus}` etc.). Positive review.

I attached a new patch which also removes the comments that refer to the previous string conversion code and say that this can be done more efficiently.

Apply attachment:trac_12239-ecl_bignum.patch only.


---

Comment by burcin created at 2012-01-03 14:02:54

Changing keywords from "" to "ecl, maxima".


---

Comment by jdemeyer created at 2012-01-18 08:16:28

Resolution: fixed
