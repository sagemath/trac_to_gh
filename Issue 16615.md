# Issue 16615: Upgrade eclib to version 20140805

archive/issues_016615.json:
```json
{
    "body": "CC:  leif\n\nThis version makes default args for friends standard compliant. That should fix the eclib problem in #12426.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16852\n\n",
    "created_at": "2014-08-19T12:33:23Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Upgrade eclib to version 20140805",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16615",
    "user": "aapitzsch"
}
```
CC:  leif

This version makes default args for friends standard compliant. That should fix the eclib problem in #12426.

Issue created by migration from https://trac.sagemath.org/ticket/16852





---

archive/issue_comments_219040.json:
```json
{
    "body": "I am now working on making the new spkg.  It should involve no change the library at all.",
    "created_at": "2014-08-26T13:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219040",
    "user": "cremona"
}
```

I am now working on making the new spkg.  It should involve no change the library at all.



---

archive/issue_comments_219041.json:
```json
{
    "body": "Up for review.  the patch (branch) just changes the packa-version.txt and checksums to match the new tarball.  I have tested the install using the check (-c) option and also done a make and tested the whole Sage library: no changes needed.\n----\nNew commits:",
    "created_at": "2014-08-26T14:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219041",
    "user": "cremona"
}
```

Up for review.  the patch (branch) just changes the packa-version.txt and checksums to match the new tarball.  I have tested the install using the check (-c) option and also done a make and tested the whole Sage library: no changes needed.
----
New commits:



---

archive/issue_comments_219042.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-26T14:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219042",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_219043.json:
```json
{
    "body": "Tried it against the latest beta and I couldn't see anything either. Given your commits I would be surprised.",
    "created_at": "2014-08-27T02:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219043",
    "user": "fbissey"
}
```

Tried it against the latest beta and I couldn't see anything either. Given your commits I would be surprised.



---

archive/issue_comments_219044.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-27T02:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219044",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_219045.json:
```json
{
    "body": "Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.",
    "created_at": "2014-08-27T09:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219045",
    "user": "cremona"
}
```

Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.



---

archive/issue_comments_219046.json:
```json
{
    "body": "Replying to [comment:7 cremona]:\n> Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.\n\nNot my experience. I updated the sage-on-gentoo ebuild and it is configured with \n\n```\n--disable-allprogs --with(out)-flint --with(out)-boost\n```\n\nand it finds ntl fine. Is it only a trouble to find it in a sage install that sets CPPFLAGS and LDFLAGS?",
    "created_at": "2014-08-27T10:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219046",
    "user": "fbissey"
}
```

Replying to [comment:7 cremona]:
> Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.

Not my experience. I updated the sage-on-gentoo ebuild and it is configured with 

```
--disable-allprogs --with(out)-flint --with(out)-boost
```

and it finds ntl fine. Is it only a trouble to find it in a sage install that sets CPPFLAGS and LDFLAGS?



---

archive/issue_comments_219047.json:
```json
{
    "body": "Replying to [comment:8 fbissey]:\n> Replying to [comment:7 cremona]:\n> > Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.\n> \n> Not my experience. I updated the sage-on-gentoo ebuild and it is configured with \n> {{{\n> --disable-allprogs --with(out)-flint --with(out)-boost\n> }}}\n> and it finds ntl fine. Is it only a trouble to find it in a sage install that sets CPPFLAGS and LDFLAGS?\n\nWas that using the new NTL, i.e. 6.2.0 or 6.2.1 (yesterday's bugfix)?  I understand that the problem is that if you do not give any --with-ntl then configure uses the AC_SEARCH_LIB command from configure.ac to look for the specific symbol _ntl_gmul but this symbol does not exist in the new NTL.  And all (or almost all) symbols which do exist are mangled versions of C++ function names, which are unsuitable for this purpose (basically because different compilers mangle things in deifferent ways).  On my system the configure works fine using --with-ntl or --with-ntl=yes or --with-ntl=#usr/local, since none of these run the AC_SEARCH_LIB command, and then the compiler and linker do find the include files and libraries without further assistance, but if I do not mention --with-ntl on the configure line then it runs the test and it fails.\n\nThis discussion probably does not belong here since in any case Sage uses an explicit  --with-ntl=\"$SAGE_LOCAL\" which avoids the problematical AC_SEARCH_LIB anyway.",
    "created_at": "2014-08-27T11:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219047",
    "user": "cremona"
}
```

Replying to [comment:8 fbissey]:
> Replying to [comment:7 cremona]:
> > Thanks.  Julien P says that the configure script needs adjustment to work properly with the new NTL but that only applies if you do _not_ give the flag --with-ntl explicitly;  we do, so this should not cause trouble with the NTL upgrade.
> 
> Not my experience. I updated the sage-on-gentoo ebuild and it is configured with 
> {{{
> --disable-allprogs --with(out)-flint --with(out)-boost
> }}}
> and it finds ntl fine. Is it only a trouble to find it in a sage install that sets CPPFLAGS and LDFLAGS?

Was that using the new NTL, i.e. 6.2.0 or 6.2.1 (yesterday's bugfix)?  I understand that the problem is that if you do not give any --with-ntl then configure uses the AC_SEARCH_LIB command from configure.ac to look for the specific symbol _ntl_gmul but this symbol does not exist in the new NTL.  And all (or almost all) symbols which do exist are mangled versions of C++ function names, which are unsuitable for this purpose (basically because different compilers mangle things in deifferent ways).  On my system the configure works fine using --with-ntl or --with-ntl=yes or --with-ntl=#usr/local, since none of these run the AC_SEARCH_LIB command, and then the compiler and linker do find the include files and libraries without further assistance, but if I do not mention --with-ntl on the configure line then it runs the test and it fails.

This discussion probably does not belong here since in any case Sage uses an explicit  --with-ntl="$SAGE_LOCAL" which avoids the problematical AC_SEARCH_LIB anyway.



---

archive/issue_comments_219048.json:
```json
{
    "body": "Right! I didn't try ntl 6.2.x you are right (face palm). You shouldn't need the mangled symbol to write the test, this is pure ignorance. Most C++ compiler vendors have agreed to a common mangling scheme back at the time the release of gcc 3.4.0. It is virtually unchanged since then. I don't know a vendor that doesn't use that scheme. It is even arch independent. What doesn't work without precaution is calling C from C++ without properly declaring it extern_C (or something like that), if you don't, the c++ compiler will look for a mangled symbol when C doesn't have any mangling.",
    "created_at": "2014-08-27T11:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219048",
    "user": "fbissey"
}
```

Right! I didn't try ntl 6.2.x you are right (face palm). You shouldn't need the mangled symbol to write the test, this is pure ignorance. Most C++ compiler vendors have agreed to a common mangling scheme back at the time the release of gcc 3.4.0. It is virtually unchanged since then. I don't know a vendor that doesn't use that scheme. It is even arch independent. What doesn't work without precaution is calling C from C++ without properly declaring it extern_C (or something like that), if you don't, the c++ compiler will look for a mangled symbol when C doesn't have any mangling.



---

archive/issue_comments_219049.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> Right! I didn't try ntl 6.2.x you are right (face palm). You shouldn't need the mangled symbol to write the test, this is pure ignorance. Most C++ compiler vendors have agreed to a common mangling scheme back at the time the release of gcc 3.4.0. It is virtually unchanged since then. I don't know a vendor that doesn't use that scheme. It is even arch independent. What doesn't work without precaution is calling C from C++ without properly declaring it extern_C (or something like that), if you don't, the c++ compiler will look for a mangled symbol when C doesn't have any mangling.\n\nI have had some more private correspondence with Julien Puydt.  He suggests using a test like the one used by linbox at http://anonscm.debian.org/cgit/debian-science/packages/linbox.git/tree/macros/ntl-check.m4 for when no --with-ntl at all is provided.  Otherwise we can continue to assume that the user has given a sensible answer for --with-ntl which will work, as is certainly the case in Sage.",
    "created_at": "2014-08-27T11:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219049",
    "user": "cremona"
}
```

Replying to [comment:10 fbissey]:
> Right! I didn't try ntl 6.2.x you are right (face palm). You shouldn't need the mangled symbol to write the test, this is pure ignorance. Most C++ compiler vendors have agreed to a common mangling scheme back at the time the release of gcc 3.4.0. It is virtually unchanged since then. I don't know a vendor that doesn't use that scheme. It is even arch independent. What doesn't work without precaution is calling C from C++ without properly declaring it extern_C (or something like that), if you don't, the c++ compiler will look for a mangled symbol when C doesn't have any mangling.

I have had some more private correspondence with Julien Puydt.  He suggests using a test like the one used by linbox at http://anonscm.debian.org/cgit/debian-science/packages/linbox.git/tree/macros/ntl-check.m4 for when no --with-ntl at all is provided.  Otherwise we can continue to assume that the user has given a sensible answer for --with-ntl which will work, as is certainly the case in Sage.



---

archive/issue_comments_219050.json:
```json
{
    "body": "Cannot say I like the macro in style or substance. But looking at your configure.ac I can see why you have the current behavior. I think it is wrong and I think using AC_CHECK_LIB is good. Now I see where the mangling issue comes from. It is exactly the opposite of what I say don't work for sure, your test is compiled with a C compiler which doesn't understand that the symbols are mangled. Somehow the symbol that you were testing previously must have been from a part of the library in C.\n\nWe can solve that problem by switching to the c++ for the test [https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html](https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html) and then reverting back for the rest. I may have closer look tomorrow and post a pull request on github.",
    "created_at": "2014-08-27T12:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219050",
    "user": "fbissey"
}
```

Cannot say I like the macro in style or substance. But looking at your configure.ac I can see why you have the current behavior. I think it is wrong and I think using AC_CHECK_LIB is good. Now I see where the mangling issue comes from. It is exactly the opposite of what I say don't work for sure, your test is compiled with a C compiler which doesn't understand that the symbols are mangled. Somehow the symbol that you were testing previously must have been from a part of the library in C.

We can solve that problem by switching to the c++ for the test [https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html](https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html) and then reverting back for the rest. I may have closer look tomorrow and post a pull request on github.



---

archive/issue_comments_219051.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> Cannot say I like the macro in style or substance. But looking at your configure.ac I can see why you have the current behavior. I think it is wrong and I think using AC_CHECK_LIB is good. Now I see where the mangling issue comes from. It is exactly the opposite of what I say don't work for sure, your test is compiled with a C compiler which doesn't understand that the symbols are mangled. Somehow the symbol that you were testing previously must have been from a part of the library in C.\n> \n> We can solve that problem by switching to the c++ for the test [https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html](https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html) and then reverting back for the rest. I may have closer look tomorrow and post a pull request on github.\n\nSounds good, thanks.",
    "created_at": "2014-08-27T12:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219051",
    "user": "cremona"
}
```

Replying to [comment:12 fbissey]:
> Cannot say I like the macro in style or substance. But looking at your configure.ac I can see why you have the current behavior. I think it is wrong and I think using AC_CHECK_LIB is good. Now I see where the mangling issue comes from. It is exactly the opposite of what I say don't work for sure, your test is compiled with a C compiler which doesn't understand that the symbols are mangled. Somehow the symbol that you were testing previously must have been from a part of the library in C.
> 
> We can solve that problem by switching to the c++ for the test [https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html](https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Language-Choice.html) and then reverting back for the rest. I may have closer look tomorrow and post a pull request on github.

Sounds good, thanks.



---

archive/issue_comments_219052.json:
```json
{
    "body": "I was considering the AC_LANG_PUSH/AC_LANG_POP dance to build&run a C++ program just like the linbox macro does. Does that look sane?",
    "created_at": "2014-08-27T12:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219052",
    "user": "Snark"
}
```

I was considering the AC_LANG_PUSH/AC_LANG_POP dance to build&run a C++ program just like the linbox macro does. Does that look sane?



---

archive/issue_comments_219053.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-27T17:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219053",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_219054.json:
```json
{
    "body": "Replying to [comment:14 Snark]:\n> I was considering the AC_LANG_PUSH/AC_LANG_POP dance to build&run a C++ program just like the linbox macro does. Does that look sane?\n\nDoes to me!",
    "created_at": "2014-08-27T18:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16615#issuecomment-219054",
    "user": "fbissey"
}
```

Replying to [comment:14 Snark]:
> I was considering the AC_LANG_PUSH/AC_LANG_POP dance to build&run a C++ program just like the linbox macro does. Does that look sane?

Does to me!
