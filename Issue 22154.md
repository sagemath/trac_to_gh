# Issue 22154: Always use PPL for facet normals of lattice polytopes

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2017-02-18 22:22:15

A follow up to #22310. As promised there, this switch makes even full-dimensional polytopes faster, on the same example we now get

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
625 loops, best of 3: 976 Âµs per loop
```

The reason is that dimension computation used to be quite complicated.


---

Comment by novoselt created at 2017-02-18 22:23:18

Changing status from new to needs_review.


---

Comment by novoselt created at 2017-02-18 22:23:18

Last 10 new commits:


---

Comment by ursula created at 2017-09-28 16:33:38

I successfully installed this patch and tried some variants on the example.  Speed seems to work as advertised:


```
sage: sim = ReflexivePolytope(3,0)
sage: timeit("sim.facet_normals()")
625 loops, best of 3: 576 ns per loop
```



---

Comment by vdelecroix created at 2017-09-29 06:34:56

Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.


---

Comment by novoselt created at 2017-09-29 16:00:54

Replying to [comment:5 vdelecroix]:
> Have you tried using normaliz? In dimension >= 10 it is likely to be faster. For that reason, it is good to have an optional keyword `method=` or `algorithm=` that simplifies speed comparisons.

The interest here is mostly in polytopes of dimensions 3-4-5, when the bottleneck is often the interface between programs. Also, the old code was quite convoluted for many reasons and adding different algorithms would be tricky. One of the goals of this and related tickets was to clean up the mess to indeed allow using different backends for certain operations.


---

Comment by roed created at 2017-09-30 22:46:20

Changing keywords from "" to "sd91".


---

Comment by ursula created at 2017-10-24 20:59:52

Changing keywords from "sd91" to "sd91, sd90".


---

Comment by ursula created at 2017-10-24 23:14:43

I tried building again, and now this patch fails, with errors involving `sage-ursula/src/build/cythonized/sage/`.  My guess is that the transition from Sage 7.6 to the current development branch is too great.  Do you mind updating the patch?


---

Comment by ursula created at 2017-10-24 23:15:35

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2017-10-25 00:23:06

Can you please be more specific in how it fails? The branch merges cleanly and passes tests according to the patchbot.


---

Comment by tscrim created at 2017-10-25 00:44:59

It also works for me. I am guessing what happened is `@`ursula just used the branch, effectively downgrading her version of Sage to that of the branch, and ran `sage -b`, which does not rebuild the necessary parts of Sage. In general, I always make sure to merge it ontop of (my version of) `develop` to avoid regressing Sage (which will include long compilation time). If that is not what [`@`ursula] did, then try running `make build` and then `sage -t`.


---

Comment by tscrim created at 2017-10-25 00:56:19

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-10-25 00:56:19

I made some small formatting changes to more match our style guide. If my changes look good, then positive review.
----
New commits:


---

Comment by novoselt created at 2017-10-25 01:57:34

Thank you!!!

Of course your changes look good - anything to get it in ;-) A small question however:

```
         TypeError: the point M(1, 1) and
-        2-d cone in 2-d lattice N have incompatible lattices!
+         2-d cone in 2-d lattice N have incompatible lattices
```

Your new line apart from dropping the exclamation point due to exception formatting change also adds a space in front of the second part of the broken line. Is this also the style recommended somewhere? I can't recall ever reading it.


---

Comment by novoselt created at 2017-10-25 01:57:34

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-10-25 02:14:54

Not really, but I feel its gives better grouping that it is part of the error message and not some new line of output, similar to indenting function blocks.


---

Comment by tscrim created at 2017-10-25 02:15:47

Also, Python does not use sentence ending punctuation for any exceptions (or initial uppercase letters).


---

Comment by vbraun created at 2017-10-29 10:32:11

Resolution: fixed
