# Issue 33074: gentoo: linker (ld) warnings when running doctests, possibly ntl-related

archive/issues_033074.json:
```json
{
    "body": "CC:  @mkoeppe\n\nSee #31758 for context.\n\nResults with `9.6.beta0` installed:\n\n```\nsage -t --random-seed=284167369500062762141862658612626387696 src/sage/misc/sagedoc.py\n**********************************************************************\nFile \"src/sage/misc/sagedoc.py\", line 653, in sage.misc.sagedoc.format\nFailed example:\n    cython('\\n'.join(cython_code))\nExpected nothing\nGot:\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.so when searching for -lm\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.a when searching for -lm\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.so when searching for -lpthread\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.a when searching for -lpthread\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.so when searching for -lc\n    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.a when sea\nrching for -lc\n**********************************************************************\n1 item had failures:\n   1 of  18 in sage.misc.sagedoc.format\n    [104 tests, 1 failure, 19.56 s]\n```\n\nand in numerous other places.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33311\n\n",
    "created_at": "2022-02-08T04:55:40Z",
    "labels": [
        "component: doctest framework",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "gentoo: linker (ld) warnings when running doctests, possibly ntl-related",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33074",
    "user": "https://github.com/strogdon"
}
```
CC:  @mkoeppe

See #31758 for context.

Results with `9.6.beta0` installed:

```
sage -t --random-seed=284167369500062762141862658612626387696 src/sage/misc/sagedoc.py
**********************************************************************
File "src/sage/misc/sagedoc.py", line 653, in sage.misc.sagedoc.format
Failed example:
    cython('\n'.join(cython_code))
Expected nothing
Got:
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.so when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.a when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.so when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.a when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.so when searching for -lc
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.a when sea
rching for -lc
**********************************************************************
1 item had failures:
   1 of  18 in sage.misc.sagedoc.format
    [104 tests, 1 failure, 19.56 s]
```

and in numerous other places.

Issue created by migration from https://trac.sagemath.org/ticket/33311





---

archive/issue_comments_470915.json:
```json
{
    "body": "Also,\n\n```\n$ grep \\/\\/\\/ pkgs/sage-conf/sage_conf.py\n\nNTL_INCDIR = \"///usr/include\"\nNTL_LIBDIR = \"///usr/lib\"\n```\n\n\nwhich I think should be\n\n```\nNTL_INCDIR = \"/usr/include\"\nNTL_LIBDIR = \"/usr/lib64\"\n```\n",
    "created_at": "2022-02-08T04:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470915",
    "user": "https://github.com/strogdon"
}
```

Also,

```
$ grep \/\/\/ pkgs/sage-conf/sage_conf.py

NTL_INCDIR = "///usr/include"
NTL_LIBDIR = "///usr/lib"
```


which I think should be

```
NTL_INCDIR = "/usr/include"
NTL_LIBDIR = "/usr/lib64"
```




---

archive/issue_comments_470916.json:
```json
{
    "body": "Note: reference ticket changed",
    "created_at": "2022-02-08T05:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470916",
    "user": "https://github.com/strogdon"
}
```

Note: reference ticket changed



---

archive/issue_comments_470917.json:
```json
{
    "body": "More info,\n\n```\n$ grep -r 'NTL_LIBDIR =' ./\n./src/sage/env.py:NTL_LIBDIR = var(\"NTL_LIBDIR\")\n./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/env.py:NTL_LIBDIR = var(\"NTL_LIBDIR\")\n./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_conf.py:NTL_LIBDIR = \"///usr/lib\"\n./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/env.py:NTL_LIBDIR = var(\"NTL_LIBDIR\")\n./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage_conf.py:NTL_LIBDIR = \"/usr/lib64\"\n./pkgs/sage-conf/sage_conf.py.in:NTL_LIBDIR = \"@NTL_LIBDIR@\"\n./pkgs/sage-conf/sage_conf.py:NTL_LIBDIR = \"///usr/lib\"\n./pkgs/sage-conf/build/lib/sage_conf.py:NTL_LIBDIR = \"///usr/lib\"\n./pkgs/sagemath-standard/build/lib.linux-x86_64-3.10/sage/env.py:NTL_LIBDIR = var(\"NTL_LIBDIR\")\n./pkgs/sagemath-standard/build/lib.linux-x86_64-3.9/sage/env.py:NTL_LIBDIR = var(\"NTL_LIBDIR\")\n./build/make/Makefile-auto:NTL_LIBDIR = ///usr/lib\n./build/make/Makefile-auto.in:NTL_LIBDIR = @NTL_LIBDIR@\n```\n\n\nThe changes from #31578 seem to be in place?",
    "created_at": "2022-02-08T05:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470917",
    "user": "https://github.com/strogdon"
}
```

More info,

```
$ grep -r 'NTL_LIBDIR =' ./
./src/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage_conf.py:NTL_LIBDIR = "/usr/lib64"
./pkgs/sage-conf/sage_conf.py.in:NTL_LIBDIR = "@NTL_LIBDIR@"
./pkgs/sage-conf/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./pkgs/sage-conf/build/lib/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./pkgs/sagemath-standard/build/lib.linux-x86_64-3.10/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./pkgs/sagemath-standard/build/lib.linux-x86_64-3.9/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./build/make/Makefile-auto:NTL_LIBDIR = ///usr/lib
./build/make/Makefile-auto.in:NTL_LIBDIR = @NTL_LIBDIR@
```


The changes from #31578 seem to be in place?



---

archive/issue_comments_470918.json:
```json
{
    "body": "But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.",
    "created_at": "2022-02-08T06:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470918",
    "user": "https://github.com/kiwifb"
}
```

But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.



---

archive/issue_comments_470919.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.\n\nYes, this is the problem. I had forgotten about that. It's been a bit. For some reason, my local `ntl` install is not the one that installs the .pc file. It would be nice to get this completely fixed. Sorry for the noise.",
    "created_at": "2022-02-08T07:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470919",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:6 fbissey]:
> But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.

Yes, this is the problem. I had forgotten about that. It's been a bit. For some reason, my local `ntl` install is not the one that installs the .pc file. It would be nice to get this completely fixed. Sorry for the noise.



---

archive/issue_comments_470920.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-08T07:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470920",
    "user": "https://github.com/strogdon"
}
```

Changing status from new to needs_review.



---

archive/issue_events_087916.json:
```json
{
    "actor": "https://github.com/strogdon",
    "created_at": "2022-02-08T07:05:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33074#event-87916"
}
```



---

archive/issue_comments_470921.json:
```json
{
    "body": "NTL installs one library, libntl, that doesn't conflict with any other software. It's in the library search path (`-lntl`) whether installed on the system or via SPKG.\n\nSo AFAIK, the only reason we guess `NTL_LIBDIR` in the first place is for homebrew users who forget to source their homebrew config and then try to use the C compiler in a broken environment. It continues to waste everyone's time and should just be deleted.",
    "created_at": "2022-02-09T03:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33074#issuecomment-470921",
    "user": "https://github.com/orlitzky"
}
```

NTL installs one library, libntl, that doesn't conflict with any other software. It's in the library search path (`-lntl`) whether installed on the system or via SPKG.

So AFAIK, the only reason we guess `NTL_LIBDIR` in the first place is for homebrew users who forget to source their homebrew config and then try to use the C compiler in a broken environment. It continues to waste everyone's time and should just be deleted.
