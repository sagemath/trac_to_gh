# Issue 33074: gentoo: linker (ld) warnings when running doctests, possibly ntl-related

Issue created by migration from https://trac.sagemath.org/ticket/33311

Original creator: strogdon

Original creation time: 2022-02-08 04:55:40

CC:  mkoeppe

See #31758 for context.

Results with `9.6.beta0` installed:

```
sage -t --random-seed=284167369500062762141862658612626387696 src/sage/misc/sagedoc.py
**********************************************************************
File "src/sage/misc/sagedoc.py", line 653, in sage.misc.sagedoc.format
Failed example:
    cython('\n'.join(cython_code))
Expected nothing
Got:
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.so when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libm.a when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.so when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libpthread.a when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.so when searching for -lc
    /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible ///usr/lib/libc.a when sea
rching for -lc
**********************************************************************
1 item had failures:
   1 of  18 in sage.misc.sagedoc.format
    [104 tests, 1 failure, 19.56 s]
```

and in numerous other places.


---

Comment by strogdon created at 2022-02-08 04:58:00

Also,

```
$ grep \/\/\/ pkgs/sage-conf/sage_conf.py

NTL_INCDIR = "///usr/include"
NTL_LIBDIR = "///usr/lib"
```


which I think should be

```
NTL_INCDIR = "/usr/include"
NTL_LIBDIR = "/usr/lib64"
```



---

Comment by strogdon created at 2022-02-08 05:42:49

Note: reference ticket changed


---

Comment by strogdon created at 2022-02-08 05:53:19

More info,

```
$ grep -r 'NTL_LIBDIR =' ./
./src/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage_conf.py:NTL_LIBDIR = "/usr/lib64"
./pkgs/sage-conf/sage_conf.py.in:NTL_LIBDIR = "@NTL_LIBDIR@"
./pkgs/sage-conf/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./pkgs/sage-conf/build/lib/sage_conf.py:NTL_LIBDIR = "///usr/lib"
./pkgs/sagemath-standard/build/lib.linux-x86_64-3.10/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./pkgs/sagemath-standard/build/lib.linux-x86_64-3.9/sage/env.py:NTL_LIBDIR = var("NTL_LIBDIR")
./build/make/Makefile-auto:NTL_LIBDIR = ///usr/lib
./build/make/Makefile-auto.in:NTL_LIBDIR = @NTL_LIBDIR@
```


The changes from #31578 seem to be in place?


---

Comment by fbissey created at 2022-02-08 06:23:31

But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.


---

Comment by strogdon created at 2022-02-08 07:05:27

Replying to [comment:6 fbissey]:
> But for the changes of #31578 to really work, we need to have a .pc file for NTL. And right now it doesn't exist. My PR for a NTL .pc file is still pending. Fighting with an unrelated PR from Matthias that touch a similar bit of code last time I checked.

Yes, this is the problem. I had forgotten about that. It's been a bit. For some reason, my local `ntl` install is not the one that installs the .pc file. It would be nice to get this completely fixed. Sorry for the noise.


---

Comment by strogdon created at 2022-02-08 07:05:27

Changing status from new to needs_review.


---

Comment by mjo created at 2022-02-09 03:49:28

NTL installs one library, libntl, that doesn't conflict with any other software. It's in the library search path (`-lntl`) whether installed on the system or via SPKG.

So AFAIK, the only reason we guess `NTL_LIBDIR` in the first place is for homebrew users who forget to source their homebrew config and then try to use the C compiler in a broken environment. It continues to waste everyone's time and should just be deleted.
