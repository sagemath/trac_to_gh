# Issue 13921: module_morphism is too liberal on inverting

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2013-02-14 22:40:15

Assignee: jason, was

CC:  sage-combinat

Keywords: module morphism, inverse

Not saying this is an actual issue, since it seems to depend on bad user input.

Since I don't know how to reliably do function declarations in the console, I'm making a py file and then importing it:

PY file:


```
def diag_func(p):
      if len(p)==0: return 1
      else: return p[0]
```


Console:


```
sage: attach ../diagbug.py #file quoted above
sage: X = CombinatorialFreeModule(ZZ, Partitions(), prefix='x'); x = X.basis();
sage: Y = CombinatorialFreeModule(ZZ, Partitions(), prefix='y'); y = Y.basis()
sage: xty = X.module_morphism(diagonal=diag_func, codomain=Y)
sage: ytx = ~xty                
sage: ytx(y[Partition([3,2,1])])
1/3*x[This is the Trac macro *3, 2, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#3, 2, 1-macro)
sage: ytx(y[Partition([3,2,1])]).parent()
Free module generated by Partitions over Integer Ring
```


Since I'm working over ZZ, I'd have expected the "ytx(y[Partition([3,2,1])])" to throw an error, but definitely I'd have expected the parent to not be defined over ZZ.
