# Issue 27082: Upgrade to cryptominisat 5.6.7

archive/issues_027082.json:
```json
{
    "body": "CC:  @embray @jdemeyer @saraedum @slel tmonteil @videlec @orlitzky\n\nKeywords: upgrade, cryptominisat\n\nThis ticket is to upgrade to cryptominisat 5.6.7.\n\n- **Tarball**: \u200bhttps://github.com/msoos/cryptominisat/archive/5.6.7.tar.gz\n\n(to be renamed cryptominisat-5.6.7.tar.gz)\n\nIssue created by migration from https://trac.sagemath.org/ticket/27319\n\n",
    "created_at": "2019-02-19T08:44:20Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Upgrade to cryptominisat 5.6.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27082",
    "user": "https://github.com/slel"
}
```
CC:  @embray @jdemeyer @saraedum @slel tmonteil @videlec @orlitzky

Keywords: upgrade, cryptominisat

This ticket is to upgrade to cryptominisat 5.6.7.

- **Tarball**: â€‹https://github.com/msoos/cryptominisat/archive/5.6.7.tar.gz

(to be renamed cryptominisat-5.6.7.tar.gz)

Issue created by migration from https://trac.sagemath.org/ticket/27319





---

archive/issue_comments_381068.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2019-02-19T15:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381068",
    "user": "https://github.com/embray"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_381069.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to task.",
    "created_at": "2019-02-19T15:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381069",
    "user": "https://github.com/embray"
}
```

Changing type from PLEASE CHANGE to task.



---

archive/issue_events_067837.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27082#event-67837"
}
```



---

archive/issue_comments_381070.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381070",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_381071.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-25T05:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381071",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_381072.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-25T05:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381072",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_381073.json:
```json
{
    "body": "Here is a branch.",
    "created_at": "2019-05-25T05:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381073",
    "user": "https://github.com/fchapoton"
}
```

Here is a branch.



---

archive/issue_comments_381074.json:
```json
{
    "body": "by the way, any idea on the following failure of the arando patchbot ?\n\n```\nsage -t --long src/sage/sat/boolean_polynomials.py\n**********************************************************************\nFile \"src/sage/sat/boolean_polynomials.py\", line 146, in sage.sat.boolean_polynomials.solve\nFailed example:\n    len(sls_aes)                                                                      # optional - cryptominisat, long time\nExpected:\n    256\nGot:\n    18\n**********************************************************************\n1 item had failures:\n   1 of  41 in sage.sat.boolean_polynomials.solve\n    [46 tests, 1 failure, 186.16 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed\n```\n",
    "created_at": "2019-05-27T14:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381074",
    "user": "https://github.com/fchapoton"
}
```

by the way, any idea on the following failure of the arando patchbot ?

```
sage -t --long src/sage/sat/boolean_polynomials.py
**********************************************************************
File "src/sage/sat/boolean_polynomials.py", line 146, in sage.sat.boolean_polynomials.solve
Failed example:
    len(sls_aes)                                                                      # optional - cryptominisat, long time
Expected:
    256
Got:
    18
**********************************************************************
1 item had failures:
   1 of  41 in sage.sat.boolean_polynomials.solve
    [46 tests, 1 failure, 186.16 s]
----------------------------------------------------------------------
sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed
```




---

archive/issue_comments_381075.json:
```json
{
    "body": "Replying to [comment:7 chapoton]:\n> by the way, any idea on the following failure of the arando patchbot ?\n> {{{\n> sage -t --long src/sage/sat/boolean_polynomials.py\n> **********************************************************************\n> File \"src/sage/sat/boolean_polynomials.py\", line 146, in sage.sat.boolean_polynomials.solve\n> Failed example:\n>     len(sls_aes)                                                                      # optional - cryptominisat, long time\n> Expected:\n>     256\n> Got:\n>     18\n> **********************************************************************\n> 1 item had failures:\n>    1 of  41 in sage.sat.boolean_polynomials.solve\n>     [46 tests, 1 failure, 186.16 s]\n> ----------------------------------------------------------------------\n> sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed\n> }}}\n\nI have a similar issue on a 32-bit VM. We should inspect further.",
    "created_at": "2019-05-28T19:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381075",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:7 chapoton]:
> by the way, any idea on the following failure of the arando patchbot ?
> {{{
> sage -t --long src/sage/sat/boolean_polynomials.py
> **********************************************************************
> File "src/sage/sat/boolean_polynomials.py", line 146, in sage.sat.boolean_polynomials.solve
> Failed example:
>     len(sls_aes)                                                                      # optional - cryptominisat, long time
> Expected:
>     256
> Got:
>     18
> **********************************************************************
> 1 item had failures:
>    1 of  41 in sage.sat.boolean_polynomials.solve
>     [46 tests, 1 failure, 186.16 s]
> ----------------------------------------------------------------------
> sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed
> }}}

I have a similar issue on a 32-bit VM. We should inspect further.



---

archive/issue_comments_381076.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-28T19:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381076",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_381077.json:
```json
{
    "body": "I re-checked: the problem was already here on 5.6.6, but not on 5.0.1.",
    "created_at": "2019-05-28T20:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381077",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I re-checked: the problem was already here on 5.6.6, but not on 5.0.1.



---

archive/issue_comments_381078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-14T09:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_381079.json:
```json
{
    "body": "I have made the necessary changes for python3-compatible doctests (because one cannot compare dicts in python3)\n\nI have also replaced `eqs = map(R, eqs)` by list comprehension in the line before the failing doctest in `src/sage/sat/boolean_polynomials.py`.",
    "created_at": "2019-06-14T09:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381079",
    "user": "https://github.com/fchapoton"
}
```

I have made the necessary changes for python3-compatible doctests (because one cannot compare dicts in python3)

I have also replaced `eqs = map(R, eqs)` by list comprehension in the line before the failing doctest in `src/sage/sat/boolean_polynomials.py`.



---

archive/issue_comments_381080.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381080",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_067838.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27082#event-67838"
}
```



---

archive/issue_events_067839.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27082#event-67839"
}
```



---

archive/issue_comments_381081.json:
```json
{
    "body": "The result of the failing doctest on arando seems to be random, varying from 16 to 25.",
    "created_at": "2019-06-17T09:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381081",
    "user": "https://github.com/fchapoton"
}
```

The result of the failing doctest on arando seems to be random, varying from 16 to 25.



---

archive/issue_comments_381082.json:
```json
{
    "body": "Thierry, or somebody else, please have a look. This contains some changes that are required for py3-compatibility !\n\nMaybe we can still update, even if this does not fix the 32-bit doctest. But maybe it does ?",
    "created_at": "2019-06-27T09:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381082",
    "user": "https://github.com/fchapoton"
}
```

Thierry, or somebody else, please have a look. This contains some changes that are required for py3-compatibility !

Maybe we can still update, even if this does not fix the 32-bit doctest. But maybe it does ?



---

archive/issue_comments_381083.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-27T09:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381083",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_381084.json:
```json
{
    "body": "Damn, now i have an issue building cryptominisat on 64 standard machine:\n\n\n```\n[ 94%] Linking CXX executable ../cryptominisat5\ncd /opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src/cmsat5-src && /opt/sagemath/sage-source/local/bin/cmake -E cmake_link_script CMakeFiles/cryptominisat5-bin.dir/link.txt --verbose=ON\n/usr/bin/g++  -std=gnu++11   -mtune=native -Wall -Wextra -Wunused -Wsign-compare -fno-omit-frame-pointer -Wtype-limits -Wuninitialized -Wno-deprecated -Wstrict-aliasing -Wpointer-arith -Wpointer-arith -Wformat-nonliteral -Winit-self -Wparentheses -Wunreachable-code -ggdb3 -Wlogical-op -Wnull-dereference -Wdouble-promotion -Wshadow -Wformat=2 -pedantic   -L/opt/sagemath/sage-source/local/lib -Wl,-rpath,/opt/sagemath/sage-source/local/lib -O2 -Wl,--discard-all -Wl,--build-id=sha1 -rdynamic CMakeFiles/cryptominisat5-bin.dir/main.cpp.o CMakeFiles/cryptominisat5-bin.dir/main_exe.cpp.o CMakeFiles/cryptominisat5-bin.dir/signalcode.cpp.o  -o ../cryptominisat5 -Wl,-rpath,/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src/lib: ../lib/libcryptominisat5.so.5.6 /usr/lib/x86_64-linux-gnu/libz.so /usr/lib/x86_64-linux-gnu/libboost_program_options.so /opt/sagemath/sage-source/local/lib/libm4ri.so -pthread \n/opt/sagemath/sage-source/local/lib/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'\ncollect2: error: ld returned 1 exit status\ncmsat5-src/CMakeFiles/cryptominisat5-bin.dir/build.make:117: recipe for target 'cryptominisat5' failed\nmake[4]: *** [cryptominisat5] Error 1\nmake[4]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'\nCMakeFiles/Makefile2:197: recipe for target 'cmsat5-src/CMakeFiles/cryptominisat5-bin.dir/all' failed\nmake[3]: *** [cmsat5-src/CMakeFiles/cryptominisat5-bin.dir/all] Error 2\nmake[3]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'\nMakefile:129: recipe for target 'all' failed\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'\n********************************************************************************\nError building cryptominisat-5.6.8\n```\n\n\nLet me rebuild `libpng` in case.",
    "created_at": "2019-06-28T11:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381084",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Damn, now i have an issue building cryptominisat on 64 standard machine:


```
[ 94%] Linking CXX executable ../cryptominisat5
cd /opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src/cmsat5-src && /opt/sagemath/sage-source/local/bin/cmake -E cmake_link_script CMakeFiles/cryptominisat5-bin.dir/link.txt --verbose=ON
/usr/bin/g++  -std=gnu++11   -mtune=native -Wall -Wextra -Wunused -Wsign-compare -fno-omit-frame-pointer -Wtype-limits -Wuninitialized -Wno-deprecated -Wstrict-aliasing -Wpointer-arith -Wpointer-arith -Wformat-nonliteral -Winit-self -Wparentheses -Wunreachable-code -ggdb3 -Wlogical-op -Wnull-dereference -Wdouble-promotion -Wshadow -Wformat=2 -pedantic   -L/opt/sagemath/sage-source/local/lib -Wl,-rpath,/opt/sagemath/sage-source/local/lib -O2 -Wl,--discard-all -Wl,--build-id=sha1 -rdynamic CMakeFiles/cryptominisat5-bin.dir/main.cpp.o CMakeFiles/cryptominisat5-bin.dir/main_exe.cpp.o CMakeFiles/cryptominisat5-bin.dir/signalcode.cpp.o  -o ../cryptominisat5 -Wl,-rpath,/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src/lib: ../lib/libcryptominisat5.so.5.6 /usr/lib/x86_64-linux-gnu/libz.so /usr/lib/x86_64-linux-gnu/libboost_program_options.so /opt/sagemath/sage-source/local/lib/libm4ri.so -pthread 
/opt/sagemath/sage-source/local/lib/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'
collect2: error: ld returned 1 exit status
cmsat5-src/CMakeFiles/cryptominisat5-bin.dir/build.make:117: recipe for target 'cryptominisat5' failed
make[4]: *** [cryptominisat5] Error 1
make[4]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'
CMakeFiles/Makefile2:197: recipe for target 'cmsat5-src/CMakeFiles/cryptominisat5-bin.dir/all' failed
make[3]: *** [cmsat5-src/CMakeFiles/cryptominisat5-bin.dir/all] Error 2
make[3]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'
Makefile:129: recipe for target 'all' failed
make[2]: *** [all] Error 2
make[2]: Leaving directory '/opt/sagemath/sage-source/local/var/tmp/sage/build/cryptominisat-5.6.8/src'
********************************************************************************
Error building cryptominisat-5.6.8
```


Let me rebuild `libpng` in case.



---

archive/issue_comments_381085.json:
```json
{
    "body": "I still have the issue after rebuilding `libpng` (and a large part of Sage). Note that i merged with Sage 8.8, could the problem be related to #27186 ?",
    "created_at": "2019-07-05T07:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381085",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I still have the issue after rebuilding `libpng` (and a large part of Sage). Note that i merged with Sage 8.8, could the problem be related to #27186 ?



---

archive/issue_comments_381086.json:
```json
{
    "body": "This looks like an attempt to update, rather than a full re-build after `make distclean`.\n\nNow Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.\nIn any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. \n\nCould you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`\nand see whether `libpng` is picked from the system or not?",
    "created_at": "2019-07-05T08:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381086",
    "user": "https://github.com/dimpase"
}
```

This looks like an attempt to update, rather than a full re-build after `make distclean`.

Now Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.
In any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. 

Could you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`
and see whether `libpng` is picked from the system or not?



---

archive/issue_comments_381087.json:
```json
{
    "body": "the update works for me on the 8.8.bera1, on Gentoo Linux",
    "created_at": "2019-07-05T10:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381087",
    "user": "https://github.com/dimpase"
}
```

the update works for me on the 8.8.bera1, on Gentoo Linux



---

archive/issue_comments_381088.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> This looks like an attempt to update, rather than a full re-build after `make distclean`.\n> \n> Now Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.\n> In any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. \n> \n> Could you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`\n> and see whether `libpng` is picked from the system or not?\n\nI will give a try, but it should also work with the `libpng` provided by Sage.",
    "created_at": "2019-07-05T13:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381088",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:17 dimpase]:
> This looks like an attempt to update, rather than a full re-build after `make distclean`.
> 
> Now Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.
> In any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. 
> 
> Could you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`
> and see whether `libpng` is picked from the system or not?

I will give a try, but it should also work with the `libpng` provided by Sage.



---

archive/issue_comments_381089.json:
```json
{
    "body": "Thierry, I have troubles with the patchbot server. Could you please phone me ?\n\nReplying to [comment:19 tmonteil]:\n\n> Replying to [comment:17 dimpase]:\n> > This looks like an attempt to update, rather than a full re-build after `make distclean`.\n> > \n> > Now Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.\n> > In any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. \n> > \n> > Could you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`\n> > and see whether `libpng` is picked from the system or not?\n> \n> I will give a try, but it should also work with the `libpng` provided by Sage.",
    "created_at": "2019-07-05T13:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381089",
    "user": "https://github.com/fchapoton"
}
```

Thierry, I have troubles with the patchbot server. Could you please phone me ?

Replying to [comment:19 tmonteil]:

> Replying to [comment:17 dimpase]:
> > This looks like an attempt to update, rather than a full re-build after `make distclean`.
> > 
> > Now Sage will try using libpng from your system. Blindly doing `./sage -f libpng` might actually be breaking your build, if it is not followed by `./configure`.
> > In any event, this is one of significant changes to configure, and all bets are off whether `make distclean` is needed. 
> > 
> > Could you try uninstalling `libpng` ? (`make libpng-clean`), then `./configure`
> > and see whether `libpng` is picked from the system or not?
> 
> I will give a try, but it should also work with the `libpng` provided by Sage.



---

archive/issue_comments_381090.json:
```json
{
    "body": "well, I can guess what happens with libpng. We have now a check that if system libpng is available then system zlib is used, and it need not be compatible with Sage's libpng.\n\nIf you override this and force-install libpng in Sage then for some reason a compatible zlib doesn't get installed, and we see this error (which should be fixable by manually installing Sage's zlib)",
    "created_at": "2019-07-05T14:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381090",
    "user": "https://github.com/dimpase"
}
```

well, I can guess what happens with libpng. We have now a check that if system libpng is available then system zlib is used, and it need not be compatible with Sage's libpng.

If you override this and force-install libpng in Sage then for some reason a compatible zlib doesn't get installed, and we see this error (which should be fixable by manually installing Sage's zlib)



---

archive/issue_comments_381091.json:
```json
{
    "body": "As I noted over in #27186, libpng won't even use `inflateValidate` unless the zlib headers are new enough to have it. Note that Sage's zlib does have `inflateValidate`. If I had to guess, this error,\n\n\n```\n/opt/sagemath/sage-source/local/lib/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'\n```\n\n\nsuggests to me that (Sage's) libpng was built against new headers that do have `inflateValidate`, and then linked against an older (system) copy of zlib that doesn't have `inflateValidate`.\n\nWe'll need the gory details of your libpng build, including the header/library search path used during the build. (If I knew how to get those off the top of my head I'd be telling you how to do it; I'll need to come back to this when I have some free time.)",
    "created_at": "2019-07-05T15:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381091",
    "user": "https://github.com/orlitzky"
}
```

As I noted over in #27186, libpng won't even use `inflateValidate` unless the zlib headers are new enough to have it. Note that Sage's zlib does have `inflateValidate`. If I had to guess, this error,


```
/opt/sagemath/sage-source/local/lib/libpng16.so.16: undefined reference to `inflateValidate@ZLIB_1.2.9'
```


suggests to me that (Sage's) libpng was built against new headers that do have `inflateValidate`, and then linked against an older (system) copy of zlib that doesn't have `inflateValidate`.

We'll need the gory details of your libpng build, including the header/library search path used during the build. (If I knew how to get those off the top of my head I'd be telling you how to do it; I'll need to come back to this when I have some free time.)



---

archive/issue_comments_381092.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-09T00:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381092",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_381093.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-10T01:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27082#issuecomment-381093",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067840.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-10T01:31:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27082",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27082#event-67840"
}
```
