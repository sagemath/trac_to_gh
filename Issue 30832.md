# Issue 30832: Upgrade: Flint 2.7.0

archive/issues_030832.json:
```json
{
    "body": "CC:  @antonio-rojas @dimpase @kiwifb @timokau @isuruf @orlitzky @mkoeppe @slel @saraedum @videlec @kliem\n\nKeywords: upgrade, flint\n\nThis is to upgrade to Flint 2.7.0.\n\nOur last upgrade was to Flint 2.6.3 in #29719.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31069\n\n",
    "created_at": "2020-12-17T20:40:10Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Upgrade: Flint 2.7.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30832",
    "user": "https://github.com/slel"
}
```
CC:  @antonio-rojas @dimpase @kiwifb @timokau @isuruf @orlitzky @mkoeppe @slel @saraedum @videlec @kliem

Keywords: upgrade, flint

This is to upgrade to Flint 2.7.0.

Our last upgrade was to Flint 2.6.3 in #29719.

Issue created by migration from https://trac.sagemath.org/ticket/31069





---

archive/issue_comments_440145.json:
```json
{
    "body": "Flint 2.7-rc2 is out. Can someone test with Sage?\n\n- https://github.com/wbhart/flint2/releases\n- [sage-devel announcement: flint 2.7.0 rc1, rc2](https://groups.google.com/g/sage-devel/c/cW2MsZDCrJY)",
    "created_at": "2020-12-17T20:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440145",
    "user": "https://github.com/slel"
}
```

Flint 2.7-rc2 is out. Can someone test with Sage?

- https://github.com/wbhart/flint2/releases
- [sage-devel announcement: flint 2.7.0 rc1, rc2](https://groups.google.com/g/sage-devel/c/cW2MsZDCrJY)



---

archive/issue_comments_440146.json:
```json
{
    "body": "Flint 2.7.0 was released today (2020-12-18).",
    "created_at": "2020-12-18T10:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440146",
    "user": "https://github.com/slel"
}
```

Flint 2.7.0 was released today (2020-12-18).



---

archive/issue_comments_440147.json:
```json
{
    "body": "singular and e-antic fail to build due to the API changes in `fmpz_mod_poly`",
    "created_at": "2020-12-18T11:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440147",
    "user": "https://github.com/antonio-rojas"
}
```

singular and e-antic fail to build due to the API changes in `fmpz_mod_poly`



---

archive/issue_comments_440148.json:
```json
{
    "body": "Actually, Singular is fixed in the (just released) 4.2.0 version. Unfortunately doesn't help much since the Singular upgrade has been stuck for years in #25993",
    "created_at": "2020-12-18T15:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440148",
    "user": "https://github.com/antonio-rojas"
}
```

Actually, Singular is fixed in the (just released) 4.2.0 version. Unfortunately doesn't help much since the Singular upgrade has been stuck for years in #25993



---

archive/issue_comments_440149.json:
```json
{
    "body": "sagelib itself builds fine with flint 2.7 and passes doctests, modulo the singular upgrade.",
    "created_at": "2020-12-19T09:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440149",
    "user": "https://github.com/antonio-rojas"
}
```

sagelib itself builds fine with flint 2.7 and passes doctests, modulo the singular upgrade.



---

archive/issue_events_081110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-27T18:56:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81110"
}
```



---

archive/issue_comments_440150.json:
```json
{
    "body": "For the record, we are now up to Flint 2.7.1. As the timing and numbering suggest, this is mainly a bugfix release.",
    "created_at": "2021-01-22T05:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440150",
    "user": "https://github.com/kedlaya"
}
```

For the record, we are now up to Flint 2.7.1. As the timing and numbering suggest, this is mainly a bugfix release.



---

archive/issue_comments_440151.json:
```json
{
    "body": "e-antic has been fixed (in head, to be 1.0.0).",
    "created_at": "2021-01-23T22:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440151",
    "user": "https://github.com/thierry-FreeBSD"
}
```

e-antic has been fixed (in head, to be 1.0.0).



---

archive/issue_comments_440152.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-02-20T09:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440152",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_440153.json:
```json
{
    "body": "I did not have any trouble to build singular. What was the issue?",
    "created_at": "2021-02-20T10:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440153",
    "user": "https://github.com/videlec"
}
```

I did not have any trouble to build singular. What was the issue?



---

archive/issue_comments_440154.json:
```json
{
    "body": "Replying to [comment:16 vdelecroix]:\n> I did not have any trouble to build singular. What was the issue?\n\n\nWhich version of singular?",
    "created_at": "2021-02-20T10:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440154",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:16 vdelecroix]:
> I did not have any trouble to build singular. What was the issue?


Which version of singular?



---

archive/issue_comments_440155.json:
```json
{
    "body": "Replying to [comment:17 arojas]:\n> Replying to [comment:16 vdelecroix]:\n> > I did not have any trouble to build singular. What was the issue?\n\n> \n> Which version of singular?\n\n\n4.1.1p2.p0 shipped with sage 9.3.beta7",
    "created_at": "2021-02-20T12:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440155",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:17 arojas]:
> Replying to [comment:16 vdelecroix]:
> > I did not have any trouble to build singular. What was the issue?

> 
> Which version of singular?


4.1.1p2.p0 shipped with sage 9.3.beta7



---

archive/issue_comments_440156.json:
```json
{
    "body": "Replying to [comment:18 vdelecroix]:\n> Replying to [comment:17 arojas]:\n> > Replying to [comment:16 vdelecroix]:\n> > > I did not have any trouble to build singular. What was the issue?\n\n> > \n> > Which version of singular?\n\n> \n> 4.1.1p2.p0 shipped with sage 9.3.beta7\n\n\nIt builds because it's not using flint\n\n```\nchecking for FLINT >= 2.4... problem\nSorry, your FLINT version is too old. Disabling.\nconfigure: WARNING: Unable to find FLINT (which is strongly recommended) on your machine: please use --with-flint=PATH_TO_DIR_CONTAINING_LIB_AND_INCLUDE (see also ./configure --help if you do not understand what we are talking about)\n```",
    "created_at": "2021-02-20T12:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440156",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:18 vdelecroix]:
> Replying to [comment:17 arojas]:
> > Replying to [comment:16 vdelecroix]:
> > > I did not have any trouble to build singular. What was the issue?

> > 
> > Which version of singular?

> 
> 4.1.1p2.p0 shipped with sage 9.3.beta7


It builds because it's not using flint

```
checking for FLINT >= 2.4... problem
Sorry, your FLINT version is too old. Disabling.
configure: WARNING: Unable to find FLINT (which is strongly recommended) on your machine: please use --with-flint=PATH_TO_DIR_CONTAINING_LIB_AND_INCLUDE (see also ./configure --help if you do not understand what we are talking about)
```



---

archive/issue_events_081111.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T16:58:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81111"
}
```



---

archive/issue_events_081112.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T16:58:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81112"
}
```



---

archive/issue_comments_440157.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-02-20T16:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440157",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_440158.json:
```json
{
    "body": "Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?",
    "created_at": "2021-02-20T17:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440158",
    "user": "https://github.com/mkoeppe"
}
```

Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?



---

archive/issue_comments_440159.json:
```json
{
    "body": "Replying to [comment:22 mkoeppe]:\n> Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?\n\n\nThat would be an alternative. But because of the API change I believe it is not enough. Let me give it a try.",
    "created_at": "2021-02-20T17:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440159",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:22 mkoeppe]:
> Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?


That would be an alternative. But because of the API change I believe it is not enough. Let me give it a try.



---

archive/issue_comments_440160.json:
```json
{
    "body": "Replying to [comment:22 mkoeppe]:\n> Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?\n\n\nThen it will fail to build with real compilation errors, unless you also backport the flint 2.7 support patches for singular",
    "created_at": "2021-02-20T17:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440160",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:22 mkoeppe]:
> Can't we patch up the failing configure check in Singular to avoid the dependency on #25993?


Then it will fail to build with real compilation errors, unless you also backport the flint 2.7 support patches for singular



---

archive/issue_comments_440161.json:
```json
{
    "body": "perhaps just Singular commit 2e7e3dc89e04ca1ef4175816cd23db6780ad5a38?",
    "created_at": "2021-02-20T17:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440161",
    "user": "https://github.com/mkoeppe"
}
```

perhaps just Singular commit 2e7e3dc89e04ca1ef4175816cd23db6780ad5a38?



---

archive/issue_comments_440162.json:
```json
{
    "body": "Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?",
    "created_at": "2021-02-23T00:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440162",
    "user": "https://github.com/mkoeppe"
}
```

Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?



---

archive/issue_comments_440163.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?\n\n\nYes, https://github.com/archlinux/svntogit-community/blob/packages/e-antic/trunk/e-antic-flint-2.7.patch\n\nNeeds massive ifdef'ing if you still want to support flint <2.7",
    "created_at": "2021-02-23T07:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440163",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:26 mkoeppe]:
> Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?


Yes, https://github.com/archlinux/svntogit-community/blob/packages/e-antic/trunk/e-antic-flint-2.7.patch

Needs massive ifdef'ing if you still want to support flint <2.7



---

archive/issue_comments_440164.json:
```json
{
    "body": "Replying to [comment:27 arojas]:\n> Replying to [comment:26 mkoeppe]:\n> > Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?\n\n> \n> Yes, https://github.com/archlinux/svntogit-community/blob/packages/e-antic/trunk/e-antic-flint-2.7.patch\n> \n> Needs massive ifdef'ing if you still want to support flint <2.7\n\n\nThanks! I've prepared this in https://github.com/mkoeppe/e-antic/tree/flint-2.7, testing currently at https://github.com/mkoeppe/e-antic/actions/runs/593267164",
    "created_at": "2021-02-23T16:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440164",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:27 arojas]:
> Replying to [comment:26 mkoeppe]:
> > Does anyone already have e-antic 0.1.x patches to work with FLINT 2.7?

> 
> Yes, https://github.com/archlinux/svntogit-community/blob/packages/e-antic/trunk/e-antic-flint-2.7.patch
> 
> Needs massive ifdef'ing if you still want to support flint <2.7


Thanks! I've prepared this in https://github.com/mkoeppe/e-antic/tree/flint-2.7, testing currently at https://github.com/mkoeppe/e-antic/actions/runs/593267164



---

archive/issue_comments_440165.json:
```json
{
    "body": "Opened #31430 for e-antic patch (or ideally new 0.1.x release)",
    "created_at": "2021-02-23T18:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440165",
    "user": "https://github.com/mkoeppe"
}
```

Opened #31430 for e-antic patch (or ideally new 0.1.x release)



---

archive/issue_comments_440166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-19T01:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_440167.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-19T01:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_440168.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-19T01:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440168",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_440169.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-19T16:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440169",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_440170.json:
```json
{
    "body": "There are still problems with `e_antic` (0.1.9):\n\n`ubuntu-trusty-maximal` (https://github.com/mkoeppe/sage/runs/2145415921 - uses FLINT from SPKG): \n\n```\n  [e_antic-0.1.9]   checking for gmp.h... yes\n  [e_antic-0.1.9]   checking for __gmpz_add in -lgmp... yes\n  [e_antic-0.1.9]   checking for flint/flint.h... yes\n  [e_antic-0.1.9]   checking for flint/fmpz.h... no\n  [e_antic-0.1.9]   configure: error: flint header not found\n```\n\n`cygwin-standard` (https://github.com/mkoeppe/sage/runs/2145195263 - uses system FLINT 2.7)\n\n```\nlibtool: compile:  gcc -DHAVE_CONFIG_H -I. -fopenmp -O2 -g -march=native -c poly_extra/fmpz_nextprime.c -o poly_extra/fmpz_nextprime.o >/dev/null 2>&1\npoly_extra/fmpz_randprime.c:17:6: error: conflicting types for 'fmpz_randprime'\n   17 | void fmpz_randprime(fmpz_t f, flint_rand_t state, mp_bitcnt_t bits, int proved)\n      |      ^~~~~~~~~~~~~~\nIn file included from /usr/include/flint/fmpz_poly.h:33,\n                 from ./e-antic/poly_extra.h:17,\n                 from poly_extra/fmpz_randprime.c:13:\n/usr/include/flint/fmpz.h:188:16: note: previous declaration of 'fmpz_randprime' was here\n  188 | FLINT_DLL void fmpz_randprime(fmpz_t f, flint_rand_t state,\n      |                ^~~~~~~~~~~~~~\nmake[4]: *** [Makefile:2699: poly_extra/fmpz_randprime.lo] Error 1\n```",
    "created_at": "2021-03-19T16:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440170",
    "user": "https://github.com/mkoeppe"
}
```

There are still problems with `e_antic` (0.1.9):

`ubuntu-trusty-maximal` (https://github.com/mkoeppe/sage/runs/2145415921 - uses FLINT from SPKG): 

```
  [e_antic-0.1.9]   checking for gmp.h... yes
  [e_antic-0.1.9]   checking for __gmpz_add in -lgmp... yes
  [e_antic-0.1.9]   checking for flint/flint.h... yes
  [e_antic-0.1.9]   checking for flint/fmpz.h... no
  [e_antic-0.1.9]   configure: error: flint header not found
```

`cygwin-standard` (https://github.com/mkoeppe/sage/runs/2145195263 - uses system FLINT 2.7)

```
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -fopenmp -O2 -g -march=native -c poly_extra/fmpz_nextprime.c -o poly_extra/fmpz_nextprime.o >/dev/null 2>&1
poly_extra/fmpz_randprime.c:17:6: error: conflicting types for 'fmpz_randprime'
   17 | void fmpz_randprime(fmpz_t f, flint_rand_t state, mp_bitcnt_t bits, int proved)
      |      ^~~~~~~~~~~~~~
In file included from /usr/include/flint/fmpz_poly.h:33,
                 from ./e-antic/poly_extra.h:17,
                 from poly_extra/fmpz_randprime.c:13:
/usr/include/flint/fmpz.h:188:16: note: previous declaration of 'fmpz_randprime' was here
  188 | FLINT_DLL void fmpz_randprime(fmpz_t f, flint_rand_t state,
      |                ^~~~~~~~~~~~~~
make[4]: *** [Makefile:2699: poly_extra/fmpz_randprime.lo] Error 1
```



---

archive/issue_comments_440171.json:
```json
{
    "body": "OTOH, on `ubuntu-xenial-maximal` (https://github.com/mkoeppe/sage/runs/2145415962)and `ubuntu-bionic-maximal` (https://github.com/mkoeppe/sage/runs/2145416018), `e_antic`  installs OK.\nWe can just write off `ubuntu-trusty` - Normaliz does not compile with the ancient compiler there either.",
    "created_at": "2021-03-19T22:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440171",
    "user": "https://github.com/mkoeppe"
}
```

OTOH, on `ubuntu-xenial-maximal` (https://github.com/mkoeppe/sage/runs/2145415962)and `ubuntu-bionic-maximal` (https://github.com/mkoeppe/sage/runs/2145416018), `e_antic`  installs OK.
We can just write off `ubuntu-trusty` - Normaliz does not compile with the ancient compiler there either.



---

archive/issue_comments_440172.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-19T22:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440172",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440173.json:
```json
{
    "body": "A serious issue: On `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2145416039) \n\n```\n  [sagelib-9.3.beta9]   In file included from build/cythonized/sage/data_structures/bounded_integer_sequences.c:3535:\n  [sagelib-9.3.beta9]   sage/libs/flint/flint_wrap.h: At top level:\n  [sagelib-9.3.beta9]   sage/libs/flint/flint_wrap.h:39:10: fatal error: flint/fmpz_mod.h: No such file or directory\n  [sagelib-9.3.beta9]      39 | #include <flint/fmpz_mod.h>\n  [sagelib-9.3.beta9]         |          ^~~~~~~~~~~~~~~~~~\n  [sagelib-9.3.beta9]   compilation terminated.\n```\nThis is using system `flint` 2.5.2 (see https://repology.org/project/flint/versions)",
    "created_at": "2021-03-19T22:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440173",
    "user": "https://github.com/mkoeppe"
}
```

A serious issue: On `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2145416039) 

```
  [sagelib-9.3.beta9]   In file included from build/cythonized/sage/data_structures/bounded_integer_sequences.c:3535:
  [sagelib-9.3.beta9]   sage/libs/flint/flint_wrap.h: At top level:
  [sagelib-9.3.beta9]   sage/libs/flint/flint_wrap.h:39:10: fatal error: flint/fmpz_mod.h: No such file or directory
  [sagelib-9.3.beta9]      39 | #include <flint/fmpz_mod.h>
  [sagelib-9.3.beta9]         |          ^~~~~~~~~~~~~~~~~~
  [sagelib-9.3.beta9]   compilation terminated.
```
This is using system `flint` 2.5.2 (see https://repology.org/project/flint/versions)



---

archive/issue_comments_440174.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-19T22:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440174",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_440175.json:
```json
{
    "body": "(`fmpz_mod.h` was introduced in 2.6.0 according to https://github.com/wbhart/flint2/blob/trunk/NEWS)",
    "created_at": "2021-03-19T22:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440175",
    "user": "https://github.com/mkoeppe"
}
```

(`fmpz_mod.h` was introduced in 2.6.0 according to https://github.com/wbhart/flint2/blob/trunk/NEWS)



---

archive/issue_comments_440176.json:
```json
{
    "body": "I think dropping support for system FLINT 2.5.x is too disruptive for Sage 9.3, given that the new features are not used yet by anything. \n\nSo I propose to split the ticket into just the upgrade and put the Cython interface to the new FLINT functions on a follow-up ticket for Sage 9.4.",
    "created_at": "2021-03-19T23:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440176",
    "user": "https://github.com/mkoeppe"
}
```

I think dropping support for system FLINT 2.5.x is too disruptive for Sage 9.3, given that the new features are not used yet by anything. 

So I propose to split the ticket into just the upgrade and put the Cython interface to the new FLINT functions on a follow-up ticket for Sage 9.4.



---

archive/issue_comments_440177.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-19T23:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_440178.json:
```json
{
    "body": "Replying to [comment:41 mkoeppe]:\n> I propose to split the ticket into just the upgrade and put the Cython interface to the new FLINT functions on a follow-up ticket for Sage 9.4.\n\n\nThis is now #31525.",
    "created_at": "2021-03-19T23:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440178",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:41 mkoeppe]:
> I propose to split the ticket into just the upgrade and put the Cython interface to the new FLINT functions on a follow-up ticket for Sage 9.4.


This is now #31525.



---

archive/issue_comments_440179.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-19T23:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440179",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440180.json:
```json
{
    "body": "I think this is OK. The main issues were in other packages that have already been fixed. With system flint-2.7.1, I see only one doctest failure due to a timeout in pari that probably cannot be blamed on flint.\n\nI see \"unrelated\" failures in the CI runs as well. If you are convinced of flint's innocence, we can set this to positive review.",
    "created_at": "2021-03-24T21:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440180",
    "user": "https://github.com/orlitzky"
}
```

I think this is OK. The main issues were in other packages that have already been fixed. With system flint-2.7.1, I see only one doctest failure due to a timeout in pari that probably cannot be blamed on flint.

I see "unrelated" failures in the CI runs as well. If you are convinced of flint's innocence, we can set this to positive review.



---

archive/issue_comments_440181.json:
```json
{
    "body": "lgtm too",
    "created_at": "2021-03-24T21:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440181",
    "user": "https://github.com/dimpase"
}
```

lgtm too



---

archive/issue_comments_440182.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-24T21:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440182",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440183.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-03-24T22:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440183",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_440184.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440184",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_440185.json:
```json
{
    "body": "Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440185",
    "user": "https://github.com/mkoeppe"
}
```

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_440186.json:
```json
{
    "body": "After merging this ticket into #31548 (since I want to use new functionality from FLINT 2.7.1 there) I'm getting errors starting Sage.  I don't usually update spkgs outside of beta releases, so I could be doing something wrong (I'm running OS X 10.15.2).\n\n```\n$ git trac fetch 31069 && git merge\n$ make build\n...\nSage build/upgrade complete!\n$ sage\nImportError Python 3.9.1: /Users/roed/sage/sage-9.3.beta7/local/bin/python3\n...\nImportError: dlopen(/Users/roed/sage/sage-9.3.beta7/local/lib/python3.9/site-packages/sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so, 2): Library not loaded: /Users/roed/sage/sage-9.3.beta7/local/lib/libSingular-4.1.1.dylib\n  Referenced from: /Users/roed/sage/sage-9.3.beta7/local/lib/python3.9/site-packages/sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so\n  Reason: image not found\n```\nFull install.log available [here](https://math.mit.edu/~roed/31548_install.log).",
    "created_at": "2021-03-30T07:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440186",
    "user": "https://github.com/roed314"
}
```

After merging this ticket into #31548 (since I want to use new functionality from FLINT 2.7.1 there) I'm getting errors starting Sage.  I don't usually update spkgs outside of beta releases, so I could be doing something wrong (I'm running OS X 10.15.2).

```
$ git trac fetch 31069 && git merge
$ make build
...
Sage build/upgrade complete!
$ sage
ImportError Python 3.9.1: /Users/roed/sage/sage-9.3.beta7/local/bin/python3
...
ImportError: dlopen(/Users/roed/sage/sage-9.3.beta7/local/lib/python3.9/site-packages/sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so, 2): Library not loaded: /Users/roed/sage/sage-9.3.beta7/local/lib/libSingular-4.1.1.dylib
  Referenced from: /Users/roed/sage/sage-9.3.beta7/local/lib/python3.9/site-packages/sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so
  Reason: image not found
```
Full install.log available [here](https://math.mit.edu/~roed/31548_install.log).



---

archive/issue_comments_440187.json:
```json
{
    "body": "I believe you need singular 4.2.0p1 (9.3.beta8 if I am not mistaken) with that. Singular uses flint so does need rebuilding and 4.2.0 is the first one that is compatible with flint-2.7.1.",
    "created_at": "2021-03-30T07:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440187",
    "user": "https://github.com/kiwifb"
}
```

I believe you need singular 4.2.0p1 (9.3.beta8 if I am not mistaken) with that. Singular uses flint so does need rebuilding and 4.2.0 is the first one that is compatible with flint-2.7.1.



---

archive/issue_comments_440188.json:
```json
{
    "body": "Despite the folder name, this is based on sage-9.3.beta9, and when I did `make build` it appeared to be building `singular-4.2.0p1+2021-03-13+sage`.",
    "created_at": "2021-03-30T08:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440188",
    "user": "https://github.com/roed314"
}
```

Despite the folder name, this is based on sage-9.3.beta9, and when I did `make build` it appeared to be building `singular-4.2.0p1+2021-03-13+sage`.



---

archive/issue_comments_440189.json:
```json
{
    "body": "I feel like I'm missing something basic here: when I try running `sage -f flint` it gives me lots of errors saying that `flint-2.7.1` isn't found:\n\n```\n[flint-2.7.1] Attempting to download package flint-2.7.1.tar.gz from mirrors\n[flint-2.7.1] http://mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz\n[flint-2.7.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[flint-2.7.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz'\n[flint-2.7.1] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/flint/flint-2.7.1.tar.gz\n...\n[flint-2.7.1] FileNotMirroredError: tarball does not exist on mirror network\n[flint-2.7.1] ************************************************************************\n[flint-2.7.1] ************************************************************************\n[flint-2.7.1] Error downloading flint-2.7.1.tar.gz\n\n```\nDo I need to download a tarball manually from somewhere?",
    "created_at": "2021-03-30T08:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440189",
    "user": "https://github.com/roed314"
}
```

I feel like I'm missing something basic here: when I try running `sage -f flint` it gives me lots of errors saying that `flint-2.7.1` isn't found:

```
[flint-2.7.1] Attempting to download package flint-2.7.1.tar.gz from mirrors
[flint-2.7.1] http://mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz
[flint-2.7.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[flint-2.7.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz'
[flint-2.7.1] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/flint/flint-2.7.1.tar.gz
...
[flint-2.7.1] FileNotMirroredError: tarball does not exist on mirror network
[flint-2.7.1] ************************************************************************
[flint-2.7.1] ************************************************************************
[flint-2.7.1] Error downloading flint-2.7.1.tar.gz

```
Do I need to download a tarball manually from somewhere?



---

archive/issue_comments_440190.json:
```json
{
    "body": "Replying to [comment:51 roed]:\n> Despite the folder name, this is based on sage-9.3.beta9, and when I did `make build` it appeared to be building `singular-4.2.0p1+2021-03-13+sage`.\n\n\nOK, then it appears that somehow `sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so` has not be rebuilt because it is still looking for libSingular-4.1.1 when it should look for libSingular-4.2.0.",
    "created_at": "2021-03-30T08:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440190",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:51 roed]:
> Despite the folder name, this is based on sage-9.3.beta9, and when I did `make build` it appeared to be building `singular-4.2.0p1+2021-03-13+sage`.


OK, then it appears that somehow `sage/matrix/matrix_mpolynomial_dense.cpython-39-darwin.so` has not be rebuilt because it is still looking for libSingular-4.1.1 when it should look for libSingular-4.2.0.



---

archive/issue_comments_440191.json:
```json
{
    "body": "Replying to [comment:52 roed]:\n> I feel like I'm missing something basic here: when I try running `sage -f flint` it gives me lots of errors saying that `flint-2.7.1` isn't found:\n> \n> ```\n> [flint-2.7.1] Attempting to download package flint-2.7.1.tar.gz from mirrors\n> [flint-2.7.1] http://mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz\n> [flint-2.7.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n> [flint-2.7.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz'\n> [flint-2.7.1] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/flint/flint-2.7.1.tar.gz\n> ...\n> [flint-2.7.1] FileNotMirroredError: tarball does not exist on mirror network\n> [flint-2.7.1] ************************************************************************\n> [flint-2.7.1] ************************************************************************\n> [flint-2.7.1] Error downloading flint-2.7.1.tar.gz\n> \n> ```\n> Do I need to download a tarball manually from somewhere?\n\n\nThis ticket is not merged, tarball are not usually mirrored before Volker attempt to merge the tickets. You'll have to fetch the source a different way. Matthias created a handy way of using a string called `upstream_url` in the file checksum.ini to do the fetching from upstream but I cannot remember how it works.",
    "created_at": "2021-03-30T09:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440191",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:52 roed]:
> I feel like I'm missing something basic here: when I try running `sage -f flint` it gives me lots of errors saying that `flint-2.7.1` isn't found:
> 
> ```
> [flint-2.7.1] Attempting to download package flint-2.7.1.tar.gz from mirrors
> [flint-2.7.1] http://mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz
> [flint-2.7.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
> [flint-2.7.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirrors.mit.edu/sage/spkg/upstream/flint/flint-2.7.1.tar.gz'
> [flint-2.7.1] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/flint/flint-2.7.1.tar.gz
> ...
> [flint-2.7.1] FileNotMirroredError: tarball does not exist on mirror network
> [flint-2.7.1] ************************************************************************
> [flint-2.7.1] ************************************************************************
> [flint-2.7.1] Error downloading flint-2.7.1.tar.gz
> 
> ```
> Do I need to download a tarball manually from somewhere?


This ticket is not merged, tarball are not usually mirrored before Volker attempt to merge the tickets. You'll have to fetch the source a different way. Matthias created a handy way of using a string called `upstream_url` in the file checksum.ini to do the fetching from upstream but I cannot remember how it works.



---

archive/issue_comments_440192.json:
```json
{
    "body": "Do this:\n\n```\n$ ./bootstrap -q\n$ ./configure --enable-download-from-upstream-url -q\n$ make -s V=0\n```",
    "created_at": "2021-03-30T09:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440192",
    "user": "https://github.com/slel"
}
```

Do this:

```
$ ./bootstrap -q
$ ./configure --enable-download-from-upstream-url -q
$ make -s V=0
```



---

archive/issue_comments_440193.json:
```json
{
    "body": "Thanks!  That seems to have worked.",
    "created_at": "2021-03-30T17:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440193",
    "user": "https://github.com/roed314"
}
```

Thanks!  That seems to have worked.



---

archive/issue_comments_440194.json:
```json
{
    "body": "For anyone else looking at this, I also had to do `sage -f flint` after the commands Samuel gave.",
    "created_at": "2021-03-31T15:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440194",
    "user": "https://github.com/roed314"
}
```

For anyone else looking at this, I also had to do `sage -f flint` after the commands Samuel gave.



---

archive/issue_comments_440195.json:
```json
{
    "body": "This should do everything at once:\n\n```\n$ ./bootstrap -q\n$ ./configure --enable-download-from-upstream-url -q\n$ make -s V=0 flint-clean\n$ make -s V=0\n```",
    "created_at": "2021-03-31T18:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440195",
    "user": "https://github.com/slel"
}
```

This should do everything at once:

```
$ ./bootstrap -q
$ ./configure --enable-download-from-upstream-url -q
$ make -s V=0 flint-clean
$ make -s V=0
```



---

archive/issue_events_081113.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T19:43:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81113"
}
```



---

archive/issue_events_081114.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T19:43:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81114"
}
```



---

archive/issue_comments_440196.json:
```json
{
    "body": "Looks unrealistic to squeeze this into 9.3",
    "created_at": "2021-04-02T19:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440196",
    "user": "https://github.com/mkoeppe"
}
```

Looks unrealistic to squeeze this into 9.3



---

archive/issue_comments_440197.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2021-04-02T19:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440197",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_440198.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30832#issuecomment-440198",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081115.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30832",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30832#event-81115"
}
```
