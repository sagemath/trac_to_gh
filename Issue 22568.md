# Issue 22568: cython(): do not include .pxi files

Issue created by migration from https://trac.sagemath.org/ticket/22805

Original creator: jdemeyer

Original creation time: 2017-04-13 14:41:01

The function `cython()` currently adds a header to every `.pyx` file:

```
include "cdefs.pxi"
include "cysignals/signals.pxi"  # ctrl-c interrupt block support
include "stdsage.pxi"
```


If we want `cython()` to become less Sage-specific (see for example #22461), we should stop doing this. The user can still manually add the includes.

Note that I don't see an easy way to make this backwards-compatible. The only thing we can do is to give a good error message.


---

Comment by jdemeyer created at 2017-04-13 15:25:38

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-04-13 15:25:38

New commits:


---

Comment by jdemeyer created at 2017-04-13 15:29:34

Changing priority from major to blocker.


---

Comment by tscrim created at 2017-04-15 04:03:20

There isn't a way to add the corresponding `cimport` statements to the code before sending it off to Cython? I'm not against this change, but I don't see why we can't have the same functionality available from Sage (mostly out of ignorance).


---

Comment by jdemeyer created at 2017-04-15 09:07:11

Replying to [comment:5 tscrim]:
> There isn't a way to add the corresponding `cimport` statements to the code before sending it off to Cython?

Yes, of course there is. We could just add `cimport` statements instead of `include` statements.

But my point is that it shouldn't be the business of Sage to add that. This is especially true in the light of #22461. I think that the user can easily add those `cimports` himself.


---

Comment by tscrim created at 2017-04-15 16:15:17

Why shouldn't we have Sage do a little bit extra on top of standard Cython to make things easier for our users? Even with this change, I don't think we could completely separate `cython()` from standard Cython because we give the users access to our standard Sage classes. I guess I don't see the point of making things harder for (more basic) users.


---

Comment by jdemeyer created at 2017-04-15 18:04:17

Replying to [comment:7 tscrim]:
> we give the users access to our standard Sage classes.

First of all, the relevant `.pxi` files have almost nothing to do with Sage: they add support for `cysignals` (i.e. the `sig_check`/`sig_on` stuff and memory functions like `sig_malloc`), some arbitrary set of C functions like `memset` and `fopen` and all GMP functions like `mpz_init`. So there is really nothing Sage-specific about this.

Second, even if you argue that `cython()` should add those things, it should still be _possible_ to just use plain Cython without any extra cimports. This could be implemented with an additional option to `cython()`. I already thought about this when starting this ticket, but then thought that Sage changing Cython files is just a misfeature.


---

Comment by tscrim created at 2017-04-16 04:52:56

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-16 04:52:56

Okay, then I'm willing to set this to a positive review. I doubt it was a much used (mis)feature, but we will see in the beta stages I think.


---

Comment by vbraun created at 2017-04-17 07:36:09

See the patchbot errors, breaks spyx compilation


---

Comment by vbraun created at 2017-04-17 07:36:09

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-04-18 07:30:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-04-18 11:29:57

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-04-18 13:48:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-23 12:58:27

Resolution: fixed
