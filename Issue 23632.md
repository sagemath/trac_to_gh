# Issue 23632: libtheora does not build on Ubuntu 16.04

Issue created by migration from https://trac.sagemath.org/ticket/23869

Original creator: mderickx

Original creation time: 2017-09-15 13:16:55

First I got an error during 

`make Theora.pdf` which is defined in `$THEORA_SOURCE/doc/spec/Makefile`. 
Changing the two occurences of `\begin{figure}[Htbp]` to `\begin{figure}[htbp]` in `doc/spec/spec.tex` solves this issue but now it is stuc at a more serious problem:


```
png2theora.c:465:20: warning: implicit declaration of function 'png_sizeof' [-Wimplicit-function-declaration]
     3*height*width*png_sizeof(*row_data));
                    ^
png2theora.c:465:31: warning: 'row_data' may be used uninitialized in this function [-Wmaybe-uninitialized]
     3*height*width*png_sizeof(*row_data));
                               ^
png2theora.c:393:13: note: 'row_data' was declared here
   png_bytep row_data;
             ^
png2theora.c:467:12: warning: 'row_pointers' may be used uninitialized in this function [-Wmaybe-uninitialized]
     height*png_sizeof(*row_pointers));
            ^
png2theora.c:394:14: note: 'row_pointers' was declared here
   png_bytep *row_pointers;
              ^
/bin/bash ../libtool --mode=link gcc -I/users/derickx/sage_test/local/include   -Wall -Wno-parentheses -O3 -fforce-addr -fomit-frame-pointer -finline-functions -funroll-loops   -L/users/derickx/sage_test/local/lib -Wl,-rpath,/users/derickx/sage_test/local/lib  -o png2theora  png2theora-png2theora.o  ../lib/libtheoraenc.la ../lib/libtheoradec.la -L/users/derickx/sage_test/local/lib -logg   -L/users/derickx/sage_test/local/lib -lpng16   -lm 
libtool: link: gcc -I/users/derickx/sage_test/local/include -Wall -Wno-parentheses -O3 -fforce-addr -fomit-frame-pointer -finline-functions -funroll-loops -Wl,-rpath -Wl,/users/derickx/sage_test/local/lib -o .libs/png2theora png2theora-png2theora.o  -L/users/derickx/sage_test/local/lib ../lib/.libs/libtheoraenc.so ../lib/.libs/libtheoradec.so -logg -lpng16 -lm -Wl,-rpath -Wl,/users/derickx/sage_test/local/lib
png2theora-png2theora.o: In function `png_read':
png2theora.c:(.text+0x20d): undefined reference to `png_sizeof'
png2theora.c:(.text+0x230): undefined reference to `png_sizeof'
collect2: error: ld returned 1 exit status
Makefile:290: recipe for target 'png2theora' failed
make[2]: *** [png2theora] Error 1
make[2]: Leaving directory '/users/derickx/sage_test/local/var/tmp/sage/build/libtheora-1.1.1/src/examples'
Makefile:291: recipe for target 'all-recursive' failed
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory '/users/derickx/sage_test/local/var/tmp/sage/build/libtheora-1.1.1/src'
Makefile:205: recipe for target 'all' failed
make: *** [all] Error 2
Error building libtheora
```


this seems to be because `png_sizeof` was removed from `lib_png` version 1.6.0, see [1] and we ship lib_png 1.6.29.

[1] https://github.com/glennrp/libpng/blob/libpng16/CHANGES#L4206



---

Comment by mderickx created at 2017-09-15 13:23:21

Resolution: duplicate


---

Comment by mderickx created at 2017-09-15 13:23:21

See #23732
