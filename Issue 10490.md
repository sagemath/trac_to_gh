# Issue 10490: Echelon form over QQ is mutable

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2011-01-02 03:18:10

Assignee: jason, was

Which is not the norm for matrices over other rings.


```
sage: A=matrix(QQ,2,range(4))
sage: B=matrix(ZZ,2,range(4))
sage: C=A.echelon_form()
sage: D=B.echelon_form()
sage: C.is_mutable()
True
sage: D.is_mutable()
False
```


See http://groups.google.com/group/sage-devel/browse_thread/thread/ef90d24da0ee704c


---

Attachment


---

Comment by rbeezer created at 2011-01-02 04:07:46

Changing status from new to needs_review.


---

Comment by rbeezer created at 2011-01-02 04:07:46

Patch adds one line of code to set the result to be immutable.  A doctest is added to check this behavior, then one other failing doctest in the matrix constructor code is fixed up to allow some subdivisions (which is what brought me here in the first place).


---

Comment by rbeezer created at 2011-01-02 04:11:31

Forgot to mention - I ran this through all tests, finding only the one `random_matrix` example that needed fixing.


---

Attachment


---

Comment by tomc created at 2011-02-02 22:07:38

Your random_matrix example fix isn't right: you need to make a copy of the matrix, rather than setting it immutable (it is already immutable!).  The reviewer patch fixes this, makes some grammatical changes to the documentation of echelon_form(), and fixes a pre-existing typo in the documentation of echelon_form().


---

Attachment

Hi Tom,

Thanks for the catch on making a copy of the matrix.  Not sure what I was thinking just then.  Your changes look real good to me.

I think your patch _includes_ my changes and yours mixed together.  And some changes get applied in the echelonize routine (which really had me scratching my head).  I've tried to split out your changes and have placed a new patch that I belive has just your changes.  Except there were some double-colons needed, including one I'd forgotten.  You should give the revised patch a real close look.

Can you test the whole package?  If so, I think you'd be clear to finalize the review if everything looks OK.  It'll need my original patch and then the rebased reviewer patch.  I have tested the pair against the two affected files and viewed the HTML documentation, and that much looks good.

Thanks for taking a look at this one and making a fix.

Rob


---

Comment by tomc created at 2011-02-03 22:49:48

Changing status from needs_review to positive_review.


---

Comment by tomc created at 2011-02-03 22:49:48

This looks good now.  Running:

```
sage -testall -long
```

gives that all doctests pass except two unrelated tests (in sage/plot/plot3d/tachyon.py and sage/plot/plot3d/base.pyx) that also fail in an unpatched copy of Sage (version 4.6.1, built from source on 64-bit Linux).


---

Comment by jdemeyer created at 2011-02-04 15:04:31

This should be rebased to sage-4.6.2.alpha3 + #10028 (or you can wait until sage-4.6.2.alpha4 is released and then rebase to that).


---

Comment by jdemeyer created at 2011-02-04 15:04:31

Changing status from positive_review to needs_work.


---

Attachment

Applied #10028 to 4.6.2.alpha3, only got one failure when applying the first of the two patches here.  Rebased that patch only, though the failure seems trivial.  All tests pass in sage/matrix2.

If this does not work, we'll go for alpha4.

Apply "v2" of original patch, then "reviewer-rebased," in that order.


---

Comment by rbeezer created at 2011-02-04 15:33:51

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2011-02-07 08:15:16

Resolution: fixed
