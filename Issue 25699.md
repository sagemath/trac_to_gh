# Issue 25699: Improvements to integrated curves and geodesics on manifolds

Issue created by migration from https://trac.sagemath.org/ticket/25936

Original creator: @FlorentinJ

Original creation time: 2018-07-26 13:13:16

CC:  egourgoulhon karimvanaelst

Keywords: manifold, geodesic, integrated curve, integration, chart

This ticket implements some improvements regarding integrated curves on manifolds, first appearing in #22951.

It adds `scipy.integrate.ode` as an integration solver. The main advantage is that it supports basic event handling, making it possible to detect frontiers of charts. This allows for integration on multiple charts, as shown in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example.ipynb) notebook, which can be particularly useful to avoid singularities, or in manifold which cannot be represented by a single chart, like in [this one](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example%202.ipynb) (not commented).


A side effect of this new method is that the time needed for the integration can be reduced (a lot!) by using objects created with `fast_callable` instead of symbolic expressions. This is used in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/kerr_geodesic_minimal.ipynb) notebook to compute the shape of a geodesic in a Kerr spacetime. Speed test shows a x700 speedup compared to the default integration method "rk4_maxima".





---

Comment by git created at 2018-07-26 13:16:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-31 19:39:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-08-06 10:02:53

Changing status from new to needs_review.


---

Comment by @FlorentinJ created at 2018-08-07 12:58:10

Changing status from needs_review to needs_work.


---

Comment by @FlorentinJ created at 2018-08-07 12:58:10

Forgot some doctests after the last commit + debug print not removed


---

Comment by git created at 2018-08-08 11:15:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-08-08 11:16:32

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-09-29 00:36:16

Some little things:

- You have `$` in docstrings which should be ```.
- Sometimes it is better to break PEP8 80 char/line, e.g.:
  {{{
-        for ichart in set(initial_pt._coordinates.keys()).\
-            intersection(charts):
+        for ichart in set(initial_pt._coordinates.keys()).intersection(charts):
  }}}
- This is confusing to read and needs more whitespace padding on the subsequent lines:
  {{{
                res += self.plot_integrated(chart=chart,
             ambient_coords=ambient_coords, mapping=mapping, prange=prange,
             interpolation_key=interpolation_key+"_chart_"+str(i),
             include_end_point=include_end_point,
             end_point_offset=end_point_offset, verbose=verbose, color=color[i],
             style=style, label_axes=False, display_tangent=display_tangent,
             color_tangent=color_tangent, across_charts=False,
             plot_points=nb_pts, **kwds)
  }}}
- Please remove a lot (all) of these blanklines:
  {{{#!diff
+            sphinx_plot(fig)
+
+
+
+
+        """
  }}}
- PEP8:
  {{{#!diff
     def solve_across_charts(self, charts=None, step=None, solution_key=None,
-              parameters_values=None, verbose=False):
+                            parameters_values=None, verbose=False):
  }}}
- `euclidean` -> `Euclidean`.
- `Let's also Add restrictions` -> `Let us also add restrictions`.
- You're not always consistent with your periods/full-stops at the end of verbose messages.

Otherwise I think I am good with the current branch as it seems to work as claimed. Eric, any other comments?


---

Comment by git created at 2018-10-08 00:36:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-08 00:37:28

This takes care of my comment:7. Eric, do you have any comments? Otherwise I think this is good to go.


---

Comment by git created at 2018-10-23 16:19:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-10-23 16:24:30

Replying to [comment:9 tscrim]:
> This takes care of my comment:7. Eric, do you have any comments? Otherwise I think this is good to go.

Sorry for the delay in replying... I've pushed a new commit (comment:10), which corrects a doctest error as well as a pyflakes one. It also improves slightly the documentation. This is fully OK for me. Karim, do you have any further comment?


---

Comment by tscrim created at 2018-10-23 16:27:27

Good for me up to any comments from Karim.


---

Comment by karimvanaelst created at 2018-10-25 08:16:22

Replying to [comment:13 tscrim]:
> Good for me up to any comments from Karim.

I actually have no comment to make, thank you for asking and for this great improvement!


---

Comment by tscrim created at 2018-10-26 01:19:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-28 20:26:56

Resolution: fixed
