# Issue 28320: julia_plot sometimes does not draw the entire julia set

Issue created by migration from https://trac.sagemath.org/ticket/28557

Original creator: @DaveWitteMorris

Original creation time: 2019-10-05 06:00:30

Keywords: complexdynamics

The algorithm for julia_plot (and fast_julia_plot) erroneously assumes that if |z| > 2, then z is not in the Julia set of the function f(z) = z<sup>2</sup> + c, because the orbit of z is unbounded under iteration of f(z). (To see that this is not always true, let c = -6. Then z = 3 is a fixed point, so its orbit is obviously not unbounded.) Looking on the bright side, the algorithm does give correct results whenever |c| <= 2 (which includes all points in the Mandelbrot set), so most users will never see a problem.

To fix this, the bound 2 should be replaced with an appropriate bound R that depends on c. By the quadratic formula, the largest (positive) fixed point of the function f*(x) = x<sup>2</sup> - |c| is R = (1 + sqrt(1 + 4|c|))/2. It is then easy to see that f*(x) > x for x > R. Then, by the triangle inequality, we have |z<sup>2</sup> + c| > |z| whenever |z| > R. So the orbit of z tends to infinity whenever |z| is greater than this value R.

I have a patch that replaces 2 with this value of R, and I will attempt to upload it to the ticket as a PR, but I have not done this before, and I apologize if I already goofed up something else about this ticket.


---

Comment by @DaveWitteMorris created at 2019-10-05 06:04:24

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2019-12-01 15:10:32

Ok, thank you. This change looks correct to me. Just in the documentation of `julia_plot`, I think you accidentally defined `R_c` as the square of the intended value. I changed it to `\bigl(1 + \sqrt{1 + 4|c|}\bigr)/2` as you explained in the ticket description. Is this correct?

I also rebased and squashed your commits and removed some trailing whitespace. If you agree with my changes, please set this ticket to positive review.
----
New commits:


---

Comment by @DaveWitteMorris created at 2019-12-01 23:16:06

Changing status from needs_review to positive_review.


---

Comment by @DaveWitteMorris created at 2019-12-01 23:16:06

You are right. Thanks for the review, for correcting the docstring, and for fixing my newbie mistakes.


---

Comment by @mwageringel created at 2019-12-02 07:36:16

There is a merge conflict with the latest beta.


---

Comment by @mwageringel created at 2019-12-02 07:36:16

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-12-14 12:44:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2019-12-14 12:47:36

Changing status from needs_work to needs_review.


---

Comment by @mwageringel created at 2019-12-14 12:47:36

Since #23740, Sage can now plot julia sets of more general polynomials. I merged in the latest beta, but this branch will only affect the case of polynomials of the form `f(z) = z^2 + c`. As this is the most common case, this seems acceptable to me.

`@`gh-DaveWitteMorris: Please check whether this is ok, or change the implementation if possible.


---

Comment by @DaveWitteMorris created at 2019-12-17 06:44:56

Changing status from needs_review to needs_work.


---

Comment by @DaveWitteMorris created at 2019-12-17 06:44:56

Thanks for doing the merge. I'm sorry not to have done anything, but I moved to a different computer last month and have not been able to get git and sagemath working properly yet. Now that the semester is coming to an end, I should have more time and expect to be able to get my installation straightened out enough to work on this ticket later in the week.


---

Comment by @DaveWitteMorris created at 2019-12-30 04:22:40

Changing status from needs_work to needs_review.


---

Comment by @DaveWitteMorris created at 2019-12-30 04:22:40

I fixed two minor pyflakes complaints in mandel_julia.py. (`DynamicalSystem` was imported twice, and `QQ` was imported but never used.) I am happy with the state of this patch, and I recommend a positive review if the patchbots are green.

However, I also think that `julia_plot` needs further work, as explained in the new metaticket #28923 (which tracks this ticket).

`@`gh-mwageringel : Thanks again for your help with this ticket.


---

Comment by git created at 2019-12-30 04:29:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2019-12-30 17:14:44

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2019-12-30 17:14:44

Thanks for the updates.


---

Comment by @mwageringel created at 2020-01-03 14:32:39

Replying to [comment:13 gh-DaveWitteMorris]:
> This branch was merged into #28772 (to deal with a merge conflict). My intention was for this ticket to be merged first, and then #28772. On the other hand, if #28772 is merged first, then I think this ticket would be redundant, so it could be closed without being merged.

No problem, as this ticket is now a dependency of #28772, so this one gets merged first. It is still useful to merge this ticket individually, as it makes for a cleaner history which makes it easier to figure out where a change is coming from, later on. Try for example `git log --first-parent --oneline develop`.


---

Comment by vbraun created at 2020-01-05 15:47:14

Resolution: fixed
