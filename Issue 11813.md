# Issue 11813: lcalc is too verbose (mysterious "Warning: new stack size")

Issue created by migration from https://trac.sagemath.org/ticket/11985

Original creator: was

Original creation time: 2011-11-03 00:28:32

Assignee: cremona

I tried one simple example "by hand" that actually *uses* lcalc, and was not pleased by what happened:

```
sage: E = EllipticCurve('37a')
sage: L = E.lseries()
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
```

Basically, every time you use lcalc to do anything with elliptic curve L-series, you get some mysterious warning (of course, really output from PARI).   However, the problem has been in released Sage for a long time.    It was in sage-4.7.  


---

Comment by jdemeyer created at 2011-11-03 08:17:15

Changing assignee from cremona to jdemeyer.


---

Comment by jdemeyer created at 2011-11-03 08:17:15

Changing component from elliptic curves to interfaces.


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted


---

Comment by jdemeyer created at 2014-01-06 13:30:52

Changing status from new to needs_review.


---

Comment by git created at 2014-01-06 14:05:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-01-06 14:12:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2014-01-06 15:34:22

Changing keywords from "" to "lcalc".


---

Comment by tscrim created at 2014-01-09 02:38:04

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-01-09 02:38:04

Looks good to me.


---

Comment by vbraun created at 2014-01-11 14:56:07

Resolution: fixed


---

Comment by vbraun created at 2014-01-15 20:15:58

Changing status from closed to new.


---

Comment by vbraun created at 2014-01-15 20:15:58

Resolution changed from fixed to 


---

Comment by vbraun created at 2014-01-15 20:15:58

I got this on mod during a doctests (somewhat random failure):

```
sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 243, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    E.lseries().zeros(2)
Expected:
    [0.000000000, 5.00317001]
Got:
      ***   Warning: not enough memory, new stack 1000000000.
    [0.000000000, 5.00317001]
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 246, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    a = E.lseries().zeros(20)             # long time
Expected nothing
Got:
      ***   Warning: not enough memory, new stack 1000000000.
**********************************************************************
1 item had failures:
```

This is also with #13163 but I'm pretty sure this ticket is the culprit...


---

Comment by jdemeyer created at 2014-01-15 22:16:16

Please confirm that the system you were building this on was not low on memory. From reading the PARI sources, it looks like that message can only occur after a failed `malloc()`. You should make sure doctests have 2.5GB of memory available.


---

Comment by jdemeyer created at 2014-01-15 22:16:16

Changing status from new to needs_info.


---

Comment by jdemeyer created at 2014-01-15 22:16:25

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2014-01-16 04:36:06

As I said its on mod, so a pretty beefy machine with 128GB ram. Of course I don't know exactly what happened, but I think its pretty unlikely that some runaway process ate everything except 2% of the available ram such that only this doctest failed. Twice in a row.


---

Comment by jdemeyer created at 2014-01-16 07:25:23

Don't forget that `mod` also runs the Sage Notebook server, which might make your scenario more likely. Were you testing many jobs in parallel? And were those the only doctest failures that you got?


---

Comment by vbraun created at 2014-01-16 16:41:37

That was the only failure in the whole build process and, at least when I checked later, there were tons (~50GB) of free memory. The buildbot always tests the same number of processes, no more, no less.


---

Comment by vbraun created at 2014-02-03 16:07:49

Resolution: fixed
