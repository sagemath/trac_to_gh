# Issue 11813: lcalc is too verbose (mysterious "Warning: new stack size")

archive/issues_011813.json:
```json
{
    "body": "Assignee: cremona\n\nI tried one simple example \"by hand\" that actually *uses* lcalc, and was not pleased by what happened:\n\n```\nsage: E = EllipticCurve('37a')\nsage: L = E.lseries()\nsage: L.zeros(10)\n  ***   Warning: new stack size = 1030944 (0.983 Mbytes).\n[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]\nsage: L.zeros(10)\n  ***   Warning: new stack size = 1030944 (0.983 Mbytes).\n[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]\n```\n\nBasically, every time you use lcalc to do anything with elliptic curve L-series, you get some mysterious warning (of course, really output from PARI).   However, the problem has been in released Sage for a long time.    It was in sage-4.7.  \n\nIssue created by migration from https://trac.sagemath.org/ticket/11985\n\n",
    "created_at": "2011-11-03T00:28:32Z",
    "labels": [
        "elliptic curves",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "lcalc is too verbose (mysterious \"Warning: new stack size\")",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11813",
    "user": "was"
}
```
Assignee: cremona

I tried one simple example "by hand" that actually *uses* lcalc, and was not pleased by what happened:

```
sage: E = EllipticCurve('37a')
sage: L = E.lseries()
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
```

Basically, every time you use lcalc to do anything with elliptic curve L-series, you get some mysterious warning (of course, really output from PARI).   However, the problem has been in released Sage for a long time.    It was in sage-4.7.  

Issue created by migration from https://trac.sagemath.org/ticket/11985





---

archive/issue_comments_135068.json:
```json
{
    "body": "Changing assignee from cremona to jdemeyer.",
    "created_at": "2011-11-03T08:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135068",
    "user": "jdemeyer"
}
```

Changing assignee from cremona to jdemeyer.



---

archive/issue_comments_135069.json:
```json
{
    "body": "Changing component from elliptic curves to interfaces.",
    "created_at": "2011-11-03T08:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135069",
    "user": "jdemeyer"
}
```

Changing component from elliptic curves to interfaces.



---

archive/issue_comments_135070.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135070",
    "user": "jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_135071.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-06T13:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135071",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-06T14:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135072",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_135073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-06T14:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_135074.json:
```json
{
    "body": "Changing keywords from \"\" to \"lcalc\".",
    "created_at": "2014-01-06T15:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135074",
    "user": "chapoton"
}
```

Changing keywords from "" to "lcalc".



---

archive/issue_comments_135075.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-09T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135075",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135076.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2014-01-09T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135076",
    "user": "tscrim"
}
```

Looks good to me.



---

archive/issue_comments_135077.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-11T14:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135077",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_135078.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135078",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_135079.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135079",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_135080.json:
```json
{
    "body": "I got this on mod during a doctests (somewhat random failure):\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/lseries_ell.py\", line 243, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros\nFailed example:\n    E.lseries().zeros(2)\nExpected:\n    [0.000000000, 5.00317001]\nGot:\n      ***   Warning: not enough memory, new stack 1000000000.\n    [0.000000000, 5.00317001]\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/lseries_ell.py\", line 246, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros\nFailed example:\n    a = E.lseries().zeros(20)             # long time\nExpected nothing\nGot:\n      ***   Warning: not enough memory, new stack 1000000000.\n**********************************************************************\n1 item had failures:\n```\n\nThis is also with #13163 but I'm pretty sure this ticket is the culprit...",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135080",
    "user": "vbraun"
}
```

I got this on mod during a doctests (somewhat random failure):

```
sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 243, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    E.lseries().zeros(2)
Expected:
    [0.000000000, 5.00317001]
Got:
      ***   Warning: not enough memory, new stack 1000000000.
    [0.000000000, 5.00317001]
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 246, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    a = E.lseries().zeros(20)             # long time
Expected nothing
Got:
      ***   Warning: not enough memory, new stack 1000000000.
**********************************************************************
1 item had failures:
```

This is also with #13163 but I'm pretty sure this ticket is the culprit...



---

archive/issue_comments_135081.json:
```json
{
    "body": "Please confirm that the system you were building this on was not low on memory. From reading the PARI sources, it looks like that message can only occur after a failed `malloc()`. You should make sure doctests have 2.5GB of memory available.",
    "created_at": "2014-01-15T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135081",
    "user": "jdemeyer"
}
```

Please confirm that the system you were building this on was not low on memory. From reading the PARI sources, it looks like that message can only occur after a failed `malloc()`. You should make sure doctests have 2.5GB of memory available.



---

archive/issue_comments_135082.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-01-15T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135082",
    "user": "jdemeyer"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_135083.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-01-15T22:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135083",
    "user": "jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_135084.json:
```json
{
    "body": "As I said its on mod, so a pretty beefy machine with 128GB ram. Of course I don't know exactly what happened, but I think its pretty unlikely that some runaway process ate everything except 2% of the available ram such that only this doctest failed. Twice in a row.",
    "created_at": "2014-01-16T04:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135084",
    "user": "vbraun"
}
```

As I said its on mod, so a pretty beefy machine with 128GB ram. Of course I don't know exactly what happened, but I think its pretty unlikely that some runaway process ate everything except 2% of the available ram such that only this doctest failed. Twice in a row.



---

archive/issue_comments_135085.json:
```json
{
    "body": "Don't forget that `mod` also runs the Sage Notebook server, which might make your scenario more likely. Were you testing many jobs in parallel? And were those the only doctest failures that you got?",
    "created_at": "2014-01-16T07:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135085",
    "user": "jdemeyer"
}
```

Don't forget that `mod` also runs the Sage Notebook server, which might make your scenario more likely. Were you testing many jobs in parallel? And were those the only doctest failures that you got?



---

archive/issue_comments_135086.json:
```json
{
    "body": "That was the only failure in the whole build process and, at least when I checked later, there were tons (~50GB) of free memory. The buildbot always tests the same number of processes, no more, no less.",
    "created_at": "2014-01-16T16:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135086",
    "user": "vbraun"
}
```

That was the only failure in the whole build process and, at least when I checked later, there were tons (~50GB) of free memory. The buildbot always tests the same number of processes, no more, no less.



---

archive/issue_comments_135087.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-03T16:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11813#issuecomment-135087",
    "user": "vbraun"
}
```

Resolution: fixed
