# Issue 28034: Implement LexM traversal

Issue created by migration from https://trac.sagemath.org/ticket/28271

Original creator: @giorgosgiapis

Original creation time: 2019-07-27 13:39:14

Keywords: gsoc19

The algorithm is described here: http://dept-info.labri.fr/~gavoille/article/DG07. Using this traversal we can approximate the tree-length of an arbitrary graph. The complexity of this algorithm will be _**O(nm)**_ where _**n**_ is the number of vertices and _**m**_ the number of edges if implemented properly in Cython.


---

Comment by @giorgosgiapis created at 2019-07-28 13:44:13

Changing status from new to needs_review.


---

Comment by @giorgosgiapis created at 2019-07-28 13:44:52

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-07-28 13:46:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-28 23:10:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-01 15:55:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-01 16:02:30

This implementation of lexM is far from OK but some comments and thoughts on the algorithm and the way it is implemented would be very helpful.


---

Comment by @giorgosgiapis created at 2019-08-01 16:26:04

I think that this method should only work for undirected graphs since triangulation and tree decomposition are only meaningful in undirected graphs. Also, the `tree` parameter is not useful since LexM doesn't produce a spanning tree like all the other traversals do.


---

Comment by dcoudert created at 2019-08-02 15:47:52

It's not easy to check the validity of the code. Can you comment it.
You tried to follow the algorithm from Dourisboure and Gavoille, right ? It's not easy to recognize it.

I tried the algorithm and I doubt it is correct. For a PetersenGraph, the ordering is `0, 1, .., 9`.

Also I don't like the way you manipulate strings. You could directly have string labels, no ?

You should read the original paper by Rose, Tarjan and Luecker 1976 https://epubs.siam.org/doi/10.1137/0205021 . 
It provides other algorithms.

I have now a working implementation of the algorithms in sections 4 and 5.3. Both versions give same orders, but the one of section 5.3 is of course way faster. I'm not claiming the orders I produce are correct. Not easy to guess what the output should be.

I will push my code to save you time, but before if want to understand what you did and if there is an error and where. So please add some comments.


---

Comment by @giorgosgiapis created at 2019-08-02 16:20:13

Replying to [comment:12 dcoudert]:
> It's not easy to check the validity of the code. Can you comment it.
> You tried to follow the algorithm from Dourisboure and Gavoille, right ? It's not easy to recognize it.
> 
> I tried the algorithm and I doubt it is correct. For a PetersenGraph, the ordering is `0, 1, .., 9`.
> 
> Also I don't like the way you manipulate strings. You could directly have string labels, no ?

The reason I didn't choose to have string labels in the first place is that the labels will be used for the tree decomposition later so strings would only make the parsing harder. Also, the conversion to string is needed if we want to use C++ queue.

> You should read the original paper by Rose, Tarjan and Luecker 1976 https://epubs.siam.org/doi/10.1137/0205021 . 
> It provides other algorithms.
> 
> I have now a working implementation of the algorithms in sections 4 and 5.3. Both versions give same orders, but the one of section 5.3 is of course way faster. I'm not claiming the orders I produce are correct. Not easy to guess what the output should be.
> 
> I will push my code to save you time, but before if want to understand what you did and if there is an error and where. So please add some comments.

The general idea is that when we assign a number to a vertex we start a BFS-like procedure from that vertex. In the queue, we are keeping two things: the vertex and the maximum label in the path from our initial vertex to this one. We take care of the case when a vertex is already numbered or examined earlier (`if int_neighbor in vertices and not int_neighbor in seen:`).


---

Comment by dcoudert created at 2019-08-02 17:00:22

What you want to do with this string is not correct. See the example below where the second label is larger than the first one (lexicographic order).

```
sage: label = [[9, 2], [10, 2]]
sage: s0 = "".join(str(code) for code in label[0])
sage: s1 = "".join(str(code) for code in label[1])
sage: s0, s1, s0 > s1, label[0] > label[1]
('92', '102', True, False)
```



---

Comment by @giorgosgiapis created at 2019-08-02 17:09:08

I see now. I should find another way to do it.


---

Comment by @giorgosgiapis created at 2019-08-02 17:30:23

Well, I found one solution:



```
sage: label = [[9, 2], [10, 2]]
sage: s0 = ",".join(str(code) for code in label[0])
sage: s1 = ",".join(str(code) for code in label[1])
sage: l1 = list(map(int, s0.split(",")))
sage: l2 = list(map(int, s1.split(",")))
sage: label[0], label[1], l1, l2
([9, 2], [10, 2], [9, 2], [10, 2])
```



---

Comment by git created at 2019-08-02 17:49:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-02 17:52:09

Do you have any examples with graphs and their corresponding LexM orderings to test my code? I could create some but if there are any verified examples it would help me a lot.


---

Comment by dcoudert created at 2019-08-03 10:55:29

In the paper by Rose, Tarjan and Luecker, there is this graph `G = Graph({1: [2, 5], 2: [3, 4, 6], 3: [7], 4: [5, 6, 8], 5: [8], 6: [7, 9], 7: [9], 8: [9]})`, but I'm not sure we can get the same labels.


---

Comment by git created at 2019-08-03 17:36:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-03 17:39:45

I rebased on last beta and did small corrections on your method to make it compliant with Python 3 (I'm working with it).

I have also added my implementation of the same algorithm and a test method. We can remove that later if not needed.
I hope it will be useful to correct your implementation as I think it is not correct.


---

Comment by dcoudert created at 2019-08-03 17:40:28

No need for the dependency to #28195, as it is merged in 8.9.beta5.


---

Comment by @giorgosgiapis created at 2019-08-04 06:22:18

Currently, I am having trouble building sage. When running make I am getting error `cp: cannot overwrite directory with non-directory` while building `[gap-4.10.2.p0]`. Should I post to sage-devel about it?


---

Comment by dcoudert created at 2019-08-04 07:56:11

Yes, sage-devel is the right place.


---

Comment by @giorgosgiapis created at 2019-08-05 16:11:01

My implementation is actually incorrect. I will try implementing the algorithm described in section  5.3 of the paper Rose.


---

Comment by @giorgosgiapis created at 2019-08-05 16:26:36

The problem with the new implementation is that we cannot directly get the labels assigned to each vertex.


---

Comment by dcoudert created at 2019-08-05 16:29:47

I will push my code for the algorithm in section 5.3.

Why do we need the labels ? The edges of the triangulation and the order are not enough ?


---

Comment by @giorgosgiapis created at 2019-08-05 16:30:47

Don't we need the labels for the tree decomposition?


---

Comment by git created at 2019-08-05 16:36:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-05 16:40:52

I don't know, I have not checked how to build the tree-decomposition from the output of `lex_M`.


---

Comment by @giorgosgiapis created at 2019-08-05 16:49:11

I thought that the labels give us a tree decomposition of the graph.


---

Comment by @giorgosgiapis created at 2019-08-05 16:53:21

I guess we could start with this code, add examples and tests and then think about the labels.


---

Comment by dcoudert created at 2019-08-05 17:53:42

So make a front-end `lex_M` method with parameter `algorithm` and keep both versions (slow and 53) plus the test function. Feel free to rename the methods if you have more suitable names in mind ;)


---

Comment by @giorgosgiapis created at 2019-08-05 18:21:29

Good idea! I will work on it.


---

Comment by git created at 2019-08-06 18:35:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-06 18:37:41

I have added `INPUT` and `OUTPUT` to all methods and also renamed them. We also raise an exception if the given graph is directed. I will also add examples and tests and then start working with the front-end.


---

Comment by git created at 2019-08-07 15:54:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-07 15:55:48

Changing status from needs_work to needs_review.


---

Comment by @giorgosgiapis created at 2019-08-07 16:01:31

I have added examples and tests for both methods. Maybe it would be better to implement the front-end in another ticket. Let me know what you think.


---

Comment by git created at 2019-08-07 23:26:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-08 02:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-08 08:44:09

The front-end must be in this ticket. No need for another ticket for that.


---

Comment by git created at 2019-08-08 13:28:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-08 13:31:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-09 15:06:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-09 15:27:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-10 13:48:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-10 14:01:23

Everything is complete now. All methods are documented and have `EXAMPLES` and `TESTS` blocks. I can't, however, build the documentation (not because of this ticket) so if anyone can do this and confirm that it is displayed nicely it would be helpful.


---

Comment by git created at 2019-08-10 15:09:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-11 09:14:59

- R. Endre Tarjan -> Robert Endre Tarjan
- the front-end method can be defined directly in `traversals.pyx`.
- in the example `LexM produces an ordering of the vertices`, you should not only check the len of the output, but also that all vertices are in (compare sets)
- you can show an ordering in an example
- add explanation for the test ` Both algorithms produce a valid LexM ordering`, i.e., what is a valid ordering
- The triangulation contains original graph edges, so we can directly do `H = Graph(F, format='list_of_edges')`
- I don't like the names `lex_M_slow` and `lex_M_fast`, and it's quite complicated for users to type. We can keep these names for the methods, but it would be better to find simple and clear names for the algorithms.
- `algorithm == None` -> `algorithm is None` or simply `not algorithm`

- remove the terms efficient and inefficient in the table of methods

- use latex (you also have to replace a `"""` by `r"""`

```diff
-    Note that instead of using labels 1, 2, ..., k and adding 1/2, we use labels
-    2, 4, ..., k and add 1, thus avoiding to use floats or rationals.
+    Note that instead of using labels `1, 2, \ldots, k` and adding `1/2`, we use labels
+    `2, 4, \ldots, k` and add `1`, thus avoiding to use floats or rationals.
```


- a possible improvement, but I'm not sure it makes a difference.

```diff
-                        F.append((int_to_v[v], int_to_v[z]))
+                        if triangulation:
+                            F.append((int_to_v[v], int_to_v[z]))
```



---

Comment by git created at 2019-08-11 17:05:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-11 17:08:51

Replying to [comment:50 dcoudert]:
> - the front-end method can be defined directly in `traversals.pyx`.
You mean define it in `traversals.pyx` and create an alias in `generic_graph.py`? I think this is a good idea

> - I don't like the names `lex_M_slow` and `lex_M_fast`, and it's quite complicated for users to type. We can keep these names for the methods, but it would be better to find simple and clear names for the algorithms.
I will try to think of a better name. If you have anything in mind let me know.


---

Comment by git created at 2019-08-15 23:48:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-19 16:52:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-19 16:53:26

I did some corrections. Please check. I you agree, you can set to positive review on my behalf.


---

Comment by @giorgosgiapis created at 2019-08-19 17:26:36

Seems OK. Let's wait for the Patchbot. If all tests pass I will set to positive review.


---

Comment by dcoudert created at 2019-08-20 16:43:30

There is an error when building the html documentation. Could be 

```diff
-    :meth:`~lex_M` | Return an ordering of the vertices of G according the LexM graph traversal.
+    :meth:`~GenericGraph.lex_M` | Return an ordering of the vertices of G according the LexM graph traversal.
```

Please check


---

Comment by git created at 2019-08-21 02:24:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-21 11:46:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-21 11:47:09

I suspect you have not even tried to build the documentation and check if it looks good...

I have done several corrections. Please check.


---

Comment by @giorgosgiapis created at 2019-08-21 11:50:29

I can't seem to get the documentation to build on my MacBook and I currently don't have access to my desktop. I will post to sage-devel about it.


---

Comment by git created at 2019-08-21 12:48:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-21 12:50:07

I have added exceptions for when `initial_vertex` is not a graph vertex.


---

Comment by dcoudert created at 2019-08-21 13:17:04

why using `str(initial_vertex)` ? I don't think it's needed.


---

Comment by git created at 2019-08-21 14:35:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @giorgosgiapis created at 2019-08-21 14:35:39

Replying to [comment:64 dcoudert]:
> why using `str(initial_vertex)` ? I don't think it's needed.
You are right. Fixed!


---

Comment by dcoudert created at 2019-08-21 14:58:47

You have again not tested your commit !!!


```diff
-        ValueError: 'foo' is not a graph vertex dad
+        ValueError: 'foo' is not a graph vertex
```


and everywhere:

```diff
-        Traceback (most recent call last)
+        Traceback (most recent call last):
```



---

Comment by git created at 2019-08-21 15:05:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-08-22 15:12:27

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2019-08-22 15:12:27

LGTM.


---

Comment by vbraun created at 2019-08-28 19:55:09

Resolution: fixed
