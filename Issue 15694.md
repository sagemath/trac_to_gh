# Issue 15694: Implement a proper hash function for (combinatorial) free module elements

archive/issues_015694.json:
```json
{
    "body": "CC:  sage-combinat @hivert simonking @tscrim @anneschilling @dwbump\n\nUp to now, CombinatorialFreeModule elements used the (horrible)\ndefault implementation of __hash__ provided by Element which uses the\nstring representation. This was slow! And further fragile! Indeed, the\nstring representation depends on a sorting of the support of the\nelements.  In #14102 we got bitten by this with elements whose support\nmixed int's, Integer's and string. The result of:\n\n```\n    sage: sorted([int(0), 'delta', 1])\n    [0, 1, 'delta']\n```\n\ndepends on the platform (that's ok) but also on which of 0 and 1 are\nint's or Integer, whereas the corresponding lists test as equal.\nThis led to equal element with distinct hash values.\n\nThis ticket adds an implementation of `__hash__` inspired from that\nproposed for frozendicts in PEP 0416. In particular this\nimplementation does not rely on sorting.\n\nSome timings:\n\n```\n    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n    sage: B = F.basis()\n    sage: f = B['a'] + 3*B['c']\n    sage: %timeit hash(f)                         # new hash function\n    100000 loops, best of 3: 3.57 \u00b5s per loop\n    sage: %timeit hash(f._repr_())                # equivalent to the previous one\n    10000 loops, best of 3: 85 \u00b5s per loop\n```\n\n\nThere used to be a custom hash function for ambient space elements in\nroot systems, but this is not needed anymore:\n\n```\n    sage: F = RootSystem(['A',2]).ambient_space()\n    sage: f = F.simple_root(0)\n    sage: %timeit hash(f)                         # new hash function\n    100000 loops, best of 3: 3.63 \u00b5s per loop\n    sage: %timeit hash(f._repr_())                # equivalent to the previous one\n    10000 loops, best of 3: 42.3 \u00b5s per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15931\n\n",
    "created_at": "2014-03-13T14:51:16Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Implement a proper hash function for (combinatorial) free module elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15694",
    "user": "https://github.com/nthiery"
}
```
CC:  sage-combinat @hivert simonking @tscrim @anneschilling @dwbump

Up to now, CombinatorialFreeModule elements used the (horrible)
default implementation of __hash__ provided by Element which uses the
string representation. This was slow! And further fragile! Indeed, the
string representation depends on a sorting of the support of the
elements.  In #14102 we got bitten by this with elements whose support
mixed int's, Integer's and string. The result of:

```
    sage: sorted([int(0), 'delta', 1])
    [0, 1, 'delta']
```

depends on the platform (that's ok) but also on which of 0 and 1 are
int's or Integer, whereas the corresponding lists test as equal.
This led to equal element with distinct hash values.

This ticket adds an implementation of `__hash__` inspired from that
proposed for frozendicts in PEP 0416. In particular this
implementation does not rely on sorting.

Some timings:

```
    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
    sage: B = F.basis()
    sage: f = B['a'] + 3*B['c']
    sage: %timeit hash(f)                         # new hash function
    100000 loops, best of 3: 3.57 µs per loop
    sage: %timeit hash(f._repr_())                # equivalent to the previous one
    10000 loops, best of 3: 85 µs per loop
```


There used to be a custom hash function for ambient space elements in
root systems, but this is not needed anymore:

```
    sage: F = RootSystem(['A',2]).ambient_space()
    sage: f = F.simple_root(0)
    sage: %timeit hash(f)                         # new hash function
    100000 loops, best of 3: 3.63 µs per loop
    sage: %timeit hash(f._repr_())                # equivalent to the previous one
    10000 loops, best of 3: 42.3 µs per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/15931





---

archive/issue_comments_202928.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202928",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202929.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202929",
    "user": "https://github.com/nthiery"
}
```

New commits:



---

archive/issue_comments_202930.json:
```json
{
    "body": "Simon: I don't remember the status: would it be possible now to use cached_method on `__hash__`?",
    "created_at": "2014-03-13T15:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202930",
    "user": "https://github.com/nthiery"
}
```

Simon: I don't remember the status: would it be possible now to use cached_method on `__hash__`?



---

archive/issue_comments_202931.json:
```json
{
    "body": "Apparently, yes; here is the timing after adding a `@`cached_method:\n\n```\n    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n    sage: B = F.basis()\n    sage: f = B['a'] + 3*B['c']\n    sage: %timeit hash(f) \n    1000000 loops, best of 3: 582 ns per loop\n```\n\n\nIt's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\nDo we want to do this?",
    "created_at": "2014-03-13T15:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202931",
    "user": "https://github.com/nthiery"
}
```

Apparently, yes; here is the timing after adding a `@`cached_method:

```
    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
    sage: B = F.basis()
    sage: f = B['a'] + 3*B['c']
    sage: %timeit hash(f) 
    1000000 loops, best of 3: 582 ns per loop
```


It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.
Do we want to do this?



---

archive/issue_comments_202932.json:
```json
{
    "body": "Replying to [comment:4 nthiery]:\n> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\n\nGlad to see that the decorator is useful on magical Python methods (by the way, `__len__` and so on can now be cached as well).\n\n> Do we want to do this?\n\nI guess I am biased... ;-) (take that as \"yes, from my viewpoint\")\n\nIt reminds me, though, that I should investigate a potentially nasty detail. Assume that `@`cached_method is applied to the hash. Then an instance `O` is created, that has the hash `h1`. Then we save `O`. Later, the `__hash__` is changed, so that a newly created copy of `O` should have hash `h2!=h1`. Would it be the case that *reloading* `O` from the old pickle still has `hash(O)==h1`, i.e., would the old hash value be part of the pickle? This would be bad.",
    "created_at": "2014-03-13T15:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202932",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:4 nthiery]:
> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.

Glad to see that the decorator is useful on magical Python methods (by the way, `__len__` and so on can now be cached as well).

> Do we want to do this?

I guess I am biased... ;-) (take that as "yes, from my viewpoint")

It reminds me, though, that I should investigate a potentially nasty detail. Assume that `@`cached_method is applied to the hash. Then an instance `O` is created, that has the hash `h1`. Then we save `O`. Later, the `__hash__` is changed, so that a newly created copy of `O` should have hash `h2!=h1`. Would it be the case that *reloading* `O` from the old pickle still has `hash(O)==h1`, i.e., would the old hash value be part of the pickle? This would be bad.



---

archive/issue_comments_202933.json:
```json
{
    "body": "Replying to [comment:4 nthiery]:\n> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\n> Do we want to do this?\n\nSince `CombinatorialFreeModuleElement` are already large objects dict(index, coeff)) the size of a cached methods without any arguments seems to be 128 byte on a 64bits machine as of Sage 6.1.1. It probably could be lowered (Simon: do you have any idea ?). I'm tempted to say: add the cached method by default.\n\nFor the info, here are the Cython struct of a `CachedMethodNoArgs`:\n\n```\ncdef class CachedFunction(object):\n    cdef public str __name__\n    cdef public str __module__\n    cdef object _argument_fixer\n    cdef public object _fix_to_pos\n    cdef public object f\n    # cache is not always of type \"dict\"!\n    cdef public object cache\n    cdef tuple _default_key\n    cdef bint is_classmethod\n\ncdef class CachedMethodCallerNoArgs(CachedFunction):\n    cdef public object _instance\n```\n \nSimon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?",
    "created_at": "2014-03-13T15:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202933",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:4 nthiery]:
> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.
> Do we want to do this?

Since `CombinatorialFreeModuleElement` are already large objects dict(index, coeff)) the size of a cached methods without any arguments seems to be 128 byte on a 64bits machine as of Sage 6.1.1. It probably could be lowered (Simon: do you have any idea ?). I'm tempted to say: add the cached method by default.

For the info, here are the Cython struct of a `CachedMethodNoArgs`:

```
cdef class CachedFunction(object):
    cdef public str __name__
    cdef public str __module__
    cdef object _argument_fixer
    cdef public object _fix_to_pos
    cdef public object f
    # cache is not always of type "dict"!
    cdef public object cache
    cdef tuple _default_key
    cdef bint is_classmethod

cdef class CachedMethodCallerNoArgs(CachedFunction):
    cdef public object _instance
```
 
Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?



---

archive/issue_comments_202934.json:
```json
{
    "body": "Replying to [comment:6 hivert]:\n> For the info, here are the Cython struct of a `CachedMethodNoArgs`:\n> {{{\n> cdef class CachedFunction(object):\n>     cdef public str __name__\n>     cdef public str __module__\n>     cdef object _argument_fixer\n>     cdef public object _fix_to_pos\n>     cdef public object f\n>     # cache is not always of type \"dict\"!\n>     cdef public object cache\n>     cdef tuple _default_key\n>     cdef bint is_classmethod\n> \n> cdef class CachedMethodCallerNoArgs(CachedFunction):\n>     cdef public object _instance\n> }}} \n> Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?\n\nAsk Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.",
    "created_at": "2014-03-13T15:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202934",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:6 hivert]:
> For the info, here are the Cython struct of a `CachedMethodNoArgs`:
> {{{
> cdef class CachedFunction(object):
>     cdef public str __name__
>     cdef public str __module__
>     cdef object _argument_fixer
>     cdef public object _fix_to_pos
>     cdef public object f
>     # cache is not always of type "dict"!
>     cdef public object cache
>     cdef tuple _default_key
>     cdef bint is_classmethod
> 
> cdef class CachedMethodCallerNoArgs(CachedFunction):
>     cdef public object _instance
> }}} 
> Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?

Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.



---

archive/issue_comments_202935.json:
```json
{
    "body": "Replying to [comment:7 SimonKing]:\n> > Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?\n> \n> Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.\n\nTo bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.",
    "created_at": "2014-03-13T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202935",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:7 SimonKing]:
> > Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?
> 
> Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.

To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.



---

archive/issue_comments_202936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T16:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202937.json:
```json
{
    "body": "Replying to [comment:8 hivert]:\n> To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.\n\nI did a short experiment. This seems to work: see #15936. So I'm Ok with caching here.\n----\nNew commits:",
    "created_at": "2014-03-13T16:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202937",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:8 hivert]:
> To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.

I did a short experiment. This seems to work: see #15936. So I'm Ok with caching here.
----
New commits:



---

archive/issue_comments_202938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T16:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202939.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-13T17:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202939",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202940.json:
```json
{
    "body": "I get multiple doctest failures",
    "created_at": "2014-03-14T01:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202940",
    "user": "https://github.com/vbraun"
}
```

I get multiple doctest failures



---

archive/issue_comments_202941.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-03-17T11:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202941",
    "user": "https://github.com/nthiery"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_202942.json:
```json
{
    "body": "Changing the hash value of combinatorial free module elements changes the order in which they get sorted when printing, e.g., sets. This causes a bunch of trivial doctest failures that are not deterministic, in particular in crystals and weyl character rings. I am in the process of fixing those, trying at this occasion to make the tests more deterministic when easy. Further work on making those tests deterministic would be desirable in later tickets. \n\nAlso, for now, I removed the hash value of the parent from the hash value of the elements. See #15959. Travis: please check it out!\n\nCheers,",
    "created_at": "2014-03-17T11:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202942",
    "user": "https://github.com/nthiery"
}
```

Changing the hash value of combinatorial free module elements changes the order in which they get sorted when printing, e.g., sets. This causes a bunch of trivial doctest failures that are not deterministic, in particular in crystals and weyl character rings. I am in the process of fixing those, trying at this occasion to make the tests more deterministic when easy. Further work on making those tests deterministic would be desirable in later tickets. 

Also, for now, I removed the hash value of the parent from the hash value of the elements. See #15959. Travis: please check it out!

Cheers,



---

archive/issue_comments_202943.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-17T15:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-17T15:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-17T16:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-17T17:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202947.json:
```json
{
    "body": "Hopefully I have been through all the failing doctests. Anne, Travis, Dan, please check them!\n\nUsing pprint makes the order depend on the comparison function of free module elements rather than their hash, which should be more robust.\n\nWell, I get a bunch of other failures in the dev scripts, but those also fail for me on the current branch develop; so I assume they are unrelated.\n\n```\nsage -t --long src/sage/dev/sagedev.py  # 273 doctests failed\nsage -t --long src/sage/dev/git_interface.py  # 27 doctests failed\nsage -t --long src/sage/dev/trac_interface.py  # 27 doctests failed\nsage -t --long src/sage/dev/test/server_proxy.py  # 26 doctests failed\nsage -t --long src/sage/dev/test/sagedev.py  # 10 doctests failed\nsage -t --long src/sage/dev/patch.py  # 9 doctests failed\nsage -t --long src/sage/dev/config.py  # 18 doctests failed\nsage -t --long src/sage/dev/cmd_line_interface.py  # 14 doctests failed\nsage -t --long src/sage/dev/test/trac_interface.py  # 8 doctests failed\nsage -t --long src/sage/dev/user_interface.py  # 13 doctests failed\nsage -t --long src/sage/dev/sagedev_wrapper.py  # 4 doctests failed\nsage -t --long src/sage/dev/test/trac_server.py  # 2 doctests failed\nsage -t --long src/sage/dev/test/user_interface.py  # 4 doctests failed\nsage -t --long src/sage/dev/sagedev_instance.py  # 1 doctest failed\nsage -t --long src/sage/dev/test/config.py  # 2 doctests failed\n```\n",
    "created_at": "2014-03-17T17:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202947",
    "user": "https://github.com/nthiery"
}
```

Hopefully I have been through all the failing doctests. Anne, Travis, Dan, please check them!

Using pprint makes the order depend on the comparison function of free module elements rather than their hash, which should be more robust.

Well, I get a bunch of other failures in the dev scripts, but those also fail for me on the current branch develop; so I assume they are unrelated.

```
sage -t --long src/sage/dev/sagedev.py  # 273 doctests failed
sage -t --long src/sage/dev/git_interface.py  # 27 doctests failed
sage -t --long src/sage/dev/trac_interface.py  # 27 doctests failed
sage -t --long src/sage/dev/test/server_proxy.py  # 26 doctests failed
sage -t --long src/sage/dev/test/sagedev.py  # 10 doctests failed
sage -t --long src/sage/dev/patch.py  # 9 doctests failed
sage -t --long src/sage/dev/config.py  # 18 doctests failed
sage -t --long src/sage/dev/cmd_line_interface.py  # 14 doctests failed
sage -t --long src/sage/dev/test/trac_interface.py  # 8 doctests failed
sage -t --long src/sage/dev/user_interface.py  # 13 doctests failed
sage -t --long src/sage/dev/sagedev_wrapper.py  # 4 doctests failed
sage -t --long src/sage/dev/test/trac_server.py  # 2 doctests failed
sage -t --long src/sage/dev/test/user_interface.py  # 4 doctests failed
sage -t --long src/sage/dev/sagedev_instance.py  # 1 doctest failed
sage -t --long src/sage/dev/test/config.py  # 2 doctests failed
```




---

archive/issue_comments_202948.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-17T17:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202948",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_202949.json:
```json
{
    "body": "Travis and I fixed some doc tests and TAB characters. Looks good otherwise.\n----\nNew commits:",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202949",
    "user": "https://github.com/anneschilling"
}
```

Travis and I fixed some doc tests and TAB characters. Looks good otherwise.
----
New commits:



---

archive/issue_comments_202950.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202950",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202951.json:
```json
{
    "body": "Thanks Anne, Travis for the review! I double checked your changes and am indeed happy with them.",
    "created_at": "2014-03-18T14:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202951",
    "user": "https://github.com/nthiery"
}
```

Thanks Anne, Travis for the review! I double checked your changes and am indeed happy with them.



---

archive/issue_comments_202952.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-20T20:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202952",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015305.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-03-20T20:07:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15694#event-15305"
}
```



---

archive/issue_comments_202953.json:
```json
{
    "body": "Still fails on 32-bit\n\n```\nsage -t --long src/sage/combinat/free_module.py\n**********************************************************************\nFile \"src/sage/combinat/free_module.py\", line 116, in sage.combinat.free_module.CombinatorialFreeModuleElement.__hash__\nFailed example:\n    hash(f)\nExpected:\n    3765996081                    \nGot:\n    -528971215\n```\n",
    "created_at": "2014-03-22T15:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202953",
    "user": "https://github.com/vbraun"
}
```

Still fails on 32-bit

```
sage -t --long src/sage/combinat/free_module.py
**********************************************************************
File "src/sage/combinat/free_module.py", line 116, in sage.combinat.free_module.CombinatorialFreeModuleElement.__hash__
Failed example:
    hash(f)
Expected:
    3765996081                    
Got:
    -528971215
```




---

archive/issue_comments_202954.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-03-22T15:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202954",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_015306.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-03-22T15:46:48Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15694#event-15306"
}
```



---

archive/issue_comments_202955.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-03-22T15:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202955",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_202956.json:
```json
{
    "body": "Shoot; I don't have a 32bits machine under hand, and I was hoping the hash value on 32bits would be the hash value on 64bits mod 2^32.\n\nVolker: can you confirm that there is no other failure in 32 bits? If yes, I'll just fix the doctest and push.",
    "created_at": "2014-03-25T11:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202956",
    "user": "https://github.com/nthiery"
}
```

Shoot; I don't have a 32bits machine under hand, and I was hoping the hash value on 32bits would be the hash value on 64bits mod 2^32.

Volker: can you confirm that there is no other failure in 32 bits? If yes, I'll just fix the doctest and push.



---

archive/issue_comments_202957.json:
```json
{
    "body": "I didn't see any other test failures...",
    "created_at": "2014-03-25T12:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202957",
    "user": "https://github.com/vbraun"
}
```

I didn't see any other test failures...



---

archive/issue_comments_202958.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-27T18:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202958",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202959.json:
```json
{
    "body": "Thanks Volker.\n\nFinally having a working connection to push my change ...\n----\nNew commits:",
    "created_at": "2014-03-27T18:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202959",
    "user": "https://github.com/nthiery"
}
```

Thanks Volker.

Finally having a working connection to push my change ...
----
New commits:



---

archive/issue_comments_202960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-27T18:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202961.json:
```json
{
    "body": "Nicolas, do you want to merge in my fix for the Kyoto path model on #15959 or just let this ticket pass in as is?",
    "created_at": "2014-04-02T01:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202961",
    "user": "https://github.com/tscrim"
}
```

Nicolas, do you want to merge in my fix for the Kyoto path model on #15959 or just let this ticket pass in as is?



---

archive/issue_comments_202962.json:
```json
{
    "body": "No strong opinion. Since we have two tickets anyway, me might maybe as well get them in one by one.\n\nThanks for your fixes on the Kyoto path model! \n\nCheers,\n                    Nicolas",
    "created_at": "2014-04-02T20:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202962",
    "user": "https://github.com/nthiery"
}
```

No strong opinion. Since we have two tickets anyway, me might maybe as well get them in one by one.

Thanks for your fixes on the Kyoto path model! 

Cheers,
                    Nicolas



---

archive/issue_comments_202963.json:
```json
{
    "body": "Okay, then back to positive review here.",
    "created_at": "2014-04-02T20:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202963",
    "user": "https://github.com/tscrim"
}
```

Okay, then back to positive review here.



---

archive/issue_comments_202964.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-02T20:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202964",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_015307.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-04-04T18:52:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15694#event-15307"
}
```



---

archive/issue_comments_202965.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-04T18:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15694#issuecomment-202965",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
