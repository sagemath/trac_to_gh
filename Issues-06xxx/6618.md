# Issue 6618: Follow up on #6591: make tightpage work even in the notebook

archive/issues_006618.json:
```json
{
    "body": "\n\nAssignee: @nthiery\n\nCC:  sage-combinat @rbeezer fidelbarrera @jhpalmieri @fchapoton\n\nKeywords: view, pdflatex, tightpage, tikz\n\nReviewer: John Palmieri, Dima Pasechnik\n\nAuthor: Nicolas M. Thi\u00e9ry\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/6618\n\n",
    "closed_at": "2020-09-15T15:58:55Z",
    "created_at": "2009-07-25T14:52:25Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Follow up on #6591: make tightpage work even in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6618",
    "user": "https://github.com/nthiery"
}
```


Assignee: @nthiery

CC:  sage-combinat @rbeezer fidelbarrera @jhpalmieri @fchapoton

Keywords: view, pdflatex, tightpage, tikz

Reviewer: John Palmieri, Dima Pasechnik

Author: Nicolas M. Thi√©ry

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/6618





---

archive/issue_comments_067365.json:
```json
{
    "body": "<a id='comment:1'></a>\nCan you clarify what you want to do here?  The pictures produced by \"view\" in the notebook already look cropped to me.  Try this example:\n\n```\nfrom sage.misc.latex import latex_examples\nlatex.add_to_preamble(\"\\\\usepackage{tkz-graph}\")\nlatex.add_to_jsmath_avoid_list(\"tikzpicture\")\nview(latex_examples.graph())\n```",
    "created_at": "2009-07-25T20:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67365",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
Can you clarify what you want to do here?  The pictures produced by "view" in the notebook already look cropped to me.  Try this example:

```
from sage.misc.latex import latex_examples
latex.add_to_preamble("\\usepackage{tkz-graph}")
latex.add_to_jsmath_avoid_list("tikzpicture")
view(latex_examples.graph())
```



---

archive/issue_comments_067366.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [jhpalmieri](#comment%3A1):\n> Can you clarify what you want to do here?  The pictures produced by \"view\" in the notebook already look cropped to me.  Try this example:\n> \n> ```\n> from sage.misc.latex import latex_examples\n> latex.add_to_preamble(\"\\\\usepackage{tkz-graph}\")\n> latex.add_to_jsmath_avoid_list(\"tikzpicture\")\n> view(latex_examples.graph())\n> ```\n\n\nThe point is that tightpage crops if the picture is small, but also does *not* crop to the page size if the picture is big.\nIn other words, it really sets the page size to be the size of the picture.\n\nI have a apparently working patch. I still need to test it further and document it this time :-)",
    "created_at": "2009-07-25T20:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67366",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>
Replying to [jhpalmieri](#comment%3A1):
> Can you clarify what you want to do here?  The pictures produced by "view" in the notebook already look cropped to me.  Try this example:
> 
> ```
> from sage.misc.latex import latex_examples
> latex.add_to_preamble("\\usepackage{tkz-graph}")
> latex.add_to_jsmath_avoid_list("tikzpicture")
> view(latex_examples.graph())
> ```


The point is that tightpage crops if the picture is small, but also does *not* crop to the page size if the picture is big.
In other words, it really sets the page size to be the size of the picture.

I have a apparently working patch. I still need to test it further and document it this time :-)



---

archive/issue_comments_067367.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2009-07-25T20:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67367",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to assigned.



---

archive/issue_comments_067368.json:
```json
{
    "body": "Upstream: N/A",
    "created_at": "2010-02-20T09:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67368",
    "user": "https://github.com/nthiery"
}
```

Upstream: N/A



---

archive/issue_comments_067369.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-02-20T09:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67369",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_067370.json:
```json
{
    "body": "<a id='comment:4'></a>\nFeedback welcome: Anne seems to have an issue with it (see http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c46b8a2fcbb5875a).\n\nAlso, the notebook seems to crop the resulting image.",
    "created_at": "2010-02-20T09:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67370",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Feedback welcome: Anne seems to have an issue with it (see http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c46b8a2fcbb5875a).

Also, the notebook seems to crop the resulting image.



---

archive/issue_comments_067371.json:
```json
{
    "body": "<a id='comment:5'></a>\n> Also, the notebook seems to crop the resulting image.\n\n\nOnly when pdflatex=False; for details, see the doctests of view. Maybe tightpage should impose pdflatex=True.",
    "created_at": "2010-02-20T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67371",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>
> Also, the notebook seems to crop the resulting image.


Only when pdflatex=False; for details, see the doctests of view. Maybe tightpage should impose pdflatex=True.



---

archive/issue_comments_067372.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think that tightpage should impose pdflatex = True, because producing badly cropped images is bad.  One other comment (for now -- I may have more later): in line 1264\n\n```diff\n \t1261\t    if tightpage: \n \t1262\t        title = '' \n \t1263\t        extra_preamble += '\\\\usepackage[tightpage,active]{preview}\\\\PreviewEnvironment{page}' \n \t1264\t        math_left  = '\\\\begin{page}$\\displaystyle' \n \t1265\t        math_right = '$\\\\end{page}' \n```\nadd a space after \"displaystyle\".  On my computer:\n\n```\nsage: CB = CrystalOfLetters(['B',2]) \nsage: latex(CB)\ndot2tex not available.  Install after running 'sage -sh'\ndot2tex not available.  Install after running 'sage -sh'\nNone\n```\nSince `latex(CB)` returns `None`, then when I try \n\n```\nsage: view(CB, tightpage = True)\n```\nit forms a latex document containing\n\n```\n\\begin{page}$\\displaystyleNone$\\end{page}\n```\nThis leads to an error.  A space after \"displaystyle\" would fix this.",
    "created_at": "2010-02-20T17:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67372",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
I think that tightpage should impose pdflatex = True, because producing badly cropped images is bad.  One other comment (for now -- I may have more later): in line 1264

```diff
 	1261	    if tightpage: 
 	1262	        title = '' 
 	1263	        extra_preamble += '\\usepackage[tightpage,active]{preview}\\PreviewEnvironment{page}' 
 	1264	        math_left  = '\\begin{page}$\displaystyle' 
 	1265	        math_right = '$\\end{page}' 
```
add a space after "displaystyle".  On my computer:

```
sage: CB = CrystalOfLetters(['B',2]) 
sage: latex(CB)
dot2tex not available.  Install after running 'sage -sh'
dot2tex not available.  Install after running 'sage -sh'
None
```
Since `latex(CB)` returns `None`, then when I try 

```
sage: view(CB, tightpage = True)
```
it forms a latex document containing

```
\begin{page}$\displaystyleNone$\end{page}
```
This leads to an error.  A space after "displaystyle" would fix this.



---

archive/issue_comments_067373.json:
```json
{
    "body": "<a id='comment:7'></a>\nTwo more comments, and otherwise I think this looks okay: first, it needs to be rebased against 4.3.3 (alpha0 or later), because of #8219.  Second, the issue with the cropped images seems to be the fault of \"convert\": if you create a dvi file using tightpage, say by using \"debug=True\" in the view command and cutting and pasting the latex, and then if you run dvips on it, then run \n\n```\nconvert -density 150x150 -trim test.ps test.png\n```\nit's badly cropped.  The postscript file is actually okay: if you run ps2pdf on it, the pdf file looks good.  So maybe it's a bug in \"convert\"?\n\nFor a future ticket: should we consider changing the default so that pdflatex is True rather than False?",
    "created_at": "2010-02-20T21:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67373",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Two more comments, and otherwise I think this looks okay: first, it needs to be rebased against 4.3.3 (alpha0 or later), because of #8219.  Second, the issue with the cropped images seems to be the fault of "convert": if you create a dvi file using tightpage, say by using "debug=True" in the view command and cutting and pasting the latex, and then if you run dvips on it, then run 

```
convert -density 150x150 -trim test.ps test.png
```
it's badly cropped.  The postscript file is actually okay: if you run ps2pdf on it, the pdf file looks good.  So maybe it's a bug in "convert"?

For a future ticket: should we consider changing the default so that pdflatex is True rather than False?



---

archive/issue_comments_067374.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-02-20T21:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67374",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_067375.json:
```json
{
    "body": "<a id='comment:8'></a>\nAttachment [trac_6618_view_viewer_tightpage-followup-nt.patch](tarball://root/attachments/some-uuid/ticket6618/trac_6618_view_viewer_tightpage-followup-nt.patch) by @mwhansen created at 2012-08-04 04:24:49\n\nI've rebased this patch and made it so that engine is set to 'pdflatex' if tightpage=True is enabled.",
    "created_at": "2012-08-04T04:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67375",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:8'></a>
Attachment [trac_6618_view_viewer_tightpage-followup-nt.patch](tarball://root/attachments/some-uuid/ticket6618/trac_6618_view_viewer_tightpage-followup-nt.patch) by @mwhansen created at 2012-08-04 04:24:49

I've rebased this patch and made it so that engine is set to 'pdflatex' if tightpage=True is enabled.



---

archive/issue_comments_067376.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-04T04:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67376",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_067377.json:
```json
{
    "body": "<a id='comment:9'></a>\nOn my OS X machine, running doctests opens up an external viewer for PDF files. Also, doctests fail because I don't have dot2tex installed (this is easy to fix). For the external viewer issue, maybe we should just rip out these doctests:\n\n```diff\ndiff --git a/sage/misc/latex.py b/sage/misc/latex.py\n--- a/sage/misc/latex.py\n+++ b/sage/misc/latex.py\n@@ -2048,17 +2048,6 @@ def view(objects, title='SAGE', debug=Fa\n         <html><span class=\"math\">\\newcommand{\\Bold}[1]{\\mathbf{#1}}x 2</span></html>\n         sage: sage.misc.latex.EMBEDDED_MODE = False\n \n-        sage: CB = CrystalOfLetters(['B',5])\n-        sage: view(CB, tightpage = True, viewer = \"pdf\")\n-\n-        sage: CB = CrystalOfLetters(['B',5])\n-        sage: view(CB, tightpage = True, pdflatex = True)\n-\n-        sage: g = sage.categories.category.category_graph() # long time\n-        sage: g.set_latex_options(format = \"dot2tex\")       # long time\n-        sage: view(g, tightpage=True, pdflatex = True)      # long time\n-\n-\n     TESTS::\n \n         sage: from sage.misc.latex import _run_latex_, _latex_file_\n```\nOther suggestions?\n\nI also still some cropping issues in the notebook, say with this code:\n\n```\ng = graphs.BidiakisCube()\nlatex.add_to_jsmath_avoid_list('tikz')\nview(g, tightpage=True)\n```\nBut maybe that's not a big deal.",
    "created_at": "2012-08-20T18:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67377",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
On my OS X machine, running doctests opens up an external viewer for PDF files. Also, doctests fail because I don't have dot2tex installed (this is easy to fix). For the external viewer issue, maybe we should just rip out these doctests:

```diff
diff --git a/sage/misc/latex.py b/sage/misc/latex.py
--- a/sage/misc/latex.py
+++ b/sage/misc/latex.py
@@ -2048,17 +2048,6 @@ def view(objects, title='SAGE', debug=Fa
         <html><span class="math">\newcommand{\Bold}[1]{\mathbf{#1}}x 2</span></html>
         sage: sage.misc.latex.EMBEDDED_MODE = False
 
-        sage: CB = CrystalOfLetters(['B',5])
-        sage: view(CB, tightpage = True, viewer = "pdf")
-
-        sage: CB = CrystalOfLetters(['B',5])
-        sage: view(CB, tightpage = True, pdflatex = True)
-
-        sage: g = sage.categories.category.category_graph() # long time
-        sage: g.set_latex_options(format = "dot2tex")       # long time
-        sage: view(g, tightpage=True, pdflatex = True)      # long time
-
-
     TESTS::
 
         sage: from sage.misc.latex import _run_latex_, _latex_file_
```
Other suggestions?

I also still some cropping issues in the notebook, say with this code:

```
g = graphs.BidiakisCube()
latex.add_to_jsmath_avoid_list('tikz')
view(g, tightpage=True)
```
But maybe that's not a big deal.



---

archive/issue_comments_067378.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-03T20:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67378",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_020023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20023"
}
```



---

archive/issue_events_020024.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20024"
}
```



---

archive/issue_events_020025.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20025"
}
```



---

archive/issue_events_020026.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20026"
}
```



---

archive/issue_events_020027.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20027"
}
```



---

archive/issue_events_020028.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20028"
}
```



---

archive/issue_events_020029.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20029"
}
```



---

archive/issue_comments_067379.json:
```json
{
    "body": "<a id='comment:16'></a>\nProposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.",
    "created_at": "2020-08-18T00:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Proposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.



---

archive/issue_comments_067380.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-18T00:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67380",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_020030.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20030"
}
```



---

archive/issue_events_020031.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20031"
}
```



---

archive/issue_comments_067381.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-25T09:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67381",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_067382.json:
```json
{
    "body": "Changing reviewer from \"John Palmieri?\" to \"John Palmieri, Dima Pasechnik\"",
    "created_at": "2020-08-25T09:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67382",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "John Palmieri?" to "John Palmieri, Dima Pasechnik"



---

archive/issue_events_020032.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-15T15:58:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6618#event-20032"
}
```



---

archive/issue_comments_067383.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-09-15T15:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6618#issuecomment-67383",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid
