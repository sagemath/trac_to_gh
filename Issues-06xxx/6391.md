# Issue 6391: libGAP!  -- create a Cython library interface to gap

archive/issues_006391.json:
```json
{
    "body": "There's libSingular, there's libPari, and next we need to create libGAP.  \n\nTo try it out,\n* Install http://boxen.math.washington.edu/home/dima/packages/gap-4.5.6.spkg from #13211\n* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg\n* Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n* Apply [attachment:trac_6391_libGAP_root.patch] to the root repository\n\nCode in `sage/libs/gap/test/` demonstrates an interface to `libgap` from C. \n\nAssignee: @williamstein\n\nCC:  @burcin nborie @robertwb jeremywest @gvol davidm @kini @kcrisman @nthiery jpflori simonking\n\nReviewer: Dmitrii Pasechnik, Ivan Andrus, Volker Braun, William Stein\n\nDependencies: #13415, #13123, #13211\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/6391\n\n",
    "closed_at": "2012-12-27T10:30:42Z",
    "created_at": "2009-06-23T21:59:35Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "libGAP!  -- create a Cython library interface to gap",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6391",
    "user": "https://github.com/williamstein"
}
```
There's libSingular, there's libPari, and next we need to create libGAP.  

To try it out,
* Install http://boxen.math.washington.edu/home/dima/packages/gap-4.5.6.spkg from #13211
* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg
* Apply [attachment:trac_6391_libGAP.patch] to the Sage library
* Apply [attachment:trac_6391_libGAP_root.patch] to the root repository

Code in `sage/libs/gap/test/` demonstrates an interface to `libgap` from C. 

Assignee: @williamstein

CC:  @burcin nborie @robertwb jeremywest @gvol davidm @kini @kcrisman @nthiery jpflori simonking

Reviewer: Dmitrii Pasechnik, Ivan Andrus, Volker Braun, William Stein

Dependencies: #13415, #13123, #13211

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/6391





---

archive/issue_comments_057352.json:
```json
{
    "body": "<a id='comment:1'></a>To try out the first demo libgap.a use of GAP as a library:\n\n1. Install this spkg: http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p13.spkg\n\n2. Apply the patch trac_6391.patch attached to this ticket and do \"sage -br\".\n\nThen\n\n```\nsage: sage.libs.gap.gap.command()\n...\n> NormalSubgroups(SymmetricGroup(4));\n[ Group(()), Group([ (1,4)(2,3), (1,3)(2,4) ]), Group([ (2,4,3), (1,4)(2,3), (1,3)(2,4) ]), Sym( [ 1 .. 4 ] ) ]\nsage: sage.libs.gap.gap.command()\n> a := 8383;\n8383\nsage: sage.libs.gap.gap.command()\n> a^20;\n2937577432790013740156622649268134038711666398939150844563902439935080138297601\n```",
    "created_at": "2009-06-23T22:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57352",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>To try out the first demo libgap.a use of GAP as a library:

1. Install this spkg: http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p13.spkg

2. Apply the patch trac_6391.patch attached to this ticket and do "sage -br".

Then

```
sage: sage.libs.gap.gap.command()
...
> NormalSubgroups(SymmetricGroup(4));
[ Group(()), Group([ (1,4)(2,3), (1,3)(2,4) ]), Group([ (2,4,3), (1,4)(2,3), (1,3)(2,4) ]), Sym( [ 1 .. 4 ] ) ]
sage: sage.libs.gap.gap.command()
> a := 8383;
8383
sage: sage.libs.gap.gap.command()
> a^20;
2937577432790013740156622649268134038711666398939150844563902439935080138297601
```



---

archive/issue_comments_057353.json:
```json
{
    "body": "<a id='comment:2'></a>Before the above, be sure to do \n\n```\nimport sage.libs.gap.gap\n```",
    "created_at": "2009-06-23T22:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57353",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>Before the above, be sure to do 

```
import sage.libs.gap.gap
```



---

archive/issue_comments_057354.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_6391-part2.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part2.patch) by @williamstein created at 2009-06-25 00:52:11\n\nMake sure to use the latest spkg, which I'll keep in the ticket description.",
    "created_at": "2009-06-25T00:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57354",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>Attachment [trac_6391-part2.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part2.patch) by @williamstein created at 2009-06-25 00:52:11

Make sure to use the latest spkg, which I'll keep in the ticket description.



---

archive/issue_comments_057355.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n \n+Latest spkg:\n+\n+   http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg\n``````\n",
    "created_at": "2009-06-25T00:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57355",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
 
+Latest spkg:
+
+   http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg
``````




---

archive/issue_comments_057356.json:
```json
{
    "body": "Attachment [trac_6391-part3-error_handling.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part3-error_handling.patch) by @williamstein created at 2009-06-25 18:24:11",
    "created_at": "2009-06-25T18:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57356",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_6391-part3-error_handling.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part3-error_handling.patch) by @williamstein created at 2009-06-25 18:24:11



---

archive/issue_comments_057357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,9 @@\n Latest spkg:\n \n    http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg\n+\n+I'm putting modified versions of gap source here:\n+\n+   http://sage.math.washington.edu/home/wstein/patches/gap\n+\n+\n``````\n",
    "created_at": "2009-06-25T18:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57357",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,9 @@
 Latest spkg:
 
    http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg
+
+I'm putting modified versions of gap source here:
+
+   http://sage.math.washington.edu/home/wstein/patches/gap
+
+
``````




---

archive/issue_comments_057358.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,10 +3,7 @@\n \n Latest spkg:\n \n-   http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg\n-\n-I'm putting modified versions of gap source here:\n-\n-   http://sage.math.washington.edu/home/wstein/patches/gap\n+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p15.spkg\n \n \n+\n``````\n",
    "created_at": "2009-06-25T21:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57358",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,10 +3,7 @@
 
 Latest spkg:
 
-   http://sage.math.washington.edu/home/wstein/patches/gap-4.4.10.p14.spkg
-
-I'm putting modified versions of gap source here:
-
-   http://sage.math.washington.edu/home/wstein/patches/gap
+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p15.spkg
 
 
+
``````




---

archive/issue_comments_057359.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2009-06-25T21:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57359",
    "user": "https://github.com/williamstein"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_057360.json:
```json
{
    "body": "Attachment [trac_6391-part4.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part4.patch) by @williamstein created at 2009-06-27 03:49:38",
    "created_at": "2009-06-27T03:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57360",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_6391-part4.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part4.patch) by @williamstein created at 2009-06-27 03:49:38



---

archive/issue_comments_057361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n \n Latest spkg:\n \n-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p15.spkg\n+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p16.spkg\n \n \n \n``````\n",
    "created_at": "2009-06-27T03:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57361",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 
 Latest spkg:
 
-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p15.spkg
+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p16.spkg
 
 
 
``````




---

archive/issue_comments_057362.json:
```json
{
    "body": "Attachment [trac_6391-part1.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part1.patch) by @williamstein created at 2009-09-28 21:07:27",
    "created_at": "2009-09-28T21:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57362",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_6391-part1.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391-part1.patch) by @williamstein created at 2009-09-28 21:07:27



---

archive/issue_comments_057363.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n \n Latest spkg:\n \n-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p16.spkg\n+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n \n \n \n``````\n",
    "created_at": "2009-09-28T21:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57363",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 
 Latest spkg:
 
-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p16.spkg
+   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
 
 
 
``````




---

archive/issue_comments_057364.json:
```json
{
    "body": "<a id='comment:9'></a>This log pretty much explains what/why/what next:\n\n```\nsage: import sage.libs.gap.gap as g\nsage: a = g.libgap('10')\nsage: a\n10\nsage: type(a)\n<type 'sage.libs.gap.gap.GapElement'>\nsage: a*a\n100\nsage: timeit('a*a')\n625 loops, best of 3: 209 ns per loop\nsage: b = gap('10')\nsage: b\n10\nsage: b*b\n100\nsage: type(b)\n<class 'sage.interfaces.gap.GapElement'>\nsage: !ps ax |grep gap\n 5497 pts/110  Ss+    0:00 /home/bober/sage-4.1/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /home/bober/sage-4.\n19751 pts/84   SNs+   0:00 /home/SimonKing/SAGE/sage-4.1.alpha1/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /ho\n27563 pts/109  Ss+    0:00 /scratch/steinz/sage/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /scratch/steinz/sag\n27572 pts/98   S+     0:00 sh -c ps ax |grep gap\n27574 pts/98   S+     0:00 grep gap\nsage: b.name()\n'$sage1'\nsage: timeit('b*b')\n625 loops, best of 3: 292 \u00b5s per loop\nsage: a = g.libgap('0')\nsage: a\n0\nsage: b = g.libgap('10')\nsage: b/a\nhit stderr\n```",
    "created_at": "2009-09-28T21:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57364",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>This log pretty much explains what/why/what next:

```
sage: import sage.libs.gap.gap as g
sage: a = g.libgap('10')
sage: a
10
sage: type(a)
<type 'sage.libs.gap.gap.GapElement'>
sage: a*a
100
sage: timeit('a*a')
625 loops, best of 3: 209 ns per loop
sage: b = gap('10')
sage: b
10
sage: b*b
100
sage: type(b)
<class 'sage.interfaces.gap.GapElement'>
sage: !ps ax |grep gap
 5497 pts/110  Ss+    0:00 /home/bober/sage-4.1/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /home/bober/sage-4.
19751 pts/84   SNs+   0:00 /home/SimonKing/SAGE/sage-4.1.alpha1/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /ho
27563 pts/109  Ss+    0:00 /scratch/steinz/sage/local/lib/gap-4.4.10/bin/x86_64-unknown-linux-gnu-gcc/gap -m 24m -l /scratch/steinz/sag
27572 pts/98   S+     0:00 sh -c ps ax |grep gap
27574 pts/98   S+     0:00 grep gap
sage: b.name()
'$sage1'
sage: timeit('b*b')
625 loops, best of 3: 292 Âµs per loop
sage: a = g.libgap('0')
sage: a
0
sage: b = g.libgap('10')
sage: b/a
hit stderr
```



---

archive/issue_comments_057365.json:
```json
{
    "body": "<a id='comment:10'></a>Overview:\n\n* Modified version of GAP, which is built by doing\n\n```\nsage -f -m  http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\nwait...\ncd sage/spkg/build/gap-4.4.10.p17\n```\nTo rebuild:\n\n```\nsteinz@sage:~/scratch/sage/spkg/build/gap-4.4.10.p17/src$ make\nsteinz@sage:~/scratch/sage/spkg/build/gap-4.4.10.p17/src/bin/x86_64-unknown-linux-gnu-gcc$ gcc -shared *.o -o libgap.so\n```\n\n* Cython code to use the Gap library:\n\n```\nIn here:\n   sage/devel/sage/sage/libs/gap/gap.pyx\n```\n\nIf you change gap.pyx, do `sage -br` to build the changed version and start Sage.",
    "created_at": "2009-09-28T21:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57365",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>Overview:

* Modified version of GAP, which is built by doing

```
sage -f -m  http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
wait...
cd sage/spkg/build/gap-4.4.10.p17
```
To rebuild:

```
steinz@sage:~/scratch/sage/spkg/build/gap-4.4.10.p17/src$ make
steinz@sage:~/scratch/sage/spkg/build/gap-4.4.10.p17/src/bin/x86_64-unknown-linux-gnu-gcc$ gcc -shared *.o -o libgap.so
```

* Cython code to use the Gap library:

```
In here:
   sage/devel/sage/sage/libs/gap/gap.pyx
```

If you change gap.pyx, do `sage -br` to build the changed version and start Sage.



---

archive/issue_comments_057366.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2010-03-10T16:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57366",
    "user": "https://trac.sagemath.org/admin/accounts/users/nborie"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_comments_057367.json:
```json
{
    "body": "<a id='comment:14'></a>I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: \n\n\n```\nsage: import sage.libs.gap.gap\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/Users/ayeq/sage-devel/<ipython console> in <module>()\n\n/Users/ayeq/sage-devel/gap.pyx in init sage.libs.gap.gap (sage/libs/gap/gap.c:6286)()\n\n/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in __init__(self, f, classmethod)\n     54 \n     55         \"\"\"\n---> 56         self._common_init(f, ArgumentFixer(f,classmethod=classmethod))\n     57         self.cache = {}\n     58 \n\n/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/function_mangling.pyc in __init__(self, f, classmethod)\n    107         \"\"\"        \n    108 \n--> 109         defaults = f.func_defaults\n    110         if defaults is None:\n    111             defaults = []\n\nAttributeError: 'builtin_function_or_method' object has no attribute 'func_defaults'\n```\n\nThe cached_function decorator works at the interpreter level so I really do not see what is happening. When the line is removed  the import works fine and from what I understand about cache_function this should be okay. \n\n```\n--- a/sage/libs/gap/gap.pyx\tSat Jun 27 05:49:14 2009 +0200\n+++ b/sage/libs/gap/gap.pyx\tSat Apr 10 16:30:27 2010 -0700\n@@ -71,8 +71,8 @@\n \n from sage.structure.element cimport ModuleElement, RingElement\n   \n-from sage.misc.cachefunc import cached_function\n-@cached_function\n+#from sage.misc.cachefunc import cached_function\n+#@cached_function\n def gap_root():\n     \"\"\"\n     Find the location of the GAP root install which is stored in the gap\n```",
    "created_at": "2010-04-10T23:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57367",
    "user": "https://trac.sagemath.org/admin/accounts/users/davidm"
}
```

<a id='comment:14'></a>I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: 


```
sage: import sage.libs.gap.gap
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/Users/ayeq/sage-devel/<ipython console> in <module>()

/Users/ayeq/sage-devel/gap.pyx in init sage.libs.gap.gap (sage/libs/gap/gap.c:6286)()

/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in __init__(self, f, classmethod)
     54 
     55         """
---> 56         self._common_init(f, ArgumentFixer(f,classmethod=classmethod))
     57         self.cache = {}
     58 

/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/function_mangling.pyc in __init__(self, f, classmethod)
    107         """        
    108 
--> 109         defaults = f.func_defaults
    110         if defaults is None:
    111             defaults = []

AttributeError: 'builtin_function_or_method' object has no attribute 'func_defaults'
```

The cached_function decorator works at the interpreter level so I really do not see what is happening. When the line is removed  the import works fine and from what I understand about cache_function this should be okay. 

```
--- a/sage/libs/gap/gap.pyx	Sat Jun 27 05:49:14 2009 +0200
+++ b/sage/libs/gap/gap.pyx	Sat Apr 10 16:30:27 2010 -0700
@@ -71,8 +71,8 @@
 
 from sage.structure.element cimport ModuleElement, RingElement
   
-from sage.misc.cachefunc import cached_function
-@cached_function
+#from sage.misc.cachefunc import cached_function
+#@cached_function
 def gap_root():
     """
     Find the location of the GAP root install which is stored in the gap
```



---

archive/issue_comments_057368.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,7 @@\n \n    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n \n+Rebased, for Sage 4.6.1 and GAP 4.4.12: \n \n+   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg\n \n``````\n",
    "created_at": "2011-01-14T17:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57368",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,7 @@
 
    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
 
+Rebased, for Sage 4.6.1 and GAP 4.4.12: 
 
+   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg
 
``````




---

archive/issue_comments_057369.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [davidm](#comment%3A14):\n> I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: \n> \n\n \n {{{\n sage: import sage.libs.gap.gap\n ---------------------------------------------------------------------------\n AttributeError                            Traceback (most recent call last)\n \n /Users/ayeq/sage-devel/<ipython console> in <module>()\n \n /Users/ayeq/sage-devel/gap.pyx in init sage.libs.gap.gap (sage/libs/gap/gap.c:6286)()\n \n/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in __init__(self, f, classmethod)\n      54 \n      55         \"\"\"\n ---> 56         self._common_init(f, ArgumentFixer(f,classmethod=classmethod))\n      57         self.cache = {}\n      58 \n \n /Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/function_mangling.pyc in __init__(self, f, classmethod)\n     107         \"\"\"        \n     108 \n --> 109         defaults = f.func_defaults\n     110         if defaults is None:\n     111             defaults = []\n \n AttributeError: 'builtin_function_or_method' object has no attribute 'func_defaults'\n }}}\n\n\nI see exactly the same with the new spkg on OSX 10.6. \nAnd the patch to gap.pyx you suggest works for me too.",
    "created_at": "2011-01-14T18:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57369",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Replying to [davidm](#comment%3A14):
> I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: 
> 

 
 {{{
 sage: import sage.libs.gap.gap
 ---------------------------------------------------------------------------
 AttributeError                            Traceback (most recent call last)
 
 /Users/ayeq/sage-devel/<ipython console> in <module>()
 
 /Users/ayeq/sage-devel/gap.pyx in init sage.libs.gap.gap (sage/libs/gap/gap.c:6286)()
 
/Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in __init__(self, f, classmethod)
      54 
      55         """
 ---> 56         self._common_init(f, ArgumentFixer(f,classmethod=classmethod))
      57         self.cache = {}
      58 
 
 /Users/ayeq/sage-devel/local/lib/python2.6/site-packages/sage/misc/function_mangling.pyc in __init__(self, f, classmethod)
     107         """        
     108 
 --> 109         defaults = f.func_defaults
     110         if defaults is None:
     111             defaults = []
 
 AttributeError: 'builtin_function_or_method' object has no attribute 'func_defaults'
 }}}


I see exactly the same with the new spkg on OSX 10.6. 
And the patch to gap.pyx you suggest works for me too.



---

archive/issue_comments_057370.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [dimpase](#comment%3A19):\n> Replying to [davidm](#comment%3A14):\n> > I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: \n> > \n\n> \n> I see exactly the same with the new spkg on OSX 10.6. \n> And the patch to gap.pyx you suggest works for me too.\n> \n\n\nmoreover, I get the same problem (and solition(?)) on Linux (on boxen). So this is certainly not OSX-specific.",
    "created_at": "2011-01-14T21:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57370",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>Replying to [dimpase](#comment%3A19):
> Replying to [davidm](#comment%3A14):
> > I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: 
> > 

> 
> I see exactly the same with the new spkg on OSX 10.6. 
> And the patch to gap.pyx you suggest works for me too.
> 


moreover, I get the same problem (and solition(?)) on Linux (on boxen). So this is certainly not OSX-specific.



---

archive/issue_comments_057371.json:
```json
{
    "body": "Attachment [6391.6.patch](tarball://root/attachments/some-uuid/ticket6391/6391.6.patch) by @dimpase created at 2011-01-17 14:10:42\n\ncumulative patch for sage 4.6.1",
    "created_at": "2011-01-17T14:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57371",
    "user": "https://github.com/dimpase"
}
```

Attachment [6391.6.patch](tarball://root/attachments/some-uuid/ticket6391/6391.6.patch) by @dimpase created at 2011-01-17 14:10:42

cumulative patch for sage 4.6.1



---

archive/issue_comments_057372.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [dimpase](#comment%3A20):\n> Replying to [dimpase](#comment%3A19):\n> > Replying to [davidm](#comment%3A14):\n> > > I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: \n> > > \n\n> > \n> > I see exactly the same with the new spkg on OSX 10.6. \n> > And the patch to gap.pyx you suggest works for me too.\n> > \n\n> \n> moreover, I get the same problem (and solition(?)) on Linux (on boxen). So this is certainly not OSX-specific.\n\n\nit turns out that cached_function won't work in Cython at all, so indeed this needs to be changed.\nThe cumulative patch 6391.6.patch fixed this, as well, as it supersedes the previous 4 patches.\n\nTo install for Sage 4.6.1, install the updated spkg, and this patch.\n\n\nDima",
    "created_at": "2011-01-17T14:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57372",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Replying to [dimpase](#comment%3A20):
> Replying to [dimpase](#comment%3A19):
> > Replying to [davidm](#comment%3A14):
> > > I get an error when importing libgap on sage 4.3.5 on OSX 10.6.3: 
> > > 

> > 
> > I see exactly the same with the new spkg on OSX 10.6. 
> > And the patch to gap.pyx you suggest works for me too.
> > 

> 
> moreover, I get the same problem (and solition(?)) on Linux (on boxen). So this is certainly not OSX-specific.


it turns out that cached_function won't work in Cython at all, so indeed this needs to be changed.
The cumulative patch 6391.6.patch fixed this, as well, as it supersedes the previous 4 patches.

To install for Sage 4.6.1, install the updated spkg, and this patch.


Dima



---

archive/issue_comments_057373.json:
```json
{
    "body": "<a id='comment:22'></a>Perhaps someone who understands libs/gap/gap.pyx better than me can comment on few sticking points I encounter:\n\nclass Gap(ParentWithBase) is instantiated only once, for base=ZZ. Is it meant that it should be instantiated for other bases, too? And if so, which ones? (I must say it's very puzzling to me piece of code...)\n\nin the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment \"This log pretty much explains what/why/what next:...\" above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?\n\nWhat _dealloc_ in this class meant to do?",
    "created_at": "2011-01-18T13:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57373",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>Perhaps someone who understands libs/gap/gap.pyx better than me can comment on few sticking points I encounter:

class Gap(ParentWithBase) is instantiated only once, for base=ZZ. Is it meant that it should be instantiated for other bases, too? And if so, which ones? (I must say it's very puzzling to me piece of code...)

in the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment "This log pretty much explains what/why/what next:..." above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?

What _dealloc_ in this class meant to do?



---

archive/issue_comments_057374.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [dimpase](#comment%3A22):\n> class Gap(ParentWithBase) is instantiated only once, for base=ZZ. Is it meant that it should be instantiated for other bases, too? And if so, which ones? (I must say it's very puzzling to me piece of code...)\n> \n\n\nNo, only once for base=ZZ.  \n\n> in the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment \"This log pretty much explains what/why/what next:...\" above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?\n> \n\n\nYes.  I don't know if GAP uses \"interrupts\" though.  You are basically above asking: \"Here is a problem nobody has solved yet, which is why libgap hasn't moved forward.  What is the solution?\"\n\n> What _dealloc_ in this class meant to do? \n\n\nSee {{__dealloc__}} at http://docs.cython.org/src/reference/extension_types.html for the definition of __dealloc__.  It is like __del__ in python.",
    "created_at": "2011-01-18T16:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57374",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:23'></a>Replying to [dimpase](#comment%3A22):
> class Gap(ParentWithBase) is instantiated only once, for base=ZZ. Is it meant that it should be instantiated for other bases, too? And if so, which ones? (I must say it's very puzzling to me piece of code...)
> 


No, only once for base=ZZ.  

> in the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment "This log pretty much explains what/why/what next:..." above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?
> 


Yes.  I don't know if GAP uses "interrupts" though.  You are basically above asking: "Here is a problem nobody has solved yet, which is why libgap hasn't moved forward.  What is the solution?"

> What _dealloc_ in this class meant to do? 


See {{__dealloc__}} at http://docs.cython.org/src/reference/extension_types.html for the definition of __dealloc__.  It is like __del__ in python.



---

archive/issue_comments_057375.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [was](#comment%3A23):\n> Replying to [dimpase](#comment%3A22):\n\n\n> > in the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment \"This log pretty much explains what/why/what next:...\" above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?\n> > \n\n> \n> Yes.  I don't know if GAP uses \"interrupts\" though.  You are basically above asking: \"Here is a problem nobody has solved yet, which is why libgap hasn't moved forward.  What is the solution?\"\n> \n\n\nFrom printing contents of the GAP interpreter output_buffer (introduced in the patch of GAP's scanner.c), I see that during the fatal a._div_(g.libgap('0'))_ it starts getting the contents of the usual GAP error message, like Entering break read-eval-print loop (i.e. it does a \"GAP interrupt\"). And then the crash happens in the Python interpreter. So I suppose more reverse engineering/understanding of the GAP interpreter is needed here, in order to avoid replicating it in Python...",
    "created_at": "2011-01-18T22:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57375",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>Replying to [was](#comment%3A23):
> Replying to [dimpase](#comment%3A22):


> > in the class GapElement, _div_ and other member functions can potentially fail (as demonstrated in the comment "This log pretty much explains what/why/what next:..." above), e.g. due to division by 0. It is meant that the corresponding checks are to be implemented in these member functions? I guess not, it's rather a matter of properly catching the corresponding GAP interrupts, right?
> > 

> 
> Yes.  I don't know if GAP uses "interrupts" though.  You are basically above asking: "Here is a problem nobody has solved yet, which is why libgap hasn't moved forward.  What is the solution?"
> 


From printing contents of the GAP interpreter output_buffer (introduced in the patch of GAP's scanner.c), I see that during the fatal a._div_(g.libgap('0'))_ it starts getting the contents of the usual GAP error message, like Entering break read-eval-print loop (i.e. it does a "GAP interrupt"). And then the crash happens in the Python interpreter. So I suppose more reverse engineering/understanding of the GAP interpreter is needed here, in order to avoid replicating it in Python...



---

archive/issue_comments_057376.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2011-03-22T01:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57376",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_057377.json:
```json
{
    "body": "<a id='comment:25'></a>I updated the patch to work with Sage-4.7.alpha1. I also added a bunch of doctests while trying to understand what is going on and replaced the deprecated `ParentWithBase` with `Parent`.\n\nI'll be doing some more work on libgap during Sage Days 29, so let me know if you have any suggestions.",
    "created_at": "2011-03-22T01:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57377",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>I updated the patch to work with Sage-4.7.alpha1. I also added a bunch of doctests while trying to understand what is going on and replaced the deprecated `ParentWithBase` with `Parent`.

I'll be doing some more work on libgap during Sage Days 29, so let me know if you have any suggestions.



---

archive/issue_comments_057378.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [vbraun](#comment%3A25):\n> I updated the patch to work with Sage-4.7.alpha1. I also added a bunch of doctests while trying to understand what is going on and replaced the deprecated `ParentWithBase` with `Parent`.\n> \n> I'll be doing some more work on libgap during Sage Days 29, so let me know if you have any suggestions.\n> \n\n\nI am not so sure that we should invest a lot of time in libGAP based on the current GAP 4.4.12, as GAP 4.5 is almost ready,\n(as a GAP package developer, I'm expecting to get it pretty soon) and has a lot of internals reworked. I understand that the GC is replaced by the Bohm's GC, and the arbitrary precision arithmetic is done by GMP, not by the internal GAP code (I suggested that they should try MPIR instead of GMP).",
    "created_at": "2011-03-22T01:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57378",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>Replying to [vbraun](#comment%3A25):
> I updated the patch to work with Sage-4.7.alpha1. I also added a bunch of doctests while trying to understand what is going on and replaced the deprecated `ParentWithBase` with `Parent`.
> 
> I'll be doing some more work on libgap during Sage Days 29, so let me know if you have any suggestions.
> 


I am not so sure that we should invest a lot of time in libGAP based on the current GAP 4.4.12, as GAP 4.5 is almost ready,
(as a GAP package developer, I'm expecting to get it pretty soon) and has a lot of internals reworked. I understand that the GC is replaced by the Bohm's GC, and the arbitrary precision arithmetic is done by GMP, not by the internal GAP code (I suggested that they should try MPIR instead of GMP).



---

archive/issue_comments_057379.json:
```json
{
    "body": "<a id='comment:27'></a>From my memory of libGAP the GC and the large integer arithmetic are totally orthogonal/irrelevant.    I think working on libGAP whenever somebody has the interest (!) is a good idea, since it really will be a major, major plus for Sage when it starts working.",
    "created_at": "2011-03-22T01:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57379",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:27'></a>From my memory of libGAP the GC and the large integer arithmetic are totally orthogonal/irrelevant.    I think working on libGAP whenever somebody has the interest (!) is a good idea, since it really will be a major, major plus for Sage when it starts working.



---

archive/issue_comments_057380.json:
```json
{
    "body": "<a id='comment:28'></a>I think the big issues right now are\n* being able to get out of the break/debug loop after a gap error\n* use libtool to build the library\nIf upstream manages to rid themselves of their memory manager and arbitrary precision arithmetic then thats awesome!",
    "created_at": "2011-03-22T02:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57380",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>I think the big issues right now are
* being able to get out of the break/debug loop after a gap error
* use libtool to build the library
If upstream manages to rid themselves of their memory manager and arbitrary precision arithmetic then thats awesome!



---

archive/issue_comments_057381.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [vbraun](#comment%3A28):\n> I think the big issues right now are\n> * being able to get out of the break/debug loop after a gap error\n> * use libtool to build the library\n> If upstream manages to rid themselves of their memory manager and arbitrary precision arithmetic then thats awesome!\n> \n\n\nHi Volker,\nplease see my current (Sage-4.6.1) snapshot, catching zero division etc.\n\n  http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg\n\nIt gets rid of the zero division problem. I.e. I can divide by 0 in GAP and still retain Sage/GAP session.\nHere is an example (sorry for extra print statements producing noise below)\n\n```\nsage: import sage.libs.gap.gap as g\n    \n            #########           ######         ###########           ###  \n         #############          ######         ############         ####  \n        ##############         ########        #############       #####  \n       ###############         ########        #####   ######      #####  \n      ######         #         #########       #####    #####     ######  \n     ######                   ##########       #####    #####    #######  \n     #####                    ##### ####       #####   ######   ########  \n     ####                    #####  #####      #############   ###  ####  \n     #####     #######       ####    ####      ###########    ####  ####  \n     #####     #######      #####    #####     ######        ####   ####  \n     #####     #######      #####    #####     #####         #############\n      #####      #####     ################    #####         #############\n      ######     #####     ################    #####         #############\n      ################    ##################   #####                ####  \n       ###############    #####        #####   #####                ####  \n         #############    #####        #####   #####                ####  \n          #########      #####          #####  #####                ####  \n                                                                          \n     Information at:  http://www.gap-system.org\n     Try '?help' for help. See also  '?copyright' and  '?authors'\n    \n   Loading the library. Please be patient, this may take a while.\nGAP4, Version: 4.4.12 of 17-Dec-2008, i686-apple-darwin10.6.0-gcc\nsage: a = g.libgap('0')\n> status in GapElement()= 0\nsage: b = g.libgap('10')\n> status in GapElement()= 0\nsage: a\ncalling READ_ERR at ViewObjVar0\noutput_buffer=0\n\n0\nsage: b\ncalling READ_ERR at ViewObjVar10\noutput_buffer=10\n\n10\nsage: a*b\ncalling READ_ERR at ViewObjVar0\noutput_buffer=0\n\n0\nsage: b/a\nRational operations: <divisor> must not be zero\nnot in any function\nEntering break read-eval-print loop ...\nyou can 'quit;' to quit to outer loop, or\nyou can replace <divisor> via 'return <divisor>;' to continue\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/usr/local/src/sage/sage-4.6.1.rc0/spkg/standard/<ipython console> in <module>()\n\n/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:11931)()\n\nRuntimeError: ReadEvalDebug called!\nsage: a*b\ncalling READ_ERR at ViewObjVar0\noutput_buffer=0\n\n0\nsage: b+b\ncalling READ_ERR at ViewObjVar20\noutput_buffer=20\n\n20\nsage: \n```\nDima",
    "created_at": "2011-03-22T02:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57381",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>Replying to [vbraun](#comment%3A28):
> I think the big issues right now are
> * being able to get out of the break/debug loop after a gap error
> * use libtool to build the library
> If upstream manages to rid themselves of their memory manager and arbitrary precision arithmetic then thats awesome!
> 


Hi Volker,
please see my current (Sage-4.6.1) snapshot, catching zero division etc.

  http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg

It gets rid of the zero division problem. I.e. I can divide by 0 in GAP and still retain Sage/GAP session.
Here is an example (sorry for extra print statements producing noise below)

```
sage: import sage.libs.gap.gap as g
    
            #########           ######         ###########           ###  
         #############          ######         ############         ####  
        ##############         ########        #############       #####  
       ###############         ########        #####   ######      #####  
      ######         #         #########       #####    #####     ######  
     ######                   ##########       #####    #####    #######  
     #####                    ##### ####       #####   ######   ########  
     ####                    #####  #####      #############   ###  ####  
     #####     #######       ####    ####      ###########    ####  ####  
     #####     #######      #####    #####     ######        ####   ####  
     #####     #######      #####    #####     #####         #############
      #####      #####     ################    #####         #############
      ######     #####     ################    #####         #############
      ################    ##################   #####                ####  
       ###############    #####        #####   #####                ####  
         #############    #####        #####   #####                ####  
          #########      #####          #####  #####                ####  
                                                                          
     Information at:  http://www.gap-system.org
     Try '?help' for help. See also  '?copyright' and  '?authors'
    
   Loading the library. Please be patient, this may take a while.
GAP4, Version: 4.4.12 of 17-Dec-2008, i686-apple-darwin10.6.0-gcc
sage: a = g.libgap('0')
> status in GapElement()= 0
sage: b = g.libgap('10')
> status in GapElement()= 0
sage: a
calling READ_ERR at ViewObjVar0
output_buffer=0

0
sage: b
calling READ_ERR at ViewObjVar10
output_buffer=10

10
sage: a*b
calling READ_ERR at ViewObjVar0
output_buffer=0

0
sage: b/a
Rational operations: <divisor> must not be zero
not in any function
Entering break read-eval-print loop ...
you can 'quit;' to quit to outer loop, or
you can replace <divisor> via 'return <divisor>;' to continue
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/usr/local/src/sage/sage-4.6.1.rc0/spkg/standard/<ipython console> in <module>()

/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:11931)()

RuntimeError: ReadEvalDebug called!
sage: a*b
calling READ_ERR at ViewObjVar0
output_buffer=0

0
sage: b+b
calling READ_ERR at ViewObjVar20
output_buffer=20

20
sage: 
```
Dima



---

archive/issue_comments_057382.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,7 @@\n \n    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg\n \n+Current snapshot, handles errors (such as zero division) better, for Sage 4.6.1 and GAP 4.4.12: \n+\n+   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg\n+\n``````\n",
    "created_at": "2011-03-22T05:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57382",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,7 @@
 
    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg
 
+Current snapshot, handles errors (such as zero division) better, for Sage 4.6.1 and GAP 4.4.12: 
+
+   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg
+
``````




---

archive/issue_comments_057383.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [was](#comment%3A27):\n> From my memory of libGAP the GC and the large integer arithmetic are totally orthogonal/irrelevant.    I think working on libGAP whenever somebody has the interest (!) is a good idea, since it really will be a major, major plus for Sage when it starts working. \n\n\nI'll try to get access to GAP 4.5 for Sage as soon as possible.\nAs I understood from GAP people, their current GC is a major headache making it hard to write a \"usual\" library interface, \nwhich might be much nicer to have...\nAFAIK, Bohm's GC is more manageable in this respect.  \n\nWell, perhaps indeed the changes in 4.5 aren't that big to warrant putting this on old.",
    "created_at": "2011-03-22T12:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57383",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>Replying to [was](#comment%3A27):
> From my memory of libGAP the GC and the large integer arithmetic are totally orthogonal/irrelevant.    I think working on libGAP whenever somebody has the interest (!) is a good idea, since it really will be a major, major plus for Sage when it starts working. 


I'll try to get access to GAP 4.5 for Sage as soon as possible.
As I understood from GAP people, their current GC is a major headache making it hard to write a "usual" library interface, 
which might be much nicer to have...
AFAIK, Bohm's GC is more manageable in this respect.  

Well, perhaps indeed the changes in 4.5 aren't that big to warrant putting this on old.



---

archive/issue_comments_057384.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n \n-Latest spkg:\n+Older spkg:\n \n    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n \n``````\n",
    "created_at": "2011-03-22T12:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57384",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
 
-Latest spkg:
+Older spkg:
 
    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
 
``````




---

archive/issue_comments_057385.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-03-22T19:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57385",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_057386.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,11 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n+Most current spkg for Sage-4.7.alpha1:\n+  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg\n \n-Older spkg:\n \n+Older versions:\n    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n-\n-Rebased, for Sage 4.6.1 and GAP 4.4.12: \n-\n    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg\n-\n-Current snapshot, handles errors (such as zero division) better, for Sage 4.6.1 and GAP 4.4.12: \n-\n    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg\n \n``````\n",
    "created_at": "2011-03-23T01:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57386",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,11 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
+Most current spkg for Sage-4.7.alpha1:
+  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg
 
-Older spkg:
 
+Older versions:
    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
-
-Rebased, for Sage 4.6.1 and GAP 4.4.12: 
-
    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg
-
-Current snapshot, handles errors (such as zero division) better, for Sage 4.6.1 and GAP 4.4.12: 
-
    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg
 
``````




---

archive/issue_comments_057387.json:
```json
{
    "body": "<a id='comment:33'></a>Attachment [trac_6391_libGAP.2.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.2.patch) by @vbraun created at 2011-03-23 01:37:52\n\nChanges to the newest spkg:\n* removed dist directory\n* removed unsetting CC/CXX since \"sage -sh\" sets these to sane values\n* converted all copied files from patches/ into patches\n* using libtool to build libGAP\n* Code cleanups\n\nBasic functionality now works including trapping errors:\n\n```\nsage: import sage.libs.gap.gap as g\nsage: g.libgap('1/0')\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1312, 0))\n\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:4963)()\n    684         \"\"\"\n    685         initialize_libgap()\n--> 686         return self.element_class(self, x)\n    687 \n    688 \n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.GapElement.__init__ (sage/libs/gap/gap.c:3047)()\n    366         except RuntimeError, msg:\n    367             ClearError()\n--> 368             raise ValueError, 'Gap: '+str(msg)\n    369 \n    370         assert Symbol == S_SEMICOLON, 'Did not end with semicolon?'\n\nValueError: Gap: Rational operations: <divisor> must not be zero\n```",
    "created_at": "2011-03-23T01:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57387",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>Attachment [trac_6391_libGAP.2.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.2.patch) by @vbraun created at 2011-03-23 01:37:52

Changes to the newest spkg:
* removed dist directory
* removed unsetting CC/CXX since "sage -sh" sets these to sane values
* converted all copied files from patches/ into patches
* using libtool to build libGAP
* Code cleanups

Basic functionality now works including trapping errors:

```
sage: import sage.libs.gap.gap as g
sage: g.libgap('1/0')
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1312, 0))

---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:4963)()
    684         """
    685         initialize_libgap()
--> 686         return self.element_class(self, x)
    687 
    688 

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.GapElement.__init__ (sage/libs/gap/gap.c:3047)()
    366         except RuntimeError, msg:
    367             ClearError()
--> 368             raise ValueError, 'Gap: '+str(msg)
    369 
    370         assert Symbol == S_SEMICOLON, 'Did not end with semicolon?'

ValueError: Gap: Rational operations: <divisor> must not be zero
```



---

archive/issue_comments_057388.json:
```json
{
    "body": "<a id='comment:34'></a>See also: http://wiki.sagemath.org/days29/projects#libGAP",
    "created_at": "2011-03-23T01:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57388",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>See also: http://wiki.sagemath.org/days29/projects#libGAP



---

archive/issue_comments_057389.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [vbraun](#comment%3A33):\n> Changes to the newest spkg:\n\n Volker,\nthe spkg does not buid on MacOSX.\nWhen building the library, I get\n\n```\n...\nchecking host system type... (cached) i686-apple-darwin10.6.0\nconfigure: creating ./config.status\nconfig.status: creating gac\nconfig.status: creating Makefile\nconfig.status: creating config.h\n( cd bin/i686-apple-darwin10.6.0-gcc ; make CC='gcc' )\nlibtool --mode=compile gcc -I. -I../.. -DCONFIG_H -Wall -g -O2  -o ariths.o -c ../../src/ariths.c\nlibtool: unknown option character `-' in: --mode=compile\nUsage: libtool -static [-] file [...] [-filelist listfile[,dirname]] [-arch_only arch] [-sacLT]\nUsage: libtool -dynamic [-] file [...] [-filelist listfile[,dirname]] [-arch_only arch] [-o output] [-install_name name] [-compatibility_version #] [-current_version #] [-seg1addr 0x#] [-segs_read_only_addr 0x#] [-segs_read_write_addr 0x#] [-seg_addr_table <filename>] [-seg_addr_table_filename <file_system_path>] [-all_load] [-noall_load]\nmake[1]: *** [ariths.o] Error 1\nmake: *** [compile] Error 2\nError building GAP.\n```",
    "created_at": "2011-03-23T05:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57389",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>Replying to [vbraun](#comment%3A33):
> Changes to the newest spkg:

 Volker,
the spkg does not buid on MacOSX.
When building the library, I get

```
...
checking host system type... (cached) i686-apple-darwin10.6.0
configure: creating ./config.status
config.status: creating gac
config.status: creating Makefile
config.status: creating config.h
( cd bin/i686-apple-darwin10.6.0-gcc ; make CC='gcc' )
libtool --mode=compile gcc -I. -I../.. -DCONFIG_H -Wall -g -O2  -o ariths.o -c ../../src/ariths.c
libtool: unknown option character `-' in: --mode=compile
Usage: libtool -static [-] file [...] [-filelist listfile[,dirname]] [-arch_only arch] [-sacLT]
Usage: libtool -dynamic [-] file [...] [-filelist listfile[,dirname]] [-arch_only arch] [-o output] [-install_name name] [-compatibility_version #] [-current_version #] [-seg1addr 0x#] [-segs_read_only_addr 0x#] [-segs_read_write_addr 0x#] [-seg_addr_table <filename>] [-seg_addr_table_filename <file_system_path>] [-all_load] [-noall_load]
make[1]: *** [ariths.o] Error 1
make: *** [compile] Error 2
Error building GAP.
```



---

archive/issue_comments_057390.json:
```json
{
    "body": "<a id='comment:36'></a>Hi Dima, Ivan Andrus already told me about the OSX issue and I'm pretty sure he'll fix it tomorrow. The problem is that OSX calls libtool `glibtool`.",
    "created_at": "2011-03-23T05:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57390",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>Hi Dima, Ivan Andrus already told me about the OSX issue and I'm pretty sure he'll fix it tomorrow. The problem is that OSX calls libtool `glibtool`.



---

archive/issue_comments_057391.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [was](#comment%3A9):\n> This log pretty much explains what/why/what next:\n\n\n```\nsage: import sage.libs.gap.gap as g\nsage: a = g.libgap('10')\nsage: a\n10\nsage: type(a)\n<type 'sage.libs.gap.gap.GapElement'>\nsage: a*a\n100\nsage: timeit('a*a')\n625 loops, best of 3: 898 ns per loop\nsage: b = gap('10')\nsage: timeit('b*b')\n125 loops, best of 3: 2.05 ms per loop\nsage: a = g.libgap('0')\nsage: a\n0\nsage: b = g.libgap('10')\nsage: b/a\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:12696)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.GapElement._div_ (sage/libs/gap/gap.c:4443)()\n    613         except RuntimeError, msg:\n    614             ClearError()\n--> 615             raise ValueError, 'Gap: '+str(msg)\n    616 \n    617 \n\nValueError: Gap: Rational operations: <divisor> must not be zero\n```\n\nI'm currently adding code to access Gap containers, e.g.\n\n```\nsage: S4 = g.libgap('SymmetricGroup(4)')\nsage: S4.List()\n[ (), (1,4), (1,2,4), (1,3,4), (2,4), (1,4,2), (1,2), (1,3,4,2), (2,3,4), (1,4,2,3), (1,2,3), (1,3)(2,4), (3,4), (1,4,3), (1,2,4,3), (1,3), (2,4,3), (1,4,3,2), (1,2)(3,4), (1,3,2), (2,3), (1,4)(2,3), (1,2,3,4), (1,3,2,4) ]\nsage: S4_elements = _\nsage: type(S4_elements)\n<type 'sage.libs.gap.gap.GapElement_List'>\nsage: S4_elements[3]\n(1,3,4)\nsage: prod( g for g in S4_elements )\n(1,3)(2,4)\n```",
    "created_at": "2011-03-23T05:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57391",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>Replying to [was](#comment%3A9):
> This log pretty much explains what/why/what next:


```
sage: import sage.libs.gap.gap as g
sage: a = g.libgap('10')
sage: a
10
sage: type(a)
<type 'sage.libs.gap.gap.GapElement'>
sage: a*a
100
sage: timeit('a*a')
625 loops, best of 3: 898 ns per loop
sage: b = gap('10')
sage: timeit('b*b')
125 loops, best of 3: 2.05 ms per loop
sage: a = g.libgap('0')
sage: a
0
sage: b = g.libgap('10')
sage: b/a
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:12696)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.GapElement._div_ (sage/libs/gap/gap.c:4443)()
    613         except RuntimeError, msg:
    614             ClearError()
--> 615             raise ValueError, 'Gap: '+str(msg)
    616 
    617 

ValueError: Gap: Rational operations: <divisor> must not be zero
```

I'm currently adding code to access Gap containers, e.g.

```
sage: S4 = g.libgap('SymmetricGroup(4)')
sage: S4.List()
[ (), (1,4), (1,2,4), (1,3,4), (2,4), (1,4,2), (1,2), (1,3,4,2), (2,3,4), (1,4,2,3), (1,2,3), (1,3)(2,4), (3,4), (1,4,3), (1,2,4,3), (1,3), (2,4,3), (1,4,3,2), (1,2)(3,4), (1,3,2), (2,3), (1,4)(2,3), (1,2,3,4), (1,3,2,4) ]
sage: S4_elements = _
sage: type(S4_elements)
<type 'sage.libs.gap.gap.GapElement_List'>
sage: S4_elements[3]
(1,3,4)
sage: prod( g for g in S4_elements )
(1,3)(2,4)
```



---

archive/issue_comments_057392.json:
```json
{
    "body": "<a id='comment:38'></a>I got it into a bad state:\n\n```\nsage: import sage.libs.gap.gap as g\nsage: g.libgap('0')\n0\nsage: g.libgap('if 4>3 then\\nPrint(\"hi\");\\nfi')\nNULL\nsage: g.libgap('if 4>3 thenPrint(\"hi\");\\nfi')\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n\n/Users/gvol/<ipython console> in <module>()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6866)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:2976)()\n\nAssertionError: The return status of ReadEvalCommand must be zero.\nsage: g.libgap('0')\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n\n/Users/gvol/<ipython console> in <module>()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6866)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:2976)()\n\nAssertionError: The return status of ReadEvalCommand must be zero.\nsage: \n```",
    "created_at": "2011-03-23T19:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57392",
    "user": "https://github.com/gvol"
}
```

<a id='comment:38'></a>I got it into a bad state:

```
sage: import sage.libs.gap.gap as g
sage: g.libgap('0')
0
sage: g.libgap('if 4>3 then\nPrint("hi");\nfi')
NULL
sage: g.libgap('if 4>3 thenPrint("hi");\nfi')
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)

/Users/gvol/<ipython console> in <module>()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6866)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:2976)()

AssertionError: The return status of ReadEvalCommand must be zero.
sage: g.libgap('0')
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)

/Users/gvol/<ipython console> in <module>()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6866)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:2976)()

AssertionError: The return status of ReadEvalCommand must be zero.
sage: 
```



---

archive/issue_comments_057393.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [iandrus](#comment%3A38):\n\nwell, it works as it should in p6, so that's something that got in p7.\nIndeed, with p6 I get\n\n```\nsage: gap('if 4>3 thenPrint(\"hi\");\\nfi')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/private/tmp/<ipython console> in <module>()\n\n/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __call__(self, x, name)\n   1093             \n   1094         if isinstance(x, basestring):\n-> 1095             return cls(self, x, name=name)\n   1096         try:\n   1097             return self._coerce_from_special_method(x)\n\n/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)\n   1520             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:\n   1521                 self._session_number = -1\n-> 1522                 raise TypeError, x\n   1523         self._session_number = parent._session_number\n   1524 \n\nTypeError: Gap produced error output\nSyntax error: expression expected\n$sage3:=if 4>3 thenPrint(\"hi\");fi;;\n         ^\n\n   executing $sage3:=if 4>3 thenPrint(\"hi\");fi;;\n```\n\nwhich is basically how it should be: cf. sage: gap('if 4>3 then\\nPrint(\"hi\");\\nfi')",
    "created_at": "2011-03-24T01:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57393",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>Replying to [iandrus](#comment%3A38):

well, it works as it should in p6, so that's something that got in p7.
Indeed, with p6 I get

```
sage: gap('if 4>3 thenPrint("hi");\nfi')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/private/tmp/<ipython console> in <module>()

/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __call__(self, x, name)
   1093             
   1094         if isinstance(x, basestring):
-> 1095             return cls(self, x, name=name)
   1096         try:
   1097             return self._coerce_from_special_method(x)

/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)
   1520             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:
   1521                 self._session_number = -1
-> 1522                 raise TypeError, x
   1523         self._session_number = parent._session_number
   1524 

TypeError: Gap produced error output
Syntax error: expression expected
$sage3:=if 4>3 thenPrint("hi");fi;;
         ^

   executing $sage3:=if 4>3 thenPrint("hi");fi;;
```

which is basically how it should be: cf. sage: gap('if 4>3 then\nPrint("hi");\nfi')



---

archive/issue_comments_057394.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [dimpase](#comment%3A39):\n\noops, no, sorry, please disregard my last comment; with p6 I also get something strange...",
    "created_at": "2011-03-24T01:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57394",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>Replying to [dimpase](#comment%3A39):

oops, no, sorry, please disregard my last comment; with p6 I also get something strange...



---

archive/issue_comments_057395.json:
```json
{
    "body": "<a id='comment:42'></a>Updated version (both spkg and library patch) fixes this issue:\n\n```\nsage: import sage.libs.gap.gap as g\nsage: g.libgap('0')\n0\nsage: g.libgap('if 4>3 then\\nPrint(\"hi\");\\nfi')\nNULL\nsage: g.libgap('if 4>3 thenPrint(\"hi\");\\nfi')\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1312, 0))\n\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6995)()\n   1125         if not isinstance(x, str):\n   1126             x = x._gap_init_()\n-> 1127         return make_GapElement(self, libgap_eval(x))\n   1128 \n   1129 \n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:3034)()\n    424     if status != STATUS_END:\n    425         ClearError()\n--> 426         raise ValueError, 'Not a normal statement.'\n    427         return NULL\n    428         \n\nValueError: Not a normal statement.\nsage: g.libgap('0')\n0\n```\nAlso, I changed the libGAP memory allocation to not use `sbrk()`, now it runs under valgrind ;-)",
    "created_at": "2011-03-24T01:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57395",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:42'></a>Updated version (both spkg and library patch) fixes this issue:

```
sage: import sage.libs.gap.gap as g
sage: g.libgap('0')
0
sage: g.libgap('if 4>3 then\nPrint("hi");\nfi')
NULL
sage: g.libgap('if 4>3 thenPrint("hi");\nfi')
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1312, 0))

---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/vbraun/opt/sage-4.7.alpha1/devel/sage-main/sage/libs/gap/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:6995)()
   1125         if not isinstance(x, str):
   1126             x = x._gap_init_()
-> 1127         return make_GapElement(self, libgap_eval(x))
   1128 
   1129 

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:3034)()
    424     if status != STATUS_END:
    425         ClearError()
--> 426         raise ValueError, 'Not a normal statement.'
    427         return NULL
    428         

ValueError: Not a normal statement.
sage: g.libgap('0')
0
```
Also, I changed the libGAP memory allocation to not use `sbrk()`, now it runs under valgrind ;-)



---

archive/issue_comments_057396.json:
```json
{
    "body": "<a id='comment:43'></a>The latest version of the libGAP patch now properly holds references to the GAP memory objects and releases them during `GapElement.__deref__`. No more random crashes because the GAP memory manager (GASMAN) recycles the Gap objects that Sage still references!\n\nI feel this is now stable enough for wider testing. I can't crash it any more :-) Please give it a whirl and let me know if you manage to segfault it!",
    "created_at": "2011-03-24T19:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57396",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'></a>The latest version of the libGAP patch now properly holds references to the GAP memory objects and releases them during `GapElement.__deref__`. No more random crashes because the GAP memory manager (GASMAN) recycles the Gap objects that Sage still references!

I feel this is now stable enough for wider testing. I can't crash it any more :-) Please give it a whirl and let me know if you manage to segfault it!



---

archive/issue_comments_057397.json:
```json
{
    "body": "<a id='comment:44'></a>Newest version can convert various GAP datatypes back to Sage, for example cyclotomic numbers\n\n```\nsage: libgap('5/3 + 7*E(3)').sage()\n7*zeta3 + 5/3\n```\nand permutations:\n\n```\nsage: generators = libgap.AlternatingGroup(4).GeneratorsOfGroup().sage()\nsage: generators   # a Sage list of Sage permutations!\n[(1,2,3), (2,3,4)]\nsage: PermutationGroup(generators).cardinality()   # computed in Sage\n12\nsage: libgap.AlternatingGroup(4).Size()            # computed in GAP\n12\n```",
    "created_at": "2011-03-25T04:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57397",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>Newest version can convert various GAP datatypes back to Sage, for example cyclotomic numbers

```
sage: libgap('5/3 + 7*E(3)').sage()
7*zeta3 + 5/3
```
and permutations:

```
sage: generators = libgap.AlternatingGroup(4).GeneratorsOfGroup().sage()
sage: generators   # a Sage list of Sage permutations!
[(1,2,3), (2,3,4)]
sage: PermutationGroup(generators).cardinality()   # computed in Sage
12
sage: libgap.AlternatingGroup(4).Size()            # computed in GAP
12
```



---

archive/issue_comments_057398.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [vbraun](#comment%3A44):\n> Newest version can convert various GAP datatypes back to Sage, for example cyclotomic numbers\n> \n> ```\n> sage: libgap('5/3 + 7*E(3)').sage()\n> 7*zeta3 + 5/3\n> ```\n> and permutations:\n> \n> ```\n> sage: generators = libgap.AlternatingGroup(4).GeneratorsOfGroup().sage()\n> sage: generators   # a Sage list of Sage permutations!\n> [(1,2,3), (2,3,4)]\n> sage: PermutationGroup(generators).cardinality()   # computed in Sage\n> 12\n> sage: libgap.AlternatingGroup(4).Size()            # computed in GAP\n> 12\n> ```\n\n\nThis sounds  great! What about matrices? \n(it would be even better if there was a well-explained in docs implementation example of such a conversion).\nE.g. for my work I need to convert GAP matrices (or non-standard sparse GAP matrices) into CVXOPT matrices.",
    "created_at": "2011-03-25T05:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57398",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>Replying to [vbraun](#comment%3A44):
> Newest version can convert various GAP datatypes back to Sage, for example cyclotomic numbers
> 
> ```
> sage: libgap('5/3 + 7*E(3)').sage()
> 7*zeta3 + 5/3
> ```
> and permutations:
> 
> ```
> sage: generators = libgap.AlternatingGroup(4).GeneratorsOfGroup().sage()
> sage: generators   # a Sage list of Sage permutations!
> [(1,2,3), (2,3,4)]
> sage: PermutationGroup(generators).cardinality()   # computed in Sage
> 12
> sage: libgap.AlternatingGroup(4).Size()            # computed in GAP
> 12
> ```


This sounds  great! What about matrices? 
(it would be even better if there was a well-explained in docs implementation example of such a conversion).
E.g. for my work I need to convert GAP matrices (or non-standard sparse GAP matrices) into CVXOPT matrices.



---

archive/issue_comments_057399.json:
```json
{
    "body": "<a id='comment:46'></a>Hi  -- vbraun, this is amazing!  You are a genius.  W00t.",
    "created_at": "2011-03-25T05:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57399",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:46'></a>Hi  -- vbraun, this is amazing!  You are a genius.  W00t.



---

archive/issue_comments_057400.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [dimpase](#comment%3A45):\n> This sounds  great! What about matrices? \n\n\nIf a dense matrix is good enough for you then you can just convert it to a List of Lists in Gap and then use the `.sage()` method which recurses through the lists and can convert numbers:\n\n```\nsage: from sage.libs.gap.libgap import libgap\nsage: M = libgap('BlockMatrix([[1,1,[[1, 2],[ 3, 4]]], [1,2,[[9,10],[11,12]]], [2,2,[[5, 6],[ 7, 8]]]],2,2)')\nsage: M\n<block matrix of dimensions (2*2)x(2*2)>\nsage: M.List().sage()\n[[1, 2, 9, 10], [3, 4, 11, 12], [0, 0, 5, 6], [0, 0, 7, 8]]\nsage: matrix(ZZ,_)\n[ 1  2  9 10]\n[ 3  4 11 12]\n[ 0  0  5  6]\n[ 0  0  7  8]\n```",
    "created_at": "2011-03-25T05:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57400",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:47'></a>Replying to [dimpase](#comment%3A45):
> This sounds  great! What about matrices? 


If a dense matrix is good enough for you then you can just convert it to a List of Lists in Gap and then use the `.sage()` method which recurses through the lists and can convert numbers:

```
sage: from sage.libs.gap.libgap import libgap
sage: M = libgap('BlockMatrix([[1,1,[[1, 2],[ 3, 4]]], [1,2,[[9,10],[11,12]]], [2,2,[[5, 6],[ 7, 8]]]],2,2)')
sage: M
<block matrix of dimensions (2*2)x(2*2)>
sage: M.List().sage()
[[1, 2, 9, 10], [3, 4, 11, 12], [0, 0, 5, 6], [0, 0, 7, 8]]
sage: matrix(ZZ,_)
[ 1  2  9 10]
[ 3  4 11 12]
[ 0  0  5  6]
[ 0  0  7  8]
```



---

archive/issue_comments_057401.json:
```json
{
    "body": "<a id='comment:48'></a>When testing the sage/libs/gap/ directory, I get a number of errors in libgap.pyx only.   Most stuff passes, but it seems to handle errors differently.  See below for an example; every error is something analogous to this, though of course they look different depending on what error is raised instead of what is expected.\n\nThis is on Mac OS X 10.4 PPC.\n\n```\nFile \"/Users/student/Desktop/sage-4.6.2/devel/sage/sage/libs/gap/libgap.pyx\", line 670:\n    sage: libgap(1) / libgap('0')\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: Gap: Rational operations: <divisor> must not be zero\nGot:\n    Traceback (most recent call last):\n      File \"/Users/student/Desktop/sage-4.6.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/student/Desktop/sage-4.6.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/student/Desktop/sage-4.6.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_17[7]>\", line 1, in <module>\n        libgap(Integer(1)) / libgap('0')###line 670:\n    sage: libgap(1) / libgap('0')\n      File \"element.pyx\", line 1549, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:11981)\n    RuntimeError: Rational operations: <divisor> must not be zero\n```\n\nBy the way, this needs some authors and reviewers in the list :)",
    "created_at": "2011-03-25T15:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57401",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:48'></a>When testing the sage/libs/gap/ directory, I get a number of errors in libgap.pyx only.   Most stuff passes, but it seems to handle errors differently.  See below for an example; every error is something analogous to this, though of course they look different depending on what error is raised instead of what is expected.

This is on Mac OS X 10.4 PPC.

```
File "/Users/student/Desktop/sage-4.6.2/devel/sage/sage/libs/gap/libgap.pyx", line 670:
    sage: libgap(1) / libgap('0')
Expected:
    Traceback (most recent call last):
    ...
    ValueError: Gap: Rational operations: <divisor> must not be zero
Got:
    Traceback (most recent call last):
      File "/Users/student/Desktop/sage-4.6.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/student/Desktop/sage-4.6.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/student/Desktop/sage-4.6.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_17[7]>", line 1, in <module>
        libgap(Integer(1)) / libgap('0')###line 670:
    sage: libgap(1) / libgap('0')
      File "element.pyx", line 1549, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:11981)
    RuntimeError: Rational operations: <divisor> must not be zero
```

By the way, this needs some authors and reviewers in the list :)



---

archive/issue_comments_057402.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [kcrisman](#comment%3A48):\n> When testing the sage/libs/gap/ directory, I get a number of errors in libgap.pyx only.   Most stuff passes, but it seems to handle errors differently.  See below for an example; every error is something analogous to this, though of course they look different depending on what error is raised instead of what is expected.\n> \n> This is on Mac OS X 10.4 PPC.\n> \n\n\n```\n File \"/Users/student/Desktop/sage-4.6.2/devel/sage/sage/libs/gap/libgap.pyx\", line 670:\n     sage: libgap(1) / libgap('0')\n```\n\nI expect that this is caught by Sage itself rather than by GAP (Sage recognizes that an illegal division is going to happen).\n\n[...]\n\n> By the way, this needs some authors and reviewers in the list :)\n\n\nI added some authors, in alphabetical order--\u2013don't know if this is a complete list.",
    "created_at": "2011-03-25T16:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57402",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>Replying to [kcrisman](#comment%3A48):
> When testing the sage/libs/gap/ directory, I get a number of errors in libgap.pyx only.   Most stuff passes, but it seems to handle errors differently.  See below for an example; every error is something analogous to this, though of course they look different depending on what error is raised instead of what is expected.
> 
> This is on Mac OS X 10.4 PPC.
> 


```
 File "/Users/student/Desktop/sage-4.6.2/devel/sage/sage/libs/gap/libgap.pyx", line 670:
     sage: libgap(1) / libgap('0')
```

I expect that this is caught by Sage itself rather than by GAP (Sage recognizes that an illegal division is going to happen).

[...]

> By the way, this needs some authors and reviewers in the list :)


I added some authors, in alphabetical order--âdon't know if this is a complete list.



---

archive/issue_comments_057403.json:
```json
{
    "body": "Changing author from \"\" to \"dimpase, iandrus,  vbraun,  was\"",
    "created_at": "2011-03-25T16:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57403",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "dimpase, iandrus,  vbraun,  was"



---

archive/issue_comments_057404.json:
```json
{
    "body": "<a id='comment:50'></a>No, `libgap(1) / libgap('0')` is evaluated in GAP and raises an error in GAP. We injected an `abort()` in the GAP code, so the `sig_on()`/`sig_off()` block catches it as `RuntimeError`. The `GapElement._div_` method should catch the `RuntimeError` and re-raise it as `ValueError`. This works for me (all doctests pass on Fedora 14 x86_64). Are you using the newest version of `trac_6391_libGAP.patch`?",
    "created_at": "2011-03-25T16:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57404",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>No, `libgap(1) / libgap('0')` is evaluated in GAP and raises an error in GAP. We injected an `abort()` in the GAP code, so the `sig_on()`/`sig_off()` block catches it as `RuntimeError`. The `GapElement._div_` method should catch the `RuntimeError` and re-raise it as `ValueError`. This works for me (all doctests pass on Fedora 14 x86_64). Are you using the newest version of `trac_6391_libGAP.patch`?



---

archive/issue_comments_057405.json:
```json
{
    "body": "<a id='comment:51'></a>Assuming you do not have the GAP small group database installed, then running\n\n```\nsage: import sage.libs.gap.gap as g\nsage: g.libgap('SmallGroup(12,3)')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/Users/gvol/SageStuff/gap-4.4.12.p7/src/<ipython console> in <module>()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:7237)()\n\n/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:3005)()\n\nValueError: Gap: Aborted\n```\n\nThe error message could be a bit more helpful, but  when runnning under `sage --valgrind` it leads to a segfault.",
    "created_at": "2011-03-25T17:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57405",
    "user": "https://github.com/gvol"
}
```

<a id='comment:51'></a>Assuming you do not have the GAP small group database installed, then running

```
sage: import sage.libs.gap.gap as g
sage: g.libgap('SmallGroup(12,3)')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/Users/gvol/SageStuff/gap-4.4.12.p7/src/<ipython console> in <module>()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6816)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.Gap._element_constructor_ (sage/libs/gap/gap.c:7237)()

/Users/gvol/vcs/cur-sage/local/lib/python2.6/site-packages/sage/libs/gap/gap.so in sage.libs.gap.gap.libgap_eval (sage/libs/gap/gap.c:3005)()

ValueError: Gap: Aborted
```

The error message could be a bit more helpful, but  when runnning under `sage --valgrind` it leads to a segfault.



---

archive/issue_comments_057406.json:
```json
{
    "body": "Changing author from \"dimpase, iandrus,  vbraun,  was\" to \"Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein\"",
    "created_at": "2011-03-25T18:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57406",
    "user": "https://github.com/kcrisman"
}
```

Changing author from "dimpase, iandrus,  vbraun,  was" to "Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein"



---

archive/issue_comments_057407.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein\"",
    "created_at": "2011-03-25T18:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57407",
    "user": "https://github.com/kcrisman"
}
```

Changing reviewer from "" to "Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein"



---

archive/issue_comments_057408.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [vbraun](#comment%3A50):\n> No, `libgap(1) / libgap('0')` is evaluated in GAP and raises an error in GAP. We injected an `abort()` in the GAP code, so the `sig_on()`/`sig_off()` block catches it as `RuntimeError`. The `GapElement._div_` method should catch the `RuntimeError` and re-raise it as `ValueError`. This works for me (all doctests pass on Fedora 14 x86_64). Are you using the newest version of `trac_6391_libGAP.patch`?\n\nI think so.\n\n```\nsage: hg_sage.import_patch('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6391/trac_6391_libGAP.patch')\n```\nis how I imported it, then `./sage -br`.  Like I said, it passes everything else in that directory.  (I haven't done other tests because it takes a loooong time.)\n\nThat part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?",
    "created_at": "2011-03-25T18:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57408",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:52'></a>Replying to [vbraun](#comment%3A50):
> No, `libgap(1) / libgap('0')` is evaluated in GAP and raises an error in GAP. We injected an `abort()` in the GAP code, so the `sig_on()`/`sig_off()` block catches it as `RuntimeError`. The `GapElement._div_` method should catch the `RuntimeError` and re-raise it as `ValueError`. This works for me (all doctests pass on Fedora 14 x86_64). Are you using the newest version of `trac_6391_libGAP.patch`?

I think so.

```
sage: hg_sage.import_patch('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6391/trac_6391_libGAP.patch')
```
is how I imported it, then `./sage -br`.  Like I said, it passes everything else in that directory.  (I haven't done other tests because it takes a loooong time.)

That part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?



---

archive/issue_comments_057409.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [kcrisman](#comment%3A52):\n> That part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?  \n\n\nThe patches are not cummulative. You need to back out old versions before applying the newest one.",
    "created_at": "2011-03-25T19:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57409",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:53'></a>Replying to [kcrisman](#comment%3A52):
> That part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?  


The patches are not cummulative. You need to back out old versions before applying the newest one.



---

archive/issue_comments_057410.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [vbraun](#comment%3A53):\n> Replying to [kcrisman](#comment%3A52):\n> > That part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?  \n\n> \n> The patches are not cummulative. You need to back out old versions before applying the newest one.\n\n\nI only applied this most recent one.  I was just wondering whether somehow I should have applied the .2.patch.  But I don't think this is the issue.\n\nInterestingly, I get long hangs, so I think you may be right that I'm somehow missing the !sig_on stuff.  But\n\n```\n        try:            sig_on()            result = make_GapElement(self.parent(),                                     DIFF(self.value, (<GapElement>right).value))            sig_off()            return result        except RuntimeError, msg:            ClearError()            raise ValueError, 'Gap: '+str(msg)\n```\nis what I get for the code of `g1._sub_??`.\n\nBut I did get this scary thing:\n\n```\nsage: libgap(1)\n/Users/student/Desktop/sage-4.6.2/local/bin/sage-sage: line 308: 14591 Abort trap              sage-ipython \"$@\" -i\n```\nCould this is another example of using the wrong !MAC_OSX_DEPLOYMENT_TARGET or something, like it was for the initial problems with 10.6 not working... ?  Maybe that's impossible.",
    "created_at": "2011-03-25T19:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57410",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:54'></a>Replying to [vbraun](#comment%3A53):
> Replying to [kcrisman](#comment%3A52):
> > That part seems to have first shown in in the .2.patch.  It didn't get cancelled in the going back to just .patch, did it?  

> 
> The patches are not cummulative. You need to back out old versions before applying the newest one.


I only applied this most recent one.  I was just wondering whether somehow I should have applied the .2.patch.  But I don't think this is the issue.

Interestingly, I get long hangs, so I think you may be right that I'm somehow missing the !sig_on stuff.  But

```
        try:            sig_on()            result = make_GapElement(self.parent(),                                     DIFF(self.value, (<GapElement>right).value))            sig_off()            return result        except RuntimeError, msg:            ClearError()            raise ValueError, 'Gap: '+str(msg)
```
is what I get for the code of `g1._sub_??`.

But I did get this scary thing:

```
sage: libgap(1)
/Users/student/Desktop/sage-4.6.2/local/bin/sage-sage: line 308: 14591 Abort trap              sage-ipython "$@" -i
```
Could this is another example of using the wrong !MAC_OSX_DEPLOYMENT_TARGET or something, like it was for the initial problems with 10.6 not working... ?  Maybe that's impossible.



---

archive/issue_comments_057411.json:
```json
{
    "body": "<a id='comment:55'></a>This also seems to be a strangely formed spkg. All that is in it is a folder called gap-4.4.12.p7, which is not the usual practice.  Where is src/, spkg-install, etc?",
    "created_at": "2011-03-25T20:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57411",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:55'></a>This also seems to be a strangely formed spkg. All that is in it is a folder called gap-4.4.12.p7, which is not the usual practice.  Where is src/, spkg-install, etc?



---

archive/issue_comments_057412.json:
```json
{
    "body": "<a id='comment:56'></a>The libGAP requires Sage-4.7.alpha1 or later because it uses the new signal handling stuff that Jeroen just merged. I saw you use 4.6.2, so that explains why the exceptions are not caught correctly. The spkg has the normal layout, not sure what you are doing wrong. It is not bzip2-compressed since that is faster to test, seems like you are not unpacking it correctly.",
    "created_at": "2011-03-25T21:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57412",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>The libGAP requires Sage-4.7.alpha1 or later because it uses the new signal handling stuff that Jeroen just merged. I saw you use 4.6.2, so that explains why the exceptions are not caught correctly. The spkg has the normal layout, not sure what you are doing wrong. It is not bzip2-compressed since that is faster to test, seems like you are not unpacking it correctly.



---

archive/issue_comments_057413.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [vbraun](#comment%3A56):\n> The libGAP requires Sage-4.7.alpha1 or later because it uses the new signal handling stuff that Jeroen just merged. I saw you use 4.6.2, so that explains why the exceptions are not caught correctly. \n\nGreat, that clarifies that.\n>The spkg has the normal layout, not sure what you are doing wrong. It is not bzip2-compressed since that is faster to test, seems like you are not unpacking it correctly.\n\nThis is hilarious - my Macs interpret the file ending `.p7` as a cryptographic file.  Removing that makes all well.\n\nSounds like you are all well on the way to solving this - another nice addition!",
    "created_at": "2011-03-26T01:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57413",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:57'></a>Replying to [vbraun](#comment%3A56):
> The libGAP requires Sage-4.7.alpha1 or later because it uses the new signal handling stuff that Jeroen just merged. I saw you use 4.6.2, so that explains why the exceptions are not caught correctly. 

Great, that clarifies that.
>The spkg has the normal layout, not sure what you are doing wrong. It is not bzip2-compressed since that is faster to test, seems like you are not unpacking it correctly.

This is hilarious - my Macs interpret the file ending `.p7` as a cryptographic file.  Removing that makes all well.

Sounds like you are all well on the way to solving this - another nice addition!



---

archive/issue_comments_057414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,14 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n-Most current spkg for Sage-4.7.alpha1:\n-  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg\n+Most current spkg for Sage-4.7.alpha2 (Requires Sage-4.7!)\n+  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p8.spkg\n+\n+\n \n \n Older versions:\n    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg\n    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg\n+   http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg\n \n``````\n",
    "created_at": "2011-03-26T10:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57414",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,14 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
-Most current spkg for Sage-4.7.alpha1:
-  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg
+Most current spkg for Sage-4.7.alpha2 (Requires Sage-4.7!)
+  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p8.spkg
+
+
 
 
 Older versions:
    http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg
    http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg
+   http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg
 
``````




---

archive/issue_comments_057415.json:
```json
{
    "body": "Attachment [trac_6391_libGAP.3.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.3.patch) by @vbraun created at 2011-03-26 10:31:18\n\nUpdated patch",
    "created_at": "2011-03-26T10:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57415",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_6391_libGAP.3.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.3.patch) by @vbraun created at 2011-03-26 10:31:18

Updated patch



---

archive/issue_comments_057416.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-26T18:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57416",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_057417.json:
```json
{
    "body": "<a id='comment:59'></a>The updated gap-4.4.12.p8 now contains a separate `libgap/` directory with a copy of the gap kernel sources and new autoconf scripts that can actually build a shared library on Solaris. \n\nWhile this layout is probably not the final word in how to build libgap, I think its good enough to test it on a wider audience. Once we are confident that it works well we should contact upstream and find out in how far they are willing to add shared library support. Ready for review!",
    "created_at": "2011-03-26T18:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57417",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:59'></a>The updated gap-4.4.12.p8 now contains a separate `libgap/` directory with a copy of the gap kernel sources and new autoconf scripts that can actually build a shared library on Solaris. 

While this layout is probably not the final word in how to build libgap, I think its good enough to test it on a wider audience. Once we are confident that it works well we should contact upstream and find out in how far they are willing to add shared library support. Ready for review!



---

archive/issue_comments_057418.json:
```json
{
    "body": "libgap interface header (for review purposes only)",
    "created_at": "2011-03-26T19:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57418",
    "user": "https://github.com/vbraun"
}
```

libgap interface header (for review purposes only)



---

archive/issue_comments_057419.json:
```json
{
    "body": "<a id='comment:60'></a>Attachment [libgap.h](tarball://root/attachments/some-uuid/ticket6391/libgap.h) by @dimpase created at 2011-03-27 09:01:59\n\nReplying to [vbraun](#comment%3A59):\n> The updated gap-4.4.12.p8 now contains a separate `libgap/` directory with a copy of the gap kernel sources and new autoconf scripts that can actually build a shared library on Solaris. \n> \n> While this layout is probably not the final word in how to build libgap, I think its good enough to test it on a wider audience. Once we are confident that it works well we should contact upstream and find out in how far they are willing to add shared library support. Ready for review!\n\n\nHi Volker, you mentioned adding doctests etc.\nDo you mean for the low-level stuff in gap.pyx ? \n\nDid you try completely replacing gap interface with libgap interface?\nIMHO it's about time to start doing this --- this would uncover more  things to do, I imagine.\n\nIt would be great is libgap/ contained at least one C example on building a C application that links against libGAP and does something, like computing the order of a permutation group. Would be good for stress-testing, and just understanding the\ninterface better.\nAnyone out there who has time for this now? (not me :-( ) I imagine it's more work on a makefile than on the C side.\n\nRegarding Sage-libGAP  interface, I would like to understand what happens in a scenario when a Python object P holds\na reference to a GAP object G, and then P gets GC'ed. This should result in G getting freed (eventually) by GAP's GC.\nIt would be good to see an evidence that this actually does happen.\n\nDid you check that things work with GAP workspaces (Saving/Loading workspaces, that is)?",
    "created_at": "2011-03-27T09:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57419",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>Attachment [libgap.h](tarball://root/attachments/some-uuid/ticket6391/libgap.h) by @dimpase created at 2011-03-27 09:01:59

Replying to [vbraun](#comment%3A59):
> The updated gap-4.4.12.p8 now contains a separate `libgap/` directory with a copy of the gap kernel sources and new autoconf scripts that can actually build a shared library on Solaris. 
> 
> While this layout is probably not the final word in how to build libgap, I think its good enough to test it on a wider audience. Once we are confident that it works well we should contact upstream and find out in how far they are willing to add shared library support. Ready for review!


Hi Volker, you mentioned adding doctests etc.
Do you mean for the low-level stuff in gap.pyx ? 

Did you try completely replacing gap interface with libgap interface?
IMHO it's about time to start doing this --- this would uncover more  things to do, I imagine.

It would be great is libgap/ contained at least one C example on building a C application that links against libGAP and does something, like computing the order of a permutation group. Would be good for stress-testing, and just understanding the
interface better.
Anyone out there who has time for this now? (not me :-( ) I imagine it's more work on a makefile than on the C side.

Regarding Sage-libGAP  interface, I would like to understand what happens in a scenario when a Python object P holds
a reference to a GAP object G, and then P gets GC'ed. This should result in G getting freed (eventually) by GAP's GC.
It would be good to see an evidence that this actually does happen.

Did you check that things work with GAP workspaces (Saving/Loading workspaces, that is)?



---

archive/issue_comments_057420.json:
```json
{
    "body": "<a id='comment:61'></a>Hi Dima,\n\nYes everything in `libgap.pyx` is doctested. I have't tried to replace gap by libgap in the Sage library, first I want to see if the new spkg compiles on all supported platforms. But p8 uses the standard autotools to build the shared library, so I'm pretty confident.\n\nThere is a subdirectory `sage/libs/gap/test` that contains a small C program for testing purposes just like what you want.\n\nGetting garbage collection in Gap work to work correctly was one of the major issues that I worked on over the week. For starters, Gasman has no explicit reference counts. It is also compacting, so we must never hold direct pointers into the memory. The way it works is that \n1. `libgap.pyx` first creates a new Gap global variable `libgap_owned_objects` and assigns an empty `rec()` to it.\n2. Every Python `GapElement` adds is wrapped Gap object to `libgap_owned_objects`.\n3. The `GapElement.__dealloc__` removes the Gap object from `libgap_owned_objects`. It is then no longer referenced inside Gap and Gasman eventually recycles the object.\nThis is doctested in the `__dealloc__` documentation.\n\nI haven't tried saving/loading Gap workspaces. But it doesn't make much sense in libGAP since it would break the Python<->Gap object relations. If you need to load a huge pre-evaluated Gap script then you probably don't need libGAP, which is all about fast interaction with Gap.",
    "created_at": "2011-03-27T13:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57420",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'></a>Hi Dima,

Yes everything in `libgap.pyx` is doctested. I have't tried to replace gap by libgap in the Sage library, first I want to see if the new spkg compiles on all supported platforms. But p8 uses the standard autotools to build the shared library, so I'm pretty confident.

There is a subdirectory `sage/libs/gap/test` that contains a small C program for testing purposes just like what you want.

Getting garbage collection in Gap work to work correctly was one of the major issues that I worked on over the week. For starters, Gasman has no explicit reference counts. It is also compacting, so we must never hold direct pointers into the memory. The way it works is that 
1. `libgap.pyx` first creates a new Gap global variable `libgap_owned_objects` and assigns an empty `rec()` to it.
2. Every Python `GapElement` adds is wrapped Gap object to `libgap_owned_objects`.
3. The `GapElement.__dealloc__` removes the Gap object from `libgap_owned_objects`. It is then no longer referenced inside Gap and Gasman eventually recycles the object.
This is doctested in the `__dealloc__` documentation.

I haven't tried saving/loading Gap workspaces. But it doesn't make much sense in libGAP since it would break the Python<->Gap object relations. If you need to load a huge pre-evaluated Gap script then you probably don't need libGAP, which is all about fast interaction with Gap.



---

archive/issue_comments_057421.json:
```json
{
    "body": "<a id='comment:62'></a>Replying to [vbraun](#comment%3A61):\n\n\n> \n> I haven't tried saving/loading Gap workspaces. But it doesn't make much sense in libGAP since it would break the Python<->Gap object relations. If you need to load a huge pre-evaluated Gap script then you probably don't need libGAP, which is all about fast interaction with Gap.\n\n\nAt least the initialization of libGAP should probably use a prebuilt workspace, as is done by the current interface.\nThe reason is to speed it up. \n\nEven with Python<-> GAP relations lost, saving workspace might still make sense (if you know the GAP names of objects\ncreated, you can get them, right?).\nAnd I don't see why it is really lost, as is it recorded in Gap global variable libgap_owned_objects. \nWhich would make it possible to re-create the corresponding Python's `GapElement` data.",
    "created_at": "2011-03-27T15:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57421",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:62'></a>Replying to [vbraun](#comment%3A61):


> 
> I haven't tried saving/loading Gap workspaces. But it doesn't make much sense in libGAP since it would break the Python<->Gap object relations. If you need to load a huge pre-evaluated Gap script then you probably don't need libGAP, which is all about fast interaction with Gap.


At least the initialization of libGAP should probably use a prebuilt workspace, as is done by the current interface.
The reason is to speed it up. 

Even with Python<-> GAP relations lost, saving workspace might still make sense (if you know the GAP names of objects
created, you can get them, right?).
And I don't see why it is really lost, as is it recorded in Gap global variable libgap_owned_objects. 
Which would make it possible to re-create the corresponding Python's `GapElement` data.



---

archive/issue_comments_057422.json:
```json
{
    "body": "<a id='comment:63'></a>During the libgGAP initialization you can pass any command line arguments to GAP, so we can easily load a workspace. Note that Gap initialization happens the first time you use libGAP, so it does not add to the Sage startup time.  \n\nIts true that one could recreate the `GapElement`s from a saved/loaded workspace (though you lose the Python variable names), but it still doesn't seem to be the most pressing issue right now.",
    "created_at": "2011-03-27T15:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57422",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:63'></a>During the libgGAP initialization you can pass any command line arguments to GAP, so we can easily load a workspace. Note that Gap initialization happens the first time you use libGAP, so it does not add to the Sage startup time.  

Its true that one could recreate the `GapElement`s from a saved/loaded workspace (though you lose the Python variable names), but it still doesn't seem to be the most pressing issue right now.



---

archive/issue_comments_057423.json:
```json
{
    "body": "<a id='comment:64'></a>Replying to [vbraun](#comment%3A63):\n> During the libgGAP initialization you can pass any command line arguments to GAP, so we can easily load a workspace. Note that Gap initialization happens the first time you use libGAP, so it does not add to the Sage startup time.  \n\n\nOK, but it does add to libGAP startup time.\n\n> \n> Its true that one could recreate the `GapElement`s from a saved/loaded workspace (though you lose the Python variable names), but it still doesn't seem to be the most pressing issue right now.\n\n\nI certainly agree with this.",
    "created_at": "2011-03-27T16:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57423",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>Replying to [vbraun](#comment%3A63):
> During the libgGAP initialization you can pass any command line arguments to GAP, so we can easily load a workspace. Note that Gap initialization happens the first time you use libGAP, so it does not add to the Sage startup time.  


OK, but it does add to libGAP startup time.

> 
> Its true that one could recreate the `GapElement`s from a saved/loaded workspace (though you lose the Python variable names), but it still doesn't seem to be the most pressing issue right now.


I certainly agree with this.



---

archive/issue_comments_057424.json:
```json
{
    "body": "<a id='comment:66'></a>A relevant status update and overview from Volker:\n\nHi Stephen,\n\nI wanted to contact you for a while about whether and how to integrate\nthe C GAP library interface that we wrote. I think it would be great\nto have a well-defined shared library interface, and it sounds like\nyou are interested in that as well. We have a working prototype at\nhttp://trac.sagemath.org/sage_trac/ticket/6391 that just needs review\nas far as I am concerned. It doesn't have a nicely abstracted\ninterface, but it works for Sage purposes. Let me comment on the\npoints in your pdf:\n\n1) IO: we want to inject input and catch output, so we can evaluate\ninput strings and parse output strings. For this, we just patched\nSyFgets() / PutChrTo().\n\n2) For errors, just send a signal from the shared library. We patched\nReadEvalError() to call abort(). The user of the shared library can\nthen install their own signal handler if they want to catch that. I\ndon't think entering the break/eval loop is particularly useful in a\nshared library, we just set BreakOnError = 0.\n\n3) similarly, if the user of the library wants to interrupt a GAP\ncomputation she can just signal SIGINT etc.\n\n4) To keep objects alive, the Sage library interface just creates a\nglobal GAP record (which aren't garbage collected)\n\n   libgap_owned_objects = GVarName( \"libgap_owned_objects\" );\n   AssGVar(libgap_owned_objects, NEW_PREC(0))\n\nand then references any objects that are wrapped by libGAP:\n\n   libgap_owned_objects_counter += 1\n   self.libgap_owned_objects_rnam = RNamIntg(libgap_owned_objects_counter)\n   AssPRec(VAL_GVAR(libgap_owned_objects),\n       self.libgap_owned_objects_rnam, self.value)\n\nFor simplicity we implemented this in Cython, but that should probably\nbe moved in the C library interface.\n\n5) Memory management: I replaced the sbrk with a malloc'ed workspace.\nAdded advantage: you can then use valgrind. I think valgrind disallows\nlarge sbrk() calls to force the libc malloc implementation to avoid\nit. For now, the libGAP workspace size has to be fixed at\niinitialization. This isn't ideal but Dima thought that you have some\nlong-term plans for switching to a different garbage collector. Maybe\nyou can tell us more about that.\n\n6) We didn't hit any name collisions in Sage, so its not an urgent\nissue. I agree that eventually only the relevant symbols should be\nexported by the shared library but GAP generally uses less common\nnames. Most C code doesn't use [CamelCase](CamelCase), for starters.\n\n7) I haven't tried loading modules from within libGAP.\n\n8) I didn't encounter any problems with GMP. Sage uses MPIR.\n\nIn any case, I'm very interested in getting a library implementation\nupstream and can help with that. I'm currently travelling around for\nconferences and will be back in DIAS in Dublin for more than a couple\nof days starting in August.\n\nBest wishes,\nVolker",
    "created_at": "2011-05-20T18:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57424",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:66'></a>A relevant status update and overview from Volker:

Hi Stephen,

I wanted to contact you for a while about whether and how to integrate
the C GAP library interface that we wrote. I think it would be great
to have a well-defined shared library interface, and it sounds like
you are interested in that as well. We have a working prototype at
http://trac.sagemath.org/sage_trac/ticket/6391 that just needs review
as far as I am concerned. It doesn't have a nicely abstracted
interface, but it works for Sage purposes. Let me comment on the
points in your pdf:

1) IO: we want to inject input and catch output, so we can evaluate
input strings and parse output strings. For this, we just patched
SyFgets() / PutChrTo().

2) For errors, just send a signal from the shared library. We patched
ReadEvalError() to call abort(). The user of the shared library can
then install their own signal handler if they want to catch that. I
don't think entering the break/eval loop is particularly useful in a
shared library, we just set BreakOnError = 0.

3) similarly, if the user of the library wants to interrupt a GAP
computation she can just signal SIGINT etc.

4) To keep objects alive, the Sage library interface just creates a
global GAP record (which aren't garbage collected)

   libgap_owned_objects = GVarName( "libgap_owned_objects" );
   AssGVar(libgap_owned_objects, NEW_PREC(0))

and then references any objects that are wrapped by libGAP:

   libgap_owned_objects_counter += 1
   self.libgap_owned_objects_rnam = RNamIntg(libgap_owned_objects_counter)
   AssPRec(VAL_GVAR(libgap_owned_objects),
       self.libgap_owned_objects_rnam, self.value)

For simplicity we implemented this in Cython, but that should probably
be moved in the C library interface.

5) Memory management: I replaced the sbrk with a malloc'ed workspace.
Added advantage: you can then use valgrind. I think valgrind disallows
large sbrk() calls to force the libc malloc implementation to avoid
it. For now, the libGAP workspace size has to be fixed at
iinitialization. This isn't ideal but Dima thought that you have some
long-term plans for switching to a different garbage collector. Maybe
you can tell us more about that.

6) We didn't hit any name collisions in Sage, so its not an urgent
issue. I agree that eventually only the relevant symbols should be
exported by the shared library but GAP generally uses less common
names. Most C code doesn't use [CamelCase](CamelCase), for starters.

7) I haven't tried loading modules from within libGAP.

8) I didn't encounter any problems with GMP. Sage uses MPIR.

In any case, I'm very interested in getting a library implementation
upstream and can help with that. I'm currently travelling around for
conferences and will be back in DIAS in Dublin for more than a couple
of days starting in August.

Best wishes,
Volker



---

archive/issue_comments_057425.json:
```json
{
    "body": "<a id='comment:67'></a>Needs work?\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: import sage.libs.gap.all\nsage: a = sage.libs.gap.all.libgap(2)\nsage: a + a\n4\nsage: timeit('a+a', number=10^6)\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (27, 0))\n| Sage Version 4.7, Release Date: 2011-05-17                         |\n| Type notebook() for the GUI, and license() for information.        |\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/tmp/wstein/sage-4.7/devel/sage-main/<ipython console> in <module>()\n\n/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit_class.so in sage.misc.sage_timeit_class.SageTimeit.__call__ (sage/misc/sage_timeit_class.c:744)()\n\n/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit_class.so in sage.misc.sage_timeit_class.SageTimeit.eval (sage/misc/sage_timeit_class.c:605)()\n\n/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit.pyc in sage_timeit(stmt, globals, preparse, number, repeat, precision)\n    182                     break\n    183 \n--> 184         best = min(timer.repeat(repeat, number)) / number\n    185 \n    186     finally:\n\n/tmp/wstein/sage-4.7/local/lib/python/timeit.pyc in repeat(self, repeat, number)\n    218         r = []\n    219         for i in range(repeat):\n--> 220             t = self.timeit(number)\n    221             r.append(t)\n    222         return r\n\n/tmp/wstein/sage-4.7/local/lib/python/timeit.pyc in timeit(self, number)\n    191         gcold = gc.isenabled()\n    192         gc.disable()\n--> 193         timing = self.inner(it, self.timer)\n    194         if gcold:\n    195             gc.enable()\n\n/tmp/wstein/sage-4.7/devel/sage-main/<magic-timeit> in inner(_it, _timer)\n\n/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__add__ (sage/structure/element.c:11367)()\n\n/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement._add_ (sage/libs/gap/libgap.c:4381)()\n\nValueError: Gap: Exhausted the GAP memory pool.\n```",
    "created_at": "2011-06-17T01:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57425",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:67'></a>Needs work?

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: import sage.libs.gap.all
sage: a = sage.libs.gap.all.libgap(2)
sage: a + a
4
sage: timeit('a+a', number=10^6)
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (27, 0))
| Sage Version 4.7, Release Date: 2011-05-17                         |
| Type notebook() for the GUI, and license() for information.        |
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/tmp/wstein/sage-4.7/devel/sage-main/<ipython console> in <module>()

/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit_class.so in sage.misc.sage_timeit_class.SageTimeit.__call__ (sage/misc/sage_timeit_class.c:744)()

/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit_class.so in sage.misc.sage_timeit_class.SageTimeit.eval (sage/misc/sage_timeit_class.c:605)()

/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/misc/sage_timeit.pyc in sage_timeit(stmt, globals, preparse, number, repeat, precision)
    182                     break
    183 
--> 184         best = min(timer.repeat(repeat, number)) / number
    185 
    186     finally:

/tmp/wstein/sage-4.7/local/lib/python/timeit.pyc in repeat(self, repeat, number)
    218         r = []
    219         for i in range(repeat):
--> 220             t = self.timeit(number)
    221             r.append(t)
    222         return r

/tmp/wstein/sage-4.7/local/lib/python/timeit.pyc in timeit(self, number)
    191         gcold = gc.isenabled()
    192         gc.disable()
--> 193         timing = self.inner(it, self.timer)
    194         if gcold:
    195             gc.enable()

/tmp/wstein/sage-4.7/devel/sage-main/<magic-timeit> in inner(_it, _timer)

/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__add__ (sage/structure/element.c:11367)()

/tmp/wstein/sage-4.7/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement._add_ (sage/libs/gap/libgap.c:4381)()

ValueError: Gap: Exhausted the GAP memory pool.
```



---

archive/issue_comments_057426.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-17T01:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57426",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_057427.json:
```json
{
    "body": "<a id='comment:69'></a>PING:   Should we try to get a very experimental version of libGAP in that has memory leaks?  Seems worrisome...?",
    "created_at": "2011-07-19T23:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57427",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:69'></a>PING:   Should we try to get a very experimental version of libGAP in that has memory leaks?  Seems worrisome...?



---

archive/issue_comments_057428.json:
```json
{
    "body": "<a id='comment:70'></a>I have been trying to make my free groups/finitely presented groups (see #12339) wraper with libgap, and in general it works fine (and an impressive speed, i must say). There are some random segfauls though. And i have run into a problem that can be traced down to:\n\n\n\n\n```\nsage: from sage.libs.gap.all import libgap\nsage: F=libgap('FreeGroup(2)')\nsage: lis=libgap('[]')\nsage: (a,b)=F.GeneratorsOfGroup()\nsage: lis.Add(a^2)\nsage: lis.Add(b^2)\nsage: lis.Add(a*b*a*b)\nsage: lis\n[ f1^2, f2^2, f1*f2*f1*f2 ]\nsage: H=F/lis\nsage: H\n<fp group on the generators [ f1, f2 ]>\nsage: H.IsomorphismSimplifiedFpGroup()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-4.7.2/<ipython console> in <module>()\n\n/home/mmarco/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:7643)()\n\n/home/mmarco/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:7259)()\n\nValueError: Gap: Aborted\n```",
    "created_at": "2012-05-13T22:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57428",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:70'></a>I have been trying to make my free groups/finitely presented groups (see #12339) wraper with libgap, and in general it works fine (and an impressive speed, i must say). There are some random segfauls though. And i have run into a problem that can be traced down to:




```
sage: from sage.libs.gap.all import libgap
sage: F=libgap('FreeGroup(2)')
sage: lis=libgap('[]')
sage: (a,b)=F.GeneratorsOfGroup()
sage: lis.Add(a^2)
sage: lis.Add(b^2)
sage: lis.Add(a*b*a*b)
sage: lis
[ f1^2, f2^2, f1*f2*f1*f2 ]
sage: H=F/lis
sage: H
<fp group on the generators [ f1, f2 ]>
sage: H.IsomorphismSimplifiedFpGroup()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-4.7.2/<ipython console> in <module>()

/home/mmarco/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:7643)()

/home/mmarco/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:7259)()

ValueError: Gap: Aborted
```



---

archive/issue_comments_057429.json:
```json
{
    "body": "Attachment [trac_6391_libGAP.4.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.4.patch) by @vbraun created at 2012-08-30 11:10:57\n\nUpdated patch",
    "created_at": "2012-08-30T11:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57429",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_6391_libGAP.4.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.4.patch) by @vbraun created at 2012-08-30 11:10:57

Updated patch



---

archive/issue_comments_057430.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#13211\"",
    "created_at": "2012-08-30T11:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57430",
    "user": "https://github.com/vbraun"
}
```

Changing dependencies from "" to "#13211"



---

archive/issue_comments_057431.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,8 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n-Most current spkg for Sage-4.7.alpha2 (Requires Sage-4.7!)\n-  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p8.spkg\n+To try it out,\n+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.5.spkg from #13211\n+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.5.spkg\n+* Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n \n \n-\n-\n-Older versions:\n-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg\n-   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg\n-   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg\n-   http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg\n-\n``````\n",
    "created_at": "2012-08-30T11:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57431",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,8 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
-Most current spkg for Sage-4.7.alpha2 (Requires Sage-4.7!)
-  http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p8.spkg
+To try it out,
+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.5.spkg from #13211
+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.5.spkg
+* Apply [attachment:trac_6391_libGAP.patch] to the Sage library
 
 
-
-
-Older versions:
-   http://sage.math.washington.edu/home/wstein/patches/gap/gap-4.4.10.p17.spkg
-   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p5.spkg
-   http://sage.math.washington.edu/home/dima/packages/gap-4.4.12.p6.spkg
-   http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.4.12.p7.spkg
-
``````




---

archive/issue_comments_057432.json:
```json
{
    "body": "<a id='comment:71'></a>The libgap doctests pass now. Also, mmarco's example works:\n\n```\nsage: F = libgap.FreeGroup(2)\nsage: a,b = F.GeneratorsOfGroup()\nsage: lis = libgap('[]')\nsage: lis.Add(a^2)\nsage: lis.Add(b^2)\nsage: lis.Add(a*b*a*b)\nsage: lis\n[ f1^2, f2^2, f1*f2*f1*f2 ]\nsage: H=F/lis\nsage: H\n<fp group on the generators [ f1, f2 ]>\nsage: H.IsomorphismSimplifiedFpGroup()\n[ f1, f2 ] -> [ f1, f2 ]\n```\nWilliam's `timeit('a+a', number=10^6)` also works. If you have any interest in libGAP please try it out **this week** and let me know if you find any bugs, then I can investigate them during the rest of this week...",
    "created_at": "2012-08-30T11:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57432",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:71'></a>The libgap doctests pass now. Also, mmarco's example works:

```
sage: F = libgap.FreeGroup(2)
sage: a,b = F.GeneratorsOfGroup()
sage: lis = libgap('[]')
sage: lis.Add(a^2)
sage: lis.Add(b^2)
sage: lis.Add(a*b*a*b)
sage: lis
[ f1^2, f2^2, f1*f2*f1*f2 ]
sage: H=F/lis
sage: H
<fp group on the generators [ f1, f2 ]>
sage: H.IsomorphismSimplifiedFpGroup()
[ f1, f2 ] -> [ f1, f2 ]
```
William's `timeit('a+a', number=10^6)` also works. If you have any interest in libGAP please try it out **this week** and let me know if you find any bugs, then I can investigate them during the rest of this week...



---

archive/issue_comments_057433.json:
```json
{
    "body": "<a id='comment:72'></a>I am running some tests with it. It seems to work fine, except for a few random segfaults (much less than before) I cannot reproduce them.\n\nI will run some more tests, but so far, it looks great.\n\nIs it possible to fix the memory limit for the gap session?",
    "created_at": "2012-08-30T16:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57433",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:72'></a>I am running some tests with it. It seems to work fine, except for a few random segfaults (much less than before) I cannot reproduce them.

I will run some more tests, but so far, it looks great.

Is it possible to fix the memory limit for the gap session?



---

archive/issue_comments_057434.json:
```json
{
    "body": "<a id='comment:73'></a>What do you mean by \"fix memory limit\"? The absolute limit is fixed. But we can increase the memory limit to be very large on 64-bit, it will only be virtual and not actually used. On 32-bit it will hurt that it counts against the 4GB process limit.",
    "created_at": "2012-08-30T17:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57434",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:73'></a>What do you mean by "fix memory limit"? The absolute limit is fixed. But we can increase the memory limit to be very large on 64-bit, it will only be virtual and not actually used. On 32-bit it will hurt that it counts against the 4GB process limit.



---

archive/issue_comments_057435.json:
```json
{
    "body": "<a id='comment:74'></a>What i mean is the amount of memory that the gap session can use (which is determined by the -o option). I have noticed that libgap handles this question in a different way than the classical pexpect interface.\n\nBefore, if i run a computaqtion that took too much memory in gap, the gap session would eventually be killed (because it is run with the option -o 9999G) by the system, leaving orphaned all the sage objects that interfaced objects in that session.\n\nI have noticed that with this interface it just returns an error, but the objects are not orphaned. This error is returned before all the system memory is exhausted. So i wonder how much memory is used before the error is issued, and how is all this handled.",
    "created_at": "2012-08-30T18:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57435",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:74'></a>What i mean is the amount of memory that the gap session can use (which is determined by the -o option). I have noticed that libgap handles this question in a different way than the classical pexpect interface.

Before, if i run a computaqtion that took too much memory in gap, the gap session would eventually be killed (because it is run with the option -o 9999G) by the system, leaving orphaned all the sage objects that interfaced objects in that session.

I have noticed that with this interface it just returns an error, but the objects are not orphaned. This error is returned before all the system memory is exhausted. So i wonder how much memory is used before the error is issued, and how is all this handled.



---

archive/issue_comments_057436.json:
```json
{
    "body": "<a id='comment:75'></a>The gap command line options that are used for setting up libgap can easily be changed. Right now its pretty small, I know. \n\nIf you have any random segfaults can you post your code? I can still debug it even if it is not reproducable.",
    "created_at": "2012-08-30T18:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57436",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:75'></a>The gap command line options that are used for setting up libgap can easily be changed. Right now its pretty small, I know. 

If you have any random segfaults can you post your code? I can still debug it even if it is not reproducable.



---

archive/issue_comments_057437.json:
```json
{
    "body": "<a id='comment:76'></a>I think it would be best if the memory limit would be set automatically deppending on the available RAM in the system.\n\nI just got a segfault playing with a modified version of my patch for finitely presented groups:\n\n```\nF=FreeGroup(3)\nF.inject_variables()\nDefining x0, x1, x2\nG=F.quotient([x0^2,x1^2,x2^2,(x0*x1)^3,(x1*x2)^3,(x0*x2)^2])\nG.inject_variables()\nDefining x0, x1, x2\nsage: g=G.gap()\nsage: g\n<fp group of size 24 on the generators [ x0, x1, x2 ]>\nsage: x=x0.gap()\nsage: x.Order()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-5.2/<ipython console> in <module>()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:8449)()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:8037)()\n\nValueError: libGAP: Segmentation fault\n```\n\nI can send you the whole file with the definition of the classes for G and x0, but i don't think it would give any useful information here: g is just a finitely presented group object of the ligbap interface, and x is one of its generators.\n\nI couldn't reproduce the error.",
    "created_at": "2012-08-30T23:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57437",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:76'></a>I think it would be best if the memory limit would be set automatically deppending on the available RAM in the system.

I just got a segfault playing with a modified version of my patch for finitely presented groups:

```
F=FreeGroup(3)
F.inject_variables()
Defining x0, x1, x2
G=F.quotient([x0^2,x1^2,x2^2,(x0*x1)^3,(x1*x2)^3,(x0*x2)^2])
G.inject_variables()
Defining x0, x1, x2
sage: g=G.gap()
sage: g
<fp group of size 24 on the generators [ x0, x1, x2 ]>
sage: x=x0.gap()
sage: x.Order()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-5.2/<ipython console> in <module>()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:8449)()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:8037)()

ValueError: libGAP: Segmentation fault
```

I can send you the whole file with the definition of the classes for G and x0, but i don't think it would give any useful information here: g is just a finitely presented group object of the ligbap interface, and x is one of its generators.

I couldn't reproduce the error.



---

archive/issue_comments_057438.json:
```json
{
    "body": "<a id='comment:77'></a>Another comment (i am not sure if itshould be fixed or if it is my fault): the testuite of my classes fails because comparison bewteen objects of this interface is not implemented. It works for the old interface though.",
    "created_at": "2012-08-30T23:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57438",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:77'></a>Another comment (i am not sure if itshould be fixed or if it is my fault): the testuite of my classes fails because comparison bewteen objects of this interface is not implemented. It works for the old interface though.



---

archive/issue_comments_057439.json:
```json
{
    "body": "<a id='comment:78'></a>Comparison isn't implemented yet. \n\nIf the error is not reproducible try to run it ~100 times to see if it crashes occasionally. And/or run it on another architecture.",
    "created_at": "2012-08-31T00:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57439",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:78'></a>Comparison isn't implemented yet. 

If the error is not reproducible try to run it ~100 times to see if it crashes occasionally. And/or run it on another architecture.



---

archive/issue_comments_057440.json:
```json
{
    "body": "<a id='comment:79'></a>Ok, i have tried to isolate the issue and run it in a loop to reproduce it. It is not easy to catch, but every few thousand iterations it fails:\n\n```\nsage: g=libgap('FreeGroup(2)')\nsage: (a,b)=g.GeneratorsOfGroup()\nsage: lis=libgap('[]')\nsage: lis.Add(a^2)    \nsage: lis.Add(b^2)    \nsage: lis.Add(b*a)                          \nsage: h=g/lis\nsage: c=h.GeneratorsOfGroup()[0]\nsage: for i in range(3000):^J    n=c.Order()\n....:     \nsage: for i in range(3000):^J    n=c.Order()\n....:     \nsage: for i in range(3000):^J    n=c.Order()\n....:     \nsage: for i in range(3000):^J    n=c.Order()\n....:     \n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-5.2/<ipython console> in <module>()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:8449)()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:8037)()\n\nValueError: libGAP: Error, no method found! For debugging hints type ?Recovery from NoMethodFound\nError, no 1st choice method found for `CallFuncList' on 2 arguments\n```\n\nI am not sure if it is the same problem though. The error message is different.",
    "created_at": "2012-08-31T00:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57440",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:79'></a>Ok, i have tried to isolate the issue and run it in a loop to reproduce it. It is not easy to catch, but every few thousand iterations it fails:

```
sage: g=libgap('FreeGroup(2)')
sage: (a,b)=g.GeneratorsOfGroup()
sage: lis=libgap('[]')
sage: lis.Add(a^2)    
sage: lis.Add(b^2)    
sage: lis.Add(b*a)                          
sage: h=g/lis
sage: c=h.GeneratorsOfGroup()[0]
sage: for i in range(3000):^J    n=c.Order()
....:     
sage: for i in range(3000):^J    n=c.Order()
....:     
sage: for i in range(3000):^J    n=c.Order()
....:     
sage: for i in range(3000):^J    n=c.Order()
....:     
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-5.2/<ipython console> in <module>()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_MethodProxy.__call__ (sage/libs/gap/libgap.c:8449)()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.GapElement_Function.__call__ (sage/libs/gap/libgap.c:8037)()

ValueError: libGAP: Error, no method found! For debugging hints type ?Recovery from NoMethodFound
Error, no 1st choice method found for `CallFuncList' on 2 arguments
```

I am not sure if it is the same problem though. The error message is different.



---

archive/issue_comments_057441.json:
```json
{
    "body": "<a id='comment:80'></a>problem persists with the new patch.",
    "created_at": "2012-08-31T18:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57441",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:80'></a>problem persists with the new patch.



---

archive/issue_comments_057442.json:
```json
{
    "body": "<a id='comment:81'></a>I've fixed Miguel's bug and tested that libGAP remains running through hundreds of GAP garbage collections. All in all, I have not had any random crashes with the new version at all even in hundreds of repetitions. So I declare the current state to be totally awesome and ready to be released into the wild and exposed to the general Sage community. Please review!",
    "created_at": "2012-09-03T16:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57442",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:81'></a>I've fixed Miguel's bug and tested that libGAP remains running through hundreds of GAP garbage collections. All in all, I have not had any random crashes with the new version at all even in hundreds of repetitions. So I declare the current state to be totally awesome and ready to be released into the wild and exposed to the general Sage community. Please review!



---

archive/issue_comments_057443.json:
```json
{
    "body": "Changing component from interfaces to group theory.",
    "created_at": "2012-09-03T16:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57443",
    "user": "https://github.com/vbraun"
}
```

Changing component from interfaces to group theory.



---

archive/issue_comments_057444.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-09-03T16:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57444",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_057445.json:
```json
{
    "body": "<a id='comment:82'></a>Problem persists for me. Not in a 3000 iterations loop, but in longer loops:\n\n```\nsage: g=libgap('FreeGroup(2)')                    \nsage: (a,b)=g.GeneratorsOfGroup()\nsage: lis=libgap('[]')\nsage: lis.Add(a^2)    \nsage: lis.Add(b^2)    \nsage: lis.Add(b*a)    \nsage: h=g/lis                                                                                              \nsage: c=h.GeneratorsOfGroup()[0]\nsage: for i in range(300000):                 \n....:     n=c.Order()\n....:     \n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-5.2/<ipython console> in <module>()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:7860)()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7433)()\n\nValueError: libGAP: Error, no method found! For debugging hints type ?Recovery from NoMethodFound\nError, no 1st choice method found for `CallFuncList' on 2 arguments\n\nsage: i\n6862\n```",
    "created_at": "2012-09-03T20:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57445",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:82'></a>Problem persists for me. Not in a 3000 iterations loop, but in longer loops:

```
sage: g=libgap('FreeGroup(2)')                    
sage: (a,b)=g.GeneratorsOfGroup()
sage: lis=libgap('[]')
sage: lis.Add(a^2)    
sage: lis.Add(b^2)    
sage: lis.Add(b*a)    
sage: h=g/lis                                                                                              
sage: c=h.GeneratorsOfGroup()[0]
sage: for i in range(300000):                 
....:     n=c.Order()
....:     
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-5.2/<ipython console> in <module>()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:7860)()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7433)()

ValueError: libGAP: Error, no method found! For debugging hints type ?Recovery from NoMethodFound
Error, no 1st choice method found for `CallFuncList' on 2 arguments

sage: i
6862
```



---

archive/issue_comments_057446.json:
```json
{
    "body": "<a id='comment:83'></a>After considerable despair I finally realized that Python called the libgap initialization from a higher stack frame than where `c.Order()` was executing. One peculiarities of the GAP memory manager is that it trawls the stack for pointers into its memory pool and keeps these alive (so you can just work with local stack-allocated GAP objects and not worry). While its easy to figure out the highest stack frame (its you, the currently executing function) we must take care to inform GAP about the lowest stack frame that can hold a pointer to a memory bag!\n\nNow Miguel's example runs perfectly! For the record, you can use the following syntactic sugar to make the code look nicer:\n\n```\n    sage: G =libgap.FreeGroup(2)\n    sage: a,b = G.GeneratorsOfGroup()\n    sage: rel = libgap([a^2, b^2, a*b*a*b])\n    sage: H = G / rel\n    sage: c = H.GeneratorsOfGroup()[0]\n    sage: for i in range(300000):\n    ...       n = c.Order()\n```",
    "created_at": "2012-09-06T12:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57446",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:83'></a>After considerable despair I finally realized that Python called the libgap initialization from a higher stack frame than where `c.Order()` was executing. One peculiarities of the GAP memory manager is that it trawls the stack for pointers into its memory pool and keeps these alive (so you can just work with local stack-allocated GAP objects and not worry). While its easy to figure out the highest stack frame (its you, the currently executing function) we must take care to inform GAP about the lowest stack frame that can hold a pointer to a memory bag!

Now Miguel's example runs perfectly! For the record, you can use the following syntactic sugar to make the code look nicer:

```
    sage: G =libgap.FreeGroup(2)
    sage: a,b = G.GeneratorsOfGroup()
    sage: rel = libgap([a^2, b^2, a*b*a*b])
    sage: H = G / rel
    sage: c = H.GeneratorsOfGroup()[0]
    sage: for i in range(300000):
    ...       n = c.Order()
```



---

archive/issue_comments_057447.json:
```json
{
    "body": "<a id='comment:84'></a>x86 means x86_64 also?",
    "created_at": "2012-09-06T13:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57447",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:84'></a>x86 means x86_64 also?



---

archive/issue_comments_057448.json:
```json
{
    "body": "<a id='comment:85'></a>Yes, anything with an esp/ebp register (I'll add support for the rest later).",
    "created_at": "2012-09-06T13:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57448",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:85'></a>Yes, anything with an esp/ebp register (I'll add support for the rest later).



---

archive/issue_comments_057449.json:
```json
{
    "body": "<a id='comment:86'></a>I guess i am missing something, but that's what i get with the new patch:\n\n```\nsage: g=libgap('FreeGroup(2)')\ngap: halfing pool size.\nsage: (a,b)=g.GeneratorsOfGroup()\nsage: h=g/libgap([a^2,b^2,a*b])       \nsage: h\n<fp group on the generators [ f1, f2 ]>\nsage: x=h.GeneratorsOfGroup()[0]\nsage: x\nf1\nsage: x^2\nf1^2\nsage: x^3\nf1^3\nsage: x.Order()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-5.2/<ipython console> in <module>()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:8003)()\n\n/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7576)()\n\nValueError: libGAP: Segmentation fault\n\n```",
    "created_at": "2012-09-06T16:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57449",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:86'></a>I guess i am missing something, but that's what i get with the new patch:

```
sage: g=libgap('FreeGroup(2)')
gap: halfing pool size.
sage: (a,b)=g.GeneratorsOfGroup()
sage: h=g/libgap([a^2,b^2,a*b])       
sage: h
<fp group on the generators [ f1, f2 ]>
sage: x=h.GeneratorsOfGroup()[0]
sage: x
f1
sage: x^2
f1^2
sage: x^3
f1^3
sage: x.Order()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-5.2/<ipython console> in <module>()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:8003)()

/home/mmarco/sage-5.2/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7576)()

ValueError: libGAP: Segmentation fault

```



---

archive/issue_comments_057450.json:
```json
{
    "body": "<a id='comment:87'></a>Great work! I noticed one thing in keeping references in `owned_objects`. The way I read the code, it's a list that any new object gets appended to (and index is stored). Upon deletion of the sage wrapper of the object, the particular location in the `owned_objects` list is unbound. Doesn't that mean that the owned_object list can grow in an unbounded way even when only a bounded number of references to gap_objects is held? i.e., wouldn't something like\n\n```\ni = 0\na = GapElement(i)\nwhile True:\n    i+=1\n    b = a\n    a = GapElement(i)\n```\nlet memory balloon?\nFor ecllib I ended up keeping a doubly linked list, since insertions and deletions are O(1), at the cost of a largish constant in memory overhead.\n\nAlternatives include inserting in the first unbound spot of the list, which has the wrong complexity for object creation unless you keep a free list. You could keep a stack or a deque of free spots. I don't know if a FIFO or LIFO strategy would lead to better opportunities to shorten the reference list.",
    "created_at": "2012-09-06T17:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57450",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:87'></a>Great work! I noticed one thing in keeping references in `owned_objects`. The way I read the code, it's a list that any new object gets appended to (and index is stored). Upon deletion of the sage wrapper of the object, the particular location in the `owned_objects` list is unbound. Doesn't that mean that the owned_object list can grow in an unbounded way even when only a bounded number of references to gap_objects is held? i.e., wouldn't something like

```
i = 0
a = GapElement(i)
while True:
    i+=1
    b = a
    a = GapElement(i)
```
let memory balloon?
For ecllib I ended up keeping a doubly linked list, since insertions and deletions are O(1), at the cost of a largish constant in memory overhead.

Alternatives include inserting in the first unbound spot of the list, which has the wrong complexity for object creation unless you keep a free list. You could keep a stack or a deque of free spots. I don't know if a FIFO or LIFO strategy would lead to better opportunities to shorten the reference list.



---

archive/issue_comments_057451.json:
```json
{
    "body": "<a id='comment:88'></a>Miguel: the \"halfing pool size\" means that GAP can't allocate its 4gb pool (or so). I suppose thats the issue here, will try to investigate.\n\nNils: I know, though it is only a pointer... Originally I was using GAP records (dictionaries/hashes), but back then I didn't understand some of the subtle points of how GAP works with them so I replaced it with the simplest possibility. I'm actually thinking that the best solution would be to add a hook to the garbage collector so we can directly force objects alive.",
    "created_at": "2012-09-06T18:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57451",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:88'></a>Miguel: the "halfing pool size" means that GAP can't allocate its 4gb pool (or so). I suppose thats the issue here, will try to investigate.

Nils: I know, though it is only a pointer... Originally I was using GAP records (dictionaries/hashes), but back then I didn't understand some of the subtle points of how GAP works with them so I replaced it with the simplest possibility. I'm actually thinking that the best solution would be to add a hook to the garbage collector so we can directly force objects alive.



---

archive/issue_comments_057452.json:
```json
{
    "body": "<a id='comment:89'></a>It's strange, since i have plenty of RAM available.",
    "created_at": "2012-09-06T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57452",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:89'></a>It's strange, since i have plenty of RAM available.



---

archive/issue_comments_057453.json:
```json
{
    "body": "<a id='comment:90'></a>I can manually force the \"halfing pool size\" message by limiting the virtual mem size (in the followng example to 5gb which is a bit more than half of what GAP wants to take on x86 --- note that this is purely virtual and not used unless you actually do a huge computation)\n\n```\n[vbraun@volker-desktop ~]$ ulimit -v 5000000\n[vbraun@volker-desktop ~]$ sage -c 'print libgap(1)'\ngap: halfing pool size.\n1\n```\nThough still all doctests pass and I don't see Miguel's segfault. Can you post a backtrace? (`sage -gdb` and type 'bt' at the gdb prompt after the segfault)",
    "created_at": "2012-09-07T21:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57453",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:90'></a>I can manually force the "halfing pool size" message by limiting the virtual mem size (in the followng example to 5gb which is a bit more than half of what GAP wants to take on x86 --- note that this is purely virtual and not used unless you actually do a huge computation)

```
[vbraun@volker-desktop ~]$ ulimit -v 5000000
[vbraun@volker-desktop ~]$ sage -c 'print libgap(1)'
gap: halfing pool size.
1
```
Though still all doctests pass and I don't see Miguel's segfault. Can you post a backtrace? (`sage -gdb` and type 'bt' at the gdb prompt after the segfault)



---

archive/issue_comments_057454.json:
```json
{
    "body": "<a id='comment:91'></a>\n```\nmmarco@neumann ~/sage-5.2 $ ./sage -gdb\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n/home/mmarco/sage-5.2/local/bin/sage-ipython\nGNU gdb (Gentoo 7.3.1 p2) 7.3.1\nCopyright (C) 2011 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-pc-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://bugs.gentoo.org/>...\nReading symbols from /home/mmarco/sage-5.2/local/bin/python...done.\n[Thread debugging using libthread_db enabled]\nPython 2.7.3 (default, Aug 30 2012, 14:13:06) \n[GCC 4.5.4] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n| Sage Version 5.2, Release Date: 2012-07-25                         |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nLoading Sage library. Current Mercurial branch is: libgap4\nsage: \nsage: g=libgap('FreeGroup(2)')\nsage: (a,b)=g.GeneratorsOfGroup()\nsage: h=g/libgap([a^2,b^2,a*b])\nsage: x=h.GeneratorsOfGroup()[0]\nsage: x.Order()\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fffcb4d15c5 in libGAP_GenStackFuncBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n(gdb) bt\n#0  0x00007fffcb4d15c5 in libGAP_GenStackFuncBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#1  0x00007fffcb4d1c2f in libGAP_CollectBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#2  0x00007fffcb4d0fda in libGAP_NewBag () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#3  0x00007fffcb4412df in libGAP_SwitchToNewLvars () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#4  0x00007fffcb447ea9 in libGAP_DoExecFunc2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#5  0x00007fffcb445555 in libGAP_EvalFunccall2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#6  0x00007fffcb34c9c4 in libGAP_ExecAssLVar () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#7  0x00007fffcb45f8b1 in libGAP_ExecSeqStat4 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#8  0x00007fffcb460a61 in libGAP_ExecFor () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#9  0x00007fffcb46366d in libGAP_ExecRepeat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#10 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#11 0x00007fffcb460151 in libGAP_ExecIf () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#12 0x00007fffcb460a61 in libGAP_ExecFor () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#13 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#14 0x00007fffcb4634e8 in libGAP_ExecRepeat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#15 0x00007fffcb45fd27 in libGAP_ExecSeqStat6 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#16 0x00007fffcb460151 in libGAP_ExecIf () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#17 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#18 0x00007fffcb46006d in libGAP_ExecSeqStat7 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#19 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#20 0x00007fffcb359b16 in libGAP_DoWrap1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#21 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#22 0x00007fffcb34ccf8 in libGAP_ExecAssLVar02 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#23 0x00007fffcb460567 in libGAP_ExecIfElifElse () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#24 0x00007fffcb45fcbb in libGAP_ExecSeqStat6 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#25 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#26 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#27 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#28 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#29 0x00007fffcb3ec5cb in libGAP_EvalNe () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#30 0x00007fffcb46049d in libGAP_ExecIfElifElse () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#31 0x00007fffcb45f5eb in libGAP_ExecSeqStat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#32 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#33 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#34 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#35 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#36 0x00007fffcb4451e3 in libGAP_EvalFunccall2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#37 0x00007fffcb464adf in libGAP_ExecReturnObj () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#38 0x00007fffcb45f654 in libGAP_ExecSeqStat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#39 0x00007fffcb447f0b in libGAP_DoExecFunc2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#40 0x00007fffcb41afe0 in libGAP_DoOperation2Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#41 0x00007fffcb2e792c in libGAP_EqObject () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#42 0x00007fffcb3ec77b in libGAP_EvalNe () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#43 0x00007fffcb463257 in libGAP_ExecWhile2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#44 0x00007fffcb460004 in libGAP_ExecSeqStat7 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#45 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#46 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#47 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0\n#48 0x00007fffcb074e7d in __pyx_pf_4sage_4libs_3gap_7element_19GapElement_Function_2__call__ (__pyx_v_self=0x49651b0, __pyx_v_args=0x7ffff7ed4f50) at sage/libs/gap/element.c:7201\n#49 0x00007fffcb0763a8 in __pyx_pw_4sage_4libs_3gap_7element_19GapElement_Function_3__call__ (__pyx_v_self=0x49651b0, __pyx_args=0x7ffff7ed4f50, __pyx_kwds=<optimized out>) at sage/libs/gap/element.c:6998\n#50 0x00007ffff7a41913 in PyObject_Call (func=0x494de90, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529\n#51 0x00007ffff7ae7c57 in PyEval_CallObjectWithKeywords (func=0x494de90, arg=0x7ffff7ed4f50, kw=<optimized out>) at Python/ceval.c:3890\n#52 0x00007ffff7a5ce2b in wrapperdescr_call (descr=<optimized out>, args=0x7ffff7ed4f50, kwds=0x0) at Objects/descrobject.c:306\n#53 0x00007ffff7a41913 in PyObject_Call (func=0x3287b40, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529\n#54 0x00007fffcb06af0d in __pyx_pf_4sage_4libs_3gap_7element_22GapElement_MethodProxy___call__ (__pyx_v_args=0x7ffff7f78050, __pyx_v_self=0x49651b0) at sage/libs/gap/element.c:8003\n#55 __pyx_pw_4sage_4libs_3gap_7element_22GapElement_MethodProxy_1__call__ (__pyx_v_self=0x49651b0, __pyx_args=0x7ffff7f78050, __pyx_kwds=<optimized out>) at sage/libs/gap/element.c:7895\n#56 0x00007ffff7a41913 in PyObject_Call (func=0x49651b0, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529\n#57 0x00007ffff7aed0ee in do_call (nk=<optimized out>, na=<optimized out>, pp_stack=0x7fffffffbff0, func=0x49651b0) at Python/ceval.c:4239\n#58 call_function (oparg=<optimized out>, pp_stack=0x7fffffffbff0) at Python/ceval.c:4044\n#59 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#60 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x4953830, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=0, kws=0x0, kwcount=0, defs=0x0, defcount=0, closure=0x0)\n    at Python/ceval.c:3253\n#61 0x00007ffff7aef762 in PyEval_EvalCode (co=<optimized out>, globals=<optimized out>, locals=<optimized out>) at Python/ceval.c:667\n#62 0x00007ffff7aeeb83 in exec_statement (locals=0xbc3c80, globals=0xbc3c80, prog=<optimized out>, f=0x4438bd0) at Python/ceval.c:4718\n#63 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:1880\n#64 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed9b0, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0x4998780, kwcount=0, defs=0x0, defcount=0, closure=0x0)\n    at Python/ceval.c:3253\n#65 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffc460, func=0xb7d7d0) at Python/ceval.c:4117\n#66 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc460) at Python/ceval.c:4042\n#67 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#68 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed930, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=3, kws=0x49a6560, kwcount=0, defs=0xb7b1d0, defcount=2, closure=0x0)\n    at Python/ceval.c:3253\n#69 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=3, n=<optimized out>, pp_stack=0x7fffffffc680, func=0xb7d758) at Python/ceval.c:4117\n#70 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc680) at Python/ceval.c:4042\n#71 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#72 0x00007ffff7aeed6a in fast_function (nk=<optimized out>, na=<optimized out>, n=<optimized out>, pp_stack=0x7fffffffc7f0, func=0xb7d848) at Python/ceval.c:4107\n#73 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc7f0) at Python/ceval.c:4042\n#74 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#75 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed4b0, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0xbe59e8, kwcount=0, defs=0xb72c28, defcount=1, closure=0x0)\n    at Python/ceval.c:3253\n#76 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffca10, func=0xb7d398) at Python/ceval.c:4117\n#77 call_function (oparg=<optimized out>, pp_stack=0x7fffffffca10) at Python/ceval.c:4042\n#78 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#79 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed030, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0xbef170, kwcount=0, defs=0xb72be8, defcount=1, closure=0x0)\n    at Python/ceval.c:3253\n#80 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffcc30, func=0xb7d0c8) at Python/ceval.c:4117\n#81 call_function (oparg=<optimized out>, pp_stack=0x7fffffffcc30) at Python/ceval.c:4042\n#82 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#83 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x7ffff7eeac30, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=1, kws=0x6f2200, kwcount=2, defs=0xa30578, defcount=2, \n    closure=0x0) at Python/ceval.c:3253\n#84 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=1, n=<optimized out>, pp_stack=0x7fffffffce50, func=0xb85a28) at Python/ceval.c:4117\n#85 call_function (oparg=<optimized out>, pp_stack=0x7fffffffce50) at Python/ceval.c:4042\n#86 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666\n#87 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x7ffff7f2ab30, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=0, kws=0x0, kwcount=0, defs=0x0, defcount=0, closure=0x0)\n    at Python/ceval.c:3253\n#88 0x00007ffff7aef762 in PyEval_EvalCode (co=<optimized out>, globals=<optimized out>, locals=<optimized out>) at Python/ceval.c:667\n#89 0x00007ffff7b11750 in run_mod (arena=0x623430, flags=0x7fffffffd170, locals=0x641160, globals=0x641160, filename=<optimized out>, mod=0x6f1ba0) at Python/pythonrun.c:1353\n#90 PyRun_FileExFlags (fp=0x6d70a0, filename=<optimized out>, start=<optimized out>, globals=0x641160, locals=0x641160, closeit=0, flags=0x7fffffffd170) at Python/pythonrun.c:1339\n#91 0x00007ffff7b1225f in PyRun_SimpleFileExFlags (fp=0x6d70a0, filename=0x7fffffffe919 \"/home/mmarco/sage-5.2/local/bin/sage-ipython\", closeit=0, flags=0x7fffffffd170) at Python/pythonrun.c:943\n#92 0x00007ffff7b27976 in RunStartupFile (cf=0x7fffffffd170) at Modules/main.c:153\n#93 Py_Main (argc=<optimized out>, argv=0x7fffffffd298) at Modules/main.c:593\n#94 0x00007ffff6de222d in __libc_start_main () from /lib64/libc.so.6\n#95 0x00000000004006e9 in _start ()\n\n```",
    "created_at": "2012-09-08T01:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57454",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:91'></a>
```
mmarco@neumann ~/sage-5.2 $ ./sage -gdb
----------------------------------------------------------------------
----------------------------------------------------------------------
/home/mmarco/sage-5.2/local/bin/sage-ipython
GNU gdb (Gentoo 7.3.1 p2) 7.3.1
Copyright (C) 2011 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-pc-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.gentoo.org/>...
Reading symbols from /home/mmarco/sage-5.2/local/bin/python...done.
[Thread debugging using libthread_db enabled]
Python 2.7.3 (default, Aug 30 2012, 14:13:06) 
[GCC 4.5.4] on linux2
Type "help", "copyright", "credits" or "license" for more information.
| Sage Version 5.2, Release Date: 2012-07-25                         |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
Loading Sage library. Current Mercurial branch is: libgap4
sage: 
sage: g=libgap('FreeGroup(2)')
sage: (a,b)=g.GeneratorsOfGroup()
sage: h=g/libgap([a^2,b^2,a*b])
sage: x=h.GeneratorsOfGroup()[0]
sage: x.Order()

Program received signal SIGSEGV, Segmentation fault.
0x00007fffcb4d15c5 in libGAP_GenStackFuncBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
(gdb) bt
#0  0x00007fffcb4d15c5 in libGAP_GenStackFuncBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#1  0x00007fffcb4d1c2f in libGAP_CollectBags () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#2  0x00007fffcb4d0fda in libGAP_NewBag () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#3  0x00007fffcb4412df in libGAP_SwitchToNewLvars () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#4  0x00007fffcb447ea9 in libGAP_DoExecFunc2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#5  0x00007fffcb445555 in libGAP_EvalFunccall2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#6  0x00007fffcb34c9c4 in libGAP_ExecAssLVar () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#7  0x00007fffcb45f8b1 in libGAP_ExecSeqStat4 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#8  0x00007fffcb460a61 in libGAP_ExecFor () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#9  0x00007fffcb46366d in libGAP_ExecRepeat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#10 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#11 0x00007fffcb460151 in libGAP_ExecIf () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#12 0x00007fffcb460a61 in libGAP_ExecFor () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#13 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#14 0x00007fffcb4634e8 in libGAP_ExecRepeat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#15 0x00007fffcb45fd27 in libGAP_ExecSeqStat6 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#16 0x00007fffcb460151 in libGAP_ExecIf () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#17 0x00007fffcb45f56a in libGAP_ExecSeqStat () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#18 0x00007fffcb46006d in libGAP_ExecSeqStat7 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#19 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#20 0x00007fffcb359b16 in libGAP_DoWrap1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#21 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#22 0x00007fffcb34ccf8 in libGAP_ExecAssLVar02 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#23 0x00007fffcb460567 in libGAP_ExecIfElifElse () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#24 0x00007fffcb45fcbb in libGAP_ExecSeqStat6 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#25 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#26 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#27 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#28 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#29 0x00007fffcb3ec5cb in libGAP_EvalNe () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#30 0x00007fffcb46049d in libGAP_ExecIfElifElse () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#31 0x00007fffcb45f5eb in libGAP_ExecSeqStat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#32 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#33 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#34 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#35 0x00007fffcb445067 in libGAP_EvalFunccall1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#36 0x00007fffcb4451e3 in libGAP_EvalFunccall2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#37 0x00007fffcb464adf in libGAP_ExecReturnObj () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#38 0x00007fffcb45f654 in libGAP_ExecSeqStat2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#39 0x00007fffcb447f0b in libGAP_DoExecFunc2args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#40 0x00007fffcb41afe0 in libGAP_DoOperation2Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#41 0x00007fffcb2e792c in libGAP_EqObject () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#42 0x00007fffcb3ec77b in libGAP_EvalNe () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#43 0x00007fffcb463257 in libGAP_ExecWhile2 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#44 0x00007fffcb460004 in libGAP_ExecSeqStat7 () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#45 0x00007fffcb447e08 in libGAP_DoExecFunc1args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#46 0x00007fffcb41ac00 in libGAP_DoOperation1Args () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#47 0x00007fffcb422ad4 in libGAP_DoAttribute () from /home/mmarco/sage-5.2/local/lib/libgap.so.0
#48 0x00007fffcb074e7d in __pyx_pf_4sage_4libs_3gap_7element_19GapElement_Function_2__call__ (__pyx_v_self=0x49651b0, __pyx_v_args=0x7ffff7ed4f50) at sage/libs/gap/element.c:7201
#49 0x00007fffcb0763a8 in __pyx_pw_4sage_4libs_3gap_7element_19GapElement_Function_3__call__ (__pyx_v_self=0x49651b0, __pyx_args=0x7ffff7ed4f50, __pyx_kwds=<optimized out>) at sage/libs/gap/element.c:6998
#50 0x00007ffff7a41913 in PyObject_Call (func=0x494de90, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529
#51 0x00007ffff7ae7c57 in PyEval_CallObjectWithKeywords (func=0x494de90, arg=0x7ffff7ed4f50, kw=<optimized out>) at Python/ceval.c:3890
#52 0x00007ffff7a5ce2b in wrapperdescr_call (descr=<optimized out>, args=0x7ffff7ed4f50, kwds=0x0) at Objects/descrobject.c:306
#53 0x00007ffff7a41913 in PyObject_Call (func=0x3287b40, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529
#54 0x00007fffcb06af0d in __pyx_pf_4sage_4libs_3gap_7element_22GapElement_MethodProxy___call__ (__pyx_v_args=0x7ffff7f78050, __pyx_v_self=0x49651b0) at sage/libs/gap/element.c:8003
#55 __pyx_pw_4sage_4libs_3gap_7element_22GapElement_MethodProxy_1__call__ (__pyx_v_self=0x49651b0, __pyx_args=0x7ffff7f78050, __pyx_kwds=<optimized out>) at sage/libs/gap/element.c:7895
#56 0x00007ffff7a41913 in PyObject_Call (func=0x49651b0, arg=<optimized out>, kw=<optimized out>) at Objects/abstract.c:2529
#57 0x00007ffff7aed0ee in do_call (nk=<optimized out>, na=<optimized out>, pp_stack=0x7fffffffbff0, func=0x49651b0) at Python/ceval.c:4239
#58 call_function (oparg=<optimized out>, pp_stack=0x7fffffffbff0) at Python/ceval.c:4044
#59 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#60 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x4953830, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=0, kws=0x0, kwcount=0, defs=0x0, defcount=0, closure=0x0)
    at Python/ceval.c:3253
#61 0x00007ffff7aef762 in PyEval_EvalCode (co=<optimized out>, globals=<optimized out>, locals=<optimized out>) at Python/ceval.c:667
#62 0x00007ffff7aeeb83 in exec_statement (locals=0xbc3c80, globals=0xbc3c80, prog=<optimized out>, f=0x4438bd0) at Python/ceval.c:4718
#63 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:1880
#64 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed9b0, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0x4998780, kwcount=0, defs=0x0, defcount=0, closure=0x0)
    at Python/ceval.c:3253
#65 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffc460, func=0xb7d7d0) at Python/ceval.c:4117
#66 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc460) at Python/ceval.c:4042
#67 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#68 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed930, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=3, kws=0x49a6560, kwcount=0, defs=0xb7b1d0, defcount=2, closure=0x0)
    at Python/ceval.c:3253
#69 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=3, n=<optimized out>, pp_stack=0x7fffffffc680, func=0xb7d758) at Python/ceval.c:4117
#70 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc680) at Python/ceval.c:4042
#71 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#72 0x00007ffff7aeed6a in fast_function (nk=<optimized out>, na=<optimized out>, n=<optimized out>, pp_stack=0x7fffffffc7f0, func=0xb7d848) at Python/ceval.c:4107
#73 call_function (oparg=<optimized out>, pp_stack=0x7fffffffc7f0) at Python/ceval.c:4042
#74 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#75 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed4b0, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0xbe59e8, kwcount=0, defs=0xb72c28, defcount=1, closure=0x0)
    at Python/ceval.c:3253
#76 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffca10, func=0xb7d398) at Python/ceval.c:4117
#77 call_function (oparg=<optimized out>, pp_stack=0x7fffffffca10) at Python/ceval.c:4042
#78 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#79 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0xaed030, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=2, kws=0xbef170, kwcount=0, defs=0xb72be8, defcount=1, closure=0x0)
    at Python/ceval.c:3253
#80 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=2, n=<optimized out>, pp_stack=0x7fffffffcc30, func=0xb7d0c8) at Python/ceval.c:4117
#81 call_function (oparg=<optimized out>, pp_stack=0x7fffffffcc30) at Python/ceval.c:4042
#82 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#83 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x7ffff7eeac30, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=1, kws=0x6f2200, kwcount=2, defs=0xa30578, defcount=2, 
    closure=0x0) at Python/ceval.c:3253
#84 0x00007ffff7aed777 in fast_function (nk=<optimized out>, na=1, n=<optimized out>, pp_stack=0x7fffffffce50, func=0xb85a28) at Python/ceval.c:4117
#85 call_function (oparg=<optimized out>, pp_stack=0x7fffffffce50) at Python/ceval.c:4042
#86 PyEval_EvalFrameEx (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2666
#87 0x00007ffff7aef63d in PyEval_EvalCodeEx (co=0x7ffff7f2ab30, globals=<optimized out>, locals=<optimized out>, args=<optimized out>, argcount=0, kws=0x0, kwcount=0, defs=0x0, defcount=0, closure=0x0)
    at Python/ceval.c:3253
#88 0x00007ffff7aef762 in PyEval_EvalCode (co=<optimized out>, globals=<optimized out>, locals=<optimized out>) at Python/ceval.c:667
#89 0x00007ffff7b11750 in run_mod (arena=0x623430, flags=0x7fffffffd170, locals=0x641160, globals=0x641160, filename=<optimized out>, mod=0x6f1ba0) at Python/pythonrun.c:1353
#90 PyRun_FileExFlags (fp=0x6d70a0, filename=<optimized out>, start=<optimized out>, globals=0x641160, locals=0x641160, closeit=0, flags=0x7fffffffd170) at Python/pythonrun.c:1339
#91 0x00007ffff7b1225f in PyRun_SimpleFileExFlags (fp=0x6d70a0, filename=0x7fffffffe919 "/home/mmarco/sage-5.2/local/bin/sage-ipython", closeit=0, flags=0x7fffffffd170) at Python/pythonrun.c:943
#92 0x00007ffff7b27976 in RunStartupFile (cf=0x7fffffffd170) at Modules/main.c:153
#93 Py_Main (argc=<optimized out>, argv=0x7fffffffd298) at Modules/main.c:593
#94 0x00007ffff6de222d in __libc_start_main () from /lib64/libc.so.6
#95 0x00000000004006e9 in _start ()

```



---

archive/issue_comments_057455.json:
```json
{
    "body": "<a id='comment:92'></a>Can you try the new spkg + patch? I think I tracked down the bug ;-)",
    "created_at": "2012-09-09T20:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57455",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:92'></a>Can you try the new spkg + patch? I think I tracked down the bug ;-)



---

archive/issue_events_015051.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2012-09-10T09:24:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15051"
}
```



---

archive/issue_comments_057456.json:
```json
{
    "body": "<a id='comment:93'></a>I am attending a conference this week, so i will have little time. On top of that, i don't have my computer with me. I will try to find time to work remotelly on that, but i cannot ensure when that will happen.",
    "created_at": "2012-09-10T09:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57456",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:93'></a>I am attending a conference this week, so i will have little time. On top of that, i don't have my computer with me. I will try to find time to work remotelly on that, but i cannot ensure when that will happen.



---

archive/issue_comments_057457.json:
```json
{
    "body": "<a id='comment:94'></a>I finally could test it. It seems to work fine now. Great work!\n\nI don't have the necessary skills to review the code, but i can go on testing it.",
    "created_at": "2012-09-10T21:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57457",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:94'></a>I finally could test it. It seems to work fine now. Great work!

I don't have the necessary skills to review the code, but i can go on testing it.



---

archive/issue_comments_057458.json:
```json
{
    "body": "<a id='comment:95'></a>Do you plan  to implement comparison of libgap objects? I am trying to port my fpgroups code to libgap, and doctests fail because of this.",
    "created_at": "2012-09-21T18:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57458",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:95'></a>Do you plan  to implement comparison of libgap objects? I am trying to port my fpgroups code to libgap, and doctests fail because of this.



---

archive/issue_comments_057459.json:
```json
{
    "body": "<a id='comment:96'></a>OK I'll try to update everything to gap-4.5.6 today and add comparison.",
    "created_at": "2012-09-22T09:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57459",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:96'></a>OK I'll try to update everything to gap-4.5.6 today and add comparison.



---

archive/issue_comments_057460.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n To try it out,\n-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.5.spkg from #13211\n-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.5.spkg\n+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211\n+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg\n * Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n \n \n``````\n",
    "created_at": "2012-09-22T16:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57460",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
 To try it out,
-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.5.spkg from #13211
-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.5.spkg
+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211
+* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg
 * Apply [attachment:trac_6391_libGAP.patch] to the Sage library
 
 
``````




---

archive/issue_comments_057461.json:
```json
{
    "body": "<a id='comment:97'></a>Ok, done. Comparison works now:\n\n```\nsage: libgap('test') == libgap.Concatenation(libgap('te'), libgap('st'))\nTrue\n```\n\nI made one incompatible change: since `libgap` is the parent to all gap elements, it should do element construction for strings:\n\n```\nsage: libgap('1+1')\n\"1+1\"\nsage: type(_)\n<type 'sage.libs.gap.element.GapElement_String'>\n```\nTo evaluate a GAP command in a string, you now have to use\n\n```\nsage: libgap.eval('1+1')\n2\n```\nSince we aim at wrapping more of GAP one expects that the `libgap.eval` method becomes less useful over time.",
    "created_at": "2012-09-22T16:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57461",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:97'></a>Ok, done. Comparison works now:

```
sage: libgap('test') == libgap.Concatenation(libgap('te'), libgap('st'))
True
```

I made one incompatible change: since `libgap` is the parent to all gap elements, it should do element construction for strings:

```
sage: libgap('1+1')
"1+1"
sage: type(_)
<type 'sage.libs.gap.element.GapElement_String'>
```
To evaluate a GAP command in a string, you now have to use

```
sage: libgap.eval('1+1')
2
```
Since we aim at wrapping more of GAP one expects that the `libgap.eval` method becomes less useful over time.



---

archive/issue_comments_057462.json:
```json
{
    "body": "<a id='comment:98'></a>PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.\n\nI think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)",
    "created_at": "2012-09-22T21:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57462",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:98'></a>PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.

I think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)



---

archive/issue_comments_057463.json:
```json
{
    "body": "<a id='comment:99'></a>Replying to [vbraun](#comment%3A98):\n> PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.\n> \n> I think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)\n> \n\nWell, yes 8-/. \n\nWhat about eliminating a hardcoded path in `sage/libs/gap/test/main.c` ?\nIs it possible to test this, via a Cython wrapper, say? (It's also easier to test this in sage-check script).",
    "created_at": "2012-09-23T09:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57463",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:99'></a>Replying to [vbraun](#comment%3A98):
> PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.
> 
> I think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)
> 

Well, yes 8-/. 

What about eliminating a hardcoded path in `sage/libs/gap/test/main.c` ?
Is it possible to test this, via a Cython wrapper, say? (It's also easier to test this in sage-check script).



---

archive/issue_comments_057464.json:
```json
{
    "body": "<a id='comment:0'></a>I see several messages `halving pool size` if I do `sage: libgap?` immediately after starting Sage.\nThis looks like some debugging printout getting in the way.",
    "created_at": "2012-09-23T09:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57464",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>I see several messages `halving pool size` if I do `sage: libgap?` immediately after starting Sage.
This looks like some debugging printout getting in the way.



---

archive/issue_comments_057465.json:
```json
{
    "body": "<a id='comment:101'></a>Replying to [dimpase](#comment%3A99):\n> Replying to [vbraun](#comment%3A98):\n> > PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.\n> > \n> > I think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)\n> > \n\n> Well, yes 8-/. \n> \n> What about eliminating a hardcoded path in `sage/libs/gap/test/main.c` ?\n\n\nI cannot guess the correct value of this relative to `$SAGE_LOCAL` or `$SAGE_ROOT`. In fact it should be easy to have this build and run from Sage shell prompt (i.e. `sage -sh`), then these hardcoded paths in Makefile and in main.c are not necessary. It would be great to have this fixed.\n\nThen hooking it up on sage-check becomes trivial, too.",
    "created_at": "2012-09-23T10:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57465",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:101'></a>Replying to [dimpase](#comment%3A99):
> Replying to [vbraun](#comment%3A98):
> > PS: I also changed the refcounting system, now its hooking directly into GASMAN to keep objects alive.
> > 
> > I think we should get this into Sage for real, now. Dima, are you up to another reviewing challenge? :-)
> > 

> Well, yes 8-/. 
> 
> What about eliminating a hardcoded path in `sage/libs/gap/test/main.c` ?


I cannot guess the correct value of this relative to `$SAGE_LOCAL` or `$SAGE_ROOT`. In fact it should be easy to have this build and run from Sage shell prompt (i.e. `sage -sh`), then these hardcoded paths in Makefile and in main.c are not necessary. It would be great to have this fixed.

Then hooking it up on sage-check becomes trivial, too.



---

archive/issue_comments_057466.json:
```json
{
    "body": "<a id='comment:2'></a>the new libgap spkg needs to be mentioned in `SAGE_ROOT/spkg/standard/deps`, as it depends on GAP, but this is not done.\nAlso, libgap needs to be mentioned in `SAGE_ROOT/spkg/install`, AFAIK.",
    "created_at": "2012-09-23T11:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57466",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>the new libgap spkg needs to be mentioned in `SAGE_ROOT/spkg/standard/deps`, as it depends on GAP, but this is not done.
Also, libgap needs to be mentioned in `SAGE_ROOT/spkg/install`, AFAIK.



---

archive/issue_comments_057467.json:
```json
{
    "body": "<a id='comment:3'></a>on the spkg: it has two (!) upstream-gap subdirectories. Does one need them both? \n\nI don't understand whether MPIR is used as the replacement of GMP here, or not.\n(according to spkg-install it looks as if it uses MPIR, actually).\n(Last time I checked (well, long ago) GAP didn't run with MPIR; actually, I was too busy to find out how it is now working with the new GAP spkg; does it build its own GMP?)",
    "created_at": "2012-09-23T11:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57467",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>on the spkg: it has two (!) upstream-gap subdirectories. Does one need them both? 

I don't understand whether MPIR is used as the replacement of GMP here, or not.
(according to spkg-install it looks as if it uses MPIR, actually).
(Last time I checked (well, long ago) GAP didn't run with MPIR; actually, I was too busy to find out how it is now working with the new GAP spkg; does it build its own GMP?)



---

archive/issue_comments_057468.json:
```json
{
    "body": "<a id='comment:4'></a>The `sage/libs/gap/test/main.c` is only for instructional purposes, it demonstrates how to build a standalone binary so you can run libGAP under a debugger/valgrind without Sage. It doesn't exercise anything thats not already in doctests. \n\nOne could add a `spkg-check` to test `src/test` in the spkg, but they again don't exercise anything thats not covered by libGAP doctests.\n\nI've removed the upstream-gap-x.y.z directories from the spkg, the `make-spkg.sh` script copied them there accidentally.\n\nGap links against MPIR just fine, the only issue is with a version check that I reported here: https://groups.google.com/d/topic/mpir-devel/X48SfwGkSd8/discussion. This is why the `spkg-install` adds `-D__GMP_MP_RELEASE=50002` to the `CFLAGS`:\n\n```\n(sage-sh) vbraun@volker-desktop:spkg$ ldd ~/Sage/sage/local/lib/libgap.so\n\tlinux-vdso.so.1 =>  (0x00007fff8ebff000)\n\tlibgmp.so.7 => /home/vbraun/opt/sage-5.4.beta1/local/lib/libgmp.so.7 (0x00007f8a82885000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f8a824a9000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00000036c4000000)\n```",
    "created_at": "2012-09-23T13:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57468",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>The `sage/libs/gap/test/main.c` is only for instructional purposes, it demonstrates how to build a standalone binary so you can run libGAP under a debugger/valgrind without Sage. It doesn't exercise anything thats not already in doctests. 

One could add a `spkg-check` to test `src/test` in the spkg, but they again don't exercise anything thats not covered by libGAP doctests.

I've removed the upstream-gap-x.y.z directories from the spkg, the `make-spkg.sh` script copied them there accidentally.

Gap links against MPIR just fine, the only issue is with a version check that I reported here: https://groups.google.com/d/topic/mpir-devel/X48SfwGkSd8/discussion. This is why the `spkg-install` adds `-D__GMP_MP_RELEASE=50002` to the `CFLAGS`:

```
(sage-sh) vbraun@volker-desktop:spkg$ ldd ~/Sage/sage/local/lib/libgap.so
	linux-vdso.so.1 =>  (0x00007fff8ebff000)
	libgmp.so.7 => /home/vbraun/opt/sage-5.4.beta1/local/lib/libgmp.so.7 (0x00007f8a82885000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f8a824a9000)
	/lib64/ld-linux-x86-64.so.2 (0x00000036c4000000)
```



---

archive/issue_comments_057469.json:
```json
{
    "body": "<a id='comment:5'></a>I've added a patch for the root repo. I guess we need to vote on sage-devel about adding a new spkg? Though its not really new, its just an alternate version of code that we already ship.",
    "created_at": "2012-09-23T13:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57469",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>I've added a patch for the root repo. I guess we need to vote on sage-devel about adding a new spkg? Though its not really new, its just an alternate version of code that we already ship.



---

archive/issue_comments_057470.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,5 +4,5 @@\n * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211\n * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg\n * Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n+* Apply [attachment:trac_6391_libGAP_root.patch] to the root repository\n \n-\n``````\n",
    "created_at": "2012-09-23T13:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57470",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,5 +4,5 @@
 * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211
 * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg
 * Apply [attachment:trac_6391_libGAP.patch] to the Sage library
+* Apply [attachment:trac_6391_libGAP_root.patch] to the root repository
 
-
``````




---

archive/issue_comments_057471.json:
```json
{
    "body": "<a id='comment:6'></a>Spkg vote: https://groups.google.com/d/topic/sage-devel/24UhIuA5eNc/discussion",
    "created_at": "2012-09-23T13:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57471",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Spkg vote: https://groups.google.com/d/topic/sage-devel/24UhIuA5eNc/discussion



---

archive/issue_comments_057472.json:
```json
{
    "body": "<a id='comment:7'></a>Can you explain how to set up the amount of memory available for the libgap session?",
    "created_at": "2012-09-23T13:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57472",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:7'></a>Can you explain how to set up the amount of memory available for the libgap session?



---

archive/issue_comments_057473.json:
```json
{
    "body": "<a id='comment:8'></a>Nowadays GAP uses anonymous mmap to reserve a big chunk of addressing space (not physical RAM, mind you) and uses that as needed. This is the origin of the `halving pool size` message on stdout. The message is purely cosmetic, but I'll ask upstream to suppress it. It also appears on the GAP command line and has nothing to do with libGAP:\n\n```\n[vbraun@volker-desktop ~]$ sage -gap -o 16384G\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n \u2502  GAP  \u2502   http://www.gap-system.org\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Components: trans 1.0, prim 2.1, small* 1.0, id* 1.0\n Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1, TomLib 1.2.2\n Try '?help' for help. See also  '?copyright' and  '?authors'\n```\nBy default we try to acquire 16TB of addressing space, and then halving that until it succeeds:\n\n```\nTasks: 352 total,   3 running, 345 sleeping,   1 stopped,   3 zombie\nCpu(s): 13.5%us,  0.4%sy,  0.0%ni, 85.9%id,  0.0%wa,  0.2%hi,  0.0%si,  0.0%st\nMem:  32835628k total, 32140456k used,   695172k free,  1037012k buffers\nSwap: 62499996k total,   485252k used, 62014744k free, 13507248k cached\n\n  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                 \n11585 vbraun    20   0 78.2g  48m  992 S  0.0  0.2   0:00.72 gap                                                     \n```\nThe memory you can use in the gap session is limited to the pool size, but at least on 64-bit this should always be a lot.",
    "created_at": "2012-09-23T14:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57473",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Nowadays GAP uses anonymous mmap to reserve a big chunk of addressing space (not physical RAM, mind you) and uses that as needed. This is the origin of the `halving pool size` message on stdout. The message is purely cosmetic, but I'll ask upstream to suppress it. It also appears on the GAP command line and has nothing to do with libGAP:

```
[vbraun@volker-desktop ~]$ sage -gap -o 16384G
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
 âââââââââ   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 â  GAP  â   http://www.gap-system.org
 âââââââââ   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Components: trans 1.0, prim 2.1, small* 1.0, id* 1.0
 Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1, TomLib 1.2.2
 Try '?help' for help. See also  '?copyright' and  '?authors'
```
By default we try to acquire 16TB of addressing space, and then halving that until it succeeds:

```
Tasks: 352 total,   3 running, 345 sleeping,   1 stopped,   3 zombie
Cpu(s): 13.5%us,  0.4%sy,  0.0%ni, 85.9%id,  0.0%wa,  0.2%hi,  0.0%si,  0.0%st
Mem:  32835628k total, 32140456k used,   695172k free,  1037012k buffers
Swap: 62499996k total,   485252k used, 62014744k free, 13507248k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                 
11585 vbraun    20   0 78.2g  48m  992 S  0.0  0.2   0:00.72 gap                                                     
```
The memory you can use in the gap session is limited to the pool size, but at least on 64-bit this should always be a lot.



---

archive/issue_comments_057474.json:
```json
{
    "body": "<a id='comment:109'></a>Replying to [vbraun](#comment%3A104):\n> Gap links against MPIR just fine, the only issue is with a version check that I reported here: https://groups.google.com/d/topic/mpir-devel/X48SfwGkSd8/discussion. This is why the `spkg-install` adds `-D__GMP_MP_RELEASE=50002` to the `CFLAGS`:\n\n\nis there any reason for GAP being linked statically against GMP (i.e. MPIR)?\n\n```\n$sage-5.4.beta1/local/gap/latest$ ldd bin/x86_64-unknown-linux-gnu-gcc-default64/gap\n        linux-vdso.so.1 =>  (0x00007fff7c4c9000)\n        libm.so.6 => /lib/libm.so.6 (0x00007fa3e0d26000)\n        libreadline.so.6 => /lib/libreadline.so.6 (0x00007fa3e0ae2000)\n        libncurses.so.5 => /usr/lib/libncurses.so.5 (0x00007fa3e089b000)\n        libdl.so.2 => /lib/libdl.so.2 (0x00007fa3e0697000)\n        libutil.so.1 => /lib/libutil.so.1 (0x00007fa3e0494000)\n        libc.so.6 => /lib/libc.so.6 (0x00007fa3e0131000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fa3e0fc3000)\n$sage-5.4.beta1/local/gap/latest$ ../../../sage -gap\n *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n *  GAP  *   http://www.gap-system.org\n *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Components: trans 1.0, prim 2.1, small* 1.0, id* 1.0\n Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1, TomLib 1.2.2\n Try '?help' for help. See also  '?copyright' and  '?authors'\ngap> \n```",
    "created_at": "2012-09-23T15:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57474",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:109'></a>Replying to [vbraun](#comment%3A104):
> Gap links against MPIR just fine, the only issue is with a version check that I reported here: https://groups.google.com/d/topic/mpir-devel/X48SfwGkSd8/discussion. This is why the `spkg-install` adds `-D__GMP_MP_RELEASE=50002` to the `CFLAGS`:


is there any reason for GAP being linked statically against GMP (i.e. MPIR)?

```
$sage-5.4.beta1/local/gap/latest$ ldd bin/x86_64-unknown-linux-gnu-gcc-default64/gap
        linux-vdso.so.1 =>  (0x00007fff7c4c9000)
        libm.so.6 => /lib/libm.so.6 (0x00007fa3e0d26000)
        libreadline.so.6 => /lib/libreadline.so.6 (0x00007fa3e0ae2000)
        libncurses.so.5 => /usr/lib/libncurses.so.5 (0x00007fa3e089b000)
        libdl.so.2 => /lib/libdl.so.2 (0x00007fa3e0697000)
        libutil.so.1 => /lib/libutil.so.1 (0x00007fa3e0494000)
        libc.so.6 => /lib/libc.so.6 (0x00007fa3e0131000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fa3e0fc3000)
$sage-5.4.beta1/local/gap/latest$ ../../../sage -gap
 *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 *  GAP  *   http://www.gap-system.org
 *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Components: trans 1.0, prim 2.1, small* 1.0, id* 1.0
 Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1, TomLib 1.2.2
 Try '?help' for help. See also  '?copyright' and  '?authors'
gap> 
```



---

archive/issue_comments_057475.json:
```json
{
    "body": "<a id='comment:110'></a>Replying to [vbraun](#comment%3A104):\n> The `sage/libs/gap/test/main.c` is only for instructional purposes, it demonstrates how to build a standalone binary so you can run libGAP under a debugger/valgrind without Sage. It doesn't exercise anything thats not already in doctests. \n\n\nI tried it on the system I am testing libgap now, and it doesn't work (I needed to do changes --- see the patch to be attached --- to the source to make it compile, but it seems to need more, as I get suspicious warnings during compilation, and then a segfault)\n\n```\n\n(sage-sh) dima@spms-banana:test$ make main\ngcc -std=gnu99 -I/usr/local/src/sage/sage-5.4.beta1/local/include -I/usr/local/src/sage/sage-5.4.beta1/local/include/python2.6 -c -g -DGAPLOCAL=/usr/local/src/sage/sage-5.4.beta1/local/gap/latest main.c\nIn file included from main.c:10:\n/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h: In function 'libGAP_SwitchToNewLvars':\n/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:163: warning: implicit declaration of function 'libGAP_BODY_FUNC'\n/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:163: warning: cast to pointer from integer of different size\nIn file included from main.c:10:\n/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h: In function 'libGAP_SwitchToOldLVars':\n/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:205: warning: cast to pointer from integer of different size\nmain.c: In function 'eval':\nmain.c:24: warning: implicit declaration of function 'libgap_set_error'\nmain.c:26: warning: implicit declaration of function 'libGAP_ViewObjHandler'\ngcc -L/usr/local/src/sage/sage-5.4.beta1/local/lib -o main main.o -lgap -lcsage -lntl -lstdc++ -lpari -lpython2.7 -lm -lgmp\n(sage-sh) dima@spms-banana:test$ ./main\nInitialized\nInput:\n1+2+3;\nOutput:\n6\nInput:\ng:=FreeGroup(2);\nSegmentation fault\n(sage-sh) dima@spms-banana:test$ \n```",
    "created_at": "2012-09-23T15:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57475",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:110'></a>Replying to [vbraun](#comment%3A104):
> The `sage/libs/gap/test/main.c` is only for instructional purposes, it demonstrates how to build a standalone binary so you can run libGAP under a debugger/valgrind without Sage. It doesn't exercise anything thats not already in doctests. 


I tried it on the system I am testing libgap now, and it doesn't work (I needed to do changes --- see the patch to be attached --- to the source to make it compile, but it seems to need more, as I get suspicious warnings during compilation, and then a segfault)

```

(sage-sh) dima@spms-banana:test$ make main
gcc -std=gnu99 -I/usr/local/src/sage/sage-5.4.beta1/local/include -I/usr/local/src/sage/sage-5.4.beta1/local/include/python2.6 -c -g -DGAPLOCAL=/usr/local/src/sage/sage-5.4.beta1/local/gap/latest main.c
In file included from main.c:10:
/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h: In function 'libGAP_SwitchToNewLvars':
/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:163: warning: implicit declaration of function 'libGAP_BODY_FUNC'
/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:163: warning: cast to pointer from integer of different size
In file included from main.c:10:
/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h: In function 'libGAP_SwitchToOldLVars':
/usr/local/src/sage/sage-5.4.beta1/local/include/gap/vars.h:205: warning: cast to pointer from integer of different size
main.c: In function 'eval':
main.c:24: warning: implicit declaration of function 'libgap_set_error'
main.c:26: warning: implicit declaration of function 'libGAP_ViewObjHandler'
gcc -L/usr/local/src/sage/sage-5.4.beta1/local/lib -o main main.o -lgap -lcsage -lntl -lstdc++ -lpari -lpython2.7 -lm -lgmp
(sage-sh) dima@spms-banana:test$ ./main
Initialized
Input:
1+2+3;
Output:
6
Input:
g:=FreeGroup(2);
Segmentation fault
(sage-sh) dima@spms-banana:test$ 
```



---

archive/issue_comments_057476.json:
```json
{
    "body": "reviewer's patch",
    "created_at": "2012-09-23T15:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57476",
    "user": "https://github.com/dimpase"
}
```

reviewer's patch



---

archive/issue_comments_057477.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [libgaptest.patch](tarball://root/attachments/some-uuid/ticket6391/libgaptest.patch) by @vbraun created at 2012-09-23 15:32:11\n\nI don't think there is any reason for statically linking gmp other than their build system predating much of autotools...\n\nThe implicit declaration and pointer cast warnings are normal, GAP just predates ansi C :-)",
    "created_at": "2012-09-23T15:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57477",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Attachment [libgaptest.patch](tarball://root/attachments/some-uuid/ticket6391/libgaptest.patch) by @vbraun created at 2012-09-23 15:32:11

I don't think there is any reason for statically linking gmp other than their build system predating much of autotools...

The implicit declaration and pointer cast warnings are normal, GAP just predates ansi C :-)



---

archive/issue_comments_057478.json:
```json
{
    "body": "<a id='comment:112'></a>Replying to [vbraun](#comment%3A111):\n\n> The implicit declaration and pointer cast warnings are normal, GAP just predates ansi C :-)\n\n\nWell, anyhow... Could you confirm that my change of the code was OK, and this is a genuine issue?\ngdb tells me the following:\n\n```\n\ng:=FreeGroup(2);\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff75a8d0f in libGAP_RNamName ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n(gdb) bt\n#0  0x00007ffff75a8d0f in libGAP_RNamName ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#1  0x00007ffff76cb0e1 in libGAP_CallErrorInner ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#2  0x00007ffff76cb2f4 in libGAP_ErrorQuit ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#3  0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#4  0x00007ffff75b7b70 in libGAP_DoWrap2args ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#5  0x00007ffff76cb299 in libGAP_CallErrorInner ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#6  0x00007ffff76cb2f4 in libGAP_ErrorQuit ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#7  0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#8  0x00007ffff75b7b70 in libGAP_DoWrap2args ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#9  0x00007ffff76cb299 in libGAP_CallErrorInner ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#10 0x00007ffff76cb2f4 in libGAP_ErrorQuit ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#11 0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#12 0x00007ffff75b7b70 in libGAP_DoWrap2args ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#13 0x00007ffff76cb299 in libGAP_CallErrorInner ()\n   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0\n#14 0x00007ffff76cb2f4 in libGAP_ErrorQuit ()\n.....\n```\nand it keeps repeating, ad nauseum...\nThe x86_64 system runs Debian, here are the compiler specs:\n\n```\n(sage-sh) dima@spms-banana:test$ gcc -v\nUsing built-in specs.\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Debian 4.4.5-8' --with-bugurl=file:///usr/share/doc/gcc-4.4/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.4 --enable-shared --enable-multiarch --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.4 --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --with-arch-32=i586 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 4.4.5 (Debian 4.4.5-8) \n```",
    "created_at": "2012-09-23T15:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:112'></a>Replying to [vbraun](#comment%3A111):

> The implicit declaration and pointer cast warnings are normal, GAP just predates ansi C :-)


Well, anyhow... Could you confirm that my change of the code was OK, and this is a genuine issue?
gdb tells me the following:

```

g:=FreeGroup(2);

Program received signal SIGSEGV, Segmentation fault.
0x00007ffff75a8d0f in libGAP_RNamName ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
(gdb) bt
#0  0x00007ffff75a8d0f in libGAP_RNamName ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#1  0x00007ffff76cb0e1 in libGAP_CallErrorInner ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#2  0x00007ffff76cb2f4 in libGAP_ErrorQuit ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#3  0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#4  0x00007ffff75b7b70 in libGAP_DoWrap2args ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#5  0x00007ffff76cb299 in libGAP_CallErrorInner ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#6  0x00007ffff76cb2f4 in libGAP_ErrorQuit ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#7  0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#8  0x00007ffff75b7b70 in libGAP_DoWrap2args ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#9  0x00007ffff76cb299 in libGAP_CallErrorInner ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#10 0x00007ffff76cb2f4 in libGAP_ErrorQuit ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#11 0x00007ffff757b8df in libGAP_ErrorMustHaveAssObjHandler ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#12 0x00007ffff75b7b70 in libGAP_DoWrap2args ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#13 0x00007ffff76cb299 in libGAP_CallErrorInner ()
   from /usr/local/src/sage/sage-5.4.beta1/local/lib/libgap.so.0
#14 0x00007ffff76cb2f4 in libGAP_ErrorQuit ()
.....
```
and it keeps repeating, ad nauseum...
The x86_64 system runs Debian, here are the compiler specs:

```
(sage-sh) dima@spms-banana:test$ gcc -v
Using built-in specs.
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 4.4.5-8' --with-bugurl=file:///usr/share/doc/gcc-4.4/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.4 --enable-shared --enable-multiarch --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.4 --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --with-arch-32=i586 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.4.5 (Debian 4.4.5-8) 
```



---

archive/issue_comments_057479.json:
```json
{
    "body": "<a id='comment:3'></a>Your changes look fine. The `test/main.c` example doesn't do proper error handling, so you shouldn't expect a useful error message. For a relevant stack backtrace you need to post what happens before you get into the error loop.",
    "created_at": "2012-09-23T16:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57479",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>Your changes look fine. The `test/main.c` example doesn't do proper error handling, so you shouldn't expect a useful error message. For a relevant stack backtrace you need to post what happens before you get into the error loop.



---

archive/issue_comments_057480.json:
```json
{
    "body": "<a id='comment:4'></a>Upon squinting a bit harder, I noticed that\n\n```\nargv[2] = \"GAPLOCAL\" ;\n```\nin your patch does not use the preprocessor macro, it is just the string `\"GAPLOCAL\"`. I've updated the patch to not hardcode the path and pass through the gap directory correctly.",
    "created_at": "2012-09-23T16:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57480",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>Upon squinting a bit harder, I noticed that

```
argv[2] = "GAPLOCAL" ;
```
in your patch does not use the preprocessor macro, it is just the string `"GAPLOCAL"`. I've updated the patch to not hardcode the path and pass through the gap directory correctly.



---

archive/issue_comments_057481.json:
```json
{
    "body": "<a id='comment:115'></a>Replying to [vbraun](#comment%3A113):\n> Your changes look fine. The `test/main.c` example doesn't do proper error handling, so you shouldn't expect a useful error message. For a relevant stack backtrace you need to post what happens before you get into the error loop.\n\n\nWell, I rebuilt libgap with SAGE_DEBUG on, and I can see it starting the interpreter interaction, parsing the input, calling gasman, then something goes wrong, it tries to print the message `\"Variable: 'FreeGroup' must have a value\"`\n\n```\n\n(gdb) \nlibGAP_SPrTo (buffer=0x7fffffffd0d0 \"Variable: 'FreeGroup' must have a value\", maxlen=120, \n    format=0x7ffff7750098 \"Variable: '%s' must have a value\", arg1=140733014557528, arg2=0)\n    at scanner.c:3049\n```\nthen I see\n\n```\n(gdb) \nlibGAP_SyStrncat (dst=0x7fffffffcd20 \"justQuit\", src=0x7ffff775e32c \"justQuit\", len=1023)\n    at system.c:682\n\n(gdb) \nlibGAP_RNamName (name=0x7ffff775e32c \"justQuit\") at records.c:110\n```\nand it tries to go further. Eventually I see\n\n```\n(gdb) \nlibGAP_ErrorQuit (msg=0x7ffff77472a0 \"Variable: <<unknown>> must have an assigned value\", arg1=0, \n    arg2=0) at gap.c:1451\n(gdb) \nlibGAP_CallErrorInner (msg=0x7ffff77472a0 \"Variable: <<unknown>> must have an assigned value\", \n    arg1=0, arg2=0, justQuit=1, mayReturnVoid=0, mayReturnObj=0, lateMessage=0x7ffef510a678, \n    printThisStatement=1) at gap.c:1430\n\n```\n\nthis gets repeated many times (buffer corruption), and eventually a segfault.\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff75a8eef in libGAP_RNamName (name=Cannot access memory at address 0x7fffff7fefa8\n) at records.c:79\n```\n\nthe trouble starts of course much earlier, before it fails to recognize `FreeGroup` as a valid GAP function...\n\n\n\n\n.",
    "created_at": "2012-09-23T17:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57481",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:115'></a>Replying to [vbraun](#comment%3A113):
> Your changes look fine. The `test/main.c` example doesn't do proper error handling, so you shouldn't expect a useful error message. For a relevant stack backtrace you need to post what happens before you get into the error loop.


Well, I rebuilt libgap with SAGE_DEBUG on, and I can see it starting the interpreter interaction, parsing the input, calling gasman, then something goes wrong, it tries to print the message `"Variable: 'FreeGroup' must have a value"`

```

(gdb) 
libGAP_SPrTo (buffer=0x7fffffffd0d0 "Variable: 'FreeGroup' must have a value", maxlen=120, 
    format=0x7ffff7750098 "Variable: '%s' must have a value", arg1=140733014557528, arg2=0)
    at scanner.c:3049
```
then I see

```
(gdb) 
libGAP_SyStrncat (dst=0x7fffffffcd20 "justQuit", src=0x7ffff775e32c "justQuit", len=1023)
    at system.c:682

(gdb) 
libGAP_RNamName (name=0x7ffff775e32c "justQuit") at records.c:110
```
and it tries to go further. Eventually I see

```
(gdb) 
libGAP_ErrorQuit (msg=0x7ffff77472a0 "Variable: <<unknown>> must have an assigned value", arg1=0, 
    arg2=0) at gap.c:1451
(gdb) 
libGAP_CallErrorInner (msg=0x7ffff77472a0 "Variable: <<unknown>> must have an assigned value", 
    arg1=0, arg2=0, justQuit=1, mayReturnVoid=0, mayReturnObj=0, lateMessage=0x7ffef510a678, 
    printThisStatement=1) at gap.c:1430

```

this gets repeated many times (buffer corruption), and eventually a segfault.

```
Program received signal SIGSEGV, Segmentation fault.
0x00007ffff75a8eef in libGAP_RNamName (name=Cannot access memory at address 0x7fffff7fefa8
) at records.c:79
```

the trouble starts of course much earlier, before it fails to recognize `FreeGroup` as a valid GAP function...




.



---

archive/issue_comments_057482.json:
```json
{
    "body": "<a id='comment:116'></a>Replying to [vbraun](#comment%3A114):\n> Upon squinting a bit harder, I noticed that\n> \n> ```\n> argv[2] = \"GAPLOCAL\" ;\n> ```\n> in your patch does not use the preprocessor macro, it is just the string `\"GAPLOCAL\"`. I've updated the patch to not hardcode the path and pass through the gap directory correctly.\n\n\n/me facepalm...\n\nOK, now, with the updated patch, it works.",
    "created_at": "2012-09-23T17:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57482",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:116'></a>Replying to [vbraun](#comment%3A114):
> Upon squinting a bit harder, I noticed that
> 
> ```
> argv[2] = "GAPLOCAL" ;
> ```
> in your patch does not use the preprocessor macro, it is just the string `"GAPLOCAL"`. I've updated the patch to not hardcode the path and pass through the gap directory correctly.


/me facepalm...

OK, now, with the updated patch, it works.



---

archive/issue_comments_057483.json:
```json
{
    "body": "<a id='comment:7'></a>What was the reason that sage.interfaces.interface wasn't used?  It seems like we should at least have a GAP Interface that is compatible with the old pexpect one much like was done for the maxima pexpect / ecl interface.",
    "created_at": "2012-09-24T00:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57483",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:7'></a>What was the reason that sage.interfaces.interface wasn't used?  It seems like we should at least have a GAP Interface that is compatible with the old pexpect one much like was done for the maxima pexpect / ecl interface.



---

archive/issue_comments_057484.json:
```json
{
    "body": "<a id='comment:118'></a>Replying to [mhansen](#comment%3A117):\n> What was the reason that sage.interfaces.interface wasn't used?  It seems like we should at least have a GAP Interface that is compatible with the old pexpect one much like was done for the maxima pexpect / ecl interface.\n\n\nMy understanding is that at this point it's still very far to compatibility. On the other hand, it seems that replacing the `pexpect` interface using  libgap's `eval` should already be quite possible.",
    "created_at": "2012-09-24T04:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57484",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:118'></a>Replying to [mhansen](#comment%3A117):
> What was the reason that sage.interfaces.interface wasn't used?  It seems like we should at least have a GAP Interface that is compatible with the old pexpect one much like was done for the maxima pexpect / ecl interface.


My understanding is that at this point it's still very far to compatibility. On the other hand, it seems that replacing the `pexpect` interface using  libgap's `eval` should already be quite possible.



---

archive/issue_comments_057485.json:
```json
{
    "body": "<a id='comment:119'></a>Replying to [vbraun](#comment%3A111):\n> I don't think there is any reason for statically linking gmp other than their build system predating much of autotools...\n\n\nWould it be much work to libtoolize GAP itself, given that, as far as I understand, the work on this ticket can largely be re-used?",
    "created_at": "2012-09-24T06:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57485",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:119'></a>Replying to [vbraun](#comment%3A111):
> I don't think there is any reason for statically linking gmp other than their build system predating much of autotools...


Would it be much work to libtoolize GAP itself, given that, as far as I understand, the work on this ticket can largely be re-used?



---

archive/issue_comments_057486.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,4 @@\n * Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n * Apply [attachment:trac_6391_libGAP_root.patch] to the root repository\n \n+Code in `sage/libs/gap/test/` demonstrates an interface to `libgap` from C. \n``````\n",
    "created_at": "2012-09-24T06:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57486",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,4 @@
 * Apply [attachment:trac_6391_libGAP.patch] to the Sage library
 * Apply [attachment:trac_6391_libGAP_root.patch] to the root repository
 
+Code in `sage/libs/gap/test/` demonstrates an interface to `libgap` from C. 
``````




---

archive/issue_comments_057487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-24T06:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57487",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_057488.json:
```json
{
    "body": "Changing dependencies from \"#13211\" to \"#13123, #13211\"",
    "created_at": "2012-09-24T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57488",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#13211" to "#13123, #13211"



---

archive/issue_events_015052.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-24T06:48:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15052"
}
```



---

archive/issue_events_015053.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-24T06:48:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15053"
}
```



---

archive/issue_comments_057489.json:
```json
{
    "body": "Changing work_issues from \"\" to \"assert usage\"",
    "created_at": "2012-09-24T06:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57489",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "assert usage"



---

archive/issue_comments_057490.json:
```json
{
    "body": "<a id='comment:2'></a>As I said on a different ticket, `assert` should not be used for control flow.  An assert checks something which should always be true, a failed assertion is always a bug.  I consider the following to be bad usage of `assert`:\n\n```\n        try:\n            sig_on()\n            proxy = make_GapElement_MethodProxy(self.parent(), \n                                                gap_eval(name),\n                                                self)\n            sig_off()\n            assert proxy.is_function()\n        except RuntimeError, AssertionError:\n            raise AttributeError, 'Name \"'+str(name)+'\" does not define a GAP function.'\n\n        return proxy\n```",
    "created_at": "2012-09-24T06:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57490",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>As I said on a different ticket, `assert` should not be used for control flow.  An assert checks something which should always be true, a failed assertion is always a bug.  I consider the following to be bad usage of `assert`:

```
        try:
            sig_on()
            proxy = make_GapElement_MethodProxy(self.parent(), 
                                                gap_eval(name),
                                                self)
            sig_off()
            assert proxy.is_function()
        except RuntimeError, AssertionError:
            raise AttributeError, 'Name "'+str(name)+'" does not define a GAP function.'

        return proxy
```



---

archive/issue_comments_057491.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-09-24T06:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57491",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_057492.json:
```json
{
    "body": "<a id='comment:3'></a>The `SAGE_ROOT` patch needs to be rebased to #13415.",
    "created_at": "2012-09-24T06:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>The `SAGE_ROOT` patch needs to be rebased to #13415.



---

archive/issue_comments_057493.json:
```json
{
    "body": "Changing dependencies from \"#13123, #13211\" to \"#13415, #13123, #13211\"",
    "created_at": "2012-09-24T06:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57493",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#13123, #13211" to "#13415, #13123, #13211"



---

archive/issue_comments_057494.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-09-24T08:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57494",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_057495.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [trac_6391_libGAP.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.patch) by @vbraun created at 2012-09-24 08:47:57\n\n`sage.interfaces.interface.Interface` doesn't look like the most useful parent, its non-unique and operates on the assumption that one is dealing with a separate process. Here we have a shared library that is full of global variables. I think libGAP should aim at directly translating Sage<->GAP objects, so that the libGAP user does not have to input gap commands as strings at all.\n\nIt wouldn't take much to also build a libtoolized standalone interpreter, or even a GAP interpreter that communicates over zeromq. The problem is that 3rd party packages often expect a stand-alone gap tree with upstream's hacked up semi-autotools to install themselves in. From talking with people in St. Andrews I understand that upstream probably would have switched their build system already if it were not for this legacy problem.\n\nI got rid of the assert abuse and added some more tests.",
    "created_at": "2012-09-24T08:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57495",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>Attachment [trac_6391_libGAP.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP.patch) by @vbraun created at 2012-09-24 08:47:57

`sage.interfaces.interface.Interface` doesn't look like the most useful parent, its non-unique and operates on the assumption that one is dealing with a separate process. Here we have a shared library that is full of global variables. I think libGAP should aim at directly translating Sage<->GAP objects, so that the libGAP user does not have to input gap commands as strings at all.

It wouldn't take much to also build a libtoolized standalone interpreter, or even a GAP interpreter that communicates over zeromq. The problem is that 3rd party packages often expect a stand-alone gap tree with upstream's hacked up semi-autotools to install themselves in. From talking with people in St. Andrews I understand that upstream probably would have switched their build system already if it were not for this legacy problem.

I got rid of the assert abuse and added some more tests.



---

archive/issue_comments_057496.json:
```json
{
    "body": "<a id='comment:125'></a>Replying to [vbraun](#comment%3A124):\n\n>  a GAP interpreter that communicates over zeromq\n\n\nThis is a great idea. Would we be able to use IPython as the GAP interpreter if we tied your libGAP to zeromq?\n\nAlso based on conversations in St. Andrews, some upstream developers are interested in an autotools based build system. AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel. libGAP solves this problem. This can be fixed by changing GAP's compiler wrapper which adds the path of these object files to find your libGAP instead. Before trying this approach, a GAP interpreter that uses libGAP is needed. Otherwise we will have the GAP binary and libGAP in memory with the same code.\n\n\nVolker, many thanks for all the hard work on libGAP.",
    "created_at": "2012-09-24T10:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57496",
    "user": "https://github.com/burcin"
}
```

<a id='comment:125'></a>Replying to [vbraun](#comment%3A124):

>  a GAP interpreter that communicates over zeromq


This is a great idea. Would we be able to use IPython as the GAP interpreter if we tied your libGAP to zeromq?

Also based on conversations in St. Andrews, some upstream developers are interested in an autotools based build system. AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel. libGAP solves this problem. This can be fixed by changing GAP's compiler wrapper which adds the path of these object files to find your libGAP instead. Before trying this approach, a GAP interpreter that uses libGAP is needed. Otherwise we will have the GAP binary and libGAP in memory with the same code.


Volker, many thanks for all the hard work on libGAP.



---

archive/issue_comments_057497.json:
```json
{
    "body": "<a id='comment:126'></a>Replying to [burcin](#comment%3A125):\n> Would we be able to use IPython as the GAP interpreter if we tied your libGAP to zeromq?\n\n\nzeromq is just a transport, you'd have to speak the IPython protocol to do this. Much harder than just tying stdin/stdout/stderr to sockets.\n\n> AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel. libGAP solves this problem. This can be fixed by changing GAP's compiler wrapper which adds the path of these object files to find your libGAP instead.\n\n\nYou also need to prefix the symbol names with `libGAP_` if you want to link against libGAP with legacy code. Doable but at least in the short term its much easier to have libGAP and standalone GAP separately. Much like libSingular and Singular.",
    "created_at": "2012-09-24T11:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57497",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:126'></a>Replying to [burcin](#comment%3A125):
> Would we be able to use IPython as the GAP interpreter if we tied your libGAP to zeromq?


zeromq is just a transport, you'd have to speak the IPython protocol to do this. Much harder than just tying stdin/stdout/stderr to sockets.

> AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel. libGAP solves this problem. This can be fixed by changing GAP's compiler wrapper which adds the path of these object files to find your libGAP instead.


You also need to prefix the symbol names with `libGAP_` if you want to link against libGAP with legacy code. Doable but at least in the short term its much easier to have libGAP and standalone GAP separately. Much like libSingular and Singular.



---

archive/issue_comments_057498.json:
```json
{
    "body": "<a id='comment:127'></a>Replying to [burcin](#comment%3A125):\n> Replying to [vbraun](#comment%3A124):\n> \n> >  a GAP interpreter that communicates over zeromq\n\n> \n> Also based on conversations in St. Andrews, some upstream developers are interested in an autotools based build system. AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel.\n\n\nDo you mean GAP extension packages, things which are compiled using `gac` ?\n\"Normal\" GAP packages do not need any of this, AFAIK.\nThe extension packages are few and far apart. The only one I know is [EDIM](http://www.math.rwth-aachen.de/~Frank.Luebeck/EDIM/index.html).\nThe main use of `gac` seems to be\nto create faster loading GAP executables.",
    "created_at": "2012-09-24T12:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57498",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:127'></a>Replying to [burcin](#comment%3A125):
> Replying to [vbraun](#comment%3A124):
> 
> >  a GAP interpreter that communicates over zeromq

> 
> Also based on conversations in St. Andrews, some upstream developers are interested in an autotools based build system. AFAICT, the main problem with compiled GAP packages is that they rely on the object files previously compiled for the GAP executable to find symbols they need from the GAP kernel.


Do you mean GAP extension packages, things which are compiled using `gac` ?
"Normal" GAP packages do not need any of this, AFAIK.
The extension packages are few and far apart. The only one I know is [EDIM](http://www.math.rwth-aachen.de/~Frank.Luebeck/EDIM/index.html).
The main use of `gac` seems to be
to create faster loading GAP executables.



---

archive/issue_comments_057499.json:
```json
{
    "body": "<a id='comment:8'></a>OS X 10.4 PPC:\n\n```\nsage -t  \"devel/sage-main/sage/algebras/group_algebra_new.py\"\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 592:\n    sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()\nExpected:\n    -1/95*(2,6)(3,5) - 1/2*(1,3)(4,6)\nGot:\n    -1/95*(1,3)(4,6) - 1/2*(1,5,3)(2,6,4)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 594:\n    sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)\nExpected:\n    1/2*[      1 9*a + 2]\n    [9*a + 2      12]\nGot:\n    1/2*[       4  9*a + 2]\n    [6*a + 10        1]\n**********************************************************************\n1 items had failures:\n   2 of   5 in __main__.example_23\n***Test Failed*** 2 failures.\n```\nThere were other errors as well, which I'm rerunning.",
    "created_at": "2012-09-24T12:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57499",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>OS X 10.4 PPC:

```
sage -t  "devel/sage-main/sage/algebras/group_algebra_new.py"
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 592:
    sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()
Expected:
    -1/95*(2,6)(3,5) - 1/2*(1,3)(4,6)
Got:
    -1/95*(1,3)(4,6) - 1/2*(1,5,3)(2,6,4)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 594:
    sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)
Expected:
    1/2*[      1 9*a + 2]
    [9*a + 2      12]
Got:
    1/2*[       4  9*a + 2]
    [6*a + 10        1]
**********************************************************************
1 items had failures:
   2 of   5 in __main__.example_23
***Test Failed*** 2 failures.
```
There were other errors as well, which I'm rerunning.



---

archive/issue_comments_057500.json:
```json
{
    "body": "<a id='comment:129'></a>Replying to [kcrisman](#comment%3A128):\nThis has nothing to do with this ticket, this is new GAP, i.e. #13211. Just as a sanity check, have you applied the patches from #13211 ?",
    "created_at": "2012-09-24T13:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:129'></a>Replying to [kcrisman](#comment%3A128):
This has nothing to do with this ticket, this is new GAP, i.e. #13211. Just as a sanity check, have you applied the patches from #13211 ?



---

archive/issue_comments_057501.json:
```json
{
    "body": "<a id='comment:0'></a>Thanks, I'll comment there (I only ran tests after doing everything just to save time).\n\n```\nDasher-03:~/Desktop/sage-5.4.beta1/devel/sage student$ ../../sage -hg qseries\ntrac_13211_fix_gap_doctests.patch\ntrac_6391_libGAP.patch\n```\nI think that's right?",
    "created_at": "2012-09-24T15:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57501",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:0'></a>Thanks, I'll comment there (I only ran tests after doing everything just to save time).

```
Dasher-03:~/Desktop/sage-5.4.beta1/devel/sage student$ ../../sage -hg qseries
trac_13211_fix_gap_doctests.patch
trac_6391_libGAP.patch
```
I think that's right?



---

archive/issue_comments_057502.json:
```json
{
    "body": "<a id='comment:131'></a>Replying to [kcrisman](#comment%3A130):\n> Thanks, I'll comment there (I only ran tests after doing everything just to save time).\n> \n> ```\n> Dasher-03:~/Desktop/sage-5.4.beta1/devel/sage student$ ../../sage -hg qseries\n> trac_13211_fix_gap_doctests.patch\n> trac_6391_libGAP.patch\n> ```\n> I think that's right?\n\nhopefully you also did `sage -b` before starting the tests? Just checking...",
    "created_at": "2012-09-24T15:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57502",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:131'></a>Replying to [kcrisman](#comment%3A130):
> Thanks, I'll comment there (I only ran tests after doing everything just to save time).
> 
> ```
> Dasher-03:~/Desktop/sage-5.4.beta1/devel/sage student$ ../../sage -hg qseries
> trac_13211_fix_gap_doctests.patch
> trac_6391_libGAP.patch
> ```
> I think that's right?

hopefully you also did `sage -b` before starting the tests? Just checking...



---

archive/issue_comments_057503.json:
```json
{
    "body": "<a id='comment:2'></a>Yes, and I just checked that this was the case.  But I hear you on that kind of thing - it's so easy to forget.",
    "created_at": "2012-09-24T17:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57503",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>Yes, and I just checked that this was the case.  But I hear you on that kind of thing - it's so easy to forget.



---

archive/issue_comments_057504.json:
```json
{
    "body": "<a id='comment:133'></a>Replying to [kcrisman](#comment%3A128):\n\n> {{{\n> sage -t  \"devel/sage-main/sage/algebras/group_algebra_new.py\"\n> **********************************************************************\n> File \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 592:\n>     sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()\n> File \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 594:\n>     sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)\n> }}}\n\nthese are calls to random stuff, or so it seems! No wonder different hardware gives different (pseudo?)random elements. If it were tests I'd say they'd be marked `# random`, like\n\n```\n         GroupAlgebra(DihedralGroup(6), QQ).random_element() # random\n```\nnot sure about examples in this case though. Or else, if these random elements are actually predictable, this could be a bug in the pseudorandom source.",
    "created_at": "2012-09-24T17:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57504",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:133'></a>Replying to [kcrisman](#comment%3A128):

> {{{
> sage -t  "devel/sage-main/sage/algebras/group_algebra_new.py"
> **********************************************************************
> File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 592:
>     sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()
> File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 594:
>     sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)
> }}}

these are calls to random stuff, or so it seems! No wonder different hardware gives different (pseudo?)random elements. If it were tests I'd say they'd be marked `# random`, like

```
         GroupAlgebra(DihedralGroup(6), QQ).random_element() # random
```
not sure about examples in this case though. Or else, if these random elements are actually predictable, this could be a bug in the pseudorandom source.



---

archive/issue_comments_057505.json:
```json
{
    "body": "<a id='comment:4'></a>I couldn't apply the root patch through normal hg_sage.apply(). Is it supposed to be applied  in some other way?.\n\nNow i get this message when i start the sage session:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\nAn error occurred, but libGAP has no handler set.\nError message: \nLoading Sage library. Current Mercurial branch is: libgap6\nsage: \n| Sage Version 5.2, Release Date: 2012-07-25                         |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n```\n\nBut, regardless of the mysterious error, everything seems to work ok (at least my fpgroups code, which is what i am using for testing).",
    "created_at": "2012-09-24T18:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57505",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:4'></a>I couldn't apply the root patch through normal hg_sage.apply(). Is it supposed to be applied  in some other way?.

Now i get this message when i start the sage session:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
An error occurred, but libGAP has no handler set.
Error message: 
Loading Sage library. Current Mercurial branch is: libgap6
sage: 
| Sage Version 5.2, Release Date: 2012-07-25                         |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
```

But, regardless of the mysterious error, everything seems to work ok (at least my fpgroups code, which is what i am using for testing).



---

archive/issue_comments_057506.json:
```json
{
    "body": "<a id='comment:5'></a>You'd use `hg_root.apply()`.  `hg_sage` applies things to the Sage library code directories, not the root directory of Sage.",
    "created_at": "2012-09-24T18:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57506",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>You'd use `hg_root.apply()`.  `hg_sage` applies things to the Sage library code directories, not the root directory of Sage.



---

archive/issue_comments_057507.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n There's libSingular, there's libPari, and next we need to create libGAP.  \n \n To try it out,\n-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211\n+* Install http://boxen.math.washington.edu/home/dima/packages/gap-4.5.6.spkg from #13211\n * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg\n * Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n * Apply [attachment:trac_6391_libGAP_root.patch] to the root repository\n``````\n",
    "created_at": "2012-09-26T10:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57507",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 There's libSingular, there's libPari, and next we need to create libGAP.  
 
 To try it out,
-* Install http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg from #13211
+* Install http://boxen.math.washington.edu/home/dima/packages/gap-4.5.6.spkg from #13211
 * Install http://www.stp.dias.ie/~vbraun/Sage/spkg/libgap-4.5.6.spkg
 * Apply [attachment:trac_6391_libGAP.patch] to the Sage library
 * Apply [attachment:trac_6391_libGAP_root.patch] to the root repository
``````




---

archive/issue_comments_057508.json:
```json
{
    "body": "rebased patch",
    "created_at": "2012-10-08T21:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57508",
    "user": "https://github.com/vbraun"
}
```

rebased patch



---

archive/issue_comments_057509.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [trac_6391_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP_root.patch) by @vbraun created at 2012-10-08 21:08:16\n\nI've rebased the root patch just now, and removed the assert that offended Jeroen a while ago.\n\nThe startup error handling will be dealt with at #13588, this ticket is already way too long.\n\nThis ticket should be easy to review since it contains only minor changes from the previously-reviewed state.",
    "created_at": "2012-10-08T21:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57509",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Attachment [trac_6391_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket6391/trac_6391_libGAP_root.patch) by @vbraun created at 2012-10-08 21:08:16

I've rebased the root patch just now, and removed the assert that offended Jeroen a while ago.

The startup error handling will be dealt with at #13588, this ticket is already way too long.

This ticket should be easy to review since it contains only minor changes from the previously-reviewed state.



---

archive/issue_comments_057510.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-08T21:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57510",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_057511.json:
```json
{
    "body": "Changing work_issues from \"assert usage\" to \"\"",
    "created_at": "2012-10-08T21:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57511",
    "user": "https://github.com/vbraun"
}
```

Changing work_issues from "assert usage" to ""



---

archive/issue_comments_057512.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-10T10:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57512",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_057513.json:
```json
{
    "body": "<a id='comment:8'></a>all good.",
    "created_at": "2012-10-10T10:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57513",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>all good.



---

archive/issue_comments_057514.json:
```json
{
    "body": "<a id='comment:9'></a>I get a strange behaviour when i use tab completion with libgap objects:\n\n```\nsage: F=libgap.eval('FreeGroup(2)')\nsage: F.GeneratorsOfGroup()\n[ f1, f2 ]\nsage: F.GeneratorsOf\nF.GeneratorsOfField  F.GeneratorsOfGroup  F.GeneratorsOfIdeal  \nsage: F.GeneratorsOfGroup()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()\n\nAttributeError: Name \"GeneratorsOfGroup\" is not defined in GAP.\nsage: F\nException RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored\n<free group on the generators [ f1, f2 ]>\nsage: F.GeneratorsOfGroup()\n[ f1, f2 ]\n```\n(i hitted TAB in the line F.GeneratorsOf, so it showed the possible completions).",
    "created_at": "2012-10-12T13:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57514",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:9'></a>I get a strange behaviour when i use tab completion with libgap objects:

```
sage: F=libgap.eval('FreeGroup(2)')
sage: F.GeneratorsOfGroup()
[ f1, f2 ]
sage: F.GeneratorsOf
F.GeneratorsOfField  F.GeneratorsOfGroup  F.GeneratorsOfIdeal  
sage: F.GeneratorsOfGroup()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()

AttributeError: Name "GeneratorsOfGroup" is not defined in GAP.
sage: F
Exception RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored
<free group on the generators [ f1, f2 ]>
sage: F.GeneratorsOfGroup()
[ f1, f2 ]
```
(i hitted TAB in the line F.GeneratorsOf, so it showed the possible completions).



---

archive/issue_comments_057515.json:
```json
{
    "body": "<a id='comment:0'></a>Another question: i can use much less memory in a gap computation through libgap that i can in a standard sage/gap session:\n\n```\n./sage -gap\n *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n *  GAP  *   http://www.gap-system.org\n *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Packages:   GAPDoc 1.5.1\n Try '?help' for help. See also  '?copyright' and  '?authors'\ngap> F:=FreeGroup(2);\n<free group on the generators [ f1, f2 ]>\ngap> H:=F/[F.1^2,F.2^3];\n<fp group on the generators [ f1, f2 ]>\ngap> a:=GeneratorsOfGroup(H)[1];\nf1\ngap> a;\nf1\ngap> Order(a);\n2\ngap> quit;\n```\n\nBut:\n\n```\nsage: G=libgap.FreeGroup(2)\nsage: (a,b)=G.GeneratorsOfGroup()\nsage: H=G/libgap([a^2,b^3]) \nsage: (c,d)=H.GeneratorsOfGroup()\nsage: c.Order()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:8414)()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7947)()\n\nValueError: libGAP: Error, exceeded the permitted memory (`-o' command line option)\n```\n\nIt is the same computation, but in the gap session it has enough memory (it doesn't need much: even with -o 256M the computation succeeds), and through libgap it runs out of memory.\n\nI don't know if it is relevant, but i have no swap enabled in my system.",
    "created_at": "2012-10-12T16:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57515",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:0'></a>Another question: i can use much less memory in a gap computation through libgap that i can in a standard sage/gap session:

```
./sage -gap
 *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 *  GAP  *   http://www.gap-system.org
 *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Packages:   GAPDoc 1.5.1
 Try '?help' for help. See also  '?copyright' and  '?authors'
gap> F:=FreeGroup(2);
<free group on the generators [ f1, f2 ]>
gap> H:=F/[F.1^2,F.2^3];
<fp group on the generators [ f1, f2 ]>
gap> a:=GeneratorsOfGroup(H)[1];
f1
gap> a;
f1
gap> Order(a);
2
gap> quit;
```

But:

```
sage: G=libgap.FreeGroup(2)
sage: (a,b)=G.GeneratorsOfGroup()
sage: H=G/libgap([a^2,b^3]) 
sage: (c,d)=H.GeneratorsOfGroup()
sage: c.Order()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_MethodProxy.__call__ (sage/libs/gap/element.c:8414)()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7947)()

ValueError: libGAP: Error, exceeded the permitted memory (`-o' command line option)
```

It is the same computation, but in the gap session it has enough memory (it doesn't need much: even with -o 256M the computation succeeds), and through libgap it runs out of memory.

I don't know if it is relevant, but i have no swap enabled in my system.



---

archive/issue_comments_057516.json:
```json
{
    "body": "<a id='comment:1'></a>Gap and libGap now use the same function sage.interfaces.gap.get_gap_memory_pool_size() to determine how much address space to reserve. Without swap you will reserve actual memory, this is why the current patch then reserves a pretty small amount (free ram / 50). I guess we need to fine-tune the actual values a bit. I'll do this and fix the tab completion issue in #13588.\n\nAnd whoever comes first gets more memory, so this is probably why gap got more than libgap in your case.",
    "created_at": "2012-10-12T17:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57516",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Gap and libGap now use the same function sage.interfaces.gap.get_gap_memory_pool_size() to determine how much address space to reserve. Without swap you will reserve actual memory, this is why the current patch then reserves a pretty small amount (free ram / 50). I guess we need to fine-tune the actual values a bit. I'll do this and fix the tab completion issue in #13588.

And whoever comes first gets more memory, so this is probably why gap got more than libgap in your case.



---

archive/issue_comments_057517.json:
```json
{
    "body": "<a id='comment:2'></a>Is it possible to use some memory balooning technique? Or are we forced to choose between having too few memory for gap and leaving too few memory for the rest of the system?",
    "created_at": "2012-10-12T17:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57517",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:2'></a>Is it possible to use some memory balooning technique? Or are we forced to choose between having too few memory for gap and leaving too few memory for the rest of the system?



---

archive/issue_comments_057518.json:
```json
{
    "body": "<a id='comment:143'></a>Replying to [mmarco](#comment%3A142):\n> Is it possible to use some memory balooning technique?\n\n\nGap does that already. I've described some of the details here:\n\n```\ndef set_gap_memory_pool_size(size_in_bytes):\n    \"\"\"\n    Set the desired gap memory pool size.\n\n    Subsequently started GAP/libGAP instances will use this as\n    default. Currently running instances are unchanged.\n\n    GAP will only reserve ``size_in_bytes`` address space. Unless you\n    actually start a big GAP computation, the memory will not be\n    used. However, corresponding swap space will be reserved so that\n    GAP will always be able to use the reserved address space if\n    needed. While nothing is actually written to disc as long as you\n    don't run a big GAP computation, the reserved swap space will not\n    be available for other processes. \n    ...\n```",
    "created_at": "2012-10-12T18:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57518",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:143'></a>Replying to [mmarco](#comment%3A142):
> Is it possible to use some memory balooning technique?


Gap does that already. I've described some of the details here:

```
def set_gap_memory_pool_size(size_in_bytes):
    """
    Set the desired gap memory pool size.

    Subsequently started GAP/libGAP instances will use this as
    default. Currently running instances are unchanged.

    GAP will only reserve ``size_in_bytes`` address space. Unless you
    actually start a big GAP computation, the memory will not be
    used. However, corresponding swap space will be reserved so that
    GAP will always be able to use the reserved address space if
    needed. While nothing is actually written to disc as long as you
    don't run a big GAP computation, the reserved swap space will not
    be available for other processes. 
    ...
```



---

archive/issue_comments_057519.json:
```json
{
    "body": "<a id='comment:4'></a>So it sounds like a good idea to reserve a big amount of physical RAM, doesn't it?",
    "created_at": "2012-10-13T00:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57519",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:4'></a>So it sounds like a good idea to reserve a big amount of physical RAM, doesn't it?



---

archive/issue_events_015054.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-13T10:15:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15054"
}
```



---

archive/issue_events_015055.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-13T10:15:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15055"
}
```



---

archive/issue_comments_057520.json:
```json
{
    "body": "<a id='comment:6'></a>I am starting to work on some project to allow computing reduced forms in some fp groups, and i found that i can't load gap packages via libgap:\n\n```\n./sage -gap\n *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n *  GAP  *   http://www.gap-system.org\n *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1\n Try '?help' for help. See also  '?copyright' and  '?authors'\ngap> LoadPackage(\"kbmag\")\n> ;\n---------------------------------------------------------------------------------------------------------------------------------------------------------\nLoading  kbmag 1.5 (Knuth-Bendix on Monoids and Automatic Groups)\nby Derek Holt (http://www.warwick.ac.uk/~mareg).\nHomepage: http://www.warwick.ac.uk/~mareg/kbmag\n---------------------------------------------------------------------------------------------------------------------------------------------------------\ntrue\ngap> LoadPackage(\"braid\");\n---------------------------------------------------------------------------------------------------------------------------------------------------------\nLoading  braid 1.2 (braid groups package)\nby Kay Magaard (http://www.math.wayne.edu/~kaym/),\n   Sergey Shpectorov (http://www-math.bgsu.edu/~sergey/), and\n   Helmut Voelklein (http://www.exp-math.uni-essen.de/algebra/people/voelklein.html).\nHomepage: http://www.math.wayne.edu/~kaym/research/braid/\n---------------------------------------------------------------------------------------------------------------------------------------------------------\ntrue\ngap> quit;\n```\n\nBut \n\n```\n./sage     \n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nLoading Sage library. Current Mercurial branch is: test\nsage: libgap.LoadPackage('\"kbmag\"')\nfail\nsage: libgap.LoadPackage('\"braid\"')\nfail\nsage: libgap.LoadPackage(\"braid\")  \ntrue\nsage: libgap.LoadPackage(\"kbmag\")  \nfail\n```\n| Sage Version 5.4.rc1, Release Date: 2012-10-05                     |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nAlso, i don't know if it is because of libgap overwriting something in the usual gap interface, but gap.LoadPackage() gives an error message.\n\nI installed the kbmag package with this .spkg i just made: \nhttps://docs.google.com/open?id=0B_B7eBQ-W5NGOFpIMmxiNXZVaGc\n\nIs there something i should take into account?",
    "created_at": "2012-10-29T17:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57520",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:6'></a>I am starting to work on some project to allow computing reduced forms in some fp groups, and i found that i can't load gap packages via libgap:

```
./sage -gap
 *********   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 *  GAP  *   http://www.gap-system.org
 *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Packages:   CTblLib 1.2.1, FactInt 1.5.3, GAPDoc 1.5.1, LAGUNA 3.6.1
 Try '?help' for help. See also  '?copyright' and  '?authors'
gap> LoadPackage("kbmag")
> ;
---------------------------------------------------------------------------------------------------------------------------------------------------------
Loading  kbmag 1.5 (Knuth-Bendix on Monoids and Automatic Groups)
by Derek Holt (http://www.warwick.ac.uk/~mareg).
Homepage: http://www.warwick.ac.uk/~mareg/kbmag
---------------------------------------------------------------------------------------------------------------------------------------------------------
true
gap> LoadPackage("braid");
---------------------------------------------------------------------------------------------------------------------------------------------------------
Loading  braid 1.2 (braid groups package)
by Kay Magaard (http://www.math.wayne.edu/~kaym/),
   Sergey Shpectorov (http://www-math.bgsu.edu/~sergey/), and
   Helmut Voelklein (http://www.exp-math.uni-essen.de/algebra/people/voelklein.html).
Homepage: http://www.math.wayne.edu/~kaym/research/braid/
---------------------------------------------------------------------------------------------------------------------------------------------------------
true
gap> quit;
```

But 

```
./sage     
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
Loading Sage library. Current Mercurial branch is: test
sage: libgap.LoadPackage('"kbmag"')
fail
sage: libgap.LoadPackage('"braid"')
fail
sage: libgap.LoadPackage("braid")  
true
sage: libgap.LoadPackage("kbmag")  
fail
```
| Sage Version 5.4.rc1, Release Date: 2012-10-05                     |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
Also, i don't know if it is because of libgap overwriting something in the usual gap interface, but gap.LoadPackage() gives an error message.

I installed the kbmag package with this .spkg i just made: 
https://docs.google.com/open?id=0B_B7eBQ-W5NGOFpIMmxiNXZVaGc

Is there something i should take into account?



---

archive/issue_comments_057521.json:
```json
{
    "body": "<a id='comment:7'></a>The `kbmag` package has a binary compiled component, this won't work with libgap until kbmag learns about shared libraries. Packages that are pure Gap scripts do work, as you saw:\n\n```\nsage: libgap.LoadPackage(\"braid\")  \ntrue\n```",
    "created_at": "2012-10-29T18:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57521",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>The `kbmag` package has a binary compiled component, this won't work with libgap until kbmag learns about shared libraries. Packages that are pure Gap scripts do work, as you saw:

```
sage: libgap.LoadPackage("braid")  
true
```



---

archive/issue_comments_057522.json:
```json
{
    "body": "<a id='comment:8'></a>So the only hope for my project is to rewrite kbmag to be able to communicate with shared libraries? I am afraid that is way beyond my skills now. Anyways, if you can help me a little bit i can try to learn about it.",
    "created_at": "2012-10-29T20:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57522",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:8'></a>So the only hope for my project is to rewrite kbmag to be able to communicate with shared libraries? I am afraid that is way beyond my skills now. Anyways, if you can help me a little bit i can try to learn about it.



---

archive/issue_comments_057523.json:
```json
{
    "body": "<a id='comment:9'></a>I don't think you need to do anything with shared libraries. As far as I can see, the package communicates with external stand-alone executables via `Exec` calls. I'm a little surprised that libgap doesn't support Gap's `Exec` when it does support the rest of the interpreted language. Perhaps it's just a matter of initializing the environment of the Gap interpreter more fully?\n\nAnyway, if you can't get the `Exec` approach to work, it should be possible to rewrite the `kbmag` routines that interface with the executable so that they produce the output that needs to go into a temporary communication file in a way that does work. Then you can call the executable with whatever means are appropriate and you parse its output back. It may not be pleasant to do, but doesn't require particular skills either. You'd better be very sure it really has a benefit over using a separate GAP process, because it'll be quite a bit of work.\n\nGrep for `Exec` to see where the interfacing takes place.",
    "created_at": "2012-10-30T07:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57523",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'></a>I don't think you need to do anything with shared libraries. As far as I can see, the package communicates with external stand-alone executables via `Exec` calls. I'm a little surprised that libgap doesn't support Gap's `Exec` when it does support the rest of the interpreted language. Perhaps it's just a matter of initializing the environment of the Gap interpreter more fully?

Anyway, if you can't get the `Exec` approach to work, it should be possible to rewrite the `kbmag` routines that interface with the executable so that they produce the output that needs to go into a temporary communication file in a way that does work. Then you can call the executable with whatever means are appropriate and you parse its output back. It may not be pleasant to do, but doesn't require particular skills either. You'd better be very sure it really has a benefit over using a separate GAP process, because it'll be quite a bit of work.

Grep for `Exec` to see where the interfacing takes place.



---

archive/issue_comments_057524.json:
```json
{
    "body": "<a id='comment:0'></a>How hard would it be to make Gap's Exec work through libgap?",
    "created_at": "2012-10-30T10:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57524",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:0'></a>How hard would it be to make Gap's Exec work through libgap?



---

archive/issue_comments_057525.json:
```json
{
    "body": "<a id='comment:1'></a>If `kbmag` only uses stdin/out to communicate with its binary component then it should work. The `Exec` GAP function basically works when calling it via libGAP\n\n```\nsage: libgap_exec = libgap.eval(\"Exec\")\nsage: libgap_exec\n<Gap function \"Exec\">\nsage: libgap_exec('echo $HOME')\n/home/vbraun\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/vbraun/<ipython console> in <module>()\n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7929)()\n\nValueError: libGAP: Segmentation fault\n```\nThere is a segfault when returning the result, I'll fix that in another ticket (maybe #13588).\n\nHow did you install `kbmag`, I don't think its one that we ship. Is there a spkg for it?",
    "created_at": "2012-10-30T11:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57525",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>If `kbmag` only uses stdin/out to communicate with its binary component then it should work. The `Exec` GAP function basically works when calling it via libGAP

```
sage: libgap_exec = libgap.eval("Exec")
sage: libgap_exec
<Gap function "Exec">
sage: libgap_exec('echo $HOME')
/home/vbraun
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/vbraun/<ipython console> in <module>()

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_Function.__call__ (sage/libs/gap/element.c:7929)()

ValueError: libGAP: Segmentation fault
```
There is a segfault when returning the result, I'll fix that in another ticket (maybe #13588).

How did you install `kbmag`, I don't think its one that we ship. Is there a spkg for it?



---

archive/issue_comments_057526.json:
```json
{
    "body": "<a id='comment:152'></a>Replying to [vbraun](#comment%3A151):\n \n> How did you install `kbmag`, I don't think its one that we ship. Is there a spkg for it?\n> \n\nthe googledocs link above will give you the spkg...\nThat's certainly not the best way to host files.\nThere is http://code.google.com/p/spkg-upload/\nwhich would make much more sense.\n\nOr, perhaps, even easier, a bitbucket or github account.",
    "created_at": "2012-10-30T13:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57526",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:152'></a>Replying to [vbraun](#comment%3A151):
 
> How did you install `kbmag`, I don't think its one that we ship. Is there a spkg for it?
> 

the googledocs link above will give you the spkg...
That's certainly not the best way to host files.
There is http://code.google.com/p/spkg-upload/
which would make much more sense.

Or, perhaps, even easier, a bitbucket or github account.



---

archive/issue_comments_057527.json:
```json
{
    "body": "<a id='comment:153'></a>And open a ticket to make kbmag an experimental spkg so we have a place to discuss it. This issue is really done so nobody should post to it.",
    "created_at": "2012-10-30T14:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57527",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:153'></a>And open a ticket to make kbmag an experimental spkg so we have a place to discuss it. This issue is really done so nobody should post to it.



---

archive/issue_comments_057528.json:
```json
{
    "body": "<a id='comment:4'></a>I have opened #13673.",
    "created_at": "2012-10-30T17:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57528",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:4'></a>I have opened #13673.



---

archive/issue_comments_057529.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks for this great contribution!\n\nI just want to mention a problem with the assertion `strlen(libGAP_stdin_buffer) < length' which \nleads to an unhandled SIGABRT. Could this be avoided? \n \n\n```\nsage: S = SymmetricGroup(10000)\nsage: s = S.random_element()\nsage: libgap(s)\n```",
    "created_at": "2012-11-09T12:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57529",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:5'></a>Thanks for this great contribution!

I just want to mention a problem with the assertion `strlen(libGAP_stdin_buffer) < length' which 
leads to an unhandled SIGABRT. Could this be avoided? 
 

```
sage: S = SymmetricGroup(10000)
sage: s = S.random_element()
sage: libgap(s)
```



---

archive/issue_comments_057530.json:
```json
{
    "body": "<a id='comment:6'></a>Will be done in #13588",
    "created_at": "2012-11-09T15:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57530",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Will be done in #13588



---

archive/issue_events_015056.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-21T23:03:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15056"
}
```



---

archive/issue_events_015057.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-21T23:03:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15057"
}
```



---

archive/issue_comments_057531.json:
```json
{
    "body": "<a id='comment:8'></a>Now that it seems that gap upgrading has moved to 4.5.7, will this need to change?",
    "created_at": "2012-12-26T11:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57531",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:8'></a>Now that it seems that gap upgrading has moved to 4.5.7, will this need to change?



---

archive/issue_comments_057532.json:
```json
{
    "body": "<a id='comment:9'></a>Indeed, the actual version of libgap is incompatible with the gap-4.5.7 spkg:\n\n```\n\nsage: libgap.FreeGroup(4)\nAn error occurred, but libGAP has no handler set.\nError message: \n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/home/mmarco/sage-5.5/<ipython console> in <module>()\n\n/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__getattr__ (sage/misc/lazy_import.c:1877)()\n\n/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport._get_object (sage/misc/lazy_import.c:1291)()\n\n/home/mmarco/sage-5.5/libgap.pyx in init sage.libs.gap.libgap (sage/libs/gap/libgap.c:4157)()\n\n/home/mmarco/sage-5.5/libgap.pyx in sage.libs.gap.libgap.Gap.__init__ (sage/libs/gap/libgap.c:2716)()\n\n/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/libs/gap/util.so in sage.libs.gap.util.initialize (sage/libs/gap/util.c:3489)()\n\nRuntimeError: libGAP initialization failed\n\n\nYou are running a GAP kernel which does not fit with the library.\nProbably you forgot to apply the kernel part or the library part\nof a bugfix?\n\nIf you are using Windows, make sure you installed the file\nwbin4r5n7.zoo (or .zip),\nMacintosh users make sure the file\nbin4r5n7-PPC.sit (or -68k.sit) is installed,\nUnix users please recompile.\n\nError before error-handling is initialized: Update to correct kernel version!\n```",
    "created_at": "2012-12-26T11:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57532",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:9'></a>Indeed, the actual version of libgap is incompatible with the gap-4.5.7 spkg:

```

sage: libgap.FreeGroup(4)
An error occurred, but libGAP has no handler set.
Error message: 
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/mmarco/sage-5.5/<ipython console> in <module>()

/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__getattr__ (sage/misc/lazy_import.c:1877)()

/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport._get_object (sage/misc/lazy_import.c:1291)()

/home/mmarco/sage-5.5/libgap.pyx in init sage.libs.gap.libgap (sage/libs/gap/libgap.c:4157)()

/home/mmarco/sage-5.5/libgap.pyx in sage.libs.gap.libgap.Gap.__init__ (sage/libs/gap/libgap.c:2716)()

/home/mmarco/sage-5.5/local/lib/python2.7/site-packages/sage/libs/gap/util.so in sage.libs.gap.util.initialize (sage/libs/gap/util.c:3489)()

RuntimeError: libGAP initialization failed


You are running a GAP kernel which does not fit with the library.
Probably you forgot to apply the kernel part or the library part
of a bugfix?

If you are using Windows, make sure you installed the file
wbin4r5n7.zoo (or .zip),
Macintosh users make sure the file
bin4r5n7-PPC.sit (or -68k.sit) is installed,
Unix users please recompile.

Error before error-handling is initialized: Update to correct kernel version!
```



---

archive/issue_comments_057533.json:
```json
{
    "body": "<a id='comment:160'></a>Replying to [mmarco](#comment%3A159):\n> Indeed, the actual version of libgap is incompatible with the gap-4.5.7 spkg:\n\nSPKG.txt contains brief instructions about upgrading. You'll need to increase the version and rerun autotools to produce new spkg. I never tried this myself though.",
    "created_at": "2012-12-26T12:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57533",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:160'></a>Replying to [mmarco](#comment%3A159):
> Indeed, the actual version of libgap is incompatible with the gap-4.5.7 spkg:

SPKG.txt contains brief instructions about upgrading. You'll need to increase the version and rerun autotools to produce new spkg. I never tried this myself though.



---

archive/issue_comments_057534.json:
```json
{
    "body": "<a id='comment:1'></a>I'm working on it.",
    "created_at": "2012-12-26T12:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57534",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>I'm working on it.



---

archive/issue_comments_057535.json:
```json
{
    "body": "<a id='comment:162'></a>Replying to [vbraun](#comment%3A161):\n> I'm working on it.\n\nI've built the new package from your bitbucket repo, and it at least installs OK.",
    "created_at": "2012-12-26T12:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57535",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:162'></a>Replying to [vbraun](#comment%3A161):
> I'm working on it.

I've built the new package from your bitbucket repo, and it at least installs OK.



---

archive/issue_comments_057536.json:
```json
{
    "body": "<a id='comment:163'></a>Replying to [dimpase](#comment%3A162):\n> Replying to [vbraun](#comment%3A161):\n> > I'm working on it.\n\n> I've built the new package from your bitbucket repo, and it at least installs OK.\nhttp://boxen.math.washington.edu/home/dima/packages/libgap-4.5.7.p1.spkg\n\nIt also passes the tests in `sage/libs/gap`\n\nTo create the package on MacOSX, I had to install `GNU findtools`, for the native `find` has different options.",
    "created_at": "2012-12-26T12:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57536",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:163'></a>Replying to [dimpase](#comment%3A162):
> Replying to [vbraun](#comment%3A161):
> > I'm working on it.

> I've built the new package from your bitbucket repo, and it at least installs OK.
http://boxen.math.washington.edu/home/dima/packages/libgap-4.5.7.p1.spkg

It also passes the tests in `sage/libs/gap`

To create the package on MacOSX, I had to install `GNU findtools`, for the native `find` has different options.



---

archive/issue_comments_057537.json:
```json
{
    "body": "<a id='comment:4'></a>The libgap source repository is of course at the state of #13588. I've forward-ported all changes there. Since this ticket is now superseded by the new GAP version, it should be closed as duplicate. One of you guys should review #13588 :-)",
    "created_at": "2012-12-26T13:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57537",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>The libgap source repository is of course at the state of #13588. I've forward-ported all changes there. Since this ticket is now superseded by the new GAP version, it should be closed as duplicate. One of you guys should review #13588 :-)



---

archive/issue_events_015058.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-12-26T13:06:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15058"
}
```



---

archive/issue_events_015059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-12-26T13:06:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15059"
}
```



---

archive/issue_comments_057538.json:
```json
{
    "body": "<a id='comment:5'></a>So the patches to the sage library and the root repository should be moved to #13588, right?\n\nI am techically unable to review the code, all i can do is test it and report.",
    "created_at": "2012-12-26T13:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57538",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:5'></a>So the patches to the sage library and the root repository should be moved to #13588, right?

I am techically unable to review the code, all i can do is test it and report.



---

archive/issue_comments_057539.json:
```json
{
    "body": "<a id='comment:6'></a>Yes, I've moved the patches from here to #13588 to make Jeroen's life easier.",
    "created_at": "2012-12-26T13:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57539",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Yes, I've moved the patches from here to #13588 to make Jeroen's life easier.



---

archive/issue_events_015060.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:30:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6391#event-15060"
}
```



---

archive/issue_comments_057540.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-12-27T10:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57540",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_comments_057541.json:
```json
{
    "body": "Changing author from \"Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein\" to \"\"",
    "created_at": "2013-01-21T09:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57541",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein" to ""



---

archive/issue_comments_057542.json:
```json
{
    "body": "Changing reviewer from \"Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein\" to \"Dmitrii Pasechnik, Ivan Andrus, Volker Braun, William Stein\"",
    "created_at": "2013-01-21T09:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6391#issuecomment-57542",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "Dima Pasechnik, Ivan Andrus, Volker Braun, William Stein" to "Dmitrii Pasechnik, Ivan Andrus, Volker Braun, William Stein"
