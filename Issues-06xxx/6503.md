# Issue 6503: remove the pyprocessing spkg from sage, then sort out any fallout that results

archive/issues_006503.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mabshoff"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nIn sage-4.1 we ship pyprocessing-0.52.p0.spkg, however a newer better version of that same code is standard in Python-2.6.x, which we also ship.  So we need to remove pyprocessing, do a clean build/test cycle, and see what problems arise, then sort them out. \n\nBe sure to test \"sage -tp\", which isn't tested by the test suite unless you do \"make ptest\".\n\nCC:  @mwhansen\n\nComponent: **packages: standard**\n\nAuthor: **John Palmieri, Mike Hansen**\n\nReviewer: **Minh Van Nguyen**\n\nMerged: **sage-4.3.4.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6503_\n\n",
    "closed_at": "2010-03-03T01:58:05Z",
    "created_at": "2009-07-09T19:01:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "remove the pyprocessing spkg from sage, then sort out any fallout that results",
    "type": "issue",
    "updated_at": "2010-03-03T01:58:05Z",
    "url": "https://github.com/sagemath/sage/issues/6503",
    "user": "https://github.com/williamstein"
}
```
<div id="comment:0"></div>

In sage-4.1 we ship pyprocessing-0.52.p0.spkg, however a newer better version of that same code is standard in Python-2.6.x, which we also ship.  So we need to remove pyprocessing, do a clean build/test cycle, and see what problems arise, then sort them out. 

Be sure to test "sage -tp", which isn't tested by the test suite unless you do "make ptest".

CC:  @mwhansen

Component: **packages: standard**

Author: **John Palmieri, Mike Hansen**

Reviewer: **Minh Van Nguyen**

Merged: **sage-4.3.4.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/6503_





---

archive/issue_events_078006.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-09T19:01:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "milestone_number": null,
    "milestone_title": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78006"
}
```



---

archive/issue_events_078007.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-09T19:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78007"
}
```



---

archive/issue_events_078008.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-09T19:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78008"
}
```



---

archive/issue_events_078009.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-09T19:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78009"
}
```



---

archive/issue_events_078010.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-07-09T19:01:10Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78010"
}
```



---

archive/issue_events_078011.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-26T05:13:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78011"
}
```



---

archive/issue_events_078012.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-26T05:13:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78012"
}
```



---

archive/issue_events_078013.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-26T05:13:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78013"
}
```



---

archive/issue_comments_044700.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nJust delete the spkg and delete the relevant lines in spkg/standard/deps.  That should be it.",
    "created_at": "2010-01-26T05:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44700",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

Just delete the spkg and delete the relevant lines in spkg/standard/deps.  That should be it.



---

archive/issue_events_078014.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-26T05:14:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78014"
}
```



---

archive/issue_events_078015.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-26T05:14:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78015"
}
```



---

archive/issue_comments_044701.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis might not be as easy as it seems. In my merge tree, I tried removing the pyprocessing spkg, and edited `spkg/install` and `spkg/standard/deps` to get rid of the rules relating to building pyprocessing. Based on this tree with pyprocessing removed, I cut a source tarball and parallel compile (using \"export MAKE='make -j4'\") everything from source. Trouble kicks in while compiling the Sage library. Here's a relevant snippet from the install log:\n\n```\nBuilding modified file sage/ext/interpreters/wrapper_el.pyx.\nExecute 248 commands (using 4 threads)\nTraceback (most recent call last):\n  File \"setup.py\", line 752, in <module>\n    execute_list_of_commands(queue)\n  File \"setup.py\", line 249, in execute_list_of_commands\n    execute_list_of_commands_in_parallel(command_list, nthreads)\n  File \"setup.py\", line 188, in execute_list_of_commands_in_parallel\n    from processing import Pool\nImportError: No module named processing\nsage: There was an error installing modified sage library code.\n\n\nreal    0m3.261s\nuser    0m2.540s\nsys     0m0.770s\nError building new version of SAGE.\nYou might try typing 'sage -ba' or write to sage-support with as much information as possible.\n\nreal    0m7.376s\nuser    0m5.570s\nsys     0m1.820s\nsage: An error occurred while installing sage-4.3.1.alpha0-take1\n```\nThe build error cannot be due to the patches or updated spkg's in my merge tree. I also tried cutting a source tarball of my merge tree (with pyprocessing intact where it is), and compile everything from source. This went OK. Removing pyrocessing would need to wait after releasing Sage 4.3.2.alpha0. I'm putting this back to \"needs work\". The likely place to look is the file `devel/sage-main/setup.py`, especially the following function:\n\n```python\ndef execute_list_of_commands_in_parallel(command_list, nthreads):\n    \"\"\"                                                                                                                                                                                                                            \n    INPUT:                                                                                                                                                                                                                         \n        command_list -- a list of pairs, consisting of a                                                                                                                                                                           \n             function to call and its argument                                                                                                                                                                                     \n        nthreads -- integer; number of threads to use                                                                                                                                                                              \n                                                                                                                                                                                                                                   \n    OUTPUT:                                                                                                                                                                                                                        \n        Executes the given list of commands, possibly in parallel,                                                                                                                                                                 \n        using nthreads threads.  Terminates setup.py with an exit code of 1                                                                                                                                                        \n        if an error occurs in any subcommand.                                                                                                                                                                                      \n                                                                                                                                                                                                                                   \n    WARNING: commands are run roughly in order, but of course successive                                                                                                                                                           \n    commands may be run at the same time.                                                                                                                                                                                          \n    \"\"\"\n    print \"Execute %s commands (using %s threads)\"%(len(command_list), min(len(command_list),nthreads))\n    from processing import Pool\n    p = Pool(nthreads)\n    for r in p.imap(apply_pair, command_list):\n        if r:\n            print \"Parallel build failed with status %s.\"%r\n            sys.exit(1)\n```",
    "created_at": "2010-01-26T15:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44701",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:3" align="right">comment:3</div>

This might not be as easy as it seems. In my merge tree, I tried removing the pyprocessing spkg, and edited `spkg/install` and `spkg/standard/deps` to get rid of the rules relating to building pyprocessing. Based on this tree with pyprocessing removed, I cut a source tarball and parallel compile (using "export MAKE='make -j4'") everything from source. Trouble kicks in while compiling the Sage library. Here's a relevant snippet from the install log:

```
Building modified file sage/ext/interpreters/wrapper_el.pyx.
Execute 248 commands (using 4 threads)
Traceback (most recent call last):
  File "setup.py", line 752, in <module>
    execute_list_of_commands(queue)
  File "setup.py", line 249, in execute_list_of_commands
    execute_list_of_commands_in_parallel(command_list, nthreads)
  File "setup.py", line 188, in execute_list_of_commands_in_parallel
    from processing import Pool
ImportError: No module named processing
sage: There was an error installing modified sage library code.


real    0m3.261s
user    0m2.540s
sys     0m0.770s
Error building new version of SAGE.
You might try typing 'sage -ba' or write to sage-support with as much information as possible.

real    0m7.376s
user    0m5.570s
sys     0m1.820s
sage: An error occurred while installing sage-4.3.1.alpha0-take1
```
The build error cannot be due to the patches or updated spkg's in my merge tree. I also tried cutting a source tarball of my merge tree (with pyprocessing intact where it is), and compile everything from source. This went OK. Removing pyrocessing would need to wait after releasing Sage 4.3.2.alpha0. I'm putting this back to "needs work". The likely place to look is the file `devel/sage-main/setup.py`, especially the following function:

```python
def execute_list_of_commands_in_parallel(command_list, nthreads):
    """                                                                                                                                                                                                                            
    INPUT:                                                                                                                                                                                                                         
        command_list -- a list of pairs, consisting of a                                                                                                                                                                           
             function to call and its argument                                                                                                                                                                                     
        nthreads -- integer; number of threads to use                                                                                                                                                                              
                                                                                                                                                                                                                                   
    OUTPUT:                                                                                                                                                                                                                        
        Executes the given list of commands, possibly in parallel,                                                                                                                                                                 
        using nthreads threads.  Terminates setup.py with an exit code of 1                                                                                                                                                        
        if an error occurs in any subcommand.                                                                                                                                                                                      
                                                                                                                                                                                                                                   
    WARNING: commands are run roughly in order, but of course successive                                                                                                                                                           
    commands may be run at the same time.                                                                                                                                                                                          
    """
    print "Execute %s commands (using %s threads)"%(len(command_list), min(len(command_list),nthreads))
    from processing import Pool
    p = Pool(nthreads)
    for r in p.imap(apply_pair, command_list):
        if r:
            print "Parallel build failed with status %s."%r
            sys.exit(1)
```



---

archive/issue_events_078016.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-26T15:29:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78016"
}
```



---

archive/issue_events_078017.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-26T15:29:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78017"
}
```



---

archive/issue_comments_044702.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAccording to:  http://www.python.org/dev/peps/pep-0371/ there was a renaming from processing to multiprocessing. There may be other changes to the api as well.\n\nAdam",
    "created_at": "2010-01-26T15:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44702",
    "user": "https://github.com/maxthemouse"
}
```

<div id="comment:4" align="right">comment:4</div>

According to:  http://www.python.org/dev/peps/pep-0371/ there was a renaming from processing to multiprocessing. There may be other changes to the api as well.

Adam



---

archive/issue_comments_044703.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFirst, we need a patch to the sage library changing any remaining imports of \"processing\" to \"multiprocessing\"; this involves changes to parallel/multiprocessing.py, plus perhaps changing the name of that file (so that in parallel/decorate.py, a line like `import multiprocessing` means import parallel/multiprocessing.py, while in parallel/multiprocessing.py, a line like `from multiprocessing import Pool` means to import the Python multiprocessing module).\n\nThe file SAGE_ROOT/devel/sage/setup.py also imports from the processing module, so that needs to be changed.\n\nAlso, as awebb suggests, the api seems to have changed: when I make these changes and run doctests on sage/parallel/, I get errors like\n\n```\nAttributeError: 'Pool' object has no attribute 'imapUnordered'\n```\n\nAfter making the appropriate changes, perhaps we should test everything by moving the pyprocessing files out of SAGE_ROOT/local/lib/python/site-packages/ to make sure they're not being loaded?",
    "created_at": "2010-01-26T19:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44703",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

First, we need a patch to the sage library changing any remaining imports of "processing" to "multiprocessing"; this involves changes to parallel/multiprocessing.py, plus perhaps changing the name of that file (so that in parallel/decorate.py, a line like `import multiprocessing` means import parallel/multiprocessing.py, while in parallel/multiprocessing.py, a line like `from multiprocessing import Pool` means to import the Python multiprocessing module).

The file SAGE_ROOT/devel/sage/setup.py also imports from the processing module, so that needs to be changed.

Also, as awebb suggests, the api seems to have changed: when I make these changes and run doctests on sage/parallel/, I get errors like

```
AttributeError: 'Pool' object has no attribute 'imapUnordered'
```

After making the appropriate changes, perhaps we should test everything by moving the pyprocessing files out of SAGE_ROOT/local/lib/python/site-packages/ to make sure they're not being loaded?



---

archive/issue_comments_044704.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOh, sage-ptest also imports `processing`.",
    "created_at": "2010-01-26T19:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44704",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Oh, sage-ptest also imports `processing`.



---

archive/issue_comments_044705.json:
```json
{
    "body": "patch for scripts repository",
    "created_at": "2010-01-26T19:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44705",
    "user": "https://github.com/jhpalmieri"
}
```

patch for scripts repository



---

archive/issue_events_078018.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-26T19:57:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78018"
}
```



---

archive/issue_events_078019.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-26T19:57:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78019"
}
```



---

archive/issue_comments_044706.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_6503-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz)**\n\nHere are two patches, one for the scripts repo and one for the main repo.  Note that one patch removes the file \"parallel/multiprocessing.py\" (actually renaming it to \"multiprocessing_sage.py\" plus the requisite changes to import statements).  When I tried to run Sage after applying this patch, I still had copies of multiprocessing.py lying around which I had to delete by hand (this won't be a problem from a build from scratch, but upgrading could problematic): I had to delete the files\n\n```\nSAGE_ROOT/devel/sage/build/lib.macosx-10.6-i386-2.6/sage/parallel/multiprocessing.py\nSAGE_ROOT/local/lib/python/site-packages/sage/parallel/multiprocessing.py\n```\n(Without deleting these files, commands like `import multiprocessing` in parallel/multiprocessing_sage.py imported the old Sage file `multiprocessing.py` instead of the Python module `multiprocessing`.)\n\nI haven't run a full test suite yet, but \"sage -tp 2 SAGE_ROOT/devel/sage/sage/parallel/\" passes all tests for me.",
    "created_at": "2010-01-26T19:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44706",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_6503-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz)**

Here are two patches, one for the scripts repo and one for the main repo.  Note that one patch removes the file "parallel/multiprocessing.py" (actually renaming it to "multiprocessing_sage.py" plus the requisite changes to import statements).  When I tried to run Sage after applying this patch, I still had copies of multiprocessing.py lying around which I had to delete by hand (this won't be a problem from a build from scratch, but upgrading could problematic): I had to delete the files

```
SAGE_ROOT/devel/sage/build/lib.macosx-10.6-i386-2.6/sage/parallel/multiprocessing.py
SAGE_ROOT/local/lib/python/site-packages/sage/parallel/multiprocessing.py
```
(Without deleting these files, commands like `import multiprocessing` in parallel/multiprocessing_sage.py imported the old Sage file `multiprocessing.py` instead of the Python module `multiprocessing`.)

I haven't run a full test suite yet, but "sage -tp 2 SAGE_ROOT/devel/sage/sage/parallel/" passes all tests for me.



---

archive/issue_comments_044707.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHere's another version of the patch; this one also patches SAGE_ROOT/devel/sage/spkg-install to try to delete the bad files.  I don't know if I did this right, though; please review.",
    "created_at": "2010-01-30T02:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44707",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Here's another version of the patch; this one also patches SAGE_ROOT/devel/sage/spkg-install to try to delete the bad files.  I don't know if I did this right, though; please review.



---

archive/issue_events_078020.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-31T17:29:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78020"
}
```



---

archive/issue_events_078021.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-31T17:29:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78021"
}
```



---

archive/issue_comments_044708.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHere are the steps I took:\n\n1. Applied [trac_6503-scripts.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz) to the scripts repository.\n2. Applied [trac_6503-sage.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz) to the Sage library.\n3. Removed `pyprocessing-0.52.p0.spkg` from the standard spkg repository.\n4. Removed the following lines from `spkg/install`:\n\n ```\n PYPROCESSING=`$newest pyprocessing`\n export PYPROCESSING\n ```\n1. Changed the following line in `spkg/standard/deps`\n\n ```\n      $(INST)/$(ZNPOLY) $(INST)/$(POLYTOPES_DB) $(INST)/$(PYPROCESSING) $(INST)/$(GHMM) \\\n ```\n to this line\n\n ```\n      $(INST)/$(ZNPOLY) $(INST)/$(POLYTOPES_DB) $(INST)/$(GHMM) \\\n ```\n Removed the lines:\n\n ```\n $(INST)/$(PYPROCESSING): $(BASE) $(INST)/$(PYTHON)\n         $(SAGE_SPKG) $(PYPROCESSING) 2>&1\n ```\n Removed the line:\n\n ```\n                  $(INST)/$(PYPROCESSING) \\\n ```\n \nThe above steps were implemented against Sage 4.3.2.alpha0. Afterwards, I packaged up this version of Sage but with pyprocessing removed as per the above instructions. I then built this version of Sage from source, but received the following error:\n\n```\nbuilding 'sage.ext.interpreters.wrapper_el' extension\nTraceback (most recent call last):\n  File \"setup.py\", line 920, in <module>\n    include_dirs = include_dirs)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/core.py\", line 152, in setup\n    dist.run_commands()\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py\", line 975, in run_commands\n    self.run_command(cmd)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py\", line 995, in run_command\n    cmd_obj.run()\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/install.py\", line 577, in run\n    self.run_command('build')\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/cmd.py\", line 333, in run_command\n    self.distribution.run_command(command)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py\", line 995, in run_command\n    cmd_obj.run()\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/build.py\", line 134, in run\n    self.run_command(cmd_name)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/cmd.py\", line 333, in run_command\n    self.distribution.run_command(command)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py\", line 995, in run_command\n    cmd_obj.run()\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/build_ext.py\", line 340, in run\n    self.build_extensions()\n  File \"setup.py\", line 323, in build_extensions\n    from processing import Pool\nImportError: No module named processing\nsage: There was an error installing modified sage library code.\n```\nI also note that the file `devel/sage-main/setup.py` has these lines:\n\n```\n            # If there were any extensions that needed to be                    \n            # rebuilt, dispatch them using pyprocessing.                        \n            if extensions_to_compile:\n               from processing import Pool\n               p = Pool(min(ncpus, len(extensions_to_compile)))\n```\nfrom line 320. It uses the pyprocessing spkg, when in fact this spkg has been removed as per the proposal of this ticket. Perhaps this could be a reason for the above build error I received. A fix is to change the above lines to use multiprocessing instead of processing. I'm investigating this approach, in addition to John's patches.",
    "created_at": "2010-01-31T17:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44708",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:9" align="right">comment:9</div>

Here are the steps I took:

1. Applied [trac_6503-scripts.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz) to the scripts repository.
2. Applied [trac_6503-sage.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz) to the Sage library.
3. Removed `pyprocessing-0.52.p0.spkg` from the standard spkg repository.
4. Removed the following lines from `spkg/install`:

 ```
 PYPROCESSING=`$newest pyprocessing`
 export PYPROCESSING
 ```
1. Changed the following line in `spkg/standard/deps`

 ```
      $(INST)/$(ZNPOLY) $(INST)/$(POLYTOPES_DB) $(INST)/$(PYPROCESSING) $(INST)/$(GHMM) \
 ```
 to this line

 ```
      $(INST)/$(ZNPOLY) $(INST)/$(POLYTOPES_DB) $(INST)/$(GHMM) \
 ```
 Removed the lines:

 ```
 $(INST)/$(PYPROCESSING): $(BASE) $(INST)/$(PYTHON)
         $(SAGE_SPKG) $(PYPROCESSING) 2>&1
 ```
 Removed the line:

 ```
                  $(INST)/$(PYPROCESSING) \
 ```
 
The above steps were implemented against Sage 4.3.2.alpha0. Afterwards, I packaged up this version of Sage but with pyprocessing removed as per the above instructions. I then built this version of Sage from source, but received the following error:

```
building 'sage.ext.interpreters.wrapper_el' extension
Traceback (most recent call last):
  File "setup.py", line 920, in <module>
    include_dirs = include_dirs)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/core.py", line 152, in setup
    dist.run_commands()
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py", line 975, in run_commands
    self.run_command(cmd)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py", line 995, in run_command
    cmd_obj.run()
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/install.py", line 577, in run
    self.run_command('build')
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/cmd.py", line 333, in run_command
    self.distribution.run_command(command)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py", line 995, in run_command
    cmd_obj.run()
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/build.py", line 134, in run
    self.run_command(cmd_name)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/cmd.py", line 333, in run_command
    self.distribution.run_command(command)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/dist.py", line 995, in run_command
    cmd_obj.run()
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/distutils/command/build_ext.py", line 340, in run
    self.build_extensions()
  File "setup.py", line 323, in build_extensions
    from processing import Pool
ImportError: No module named processing
sage: There was an error installing modified sage library code.
```
I also note that the file `devel/sage-main/setup.py` has these lines:

```
            # If there were any extensions that needed to be                    
            # rebuilt, dispatch them using pyprocessing.                        
            if extensions_to_compile:
               from processing import Pool
               p = Pool(min(ncpus, len(extensions_to_compile)))
```
from line 320. It uses the pyprocessing spkg, when in fact this spkg has been removed as per the proposal of this ticket. Perhaps this could be a reason for the above build error I received. A fix is to change the above lines to use multiprocessing instead of processing. I'm investigating this approach, in addition to John's patches.



---

archive/issue_comments_044709.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIn the file `devel/sage-main/setup.py`, changing the following lines\n\n```\n            # If there were any extensions that needed to be                    \n            # rebuilt, dispatch them using pyprocessing.                        \n            if extensions_to_compile:\n               from processing import Pool\n               p = Pool(min(ncpus, len(extensions_to_compile)))\n```\nto these\n\n```\n            # If there were any extensions that needed to be                    \n            # rebuilt, dispatch them using pyprocessing.                        \n            if extensions_to_compile:\n               from multiprocessing import Pool\n               p = Pool(min(ncpus, len(extensions_to_compile)))\n```\nresults in the build process hanging at\n\n```\nbuilding 'sage.ext.interpreters.wrapper_el' extension\nException in thread Thread-3:\nTraceback (most recent call last):\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/threading.py\", line 525, in __bootstrap_inner\n    self.run()\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/threading.py\", line 477, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/multiprocessing/pool.py\", line 225, in _handle_tasks\n    put(task)\nPicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed\n```",
    "created_at": "2010-01-31T19:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44709",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:10" align="right">comment:10</div>

In the file `devel/sage-main/setup.py`, changing the following lines

```
            # If there were any extensions that needed to be                    
            # rebuilt, dispatch them using pyprocessing.                        
            if extensions_to_compile:
               from processing import Pool
               p = Pool(min(ncpus, len(extensions_to_compile)))
```
to these

```
            # If there were any extensions that needed to be                    
            # rebuilt, dispatch them using pyprocessing.                        
            if extensions_to_compile:
               from multiprocessing import Pool
               p = Pool(min(ncpus, len(extensions_to_compile)))
```
results in the build process hanging at

```
building 'sage.ext.interpreters.wrapper_el' extension
Exception in thread Thread-3:
Traceback (most recent call last):
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/threading.py", line 525, in __bootstrap_inner
    self.run()
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/threading.py", line 477, in run
    self.__target(*self.__args, **self.__kwargs)
  File "/dev/shm/mvngu/sandbox/sage-4.3.2.alpha0-8115/local/lib/python/multiprocessing/pool.py", line 225, in _handle_tasks
    put(task)
PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed
```



---

archive/issue_comments_044710.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIt is interesting that doing a single-threaded build on Solaris, pyprocessing failed on Solaris after applying the patch at \n\nhttp://bugs.python.org/issue1759169 \n\nHowever, after touching \n\n```\n$ touch spkg/installed/pyprocessing-0.52.p0\n```\n\nso the Sage library built without problems on Solaris 10 (SPARC)\n\nCould it be the fact a parallel build was performed that caused the problems observed? \n\nDave",
    "created_at": "2010-02-25T15:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44710",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:11" align="right">comment:11</div>

It is interesting that doing a single-threaded build on Solaris, pyprocessing failed on Solaris after applying the patch at 

http://bugs.python.org/issue1759169 

However, after touching 

```
$ touch spkg/installed/pyprocessing-0.52.p0
```

so the Sage library built without problems on Solaris 10 (SPARC)

Could it be the fact a parallel build was performed that caused the problems observed? 

Dave



---

archive/issue_comments_044711.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFor the record, I'm attaching a new version of the patch which deals with the reference to processing in setup.py -- the one that I missed in the first patch.  I don't know why mvngu's build process failed with this patch.  I may try to build it myself if I have time, but if anyone else wants to give it a try, please go ahead.",
    "created_at": "2010-02-26T15:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44711",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

For the record, I'm attaching a new version of the patch which deals with the reference to processing in setup.py -- the one that I missed in the first patch.  I don't know why mvngu's build process failed with this patch.  I may try to build it myself if I have time, but if anyone else wants to give it a try, please go ahead.



---

archive/issue_comments_044712.json:
```json
{
    "body": "patch for Sage library",
    "created_at": "2010-02-26T15:58:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44712",
    "user": "https://github.com/jhpalmieri"
}
```

patch for Sage library



---

archive/issue_comments_044713.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[trac_6503-sage.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz)**\n\nOkay, I took a copy of Sage, applied the attached patches and made Minh's suggested changes to install and deps, then ran `sage -sdist`.  I took the resulting tar file and tried to build it.  With MAKE defined as \"make -j2\", I ran into the same issue that Minh did.  At that point I redefined MAKE to be \"make\", and the build finished.  I'm running doctests now, but everything looks good.  In particular, `sage/sage/parallel` passes doctests.",
    "created_at": "2010-02-26T20:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44713",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[trac_6503-sage.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz)**

Okay, I took a copy of Sage, applied the attached patches and made Minh's suggested changes to install and deps, then ran `sage -sdist`.  I took the resulting tar file and tried to build it.  With MAKE defined as "make -j2", I ran into the same issue that Minh did.  At that point I redefined MAKE to be "make", and the build finished.  I'm running doctests now, but everything looks good.  In particular, `sage/sage/parallel` passes doctests.



---

archive/issue_comments_044714.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNote also that #8191, which already has positive review and I believe will be in the next release, needs changes to spkg/install and spkg/standard/deps. These need to be coordinated with patches. \n\nI'd love to try your fixes, but I'm not sure how to apply a patch like this to the Sage library. Perhaps if you could give me an idiots buide to how to do this with Mercurial, I'll try it. \n\nDave",
    "created_at": "2010-02-26T23:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44714",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:14" align="right">comment:14</div>

Note also that #8191, which already has positive review and I believe will be in the next release, needs changes to spkg/install and spkg/standard/deps. These need to be coordinated with patches. 

I'd love to try your fixes, but I'm not sure how to apply a patch like this to the Sage library. Perhaps if you could give me an idiots buide to how to do this with Mercurial, I'll try it. 

Dave



---

archive/issue_comments_044715.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe simplest way to see the bug that Minh reported is as follows:\n\n- apply trac_6503-sage.patch\n- export MAKE='make -j2'  (to do a parallel build)\n- touch a cython file in the Sage library\n- sage -b\n\nYou should get the pickling error he described above.",
    "created_at": "2010-02-27T00:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44715",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

The simplest way to see the bug that Minh reported is as follows:

- apply trac_6503-sage.patch
- export MAKE='make -j2'  (to do a parallel build)
- touch a cython file in the Sage library
- sage -b

You should get the pickling error he described above.



---

archive/issue_comments_044716.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A14):\n> Note also that #8191, which already has positive review and I believe will be in the next release, needs changes to spkg/install and spkg/standard/deps. These need to be coordinated with patches. \n> \n> I'd love to try your fixes, but I'm not sure how to apply a patch like this to the Sage library. Perhaps if you could give me an idiots buide to how to do this with Mercurial, I'll try it. \n\nIn my opinion, Mercurial queues are the easiest way to do these things.  Have a look at the quick startup guide at:\n\nhttp://wiki.sagemath.org/MercurialQueues",
    "created_at": "2010-02-27T04:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44716",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-drkirkby](#comment%3A14):
> Note also that #8191, which already has positive review and I believe will be in the next release, needs changes to spkg/install and spkg/standard/deps. These need to be coordinated with patches. 
> 
> I'd love to try your fixes, but I'm not sure how to apply a patch like this to the Sage library. Perhaps if you could give me an idiots buide to how to do this with Mercurial, I'll try it. 

In my opinion, Mercurial queues are the easiest way to do these things.  Have a look at the quick startup guide at:

http://wiki.sagemath.org/MercurialQueues



---

archive/issue_comments_044717.json:
```json
{
    "body": "Attachment: **[trac_6503-fix.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-fix.patch.gz)**",
    "created_at": "2010-02-27T20:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44717",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[trac_6503-fix.patch.gz](https://github.com/sagemath/sage/files/ticket6503/trac_6503-fix.patch.gz)**



---

archive/issue_comments_044718.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI've added a patch on top of trac_6503-sage.patch which fixes the issue with pickling the instancemethods when building the Sage library in parallel with multiprocessing.",
    "created_at": "2010-02-27T20:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44718",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:17" align="right">comment:17</div>

I've added a patch on top of trac_6503-sage.patch which fixes the issue with pickling the instancemethods when building the Sage library in parallel with multiprocessing.



---

archive/issue_events_078022.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-02-27T20:13:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78022"
}
```



---

archive/issue_events_078023.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-02-27T20:13:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78023"
}
```



---

archive/issue_comments_044719.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nmhansen's patch works for me.  Since I wrote the original patch, I can't give the whole thing a positive review.  I'll positively review mhansen's patch, though, and mvngu's instructions [above](https://github.com/sagemath/sage/issues/6503#comment:9), items 3-5 in particular (patching spkg/install and spkg/standard/deps, and removing pyprocessing...spkg).\n\nI'm attaching complete versions of the modified versions of install and deps, for completeness.",
    "created_at": "2010-03-01T23:52:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44719",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

mhansen's patch works for me.  Since I wrote the original patch, I can't give the whole thing a positive review.  I'll positively review mhansen's patch, though, and mvngu's instructions [above](https://github.com/sagemath/sage/issues/6503#comment:9), items 3-5 in particular (patching spkg/install and spkg/standard/deps, and removing pyprocessing...spkg).

I'm attaching complete versions of the modified versions of install and deps, for completeness.



---

archive/issue_comments_044720.json:
```json
{
    "body": "Work Issues: **rebase on top of #8191**",
    "created_at": "2010-03-02T19:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44720",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Work Issues: **rebase on top of #8191**



---

archive/issue_comments_044721.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe file \"install\" here needs to be rebased on top of that at #8191. The latter adds the new iconv spkg. In doing so, it modifies \"install\". Simiarly, the file \"deps\" on the current ticket needs to be rebased on top of that at #8191.",
    "created_at": "2010-03-02T19:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44721",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:19" align="right">comment:19</div>

The file "install" here needs to be rebased on top of that at #8191. The latter adds the new iconv spkg. In doing so, it modifies "install". Simiarly, the file "deps" on the current ticket needs to be rebased on top of that at #8191.



---

archive/issue_events_078024.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-02T19:54:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78024"
}
```



---

archive/issue_events_078025.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-02T19:54:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78025"
}
```



---

archive/issue_events_078026.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-02T20:13:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78026"
}
```



---

archive/issue_events_078027.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-02T20:13:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78027"
}
```



---

archive/issue_comments_044722.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nGiven that neither #8191 nor this ticket has a positive review, I'm not sure why this one in particular needs rebasing.  But here you go.",
    "created_at": "2010-03-02T20:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44722",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Given that neither #8191 nor this ticket has a positive review, I'm not sure why this one in particular needs rebasing.  But here you go.



---

archive/issue_comments_044723.json:
```json
{
    "body": "rebased against #8191",
    "created_at": "2010-03-02T20:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44723",
    "user": "https://github.com/jhpalmieri"
}
```

rebased against #8191



---

archive/issue_comments_044724.json:
```json
{
    "body": "Attachment: **[deps.2.gz](https://github.com/sagemath/sage/files/ticket6503/deps.2.gz)**\n\nAttachment: **[install.gz](https://github.com/sagemath/sage/files/ticket6503/install.gz)**\n\nrebased against #8191",
    "created_at": "2010-03-02T20:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44724",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[deps.2.gz](https://github.com/sagemath/sage/files/ticket6503/deps.2.gz)**

Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket6503/install.gz)**

rebased against #8191



---

archive/issue_comments_044725.json:
```json
{
    "body": "rebased against #8191",
    "created_at": "2010-03-02T20:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44725",
    "user": "https://github.com/jhpalmieri"
}
```

rebased against #8191



---

archive/issue_comments_044726.json:
```json
{
    "body": "Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket6503/deps.gz)**",
    "created_at": "2010-03-02T20:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44726",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket6503/deps.gz)**



---

archive/issue_comments_044727.json:
```json
{
    "body": "Attachment: **[deps.diff.gz](https://github.com/sagemath/sage/files/ticket6503/deps.diff.gz)**\n\nAttachment: **[install.diff.gz](https://github.com/sagemath/sage/files/ticket6503/install.diff.gz)**",
    "created_at": "2010-03-02T20:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44727",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[deps.diff.gz](https://github.com/sagemath/sage/files/ticket6503/deps.diff.gz)**

Attachment: **[install.diff.gz](https://github.com/sagemath/sage/files/ticket6503/install.diff.gz)**



---

archive/issue_comments_044728.json:
```json
{
    "body": "Changed work issues from **rebase on top of #8191** to none",
    "created_at": "2010-03-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44728",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed work issues from **rebase on top of #8191** to none



---

archive/issue_events_078028.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T01:42:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78028"
}
```



---

archive/issue_events_078029.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T01:42:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78029"
}
```



---

archive/issue_comments_044729.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHurray! Parallel build works and parallel doctesting works also. I often use the following little script to parallel build and doctest after the build is done:\n\n```sh\n#!/bin/sh\nexport DOT_SAGE=/dev/shm/mvngu/dot_sage/<x.y.z>\nexport MAKE='make -j6'\nmake\nmake ptestlong\n```\nThis script first requires that I edit the following line in `makefile`\n\n```\nNUM_THREADS=0 # 0 interpreted as min(8, multiprocessing.cpu_count())\n```\nto result in \n\n```\nNUM_THREADS=8 # 0 interpreted as min(8, multiprocessing.cpu_count())\n```\nI also attempted parallel doctest with\n\n```\n./sage -tp 12 -long devel/sage-main/\n```\nAs far as the parallel compilation and parallel doctesting of Sage is concerned, they went OK without pyprocessing. Now is the time to remove pyprocessing and instead use the Python library module `multiprocessing`. A big thank you to John and Mike for the hard work!",
    "created_at": "2010-03-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44729",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:21" align="right">comment:21</div>

Hurray! Parallel build works and parallel doctesting works also. I often use the following little script to parallel build and doctest after the build is done:

```sh
#!/bin/sh
export DOT_SAGE=/dev/shm/mvngu/dot_sage/<x.y.z>
export MAKE='make -j6'
make
make ptestlong
```
This script first requires that I edit the following line in `makefile`

```
NUM_THREADS=0 # 0 interpreted as min(8, multiprocessing.cpu_count())
```
to result in 

```
NUM_THREADS=8 # 0 interpreted as min(8, multiprocessing.cpu_count())
```
I also attempted parallel doctest with

```
./sage -tp 12 -long devel/sage-main/
```
As far as the parallel compilation and parallel doctesting of Sage is concerned, they went OK without pyprocessing. Now is the time to remove pyprocessing and instead use the Python library module `multiprocessing`. A big thank you to John and Mike for the hard work!



---

archive/issue_comments_044730.json:
```json
{
    "body": "Reviewer: **Minh Van Nguyen**",
    "created_at": "2010-03-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44730",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Reviewer: **Minh Van Nguyen**



---

archive/issue_comments_044731.json:
```json
{
    "body": "Author: **John Palmieri, Mike Hansen**",
    "created_at": "2010-03-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44731",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Author: **John Palmieri, Mike Hansen**



---

archive/issue_comments_044732.json:
```json
{
    "body": "Merged: **sage-4.3.4.alpha0**",
    "created_at": "2010-03-03T01:58:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44732",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.4.alpha0**



---

archive/issue_events_078030.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T01:58:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78030"
}
```



---

archive/issue_events_078031.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T01:58:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6503#event-78031"
}
```



---

archive/issue_comments_044733.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nMerged in this order:\n\n1. Removed `SAGE_ROOT/spkg/standard/pyprocessing-0.52.p0.spkg`.\n2. Replaced the file `SAGE_ROOT/spkg/install` with [install](https://github.com/sagemath/sage/files/ticket6503/install.gz).\n3. Replaced the file `SAGE_ROOT/spkg/standard/deps` with [deps](https://github.com/sagemath/sage/files/ticket6503/deps.gz).\n4. Merged [trac_6503-scripts.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz) in the scripts repository.\n5. Merged [trac_6503-sage.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz) in the Sage library.\n6. Merged [trac_6503-fix.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-fix.patch.gz) in the Sage library.",
    "created_at": "2010-03-03T01:58:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6503#issuecomment-44733",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:22" align="right">comment:22</div>

Merged in this order:

1. Removed `SAGE_ROOT/spkg/standard/pyprocessing-0.52.p0.spkg`.
2. Replaced the file `SAGE_ROOT/spkg/install` with [install](https://github.com/sagemath/sage/files/ticket6503/install.gz).
3. Replaced the file `SAGE_ROOT/spkg/standard/deps` with [deps](https://github.com/sagemath/sage/files/ticket6503/deps.gz).
4. Merged [trac_6503-scripts.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-scripts.patch.gz) in the scripts repository.
5. Merged [trac_6503-sage.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-sage.patch.gz) in the Sage library.
6. Merged [trac_6503-fix.patch](https://github.com/sagemath/sage/files/ticket6503/trac_6503-fix.patch.gz) in the Sage library.
