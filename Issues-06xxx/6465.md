# Issue 6465: Derivative D acts wrongly on symbolic integration

archive/issues_006465.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nIn new symbolics, derivative operator does not know \nhow to act on symbolic integration.\n\n```\nsage: f(x) = function('f',x)\nsage: g = integrate(f(x),x)\nsage: g.diff(x)\nD[0](integrate)(f(x), x)*D[0](f)(x) + D[1](integrate)(f(x), x)\n```\n\n**Patches**:\n\n* Both patches should be applied in order (spkg is already included in sage-4.1.1).\n\nApart from solving this bug it introduces couple\nof new features (by moving it into new symbolics' SFunction sub-class)\n\n (1) Stricter syntax:\n\n  http://groups.google.com/group/sage-devel/browse_thread/thread/3e98841311653d7a\n\n (2) Numerical approximation using .n() method\n\n (3) Updated \"integrate?\" docstring\n \n (4) Graceful handling of situations where integration is specified w.r.t. an expression\n\n  http://groups.google.com/group/sage-devel/browse_thread/thread/cd9f91338635ada9\n\n\n\n (4) Behind the scene it provides a framework to hook up easily new integration algorithm written within sage.\n\n\n\nComponent: **symbolics**\n\nAuthor: **Burcin Erocal, Golam Mortuza Hossain**\n\nReviewer: **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou, Minh Van Nguyen**\n\nMerged: **sage-4.3.3.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6465_\n\n",
    "closed_at": "2010-02-18T21:51:14Z",
    "created_at": "2009-07-05T02:31:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Derivative D acts wrongly on symbolic integration",
    "type": "issue",
    "updated_at": "2010-02-18T21:51:14Z",
    "url": "https://github.com/sagemath/sage/issues/6465",
    "user": "https://github.com/golam-m-hossain"
}
```
<div id="comment:0"></div>

In new symbolics, derivative operator does not know 
how to act on symbolic integration.

```
sage: f(x) = function('f',x)
sage: g = integrate(f(x),x)
sage: g.diff(x)
D[0](integrate)(f(x), x)*D[0](f)(x) + D[1](integrate)(f(x), x)
```

**Patches**:

* Both patches should be applied in order (spkg is already included in sage-4.1.1).

Apart from solving this bug it introduces couple
of new features (by moving it into new symbolics' SFunction sub-class)

 (1) Stricter syntax:

  http://groups.google.com/group/sage-devel/browse_thread/thread/3e98841311653d7a

 (2) Numerical approximation using .n() method

 (3) Updated "integrate?" docstring
 
 (4) Graceful handling of situations where integration is specified w.r.t. an expression

  http://groups.google.com/group/sage-devel/browse_thread/thread/cd9f91338635ada9



 (4) Behind the scene it provides a framework to hook up easily new integration algorithm written within sage.



Component: **symbolics**

Author: **Burcin Erocal, Golam Mortuza Hossain**

Reviewer: **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou, Minh Van Nguyen**

Merged: **sage-4.3.3.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/6465_





---

archive/issue_events_077468.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-05T02:31:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77468"
}
```



---

archive/issue_events_077469.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-05T02:31:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77469"
}
```



---

archive/issue_events_077470.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-05T02:31:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77470"
}
```



---

archive/issue_events_077471.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-05T02:31:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77471"
}
```



---

archive/issue_comments_043946.json:
```json
{
    "body": "support disabling chain rule for symbolic functions",
    "created_at": "2009-08-01T02:36:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43946",
    "user": "https://github.com/burcin"
}
```

support disabling chain rule for symbolic functions



---

archive/issue_comments_043947.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_6465-chain_rule.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.patch.gz)**\n\n[attachment: trac_6465-chain_rule.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.patch.gz) adds support for disabling chain rule for symbolic functions. It depends on the new pynac package here:\n\nhttp://sage.math.washington.edu/home/burcin/pynac/pynac-0.1.8.p2.spkg",
    "created_at": "2009-08-01T02:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43947",
    "user": "https://github.com/burcin"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_6465-chain_rule.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.patch.gz)**

[attachment: trac_6465-chain_rule.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.patch.gz) adds support for disabling chain rule for symbolic functions. It depends on the new pynac package here:

http://sage.math.washington.edu/home/burcin/pynac/pynac-0.1.8.p2.spkg



---

archive/issue_events_077472.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-08-20T23:34:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77472"
}
```



---

archive/issue_events_077473.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-08-20T23:34:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77473"
}
```



---

archive/issue_comments_043948.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,28 @@\n sage: g.diff(x)\n D[0](integrate)(f(x), x)*D[0](f)(x) + D[1](integrate)(f(x), x)\n ```\n+\n+**Patches**:\n+\n+* Both patches should be applied in order (spkg is already included in sage-4.1.1).\n+\n+Apart from solving this bug it introduces couple\n+of new features (by moving it into new symbolics' SFunction sub-class)\n+\n+ (1) Stricter syntax:\n+\n+  http://groups.google.com/group/sage-devel/browse_thread/thread/3e98841311653d7a\n+\n+ (2) Numerical approximation using .n() method\n+\n+ (3) Updated \"integrate?\" docstring\n+ \n+ (4) Graceful handling of situations where integration is specified w.r.t. an expression\n+\n+  http://groups.google.com/group/sage-devel/browse_thread/thread/cd9f91338635ada9\n+\n+\n+\n+ (4) Behind the scene it provides a framework to hook up easily new integration algorithm written within sage.\n+\n+\n``````\n",
    "created_at": "2009-08-20T23:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43948",
    "user": "https://github.com/golam-m-hossain"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,28 @@
 sage: g.diff(x)
 D[0](integrate)(f(x), x)*D[0](f)(x) + D[1](integrate)(f(x), x)
 ```
+
+**Patches**:
+
+* Both patches should be applied in order (spkg is already included in sage-4.1.1).
+
+Apart from solving this bug it introduces couple
+of new features (by moving it into new symbolics' SFunction sub-class)
+
+ (1) Stricter syntax:
+
+  http://groups.google.com/group/sage-devel/browse_thread/thread/3e98841311653d7a
+
+ (2) Numerical approximation using .n() method
+
+ (3) Updated "integrate?" docstring
+ 
+ (4) Graceful handling of situations where integration is specified w.r.t. an expression
+
+  http://groups.google.com/group/sage-devel/browse_thread/thread/cd9f91338635ada9
+
+
+
+ (4) Behind the scene it provides a framework to hook up easily new integration algorithm written within sage.
+
+
``````




---

archive/issue_comments_043949.json:
```json
{
    "body": "Author: **Burcin Erocal, Golam Mortuza Hossain**",
    "created_at": "2009-08-20T23:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43949",
    "user": "https://github.com/golam-m-hossain"
}
```

Author: **Burcin Erocal, Golam Mortuza Hossain**



---

archive/issue_comments_043950.json:
```json
{
    "body": "Attachment: **[trac_6465-moves-integration-into-sfunction-subclass.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.patch.gz)**\n\nShould be applied after the chain-rule patch",
    "created_at": "2009-08-21T17:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43950",
    "user": "https://github.com/golam-m-hossain"
}
```

Attachment: **[trac_6465-moves-integration-into-sfunction-subclass.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.patch.gz)**

Should be applied after the chain-rule patch



---

archive/issue_comments_043951.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThere need to be deprecation warnings for things like \n\n```\nsage: integral(sin(x), pi, 2*pi)\nsage: integral(sin(x)^3\n```",
    "created_at": "2009-09-10T15:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43951",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

There need to be deprecation warnings for things like 

```
sage: integral(sin(x), pi, 2*pi)
sage: integral(sin(x)^3
```



---

archive/issue_events_077474.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-09-22T10:47:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77474"
}
```



---

archive/issue_events_077475.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-09-22T10:47:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77475"
}
```



---

archive/issue_comments_043952.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe sudden API change probably merits a deprecation warning, as kcrisman said. Also:\n\nDoctest failure:\n\n```\n\nsage -t -long devel/sage/sage/libs/ginac/decl.pxi         \n         [0.1 s]                                          \nsage -t -long devel/sage/sage/misc/functional.py          \n**********************************************************************\nFile \"/opt/sage-bin/devel/sage-deriv/sage/misc/functional.py\", line 412:\n    sage: integral(exp(-x), (x, 1, oo))                                 \nExpected:                                                               \n    e^(-1)                                                              \nGot:                                                                    \n    gamma_incomplete(1, 1)                                              \n**********************************************************************  \n1 items had failures:                                                   \n   1 of  15 in __main__.example_25                                      \n***Test Failed*** 1 failures.                                           \nFor whitespace errors, see the file /opt/sage-bin/tmp/.doctest_functional.py\n         [9.3 s]\n\n```",
    "created_at": "2009-09-22T10:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43952",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:4" align="right">comment:4</div>

The sudden API change probably merits a deprecation warning, as kcrisman said. Also:

Doctest failure:

```

sage -t -long devel/sage/sage/libs/ginac/decl.pxi         
         [0.1 s]                                          
sage -t -long devel/sage/sage/misc/functional.py          
**********************************************************************
File "/opt/sage-bin/devel/sage-deriv/sage/misc/functional.py", line 412:
    sage: integral(exp(-x), (x, 1, oo))                                 
Expected:                                                               
    e^(-1)                                                              
Got:                                                                    
    gamma_incomplete(1, 1)                                              
**********************************************************************  
1 items had failures:                                                   
   1 of  15 in __main__.example_25                                      
***Test Failed*** 1 failures.                                           
For whitespace errors, see the file /opt/sage-bin/tmp/.doctest_functional.py
         [9.3 s]

```



---

archive/issue_comments_043953.json:
```json
{
    "body": "Reviewer: **Tim Dumol**",
    "created_at": "2009-09-22T10:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43953",
    "user": "https://github.com/TimDumol"
}
```

Reviewer: **Tim Dumol**



---

archive/issue_comments_043954.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThat may be due to the Maxima upgrade - has it been patched elsewhere?  Just FYI, I'm not certain on this.",
    "created_at": "2009-09-22T12:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43954",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

That may be due to the Maxima upgrade - has it been patched elsewhere?  Just FYI, I'm not certain on this.



---

archive/issue_comments_043955.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis patch needs to be rebased on #6816. The doctest failure persists, but gamma_incomplete(1, 1) is equivalent to e^(-1) anyways.",
    "created_at": "2009-11-30T08:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43955",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:6" align="right">comment:6</div>

This patch needs to be rebased on #6816. The doctest failure persists, but gamma_incomplete(1, 1) is equivalent to e^(-1) anyways.



---

archive/issue_comments_043956.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nBoth patches need major rebase after #7490. I'll take a look at this when I find some time.\n\nThe problem with `gamma_incomplete` might be related to/fixed by #7748.",
    "created_at": "2009-12-22T22:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43956",
    "user": "https://github.com/burcin"
}
```

<div id="comment:7" align="right">comment:7</div>

Both patches need major rebase after #7490. I'll take a look at this when I find some time.

The problem with `gamma_incomplete` might be related to/fixed by #7748.



---

archive/issue_events_077476.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-12-22T22:46:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "milestone_number": null,
    "milestone_title": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77476"
}
```



---

archive/issue_comments_043957.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n> The problem with `gamma_incomplete` might be related to/fixed by #7748.\n\nYes, I think so, as Maxima 5.20.1 now returns this for both integrate(exp(-x),x,1,inf) and integrate(1/%e^x,x,1,inf).  Note that \n\n```\nsage: gamma_inc(1,1)\n0.367...\n```\nrather than 1/e at this point, so it really is the symbolic piece, not just having translation from Maxima, that would be important.",
    "created_at": "2009-12-23T04:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43957",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

> The problem with `gamma_incomplete` might be related to/fixed by #7748.

Yes, I think so, as Maxima 5.20.1 now returns this for both integrate(exp(-x),x,1,inf) and integrate(1/%e^x,x,1,inf).  Note that 

```
sage: gamma_inc(1,1)
0.367...
```
rather than 1/e at this point, so it really is the symbolic piece, not just having translation from Maxima, that would be important.



---

archive/issue_comments_043958.json:
```json
{
    "body": "rebased to 4.3.rc0",
    "created_at": "2010-01-19T10:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43958",
    "user": "https://github.com/burcin"
}
```

rebased to 4.3.rc0



---

archive/issue_comments_043959.json:
```json
{
    "body": "Attachment: **[trac_6465-chain_rule.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)**\n\nrebased to 4.3.1.rc0",
    "created_at": "2010-01-19T10:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43959",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_6465-chain_rule.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)**

rebased to 4.3.1.rc0



---

archive/issue_comments_043960.json:
```json
{
    "body": "Attachment: **[trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)**\n\nreferee patch",
    "created_at": "2010-01-19T10:22:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43960",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)**

referee patch



---

archive/issue_comments_043961.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_6465-integral.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)**\n\nI uploaded new versions of the two old patches, rebased to 4.3.1.rc0, and a referee patch. I consider this ready now, though someone needs to review my changes.\n\nUnfortunately [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz) depends on the next version of pynac. I will release that real soon now. :)\n\nThe patches should be applied in this order:\n* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)\n* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)\n* [attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)\n\nThey probably depend on other tickets. ATM, my queue contains: #7822, #6961, #7876, #7363, #7955, #7957, #7916 related to symbolics.",
    "created_at": "2010-01-19T10:33:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43961",
    "user": "https://github.com/burcin"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_6465-integral.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)**

I uploaded new versions of the two old patches, rebased to 4.3.1.rc0, and a referee patch. I consider this ready now, though someone needs to review my changes.

Unfortunately [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz) depends on the next version of pynac. I will release that real soon now. :)

The patches should be applied in this order:
* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)
* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)
* [attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)

They probably depend on other tickets. ATM, my queue contains: #7822, #6961, #7876, #7363, #7955, #7957, #7916 related to symbolics.



---

archive/issue_events_077477.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-01-19T14:15:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77477"
}
```



---

archive/issue_events_077478.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-01-19T14:15:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77478"
}
```



---

archive/issue_comments_043962.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nNew pynac package available here:\n\nhttp://sage.math.washington.edu/home/burcin/pynac/pynac-0.1.11.spkg\n\nThe patches here depend on #7822, #7876, #7363, #7955, #7957 and #7916 (in this order).\n\nThe patches should be applied in this order:\n\n* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz) Download\n* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz) Download\n* [attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)",
    "created_at": "2010-01-19T14:15:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43962",
    "user": "https://github.com/burcin"
}
```

<div id="comment:10" align="right">comment:10</div>

New pynac package available here:

http://sage.math.washington.edu/home/burcin/pynac/pynac-0.1.11.spkg

The patches here depend on #7822, #7876, #7363, #7955, #7957 and #7916 (in this order).

The patches should be applied in this order:

* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz) Download
* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz) Download
* [attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz)



---

archive/issue_comments_043963.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThere is a reject on sage/symbolic/random_tests.py with the last patch.",
    "created_at": "2010-01-21T00:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43963",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:11" align="right">comment:11</div>

There is a reject on sage/symbolic/random_tests.py with the last patch.



---

archive/issue_comments_043964.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSee #6559 for the correct order of patches to avoid the reject.",
    "created_at": "2010-01-21T01:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43964",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

See #6559 for the correct order of patches to avoid the reject.



---

archive/issue_comments_043965.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI've applied every one of Burcin's patches I could find, and get only one type of doctest failure with all of them (when applied in the right order).  So so far so good!  Unfortunately, I can't review any of them for two reasons - my understanding of C++/Pynac is not reliable enough to do a good job, and there are so many failures until one applies *all* the patches that it's hard to separate out what's what.\n\nThe reason I say that here is that I do get a significant failure, in a few different files, for the `_tderivative_` method, though the actual failure occurs as a RuntimeError in line 216 of sage/misc/derivative.pyx (with no error message, more's the pity).  For instance, in line 99 of sage/symbolic/integration/integral.py, \n\n```\nsage: f = function('f'); a,b = var('a,b')\nsage: h = indefinite_integral(f(x), x)\nsage: h.diff(x)\nRuntimeError\n```\nI hope this helps track it down.",
    "created_at": "2010-01-21T02:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43965",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:13" align="right">comment:13</div>

I've applied every one of Burcin's patches I could find, and get only one type of doctest failure with all of them (when applied in the right order).  So so far so good!  Unfortunately, I can't review any of them for two reasons - my understanding of C++/Pynac is not reliable enough to do a good job, and there are so many failures until one applies *all* the patches that it's hard to separate out what's what.

The reason I say that here is that I do get a significant failure, in a few different files, for the `_tderivative_` method, though the actual failure occurs as a RuntimeError in line 216 of sage/misc/derivative.pyx (with no error message, more's the pity).  For instance, in line 99 of sage/symbolic/integration/integral.py, 

```
sage: f = function('f'); a,b = var('a,b')
sage: h = indefinite_integral(f(x), x)
sage: h.diff(x)
RuntimeError
```
I hope this helps track it down.



---

archive/issue_comments_043966.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nCan you download the package file again and install it?\n\nI forgot to include a patch when I first put the release together. I fixed the spkg file once I realized the problem, assuming no one looked at it yet. You must have downloaded in that period.\n\nSorry for the inconvenience and many thanks for trying these patches out.",
    "created_at": "2010-01-21T07:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43966",
    "user": "https://github.com/burcin"
}
```

<div id="comment:14" align="right">comment:14</div>

Can you download the package file again and install it?

I forgot to include a patch when I first put the release together. I fixed the spkg file once I realized the problem, assuming no one looked at it yet. You must have downloaded in that period.

Sorry for the inconvenience and many thanks for trying these patches out.



---

archive/issue_comments_043967.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@burcin](#comment%3A14):\n> Can you download the package file again and install it?\n> \n> I forgot to include a patch when I first put the release together. I fixed the spkg file once I realized the problem, assuming no one looked at it yet. You must have downloaded in that period.\n\nI now get\n\n```\nsage: h.diff(x)\nf(x)\n```\n\nHowever, I now get some errors after applying all patches up to and including this set.  Some should also be marked # optional - requires Internet (the mathematica_free ones).  They all seem to be related to some extra keyword being passed to the DeprecatedSFunction constructor.\n\n```\nsage -t  \"devel/sage/sage/symbolic/integration/integration.py\"\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 29:\n    sage: from sage.symbolic.integration.integration import _maxima_integrator\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[2]>\", line 1, in <module>\n        from sage.symbolic.integration.integration import _maxima_integrator###line 29:\n    sage: from sage.symbolic.integration.integration import _maxima_integrator\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 316, in <module>\n        integral = SymbolicIntegration()\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 152, in __init__\n        SFunction.__init__(self, \"integrate\", *args, **kwds)\n      File \"function.pyx\", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)\n    TypeError: __init__() got an unexpected keyword argument 'built_in_function'\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 30:\n    sage: _maxima_integrator(sin(x), x)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[3]>\", line 1, in <module>\n        _maxima_integrator(sin(x), x)###line 30:\n    sage: _maxima_integrator(sin(x), x)\n    NameError: name '_maxima_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 33:\n    sage: _maxima_integrator(f(x), x)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: Maxima failed to integrate\nGot:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[5]>\", line 1, in <module>\n        _maxima_integrator(f(x), x)###line 33:\n    sage: _maxima_integrator(f(x), x)\n    NameError: name '_maxima_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 293:\n    sage: from sage.symbolic.integration.integration import integral\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[2]>\", line 1, in <module>\n        from sage.symbolic.integration.integration import integral###line 293:\n    sage: from sage.symbolic.integration.integration import integral\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 316, in <module>\n        integral = SymbolicIntegration()\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 152, in __init__\n        SFunction.__init__(self, \"integrate\", *args, **kwds)\n      File \"function.pyx\", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)\n    TypeError: __init__() got an unexpected keyword argument 'built_in_function'\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 294:\n    sage: _ilatex = integral._print_latex_\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[3]>\", line 1, in <module>\n        _ilatex = integral._print_latex_###line 294:\n    sage: _ilatex = integral._print_latex_\n    AttributeError: 'function' object has no attribute '_print_latex_'\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 298:\n    sage: _ilatex(f(x),x)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[6]>\", line 1, in <module>\n        _ilatex(f(x),x)###line 298:\n    sage: _ilatex(f(x),x)\n    NameError: name '_ilatex' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 300:\n    sage: _ilatex(f(x),x,a,b)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[7]>\", line 1, in <module>\n        _ilatex(f(x),x,a,b)###line 300:\n    sage: _ilatex(f(x),x,a,b)\n    NameError: name '_ilatex' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 51:\n    sage: from sage.symbolic.integration.integration import _sympy_integrator\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[2]>\", line 1, in <module>\n        from sage.symbolic.integration.integration import _sympy_integrator###line 51:\n    sage: from sage.symbolic.integration.integration import _sympy_integrator\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 316, in <module>\n        integral = SymbolicIntegration()\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 152, in __init__\n        SFunction.__init__(self, \"integrate\", *args, **kwds)\n      File \"function.pyx\", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)\n    TypeError: __init__() got an unexpected keyword argument 'built_in_function'\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 52:\n    sage: _sympy_integrator(sin(x), x)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[3]>\", line 1, in <module>\n        _sympy_integrator(sin(x), x)###line 52:\n    sage: _sympy_integrator(sin(x), x)\n    NameError: name '_sympy_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 55:\n    sage: _sympy_integrator(f(x), x)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: Sympy failed to integrate\nGot:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[5]>\", line 1, in <module>\n        _sympy_integrator(f(x), x)###line 55:\n    sage: _sympy_integrator(f(x), x)\n    NameError: name '_sympy_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 76:\n    sage: from sage.symbolic.integration.integration import _mathematica_free_integrator\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[2]>\", line 1, in <module>\n        from sage.symbolic.integration.integration import _mathematica_free_integrator###line 76:\n    sage: from sage.symbolic.integration.integration import _mathematica_free_integrator\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 316, in <module>\n        integral = SymbolicIntegration()\n      File \"/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py\", line 152, in __init__\n        SFunction.__init__(self, \"integrate\", *args, **kwds)\n      File \"function.pyx\", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)\n    TypeError: __init__() got an unexpected keyword argument 'built_in_function'\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 77:\n    sage: _mathematica_free_integrator(sin(x), x)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[3]>\", line 1, in <module>\n        _mathematica_free_integrator(sin(x), x)###line 77:\n    sage: _mathematica_free_integrator(sin(x), x)\n    NameError: name '_mathematica_free_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 80:\n    sage: _mathematica_free_integrator(f(x), x)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: mathematica_free failed to integrate\nGot:\n    Traceback (most recent call last):\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/.../sage-4.3.1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[5]>\", line 1, in <module>\n        _mathematica_free_integrator(f(x), x)###line 80:\n    sage: _mathematica_free_integrator(f(x), x)\n    NameError: name '_mathematica_free_integrator' is not defined\n**********************************************************************\nFile \"/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py\", line 241:\n    sage: h.n()\nExpected:\n    0.472399177268953\nGot:\n    0.47239917726895253\n**********************************************************************\n5 items had failures:\n   3 of   6 in __main__.example_1\n   4 of   9 in __main__.example_10\n   3 of   6 in __main__.example_2\n   3 of   6 in __main__.example_3\n   1 of   4 in __main__.example_8\n***Test Failed*** 14 failures.\n\t [6.5 s]\n```\n\n> Sorry for the inconvenience and many thanks for trying these patches out.\n\nNo problem.  Although I *strongly* disagree with the removal of indefinite integration longterm without explicit variable, overall this set of changes will be a big improvement.  I am sorry again I cannot review much of the C++ related stuff, or the Pynac changes, though I am glad they are now up on [|pynac.sagemath.org] !",
    "created_at": "2010-01-28T21:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43967",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@burcin](#comment%3A14):
> Can you download the package file again and install it?
> 
> I forgot to include a patch when I first put the release together. I fixed the spkg file once I realized the problem, assuming no one looked at it yet. You must have downloaded in that period.

I now get

```
sage: h.diff(x)
f(x)
```

However, I now get some errors after applying all patches up to and including this set.  Some should also be marked # optional - requires Internet (the mathematica_free ones).  They all seem to be related to some extra keyword being passed to the DeprecatedSFunction constructor.

```
sage -t  "devel/sage/sage/symbolic/integration/integration.py"
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 29:
    sage: from sage.symbolic.integration.integration import _maxima_integrator
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[2]>", line 1, in <module>
        from sage.symbolic.integration.integration import _maxima_integrator###line 29:
    sage: from sage.symbolic.integration.integration import _maxima_integrator
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 316, in <module>
        integral = SymbolicIntegration()
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 152, in __init__
        SFunction.__init__(self, "integrate", *args, **kwds)
      File "function.pyx", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)
    TypeError: __init__() got an unexpected keyword argument 'built_in_function'
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 30:
    sage: _maxima_integrator(sin(x), x)
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[3]>", line 1, in <module>
        _maxima_integrator(sin(x), x)###line 30:
    sage: _maxima_integrator(sin(x), x)
    NameError: name '_maxima_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 33:
    sage: _maxima_integrator(f(x), x)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Maxima failed to integrate
Got:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[5]>", line 1, in <module>
        _maxima_integrator(f(x), x)###line 33:
    sage: _maxima_integrator(f(x), x)
    NameError: name '_maxima_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 293:
    sage: from sage.symbolic.integration.integration import integral
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[2]>", line 1, in <module>
        from sage.symbolic.integration.integration import integral###line 293:
    sage: from sage.symbolic.integration.integration import integral
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 316, in <module>
        integral = SymbolicIntegration()
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 152, in __init__
        SFunction.__init__(self, "integrate", *args, **kwds)
      File "function.pyx", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)
    TypeError: __init__() got an unexpected keyword argument 'built_in_function'
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 294:
    sage: _ilatex = integral._print_latex_
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[3]>", line 1, in <module>
        _ilatex = integral._print_latex_###line 294:
    sage: _ilatex = integral._print_latex_
    AttributeError: 'function' object has no attribute '_print_latex_'
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 298:
    sage: _ilatex(f(x),x)
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[6]>", line 1, in <module>
        _ilatex(f(x),x)###line 298:
    sage: _ilatex(f(x),x)
    NameError: name '_ilatex' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 300:
    sage: _ilatex(f(x),x,a,b)
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[7]>", line 1, in <module>
        _ilatex(f(x),x,a,b)###line 300:
    sage: _ilatex(f(x),x,a,b)
    NameError: name '_ilatex' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 51:
    sage: from sage.symbolic.integration.integration import _sympy_integrator
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[2]>", line 1, in <module>
        from sage.symbolic.integration.integration import _sympy_integrator###line 51:
    sage: from sage.symbolic.integration.integration import _sympy_integrator
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 316, in <module>
        integral = SymbolicIntegration()
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 152, in __init__
        SFunction.__init__(self, "integrate", *args, **kwds)
      File "function.pyx", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)
    TypeError: __init__() got an unexpected keyword argument 'built_in_function'
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 52:
    sage: _sympy_integrator(sin(x), x)
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[3]>", line 1, in <module>
        _sympy_integrator(sin(x), x)###line 52:
    sage: _sympy_integrator(sin(x), x)
    NameError: name '_sympy_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 55:
    sage: _sympy_integrator(f(x), x)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Sympy failed to integrate
Got:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[5]>", line 1, in <module>
        _sympy_integrator(f(x), x)###line 55:
    sage: _sympy_integrator(f(x), x)
    NameError: name '_sympy_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 76:
    sage: from sage.symbolic.integration.integration import _mathematica_free_integrator
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[2]>", line 1, in <module>
        from sage.symbolic.integration.integration import _mathematica_free_integrator###line 76:
    sage: from sage.symbolic.integration.integration import _mathematica_free_integrator
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 316, in <module>
        integral = SymbolicIntegration()
      File "/Users/.../sage-4.3.1/local/lib/python/site-packages/sage/symbolic/integration/integration.py", line 152, in __init__
        SFunction.__init__(self, "integrate", *args, **kwds)
      File "function.pyx", line 1059, in sage.symbolic.function.DeprecatedSFunction.__init__ (sage/symbolic/function.cpp:8588)
    TypeError: __init__() got an unexpected keyword argument 'built_in_function'
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 77:
    sage: _mathematica_free_integrator(sin(x), x)
Exception raised:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[3]>", line 1, in <module>
        _mathematica_free_integrator(sin(x), x)###line 77:
    sage: _mathematica_free_integrator(sin(x), x)
    NameError: name '_mathematica_free_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 80:
    sage: _mathematica_free_integrator(f(x), x)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: mathematica_free failed to integrate
Got:
    Traceback (most recent call last):
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/.../sage-4.3.1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[5]>", line 1, in <module>
        _mathematica_free_integrator(f(x), x)###line 80:
    sage: _mathematica_free_integrator(f(x), x)
    NameError: name '_mathematica_free_integrator' is not defined
**********************************************************************
File "/Users/.../sage-4.3.1/devel/sage/sage/symbolic/integration/integration.py", line 241:
    sage: h.n()
Expected:
    0.472399177268953
Got:
    0.47239917726895253
**********************************************************************
5 items had failures:
   3 of   6 in __main__.example_1
   4 of   9 in __main__.example_10
   3 of   6 in __main__.example_2
   3 of   6 in __main__.example_3
   1 of   4 in __main__.example_8
***Test Failed*** 14 failures.
	 [6.5 s]
```

> Sorry for the inconvenience and many thanks for trying these patches out.

No problem.  Although I *strongly* disagree with the removal of indefinite integration longterm without explicit variable, overall this set of changes will be a big improvement.  I am sorry again I cannot review much of the C++ related stuff, or the Pynac changes, though I am glad they are now up on [|pynac.sagemath.org] !



---

archive/issue_events_077479.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-01-28T21:00:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77479"
}
```



---

archive/issue_events_077480.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-01-28T21:00:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77480"
}
```



---

archive/issue_comments_043968.json:
```json
{
    "body": "Changed reviewer from **Tim Dumol** to **Tim Dumol, Karl-Dieter Crisman**",
    "created_at": "2010-01-28T21:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43968",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Tim Dumol** to **Tim Dumol, Karl-Dieter Crisman**



---

archive/issue_comments_043969.json:
```json
{
    "body": "Attachment: **[trac_6465-integral.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)**\n\nnew version",
    "created_at": "2010-01-31T21:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43969",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_6465-integral.take2.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)**

new version



---

archive/issue_events_077481.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-01-31T21:23:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77481"
}
```



---

archive/issue_events_077482.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-01-31T21:23:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77482"
}
```



---

archive/issue_comments_043970.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n[attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz) renames the file `sage/symbolic/integration/integration.py` to `sage/symbolic/integration/integral.py`. Are you sure you applied the patches correctly? Since these are git style diffs using `hg import` or `hg qimport` is recommended.\n\nI applied the whole batch of symbolics patches associated to pynac-0.11 to 4.3.2.alpha0, and tested the sage/{symbolic,calculus,functions} directories. The only doctest failure I got was in  `sage/symbolic/integration/external.py`. [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz) removes this dubious test.\n\nThe patches that need to be applied from this ticket are now:\n* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)\n* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)\n* [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)",
    "created_at": "2010-01-31T21:23:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43970",
    "user": "https://github.com/burcin"
}
```

<div id="comment:16" align="right">comment:16</div>

[attachment: trac_6465-integral.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.patch.gz) renames the file `sage/symbolic/integration/integration.py` to `sage/symbolic/integration/integral.py`. Are you sure you applied the patches correctly? Since these are git style diffs using `hg import` or `hg qimport` is recommended.

I applied the whole batch of symbolics patches associated to pynac-0.11 to 4.3.2.alpha0, and tested the sage/{symbolic,calculus,functions} directories. The only doctest failure I got was in  `sage/symbolic/integration/external.py`. [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz) removes this dubious test.

The patches that need to be applied from this ticket are now:
* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)
* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)
* [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)



---

archive/issue_comments_043971.json:
```json
{
    "body": "fix numerical problems in doctests",
    "created_at": "2010-02-03T10:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43971",
    "user": "https://github.com/burcin"
}
```

fix numerical problems in doctests



---

archive/issue_comments_043972.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[trac_6465-integral.take3.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take3.patch.gz)**\n\nAfter testing on a 32-bit Debian box, I uploaded [attachment: trac_6465-integral.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take3.patch.gz) to replace [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)The only difference is the `...` used for the trailing digits of the numerical integral on line 188 of `sage/symbolic/integration/integral.py`.\n\nThe patches that need to be applied are: \n* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)\n* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)\n* [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)",
    "created_at": "2010-02-03T11:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43972",
    "user": "https://github.com/burcin"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[trac_6465-integral.take3.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take3.patch.gz)**

After testing on a 32-bit Debian box, I uploaded [attachment: trac_6465-integral.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take3.patch.gz) to replace [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)The only difference is the `...` used for the trailing digits of the numerical integral on line 188 of `sage/symbolic/integration/integral.py`.

The patches that need to be applied are: 
* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)
* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take2.patch.gz)
* [attachment: trac_6465-integral.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take2.patch.gz)



---

archive/issue_comments_043973.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOops, the last patch to be applied is [attachment: trac_6465-integral.take3.patch!](https://github.com/sagemath/sage/files/ticket6465/17e0c8479c66d210c37d8b38693bea7e.gz) That was a typo in the list above.",
    "created_at": "2010-02-04T09:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43973",
    "user": "https://github.com/burcin"
}
```

<div id="comment:18" align="right">comment:18</div>

Oops, the last patch to be applied is [attachment: trac_6465-integral.take3.patch!](https://github.com/sagemath/sage/files/ticket6465/17e0c8479c66d210c37d8b38693bea7e.gz) That was a typo in the list above.



---

archive/issue_comments_043974.json:
```json
{
    "body": "Attachment: **[trac_6465-integral.take4.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)**\n\nrebased to 4.3.2",
    "created_at": "2010-02-09T10:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43974",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_6465-integral.take4.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)**

rebased to 4.3.2



---

archive/issue_comments_043975.json:
```json
{
    "body": "rebased to 4.3.2",
    "created_at": "2010-02-09T10:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43975",
    "user": "https://github.com/burcin"
}
```

rebased to 4.3.2



---

archive/issue_comments_043976.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAttachment: **[trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)**\n\nI rebased the patches to 4.3.2. Patches to be applied are now:\n\n* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)\n* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)\n* [attachment: trac_6465-integral.take4.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)",
    "created_at": "2010-02-09T11:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43976",
    "user": "https://github.com/burcin"
}
```

<div id="comment:19" align="right">comment:19</div>

Attachment: **[trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)**

I rebased the patches to 4.3.2. Patches to be applied are now:

* [attachment: trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)
* [attachment: trac_6465-moves-integration-into-sfunction-subclass.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)
* [attachment: trac_6465-integral.take4.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)



---

archive/issue_comments_043977.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe patch solves the stated problem without loss of functionality (at\nleast in the tests below). +1 for positive review.\n\n```\nsage: f(x) = function('f',x)\nsage: g = integrate(f(x),x)\nsage: g.diff(x)\nf(x)\nsage: integrate(f(x),x).diff(x)\nf(x)\n\nsage: h(x,y) = function('h',x,y)\nsage: kx = integrate(h(x,y),x)\nsage: kx\nintegrate(h(x, y), x)\nsage: kx.diff(x)\nh(x, y)\n\nsage: kxy = integrate( integrate(h(x,y),x), y)\nsage: kxy\nintegrate(integrate(h(x, y), x), y)\nsage: kxy.diff(y).diff(x)\nh(x, y)\nsage: kxy.diff(x).diff(y)\nh(x, y)\nsage: kxy.diff(x)\nintegrate(h(x, y), y)\n\nsage: integrate(1/(2*x+1)^2, x, 0, 1)\n1/3\n\nsage: loads(dumps(integrate(1/(2*x+1)^2, x, 0, 1))) == 1/3\nTrue\n\nsage: integrate(1/(2*x+1)^2, x, 0.0, 1.0)\n0.333333333333\n\nsage: integrate(1/(2*x+1)^2, x, 0, 1.0)\n0.333333333333\n\nsage: integrate(1/(2*x+1)^2, x, CC(0), 1.0)\n0.333333333333\n\nsage: integrate(x/(1+x^2),x)\n1/2*log(x^2 + 1)\n\nsage: integrate(tan(x),x)\nlog(sec(x))\n```\n\nThere is one issue (that is not necessarily a part of this ticket). \nI may be wrong but I'm reasonably sure that in general that \nintegrate( integrate(h(x,y),x), y).diff(y).diff(x) <>\nintegrate( integrate(h(x,y),x), y).diff(x).diff(y)\nBut the following seems to imply it is (both are equal to h(x, y) )\n\n```\nsage: kxy = integrate( integrate(h(x,y),x), y)\nsage: kxy\nintegrate(integrate(h(x, y), x), y)\nsage: kxy.diff(y).diff(x)\nh(x, y)\nsage: kxy.diff(x).diff(y)\nh(x, y)\n```",
    "created_at": "2010-02-18T14:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43977",
    "user": "https://github.com/sagetrac-rossk"
}
```

<div id="comment:20" align="right">comment:20</div>

The patch solves the stated problem without loss of functionality (at
least in the tests below). +1 for positive review.

```
sage: f(x) = function('f',x)
sage: g = integrate(f(x),x)
sage: g.diff(x)
f(x)
sage: integrate(f(x),x).diff(x)
f(x)

sage: h(x,y) = function('h',x,y)
sage: kx = integrate(h(x,y),x)
sage: kx
integrate(h(x, y), x)
sage: kx.diff(x)
h(x, y)

sage: kxy = integrate( integrate(h(x,y),x), y)
sage: kxy
integrate(integrate(h(x, y), x), y)
sage: kxy.diff(y).diff(x)
h(x, y)
sage: kxy.diff(x).diff(y)
h(x, y)
sage: kxy.diff(x)
integrate(h(x, y), y)

sage: integrate(1/(2*x+1)^2, x, 0, 1)
1/3

sage: loads(dumps(integrate(1/(2*x+1)^2, x, 0, 1))) == 1/3
True

sage: integrate(1/(2*x+1)^2, x, 0.0, 1.0)
0.333333333333

sage: integrate(1/(2*x+1)^2, x, 0, 1.0)
0.333333333333

sage: integrate(1/(2*x+1)^2, x, CC(0), 1.0)
0.333333333333

sage: integrate(x/(1+x^2),x)
1/2*log(x^2 + 1)

sage: integrate(tan(x),x)
log(sec(x))
```

There is one issue (that is not necessarily a part of this ticket). 
I may be wrong but I'm reasonably sure that in general that 
integrate( integrate(h(x,y),x), y).diff(y).diff(x) <>
integrate( integrate(h(x,y),x), y).diff(x).diff(y)
But the following seems to imply it is (both are equal to h(x, y) )

```
sage: kxy = integrate( integrate(h(x,y),x), y)
sage: kxy
integrate(integrate(h(x, y), x), y)
sage: kxy.diff(y).diff(x)
h(x, y)
sage: kxy.diff(x).diff(y)
h(x, y)
```



---

archive/issue_comments_043978.json:
```json
{
    "body": "Changed reviewer from **Tim Dumol, Karl-Dieter Crisman** to **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou**",
    "created_at": "2010-02-18T14:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43978",
    "user": "https://github.com/sagetrac-rossk"
}
```

Changed reviewer from **Tim Dumol, Karl-Dieter Crisman** to **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou**



---

archive/issue_comments_043979.json:
```json
{
    "body": "Changed reviewer from **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou** to **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou, Minh Van Nguyen**",
    "created_at": "2010-02-18T21:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43979",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed reviewer from **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou** to **Tim Dumol, Karl-Dieter Crisman, Ross Kyprianou, Minh Van Nguyen**



---

archive/issue_events_077483.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-02-18T21:29:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77483"
}
```



---

archive/issue_events_077484.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-02-18T21:29:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77484"
}
```



---

archive/issue_comments_043980.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe rebase looks good. See #6961 for the order in which to apply patches.",
    "created_at": "2010-02-18T21:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43980",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:21" align="right">comment:21</div>

The rebase looks good. See #6961 for the order in which to apply patches.



---

archive/issue_comments_043981.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nMerged in this order:\n\n1. [trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)\n2. [trac_6465-moves-integration-into-sfunction-subclass.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)\n3. [trac_6465-integral.take4.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)",
    "created_at": "2010-02-18T21:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43981",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:22" align="right">comment:22</div>

Merged in this order:

1. [trac_6465-chain_rule.take2.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-chain_rule.take2.patch.gz)
2. [trac_6465-moves-integration-into-sfunction-subclass.take3.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-moves-integration-into-sfunction-subclass.take3.patch.gz)
3. [trac_6465-integral.take4.patch](https://github.com/sagemath/sage/files/ticket6465/trac_6465-integral.take4.patch.gz)



---

archive/issue_events_077485.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-02-18T21:51:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77485"
}
```



---

archive/issue_events_077486.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-02-18T21:51:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6465#event-77486"
}
```



---

archive/issue_comments_043982.json:
```json
{
    "body": "Merged: **sage-4.3.3.alpha1**",
    "created_at": "2010-02-18T21:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6465",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6465#issuecomment-43982",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.3.alpha1**
