# Issue 6083: speedup integer division

archive/issues_006083.json:
```json
{
    "body": "remove _sig_on and _sig_off for small operands, specialize for int divisor\n\n**Author:** Robert Bradshaw\n\n**Reviewer:** Craig Citro\n\n**Merged:** sage-4.1.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6083\n\n",
    "closed_at": "2009-07-04T02:09:23Z",
    "created_at": "2009-05-19T07:35:58Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "title": "speedup integer division",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6083",
    "user": "https://github.com/robertwb"
}
```
remove _sig_on and _sig_off for small operands, specialize for int divisor

**Author:** Robert Bradshaw

**Reviewer:** Craig Citro

**Merged:** sage-4.1.rc0

Issue created by migration from https://trac.sagemath.org/ticket/6083





---

archive/attachments_007113.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "6083-integer-div.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6083/6083-integer-div.patch",
    "created_at": "2009-05-20T03:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_042204.json:
```json
{
    "body": "",
    "created_at": "2009-05-20T03:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42204",
    "user": "https://github.com/robertwb"
}
```





---

archive/issue_comments_042205.json:
```json
{
    "body": "<a id='comment:1'></a>\nI now get one trivial test failure (changed exception message):\n\n```\nFile \"/home/fredrik/sage-4.0/devel/sage-mpmath/sage/rings/integer.pyx\", line 2163:\n    sage: z % 0\nExpected:\n    Traceback (most recent call last):\n    ...\n    ZeroDivisionError: Integer modulo by zero\nGot:\n    Traceback (most recent call last):\n      File \"/space/wstein/farm/sage-4.0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/space/wstein/farm/sage-4.0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/space/wstein/farm/sage-4.0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_46[4]>\", line 1, in <module>\n        z % Integer(0)###line 2163:\n    sage: z % 0\n      File \"integer.pyx\", line 2189, in sage.rings.integer.Integer.__mod__ (sage/rings/integer.c:15033)\n    ZeroDivisionError: other must be nonzero\n```\n\nOtherwise, this patch has my approval.",
    "created_at": "2009-06-03T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42205",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:1'></a>
I now get one trivial test failure (changed exception message):

```
File "/home/fredrik/sage-4.0/devel/sage-mpmath/sage/rings/integer.pyx", line 2163:
    sage: z % 0
Expected:
    Traceback (most recent call last):
    ...
    ZeroDivisionError: Integer modulo by zero
Got:
    Traceback (most recent call last):
      File "/space/wstein/farm/sage-4.0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/space/wstein/farm/sage-4.0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/space/wstein/farm/sage-4.0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_46[4]>", line 1, in <module>
        z % Integer(0)###line 2163:
    sage: z % 0
      File "integer.pyx", line 2189, in sage.rings.integer.Integer.__mod__ (sage/rings/integer.c:15033)
    ZeroDivisionError: other must be nonzero
```

Otherwise, this patch has my approval.



---

archive/issue_comments_042206.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for looking at these. I'll fix this (the original error seems better).",
    "created_at": "2009-06-03T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42206",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>
Thanks for looking at these. I'll fix this (the original error seems better).



---

archive/issue_events_040245.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2009-06-05T04:47:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "rename": {
        "from": "speedup integer division",
        "to": "[with patch, with positive review modulo referee's patch] speedup integer division"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40245"
}
```



---

archive/issue_comments_042207.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis patch looks good. I've added a referee patch that makes a few really minor changes:\n\n* removes the unused `_floordiv` function\n* changes the error messages: they all now say either \"Integer division by zero\" or \"Integer modulo by zero.\" I think these are more informative, and they also now mirror the Python ones (which all say \"integer division or modulus by zero\"). The old ones were of the form `\"other (=%s) must be nonzero\"%other`, and by definition **always** had other equal to 0, so that just seemed silly. \n\nUnless Robert or Fredrik has any objections to the second patch, I'd say this is good to go.",
    "created_at": "2009-06-05T04:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42207",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:3'></a>
This patch looks good. I've added a referee patch that makes a few really minor changes:

* removes the unused `_floordiv` function
* changes the error messages: they all now say either "Integer division by zero" or "Integer modulo by zero." I think these are more informative, and they also now mirror the Python ones (which all say "integer division or modulus by zero"). The old ones were of the form `"other (=%s) must be nonzero"%other`, and by definition **always** had other equal to 0, so that just seemed silly. 

Unless Robert or Fredrik has any objections to the second patch, I'd say this is good to go.



---

archive/issue_comments_042208.json:
```json
{
    "body": "<a id='comment:4'></a>\nYep, looks good.",
    "created_at": "2009-06-05T11:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42208",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'></a>
Yep, looks good.



---

archive/issue_events_040246.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-06-05T11:15:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "rename": {
        "from": "[with patch, with positive review modulo referee's patch] speedup integer division",
        "to": "speedup integer division"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40246"
}
```



---

archive/issue_events_040247.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-06-05T11:15:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40247"
}
```



---

archive/issue_comments_042209.json:
```json
{
    "body": "<a id='comment:5'></a>\nUnfortunately, this causes a segfault with the 4.0.2.alpha0 singular:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n        sage -t -long devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # Segfault\n----------------------------------------------------------------------\nTotal time for all tests: 524.4 seconds\nTests failed!\n```",
    "created_at": "2009-06-13T21:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42209",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:5'></a>
Unfortunately, this causes a segfault with the 4.0.2.alpha0 singular:

```
----------------------------------------------------------------------

The following tests failed:

        sage -t -long devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # Segfault
----------------------------------------------------------------------
Total time for all tests: 524.4 seconds
Tests failed!
```



---

archive/issue_events_040248.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:06:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40248"
}
```



---

archive/issue_events_040249.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:06:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40249"
}
```



---

archive/attachments_007114.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-6083-referee.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6083/trac-6083-referee.patch",
    "created_at": "2009-06-22T07:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/craigcitro"
}
```



---

archive/issue_comments_042210.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt turns out the segfault was coming from an infinite loop in Cython. The issue was that after the first patch above, doing `Integer % IntegerMod_gmp` would call into the `__mod__` on `IntegerMod_gmp`, which tried to check if something was zero by doing something of the form `Integer % IntegerMod_gmp` ... and repeat ad infinitum. \n\nSo the new patch adds a small snippet to fix this, and a doctest.",
    "created_at": "2009-06-22T07:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42210",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:6'></a>
It turns out the segfault was coming from an infinite loop in Cython. The issue was that after the first patch above, doing `Integer % IntegerMod_gmp` would call into the `__mod__` on `IntegerMod_gmp`, which tried to check if something was zero by doing something of the form `Integer % IntegerMod_gmp` ... and repeat ad infinitum. 

So the new patch adds a small snippet to fix this, and a doctest.



---

archive/issue_events_040250.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2009-06-22T07:45:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40250"
}
```



---

archive/issue_events_040251.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2009-06-22T07:45:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40251"
}
```



---

archive/issue_comments_042211.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlthough I have not been following all the details of this one, I applied all patches successfully to 4.1.alpha2 and ran -testall successfully, so I'm giving it a positive review.",
    "created_at": "2009-06-28T13:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42211",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
Although I have not been following all the details of this one, I applied all patches successfully to 4.1.alpha2 and ran -testall successfully, so I'm giving it a positive review.



---

archive/issue_events_040252.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-06-28T13:18:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40252"
}
```



---

archive/issue_events_040253.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-06-28T13:18:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40253"
}
```



---

archive/issue_events_040254.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T02:09:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40254"
}
```



---

archive/issue_events_040255.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T02:09:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6083#event-40255"
}
```



---

archive/issue_comments_042212.json:
```json
{
    "body": "**Author:** Robert Bradshaw",
    "created_at": "2009-07-04T02:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42212",
    "user": "https://github.com/rlmill"
}
```

**Author:** Robert Bradshaw



---

archive/issue_comments_042213.json:
```json
{
    "body": "**Merged:** sage-4.1.rc0",
    "created_at": "2009-07-04T02:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42213",
    "user": "https://github.com/rlmill"
}
```

**Merged:** sage-4.1.rc0



---

archive/issue_comments_042214.json:
```json
{
    "body": "**Reviewer:** Craig Citro",
    "created_at": "2009-07-04T02:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6083#issuecomment-42214",
    "user": "https://github.com/rlmill"
}
```

**Reviewer:** Craig Citro
