# Issue 6523: .is_zero() method raises error for symbolic expression involving derivative

archive/issues_006523.json:
```json
{
    "body": "If a symbolic expression contains \u00a0symbolic derivative then\nchecking whether it is zero, raises error:\n\n```\nsage: x.diff(x,2).is_zero()\nTrue\n\nsage: f(x) = function('f',x)\nsage: f(x).diff(x).is_zero()\n....\nNotImplementedError: derivative\n```\n\nThis fails because new symbolics tries to convert it to maxima\nexpression for checking the relation.\n\n**Update:**\n\n***** A patch to fix the issue is attached. The patch \nadds a new method \".has_fderivative()\" for symbolic expressions \nand in `__nonzero__` method adds a check whether it has fderivative.\n\n**Comments**  (for future works):\nA simple timing comparison that illustrates why we should\navoid calling maxima to assert nonzero even for symbolic \nfunctions\n\n```\nsage: f(x) = function('f',x)\nsage: timeit('sin(f(x)).is_zero()')\n5 loops, best of 3: 85.8 ms per loop\nsage: timeit('sin(f(x).diff(x)).is_zero()')\n625 loops, best of 3: 132 \u00b5s per loop\n```  \n\nIt seems pynac is 400 times faster than maxima in this case.\n\n\nCC:  @mwhansen\n\nResolution: fixed\n\nAuthor: Burcin Erocal\n\nReviewer: Mike Hansen\n\nMerged: sage-4.3.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6523\n\n",
    "closed_at": "2009-12-06T08:33:39Z",
    "created_at": "2009-07-13T11:39:09Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3",
    "title": ".is_zero() method raises error for symbolic expression involving derivative",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6523",
    "user": "https://github.com/golam-m-hossain"
}
```
If a symbolic expression contains  symbolic derivative then
checking whether it is zero, raises error:

```
sage: x.diff(x,2).is_zero()
True

sage: f(x) = function('f',x)
sage: f(x).diff(x).is_zero()
....
NotImplementedError: derivative
```

This fails because new symbolics tries to convert it to maxima
expression for checking the relation.

**Update:**

***** A patch to fix the issue is attached. The patch 
adds a new method ".has_fderivative()" for symbolic expressions 
and in `__nonzero__` method adds a check whether it has fderivative.

**Comments**  (for future works):
A simple timing comparison that illustrates why we should
avoid calling maxima to assert nonzero even for symbolic 
functions

```
sage: f(x) = function('f',x)
sage: timeit('sin(f(x)).is_zero()')
5 loops, best of 3: 85.8 ms per loop
sage: timeit('sin(f(x).diff(x)).is_zero()')
625 loops, best of 3: 132 µs per loop
```  

It seems pynac is 400 times faster than maxima in this case.


CC:  @mwhansen

Resolution: fixed

Author: Burcin Erocal

Reviewer: Mike Hansen

Merged: sage-4.3.rc0

Issue created by migration from https://trac.sagemath.org/ticket/6523





---

archive/issue_comments_053098.json:
```json
{
    "body": "Attachment [trac_6523-fixes-error-in-is_zero_method_for_symbolic_derivative.patch](tarball://root/attachments/some-uuid/ticket6523/trac_6523-fixes-error-in-is_zero_method_for_symbolic_derivative.patch) by @golam-m-hossain created at 2009-07-15 15:56:46",
    "created_at": "2009-07-15T15:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53098",
    "user": "https://github.com/golam-m-hossain"
}
```

Attachment [trac_6523-fixes-error-in-is_zero_method_for_symbolic_derivative.patch](tarball://root/attachments/some-uuid/ticket6523/trac_6523-fixes-error-in-is_zero_method_for_symbolic_derivative.patch) by @golam-m-hossain created at 2009-07-15 15:56:46



---

archive/issue_events_015395.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-08-01T11:16:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "milestone": "sage-4.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6523#event-15395"
}
```



---

archive/issue_comments_053099.json:
```json
{
    "body": "<a id='comment:2'></a>Unfortunately, the fact that an expression contains a symbolic derivative doesn't guarantee that it is nonzero:\n\n```\nsage: t = f(x).derivative(x)\nsage: (x*t +(1-x)*t - t)\n-(x - 1)*D[1](f)(x) + x*D[1](f)(x) - D[1](f)(x)\nsage: (x*t +(1-x)*t - t).collect(x)\n0\n```\n\nThe right fix for this is to either implement the `.derivative()` method in `sage/symbolic/expression_conversions.py` or to change pynac to allow different parents in `evalf()`, so that conversion to `CIF` can be done without the code in `expression_conversions.pyx`. \n\nI was planning to do this for #6243, but ended up using a different/better fix there.",
    "created_at": "2009-08-01T11:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53099",
    "user": "https://github.com/burcin"
}
```

<a id='comment:2'></a>Unfortunately, the fact that an expression contains a symbolic derivative doesn't guarantee that it is nonzero:

```
sage: t = f(x).derivative(x)
sage: (x*t +(1-x)*t - t)
-(x - 1)*D[1](f)(x) + x*D[1](f)(x) - D[1](f)(x)
sage: (x*t +(1-x)*t - t).collect(x)
0
```

The right fix for this is to either implement the `.derivative()` method in `sage/symbolic/expression_conversions.py` or to change pynac to allow different parents in `evalf()`, so that conversion to `CIF` can be done without the code in `expression_conversions.pyx`. 

I was planning to do this for #6243, but ended up using a different/better fix there.



---

archive/issue_comments_053100.json:
```json
{
    "body": "Attachment [trac_6523-derivative_is_zero.patch](tarball://root/attachments/some-uuid/ticket6523/trac_6523-derivative_is_zero.patch) by @burcin created at 2009-11-21 11:20:32\n\nadd doctests",
    "created_at": "2009-11-21T11:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53100",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_6523-derivative_is_zero.patch](tarball://root/attachments/some-uuid/ticket6523/trac_6523-derivative_is_zero.patch) by @burcin created at 2009-11-21 11:20:32

add doctests



---

archive/issue_comments_053101.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2009-11-21T11:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53101",
    "user": "https://github.com/burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_053102.json:
```json
{
    "body": "<a id='comment:3'></a>This is fixed by #7490, since we don't use the `expression_conversions` module to convert to `RIF` any more.\n\nattachment:trac_6523-derivative_is_zero.patch adds a doctest with the example in the description.",
    "created_at": "2009-11-21T11:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53102",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>This is fixed by #7490, since we don't use the `expression_conversions` module to convert to `RIF` any more.

attachment:trac_6523-derivative_is_zero.patch adds a doctest with the example in the description.



---

archive/issue_comments_053103.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-12-06T08:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53103",
    "user": "https://github.com/mwhansen"
}
```

Resolution: fixed



---

archive/issue_comments_053104.json:
```json
{
    "body": "<a id='comment:4'></a>Looks good to me.\n\nMerged trac_6523-derivative_is_zero.patch.",
    "created_at": "2009-12-06T08:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6523#issuecomment-53104",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:4'></a>Looks good to me.

Merged trac_6523-derivative_is_zero.patch.



---

archive/issue_events_015396.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-06T08:33:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6523",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6523#event-15396"
}
```
