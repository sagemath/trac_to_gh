# Issue 6956: cannot differentiate cotangent

archive/issues_006956.json:
```json
{
    "body": "From sage-support:\n\n```\nOn Fri, 18 Sep 2009 13:15:46 -0500\nJason Grout <jason-sage@creativetrax.com> wrote:\n\n> On alpha.sagenb.org, I get the following:\n> \n> sage: t=var('t')\n> sage: diff(cot(t),t)\n> D[0](cot)(t)\n> sage: diff(cos(t)/sin(t),t)\n> -cos(t)^2/sin(t)^2 - 1\n> \n> \n> Does Sage not know that cot(t) is cos(t)/sin(t)? \n```\nUnfortunately it doesn't. \n\nGiNaC doesn't define the function `cot`. Sage defines it in the file\n`sage/functions/trig.py` starting at line 184. I suppose it was written quickly by Mike during the symbolics switch.\n\nDefining a custom derivative function (named `_derivative_`) in that\nclass should fix this.\n\nHere is the thread:\n\nhttp://groups.google.com/group/sage-support/browse_thread/thread/752de34c876720cc\n\n\nCC:  @jasongrout @kcrisman\n\nReviewer: Burcin Erocal\n\nAuthor: Tim Dumol\n\nMerged: Sage 4.1.2.alpha4\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/6956\n\n",
    "closed_at": "2009-09-24T15:21:00Z",
    "created_at": "2009-09-18T18:32:18Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "cannot differentiate cotangent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6956",
    "user": "https://github.com/burcin"
}
```
From sage-support:

```
On Fri, 18 Sep 2009 13:15:46 -0500
Jason Grout <jason-sage@creativetrax.com> wrote:

> On alpha.sagenb.org, I get the following:
> 
> sage: t=var('t')
> sage: diff(cot(t),t)
> D[0](cot)(t)
> sage: diff(cos(t)/sin(t),t)
> -cos(t)^2/sin(t)^2 - 1
> 
> 
> Does Sage not know that cot(t) is cos(t)/sin(t)? 
```
Unfortunately it doesn't. 

GiNaC doesn't define the function `cot`. Sage defines it in the file
`sage/functions/trig.py` starting at line 184. I suppose it was written quickly by Mike during the symbolics switch.

Defining a custom derivative function (named `_derivative_`) in that
class should fix this.

Here is the thread:

http://groups.google.com/group/sage-support/browse_thread/thread/752de34c876720cc


CC:  @jasongrout @kcrisman

Reviewer: Burcin Erocal

Author: Tim Dumol

Merged: Sage 4.1.2.alpha4

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/6956





---

archive/issue_comments_072335.json:
```json
{
    "body": "Attachment [trac_6956-derivatives.patch](tarball://root/attachments/some-uuid/ticket6956/trac_6956-derivatives.patch) by @TimDumol created at 2009-09-19 00:24:46\n\nAdded _derivative() functions to all functions in `trig.py` and `hyperbolic.py`",
    "created_at": "2009-09-19T00:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72335",
    "user": "https://github.com/TimDumol"
}
```

Attachment [trac_6956-derivatives.patch](tarball://root/attachments/some-uuid/ticket6956/trac_6956-derivatives.patch) by @TimDumol created at 2009-09-19 00:24:46

Added _derivative() functions to all functions in `trig.py` and `hyperbolic.py`



---

archive/issue_comments_072336.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis should do the trick.",
    "created_at": "2009-09-19T00:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72336",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:1'></a>
This should do the trick.



---

archive/issue_comments_072337.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2009-09-19T00:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72337",
    "user": "https://github.com/TimDumol"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_072338.json:
```json
{
    "body": "Changing author from \"\" to \"Tim Joseph Dumol\"",
    "created_at": "2009-09-19T00:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72338",
    "user": "https://github.com/TimDumol"
}
```

Changing author from "" to "Tim Joseph Dumol"



---

archive/issue_comments_072339.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for the quick patch.\n\nHere is my review:\n* the keyword argument `diff_param` is only useful for multivariate functions. In this case since all these functions are univariate, so we know the argument is `args[0]`. You can safely drop the first two lines of the `_derivative_()` methods and replace the third with `x = args[0]`.\n* continuing the previous item, we should tell these functions they are univariate. ATM, they silently drop the second argument:\n\n```\nsage: arccsc(a,b)\narccsc(a)\n```\n You can do this by giving `nargs=1` as a parameter to the base class constructor.\n* It is better to give the variable as an argument to `diff` in the doctests, for example `diff(asech(x), x)`. I actually prefer `asech(x).derivative(x)`, but this is your patch. :)\n* The formula for the derivative of `asech(x)` you use is only true for x real. You need `-1/(x * (x+1) * sqrt( (1-x)/(1+x) ))`.\n* Similarly, the derivative of `acsch(x)` is `-1/(x^2 * sqrt(1 + 1/x^2) )`\n\nCan someone else check the derivatives to make sure there is no mistake?",
    "created_at": "2009-09-19T16:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72339",
    "user": "https://github.com/burcin"
}
```

<a id='comment:2'></a>
Thanks for the quick patch.

Here is my review:
* the keyword argument `diff_param` is only useful for multivariate functions. In this case since all these functions are univariate, so we know the argument is `args[0]`. You can safely drop the first two lines of the `_derivative_()` methods and replace the third with `x = args[0]`.
* continuing the previous item, we should tell these functions they are univariate. ATM, they silently drop the second argument:

```
sage: arccsc(a,b)
arccsc(a)
```
 You can do this by giving `nargs=1` as a parameter to the base class constructor.
* It is better to give the variable as an argument to `diff` in the doctests, for example `diff(asech(x), x)`. I actually prefer `asech(x).derivative(x)`, but this is your patch. :)
* The formula for the derivative of `asech(x)` you use is only true for x real. You need `-1/(x * (x+1) * sqrt( (1-x)/(1+x) ))`.
* Similarly, the derivative of `acsch(x)` is `-1/(x^2 * sqrt(1 + 1/x^2) )`

Can someone else check the derivatives to make sure there is no mistake?



---

archive/issue_comments_072340.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2009-09-19T16:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72340",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_072341.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Burcin Erocal\"",
    "created_at": "2009-09-19T16:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72341",
    "user": "https://github.com/burcin"
}
```

Changing reviewer from "" to "Burcin Erocal"



---

archive/issue_comments_072342.json:
```json
{
    "body": "Added `_derivative_()` functions to all functions in trig.py and hyperbolic.py. Rev 2. Apply this patch only.",
    "created_at": "2009-09-20T00:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72342",
    "user": "https://github.com/TimDumol"
}
```

Added `_derivative_()` functions to all functions in trig.py and hyperbolic.py. Rev 2. Apply this patch only.



---

archive/issue_comments_072343.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_6956-derivatives.2.patch](tarball://root/attachments/some-uuid/ticket6956/trac_6956-derivatives.2.patch) by @TimDumol created at 2009-09-20 00:31:20\n\nFunctions that inherit from `PrimitiveFunction` are automatically given `nargs = 1` on L800 of `symbolic/function.pyx`. So the silent dropping of arguments is more of a usability problem on the Symbolic side.\n\nI've made the changes for the derivatives of `asech(x)` and `acsch(x)`. I've also generalized the derivatives for `asec(x)` and `acsc(x)`.\n\nAnyone who wants to review the derivatives can check: http://mathworld.wolfram.com/Derivative.html, http://mathworld.wolfram.com/InverseHyperbolicFunctions.html and http://mathworld.wolfram.com/InverseTrigonometricFunctions.html",
    "created_at": "2009-09-20T00:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72343",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:3'></a>
Attachment [trac_6956-derivatives.2.patch](tarball://root/attachments/some-uuid/ticket6956/trac_6956-derivatives.2.patch) by @TimDumol created at 2009-09-20 00:31:20

Functions that inherit from `PrimitiveFunction` are automatically given `nargs = 1` on L800 of `symbolic/function.pyx`. So the silent dropping of arguments is more of a usability problem on the Symbolic side.

I've made the changes for the derivatives of `asech(x)` and `acsch(x)`. I've also generalized the derivatives for `asec(x)` and `acsc(x)`.

Anyone who wants to review the derivatives can check: http://mathworld.wolfram.com/Derivative.html, http://mathworld.wolfram.com/InverseHyperbolicFunctions.html and http://mathworld.wolfram.com/InverseTrigonometricFunctions.html



---

archive/issue_comments_072344.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2009-09-20T02:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72344",
    "user": "https://github.com/TimDumol"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_072345.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2009-09-22T11:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72345",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_072346.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [timdumol](#comment%3A3):\n> Functions that inherit from `PrimitiveFunction` are automatically given `nargs = 1` on L800 of `symbolic/function.pyx`. So the silent dropping of arguments is more of a usability problem on the Symbolic side.\n\n\nYou're right. I fixed this and many other things about symbolic functions last weekend, by rewriting sage/symbolic/function.pyx. Unfortunately I don't think I'll be able to clean up my changes and submit them any time soon... oh, well...\n\n\nI'm giving your patch a positive review. It applies cleanly, and passes all tests on my 4.1.1.alpha. Great job! Many thanks.",
    "created_at": "2009-09-22T11:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72346",
    "user": "https://github.com/burcin"
}
```

<a id='comment:5'></a>
Replying to [timdumol](#comment%3A3):
> Functions that inherit from `PrimitiveFunction` are automatically given `nargs = 1` on L800 of `symbolic/function.pyx`. So the silent dropping of arguments is more of a usability problem on the Symbolic side.


You're right. I fixed this and many other things about symbolic functions last weekend, by rewriting sage/symbolic/function.pyx. Unfortunately I don't think I'll be able to clean up my changes and submit them any time soon... oh, well...


I'm giving your patch a positive review. It applies cleanly, and passes all tests on my 4.1.1.alpha. Great job! Many thanks.



---

archive/issue_comments_072347.json:
```json
{
    "body": "<a id='comment:6'></a>\nburcin: it seems that there are several people interested in helping with symbolics, so maybe if you just posted what you had, people could clean it up for you, if that would be easier for your time situation?",
    "created_at": "2009-09-22T13:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72347",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
burcin: it seems that there are several people interested in helping with symbolics, so maybe if you just posted what you had, people could clean it up for you, if that would be easier for your time situation?



---

archive/issue_events_020923.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-09-24T15:21:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6956#event-20923"
}
```



---

archive/issue_comments_072348.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged `trac_6956-derivatives.2.patch`.",
    "created_at": "2009-09-24T15:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72348",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:7'></a>
Merged `trac_6956-derivatives.2.patch`.



---

archive/issue_comments_072349.json:
```json
{
    "body": "Changing merged from \"\" to \"Sage 4.1.2.alpha3\"",
    "created_at": "2009-09-24T15:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72349",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "" to "Sage 4.1.2.alpha3"



---

archive/issue_comments_072350.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-09-24T15:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72350",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_comments_072351.json:
```json
{
    "body": "Changing merged from \"Sage 4.1.2.alpha3\" to \"Sage 4.1.2.alpha4\"",
    "created_at": "2009-09-27T10:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72351",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "Sage 4.1.2.alpha3" to "Sage 4.1.2.alpha4"



---

archive/issue_comments_072352.json:
```json
{
    "body": "<a id='comment:8'></a>\nThere is no 4.1.2.alpha3. Sage 4.1.2.alpha3 was William Stein's release for working on making the notebook a standalone package.",
    "created_at": "2009-09-27T10:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72352",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:8'></a>
There is no 4.1.2.alpha3. Sage 4.1.2.alpha3 was William Stein's release for working on making the notebook a standalone package.



---

archive/issue_comments_072353.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2016-07-14T07:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72353",
    "user": "https://github.com/fchapoton"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_comments_072354.json:
```json
{
    "body": "Changing author from \"Tim Joseph Dumol\" to \"Tim Dumol\"",
    "created_at": "2016-07-14T07:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6956#issuecomment-72354",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "Tim Joseph Dumol" to "Tim Dumol"
