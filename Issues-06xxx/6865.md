# Issue 6865: [with patch, positive review] Use templates for CSS

archive/issues_006865.json:
```json
{
    "body": "CSS is currently served by `css()` in `css.py`, even though it is completely static. Using templates for it should make things easier to customize in the future.\n\nAssignee: boothby\n\nKeywords: notebook css stylesheets\n\nResolution: fixed\n\nAuthor: Tim Dumol\n\nReviewer: Mitesh Patel, Jason Grout\n\nMerged: Sage 4.1.2.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/6865\n\n",
    "closed_at": "2009-09-22T17:55:59Z",
    "created_at": "2009-09-02T15:30:45Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "[with patch, positive review] Use templates for CSS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6865",
    "user": "https://github.com/TimDumol"
}
```
CSS is currently served by `css()` in `css.py`, even though it is completely static. Using templates for it should make things easier to customize in the future.

Assignee: boothby

Keywords: notebook css stylesheets

Resolution: fixed

Author: Tim Dumol

Reviewer: Mitesh Patel, Jason Grout

Merged: Sage 4.1.2.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/6865





---

archive/issue_comments_058409.json:
```json
{
    "body": "Moved CSS in `css.py` to templates, and adjusted `twist.py` to use them.",
    "created_at": "2009-09-02T16:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58409",
    "user": "https://github.com/TimDumol"
}
```

Moved CSS in `css.py` to templates, and adjusted `twist.py` to use them.



---

archive/issue_events_016155.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-09-02T16:20:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "milestone": "sage-4.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6865#event-16155"
}
```



---

archive/issue_comments_058410.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_6865-templates-css.patch](tarball://root/attachments/some-uuid/ticket6865/trac_6865-templates-css.patch) by @TimDumol created at 2009-09-02 16:20:43",
    "created_at": "2009-09-02T16:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58410",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:1'></a>Attachment [trac_6865-templates-css.patch](tarball://root/attachments/some-uuid/ticket6865/trac_6865-templates-css.patch) by @TimDumol created at 2009-09-02 16:20:43



---

archive/issue_comments_058411.json:
```json
{
    "body": "<a id='comment:2'></a>This probably needs to be rebased after #6939 to include the CSS fix there (or the rebasing should go the other way, if this gets reviewed before that gets merged...)",
    "created_at": "2009-09-17T19:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58411",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>This probably needs to be rebased after #6939 to include the CSS fix there (or the rebasing should go the other way, if this gets reviewed before that gets merged...)



---

archive/issue_comments_058412.json:
```json
{
    "body": "<a id='comment:3'></a>#6940 is a dup of this ticket (i.e., close #6940).",
    "created_at": "2009-09-17T19:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58412",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>#6940 is a dup of this ticket (i.e., close #6940).



---

archive/issue_comments_058413.json:
```json
{
    "body": "<a id='comment:4'></a>Does the patch depend on another ticket's patch?  Applying [attachment:trac_6865-templates-css.patch] to 4.1.2.alpha1, I get\n\n```\napplying trac_6865-templates-css.patch\npatching file sage/server/notebook/css.py\nHunk #1 FAILED at 0\n1 out of 3 hunks FAILED -- saving rejects to file sage/server/notebook/css.py.rej\npatching file sage/server/notebook/twist.py\nHunk #1 FAILED at 133\nHunk #2 succeeded at 1787 with fuzz 1 (offset 37 lines).\nHunk #3 FAILED at 2315\n2 out of 3 hunks FAILED -- saving rejects to file sage/server/notebook/twist.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac_6865-templates-css.patch\n```\nThe important one is the last, which doesn't apply because the local `twist.py` contains\n\n```python\n        elif self.problem == 'suspended':\n            return HTMLResponse(stream = message(\"Your account is currently suspended.\"))\n```\nBut I could have altered my configuration.",
    "created_at": "2009-09-17T22:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58413",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>Does the patch depend on another ticket's patch?  Applying [attachment:trac_6865-templates-css.patch] to 4.1.2.alpha1, I get

```
applying trac_6865-templates-css.patch
patching file sage/server/notebook/css.py
Hunk #1 FAILED at 0
1 out of 3 hunks FAILED -- saving rejects to file sage/server/notebook/css.py.rej
patching file sage/server/notebook/twist.py
Hunk #1 FAILED at 133
Hunk #2 succeeded at 1787 with fuzz 1 (offset 37 lines).
Hunk #3 FAILED at 2315
2 out of 3 hunks FAILED -- saving rejects to file sage/server/notebook/twist.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac_6865-templates-css.patch
```
The important one is the last, which doesn't apply because the local `twist.py` contains

```python
        elif self.problem == 'suspended':
            return HTMLResponse(stream = message("Your account is currently suspended."))
```
But I could have altered my configuration.



---

archive/issue_comments_058414.json:
```json
{
    "body": "<a id='comment:5'></a>I think we need to add\n\n```\ninclude sage/server/notebook/css/*\n```\nto `MANIFEST.in,` or we'll definitely hear from the release manager...",
    "created_at": "2009-09-18T02:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58414",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>I think we need to add

```
include sage/server/notebook/css/*
```
to `MANIFEST.in,` or we'll definitely hear from the release manager...



---

archive/issue_comments_058415.json:
```json
{
    "body": "<a id='comment:6'></a>What is MANIFEST.in and when do we need to add things to it?",
    "created_at": "2009-09-19T02:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58415",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>What is MANIFEST.in and when do we need to add things to it?



---

archive/issue_comments_058416.json:
```json
{
    "body": "<a id='comment:7'></a>(setting to \"needs work\", based on mpatel's comment about MANIFEST.in and his comment about applying the patch)",
    "created_at": "2009-09-19T02:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58416",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>(setting to "needs work", based on mpatel's comment about MANIFEST.in and his comment about applying the patch)



---

archive/issue_comments_058417.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 jason]:\n> What is MANIFEST.in and when do we need to add things to it?\n\nI believe the `sage -bdist` and `sage -sdist` invoke [distutils](http://docs.python.org/distutils/sourcedist.html#specifying-the-files-to-distribute) to build `sage-*.spkg`.  Distutils uses `SAGE_ROOT/devel/sage/MANIFEST.in` to determine which files to include in the distribution.  If we add files to the local Mercurial repository, we should check that some line(s) in `MANIFEST.in` includes the newly tracked files or add a new line.  Otherwise, the next (pre-)release of Sage will not include them.  As mvngu puts it, this results in [\"repository corruption\"](http://groups.google.com/group/sage-devel/browse_thread/thread/697693c77e8d7ee8/290f2ec5412b909d?q=repository+corruption+group:sage-devel#290f2ec5412b909d).\n\nPrevious sightings: #4460, #5653, #5799, #6568, etc.",
    "created_at": "2009-09-19T05:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58417",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>Replying to [comment:6 jason]:
> What is MANIFEST.in and when do we need to add things to it?

I believe the `sage -bdist` and `sage -sdist` invoke [distutils](http://docs.python.org/distutils/sourcedist.html#specifying-the-files-to-distribute) to build `sage-*.spkg`.  Distutils uses `SAGE_ROOT/devel/sage/MANIFEST.in` to determine which files to include in the distribution.  If we add files to the local Mercurial repository, we should check that some line(s) in `MANIFEST.in` includes the newly tracked files or add a new line.  Otherwise, the next (pre-)release of Sage will not include them.  As mvngu puts it, this results in ["repository corruption"](http://groups.google.com/group/sage-devel/browse_thread/thread/697693c77e8d7ee8/290f2ec5412b909d?q=repository+corruption+group:sage-devel#290f2ec5412b909d).

Previous sightings: #4460, #5653, #5799, #6568, etc.



---

archive/issue_comments_058418.json:
```json
{
    "body": "<a id='comment:9'></a>No, this doesn't depend on other patches. It is based on 4.1.2.alpha1.\n\nI've made the requisite changes to `MANIFEST.in`.",
    "created_at": "2009-09-20T03:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58418",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:9'></a>No, this doesn't depend on other patches. It is based on 4.1.2.alpha1.

I've made the requisite changes to `MANIFEST.in`.



---

archive/issue_comments_058419.json:
```json
{
    "body": "Moved CSS in css.py to templates, and adjusted twist.py to use them. Rev 2. Apply this patch only.",
    "created_at": "2009-09-20T03:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58419",
    "user": "https://github.com/TimDumol"
}
```

Moved CSS in css.py to templates, and adjusted twist.py to use them. Rev 2. Apply this patch only.



---

archive/issue_comments_058420.json:
```json
{
    "body": "Attachment [trac_6865-templates-css.3.patch](tarball://root/attachments/some-uuid/ticket6865/trac_6865-templates-css.3.patch) by @qed777 created at 2009-09-21 00:30:15\n\nMoved CSS in css.py to templates, and adjusted twist.py to use them. Rev 3. Apply this patch only.",
    "created_at": "2009-09-21T00:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58420",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_6865-templates-css.3.patch](tarball://root/attachments/some-uuid/ticket6865/trac_6865-templates-css.3.patch) by @qed777 created at 2009-09-21 00:30:15

Moved CSS in css.py to templates, and adjusted twist.py to use them. Rev 3. Apply this patch only.



---

archive/issue_comments_058421.json:
```json
{
    "body": "<a id='comment:10'></a>Changes in patch v3:\n\n* `css.py`: `if os.path.exists(user_css):` --> `if os.path.exists(user_css_path):`\n* `css.py`: `+` --> `os.path.join()`\n* `css.py`: html -> HTML in docstring\n* `main.css`: {% ->  {%-\n\nSorry about the trivial stuff.  I just noticed the [whitespace control](http://jinja.pocoo.org/2/documentation/templates#whitespace-control) part of the Jinja2 docs.\n\nThis is a positive review from me, but someone should review my changes.",
    "created_at": "2009-09-21T00:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58421",
    "user": "https://github.com/qed777"
}
```

<a id='comment:10'></a>Changes in patch v3:

* `css.py`: `if os.path.exists(user_css):` --> `if os.path.exists(user_css_path):`
* `css.py`: `+` --> `os.path.join()`
* `css.py`: html -> HTML in docstring
* `main.css`: {% ->  {%-

Sorry about the trivial stuff.  I just noticed the [whitespace control](http://jinja.pocoo.org/2/documentation/templates#whitespace-control) part of the Jinja2 docs.

This is a positive review from me, but someone should review my changes.



---

archive/issue_comments_058422.json:
```json
{
    "body": "<a id='comment:11'></a>Your changes look good to me.",
    "created_at": "2009-09-22T17:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58422",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:11'></a>Your changes look good to me.



---

archive/issue_comments_058423.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-09-22T17:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58423",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_comments_058424.json:
```json
{
    "body": "<a id='comment:13'></a>Merged `trac_6865-templates-css.3.patch`.",
    "created_at": "2009-09-22T17:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58424",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:13'></a>Merged `trac_6865-templates-css.3.patch`.



---

archive/issue_events_016156.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-09-22T17:55:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6865#event-16156"
}
```



---

archive/issue_comments_058425.json:
```json
{
    "body": "<a id='comment:14'></a>There is no 4.1.2.alpha3. Sage 4.1.2.alpha3 was William Stein's release for working on the making the notebook a standalone package.",
    "created_at": "2009-09-27T09:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6865#issuecomment-58425",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:14'></a>There is no 4.1.2.alpha3. Sage 4.1.2.alpha3 was William Stein's release for working on the making the notebook a standalone package.
