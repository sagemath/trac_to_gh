# Issue 6344: Typesetting partial derivatives in new symbolics

archive/issues_006344.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "New symbolics uses \"D\" format for derivatives instead of old \"diff\" format. \n\nSee the threads below for discussion on various related issues\n\n**[1]**  http://groups.google.com/group/sage-devel/browse_thread/thread/7479c3eeb96348a2\n\n**[2]**  http://groups.google.com/group/sage-devel/browse_thread/thread/2c8068f27c1fb642\n\nSome patches attached to #5711 also has code for this.\n \n\n\nCC:  @jasongrout @sagetrac-mvngu @robertwb @eviatarbach @sagetrac-schymans @pjbruin @nbruin\n\nAuthor: **Burcin Erocal**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6344_\n\n",
    "closed_at": "2018-05-18T17:16:26Z",
    "created_at": "2009-06-16T23:47:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Typesetting partial derivatives in new symbolics",
    "type": "issue",
    "updated_at": "2018-05-18T17:16:26Z",
    "url": "https://github.com/sagemath/sage/issues/6344",
    "user": "https://github.com/golam-m-hossain"
}
```
New symbolics uses "D" format for derivatives instead of old "diff" format. 

See the threads below for discussion on various related issues

**[1]**  http://groups.google.com/group/sage-devel/browse_thread/thread/7479c3eeb96348a2

**[2]**  http://groups.google.com/group/sage-devel/browse_thread/thread/2c8068f27c1fb642

Some patches attached to #5711 also has code for this.
 


CC:  @jasongrout @sagetrac-mvngu @robertwb @eviatarbach @sagetrac-schymans @pjbruin @nbruin

Author: **Burcin Erocal**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/6344_





---

archive/issue_events_076581.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-16T23:47:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76581"
}
```



---

archive/issue_events_076582.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-16T23:47:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76582"
}
```



---

archive/issue_events_076583.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-16T23:47:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76583"
}
```



---

archive/issue_comments_042353.json:
```json
{
    "body": "an attempt at implementing the MMA style, for testing only",
    "created_at": "2009-06-24T21:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42353",
    "user": "https://github.com/burcin"
}
```

an attempt at implementing the MMA style, for testing only



---

archive/issue_comments_042354.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,6 @@\n \n **[2]**  http://groups.google.com/group/sage-devel/browse_thread/thread/2c8068f27c1fb642\n \n-The purpose of this patch to decide the strategy: how to tackle the various issues while typesetting D derivative.\n-\n-Some part of the code from the patch #5711 should be taken out.\n+Some patches attached to #5711 also has code for this.\n  \n \n``````\n",
    "created_at": "2009-06-24T21:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42354",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,6 @@
 
 **[2]**  http://groups.google.com/group/sage-devel/browse_thread/thread/2c8068f27c1fb642
 
-The purpose of this patch to decide the strategy: how to tackle the various issues while typesetting D derivative.
-
-Some part of the code from the patch #5711 should be taken out.
+Some patches attached to #5711 also has code for this.
  
 
``````




---

archive/issue_events_076584.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-24T21:49:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76584"
}
```



---

archive/issue_events_076585.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-24T21:49:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76585"
}
```



---

archive/issue_comments_042355.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_6344-mma_style_attempt.patch.gz](https://github.com/sagemath/sage/files/ticket6344/trac_6344-mma_style_attempt.patch.gz)**\n\n[attachment: trac_6344-mma_style_attempt.patch](https://github.com/sagemath/sage/files/ticket6344/trac_6344-mma_style_attempt.patch.gz) implements an approximation to MMA style. It is just for testing, needs much more work for inclusion.\n\nIt doesn't look good in text only mode:\n\n```\nsage: f = function('f')\nsage: f(x).derivative(x,3)\nf^{(3)}(x)\n```",
    "created_at": "2009-06-24T21:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42355",
    "user": "https://github.com/burcin"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_6344-mma_style_attempt.patch.gz](https://github.com/sagemath/sage/files/ticket6344/trac_6344-mma_style_attempt.patch.gz)**

[attachment: trac_6344-mma_style_attempt.patch](https://github.com/sagemath/sage/files/ticket6344/trac_6344-mma_style_attempt.patch.gz) implements an approximation to MMA style. It is just for testing, needs much more work for inclusion.

It doesn't look good in text only mode:

```
sage: f = function('f')
sage: f(x).derivative(x,3)
f^{(3)}(x)
```



---

archive/issue_comments_042356.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI uploaded a new patch at [attachment: trac_6344-symbolic_derivative_print.patch.](https://github.com/sagemath/sage/files/ticket6344/trac_6344-symbolic_derivative_print.patch..gz)\n\nThe new patch keeps the text mode printing similar to the old one, but changes the printed parameters to indicate how many times each argument is differentiated. E.g., old output:\n\n```\nsage: var('x,y')\nsage: f = function('f')\nsage: f(x).derivative(x)\nD[0](f)(x)\nsage: f(x,x).derivative(x,2)\nD[0, 0](f)(x, x) + 2*D[0, 1](f)(x, x) + D[1, 1](f)(x, x)\n```\n\nNew output:\n\n```\nsage: f(x).derivative(x)\nD[1](f)(x)\nsage: f(x,x).derivative(x,2)\nD[2, 0](f)(x, x) + 2*D[1, 1](f)(x, x) + D[0, 2](f)(x, x)\n```\n\nNew latex output:\n\n```\nsage: latex(f(x).derivative(x))\nf'\\left(x\\right)\nsage: latex(f(x,x).derivative(x,2))\nf^{(2,0)}\\left(x, x\\right) + 2 \\, f^{(1,1)}\\left(x, x\\right) + f^{(0,2)}\\left(x, x\\right)\n```\n\nIt would be better to add more documentation to explain the output, provide conversions to \"textbook style\" and fix other problems that pop up when printing derivatives:\n\n```\nsage: binomial(x,y).derivative(x)\n<boom>\nsage: latex(floor(x).derivative(x))\nD[0]\\left \\lfloor x \\right \\rfloor\nsage: latex(ceil(x).derivative(x))\nD[0]\\left \\lceil x \\right \\rceil\n```\n\nHowever, I think we should settle on an output style ASAP, without letting too many releases go by.\n\nJason, Minh, can one (or both) of you review this?",
    "created_at": "2009-07-14T21:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42356",
    "user": "https://github.com/burcin"
}
```

<div id="comment:2" align="right">comment:2</div>

I uploaded a new patch at [attachment: trac_6344-symbolic_derivative_print.patch.](https://github.com/sagemath/sage/files/ticket6344/trac_6344-symbolic_derivative_print.patch..gz)

The new patch keeps the text mode printing similar to the old one, but changes the printed parameters to indicate how many times each argument is differentiated. E.g., old output:

```
sage: var('x,y')
sage: f = function('f')
sage: f(x).derivative(x)
D[0](f)(x)
sage: f(x,x).derivative(x,2)
D[0, 0](f)(x, x) + 2*D[0, 1](f)(x, x) + D[1, 1](f)(x, x)
```

New output:

```
sage: f(x).derivative(x)
D[1](f)(x)
sage: f(x,x).derivative(x,2)
D[2, 0](f)(x, x) + 2*D[1, 1](f)(x, x) + D[0, 2](f)(x, x)
```

New latex output:

```
sage: latex(f(x).derivative(x))
f'\left(x\right)
sage: latex(f(x,x).derivative(x,2))
f^{(2,0)}\left(x, x\right) + 2 \, f^{(1,1)}\left(x, x\right) + f^{(0,2)}\left(x, x\right)
```

It would be better to add more documentation to explain the output, provide conversions to "textbook style" and fix other problems that pop up when printing derivatives:

```
sage: binomial(x,y).derivative(x)
<boom>
sage: latex(floor(x).derivative(x))
D[0]\left \lfloor x \right \rfloor
sage: latex(ceil(x).derivative(x))
D[0]\left \lceil x \right \rceil
```

However, I think we should settle on an output style ASAP, without letting too many releases go by.

Jason, Minh, can one (or both) of you review this?



---

archive/issue_events_076586.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-14T21:39:10Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "title_is": "Typesetting partial derivatives in new symbolics",
    "title_was": "Typesetting partial derivatives in new Symbolics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76586"
}
```



---

archive/issue_events_076587.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-14T21:39:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76587"
}
```



---

archive/issue_events_076588.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-14T21:39:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76588"
}
```



---

archive/issue_comments_042357.json:
```json
{
    "body": "Author: **Burcin Erocal**",
    "created_at": "2009-07-14T21:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42357",
    "user": "https://github.com/burcin"
}
```

Author: **Burcin Erocal**



---

archive/issue_events_076589.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-14T21:39:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76589"
}
```



---

archive/issue_events_076590.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-14T21:39:10Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "subject": "https://github.com/burcin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76590"
}
```



---

archive/issue_comments_042358.json:
```json
{
    "body": "Attachment: **[trac_6344-symbolic_derivative_print.patch.gz](https://github.com/sagemath/sage/files/ticket6344/trac_6344-symbolic_derivative_print.patch.gz)**\n\nchange printing of symbolic derivatives",
    "created_at": "2009-07-14T21:39:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42358",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_6344-symbolic_derivative_print.patch.gz](https://github.com/sagemath/sage/files/ticket6344/trac_6344-symbolic_derivative_print.patch.gz)**

change printing of symbolic derivatives



---

archive/issue_comments_042359.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis needs a slight rebasing to be applied and tested to Sage 4.2, in calculus/tests.py and symbolic/pynac.pyx.",
    "created_at": "2009-10-29T18:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42359",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

This needs a slight rebasing to be applied and tested to Sage 4.2, in calculus/tests.py and symbolic/pynac.pyx.



---

archive/issue_events_076591.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-10-29T18:19:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76591"
}
```



---

archive/issue_events_076592.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76592"
}
```



---

archive/issue_events_076593.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76593"
}
```



---

archive/issue_events_076594.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76594"
}
```



---

archive/issue_events_076595.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76595"
}
```



---

archive/issue_comments_042360.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n#14517 has a similar complaint.",
    "created_at": "2014-03-12T08:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42360",
    "user": "https://github.com/burcin"
}
```

<div id="comment:10" align="right">comment:10</div>

#14517 has a similar complaint.



---

archive/issue_events_076596.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76596"
}
```



---

archive/issue_events_076597.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76597"
}
```



---

archive/issue_events_076598.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76598"
}
```



---

archive/issue_events_076599.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76599"
}
```



---

archive/issue_comments_042361.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI tried to apply the most recent patch, but did not succeed. It is just too old and when looking at the diff I couldn't make any sense of it. I tried to implement differential notation myself, but got stuck, perhaps someone can help?\n\nAll I wanted to do is to change the `_latex_` representation of the FDerivativeOperator and added the following lines to src/sage/symbolic/operators.py:\n\n\n```\ndef _latex_(self):\n        \"\"\"\n            Return the LaTeX representation of X.\n\n            EXAMPLES::\n\n            sage: from sage.symbolic.operators import FDerivativeOperator\n            sage: var('x z')\n            sage: f = function('f', x, z)\n            sage: op = FDerivativeOperator(f, [0,1]); latex(op)\n            \\frac{\\partial \\frac{\\partial f }{\\partial x } }{\\partial z }\n        \"\"\"\n        fname = self._f.operator()\n        vars = self._f.operands()\n        difvars = self._parameter_set\n        str1 = str(fname)\n        for difvar in difvars:\n            str1 = '\\\\frac{\\partial '+str1+'}{\\partial '+str(vars[difvar])+'}'\n        return str1\n```\nUnfortunately, this does not have any effect on the latex representation of f.diff:\n\n```\nsage: f = function('f', x, z)\nsage: g = diff(f, x,z)\nsage: latex(g)\nD[0, 1]\\left(f\\right)\\left(x, z\\right)\n```\n\nDoes anyone have an idea what else I need to modify? Thanks in advance!",
    "created_at": "2014-12-03T21:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42361",
    "user": "https://github.com/sagetrac-schymans"
}
```

<div id="comment:13" align="right">comment:13</div>

I tried to apply the most recent patch, but did not succeed. It is just too old and when looking at the diff I couldn't make any sense of it. I tried to implement differential notation myself, but got stuck, perhaps someone can help?

All I wanted to do is to change the `_latex_` representation of the FDerivativeOperator and added the following lines to src/sage/symbolic/operators.py:


```
def _latex_(self):
        """
            Return the LaTeX representation of X.

            EXAMPLES::

            sage: from sage.symbolic.operators import FDerivativeOperator
            sage: var('x z')
            sage: f = function('f', x, z)
            sage: op = FDerivativeOperator(f, [0,1]); latex(op)
            \frac{\partial \frac{\partial f }{\partial x } }{\partial z }
        """
        fname = self._f.operator()
        vars = self._f.operands()
        difvars = self._parameter_set
        str1 = str(fname)
        for difvar in difvars:
            str1 = '\\frac{\partial '+str1+'}{\partial '+str(vars[difvar])+'}'
        return str1
```
Unfortunately, this does not have any effect on the latex representation of f.diff:

```
sage: f = function('f', x, z)
sage: g = diff(f, x,z)
sage: latex(g)
D[0, 1]\left(f\right)\left(x, z\right)
```

Does anyone have an idea what else I need to modify? Thanks in advance!



---

archive/issue_comments_042362.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@sagetrac-schymans](#comment:13):\n> All I wanted to do is to change the `_latex_` representation of the FDerivativeOperator and added the following lines to src/sage/symbolic/operators.py:\n\nLooks like the wrong place to hook into this. For symbolic expressions. `self._latex_` invokes `SR._latex_element_` which calls straight into Pynac via ` GEx_to_str_latex(&x._gobj)`. Your experiment shows that this doesn't dispatch to `_latex_` methods on operators. Perhaps there's another hook?\n\nIncidentally, your code wouldn't work, because that's not how FDerivateOperators occur in code:\n\n```\nsage: var(\"x,y\")\n(x, y)\nsage: function('f',x,y)\nf(x, y)\nsage: g=diff(f(x,y),x,y)\nsage: g\nD[0, 1](f)(x, y)\nsage: g.operator()\nD[0, 1](f)\nsage: type(g.operator())\n<class 'sage.symbolic.operators.FDerivativeOperator'>\nsage: g.operator()._f\nf\n```\nAs you can see, there are no variable names to refer to. That's why this ticket has stalled: if you want to do this, you need to recognize on the level of `g` that the operator is an `FDerivativeOperator` and hence that, if the operands of `g` are distinct, simple symbolic variables, that the derivative could be written in Leibnitz notation.\n\nClearly, people haven't found the effort required worth the payoff.",
    "created_at": "2014-12-03T22:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42362",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@sagetrac-schymans](#comment:13):
> All I wanted to do is to change the `_latex_` representation of the FDerivativeOperator and added the following lines to src/sage/symbolic/operators.py:

Looks like the wrong place to hook into this. For symbolic expressions. `self._latex_` invokes `SR._latex_element_` which calls straight into Pynac via ` GEx_to_str_latex(&x._gobj)`. Your experiment shows that this doesn't dispatch to `_latex_` methods on operators. Perhaps there's another hook?

Incidentally, your code wouldn't work, because that's not how FDerivateOperators occur in code:

```
sage: var("x,y")
(x, y)
sage: function('f',x,y)
f(x, y)
sage: g=diff(f(x,y),x,y)
sage: g
D[0, 1](f)(x, y)
sage: g.operator()
D[0, 1](f)
sage: type(g.operator())
<class 'sage.symbolic.operators.FDerivativeOperator'>
sage: g.operator()._f
f
```
As you can see, there are no variable names to refer to. That's why this ticket has stalled: if you want to do this, you need to recognize on the level of `g` that the operator is an `FDerivativeOperator` and hence that, if the operands of `g` are distinct, simple symbolic variables, that the derivative could be written in Leibnitz notation.

Clearly, people haven't found the effort required worth the payoff.



---

archive/issue_comments_042363.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks for the quick answer! From the user's perspective, the best way would be to have an option similar to derivative_func in the function definition, allowing to define the notation for derivatives. The efforts required seems indeed amazingly high. \n\nWouldn't it be possible to write some parsing code to convert something like D[0,1](f)(x,y) to any kind of notation? It should even be possible to convert it back to diff(f(x,y),x,y), as requested here: http://comments.gmane.org/gmane.comp.mathematics.sage.devel/58040",
    "created_at": "2014-12-04T00:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42363",
    "user": "https://github.com/sagetrac-schymans"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks for the quick answer! From the user's perspective, the best way would be to have an option similar to derivative_func in the function definition, allowing to define the notation for derivatives. The efforts required seems indeed amazingly high. 

Wouldn't it be possible to write some parsing code to convert something like D[0,1](f)(x,y) to any kind of notation? It should even be possible to convert it back to diff(f(x,y),x,y), as requested here: http://comments.gmane.org/gmane.comp.mathematics.sage.devel/58040



---

archive/issue_comments_042364.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@sagetrac-schymans](#comment:16):\n> Wouldn't it be possible to write some parsing code to convert something like D[0,1](f)(x,y) to any kind of notation? It should even be possible to convert it back to diff(f(x,y),x,y), as requested here: http://comments.gmane.org/gmane.comp.mathematics.sage.devel/58040\n\nIt's really much easier to do on the expression tree than on a string. We do it for conversions already. See e.g. [https://github.com/sagemath/sage/blob/master/src/sage/interfaces/maxima_lib.py#L1564](https://github.com/sagemath/sage/blob/master/src/sage/interfaces/maxima_lib.py#L1564). The approach is straightforward. The hard work is that you need to reach into Pynac to make the change. So it takes someone conversant with Pynac who cares enough to do it. Doing it on strings afterwards is going to be horrible.\n\nIncidentally, watch out that an expression like\n\n```\nD[0,1](f)(x,x+1)\n```\nis almost impossible to write in Leibnitz notation unless you introduce auxiliary variables (which is what happens in the maxima_lib code). So you should probably just stick with operator notation for those cases (maple does).",
    "created_at": "2014-12-04T01:26:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42364",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@sagetrac-schymans](#comment:16):
> Wouldn't it be possible to write some parsing code to convert something like D[0,1](f)(x,y) to any kind of notation? It should even be possible to convert it back to diff(f(x,y),x,y), as requested here: http://comments.gmane.org/gmane.comp.mathematics.sage.devel/58040

It's really much easier to do on the expression tree than on a string. We do it for conversions already. See e.g. [https://github.com/sagemath/sage/blob/master/src/sage/interfaces/maxima_lib.py#L1564](https://github.com/sagemath/sage/blob/master/src/sage/interfaces/maxima_lib.py#L1564). The approach is straightforward. The hard work is that you need to reach into Pynac to make the change. So it takes someone conversant with Pynac who cares enough to do it. Doing it on strings afterwards is going to be horrible.

Incidentally, watch out that an expression like

```
D[0,1](f)(x,x+1)
```
is almost impossible to write in Leibnitz notation unless you introduce auxiliary variables (which is what happens in the maxima_lib code). So you should probably just stick with operator notation for those cases (maple does).



---

archive/issue_comments_042365.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI see. Would it be easier to allow the user to define custom latex representations for just some standard differentials one anticipates when defining a function? For all others, the system could fall back to the D[0,1] (f)(x,z) notation. A simple replacement rule when latexing an expression could do it. \n\nBy the way, it took me a quite some time of digging in the code to understand the meaning of e.g. D[0,1](f)(x,z). Now that I have understood it, I see its use. I was expecting a description in the documentation of the diff() or differential() command, but I didn't find it there. Where is the right place to look?",
    "created_at": "2014-12-04T08:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42365",
    "user": "https://github.com/sagetrac-schymans"
}
```

<div id="comment:18" align="right">comment:18</div>

I see. Would it be easier to allow the user to define custom latex representations for just some standard differentials one anticipates when defining a function? For all others, the system could fall back to the D[0,1] (f)(x,z) notation. A simple replacement rule when latexing an expression could do it. 

By the way, it took me a quite some time of digging in the code to understand the meaning of e.g. D[0,1](f)(x,z). Now that I have understood it, I see its use. I was expecting a description in the documentation of the diff() or differential() command, but I didn't find it there. Where is the right place to look?



---

archive/issue_comments_042366.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n> By the way, it took me a quite some time of digging in the code to understand the meaning of e.g. D[0,1](f)(x,z). Now that I have understood it, I see its use. I was expecting a description in the documentation of the diff() or differential() command, but I didn't find it there. Where is the right place to look?\n\nIf anyone should know, I should, but I don't.  It would be *wonderful* to have some better documentation of that where it belongs - want to take a stab?  If so, open a ticket and cc: me.",
    "created_at": "2014-12-04T14:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42366",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

> By the way, it took me a quite some time of digging in the code to understand the meaning of e.g. D[0,1](f)(x,z). Now that I have understood it, I see its use. I was expecting a description in the documentation of the diff() or differential() command, but I didn't find it there. Where is the right place to look?

If anyone should know, I should, but I don't.  It would be *wonderful* to have some better documentation of that where it belongs - want to take a stab?  If so, open a ticket and cc: me.



---

archive/issue_comments_042367.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThanks, this is now http://trac.sagemath.org/ticket/17445\nThere, I mentioned some other, related tickets, which made me realise that I do not fully understand the meaning of the D-notation, so it wouldn't make much sense for me to write a documentation for it. Sorry!",
    "created_at": "2014-12-04T22:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42367",
    "user": "https://github.com/sagetrac-schymans"
}
```

<div id="comment:20" align="right">comment:20</div>

Thanks, this is now http://trac.sagemath.org/ticket/17445
There, I mentioned some other, related tickets, which made me realise that I do not fully understand the meaning of the D-notation, so it wouldn't make much sense for me to write a documentation for it. Sorry!



---

archive/issue_comments_042368.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWow, after reading the threads in question I see that at this point Sage has existed about as long with this new format as it did with the previous one.  I'm reluctant to make this wontfix, at least the *option* as indicated there\n\n```\npsi(x) = function('psi',x)\ng = diff(psi(x),x)\nlatex(g)\n\\frac{d \\psi\\left(x\\right)}{d x}\n\n# Switch to D format\nsage.symbolic.pynac.typeset_d_as_diff=False\n\nlatex(g)\nD[0]\\psi\\left(x\\right)\n```\nshould exist, except of course the other way around for the default nowadays, I guess.  Maybe that piece of [attachment: enhanced-symbolic-typesetting-rebased_to_4.0.1.patch:ticket:5711](https://github.com/sagemath/sage/files/ticket6344/10c6c655141c19d14e0ba98277619d19.gz) should be implemented here instead?",
    "created_at": "2014-12-05T04:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42368",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

Wow, after reading the threads in question I see that at this point Sage has existed about as long with this new format as it did with the previous one.  I'm reluctant to make this wontfix, at least the *option* as indicated there

```
psi(x) = function('psi',x)
g = diff(psi(x),x)
latex(g)
\frac{d \psi\left(x\right)}{d x}

# Switch to D format
sage.symbolic.pynac.typeset_d_as_diff=False

latex(g)
D[0]\psi\left(x\right)
```
should exist, except of course the other way around for the default nowadays, I guess.  Maybe that piece of [attachment: enhanced-symbolic-typesetting-rebased_to_4.0.1.patch:ticket:5711](https://github.com/sagemath/sage/files/ticket6344/10c6c655141c19d14e0ba98277619d19.gz) should be implemented here instead?



---

archive/issue_comments_042369.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n+1 from me! I was very sad to find out that this had not been implemented.",
    "created_at": "2014-12-05T09:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42369",
    "user": "https://github.com/sagetrac-schymans"
}
```

<div id="comment:22" align="right">comment:22</div>

+1 from me! I was very sad to find out that this had not been implemented.



---

archive/issue_comments_042370.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNils and/or Peter, would you have objections to the following, based on code from #5711 (if possible)?\n\n```\npsi(x) = function('psi',x)\ng = diff(psi(x),x)\nlatex(g)\nD[0]\\psi\\left(x\\right)\n\n# Switch to D format\nsage.symbolic.pynac.typeset_d_as_diff=True\n\nlatex(g)\n\\frac{d \\psi\\left(x\\right)}{d x}\n```",
    "created_at": "2014-12-05T14:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42370",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>

Nils and/or Peter, would you have objections to the following, based on code from #5711 (if possible)?

```
psi(x) = function('psi',x)
g = diff(psi(x),x)
latex(g)
D[0]\psi\left(x\right)

# Switch to D format
sage.symbolic.pynac.typeset_d_as_diff=True

latex(g)
\frac{d \psi\left(x\right)}{d x}
```



---

archive/issue_comments_042371.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kcrisman](#comment:23):\n> Nils and/or Peter, would you have objections to the following, based on code from #5711 (if possible)?\n> \n> ```\n> ...\n> sage.symbolic.pynac.typeset_d_as_diff=True\n> \n> latex(g)\n> \\frac{d \\psi\\left(x\\right)}{d x}\n> ```\n\nOnly do that when the argument list consists only of distinct symbolic variables. Then you can even print \"diff\" for the normal rep. See links above for code that makes this distinction already. This is what Maple does too, by the way.",
    "created_at": "2014-12-05T17:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42371",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kcrisman](#comment:23):
> Nils and/or Peter, would you have objections to the following, based on code from #5711 (if possible)?
> 
> ```
> ...
> sage.symbolic.pynac.typeset_d_as_diff=True
> 
> latex(g)
> \frac{d \psi\left(x\right)}{d x}
> ```

Only do that when the argument list consists only of distinct symbolic variables. Then you can even print "diff" for the normal rep. See links above for code that makes this distinction already. This is what Maple does too, by the way.



---

archive/issue_comments_042372.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOh, so that's where the `t0` and friends come from.  Funny thing... what if those variables are already taken?  <ducks />",
    "created_at": "2014-12-05T17:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42372",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

Oh, so that's where the `t0` and friends come from.  Funny thing... what if those variables are already taken?  <ducks />



---

archive/issue_comments_042373.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kcrisman](#comment:25):\n> Oh, so that's where the `t0` and friends come from.  Funny thing... what if those variables are already taken?\n\nThought about that, no problem. They get substituted right away.",
    "created_at": "2014-12-05T17:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42373",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kcrisman](#comment:25):
> Oh, so that's where the `t0` and friends come from.  Funny thing... what if those variables are already taken?

Thought about that, no problem. They get substituted right away.



---

archive/issue_comments_042374.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n#21286 has dealt with with this. Close as duplicate/invalid ?",
    "created_at": "2018-03-22T01:28:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42374",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:27" align="right">comment:27</div>

#21286 has dealt with with this. Close as duplicate/invalid ?



---

archive/issue_events_076600.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2018-03-22T01:28:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76600"
}
```



---

archive/issue_events_076601.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2018-03-22T01:28:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76601"
}
```



---

archive/issue_events_076602.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2018-03-22T01:28:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76602"
}
```



---

archive/issue_events_076603.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2018-03-22T01:28:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76603"
}
```



---

archive/issue_events_076604.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2018-03-22T01:28:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76604"
}
```



---

archive/issue_events_076605.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-04-15T11:46:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76605"
}
```



---

archive/issue_events_076606.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-04-15T11:46:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76606"
}
```



---

archive/issue_events_076607.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76607"
}
```



---

archive/issue_comments_042375.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nclosing positively reviewed duplicates",
    "created_at": "2018-05-18T17:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6344#issuecomment-42375",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

closing positively reviewed duplicates



---

archive/issue_events_076608.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76608"
}
```



---

archive/issue_events_076609.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6344",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6344#event-76609"
}
```
