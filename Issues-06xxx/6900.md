# Issue 6900: Sage pexpect problems - suggestion to use upstream release

archive/issues_006900.json:
```json
{
    "body": "  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace(\"/path/to/$DOT_SAGE/gap/workspace-ext\");\ncommand in interfaces/gap.py fail (and possibly others).\n\n  Sample test case to reproduce the problem:\n\n\n```\n% mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage\n<<make sure DOT_SAGE will point to that directory>>\n% sage\n<<exit sage>>\n% ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/\nREADME.txt\n<<change DOT_SAGE to something like just /tmp/0123456789/>>\n% sage\n<<exit sage>>\n% ls /tmp/0123456789/.sage/gap\nREADME.txt  workspace-1328071335\n```\n\n  The problem is due to the command having more then 80 characters.\n\n  Currently sage uses pexpect-2.0 (patchlevel 4). And this is also one special case in my rpm packages of sage, because if using the latest upstream, in my case:\n\n```\n% rpm -q python-pexpect\npython-pexpect-2.4-1mdv2010.0\n```\n\nit works correctly in the terminal interface, but doesn't work correctly in the notebook interface.\n\n  A quick and dirty way to test a newer pexpect would be:\n\n\n```\n% mkdir $HOME/tmp/sage-pexpect\n% mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect\n% cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages\n% sage\nsage: notebook()\n```\n\n  After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.\nA screenshot of the problem, that happens the first time a background process is started is:\nhttp://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg\nbut, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.\n\n  Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)\n\n\nAssignee: boothby\n\nKeywords: pexpect\n\nReviewer: Andr\u00e9 Apitzsch, Karl-Dieter Crisman\n\nResolution: worksforme\n\nIssue created by migration from https://trac.sagemath.org/ticket/6900\n\n",
    "closed_at": "2014-09-18T17:58:35Z",
    "created_at": "2009-09-07T04:32:43Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Sage pexpect problems - suggestion to use upstream release",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6900",
    "user": "https://trac.sagemath.org/admin/accounts/users/pcpa"
}
```
  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace("/path/to/$DOT_SAGE/gap/workspace-ext");
command in interfaces/gap.py fail (and possibly others).

  Sample test case to reproduce the problem:


```
% mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage
<<make sure DOT_SAGE will point to that directory>>
% sage
<<exit sage>>
% ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/
README.txt
<<change DOT_SAGE to something like just /tmp/0123456789/>>
% sage
<<exit sage>>
% ls /tmp/0123456789/.sage/gap
README.txt  workspace-1328071335
```

  The problem is due to the command having more then 80 characters.

  Currently sage uses pexpect-2.0 (patchlevel 4). And this is also one special case in my rpm packages of sage, because if using the latest upstream, in my case:

```
% rpm -q python-pexpect
python-pexpect-2.4-1mdv2010.0
```

it works correctly in the terminal interface, but doesn't work correctly in the notebook interface.

  A quick and dirty way to test a newer pexpect would be:


```
% mkdir $HOME/tmp/sage-pexpect
% mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect
% cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages
% sage
sage: notebook()
```

  After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.
A screenshot of the problem, that happens the first time a background process is started is:
http://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg
but, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.

  Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)


Assignee: boothby

Keywords: pexpect

Reviewer: André Apitzsch, Karl-Dieter Crisman

Resolution: worksforme

Issue created by migration from https://trac.sagemath.org/ticket/6900





---

archive/issue_comments_065053.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,10 @@\n-Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace(\"/path/to/$DOT_SAGE/gap/workspace-ext\");\n+  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace(\"/path/to/$DOT_SAGE/gap/workspace-ext\");\n command in interfaces/gap.py fail (and possibly others).\n \n   Sample test case to reproduce the problem:\n+\n+\n+```\n \n % mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage\n <<make sure DOT_SAGE will point to that directory>>\n@@ -14,6 +17,7 @@\n <<exit sage>>\n % ls /tmp/0123456789/.sage/gap\n README.txt  workspace-1328071335\n+```\n \n   The problem is due to the command having more then 80 characters.\n \n@@ -23,11 +27,15 @@\n it works correctly in the terminal interface, but doesn't work correctly in the notebook interface.\n \n   A quick and dirty way to test a newer pexpect would be:\n+\n+\n+```\n % mkdir $HOME/tmp/sage-pexpect\n % mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect\n % cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages\n % sage\n sage: notebook()\n+```\n \n   After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.\n A screenshot of the problem, that happens the first time a background process is started is:\n@@ -36,6 +44,7 @@\n \n   Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)\n \n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/6900\n``````\n",
    "created_at": "2009-09-07T04:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65053",
    "user": "https://trac.sagemath.org/admin/accounts/users/pcpa"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,10 @@
-Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace("/path/to/$DOT_SAGE/gap/workspace-ext");
+  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace("/path/to/$DOT_SAGE/gap/workspace-ext");
 command in interfaces/gap.py fail (and possibly others).
 
   Sample test case to reproduce the problem:
+
+
+```
 
 % mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage
 <<make sure DOT_SAGE will point to that directory>>
@@ -14,6 +17,7 @@
 <<exit sage>>
 % ls /tmp/0123456789/.sage/gap
 README.txt  workspace-1328071335
+```
 
   The problem is due to the command having more then 80 characters.
 
@@ -23,11 +27,15 @@
 it works correctly in the terminal interface, but doesn't work correctly in the notebook interface.
 
   A quick and dirty way to test a newer pexpect would be:
+
+
+```
 % mkdir $HOME/tmp/sage-pexpect
 % mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect
 % cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages
 % sage
 sage: notebook()
+```
 
   After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.
 A screenshot of the problem, that happens the first time a background process is started is:
@@ -36,6 +44,7 @@
 
   Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)
 
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/6900
``````




---

archive/issue_comments_065054.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,51 @@\n+  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace(\"/path/to/$DOT_SAGE/gap/workspace-ext\");\n+command in interfaces/gap.py fail (and possibly others).\n+\n+  Sample test case to reproduce the problem:\n+\n+\n+```\n+% mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage\n+<<make sure DOT_SAGE will point to that directory>>\n+% sage\n+<<exit sage>>\n+% ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/\n+README.txt\n+<<change DOT_SAGE to something like just /tmp/0123456789/>>\n+% sage\n+<<exit sage>>\n+% ls /tmp/0123456789/.sage/gap\n+README.txt  workspace-1328071335\n+```\n+\n+  The problem is due to the command having more then 80 characters.\n+\n+  Currently sage uses pexpect-2.0 (patchlevel 4). And this is also one special case in my rpm packages of sage, because if using the latest upstream, in my case:\n+\n+```\n+% rpm -q python-pexpect\n+python-pexpect-2.4-1mdv2010.0\n+```\n+\n+it works correctly in the terminal interface, but doesn't work correctly in the notebook interface.\n+\n+  A quick and dirty way to test a newer pexpect would be:\n+\n+\n+```\n+% mkdir $HOME/tmp/sage-pexpect\n+% mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect\n+% cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages\n+% sage\n+sage: notebook()\n+```\n+\n+  After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.\n+A screenshot of the problem, that happens the first time a background process is started is:\n+http://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg\n+but, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.\n+\n+  Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)\n \n \n Comment: 1\n``````\n",
    "created_at": "2009-09-07T04:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65054",
    "user": "https://trac.sagemath.org/admin/accounts/users/pcpa"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,51 @@
+  Since pexpect is a very important package, I would like to point one problem that happens when DOT_SAGE is set to a long pathname, causing the SaveWorkspace("/path/to/$DOT_SAGE/gap/workspace-ext");
+command in interfaces/gap.py fail (and possibly others).
+
+  Sample test case to reproduce the problem:
+
+
+```
+% mkdir -p /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage
+<<make sure DOT_SAGE will point to that directory>>
+% sage
+<<exit sage>>
+% ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/
+README.txt
+<<change DOT_SAGE to something like just /tmp/0123456789/>>
+% sage
+<<exit sage>>
+% ls /tmp/0123456789/.sage/gap
+README.txt  workspace-1328071335
+```
+
+  The problem is due to the command having more then 80 characters.
+
+  Currently sage uses pexpect-2.0 (patchlevel 4). And this is also one special case in my rpm packages of sage, because if using the latest upstream, in my case:
+
+```
+% rpm -q python-pexpect
+python-pexpect-2.4-1mdv2010.0
+```
+
+it works correctly in the terminal interface, but doesn't work correctly in the notebook interface.
+
+  A quick and dirty way to test a newer pexpect would be:
+
+
+```
+% mkdir $HOME/tmp/sage-pexpect
+% mv $SAGE_ROOT/lib/python/site-packages/{ANSI,FSM,pexpect,pxssh,screen}.py $HOME/tmp/sage-pexpect
+% cp newer-python-pexpect/{ANSI,FSM,pexpect,pxssh,screen}.py $SAGE_ROOT/lib/python/site-packages
+% sage
+sage: notebook()
+```
+
+  After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.
+A screenshot of the problem, that happens the first time a background process is started is:
+http://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg
+but, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.
+
+  Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)
 
 
 Comment: 1
``````




---

archive/issue_comments_065055.json:
```json
{
    "body": "Replying to [ticket:6900 pcpa]:\n[Sorry for replying to myself]\n>   After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.\n\n> A screenshot of the problem, that happens the first time a background process is started is:\n> http://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg\n> but, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.\n> \n>   Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)\n\n\n  For people familiar with the notebook code, I think what may be also a good hint as to what may be wrong is that the extra noise in the output is not \"really noise\", but the \"dancing\" / and \\ characters that go to the browser titlebar.",
    "created_at": "2009-09-08T14:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65055",
    "user": "https://trac.sagemath.org/admin/accounts/users/pcpa"
}
```

Replying to [ticket:6900 pcpa]:
[Sorry for replying to myself]
>   After starting the notebook, and using a newer pexpect, try some command that causes a background processes to be created, like the first singular example in the tutorial.

> A screenshot of the problem, that happens the first time a background process is started is:
> http://img134.imageshack.us/img134/557/sagewithnewerpexpect1.jpg
> but, as also shown in the screenshot, in subsequent evaluations, it works correctly in the notebook.
> 
>   Since it always works correct in the terminal interface of sage, I suspect it is an issue in the notebook/worksheet code. And in that case, it actually may be a different way to debug problems in the sage pexpect interface (also a suggestion :-)


  For people familiar with the notebook code, I think what may be also a good hint as to what may be wrong is that the extra noise in the output is not "really noise", but the "dancing" / and \ characters that go to the browser titlebar.



---

archive/issue_comments_065056.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-18T19:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65056",
    "user": "https://github.com/a-andre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_065057.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2014-08-18T19:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65057",
    "user": "https://github.com/a-andre"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_comments_065058.json:
```json
{
    "body": "<a id='comment:4'></a>I cannot reproduce the problem.",
    "created_at": "2014-08-18T19:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65058",
    "user": "https://github.com/a-andre"
}
```

<a id='comment:4'></a>I cannot reproduce the problem.



---

archive/issue_events_016225.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2014-08-18T19:11:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6900#event-16225"
}
```



---

archive/issue_comments_065059.json:
```json
{
    "body": "<a id='comment:5'></a>You've got to do something with GAP, of course... but I agree that this seems to not be an issue now.\n\n```\n$ ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/\nREADME.txt                     workspace-8276014924322680366\n\n$ ls /tmp/0123456789/.sage/gap/\nREADME.txt\t\t\tworkspace-8276014924322680366\n```",
    "created_at": "2014-09-18T03:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65059",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>You've got to do something with GAP, of course... but I agree that this seems to not be an issue now.

```
$ ls /tmp/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/0123456789/.sage/gap/
README.txt                     workspace-8276014924322680366

$ ls /tmp/0123456789/.sage/gap/
README.txt			workspace-8276014924322680366
```



---

archive/issue_comments_065060.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andr\u00e9 Apitzsch, Karl-Dieter Crisman\"",
    "created_at": "2014-09-18T03:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65060",
    "user": "https://github.com/kcrisman"
}
```

Changing reviewer from "" to "André Apitzsch, Karl-Dieter Crisman"



---

archive/issue_comments_065061.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-18T03:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65061",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_016226.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T17:58:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6900#event-16226"
}
```



---

archive/issue_comments_065062.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2014-09-18T17:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6900#issuecomment-65062",
    "user": "https://github.com/vbraun"
}
```

Resolution: worksforme
