# Issue 6586: update Sphinx to version 0.6.2 or 0.6.3

archive/issues_006586.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mabshoff"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nAs the summary says.  The spkg can be found at\n\nhttp://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg\n\nAfter installing it and before building any docs, you will probably need to delete the directory SAGE_ROOT/devel/sage/doc/output -- this holds cached information which may not be compatible between different versions of Sphinx.\n\nSphinx 0.6.3 also uses Jinja2.  Sage includes Jinja, not Jinja2.  As long as you're connected to a network, the installation of Sphinx 0.6.3 downloads Jinja2 and installs it -- it can coexist with Jinja, so it shouldn't mess anything up.  If you're not connected to a network, and for putting in the Sage tar ball, there is an spkg for Jinja2:\n\nhttp://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg\n\nFor producing a new Sage tarball, since we're adding a new spkg, I think we need to modify the files `spkg/install` and `spkg/standard/deps`; I've attached new versions of these.\n\nFinally, the patch below (\"inheritance_example.patch\") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.\n\n\nCC:  @mwhansen @sagetrac-sage-combinat\n\nComponent: **packages: standard**\n\nAuthor: **John Palmieri**\n\nReviewer: **John Cremona, Tim Dumol, Mitesh Patel**\n\nMerged: **sage-4.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6586_\n\n",
    "closed_at": "2009-10-16T04:45:42Z",
    "created_at": "2009-07-22T05:07:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "update Sphinx to version 0.6.2 or 0.6.3",
    "type": "issue",
    "updated_at": "2009-10-16T04:45:42Z",
    "url": "https://github.com/sagemath/sage/issues/6586",
    "user": "https://github.com/jhpalmieri"
}
```
<div id="comment:0"></div>

As the summary says.  The spkg can be found at

http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg

After installing it and before building any docs, you will probably need to delete the directory SAGE_ROOT/devel/sage/doc/output -- this holds cached information which may not be compatible between different versions of Sphinx.

Sphinx 0.6.3 also uses Jinja2.  Sage includes Jinja, not Jinja2.  As long as you're connected to a network, the installation of Sphinx 0.6.3 downloads Jinja2 and installs it -- it can coexist with Jinja, so it shouldn't mess anything up.  If you're not connected to a network, and for putting in the Sage tar ball, there is an spkg for Jinja2:

http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg

For producing a new Sage tarball, since we're adding a new spkg, I think we need to modify the files `spkg/install` and `spkg/standard/deps`; I've attached new versions of these.

Finally, the patch below ("inheritance_example.patch") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.


CC:  @mwhansen @sagetrac-sage-combinat

Component: **packages: standard**

Author: **John Palmieri**

Reviewer: **John Cremona, Tim Dumol, Mitesh Patel**

Merged: **sage-4.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/6586_





---

archive/issue_events_079123.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "milestone_number": null,
    "milestone_title": "sage-4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79123"
}
```



---

archive/issue_events_079124.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79124"
}
```



---

archive/issue_events_079125.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79125"
}
```



---

archive/issue_events_079126.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79126"
}
```



---

archive/issue_events_079127.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79127"
}
```



---

archive/issue_events_079128.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "subject": "https://github.com/jhpalmieri",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79128"
}
```



---

archive/issue_events_079129.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-22T05:07:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79129"
}
```



---

archive/issue_comments_045602.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nOh, I forgot: you need to apply the patch at #6585 for the reference manual to build.  This version of Sphinx also prints a lot of new warnings, too.",
    "created_at": "2009-07-22T05:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45602",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

Oh, I forgot: you need to apply the patch at #6585 for the reference manual to build.  This version of Sphinx also prints a lot of new warnings, too.



---

archive/issue_events_079130.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-23T01:22:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79130"
}
```



---

archive/issue_events_079131.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-23T01:22:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79131"
}
```



---

archive/issue_comments_045603.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI installed the updated SPKG with\n\n```\n./sage -f http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg\n```\nand applied the patch at #6585. When doing\n\n```\n./sage -docbuild reference html\n```\nI got the following errors:\n\n```\nmvngu@sage sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux]$ ./sage -docbuild reference html\nTraceback (most recent call last):\n  File \"/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py\", line 667, in <module>\n    getattr(get_builder(name), type)()\n  File \"/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py\", line 348, in _wrapper\n    for module_name in self.get_modified_modules():\n  File \"/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py\", line 412, in get_modified_modules\n    env = self.get_sphinx_environment()\n  File \"/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py\", line 403, in get_sphinx_environment\n    return BuildEnvironment.frompickle(config, env_pickle)\n  File \"/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/local/lib/python2.6/site-packages/Sphinx-0.6.2-py2.6.egg/sphinx/environment.py\", line 210, in frompickle\n    env = pickle.load(picklefile)\nAttributeError: 'module' object has no attribute 'RedirStream'\n```",
    "created_at": "2009-07-23T01:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45603",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:2" align="right">comment:2</div>

I installed the updated SPKG with

```
./sage -f http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg
```
and applied the patch at #6585. When doing

```
./sage -docbuild reference html
```
I got the following errors:

```
mvngu@sage sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux]$ ./sage -docbuild reference html
Traceback (most recent call last):
  File "/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py", line 667, in <module>
    getattr(get_builder(name), type)()
  File "/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py", line 348, in _wrapper
    for module_name in self.get_modified_modules():
  File "/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py", line 412, in get_modified_modules
    env = self.get_sphinx_environment()
  File "/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/devel/sage/doc/common/builder.py", line 403, in get_sphinx_environment
    return BuildEnvironment.frompickle(config, env_pickle)
  File "/scratch/mvngu/sage-4.1.1.alpha0-sage.math.washignton.edu-x86_64-Linux/local/lib/python2.6/site-packages/Sphinx-0.6.2-py2.6.egg/sphinx/environment.py", line 210, in frompickle
    env = pickle.load(picklefile)
AttributeError: 'module' object has no attribute 'RedirStream'
```



---

archive/issue_comments_045604.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think I got this error, too.  Once I deleted doc/output, things worked for me.  (I think there is something stored in the old version of the documentation which confuses the new version of Sphinx.)",
    "created_at": "2009-07-23T02:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45604",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

I think I got this error, too.  Once I deleted doc/output, things worked for me.  (I think there is something stored in the old version of the documentation which confuses the new version of Sphinx.)



---

archive/issue_events_079132.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-23T19:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79132"
}
```



---

archive/issue_events_079133.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-07-23T19:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79133"
}
```



---

archive/issue_comments_045605.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe upgraded Sphinx SPKG can't handle binary encodings in the file:\n\n```\nsage/combinat/partition.py\n```\nIn particular, the following sections from that source file:\n\n\nline:2233\n\n```\nsage: p = loads('x\\x9c\\x85\\x8e\\xbd\\xaa\\xc2@\\x10\\x85\\x89\\xff.>\\xc4\\x94\\xda\\x04\\x15|\\x04\\xb1\\xb1\\x90\\x0b[\\x87I\\x18\\x935\\xc9\\xae\\xb33\\xda\\t\\xd7\\xc2\\xf76\"biw\\x0e\\x9c\\x9f\\xef\\xbfW\\x08\\x96\\x94\\x16\\xa1\\xcd\\x9dGM\\xcf\\x18\\xd5\\xa9\\x0b\\xde\\x1c>Jv\\x91PIt\\xbf\\xcd|m8Y\\xdc\\xb9w\\xe3\\xfe\\xdc&\\xf5\\xbb\\x1d\\x9d/%u^\\xa9\\xa4hZ\\xac)\\xfb\\x18\\x1e\\xd8d\\xfd\\xf8\\xe3\\xa1\\x1df\\x1e[\\xe2\\x91\\xdd|\\x97!\\x1ca\\xb5\\x84\\n\\xaf\\xdd\\x02\\xbc\\xbe\\x05\\x1a\\x12\\x01\\xad\\xd0C\\x88@|\\xc1\\x064\\xc0\\x9a\\xc7v\\x16\\xf2\\x13\\x15\\x9a\\x15\\r\\x8a\\xf0\\xe47\\xf9;ixj\\x13_u \\xd8\\x81\\x98K\\x9e>\\x01\\x13iVH')\n```\n\n\nline:2294\n\n```\nsage: p = loads('x\\x9c\\x85\\x8e\\xbd\\x0e\\x820\\x14\\x85\\x03\\x8a?\\x8d\\x0f\\xd1Q\\x97\\x06y\\x07\\xe3\\xaa&\\x9d\\xc9\\xa5\\xb9\\x96\\n\\xb4^Z\\xdcLt\\xf0\\xbd\\xc5 qt;\\'9?\\xdf#V\\x1e4\\n\\xe5\\x9a\\xc2X\\x08\\xe2\\nm0\\xc18\\xcb\\x0e\\xa3\\xf2\\xfb\\x16!\\xa0\\x0f\\xbbcn+F\\xd1\\xe6I\\xf1\\x9d&k\\x19UC\\xbb5V{al@\\x8d-k\\xa0\\xc2|44\\x95Q\\xf6:Q\"\\x93\\xdcB\\x834\\x93\\xe9o\\x99\\xbb3\\xdf\\xa6\\xbc\\x84[\\xbf\\xc0\\xf5\\xf7\\x87\\x7f 8R\\x075\\x0f\\x8eg4\\x97+W\\\\P\\x85\\\\\\xd5\\xe0=-\\xfeC\\x0fIFK\\x19\\xd9\\xb2g\\x80\\x9e\\x81u\\x85x\\x03w\\x0eT\\xb1')\n```\n\n\nline:2839\n\n```\nsage: dmp = 'x\\x9ck`J.NLO\\xd5K\\xce\\xcfM\\xca\\xccK,\\xd1+H,*\\xc9,\\xc9\\xcc\\xcf\\xe3\\n\\x80\\xb1\\x8a\\xe3\\x93\\x81DIQbf^I1W!\\xa3fc!Sm!\\xb3F(7\\x92x!Km!k(GnbE<\\xc8\\x88B6\\x88\\xb9E\\x99y\\xe9\\xc5z@\\x05\\xa9\\xe9\\xa9E\\\\\\xb9\\x89\\xd9\\xa9\\xf10N!{(\\xa3QkP!Gq(c^\\x06\\x90c\\x0c\\xe4p\\x96&\\xe9\\x01\\x00\\xc2\\xe53\\xfd'\n```\nWhen these lines are removed, the HTML version of the reference manual builds OK. So a possible fix for line 2233 is to replace everything in the TEST block starting from that line by:\n\n```\nsage: p = PartitionsGreatestLE(10,2)\nsage: p == loads(dumps(p))\nTrue\n```\nWe can do something similar for line 2294; replace everything in the TEST block starting from line 2294 by:\n\n```\nsage: p = PartitionsGreatestEQ(10,2)\nsage: p == loads(dumps(p))\nTrue\n```\nAs for the TEST block starting from line 2839, I have no idea how to fix it so that the reference manual would successfully builds. Someone on the sage-combinat team to the rescue?",
    "created_at": "2009-07-24T10:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45605",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:5" align="right">comment:5</div>

The upgraded Sphinx SPKG can't handle binary encodings in the file:

```
sage/combinat/partition.py
```
In particular, the following sections from that source file:


line:2233

```
sage: p = loads('x\x9c\x85\x8e\xbd\xaa\xc2@\x10\x85\x89\xff.>\xc4\x94\xda\x04\x15|\x04\xb1\xb1\x90\x0b[\x87I\x18\x935\xc9\xae\xb33\xda\t\xd7\xc2\xf76"biw\x0e\x9c\x9f\xef\xbfW\x08\x96\x94\x16\xa1\xcd\x9dGM\xcf\x18\xd5\xa9\x0b\xde\x1c>Jv\x91PIt\xbf\xcd|m8Y\xdc\xb9w\xe3\xfe\xdc&\xf5\xbb\x1d\x9d/%u^\xa9\xa4hZ\xac)\xfb\x18\x1e\xd8d\xfd\xf8\xe3\xa1\x1df\x1e[\xe2\x91\xdd|\x97!\x1ca\xb5\x84\n\xaf\xdd\x02\xbc\xbe\x05\x1a\x12\x01\xad\xd0C\x88@|\xc1\x064\xc0\x9a\xc7v\x16\xf2\x13\x15\x9a\x15\r\x8a\xf0\xe47\xf9;ixj\x13_u \xd8\x81\x98K\x9e>\x01\x13iVH')
```


line:2294

```
sage: p = loads('x\x9c\x85\x8e\xbd\x0e\x820\x14\x85\x03\x8a?\x8d\x0f\xd1Q\x97\x06y\x07\xe3\xaa&\x9d\xc9\xa5\xb9\x96\n\xb4^Z\xdcLt\xf0\xbd\xc5 qt;\'9?\xdf#V\x1e4\n\xe5\x9a\xc2X\x08\xe2\nm0\xc18\xcb\x0e\xa3\xf2\xfb\x16!\xa0\x0f\xbbcn+F\xd1\xe6I\xf1\x9d&k\x19UC\xbb5V{al@\x8d-k\xa0\xc2|44\x95Q\xf6:Q"\x93\xdcB\x834\x93\xe9o\x99\xbb3\xdf\xa6\xbc\x84[\xbf\xc0\xf5\xf7\x87\x7f 8R\x075\x0f\x8eg4\x97+W\\P\x85\\\xd5\xe0=-\xfeC\x0fIFK\x19\xd9\xb2g\x80\x9e\x81u\x85x\x03w\x0eT\xb1')
```


line:2839

```
sage: dmp = 'x\x9ck`J.NLO\xd5K\xce\xcfM\xca\xccK,\xd1+H,*\xc9,\xc9\xcc\xcf\xe3\n\x80\xb1\x8a\xe3\x93\x81DIQbf^I1W!\xa3fc!Sm!\xb3F(7\x92x!Km!k(GnbE<\xc8\x88B6\x88\xb9E\x99y\xe9\xc5z@\x05\xa9\xe9\xa9E\\\xb9\x89\xd9\xa9\xf10N!{(\xa3QkP!Gq(c^\x06\x90c\x0c\xe4p\x96&\xe9\x01\x00\xc2\xe53\xfd'
```
When these lines are removed, the HTML version of the reference manual builds OK. So a possible fix for line 2233 is to replace everything in the TEST block starting from that line by:

```
sage: p = PartitionsGreatestLE(10,2)
sage: p == loads(dumps(p))
True
```
We can do something similar for line 2294; replace everything in the TEST block starting from line 2294 by:

```
sage: p = PartitionsGreatestEQ(10,2)
sage: p == loads(dumps(p))
True
```
As for the TEST block starting from line 2839, I have no idea how to fix it so that the reference manual would successfully builds. Someone on the sage-combinat team to the rescue?



---

archive/issue_comments_045606.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jhpalmieri](#comment%3A1):\n> Oh, I forgot: you need to apply the patch at #6585 for the reference manual to build.  This version of Sphinx also prints a lot of new warnings, too.\n\nI think that this patch fixes the issue with binary encodings; at least it did for me.",
    "created_at": "2009-07-24T14:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45606",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jhpalmieri](#comment%3A1):
> Oh, I forgot: you need to apply the patch at #6585 for the reference manual to build.  This version of Sphinx also prints a lot of new warnings, too.

I think that this patch fixes the issue with binary encodings; at least it did for me.



---

archive/issue_comments_045607.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWith the patch at #6585 and the SPKG, building the reference manual on sage.math takes much longer than previously.",
    "created_at": "2009-07-25T23:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45607",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:7" align="right">comment:7</div>

With the patch at #6585 and the SPKG, building the reference manual on sage.math takes much longer than previously.



---

archive/issue_comments_045608.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@sagetrac-mvngu](#comment%3A7):\n> With the patch at #6585 and the SPKG, building the reference manual on sage.math takes much longer than previously. \n\nI agree: on my mac, it took 28 minutes to build the html version with the old one, and 43 minutes with the new one.  With the --jsmath option on, the old one took 6 minutes and the new one took 15 minutes.  I was getting similar comparisons on sage.math.  (This is with me deleting devel/sage/doc/output between each build, to level the playing field.) \n\nIt's strange: for the tutorial and developer's guide, building is about the same or slightly faster with the new version. I also made a modified version of the developer's guide by duplicating some sections (so that the resulting PDF file was 559 pages); the new version was slightly faster there, too.  Maybe it's all of the math in the reference manual?  Maybe it's the large number of files?  Maybe it's the autogeneration of files?",
    "created_at": "2009-07-26T22:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45608",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@sagetrac-mvngu](#comment%3A7):
> With the patch at #6585 and the SPKG, building the reference manual on sage.math takes much longer than previously. 

I agree: on my mac, it took 28 minutes to build the html version with the old one, and 43 minutes with the new one.  With the --jsmath option on, the old one took 6 minutes and the new one took 15 minutes.  I was getting similar comparisons on sage.math.  (This is with me deleting devel/sage/doc/output between each build, to level the playing field.) 

It's strange: for the tutorial and developer's guide, building is about the same or slightly faster with the new version. I also made a modified version of the developer's guide by duplicating some sections (so that the resulting PDF file was 559 pages); the new version was slightly faster there, too.  Maybe it's all of the math in the reference manual?  Maybe it's the large number of files?  Maybe it's the autogeneration of files?



---

archive/issue_comments_045609.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nCursory [profiling](http://docs.python.org/library/profile.html) with #6187's \"testreference\" target indicates that the rewritten `autodoc` extension is significantly slower than before.  I think `autodoc` now also uses far more memory.  Attempting to build the full reference manual on my machine, Sphinx \"stalled\" at 97% of modules read.  I think the kernel was too busy swapping everything but Sphinx to disk.\n\nPerhaps there's a more efficient, parallelizable representation.  Can we subclass and/or Cythonize [sphinx.ext.autodoc.Documenter](http://sphinx.pocoo.org/ext/appapi.html#sphinx.application.Sphinx.add_autodocumenter)?",
    "created_at": "2009-07-30T07:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45609",
    "user": "https://github.com/qed777"
}
```

<div id="comment:9" align="right">comment:9</div>

Cursory [profiling](http://docs.python.org/library/profile.html) with #6187's "testreference" target indicates that the rewritten `autodoc` extension is significantly slower than before.  I think `autodoc` now also uses far more memory.  Attempting to build the full reference manual on my machine, Sphinx "stalled" at 97% of modules read.  I think the kernel was too busy swapping everything but Sphinx to disk.

Perhaps there's a more efficient, parallelizable representation.  Can we subclass and/or Cythonize [sphinx.ext.autodoc.Documenter](http://sphinx.pocoo.org/ext/appapi.html#sphinx.application.Sphinx.add_autodocumenter)?



---

archive/issue_comments_045610.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMinor progress:  It seems that a custom [autodoc-skip-member](http://sphinx.pocoo.org/ext/autodoc.html?highlight=inherited%20members#skipping-members) method now *overrides* Sphinx's default behavior, which is to skip private methods (`__init__`, etc.).  To keep these out of the reference manual, we might use, e.g.,\n\n```\ndef skip_NestedClass(app, what, name, obj, skip, options):\n    \"\"\"docstring\"\"\"\n    skip_nested = str(obj).find(\"sage.misc.misc\") != -1 and name.find(\"MainClass.NestedClass\") != -1\n    return skip or skip_nested\n```\nin `conf.py`.  Unfortunately, this does not significantly reduce the build time or memory usage.",
    "created_at": "2009-08-01T15:05:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45610",
    "user": "https://github.com/qed777"
}
```

<div id="comment:10" align="right">comment:10</div>

Minor progress:  It seems that a custom [autodoc-skip-member](http://sphinx.pocoo.org/ext/autodoc.html?highlight=inherited%20members#skipping-members) method now *overrides* Sphinx's default behavior, which is to skip private methods (`__init__`, etc.).  To keep these out of the reference manual, we might use, e.g.,

```
def skip_NestedClass(app, what, name, obj, skip, options):
    """docstring"""
    skip_nested = str(obj).find("sage.misc.misc") != -1 and name.find("MainClass.NestedClass") != -1
    return skip or skip_nested
```
in `conf.py`.  Unfortunately, this does not significantly reduce the build time or memory usage.



---

archive/issue_comments_045611.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nApparently, the culprit is `sphinx.pycode`'s Python source analyzer, which `sphinx.ext.autodoc` uses to extract *attribute* docstrings.  From `Sphinx-0.6.2-py2.6.egg/sphinx/pycode/__init__.py`:\n\n```\n    The docstrings can either be in special '#:' comments before the assignment\n    or in a docstring after it.\n```\nAccording to the analyzer, there are just two places to find such docstrings in the Sage library:\n* `combinat/designs/block_design.py`\n* `schemes/elliptic_curves/ell_field.py`\nStill, resource use is high, because there is a **lot** of caching going on.  We can reduce it with [weak references](http://docs.python.org/library/weakref.html):\n\n```\n--- __init__.py.orig    2009-08-01 09:58:27.303927239 -0700\n+++ __init__.py 2009-08-01 11:35:17.477865562 -0700\n@@ -120,10 +120,11 @@ class PycodeError(Exception):\n             res += ' (exception was: %r)' % self.args[1]\n         return res\n \n-\n+import weakref\n class ModuleAnalyzer(object):\n     # cache for analyzer objects -- caches both by module and file name\n-    cache = {}\n+#    cache = {}\n+    cache = weakref.WeakValueDictionary()\n \n     @classmethod\n     def for_string(cls, string, modname, srcname='<string>'):\n```\nThis does reduce build time and memory usage, but I don't know if the output is identical.",
    "created_at": "2009-08-01T19:25:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45611",
    "user": "https://github.com/qed777"
}
```

<div id="comment:11" align="right">comment:11</div>

Apparently, the culprit is `sphinx.pycode`'s Python source analyzer, which `sphinx.ext.autodoc` uses to extract *attribute* docstrings.  From `Sphinx-0.6.2-py2.6.egg/sphinx/pycode/__init__.py`:

```
    The docstrings can either be in special '#:' comments before the assignment
    or in a docstring after it.
```
According to the analyzer, there are just two places to find such docstrings in the Sage library:
* `combinat/designs/block_design.py`
* `schemes/elliptic_curves/ell_field.py`
Still, resource use is high, because there is a **lot** of caching going on.  We can reduce it with [weak references](http://docs.python.org/library/weakref.html):

```
--- __init__.py.orig    2009-08-01 09:58:27.303927239 -0700
+++ __init__.py 2009-08-01 11:35:17.477865562 -0700
@@ -120,10 +120,11 @@ class PycodeError(Exception):
             res += ' (exception was: %r)' % self.args[1]
         return res
 
-
+import weakref
 class ModuleAnalyzer(object):
     # cache for analyzer objects -- caches both by module and file name
-    cache = {}
+#    cache = {}
+    cache = weakref.WeakValueDictionary()
 
     @classmethod
     def for_string(cls, string, modname, srcname='<string>'):
```
This does reduce build time and memory usage, but I don't know if the output is identical.



---

archive/issue_comments_045612.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFor `sage -docbuild reference html --jsmath`, at least, the results are close:\n\n```\n$ du -s output_v0*\n95550   output_v051\n97392   output_v062\n97388   output_v062_mod\n```\nThe differences are in `environmental.pickle` or stem from using a function as a default argument in\n* `combinat/words/word_content.py`\n* `rings/polynomial/groebner_fan.py`",
    "created_at": "2009-08-01T20:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45612",
    "user": "https://github.com/qed777"
}
```

<div id="comment:12" align="right">comment:12</div>

For `sage -docbuild reference html --jsmath`, at least, the results are close:

```
$ du -s output_v0*
95550   output_v051
97392   output_v062
97388   output_v062_mod
```
The differences are in `environmental.pickle` or stem from using a function as a default argument in
* `combinat/words/word_content.py`
* `rings/polynomial/groebner_fan.py`



---

archive/issue_comments_045613.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nClearly, it's time for a break.",
    "created_at": "2009-08-01T20:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45613",
    "user": "https://github.com/qed777"
}
```

<div id="comment:13" align="right">comment:13</div>

Clearly, it's time for a break.



---

archive/issue_comments_045614.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNice observation.  Making the change with weak_references does indeed speed things up: \n\n```\n0.5.1     28 minutes\n0.6.2     43 minutes\n0.6.2     33 minutes   (version using weakref)\n```\nWith no other changes, it includes all of the private methods, as already pointed out (and I assume it did before using weakref -- this may account for some of the increased time, since it's producing more output), but it also includes (for some classes, anyway), an entry for `__weakref)_`.  See the documentation for sage/algebras/steenrod_algebra.py, for instance: it lists as an attribute of SteenrodAlgebraFactory\n\n```\n__weakref__\n   list of weak references to the object (if defined)\n```",
    "created_at": "2009-08-02T00:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45614",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Nice observation.  Making the change with weak_references does indeed speed things up: 

```
0.5.1     28 minutes
0.6.2     43 minutes
0.6.2     33 minutes   (version using weakref)
```
With no other changes, it includes all of the private methods, as already pointed out (and I assume it did before using weakref -- this may account for some of the increased time, since it's producing more output), but it also includes (for some classes, anyway), an entry for `__weakref)_`.  See the documentation for sage/algebras/steenrod_algebra.py, for instance: it lists as an attribute of SteenrodAlgebraFactory

```
__weakref__
   list of weak references to the object (if defined)
```



---

archive/issue_comments_045615.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nActually, noticing `__weakref__` for that module is what led to the comment about `autodoc-skip-member`.  I think this was before I \"patched\" Sphinx, but I may be mistaken.  I'm also not sure about why `__weakref__` appears spontaneously.  Perhaps a super class?",
    "created_at": "2009-08-02T01:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45615",
    "user": "https://github.com/qed777"
}
```

<div id="comment:15" align="right">comment:15</div>

Actually, noticing `__weakref__` for that module is what led to the comment about `autodoc-skip-member`.  I think this was before I "patched" Sphinx, but I may be mistaken.  I'm also not sure about why `__weakref__` appears spontaneously.  Perhaps a super class?



---

archive/issue_comments_045616.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSee #6664 for the `autodoc-skip-member` issue.",
    "created_at": "2009-08-02T10:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45616",
    "user": "https://github.com/qed777"
}
```

<div id="comment:16" align="right">comment:16</div>

See #6664 for the `autodoc-skip-member` issue.



---

archive/issue_comments_045617.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAlso, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).",
    "created_at": "2009-08-02T10:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45617",
    "user": "https://github.com/qed777"
}
```

<div id="comment:17" align="right">comment:17</div>

Also, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).



---

archive/issue_comments_045618.json:
```json
{
    "body": "Example inheritance diagram for \"The Steenrod algebra\".  This is just for fun.",
    "created_at": "2009-08-02T21:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45618",
    "user": "https://github.com/qed777"
}
```

Example inheritance diagram for "The Steenrod algebra".  This is just for fun.



---

archive/issue_comments_045619.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[inheritance_example.patch.gz](https://github.com/sagemath/sage/files/ticket6586/inheritance_example.patch.gz)**\n\nThe new [inheritance diagram](http://sphinx.pocoo.org/ext/inheritance.html?highlight=inheritance#module-sphinx.ext.inheritance_diagram) extension has potential.  I've attached a minimal example.  **Please do not merge it.**\n\nThe options are limited, however.  For example, I could not find a directive that auto-generates a diagram for each module.  Also, it seems there's no way to color-code the nodes/classes, e.g., to indicate their modular provenance.  Maybe it's possible to do one or more of these ourselves, in `builder.py`, `conf.py`, or by patching Sphinx.",
    "created_at": "2009-08-02T21:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45619",
    "user": "https://github.com/qed777"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[inheritance_example.patch.gz](https://github.com/sagemath/sage/files/ticket6586/inheritance_example.patch.gz)**

The new [inheritance diagram](http://sphinx.pocoo.org/ext/inheritance.html?highlight=inheritance#module-sphinx.ext.inheritance_diagram) extension has potential.  I've attached a minimal example.  **Please do not merge it.**

The options are limited, however.  For example, I could not find a directive that auto-generates a diagram for each module.  Also, it seems there's no way to color-code the nodes/classes, e.g., to indicate their modular provenance.  Maybe it's possible to do one or more of these ourselves, in `builder.py`, `conf.py`, or by patching Sphinx.



---

archive/issue_comments_045620.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI should add that this requires a local installation of [GraphViz](http://www.graphviz.org/).",
    "created_at": "2009-08-02T21:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45620",
    "user": "https://github.com/qed777"
}
```

<div id="comment:19" align="right">comment:19</div>

I should add that this requires a local installation of [GraphViz](http://www.graphviz.org/).



---

archive/issue_comments_045621.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@qed777](#comment%3A17):\n> Also, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).  \n\nThe [thread](https://github.com/sagemath/sage/files/ticket6187/trac_6187_testreference.patch.gz).  Preliminary tests indicate that the proposed alternative does not reduce memory use significantly.",
    "created_at": "2009-08-05T08:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45621",
    "user": "https://github.com/qed777"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@qed777](#comment%3A17):
> Also, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).  

The [thread](https://github.com/sagemath/sage/files/ticket6187/trac_6187_testreference.patch.gz).  Preliminary tests indicate that the proposed alternative does not reduce memory use significantly.



---

archive/issue_comments_045622.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@qed777](#comment%3A20):\n> Replying to [@qed777](#comment%3A17):\n> > Also, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).  \n> \n> The [thread](https://github.com/sagemath/sage/files/ticket6187/trac_6187_testreference.patch.gz).  Preliminary tests indicate that the proposed alternative does not reduce memory use significantly.  \n\n[Here](http://groups.google.com/group/sphinx-dev/browse_thread/thread/db7752d5316f699c), actually.",
    "created_at": "2009-08-05T08:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45622",
    "user": "https://github.com/qed777"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@qed777](#comment%3A20):
> Replying to [@qed777](#comment%3A17):
> > Also, I've asked about the merits of the `weakref` workaround on [sphinx-dev](http://groups.google.com/group/sphinx-dev).  
> 
> The [thread](https://github.com/sagemath/sage/files/ticket6187/trac_6187_testreference.patch.gz).  Preliminary tests indicate that the proposed alternative does not reduce memory use significantly.  

[Here](http://groups.google.com/group/sphinx-dev/browse_thread/thread/db7752d5316f699c), actually.



---

archive/issue_comments_045623.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThere's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?",
    "created_at": "2009-08-14T12:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45623",
    "user": "https://github.com/qed777"
}
```

<div id="comment:22" align="right">comment:22</div>

There's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?



---

archive/issue_comments_045624.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@qed777](#comment%3A22):\n> There's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?\n\nHmm... could you make an spkg with that workaround?",
    "created_at": "2009-08-14T12:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45624",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@qed777](#comment%3A22):
> There's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?

Hmm... could you make an spkg with that workaround?



---

archive/issue_comments_045625.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@sagetrac-mvngu](#comment%3A23):\n> Replying to [@qed777](#comment%3A22):\n> > There's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?\n> \n> Hmm... could you make an spkg with that workaround?\n\nI can certainly do it, but not until Monday.",
    "created_at": "2009-08-14T15:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45625",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@sagetrac-mvngu](#comment%3A23):
> Replying to [@qed777](#comment%3A22):
> > There's been no further activity about the workaround on sphinx-dev.  Since weakrefs appear to work for us, should we add a patch to the spkg?
> 
> Hmm... could you make an spkg with that workaround?

I can certainly do it, but not until Monday.



---

archive/issue_comments_045626.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nDoes the problem described [here](http://groups.google.com/group/sage-devel/browse_thread/thread/fa1f33186d5fd636#) recur with the new spkg?",
    "created_at": "2009-08-20T06:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45626",
    "user": "https://github.com/qed777"
}
```

<div id="comment:25" align="right">comment:25</div>

Does the problem described [here](http://groups.google.com/group/sage-devel/browse_thread/thread/fa1f33186d5fd636#) recur with the new spkg?



---

archive/issue_comments_045627.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe new spkg is at\n\n[http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p1.spkg)\n\n(The old one is still there; it's \"...p0.spkg\", as listed in the description above.)",
    "created_at": "2009-08-20T14:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45627",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

The new spkg is at

[http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p1.spkg)

(The old one is still there; it's "...p0.spkg", as listed in the description above.)



---

archive/issue_comments_045628.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nBy the way, note that since this includes the private methods in the reference manual, there are a lot of new warnings when building that document.  (People haven't written all of the docstrings for their `__init__` methods, etc., to conform with proper reST format, since they didn't need to before.)  These should be dealt with in a separate ticket: otherwise, we might feel obliged to keep rebasing this ticket until it was merged.",
    "created_at": "2009-08-23T17:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45628",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

By the way, note that since this includes the private methods in the reference manual, there are a lot of new warnings when building that document.  (People haven't written all of the docstrings for their `__init__` methods, etc., to conform with proper reST format, since they didn't need to before.)  These should be dealt with in a separate ticket: otherwise, we might feel obliged to keep rebasing this ticket until it was merged.



---

archive/issue_comments_045629.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nDoes #6664 suppress the private methods?",
    "created_at": "2009-08-23T17:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45629",
    "user": "https://github.com/qed777"
}
```

<div id="comment:28" align="right">comment:28</div>

Does #6664 suppress the private methods?



---

archive/issue_comments_045630.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n> Does #6664 suppress the private methods?\n\nYes, but do we *want* to suppress the private methods?  I actually prefer that they be included in the reference manual.",
    "created_at": "2009-08-23T18:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45630",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

> Does #6664 suppress the private methods?

Yes, but do we *want* to suppress the private methods?  I actually prefer that they be included in the reference manual.



---

archive/issue_comments_045631.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nUh oh, it seems as though with this spkg, changes to pyx files are not detected.  That is, build the documentation (say, with the jsmath option).  Then edit a .py file and a .pyx file (I chose sage/misc/latex.py and sage/matrix/matrix0.pyx).  Run 'sage -docbuild reference print_modified_modules': the .py file will be listed, but not the .pyx file.  I can't figure out why this is happening :(",
    "created_at": "2009-08-23T22:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45631",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Uh oh, it seems as though with this spkg, changes to pyx files are not detected.  That is, build the documentation (say, with the jsmath option).  Then edit a .py file and a .pyx file (I chose sage/misc/latex.py and sage/matrix/matrix0.pyx).  Run 'sage -docbuild reference print_modified_modules': the .py file will be listed, but not the .pyx file.  I can't figure out why this is happening :(



---

archive/issue_comments_045632.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI also don't know why.  `builder.py` uses Sphinx's `get_outdated_files()` method to get an iterable of modified modules.  However, this method's code is the same in v0.5.1 and v0.6.2.  I did find that the newer Sphinx does not include .so files for .pyx files in `environment.pickle`'s `dependencies` dictionary.  This may \"explain\" the observed behavior.",
    "created_at": "2009-08-26T11:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45632",
    "user": "https://github.com/qed777"
}
```

<div id="comment:31" align="right">comment:31</div>

I also don't know why.  `builder.py` uses Sphinx's `get_outdated_files()` method to get an iterable of modified modules.  However, this method's code is the same in v0.5.1 and v0.6.2.  I did find that the newer Sphinx does not include .so files for .pyx files in `environment.pickle`'s `dependencies` dictionary.  This may "explain" the observed behavior.



---

archive/issue_comments_045633.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI played around with the Sphinx code for a while, and I could not figure out what's going on.  Well, I believe that \"matrix0.so\" was listed as a dependency of \"matrix0.pyx\" in version 0.5.1, so changing the .pyx file resulted in the modification time for the .so file to be wrong, triggering a rebuild of the docs, but in 0.6.2, the .so file no longer appears to be a dependency of the .pyx file.  I've posted a message to sphinx-dev about how dependencies are determined; we'll see if there are any helpful responses.",
    "created_at": "2009-08-27T02:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45633",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

I played around with the Sphinx code for a while, and I could not figure out what's going on.  Well, I believe that "matrix0.so" was listed as a dependency of "matrix0.pyx" in version 0.5.1, so changing the .pyx file resulted in the modification time for the .so file to be wrong, triggering a rebuild of the docs, but in 0.6.2, the .so file no longer appears to be a dependency of the .pyx file.  I've posted a message to sphinx-dev about how dependencies are determined; we'll see if there are any helpful responses.



---

archive/issue_comments_045634.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOkay, I now have a patch which seems to recognize changes to pyx files.  The dependency information is stored in the pickle, so to test this, first delete `SAGEDOC/output/doctrees/`.  The new spkg is available from\n[http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg).\n\nPlease test thoroughly.  (One thing to watch out for: I thought it wasn't working because I was changing sage/matrix/action.pyx and seeing no notification when the reference manual was built, but then I realized that action.pyx isn't even included in the reference manual.  Doh.)",
    "created_at": "2009-09-02T21:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45634",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

Okay, I now have a patch which seems to recognize changes to pyx files.  The dependency information is stored in the pickle, so to test this, first delete `SAGEDOC/output/doctrees/`.  The new spkg is available from
[http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg).

Please test thoroughly.  (One thing to watch out for: I thought it wasn't working because I was changing sage/matrix/action.pyx and seeing no notification when the reference manual was built, but then I realized that action.pyx isn't even included in the reference manual.  Doh.)



---

archive/issue_comments_045635.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nIn case anyone downloaded the version posted yesterday, there is a slightly modified version today: the author of Sphinx posted a patch for the Cython problem to the [Sphinx mercurial site](http://bitbucket.org/birkenfeld/sphinx/changeset/8a434cdb511f/), and so the version today uses that patch instead.  (Mine was similar to his, but why not use the official one?)\n\nI've replaced the old one with the new one, so the link is the same: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg).",
    "created_at": "2009-09-03T21:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45635",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

In case anyone downloaded the version posted yesterday, there is a slightly modified version today: the author of Sphinx posted a patch for the Cython problem to the [Sphinx mercurial site](http://bitbucket.org/birkenfeld/sphinx/changeset/8a434cdb511f/), and so the version today uses that patch instead.  (Mine was similar to his, but why not use the official one?)

I've replaced the old one with the new one, so the link is the same: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p2.spkg).



---

archive/issue_events_079134.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-09-04T02:02:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "title_is": "update Sphinx to version 0.6.2 or 0.6.3",
    "title_was": "update Sphinx to version 0.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79134"
}
```



---

archive/issue_comments_045636.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nOkay, here's another one.  Sphinx was just updated to version 0.6.3, and this is supposed to fix our problems.  In my testing, it doesn't have the Cython problem that the original version of 0.6.2 had; it incorporates the patch in the most recent 0.6.2 spkg.  The 0.6.3 spkg is a bit slower than 0.5.1 and also than our version of 0.6.2 with the unauthorized weakref patch.  It's not nearly as slow and doesn't seem to use nearly as much memory as the unpatched 0.6.2.  Here's the spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p0.spkg).\n\nSome timings in minutes for \"sage -docbuild reference html --jsmath\", with the patch at #6664 applied:\n\n```\n                    Mac      sage.math  ubuntu\nSphinx 0.5.1         6           5        10\nSphinx 0.6.2.p2      6           6        10\nSphinx 0.6.3         8           9        11\n```\n\"Mac\" is my Intel iMac running OS X 10.5; \"sage.math\" is sage.math, and \"ubuntu\" is an old ubuntu box I have access to.\n\nAs I said above, the memory usage seems to stay within reason for all of these, but I'm not using anything sophisticated to test this: with the terrible version, my computer would become very sluggish, and with the versions tested here, that doesn't happen.",
    "created_at": "2009-09-04T02:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45636",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

Okay, here's another one.  Sphinx was just updated to version 0.6.3, and this is supposed to fix our problems.  In my testing, it doesn't have the Cython problem that the original version of 0.6.2 had; it incorporates the patch in the most recent 0.6.2 spkg.  The 0.6.3 spkg is a bit slower than 0.5.1 and also than our version of 0.6.2 with the unauthorized weakref patch.  It's not nearly as slow and doesn't seem to use nearly as much memory as the unpatched 0.6.2.  Here's the spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p0.spkg).

Some timings in minutes for "sage -docbuild reference html --jsmath", with the patch at #6664 applied:

```
                    Mac      sage.math  ubuntu
Sphinx 0.5.1         6           5        10
Sphinx 0.6.2.p2      6           6        10
Sphinx 0.6.3         8           9        11
```
"Mac" is my Intel iMac running OS X 10.5; "sage.math" is sage.math, and "ubuntu" is an old ubuntu box I have access to.

As I said above, the memory usage seems to stay within reason for all of these, but I'm not using anything sophisticated to test this: with the terrible version, my computer would become very sluggish, and with the versions tested here, that doesn't happen.



---

archive/issue_comments_045637.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nFor Sage 4.1.2.alpha0's HTML reference manual, at least, the new spkg seems to work just as Georg indicated.  I'll try to do more testing soon.\n\nBy the way, it might be useful to update spkg-install along the lines of #6598 and [this example](http://wiki.sagemath.org/DavidKirkby).  For example,\n\n```\n#!/usr/bin/env bash\n\nif [ -z \"$SAGE_LOCAL\" ]; then\n   echo \"SAGE_LOCAL undefined ... exiting\";\n   echo \"Maybe run 'sage -sh'?\"\n   exit 1\nfi\n\nsuccess() {\n    if [ $? -ne 0 ]; then\n        echo \"Error building Sphinx: '$1'\"\n        exit 1\n    fi\n}\n\nset -e\n\necho \"Removing old version...\"\nrm -rf \"$SAGE_LOCAL\"/lib/python/site-packages/Sphinx-*\nsuccess 'deleting previous version'\n\n[...]\n```",
    "created_at": "2009-09-04T07:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45637",
    "user": "https://github.com/qed777"
}
```

<div id="comment:36" align="right">comment:36</div>

For Sage 4.1.2.alpha0's HTML reference manual, at least, the new spkg seems to work just as Georg indicated.  I'll try to do more testing soon.

By the way, it might be useful to update spkg-install along the lines of #6598 and [this example](http://wiki.sagemath.org/DavidKirkby).  For example,

```
#!/usr/bin/env bash

if [ -z "$SAGE_LOCAL" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

success() {
    if [ $? -ne 0 ]; then
        echo "Error building Sphinx: '$1'"
        exit 1
    fi
}

set -e

echo "Removing old version..."
rm -rf "$SAGE_LOCAL"/lib/python/site-packages/Sphinx-*
success 'deleting previous version'

[...]
```



---

archive/issue_comments_045638.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@qed777](#comment%3A36):\n> By the way, it might be useful to update spkg-install along the lines of #6598 and [this example](http://wiki.sagemath.org/DavidKirkby).  For example,\n\nOkay, try this one: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg).  (Putting \"set -e\" in other places made the script exit without printing the custom error message.  With this one, if, for example, I make the directory `\"$SAGE_LOCAL\"/lib/python/site-packages/Sphinx-*` undeletable, I get the appropriate message.)",
    "created_at": "2009-09-04T21:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45638",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@qed777](#comment%3A36):
> By the way, it might be useful to update spkg-install along the lines of #6598 and [this example](http://wiki.sagemath.org/DavidKirkby).  For example,

Okay, try this one: [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg).  (Putting "set -e" in other places made the script exit without printing the custom error message.  With this one, if, for example, I make the directory `"$SAGE_LOCAL"/lib/python/site-packages/Sphinx-*` undeletable, I get the appropriate message.)



---

archive/issue_comments_045639.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThanks very much for pointing that out.  I may need to update the spkgs at #5447...",
    "created_at": "2009-09-05T14:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45639",
    "user": "https://github.com/qed777"
}
```

<div id="comment:38" align="right">comment:38</div>

Thanks very much for pointing that out.  I may need to update the spkgs at #5447...



---

archive/issue_comments_045640.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nForgive me if I'm mistaken, but doesn't Sphinx>=0.6 depend on Jinja2?\n\n  Incompatible changes:\n\n* Templating now requires the Jinja2 library, which is an enhanced version of the old Jinja1 engine.\n\nhttp://sphinx.pocoo.org/changes.html#release-0-6-mar-24-2009",
    "created_at": "2009-09-05T15:58:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45640",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:39" align="right">comment:39</div>

Forgive me if I'm mistaken, but doesn't Sphinx>=0.6 depend on Jinja2?

  Incompatible changes:

* Templating now requires the Jinja2 library, which is an enhanced version of the old Jinja1 engine.

http://sphinx.pocoo.org/changes.html#release-0-6-mar-24-2009



---

archive/issue_comments_045641.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nYes.  I think `site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg`, say, is installed automatically (via network) by `python setup.py install` in `spkg-install`.\n\nShould we make it a separate spkg, to supplement or replace `jinja-1.2.p0.spkg`?",
    "created_at": "2009-09-05T16:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45641",
    "user": "https://github.com/qed777"
}
```

<div id="comment:40" align="right">comment:40</div>

Yes.  I think `site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg`, say, is installed automatically (via network) by `python setup.py install` in `spkg-install`.

Should we make it a separate spkg, to supplement or replace `jinja-1.2.p0.spkg`?



---

archive/issue_comments_045642.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2009-09-05T16:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45642",
    "user": "https://github.com/qed777"
}
```

Author: **John Palmieri**



---

archive/issue_comments_045643.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI checked that Sphinx now incorporates changes to included .py and .pyx files.\n\nFor the HTML builder, both `jsmath` and `pngmath` modes appear to work as expected.  \n\nThe PDF reference manual's table of contents is missing.  This may stem from #6885 and my invoking LaTeX's batch mode with `b`.",
    "created_at": "2009-09-05T16:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45643",
    "user": "https://github.com/qed777"
}
```

<div id="comment:41" align="right">comment:41</div>

I checked that Sphinx now incorporates changes to included .py and .pyx files.

For the HTML builder, both `jsmath` and `pngmath` modes appear to work as expected.  

The PDF reference manual's table of contents is missing.  This may stem from #6885 and my invoking LaTeX's batch mode with `b`.



---

archive/issue_comments_045644.json:
```json
{
    "body": "Reviewer: **Mitesh Patel**",
    "created_at": "2009-09-05T16:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45644",
    "user": "https://github.com/qed777"
}
```

Reviewer: **Mitesh Patel**



---

archive/issue_comments_045645.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@qed777](#comment%3A40):\n> Yes.  I think `site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg`, say, is installed automatically (via network) by `python setup.py install` in `spkg-install`.\n> \n> Should we make it a separate spkg, to supplement or replace `jinja-1.2.p0.spkg`?\n\nI think it would probably best to make a separate spkg so that installation will not require network access. I've made an spkg that I can post if you want.\n\nAlso, the spkg for this states that it depends on Jinja>=``1.1``, which is no longer the case.",
    "created_at": "2009-09-06T01:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45645",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@qed777](#comment%3A40):
> Yes.  I think `site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg`, say, is installed automatically (via network) by `python setup.py install` in `spkg-install`.
> 
> Should we make it a separate spkg, to supplement or replace `jinja-1.2.p0.spkg`?

I think it would probably best to make a separate spkg so that installation will not require network access. I've made an spkg that I can post if you want.

Also, the spkg for this states that it depends on Jinja>=``1.1``, which is no longer the case.



---

archive/issue_comments_045646.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nOkay, I've updated the file SPKG.txt (in [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg)) to say that it depends on Jinja >= 2.  If you want to post a link to an spkg for jinja, that would be great.",
    "created_at": "2009-09-06T02:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45646",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:43" align="right">comment:43</div>

Okay, I've updated the file SPKG.txt (in [http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg)) to say that it depends on Jinja >= 2.  If you want to post a link to an spkg for jinja, that would be great.



---

archive/issue_comments_045647.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nHere you go: http://drop.io/jinja2_spkg",
    "created_at": "2009-09-06T03:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45647",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:44" align="right">comment:44</div>

Here you go: http://drop.io/jinja2_spkg



---

archive/issue_comments_045648.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nA few issues with the Jinja spkg: the source is under version control but it shouldn't be.  When I install it, I get jinja2-2.1.1, not jinja2-2.2, so the name is wrong.  Also, the part of the spkg-install file which is supposed to remove the old version wasn't removing the right thing (it said \"Jinja-2*\", but the directory is actually \"Jinja2-2.1.1*\").\n\nAnyway, here's a modified spkg, much smaller since src is not in the mercurial repository.  This is an updated version of the version 1 jinja spkg, with the new src dropped in, replacing the old src: [http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg).\n\nShould this have its own ticket?  Will it screw up anything from #6568?  I don't know anything about Jinja, so I don't know what to do to test it; all I see is that the docs are built correctly with the new versions of Sphinx and Jinja.",
    "created_at": "2009-09-06T04:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45648",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">comment:45</div>

A few issues with the Jinja spkg: the source is under version control but it shouldn't be.  When I install it, I get jinja2-2.1.1, not jinja2-2.2, so the name is wrong.  Also, the part of the spkg-install file which is supposed to remove the old version wasn't removing the right thing (it said "Jinja-2*", but the directory is actually "Jinja2-2.1.1*").

Anyway, here's a modified spkg, much smaller since src is not in the mercurial repository.  This is an updated version of the version 1 jinja spkg, with the new src dropped in, replacing the old src: [http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg).

Should this have its own ticket?  Will it screw up anything from #6568?  I don't know anything about Jinja, so I don't know what to do to test it; all I see is that the docs are built correctly with the new versions of Sphinx and Jinja.



---

archive/issue_comments_045649.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThanks for the fixes.\n\nJinja and Jinja2 are totally different, and so it shouldn't affect any current templating routines. In any case, once Sphinx 0.6.3 is included, we can remove the dependency on Jinja by replacing all instances of `import jinja` with `import jinja2`, etc. The API's are pretty much unchanged, and from what I know, none of the changed interfaces are currently used.",
    "created_at": "2009-09-06T04:41:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45649",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:46" align="right">comment:46</div>

Thanks for the fixes.

Jinja and Jinja2 are totally different, and so it shouldn't affect any current templating routines. In any case, once Sphinx 0.6.3 is included, we can remove the dependency on Jinja by replacing all instances of `import jinja` with `import jinja2`, etc. The API's are pretty much unchanged, and from what I know, none of the changed interfaces are currently used.



---

archive/issue_comments_045650.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI'm not at all sure what you people are doing here, so perhaps I should have kept away, but (in trying to help with #6820) I tried installing the new sphinx spkg using\n\n```\n./sage -f http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg\n```\nand now \n\n```\njohn@ubuntu%sage -docbuild reference html\nTraceback (most recent call last):\n  File \"/home/john/sage-4.1.1/devel/sage/doc/common/builder.py\", line 667, in <module>\n    getattr(get_builder(name), type)()\n  File \"/home/john/sage-4.1.1/devel/sage/doc/common/builder.py\", line 348, in _wrapper\n    for module_name in self.get_modified_modules():\n  File \"/home/john/sage-4.1.1/devel/sage/doc/common/builder.py\", line 412, in get_modified_modules\n    env = self.get_sphinx_environment()\n  File \"/home/john/sage-4.1.1/devel/sage/doc/common/builder.py\", line 403, in get_sphinx_environment\n    return BuildEnvironment.frompickle(config, env_pickle)\n  File \"/home/john/sage-4.1.1/local/lib/python2.6/site-packages/Sphinx-0.6.2-py2.6.egg/sphinx/environment.py\", line 210, in frompickle\n    env = pickle.load(picklefile)\nAttributeError: 'module' object has no attribute 'RedirStream'\n```\n\nThis is in the main branch, so a vanilla 4.1.1 build.  Should that be 4.1.2.alpha0?",
    "created_at": "2009-09-06T16:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45650",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:47" align="right">comment:47</div>

I'm not at all sure what you people are doing here, so perhaps I should have kept away, but (in trying to help with #6820) I tried installing the new sphinx spkg using

```
./sage -f http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg
```
and now 

```
john@ubuntu%sage -docbuild reference html
Traceback (most recent call last):
  File "/home/john/sage-4.1.1/devel/sage/doc/common/builder.py", line 667, in <module>
    getattr(get_builder(name), type)()
  File "/home/john/sage-4.1.1/devel/sage/doc/common/builder.py", line 348, in _wrapper
    for module_name in self.get_modified_modules():
  File "/home/john/sage-4.1.1/devel/sage/doc/common/builder.py", line 412, in get_modified_modules
    env = self.get_sphinx_environment()
  File "/home/john/sage-4.1.1/devel/sage/doc/common/builder.py", line 403, in get_sphinx_environment
    return BuildEnvironment.frompickle(config, env_pickle)
  File "/home/john/sage-4.1.1/local/lib/python2.6/site-packages/Sphinx-0.6.2-py2.6.egg/sphinx/environment.py", line 210, in frompickle
    env = pickle.load(picklefile)
AttributeError: 'module' object has no attribute 'RedirStream'
```

This is in the main branch, so a vanilla 4.1.1 build.  Should that be 4.1.2.alpha0?



---

archive/issue_comments_045651.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nHey.\n\nThe first spkg had problems. There are newer spkgs. http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg is the latest.",
    "created_at": "2009-09-06T17:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45651",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:48" align="right">comment:48</div>

Hey.

The first spkg had problems. There are newer spkgs. http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg is the latest.



---

archive/issue_comments_045652.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n As the summary says.  The spkg can be found at\n \n-http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg\n+http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg\n \n+After installing it and before building any docs, you will probably need to delete the directory SAGE_ROOT/devel/sage/doc/output -- this holds cached information which may not be compatible between different versions of Sphinx.\n+\n+Sphinx 0.6.3 also uses Jinja2.  Sage includes Jinja, not Jinja2.  As long as you're connected to a network, the installation of Sphinx 0.6.3 downloads Jinja2 and installs it -- it can coexist with Jinja, so it shouldn't mess anything up.  If you're not connected to a network, and for putting in the Sage tar ball, there is an spkg for Jinja2:\n+\n+http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg\n+\n+Finally, the patch below (\"inheritance_example.patch\") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.\n+\n``````\n",
    "created_at": "2009-09-06T17:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45652",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
 As the summary says.  The spkg can be found at
 
-http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.2.p0.spkg
+http://sage.math.washington.edu/home/palmieri/SPKG/sphinx-0.6.3.p1.spkg
 
+After installing it and before building any docs, you will probably need to delete the directory SAGE_ROOT/devel/sage/doc/output -- this holds cached information which may not be compatible between different versions of Sphinx.
+
+Sphinx 0.6.3 also uses Jinja2.  Sage includes Jinja, not Jinja2.  As long as you're connected to a network, the installation of Sphinx 0.6.3 downloads Jinja2 and installs it -- it can coexist with Jinja, so it shouldn't mess anything up.  If you're not connected to a network, and for putting in the Sage tar ball, there is an spkg for Jinja2:
+
+http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg
+
+Finally, the patch below ("inheritance_example.patch") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.
+
``````




---

archive/issue_comments_045653.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nTo cremona: sorry about that.  When you switch versions of Sphinx, you have to delete the old output in the docs directory -- it caches some information there, apparently in ways which are not compatible between versions.  So after you install the spkg, delete the directory SAGE_ROOT/devel/sage/doc/output and try again.  I should change the summary on this ticket to reflect this...\n\nTo timdumol: I see, jinja and jinja2 can coexist on the same system, so for now we can have both.  That's the best solution now, I agree.  (I tried replacing all of the \"import jinja\" lines with \"import jinja2\", but there was a problem with one of them: in sage.ext.gen_interpreters, the line `from jinja.datastructure import ComplainingUndefined` doesn't translate, because there is no jinja2.datastructure.)",
    "created_at": "2009-09-06T17:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45653",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:49" align="right">comment:49</div>

To cremona: sorry about that.  When you switch versions of Sphinx, you have to delete the old output in the docs directory -- it caches some information there, apparently in ways which are not compatible between versions.  So after you install the spkg, delete the directory SAGE_ROOT/devel/sage/doc/output and try again.  I should change the summary on this ticket to reflect this...

To timdumol: I see, jinja and jinja2 can coexist on the same system, so for now we can have both.  That's the best solution now, I agree.  (I tried replacing all of the "import jinja" lines with "import jinja2", but there was a problem with one of them: in sage.ext.gen_interpreters, the line `from jinja.datastructure import ComplainingUndefined` doesn't translate, because there is no jinja2.datastructure.)



---

archive/issue_comments_045654.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nThanks -- that worked!  (Except that I cannot read and deleted all SAGE_ROOT/devel/sage/doc and not just the output directory, so had to copy the rest from another clone...)\n\nI like the percentage meter and the fact that the output overwrites one line rather than running off the screen.  Minor point here:  it does not overwrite long lines when they are followed by short ones so you see strange garbage characters on the end of te line like this:\n\n```\nreading sources... [ 49%] sage/misc/explain_pickle      _densensephismsmpecies\n```\nOf course this is a triviality.\n\nOtherwise all went well and (from the point of view of an ordinary user/developer) I'm happy with this spkg.  (There are lots of warnings and at least one error in the docstrings, but that is another matter).  I have no objection to this getting a positive review, assuming tha the other issues discussed above have been dealt with.",
    "created_at": "2009-09-06T19:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45654",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:50" align="right">comment:50</div>

Thanks -- that worked!  (Except that I cannot read and deleted all SAGE_ROOT/devel/sage/doc and not just the output directory, so had to copy the rest from another clone...)

I like the percentage meter and the fact that the output overwrites one line rather than running off the screen.  Minor point here:  it does not overwrite long lines when they are followed by short ones so you see strange garbage characters on the end of te line like this:

```
reading sources... [ 49%] sage/misc/explain_pickle      _densensephismsmpecies
```
Of course this is a triviality.

Otherwise all went well and (from the point of view of an ordinary user/developer) I'm happy with this spkg.  (There are lots of warnings and at least one error in the docstrings, but that is another matter).  I have no objection to this getting a positive review, assuming tha the other issues discussed above have been dealt with.



---

archive/issue_comments_045655.json:
```json
{
    "body": "Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket6586/install.gz)**\n\nnew version the file spkg/install (incorporating jinja2)",
    "created_at": "2009-09-06T22:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45655",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket6586/install.gz)**

new version the file spkg/install (incorporating jinja2)



---

archive/issue_comments_045656.json:
```json
{
    "body": "new version of the file spkg/standard/deps (incorporating jinja2)",
    "created_at": "2009-09-06T22:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45656",
    "user": "https://github.com/jhpalmieri"
}
```

new version of the file spkg/standard/deps (incorporating jinja2)



---

archive/issue_comments_045657.json:
```json
{
    "body": "Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket6586/deps.gz)**\n\ndiff between old and new install",
    "created_at": "2009-09-06T22:01:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45657",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket6586/deps.gz)**

diff between old and new install



---

archive/issue_comments_045658.json:
```json
{
    "body": "Attachment: **[install.patch.gz](https://github.com/sagemath/sage/files/ticket6586/install.patch.gz)**\n\nAttachment: **[deps.patch.gz](https://github.com/sagemath/sage/files/ticket6586/deps.patch.gz)**\n\ndiff between old and new deps",
    "created_at": "2009-09-06T22:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45658",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[install.patch.gz](https://github.com/sagemath/sage/files/ticket6586/install.patch.gz)**

Attachment: **[deps.patch.gz](https://github.com/sagemath/sage/files/ticket6586/deps.patch.gz)**

diff between old and new deps



---

archive/issue_comments_045659.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,7 @@\n \n http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg\n \n+For producing a new Sage tarball, since we're adding a new spkg, I think we need to modify the files `spkg/install` and `spkg/standard/deps`; I've attached new versions of these.\n+\n Finally, the patch below (\"inheritance_example.patch\") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.\n \n``````\n",
    "created_at": "2009-09-06T22:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45659",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,7 @@
 
 http://sage.math.washington.edu/home/palmieri/SPKG/jinja2-2.1.1.p0.spkg
 
+For producing a new Sage tarball, since we're adding a new spkg, I think we need to modify the files `spkg/install` and `spkg/standard/deps`; I've attached new versions of these.
+
 Finally, the patch below ("inheritance_example.patch") is not required.  It provides an illustration of a new capability of Sphinx 0.6.3 (and I think it's quite nice), but it's not something that needs to be installed or reviewed for this ticket.
 
``````




---

archive/issue_comments_045660.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nBoth the latest Sphinx and Jinja2 packages appear to install without network activity.  The changes to `install` and `deps` look good to me, but I haven't done a complete installation from scratch.\n\nTo the extent that it counts, my review is positive.",
    "created_at": "2009-09-11T00:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45660",
    "user": "https://github.com/qed777"
}
```

<div id="comment:52" align="right">comment:52</div>

Both the latest Sphinx and Jinja2 packages appear to install without network activity.  The changes to `install` and `deps` look good to me, but I haven't done a complete installation from scratch.

To the extent that it counts, my review is positive.



---

archive/issue_events_079135.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-09-22T16:37:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "title_is": "[partially positive review] update Sphinx to version 0.6.2 or 0.6.3",
    "title_was": "update Sphinx to version 0.6.2 or 0.6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79135"
}
```



---

archive/issue_comments_045661.json:
```json
{
    "body": "Changed reviewer from **Mitesh Patel** to **Mitesh Patel, Tim Dumol**",
    "created_at": "2009-09-22T16:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45661",
    "user": "https://github.com/TimDumol"
}
```

Changed reviewer from **Mitesh Patel** to **Mitesh Patel, Tim Dumol**



---

archive/issue_comments_045662.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nDocumentation builds perfectly. Sphinx 0.6.3 takes only 2 minutes more `sys` time than 0.5.1 to build all the docs, for me.\n\nHaven't done a complete install yet, but I'll do so once I finish downloading the 4.1.2.alpha2 tarball.",
    "created_at": "2009-09-22T16:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45662",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:53" align="right">comment:53</div>

Documentation builds perfectly. Sphinx 0.6.3 takes only 2 minutes more `sys` time than 0.5.1 to build all the docs, for me.

Haven't done a complete install yet, but I'll do so once I finish downloading the 4.1.2.alpha2 tarball.



---

archive/issue_events_079136.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-09-25T12:39:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "title_is": "update Sphinx to version 0.6.2 or 0.6.3",
    "title_was": "[partially positive review] update Sphinx to version 0.6.2 or 0.6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79136"
}
```



---

archive/issue_events_079137.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-09-25T12:39:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79137"
}
```



---

archive/issue_events_079138.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-09-25T12:39:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79138"
}
```



---

archive/issue_comments_045663.json:
```json
{
    "body": "Changed reviewer from **Mitesh Patel, Tim Dumol** to **John Cremona, Tim Dumol, Mitesh Patel**",
    "created_at": "2009-09-25T12:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45663",
    "user": "https://github.com/qed777"
}
```

Changed reviewer from **Mitesh Patel, Tim Dumol** to **John Cremona, Tim Dumol, Mitesh Patel**



---

archive/issue_comments_045664.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI updated `spkg/install` and `spkg/standard/deps`, replaced the old Sphinx spkg with the new one in `spkg/standard`, and copied the Jinja2 package to `spkg/standard`.  With these changes, `sage -bdist 100` generates the expected binary distributions on sage.math from both binary and compiled source distributions.  Moreover, `sage -sdist 200` makes a source distribution that compiles as expected.\n\nThere's a failed test:\n\n```python\nmpatel@sage sage-200$ ./sage -t devel/sage/sage/misc/trace.py \nsage -t  \"devel/sage/sage/misc/trace.py\"                    \n**********************************************************************\nFile \"/scratch/mpatel/source/sage-200/devel/sage/sage/misc/trace.py\", line 61:\n    sage: print s.before[s.before.find('-'):]\nExpected:\n    ---...\n    ipdb> c\n    2 * 5\nGot:\n    --Call--\n    > /scratch/mpatel/source/sage-200/local/lib/python2.6/site-packages/sage/rings/arith.py(1944)factor()\n       1943 \n    -> 1944 def factor(n, proof=None, int_=False, algorithm='pari', verbose=0, **kwds):\n       1945     \"\"\"\n    \n    ipdb> c\n    2 * 5\n    <BLANKLINE>\n**********************************************************************\n1 items had failures:\n   1 of  10 in __main__.example_1\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/mpatel/source/sage-200/tmp/.doctest_trace.py\n         [3.7 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t  \"devel/sage/sage/misc/trace.py\"\nTotal time for all tests: 3.7 seconds\n```\nI *think* it's not related to this ticket.",
    "created_at": "2009-09-25T12:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45664",
    "user": "https://github.com/qed777"
}
```

<div id="comment:54" align="right">comment:54</div>

I updated `spkg/install` and `spkg/standard/deps`, replaced the old Sphinx spkg with the new one in `spkg/standard`, and copied the Jinja2 package to `spkg/standard`.  With these changes, `sage -bdist 100` generates the expected binary distributions on sage.math from both binary and compiled source distributions.  Moreover, `sage -sdist 200` makes a source distribution that compiles as expected.

There's a failed test:

```python
mpatel@sage sage-200$ ./sage -t devel/sage/sage/misc/trace.py 
sage -t  "devel/sage/sage/misc/trace.py"                    
**********************************************************************
File "/scratch/mpatel/source/sage-200/devel/sage/sage/misc/trace.py", line 61:
    sage: print s.before[s.before.find('-'):]
Expected:
    ---...
    ipdb> c
    2 * 5
Got:
    --Call--
    > /scratch/mpatel/source/sage-200/local/lib/python2.6/site-packages/sage/rings/arith.py(1944)factor()
       1943 
    -> 1944 def factor(n, proof=None, int_=False, algorithm='pari', verbose=0, **kwds):
       1945     """
    
    ipdb> c
    2 * 5
    <BLANKLINE>
**********************************************************************
1 items had failures:
   1 of  10 in __main__.example_1
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/mpatel/source/sage-200/tmp/.doctest_trace.py
         [3.7 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


        sage -t  "devel/sage/sage/misc/trace.py"
Total time for all tests: 3.7 seconds
```
I *think* it's not related to this ticket.



---

archive/issue_comments_045665.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nProblem: Somehow, Sphinx 0.6.3 breaks the sidebar toggle (cf. #6507) in the *live* docs.  In Firebug's console:\n\n```js\nunexpected end of XML source\n<span class=\"math\">('#searchbox').show(0);\n```",
    "created_at": "2009-10-04T14:56:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45665",
    "user": "https://github.com/qed777"
}
```

<div id="comment:55" align="right">comment:55</div>

Problem: Somehow, Sphinx 0.6.3 breaks the sidebar toggle (cf. #6507) in the *live* docs.  In Firebug's console:

```js
unexpected end of XML source
<span class="math">('#searchbox').show(0);
```



---

archive/issue_comments_045666.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nPatching Sphinx 0.6.3 should fix this and perhaps also a similar problem reported on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/bb2d0d7f43efefc9/796d42841bd79c5c?#796d42841bd79c5c): \n\n```diff\n--- sphinx/themes/basic/layout.html.orig        2009-10-04 17:07:16.000000000 -0700\n+++ sphinx/themes/basic/layout.html     2009-10-04 17:07:28.000000000 -0700\n@@ -81,7 +81,7 @@\n               {{ _('Enter search terms or a module, class or function name.') }}\n               </p>\n           </div>\n-          <script type=\"text/javascript\">$('#searchbox').show(0);</script>\n+          <script type=\"text/javascript\">jQuery('#searchbox').show(0);</script>\n           {%- endif %}\n           {%- endblock %}\n         </div>\n```",
    "created_at": "2009-10-05T00:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45666",
    "user": "https://github.com/qed777"
}
```

<div id="comment:56" align="right">comment:56</div>

Patching Sphinx 0.6.3 should fix this and perhaps also a similar problem reported on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/bb2d0d7f43efefc9/796d42841bd79c5c?#796d42841bd79c5c): 

```diff
--- sphinx/themes/basic/layout.html.orig        2009-10-04 17:07:16.000000000 -0700
+++ sphinx/themes/basic/layout.html     2009-10-04 17:07:28.000000000 -0700
@@ -81,7 +81,7 @@
               {{ _('Enter search terms or a module, class or function name.') }}
               </p>
           </div>
-          <script type="text/javascript">$('#searchbox').show(0);</script>
+          <script type="text/javascript">jQuery('#searchbox').show(0);</script>
           {%- endif %}
           {%- endblock %}
         </div>
```



---

archive/issue_comments_045667.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nOr perhaps not.",
    "created_at": "2009-10-05T00:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45667",
    "user": "https://github.com/qed777"
}
```

<div id="comment:57" align="right">comment:57</div>

Or perhaps not.



---

archive/issue_comments_045668.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nmpatel: The problem with the sidebar is caused by compression. Line comments (\"//\") are used in the sidebar code, therefore when the code is compressed, the entire function is commented out. Changing the line comments to block comments (\"/* */\") fixed the problem for me.",
    "created_at": "2009-10-05T18:53:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45668",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:58" align="right">comment:58</div>

mpatel: The problem with the sidebar is caused by compression. Line comments ("//") are used in the sidebar code, therefore when the code is compressed, the entire function is commented out. Changing the line comments to block comments ("/* */") fixed the problem for me.



---

archive/issue_comments_045669.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nA patch for the doc sidebar problem is now up at #7126.",
    "created_at": "2009-10-05T19:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45669",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:59" align="right">comment:59</div>

A patch for the doc sidebar problem is now up at #7126.



---

archive/issue_comments_045670.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nIf [this comment](https://github.com/sagemath/sage/issues/7126#comment:2) at #7126 is correct, we should still patch `sphinx/themes/basic/layout.html`.  I can do this.",
    "created_at": "2009-10-06T00:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45670",
    "user": "https://github.com/qed777"
}
```

<div id="comment:60" align="right">comment:60</div>

If [this comment](https://github.com/sagemath/sage/issues/7126#comment:2) at #7126 is correct, we should still patch `sphinx/themes/basic/layout.html`.  I can do this.



---

archive/issue_comments_045671.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@qed777](#comment%3A55):\n> Problem: Somehow, Sphinx 0.6.3 breaks the sidebar toggle (cf. #6507) in the *live* docs.  In Firebug's console:\n> \n> ```js\n> unexpected end of XML source\n> <span class=\"math\">('#searchbox').show(0);\n> ```\n\n#7141 adds a patch that fixes this.",
    "created_at": "2009-10-06T15:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45671",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@qed777](#comment%3A55):
> Problem: Somehow, Sphinx 0.6.3 breaks the sidebar toggle (cf. #6507) in the *live* docs.  In Firebug's console:
> 
> ```js
> unexpected end of XML source
> <span class="math">('#searchbox').show(0);
> ```

#7141 adds a patch that fixes this.



---

archive/issue_events_079139.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-16T04:45:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79139"
}
```



---

archive/issue_events_079140.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-16T04:45:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6586#event-79140"
}
```



---

archive/issue_comments_045672.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nMerged both the jinja2 and sphinx in spkg.",
    "created_at": "2009-10-16T04:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45672",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:62" align="right">comment:62</div>

Merged both the jinja2 and sphinx in spkg.



---

archive/issue_comments_045673.json:
```json
{
    "body": "Merged: **sage-4.2.alpha0**",
    "created_at": "2009-10-16T04:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6586#issuecomment-45673",
    "user": "https://github.com/mwhansen"
}
```

Merged: **sage-4.2.alpha0**
