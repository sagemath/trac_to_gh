# Issue 6421: [with patch, positive review] make a symbolic arctan2 function

archive/issues_006421.json:
```json
{
    "body": "From sage-devel:\n\n```\n> On Thu, Jun 25, 2009 at 11:31 PM, Nick\n> Alexander<ncalexander@gmail.com> wrote:\n> >\n> > Can someone verify that this is a bug? \u00a0Any hope a fix? \u00a0(This is\n> > with sage-4.0.2 on sage.math.)\n> >\n> > {{{\n> > sage: complex_plot((x^2 + I).sqrt().real_part(), (-2, 2), (-2, 2))\n> > ---------------------------------------------------------------------------\n> ...\n> > RuntimeError: cannot find SFunction in table\n> > }}}\n> \n> It seems, its not just complex_plot issue. It is happening for other\n> plots. For example,  the following works fine in 3.4 but fails with\n> the same error in 4.0.2\n> -----\n> sage: x,y=var('x,y'); plot3d( log(x+I*y).imag(), (x,-2,2), (y,-2,2))\n> ...\n> RuntimeError: cannot find SFunction in table\n> -----\n\nsage: %debug\n> /home/burcin/sage/sage-4.0.2.rc0/expression.pyx(3115)sage.symbolic.expression.Expression.operator\n> (sage/symbolic/expression.cpp:15268)()\n\nipdb> u\n> /home/burcin/sage/sage-4.0.2.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression_conversions.py(206)__call__()\n    205 \n--> 206         operator = ex.operator()\n    207         if operator is None:\n\nipdb> print ex\narctan2(real_part(y) + imag_part(x), real_part(x) - imag_part(y))\n\n\nBoth of these fail because Sage doesn't define a symbolic arctan2\nfunction. There is instead a simple wrapper around arctan in\nsage/functions/trig.py:\n\nsage: arctan2(x,y)\narctan(x/y)\n\n```\n\nIt's possible that this worked on 4.0, and I broke it with #6244.\n\n\n\n\nAssignee: @kcrisman\n\nResolution: fixed\n\nAuthor: Karl-Dieter Crisman\n\nReviewer: Burcin Erocal\n\nMerged: sage-4.1.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6421\n\n",
    "closed_at": "2009-07-04T01:07:11Z",
    "created_at": "2009-06-26T12:22:36Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1",
    "title": "[with patch, positive review] make a symbolic arctan2 function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6421",
    "user": "https://github.com/burcin"
}
```
From sage-devel:

```
> On Thu, Jun 25, 2009 at 11:31 PM, Nick
> Alexander<ncalexander@gmail.com> wrote:
> >
> > Can someone verify that this is a bug?  Any hope a fix?  (This is
> > with sage-4.0.2 on sage.math.)
> >
> > {{{
> > sage: complex_plot((x^2 + I).sqrt().real_part(), (-2, 2), (-2, 2))
> > ---------------------------------------------------------------------------
> ...
> > RuntimeError: cannot find SFunction in table
> > }}}
> 
> It seems, its not just complex_plot issue. It is happening for other
> plots. For example,  the following works fine in 3.4 but fails with
> the same error in 4.0.2
> -----
> sage: x,y=var('x,y'); plot3d( log(x+I*y).imag(), (x,-2,2), (y,-2,2))
> ...
> RuntimeError: cannot find SFunction in table
> -----

sage: %debug
> /home/burcin/sage/sage-4.0.2.rc0/expression.pyx(3115)sage.symbolic.expression.Expression.operator
> (sage/symbolic/expression.cpp:15268)()

ipdb> u
> /home/burcin/sage/sage-4.0.2.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression_conversions.py(206)__call__()
    205 
--> 206         operator = ex.operator()
    207         if operator is None:

ipdb> print ex
arctan2(real_part(y) + imag_part(x), real_part(x) - imag_part(y))


Both of these fail because Sage doesn't define a symbolic arctan2
function. There is instead a simple wrapper around arctan in
sage/functions/trig.py:

sage: arctan2(x,y)
arctan(x/y)

```

It's possible that this worked on 4.0, and I broke it with #6244.




Assignee: @kcrisman

Resolution: fixed

Author: Karl-Dieter Crisman

Reviewer: Burcin Erocal

Merged: sage-4.1.rc0

Issue created by migration from https://trac.sagemath.org/ticket/6421





---

archive/issue_comments_057818.json:
```json
{
    "body": "Attachment [trac_6421-arctan2.patch](tarball://root/attachments/some-uuid/ticket6421/trac_6421-arctan2.patch) by @kcrisman created at 2009-06-26 17:16:45",
    "created_at": "2009-06-26T17:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57818",
    "user": "https://github.com/kcrisman"
}
```

Attachment [trac_6421-arctan2.patch](tarball://root/attachments/some-uuid/ticket6421/trac_6421-arctan2.patch) by @kcrisman created at 2009-06-26 17:16:45



---

archive/issue_comments_057819.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2009-06-26T17:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57819",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to assigned.



---

archive/issue_comments_057820.json:
```json
{
    "body": "Set assignee to @kcrisman.",
    "created_at": "2009-06-26T17:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57820",
    "user": "https://github.com/kcrisman"
}
```

Set assignee to @kcrisman.



---

archive/issue_comments_057821.json:
```json
{
    "body": "<a id='comment:1'></a>Okay, this seems to fix everything and passes tests on trig.py and symbolic/expression.py and /function.py.    I made the function consistent with Maxima, Pynac, and Python math.  Only issue, which I would really appreciate some insight on but should not prevent it from going in, is the following:\n\n```\nsage: latex(arctan2)\n\\arctan\nsage: var('y')\ny\nsage: latex(arctan2(y,x))\n\\mbox{atan2}\\left(y,x\\right)\n```\nOf course, this doesn't fix the question about plotting, but now the failure on that will be clearer.",
    "created_at": "2009-06-26T17:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57821",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>Okay, this seems to fix everything and passes tests on trig.py and symbolic/expression.py and /function.py.    I made the function consistent with Maxima, Pynac, and Python math.  Only issue, which I would really appreciate some insight on but should not prevent it from going in, is the following:

```
sage: latex(arctan2)
\arctan
sage: var('y')
y
sage: latex(arctan2(y,x))
\mbox{atan2}\left(y,x\right)
```
Of course, this doesn't fix the question about plotting, but now the failure on that will be clearer.



---

archive/issue_comments_057822.json:
```json
{
    "body": "Attachment [trac_6421-arctan2_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket6421/trac_6421-arctan2_doctest_fixes.patch) by @burcin created at 2009-06-27 16:03:26\n\nminor doctest fixes in `sage.symbolic.random_tests`",
    "created_at": "2009-06-27T16:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57822",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_6421-arctan2_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket6421/trac_6421-arctan2_doctest_fixes.patch) by @burcin created at 2009-06-27 16:03:26

minor doctest fixes in `sage.symbolic.random_tests`



---

archive/issue_comments_057823.json:
```json
{
    "body": "Changing author from \"\" to \"Karl-Dieter Crisman\"",
    "created_at": "2009-06-27T16:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57823",
    "user": "https://github.com/burcin"
}
```

Changing author from "" to "Karl-Dieter Crisman"



---

archive/issue_comments_057824.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Burcin Erocal\"",
    "created_at": "2009-06-27T16:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57824",
    "user": "https://github.com/burcin"
}
```

Changing reviewer from "" to "Burcin Erocal"



---

archive/issue_comments_057825.json:
```json
{
    "body": "<a id='comment:2'></a>Looks good, thanks for this.\n\nI added a small patch with doctest fixes in `sage/symbolic/random_tests.py`.",
    "created_at": "2009-06-27T16:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57825",
    "user": "https://github.com/burcin"
}
```

<a id='comment:2'></a>Looks good, thanks for this.

I added a small patch with doctest fixes in `sage/symbolic/random_tests.py`.



---

archive/issue_comments_057826.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.1.rc0\"",
    "created_at": "2009-07-04T01:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57826",
    "user": "https://github.com/rlmill"
}
```

Changing merged from "" to "sage-4.1.rc0"



---

archive/issue_comments_057827.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-07-04T01:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57827",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_events_015137.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T01:07:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6421#event-15137"
}
```



---

archive/issue_comments_057828.json:
```json
{
    "body": "<a id='comment:4'></a>[mickey mouse pictures](http://like-search.info/)",
    "created_at": "2010-05-26T08:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57828",
    "user": "https://trac.sagemath.org/admin/accounts/users/bascorp2"
}
```

<a id='comment:4'></a>[mickey mouse pictures](http://like-search.info/)



---

archive/issue_comments_057829.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2010-05-26T08:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6421#issuecomment-57829",
    "user": "https://trac.sagemath.org/admin/accounts/users/bascorp2"
}
```

Changing upstream from "" to "N/A"
