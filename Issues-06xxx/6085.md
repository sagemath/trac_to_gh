# Issue 6085: Finish full implementation of c_graphs

archive/issues_006085.json:
```json
{
    "assignees": [
        "https://github.com/rlmill"
    ],
    "body": "The goal is for c_graphs to be able to take over as the default implementation of graphs in Sage. With the first patch, all that remains to be done is:\n\n1. We need support for arbitrary hashable vertices.\n\n2. We need support for arbitrary edge labels.\n\n3. We need pickling.\n\nCC:  @sagetrac-rdingman @sagetrac-mvngu @saliola @boothby\n\nComponent: **graph theory**\n\nAuthor: **Robert Miller**\n\nReviewer: **Tom Boothby**\n\nMerged: **sage-4.1.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6085_\n\n",
    "closed_at": "2009-06-25T17:52:35Z",
    "created_at": "2009-05-19T17:06:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Finish full implementation of c_graphs",
    "type": "issue",
    "updated_at": "2009-06-25T17:52:35Z",
    "url": "https://github.com/sagemath/sage/issues/6085",
    "user": "https://github.com/rlmill"
}
```
The goal is for c_graphs to be able to take over as the default implementation of graphs in Sage. With the first patch, all that remains to be done is:

1. We need support for arbitrary hashable vertices.

2. We need support for arbitrary edge labels.

3. We need pickling.

CC:  @sagetrac-rdingman @sagetrac-mvngu @saliola @boothby

Component: **graph theory**

Author: **Robert Miller**

Reviewer: **Tom Boothby**

Merged: **sage-4.1.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/6085_





---

archive/issue_events_073251.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-05-19T17:06:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "milestone_number": null,
    "milestone_title": "sage-4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73251"
}
```



---

archive/issue_events_073252.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-05-19T17:06:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "eeeeee",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73252"
}
```



---

archive/issue_events_073253.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-05-19T17:06:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73253"
}
```



---

archive/issue_events_073254.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-05-19T17:06:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73254"
}
```



---

archive/issue_events_073255.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-05-19T17:06:07Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "subject": "https://github.com/rlmill",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73255"
}
```



---

archive/issue_comments_039909.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSome notes for posterity:\n\n```\n1. hashable vertices\n - have a list to go from an int to a label\n - a dict will go the other way\n - a stack will keep track of \"unused\" vertices leftover from deletion\n - these will be listed as \"None\" in the list\n\n2. arbitrary edge labels\n - this will simply be a dict, going from ints to objects\n - since edge labels need not be hashable, we will need to do a search\n   when trying to find the int for a label, but if we fail to find one,\n   we will have a new int label for this new edge label\n\n3. pickling\n - this will be little more than a sparse6 string\n```",
    "created_at": "2009-05-19T18:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39909",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:1" align="right">comment:1</div>

Some notes for posterity:

```
1. hashable vertices
 - have a list to go from an int to a label
 - a dict will go the other way
 - a stack will keep track of "unused" vertices leftover from deletion
 - these will be listed as "None" in the list

2. arbitrary edge labels
 - this will simply be a dict, going from ints to objects
 - since edge labels need not be hashable, we will need to do a search
   when trying to find the int for a label, but if we fail to find one,
   we will have a new int label for this new edge label

3. pickling
 - this will be little more than a sparse6 string
```



---

archive/issue_comments_039910.json:
```json
{
    "body": "Attachment: **[trac_6085-part-1.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-1.patch.gz)**",
    "created_at": "2009-05-21T14:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39910",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-part-1.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-1.patch.gz)**



---

archive/issue_comments_039911.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[trac_6085-part-2.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-2.patch.gz)**\n\nAdd myself so I receive updates on this ticket :-)",
    "created_at": "2009-05-21T23:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39911",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[trac_6085-part-2.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-2.patch.gz)**

Add myself so I receive updates on this ticket :-)



---

archive/issue_comments_039912.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_6085-part-3.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-3.patch.gz)**\n\nThese patches applied cleanly against 4.0.1.a0 on an amd64 ubuntu 9.04 machine. After running \"sage -b\" and then \"sage -testall\", there were the following failures:\n\n```\nThe following tests failed:                                                                                         \n\n\n        sage -t  \"devel/sage/doc/en/constructions/graph_theory.rst\"\n        sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n        sage -t  \"devel/sage/sage/graphs/print_graphs.py\"                       \n        sage -t  \"devel/sage/sage/graphs/graph_database.py\"                     \n        sage -t  \"devel/sage/sage/graphs/graph_list.py\"                         \n        sage -t  \"devel/sage/sage/graphs/linearextensions.py\"                   \n        sage -t  \"devel/sage/sage/graphs/planarity.pyx\"                         \n        sage -t  \"devel/sage/sage/graphs/bipartite_graph.py\"                    \n        sage -t  \"devel/sage/sage/graphs/schnyder.py\"                           \n        sage -t  \"devel/sage/sage/graphs/graph_bundle.py\"                       \n        sage -t  \"devel/sage/sage/graphs/graph_plot.py\"                         \n        sage -t  \"devel/sage/sage/graphs/graph_generators.py\"                   \n        sage -t  \"devel/sage/sage/graphs/graph_coloring.py\"                     \n        sage -t  \"devel/sage/sage/graphs/graph_fast.pyx\"                        \n        sage -t  \"devel/sage/sage/graphs/graph.py\"                              \n        sage -t  \"devel/sage/sage/graphs/chrompoly.pyx\"                         \n        sage -t  \"devel/sage/sage/graphs/base/c_graph.pyx\"                      \n        sage -t  \"devel/sage/sage/graphs/base/sparse_graph.pyx\"                 \n        sage -t  \"devel/sage/sage/graphs/graph_isom.pyx\"                        \n        sage -t  \"devel/sage/sage/crypto/mq/mpolynomialsystem.py\"               \n        sage -t  \"devel/sage/sage/matrix/constructor.py\"                        \n        sage -t  \"devel/sage/sage/geometry/polyhedra.py\"                        \n        sage -t  \"devel/sage/sage/geometry/lattice_polytope.py\"                 \n        sage -t  \"devel/sage/sage/groups/perm_gps/partn_ref/refinement_graphs.pyx\"\n        sage -t  \"devel/sage/sage/plot/plot.py\"                                   \n        sage -t  \"devel/sage/sage/homology/simplicial_complex.py\"                 \n        sage -t  \"devel/sage/sage/combinat/posets/poset_examples.py\"              \n        sage -t  \"devel/sage/sage/combinat/posets/posets.py\"                      \n        sage -t  \"devel/sage/sage/combinat/posets/elements.py\"                    \n        sage -t  \"devel/sage/sage/combinat/posets/lattices.py\"                    \n        sage -t  \"devel/sage/sage/combinat/posets/hasse_diagram.py\"               \n        sage -t  \"devel/sage/sage/combinat/partition_algebra.py\"                  \n        sage -t  \"devel/sage/sage/combinat/skew_partition.py\"                     \n        sage -t  \"devel/sage/sage/combinat/ribbon.py\"                             \n        sage -t  \"devel/sage/sage/combinat/skew_tableau.py\"                       \n        sage -t  \"devel/sage/sage/combinat/words/suffix_trees.py\"                 \n        sage -t  \"devel/sage/sage/combinat/root_system/type_G.py\"                 \n        sage -t  \"devel/sage/sage/combinat/root_system/type_E.py\"                 \n        sage -t  \"devel/sage/sage/combinat/root_system/root_system.py\"            \n        sage -t  \"devel/sage/sage/combinat/root_system/type_D.py\"                 \n        sage -t  \"devel/sage/sage/combinat/root_system/root_lattice_realization.py\"\n        sage -t  \"devel/sage/sage/combinat/root_system/type_B.py\"                  \n        sage -t  \"devel/sage/sage/combinat/root_system/type_F.py\"                  \n        sage -t  \"devel/sage/sage/combinat/root_system/type_C.py\"                  \n        sage -t  \"devel/sage/sage/combinat/root_system/type_A.py\"                  \n        sage -t  \"devel/sage/sage/combinat/root_system/cartan_type.py\"             \n        sage -t  \"devel/sage/sage/combinat/root_system/weight_space.py\"            \n        sage -t  \"devel/sage/sage/combinat/root_system/coxeter_matrix.py\"          \n        sage -t  \"devel/sage/sage/combinat/root_system/weight_lattice_realization.py\"\n        sage -t  \"devel/sage/sage/combinat/root_system/type_dual.py\"                 \n        sage -t  \"devel/sage/sage/combinat/root_system/weyl_group.py\"                \"devel/sage/sage/misc/html.py\" \n        sage -t  \"devel/sage/sage/combinat/root_system/type_reducible.py\"            \n        sage -t  \"devel/sage/sage/combinat/root_system/dynkin_diagram.py\"            \n        sage -t  \"devel/sage/sage/combinat/root_system/root_space.py\"                \n        sage -t  \"devel/sage/sage/combinat/root_system/cartan_matrix.py\"             \n        sage -t  \"devel/sage/sage/combinat/permutation.py\"                           \n        sage -t  \"devel/sage/sage/combinat/species/species.py\"                       \n        sage -t  \"devel/sage/sage/combinat/species/recursive_species.py\"             \n        sage -t  \"devel/sage/sage/combinat/species/sum_species.py\"                   \n        sage -t  \"devel/sage/sage/combinat/species/product_species.py\"               \n        sage -t  \"devel/sage/sage/combinat/crystals/fast_crystals.py\"                \n        sage -t  \"devel/sage/sage/combinat/crystals/tensor_product.py\"               \n        sage -t  \"devel/sage/sage/combinat/crystals/spins.py\"                        \n        sage -t  \"devel/sage/sage/combinat/crystals/letters.py\"                      \n        sage -t  \"devel/sage/sage/combinat/crystals/crystals.py\"                     \n        sage -t  \"devel/sage/sage/combinat/graph_path.py\"                            \n        sage -t  \"devel/sage/sage/databases/database.py\"                             \n        sage -t  \"devel/sage/sage/misc/html.py\"                                      \n        sage -t  \"devel/sage/sage/misc/functional.py\"                                \n        sage -t  \"devel/sage/sage/misc/classgraph.py\"     \n```\n(I suspect that \"devel/sage/sage/misc/html.py\" failing was already reported as a separate issue. The others seem new.) In particular, there was the following:\n\n```\nwdj@hera:~/sagefiles/sage-4.0.1.alpha0$ ./sage -t  \"devel/sage/doc/en/constructions/graph_theory.rst\"\nsage -t  \"devel/sage/doc/en/constructions/graph_theory.rst\"                                          \n**********************************************************************                               \nFile \"/home/wdj/sagefiles/sage-4.0.1.alpha0/devel/sage/doc/en/constructions/graph_theory.rst\", line 31:\n    sage: D = DiGraph( { 0: [1], 1: [2], 2: [0]} )                                                     \nException raised:                                                                                      \n    Traceback (most recent call last):                                                                 \n      File \"/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test \n        self.run_one_example(test, example, filename, compileflags)                                    \n      File \"/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)                  \n      File \"/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs                                                                   \n      File \"<doctest __main__.example_1[2]>\", line 1, in <module>                                        \n        D = DiGraph( { Integer(0): [Integer(1)], Integer(1): [Integer(2)], Integer(2): [Integer(0)]} )###line 31:\n    sage: D = DiGraph( { 0: [1], 1: [2], 2: [0]} )                                                               \n      File \"/home/wdj/sagefiles/sage-4.0.1.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 10117, in __init__\n        self.add_vertices(verts)\n      File \"/home/wdj/sagefiles/sage-4.0.1.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 2923, in add_vertices\n        self._backend.add_vertices(vertices)\n      File \"sparse_graph.pyx\", line 1627, in sage.graphs.base.sparse_graph.SparseGraphBackend.add_vertices (sage/graphs/base/sparse_graph.c:15334)\n      File \"sparse_graph.pyx\", line 404, in sage.graphs.base.sparse_graph.SparseGraph.add_vertices (sage/graphs/base/sparse_graph.c:5294)\n      File \"sparse_graph.pyx\", line 424, in sage.graphs.base.sparse_graph.SparseGraph.add_vertices (sage/graphs/base/sparse_graph.c:5217)\n    TypeError: 'int' object is not iterable\n**********************************************************************\n1 items had failures:\n   1 of   3 in __main__.example_1\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/wdj/sagefiles/sage-4.0.1.alpha0/tmp/.doctest_graph_theory.py\n         [3.3 s]\nexit code: 1024\n\n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t  \"devel/sage/doc/en/constructions/graph_theory.rst\"\n\n```\n\nHope this helps.",
    "created_at": "2009-06-03T14:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39912",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_6085-part-3.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-3.patch.gz)**

These patches applied cleanly against 4.0.1.a0 on an amd64 ubuntu 9.04 machine. After running "sage -b" and then "sage -testall", there were the following failures:

```
The following tests failed:                                                                                         


        sage -t  "devel/sage/doc/en/constructions/graph_theory.rst"
        sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
        sage -t  "devel/sage/sage/graphs/print_graphs.py"                       
        sage -t  "devel/sage/sage/graphs/graph_database.py"                     
        sage -t  "devel/sage/sage/graphs/graph_list.py"                         
        sage -t  "devel/sage/sage/graphs/linearextensions.py"                   
        sage -t  "devel/sage/sage/graphs/planarity.pyx"                         
        sage -t  "devel/sage/sage/graphs/bipartite_graph.py"                    
        sage -t  "devel/sage/sage/graphs/schnyder.py"                           
        sage -t  "devel/sage/sage/graphs/graph_bundle.py"                       
        sage -t  "devel/sage/sage/graphs/graph_plot.py"                         
        sage -t  "devel/sage/sage/graphs/graph_generators.py"                   
        sage -t  "devel/sage/sage/graphs/graph_coloring.py"                     
        sage -t  "devel/sage/sage/graphs/graph_fast.pyx"                        
        sage -t  "devel/sage/sage/graphs/graph.py"                              
        sage -t  "devel/sage/sage/graphs/chrompoly.pyx"                         
        sage -t  "devel/sage/sage/graphs/base/c_graph.pyx"                      
        sage -t  "devel/sage/sage/graphs/base/sparse_graph.pyx"                 
        sage -t  "devel/sage/sage/graphs/graph_isom.pyx"                        
        sage -t  "devel/sage/sage/crypto/mq/mpolynomialsystem.py"               
        sage -t  "devel/sage/sage/matrix/constructor.py"                        
        sage -t  "devel/sage/sage/geometry/polyhedra.py"                        
        sage -t  "devel/sage/sage/geometry/lattice_polytope.py"                 
        sage -t  "devel/sage/sage/groups/perm_gps/partn_ref/refinement_graphs.pyx"
        sage -t  "devel/sage/sage/plot/plot.py"                                   
        sage -t  "devel/sage/sage/homology/simplicial_complex.py"                 
        sage -t  "devel/sage/sage/combinat/posets/poset_examples.py"              
        sage -t  "devel/sage/sage/combinat/posets/posets.py"                      
        sage -t  "devel/sage/sage/combinat/posets/elements.py"                    
        sage -t  "devel/sage/sage/combinat/posets/lattices.py"                    
        sage -t  "devel/sage/sage/combinat/posets/hasse_diagram.py"               
        sage -t  "devel/sage/sage/combinat/partition_algebra.py"                  
        sage -t  "devel/sage/sage/combinat/skew_partition.py"                     
        sage -t  "devel/sage/sage/combinat/ribbon.py"                             
        sage -t  "devel/sage/sage/combinat/skew_tableau.py"                       
        sage -t  "devel/sage/sage/combinat/words/suffix_trees.py"                 
        sage -t  "devel/sage/sage/combinat/root_system/type_G.py"                 
        sage -t  "devel/sage/sage/combinat/root_system/type_E.py"                 
        sage -t  "devel/sage/sage/combinat/root_system/root_system.py"            
        sage -t  "devel/sage/sage/combinat/root_system/type_D.py"                 
        sage -t  "devel/sage/sage/combinat/root_system/root_lattice_realization.py"
        sage -t  "devel/sage/sage/combinat/root_system/type_B.py"                  
        sage -t  "devel/sage/sage/combinat/root_system/type_F.py"                  
        sage -t  "devel/sage/sage/combinat/root_system/type_C.py"                  
        sage -t  "devel/sage/sage/combinat/root_system/type_A.py"                  
        sage -t  "devel/sage/sage/combinat/root_system/cartan_type.py"             
        sage -t  "devel/sage/sage/combinat/root_system/weight_space.py"            
        sage -t  "devel/sage/sage/combinat/root_system/coxeter_matrix.py"          
        sage -t  "devel/sage/sage/combinat/root_system/weight_lattice_realization.py"
        sage -t  "devel/sage/sage/combinat/root_system/type_dual.py"                 
        sage -t  "devel/sage/sage/combinat/root_system/weyl_group.py"                "devel/sage/sage/misc/html.py" 
        sage -t  "devel/sage/sage/combinat/root_system/type_reducible.py"            
        sage -t  "devel/sage/sage/combinat/root_system/dynkin_diagram.py"            
        sage -t  "devel/sage/sage/combinat/root_system/root_space.py"                
        sage -t  "devel/sage/sage/combinat/root_system/cartan_matrix.py"             
        sage -t  "devel/sage/sage/combinat/permutation.py"                           
        sage -t  "devel/sage/sage/combinat/species/species.py"                       
        sage -t  "devel/sage/sage/combinat/species/recursive_species.py"             
        sage -t  "devel/sage/sage/combinat/species/sum_species.py"                   
        sage -t  "devel/sage/sage/combinat/species/product_species.py"               
        sage -t  "devel/sage/sage/combinat/crystals/fast_crystals.py"                
        sage -t  "devel/sage/sage/combinat/crystals/tensor_product.py"               
        sage -t  "devel/sage/sage/combinat/crystals/spins.py"                        
        sage -t  "devel/sage/sage/combinat/crystals/letters.py"                      
        sage -t  "devel/sage/sage/combinat/crystals/crystals.py"                     
        sage -t  "devel/sage/sage/combinat/graph_path.py"                            
        sage -t  "devel/sage/sage/databases/database.py"                             
        sage -t  "devel/sage/sage/misc/html.py"                                      
        sage -t  "devel/sage/sage/misc/functional.py"                                
        sage -t  "devel/sage/sage/misc/classgraph.py"     
```
(I suspect that "devel/sage/sage/misc/html.py" failing was already reported as a separate issue. The others seem new.) In particular, there was the following:

```
wdj@hera:~/sagefiles/sage-4.0.1.alpha0$ ./sage -t  "devel/sage/doc/en/constructions/graph_theory.rst"
sage -t  "devel/sage/doc/en/constructions/graph_theory.rst"                                          
**********************************************************************                               
File "/home/wdj/sagefiles/sage-4.0.1.alpha0/devel/sage/doc/en/constructions/graph_theory.rst", line 31:
    sage: D = DiGraph( { 0: [1], 1: [2], 2: [0]} )                                                     
Exception raised:                                                                                      
    Traceback (most recent call last):                                                                 
      File "/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test 
        self.run_one_example(test, example, filename, compileflags)                                    
      File "/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)                  
      File "/home/wdj/sagefiles/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs                                                                   
      File "<doctest __main__.example_1[2]>", line 1, in <module>                                        
        D = DiGraph( { Integer(0): [Integer(1)], Integer(1): [Integer(2)], Integer(2): [Integer(0)]} )###line 31:
    sage: D = DiGraph( { 0: [1], 1: [2], 2: [0]} )                                                               
      File "/home/wdj/sagefiles/sage-4.0.1.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 10117, in __init__
        self.add_vertices(verts)
      File "/home/wdj/sagefiles/sage-4.0.1.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 2923, in add_vertices
        self._backend.add_vertices(vertices)
      File "sparse_graph.pyx", line 1627, in sage.graphs.base.sparse_graph.SparseGraphBackend.add_vertices (sage/graphs/base/sparse_graph.c:15334)
      File "sparse_graph.pyx", line 404, in sage.graphs.base.sparse_graph.SparseGraph.add_vertices (sage/graphs/base/sparse_graph.c:5294)
      File "sparse_graph.pyx", line 424, in sage.graphs.base.sparse_graph.SparseGraph.add_vertices (sage/graphs/base/sparse_graph.c:5217)
    TypeError: 'int' object is not iterable
**********************************************************************
1 items had failures:
   1 of   3 in __main__.example_1
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/wdj/sagefiles/sage-4.0.1.alpha0/tmp/.doctest_graph_theory.py
         [3.3 s]
exit code: 1024

----------------------------------------------------------------------
The following tests failed:


        sage -t  "devel/sage/doc/en/constructions/graph_theory.rst"

```

Hope this helps.



---

archive/issue_comments_039913.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDavid,\n\nI appreciate your enthusiasm, but these patches are not ready. There is no point in testing until they are. There are several more patches coming before anything is going to actually work.",
    "created_at": "2009-06-03T14:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39913",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:4" align="right">comment:4</div>

David,

I appreciate your enthusiasm, but these patches are not ready. There is no point in testing until they are. There are several more patches coming before anything is going to actually work.



---

archive/issue_comments_039914.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSorry, I just read your email to sage-devel and missed the \"not ready\" title of your ticket... I'll try to read more carefully next time:-)",
    "created_at": "2009-06-03T17:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39914",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:5" align="right">comment:5</div>

Sorry, I just read your email to sage-devel and missed the "not ready" title of your ticket... I'll try to read more carefully next time:-)



---

archive/issue_comments_039915.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nLatest version is the closest I've seen to the whole test quite passing, but there are persisting memory issues (`malloc: *** error for object 0x8a26660: incorrect checksum for freed object - object was probably modified after being freed.`). The following example exposes this best, due to having to double the allocation several times:\n\n```\nG = Graph()\nG.add_vertices(range(5000))\n```",
    "created_at": "2009-06-03T20:49:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39915",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:6" align="right">comment:6</div>

Latest version is the closest I've seen to the whole test quite passing, but there are persisting memory issues (`malloc: *** error for object 0x8a26660: incorrect checksum for freed object - object was probably modified after being freed.`). The following example exposes this best, due to having to double the allocation several times:

```
G = Graph()
G.add_vertices(range(5000))
```



---

archive/issue_comments_039916.json:
```json
{
    "body": "Attachment: **[trac_6085-part-5.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-5.patch.gz)**",
    "created_at": "2009-06-04T12:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39916",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-part-5.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-5.patch.gz)**



---

archive/issue_comments_039917.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOK, latest version passes memory testing, and passes all tests except where pickling is involved... So there will be probably one more patch, with this and more documentation and other random cleanup.",
    "created_at": "2009-06-04T12:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39917",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:7" align="right">comment:7</div>

OK, latest version passes memory testing, and passes all tests except where pickling is involved... So there will be probably one more patch, with this and more documentation and other random cleanup.



---

archive/issue_comments_039918.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[trac_6085-part-6.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-6.patch.gz)**\n\nPart 6 brings dense graphs up to speed. Still need pickling.",
    "created_at": "2009-06-05T16:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39918",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[trac_6085-part-6.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-6.patch.gz)**

Part 6 brings dense graphs up to speed. Still need pickling.



---

archive/issue_comments_039919.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAfter patch 7, the only test failures in `graphs` I can find are related to the planarity code Emily Kirkman and John Bober wrote. I can imagine that the problem is that CGraphs used to require to have vertices in a consecutive range, and now, e.g. you can have the vertex set = {1, 7, 9}:\n\n```\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py\", line 2246:\n    sage: g.set_planar_positions(test=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_45[3]>\", line 1, in <module>\n        g.set_planar_positions(test=True)###line 2246:\n    sage: g.set_planar_positions(test=True)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 2324, in set_planar_positions\n        raise Exception('BUG: Triangulation returned face: %s'%face)\n    Exception: BUG: Triangulation returned face: [(0, 1), (1, 2), (2, 3), (3, 4), (4, 5), (5, 6), (6, 7), (7, 8), (8, 9), (9, 1), (1, 0)]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py\", line 2249:\n    sage: g.set_planar_positions(test=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_45[5]>\", line 1, in <module>\n        g.set_planar_positions(test=True)###line 2249:\n    sage: g.set_planar_positions(test=True)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 2324, in set_planar_positions\n        raise Exception('BUG: Triangulation returned face: %s'%face)\n    Exception: BUG: Triangulation returned face: [(11, 103), (103, 104), (104, 95), (95, 11)]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py\", line 2252:\n    sage: g.set_planar_positions(test=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_45[7]>\", line 1, in <module>\n        g.set_planar_positions(test=True)###line 2252:\n    sage: g.set_planar_positions(test=True)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 2332, in set_planar_positions\n        tree_nodes = _realizer( G, label)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 397, in _realizer\n        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 467, in _compute_coordinates\n        p = tree_nodes[v][(i + 1) % 3]\n    KeyError: None\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py\", line 2366:\n    sage: D.set_planar_positions()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_46[3]>\", line 1, in <module>\n        D.set_planar_positions()###line 2366:\n    sage: D.set_planar_positions()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 2332, in set_planar_positions\n        tree_nodes = _realizer( G, label)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 397, in _realizer\n        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 467, in _compute_coordinates\n        p = tree_nodes[v][(i + 1) % 3]\n    KeyError: None\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py\", line 2367:\n    sage: D.is_drawn_free_of_edge_crossings()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py\", line 153:\n    sage: _realizer(g, tn)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[8]>\", line 1, in <module>\n        _realizer(g, tn)###line 153:\n    sage: _realizer(g, tn)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 397, in _realizer\n        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 467, in _compute_coordinates\n        p = tree_nodes[v][(i + 1) % 3]\n    KeyError: None\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py\", line 350:\n    sage: _realizer(g, tn)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[8]>\", line 1, in <module>\n        _realizer(g, tn)###line 350:\n    sage: _realizer(g, tn)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 397, in _realizer\n        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 467, in _compute_coordinates\n        p = tree_nodes[v][(i + 1) % 3]\n    KeyError: None\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py\", line 430:\n    sage: r = _realizer(g, tn)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_4[8]>\", line 1, in <module>\n        r = _realizer(g, tn)###line 430:\n    sage: r = _realizer(g, tn)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 397, in _realizer\n        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 467, in _compute_coordinates\n        p = tree_nodes[v][(i + 1) % 3]\n    KeyError: None\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py\", line 431:\n    sage: _compute_coordinates(g,r)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_4[9]>\", line 1, in <module>\n        _compute_coordinates(g,r)###line 431:\n    sage: _compute_coordinates(g,r)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py\", line 437, in _compute_coordinates\n        tree_nodes, (v1, v2, v3) = x\n    ValueError: too many values to unpack\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py\", line 432:\n    sage: g.get_pos()\nExpected:\n    {0: [5, 1], 1: [0, 5], 2: [1, 0], 3: [1, 4], 4: [2, 1], 5: [2, 3], 6: [3, 2]}\nGot nothing\n**********************************************************************\n```\n\nThis one probably results from ordering being different:\n\n```\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/posets/posets.py\", line 924:\n    sage: [(v,P.rank(v)) for v in P]\nExpected:\n    [(1234, 0),\n     (2134, 1),\n    ...\n     (4231, 5),\n     (4321, 6)]\nGot:\n    [(1234, 0), (1243, 1), (1324, 1), (2134, 1), (2314, 2), (1423, 2), (3124, 2), (3214, 3), (1342, 2), (1432, 3), (2143, 2), (2341, 3), (4123, 3), (3142, 3), (4132, 4), (3241, 4), (2413, 3), (3412, 4), (2431, 4), (3421, 5), (4213, 4), (4231, 5), (4312, 5), (4321, 6)]\n**********************************************************************\n```\n\nNot sure about these ones:\n\n```\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/species/species.py\", line 667:\n    sage: list(sorted(labels.items()))\nExpected:\n    [(Combinatorial species, 0),\n     (Product of (Combinatorial species) and (Combinatorial species), 2),\n     (Singleton species, 1),\n     (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), 3)]\nGot:\n    [(('o', Combinatorial species), 0), (('o', Product of (Combinatorial species) and (Combinatorial species)), 2), (('o', Singleton species), 1), (('o', Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species))), 3), (('x', 0), 4), (('x', 1), 5), (Combinatorial species, Combinatorial species), (Product of (Combinatorial species) and (Combinatorial species), Product of (Combinatorial species) and (Combinatorial species)), (Singleton species, Singleton species), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)))]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/species/species.py\", line 672:\n    sage: g.edges()\nExpected:\n    [(0, 3, None), (2, 0, None), (2, 0, None), (3, 1, None), (3, 2, None)]\nGot:\n    [(Combinatorial species, Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), None), (Product of (Combinatorial species) and (Combinatorial species), Combinatorial species, None), (Product of (Combinatorial species) and (Combinatorial species), Combinatorial species, None), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Product of (Combinatorial species) and (Combinatorial species), None), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Singleton species, None)]\n**********************************************************************\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1337:\n    sage: s.edges()\nExpected:\n    [(0, 3, word: ca), (0, 5, word: a), (0, 7, word: o), (3, 1, word: cao), (3, 4, word: o), (5, 2, word: cao), (5, 6, word: o)]\nGot:\n    [(0, 1, word: cacao), (0, 2, word: acao), (0, 3, word: ca), (0, 5, word: a), (0, 7, word: o), (3, 1, word: cao), (3, 4, word: o), (5, 2, word: cao), (5, 6, word: o)]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1345:\n    sage: s.edges()\nExpected:\n    [(0, 3, word: 01), (0, 5, word: 1), (3, 1, word: 011), (3, 4, word: 1), (5, 2, word: 011), (5, 6, word: 1)]\nGot:\n    [(0, 1, word: 01011), (0, 2, word: 1011), (0, 3, word: 01), (0, 5, word: 1), (0, 7, word: 1), (3, 1, word: 011), (3, 4, word: 1), (5, 2, word: 011), (5, 6, word: 1), (7, 2, word: 011)]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1389:\n    sage: NST.word_to_node(0, W(\"ca\"))\nExpected:\n    ('node', 17, word: )\nGot:\n    ('implicit', ((0, 5, word: cabaabaca), 2), word: )\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1391:\n    sage: NST.word_to_node(0, W(\"cab\"))\nExpected:\n    ('implicit', ((17, 5, word: baabaca), 1), word: )\nGot:\n    ('implicit', ((0, 5, word: cabaabaca), 3), word: )\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1393:\n    sage: NST.word_to_node(17, W(\"b\"))\nExpected:\n    ('implicit', ((17, 5, word: baabaca), 1), word: )\nGot:\n    ('node', 17, word: b)\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1395:\n    sage: NST.word_to_node(15, W(\"baabacabca\"))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_41[8]>\", line 1, in <module>\n        NST.word_to_node(Integer(15), W(\"baabacabca\"))###line 1395:\n    sage: NST.word_to_node(15, W(\"baabacabca\"))\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py\", line 1400, in word_to_node\n        for v in self.successor_iterator(node):\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 10434, in successor_iterator\n        return iter(set(self._backend.iterator_out_nbrs(vertex)))\n      File \"c_graph.pyx\", line 615, in sage.graphs.base.c_graph.CGraphBackend.iterator_out_nbrs (sage/graphs/base/c_graph.c:7952)\n    KeyError: 15\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1464:\n    sage: NaiveSuffixTree(Word(\"abacabaabaca\")).plot()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_43[3]>\", line 1, in <module>\n        NaiveSuffixTree(Word(\"abacabaabaca\")).plot()###line 1464:\n    sage: NaiveSuffixTree(Word(\"abacabaabaca\")).plot()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py\", line 1477, in plot\n        *args, **kwds)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/plot/misc.py\", line 325, in wrapper\n        return func(*args, **options)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 6513, in plot\n        return GraphPlot(graph=self, options=options).plot()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py\", line 84, in __init__\n        self.set_pos()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py\", line 148, in set_pos\n        raise RuntimeError(\"Cannot use tree layout on this graph: self.is_tree() returns False.\")\n    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1469:\n    sage: type(NaiveSuffixTree(Word(\"abacabaabaca\")).plot())\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_43[5]>\", line 1, in <module>\n        type(NaiveSuffixTree(Word(\"abacabaabaca\")).plot())###line 1469:\n    sage: type(NaiveSuffixTree(Word(\"abacabaabaca\")).plot())\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py\", line 1477, in plot\n        *args, **kwds)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/plot/misc.py\", line 325, in wrapper\n        return func(*args, **options)\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 6513, in plot\n        return GraphPlot(graph=self, options=options).plot()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py\", line 84, in __init__\n        self.set_pos()\n      File \"/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py\", line 148, in set_pos\n        raise RuntimeError(\"Cannot use tree layout on this graph: self.is_tree() returns False.\")\n    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.\n**********************************************************************\nFile \"/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py\", line 1487:\n    sage: NaiveSuffixTree(Word(\"abacabaabaca\")).node_to_word(17)\nExpected:\n    word: ca\nGot:\n    word: aca\n**********************************************************************\n```",
    "created_at": "2009-06-05T17:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39919",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:9" align="right">comment:9</div>

After patch 7, the only test failures in `graphs` I can find are related to the planarity code Emily Kirkman and John Bober wrote. I can imagine that the problem is that CGraphs used to require to have vertices in a consecutive range, and now, e.g. you can have the vertex set = {1, 7, 9}:

```
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py", line 2246:
    sage: g.set_planar_positions(test=True)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_45[3]>", line 1, in <module>
        g.set_planar_positions(test=True)###line 2246:
    sage: g.set_planar_positions(test=True)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 2324, in set_planar_positions
        raise Exception('BUG: Triangulation returned face: %s'%face)
    Exception: BUG: Triangulation returned face: [(0, 1), (1, 2), (2, 3), (3, 4), (4, 5), (5, 6), (6, 7), (7, 8), (8, 9), (9, 1), (1, 0)]
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py", line 2249:
    sage: g.set_planar_positions(test=True)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_45[5]>", line 1, in <module>
        g.set_planar_positions(test=True)###line 2249:
    sage: g.set_planar_positions(test=True)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 2324, in set_planar_positions
        raise Exception('BUG: Triangulation returned face: %s'%face)
    Exception: BUG: Triangulation returned face: [(11, 103), (103, 104), (104, 95), (95, 11)]
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py", line 2252:
    sage: g.set_planar_positions(test=True)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_45[7]>", line 1, in <module>
        g.set_planar_positions(test=True)###line 2252:
    sage: g.set_planar_positions(test=True)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 2332, in set_planar_positions
        tree_nodes = _realizer( G, label)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 397, in _realizer
        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 467, in _compute_coordinates
        p = tree_nodes[v][(i + 1) % 3]
    KeyError: None
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py", line 2366:
    sage: D.set_planar_positions()
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_46[3]>", line 1, in <module>
        D.set_planar_positions()###line 2366:
    sage: D.set_planar_positions()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 2332, in set_planar_positions
        tree_nodes = _realizer( G, label)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 397, in _realizer
        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 467, in _compute_coordinates
        p = tree_nodes[v][(i + 1) % 3]
    KeyError: None
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/graph.py", line 2367:
    sage: D.is_drawn_free_of_edge_crossings()
Expected:
    True
Got:
    False
**********************************************************************
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py", line 153:
    sage: _realizer(g, tn)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[8]>", line 1, in <module>
        _realizer(g, tn)###line 153:
    sage: _realizer(g, tn)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 397, in _realizer
        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 467, in _compute_coordinates
        p = tree_nodes[v][(i + 1) % 3]
    KeyError: None
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py", line 350:
    sage: _realizer(g, tn)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[8]>", line 1, in <module>
        _realizer(g, tn)###line 350:
    sage: _realizer(g, tn)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 397, in _realizer
        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 467, in _compute_coordinates
        p = tree_nodes[v][(i + 1) % 3]
    KeyError: None
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py", line 430:
    sage: r = _realizer(g, tn)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_4[8]>", line 1, in <module>
        r = _realizer(g, tn)###line 430:
    sage: r = _realizer(g, tn)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 397, in _realizer
        _compute_coordinates(realizer, (tree_nodes, (v1, v2, v3)))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 467, in _compute_coordinates
        p = tree_nodes[v][(i + 1) % 3]
    KeyError: None
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py", line 431:
    sage: _compute_coordinates(g,r)
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_4[9]>", line 1, in <module>
        _compute_coordinates(g,r)###line 431:
    sage: _compute_coordinates(g,r)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/schnyder.py", line 437, in _compute_coordinates
        tree_nodes, (v1, v2, v3) = x
    ValueError: too many values to unpack
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/graphs/schnyder.py", line 432:
    sage: g.get_pos()
Expected:
    {0: [5, 1], 1: [0, 5], 2: [1, 0], 3: [1, 4], 4: [2, 1], 5: [2, 3], 6: [3, 2]}
Got nothing
**********************************************************************
```

This one probably results from ordering being different:

```
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/posets/posets.py", line 924:
    sage: [(v,P.rank(v)) for v in P]
Expected:
    [(1234, 0),
     (2134, 1),
    ...
     (4231, 5),
     (4321, 6)]
Got:
    [(1234, 0), (1243, 1), (1324, 1), (2134, 1), (2314, 2), (1423, 2), (3124, 2), (3214, 3), (1342, 2), (1432, 3), (2143, 2), (2341, 3), (4123, 3), (3142, 3), (4132, 4), (3241, 4), (2413, 3), (3412, 4), (2431, 4), (3421, 5), (4213, 4), (4231, 5), (4312, 5), (4321, 6)]
**********************************************************************
```

Not sure about these ones:

```
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/species/species.py", line 667:
    sage: list(sorted(labels.items()))
Expected:
    [(Combinatorial species, 0),
     (Product of (Combinatorial species) and (Combinatorial species), 2),
     (Singleton species, 1),
     (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), 3)]
Got:
    [(('o', Combinatorial species), 0), (('o', Product of (Combinatorial species) and (Combinatorial species)), 2), (('o', Singleton species), 1), (('o', Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species))), 3), (('x', 0), 4), (('x', 1), 5), (Combinatorial species, Combinatorial species), (Product of (Combinatorial species) and (Combinatorial species), Product of (Combinatorial species) and (Combinatorial species)), (Singleton species, Singleton species), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)))]
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/species/species.py", line 672:
    sage: g.edges()
Expected:
    [(0, 3, None), (2, 0, None), (2, 0, None), (3, 1, None), (3, 2, None)]
Got:
    [(Combinatorial species, Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), None), (Product of (Combinatorial species) and (Combinatorial species), Combinatorial species, None), (Product of (Combinatorial species) and (Combinatorial species), Combinatorial species, None), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Product of (Combinatorial species) and (Combinatorial species), None), (Sum of (Singleton species) and (Product of (Combinatorial species) and (Combinatorial species)), Singleton species, None)]
**********************************************************************
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1337:
    sage: s.edges()
Expected:
    [(0, 3, word: ca), (0, 5, word: a), (0, 7, word: o), (3, 1, word: cao), (3, 4, word: o), (5, 2, word: cao), (5, 6, word: o)]
Got:
    [(0, 1, word: cacao), (0, 2, word: acao), (0, 3, word: ca), (0, 5, word: a), (0, 7, word: o), (3, 1, word: cao), (3, 4, word: o), (5, 2, word: cao), (5, 6, word: o)]
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1345:
    sage: s.edges()
Expected:
    [(0, 3, word: 01), (0, 5, word: 1), (3, 1, word: 011), (3, 4, word: 1), (5, 2, word: 011), (5, 6, word: 1)]
Got:
    [(0, 1, word: 01011), (0, 2, word: 1011), (0, 3, word: 01), (0, 5, word: 1), (0, 7, word: 1), (3, 1, word: 011), (3, 4, word: 1), (5, 2, word: 011), (5, 6, word: 1), (7, 2, word: 011)]
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1389:
    sage: NST.word_to_node(0, W("ca"))
Expected:
    ('node', 17, word: )
Got:
    ('implicit', ((0, 5, word: cabaabaca), 2), word: )
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1391:
    sage: NST.word_to_node(0, W("cab"))
Expected:
    ('implicit', ((17, 5, word: baabaca), 1), word: )
Got:
    ('implicit', ((0, 5, word: cabaabaca), 3), word: )
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1393:
    sage: NST.word_to_node(17, W("b"))
Expected:
    ('implicit', ((17, 5, word: baabaca), 1), word: )
Got:
    ('node', 17, word: b)
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1395:
    sage: NST.word_to_node(15, W("baabacabca"))
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_41[8]>", line 1, in <module>
        NST.word_to_node(Integer(15), W("baabacabca"))###line 1395:
    sage: NST.word_to_node(15, W("baabacabca"))
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py", line 1400, in word_to_node
        for v in self.successor_iterator(node):
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 10434, in successor_iterator
        return iter(set(self._backend.iterator_out_nbrs(vertex)))
      File "c_graph.pyx", line 615, in sage.graphs.base.c_graph.CGraphBackend.iterator_out_nbrs (sage/graphs/base/c_graph.c:7952)
    KeyError: 15
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1464:
    sage: NaiveSuffixTree(Word("abacabaabaca")).plot()
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_43[3]>", line 1, in <module>
        NaiveSuffixTree(Word("abacabaabaca")).plot()###line 1464:
    sage: NaiveSuffixTree(Word("abacabaabaca")).plot()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py", line 1477, in plot
        *args, **kwds)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/plot/misc.py", line 325, in wrapper
        return func(*args, **options)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 6513, in plot
        return GraphPlot(graph=self, options=options).plot()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py", line 84, in __init__
        self.set_pos()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py", line 148, in set_pos
        raise RuntimeError("Cannot use tree layout on this graph: self.is_tree() returns False.")
    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1469:
    sage: type(NaiveSuffixTree(Word("abacabaabaca")).plot())
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.0.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_43[5]>", line 1, in <module>
        type(NaiveSuffixTree(Word("abacabaabaca")).plot())###line 1469:
    sage: type(NaiveSuffixTree(Word("abacabaabaca")).plot())
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/combinat/words/suffix_trees.py", line 1477, in plot
        *args, **kwds)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/plot/misc.py", line 325, in wrapper
        return func(*args, **options)
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 6513, in plot
        return GraphPlot(graph=self, options=options).plot()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py", line 84, in __init__
        self.set_pos()
      File "/Users/rlmill/sage-4.0.rc0/local/lib/python2.5/site-packages/sage/graphs/graph_plot.py", line 148, in set_pos
        raise RuntimeError("Cannot use tree layout on this graph: self.is_tree() returns False.")
    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.
**********************************************************************
File "/Users/rlmill/sage-4.0.rc0/devel/sage-main/sage/combinat/words/suffix_trees.py", line 1487:
    sage: NaiveSuffixTree(Word("abacabaabaca")).node_to_word(17)
Expected:
    word: ca
Got:
    word: aca
**********************************************************************
```



---

archive/issue_comments_039920.json:
```json
{
    "body": "Attachment: **[trac_6085-part-7.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-7.patch.gz)**",
    "created_at": "2009-06-06T07:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39920",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-part-7.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-7.patch.gz)**



---

archive/issue_comments_039921.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSpecies doctests now passing. The `sage/combinat/words` errors are a bit more mysterious to me, because of the class structure there...",
    "created_at": "2009-06-06T07:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39921",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:10" align="right">comment:10</div>

Species doctests now passing. The `sage/combinat/words` errors are a bit more mysterious to me, because of the class structure there...



---

archive/issue_comments_039922.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAttachment: **[trac_6085-part-8.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-8.patch.gz)**\n\nA benchmark:\n\n```\nsage: time G = Graph(1000000)\nCPU times: user 7.31 s, sys: 0.29 s, total: 7.60 s\nWall time: 7.65 s\n```\n\n```\nsage: time G = Graph(1000000)\nCPU times: user 0.05 s, sys: 0.09 s, total: 0.13 s\nWall time: 0.14 s\n```",
    "created_at": "2009-06-16T20:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39922",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:12" align="right">comment:12</div>

Attachment: **[trac_6085-part-8.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-8.patch.gz)**

A benchmark:

```
sage: time G = Graph(1000000)
CPU times: user 7.31 s, sys: 0.29 s, total: 7.60 s
Wall time: 7.65 s
```

```
sage: time G = Graph(1000000)
CPU times: user 0.05 s, sys: 0.09 s, total: 0.13 s
Wall time: 0.14 s
```



---

archive/issue_comments_039923.json:
```json
{
    "body": "Reviewer: **boothby**",
    "created_at": "2009-06-16T22:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39923",
    "user": "https://github.com/boothby"
}
```

Reviewer: **boothby**



---

archive/issue_events_073256.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-17T14:05:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "title_is": "[needs rebase] Finish full implementation of c_graphs",
    "title_was": "[not ready] Finish full implementation of c_graphs",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73256"
}
```



---

archive/issue_comments_039924.json:
```json
{
    "body": "Author: **Robert Miller**",
    "created_at": "2009-06-17T14:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39924",
    "user": "https://github.com/rlmill"
}
```

Author: **Robert Miller**



---

archive/issue_comments_039925.json:
```json
{
    "body": "Changed reviewer from **boothby** to **Tom Boothby**",
    "created_at": "2009-06-17T14:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39925",
    "user": "https://github.com/rlmill"
}
```

Changed reviewer from **boothby** to **Tom Boothby**



---

archive/issue_comments_039926.json:
```json
{
    "body": "Attachment: **[trac_6085-part-4-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-4-rebased.patch.gz)**",
    "created_at": "2009-06-17T17:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39926",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-part-4-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-4-rebased.patch.gz)**



---

archive/issue_events_073257.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-17T17:05:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "title_is": "Finish full implementation of c_graphs",
    "title_was": "[needs rebase] Finish full implementation of c_graphs",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73257"
}
```



---

archive/issue_events_073258.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-17T17:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73258"
}
```



---

archive/issue_comments_039927.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_6085-part-9-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-9-rebased.patch.gz)**\n\nApply patches in *numerical* order, not the order listed. Patches are rebased on sage-4.0.2.rc2.",
    "created_at": "2009-06-17T17:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39927",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_6085-part-9-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-9-rebased.patch.gz)**

Apply patches in *numerical* order, not the order listed. Patches are rebased on sage-4.0.2.rc2.



---

archive/issue_comments_039928.json:
```json
{
    "body": "Equivalent to applying parts 1 through 9",
    "created_at": "2009-06-17T20:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39928",
    "user": "https://github.com/rlmill"
}
```

Equivalent to applying parts 1 through 9



---

archive/issue_comments_039929.json:
```json
{
    "body": "Attachment: **[trac_6085-flattened.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz)**\n\nAttachment: **[trac_6085-part-10.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-10.patch.gz)**\n\nOne last bugfix in bitsets",
    "created_at": "2009-06-18T15:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39929",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-flattened.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz)**

Attachment: **[trac_6085-part-10.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-10.patch.gz)**

One last bugfix in bitsets



---

archive/issue_comments_039930.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI can't apply this to 4.1.alpha0.\n\n```\nsage: hg_sage.apply('https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz')\nAttempting to load remote file: https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz\nLoading: [..................................]\ncd \"/space/boothby/sage-4.1.a0/devel/sage\" && hg status\ncd \"/space/boothby/sage-4.1.a0/devel/sage\" && hg status\ncd \"/space/boothby/sage-4.1.a0/devel/sage\" && hg import   \"/home/boothby/.sage/temp/geom/12604/tmp_1.patch\"\napplying /home/boothby/.sage/temp/geom/12604/tmp_1.patch\nunable to find 'sage/graphs/graph_isom.pyx' for patching\n3 out of 3 hunks FAILED -- saving rejects to file sage/graphs/graph_isom.pyx.rej\nabort: patch failed to apply\n```",
    "created_at": "2009-06-25T03:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39930",
    "user": "https://github.com/boothby"
}
```

<div id="comment:17" align="right">comment:17</div>

I can't apply this to 4.1.alpha0.

```
sage: hg_sage.apply('https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz')
Attempting to load remote file: https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened.patch.gz
Loading: [..................................]
cd "/space/boothby/sage-4.1.a0/devel/sage" && hg status
cd "/space/boothby/sage-4.1.a0/devel/sage" && hg status
cd "/space/boothby/sage-4.1.a0/devel/sage" && hg import   "/home/boothby/.sage/temp/geom/12604/tmp_1.patch"
applying /home/boothby/.sage/temp/geom/12604/tmp_1.patch
unable to find 'sage/graphs/graph_isom.pyx' for patching
3 out of 3 hunks FAILED -- saving rejects to file sage/graphs/graph_isom.pyx.rej
abort: patch failed to apply
```



---

archive/issue_comments_039931.json:
```json
{
    "body": "Attachment: **[trac_6085-flattened-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened-rebased.patch.gz)**\n\nAttachment: **[trac_6085-part-11.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-11.patch.gz)**\n\nPython 2.6 formatting changes",
    "created_at": "2009-06-25T08:59:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39931",
    "user": "https://github.com/rlmill"
}
```

Attachment: **[trac_6085-flattened-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-flattened-rebased.patch.gz)**

Attachment: **[trac_6085-part-11.patch.gz](https://github.com/sagemath/sage/files/ticket6085/trac_6085-part-11.patch.gz)**

Python 2.6 formatting changes



---

archive/issue_comments_039932.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSince I have rebased this ticket around the Python 2.6.2 changes, and since the Python 2.6.2 upgrade has uncovered some problems, I'm flagging this as needs work until some resolution regarding Python 2.6 is reached. At that point, I'll post a flat patch which will be appropriate, whichever way we end up going.",
    "created_at": "2009-06-25T10:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39932",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:18" align="right">comment:18</div>

Since I have rebased this ticket around the Python 2.6.2 changes, and since the Python 2.6.2 upgrade has uncovered some problems, I'm flagging this as needs work until some resolution regarding Python 2.6 is reached. At that point, I'll post a flat patch which will be appropriate, whichever way we end up going.



---

archive/issue_events_073259.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-25T10:05:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73259"
}
```



---

archive/issue_events_073260.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-25T10:05:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73260"
}
```



---

archive/issue_events_073261.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2009-06-25T17:49:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73261"
}
```



---

archive/issue_events_073262.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2009-06-25T17:49:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73262"
}
```



---

archive/issue_comments_039933.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWorks for me!",
    "created_at": "2009-06-25T17:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39933",
    "user": "https://github.com/boothby"
}
```

<div id="comment:19" align="right">comment:19</div>

Works for me!



---

archive/issue_events_073263.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-25T17:52:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73263"
}
```



---

archive/issue_events_073264.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-25T17:52:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6085#event-73264"
}
```



---

archive/issue_comments_039934.json:
```json
{
    "body": "Merged: **sage-4.1.alpha1**",
    "created_at": "2009-06-25T17:52:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6085#issuecomment-39934",
    "user": "https://github.com/rlmill"
}
```

Merged: **sage-4.1.alpha1**
