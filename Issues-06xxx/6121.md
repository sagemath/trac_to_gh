# Issue 6121: use metaclasses to support nested class pickling

archive/issues_006121.json:
```json
{
    "assignees": [],
    "body": "We can work around this by shipping and always using a custom cPickle, and hopefully this will eventually be fixed in Python itself, but a metaclass seems to be a less hackish solution. \n\nAnother solution is decorators, but this requires a decorator on every use. \n\nAssignee: **cwitty**\n\nCC:  sage-combinat cwitty\n\nKeywords: **pickling, nested classes**\n\nReviewer: **Nicolas M. Thi\u00e9ry**\n\nAuthor: **Robert Bradshaw, Nicolas M. Thi\u00e9ry**\n\nMerged: **4.0.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6121_\n\n",
    "closed_at": "2009-06-13T21:54:19Z",
    "created_at": "2009-05-22T23:06:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.0.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "use metaclasses to support nested class pickling",
    "type": "issue",
    "updated_at": "2016-08-07T19:53:32Z",
    "url": "https://github.com/sagemath/sage/issues/6121",
    "user": "https://github.com/robertwb"
}
```
We can work around this by shipping and always using a custom cPickle, and hopefully this will eventually be fixed in Python itself, but a metaclass seems to be a less hackish solution. 

Another solution is decorators, but this requires a decorator on every use. 

Assignee: **cwitty**

CC:  sage-combinat cwitty

Keywords: **pickling, nested classes**

Reviewer: **Nicolas M. Thiéry**

Author: **Robert Bradshaw, Nicolas M. Thiéry**

Merged: **4.0.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/6121_





---

archive/issue_events_066122.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-05-22T23:06:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66122"
}
```



---

archive/issue_events_066123.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-05-22T23:06:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66123"
}
```



---

archive/issue_comments_041826.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThanks in advance for doing it.\n\nNotes:\n- Fundamentally, the two approaches work the same (fixing the name, and inserting it in the module).\n  The only difference is when this occur.\n- We anyway need to ship a patched cPickle for #5985.\n- This is a blocker for a bunch of later patches.",
    "created_at": "2009-05-23T03:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41826",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:1'>Comment 1:</a>
Thanks in advance for doing it.

Notes:
- Fundamentally, the two approaches work the same (fixing the name, and inserting it in the module).
  The only difference is when this occur.
- We anyway need to ship a patched cPickle for #5985.
- This is a blocker for a bunch of later patches.



---

archive/issue_comments_041827.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nDepends on #6110\n\nAuthorship credit should go to nthiery as well.",
    "created_at": "2009-06-10T09:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41827",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'>Comment 2:</a>
Depends on #6110

Authorship credit should go to nthiery as well.



---

archive/issue_events_066124.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-06-10T09:03:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66124"
}
```



---

archive/issue_comments_041828.json:
```json
{
    "body": "Attachment: **[6121-nested-pickle-meta.patch.gz](https://github.com/sagemath/sage/files/ticket6121/6121-nested-pickle-meta.patch.gz)**",
    "created_at": "2009-06-10T09:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41828",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[6121-nested-pickle-meta.patch.gz](https://github.com/sagemath/sage/files/ticket6121/6121-nested-pickle-meta.patch.gz)**



---

archive/issue_events_066125.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-06-12T15:59:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "milestone_number": null,
    "milestone_title": "sage-4.0.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66125"
}
```



---

archive/issue_events_066126.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-06-12T15:59:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66126"
}
```



---

archive/issue_events_066127.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-06-12T15:59:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66127"
}
```



---

archive/issue_comments_041829.json:
```json
{
    "body": "Reviewer: **nthiery**",
    "created_at": "2009-06-12T15:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41829",
    "user": "https://github.com/nthiery"
}
```

Reviewer: **nthiery**



---

archive/issue_comments_041830.json:
```json
{
    "body": "Author: **robertwb, nthiery**",
    "created_at": "2009-06-12T15:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41830",
    "user": "https://github.com/nthiery"
}
```

Author: **robertwb, nthiery**



---

archive/issue_comments_041831.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nApplies and test smoothly (and 4.1, with #6110 applied first) and does its job.",
    "created_at": "2009-06-12T15:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41831",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'>Comment 3:</a>
Applies and test smoothly (and 4.1, with #6110 applied first) and does its job.



---

archive/issue_events_066128.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-06-12T15:59:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66128"
}
```



---

archive/issue_events_066129.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-06-12T15:59:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66129"
}
```



---

archive/issue_comments_041832.json:
```json
{
    "body": "Changed author from **robertwb, nthiery** to **Robert Bradshaw, Nicolas Thiery**",
    "created_at": "2009-06-13T21:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41832",
    "user": "https://github.com/ncalexan"
}
```

Changed author from **robertwb, nthiery** to **Robert Bradshaw, Nicolas Thiery**



---

archive/issue_events_066130.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66130"
}
```



---

archive/issue_events_066131.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:54:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6121#event-66131"
}
```



---

archive/issue_comments_041833.json:
```json
{
    "body": "Merged: **4.0.2.alpha0**",
    "created_at": "2009-06-13T21:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41833",
    "user": "https://github.com/ncalexan"
}
```

Merged: **4.0.2.alpha0**



---

archive/issue_comments_041834.json:
```json
{
    "body": "Changed reviewer from **nthiery** to **Nicolas Thiery**",
    "created_at": "2009-06-13T21:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41834",
    "user": "https://github.com/ncalexan"
}
```

Changed reviewer from **nthiery** to **Nicolas Thiery**



---

archive/issue_comments_041835.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nA comment on #5986 indicates that it may be solved with this ticket.",
    "created_at": "2009-09-22T17:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41835",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'>Comment 5:</a>
A comment on #5986 indicates that it may be solved with this ticket.



---

archive/issue_comments_041836.json:
```json
{
    "body": "Changed reviewer from **Nicolas Thiery** to **Nicolas M. Thi\u00e9ry**",
    "created_at": "2016-08-07T19:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41836",
    "user": "https://github.com/fchapoton"
}
```

Changed reviewer from **Nicolas Thiery** to **Nicolas M. Thiéry**



---

archive/issue_comments_041837.json:
```json
{
    "body": "Changed author from **Robert Bradshaw, Nicolas Thiery** to **Robert Bradshaw, Nicolas M. Thi\u00e9ry**",
    "created_at": "2016-08-07T19:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6121#issuecomment-41837",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **Robert Bradshaw, Nicolas Thiery** to **Robert Bradshaw, Nicolas M. Thiéry**
