# Issue 6519: improve the words library code

archive/issues_006519.json:
```json
{
    "assignees": [
        "https://github.com/mwhansen"
    ],
    "body": "The current words library in Sage needs to be improved (mainly for speed, better code organization, etc.).\n\nWe essentially got a patch ready to do this. I'll post it soon.\n\nCC:  @seblabbe\n\nKeywords: **words**\n\nComponent: **combinatorics**\n\nAuthor: **Vincent Delecroix, S\u00e9bastien Labb\u00e9, Franco Saliola**\n\nReviewer: **Robert Miller, S\u00e9bastien Labb\u00e9**\n\nMerged: **sage-4.1.1.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6519_\n\n",
    "closed_at": "2009-07-18T14:07:07Z",
    "created_at": "2009-07-12T14:33:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "improve the words library code",
    "type": "issue",
    "updated_at": "2009-07-18T14:07:07Z",
    "url": "https://github.com/sagemath/sage/issues/6519",
    "user": "https://github.com/saliola"
}
```
The current words library in Sage needs to be improved (mainly for speed, better code organization, etc.).

We essentially got a patch ready to do this. I'll post it soon.

CC:  @seblabbe

Keywords: **words**

Component: **combinatorics**

Author: **Vincent Delecroix, Sébastien Labbé, Franco Saliola**

Reviewer: **Robert Miller, Sébastien Labbé**

Merged: **sage-4.1.1.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/6519_





---

archive/issue_events_078232.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-12T14:33:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "milestone_number": null,
    "milestone_title": "sage-4.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78232"
}
```



---

archive/issue_events_078233.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-12T14:33:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78233"
}
```



---

archive/issue_events_078234.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-12T14:33:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78234"
}
```



---

archive/issue_events_078235.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-07-12T14:33:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "subject": "https://github.com/saliola",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78235"
}
```



---

archive/issue_comments_044912.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nYou can find comparisons of the new code and the old code at the bottom of\nthe site [http://wiki.sagemath.org/WordDesign](http://wiki.sagemath.org/WordDesign). The new code is much\nfaster.",
    "created_at": "2009-07-12T16:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44912",
    "user": "https://github.com/saliola"
}
```

<div id="comment:1" align="right">comment:1</div>

You can find comparisons of the new code and the old code at the bottom of
the site [http://wiki.sagemath.org/WordDesign](http://wiki.sagemath.org/WordDesign). The new code is much
faster.



---

archive/issue_comments_044913.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis patch includes code from S\u00e9bastien Labb\u00e9, Vincent Delecroix and\nmyself, so we should all get author credit. (I added all names to the Author\nfield).\n\nThe development took place on the sage-combinat patch server, and the attached patch\nis just a folding together and re-organizing of all the relevant patches\nfrom the server. It applies cleanly to sage-4.1 and passes all doctests.\n\n**Partial Review:** I reviewed and documented Vincent's code, to which give a positive\nreview. I also reviewed S\u00e9bastien's code, which also gets a positive review.\n\nS\u00e9bastien, can you look over the changes that I made that you haven't yet\nreviewed? I guess these are just the changes that I made this past week?\n(You can find these changes as four independent patches in the sage-combinat\npatches server history.)",
    "created_at": "2009-07-12T17:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44913",
    "user": "https://github.com/saliola"
}
```

<div id="comment:2" align="right">comment:2</div>

This patch includes code from Sébastien Labbé, Vincent Delecroix and
myself, so we should all get author credit. (I added all names to the Author
field).

The development took place on the sage-combinat patch server, and the attached patch
is just a folding together and re-organizing of all the relevant patches
from the server. It applies cleanly to sage-4.1 and passes all doctests.

**Partial Review:** I reviewed and documented Vincent's code, to which give a positive
review. I also reviewed Sébastien's code, which also gets a positive review.

Sébastien, can you look over the changes that I made that you haven't yet
reviewed? I guess these are just the changes that I made this past week?
(You can find these changes as four independent patches in the sage-combinat
patches server history.)



---

archive/issue_events_078236.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-12T17:36:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78236"
}
```



---

archive/issue_events_078237.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-13T19:18:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78237"
}
```



---

archive/issue_events_078238.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-13T19:18:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78238"
}
```



---

archive/issue_comments_044914.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOn top of a fresh sage-4.1 build (OS X), this patch fails to build:\n\n```\nbuilding 'sage.combinat.words.word_datatypes' extension\ngcc -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -Isage/combinat/words -I/Users/rlmill/sage-4.1.32bit/local//include -I/Users/rlmill/sage-4.1.32bit/local//include/csage -I/Users/rlmill/sage-4.1.32bit/devel//sage/sage/ext -I/Users/rlmill/sage-4.1.32bit/local/include/python2.6 -c sage/combinat/words/word_cpp_basic_string.cpp -o build/temp.macosx-10.3-i386-2.6/sage/combinat/words/word_cpp_basic_string.o -w\ncc1plus: warning: command line option \"-Wstrict-prototypes\" is valid for C/ObjC but not for C++\nsage/combinat/words/word_cpp_basic_string.cpp: In member function \u2018size_t Word::find_factor_naive(Word*)\u2019:\nsage/combinat/words/word_cpp_basic_string.cpp:70: error: \u2018memmem\u2019 was not declared in this scope\nerror: command 'gcc' failed with exit status 1\nsage: There was an error installing modified sage library code.\n```",
    "created_at": "2009-07-13T19:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44914",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:3" align="right">comment:3</div>

On top of a fresh sage-4.1 build (OS X), this patch fails to build:

```
building 'sage.combinat.words.word_datatypes' extension
gcc -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -Isage/combinat/words -I/Users/rlmill/sage-4.1.32bit/local//include -I/Users/rlmill/sage-4.1.32bit/local//include/csage -I/Users/rlmill/sage-4.1.32bit/devel//sage/sage/ext -I/Users/rlmill/sage-4.1.32bit/local/include/python2.6 -c sage/combinat/words/word_cpp_basic_string.cpp -o build/temp.macosx-10.3-i386-2.6/sage/combinat/words/word_cpp_basic_string.o -w
cc1plus: warning: command line option "-Wstrict-prototypes" is valid for C/ObjC but not for C++
sage/combinat/words/word_cpp_basic_string.cpp: In member function ‘size_t Word::find_factor_naive(Word*)’:
sage/combinat/words/word_cpp_basic_string.cpp:70: error: ‘memmem’ was not declared in this scope
error: command 'gcc' failed with exit status 1
sage: There was an error installing modified sage library code.
```



---

archive/issue_comments_044915.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@rlmill](#comment%3A3):\n\n> On top of a fresh sage-4.1 build (OS X), this patch fails to build:\n\nOkay, I've factored the offending code out of this patch (once it is fixed,\nwe will create a new ticket for it), so there should no longer be any\nproblems. Can you test it again?",
    "created_at": "2009-07-13T23:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44915",
    "user": "https://github.com/saliola"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@rlmill](#comment%3A3):

> On top of a fresh sage-4.1 build (OS X), this patch fails to build:

Okay, I've factored the offending code out of this patch (once it is fixed,
we will create a new ticket for it), so there should no longer be any
problems. Can you test it again?



---

archive/issue_events_078239.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-13T23:20:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78239"
}
```



---

archive/issue_events_078240.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-13T23:20:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78240"
}
```



---

archive/issue_comments_044916.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@saliola](#comment%3A4):\n> Can you test it again?\n\nThe patch now applies, builds and passes long doctests in `sage/combinat`. I've also skimmed the patch (`historic.txt` was interesting), and it looked good. If you want, I can also run a valgrind session.\n\nDoesn't the date in the deprecation comments need to be updated?\n\n```\n+    ###########################################################################\n+    ##### DEPRECATION WARNINGS (next 4 functions) #############################\n+    ##### Added 23 February 2008 ##############################################\n+    ###########################################################################\n```",
    "created_at": "2009-07-14T16:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44916",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@saliola](#comment%3A4):
> Can you test it again?

The patch now applies, builds and passes long doctests in `sage/combinat`. I've also skimmed the patch (`historic.txt` was interesting), and it looked good. If you want, I can also run a valgrind session.

Doesn't the date in the deprecation comments need to be updated?

```
+    ###########################################################################
+    ##### DEPRECATION WARNINGS (next 4 functions) #############################
+    ##### Added 23 February 2008 ##############################################
+    ###########################################################################
```



---

archive/issue_comments_044917.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI ran valgrind on sage-4.1 + the patch here on the `sage/combinat/words` directory, and all looks good!",
    "created_at": "2009-07-15T16:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44917",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:6" align="right">comment:6</div>

I ran valgrind on sage-4.1 + the patch here on the `sage/combinat/words` directory, and all looks good!



---

archive/issue_comments_044918.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRobert! Thank you very much for doing this. That's great.",
    "created_at": "2009-07-15T16:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44918",
    "user": "https://github.com/saliola"
}
```

<div id="comment:7" align="right">comment:7</div>

Robert! Thank you very much for doing this. That's great.



---

archive/issue_comments_044919.json:
```json
{
    "body": "Reviewer: **Robert Miller**",
    "created_at": "2009-07-16T18:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44919",
    "user": "https://github.com/rlmill"
}
```

Reviewer: **Robert Miller**



---

archive/issue_events_078241.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-16T18:34:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78241"
}
```



---

archive/issue_events_078242.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-16T18:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78242"
}
```



---

archive/issue_comments_044920.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n#6526 should probably be merged right after this, to avoid later conflicts.",
    "created_at": "2009-07-16T18:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44920",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:9" align="right">comment:9</div>

#6526 should probably be merged right after this, to avoid later conflicts.



---

archive/issue_comments_044921.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nDear Robert, I want to thank you for reviewing this huge patch we are working on since so long time. It was an heavy task that was following us for more than one semester. And all this time, I was affraid not to find a reviewer so that the code get old again with another ReST sphinfixication 2 or something like that because things are moving so fast with Sage. So, I feel more light now that this will get merged apparently really soon. Thank you for your contribution.\n\nBy the way, I was having a good excuse to be absent from this ticket review this week. I was organising and giving a course on Sage this week in Montreal. There was between 10 and 20 persons present in the class at all time. We migth have triple the number of Sage users in all Quebec province with this course!! See the link here : http://wiki.sagemath.org/S\u00e9bastienLabb\u00e9/JoursSageUQAM\n\nDear Franco, even if Robert already gave a positive review, I will look the modifications/improvements you have done in the last week tommorow and I will give you feedback if I have any.",
    "created_at": "2009-07-17T02:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44921",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>

Dear Robert, I want to thank you for reviewing this huge patch we are working on since so long time. It was an heavy task that was following us for more than one semester. And all this time, I was affraid not to find a reviewer so that the code get old again with another ReST sphinfixication 2 or something like that because things are moving so fast with Sage. So, I feel more light now that this will get merged apparently really soon. Thank you for your contribution.

By the way, I was having a good excuse to be absent from this ticket review this week. I was organising and giving a course on Sage this week in Montreal. There was between 10 and 20 persons present in the class at all time. We migth have triple the number of Sage users in all Quebec province with this course!! See the link here : http://wiki.sagemath.org/SébastienLabbé/JoursSageUQAM

Dear Franco, even if Robert already gave a positive review, I will look the modifications/improvements you have done in the last week tommorow and I will give you feedback if I have any.



---

archive/issue_comments_044922.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI'm getting a doctest failure:\n\n```\nsage -t -long devel/sage-exp/sage/structure/sage_object.pyx\n**********************************************************************\nFile \"/scratch/mvngu/release/sage-4.1.1/devel/sage-exp/sage/structure/sage_object.pyx\", line 813:\n    sage: sage.structure.sage_object.unpickle_all(std)\nExpected:\n    doctest:...: DeprecationWarning: RQDF is deprecated; use RealField(212) instead.\n    Successfully unpickled 572 objects.\n    Failed to unpickle 0 objects.\nGot:\n    ** failed:  _class__sage_combinat_words_morphism_WordMorphism__.sobj\n    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping__.sobj\n    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping_r__.sobj\n    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_shifted__.sobj\n    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_w1w2__.sobj\n    ** failed:  _class__sage_combinat_words_suffix_trees_ImplicitSuffixTree__.sobj\n    ** failed:  _class__sage_combinat_words_suffix_trees_SuffixTrie__.sobj\n    ** failed:  _class__sage_combinat_words_word_AbstractWord__.sobj\n    ** failed:  _class__sage_combinat_words_word_Word_over_Alphabet__.sobj\n    ** failed:  _class__sage_combinat_words_word_Word_over_OrderedAlphabet__.sobj\n    doctest:1: DeprecationWarning: ChristoffelWord_Lower is deprecated, use LowerChristoffelWord instead\n    doctest:1172: DeprecationWarning: RQDF is deprecated; use RealField(212) instead.\n    Failed:\n    _class__sage_combinat_words_morphism_WordMorphism__.sobj\n    _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping__.sobj\n    _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping_r__.sobj\n    _class__sage_combinat_words_shuffle_product_ShuffleProduct_shifted__.sobj\n    _class__sage_combinat_words_shuffle_product_ShuffleProduct_w1w2__.sobj\n    _class__sage_combinat_words_suffix_trees_ImplicitSuffixTree__.sobj\n    _class__sage_combinat_words_suffix_trees_SuffixTrie__.sobj\n    _class__sage_combinat_words_word_AbstractWord__.sobj\n    _class__sage_combinat_words_word_Word_over_Alphabet__.sobj\n    _class__sage_combinat_words_word_Word_over_OrderedAlphabet__.sobj\n    Successfully unpickled 562 objects.\n    Failed to unpickle 10 objects.\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_18\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/mvngu/release/sage-4.1.1/tmp/.doctest_sage_object.py\n\t [6.6 s]\n```",
    "created_at": "2009-07-17T09:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44922",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:11" align="right">comment:11</div>

I'm getting a doctest failure:

```
sage -t -long devel/sage-exp/sage/structure/sage_object.pyx
**********************************************************************
File "/scratch/mvngu/release/sage-4.1.1/devel/sage-exp/sage/structure/sage_object.pyx", line 813:
    sage: sage.structure.sage_object.unpickle_all(std)
Expected:
    doctest:...: DeprecationWarning: RQDF is deprecated; use RealField(212) instead.
    Successfully unpickled 572 objects.
    Failed to unpickle 0 objects.
Got:
    ** failed:  _class__sage_combinat_words_morphism_WordMorphism__.sobj
    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping__.sobj
    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping_r__.sobj
    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_shifted__.sobj
    ** failed:  _class__sage_combinat_words_shuffle_product_ShuffleProduct_w1w2__.sobj
    ** failed:  _class__sage_combinat_words_suffix_trees_ImplicitSuffixTree__.sobj
    ** failed:  _class__sage_combinat_words_suffix_trees_SuffixTrie__.sobj
    ** failed:  _class__sage_combinat_words_word_AbstractWord__.sobj
    ** failed:  _class__sage_combinat_words_word_Word_over_Alphabet__.sobj
    ** failed:  _class__sage_combinat_words_word_Word_over_OrderedAlphabet__.sobj
    doctest:1: DeprecationWarning: ChristoffelWord_Lower is deprecated, use LowerChristoffelWord instead
    doctest:1172: DeprecationWarning: RQDF is deprecated; use RealField(212) instead.
    Failed:
    _class__sage_combinat_words_morphism_WordMorphism__.sobj
    _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping__.sobj
    _class__sage_combinat_words_shuffle_product_ShuffleProduct_overlapping_r__.sobj
    _class__sage_combinat_words_shuffle_product_ShuffleProduct_shifted__.sobj
    _class__sage_combinat_words_shuffle_product_ShuffleProduct_w1w2__.sobj
    _class__sage_combinat_words_suffix_trees_ImplicitSuffixTree__.sobj
    _class__sage_combinat_words_suffix_trees_SuffixTrie__.sobj
    _class__sage_combinat_words_word_AbstractWord__.sobj
    _class__sage_combinat_words_word_Word_over_Alphabet__.sobj
    _class__sage_combinat_words_word_Word_over_OrderedAlphabet__.sobj
    Successfully unpickled 562 objects.
    Failed to unpickle 10 objects.
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_18
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/mvngu/release/sage-4.1.1/tmp/.doctest_sage_object.py
	 [6.6 s]
```



---

archive/issue_events_078243.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-17T09:53:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78243"
}
```



---

archive/issue_events_078244.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-17T09:53:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78244"
}
```



---

archive/issue_comments_044923.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI am currently trying to understand the pickle problem... Using debug=True, I am getting more information (see below). The 10 problems look the same... I still don't know how to fix this...\n\nS\u00e9bastien\n\n```\nsage: std = os.environ['SAGE_DATA'] + '/extcode/pickle_jar/pickle_jar.tar.bz2'\nsage: sage.structure.sage_object.unpickle_all(std, debug=True)\n...\n[same thing as above]\n...\nSuccessfully unpickled 562 objects.\nFailed to unpickle 10 objects.\n\n[(<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbef502c>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbef5c84>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf006bc>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf005cc>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf00554>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf091bc>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf095f4>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf0966c>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf09b6c>),\n (<type 'exceptions.TypeError'>,\n  TypeError('__new__() takes at least 3 arguments (1 given)',),\n  <traceback object at 0xbf09c84>)]\n```",
    "created_at": "2009-07-17T19:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44923",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:12" align="right">comment:12</div>

I am currently trying to understand the pickle problem... Using debug=True, I am getting more information (see below). The 10 problems look the same... I still don't know how to fix this...

Sébastien

```
sage: std = os.environ['SAGE_DATA'] + '/extcode/pickle_jar/pickle_jar.tar.bz2'
sage: sage.structure.sage_object.unpickle_all(std, debug=True)
...
[same thing as above]
...
Successfully unpickled 562 objects.
Failed to unpickle 10 objects.

[(<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbef502c>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbef5c84>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf006bc>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf005cc>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf00554>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf091bc>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf095f4>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf0966c>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf09b6c>),
 (<type 'exceptions.TypeError'>,
  TypeError('__new__() takes at least 3 arguments (1 given)',),
  <traceback object at 0xbf09c84>)]
```



---

archive/issue_comments_044924.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@saliola](#comment%3A2):\n> **Partial Review:** I reviewed and documented Vincent's code, to which give a positive\n> review. I also reviewed S\u00e9bastien's code, which also gets a positive review.\n> \n> S\u00e9bastien, can you look over the changes that I made that you haven't yet\n> reviewed? I guess these are just the changes that I made this past week?\n\nI just looked at the changes that Franco made in the last week and I am giving a positive review to them. We now have to tackle the pickle problem described above.",
    "created_at": "2009-07-17T20:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44924",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@saliola](#comment%3A2):
> **Partial Review:** I reviewed and documented Vincent's code, to which give a positive
> review. I also reviewed Sébastien's code, which also gets a positive review.
> 
> Sébastien, can you look over the changes that I made that you haven't yet
> reviewed? I guess these are just the changes that I made this past week?

I just looked at the changes that Franco made in the last week and I am giving a positive review to them. We now have to tackle the pickle problem described above.



---

archive/issue_comments_044925.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI have a working patch right now. I am going to run a few more tests, and the post it.",
    "created_at": "2009-07-17T21:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44925",
    "user": "https://github.com/saliola"
}
```

<div id="comment:14" align="right">comment:14</div>

I have a working patch right now. I am going to run a few more tests, and the post it.



---

archive/issue_comments_044926.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe problem. The picklejar contains objects saved with older versions of\nSage, and since we changed a bunch of things, these older objects don't get\nloaded correctly.\n\nThe solution. The old word objects use the `WordContent` backend, which\nmy original patch completely removed (the new implementation is much\nbetter). So my fix was to restore the (`word_content.py` and\n`utils.py`); this way, an old-style word can be unpickled, and during\nthe unpickling, it gets converted to a new-style word, and the user is\ngiven a warning to re-save the word:\n\n```\nsage: load /tmp/foo\n...DeprecationWarning: Your word object is saved in an old file format since FiniteWord_over_OrderedAlphabet is deprecated and will be deleted in a future version of Sage (you can use FiniteWord_list instead). You can re-save your word by typing \"word.save(filename)\" to ensure that it will load in future versions of Sage.\nword: abbabaab\n```\nI also added a bunch of deprecation warnings to these files and to the\ndocumentation for these files. \n\nThis is a temporary fix: since the `WordContent` code is not necessary\nfor any other part of Sage, it will be deleted in a few months. In the\nmeantime, if there is anyone with some saved word objects, then unpickling\nwill work.",
    "created_at": "2009-07-17T21:49:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44926",
    "user": "https://github.com/saliola"
}
```

<div id="comment:15" align="right">comment:15</div>

The problem. The picklejar contains objects saved with older versions of
Sage, and since we changed a bunch of things, these older objects don't get
loaded correctly.

The solution. The old word objects use the `WordContent` backend, which
my original patch completely removed (the new implementation is much
better). So my fix was to restore the (`word_content.py` and
`utils.py`); this way, an old-style word can be unpickled, and during
the unpickling, it gets converted to a new-style word, and the user is
given a warning to re-save the word:

```
sage: load /tmp/foo
...DeprecationWarning: Your word object is saved in an old file format since FiniteWord_over_OrderedAlphabet is deprecated and will be deleted in a future version of Sage (you can use FiniteWord_list instead). You can re-save your word by typing "word.save(filename)" to ensure that it will load in future versions of Sage.
word: abbabaab
```
I also added a bunch of deprecation warnings to these files and to the
documentation for these files. 

This is a temporary fix: since the `WordContent` code is not necessary
for any other part of Sage, it will be deleted in a few months. In the
meantime, if there is anyone with some saved word objects, then unpickling
will work.



---

archive/issue_comments_044927.json:
```json
{
    "body": "(now with unpickle support for words save with older versions of Sage)",
    "created_at": "2009-07-17T21:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44927",
    "user": "https://github.com/saliola"
}
```

(now with unpickle support for words save with older versions of Sage)



---

archive/issue_comments_044928.json:
```json
{
    "body": "Attachment: **[trac_6519-words_ng.patch.gz](https://github.com/sagemath/sage/files/ticket6519/trac_6519-words_ng.patch.gz)**\n\nDO NOT APPLY!",
    "created_at": "2009-07-17T21:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44928",
    "user": "https://github.com/saliola"
}
```

Attachment: **[trac_6519-words_ng.patch.gz](https://github.com/sagemath/sage/files/ticket6519/trac_6519-words_ng.patch.gz)**

DO NOT APPLY!



---

archive/issue_comments_044929.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[old_pickle_support.patch.gz](https://github.com/sagemath/sage/files/ticket6519/old_pickle_support.patch.gz)**\n\nTo make reviewing my fix easier: I've attached the file\n`old_pickle_support.patch`, which contains only the changes that I made\nto address the pickle issue. This patch has already been folded into o\n`trac_6519-words_ng.patch`, so do not apply it.\n\nBesides restoring the files `word_content.py` and `utils.py` (and\nadding warnings), I needed to touch `word.py`, so this is where the\nreviewer needs to concentrate their attention.",
    "created_at": "2009-07-17T22:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44929",
    "user": "https://github.com/saliola"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[old_pickle_support.patch.gz](https://github.com/sagemath/sage/files/ticket6519/old_pickle_support.patch.gz)**

To make reviewing my fix easier: I've attached the file
`old_pickle_support.patch`, which contains only the changes that I made
to address the pickle issue. This patch has already been folded into o
`trac_6519-words_ng.patch`, so do not apply it.

Besides restoring the files `word_content.py` and `utils.py` (and
adding warnings), I needed to touch `word.py`, so this is where the
reviewer needs to concentrate their attention.



---

archive/issue_events_078245.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-17T22:02:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78245"
}
```



---

archive/issue_events_078246.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2009-07-17T22:02:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78246"
}
```



---

archive/issue_comments_044930.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI applied the latest `trac_6519-words_ng.patch` on a clean version of sage-4.1. The following now works :\n\n```\nslabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ sage -t  \"devel/sage/sage/structure/sage_object.pyx\"\nsage -t  \"devel/sage/sage/structure/sage_object.pyx\"        \n\t [4.9 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 4.9 seconds\n```\n\nI also run sage -t -long on all the sage tree and the only tests that failed are the following :\n\n```\nslabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ sage -t -long \"devel/sage-words_ng/sage/interfaces/r.py\"\nsage -t -long \"devel/sage-words_ng/sage/interfaces/r.py\"    \n**********************************************************************\nFile \"/home/slabbe/sage-4.1/devel/sage-words_ng/sage/interfaces/r.py\", line 549:\n    sage: r.library('foobar')\nExpected:\n    Traceback (most recent call last):\n    ...\n    ImportError: there is no package called 'foobar'\nGot nothing\n**********************************************************************\nFile \"/home/slabbe/sage-4.1/devel/sage-words_ng/sage/interfaces/r.py\", line 835:\n    sage: r.completions('tes')\nExpected:\n    ['testPlatformEquivalence', 'testVirtual']\nGot:\n    ['testPlatformEquivalence', 'testPlatformEquivalence', 'testVirtual', 'testVirtual']\n**********************************************************************\n2 items had failures:\n   1 of   5 in __main__.example_17\n   1 of   3 in __main__.example_34\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /home/slabbe/sage-4.1/tmp/.doctest_r.py\n\t [4.5 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -long \"devel/sage-words_ng/sage/interfaces/r.py\"\nTotal time for all tests: 4.5 seconds\nslabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ \n```\n\nbut those were also broken on my clean version of sage-4.1. Hence, I am giving a positive review to the changes made by Franco to solve the pickle problem.",
    "created_at": "2009-07-18T13:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44930",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:18" align="right">comment:18</div>

I applied the latest `trac_6519-words_ng.patch` on a clean version of sage-4.1. The following now works :

```
slabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ sage -t  "devel/sage/sage/structure/sage_object.pyx"
sage -t  "devel/sage/sage/structure/sage_object.pyx"        
	 [4.9 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.9 seconds
```

I also run sage -t -long on all the sage tree and the only tests that failed are the following :

```
slabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ sage -t -long "devel/sage-words_ng/sage/interfaces/r.py"
sage -t -long "devel/sage-words_ng/sage/interfaces/r.py"    
**********************************************************************
File "/home/slabbe/sage-4.1/devel/sage-words_ng/sage/interfaces/r.py", line 549:
    sage: r.library('foobar')
Expected:
    Traceback (most recent call last):
    ...
    ImportError: there is no package called 'foobar'
Got nothing
**********************************************************************
File "/home/slabbe/sage-4.1/devel/sage-words_ng/sage/interfaces/r.py", line 835:
    sage: r.completions('tes')
Expected:
    ['testPlatformEquivalence', 'testVirtual']
Got:
    ['testPlatformEquivalence', 'testPlatformEquivalence', 'testVirtual', 'testVirtual']
**********************************************************************
2 items had failures:
   1 of   5 in __main__.example_17
   1 of   3 in __main__.example_34
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/slabbe/sage-4.1/tmp/.doctest_r.py
	 [4.5 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -long "devel/sage-words_ng/sage/interfaces/r.py"
Total time for all tests: 4.5 seconds
slabbe@slabbe-laptop:~/sage-4.1/devel/sage-words_ng$ 
```

but those were also broken on my clean version of sage-4.1. Hence, I am giving a positive review to the changes made by Franco to solve the pickle problem.



---

archive/issue_events_078247.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-07-18T13:04:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78247"
}
```



---

archive/issue_events_078248.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-07-18T13:04:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78248"
}
```



---

archive/issue_comments_044931.json:
```json
{
    "body": "Changed reviewer from **Robert Miller** to **Robert Miller, S\u00e9bastien Labb\u00e9**",
    "created_at": "2009-07-18T13:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44931",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed reviewer from **Robert Miller** to **Robert Miller, Sébastien Labbé**



---

archive/issue_events_078249.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-18T14:07:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78249"
}
```



---

archive/issue_events_078250.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2009-07-18T14:07:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6519#event-78250"
}
```



---

archive/issue_comments_044932.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nMerged `trac_6519-words_ng.patch`.",
    "created_at": "2009-07-18T14:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44932",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:20" align="right">comment:20</div>

Merged `trac_6519-words_ng.patch`.



---

archive/issue_comments_044933.json:
```json
{
    "body": "Merged: **sage-4.1.1.alpha0**",
    "created_at": "2009-07-18T14:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6519",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6519#issuecomment-44933",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.1.1.alpha0**
