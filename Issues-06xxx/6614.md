# Issue 6614: Remove jsMath from version control in the Sage library.

archive/issues_006614.json:
```json
{
    "body": "After the merge of #5799, we have jsMath installed in two places: `$SAGE_ROOT/local/notebook/javascript` **and** `$SAGE_DOC/common/static`.  Moreover, all of jsMath is under version control in the Sage library.  However, the standard practice for Sage development is to keep most upstream spkg code out of Mercurial's reach.\n\nIn particular, we'll need to do unnecessary extra work when we upgrade to new upstream versions of jsMath or keep track of local customizations (cf. #4714).\n\n\n**CC:**  @rlmill\n\n**Author:** Mitesh Patel\n\n**Reviewer:** John Palmieri\n\n**Merged:** Sage 4.1.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6614\n\n",
    "closed_at": "2009-08-30T06:35:53Z",
    "created_at": "2009-07-24T14:50:30Z",
    "labels": [
        "component: documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "Remove jsMath from version control in the Sage library.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6614",
    "user": "https://github.com/qed777"
}
```
After the merge of #5799, we have jsMath installed in two places: `$SAGE_ROOT/local/notebook/javascript` **and** `$SAGE_DOC/common/static`.  Moreover, all of jsMath is under version control in the Sage library.  However, the standard practice for Sage development is to keep most upstream spkg code out of Mercurial's reach.

In particular, we'll need to do unnecessary extra work when we upgrade to new upstream versions of jsMath or keep track of local customizations (cf. #4714).


**CC:**  @rlmill

**Author:** Mitesh Patel

**Reviewer:** John Palmieri

**Merged:** Sage 4.1.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6614





---

archive/attachments_007883.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6614-distutils_symlinks.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6614/trac_6614-distutils_symlinks.patch",
    "created_at": "2009-07-24T15:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_061064.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis [attachment:trac_6614-distutils_symlinks.patch patch] alters `setup.py` so that distutils includes broken symbolic links as it builds a source distribution of the Sage library.  Is this appropriate?\n\nIf so, I can add another patch that replaces the `jsmath` directory in `$SAGE_DOC/common/static` with a symlink and updates the repository accordingly (i.e., reverses the patch mentioned [here](http://trac.sagemath.org/sage_trac/ticket/5799#comment:11)).\n\nOne caveat is that Python's [os](http://docs.python.org/library/os.html) module supports symbolic links only on Unix systems.  If we need to avoid links altogether, we could instead copy jsMath to multiple locations from its own `spkg-install` script.",
    "created_at": "2009-07-24T15:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61064",
    "user": "https://github.com/qed777"
}
```

<a id='comment:1'></a>
This [attachment:trac_6614-distutils_symlinks.patch patch] alters `setup.py` so that distutils includes broken symbolic links as it builds a source distribution of the Sage library.  Is this appropriate?

If so, I can add another patch that replaces the `jsmath` directory in `$SAGE_DOC/common/static` with a symlink and updates the repository accordingly (i.e., reverses the patch mentioned [here](http://trac.sagemath.org/sage_trac/ticket/5799#comment:11)).

One caveat is that Python's [os](http://docs.python.org/library/os.html) module supports symbolic links only on Unix systems.  If we need to avoid links altogether, we could instead copy jsMath to multiple locations from its own `spkg-install` script.



---

archive/issue_comments_061065.json:
```json
{
    "body": "<a id='comment:2'></a>\nShould we add the jsmath directory to devel/sage/.hgignore?",
    "created_at": "2009-07-24T17:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61065",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Should we add the jsmath directory to devel/sage/.hgignore?



---

archive/attachments_007884.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6614-jsmath_repo.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6614/trac_6614-jsmath_repo.patch",
    "created_at": "2009-07-25T12:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_061066.json:
```json
{
    "body": "Different approach.",
    "created_at": "2009-07-25T12:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61066",
    "user": "https://github.com/qed777"
}
```

Different approach.



---

archive/issue_comments_061067.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis [attachment:trac_6614-jsmath_repo.patch alternative patch] deletes `doc/common/static/jsmath` and adds jsMath to `doc/common/conf.py`'s list of `html_static_path`s.\n\nSince Sphinx recursively copies the only the contents of the static paths, jsMath no longer gets its own directory in `_static`.  I've changed `jsmath_path` to `'easy/load.js'`.\n\nIf we take this approach, then I should update the \"`new_scripts`\" patch at #6187.",
    "created_at": "2009-07-25T12:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61067",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>
This [attachment:trac_6614-jsmath_repo.patch alternative patch] deletes `doc/common/static/jsmath` and adds jsMath to `doc/common/conf.py`'s list of `html_static_path`s.

Since Sphinx recursively copies the only the contents of the static paths, jsMath no longer gets its own directory in `_static`.  I've changed `jsmath_path` to `'easy/load.js'`.

If we take this approach, then I should update the "`new_scripts`" patch at #6187.



---

archive/issue_comments_061068.json:
```json
{
    "body": "New version that puts jsMath path first.",
    "created_at": "2009-08-02T18:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61068",
    "user": "https://github.com/qed777"
}
```

New version that puts jsMath path first.



---

archive/issue_comments_061069.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-08-02T19:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61069",
    "user": "https://github.com/qed777"
}
```

**Changing status** from new to needs_review.



---

archive/attachments_007885.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6614-jsmath_repo_v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6614/trac_6614-jsmath_repo_v2.patch",
    "created_at": "2009-08-02T19:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_061070.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe new version *prepends* jsMath's path to `html_static_path`, so that custom files copied subsequently from, e.g., `doc/common/static`,  can override certain settings, at our option.\n\nThe same caveats apply.",
    "created_at": "2009-08-02T19:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61070",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>
The new version *prepends* jsMath's path to `html_static_path`, so that custom files copied subsequently from, e.g., `doc/common/static`,  can override certain settings, at our option.

The same caveats apply.



---

archive/issue_comments_061071.json:
```json
{
    "body": "<a id='comment:5'></a>\nAn aside on Firefox's security policy:\n\n* Build the reference manual with `--jsmath`.\n* Browse to the table of contents in FF 3.5.\n* Open \"The Steenrod algebra\", say, in a new background tab by middle-clicking (or the equivalent).\n* Switch to the new tab.  Did jsMath process the page?  Not for me.\n* Switch back to the ToC tab and browse directly to the same topic.  Did jsMath process the page?  Yes for me.\n\nI've tested this only on Linux.  Opera and Chromium don't behave this way, so I don't think it's [entirely] jsMath's fault.\n\nIn any case, this happens whether or not I apply the patch above.",
    "created_at": "2009-08-02T19:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61071",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>
An aside on Firefox's security policy:

* Build the reference manual with `--jsmath`.
* Browse to the table of contents in FF 3.5.
* Open "The Steenrod algebra", say, in a new background tab by middle-clicking (or the equivalent).
* Switch to the new tab.  Did jsMath process the page?  Not for me.
* Switch back to the ToC tab and browse directly to the same topic.  Did jsMath process the page?  Yes for me.

I've tested this only on Linux.  Opera and Chromium don't behave this way, so I don't think it's [entirely] jsMath's fault.

In any case, this happens whether or not I apply the patch above.



---

archive/issue_comments_061072.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mpatel](#comment%3A3):\n> This [attachment:trac_6614-jsmath_repo.patch alternative patch] deletes `doc/common/static/jsmath` and adds jsMath to `doc/common/conf.py`'s list of `html_static_path`s.\n\nIt may be necessary to delete `doc/common/static/jsmath` manually, after applying the patch.",
    "created_at": "2009-08-03T18:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61072",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>
Replying to [mpatel](#comment%3A3):
> This [attachment:trac_6614-jsmath_repo.patch alternative patch] deletes `doc/common/static/jsmath` and adds jsMath to `doc/common/conf.py`'s list of `html_static_path`s.

It may be necessary to delete `doc/common/static/jsmath` manually, after applying the patch.



---

archive/issue_events_019501.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2009-08-20T21:21:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "milestone": "sage-4.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6614#event-19501"
}
```



---

archive/issue_comments_061073.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2009-08-20T21:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61073",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_061074.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2009-08-20T21:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61074",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** Mitesh Patel



---

archive/issue_comments_061075.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mpatel](#comment%3A3):\n> Since Sphinx recursively copies the only the contents of the static paths, jsMath no longer gets its own directory in `_static`.  I've changed `jsmath_path` to `'easy/load.js'`.\n\n\nAlso, since the jsMath files all begin with \"jsMath\", we don't have to worry about name clashes (except, I suppose, the names of the subdirectories of jsMath, but I hope this won't be an issue).\n\nAnyway, it looks good to me.  I did manually delete `doc/common/static/jsmath`, and the documentation build correctly, with or without the \"--jsmath\" switch, and jsMath was active when reading docs off-line and on.  The patch is large, but almost all of it consists of deleting files in `doc/common/static/jsmath`; the only \"interesting\" part is at the very beginning, the changes to `conf.py`.  The changes there look good, both the new stuff and tidying up the old stuff (using `os.path.join` instead of \"+\", for example).\n\nI hope I'm not missing anything, but I think it gets a positive review.  Apply only [trac_6614-jsmath_repo_v2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/6614/trac_6614-jsmath_repo_v2.patch).",
    "created_at": "2009-08-20T21:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61075",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Replying to [mpatel](#comment%3A3):
> Since Sphinx recursively copies the only the contents of the static paths, jsMath no longer gets its own directory in `_static`.  I've changed `jsmath_path` to `'easy/load.js'`.


Also, since the jsMath files all begin with "jsMath", we don't have to worry about name clashes (except, I suppose, the names of the subdirectories of jsMath, but I hope this won't be an issue).

Anyway, it looks good to me.  I did manually delete `doc/common/static/jsmath`, and the documentation build correctly, with or without the "--jsmath" switch, and jsMath was active when reading docs off-line and on.  The patch is large, but almost all of it consists of deleting files in `doc/common/static/jsmath`; the only "interesting" part is at the very beginning, the changes to `conf.py`.  The changes there look good, both the new stuff and tidying up the old stuff (using `os.path.join` instead of "+", for example).

I hope I'm not missing anything, but I think it gets a positive review.  Apply only [trac_6614-jsmath_repo_v2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/6614/trac_6614-jsmath_repo_v2.patch).



---

archive/issue_comments_061076.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2009-08-20T21:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61076",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_061077.json:
```json
{
    "body": "<a id='comment:8'></a>\nI left alone the following line in `MANIFEST.in`\n\n```\nrecursive-include doc/common/static *\n```\nI assume this is OK, although it's somewhat more than we need just now.",
    "created_at": "2009-08-22T13:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61077",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
I left alone the following line in `MANIFEST.in`

```
recursive-include doc/common/static *
```
I assume this is OK, although it's somewhat more than we need just now.



---

archive/issue_comments_061078.json:
```json
{
    "body": "<a id='comment:9'></a>\nYes, I noticed that and decided it was okay to leave it.",
    "created_at": "2009-08-22T14:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61078",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Yes, I noticed that and decided it was okay to leave it.



---

archive/issue_comments_061079.json:
```json
{
    "body": "**Merged:** Sage 4.1.2.alpha0",
    "created_at": "2009-08-30T06:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61079",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** Sage 4.1.2.alpha0



---

archive/issue_events_019502.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-08-30T06:35:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6614#event-19502"
}
```



---

archive/issue_comments_061080.json:
```json
{
    "body": "<a id='comment:10'></a>\nFor Sage 4.1.1 with `trac_6614-jsmath_repo_v2.patch`, reference manual built with `./sage -docbuild --jsmath reference html`:\n\n* jsMath can't handle Sage's customized LaTeX macros for common rings such such `\\RR` for the reals, `\\ZZ` for the integers, `\\QQ` for the rationals, `\\CC` for complex numbers, and `\\GF(p)` for the finite field of `p` elements. See this screenshot.\n \n* At least with Firefox 3.5.2, jsMath doesn't render LaTeX-typeset maths expressions very well. See this screenshot.\n\nThese two issues are not specific to the patch. The same things happen without `trac_6614-jsmath_repo_v2.patch` being applied to Sage 4.1.1.\n\n\n\nMerged only `trac_6614-jsmath_repo_v2.patch`.",
    "created_at": "2009-08-30T06:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61080",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:10'></a>
For Sage 4.1.1 with `trac_6614-jsmath_repo_v2.patch`, reference manual built with `./sage -docbuild --jsmath reference html`:

* jsMath can't handle Sage's customized LaTeX macros for common rings such such `\RR` for the reals, `\ZZ` for the integers, `\QQ` for the rationals, `\CC` for complex numbers, and `\GF(p)` for the finite field of `p` elements. See this screenshot.
 
* At least with Firefox 3.5.2, jsMath doesn't render LaTeX-typeset maths expressions very well. See this screenshot.

These two issues are not specific to the patch. The same things happen without `trac_6614-jsmath_repo_v2.patch` being applied to Sage 4.1.1.



Merged only `trac_6614-jsmath_repo_v2.patch`.



---

archive/issue_comments_061081.json:
```json
{
    "body": "<a id='comment:11'></a>\nI also manually deleted the directory `doc/common/static/jsmath`.",
    "created_at": "2009-08-30T06:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61081",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:11'></a>
I also manually deleted the directory `doc/common/static/jsmath`.



---

archive/issue_comments_061082.json:
```json
{
    "body": "<a id='comment:12'></a>\nWe're working on Sage-specific jsMath customizations for the documentation at #6673.  \n\nThe screenshots appear to be missing, at least for me.\n\nFrom the [changelog](http://www.math.union.edu/~dpvc/jsMath/changes.html) for jsMath 3.6c:\n\n```\n* Worked around another problem with Firefox 3.5's single-origin policy for\n  local files that would cause jsMath not to be able to load external\n  components.\n```\nThis may address the \"aside\" above, unless it's besides the aside's point.",
    "created_at": "2009-08-30T07:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61082",
    "user": "https://github.com/qed777"
}
```

<a id='comment:12'></a>
We're working on Sage-specific jsMath customizations for the documentation at #6673.  

The screenshots appear to be missing, at least for me.

From the [changelog](http://www.math.union.edu/~dpvc/jsMath/changes.html) for jsMath 3.6c:

```
* Worked around another problem with Firefox 3.5's single-origin policy for
  local files that would cause jsMath not to be able to load external
  components.
```
This may address the "aside" above, unless it's besides the aside's point.



---

archive/issue_comments_061083.json:
```json
{
    "body": "<a id='comment:13'></a>\nI forgot to add links to the screenshots. See [this](http://sage.math.washington.edu/home/mvngu/patch/screenshots/sage-4.1.1-with-trac-6614-custom-latex.png) for the customized LaTeX macros, and [this](http://sage.math.washington.edu/home/mvngu/patch/screenshots/sage-4.1.1-with-trac-6614-jsmath.png) for jsMath issues with Firefox 3.5.2.",
    "created_at": "2009-08-30T08:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61083",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:13'></a>
I forgot to add links to the screenshots. See [this](http://sage.math.washington.edu/home/mvngu/patch/screenshots/sage-4.1.1-with-trac-6614-custom-latex.png) for the customized LaTeX macros, and [this](http://sage.math.washington.edu/home/mvngu/patch/screenshots/sage-4.1.1-with-trac-6614-jsmath.png) for jsMath issues with Firefox 3.5.2.



---

archive/issue_comments_061084.json:
```json
{
    "body": "<a id='comment:14'></a>\n#6673 should help with the macros, but please let us know if we've missed any.\n\nOn the other problem: If Firefox is running on Linux, are the [updated fonts](http://www.math.union.edu/~dpvc/jsMath/download/jsMath-fonts.html) installed?",
    "created_at": "2009-08-30T09:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6614#issuecomment-61084",
    "user": "https://github.com/qed777"
}
```

<a id='comment:14'></a>
#6673 should help with the macros, but please let us know if we've missed any.

On the other problem: If Firefox is running on Linux, are the [updated fonts](http://www.math.union.edu/~dpvc/jsMath/download/jsMath-fonts.html) installed?
