# Issue 6179: html -- doctest failure in sage-4.0.1.alpha0

archive/issues_006179.json:
```json
{
    "assignees": [],
    "body": "We have the following on 32-bit OS X Intel:\n\n```\nsage -t -long \"devel/sage/sage/misc/html.py\"\n**********************************************************************\nFile \"/Users/was/build/sage-4.0.1.alpha0/devel/sage/sage/misc/html.py\", line 157:\n    sage: html.table([(i, j, i == j) for i in [0..1] for j in [0..1]])\nExpected:\n    <html>\n    <div class=\"notruncate\">\n    <table class=\"table_form\">\n    <tbody>\n    <tr class =\"row-a\">\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">True</span></td>\n    </tr>\n    <tr class =\"row-b\">\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">False</span></td>\n    </tr>\n    <tr class =\"row-a\">\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">False</span></td>\n    </tr>\n    <tr class =\"row-b\">\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">True</span></td>\n    </tr>  \n    </tbody>\n    </table>\n    </div>\n    </html>\nGot:\n    <html>\n    <div class=\"notruncate\">\n    <table class=\"table_form\">\n    <tbody>\n    <tr class =\"row-a\">\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">\\mbox{\\rm True}</span></td>\n    </tr>\n    <tr class =\"row-b\">\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">\\mbox{\\rm False}</span></td>\n    </tr>\n    <tr class =\"row-a\">\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">0</span></td>\n    <td><span class=\"math\">\\mbox{\\rm False}</span></td>\n    </tr>\n    <tr class =\"row-b\">\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">1</span></td>\n    <td><span class=\"math\">\\mbox{\\rm True}</span></td>\n    </tr>\n    </tbody>\n    </table>\n    </div>\n    </html>\n**********************************************************************\n1 items had failures:\n\n```\n\nAssignee: **@mwhansen**\n\nAuthor: **John Palmieri**\n\nReviewer: **Mike Hansen**\n\nMerged: **4.0.1.rc3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6179_\n\n",
    "closed_at": "2009-06-06T00:09:55Z",
    "created_at": "2009-06-01T14:37:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/doctest%20coverage",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.0.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "html -- doctest failure in sage-4.0.1.alpha0",
    "type": "issue",
    "updated_at": "2009-06-06T20:40:58Z",
    "url": "https://github.com/sagemath/sage/issues/6179",
    "user": "https://github.com/williamstein"
}
```
We have the following on 32-bit OS X Intel:

```
sage -t -long "devel/sage/sage/misc/html.py"
**********************************************************************
File "/Users/was/build/sage-4.0.1.alpha0/devel/sage/sage/misc/html.py", line 157:
    sage: html.table([(i, j, i == j) for i in [0..1] for j in [0..1]])
Expected:
    <html>
    <div class="notruncate">
    <table class="table_form">
    <tbody>
    <tr class ="row-a">
    <td><span class="math">0</span></td>
    <td><span class="math">0</span></td>
    <td><span class="math">True</span></td>
    </tr>
    <tr class ="row-b">
    <td><span class="math">0</span></td>
    <td><span class="math">1</span></td>
    <td><span class="math">False</span></td>
    </tr>
    <tr class ="row-a">
    <td><span class="math">1</span></td>
    <td><span class="math">0</span></td>
    <td><span class="math">False</span></td>
    </tr>
    <tr class ="row-b">
    <td><span class="math">1</span></td>
    <td><span class="math">1</span></td>
    <td><span class="math">True</span></td>
    </tr>  
    </tbody>
    </table>
    </div>
    </html>
Got:
    <html>
    <div class="notruncate">
    <table class="table_form">
    <tbody>
    <tr class ="row-a">
    <td><span class="math">0</span></td>
    <td><span class="math">0</span></td>
    <td><span class="math">\mbox{\rm True}</span></td>
    </tr>
    <tr class ="row-b">
    <td><span class="math">0</span></td>
    <td><span class="math">1</span></td>
    <td><span class="math">\mbox{\rm False}</span></td>
    </tr>
    <tr class ="row-a">
    <td><span class="math">1</span></td>
    <td><span class="math">0</span></td>
    <td><span class="math">\mbox{\rm False}</span></td>
    </tr>
    <tr class ="row-b">
    <td><span class="math">1</span></td>
    <td><span class="math">1</span></td>
    <td><span class="math">\mbox{\rm True}</span></td>
    </tr>
    </tbody>
    </table>
    </div>
    </html>
**********************************************************************
1 items had failures:

```

Assignee: **@mwhansen**

Author: **John Palmieri**

Reviewer: **Mike Hansen**

Merged: **4.0.1.rc3**

_Issue created by migration from https://trac.sagemath.org/ticket/6179_





---

archive/issue_events_064946.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-06-01T14:37:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64946"
}
```



---

archive/issue_events_064947.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-06-01T14:37:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64947"
}
```



---

archive/issue_events_064948.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-06-01T14:37:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64948"
}
```



---

archive/issue_events_064949.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-06-01T14:37:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64949"
}
```



---

archive/issue_comments_042284.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNOTE: The expected values are *wrong*.  Math typesetting of bools should use \\mbox{\\rm ...}.",
    "created_at": "2009-06-04T00:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42284",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'>Comment 1:</a>
NOTE: The expected values are *wrong*.  Math typesetting of bools should use \mbox{\rm ...}.



---

archive/issue_comments_042285.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nOn my 32-bit Debian with sage-4.0.1.alpha0:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.0.1.alpha0, Release Date: 2009-05-31                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: latex(True)\nTrue\nsage: latex(False)\nFalse\n```\n\nand also:\n\n```\n$ ./sage -t devel/sage/sage/misc/html.py\nsage -t  \"devel/sage/sage/misc/html.py\"\n         [1.1 s]\n\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.1 seconds\n```",
    "created_at": "2009-06-04T08:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42285",
    "user": "https://github.com/sagetrac-whuss"
}
```

<a id='comment:2'>Comment 2:</a>
On my 32-bit Debian with sage-4.0.1.alpha0:

```
----------------------------------------------------------------------
| Sage Version 4.0.1.alpha0, Release Date: 2009-05-31                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: latex(True)
True
sage: latex(False)
False
```

and also:

```
$ ./sage -t devel/sage/sage/misc/html.py
sage -t  "devel/sage/sage/misc/html.py"
         [1.1 s]

----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.1 seconds
```



---

archive/issue_comments_042286.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nAttachment: **[trac_6179.patch.gz](https://github.com/sagemath/sage/files/ticket6179/trac_6179.patch.gz)**\n\nThis issue is that\n\n```\nsage: isinstance(True, int)\nTrue\nsage: isinstance(True, bool)\nTrue\nsage: isinstance(1, bool)\nFalse\n```\n\nso the output depended on the order in which items of the latex_table dict were iterated.  This is fixed by changing latex_table to a list so that bool comes first.",
    "created_at": "2009-06-05T21:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42286",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'>Comment 3:</a>
Attachment: **[trac_6179.patch.gz](https://github.com/sagemath/sage/files/ticket6179/trac_6179.patch.gz)**

This issue is that

```
sage: isinstance(True, int)
True
sage: isinstance(True, bool)
True
sage: isinstance(1, bool)
False
```

so the output depended on the order in which items of the latex_table dict were iterated.  This is fixed by changing latex_table to a list so that bool comes first.



---

archive/issue_comments_042287.json:
```json
{
    "body": "Assignee: **@mwhansen**",
    "created_at": "2009-06-05T21:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42287",
    "user": "https://github.com/mwhansen"
}
```

Assignee: **@mwhansen**



---

archive/issue_events_064950.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-05T21:21:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64950"
}
```



---

archive/issue_comments_042288.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nHere's another possible fix for the latex_table issue:\n\n``` \n        try:\n            f = latex_table[type(x)]\n            return LatexExpr(f(x))\n        except KeyError:\n            if x is None:\n                return LatexExpr(\"\\\\mbox{\\\\mathrm{None}}\")\n            return LatexExpr(str_function(str(x)))\n```\nSince `type(True)` returns `bool`, this looks up the right thing.  Is this approach better or worse than the one in your patch?  \n\nThe try/except approach helps to avoid accidental lookups in the table, but were those being used intentionally for anything?  For example, does `isinstance(blah, int)` return True for other classes that we care about for typesetting?  I tend to think that we should be more explicit rather than implicit (so add more entries `new-type: str` if we want more types to behave the way ints do), so I would favor the dictionary lookup approach.  I could be convinced otherwise, though.",
    "created_at": "2009-06-05T21:57:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42288",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>Comment 4:</a>
Here's another possible fix for the latex_table issue:

``` 
        try:
            f = latex_table[type(x)]
            return LatexExpr(f(x))
        except KeyError:
            if x is None:
                return LatexExpr("\\mbox{\\mathrm{None}}")
            return LatexExpr(str_function(str(x)))
```
Since `type(True)` returns `bool`, this looks up the right thing.  Is this approach better or worse than the one in your patch?  

The try/except approach helps to avoid accidental lookups in the table, but were those being used intentionally for anything?  For example, does `isinstance(blah, int)` return True for other classes that we care about for typesetting?  I tend to think that we should be more explicit rather than implicit (so add more entries `new-type: str` if we want more types to behave the way ints do), so I would favor the dictionary lookup approach.  I could be convinced otherwise, though.



---

archive/issue_comments_042289.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI have no strong feelings on this; your patch is a tad more efficient, but none of this is really time critical. The latex_table should really only be used for builtin types though; anything else would be coupling things too much.",
    "created_at": "2009-06-05T22:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42289",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'>Comment 5:</a>
I have no strong feelings on this; your patch is a tad more efficient, but none of this is really time critical. The latex_table should really only be used for builtin types though; anything else would be coupling things too much.



---

archive/issue_comments_042290.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI don't care about the efficiency, but I like that my patch is less ambiguous: with yours, if some unexpected type returns True for `isinstance(blah, int)`, then the latex could get screwed up.  It also depends on the ordering in the table.  My change was already in a patch (\"needs work\") for #6089, and in that patch it also gets used when constructing jsmath expressions.  So if you don't have a strong preference, I'll post my version of the patch here.\n\nThis includes your changes to html.py and your new doctest in latex.py, which I give a positive review to.",
    "created_at": "2009-06-05T22:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42290",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'>Comment 6:</a>
I don't care about the efficiency, but I like that my patch is less ambiguous: with yours, if some unexpected type returns True for `isinstance(blah, int)`, then the latex could get screwed up.  It also depends on the ordering in the table.  My change was already in a patch ("needs work") for #6089, and in that patch it also gets used when constructing jsmath expressions.  So if you don't have a strong preference, I'll post my version of the patch here.

This includes your changes to html.py and your new doctest in latex.py, which I give a positive review to.



---

archive/issue_comments_042291.json:
```json
{
    "body": "apply only this patch",
    "created_at": "2009-06-05T22:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42291",
    "user": "https://github.com/jhpalmieri"
}
```

apply only this patch



---

archive/issue_events_064951.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-05T22:23:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64951"
}
```



---

archive/issue_events_064952.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-05T22:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64952"
}
```



---

archive/issue_comments_042292.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nAttachment: **[trac_6179_version2.patch.gz](https://github.com/sagemath/sage/files/ticket6179/trac_6179_version2.patch.gz)**\n\nLooks good to me.",
    "created_at": "2009-06-05T22:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42292",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:7'>Comment 7:</a>
Attachment: **[trac_6179_version2.patch.gz](https://github.com/sagemath/sage/files/ticket6179/trac_6179_version2.patch.gz)**

Looks good to me.



---

archive/issue_events_064953.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-06T00:09:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64953"
}
```



---

archive/issue_events_064954.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-06T00:09:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6179#event-64954"
}
```



---

archive/issue_comments_042293.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nMerged in 4.0.1.rc3.",
    "created_at": "2009-06-06T00:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42293",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:8'>Comment 8:</a>
Merged in 4.0.1.rc3.



---

archive/issue_comments_042294.json:
```json
{
    "body": "Merged: **4.0.1.rc3**",
    "created_at": "2009-06-06T20:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42294",
    "user": "https://github.com/mwhansen"
}
```

Merged: **4.0.1.rc3**



---

archive/issue_comments_042295.json:
```json
{
    "body": "Reviewer: **Mike Hansen**",
    "created_at": "2009-06-06T20:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42295",
    "user": "https://github.com/mwhansen"
}
```

Reviewer: **Mike Hansen**



---

archive/issue_comments_042296.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2009-06-06T20:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6179#issuecomment-42296",
    "user": "https://github.com/mwhansen"
}
```

Author: **John Palmieri**
