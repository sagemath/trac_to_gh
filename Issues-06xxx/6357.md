# Issue 6357: make sage -t worksheet.sws work

archive/issues_006357.json:
```json
{
    "body": "This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.\n\nAlso, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. \n\nSeparate, but also nice, would be \"worksheet-ify\" command that took a series of doctests and made a nice worksheet out of it.\n\nAssignee: tbd\n\nCC:  @kini @novoselt\n\nKeywords: doctest sws notebook worksheet test\n\nReviewer: Andrey Novoseltsev, Fr\u00e9d\u00e9ric Chapoton\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/6357\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2009-06-18T17:05:01Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "make sage -t worksheet.sws work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6357",
    "user": "https://github.com/ncalexan"
}
```
This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.

Also, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. 

Separate, but also nice, would be "worksheet-ify" command that took a series of doctests and made a nice worksheet out of it.

Assignee: tbd

CC:  @kini @novoselt

Keywords: doctest sws notebook worksheet test

Reviewer: Andrey Novoseltsev, Frédéric Chapoton

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/6357





---

archive/issue_comments_050737.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2009-06-18T17:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50737",
    "user": "https://github.com/ncalexan"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_050738.json:
```json
{
    "body": "<a id='comment:2'></a>(NOTE -- I rethought this in the last paragraph below, but didn't delete the stuff above, in case it is useful still.)\n\nHow I would implement this:\n\n```\n sage -t foo.sws\n```\nwould\n\n1. extract foo.sws into a temporary directory.  Try to use builtin library calls instead of calling tar on the command line, if possible.  Note that foo.sws is a .tar.bz2\n\n2. Ignore everything not in {{}}'s.  I'm using {{ instead of triple {'s to avoid trac's wiki preformat mode.\n\n3. Create a file foo.py.  For each chunk of code \n\n```\n{{\ninput lines\n///\noutput lines\n```\ninsert into the file foo.py lines:\n\n```\nsage: sage.server.notebook.cell.eval_for_testing(r\"\"\"input lines\ninput lines...\"\"\")\noutput lines\n```\nsince I think how the notebook works is best simulated by using the sage0 pexpect interface (that's what the notebook really uses).  \n\n4. Doctest foo.py using `sage -t foo.py` and let normal doctest report the results.  Possibly postprocess the `print sage0.eval(r\"\"\"` wrapper crap out of the result.\n\n\nThe above plan has the advantage that it reduces things to the existing python doctest framework instead of trying to write another doctest system.   One disadvantage is that using sage0 means that two Python processes are spawned instead of 1.\n\nThe function `sage.server.notebook.cell.eval_for_testing` has not been written.  It would make a blank directory, call sage0.eval -- just like the notebook does -- then apply all transformations the notebook does on output.  \n\nActually, writing the above makes me think that this problem is harder than I thought when I started writing this comment!  The problem is the output is potentially very complicated, since it can be a bunch of sagexxx.png files, html, etc.   Maybe a better approach is to completely use the notebook codebase -- as is done in all the notebook doctesting -- to run a *copy* of the whole worksheet (a sort of evaluate all) -- then simply compare the original's output to the copy's.",
    "created_at": "2009-06-18T19:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50738",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>(NOTE -- I rethought this in the last paragraph below, but didn't delete the stuff above, in case it is useful still.)

How I would implement this:

```
 sage -t foo.sws
```
would

1. extract foo.sws into a temporary directory.  Try to use builtin library calls instead of calling tar on the command line, if possible.  Note that foo.sws is a .tar.bz2

2. Ignore everything not in {{}}'s.  I'm using {{ instead of triple {'s to avoid trac's wiki preformat mode.

3. Create a file foo.py.  For each chunk of code 

```
{{
input lines
///
output lines
```
insert into the file foo.py lines:

```
sage: sage.server.notebook.cell.eval_for_testing(r"""input lines
input lines...""")
output lines
```
since I think how the notebook works is best simulated by using the sage0 pexpect interface (that's what the notebook really uses).  

4. Doctest foo.py using `sage -t foo.py` and let normal doctest report the results.  Possibly postprocess the `print sage0.eval(r"""` wrapper crap out of the result.


The above plan has the advantage that it reduces things to the existing python doctest framework instead of trying to write another doctest system.   One disadvantage is that using sage0 means that two Python processes are spawned instead of 1.

The function `sage.server.notebook.cell.eval_for_testing` has not been written.  It would make a blank directory, call sage0.eval -- just like the notebook does -- then apply all transformations the notebook does on output.  

Actually, writing the above makes me think that this problem is harder than I thought when I started writing this comment!  The problem is the output is potentially very complicated, since it can be a bunch of sagexxx.png files, html, etc.   Maybe a better approach is to completely use the notebook codebase -- as is done in all the notebook doctesting -- to run a *copy* of the whole worksheet (a sort of evaluate all) -- then simply compare the original's output to the copy's.



---

archive/issue_comments_050739.json:
```json
{
    "body": "Changing keywords from \"sage test worksheet doctest\" to \"doctest sws notebook worksheet test\".",
    "created_at": "2011-11-03T00:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50739",
    "user": "https://github.com/kini"
}
```

Changing keywords from "sage test worksheet doctest" to "doctest sws notebook worksheet test".



---

archive/issue_comments_050740.json:
```json
{
    "body": "<a id='comment:6'></a>After #12415, this just needs to add a parser for .sws files in `sage.doctest.sources` analogous to `PythonSource`, `RestSource` and `TexSource`.",
    "created_at": "2013-03-14T21:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50740",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>After #12415, this just needs to add a parser for .sws files in `sage.doctest.sources` analogous to `PythonSource`, `RestSource` and `TexSource`.



---

archive/issue_comments_050741.json:
```json
{
    "body": "Changing component from doctest to doctest framework.",
    "created_at": "2013-03-28T22:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50741",
    "user": "https://github.com/roed314"
}
```

Changing component from doctest to doctest framework.



---

archive/issue_events_014955.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-02T22:48:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6357#event-14955"
}
```



---

archive/issue_comments_050742.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-02T22:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50742",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_050743.json:
```json
{
    "body": "<a id='comment:8'></a>With no progress on it and with sws planned for retirement together with SageNB, I think we should close it.",
    "created_at": "2017-01-02T22:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50743",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>With no progress on it and with sws planned for retirement together with SageNB, I think we should close it.



---

archive/issue_comments_050744.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-05T16:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50744",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_050745.json:
```json
{
    "body": "<a id='comment:9'></a>yes, let us close that",
    "created_at": "2017-01-05T16:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50745",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>yes, let us close that



---

archive/issue_comments_050746.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-21T18:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6357#issuecomment-50746",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid



---

archive/issue_events_014956.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6357",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6357#event-14956"
}
```
