# Issue 6357: make sage -t worksheet.sws work

archive/issues_006357.json:
```json
{
    "assignees": [],
    "body": "This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.\n\nAlso, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. \n\nSeparate, but also nice, would be \"worksheet-ify\" command that took a series of doctests and made a nice worksheet out of it.\n\nCC:  @kini @novoselt\n\nKeywords: **doctest sws notebook worksheet test**\n\nReviewer: **Andrey Novoseltsev, Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6357_\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2009-06-18T17:05:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "make sage -t worksheet.sws work",
    "type": "issue",
    "updated_at": "2017-01-21T18:03:11Z",
    "url": "https://github.com/sagemath/sage/issues/6357",
    "user": "https://github.com/ncalexan"
}
```
This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.

Also, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. 

Separate, but also nice, would be "worksheet-ify" command that took a series of doctests and made a nice worksheet out of it.

CC:  @kini @novoselt

Keywords: **doctest sws notebook worksheet test**

Reviewer: **Andrey Novoseltsev, Frédéric Chapoton**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/6357_





---

archive/issue_events_076486.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76486"
}
```



---

archive/issue_events_076487.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76487"
}
```



---

archive/issue_events_076488.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76488"
}
```



---

archive/issue_events_076489.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76489"
}
```



---

archive/issue_events_076490.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76490"
}
```



---

archive/issue_events_076491.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-18T17:05:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76491"
}
```



---

archive/issue_comments_042515.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n(NOTE -- I rethought this in the last paragraph below, but didn't delete the stuff above, in case it is useful still.)\n\nHow I would implement this:\n\n```\n sage -t foo.sws\n```\nwould\n\n1. extract foo.sws into a temporary directory.  Try to use builtin library calls instead of calling tar on the command line, if possible.  Note that foo.sws is a .tar.bz2\n\n2. Ignore everything not in {{}}'s.  I'm using {{ instead of triple {'s to avoid trac's wiki preformat mode.\n\n3. Create a file foo.py.  For each chunk of code \n\n```\n{{\ninput lines\n///\noutput lines\n```\ninsert into the file foo.py lines:\n\n```\nsage: sage.server.notebook.cell.eval_for_testing(r\"\"\"input lines\ninput lines...\"\"\")\noutput lines\n```\nsince I think how the notebook works is best simulated by using the sage0 pexpect interface (that's what the notebook really uses).  \n\n4. Doctest foo.py using `sage -t foo.py` and let normal doctest report the results.  Possibly postprocess the `print sage0.eval(r\"\"\"` wrapper crap out of the result.\n\n\nThe above plan has the advantage that it reduces things to the existing python doctest framework instead of trying to write another doctest system.   One disadvantage is that using sage0 means that two Python processes are spawned instead of 1.\n\nThe function `sage.server.notebook.cell.eval_for_testing` has not been written.  It would make a blank directory, call sage0.eval -- just like the notebook does -- then apply all transformations the notebook does on output.  \n\nActually, writing the above makes me think that this problem is harder than I thought when I started writing this comment!  The problem is the output is potentially very complicated, since it can be a bunch of sagexxx.png files, html, etc.   Maybe a better approach is to completely use the notebook codebase -- as is done in all the notebook doctesting -- to run a *copy* of the whole worksheet (a sort of evaluate all) -- then simply compare the original's output to the copy's.",
    "created_at": "2009-06-18T19:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42515",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">comment:2</div>

(NOTE -- I rethought this in the last paragraph below, but didn't delete the stuff above, in case it is useful still.)

How I would implement this:

```
 sage -t foo.sws
```
would

1. extract foo.sws into a temporary directory.  Try to use builtin library calls instead of calling tar on the command line, if possible.  Note that foo.sws is a .tar.bz2

2. Ignore everything not in {{}}'s.  I'm using {{ instead of triple {'s to avoid trac's wiki preformat mode.

3. Create a file foo.py.  For each chunk of code 

```
{{
input lines
///
output lines
```
insert into the file foo.py lines:

```
sage: sage.server.notebook.cell.eval_for_testing(r"""input lines
input lines...""")
output lines
```
since I think how the notebook works is best simulated by using the sage0 pexpect interface (that's what the notebook really uses).  

4. Doctest foo.py using `sage -t foo.py` and let normal doctest report the results.  Possibly postprocess the `print sage0.eval(r"""` wrapper crap out of the result.


The above plan has the advantage that it reduces things to the existing python doctest framework instead of trying to write another doctest system.   One disadvantage is that using sage0 means that two Python processes are spawned instead of 1.

The function `sage.server.notebook.cell.eval_for_testing` has not been written.  It would make a blank directory, call sage0.eval -- just like the notebook does -- then apply all transformations the notebook does on output.  

Actually, writing the above makes me think that this problem is harder than I thought when I started writing this comment!  The problem is the output is potentially very complicated, since it can be a bunch of sagexxx.png files, html, etc.   Maybe a better approach is to completely use the notebook codebase -- as is done in all the notebook doctesting -- to run a *copy* of the whole worksheet (a sort of evaluate all) -- then simply compare the original's output to the copy's.



---

archive/issue_comments_042516.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.\n \n+Also, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. \n+\n Separate, but also nice, would be \"worksheet-ify\" command that took a series of doctests and made a nice worksheet out of it.\n``````\n",
    "created_at": "2009-06-18T19:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42516",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 This came up on the mailing list: it would be nice if sage -t worksheet.sws worked.
 
+Also, it would be nice to have a button when using notebook that would launch sage -t on it and display the result. 
+
 Separate, but also nice, would be "worksheet-ify" command that took a series of doctests and made a nice worksheet out of it.
``````




---

archive/issue_comments_042517.json:
```json
{
    "body": "Changed keywords from **sage test worksheet doctest** to **doctest sws notebook worksheet test**",
    "created_at": "2011-11-03T00:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42517",
    "user": "https://github.com/kini"
}
```

Changed keywords from **sage test worksheet doctest** to **doctest sws notebook worksheet test**



---

archive/issue_comments_042518.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAfter #12415, this just needs to add a parser for .sws files in `sage.doctest.sources` analogous to `PythonSource`, `RestSource` and `TexSource`.",
    "created_at": "2013-03-14T21:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42518",
    "user": "https://github.com/roed314"
}
```

<div id="comment:6" align="right">comment:6</div>

After #12415, this just needs to add a parser for .sws files in `sage.doctest.sources` analogous to `PythonSource`, `RestSource` and `TexSource`.



---

archive/issue_events_076492.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T22:41:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76492"
}
```



---

archive/issue_events_076493.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T22:41:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76493"
}
```



---

archive/issue_events_076494.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-02T22:48:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76494"
}
```



---

archive/issue_events_076495.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-02T22:48:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76495"
}
```



---

archive/issue_events_076496.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-02T22:48:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76496"
}
```



---

archive/issue_events_076497.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-01-02T22:48:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76497"
}
```



---

archive/issue_comments_042519.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWith no progress on it and with sws planned for retirement together with SageNB, I think we should close it.",
    "created_at": "2017-01-02T22:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42519",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:8" align="right">comment:8</div>

With no progress on it and with sws planned for retirement together with SageNB, I think we should close it.



---

archive/issue_comments_042520.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-01-05T16:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42520",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Andrey Novoseltsev, Frédéric Chapoton**



---

archive/issue_events_076498.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-05T16:50:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76498"
}
```



---

archive/issue_events_076499.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-05T16:50:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76499"
}
```



---

archive/issue_comments_042521.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nyes, let us close that",
    "created_at": "2017-01-05T16:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6357#issuecomment-42521",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

yes, let us close that



---

archive/issue_events_076500.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76500"
}
```



---

archive/issue_events_076501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6357",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6357#event-76501"
}
```
