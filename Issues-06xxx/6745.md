# Issue 6745: quaternion algebras -- add computation of left and right orders associated to ideals

archive/issues_006745.json:
```json
{
    "body": "A big gap in functionality for quaternion algebras right now is that one can't compute the left and right orders associated to ideals (the functions raise NotImplementedError).    I just designed a little algorithm and wrote code to do this for my research and will post a patch here soon. \n\nJust in case I misplace it, some demo code that works is the following:\n\n```\ndef left_order(I):\n    Q = I.quaternion_algebra()\n    M = [matrix([(a*b).coefficient_tuple() for a in Q.basis()]) for b in I.basis()]\n    B = I.basis_matrix()\n    invs = [(B*m^(-1)).row_module(ZZ) for m in M]\n    IS = invs[0].intersection(invs[1]).intersection(invs[2]).intersection(invs[3])\n    ISB = [Q(v) for v in IS.basis()]\n    return Q.quaternion_order(ISB)\n```\n\n**Author:** William Stein\n\n**Reviewer:** Robert Bradshaw\n\n**Merged:** Sage 4.1.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6745\n\n",
    "closed_at": "2009-09-02T15:41:53Z",
    "created_at": "2009-08-14T16:23:57Z",
    "labels": [
        "component: algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1.2",
    "title": "quaternion algebras -- add computation of left and right orders associated to ideals",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/6745",
    "user": "https://github.com/williamstein"
}
```
A big gap in functionality for quaternion algebras right now is that one can't compute the left and right orders associated to ideals (the functions raise NotImplementedError).    I just designed a little algorithm and wrote code to do this for my research and will post a patch here soon. 

Just in case I misplace it, some demo code that works is the following:

```
def left_order(I):
    Q = I.quaternion_algebra()
    M = [matrix([(a*b).coefficient_tuple() for a in Q.basis()]) for b in I.basis()]
    B = I.basis_matrix()
    invs = [(B*m^(-1)).row_module(ZZ) for m in M]
    IS = invs[0].intersection(invs[1]).intersection(invs[2]).intersection(invs[3])
    ISB = [Q(v) for v in IS.basis()]
    return Q.quaternion_order(ISB)
```

**Author:** William Stein

**Reviewer:** Robert Bradshaw

**Merged:** Sage 4.1.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6745





---

archive/issue_comments_049064.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n ```\n def left_order(I):\n-    Q = O.quaternion_algebra()\n+    Q = I.quaternion_algebra()\n     M = [matrix([(a*b).coefficient_tuple() for a in Q.basis()]) for b in I.basis()]\n     B = I.basis_matrix()\n     invs = [(B*m^(-1)).row_module(ZZ) for m in M]\n``````\n",
    "created_at": "2009-08-14T16:25:20Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49064",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 ```
 def left_order(I):
-    Q = O.quaternion_algebra()
+    Q = I.quaternion_algebra()
     M = [matrix([(a*b).coefficient_tuple() for a in Q.basis()]) for b in I.basis()]
     B = I.basis_matrix()
     invs = [(B*m^(-1)).row_module(ZZ) for m in M]
``````




---

archive/issue_events_044690.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-08-14T21:08:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44690"
}
```



---

archive/issue_events_044691.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-08-16T09:18:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "rename": {
        "from": "quaternion algebras -- add computation of left and right orders associated to ideals",
        "to": "[nearly positive review] quaternion algebras -- add computation of left and right orders associated to ideals"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44691"
}
```



---

archive/attachments_008084.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6745.patch",
    "asset_url": "tarball://root/attachments/ticket6745/trac_6745.patch",
    "created_at": "2009-08-16T09:18:21Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket6745/trac_6745.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_049065.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_6745.patch](https://github.com/sagemath/sage/files/ticket6745/trac_6745.patch) by @robertwb created at 2009-08-16 09:18:21\n\nsage/algebras/quatalg/quaternion_algebra.py:1272\n\n```\nALGORITHM: Let `b_1, b_2, b_3, b_3` be a basis for this \n```\n\n(Typo, you want b_4). \n\nTabularUnified  sage/matrix/matrix_integer_dense.pyx:2310\n\n```\nif max(self._nrows, self._ncols) <= 50: \n```\n\nI think you intended to have an `elif` here. \n\nOther than that, looks good to me. Also, while I was playing around with it trying it out, I found #6762 useful.",
    "created_at": "2009-08-16T09:18:21Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49065",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>
Attachment [trac_6745.patch](https://github.com/sagemath/sage/files/ticket6745/trac_6745.patch) by @robertwb created at 2009-08-16 09:18:21

sage/algebras/quatalg/quaternion_algebra.py:1272

```
ALGORITHM: Let `b_1, b_2, b_3, b_3` be a basis for this 
```

(Typo, you want b_4). 

TabularUnified  sage/matrix/matrix_integer_dense.pyx:2310

```
if max(self._nrows, self._ncols) <= 50: 
```

I think you intended to have an `elif` here. 

Other than that, looks good to me. Also, while I was playing around with it trying it out, I found #6762 useful.



---

archive/issue_comments_049066.json:
```json
{
    "body": "<a id='comment:4'></a>\nWilliam: any words on the typos reported by Robert?",
    "created_at": "2009-08-25T03:13:35Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49066",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:4'></a>
William: any words on the typos reported by Robert?



---

archive/issue_comments_049067.json:
```json
{
    "body": "<a id='comment:5'></a>\nRegarding Robert's comments:\n\n* I posted a patch fixing the `b_3 |--> b_4` typo.\n\n* The matrix_integer_dense.pyx is *not* a typo.  The issue is that I want to default to pari for small matrices, *unless* said small matrix has huge entries, so the logic is correct (i.e., if entries huge, still use padic).  I've put in some spaces and an {{{# endif} comment to maybe make that seem more intentional. \n\nSo the attached patch changes no logic in the code, but changes/improves two comments.",
    "created_at": "2009-08-30T21:58:09Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49067",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
Regarding Robert's comments:

* I posted a patch fixing the `b_3 |--> b_4` typo.

* The matrix_integer_dense.pyx is *not* a typo.  The issue is that I want to default to pari for small matrices, *unless* said small matrix has huge entries, so the logic is correct (i.e., if entries huge, still use padic).  I've put in some spaces and an {{{# endif} comment to maybe make that seem more intentional. 

So the attached patch changes no logic in the code, but changes/improves two comments.



---

archive/attachments_008085.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6745-part2.patch",
    "asset_url": "tarball://root/attachments/ticket6745/trac_6745-part2.patch",
    "created_at": "2009-08-30T21:58:48Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket6745/trac_6745-part2.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_049068.json:
```json
{
    "body": "Attachment [trac_6745-part2.patch](https://github.com/sagemath/sage/files/ticket6745/trac_6745-part2.patch) by @williamstein created at 2009-08-30 21:58:48\n\nfix comments",
    "created_at": "2009-08-30T21:58:48Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49068",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_6745-part2.patch](https://github.com/sagemath/sage/files/ticket6745/trac_6745-part2.patch) by @williamstein created at 2009-08-30 21:58:48

fix comments



---

archive/issue_events_044692.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-08-31T16:09:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "rename": {
        "from": "[nearly positive review] quaternion algebras -- add computation of left and right orders associated to ideals",
        "to": "quaternion algebras -- add computation of left and right orders associated to ideals"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44692"
}
```



---

archive/issue_events_044693.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-08-31T16:09:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44693"
}
```



---

archive/issue_events_044694.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-08-31T16:09:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44694"
}
```



---

archive/issue_comments_049069.json:
```json
{
    "body": "<a id='comment:6'></a>\nGreat. Positive review.",
    "created_at": "2009-08-31T16:09:43Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49069",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>
Great. Positive review.



---

archive/issue_comments_049070.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged both patches.",
    "created_at": "2009-09-02T15:41:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49070",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:7'></a>
Merged both patches.



---

archive/issue_comments_049071.json:
```json
{
    "body": "**Author:** William Stein",
    "created_at": "2009-09-02T15:41:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49071",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Author:** William Stein



---

archive/issue_comments_049072.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw",
    "created_at": "2009-09-02T15:41:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49072",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Reviewer:** Robert Bradshaw



---

archive/issue_comments_049073.json:
```json
{
    "body": "**Merged:** Sage 4.1.2.alpha0",
    "created_at": "2009-09-02T15:41:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6745#issuecomment-49073",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** Sage 4.1.2.alpha0



---

archive/issue_events_044695.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-09-02T15:41:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44695"
}
```



---

archive/issue_events_044696.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-09-02T15:41:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6745",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6745#event-44696"
}
```
