# Issue 6229: [with patch, positive review] efficiency in Lagrange polynomial interpolation (easy fix...)

archive/issues_006229.json:
```json
{
    "body": "This is a follow-up to #6043.\n\nThis nested loop is useless:\n\n```\n        P = 0 \n        for i in xrange(n): \n            prod = 1 \n            for j in xrange(i): \n                prod *= (x - points[j][0]) \n            P += (F[i] * prod) \n        return P\n\n```\n\nand should be replaced with (something like)\n\n```\n        P = F[n-1]\n        for i in xrange(n-2,-1,-1): \n            P *= (x - points[i][0])\n            P += F[i]\n        return P\n```\n\nAssignee: tbd\n\nCC:  mvngu\n\nResolution: fixed\n\nAuthor: Yann Laigle-Chapuy\n\nReviewer: Minh Van Nguyen\n\nMerged: 4.0.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6229\n\n",
    "closed_at": "2009-06-13T21:18:38Z",
    "created_at": "2009-06-05T22:15:54Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0.2",
    "title": "[with patch, positive review] efficiency in Lagrange polynomial interpolation (easy fix...)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6229",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```
This is a follow-up to #6043.

This nested loop is useless:

```
        P = 0 
        for i in xrange(n): 
            prod = 1 
            for j in xrange(i): 
                prod *= (x - points[j][0]) 
            P += (F[i] * prod) 
        return P

```

and should be replaced with (something like)

```
        P = F[n-1]
        for i in xrange(n-2,-1,-1): 
            P *= (x - points[i][0])
            P += F[i]
        return P
```

Assignee: tbd

CC:  mvngu

Resolution: fixed

Author: Yann Laigle-Chapuy

Reviewer: Minh Van Nguyen

Merged: 4.0.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6229





---

archive/issue_comments_055297.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n This is a follow-up to #6043.\n \n This nested loop is useless:\n-{{\n+\n+```\n         P = 0 \n         for i in xrange(n): \n             prod = 1 \n@@ -10,14 +11,14 @@\n             P += (F[i] * prod) \n         return P\n \n-}}\n+```\n \n and should be replaced with (something like)\n \n-{{\n+```\n         P = F[n-1]\n         for i in xrange(n-2,-1,-1): \n             P *= (x - points[i][0])\n             P += F[i]\n         return P\n-}}\n+```\n``````\n",
    "created_at": "2009-06-05T22:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55297",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
 This is a follow-up to #6043.
 
 This nested loop is useless:
-{{
+
+```
         P = 0 
         for i in xrange(n): 
             prod = 1 
@@ -10,14 +11,14 @@
             P += (F[i] * prod) 
         return P
 
-}}
+```
 
 and should be replaced with (something like)
 
-{{
+```
         P = F[n-1]
         for i in xrange(n-2,-1,-1): 
             P *= (x - points[i][0])
             P += F[i]
         return P
-}}
+```
``````




---

archive/issue_comments_055298.json:
```json
{
    "body": "<a id='comment:2'></a>I have no clean install yet to produce the patch myself...",
    "created_at": "2009-06-05T22:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55298",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:2'></a>I have no clean install yet to produce the patch myself...



---

archive/issue_comments_055299.json:
```json
{
    "body": "<a id='comment:3'></a>You mean like evaluating it in nested form, similar to Horner's method? Do'h, I missed that.",
    "created_at": "2009-06-05T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55299",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:3'></a>You mean like evaluating it in nested form, similar to Horner's method? Do'h, I missed that.



---

archive/issue_comments_055300.json:
```json
{
    "body": "<a id='comment:4'></a>The patch contains the suggested fix by ylchapuy. It's ylchapuy's code, not mine, so authorship credit goes to ylchapuy. I'm just reviewing the code. Here are some timing statistics on sage.math:\n\n```\n# BEFORE\n\nsage: R = PolynomialRing(QQ, 'x')\nsage: %timeit R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])\n1000 loops, best of 3: 830 \u00b5s per loop\nsage: R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])\n-23/84*x^3 - 11/84*x^2 + 13/7*x + 1\nsage: R = PolynomialRing(GF(2**3,'a'), 'x')\nsage: a = R.base_ring().gen()\nsage: timeit(\"R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])\")\n625 loops, best of 3: 112 \u00b5s per loop\nsage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])\na^2*x^2 + a^2*x + a^2\n\n\n# AFTER\n\nsage: R = PolynomialRing(QQ, 'x')\nsage: %timeit R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])\n1000 loops, best of 3: 416 \u00b5s per loop\nsage: R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])\n-23/84*x^3 - 11/84*x^2 + 13/7*x + 1\nsage: R = PolynomialRing(GF(2**3,'a'), 'x')\nsage: a = R.base_ring().gen()\nsage: timeit(\"R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])\")\n625 loops, best of 3: 86.2 \u00b5s per loop\nsage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])\na^2*x^2 + a^2*x + a^2\n```\nSo efficiency gain of up to 50%. Positive review.",
    "created_at": "2009-06-06T00:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55300",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:4'></a>The patch contains the suggested fix by ylchapuy. It's ylchapuy's code, not mine, so authorship credit goes to ylchapuy. I'm just reviewing the code. Here are some timing statistics on sage.math:

```
# BEFORE

sage: R = PolynomialRing(QQ, 'x')
sage: %timeit R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])
1000 loops, best of 3: 830 µs per loop
sage: R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])
-23/84*x^3 - 11/84*x^2 + 13/7*x + 1
sage: R = PolynomialRing(GF(2**3,'a'), 'x')
sage: a = R.base_ring().gen()
sage: timeit("R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])")
625 loops, best of 3: 112 µs per loop
sage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])
a^2*x^2 + a^2*x + a^2


# AFTER

sage: R = PolynomialRing(QQ, 'x')
sage: %timeit R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])
1000 loops, best of 3: 416 µs per loop
sage: R.lagrange_polynomial([(0,1),(2,2),(3,-2),(-4,9)])
-23/84*x^3 - 11/84*x^2 + 13/7*x + 1
sage: R = PolynomialRing(GF(2**3,'a'), 'x')
sage: a = R.base_ring().gen()
sage: timeit("R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])")
625 loops, best of 3: 86.2 µs per loop
sage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)])
a^2*x^2 + a^2*x + a^2
```
So efficiency gain of up to 50%. Positive review.



---

archive/issue_comments_055301.json:
```json
{
    "body": "Attachment [trac_6229.patch](tarball://root/attachments/some-uuid/ticket6229/trac_6229.patch) by mvngu created at 2009-06-06 00:33:32\n\nbased on Sage 4.0.1.rc2",
    "created_at": "2009-06-06T00:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55301",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Attachment [trac_6229.patch](tarball://root/attachments/some-uuid/ticket6229/trac_6229.patch) by mvngu created at 2009-06-06 00:33:32

based on Sage 4.0.1.rc2



---

archive/issue_comments_055302.json:
```json
{
    "body": "Changing merged from \"\" to \"4.0.2.alpha0\"",
    "created_at": "2009-06-13T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55302",
    "user": "https://github.com/ncalexan"
}
```

Changing merged from "" to "4.0.2.alpha0"



---

archive/issue_comments_055303.json:
```json
{
    "body": "Changing author from \"\" to \"Yann Laigle-Chapuy\"",
    "created_at": "2009-06-13T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55303",
    "user": "https://github.com/ncalexan"
}
```

Changing author from "" to "Yann Laigle-Chapuy"



---

archive/issue_events_014605.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:18:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6229#event-14605"
}
```



---

archive/issue_comments_055304.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-06-13T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55304",
    "user": "https://github.com/ncalexan"
}
```

Resolution: fixed



---

archive/issue_comments_055305.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Minh van Nguyen\"",
    "created_at": "2009-06-13T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55305",
    "user": "https://github.com/ncalexan"
}
```

Changing reviewer from "" to "Minh van Nguyen"



---

archive/issue_comments_055306.json:
```json
{
    "body": "Changing reviewer from \"Minh van Nguyen\" to \"Minh Van Nguyen\"",
    "created_at": "2009-06-14T14:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6229#issuecomment-55306",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing reviewer from "Minh van Nguyen" to "Minh Van Nguyen"
