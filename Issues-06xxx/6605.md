# Issue 6605: [with patch, positive review] sage -docbuild DOC FORMAT should do better error checking on DOC

archive/issues_006605.json:
```json
{
    "body": "If I run `sage -docbuild hello html`, then a directory \"hello\" is created in `SAGE_ROOT/devel/sage/doc/en`.  Then if I run `sage -docbuild -help`, \"hello\" is listed as one of the options.\n\nError-checking should be done on the \"document\" argument of `sage -docbuild` to make sure this doesn't happen.\n\n\nAssignee: @jhpalmieri\n\nResolution: fixed\n\nAuthor: John Palmieri\n\nReviewer: Mitesh Patel\n\nMerged: sage-4.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6605\n\n",
    "closed_at": "2009-10-15T16:34:36Z",
    "created_at": "2009-07-23T17:48:39Z",
    "labels": [
        "component: documentation",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.2",
    "title": "[with patch, positive review] sage -docbuild DOC FORMAT should do better error checking on DOC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6605",
    "user": "https://github.com/jhpalmieri"
}
```
If I run `sage -docbuild hello html`, then a directory "hello" is created in `SAGE_ROOT/devel/sage/doc/en`.  Then if I run `sage -docbuild -help`, "hello" is listed as one of the options.

Error-checking should be done on the "document" argument of `sage -docbuild` to make sure this doesn't happen.


Assignee: @jhpalmieri

Resolution: fixed

Author: John Palmieri

Reviewer: Mitesh Patel

Merged: sage-4.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6605





---

archive/issue_comments_061044.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2009-07-23T19:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61044",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to assigned.



---

archive/issue_comments_061045.json:
```json
{
    "body": "Changing assignee from tba to @jhpalmieri.",
    "created_at": "2009-07-23T19:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61045",
    "user": "https://github.com/jhpalmieri"
}
```

Changing assignee from tba to @jhpalmieri.



---

archive/issue_comments_061046.json:
```json
{
    "body": "Changing author from \"\" to \"John Palmieri\"",
    "created_at": "2009-07-23T19:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61046",
    "user": "https://github.com/jhpalmieri"
}
```

Changing author from "" to "John Palmieri"



---

archive/issue_comments_061047.json:
```json
{
    "body": "<a id='comment:1'></a>As written, this depends on #6187 (although it would be easy enough to modify it to avoid this).   The new OMIT variable is for situations such as the one introduced by #5653, where there is a subdirectory \"introspect\" of SAGE_ROOT/doc/en/, which is not a document to be processed by \"sage -docbuild\", and so should be omitted from the list of all such documents.  (This patch doesn't depend on #5653, but it will be compatible with it, should #5653 be merged.)",
    "created_at": "2009-07-23T19:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61047",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>As written, this depends on #6187 (although it would be easy enough to modify it to avoid this).   The new OMIT variable is for situations such as the one introduced by #5653, where there is a subdirectory "introspect" of SAGE_ROOT/doc/en/, which is not a document to be processed by "sage -docbuild", and so should be omitted from the list of all such documents.  (This patch doesn't depend on #5653, but it will be compatible with it, should #5653 be merged.)



---

archive/issue_comments_061048.json:
```json
{
    "body": "<a id='comment:2'></a>The patch works for me.  I think a non-zero exit value is the UNIX convention for an error.  I can make an updated patch.  Or I can wait for more feedback on #6187. \n\nNotes for other potential tickets:\n\n* We could also print a similar message in the less severe case of an invalid format.\n* Instead of using [sys.exit()](http://docs.python.org/library/sys.html#sys.exit), we could raise (and catch) some exception, so that the builder can loop over documents, formats, and commands, printing warnings as necessary.  At the moment, though, this feature is not implemented.",
    "created_at": "2009-07-24T09:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61048",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>The patch works for me.  I think a non-zero exit value is the UNIX convention for an error.  I can make an updated patch.  Or I can wait for more feedback on #6187. 

Notes for other potential tickets:

* We could also print a similar message in the less severe case of an invalid format.
* Instead of using [sys.exit()](http://docs.python.org/library/sys.html#sys.exit), we could raise (and catch) some exception, so that the builder can loop over documents, formats, and commands, printing warnings as necessary.  At the moment, though, this feature is not implemented.



---

archive/issue_comments_061049.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_6605-docbuild-check.patch](tarball://root/attachments/some-uuid/ticket6605/trac_6605-docbuild-check.patch) by @jhpalmieri created at 2009-07-24 15:18:19\n\nThis patch is identical, except it uses sys.exit(1) instead of sys.exit(0).",
    "created_at": "2009-07-24T15:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61049",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>Attachment [trac_6605-docbuild-check.patch](tarball://root/attachments/some-uuid/ticket6605/trac_6605-docbuild-check.patch) by @jhpalmieri created at 2009-07-24 15:18:19

This patch is identical, except it uses sys.exit(1) instead of sys.exit(0).



---

archive/issue_comments_061050.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Mitesh Patel\"",
    "created_at": "2009-07-24T15:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61050",
    "user": "https://github.com/qed777"
}
```

Changing reviewer from "" to "Mitesh Patel"



---

archive/issue_comments_061051.json:
```json
{
    "body": "Changing merged from \"\" to \"Sage 4.1.1.alpha1\"",
    "created_at": "2009-07-24T22:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61051",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "" to "Sage 4.1.1.alpha1"



---

archive/issue_comments_061052.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-07-24T22:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61052",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_events_015593.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-07-24T22:35:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6605#event-15593"
}
```



---

archive/issue_comments_061053.json:
```json
{
    "body": "<a id='comment:6'></a>The patch applies but with fuzz:\n\n```\n[mvngu@sage sage-main]$ hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6605/trac_6605-docbuild-check.patch && hg qpush\nadding trac_6605-docbuild-check.patch to series file\napplying trac_6605-docbuild-check.patch\npatching file doc/common/builder.py\nHunk #3 succeeded at 614 with fuzz 1 (offset -44 lines).\nNow at: trac_6605-docbuild-check.patch\n```",
    "created_at": "2009-07-26T23:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61053",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:6'></a>The patch applies but with fuzz:

```
[mvngu@sage sage-main]$ hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6605/trac_6605-docbuild-check.patch && hg qpush
adding trac_6605-docbuild-check.patch to series file
applying trac_6605-docbuild-check.patch
patching file doc/common/builder.py
Hunk #3 succeeded at 614 with fuzz 1 (offset -44 lines).
Now at: trac_6605-docbuild-check.patch
```



---

archive/issue_comments_061054.json:
```json
{
    "body": "<a id='comment:7'></a>The patch `trac_6605-docbuild-check.patch` is buggy when it comes to (re)building the documentation of a new release. Assume you have applied this patch to Sage 4.1.1.alpha0, then build a source release with\n\n```\nsage -sdist <version>\n```\nor a binary release with\n\n```\nsage -bdist <version>\n```\nAfter that, upgrade a previous release to this new release and rebuild the documentation. You then get this error message:\n\n```\n[mvngu@sage sage-4.1.1.alpha1-test-x86_64-Linux]$ ./sage -docbuild tutorial htmlTraceback (most recent call last):\n  File \"/scratch/mvngu/sage-4.1.1.alpha1-test-x86_64-Linux/devel/sage/doc/common/builder.py\", line 673, in <module>\n    getattr(get_builder(name), type)()\n  File \"/scratch/mvngu/sage-4.1.1.alpha1-test-x86_64-Linux/devel/sage/doc/common/builder.py\", line 616, in get_builder\n    elif name in get_documents() or name in AllBuilder().get_all_documents():\nNameError: global name 'get_documents' is not defined\n```\nThe same error is raised if you rebuild the documentation of the binary version of the new release. I'm reopening this ticket and marking it as needs work.",
    "created_at": "2009-07-27T05:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61054",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:7'></a>The patch `trac_6605-docbuild-check.patch` is buggy when it comes to (re)building the documentation of a new release. Assume you have applied this patch to Sage 4.1.1.alpha0, then build a source release with

```
sage -sdist <version>
```
or a binary release with

```
sage -bdist <version>
```
After that, upgrade a previous release to this new release and rebuild the documentation. You then get this error message:

```
[mvngu@sage sage-4.1.1.alpha1-test-x86_64-Linux]$ ./sage -docbuild tutorial htmlTraceback (most recent call last):
  File "/scratch/mvngu/sage-4.1.1.alpha1-test-x86_64-Linux/devel/sage/doc/common/builder.py", line 673, in <module>
    getattr(get_builder(name), type)()
  File "/scratch/mvngu/sage-4.1.1.alpha1-test-x86_64-Linux/devel/sage/doc/common/builder.py", line 616, in get_builder
    elif name in get_documents() or name in AllBuilder().get_all_documents():
NameError: global name 'get_documents' is not defined
```
The same error is raised if you rebuild the documentation of the binary version of the new release. I'm reopening this ticket and marking it as needs work.



---

archive/issue_comments_061055.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2009-07-27T05:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61055",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_061056.json:
```json
{
    "body": "Changing merged from \"Sage 4.1.1.alpha1\" to \"\"",
    "created_at": "2009-07-27T05:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61056",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "Sage 4.1.1.alpha1" to ""



---

archive/issue_comments_061057.json:
```json
{
    "body": "Changing status from closed to reopened.",
    "created_at": "2009-07-27T05:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61057",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing status from closed to reopened.



---

archive/issue_events_015594.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-07-27T05:24:22Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6605#event-15594"
}
```



---

archive/issue_comments_061058.json:
```json
{
    "body": "<a id='comment:8'></a>It doesn't need work.  As I mentioned in the first comment, it depends on #6187.  That's where \"get_documents\" is defined.\n\nPlease wait for #6187 to merge.",
    "created_at": "2009-07-27T05:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61058",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>It doesn't need work.  As I mentioned in the first comment, it depends on #6187.  That's where "get_documents" is defined.

Please wait for #6187 to merge.



---

archive/issue_comments_061059.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-10-15T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61059",
    "user": "https://github.com/mwhansen"
}
```

Resolution: fixed



---

archive/issue_comments_061060.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.2.alpha0\"",
    "created_at": "2009-10-15T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6605#issuecomment-61060",
    "user": "https://github.com/mwhansen"
}
```

Changing merged from "" to "sage-4.2.alpha0"



---

archive/issue_events_015595.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-15T16:34:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6605#event-15595"
}
```
