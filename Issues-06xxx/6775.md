# Issue 6775: Create an interface for Disjoint Set data structure

archive/issues_006775.json:
```json
{
    "assignees": [
        "https://github.com/seblabbe"
    ],
    "body": "I would like to have an easy to use disjoint-set data structure like the one described here:\n\nhttp://en.wikipedia.org/wiki/Disjoint_set_data_structure\n\n```\nsage: d = DisjointSet(range(5))\nsage: d\n{{0}, {1}, {2}, {3}, {4}}\nsage: d.union(3,4)\nsage: d\n{{0}, {1}, {2}, {3, 4}}\nsage: d.union(0,2)\nsage: d\n{{0, 2}, {1}, {3, 4}}\nsage: d.union(1,4)\nsage: d.find(3)\n3\nsage: d.find(4)\n3\n```\n\nAs suggested [by Robert Miller on sage-devel](http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/4b6d5bb2983d81c2/f52adb855eb3b09f?lnk=gst&q=disjoint+set#f52adb855eb3b09f), one could use what is defined in\n\n`sage/groups/perm_gps/partn_ref/data_structures_*`\n\n\n\n\n\nCC:  @rlmill\n\nComponent: **combinatorics**\n\nKeywords: **disjoint set data structure**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nReviewer: **Robert Miller**\n\nMerged: **sage-4.3.3.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6775_\n\n",
    "closed_at": "2010-02-11T14:47:53Z",
    "created_at": "2009-08-19T18:29:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Create an interface for Disjoint Set data structure",
    "type": "issue",
    "updated_at": "2016-04-15T19:30:31Z",
    "url": "https://github.com/sagemath/sage/issues/6775",
    "user": "https://github.com/seblabbe"
}
```
I would like to have an easy to use disjoint-set data structure like the one described here:

http://en.wikipedia.org/wiki/Disjoint_set_data_structure

```
sage: d = DisjointSet(range(5))
sage: d
{{0}, {1}, {2}, {3}, {4}}
sage: d.union(3,4)
sage: d
{{0}, {1}, {2}, {3, 4}}
sage: d.union(0,2)
sage: d
{{0, 2}, {1}, {3, 4}}
sage: d.union(1,4)
sage: d.find(3)
3
sage: d.find(4)
3
```

As suggested [by Robert Miller on sage-devel](http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/4b6d5bb2983d81c2/f52adb855eb3b09f?lnk=gst&q=disjoint+set#f52adb855eb3b09f), one could use what is defined in

`sage/groups/perm_gps/partn_ref/data_structures_*`





CC:  @rlmill

Component: **combinatorics**

Keywords: **disjoint set data structure**

Author: **Sébastien Labbé**

Reviewer: **Robert Miller**

Merged: **sage-4.3.3.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/6775_





---

archive/issue_events_081558.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-08-19T18:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81558"
}
```



---

archive/issue_events_081559.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-08-19T18:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81559"
}
```



---

archive/issue_events_081560.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-08-19T18:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81560"
}
```



---

archive/issue_events_081561.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-08-19T18:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81561"
}
```



---

archive/issue_events_081562.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-08-19T18:29:55Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "subject": "https://github.com/seblabbe",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81562"
}
```



---

archive/issue_comments_047845.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI just added a patch. I have two issues :\n\n1. I still have some problems with pikling :\n\n```\nslabbe@slabbe-laptop:~/sage-4.1/devel/sage-combinat/sage/sets$ sage\n----------------------------------------------------------------------\n| Sage Version 4.1, Release Date: 2009-07-09                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: combinat\nsage: d = DisjointSet(5)\nsage: b = loads(dumps(d))\nsage: b\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occured in SAGE.\nThis probably occured because a *compiled* component\nof SAGE has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run SAGE under gdb with 'sage -gdb' to debug this.\nSAGE will now terminate (sorry).\n------------------------------------------------------------\n```\n\n2. I am using the `__del__` function to call the `OP_dealloc`, but I not sure it is proper...",
    "created_at": "2009-08-19T18:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47845",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1" align="right">comment:1</div>

I just added a patch. I have two issues :

1. I still have some problems with pikling :

```
slabbe@slabbe-laptop:~/sage-4.1/devel/sage-combinat/sage/sets$ sage
----------------------------------------------------------------------
| Sage Version 4.1, Release Date: 2009-07-09                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: combinat
sage: d = DisjointSet(5)
sage: b = loads(dumps(d))
sage: b


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occured in SAGE.
This probably occured because a *compiled* component
of SAGE has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run SAGE under gdb with 'sage -gdb' to debug this.
SAGE will now terminate (sorry).
------------------------------------------------------------
```

2. I am using the `__del__` function to call the `OP_dealloc`, but I not sure it is proper...



---

archive/issue_events_081563.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-08-19T19:11:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "milestone_number": null,
    "milestone_title": "sage-4.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81563"
}
```



---

archive/issue_events_081564.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-11-02T10:23:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "title_is": "Create an interface for Disjoint Set data structure",
    "title_was": "Having an easy to use Disjoint Set data structure",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81564"
}
```



---

archive/issue_events_081565.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-11-02T10:23:03Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "subject": "https://github.com/seblabbe",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81565"
}
```



---

archive/issue_events_081566.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-11-02T10:23:03Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "subject": "https://github.com/seblabbe",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81566"
}
```



---

archive/issue_comments_047846.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n1. You should probably declare things like\n\n```\ncdef class DisjointSet_of_integers(SageObject):\n    cdef OrbitPartition *_nodes \n```\nand\n\n```\ncdef class DisjointSet_of_hashable(SageObject):\n   cdef list _int_to_el\n   cdef dict _el_to_int\n   cdef DisjointSet_of_integers _d\n```\nin `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.\n\n2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.",
    "created_at": "2009-11-05T21:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47846",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:4" align="right">comment:4</div>

1. You should probably declare things like

```
cdef class DisjointSet_of_integers(SageObject):
    cdef OrbitPartition *_nodes 
```
and

```
cdef class DisjointSet_of_hashable(SageObject):
   cdef list _int_to_el
   cdef dict _el_to_int
   cdef DisjointSet_of_integers _d
```
in `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.

2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.



---

archive/issue_comments_047847.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI just replace the old patch and I solved the pickle problem. \n\nReplying to [@rlmill](#comment%3A4):\n> 1. You should probably declare things like\n\n[snip]\n> in `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.\n\nDone. Thanks for the comment. But is it really necessary since the function `DisjointSet` is the function used as a constructor? Should I also add that one to the `.pxd` ?\n\n> 2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.\n\nThe function `__del__` was not called, but `__dealloc__` is. Although, I am getting memory errors when using the `__dealloc__` function. I put a `pass` command in it and I get All test pass. Am I losing memory somewhere?\n\nNeeds review!",
    "created_at": "2009-11-24T14:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47847",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:5" align="right">comment:5</div>

I just replace the old patch and I solved the pickle problem. 

Replying to [@rlmill](#comment%3A4):
> 1. You should probably declare things like

[snip]
> in `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.

Done. Thanks for the comment. But is it really necessary since the function `DisjointSet` is the function used as a constructor? Should I also add that one to the `.pxd` ?

> 2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.

The function `__del__` was not called, but `__dealloc__` is. Although, I am getting memory errors when using the `__dealloc__` function. I put a `pass` command in it and I get All test pass. Am I losing memory somewhere?

Needs review!



---

archive/issue_events_081567.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-11-24T14:31:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81567"
}
```



---

archive/issue_events_081568.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2009-11-24T14:31:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81568"
}
```



---

archive/issue_comments_047848.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@seblabbe](#comment%3A5):\n> Replying to [@rlmill](#comment%3A4):\n> > 1. You should probably declare things like\n\n> [snip]\n> > in `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.\n\n> \n> Done. Thanks for the comment. But is it really necessary since the function `DisjointSet` is the function used as a constructor?\n\nIt would make things easier for developers using this later on, who want to use some Cython with this object. The DisjointSet function is a Python function, so it is irrelevant. I'm just talking about the class definitions.\n\n> > 2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.\n\n> \n> The function `__del__` was not called, but `__dealloc__` is. Although, I am getting memory errors when using the `__dealloc__` function. I put a `pass` command in it and I get All test pass. Am I losing memory somewhere?\n\nYes, because your dealloc isn't doing anything. You should replace `pass` with `OP_dealloc(self._nodes)`.",
    "created_at": "2009-11-24T17:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47848",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@seblabbe](#comment%3A5):
> Replying to [@rlmill](#comment%3A4):
> > 1. You should probably declare things like

> [snip]
> > in `disjoint_set.pxd` instead of `disjoint_set.pyx`. That'll make it easier to use these classes elsewhere.

> 
> Done. Thanks for the comment. But is it really necessary since the function `DisjointSet` is the function used as a constructor?

It would make things easier for developers using this later on, who want to use some Cython with this object. The DisjointSet function is a Python function, so it is irrelevant. I'm just talking about the class definitions.

> > 2. You should have `__del__` print something and see if it's even getting called. I would define `__dealloc__` and see if that gets called instead. You're using `OP_dealloc` correctly.

> 
> The function `__del__` was not called, but `__dealloc__` is. Although, I am getting memory errors when using the `__dealloc__` function. I put a `pass` command in it and I get All test pass. Am I losing memory somewhere?

Yes, because your dealloc isn't doing anything. You should replace `pass` with `OP_dealloc(self._nodes)`.



---

archive/issue_events_081569.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-11-24T17:07:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81569"
}
```



---

archive/issue_events_081570.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-11-24T17:07:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81570"
}
```



---

archive/issue_comments_047849.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe patch trac_6775-with_dealloc-sl.patch puts back the dealloc. I now get a mysterious error :\n\n```\nslabbe@pol:~/sage-4.2/devel/sage-combinat/sage/sets$ sage -t disjoint_set.pyx\nsage -t  \"devel/sage-combinat/sage/sets/disjoint_set.pyx\"   \nA mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.\n\t [2.3 s]\nexit code: 768\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage-combinat/sage/sets/disjoint_set.pyx\"\nTotal time for all tests: 2.3 seconds\n```\n\nToday I was not able to reproduce the same problem in the command line. Is there a way to get more informations on such a failed test?\n\nAlthough, adding a print statement in the `__init__` gives more information in the failed tests. I am getting the result below. Changing the print statement from one `__init__` to another changes the place where the memory error occur.\n\n```\n...\n**********************************************************************\nFile \"/home/slabbe/sage-4.2/devel/sage-combinat/sage/sets/disjoint_set.pyx\", line 744:\n    sage: d = DisjointSet(range(5))\nExpected nothing\nGot:\n    DisjointSet_of_hashable.__init__ called\n**********************************************************************\nFile \"/home/\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occured in SAGE.\nThis probably occured because a *compiled* component\nof SAGE has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, line 760:\n    sage: d = DisjointSet(range(5))\nExpected nothing\nGot:\n    DisjointSet_of_hashable.__init__ called\n**********************************************************************\nFile \"/home/slabbe/sage-4.2/devel/sage-combinat/sage/sets/disjoint_set.pyx\", line 781:\n    sage: d = DisjointSet(range(5))\nExpected nothing\nGot:\n    DisjointSet_of_hashable.__init__ called\n**********************************************************************\n...\n```\n\nWill I get the same problem at the same place if I redo all the doctests in the same order as in the file by hand directly in the command line. Can I reproduce the problem is my actual question.\n\nI think I also need to understand when exactly the `__dealloc__` is called.",
    "created_at": "2009-11-24T17:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47849",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:7" align="right">comment:7</div>

The patch trac_6775-with_dealloc-sl.patch puts back the dealloc. I now get a mysterious error :

```
slabbe@pol:~/sage-4.2/devel/sage-combinat/sage/sets$ sage -t disjoint_set.pyx
sage -t  "devel/sage-combinat/sage/sets/disjoint_set.pyx"   
A mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.
	 [2.3 s]
exit code: 768
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage-combinat/sage/sets/disjoint_set.pyx"
Total time for all tests: 2.3 seconds
```

Today I was not able to reproduce the same problem in the command line. Is there a way to get more informations on such a failed test?

Although, adding a print statement in the `__init__` gives more information in the failed tests. I am getting the result below. Changing the print statement from one `__init__` to another changes the place where the memory error occur.

```
...
**********************************************************************
File "/home/slabbe/sage-4.2/devel/sage-combinat/sage/sets/disjoint_set.pyx", line 744:
    sage: d = DisjointSet(range(5))
Expected nothing
Got:
    DisjointSet_of_hashable.__init__ called
**********************************************************************
File "/home/

------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occured in SAGE.
This probably occured because a *compiled* component
of SAGE has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, line 760:
    sage: d = DisjointSet(range(5))
Expected nothing
Got:
    DisjointSet_of_hashable.__init__ called
**********************************************************************
File "/home/slabbe/sage-4.2/devel/sage-combinat/sage/sets/disjoint_set.pyx", line 781:
    sage: d = DisjointSet(range(5))
Expected nothing
Got:
    DisjointSet_of_hashable.__init__ called
**********************************************************************
...
```

Will I get the same problem at the same place if I redo all the doctests in the same order as in the file by hand directly in the command line. Can I reproduce the problem is my actual question.

I think I also need to understand when exactly the `__dealloc__` is called.



---

archive/issue_comments_047850.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nhttp://wiki.sagemath.org/ValgrindingSage\n\nYou may need to build a fresh version of Sage to use valgrind with it, see the above link for details. Once you get it built, and get your patch attached, you can run the doctest session in valgrind mode, and when it segfaults, valgrind will tell you what leaked.",
    "created_at": "2009-11-24T19:18:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47850",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:8" align="right">comment:8</div>

http://wiki.sagemath.org/ValgrindingSage

You may need to build a fresh version of Sage to use valgrind with it, see the above link for details. Once you get it built, and get your patch attached, you can run the doctest session in valgrind mode, and when it segfaults, valgrind will tell you what leaked.



---

archive/issue_comments_047851.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nPS - Make sure to do this on a Linux box :)",
    "created_at": "2009-11-24T19:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47851",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:9" align="right">comment:9</div>

PS - Make sure to do this on a Linux box :)



---

archive/issue_comments_047852.json:
```json
{
    "body": "Author: **Sebastien Labbe**",
    "created_at": "2010-01-19T17:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47852",
    "user": "https://github.com/seblabbe"
}
```

Author: **Sebastien Labbe**



---

archive/issue_comments_047853.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFinally, `sage -t -verbose` gave me enough information to solve the problem. There was one doctest doing :\n\n```\nsage: DisjointSet(-1)\n```\n\nto illustrate that the argument must be non negative. The test `arg < 0` was done inside the `__init__` function of the class so that the attribute `_nodes` was not initialized if an error was raised before. Then, `__dealloc__` was trying to call `OP_dealloc` on a non existing `_nodes` : BOOM!\n\nI moved the `arg < 0` test in the `DisjointSet` function and All tests passed : great !\n\nI just uploaded the second patch.",
    "created_at": "2010-01-19T17:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47853",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>

Finally, `sage -t -verbose` gave me enough information to solve the problem. There was one doctest doing :

```
sage: DisjointSet(-1)
```

to illustrate that the argument must be non negative. The test `arg < 0` was done inside the `__init__` function of the class so that the attribute `_nodes` was not initialized if an error was raised before. Then, `__dealloc__` was trying to call `OP_dealloc` on a non existing `_nodes` : BOOM!

I moved the `arg < 0` test in the `DisjointSet` function and All tests passed : great !

I just uploaded the second patch.



---

archive/issue_comments_047854.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI am now having problem building the documentation...\n\n```\n/home/slabbe/sage-4.3/devel/sage/doc/en/reference/sage/sets/disjoint_set.rst:6: \n(WARNING/2) error while formatting signature for sage.sets.disjoint_set.OP_represent: \nCould not parse cython argspec\n/home/slabbe/sage-4.3/devel/sage/doc/en/reference/sage/sets/disjoint_set.rst:6: \n(WARNING/2) error while formatting signature for sage.sets.disjoint_set.PS_represent: \nCould not parse cython argspec\n```\n\nI will look at this before changing the status to `needs review`.",
    "created_at": "2010-01-19T17:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47854",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:11" align="right">comment:11</div>

I am now having problem building the documentation...

```
/home/slabbe/sage-4.3/devel/sage/doc/en/reference/sage/sets/disjoint_set.rst:6: 
(WARNING/2) error while formatting signature for sage.sets.disjoint_set.OP_represent: 
Could not parse cython argspec
/home/slabbe/sage-4.3/devel/sage/doc/en/reference/sage/sets/disjoint_set.rst:6: 
(WARNING/2) error while formatting signature for sage.sets.disjoint_set.PS_represent: 
Could not parse cython argspec
```

I will look at this before changing the status to `needs review`.



---

archive/issue_comments_047855.json:
```json
{
    "body": "Attachment: **[trac_6775-with_dealloc-sl.patch.gz](https://github.com/sagemath/sage/files/ticket6775/trac_6775-with_dealloc-sl.patch.gz)**\n\nApplies over the precedent patch.",
    "created_at": "2010-01-19T17:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47855",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[trac_6775-with_dealloc-sl.patch.gz](https://github.com/sagemath/sage/files/ticket6775/trac_6775-with_dealloc-sl.patch.gz)**

Applies over the precedent patch.



---

archive/issue_comments_047856.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe docbuild problem comes from `_sage_getargspec_cython` which fails because it doesn't handle the presence of commas inside default value of arguments of a function. In fact, both `OP_represent` and `PS_represent` do use commas in their default arguments... \n\n```\nsage: from sage.misc.sageinspect import _sage_getargspec_cython\nsage: _sage_getargspec_cython('def PS_represent(partition=5, splits=[444]):')\n(['partition', 'splits'], None, None, (5, [444]))\nsage: _sage_getargspec_cython('def PS_represent(partition=5, splits=[444,4]):') \nTraceback (most recent call last):\n...\nValueError: Could not parse cython argspec\n```\n\nOne solution could be to avoid the presence of those two functions in the doc, but I don't know how to do this since they appear from the cython line\n\n```\ninclude '../groups/perm_gps/partn_ref/data_structures_pyx.pxi'\n```\nwhich includes everything in the file including `PS_represent` and `OP_represent` which are not needed for `disjoint_set.pyx`. Is it possible to include only what we need?\n\nI think this problem concerns something independant from this ticket (another ticket could be open for the comma problem). So I change the status of this ticket to `needs review`.",
    "created_at": "2010-02-01T17:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47856",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:12" align="right">comment:12</div>

The docbuild problem comes from `_sage_getargspec_cython` which fails because it doesn't handle the presence of commas inside default value of arguments of a function. In fact, both `OP_represent` and `PS_represent` do use commas in their default arguments... 

```
sage: from sage.misc.sageinspect import _sage_getargspec_cython
sage: _sage_getargspec_cython('def PS_represent(partition=5, splits=[444]):')
(['partition', 'splits'], None, None, (5, [444]))
sage: _sage_getargspec_cython('def PS_represent(partition=5, splits=[444,4]):') 
Traceback (most recent call last):
...
ValueError: Could not parse cython argspec
```

One solution could be to avoid the presence of those two functions in the doc, but I don't know how to do this since they appear from the cython line

```
include '../groups/perm_gps/partn_ref/data_structures_pyx.pxi'
```
which includes everything in the file including `PS_represent` and `OP_represent` which are not needed for `disjoint_set.pyx`. Is it possible to include only what we need?

I think this problem concerns something independant from this ticket (another ticket could be open for the comma problem). So I change the status of this ticket to `needs review`.



---

archive/issue_comments_047857.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNeeds review! (Both patches together).",
    "created_at": "2010-02-01T17:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47857",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:13" align="right">comment:13</div>

Needs review! (Both patches together).



---

archive/issue_events_081571.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-02-01T17:27:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81571"
}
```



---

archive/issue_events_081572.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-02-01T17:27:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81572"
}
```



---

archive/issue_comments_047858.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAre you still having the same problems building the documentation?\n\nIf you are, then you should know that both `OP_` and `PS_` -`represent` are functions which are only intended to illustrate a point. In fact, you could change their default arguments to `None` and simply feed in the original arguments in the doctests, since that is their only purpose.",
    "created_at": "2010-02-06T19:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47858",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:14" align="right">comment:14</div>

Are you still having the same problems building the documentation?

If you are, then you should know that both `OP_` and `PS_` -`represent` are functions which are only intended to illustrate a point. In fact, you could change their default arguments to `None` and simply feed in the original arguments in the doctests, since that is their only purpose.



---

archive/issue_comments_047859.json:
```json
{
    "body": "Apply only this one.",
    "created_at": "2010-02-07T16:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47859",
    "user": "https://github.com/seblabbe"
}
```

Apply only this one.



---

archive/issue_comments_047860.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[trac_6775-disjoint_set-sl.patch.gz](https://github.com/sagemath/sage/files/ticket6775/trac_6775-disjoint_set-sl.patch.gz)**\n\nGood point. I followed your suggestion and I folded both precedent patches.\n\nNeeds review!",
    "created_at": "2010-02-07T16:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47860",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[trac_6775-disjoint_set-sl.patch.gz](https://github.com/sagemath/sage/files/ticket6775/trac_6775-disjoint_set-sl.patch.gz)**

Good point. I followed your suggestion and I folded both precedent patches.

Needs review!



---

archive/issue_comments_047861.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nGood work!",
    "created_at": "2010-02-07T20:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47861",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:16" align="right">comment:16</div>

Good work!



---

archive/issue_comments_047862.json:
```json
{
    "body": "Reviewer: **Robert Miller**",
    "created_at": "2010-02-07T20:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47862",
    "user": "https://github.com/rlmill"
}
```

Reviewer: **Robert Miller**



---

archive/issue_events_081573.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-02-07T20:29:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81573"
}
```



---

archive/issue_events_081574.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-02-07T20:29:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81574"
}
```



---

archive/issue_events_081575.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-02-07T20:29:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81575"
}
```



---

archive/issue_events_081576.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-02-07T20:29:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81576"
}
```



---

archive/issue_events_081577.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-11T14:47:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81577"
}
```



---

archive/issue_events_081578.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-11T14:47:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6775#event-81578"
}
```



---

archive/issue_comments_047863.json:
```json
{
    "body": "Merged: **sage-4.3.3.alpha0**",
    "created_at": "2010-02-11T14:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47863",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.3.3.alpha0**



---

archive/issue_comments_047864.json:
```json
{
    "body": "Changed author from **Sebastien Labbe** to **S\u00e9bastien Labb\u00e9**",
    "created_at": "2016-04-15T19:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6775",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6775#issuecomment-47864",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **Sebastien Labbe** to **Sébastien Labbé**
