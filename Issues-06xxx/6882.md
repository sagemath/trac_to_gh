# Issue 6882: bugs in conversion of variable names from Maxima to Sage

archive/issues_006882.json:
```json
{
    "assignees": [
        "https://github.com/rwst"
    ],
    "body": "\n```\n-----------\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('%i')\nI\nsage: symbolic_expression_from_maxima_string('i')\nI\nsage: symbolic_expression_from_maxima_string('%inf')\nInf\n-----------\n\nSo as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n```\nThe ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n\nWe do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n\nCC:  @robert-marik\n\nBranch/Commit: **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**\n\nReviewer: **Karl-Dieter Crisman**\n\nAuthor: **Ralf Stephan**\n\nComponent: **calculus**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/6882_\n\n",
    "closed_at": "2014-07-03T12:41:31Z",
    "created_at": "2009-09-03T22:58:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bugs in conversion of variable names from Maxima to Sage",
    "type": "issue",
    "updated_at": "2014-07-03T12:41:31Z",
    "url": "https://github.com/sagemath/sage/issues/6882",
    "user": "https://github.com/williamstein"
}
```

```
-----------
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('%i')
I
sage: symbolic_expression_from_maxima_string('i')
I
sage: symbolic_expression_from_maxima_string('%inf')
Inf
-----------

So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
```
The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.

We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.

CC:  @robert-marik

Branch/Commit: **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**

Reviewer: **Karl-Dieter Crisman**

Author: **Ralf Stephan**

Component: **calculus**

_Issue created by migration from https://trac.sagemath.org/ticket/6882_





---

archive/issue_events_083582.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-09-03T22:58:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83582"
}
```



---

archive/issue_events_083583.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-09-03T22:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83583"
}
```



---

archive/issue_events_083584.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-09-03T22:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83584"
}
```



---

archive/issue_events_083585.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-09-03T22:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83585"
}
```



---

archive/issue_events_083586.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-09-03T22:58:43Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83586"
}
```



---

archive/issue_comments_048961.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nHere is the relevant [discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/93713a7c32100625/31b2cd361def53b0?show_docid=31b2cd361def53b0#).",
    "created_at": "2009-10-23T23:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48961",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

Here is the relevant [discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/93713a7c32100625/31b2cd361def53b0?show_docid=31b2cd361def53b0#).



---

archive/issue_comments_048962.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis will also happen with %e and e, and any other similar pairs, so a fix should take care of all of them.",
    "created_at": "2009-10-24T00:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48962",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

This will also happen with %e and e, and any other similar pairs, so a fix should take care of all of them.



---

archive/issue_comments_048963.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAs another consequence, solving of ode y'=c*x is not correct, the free variable is messed up with a parameter, see [sage-devel](http://groups.google.cz/group/sage-devel/browse_thread/thread/e04cbc547095f2ac) - thanks for  \t \t\nYuri Karadzhov\n\n```\n[marik@um-bc107 /opt/sage-4.3.4]$ ./sage\n----------------------------------------------------------------------\n| Sage Version 4.3.4, Release Date: 2010-03-19                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('%c')\nc\nsage: c=var('c'); y=function('y',x); eq=diff(y,x)==c*x; eq\nD[0](y)(x) == c*x\nsage: desolve(eq,y,ivar=x)\n1/2*c*x^2 + c\n```\nthe answer should be something like 1/2*c*x^2 + c1",
    "created_at": "2010-03-23T21:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48963",
    "user": "https://github.com/robert-marik"
}
```

<div id="comment:3" align="right">comment:3</div>

As another consequence, solving of ode y'=c*x is not correct, the free variable is messed up with a parameter, see [sage-devel](http://groups.google.cz/group/sage-devel/browse_thread/thread/e04cbc547095f2ac) - thanks for  	 	
Yuri Karadzhov

```
[marik@um-bc107 /opt/sage-4.3.4]$ ./sage
----------------------------------------------------------------------
| Sage Version 4.3.4, Release Date: 2010-03-19                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('%c')
c
sage: c=var('c'); y=function('y',x); eq=diff(y,x)==c*x; eq
D[0](y)(x) == c*x
sage: desolve(eq,y,ivar=x)
1/2*c*x^2 + c
```
the answer should be something like 1/2*c*x^2 + c1



---

archive/issue_comments_048964.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSee #8734 for what I think is a \"needs work\" solution.",
    "created_at": "2010-05-03T17:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48964",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

See #8734 for what I think is a "needs work" solution.



---

archive/issue_comments_048965.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nActually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.",
    "created_at": "2010-05-03T17:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48965",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:5" align="right">comment:5</div>

Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.



---

archive/issue_comments_048966.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis should fix also #9421.",
    "created_at": "2010-07-04T15:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48966",
    "user": "https://github.com/robert-marik"
}
```

<div id="comment:6" align="right">comment:6</div>

This should fix also #9421.



---

archive/issue_comments_048967.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAlso, in a situation where we *don't* have the duplication of constants, we get\n\n```\nsage: c\nTraceback (click to the left of this block for traceback)\n...\nNameError: name 'c' is not defined\n```\nwhich isn't good either, though apparently that part of the expression still has type SymbolicExpression.",
    "created_at": "2012-07-26T15:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48967",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Also, in a situation where we *don't* have the duplication of constants, we get

```
sage: c
Traceback (click to the left of this block for traceback)
...
NameError: name 'c' is not defined
```
which isn't good either, though apparently that part of the expression still has type SymbolicExpression.



---

archive/issue_events_083587.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83587"
}
```



---

archive/issue_events_083588.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83588"
}
```



---

archive/issue_events_083589.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83589"
}
```



---

archive/issue_events_083590.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83590"
}
```



---

archive/issue_comments_048968.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSet to critical due to dependent tickets.",
    "created_at": "2014-02-18T07:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48968",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

Set to critical due to dependent tickets.



---

archive/issue_events_083591.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-18T07:39:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83591"
}
```



---

archive/issue_events_083592.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-18T07:39:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83592"
}
```



---

archive/issue_comments_048969.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jasongrout](#comment:5):\n> Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.\n\nIndeed, because the patch at #8734 (needing review) only is about vars, and it will only help with the problem in [comment:3](#comment:3) if the then marked sage vars are renamed to some other specific string before output in desolve...().",
    "created_at": "2014-03-24T17:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48969",
    "user": "https://github.com/rwst"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jasongrout](#comment:5):
> Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.

Indeed, because the patch at #8734 (needing review) only is about vars, and it will only help with the problem in [comment:3](#comment:3) if the then marked sage vars are renamed to some other specific string before output in desolve...().



---

archive/issue_comments_048970.json:
```json
{
    "body": "Dependencies: **#8734**",
    "created_at": "2014-03-24T17:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48970",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#8734**



---

archive/issue_comments_048971.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@robert-marik](#comment:3):\n> As another consequence, solving of ode y'=c*x is not correct\n> ...\n> the answer should be something like 1/2*c*x^2 + c1\n\nThis one is resolved in #16007. So it seems only variables are left (#8734).",
    "created_at": "2014-03-26T16:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48971",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@robert-marik](#comment:3):
> As another consequence, solving of ode y'=c*x is not correct
> ...
> the answer should be something like 1/2*c*x^2 + c1

This one is resolved in #16007. So it seems only variables are left (#8734).



---

archive/issue_comments_048972.json:
```json
{
    "body": "Changed dependencies from **#8734** to **#8734, #16007**",
    "created_at": "2014-03-26T16:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48972",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#8734** to **#8734, #16007**



---

archive/issue_comments_048973.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYes, variables are all that's left, but the other way around!   (Don't forget the initial examples of this ticket.) We need to disambiguate Maxima variables like `i` and `e` from the things that become those in Sage - `%i` and `%e`.   I suppose one could take the Maxima variables `i` and `I` and turn them into `_i` and `_I`, and likewise for e, as at #16007, but I'm not sure if that's ideal or not.  Thoughts?",
    "created_at": "2014-03-27T16:43:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48973",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">comment:15</div>

Yes, variables are all that's left, but the other way around!   (Don't forget the initial examples of this ticket.) We need to disambiguate Maxima variables like `i` and `e` from the things that become those in Sage - `%i` and `%e`.   I suppose one could take the Maxima variables `i` and `I` and turn them into `_i` and `_I`, and likewise for e, as at #16007, but I'm not sure if that's ideal or not.  Thoughts?



---

archive/issue_events_083593.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83593"
}
```



---

archive/issue_events_083594.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83594"
}
```



---

archive/issue_comments_048974.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nPriority changed as the more important fixes were outsourced to other tickets.",
    "created_at": "2014-06-06T13:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48974",
    "user": "https://github.com/rwst"
}
```

<div id="comment:17" align="right">comment:17</div>

Priority changed as the more important fixes were outsourced to other tickets.



---

archive/issue_events_083595.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-06T13:41:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83595"
}
```



---

archive/issue_events_083596.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-06T13:41:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83596"
}
```



---

archive/issue_comments_048975.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> Priority changed as the more important fixes were outsourced to other tickets.\n\nHmm, though the BDFL originally reported this with the comment\n\n```\nI think my email must have not been clear.  I think it's an instance   \nof a *HUGE BUG* in Sage.  No more, no less.    \n```",
    "created_at": "2014-06-10T00:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48975",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

> Priority changed as the more important fixes were outsourced to other tickets.

Hmm, though the BDFL originally reported this with the comment

```
I think my email must have not been clear.  I think it's an instance   
of a *HUGE BUG* in Sage.  No more, no less.    
```



---

archive/issue_comments_048976.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMaybe we can change the Maxima `i` and `e` to Sage `_i` and `_e`, leaving `%i` and `%e` to become `i` and `e` as currently, and then taking advantage of the last changes at #16007 for typesetting more-or-less properly.",
    "created_at": "2014-06-24T15:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48976",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

Maybe we can change the Maxima `i` and `e` to Sage `_i` and `_e`, leaving `%i` and `%e` to become `i` and `e` as currently, and then taking advantage of the last changes at #16007 for typesetting more-or-less properly.



---

archive/issue_events_083597.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-06-24T15:47:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83597"
}
```



---

archive/issue_events_083598.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-06-24T15:47:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83598"
}
```



---

archive/issue_comments_048977.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe original bug report on sage-devel had:\n\n```\nsage: var('i')\ni\nsage: i\ni\nsage: a = i^2\nsage: a.simplify_full()\n-1\n```\nHowever, with develop I get `i^2`. Is this ticket still valid?",
    "created_at": "2014-06-26T09:39:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48977",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">comment:20</div>

The original bug report on sage-devel had:

```
sage: var('i')
i
sage: i
i
sage: a = i^2
sage: a.simplify_full()
-1
```
However, with develop I get `i^2`. Is this ticket still valid?



---

archive/issue_events_083599.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T09:39:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83599"
}
```



---

archive/issue_comments_048978.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAnd indeed,\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('i')\ni\nsage: symbolic_expression_from_maxima_string('%i')\nI\n```\nAnd the original solving case William reported is also fixed.  \n\nHuh.  Is this before or after #8734? (I would imagine that one would have an impact.)  Anyway, I would say we add some doctests (for both the `sefms` and `i^2` cases) and call it a day, regardless of which ticket it depends on.  Good work, since ideally one wouldn't be creating a Maxima `i` and then trying to bring it to Sage.",
    "created_at": "2014-06-26T12:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48978",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

And indeed,

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('i')
i
sage: symbolic_expression_from_maxima_string('%i')
I
```
And the original solving case William reported is also fixed.  

Huh.  Is this before or after #8734? (I would imagine that one would have an impact.)  Anyway, I would say we add some doctests (for both the `sefms` and `i^2` cases) and call it a day, regardless of which ticket it depends on.  Good work, since ideally one wouldn't be creating a Maxima `i` and then trying to bring it to Sage.



---

archive/issue_events_083600.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T16:48:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83600"
}
```



---

archive/issue_events_083601.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T16:48:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83601"
}
```



---

archive/issue_comments_048979.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWith develop:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('t')\nt\nsage: symbolic_expression_from_maxima_string('i')\nI\nsage: var('i')\ni\nsage: symbolic_expression_from_maxima_string('i')\ni\n```\nSo that example is a different animal than the ticket case.",
    "created_at": "2014-06-26T16:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48979",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

With develop:

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('t')
t
sage: symbolic_expression_from_maxima_string('i')
I
sage: var('i')
i
sage: symbolic_expression_from_maxima_string('i')
i
```
So that example is a different animal than the ticket case.



---

archive/issue_comments_048980.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOkay, I see.  But the thing is that, in principle, we should never get `i` inside Maxima without asking for it via Sage having a variable `i`; we should only get `%i` the imaginary in Maxima, which translates differently (and correctly) now.  Does that make sense, or do you think this is still worth fixing?  (We should check what happens with `e` as well, maybe via `ln(e)`.)",
    "created_at": "2014-06-26T19:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48980",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>

Okay, I see.  But the thing is that, in principle, we should never get `i` inside Maxima without asking for it via Sage having a variable `i`; we should only get `%i` the imaginary in Maxima, which translates differently (and correctly) now.  Does that make sense, or do you think this is still worth fixing?  (We should check what happens with `e` as well, maybe via `ln(e)`.)



---

archive/issue_comments_048981.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nWith #8734 `I` can result from a Sage `I` variable, from Maxima `%i`, or from Maxima `i` which is only creatable from Sage via the Maxima interface. But not from any trick involving the Sage variable `i` due to the protection via `_SAGE_VAR_`. The `i` case is why Jason said #8734 will help, but not totally solve the problem.\n\nI don't know why the `i^2` example failed at all, and when exactly it stopped failing. Maybe it didn't fail; certainly nobody posted a confirmation message. And certainly we all confirmed the sefms snippet because that's what the ticket presented.",
    "created_at": "2014-06-26T20:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48981",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

With #8734 `I` can result from a Sage `I` variable, from Maxima `%i`, or from Maxima `i` which is only creatable from Sage via the Maxima interface. But not from any trick involving the Sage variable `i` due to the protection via `_SAGE_VAR_`. The `i` case is why Jason said #8734 will help, but not totally solve the problem.

I don't know why the `i^2` example failed at all, and when exactly it stopped failing. Maybe it didn't fail; certainly nobody posted a confirmation message. And certainly we all confirmed the sefms snippet because that's what the ticket presented.



---

archive/issue_comments_048982.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYeah, even in Sage 4.4.4 (which I have lying around due to some custom fixes I use for research I'm too lazy to update) \n\n```\nsage: var('i')\ni\nsage: i\ni\nsage: a = i^2\nsage: a\ni^2\nsage: a.simplify_full()\ni^2\n```\nYour thoughts on a resolution?  The thing that was a bug is not there any more, and the only potential bug is from 'user error', in some sense.",
    "created_at": "2014-06-26T21:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48982",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

Yeah, even in Sage 4.4.4 (which I have lying around due to some custom fixes I use for research I'm too lazy to update) 

```
sage: var('i')
i
sage: i
i
sage: a = i^2
sage: a
i^2
sage: a.simplify_full()
i^2
```
Your thoughts on a resolution?  The thing that was a bug is not there any more, and the only potential bug is from 'user error', in some sense.



---

archive/issue_comments_048983.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAt the moment we also get behaviour like\n\n```\nsage: symbolic_expression_from_maxima_string('%inf')\nInf\n```\nso I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.",
    "created_at": "2014-06-27T09:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48983",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">comment:26</div>

At the moment we also get behaviour like

```
sage: symbolic_expression_from_maxima_string('%inf')
Inf
```
so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.



---

archive/issue_comments_048984.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,9 +6,11 @@\n I\n sage: symbolic_expression_from_maxima_string('i')\n I\n+sage: symbolic_expression_from_maxima_string('%inf')\n+Inf\n -----------\n \n So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n ```\n+The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n-See the sage-devel thread about this on Sept 3 for some discussion and motivation.\n``````\n",
    "created_at": "2014-06-27T09:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48984",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,9 +6,11 @@
 I
 sage: symbolic_expression_from_maxima_string('i')
 I
+sage: symbolic_expression_from_maxima_string('%inf')
+Inf
 -----------
 
 So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
 ```
+The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
-See the sage-devel thread about this on Sept 3 for some discussion and motivation.
``````




---

archive/issue_events_083602.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2014-06-27T09:18:56Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "subject": "https://github.com/rwst",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83602"
}
```



---

archive/issue_events_083603.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-27T09:18:56Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "subject": "https://github.com/rwst",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83603"
}
```



---

archive/issue_events_083604.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-27T09:18:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "title_is": "bugs in conversion of variable names from Maxima to Sage",
    "title_was": "bug in conversion of \"i\" from Maxima to Sage",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83604"
}
```



---

archive/issue_comments_048985.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n> At the moment we also get behaviour like\n> \n> ```\n> sage: symbolic_expression_from_maxima_string('%inf')\n> Inf\n> ```\n\nIs `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n> so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n\nI guess one could do so... I'm just trying to imagine cases in which this would be necessary due only to Sage usage.  If someone uses Maxima to create variables it's quite different.",
    "created_at": "2014-06-27T12:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48985",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:27" align="right">comment:27</div>

> At the moment we also get behaviour like
> 
> ```
> sage: symbolic_expression_from_maxima_string('%inf')
> Inf
> ```

Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.
> so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.

I guess one could do so... I'm just trying to imagine cases in which this would be necessary due only to Sage usage.  If someone uses Maxima to create variables it's quite different.



---

archive/issue_comments_048986.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@kcrisman](#comment:27):\n> Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n\nNo but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.",
    "created_at": "2014-06-27T14:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48986",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@kcrisman](#comment:27):
> Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.

No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.



---

archive/issue_comments_048987.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,4 @@\n ```\n The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n+We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n``````\n",
    "created_at": "2014-06-27T14:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48987",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,4 @@
 ```
 The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
+We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.
``````




---

archive/issue_comments_048988.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n> > Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n\n> No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.\n\nAha!  I didn't catch that was the reason.  I don't think Maxima introduces many new constants with `%` but I see your point.",
    "created_at": "2014-06-27T14:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48988",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">comment:30</div>

> > Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.

> No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.

Aha!  I didn't catch that was the reason.  I don't think Maxima introduces many new constants with `%` but I see your point.



---

archive/issue_comments_048989.json:
```json
{
    "body": "Branch: **[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)**",
    "created_at": "2014-06-28T16:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48989",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)**



---

archive/issue_comments_048990.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2014-06-28T16:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48990",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_048991.json:
```json
{
    "body": "Commit: **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**",
    "created_at": "2014-06-28T16:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48991",
    "user": "https://github.com/rwst"
}
```

Commit: **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**



---

archive/issue_comments_048992.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e0738355f228ea068bea927f3025dcccb955b1c\">4e07383</a></td><td><code>6882: add rules for e, i, I</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5a53435bde170e774c4e1dafba8f333a9653330\">e5a5343</a></td><td><code>6882: do word search/replace for symtable keys</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c1b0eb5d6ff4b2b95487440c27c9879edb0131e\">4c1b0eb</a></td><td><code>6882: correction to previous commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c\">518de3e</a></td><td><code>6882: add symable rules for e,i,I; fix maxima_var; add doctests</code></td></tr></table>\n",
    "created_at": "2014-06-28T16:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48992",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">comment:32</div>

I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e0738355f228ea068bea927f3025dcccb955b1c">4e07383</a></td><td><code>6882: add rules for e, i, I</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5a53435bde170e774c4e1dafba8f333a9653330">e5a5343</a></td><td><code>6882: do word search/replace for symtable keys</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c1b0eb5d6ff4b2b95487440c27c9879edb0131e">4c1b0eb</a></td><td><code>6882: correction to previous commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c">518de3e</a></td><td><code>6882: add symable rules for e,i,I; fix maxima_var; add doctests</code></td></tr></table>




---

archive/issue_events_083605.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-28T16:27:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83605"
}
```



---

archive/issue_events_083606.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-28T16:27:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83606"
}
```



---

archive/issue_comments_048993.json:
```json
{
    "body": "Changed dependencies from **#8734, #16007** to none",
    "created_at": "2014-06-28T16:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48993",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#8734, #16007** to none



---

archive/issue_comments_048994.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,6 +12,6 @@\n \n So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n ```\n-The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n+The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n``````\n",
    "created_at": "2014-06-28T16:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48994",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,6 +12,6 @@
 
 So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
 ```
-The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
+The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
 We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.
``````




---

archive/issue_comments_048995.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\n> I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.\n\nYou'll note that `maxima_var` was never currently used in the codebase, so it wasn't a problem, more of just old code - [here](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/calculus/calculus.py#n1792) is where the `%` were all replaced.  If you wanted I guess you could just replace that with `_` and it would be much more efficient than doing this whole loop every time, or so it seems to me.  How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)  Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.",
    "created_at": "2014-06-30T14:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48995",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:34" align="right">comment:34</div>

> I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.

You'll note that `maxima_var` was never currently used in the codebase, so it wasn't a problem, more of just old code - [here](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/calculus/calculus.py#n1792) is where the `%` were all replaced.  If you wanted I guess you could just replace that with `_` and it would be much more efficient than doing this whole loop every time, or so it seems to me.  How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)  Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.



---

archive/issue_comments_048996.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@kcrisman](#comment:34):\n> How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)\n\nIt's within the measurement error:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms\nsage: var('v1,v2,v3')\n(v1, v2, v3)\nsage: ex=-1/3*(pi + 1)*(3*(euler_gamma - e)*(pi - 3*v1 - v1/arcsech(1) + e^(-1)/pi) - 6*v3^2*arcsinh(-v1 + e)/v2 - v2 - 3*log_gamma(v1*v3)/v2 - 3*e^(-254) + 3)*(-catalan/v3)^(twinprime*pi - 1/2*v1 - 1/2*v2)*inverse_jacobi_cs(1, v3)/jacobi_sc(1/arccos(-1/(v1*csc(v3))), v3/v1 + e) - 1/4*(2*v3^2*(e + 1) + ((e*log_integral(arcsech(exp_integral_e1(v2^mertens - 1) - 4)) + 15*v1 + jacobi_dn(v2, pi))*v1*e^(-1) + golden_ratio*pi^v1*(1/v3^12 + jacobi_ds(-10, csc(v3^2)))^(v2 - 1/2/v2)*sinh(v2*e)/((v1 + v2 + v3 + 1)*v2))/(v1^2*inverse_jacobi_nc(v1, -e)) - 2*bessel_Y(v3, v2))/v2 + v3/inverse_jacobi_sc(1, v2) - (v1 + 1)/((v2 + v3)*(2*(v1 + e)*(v3 - 1)/(pi + v1) + (-v3*sech(v1*v3)/v2)^(-e/v1))) + inverse_jacobi_cn(pi + v1*v3, pi - v3) + jacobi_sn(e, arctanh(-(-log_integral(2) + log_integral(jacobi_ds(-1, v3)))^v2*e)^(1/7*(18*v2 - v3)*(14*v2 + e)/(v3*arctan(1/v2)*kronecker_delta(v1, v3))))\nsage: timeit('sefms(str(ex))')\n5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n```\nObviously the whole routine takes so long that the loop doesn't signify. That may be worth an optimization ticket alone.\n> Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.\n\nJust put it in `symtable`, give it a special value, and ask for that value within the new loop. Having it all in the loop is more efficient than find every time.",
    "created_at": "2014-06-30T15:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48996",
    "user": "https://github.com/rwst"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@kcrisman](#comment:34):
> How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)

It's within the measurement error:

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms
sage: var('v1,v2,v3')
(v1, v2, v3)
sage: ex=-1/3*(pi + 1)*(3*(euler_gamma - e)*(pi - 3*v1 - v1/arcsech(1) + e^(-1)/pi) - 6*v3^2*arcsinh(-v1 + e)/v2 - v2 - 3*log_gamma(v1*v3)/v2 - 3*e^(-254) + 3)*(-catalan/v3)^(twinprime*pi - 1/2*v1 - 1/2*v2)*inverse_jacobi_cs(1, v3)/jacobi_sc(1/arccos(-1/(v1*csc(v3))), v3/v1 + e) - 1/4*(2*v3^2*(e + 1) + ((e*log_integral(arcsech(exp_integral_e1(v2^mertens - 1) - 4)) + 15*v1 + jacobi_dn(v2, pi))*v1*e^(-1) + golden_ratio*pi^v1*(1/v3^12 + jacobi_ds(-10, csc(v3^2)))^(v2 - 1/2/v2)*sinh(v2*e)/((v1 + v2 + v3 + 1)*v2))/(v1^2*inverse_jacobi_nc(v1, -e)) - 2*bessel_Y(v3, v2))/v2 + v3/inverse_jacobi_sc(1, v2) - (v1 + 1)/((v2 + v3)*(2*(v1 + e)*(v3 - 1)/(pi + v1) + (-v3*sech(v1*v3)/v2)^(-e/v1))) + inverse_jacobi_cn(pi + v1*v3, pi - v3) + jacobi_sn(e, arctanh(-(-log_integral(2) + log_integral(jacobi_ds(-1, v3)))^v2*e)^(1/7*(18*v2 - v3)*(14*v2 + e)/(v3*arctan(1/v2)*kronecker_delta(v1, v3))))
sage: timeit('sefms(str(ex))')
5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
```
Obviously the whole routine takes so long that the loop doesn't signify. That may be worth an optimization ticket alone.
> Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.

Just put it in `symtable`, give it a special value, and ask for that value within the new loop. Having it all in the loop is more efficient than find every time.



---

archive/issue_comments_048997.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@rwst](#comment:35):\n> \n> ```\n> sage: timeit('sefms(str(ex))')\n> 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n> 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n> ```\n\nIt calls 120 times the function `MaximaLib._eval_line()` which takes 17ms in average = 2 seconds. 17 ms is an eternity.",
    "created_at": "2014-06-30T16:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48997",
    "user": "https://github.com/rwst"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@rwst](#comment:35):
> 
> ```
> sage: timeit('sefms(str(ex))')
> 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
> 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
> ```

It calls 120 times the function `MaximaLib._eval_line()` which takes 17ms in average = 2 seconds. 17 ms is an eternity.



---

archive/issue_comments_048998.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n> > \n> > ```\n> > sage: timeit('sefms(str(ex))')\n> > 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n> > 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n> > ```\n\nWow, those timings are indeed an eternity, though presumably not for shorter expressions.  I'll put this ticket in my \"finally finish reviewing\" queue, then, for sure.",
    "created_at": "2014-06-30T16:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48998",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:37" align="right">comment:37</div>

> > 
> > ```
> > sage: timeit('sefms(str(ex))')
> > 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
> > 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
> > ```

Wow, those timings are indeed an eternity, though presumably not for shorter expressions.  I'll put this ticket in my "finally finish reviewing" queue, then, for sure.



---

archive/issue_comments_048999.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2014-07-02T02:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-48999",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_049000.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nWell, it's an improvement, though still not perfect:\n\n```\n# Before\nsage: sefms('%inf')\nInf\nsage: sefms('%minf')\n-Infinity\n# After\nsage: sefms('%inf')\n+Infinity\nsage: sefms('%minf')\n-Infinity\n```\nNeither of these are infinity in Maxima, of course.  And indeed here is what the [Maxima manual](http://maxima.sourceforge.net/docs/manual/en/maxima_6.html#SEC32) says about identifiers:\n\n```\n(%i1) %an_ordinary_identifier42;\n(%o1)               %an_ordinary_identifier42\n```\n\"A numeral may be the first character of an identifier if it is preceded by a backslash. \"  But I don't know that we need to translate all identifiers in Maxima to Sage here... I guess I'm torn about that.  \n\n```\nsage: timeit('sefms(str(ex))')\n5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n```\nOf course, thinking about it, that string is a Sage string, not a Maxima string, so `%time R = random_expr(50,nvars=2); sefms(repr(R._maxima_()))` is probably more accurate, but that is also wildly variant on the expression.\n\nOkay, as far as I can tell this will not break anything (let's really hope!) and fixes the actual problem without slowing down what is already a very slow process (even for `random_expr(5,nvars=2)` it's 2-3 milliseconds either way).  Step in right direction, and again most people should not be affected in the slightest.  If passes tests, let's get it in.",
    "created_at": "2014-07-02T02:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-49000",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:38" align="right">comment:38</div>

Well, it's an improvement, though still not perfect:

```
# Before
sage: sefms('%inf')
Inf
sage: sefms('%minf')
-Infinity
# After
sage: sefms('%inf')
+Infinity
sage: sefms('%minf')
-Infinity
```
Neither of these are infinity in Maxima, of course.  And indeed here is what the [Maxima manual](http://maxima.sourceforge.net/docs/manual/en/maxima_6.html#SEC32) says about identifiers:

```
(%i1) %an_ordinary_identifier42;
(%o1)               %an_ordinary_identifier42
```
"A numeral may be the first character of an identifier if it is preceded by a backslash. "  But I don't know that we need to translate all identifiers in Maxima to Sage here... I guess I'm torn about that.  

```
sage: timeit('sefms(str(ex))')
5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
```
Of course, thinking about it, that string is a Sage string, not a Maxima string, so `%time R = random_expr(50,nvars=2); sefms(repr(R._maxima_()))` is probably more accurate, but that is also wildly variant on the expression.

Okay, as far as I can tell this will not break anything (let's really hope!) and fixes the actual problem without slowing down what is already a very slow process (even for `random_expr(5,nvars=2)` it's 2-3 milliseconds either way).  Step in right direction, and again most people should not be affected in the slightest.  If passes tests, let's get it in.



---

archive/issue_events_083607.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-07-02T03:03:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83607"
}
```



---

archive/issue_events_083608.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-07-02T03:03:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83608"
}
```



---

archive/issue_events_083609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-03T12:41:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83609"
}
```



---

archive/issue_events_083610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "abfe262330183f8dd1a547f269457e6cbb800623",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-07-03T12:41:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-83610"
}
```



---

archive/issue_comments_049001.json:
```json
{
    "body": "Changed branch from **[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)** to **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**",
    "created_at": "2014-07-03T12:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-49001",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)** to **[`518de3e`](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)**
