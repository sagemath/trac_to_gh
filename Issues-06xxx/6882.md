# Issue 6882: bugs in conversion of variable names from Maxima to Sage

archive/issues_006882.json:
```json
{
    "body": "\n```\n-----------\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('%i')\nI\nsage: symbolic_expression_from_maxima_string('i')\nI\nsage: symbolic_expression_from_maxima_string('%inf')\nInf\n-----------\n\nSo as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n```\nThe ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n\nWe do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n\n**Assignee:** @rwst\n\n**CC:**  @robert-marik\n\n**Branch/Commit:** [518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Author:** Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/6882\n\n",
    "closed_at": "2014-07-03T12:41:31Z",
    "created_at": "2009-09-03T22:58:43Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "title": "bugs in conversion of variable names from Maxima to Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/6882",
    "user": "https://github.com/williamstein"
}
```

```
-----------
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('%i')
I
sage: symbolic_expression_from_maxima_string('i')
I
sage: symbolic_expression_from_maxima_string('%inf')
Inf
-----------

So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
```
The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.

We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.

**Assignee:** @rwst

**CC:**  @robert-marik

**Branch/Commit:** [518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)

**Reviewer:** Karl-Dieter Crisman

**Author:** Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/6882





---

archive/issue_comments_050480.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere is the relevant [discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/93713a7c32100625/31b2cd361def53b0?show_docid=31b2cd361def53b0#).",
    "created_at": "2009-10-23T23:57:48Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50480",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
Here is the relevant [discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/93713a7c32100625/31b2cd361def53b0?show_docid=31b2cd361def53b0#).



---

archive/issue_comments_050481.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis will also happen with %e and e, and any other similar pairs, so a fix should take care of all of them.",
    "created_at": "2009-10-24T00:04:01Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50481",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
This will also happen with %e and e, and any other similar pairs, so a fix should take care of all of them.



---

archive/issue_comments_050482.json:
```json
{
    "body": "<a id='comment:3'></a>\nAs another consequence, solving of ode y'=c*x is not correct, the free variable is messed up with a parameter, see [sage-devel](http://groups.google.cz/group/sage-devel/browse_thread/thread/e04cbc547095f2ac) - thanks for  \t \t\nYuri Karadzhov\n\n```\n[marik@um-bc107 /opt/sage-4.3.4]$ ./sage\n----------------------------------------------------------------------\n| Sage Version 4.3.4, Release Date: 2010-03-19                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('%c')\nc\nsage: c=var('c'); y=function('y',x); eq=diff(y,x)==c*x; eq\nD[0](y)(x) == c*x\nsage: desolve(eq,y,ivar=x)\n1/2*c*x^2 + c\n```\nthe answer should be something like 1/2*c*x^2 + c1",
    "created_at": "2010-03-23T21:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50482",
    "user": "https://github.com/robert-marik"
}
```

<a id='comment:3'></a>
As another consequence, solving of ode y'=c*x is not correct, the free variable is messed up with a parameter, see [sage-devel](http://groups.google.cz/group/sage-devel/browse_thread/thread/e04cbc547095f2ac) - thanks for  	 	
Yuri Karadzhov

```
[marik@um-bc107 /opt/sage-4.3.4]$ ./sage
----------------------------------------------------------------------
| Sage Version 4.3.4, Release Date: 2010-03-19                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('%c')
c
sage: c=var('c'); y=function('y',x); eq=diff(y,x)==c*x; eq
D[0](y)(x) == c*x
sage: desolve(eq,y,ivar=x)
1/2*c*x^2 + c
```
the answer should be something like 1/2*c*x^2 + c1



---

archive/issue_comments_050483.json:
```json
{
    "body": "<a id='comment:4'></a>\nSee #8734 for what I think is a \"needs work\" solution.",
    "created_at": "2010-05-03T17:35:13Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50483",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
See #8734 for what I think is a "needs work" solution.



---

archive/issue_comments_050484.json:
```json
{
    "body": "<a id='comment:5'></a>\nActually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.",
    "created_at": "2010-05-03T17:36:52Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50484",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.



---

archive/issue_comments_050485.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis should fix also #9421.",
    "created_at": "2010-07-04T15:53:31Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50485",
    "user": "https://github.com/robert-marik"
}
```

<a id='comment:6'></a>
This should fix also #9421.



---

archive/issue_comments_050486.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, in a situation where we *don't* have the duplication of constants, we get\n\n```\nsage: c\nTraceback (click to the left of this block for traceback)\n...\nNameError: name 'c' is not defined\n```\nwhich isn't good either, though apparently that part of the expression still has type SymbolicExpression.",
    "created_at": "2012-07-26T15:04:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50486",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Also, in a situation where we *don't* have the duplication of constants, we get

```
sage: c
Traceback (click to the left of this block for traceback)
...
NameError: name 'c' is not defined
```
which isn't good either, though apparently that part of the expression still has type SymbolicExpression.



---

archive/issue_events_045749.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45749"
}
```



---

archive/issue_events_045750.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45750"
}
```



---

archive/issue_events_045751.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45751"
}
```



---

archive/issue_events_045752.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45752"
}
```



---

archive/issue_comments_050487.json:
```json
{
    "body": "<a id='comment:10'></a>\nSet to critical due to dependent tickets.",
    "created_at": "2014-02-18T07:39:57Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50487",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
Set to critical due to dependent tickets.



---

archive/issue_events_045753.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-18T07:39:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45753"
}
```



---

archive/issue_comments_050488.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jason](#comment%3A5):\n> Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.\n\n\nIndeed, because the patch at #8734 (needing review) only is about vars, and it will only help with the problem in [comment:3](#comment%3A3) if the then marked sage vars are renamed to some other specific string before output in desolve...().",
    "created_at": "2014-03-24T17:59:05Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50488",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
Replying to [jason](#comment%3A5):
> Actually, I guess the patch at #8734 will *help* with the solution, but may not totally solve the problem.


Indeed, because the patch at #8734 (needing review) only is about vars, and it will only help with the problem in [comment:3](#comment%3A3) if the then marked sage vars are renamed to some other specific string before output in desolve...().



---

archive/issue_comments_050489.json:
```json
{
    "body": "**Dependencies:** #8734",
    "created_at": "2014-03-24T17:59:31Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50489",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #8734



---

archive/issue_comments_050490.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [robert.marik](#comment%3A3):\n> As another consequence, solving of ode y'=c*x is not correct\n> ...\n> the answer should be something like 1/2*c*x^2 + c1\n\n\nThis one is resolved in #16007. So it seems only variables are left (#8734).",
    "created_at": "2014-03-26T16:07:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50490",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Replying to [robert.marik](#comment%3A3):
> As another consequence, solving of ode y'=c*x is not correct
> ...
> the answer should be something like 1/2*c*x^2 + c1


This one is resolved in #16007. So it seems only variables are left (#8734).



---

archive/issue_comments_050491.json:
```json
{
    "body": "**Changing dependencies** from \"#8734\" to \"#8734, #16007\".",
    "created_at": "2014-03-26T16:07:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50491",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#8734" to "#8734, #16007".



---

archive/issue_comments_050492.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, variables are all that's left, but the other way around!   (Don't forget the initial examples of this ticket.) We need to disambiguate Maxima variables like `i` and `e` from the things that become those in Sage - `%i` and `%e`.   I suppose one could take the Maxima variables `i` and `I` and turn them into `_i` and `_I`, and likewise for e, as at #16007, but I'm not sure if that's ideal or not.  Thoughts?",
    "created_at": "2014-03-27T16:43:23Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50492",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
Yes, variables are all that's left, but the other way around!   (Don't forget the initial examples of this ticket.) We need to disambiguate Maxima variables like `i` and `e` from the things that become those in Sage - `%i` and `%e`.   I suppose one could take the Maxima variables `i` and `I` and turn them into `_i` and `_I`, and likewise for e, as at #16007, but I'm not sure if that's ideal or not.  Thoughts?



---

archive/issue_events_045754.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45754"
}
```



---

archive/issue_events_045755.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45755"
}
```



---

archive/issue_comments_050493.json:
```json
{
    "body": "<a id='comment:17'></a>\nPriority changed as the more important fixes were outsourced to other tickets.",
    "created_at": "2014-06-06T13:41:33Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50493",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>
Priority changed as the more important fixes were outsourced to other tickets.



---

archive/issue_events_045756.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-06T13:41:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45756"
}
```



---

archive/issue_events_045757.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-06T13:41:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45757"
}
```



---

archive/issue_comments_050494.json:
```json
{
    "body": "<a id='comment:18'></a>\n> Priority changed as the more important fixes were outsourced to other tickets.\n\nHmm, though the BDFL originally reported this with the comment\n\n```\nI think my email must have not been clear.  I think it's an instance   \nof a *HUGE BUG* in Sage.  No more, no less.    \n```",
    "created_at": "2014-06-10T00:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50494",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
> Priority changed as the more important fixes were outsourced to other tickets.

Hmm, though the BDFL originally reported this with the comment

```
I think my email must have not been clear.  I think it's an instance   
of a *HUGE BUG* in Sage.  No more, no less.    
```



---

archive/issue_comments_050495.json:
```json
{
    "body": "<a id='comment:19'></a>\nMaybe we can change the Maxima `i` and `e` to Sage `_i` and `_e`, leaving `%i` and `%e` to become `i` and `e` as currently, and then taking advantage of the last changes at #16007 for typesetting more-or-less properly.",
    "created_at": "2014-06-24T15:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50495",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
Maybe we can change the Maxima `i` and `e` to Sage `_i` and `_e`, leaving `%i` and `%e` to become `i` and `e` as currently, and then taking advantage of the last changes at #16007 for typesetting more-or-less properly.



---

archive/issue_events_045758.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-06-24T15:47:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45758"
}
```



---

archive/issue_comments_050496.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe original bug report on sage-devel had:\n\n```\nsage: var('i')\ni\nsage: i\ni\nsage: a = i^2\nsage: a.simplify_full()\n-1\n```\nHowever, with develop I get `i^2`. Is this ticket still valid?",
    "created_at": "2014-06-26T09:39:30Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50496",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>
The original bug report on sage-devel had:

```
sage: var('i')
i
sage: i
i
sage: a = i^2
sage: a.simplify_full()
-1
```
However, with develop I get `i^2`. Is this ticket still valid?



---

archive/issue_events_045759.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T09:39:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45759"
}
```



---

archive/issue_comments_050497.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnd indeed,\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('i')\ni\nsage: symbolic_expression_from_maxima_string('%i')\nI\n```\nAnd the original solving case William reported is also fixed.  \n\nHuh.  Is this before or after #8734? (I would imagine that one would have an impact.)  Anyway, I would say we add some doctests (for both the `sefms` and `i^2` cases) and call it a day, regardless of which ticket it depends on.  Good work, since ideally one wouldn't be creating a Maxima `i` and then trying to bring it to Sage.",
    "created_at": "2014-06-26T12:55:18Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50497",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
And indeed,

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('i')
i
sage: symbolic_expression_from_maxima_string('%i')
I
```
And the original solving case William reported is also fixed.  

Huh.  Is this before or after #8734? (I would imagine that one would have an impact.)  Anyway, I would say we add some doctests (for both the `sefms` and `i^2` cases) and call it a day, regardless of which ticket it depends on.  Good work, since ideally one wouldn't be creating a Maxima `i` and then trying to bring it to Sage.



---

archive/issue_events_045760.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T16:48:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45760"
}
```



---

archive/issue_events_045761.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-26T16:48:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45761"
}
```



---

archive/issue_comments_050498.json:
```json
{
    "body": "<a id='comment:22'></a>\nWith develop:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string\nsage: symbolic_expression_from_maxima_string('t')\nt\nsage: symbolic_expression_from_maxima_string('i')\nI\nsage: var('i')\ni\nsage: symbolic_expression_from_maxima_string('i')\ni\n```\nSo that example is a different animal than the ticket case.",
    "created_at": "2014-06-26T16:48:28Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50498",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
With develop:

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string
sage: symbolic_expression_from_maxima_string('t')
t
sage: symbolic_expression_from_maxima_string('i')
I
sage: var('i')
i
sage: symbolic_expression_from_maxima_string('i')
i
```
So that example is a different animal than the ticket case.



---

archive/issue_comments_050499.json:
```json
{
    "body": "<a id='comment:23'></a>\nOkay, I see.  But the thing is that, in principle, we should never get `i` inside Maxima without asking for it via Sage having a variable `i`; we should only get `%i` the imaginary in Maxima, which translates differently (and correctly) now.  Does that make sense, or do you think this is still worth fixing?  (We should check what happens with `e` as well, maybe via `ln(e)`.)",
    "created_at": "2014-06-26T19:50:30Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50499",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:23'></a>
Okay, I see.  But the thing is that, in principle, we should never get `i` inside Maxima without asking for it via Sage having a variable `i`; we should only get `%i` the imaginary in Maxima, which translates differently (and correctly) now.  Does that make sense, or do you think this is still worth fixing?  (We should check what happens with `e` as well, maybe via `ln(e)`.)



---

archive/issue_comments_050500.json:
```json
{
    "body": "<a id='comment:24'></a>\nWith #8734 `I` can result from a Sage `I` variable, from Maxima `%i`, or from Maxima `i` which is only creatable from Sage via the Maxima interface. But not from any trick involving the Sage variable `i` due to the protection via `_SAGE_VAR_`. The `i` case is why Jason said #8734 will help, but not totally solve the problem.\n\nI don't know why the `i^2` example failed at all, and when exactly it stopped failing. Maybe it didn't fail; certainly nobody posted a confirmation message. And certainly we all confirmed the sefms snippet because that's what the ticket presented.",
    "created_at": "2014-06-26T20:48:09Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50500",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'></a>
With #8734 `I` can result from a Sage `I` variable, from Maxima `%i`, or from Maxima `i` which is only creatable from Sage via the Maxima interface. But not from any trick involving the Sage variable `i` due to the protection via `_SAGE_VAR_`. The `i` case is why Jason said #8734 will help, but not totally solve the problem.

I don't know why the `i^2` example failed at all, and when exactly it stopped failing. Maybe it didn't fail; certainly nobody posted a confirmation message. And certainly we all confirmed the sefms snippet because that's what the ticket presented.



---

archive/issue_comments_050501.json:
```json
{
    "body": "<a id='comment:25'></a>\nYeah, even in Sage 4.4.4 (which I have lying around due to some custom fixes I use for research I'm too lazy to update) \n\n```\nsage: var('i')\ni\nsage: i\ni\nsage: a = i^2\nsage: a\ni^2\nsage: a.simplify_full()\ni^2\n```\nYour thoughts on a resolution?  The thing that was a bug is not there any more, and the only potential bug is from 'user error', in some sense.",
    "created_at": "2014-06-26T21:10:59Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50501",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:25'></a>
Yeah, even in Sage 4.4.4 (which I have lying around due to some custom fixes I use for research I'm too lazy to update) 

```
sage: var('i')
i
sage: i
i
sage: a = i^2
sage: a
i^2
sage: a.simplify_full()
i^2
```
Your thoughts on a resolution?  The thing that was a bug is not there any more, and the only potential bug is from 'user error', in some sense.



---

archive/issue_comments_050502.json:
```json
{
    "body": "<a id='comment:26'></a>\nAt the moment we also get behaviour like\n\n```\nsage: symbolic_expression_from_maxima_string('%inf')\nInf\n```\nso I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.",
    "created_at": "2014-06-27T09:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50502",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'></a>
At the moment we also get behaviour like

```
sage: symbolic_expression_from_maxima_string('%inf')
Inf
```
so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.



---

archive/issue_comments_050503.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,9 +6,11 @@\n I\n sage: symbolic_expression_from_maxima_string('i')\n I\n+sage: symbolic_expression_from_maxima_string('%inf')\n+Inf\n -----------\n \n So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n ```\n+The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n-See the sage-devel thread about this on Sept 3 for some discussion and motivation.\n``````\n",
    "created_at": "2014-06-27T09:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50503",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,9 +6,11 @@
 I
 sage: symbolic_expression_from_maxima_string('i')
 I
+sage: symbolic_expression_from_maxima_string('%inf')
+Inf
 -----------
 
 So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
 ```
+The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
-See the sage-devel thread about this on Sept 3 for some discussion and motivation.
``````




---

archive/issue_comments_050504.json:
```json
{
    "body": "**Changing assignee** from @burcin to @rwst.",
    "created_at": "2014-06-27T09:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50504",
    "user": "https://github.com/rwst"
}
```

**Changing assignee** from @burcin to @rwst.



---

archive/issue_events_045762.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-27T09:18:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "rename": {
        "from": "bug in conversion of \"i\" from Maxima to Sage",
        "to": "bugs in conversion of variable names from Maxima to Sage"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45762"
}
```



---

archive/issue_comments_050505.json:
```json
{
    "body": "<a id='comment:27'></a>\n> At the moment we also get behaviour like\n> \n> ```\n> sage: symbolic_expression_from_maxima_string('%inf')\n> Inf\n> ```\n\nIs `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n> so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n\nI guess one could do so... I'm just trying to imagine cases in which this would be necessary due only to Sage usage.  If someone uses Maxima to create variables it's quite different.",
    "created_at": "2014-06-27T12:25:40Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50505",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:27'></a>
> At the moment we also get behaviour like
> 
> ```
> sage: symbolic_expression_from_maxima_string('%inf')
> Inf
> ```

Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.
> so I think the ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.

I guess one could do so... I'm just trying to imagine cases in which this would be necessary due only to Sage usage.  If someone uses Maxima to create variables it's quite different.



---

archive/issue_comments_050506.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [kcrisman](#comment%3A27):\n> Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n\nNo but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.",
    "created_at": "2014-06-27T14:34:25Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50506",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Replying to [kcrisman](#comment%3A27):
> Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.

No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.



---

archive/issue_comments_050507.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,3 +14,4 @@\n ```\n The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n+We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n``````\n",
    "created_at": "2014-06-27T14:35:51Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50507",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,3 +14,4 @@
 ```
 The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
+We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.
``````




---

archive/issue_comments_050508.json:
```json
{
    "body": "<a id='comment:30'></a>\n> > Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.\n\n> No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.\nAha!  I didn't catch that was the reason.  I don't think Maxima introduces many new constants with `%` but I see your point.",
    "created_at": "2014-06-27T14:44:44Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50508",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:30'></a>
> > Is `%inf` a normal Maxima expression, though?  They just use `inf` and `minf`, I believe, which we replace correctly.

> No but we do not want to be surprised when some new Maxima variable starting `%i` is introduced. At the moment it's really just a string replace from `%i` to `I`, without sense of word boundaries.
Aha!  I didn't catch that was the reason.  I don't think Maxima introduces many new constants with `%` but I see your point.



---

archive/issue_comments_050509.json:
```json
{
    "body": "**Branch:** [u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)",
    "created_at": "2014-06-28T16:20:53Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50509",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)



---

archive/issue_comments_050510.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2014-06-28T16:27:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50510",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_050511.json:
```json
{
    "body": "**Commit:** [518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)",
    "created_at": "2014-06-28T16:27:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50511",
    "user": "https://github.com/rwst"
}
```

**Commit:** [518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)



---

archive/issue_comments_050512.json:
```json
{
    "body": "<a id='comment:32'></a>\nI also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e0738355f228ea068bea927f3025dcccb955b1c\">4e07383</a></td><td><code>6882: add rules for e, i, I</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5a53435bde170e774c4e1dafba8f333a9653330\">e5a5343</a></td><td><code>6882: do word search/replace for symtable keys</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c1b0eb5d6ff4b2b95487440c27c9879edb0131e\">4c1b0eb</a></td><td><code>6882: correction to previous commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c\">518de3e</a></td><td><code>6882: add symable rules for e,i,I; fix maxima_var; add doctests</code></td></tr></table>\n",
    "created_at": "2014-06-28T16:27:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50512",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'></a>
I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e0738355f228ea068bea927f3025dcccb955b1c">4e07383</a></td><td><code>6882: add rules for e, i, I</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5a53435bde170e774c4e1dafba8f333a9653330">e5a5343</a></td><td><code>6882: do word search/replace for symtable keys</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c1b0eb5d6ff4b2b95487440c27c9879edb0131e">4c1b0eb</a></td><td><code>6882: correction to previous commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c">518de3e</a></td><td><code>6882: add symable rules for e,i,I; fix maxima_var; add doctests</code></td></tr></table>




---

archive/issue_events_045763.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-28T16:27:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45763"
}
```



---

archive/issue_events_045764.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-28T16:27:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45764"
}
```



---

archive/issue_comments_050513.json:
```json
{
    "body": "**Changing dependencies** from \"#8734, #16007\" to \"\".",
    "created_at": "2014-06-28T16:27:04Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50513",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#8734, #16007" to "".



---

archive/issue_comments_050514.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,6 +12,6 @@\n \n So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!\n ```\n-The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n+The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.\n \n We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.\n``````\n",
    "created_at": "2014-06-28T16:33:18Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50514",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,6 +12,6 @@
 
 So as you see, we are converting both '%i' and 'i' to  imaginary 'I' !!!!
 ```
-The ticket should implement `multi_word_replace()` in `sage.misc.multireplace` and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
+The ticket should implement a multi word replace and use that on a symtable with additional entries `'e':'_e', 'i':'_i', 'I':'_I'`.
 
 We do not want to be surprised when some new Maxima variable starting %i is introduced. At the moment it's really just a string replace from %i to I, without sense of word boundaries.
``````




---

archive/issue_comments_050515.json:
```json
{
    "body": "<a id='comment:34'></a>\n> I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.\n\nYou'll note that `maxima_var` was never currently used in the codebase, so it wasn't a problem, more of just old code - [here](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/calculus/calculus.py#n1792) is where the `%` were all replaced.  If you wanted I guess you could just replace that with `_` and it would be much more efficient than doing this whole loop every time, or so it seems to me.  How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)  Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.",
    "created_at": "2014-06-30T14:36:27Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50515",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:34'></a>
> I also found an error in the definition for maxima variable, because it didn't allow variable names without '%' or the '%' not at the beginning. Now the mentioned rules can be expressed as simple entries in symtable.

You'll note that `maxima_var` was never currently used in the codebase, so it wasn't a problem, more of just old code - [here](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/calculus/calculus.py#n1792) is where the `%` were all replaced.  If you wanted I guess you could just replace that with `_` and it would be much more efficient than doing this whole loop every time, or so it seems to me.  How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)  Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.



---

archive/issue_comments_050516.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [kcrisman](#comment%3A34):\n> How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)\n\nIt's within the measurement error:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms\nsage: var('v1,v2,v3')\n(v1, v2, v3)\nsage: ex=-1/3*(pi + 1)*(3*(euler_gamma - e)*(pi - 3*v1 - v1/arcsech(1) + e^(-1)/pi) - 6*v3^2*arcsinh(-v1 + e)/v2 - v2 - 3*log_gamma(v1*v3)/v2 - 3*e^(-254) + 3)*(-catalan/v3)^(twinprime*pi - 1/2*v1 - 1/2*v2)*inverse_jacobi_cs(1, v3)/jacobi_sc(1/arccos(-1/(v1*csc(v3))), v3/v1 + e) - 1/4*(2*v3^2*(e + 1) + ((e*log_integral(arcsech(exp_integral_e1(v2^mertens - 1) - 4)) + 15*v1 + jacobi_dn(v2, pi))*v1*e^(-1) + golden_ratio*pi^v1*(1/v3^12 + jacobi_ds(-10, csc(v3^2)))^(v2 - 1/2/v2)*sinh(v2*e)/((v1 + v2 + v3 + 1)*v2))/(v1^2*inverse_jacobi_nc(v1, -e)) - 2*bessel_Y(v3, v2))/v2 + v3/inverse_jacobi_sc(1, v2) - (v1 + 1)/((v2 + v3)*(2*(v1 + e)*(v3 - 1)/(pi + v1) + (-v3*sech(v1*v3)/v2)^(-e/v1))) + inverse_jacobi_cn(pi + v1*v3, pi - v3) + jacobi_sn(e, arctanh(-(-log_integral(2) + log_integral(jacobi_ds(-1, v3)))^v2*e)^(1/7*(18*v2 - v3)*(14*v2 + e)/(v3*arctan(1/v2)*kronecker_delta(v1, v3))))\nsage: timeit('sefms(str(ex))')\n5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n```\nObviously the whole routine takes so long that the loop doesn't signify. That may be worth an optimization ticket alone.\n> Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.\n\nJust put it in `symtable`, give it a special value, and ask for that value within the new loop. Having it all in the loop is more efficient than find every time.",
    "created_at": "2014-06-30T15:30:47Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50516",
    "user": "https://github.com/rwst"
}
```

<a id='comment:35'></a>
Replying to [kcrisman](#comment%3A34):
> How does this do with `timeit` for long expressions one gets in 'real life'?  (See sage/symbolic/random_tests.py.)

It's within the measurement error:

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms
sage: var('v1,v2,v3')
(v1, v2, v3)
sage: ex=-1/3*(pi + 1)*(3*(euler_gamma - e)*(pi - 3*v1 - v1/arcsech(1) + e^(-1)/pi) - 6*v3^2*arcsinh(-v1 + e)/v2 - v2 - 3*log_gamma(v1*v3)/v2 - 3*e^(-254) + 3)*(-catalan/v3)^(twinprime*pi - 1/2*v1 - 1/2*v2)*inverse_jacobi_cs(1, v3)/jacobi_sc(1/arccos(-1/(v1*csc(v3))), v3/v1 + e) - 1/4*(2*v3^2*(e + 1) + ((e*log_integral(arcsech(exp_integral_e1(v2^mertens - 1) - 4)) + 15*v1 + jacobi_dn(v2, pi))*v1*e^(-1) + golden_ratio*pi^v1*(1/v3^12 + jacobi_ds(-10, csc(v3^2)))^(v2 - 1/2/v2)*sinh(v2*e)/((v1 + v2 + v3 + 1)*v2))/(v1^2*inverse_jacobi_nc(v1, -e)) - 2*bessel_Y(v3, v2))/v2 + v3/inverse_jacobi_sc(1, v2) - (v1 + 1)/((v2 + v3)*(2*(v1 + e)*(v3 - 1)/(pi + v1) + (-v3*sech(v1*v3)/v2)^(-e/v1))) + inverse_jacobi_cn(pi + v1*v3, pi - v3) + jacobi_sn(e, arctanh(-(-log_integral(2) + log_integral(jacobi_ds(-1, v3)))^v2*e)^(1/7*(18*v2 - v3)*(14*v2 + e)/(v3*arctan(1/v2)*kronecker_delta(v1, v3))))
sage: timeit('sefms(str(ex))')
5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
```
Obviously the whole routine takes so long that the loop doesn't signify. That may be worth an optimization ticket alone.
> Also note that usually we end up having to special-case things with `%` anyway - e.g., `%ilt` (inverse Laplace transform) gets handled somewhere else, I'd have to look up where.

Just put it in `symtable`, give it a special value, and ask for that value within the new loop. Having it all in the loop is more efficient than find every time.



---

archive/issue_comments_050517.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [rws](#comment%3A35):\n> \n> ```\n> sage: timeit('sefms(str(ex))')\n> 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n> 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n> ```\n\nIt calls 120 times the function `MaximaLib._eval_line()` which takes 17ms in average = 2 seconds. 17 ms is an eternity.",
    "created_at": "2014-06-30T16:06:17Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50517",
    "user": "https://github.com/rwst"
}
```

<a id='comment:36'></a>
Replying to [rws](#comment%3A35):
> 
> ```
> sage: timeit('sefms(str(ex))')
> 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
> 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
> ```

It calls 120 times the function `MaximaLib._eval_line()` which takes 17ms in average = 2 seconds. 17 ms is an eternity.



---

archive/issue_comments_050518.json:
```json
{
    "body": "<a id='comment:37'></a>\n> > \n> > ```\n> > sage: timeit('sefms(str(ex))')\n> > 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n> > 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n> > ```\n\nWow, those timings are indeed an eternity, though presumably not for shorter expressions.  I'll put this ticket in my \"finally finish reviewing\" queue, then, for sure.",
    "created_at": "2014-06-30T16:10:19Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50518",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:37'></a>
> > 
> > ```
> > sage: timeit('sefms(str(ex))')
> > 5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
> > 5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
> > ```

Wow, those timings are indeed an eternity, though presumably not for shorter expressions.  I'll put this ticket in my "finally finish reviewing" queue, then, for sure.



---

archive/issue_comments_050519.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2014-07-02T02:44:01Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50519",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_050520.json:
```json
{
    "body": "<a id='comment:38'></a>\nWell, it's an improvement, though still not perfect:\n\n```\n# Before\nsage: sefms('%inf')\nInf\nsage: sefms('%minf')\n-Infinity\n# After\nsage: sefms('%inf')\n+Infinity\nsage: sefms('%minf')\n-Infinity\n```\nNeither of these are infinity in Maxima, of course.  And indeed here is what the [Maxima manual](http://maxima.sourceforge.net/docs/manual/en/maxima_6.html#SEC32) says about identifiers:\n\n```\n(%i1) %an_ordinary_identifier42;\n(%o1)               %an_ordinary_identifier42\n```\n\"A numeral may be the first character of an identifier if it is preceded by a backslash. \"  But I don't know that we need to translate all identifiers in Maxima to Sage here... I guess I'm torn about that.  \n\n```\nsage: timeit('sefms(str(ex))')\n5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)\n5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)\n```\nOf course, thinking about it, that string is a Sage string, not a Maxima string, so `%time R = random_expr(50,nvars=2); sefms(repr(R._maxima_()))` is probably more accurate, but that is also wildly variant on the expression.\n\nOkay, as far as I can tell this will not break anything (let's really hope!) and fixes the actual problem without slowing down what is already a very slow process (even for `random_expr(5,nvars=2)` it's 2-3 milliseconds either way).  Step in right direction, and again most people should not be affected in the slightest.  If passes tests, let's get it in.",
    "created_at": "2014-07-02T02:44:01Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50520",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:38'></a>
Well, it's an improvement, though still not perfect:

```
# Before
sage: sefms('%inf')
Inf
sage: sefms('%minf')
-Infinity
# After
sage: sefms('%inf')
+Infinity
sage: sefms('%minf')
-Infinity
```
Neither of these are infinity in Maxima, of course.  And indeed here is what the [Maxima manual](http://maxima.sourceforge.net/docs/manual/en/maxima_6.html#SEC32) says about identifiers:

```
(%i1) %an_ordinary_identifier42;
(%o1)               %an_ordinary_identifier42
```
"A numeral may be the first character of an identifier if it is preceded by a backslash. "  But I don't know that we need to translate all identifiers in Maxima to Sage here... I guess I'm torn about that.  

```
sage: timeit('sefms(str(ex))')
5 loops, best of 3: 2.19/2.14/2.15 s per loop (without #6882)
5 loops, best of 3: 2.13/2.11/2.12 s per loop (with #6882)
```
Of course, thinking about it, that string is a Sage string, not a Maxima string, so `%time R = random_expr(50,nvars=2); sefms(repr(R._maxima_()))` is probably more accurate, but that is also wildly variant on the expression.

Okay, as far as I can tell this will not break anything (let's really hope!) and fixes the actual problem without slowing down what is already a very slow process (even for `random_expr(5,nvars=2)` it's 2-3 milliseconds either way).  Step in right direction, and again most people should not be affected in the slightest.  If passes tests, let's get it in.



---

archive/issue_events_045765.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-07-02T03:03:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45765"
}
```



---

archive/issue_events_045766.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-07-02T03:03:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45766"
}
```



---

archive/issue_events_045767.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-03T12:41:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45767"
}
```



---

archive/issue_events_045768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "abfe262330183f8dd1a547f269457e6cbb800623",
    "created_at": "2014-07-03T12:41:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/6882#event-45768"
}
```



---

archive/issue_comments_050521.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)\" to \"[518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)\".",
    "created_at": "2014-07-03T12:41:31Z",
    "issue": "https://github.com/sagemath/sage/issues/6882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/6882#issuecomment-50521",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bugs_in_conversion_of_variable_names_from_maxima_to_sage)" to "[518de3e62533cd209997107f903192f1a31d118c](https://github.com/sagemath/sagetrac-mirror/commit/518de3e62533cd209997107f903192f1a31d118c)".
