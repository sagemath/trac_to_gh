# Issue 6864: Stop Sage tests from saving things to hard drive

archive/issues_006864.json:
```json
{
    "body": "As far as I can tell, there are several objects that are saved when you run sage -t.  One example is \n\n```\n    sage: from pylab import *\n    sage: t = arange(0.0, 2.0, 0.01)\n    sage: s = sin(2*pi*t)\n    sage: P = plot(t, s, linewidth=1.0)\n    sage: xl = xlabel('time (s)')\n    sage: yl = ylabel('voltage (mV)')\n    sage: t = title('About as simple as it gets, folks')\n    sage: grid(True)\n    sage: savefig('sage.png')\n```\nin sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.  \n\nThe point is these should not be cluttering up one's home directory.  This one seems to do it right:\n\n```\nsage: text(\"sage\", (0,0), rgbcolor=(0,0,0)).save(SAGE_TMP + 'a.pdf')\n```\nwhich is in the sage/plot/text.py, I think.  It does not show up in my home directory.\n\nI'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  Note also that there is a test.sobj and tmp.sws that get saved.  \n\n**Author:** John Palmieri\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Merged:** Sage 4.1.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/6864\n\n",
    "closed_at": "2009-09-16T04:02:30Z",
    "created_at": "2009-09-02T14:19:01Z",
    "labels": [
        "component: doctest coverage",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "Stop Sage tests from saving things to hard drive",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6864",
    "user": "https://github.com/kcrisman"
}
```
As far as I can tell, there are several objects that are saved when you run sage -t.  One example is 

```
    sage: from pylab import *
    sage: t = arange(0.0, 2.0, 0.01)
    sage: s = sin(2*pi*t)
    sage: P = plot(t, s, linewidth=1.0)
    sage: xl = xlabel('time (s)')
    sage: yl = ylabel('voltage (mV)')
    sage: t = title('About as simple as it gets, folks')
    sage: grid(True)
    sage: savefig('sage.png')
```
in sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.  

The point is these should not be cluttering up one's home directory.  This one seems to do it right:

```
sage: text("sage", (0,0), rgbcolor=(0,0,0)).save(SAGE_TMP + 'a.pdf')
```
which is in the sage/plot/text.py, I think.  It does not show up in my home directory.

I'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  Note also that there is a test.sobj and tmp.sws that get saved.  

**Author:** John Palmieri

**Reviewer:** Karl-Dieter Crisman

**Merged:** Sage 4.1.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/6864





---

archive/attachments_008231.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sage.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6864/sage.png",
    "created_at": "2009-09-02T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_064574.json:
```json
{
    "body": "",
    "created_at": "2009-09-02T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64574",
    "user": "https://github.com/kcrisman"
}
```





---

archive/attachments_008232.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sage0.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6864/sage0.png",
    "created_at": "2009-09-02T14:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_064575.json:
```json
{
    "body": "",
    "created_at": "2009-09-02T14:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64575",
    "user": "https://github.com/kcrisman"
}
```





---

archive/attachments_008233.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "0.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6864/0.png",
    "created_at": "2009-09-02T14:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_064576.json:
```json
{
    "body": "",
    "created_at": "2009-09-02T14:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64576",
    "user": "https://github.com/kcrisman"
}
```





---

archive/attachments_008234.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "zz.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6864/zz.png",
    "created_at": "2009-09-02T14:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_064577.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2009-09-02T14:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64577",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>




---

archive/issue_comments_064578.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,13 +11,13 @@\n     sage: grid(True)\n     sage: savefig('sage.png')\n ```\n-in sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.\n+in sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.  \n \n-This one seems to do it right:\n+The point is these should not be cluttering up one's home directory.  This one seems to do it right:\n \n ```\n sage: text(\"sage\", (0,0), rgbcolor=(0,0,0)).save(SAGE_TMP + 'a.pdf')\n ```\n-which is in the sage/plot/text.py, I think.  \n+which is in the sage/plot/text.py, I think.  It does not show up in my home directory.\n \n-I'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  \n+I'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  Note also that there is a test.sobj and tmp.sws that get saved.  \n``````\n",
    "created_at": "2009-09-02T14:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64578",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,13 +11,13 @@
     sage: grid(True)
     sage: savefig('sage.png')
 ```
-in sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.
+in sage/plot/plot.py.  However, there are others, which are unfortunately not anywhere near as easy to find, since they don't have a goofy caption.  
 
-This one seems to do it right:
+The point is these should not be cluttering up one's home directory.  This one seems to do it right:
 
 ```
 sage: text("sage", (0,0), rgbcolor=(0,0,0)).save(SAGE_TMP + 'a.pdf')
 ```
-which is in the sage/plot/text.py, I think.  
+which is in the sage/plot/text.py, I think.  It does not show up in my home directory.
 
-I'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  
+I'm not sure what else there is for sure, but I get at the very least the graphics which are attached.  If you recognize them, post it here.  Note also that there is a test.sobj and tmp.sws that get saved.  
``````




---

archive/issue_comments_064579.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis ticket is a good idea.  Here are some things I've found:\n\nThe file 'zz.png' is from sage.misc.latex, the function `png`.  By the way, in that same file, the function `_run_latex_` saves its output to a temporary directory like this:\n\n```\n        sage: from sage.misc.latex import _run_latex_, _latex_file_\n        sage: from sage.misc.misc import tmp_dir\n        sage: base = tmp_dir()\n        sage: file = os.path.join(base, \"temp.tex\")\n        sage: O = open(file, 'w')\n        sage: O.write(_latex_file_([ZZ[x], RR])); O.close()\n        sage: _run_latex_(file) # random - depends on whether latex is installed\n        'dvi'\n```\nIn the class `ode_solver` in sage.gsl.ode, a file \"sage.png\" is produced: \n\n```\n         By default T.plot_solution() plots the y_0, to plot general y_i use\n         sage: T.plot_solution(i=0, filename='sage.png')\n         sage: T.plot_solution(i=1, filename='sage.png')\n         sage: T.plot_solution(i=2, filename='sage.png')\n```\nThis gets overwritten by the \"as simple as it gets\" example, though.\n\n`_import_worksheet_sws` in sage.server.notebook.notebook: produces the file \"tmp.sws\".  (Note that the file is exported and then imported again, so if we change the path name, it needs to be done in both places.)\n\nIn sage.structure.sage_object, we get sage.png and test.sobj, both in the function `save`.\n\n\"0.png\" seems to come from sage.databases.database, in the function `_apply_plot`, maybe.\n\nI'll try to track down the others later.",
    "created_at": "2009-09-02T17:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64579",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
This ticket is a good idea.  Here are some things I've found:

The file 'zz.png' is from sage.misc.latex, the function `png`.  By the way, in that same file, the function `_run_latex_` saves its output to a temporary directory like this:

```
        sage: from sage.misc.latex import _run_latex_, _latex_file_
        sage: from sage.misc.misc import tmp_dir
        sage: base = tmp_dir()
        sage: file = os.path.join(base, "temp.tex")
        sage: O = open(file, 'w')
        sage: O.write(_latex_file_([ZZ[x], RR])); O.close()
        sage: _run_latex_(file) # random - depends on whether latex is installed
        'dvi'
```
In the class `ode_solver` in sage.gsl.ode, a file "sage.png" is produced: 

```
         By default T.plot_solution() plots the y_0, to plot general y_i use
         sage: T.plot_solution(i=0, filename='sage.png')
         sage: T.plot_solution(i=1, filename='sage.png')
         sage: T.plot_solution(i=2, filename='sage.png')
```
This gets overwritten by the "as simple as it gets" example, though.

`_import_worksheet_sws` in sage.server.notebook.notebook: produces the file "tmp.sws".  (Note that the file is exported and then imported again, so if we change the path name, it needs to be done in both places.)

In sage.structure.sage_object, we get sage.png and test.sobj, both in the function `save`.

"0.png" seems to come from sage.databases.database, in the function `_apply_plot`, maybe.

I'll try to track down the others later.



---

archive/issue_comments_064580.json:
```json
{
    "body": "<a id='comment:3'></a>\nAnother one is in calculus/calculus.py, line 1200 \n\n```\n(p1+p2).save()\n```\nin a long differential equations example.  This is the one labeled sage0.png above.\n\nI think that leaves only sage2.png to be found.  This is a single point, and it's not clear if it comes from plotting or elsewhere. \n\nNotwithstanding that some optional doctests also save...",
    "created_at": "2009-09-02T17:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64580",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Another one is in calculus/calculus.py, line 1200 

```
(p1+p2).save()
```
in a long differential equations example.  This is the one labeled sage0.png above.

I think that leaves only sage2.png to be found.  This is a single point, and it's not clear if it comes from plotting or elsewhere. 

Notwithstanding that some optional doctests also save...



---

archive/issue_comments_064581.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [kcrisman](#comment%3A3):\n>\n> I think that leaves only sage2.png to be found.  This is a single point, and it's not clear if it comes from plotting or elsewhere. \n\n\nIt's from `visualize_structure` in sage.matrix.matrix2.",
    "created_at": "2009-09-02T19:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64581",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Replying to [kcrisman](#comment%3A3):
>
> I think that leaves only sage2.png to be found.  This is a single point, and it's not clear if it comes from plotting or elsewhere. 


It's from `visualize_structure` in sage.matrix.matrix2.



---

archive/issue_events_020154.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "label": "component: doctest",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6864#event-20154"
}
```



---

archive/issue_comments_064582.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-09-02T20:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64582",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_064583.json:
```json
{
    "body": "<a id='comment:5'></a>\nHere's a patch.  I couldn't figure out how to fix the one in database.py, so it is now \"not tested\".",
    "created_at": "2009-09-02T20:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64583",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Here's a patch.  I couldn't figure out how to fix the one in database.py, so it is now "not tested".



---

archive/issue_comments_064584.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2009-09-14T21:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64584",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to positive_review.



---

archive/attachments_008235.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6864-SAGETMP.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6864/trac_6864-SAGETMP.patch",
    "created_at": "2009-09-14T21:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_064585.json:
```json
{
    "body": "<a id='comment:6'></a>\nGreat!  Thanks.   This passes all relevant doctests and nothing appears in my home directory.  I think not testing that example will be okay.",
    "created_at": "2009-09-14T21:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64585",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
Great!  Thanks.   This passes all relevant doctests and nothing appears in my home directory.  I think not testing that example will be okay.



---

archive/issue_events_020155.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-09-16T04:02:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6864#event-20155"
}
```



---

archive/issue_comments_064586.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2009-09-16T04:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64586",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Author:** John Palmieri



---

archive/issue_comments_064587.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged `trac_6864-SAGETMP.patch`.",
    "created_at": "2009-09-16T04:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64587",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:7'></a>
Merged `trac_6864-SAGETMP.patch`.



---

archive/issue_comments_064588.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2009-09-16T04:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64588",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_064589.json:
```json
{
    "body": "**Merged:** Sage 4.1.2.alpha2",
    "created_at": "2009-09-16T04:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64589",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** Sage 4.1.2.alpha2



---

archive/issue_comments_064590.json:
```json
{
    "body": "<a id='comment:8'></a>\nSee #7059 for a followup.",
    "created_at": "2009-09-29T03:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6864#issuecomment-64590",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
See #7059 for a followup.
