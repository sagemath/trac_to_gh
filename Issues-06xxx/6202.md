# Issue 6202: [with patch, positive review] bitset "noise" on solaris sparc (mark)

archive/issues_006202.json:
```json
{
    "body": "```\n-bash-3.00$ pwd\n/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0\n\nsage -t  devel/sage/sage/misc/misc_c.pyx\n**********************************************************************\nFile \"/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0/devel/sage-main/sage/misc/misc_c.pyx\", line 359:\n    sage: test_bitset('00'*32, '01'*32, 64)\nExpected:\n    a 0000000000000000000000000000000000000000000000000000000000000000\n    a.size 64\n    len(a) 0\n    a.limbs ...\n    b 0101010101010101010101010101010101010101010101010101010101010101\n    a.in(n)   False\n    a.not_in(n)   True\n    a.add(n)     0000000000000000000000000000000000000000000000000000000000000000\n    a.discard(n)   0000000000000000000000000000000000000000000000000000000000000000\n    a.set_to(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.flip(n)    0000000000000000000000000000000000000000000000000000000000000000\n    a.isempty()  True\n    a.eq(b)      False\n    a.cmp(b)     -1\n    a.issubset(b) True\n    a.issuperset(b) False\n    a.copy()     0000000000000000000000000000000000000000000000000000000000000000\n    r.clear()     0000000000000000000000000000000000000000000000000000000000000000\n    complement a        1111111111111111111111111111111111111111111111111111111111111111\n    a intersect b      0000000000000000000000000000000000000000000000000000000000000000\n    a union b       0101010101010101010101010101010101010101010101010101010101010101\n    a minus b      0000000000000000000000000000000000000000000000000000000000000000\n    a symmetric_difference b      0101010101010101010101010101010101010101010101010101010101010101\n    a.rshift(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.lshift(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.first()           -1\n    a.next(n)           -1\n    a.first_diff(b)     1\n    a.next_diff(b, n)   -1\n    a.hamming_weight()  0\n    a.hamming_weight_sparse()  0\nGot:\n    a 0000000000000000000000000000000000000000000000000000000000000000\n    a.size 64\n    len(a) 0\n    a.limbs 2\n    b 0101010101010101010101010101010101010101010101010101010101010101\n    a.in(n)   True\n    a.not_in(n)   False\n    a.add(n)     0000000000000000000000000000000000000000000000000000000000000000\n    a.discard(n)   0000000000000000000000000000000000000000000000000000000000000000\n    a.set_to(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.flip(n)    0000000000000000000000000000000000000000000000000000000000000000\n    a.isempty()  True\n    a.eq(b)      False\n    a.cmp(b)     -1\n    a.issubset(b) True\n    a.issuperset(b) False\n    a.copy()     0000000000000000000000000000000000000000000000000000000000000000\n    r.clear()     0000000000000000000000000000000000000000000000000000000000000000\n    complement a        1111111111111111111111111111111111111111111111111111111111111111\n    a intersect b      0000000000000000000000000000000000000000000000000000000000000000\n    a union b       0101010101010101010101010101010101010101010101010101010101010101\n    a minus b      0000000000000000000000000000000000000000000000000000000000000000\n    a symmetric_difference b      0101010101010101010101010101010101010101010101010101010101010101\n    a.rshift(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.lshift(n)  0000000000000000000000000000000000000000000000000000000000000000\n    a.first()           -1\n    a.next(n)           -1\n    a.first_diff(b)     1\n    a.next_diff(b, n)   -1\n    a.hamming_weight()  0\n    a.hamming_weight_sparse()  0\n```\n\nAssignee: tbd\n\nResolution: fixed\n\nAuthor: Robert Bradshaw\n\nReviewer: William Stein\n\nMerged: 4.0.2.rc1\n\nIssue created by migration from https://trac.sagemath.org/ticket/6202\n\n",
    "closed_at": "2009-06-15T23:35:53Z",
    "created_at": "2009-06-03T23:09:18Z",
    "labels": [
        "component: porting: solaris",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0.2",
    "title": "[with patch, positive review] bitset \"noise\" on solaris sparc (mark)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6202",
    "user": "https://github.com/williamstein"
}
```
```
-bash-3.00$ pwd
/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0

sage -t  devel/sage/sage/misc/misc_c.pyx
**********************************************************************
File "/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0/devel/sage-main/sage/misc/misc_c.pyx", line 359:
    sage: test_bitset('00'*32, '01'*32, 64)
Expected:
    a 0000000000000000000000000000000000000000000000000000000000000000
    a.size 64
    len(a) 0
    a.limbs ...
    b 0101010101010101010101010101010101010101010101010101010101010101
    a.in(n)   False
    a.not_in(n)   True
    a.add(n)     0000000000000000000000000000000000000000000000000000000000000000
    a.discard(n)   0000000000000000000000000000000000000000000000000000000000000000
    a.set_to(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.flip(n)    0000000000000000000000000000000000000000000000000000000000000000
    a.isempty()  True
    a.eq(b)      False
    a.cmp(b)     -1
    a.issubset(b) True
    a.issuperset(b) False
    a.copy()     0000000000000000000000000000000000000000000000000000000000000000
    r.clear()     0000000000000000000000000000000000000000000000000000000000000000
    complement a        1111111111111111111111111111111111111111111111111111111111111111
    a intersect b      0000000000000000000000000000000000000000000000000000000000000000
    a union b       0101010101010101010101010101010101010101010101010101010101010101
    a minus b      0000000000000000000000000000000000000000000000000000000000000000
    a symmetric_difference b      0101010101010101010101010101010101010101010101010101010101010101
    a.rshift(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.lshift(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.first()           -1
    a.next(n)           -1
    a.first_diff(b)     1
    a.next_diff(b, n)   -1
    a.hamming_weight()  0
    a.hamming_weight_sparse()  0
Got:
    a 0000000000000000000000000000000000000000000000000000000000000000
    a.size 64
    len(a) 0
    a.limbs 2
    b 0101010101010101010101010101010101010101010101010101010101010101
    a.in(n)   True
    a.not_in(n)   False
    a.add(n)     0000000000000000000000000000000000000000000000000000000000000000
    a.discard(n)   0000000000000000000000000000000000000000000000000000000000000000
    a.set_to(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.flip(n)    0000000000000000000000000000000000000000000000000000000000000000
    a.isempty()  True
    a.eq(b)      False
    a.cmp(b)     -1
    a.issubset(b) True
    a.issuperset(b) False
    a.copy()     0000000000000000000000000000000000000000000000000000000000000000
    r.clear()     0000000000000000000000000000000000000000000000000000000000000000
    complement a        1111111111111111111111111111111111111111111111111111111111111111
    a intersect b      0000000000000000000000000000000000000000000000000000000000000000
    a union b       0101010101010101010101010101010101010101010101010101010101010101
    a minus b      0000000000000000000000000000000000000000000000000000000000000000
    a symmetric_difference b      0101010101010101010101010101010101010101010101010101010101010101
    a.rshift(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.lshift(n)  0000000000000000000000000000000000000000000000000000000000000000
    a.first()           -1
    a.next(n)           -1
    a.first_diff(b)     1
    a.next_diff(b, n)   -1
    a.hamming_weight()  0
    a.hamming_weight_sparse()  0
```

Assignee: tbd

Resolution: fixed

Author: Robert Bradshaw

Reviewer: William Stein

Merged: 4.0.2.rc1

Issue created by migration from https://trac.sagemath.org/ticket/6202





---

archive/issue_comments_050898.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n \\`\\`\\`\n+-bash-3.00$ pwd\n+/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0\n+\n sage -t  devel/sage/sage/misc/misc_c.pyx\n **********************************************************************\n File \"/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0/devel/sage-main/sage/misc/misc_c.pyx\", line 359:\n```\n",
    "created_at": "2009-06-03T23:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50898",
    "user": "https://github.com/williamstein"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
 \`\`\`
+-bash-3.00$ pwd
+/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0
+
 sage -t  devel/sage/sage/misc/misc_c.pyx
 **********************************************************************
 File "/home/wstein/build-4.4.0/mark/sage-4.0.1.alpha0/devel/sage-main/sage/misc/misc_c.pyx", line 359:
```




---

archive/issue_comments_050899.json:
```json
{
    "body": "Changing component from algebra to solaris.",
    "created_at": "2009-06-03T23:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50899",
    "user": "https://github.com/williamstein"
}
```

Changing component from algebra to solaris.



---

archive/issue_comments_050900.json:
```json
{
    "body": "<a id='comment:3'></a>This is the part that is wrong\n\n```\n    a.in(n)   True\n    a.not_in(n)   False\n```",
    "created_at": "2009-06-03T23:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50900",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>This is the part that is wrong

```
    a.in(n)   True
    a.not_in(n)   False
```



---

archive/issue_comments_050901.json:
```json
{
    "body": "<a id='comment:4'></a>Did someone find the bug?  What is the status of this?",
    "created_at": "2009-06-04T19:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50901",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>Did someone find the bug?  What is the status of this?



---

archive/issue_comments_050902.json:
```json
{
    "body": "<a id='comment:5'></a>Somewhat bizarrely I got this exact doctest failure once on OSX 32-bit PPC, but I can't reproduce it.  It's there in the log on my OSX10.5 ppc box\n\n```\npdlc424:sage-4.0.1.rc3 wstein$ pwd\n/Users/wstein/build/sage-4.0.1.rc3\n```",
    "created_at": "2009-06-06T16:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50902",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>Somewhat bizarrely I got this exact doctest failure once on OSX 32-bit PPC, but I can't reproduce it.  It's there in the log on my OSX10.5 ppc box

```
pdlc424:sage-4.0.1.rc3 wstein$ pwd
/Users/wstein/build/sage-4.0.1.rc3
```



---

archive/issue_comments_050903.json:
```json
{
    "body": "<a id='comment:6'></a>I looked at this earlier, but didn't make any progress. I'm looking at it again now.",
    "created_at": "2009-06-06T23:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50903",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>I looked at this earlier, but didn't make any progress. I'm looking at it again now.



---

archive/issue_comments_050904.json:
```json
{
    "body": "<a id='comment:7'></a>OK, taking a fresh look, it's not obvious this test is indexing off the end of the bitset. Bitsets are zero-indexed, and the third parameter is supposed to be an index into this set (used for setting, clearing, etc.)\n\nIt looks like it wasn't added that long ago, but I'm actually surprised it has been so consistent (and not caused random segfaults anywhere else).",
    "created_at": "2009-06-06T23:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50904",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>OK, taking a fresh look, it's not obvious this test is indexing off the end of the bitset. Bitsets are zero-indexed, and the third parameter is supposed to be an index into this set (used for setting, clearing, etc.)

It looks like it wasn't added that long ago, but I'm actually surprised it has been so consistent (and not caused random segfaults anywhere else).



---

archive/issue_comments_050905.json:
```json
{
    "body": "Attachment [6202-bitset-testcase.patch](tarball://root/attachments/some-uuid/ticket6202/6202-bitset-testcase.patch) by @robertwb created at 2009-06-07 00:08:04",
    "created_at": "2009-06-07T00:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50905",
    "user": "https://github.com/robertwb"
}
```

Attachment [6202-bitset-testcase.patch](tarball://root/attachments/some-uuid/ticket6202/6202-bitset-testcase.patch) by @robertwb created at 2009-06-07 00:08:04



---

archive/issue_comments_050906.json:
```json
{
    "body": "<a id='comment:8'></a>Jason, does this still test what was intended to be tested?",
    "created_at": "2009-06-07T00:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50906",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>Jason, does this still test what was intended to be tested?



---

archive/issue_comments_050907.json:
```json
{
    "body": "<a id='comment:9'></a>No.  You're right; there was an error in the original doctest; it should have been testing for 31, not 32.  The problem this was testing was a case where complementing the bit would actually zero out the last word if the number of bits was an integral multiple of the wordsize (not an \"even\" multiple).\n\nSo, if you changed the test so that the third parameter was 127 instead of 64, it would be testing the correct thing.\n\nThis is good to know that the code wasn't at fault here, just the doctest!",
    "created_at": "2009-06-07T05:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50907",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:9'></a>No.  You're right; there was an error in the original doctest; it should have been testing for 31, not 32.  The problem this was testing was a case where complementing the bit would actually zero out the last word if the number of bits was an integral multiple of the wordsize (not an "even" multiple).

So, if you changed the test so that the third parameter was 127 instead of 64, it would be testing the correct thing.

This is good to know that the code wasn't at fault here, just the doctest!



---

archive/issue_comments_050908.json:
```json
{
    "body": "<a id='comment:10'></a>To clarify, your patch looks good if you:\n\n* Change the third parameter to 127\n* Change \"even multiple\" to \"integral multiple\" or just \"multiple\"\n\nI haven't applied or run it yet, though.  I'll do that next week and probably give it a positive review (with the above changes).",
    "created_at": "2009-06-07T05:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50908",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:10'></a>To clarify, your patch looks good if you:

* Change the third parameter to 127
* Change "even multiple" to "integral multiple" or just "multiple"

I haven't applied or run it yet, though.  I'll do that next week and probably give it a positive review (with the above changes).



---

archive/issue_comments_050909.json:
```json
{
    "body": "<a id='comment:11'></a>(and thanks for figuring out my mistake in making this doctest!)",
    "created_at": "2009-06-07T05:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50909",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:11'></a>(and thanks for figuring out my mistake in making this doctest!)



---

archive/issue_comments_050910.json:
```json
{
    "body": "<a id='comment:13'></a>Woops.  It's no surprise but though you fixed the test on mark (the solaris box), it is now completely broke on sage.math:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: \nExiting SAGE (CPU time 0m0.04s, Wall time 0m1.13s).\nwstein@sage:~/build/sage-4.0.1$ ./sage -t devel/sage/sage/misc/misc_c.pyx \nsage -t  \"devel/sage/sage/misc/misc_c.pyx\"                  \n**********************************************************************\nFile \"/scratch/wstein/build/sage-4.0.1/devel/sage/sage/misc/misc_c.pyx\", line 359:\n    sage: test_bitset('00'*64, '01'*64, 64)\nExpected:\n    a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.size 128\n    len(a) 0\n    a.limbs 4\n    b 01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a.in(n)   False\n    a.not_in(n)   True\n    a.add(n)     00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.discard(n)   00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.set_to(n)  00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.flip(n)    00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.isempty()  True\n    a.eq(b)      False\n    a.cmp(b)     -1\n    a.issubset(b) True\n    a.issuperset(b) False\n    a.copy()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    r.clear()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    complement a        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    a intersect b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a union b       01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a minus b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a symmetric_difference b      01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a.rshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.lshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.first()           -1\n    a.next(n)           -1\n    a.first_diff(b)     1\n    a.next_diff(b, n)   65\n    a.hamming_weight()  0\n    a.hamming_weight_sparse()  0\n    rshifts add  True\n    lshifts add  True\n    intersection commutes True\n    union commutes  True\n    not not = id True\n    flipped bit  64\n    add bit      64\n    discard bit    64\n    lshift add unset ok True\n    rshift set unset ok True\nGot:\n    a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.size 128\n    len(a) 0\n    a.limbs 2\n    b 01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a.in(n)   False\n    a.not_in(n)   True\n    a.add(n)     00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.discard(n)   00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.set_to(n)  00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.flip(n)    00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000\n    a.isempty()  True\n    a.eq(b)      False\n    a.cmp(b)     -1\n    a.issubset(b) True\n    a.issuperset(b) False\n    a.copy()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    r.clear()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    complement a        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    a intersect b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a union b       01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a minus b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a symmetric_difference b      01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\n    a.rshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.lshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n    a.first()           -1\n    a.next(n)           -1\n    a.first_diff(b)     1\n    a.next_diff(b, n)   65\n    a.hamming_weight()  0\n    a.hamming_weight_sparse()  0\n    rshifts add  True\n    lshifts add  True\n    intersection commutes True\n    union commutes  True\n    not not = id True\n    flipped bit  64\n    add bit      64\n    discard bit    64\n    lshift add unset ok True\n    rshift set unset ok True\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_8\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/wstein/build/sage-4.0.1/tmp/.doctest_misc_c.py\n         [1.2 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n| Sage Version 4.0.1, Release Date: 2009-06-06                       |\n| Type notebook() for the GUI, and license() for information.        |\n\n        sage -t  \"devel/sage/sage/misc/misc_c.pyx\"\nTotal time for all tests: 1.2 seconds\nwstein@sage:~/build/sage-4.0.1$ \n\n```",
    "created_at": "2009-06-08T12:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50910",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:13'></a>Woops.  It's no surprise but though you fixed the test on mark (the solaris box), it is now completely broke on sage.math:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: 
Exiting SAGE (CPU time 0m0.04s, Wall time 0m1.13s).
wstein@sage:~/build/sage-4.0.1$ ./sage -t devel/sage/sage/misc/misc_c.pyx 
sage -t  "devel/sage/sage/misc/misc_c.pyx"                  
**********************************************************************
File "/scratch/wstein/build/sage-4.0.1/devel/sage/sage/misc/misc_c.pyx", line 359:
    sage: test_bitset('00'*64, '01'*64, 64)
Expected:
    a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.size 128
    len(a) 0
    a.limbs 4
    b 01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a.in(n)   False
    a.not_in(n)   True
    a.add(n)     00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.discard(n)   00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.set_to(n)  00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.flip(n)    00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.isempty()  True
    a.eq(b)      False
    a.cmp(b)     -1
    a.issubset(b) True
    a.issuperset(b) False
    a.copy()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    r.clear()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    complement a        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    a intersect b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a union b       01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a minus b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a symmetric_difference b      01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a.rshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.lshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.first()           -1
    a.next(n)           -1
    a.first_diff(b)     1
    a.next_diff(b, n)   65
    a.hamming_weight()  0
    a.hamming_weight_sparse()  0
    rshifts add  True
    lshifts add  True
    intersection commutes True
    union commutes  True
    not not = id True
    flipped bit  64
    add bit      64
    discard bit    64
    lshift add unset ok True
    rshift set unset ok True
Got:
    a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.size 128
    len(a) 0
    a.limbs 2
    b 01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a.in(n)   False
    a.not_in(n)   True
    a.add(n)     00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.discard(n)   00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.set_to(n)  00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.flip(n)    00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000
    a.isempty()  True
    a.eq(b)      False
    a.cmp(b)     -1
    a.issubset(b) True
    a.issuperset(b) False
    a.copy()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    r.clear()     00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    complement a        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    a intersect b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a union b       01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a minus b      00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a symmetric_difference b      01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
    a.rshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.lshift(n)  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    a.first()           -1
    a.next(n)           -1
    a.first_diff(b)     1
    a.next_diff(b, n)   65
    a.hamming_weight()  0
    a.hamming_weight_sparse()  0
    rshifts add  True
    lshifts add  True
    intersection commutes True
    union commutes  True
    not not = id True
    flipped bit  64
    add bit      64
    discard bit    64
    lshift add unset ok True
    rshift set unset ok True
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_8
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/wstein/build/sage-4.0.1/tmp/.doctest_misc_c.py
         [1.2 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:
| Sage Version 4.0.1, Release Date: 2009-06-06                       |
| Type notebook() for the GUI, and license() for information.        |

        sage -t  "devel/sage/sage/misc/misc_c.pyx"
Total time for all tests: 1.2 seconds
wstein@sage:~/build/sage-4.0.1$ 

```



---

archive/issue_comments_050911.json:
```json
{
    "body": "<a id='comment:14'></a>The number of limbs is different; that indicates that this is a 64-bit computer.  There should be a \"...\" for the number of limbs, as it will be 4 on a 32-bit computer, but 2 on a 64-bit computer.\n\nI still think the changes I mentioned above need to be fixed, so I'm also leaving it a \"needs work\" for that.",
    "created_at": "2009-06-08T15:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50911",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:14'></a>The number of limbs is different; that indicates that this is a 64-bit computer.  There should be a "..." for the number of limbs, as it will be 4 on a 32-bit computer, but 2 on a 64-bit computer.

I still think the changes I mentioned above need to be fixed, so I'm also leaving it a "needs work" for that.



---

archive/issue_comments_050912.json:
```json
{
    "body": "apply only this patch",
    "created_at": "2009-06-10T08:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50912",
    "user": "https://github.com/robertwb"
}
```

apply only this patch



---

archive/issue_comments_050913.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [6202-bitset-testcase-new.patch](tarball://root/attachments/some-uuid/ticket6202/6202-bitset-testcase-new.patch) by @robertwb created at 2009-06-10 08:39:59",
    "created_at": "2009-06-10T08:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50913",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:15'></a>Attachment [6202-bitset-testcase-new.patch](tarball://root/attachments/some-uuid/ticket6202/6202-bitset-testcase-new.patch) by @robertwb created at 2009-06-10 08:39:59



---

archive/issue_comments_050914.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-06-15T23:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50914",
    "user": "https://github.com/williamstein"
}
```

Resolution: fixed



---

archive/issue_events_014550.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-06-15T23:35:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6202#event-14550"
}
```



---

archive/issue_comments_050915.json:
```json
{
    "body": "<a id='comment:16'></a>merged into 4.0.2.rc1",
    "created_at": "2009-06-15T23:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6202#issuecomment-50915",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:16'></a>merged into 4.0.2.rc1
