# Issue 6766: faster powers of factorizations

archive/issues_006766.json:
```json
{
    "body": "The patch provides a much faster method for computing powers of commutative factorizations.  This implements a suggestion made by John Cremona in #5188. \nThe speed-up is most marked for factorizations of ideals in number fields.\nBefore:\n\n```\nsage: f = NumberField(x^2 + 23, 'a').factor(47)\nsage: timeit('f^10')\n5 loops, best of 3: 134 ms per loop\n```\nAfter:\n\n```\nsage: f = NumberField(x^2 + 23, 'a').factor(47)\nsage: timeit('f^10')\n625 loops, best of 3: 571 \u00b5s per loop\n```\n\nIn addition, five redundant lines have been removed from the `__init__` function of the `Factorization` class.\n\n\n\n**CC:**  @JohnCremona\n\n**Author:** Francis Clarke\n\n**Reviewer:** John Cremona\n\n**Merged:** Sage 4.1.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6766\n\n",
    "closed_at": "2009-08-25T04:44:10Z",
    "created_at": "2009-08-16T21:08:14Z",
    "labels": [
        "component: algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "faster powers of factorizations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6766",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```
The patch provides a much faster method for computing powers of commutative factorizations.  This implements a suggestion made by John Cremona in #5188. 
The speed-up is most marked for factorizations of ideals in number fields.
Before:

```
sage: f = NumberField(x^2 + 23, 'a').factor(47)
sage: timeit('f^10')
5 loops, best of 3: 134 ms per loop
```
After:

```
sage: f = NumberField(x^2 + 23, 'a').factor(47)
sage: timeit('f^10')
625 loops, best of 3: 571 µs per loop
```

In addition, five redundant lines have been removed from the `__init__` function of the `Factorization` class.



**CC:**  @JohnCremona

**Author:** Francis Clarke

**Reviewer:** John Cremona

**Merged:** Sage 4.1.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6766





---

archive/issue_events_045866.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-08-16T22:36:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6766#event-45866"
}
```



---

archive/attachments_008109.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6766.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6766/trac_6766.patch",
    "created_at": "2009-08-16T22:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```



---

archive/issue_comments_050503.json:
```json
{
    "body": "<a id='comment:1'></a>\nHi Francis. After uploading a patch for a ticket, you should change the subject to \"[with patch, needs review]\". That way, the ticket can be picked up by the relevant trac report as needing review.",
    "created_at": "2009-08-16T22:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50503",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:1'></a>
Hi Francis. After uploading a patch for a ticket, you should change the subject to "[with patch, needs review]". That way, the ticket can be picked up by the relevant trac report as needing review.



---

archive/issue_comments_050504.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis looks good to me;  it applies fine to 4.1.1.  I only tested the file which was changed.",
    "created_at": "2009-08-18T16:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50504",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
This looks good to me;  it applies fine to 4.1.1.  I only tested the file which was changed.



---

archive/issue_events_045867.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-08-18T16:29:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6766#event-45867"
}
```



---

archive/issue_events_045868.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-08-18T16:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6766#event-45868"
}
```



---

archive/issue_comments_050505.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt would be nice if there are more code to illustrate timings before and after applying the patch. As I see it, the patch claims to optimize an operation and Francis has provided one example. Is it possible to provide some more examples of before and after timing statistics? Such examples goes very well with release tours, in which features are being showcased.",
    "created_at": "2009-08-18T16:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50505",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:3'></a>
It would be nice if there are more code to illustrate timings before and after applying the patch. As I see it, the patch claims to optimize an operation and Francis has provided one example. Is it possible to provide some more examples of before and after timing statistics? Such examples goes very well with release tours, in which features are being showcased.



---

archive/issue_comments_050506.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mvngu](#comment%3A3):\n> It would be nice if there are more code to illustrate timings before and after applying the patch. As I see it, the patch claims to optimize an operation and Francis has provided one example. Is it possible to provide some more examples of before and after timing statistics? Such examples goes very well with release tours, in which features are being showcased.\n\n\nI'm not sure this is really worth it in this case.  Before a stupid method was used (by default) while now a sensible one is.  But on the other hand there are not that many situations where one needs to raise a factoization to a power anyway, so I would not want to make a big issue of this in release notes! [This is not to diminish the credit to Francis for bothering to do the job, of course!]",
    "created_at": "2009-08-18T20:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50506",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Replying to [mvngu](#comment%3A3):
> It would be nice if there are more code to illustrate timings before and after applying the patch. As I see it, the patch claims to optimize an operation and Francis has provided one example. Is it possible to provide some more examples of before and after timing statistics? Such examples goes very well with release tours, in which features are being showcased.


I'm not sure this is really worth it in this case.  Before a stupid method was used (by default) while now a sensible one is.  But on the other hand there are not that many situations where one needs to raise a factoization to a power anyway, so I would not want to make a big issue of this in release notes! [This is not to diminish the credit to Francis for bothering to do the job, of course!]



---

archive/issue_comments_050507.json:
```json
{
    "body": "<a id='comment:5'></a>\nI agree with John's comments, but  for the record: before (4.1.1)\n\n```\nsage: f = factor(120)\nsage: for i in range(10): timeit('f^(2^%s)' % i)\n....: \n625 loops, best of 3: 80.1 \u00b5s per loop\n625 loops, best of 3: 538 \u00b5s per loop\n625 loops, best of 3: 1.03 ms per loop\n125 loops, best of 3: 1.5 ms per loop\n125 loops, best of 3: 1.93 ms per loop\n125 loops, best of 3: 2.39 ms per loop\n125 loops, best of 3: 2.81 ms per loop\n125 loops, best of 3: 3.23 ms per loop\n125 loops, best of 3: 3.7 ms per loop\n125 loops, best of 3: 4.12 ms per loop\n```\nand after (4.1.1 + patch)\n\n```\nsage: f = factor(120)\nsage: for i in range(10): timeit('f^(2^%s)' % i)\n....: \n625 loops, best of 3: 4.49 \u00b5s per loop\n625 loops, best of 3: 95.1 \u00b5s per loop\n625 loops, best of 3: 95 \u00b5s per loop\n625 loops, best of 3: 95 \u00b5s per loop\n625 loops, best of 3: 95.1 \u00b5s per loop\n625 loops, best of 3: 95 \u00b5s per loop\n625 loops, best of 3: 95.2 \u00b5s per loop\n625 loops, best of 3: 95.2 \u00b5s per loop\n625 loops, best of 3: 95.3 \u00b5s per loop\n625 loops, best of 3: 95.3 \u00b5s per loop\n```\nIt might be possible to make this faster still.  But as John points out, it's a fairly obscure function.  I only wrote the patch because I found in the course of doing some calculations that the existing code can't cope at all with factorizations of ideals in moderately sized number fields; what takes all the time is the completely unnecessary check for idempotence in the generic power code.",
    "created_at": "2009-08-18T22:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50507",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:5'></a>
I agree with John's comments, but  for the record: before (4.1.1)

```
sage: f = factor(120)
sage: for i in range(10): timeit('f^(2^%s)' % i)
....: 
625 loops, best of 3: 80.1 µs per loop
625 loops, best of 3: 538 µs per loop
625 loops, best of 3: 1.03 ms per loop
125 loops, best of 3: 1.5 ms per loop
125 loops, best of 3: 1.93 ms per loop
125 loops, best of 3: 2.39 ms per loop
125 loops, best of 3: 2.81 ms per loop
125 loops, best of 3: 3.23 ms per loop
125 loops, best of 3: 3.7 ms per loop
125 loops, best of 3: 4.12 ms per loop
```
and after (4.1.1 + patch)

```
sage: f = factor(120)
sage: for i in range(10): timeit('f^(2^%s)' % i)
....: 
625 loops, best of 3: 4.49 µs per loop
625 loops, best of 3: 95.1 µs per loop
625 loops, best of 3: 95 µs per loop
625 loops, best of 3: 95 µs per loop
625 loops, best of 3: 95.1 µs per loop
625 loops, best of 3: 95 µs per loop
625 loops, best of 3: 95.2 µs per loop
625 loops, best of 3: 95.2 µs per loop
625 loops, best of 3: 95.3 µs per loop
625 loops, best of 3: 95.3 µs per loop
```
It might be possible to make this faster still.  But as John points out, it's a fairly obscure function.  I only wrote the patch because I found in the course of doing some calculations that the existing code can't cope at all with factorizations of ideals in moderately sized number fields; what takes all the time is the completely unnecessary check for idempotence in the generic power code.



---

archive/issue_comments_050508.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [fwclarke](#comment%3A5):\n> I agree with John's comments, but  for the record: before (4.1.1)\n\n\n```\n sage: f = factor(120)\n sage: for i in range(10): timeit('f^(2^%s)' % i)\n ....: \n 625 loops, best of 3: 80.1 \u00b5s per loop\n 625 loops, best of 3: 538 \u00b5s per loop\n 625 loops, best of 3: 1.03 ms per loop\n 125 loops, best of 3: 1.5 ms per loop\n 125 loops, best of 3: 1.93 ms per loop\n 125 loops, best of 3: 2.39 ms per loop\n 125 loops, best of 3: 2.81 ms per loop\n 125 loops, best of 3: 3.23 ms per loop\n 125 loops, best of 3: 3.7 ms per loop\n 125 loops, best of 3: 4.12 ms per loop\n```\n> and after (4.1.1 + patch)\n\n\n```\n sage: f = factor(120)\n sage: for i in range(10): timeit('f^(2^%s)' % i)\n ....: \n 625 loops, best of 3: 4.49 \u00b5s per loop\n 625 loops, best of 3: 95.1 \u00b5s per loop\n 625 loops, best of 3: 95 \u00b5s per loop\n 625 loops, best of 3: 95 \u00b5s per loop\n 625 loops, best of 3: 95.1 \u00b5s per loop\n 625 loops, best of 3: 95 \u00b5s per loop\n 625 loops, best of 3: 95.2 \u00b5s per loop\n 625 loops, best of 3: 95.2 \u00b5s per loop\n 625 loops, best of 3: 95.3 \u00b5s per loop\n 625 loops, best of 3: 95.3 \u00b5s per loop\n```\nThese are what I was looking for. Thank you for providing more examples. And my apologies since my above request was ambiguous.",
    "created_at": "2009-08-18T22:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50508",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:6'></a>
Replying to [fwclarke](#comment%3A5):
> I agree with John's comments, but  for the record: before (4.1.1)


```
 sage: f = factor(120)
 sage: for i in range(10): timeit('f^(2^%s)' % i)
 ....: 
 625 loops, best of 3: 80.1 µs per loop
 625 loops, best of 3: 538 µs per loop
 625 loops, best of 3: 1.03 ms per loop
 125 loops, best of 3: 1.5 ms per loop
 125 loops, best of 3: 1.93 ms per loop
 125 loops, best of 3: 2.39 ms per loop
 125 loops, best of 3: 2.81 ms per loop
 125 loops, best of 3: 3.23 ms per loop
 125 loops, best of 3: 3.7 ms per loop
 125 loops, best of 3: 4.12 ms per loop
```
> and after (4.1.1 + patch)


```
 sage: f = factor(120)
 sage: for i in range(10): timeit('f^(2^%s)' % i)
 ....: 
 625 loops, best of 3: 4.49 µs per loop
 625 loops, best of 3: 95.1 µs per loop
 625 loops, best of 3: 95 µs per loop
 625 loops, best of 3: 95 µs per loop
 625 loops, best of 3: 95.1 µs per loop
 625 loops, best of 3: 95 µs per loop
 625 loops, best of 3: 95.2 µs per loop
 625 loops, best of 3: 95.2 µs per loop
 625 loops, best of 3: 95.3 µs per loop
 625 loops, best of 3: 95.3 µs per loop
```
These are what I was looking for. Thank you for providing more examples. And my apologies since my above request was ambiguous.



---

archive/issue_comments_050509.json:
```json
{
    "body": "**Merged:** Sage 4.1.2.alpha0",
    "created_at": "2009-08-25T04:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50509",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** Sage 4.1.2.alpha0



---

archive/issue_events_045869.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-08-25T04:44:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6766#event-45869"
}
```



---

archive/issue_events_045870.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-08-25T04:44:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6766#event-45870"
}
```



---

archive/issue_comments_050510.json:
```json
{
    "body": "**Reviewer:** John Cremona",
    "created_at": "2009-08-25T04:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6766#issuecomment-50510",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Reviewer:** John Cremona
