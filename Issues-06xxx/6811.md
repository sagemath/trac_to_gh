# Issue 6811: [with patch, positive review] prime_pi.plot is wrong (!)

archive/issues_006811.json:
```json
{
    "body": "I was computed Riemann's analytic formula for pi(X), and was disturbed it wasn't converging to pi(X).  It turned out that the function in Sage for a while for plotting prime_pi is buggy! For example, try this:\n\n```\nsage: prime_pi.plot(5,10).show(gridlines='minor',frame=True)\nsage: prime_pi(8)\n4\n```\nYou'll see a plot that has a horizontal line at height 5 on it.  \n\nThis is very bad and embarrassing!\n\n\nAssignee: @williamstein\n\nResolution: fixed\n\nAuthor: William Stein\n\nReviewer: R. Andrew Ohana, Minh Van Nguyen\n\nMerged: Sage 4.1.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/6811\n\n",
    "closed_at": "2009-08-24T06:43:15Z",
    "created_at": "2009-08-23T04:11:08Z",
    "labels": [
        "component: number theory",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.1.2",
    "title": "[with patch, positive review] prime_pi.plot is wrong (!)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6811",
    "user": "https://github.com/williamstein"
}
```
I was computed Riemann's analytic formula for pi(X), and was disturbed it wasn't converging to pi(X).  It turned out that the function in Sage for a while for plotting prime_pi is buggy! For example, try this:

```
sage: prime_pi.plot(5,10).show(gridlines='minor',frame=True)
sage: prime_pi(8)
4
```
You'll see a plot that has a horizontal line at height 5 on it.  

This is very bad and embarrassing!


Assignee: @williamstein

Resolution: fixed

Author: William Stein

Reviewer: R. Andrew Ohana, Minh Van Nguyen

Merged: Sage 4.1.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/6811





---

archive/issue_comments_055959.json:
```json
{
    "body": "<a id='comment:1'></a>I've attached code to fix this bug.  It does things right.  \n\n  (1) I created a plot_step_function command that can be used to plot general step functions, and added it to the reference manual. \n\n  (2) I changed the current broken prime_pi.plot to use that and use a much easier to understand (hence right) algorithm to generate the plot.\n\n  (3) I fixed a bunch of ReST mistakes in prime_pi.pyx while I was at it.  \n\n  (4) I added prime_pi to the reference manual.",
    "created_at": "2009-08-23T05:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55959",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>I've attached code to fix this bug.  It does things right.  

  (1) I created a plot_step_function command that can be used to plot general step functions, and added it to the reference manual. 

  (2) I changed the current broken prime_pi.plot to use that and use a much easier to understand (hence right) algorithm to generate the plot.

  (3) I fixed a bunch of ReST mistakes in prime_pi.pyx while I was at it.  

  (4) I added prime_pi to the reference manual.



---

archive/issue_comments_055960.json:
```json
{
    "body": "Attachment [trac_6811.patch](tarball://root/attachments/some-uuid/ticket6811/trac_6811.patch) by @williamstein created at 2009-08-23 05:14:09",
    "created_at": "2009-08-23T05:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55960",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_6811.patch](tarball://root/attachments/some-uuid/ticket6811/trac_6811.patch) by @williamstein created at 2009-08-23 05:14:09



---

archive/issue_comments_055961.json:
```json
{
    "body": "<a id='comment:2'></a>Looks fine:\n1. Importing sage.plot.all is no longer necessary in prime_pi.pyx\n2. May want to change\n\n```\nfor i in range(len(v)):\n    w.append(v[i])\n    if i+1 < len(v):\n        w.append((v[i+1][0],v[i][1]))\n```\nto\n\n```\nfor i in range(len(v)-1):\n    w.append(v[i])\n    w.append((v[i+1][0],v[i][1]))\nw.append(v[len(v)-1])\n```\nfor readability.\n1. The plot_step_function always starts horizontal and ends vertically, this can sometimes lead to rather odd looking results in my opinion. For example, compare\n\n```\nsage: plot_step_function([(i,i^3) for i in range(6)])\nsage: plot_step_function([(i,i^3) for i in range(6)]) + line([(5,125),(6,125)])\n```\na. If we are to make any changes to this, we would need to consider uneven intervals of definition (say the function `[(i<sup>2,i</sup>3) for i in range(6)]`).\n1. Might be useful to use the plot_step_function elsewhere. For example, with Riemann sums it is either difficult or impossible to enable vertical lines, and the floor function is in the opposite situation.",
    "created_at": "2009-08-23T09:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55961",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:2'></a>Looks fine:
1. Importing sage.plot.all is no longer necessary in prime_pi.pyx
2. May want to change

```
for i in range(len(v)):
    w.append(v[i])
    if i+1 < len(v):
        w.append((v[i+1][0],v[i][1]))
```
to

```
for i in range(len(v)-1):
    w.append(v[i])
    w.append((v[i+1][0],v[i][1]))
w.append(v[len(v)-1])
```
for readability.
1. The plot_step_function always starts horizontal and ends vertically, this can sometimes lead to rather odd looking results in my opinion. For example, compare

```
sage: plot_step_function([(i,i^3) for i in range(6)])
sage: plot_step_function([(i,i^3) for i in range(6)]) + line([(5,125),(6,125)])
```
a. If we are to make any changes to this, we would need to consider uneven intervals of definition (say the function `[(i<sup>2,i</sup>3) for i in range(6)]`).
1. Might be useful to use the plot_step_function elsewhere. For example, with Riemann sums it is either difficult or impossible to enable vertical lines, and the floor function is in the opposite situation.



---

archive/issue_comments_055962.json:
```json
{
    "body": "<a id='comment:3'></a>Also, we need to fix the credit situation in prime_pi.pyx",
    "created_at": "2009-08-23T09:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55962",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:3'></a>Also, we need to fix the credit situation in prime_pi.pyx



---

archive/issue_comments_055963.json:
```json
{
    "body": "reviewer patch; fixes typos",
    "created_at": "2009-08-24T06:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55963",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

reviewer patch; fixes typos



---

archive/issue_comments_055964.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [trac_6811-reviewer.patch](tarball://root/attachments/some-uuid/ticket6811/trac_6811-reviewer.patch) by mvngu created at 2009-08-24 06:05:53\n\nThe reviewer patch `trac_6811-reviewer.patch` fixes some typos in `trac_6811.patch`. One of these typos results in a warning when building the reference manual.",
    "created_at": "2009-08-24T06:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55964",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:4'></a>Attachment [trac_6811-reviewer.patch](tarball://root/attachments/some-uuid/ticket6811/trac_6811-reviewer.patch) by mvngu created at 2009-08-24 06:05:53

The reviewer patch `trac_6811-reviewer.patch` fixes some typos in `trac_6811.patch`. One of these typos results in a warning when building the reference manual.



---

archive/issue_comments_055965.json:
```json
{
    "body": "<a id='comment:5'></a>Merged both patches.",
    "created_at": "2009-08-24T06:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55965",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:5'></a>Merged both patches.



---

archive/issue_events_016049.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-08-24T06:43:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6811#event-16049"
}
```



---

archive/issue_comments_055966.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-08-24T06:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6811#issuecomment-55966",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed
