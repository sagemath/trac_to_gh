# Issue 6115: make symbolic matrices use pynac symbolics

archive/issues_006115.json:
```json
{
    "body": "Currently, it looks like the symbolic matrix code in `matrix/matrix_symbolic_dense.pyx` goes to maxima for everything.  This makes things **slow** and, at least in 3.4.2, it was easy to crash Maxima by calculating a 6x6 determinant, for example.\n\nHere is an example of how the current general algorithms in Sage can speed things up (even before making the matrix be stored in Sage instead of Maxima).\n\n```\nsage: var('x00,x01,x10,x11')\nsage: a=matrix(2,[[x00,x01],[x10,x11]])\nsage: %timeit a.det()\n10 loops, best of 3: 218 ms per loop\n```\n\nI went into matrix/matrix_symbolic_dense.pyx and just commented out the determinant routine.  This way, it uses the generic determinant routine for matrices.  Note that we still have to get values from maxima for this, but the multiplication and things are done in pynac.\n\nGeneric determinant algorithm:\n\n```\nsage: var('x00,x01,x10,x11')\n(x00, x01, x10, x11)\nsage: a=matrix(2,[[x00,x01],[x10,x11]])\nsage: %timeit a.det()\n100000 loops, best of 3: 5.85 \u00b5s per loop\nsage: %timeit a.det()\n100000 loops, best of 3: 6.15 \u00b5s per loop\n```\n\nSo, the generic Sage code with pynac took about 3% of the time it took to call maxima and ask it for the determinant.\n\n**Assignee:** @williamstein\n\nIssue created by migration from https://trac.sagemath.org/ticket/6115\n\n",
    "closed_at": "2009-05-28T06:04:44Z",
    "created_at": "2009-05-21T18:39:36Z",
    "labels": [
        "component: linear algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0",
    "title": "make symbolic matrices use pynac symbolics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6115",
    "user": "https://github.com/jasongrout"
}
```
Currently, it looks like the symbolic matrix code in `matrix/matrix_symbolic_dense.pyx` goes to maxima for everything.  This makes things **slow** and, at least in 3.4.2, it was easy to crash Maxima by calculating a 6x6 determinant, for example.

Here is an example of how the current general algorithms in Sage can speed things up (even before making the matrix be stored in Sage instead of Maxima).

```
sage: var('x00,x01,x10,x11')
sage: a=matrix(2,[[x00,x01],[x10,x11]])
sage: %timeit a.det()
10 loops, best of 3: 218 ms per loop
```

I went into matrix/matrix_symbolic_dense.pyx and just commented out the determinant routine.  This way, it uses the generic determinant routine for matrices.  Note that we still have to get values from maxima for this, but the multiplication and things are done in pynac.

Generic determinant algorithm:

```
sage: var('x00,x01,x10,x11')
(x00, x01, x10, x11)
sage: a=matrix(2,[[x00,x01],[x10,x11]])
sage: %timeit a.det()
100000 loops, best of 3: 5.85 µs per loop
sage: %timeit a.det()
100000 loops, best of 3: 6.15 µs per loop
```

So, the generic Sage code with pynac took about 3% of the time it took to call maxima and ask it for the determinant.

**Assignee:** @williamstein

Issue created by migration from https://trac.sagemath.org/ticket/6115





---

archive/issue_comments_042719.json:
```json
{
    "body": "<a id='comment:1'></a>\nMike Hansen mentions that all of the docstrings should be moved up to the module docstring.  Most of this patch would probably be just deleting functions in matrix_symbolic_dense.pyx.",
    "created_at": "2009-05-21T18:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42719",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
Mike Hansen mentions that all of the docstrings should be moved up to the module docstring.  Most of this patch would probably be just deleting functions in matrix_symbolic_dense.pyx.



---

archive/issue_comments_042720.json:
```json
{
    "body": "<a id='comment:2'></a>\nAlmost positive review.  Here is a problem:\n\n```\nsage: a=matrix(SR, [[1,2],[3,4]])\nsage: a.eig\na.eigenmatrix_left    a.eigenspaces         a.eigenspaces_right   a.eigenvectors_left   \na.eigenmatrix_right   a.eigenspaces_left    a.eigenvalues         a.eigenvectors_right  \nsage: a.eigenm\na.eigenmatrix_left   a.eigenmatrix_right  \nsage: a.eigenmatrix_right()\n/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py:1: UserWarning: Using generic algorithm for an inexact ring, which may result in garbarge from numerical precision issues.\n  # -*- coding: utf-8 -*-\n/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py:1: UserWarning: Using generic algorithm for an inexact ring, which will probably give incorrect results due to numerical precision issues.\n  # -*- coding: utf-8 -*-\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py in <module>()\n\n/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_right (sage/matrix/matrix2.c:21183)()\n   3505             True\n   3506         \"\"\"\n-> 3507         D,P=self.transpose().eigenmatrix_left()\n   3508         return D,P.transpose()\n   3509 \n\n/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_left (sage/matrix/matrix2.c:20868)()\n   3440         \"\"\"\n   3441         from sage.misc.flatten import flatten\n-> 3442         evecs = self.eigenvectors_left()\n   3443         D = sage.matrix.constructor.diagonal_matrix(flatten([[e[0]]*e[2] for e in evecs]))\n   3444         rows = []\n\n/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenvectors_left (sage/matrix/matrix2.c:20199)()\n   3324         from sage.rings.qqbar import QQbar\n   3325         from sage.categories.homset import hom\n-> 3326         eigenspaces = self.eigenspaces_left(algebraic_multiplicity=True)\n   3327         evec_list=[]\n   3328         n = self._nrows\n\n/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenspaces_left (sage/matrix/matrix2.c:18811)()\n   3061         i = 0\n   3062         for h, e in G:\n-> 3063             if h.degree() == 1:\n   3064                 alpha = -h[0]/h[1]\n   3065                 F = alpha.parent()\n\nTypeError: degree() takes exactly one argument (0 given)\n```",
    "created_at": "2009-05-26T19:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42720",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
Almost positive review.  Here is a problem:

```
sage: a=matrix(SR, [[1,2],[3,4]])
sage: a.eig
a.eigenmatrix_left    a.eigenspaces         a.eigenspaces_right   a.eigenvectors_left   
a.eigenmatrix_right   a.eigenspaces_left    a.eigenvalues         a.eigenvectors_right  
sage: a.eigenm
a.eigenmatrix_left   a.eigenmatrix_right  
sage: a.eigenmatrix_right()
/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py:1: UserWarning: Using generic algorithm for an inexact ring, which may result in garbarge from numerical precision issues.
  # -*- coding: utf-8 -*-
/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py:1: UserWarning: Using generic algorithm for an inexact ring, which will probably give incorrect results due to numerical precision issues.
  # -*- coding: utf-8 -*-
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/grout/.sage/temp/good/26004/_home_grout__sage_init_sage_0.py in <module>()

/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_right (sage/matrix/matrix2.c:21183)()
   3505             True
   3506         """
-> 3507         D,P=self.transpose().eigenmatrix_left()
   3508         return D,P.transpose()
   3509 

/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_left (sage/matrix/matrix2.c:20868)()
   3440         """
   3441         from sage.misc.flatten import flatten
-> 3442         evecs = self.eigenvectors_left()
   3443         D = sage.matrix.constructor.diagonal_matrix(flatten([[e[0]]*e[2] for e in evecs]))
   3444         rows = []

/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenvectors_left (sage/matrix/matrix2.c:20199)()
   3324         from sage.rings.qqbar import QQbar
   3325         from sage.categories.homset import hom
-> 3326         eigenspaces = self.eigenspaces_left(algebraic_multiplicity=True)
   3327         evec_list=[]
   3328         n = self._nrows

/home/grout/download/sage-sage-4.0.alpha0.5/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenspaces_left (sage/matrix/matrix2.c:18811)()
   3061         i = 0
   3062         for h, e in G:
-> 3063             if h.degree() == 1:
   3064                 alpha = -h[0]/h[1]
   3065                 F = alpha.parent()

TypeError: degree() takes exactly one argument (0 given)
```



---

archive/issue_comments_042721.json:
```json
{
    "body": "<a id='comment:3'></a>\nI should mention that all but about 3 lines of the above patch are Mike Hansen's, so I'm not reviewing my own patch!  I did add the simplify_rational() calls to the exponent doctests and the deprecation warning to is_simplified; those should be reviewed by someone other than me.",
    "created_at": "2009-05-26T19:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42721",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
I should mention that all but about 3 lines of the above patch are Mike Hansen's, so I'm not reviewing my own patch!  I did add the simplify_rational() calls to the exponent doctests and the deprecation warning to is_simplified; those should be reviewed by someone other than me.



---

archive/issue_events_040562.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-26T19:17:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40562"
}
```



---

archive/issue_comments_042722.json:
```json
{
    "body": "<a id='comment:4'></a>\nPlaying around with things gives more interesting errors:\n\n```\nsage: a=matrix(SR, [[1,2],[3,x]])\nsage: a.fcp('x')\n-6\nsage: a.fcp('y')\n-x*y + y^2 + x - y - 6\n```",
    "created_at": "2009-05-26T19:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42722",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
Playing around with things gives more interesting errors:

```
sage: a=matrix(SR, [[1,2],[3,x]])
sage: a.fcp('x')
-6
sage: a.fcp('y')
-x*y + y^2 + x - y - 6
```



---

archive/issue_comments_042723.json:
```json
{
    "body": "apply on top of previous patches",
    "created_at": "2009-05-26T21:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42723",
    "user": "https://github.com/jasongrout"
}
```

apply on top of previous patches



---

archive/issue_events_040563.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-26T21:04:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40563"
}
```



---

archive/issue_events_040564.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-26T21:04:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40564"
}
```



---

archive/attachments_007205.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-6115-symbolic-eigenvalues.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6115/trac-6115-symbolic-eigenvalues.patch",
    "created_at": "2009-05-26T21:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_042724.json:
```json
{
    "body": "<a id='comment:5'></a>\nthe trac-6115-symbolic-eigenvalues.patch  patch needs to be reviewed as well.",
    "created_at": "2009-05-26T21:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42724",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
the trac-6115-symbolic-eigenvalues.patch  patch needs to be reviewed as well.



---

archive/issue_comments_042725.json:
```json
{
    "body": "<a id='comment:6'></a>\nthe complaints that I raise above happened with the old implementation of symbolic matrices, so they are beyond the scope of this ticket.\n\nI positively review mhansen's part (the first patch, which I posted).  My part (the second patch) needs to be reviewed, though.",
    "created_at": "2009-05-28T05:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42725",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
the complaints that I raise above happened with the old implementation of symbolic matrices, so they are beyond the scope of this ticket.

I positively review mhansen's part (the first patch, which I posted).  My part (the second patch) needs to be reviewed, though.



---

archive/issue_comments_042726.json:
```json
{
    "body": "<a id='comment:7'></a>\n(well, and the three or so lines that I changed from mhansen's patch; see my above comment)",
    "created_at": "2009-05-28T05:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42726",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>
(well, and the three or so lines that I changed from mhansen's patch; see my above comment)



---

archive/issue_comments_042727.json:
```json
{
    "body": "<a id='comment:8'></a>\nJason's patch looks good to me.  I just put up a new version of #6115 which fixes a doctest failure in sage/matrix/tests.py.",
    "created_at": "2009-05-28T05:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42727",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:8'></a>
Jason's patch looks good to me.  I just put up a new version of #6115 which fixes a doctest failure in sage/matrix/tests.py.



---

archive/issue_events_040565.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-28T05:18:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40565"
}
```



---

archive/issue_events_040566.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-28T05:18:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40566"
}
```



---

archive/issue_comments_042728.json:
```json
{
    "body": "<a id='comment:9'></a>\nYep, and Mike's change looks good to me and makes tests.py pass doctests, so positive review.",
    "created_at": "2009-05-28T05:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42728",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:9'></a>
Yep, and Mike's change looks good to me and makes tests.py pass doctests, so positive review.



---

archive/attachments_007206.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_6115.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket6115/trac_6115.patch",
    "created_at": "2009-05-28T05:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_042729.json:
```json
{
    "body": "",
    "created_at": "2009-05-28T05:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42729",
    "user": "https://github.com/mwhansen"
}
```





---

archive/issue_comments_042730.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerged both patches in 4.0.rc1.",
    "created_at": "2009-05-28T06:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6115#issuecomment-42730",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'></a>
Merged both patches in 4.0.rc1.



---

archive/issue_events_040567.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-28T06:04:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40567"
}
```



---

archive/issue_events_040568.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-28T06:04:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40568"
}
```



---

archive/issue_events_040569.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-29T19:13:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "milestone": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40569"
}
```



---

archive/issue_events_040570.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-05-29T19:13:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/6115",
    "milestone": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/6115#event-40570"
}
```
