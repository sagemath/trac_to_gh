# Issue 13395: Bugfix in is_cartesian_product

archive/issues_013395.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nHelloooooooooo everybody !!!\n\nGeorgi Guninski reported by email the following bug :\n\n\n```\nsage: g = graphs.WagnerGraph()\nsage: g.is_cartesian_product()\n\nValueError: Something weird happened during the algorithm... Please report the bug and give us the graph instance that made it fail !!!\n```\n\n\nWell, it is not very bad as the ``is_cartesian_product`` function is made to return only results that it can check for correction, so an exception is raised when the algorithm sees something wrong.\n\nAnyway. I opened another book which told me what I should add to fix this bug, and the patch that follows fixes it. I'm glad when working on Sage teaches me some graph theory `:-)`\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/13599\n\n",
    "created_at": "2012-10-14T12:57:24Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "Bugfix in is_cartesian_product",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13395",
    "user": "https://github.com/nathanncohen"
}
```
Assignee: jason, ncohen, rlm

Helloooooooooo everybody !!!

Georgi Guninski reported by email the following bug :


```
sage: g = graphs.WagnerGraph()
sage: g.is_cartesian_product()

ValueError: Something weird happened during the algorithm... Please report the bug and give us the graph instance that made it fail !!!
```


Well, it is not very bad as the ``is_cartesian_product`` function is made to return only results that it can check for correction, so an exception is raised when the algorithm sees something wrong.

Anyway. I opened another book which told me what I should add to fix this bug, and the patch that follows fixes it. I'm glad when working on Sage teaches me some graph theory `:-)`

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/13599





---

archive/issue_comments_164689.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-14T13:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164689",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164690.json:
```json
{
    "body": "The patch is working but you can at least use some {{edge_iterator}} and `neighbor_iterator` to save some time. I don't know what else could be easily done.",
    "created_at": "2012-10-14T14:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164690",
    "user": "https://github.com/dcoudert"
}
```

The patch is working but you can at least use some {{edge_iterator}} and `neighbor_iterator` to save some time. I don't know what else could be easily done.



---

archive/issue_comments_164691.json:
```json
{
    "body": "Ahahahah. Actually, what I should do is cache the list of edges.. Thanks for the hint ! `:-)`\n\n\n```\ng = graphs.RandomGNP(100,.2)\ndef test(g):\n   c = 0\n   for u,v in g.edge_iterator(labels = False):\n       for uu,vv in g.edge_iterator(labels = False):       \n            c += uu+vv+u+v\n   return c\n\ndef test2(g):\n   c = 0\n   edges = g.edges(labels = False)\n   for i,(u,v) in enumerate(edges):\n       for j in range(i+1, len(edges)):\n            uu,vv = edges[j]\n            c += uu+vv+u+v\n   return c\n\nsage: %time test(g)\nCPU times: user 4.60 s, sys: 0.00 s, total: 4.60 s\nWall time: 4.60 s\n198772752\nsage: %time test2(g)\nCPU times: user 0.78 s, sys: 0.00 s, total: 0.78 s\nWall time: 0.78 s\n99287188\n```\n\n\nThis thing is ..... very ..... slow `:-/`\n\nNathann",
    "created_at": "2012-10-14T15:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164691",
    "user": "https://github.com/nathanncohen"
}
```

Ahahahah. Actually, what I should do is cache the list of edges.. Thanks for the hint ! `:-)`


```
g = graphs.RandomGNP(100,.2)
def test(g):
   c = 0
   for u,v in g.edge_iterator(labels = False):
       for uu,vv in g.edge_iterator(labels = False):       
            c += uu+vv+u+v
   return c

def test2(g):
   c = 0
   edges = g.edges(labels = False)
   for i,(u,v) in enumerate(edges):
       for j in range(i+1, len(edges)):
            uu,vv = edges[j]
            c += uu+vv+u+v
   return c

sage: %time test(g)
CPU times: user 4.60 s, sys: 0.00 s, total: 4.60 s
Wall time: 4.60 s
198772752
sage: %time test2(g)
CPU times: user 0.78 s, sys: 0.00 s, total: 0.78 s
Wall time: 0.78 s
99287188
```


This thing is ..... very ..... slow `:-/`

Nathann



---

archive/issue_comments_164692.json:
```json
{
    "body": "Btw : this patch now depends on #13188 (a duplicated method is removed), and there is a new keyword \"relabeling\" to get the final coordinates. This has been requested by email `:-P`\n\nNathann",
    "created_at": "2012-10-14T15:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164692",
    "user": "https://github.com/nathanncohen"
}
```

Btw : this patch now depends on #13188 (a duplicated method is removed), and there is a new keyword "relabeling" to get the final coordinates. This has been requested by email `:-P`

Nathann



---

archive/issue_comments_164693.json:
```json
{
    "body": "Attachment [trac_13599.patch](tarball://root/attachments/some-uuid/ticket13599/trac_13599.patch) by @dcoudert created at 2012-10-14 19:11:58\n\nThe patch is working and is much faster than previous version.\nGood.",
    "created_at": "2012-10-14T19:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164693",
    "user": "https://github.com/dcoudert"
}
```

Attachment [trac_13599.patch](tarball://root/attachments/some-uuid/ticket13599/trac_13599.patch) by @dcoudert created at 2012-10-14 19:11:58

The patch is working and is much faster than previous version.
Good.



---

archive/issue_comments_164694.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-14T19:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164694",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164695.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-01T12:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13395#issuecomment-164695",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
