# Issue 23688: Bulk fix of signal handling in symbolics

archive/issues_023688.json:
```json
{
    "body": "In Sage-8.1.beta6 this crashes:\n\n```\nsage: (x/(x^1431655765-1)).normalize()\nException (FLINT memory_manager). Unable to allocate memory.\n```\n\nwhile the underlying operation only aborts with `RuntimeError`:\n\n```\ngcd(x,x^1431655765-1)\n```\n\n\nThe `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23925\n\n",
    "created_at": "2017-09-25T06:43:15Z",
    "labels": [
        "component: symbolics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Bulk fix of signal handling in symbolics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23688",
    "user": "https://github.com/rwst"
}
```
In Sage-8.1.beta6 this crashes:

```
sage: (x/(x^1431655765-1)).normalize()
Exception (FLINT memory_manager). Unable to allocate memory.
```

while the underlying operation only aborts with `RuntimeError`:

```
gcd(x,x^1431655765-1)
```


The `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.

Issue created by migration from https://trac.sagemath.org/ticket/23925





---

archive/issue_comments_331465.json:
```json
{
    "body": "Changing component from symbolics to cython.",
    "created_at": "2017-09-25T07:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331465",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from symbolics to cython.



---

archive/issue_comments_331466.json:
```json
{
    "body": "In the future, please remember to **POST TRACEBACKS** such that people reading this ticket can actually understand what it is about.",
    "created_at": "2017-09-25T07:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331466",
    "user": "https://github.com/jdemeyer"
}
```

In the future, please remember to **POST TRACEBACKS** such that people reading this ticket can actually understand what it is about.



---

archive/issue_comments_331467.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-25T07:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331467",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_331468.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-25T07:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331468",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331469.json:
```json
{
    "body": "Don't put Python code inside `sig_on()`/`sig_off()` blocks.\n\nWhat you are doing is essentially\n\n```\nsig_on()\ntry:\n    initialize()\n    res = c_lib_call()\n    return process(res)\nfinally:\n    sig_off\n```\n\nInstead, it should be\n\n```\ninitialize()\nsig_on()\nres = c_lib_call()\nsig_off()\nreturn process(res)\n```\n",
    "created_at": "2017-09-25T07:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331469",
    "user": "https://github.com/jdemeyer"
}
```

Don't put Python code inside `sig_on()`/`sig_off()` blocks.

What you are doing is essentially

```
sig_on()
try:
    initialize()
    res = c_lib_call()
    return process(res)
finally:
    sig_off
```

Instead, it should be

```
initialize()
sig_on()
res = c_lib_call()
sig_off()
return process(res)
```




---

archive/issue_comments_331470.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-25T07:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331470",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331471.json:
```json
{
    "body": "...or, if C++ exceptions can occur, it should be:\n\n```\ninitialize()\nsig_on()\ntry:\n    res = c_lib_call()\nfinally:\n    sig_off()\nreturn process(res)\n```\n",
    "created_at": "2017-09-25T07:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331471",
    "user": "https://github.com/jdemeyer"
}
```

...or, if C++ exceptions can occur, it should be:

```
initialize()
sig_on()
try:
    res = c_lib_call()
finally:
    sig_off()
return process(res)
```




---

archive/issue_comments_331472.json:
```json
{
    "body": "After thinking about it a bit more... `pynac` is partially implemented in Python, right? So maybe these should be added upstream in Pynac, not in Sage.",
    "created_at": "2017-09-25T07:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331472",
    "user": "https://github.com/jdemeyer"
}
```

After thinking about it a bit more... `pynac` is partially implemented in Python, right? So maybe these should be added upstream in Pynac, not in Sage.



---

archive/issue_comments_331473.json:
```json
{
    "body": "Pynac is completely C++ but calls some Python C API functions. Is there a C function `sig_on`?",
    "created_at": "2017-09-25T07:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331473",
    "user": "https://github.com/rwst"
}
```

Pynac is completely C++ but calls some Python C API functions. Is there a C function `sig_on`?



---

archive/issue_comments_331474.json:
```json
{
    "body": "In theory, `cysignals` can be interfaced via C/C++ but I don't think that this has been done already.",
    "created_at": "2017-09-25T08:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331474",
    "user": "https://github.com/jdemeyer"
}
```

In theory, `cysignals` can be interfaced via C/C++ but I don't think that this has been done already.



---

archive/issue_comments_331475.json:
```json
{
    "body": "I don't think it belongs in Pynac. Several functions are called that are used by Pynac itself. Rather, if you insist on adding a code layer, it should go in the Pynac interface, e.g. `libs/pynac/wrap.h`.",
    "created_at": "2017-09-25T08:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331475",
    "user": "https://github.com/rwst"
}
```

I don't think it belongs in Pynac. Several functions are called that are used by Pynac itself. Rather, if you insist on adding a code layer, it should go in the Pynac interface, e.g. `libs/pynac/wrap.h`.



---

archive/issue_comments_331476.json:
```json
{
    "body": "Replying to [comment:10 rws]:\n> if you insist on adding a code layer\n\nI'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.",
    "created_at": "2017-09-25T08:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331476",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 rws]:
> if you insist on adding a code layer

I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.



---

archive/issue_comments_331477.json:
```json
{
    "body": "If it goes to correctness:\n\n\"...it is possible to declare a function as potentially raising an C++ exception and converting it into a Python exception. For example,\n\n\n```\ncdef extern from \"some_file.h\":\n    cdef int foo() except +\n```\n\nThis will translate try and the C++ error into an appropriate Python exception (currently an IndexError on std::out_of_range and a RuntimeError otherwise (preserving the what() message).\"\n\nSee https://github.com/cython/cython/wiki/WrappingCPlusPlus#advanced-c-features\n\nThe relevant methods all have their \"except +\" in `libs/pynac/pynac.pxd` so why do we need the `sig_on/off` at all?",
    "created_at": "2017-09-25T13:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331477",
    "user": "https://github.com/rwst"
}
```

If it goes to correctness:

"...it is possible to declare a function as potentially raising an C++ exception and converting it into a Python exception. For example,


```
cdef extern from "some_file.h":
    cdef int foo() except +
```

This will translate try and the C++ error into an appropriate Python exception (currently an IndexError on std::out_of_range and a RuntimeError otherwise (preserving the what() message)."

See https://github.com/cython/cython/wiki/WrappingCPlusPlus#advanced-c-features

The relevant methods all have their "except +" in `libs/pynac/pynac.pxd` so why do we need the `sig_on/off` at all?



---

archive/issue_comments_331478.json:
```json
{
    "body": "Replying to [comment:12 rws]:\n> why do we need the `sig_on/off` at all?\n\n1. To allow interrupting a long-running operation.\n\n2. For error handling from low-level C libraries like FLINT (which is what this ticket is about).\n\nNone of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.\n\nWhat is true is that `cysignals` was not written with C++ in mind. Maybe one could reimplement parts of `cysignals` to be more C++-friendly, for example by raising C++ exceptions (which are then converted to Python exceptions by Cython).",
    "created_at": "2017-09-25T13:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331478",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 rws]:
> why do we need the `sig_on/off` at all?

1. To allow interrupting a long-running operation.

2. For error handling from low-level C libraries like FLINT (which is what this ticket is about).

None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.

What is true is that `cysignals` was not written with C++ in mind. Maybe one could reimplement parts of `cysignals` to be more C++-friendly, for example by raising C++ exceptions (which are then converted to Python exceptions by Cython).



---

archive/issue_comments_331479.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.\n\nIt's the same layer and doing it automatically (maybe if a similar directive to `except +` is given) prevents tickets such as this.",
    "created_at": "2017-09-25T13:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331479",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:13 jdemeyer]:
> None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.

It's the same layer and doing it automatically (maybe if a similar directive to `except +` is given) prevents tickets such as this.



---

archive/issue_comments_331480.json:
```json
{
    "body": "Replying to [comment:14 rws]:\n> It's the same layer and doing **it** automatically prevents tickets such as this.\n\nDoing **what** automatically?",
    "created_at": "2017-09-25T13:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331480",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 rws]:
> It's the same layer and doing **it** automatically prevents tickets such as this.

Doing **what** automatically?



---

archive/issue_comments_331481.json:
```json
{
    "body": "More exactly. There are two possibilities, a signal handler is set when leaving Python (like `sig_on/off`) or one is set when leaving C++ and calling FLINT. The latter would be in Singular not Pynac however. With this I tend to call it a Singular/libfactory bug.",
    "created_at": "2017-09-25T13:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331481",
    "user": "https://github.com/rwst"
}
```

More exactly. There are two possibilities, a signal handler is set when leaving Python (like `sig_on/off`) or one is set when leaving C++ and calling FLINT. The latter would be in Singular not Pynac however. With this I tend to call it a Singular/libfactory bug.



---

archive/issue_comments_331482.json:
```json
{
    "body": "It should be set when leaving Python. However, Pynac is a difficult case because it mixes C++ and Python. So there is no clear Python/C++ boundary.",
    "created_at": "2017-09-25T13:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331482",
    "user": "https://github.com/jdemeyer"
}
```

It should be set when leaving Python. However, Pynac is a difficult case because it mixes C++ and Python. So there is no clear Python/C++ boundary.



---

archive/issue_comments_331483.json:
```json
{
    "body": "In any case cysignals has a tested implementation. Is it possible at all to reuse it from C++?",
    "created_at": "2017-09-25T14:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331483",
    "user": "https://github.com/rwst"
}
```

In any case cysignals has a tested implementation. Is it possible at all to reuse it from C++?



---

archive/issue_comments_331484.json:
```json
{
    "body": "Ah I see, `src/sage/rings/padics/transcendantal.c` (sic) uses cysignals.",
    "created_at": "2017-09-25T14:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331484",
    "user": "https://github.com/rwst"
}
```

Ah I see, `src/sage/rings/padics/transcendantal.c` (sic) uses cysignals.



---

archive/issue_comments_331485.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-09-26T07:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331485",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_331486.json:
```json
{
    "body": "This test branch implements calling of `sig_on/off` from the Pynac interface, just for the ticket case. While C++ runtime errors are caught, the ticket case's SIGABRT is not (while it is caught in the first uploaded branch where the `sig_on/off` is called from Python).\n\nHow to proceed?\n----\nNew commits:",
    "created_at": "2017-09-26T07:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331486",
    "user": "https://github.com/rwst"
}
```

This test branch implements calling of `sig_on/off` from the Pynac interface, just for the ticket case. While C++ runtime errors are caught, the ticket case's SIGABRT is not (while it is caught in the first uploaded branch where the `sig_on/off` is called from Python).

How to proceed?
----
New commits:



---

archive/issue_comments_331487.json:
```json
{
    "body": "\n```\nException (FLINT memory_manager). Unable to allocate memory.\n------------------------------------------------------------------------\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5d55)[0x7f7af2ecfd55]\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5da5)[0x7f7af2ecfda5]\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8c2a)[0x7f7af2ed2c2a]\n/lib64/libpthread.so.0(+0x10b10)[0x7f7afaebcb10]\n/lib64/libc.so.6(gsignal+0x37)[0x7f7afa4398d7]\n/lib64/libc.so.6(abort+0x13a)[0x7f7afa43acaa]\n/home/ralf/sage/local/lib/libflint.so.13(+0x59194)[0x7f7ae9ffe194]\n/home/ralf/sage/local/lib/libflint.so.13(+0x5f468)[0x7f7aea004468]\n/home/ralf/sage/local/lib/libflint.so.13(_fmpz_poly_gcd_heuristic+0x6aa)[0x7f7aea06a29a]\n```\n",
    "created_at": "2017-09-27T05:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331487",
    "user": "https://github.com/rwst"
}
```


```
Exception (FLINT memory_manager). Unable to allocate memory.
------------------------------------------------------------------------
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5d55)[0x7f7af2ecfd55]
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5da5)[0x7f7af2ecfda5]
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8c2a)[0x7f7af2ed2c2a]
/lib64/libpthread.so.0(+0x10b10)[0x7f7afaebcb10]
/lib64/libc.so.6(gsignal+0x37)[0x7f7afa4398d7]
/lib64/libc.so.6(abort+0x13a)[0x7f7afa43acaa]
/home/ralf/sage/local/lib/libflint.so.13(+0x59194)[0x7f7ae9ffe194]
/home/ralf/sage/local/lib/libflint.so.13(+0x5f468)[0x7f7aea004468]
/home/ralf/sage/local/lib/libflint.so.13(_fmpz_poly_gcd_heuristic+0x6aa)[0x7f7aea06a29a]
```




---

archive/issue_comments_331488.json:
```json
{
    "body": "The reason for your problem is that Cython supports either checking for C++ exceptions (`except +`) or Python exceptions (`except something_else`), but not both at the same time.\n\nBut as I already said: no additional layer is needed, you can just add the `sig_on`/`sig_off` in the Cython file directly.",
    "created_at": "2017-09-27T12:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331488",
    "user": "https://github.com/jdemeyer"
}
```

The reason for your problem is that Cython supports either checking for C++ exceptions (`except +`) or Python exceptions (`except something_else`), but not both at the same time.

But as I already said: no additional layer is needed, you can just add the `sig_on`/`sig_off` in the Cython file directly.



---

archive/issue_comments_331489.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> Replying to [comment:10 rws]:\n> > if you insist on adding a code layer\n> \n> I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.\n\nThe layer that is calling C library functions is the C++ layer (either `expression.pyx` translated to C++ or Singular or Pynac, all of it happens). You just said to insert the insert `sig_on()` in the Cython file. You mean `expression.pyx`, that is, just like I did in the first branch, right?",
    "created_at": "2017-09-27T13:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331489",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:11 jdemeyer]:
> Replying to [comment:10 rws]:
> > if you insist on adding a code layer
> 
> I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.

The layer that is calling C library functions is the C++ layer (either `expression.pyx` translated to C++ or Singular or Pynac, all of it happens). You just said to insert the insert `sig_on()` in the Cython file. You mean `expression.pyx`, that is, just like I did in the first branch, right?



---

archive/issue_comments_331490.json:
```json
{
    "body": "Replying to [comment:24 rws]:\n> The layer that is calling C library functions is the C++ layer\n\nSorry, when I said \"C\" I meant \"C or C++\". For `cysignals`, C or C++ is the same thing. It's just the separation Python <-> C/C++ that matters.\n\n> You mean `expression.pyx`, that is, just like I did in the first branch, right?\n\nYes, like in your first branch. However, your branch had many wrong usages like\n\n```\nsig_on()\nPython code\nPynac call\nPython code\nsig_off()\n```\n\nThat is certainly wrong. It should be\n\n```\nPython code\nsig_on()\nPynac call\nsig_off()\nPython code\n```\n",
    "created_at": "2017-09-27T13:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331490",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:24 rws]:
> The layer that is calling C library functions is the C++ layer

Sorry, when I said "C" I meant "C or C++". For `cysignals`, C or C++ is the same thing. It's just the separation Python <-> C/C++ that matters.

> You mean `expression.pyx`, that is, just like I did in the first branch, right?

Yes, like in your first branch. However, your branch had many wrong usages like

```
sig_on()
Python code
Pynac call
Python code
sig_off()
```

That is certainly wrong. It should be

```
Python code
sig_on()
Pynac call
sig_off()
Python code
```




---

archive/issue_comments_331491.json:
```json
{
    "body": "The code calling `normal()` should look like\n\n```\ncdef GEx result\nsig_on()\ntry:\n    result = self._gobj.normal(0, False, True)\nfinally:\n    sig_off()\nreturn new_Expression_from_GEx(self._parent, result)\n```\n\nNote that `_gobj` is a `cdef` attribute, so `self._gobj` involves no Python code. Therefore, it is safe to put inside the `sig_on()` block. On the other hand, `new_Expression_from_GEx()` is unsafe since it invokes Python code like `cls.__new__(cls)` for example.",
    "created_at": "2017-09-27T13:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331491",
    "user": "https://github.com/jdemeyer"
}
```

The code calling `normal()` should look like

```
cdef GEx result
sig_on()
try:
    result = self._gobj.normal(0, False, True)
finally:
    sig_off()
return new_Expression_from_GEx(self._parent, result)
```

Note that `_gobj` is a `cdef` attribute, so `self._gobj` involves no Python code. Therefore, it is safe to put inside the `sig_on()` block. On the other hand, `new_Expression_from_GEx()` is unsafe since it invokes Python code like `cls.__new__(cls)` for example.



---

archive/issue_comments_331492.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-27T15:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331492",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_331493.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-09-27T15:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331493",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_331494.json:
```json
{
    "body": "The `evalf()` code is more complicated. Maybe don't add the `sig_on()` there for now.\n\nAnd it would be more efficient to replace\n\n```\n    def _rel_equal2(self, right):\n```\n\nby\n\n```\n    cdef bint _rel_equal2(Expression self, Expression other) except -1:\n```\n\nThis way, you don't need the `cdef Expression l, r` variables.",
    "created_at": "2017-09-27T17:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331494",
    "user": "https://github.com/jdemeyer"
}
```

The `evalf()` code is more complicated. Maybe don't add the `sig_on()` there for now.

And it would be more efficient to replace

```
    def _rel_equal2(self, right):
```

by

```
    cdef bint _rel_equal2(Expression self, Expression other) except -1:
```

This way, you don't need the `cdef Expression l, r` variables.



---

archive/issue_comments_331495.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-27T17:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331495",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331496.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-28T05:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331496",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331497.json:
```json
{
    "body": "How come I get `SCORE src/sage/symbolic/expression.pyx: 100.0% (232 of 232)` from `sage -coverage` but the patchbot plugin fails? I'm now filling this file with useless characters just for the sake...",
    "created_at": "2017-09-28T06:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331497",
    "user": "https://github.com/rwst"
}
```

How come I get `SCORE src/sage/symbolic/expression.pyx: 100.0% (232 of 232)` from `sage -coverage` but the patchbot plugin fails? I'm now filling this file with useless characters just for the sake...



---

archive/issue_comments_331498.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-28T06:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331499.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-28T06:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331499",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331500.json:
```json
{
    "body": "Replying to [comment:32 rws]:\n> I'm now filling this file with useless characters just for the sake...\n\nPlease don't! Use your own judgement. You are smarter than the coverage plugin.",
    "created_at": "2017-09-28T15:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331500",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:32 rws]:
> I'm now filling this file with useless characters just for the sake...

Please don't! Use your own judgement. You are smarter than the coverage plugin.



---

archive/issue_comments_331501.json:
```json
{
    "body": "I'll leave it as is now; declaring something a helper function is not so bad. Patchbot is go. Please review.",
    "created_at": "2017-09-29T05:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331501",
    "user": "https://github.com/rwst"
}
```

I'll leave it as is now; declaring something a helper function is not so bad. Patchbot is go. Please review.



---

archive/issue_comments_331502.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-04T13:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331502",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331503.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2017-10-04T13:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331503",
    "user": "https://github.com/jdemeyer"
}
```

Merge conflict



---

archive/issue_comments_331504.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-04T13:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331505.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-04T13:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331505",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331506.json:
```json
{
    "body": "Good for me if this passes patchbot testing.",
    "created_at": "2017-10-04T13:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331506",
    "user": "https://github.com/jdemeyer"
}
```

Good for me if this passes patchbot testing.



---

archive/issue_comments_331507.json:
```json
{
    "body": "Passes patchbots, thanks.",
    "created_at": "2017-10-05T05:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331507",
    "user": "https://github.com/rwst"
}
```

Passes patchbots, thanks.



---

archive/issue_comments_331508.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-05T05:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331508",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_060882.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T11:45:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23688#event-60882"
}
```



---

archive/issue_comments_331509.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-15T11:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23688#issuecomment-331509",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
