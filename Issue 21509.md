# Issue 21509: overflow for vector mod2 dense

Issue created by migration from https://trac.sagemath.org/ticket/21746

Original creator: vdelecroix

Original creation time: 2016-10-23 13:04:04


```
sage: VS = VectorSpace(GF(2),1)
sage: VS([2**64])
Traceback (most recent call last):
...
OverflowError: Python int too large to convert to C long
```



---

Comment by vdelecroix created at 2016-10-23 13:17:06

Changing status from new to needs_review.


---

Comment by git created at 2016-10-23 13:17:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-10-23 18:56:55

Changing status from needs_review to positive_review.


---

Comment by git created at 2016-10-25 16:47:31

Changing status from positive_review to needs_review.


---

Comment by git created at 2016-10-25 16:47:31

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by vdelecroix created at 2016-10-25 16:48:04

Fixed doctest failure in `coding/`. Needs review again.


---

Comment by tscrim created at 2016-10-25 22:19:27

This branch does result in ~10% slowdown:

```
sage: V = VectorSpace(GF(2), 2^10)
sage: %timeit V([1]*(2^10))
The slowest run took 5.95 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 49.8 µs per loop
```

Before:

```
sage: V = VectorSpace(GF(2), 2^10)
sage: %timeit V([1]*(2^10))
The slowest run took 5.69 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 45.8 µs per loop
```

However, changing the for loop over `enumerate` back to `for i from 0 <= i < self._degree:` and setting `xi = x[i]` doesn't have a noticeable impact. So I think we have to deal with this.

I do have one nitpick: change the `ZeroDivisionError` to start with a lowercase. Once that is done, you can put this back to a positive review.


---

Comment by git created at 2016-10-26 07:19:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-26 07:28:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-10-26 07:29:17

Thanks for the timings!

I removed the enumerate and also did some cleaning in the case `x = 0`. This code is completely useless

```
for i from 0 <= i < self._degree:
    mzd_set_ui(self._entries, 0)
```



---

Comment by jdemeyer created at 2016-10-26 11:22:26

The `enumerate` is optimized by Cython, so no need to remove it!


---

Comment by tscrim created at 2016-10-26 14:54:03

I realize the phrasing in my comment was somewhat vague too; I meant we have to just live with the slowdown. I did come to the conclusion that `enumerate` was likely optimized by Cython, but it is good to know. Anyways, removing it is a net-zero change, so I'm setting this back to a positive review.


---

Comment by tscrim created at 2016-10-26 14:54:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-10-30 14:15:47

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-10-30 14:15:47

segfault galore... see patchbot


---

Comment by vdelecroix created at 2016-10-30 14:59:26

Indeed. I am able to reproduce it with the shorter

```
sage: (GF(2)**0).zero_vector()
```



---

Comment by git created at 2016-10-30 15:01:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-10-30 15:02:14

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-10-30 22:33:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-02 19:20:12

Resolution: fixed
