# Issue 30861: Package cgal-swig-bindings, script packages cgal, swig

Issue created by migration from https://trac.sagemath.org/ticket/31098

Original creator: mkoeppe

Original creation time: 2020-12-22 19:06:26

CC:  @drkwang slelievre mjo

Instead of full packaging of CGAL started in #18197, in this ticket we create a script package for CGAL just to record system package information. Likewise we create a script package for swig, which is needed for building Python bindings.

We create a normal package for `cgal-swig-bindings`.


---

Comment by mkoeppe created at 2020-12-22 19:41:38

`@`gh-DRKWang - would you be able to create the same for `swig`? 
The package information in `distros/` is coming from https://repology.org/
----
New commits:


---

Comment by @DRKWang created at 2021-01-11 18:56:49

New commits:


---

Comment by git created at 2021-01-20 16:41:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-20 18:38:24


```
+sdh_cmake -DCGAL_DIR=/usr/local/opt/cgal/lib/cmake/CGAL \
+-DBUILD_PYTHON=ON \
+-DBUILD_JAVA=OFF
```

See if you can use cmake facilities such as `cmake --find-package` (
https://blogs.kde.org/2011/11/09/cool-new-stuff-cmake-286-2-pkg-config-compatible-mode-added-use-eg-autotools)
instead of hardcoding `CGAL_DIR`


---

Comment by mkoeppe created at 2021-01-20 18:52:10

Also, where's the tarball for `cgal_swig_bindings` coming from? 
Add an URL to it as `upstream_url` as explained in https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1


---

Comment by @DRKWang created at 2021-01-20 19:37:55

Replying to [comment:7 mkoeppe]:
> Also, where's the tarball for `cgal_swig_bindings` coming from? 
> Add an URL to it as `upstream_url` as explained in https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1

The tarball can not be pushed because git ignored the upstream folder, where the tarball is stored. This tarball basically comes from compressing those files under the CGAL/cgal-swig-bindings repository and I change it a little bit. I will update the checksums.ini file and add `upstream_url` to it later, but I am not sure what platform I should upload it to.


---

Comment by mkoeppe created at 2021-01-20 20:19:59

Here's how to do this:
 - Create a fork of https://github.com/CGAL/cgal-swig-bindings into your [GitHub](GitHub) account
 - Make a release
 - Then use the archive that [GitHub](GitHub) creates for the release as the upstream URL.


---

Comment by @DRKWang created at 2021-01-21 00:14:13

Replying to [comment:6 mkoeppe]:
> {{{
> +sdh_cmake -DCGAL_DIR=/usr/local/opt/cgal/lib/cmake/CGAL \
> +-DBUILD_PYTHON=ON \
> +-DBUILD_JAVA=OFF
> }}}
> See if you can use cmake facilities such as `cmake --find-package` (
> https://blogs.kde.org/2011/11/09/cool-new-stuff-cmake-286-2-pkg-config-compatible-mode-added-use-eg-autotools)
> instead of hardcoding `CGAL_DIR`
That is awesome. Let me make it.


---

Comment by @DRKWang created at 2021-01-21 02:53:30

Replying to [comment:6 mkoeppe]:
> {{{
> +sdh_cmake -DCGAL_DIR=/usr/local/opt/cgal/lib/cmake/CGAL \
> +-DBUILD_PYTHON=ON \
> +-DBUILD_JAVA=OFF
> }}}
> See if you can use cmake facilities such as `cmake --find-package` (
> https://blogs.kde.org/2011/11/09/cool-new-stuff-cmake-286-2-pkg-config-compatible-mode-added-use-eg-autotools)
> instead of hardcoding `CGAL_DIR`

I tried it with `cmake --find-package -DNAME=CGAL -DLANGUAGE=C -DCOMPILER_ID=GNU -DMODE=COMPILE` and it returned `-I/usr/local/include` instead of what we expect --`/usr/local/opt/cgal/lib/cmake/CGAL`. This script does return the right directory based on those parameters but it only gives CGAL library containing `.h` file, whereas we hope to find CGAL library full of `.cmake` file. I also tried to set `-DLANGUAGE=cmake`, but it does not work because language options do not contain it according to this description(https://cmake.org/cmake/help/latest/command/project.html#:~:text=Supported%20languages%20include%20C%20%2C%20CXX,no%20language%20options%20are%20given.).

Besides, I also tried to install it without this setting and it turns out that setting `-DCGAL_DIR` manually is not necessary. The reason might be that `find_package(CGAL REQUIRED OPTIONAL_COMPONENTS ImageIO)` in `CMakeLists.txt` performs the same duty as the `cmake --find-package`.


---

Comment by git created at 2021-01-21 03:40:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DRKWang created at 2021-01-21 03:44:33

Replying to [comment:9 mkoeppe]:
> Here's how to do this:
>  - Create a fork of https://github.com/CGAL/cgal-swig-bindings into your [GitHub](GitHub) account
>  - Make a release
>  - Then use the archive that [GitHub](GitHub) creates for the release as the upstream URL.
I have created the fork(https://github.com/DRKWang/cgal-swig-bindings) and also update the `upstream_url` and has pushed them. Please take a look.


---

Comment by mkoeppe created at 2021-01-21 18:02:52

There was a typo in the URL, fixed. I have also merged the latest development version
----
New commits:


---

Comment by mkoeppe created at 2021-01-21 18:05:26

Related to my comment in https://github.com/DRKWang/cgal-swig-bindings/commit/044ef5f5b0ab3a5eacf741f5114d4494372e987f#commitcomment-46206802, 
see if you can force cmake to use the specific python executable used in Sage instead:
https://gitlab.kitware.com/cmake/cmake/-/issues/19492#note_603445

In the `spkg-install` script you can refer to it as `"$SAGE_VENV"/bin/python3`.


---

Comment by git created at 2021-01-21 21:58:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-21 22:01:16

This here builds for me OK with python 3.9
and then in Sage, `import CGAL` succeeds. 
Could you add some test code to the ticket description?


---

Comment by @DRKWang created at 2021-01-21 23:45:46

Replying to [comment:18 mkoeppe]:
> This here builds for me OK with python 3.9
> and then in Sage, `import CGAL` succeeds. 
> Could you add some test code to the ticket description?
No problem, let me tried it.


---

Comment by @DRKWang created at 2021-01-28 18:09:53

Replying to [comment:18 mkoeppe]:
> This here builds for me OK with python 3.9
> and then in Sage, `import CGAL` succeeds. 
> Could you add some test code to the ticket description?
I have added some test code, which comes from the official website of cgal_swig_bindings. But I am a little confused about what is the purpose of adding those test code, does it serve as checking whether the sage has been installed successfully, or checking each module of it can be performed without errors?
If the former, I think those codes are enough, if the latter, those files are supposed to be shrunk into a file.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-12-03 18:12:23

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-02-02 01:13:04

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-02-02 01:13:04

Docbuild fails:

```
OSError: /sage/src/doc/en/reference/spkg/cgal_swig_bindings.rst:4: WARNING: Title underline too short.
```



---

Comment by slelievre created at 2022-02-02 10:24:08

To fix this, in `build/pkgs/cgal_swig_bindings/SPKG.rst`,
please change

```diff
 cgal-swig-bindings
-====
+==================
```



---

Comment by slelievre created at 2022-02-06 17:22:29

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2022-02-06 17:22:29

Ready for review.
----
New commits:


---

Comment by git created at 2022-02-06 17:26:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slelievre created at 2022-02-06 17:27:49

Changing keywords from "" to "cgal, swig".


---

Comment by dimpase created at 2022-03-29 18:21:47

debian CGAL package is called `libcgal-dev`, not `cgal`.


---

Comment by git created at 2022-03-30 14:45:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-30 14:47:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slelievre created at 2022-03-30 14:49:09

> debian CGAL package is called libcgal-dev, not cgal.

Fixed.


---

Comment by git created at 2022-03-30 20:30:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-30 20:31:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-30 20:36:51

With CGAL 5.4 from homebrew:

```
[cgal_swig_bindings-5.1.0-2021-01-21] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/cgal_swig_bindings-5.1.0-2021-01-21/src/SWIG_CGAL/Kernel/typedefs.h:15:10: fatal error: 'CGAL/internal/Exact_type_selector.h' file not found
[cgal_swig_bindings-5.1.0-2021-01-21] #include <CGAL/internal/Exact_type_selector.h>
[cgal_swig_bindings-5.1.0-2021-01-21]          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[cgal_swig_bindings-5.1.0-2021-01-21] 1 error generated.
```



---

Comment by git created at 2022-03-30 21:59:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-30 21:59:43

The update fixes it.


---

Comment by dimpase created at 2022-03-31 12:49:21

Where is tarball for cgal-swig-bindings coming from? (I see it's on your [GitHub](GitHub)...)


---

Comment by mkoeppe created at 2022-03-31 13:06:11

Upstream does not make releases and does not use tags. I have set a tag in my fork of it so that I can retrieve the github archive tarball.


---

Comment by dimpase created at 2022-03-31 13:13:12

Replying to [comment:48 mkoeppe]:
> Upstream does not make releases and does not use tags. I have set a tag in my fork of it so that I can retrieve the github archive tarball.

this ought to be mentioned in e.g. `build/pkgs/cgal_swig_bindings/SPKG.rst`


---

Comment by dimpase created at 2022-03-31 13:18:47

On gentoo with its current CGAL (v.5.2.2) I see

```
[cgal_swig_bindings-5.1.0-2022-03-28] [ 61%] Building CXX object SWIG_CGAL/Mesh_3/CMakeFiles/CGAL_Mesh_3_python.dir/__/__/build-python/CGAL/CGAL_Mesh_3PYTHON_wrap.cxx.o
[cgal_swig_bindings-5.1.0-2022-03-28] In file included from /usr/include/CGAL/Mesh_3/Mesher_3.h:41,
[cgal_swig_bindings-5.1.0-2022-03-28]                  from /usr/include/CGAL/refine_mesh_3.h:28,
[cgal_swig_bindings-5.1.0-2022-03-28]                  from /usr/include/CGAL/make_mesh_3.h:26,
[cgal_swig_bindings-5.1.0-2022-03-28]                  from /mnt/opt/Sage/sage-clang/local/var/tmp/sage/build/cgal_swig_bindings-5.1.0-2022-03-28/src/SWIG_CGAL/Mesh_3/typedefs.h:17,
[cgal_swig_bindings-5.1.0-2022-03-28]                  from /mnt/opt/Sage/sage-clang/local/var/tmp/sage/build/cgal_swig_bindings-5.1.0-2022-03-28/src/SWIG_CGAL/Mesh_3/all_includes.h:9,
[cgal_swig_bindings-5.1.0-2022-03-28]                  from /mnt/opt/Sage/sage-clang/local/var/tmp/sage/build/cgal_swig_bindings-5.1.0-2022-03-28/src/build-python/CGAL/CGAL_Mesh_3PYTHON_wrap.cxx:2916:
[cgal_swig_bindings-5.1.0-2022-03-28] /usr/include/CGAL/Mesh_3/Refine_facets_3.h:29:12: fatal error: tbb/parallel_do.h: No such file or directory
[cgal_swig_bindings-5.1.0-2022-03-28]    29 |   #include <tbb/parallel_do.h>
[cgal_swig_bindings-5.1.0-2022-03-28]       |            ^~~~~~~~~~~~~~~~~~~
[cgal_swig_bindings-5.1.0-2022-03-28] compilation terminated.
[cgal_swig_bindings-5.1.0-2022-03-28] make[5]: *** [SWIG_CGAL/Mesh_3/CMakeFiles/CGAL_Mesh_3_python.dir/build.make:76: SWIG_CGAL/Mesh_3/CMakeFiles/CGAL_Mesh_3_python.dir/__/__/build-python/CGAL/CGAL_Mesh_3PYTHON_wrap.cxx.o] Error 1
```


is this a missing dependency?


---

Comment by dimpase created at 2022-03-31 13:22:52

rather, it's https://github.com/CGAL/cgal/issues/6168
(fixed in newer CGALs)


---

Comment by git created at 2022-03-31 13:46:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-31 13:51:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-03-31 21:44:54

gentoo bug reported: https://bugs.gentoo.org/836566


---

Comment by slelievre created at 2022-07-07 09:53:33

From the discussion on the gentoo ticket:
the upstream bug is fixed in CGAL 5.4.1.


---

Comment by dimpase created at 2022-07-07 12:51:16

CGAL module does not get installed into venv/, only in local/.
Thus it's not found (without modifying `sys.path`).


---

Comment by dimpase created at 2022-07-07 12:51:16

Changing status from needs_review to needs_work.


---

Comment by slelievre created at 2022-07-07 14:09:04

Suggested change in `build/pkgs/cgal_swig_bindings/SPKG.rst`:

```diff
 cgal-swig-bindings
 ==================

 Description
 -----------

-The CGAL Bindings project allows to use some packages of CGAL, the Computational Algorithms Library, in languages other than C++, as for example Java and Python. The bindings are implemented with SWIG.
+The CGAL Bindings project allows to use some packages of CGAL,
+the Computational Geometry Algorithms Library, in languages other than C++,
+such as for example Java and Python. The bindings are implemented with SWIG.

 License
 -------

 GNU GPL version 3 or later.
```

