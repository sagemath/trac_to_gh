# Issue 20338: Iterator over random vertices/edges

Issue created by migration from https://trac.sagemath.org/ticket/20575

Original creator: dcoudert

Original creation time: 2016-05-09 12:45:22

CC:  jmantysalo vdelecroix

This patch adds an iterator over random vertices/edges with better amortized performance than current methods for getting a random vertex/edge.


---

Comment by git created at 2016-05-09 15:46:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-05-10 07:10:37

Changing priority from major to minor.


---

Comment by dcoudert created at 2016-05-10 07:10:37

Changing status from new to needs_review.


---

Comment by dcoudert created at 2016-05-10 07:10:37

Improvements are certainly possible, in particular in how to handle empty graphs.


---

Comment by jmantysalo created at 2016-05-10 08:37:20

Replying to [comment:3 dcoudert]:
> Improvements are certainly possible, in particular in how to handle empty graphs.

`G.random_edge()` will raise an exception if the graph `G` has no edges at all. (Not a good exception, but at least something.) I suggest this one also to raise something instead of returning nothing.


---

Comment by git created at 2016-05-10 08:50:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-05-10 08:51:44

This is not so clear. Here we have an iterator. We will typically use it like

```
for e in G.random_edge_iterator():
    do something
    if <some condition>:
        break
```

In such case, you expect the loop to do nothing if the graph has no edge, as will be the case using `G.edge_iterator()`. Raising an error is not necessarily what we want.
The last commit raise a stopiteration. Is it ok?


---

Comment by jmantysalo created at 2016-05-10 09:14:29

Replying to [comment:6 dcoudert]:

> The last commit raise a stopiteration. Is it ok?

Hmm... I don't know. Vincent?


---

Comment by vdelecroix created at 2016-05-10 12:21:02

First of all you would better use `choice(my_list)` rather than `my_list[randint(0,length-1)]`.

And in the case of an empty graph I would either:
 - raise an `EmptySetError` (from `sage.categories.sets_cat`)
 - return an empty iterator, for example `return iter([])`

But anyway, you would better document the behavior of this special case.


---

Comment by git created at 2016-05-10 13:09:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-05-10 13:10:04

I was not aware of the `choice()` method. Thanks.

For empty graphs, I checked what is done for `edge_iterator` and I propose to follow it, that is do nothing. I have added appropriate tests.


---

Comment by vdelecroix created at 2016-05-12 05:09:34

When the test involves some randomness it is better to put a `#random` flag

```
sage: give_me_a_random_stuff()  # random
haha
```

That way the method is checked but not the actual matching with the output.

If you forward all arguments, it might be better to have both arguments and named arguments forwarded as in

```
def f(*args, **kwds):
    whatever(*args, **kwds)
```



---

Comment by git created at 2016-05-12 06:56:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-05-12 06:58:04

I was not aware of the `*args` stuff. Added.
However, I have let the `self` parameter. Is it correct?


---

Comment by vdelecroix created at 2016-05-12 13:31:33

Yes that is good.


---

Comment by vdelecroix created at 2016-05-12 13:31:33

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2016-05-12 13:35:29

Thank you :)


---

Comment by vbraun created at 2016-05-21 22:53:59

Documentation doesn't build as you can see from the patchbot output


---

Comment by vbraun created at 2016-05-21 22:53:59

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-05-22 09:01:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-05-22 09:04:34

Error due to a bad indentation. Now fixed. Sorry.


---

Comment by dcoudert created at 2016-05-22 09:04:34

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-06-01 11:00:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-06-01 11:02:34

I have rebased the patch on last beta.
Still needs review since last modification to fix a docbuild error.
Thanks.


---

Comment by vdelecroix created at 2016-06-02 08:28:01

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2016-06-02 11:21:32

Thank you.


---

Comment by vbraun created at 2016-06-02 20:58:06

Resolution: fixed
