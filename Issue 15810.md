# Issue 15810: Fix mpl header search issues on OS X 10.4

Issue created by migration from https://trac.sagemath.org/ticket/16047

Original creator: kcrisman

Original creation time: 2014-04-02 14:57:37

CC:  ppurka fbissey

I have no idea whether this is really just an issue on this platform, but it was discovered here.  Thanks to ppurka for tracking down the likely culprit for this failure [here](http://trac.sagemath.org/ticket/16002#comment:18).

```
matplotlib-1.3.1
====================================================
Setting up build directory for matplotlib-1.3.1
Finished set up
****************************************************
Host system:
Darwin Dasher-03.local 8.11.0 Darwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC Power Macintosh powerpc
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Users/student/Desktop/sage-6.2.beta5/local/libexec/gcc/powerpc-apple-darwin8.11.0/4.7.3/lto-wrapper
Target: powerpc-apple-darwin8.11.0
Configured with: ../src/configure --prefix=/Users/student/Desktop/sage-6.2.beta5/local --with-local-prefix=/Users/student/Desktop/sage-6.2.beta5/local --with-gmp=/Users/student/Desktop/sage-6.2.beta5/local --with-mpfr=/Users/student/Desktop/sage-6.2.beta5/local --with-mpc=/Users/student/Desktop/sage-6.2.beta5/local --with-system-zlib --disable-multilib --disable-nls  
Thread model: posix
gcc version 4.7.3 (GCC) 
****************************************************
NOTE: Set SAGE_MATPLOTLIB_GUI to anything but 'no' to try to build the Matplotlib GUI.
Not building any matplotlib graphical backends.
patching file lib/matplotlib/tri/_tri.cpp
patching file lib/matplotlib/tri/_tri.h
patching file setup.py
============================================================================
Edit setup.cfg to change the build options

BUILDING MATPLOTLIB
            matplotlib: yes [1.3.1]
                python: yes [2.7.5 (default, Mar 26 2014, 08:50:37)  [GCC
                        4.7.3]]
              platform: yes [darwin]

REQUIRED DEPENDENCIES AND EXTENSIONS
                 numpy: yes [version 1.7.0]
              dateutil: yes [using dateutil version 2.2]
               tornado: yes [tornado was not found. It is required for the
                        WebAgg backend. pip/easy_install may attempt to
                        install it after matplotlib.]
             pyparsing: yes [using pyparsing version 2.0.1]
                 pycxx: yes [Couldn't import.  Using local copy.]
                libagg: yes [pkg-config information for 'libagg' could not
                        be found. Using local copy.]
              freetype: no  [The C/C++ header for freetype2 (ft2build.h)
                        could not be found.  You may need to install the
                        development package.]
                   png: yes [pkg-config information for 'libpng' could not
                        be found. Using unknown version.]

OPTIONAL SUBPACKAGES
           sample_data: yes [installing]
              toolkits: yes [installing]

OPTIONAL BACKEND EXTENSIONS
                macosx: no  [skipping due to configuration]
                qt4agg: no  [PyQt4 not found]
               gtk3agg: no  [Requires pygobject to be installed.]
             gtk3cairo: no  [Requires cairo to be installed.]
                gtkagg: no  [skipping due to configuration]
                 tkagg: no  [skipping due to configuration]
                 wxagg: no  [skipping due to configuration]
                   gtk: no  [skipping due to configuration]
                   agg: yes [installing]
                 cairo: no  [cairo not found]
             windowing: no  [skipping due to configuration]

OPTIONAL LATEX DEPENDENCIES
                dvipng: no
           ghostscript: no
                 latex: no
               pdftops: no

============================================================================
                        * The following required packages can not be built:
                        * freetype
Error building matplotlib package.

real    0m10.504s
user    0m4.290s
sys     0m2.525s
************************************************************************
Error installing package matplotlib-1.3.1
************************************************************************
```


See [another](https://gist.github.com/anonymous/8075373) [reports on](https://github.com/Homebrew/homebrew-python/issues/74) [homebrew](https://github.com/Homebrew/homebrew-python/issues/62) for something very similar.  [Here](http://trac.macports.org/ticket/41593) [are some https://github.com/Homebrew/homebrew-versions/pull/302] [fixes](https://github.com/matplotlib/matplotlib/pull/2623).  Somewhat surprisingly, the [mpl commit](https://github.com/efiring/matplotlib/commit/be37790f449641a6ead3af2d2334cc544789e869) is a one-liner.


---

Comment by kcrisman created at 2014-04-02 15:12:19

Yup, just adding a patch in `build/pkgs/matplotlib/patches` with [this commit](https://github.com/efiring/matplotlib/commit/be37790f449641a6ead3af2d2334cc544789e869) got me to the actual build of mpl.  It's not clear when the next upstream release is, but it's fixed in their trunk so no need to report upstream.


---

Comment by kcrisman created at 2014-04-02 17:50:01

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-04-02 17:50:01

I am annoyed that I had to do this setting of the branch by hand.  [The devel guide said so](http://www.sagemath.org/doc/developer/manual_git.html#pushing-your-changes-to-a-ticket) but I didn't have it figure out that it really meant "set it by typing on Trac".  Huh.

This and I think a few other mpl patches will need to be removed whenever mpl upgrades but that will be a while, perhaps.


---

Comment by fbissey created at 2014-04-02 20:47:52

My head hurts trying to think why it is an issue with your mac and not on other platforms. There must be something that setupext.py finds on a OS X 10.4 before the stuff in pkg-config that it doesn't on other platform. I almost fell like resurrecting an ancient distro to test that theory.


---

Comment by kcrisman created at 2014-04-03 01:33:51

> My head hurts trying to think why it is an issue with your mac and not on other platforms. There must be something that setupext.py finds on a OS X 10.4 before the stuff in pkg-config that it doesn't on other platform. I almost fell like resurrecting an ancient distro to test that theory.
Yay, I made someone's head hurt!

Seriously, I was baffled - and why does it hurt pip install but not others? - but at any rate this works *and* (crucially) is already in upstream, so as long as it doesn't give us any surprises I figure we should be okay.  (For instance, someone might want to make sure that a few figures actually plot correctly with this.)


---

Comment by vbraun created at 2014-04-05 10:50:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-06 20:49:03

Resolution: fixed


---

Comment by kcrisman created at 2014-04-07 16:39:51

See also #16084.
