# Issue 13127: Improve slice and __getitem__ methods of padics

archive/issues_013127.json:
```json
{
    "body": "Assignee: @roed314\n\nCC:  @roed314\n\nThere are a few surprises/bugs in the way that slices and `__getitem__` works for padics.\n\n* Slices are not supported in some cases:\n\n```\nsage: R = Zp(5, 6, 'capped-rel')\nsage: a = R(1/2); a\n3 + 2*5 + 2*5^2 + 2*5^3 + 2*5^4 + 2*5^5 + O(5^6)\nsage: a[0:5]\nValueError: due to limitations in Python 2.5, you must call the slice() function rather than using the [:] syntax in this case\n```\n\n* The precision is sometimes wrong over fields:\n\n```\nsage: K = Qp(5, 6)\nsage: a = K(1/25); a\n5^-2 + O(5^4)\nsage: a.slice(2, 4)\nO(5^6)\n```\n\n* Over fields, the coefficients are sometimes wrong:\n\n```\nsage: a.slice(-5, -1)\n5^-5 + O(5)\n```\n\n* Some indices produce an error, even though they are inside the precision:\n\n```\nsage: a.precision_absolute()\n4\nsage: a[0]\nIndexError: list index out of range\n```\n\n* The returned values are sometimes padics\n\n```\nsage: a = K(1/5 + 5); a\n5^-1 + 5 + O(5^5)\nsage: a[-2].parent()\n5-adic Field with capped relative precision 6\nsage: a[-1].parent()\nInteger Ring\n```\n\n* They do not seem to work over unramified extensions. This will be the topic of a followup ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13299\n\n",
    "created_at": "2012-07-26T16:57:32Z",
    "labels": [
        "component: padics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "Improve slice and __getitem__ methods of padics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13127",
    "user": "https://github.com/saraedum"
}
```
Assignee: @roed314

CC:  @roed314

There are a few surprises/bugs in the way that slices and `__getitem__` works for padics.

* Slices are not supported in some cases:

```
sage: R = Zp(5, 6, 'capped-rel')
sage: a = R(1/2); a
3 + 2*5 + 2*5^2 + 2*5^3 + 2*5^4 + 2*5^5 + O(5^6)
sage: a[0:5]
ValueError: due to limitations in Python 2.5, you must call the slice() function rather than using the [:] syntax in this case
```

* The precision is sometimes wrong over fields:

```
sage: K = Qp(5, 6)
sage: a = K(1/25); a
5^-2 + O(5^4)
sage: a.slice(2, 4)
O(5^6)
```

* Over fields, the coefficients are sometimes wrong:

```
sage: a.slice(-5, -1)
5^-5 + O(5)
```

* Some indices produce an error, even though they are inside the precision:

```
sage: a.precision_absolute()
4
sage: a[0]
IndexError: list index out of range
```

* The returned values are sometimes padics

```
sage: a = K(1/5 + 5); a
5^-1 + 5 + O(5^5)
sage: a[-2].parent()
5-adic Field with capped relative precision 6
sage: a[-1].parent()
Integer Ring
```

* They do not seem to work over unramified extensions. This will be the topic of a followup ticket.

Issue created by migration from https://trac.sagemath.org/ticket/13299





---

archive/issue_comments_159554.json:
```json
{
    "body": "The attached patch fixes these issues.",
    "created_at": "2012-07-26T17:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159554",
    "user": "https://github.com/saraedum"
}
```

The attached patch fixes these issues.



---

archive/issue_comments_159555.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-26T17:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159555",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_159556.json:
```json
{
    "body": "CCed roed since he seems to be last one who made substantial changes to these methods.",
    "created_at": "2012-07-26T17:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159556",
    "user": "https://github.com/saraedum"
}
```

CCed roed since he seems to be last one who made substantial changes to these methods.



---

archive/issue_comments_159557.json:
```json
{
    "body": "When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent. But here are a few comments (having not tried the patch):\n\nFor LocalGenericElement:\n\n-line 55 should say \"nonnegative integers `l`\"\n\n-line 89 should say \"if `i` exceeds `j`\"\n\n-I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like \"relative\". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of \"significant digits\".",
    "created_at": "2012-09-02T18:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159557",
    "user": "https://github.com/rharron"
}
```

When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent. But here are a few comments (having not tried the patch):

For LocalGenericElement:

-line 55 should say "nonnegative integers `l`"

-line 89 should say "if `i` exceeds `j`"

-I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like "relative". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of "significant digits".



---

archive/issue_comments_159558.json:
```json
{
    "body": "Thanks for having a look at this.\n\nReplying to [comment:5 robharron]:\n> When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent.\n\nI only have 5.1 installed right now. I'll try to apply the patch again, as soon as I upgrade to 5.3.\n\n> For LocalGenericElement:\n\n> -line 55 should say \"nonnegative integers `l`\"\n\n> -line 89 should say \"if `i` exceeds `j`\"\n\n\nI updated the patch with these two changes.\n\n> -I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like \"relative\". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of \"significant digits\".\n\nIt would not be hard to implement something like this. Probably it should not be called slicing but use a different method to not confuse people who are used to python's slicing. If you would like to see such a feature, you should probably open a new ticket and link it here.",
    "created_at": "2012-09-06T13:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159558",
    "user": "https://github.com/saraedum"
}
```

Thanks for having a look at this.

Replying to [comment:5 robharron]:
> When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent.

I only have 5.1 installed right now. I'll try to apply the patch again, as soon as I upgrade to 5.3.

> For LocalGenericElement:

> -line 55 should say "nonnegative integers `l`"

> -line 89 should say "if `i` exceeds `j`"


I updated the patch with these two changes.

> -I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like "relative". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of "significant digits".

It would not be hard to implement something like this. Probably it should not be called slicing but use a different method to not confuse people who are used to python's slicing. If you would like to see such a feature, you should probably open a new ticket and link it here.



---

archive/issue_comments_159559.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-27T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159559",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_159560.json:
```json
{
    "body": "I want to remove `self` from the docstrings.",
    "created_at": "2012-10-27T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159560",
    "user": "https://github.com/saraedum"
}
```

I want to remove `self` from the docstrings.



---

archive/issue_comments_159561.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-13T16:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159561",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_159562.json:
```json
{
    "body": "Attachment [trac_13299.patch](tarball://root/attachments/some-uuid/ticket13299/trac_13299.patch) by @saraedum created at 2013-02-13 16:58:29",
    "created_at": "2013-02-13T16:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159562",
    "user": "https://github.com/saraedum"
}
```

Attachment [trac_13299.patch](tarball://root/attachments/some-uuid/ticket13299/trac_13299.patch) by @saraedum created at 2013-02-13 16:58:29



---

archive/issue_comments_159563.json:
```json
{
    "body": "Attachment [13299_review.patch](tarball://root/attachments/some-uuid/ticket13299/13299_review.patch) by @roed314 created at 2013-03-16 19:43:06",
    "created_at": "2013-03-16T19:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159563",
    "user": "https://github.com/roed314"
}
```

Attachment [13299_review.patch](tarball://root/attachments/some-uuid/ticket13299/13299_review.patch) by @roed314 created at 2013-03-16 19:43:06



---

archive/issue_comments_159564.json:
```json
{
    "body": "Looks good.",
    "created_at": "2013-03-17T06:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159564",
    "user": "https://github.com/roed314"
}
```

Looks good.



---

archive/issue_comments_159565.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-17T06:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159565",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_159566.json:
```json
{
    "body": "We missed one WARNING in the second review patch.",
    "created_at": "2013-03-18T06:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159566",
    "user": "https://github.com/saraedum"
}
```

We missed one WARNING in the second review patch.



---

archive/issue_comments_159567.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-03-18T06:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159567",
    "user": "https://github.com/saraedum"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_159568.json:
```json
{
    "body": "fixed new-style slices",
    "created_at": "2013-03-18T06:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159568",
    "user": "https://github.com/saraedum"
}
```

fixed new-style slices



---

archive/issue_comments_159569.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-18T06:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159569",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_159570.json:
```json
{
    "body": "Attachment [trac_13299_review2.patch](tarball://root/attachments/some-uuid/ticket13299/trac_13299_review2.patch) by @saraedum created at 2013-03-18 06:16:57",
    "created_at": "2013-03-18T06:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159570",
    "user": "https://github.com/saraedum"
}
```

Attachment [trac_13299_review2.patch](tarball://root/attachments/some-uuid/ticket13299/trac_13299_review2.patch) by @saraedum created at 2013-03-18 06:16:57



---

archive/issue_comments_159571.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-18T08:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159571",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_159572.json:
```json
{
    "body": "Sure.",
    "created_at": "2013-03-18T08:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159572",
    "user": "https://github.com/roed314"
}
```

Sure.



---

archive/issue_comments_159573.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-20T14:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13127#issuecomment-159573",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
