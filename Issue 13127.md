# Issue 13127: Improve slice and __getitem__ methods of padics

Issue created by migration from https://trac.sagemath.org/ticket/13299

Original creator: saraedum

Original creation time: 2012-07-26 16:57:32

Assignee: roed

CC:  roed

There are a few surprises/bugs in the way that slices and `__getitem__` works for padics.

* Slices are not supported in some cases:

```
sage: R = Zp(5, 6, 'capped-rel')
sage: a = R(1/2); a
3 + 2*5 + 2*5^2 + 2*5^3 + 2*5^4 + 2*5^5 + O(5^6)
sage: a[0:5]
ValueError: due to limitations in Python 2.5, you must call the slice() function rather than using the [:] syntax in this case
```

* The precision is sometimes wrong over fields:

```
sage: K = Qp(5, 6)
sage: a = K(1/25); a
5^-2 + O(5^4)
sage: a.slice(2, 4)
O(5^6)
```

* Over fields, the coefficients are sometimes wrong:

```
sage: a.slice(-5, -1)
5^-5 + O(5)
```

* Some indices produce an error, even though they are inside the precision:

```
sage: a.precision_absolute()
4
sage: a[0]
IndexError: list index out of range
```

* The returned values are sometimes padics

```
sage: a = K(1/5 + 5); a
5^-1 + 5 + O(5^5)
sage: a[-2].parent()
5-adic Field with capped relative precision 6
sage: a[-1].parent()
Integer Ring
```

* They do not seem to work over unramified extensions. This will be the topic of a followup ticket.


---

Comment by saraedum created at 2012-07-26 17:01:05

The attached patch fixes these issues.


---

Comment by saraedum created at 2012-07-26 17:01:05

Changing status from new to needs_review.


---

Comment by saraedum created at 2012-07-26 17:03:04

CCed roed since he seems to be last one who made substantial changes to these methods.


---

Comment by robharron created at 2012-09-02 18:27:34

When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent. But here are a few comments (having not tried the patch):

For LocalGenericElement:

-line 55 should say "nonnegative integers `l`"

-line 89 should say "if `i` exceeds `j`"

-I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like "relative". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of "significant digits".


---

Comment by saraedum created at 2012-09-06 13:55:07

Thanks for having a look at this.

Replying to [comment:5 robharron]:
> When I tried to apply this on top of version 5.2 nothing happened. Now, I've never tried to apply anyone else's patch, so maybe I'm just incompetent.

I only have 5.1 installed right now. I'll try to apply the patch again, as soon as I upgrade to 5.3.

> For LocalGenericElement:

> -line 55 should say "nonnegative integers `l`"

> -line 89 should say "if `i` exceeds `j`"


I updated the patch with these two changes.

> -I think it would be nice if there was some relative version of slicing. Maybe by adding a True/False parameter like "relative". Then, j would represent a length rather than an absolute cutoff. This would allow a slice that keep a certain number of "significant digits".

It would not be hard to implement something like this. Probably it should not be called slicing but use a different method to not confuse people who are used to python's slicing. If you would like to see such a feature, you should probably open a new ticket and link it here.


---

Comment by saraedum created at 2012-10-27 15:10:48

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2012-10-27 15:10:48

I want to remove `self` from the docstrings.


---

Comment by saraedum created at 2013-02-13 16:55:06

Changing status from needs_work to needs_review.


---

Attachment


---

Attachment


---

Comment by roed created at 2013-03-17 06:29:44

Looks good.


---

Comment by roed created at 2013-03-17 06:29:44

Changing status from needs_review to positive_review.


---

Comment by saraedum created at 2013-03-18 06:14:34

We missed one WARNING in the second review patch.


---

Comment by saraedum created at 2013-03-18 06:14:34

Changing status from positive_review to needs_work.


---

Comment by saraedum created at 2013-03-18 06:16:42

fixed new-style slices


---

Comment by saraedum created at 2013-03-18 06:16:57

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by roed created at 2013-03-18 08:54:36

Changing status from needs_review to positive_review.


---

Comment by roed created at 2013-03-18 08:54:36

Sure.


---

Comment by jdemeyer created at 2013-03-20 14:44:02

Resolution: fixed
