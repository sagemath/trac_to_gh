# Issue 27616: polymake: Install gcc if system gcc older than 5.1

Issue created by migration from https://trac.sagemath.org/ticket/27853

Original creator: mkoeppe

Original creation time: 2019-05-20 03:09:42

CC:  dimpase




---

Comment by mkoeppe created at 2019-05-20 03:29:06

Can this be done with spkg-configure?


---

Comment by dimpase created at 2019-05-20 06:25:48

Do you mean the  spkg-configure of polymake?

This might be a bit tricky, I'd just implement a version check, which errors
out with a message to install a newer gcc. You if needed might tweak spkg-configure of gcc to make it easier.

As well, very old gcc's (say, 4.4) cannot even compile Sage's gcc.

Also note that clang typically fakes a gcc, sometimes (on OSX) quite old one.


---

Comment by dimpase created at 2019-05-20 11:51:38

on the other hand, yes, in `polymake/spkg-config.m4` you can do something like 

```
SAGE_SPKG_CONFIGURE([gcc], [
    sage_spkg_install_polymake=yes
    AC_REQUIRE([SAGE_SPKG_CONFIGURE_GMP])
    if test $IS_REALLY_GCC = yes ; then
       AS_CASE(["$GXX_VERSION.0"],
           [[[0-4]].*|5.0.*], [
               SAGE_MUST_INSTALL_GCC([you have $CXX version $GXX_VERSION, which is too old to build polymake])
                ])
    fi
```


but I am not sure whether this would kick in regardless of the experimental status of polymake.

In fact I would be in favours of dropping gcc 4 support completely, and require at least 5.1 globally.


---

Comment by mkoeppe created at 2019-05-20 13:43:39

I tried this (see branch) but it seems that this script is always run, even if polymake is not requested. 
----
New commits:


---

Comment by dimpase created at 2019-05-20 16:24:52

One can have a `--with-polymake=install` (with default value `no`) switch tested in spkg-config, so that its contents is skipped, unless `install` is given as the value of this parameter. Except this would be a non-standard way to install a package. 

[Jeez, how much I hate `sage -i/-f` thing... :-)]


---

Comment by mkoeppe created at 2019-05-20 16:34:13

Replying to [comment:6 dimpase]:
> One can have a `--with-polymake=install` (with default value `no`) switch tested in spkg-config, so that its contents is skipped, unless `install` is given as the value of this parameter. Except this would be a non-standard way to install a package. 

Hardly an improvement.

> [Jeez, how much I hate `sage -i/-f` thing... :-)]

Where's the ticket that will change "sage -i PACKAGE" to just reconfiguration with "--enable-PACKAGE" appended to the configure command line and "make build"?


---

Comment by dimpase created at 2019-05-20 16:46:43

You can read on recent (mis)adventures in this domain on #27373, #27642...

Feel free to open such a ticket though and cc me on it.


---

Comment by dimpase created at 2019-05-20 17:24:07

how about we re-target this ticket to bump up the minimal gcc version to 5.1?


---

Comment by mkoeppe created at 2019-05-20 18:55:06

Replying to [comment:9 dimpase]:
> how about we re-target this ticket to bump up the minimal gcc version to 5.1?
It's better if that goal is not associated with an experimental package.


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by mkoeppe created at 2020-05-01 18:16:15

Moving some tickets to 9.2. This is not a promise that I will be working on them.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2022-07-27 05:33:19

outdated, should close


---

Comment by mkoeppe created at 2022-07-27 05:33:19

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-07-27 08:20:25

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-08-02 06:31:03

Resolution: invalid
