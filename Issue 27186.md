# Issue 27186: fix constructor of ConvexRationalPolyhedralCone

Issue created by migration from https://trac.sagemath.org/ticket/27423

Original creator: vdelecroix

Original creation time: 2019-03-04 19:23:33

CC:  novoselt

The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an "advanced" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).

This ticket stands to fix the behavior.


---

Comment by novoselt created at 2019-03-05 00:09:15

How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.


---

Comment by vdelecroix created at 2019-03-05 09:39:29

Replying to [comment:2 novoselt]:
> How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.

`PPL` (the C++ library) does not implement any mutability flag. This is why it has disappeared in the Python interface `pplpy`. A mutability flag is definitely error prone since you can still modify the polyhedron via C++ access to `thisptr`. Unless you have a serious use case for this immutability flag I am not inclined to reintroduce it.


---

Comment by vdelecroix created at 2019-03-05 09:40:36

What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.


---

Comment by vdelecroix created at 2019-03-05 09:42:45

Replying to [comment:4 vdelecroix]:
> What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.

Indeed, PPL has copy constructor which I believe does the right thing.


---

Comment by novoselt created at 2019-03-05 17:01:37

What if it is not gigantic, but there are 400 millions of them? What's the point to copy it if you specifically produced a PPL object to feed into constructor? Given that it is unlikely to be used "by accident", I think it should be kept as is, but the documentation should clearly say that it will be stored in a private attribute and will be assumed not to change.


---

Comment by vdelecroix created at 2019-03-05 17:19:42

New commits:


---

Comment by vdelecroix created at 2019-03-05 17:19:42

Changing status from new to needs_review.


---

Comment by novoselt created at 2019-03-06 17:31:21

Should it be "make a copy" rather than "take a copy"?


---

Comment by git created at 2019-03-06 17:35:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2019-03-06 17:37:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-07 19:26:53

Resolution: fixed
