# Issue 11965: Fix parallel building Singular

archive/issues_011965.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jhpalmieri malb\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12137\n\n",
    "created_at": "2011-12-09T22:10:32Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Fix parallel building Singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11965",
    "user": "jdemeyer"
}
```
Assignee: tbd

CC:  jhpalmieri malb



Issue created by migration from https://trac.sagemath.org/ticket/12137





---

archive/issue_comments_137645.json:
```json
{
    "body": "Fixed one issue, hit another.  It seems Singular's Makefiles are very broken.  Looks like a \"$MAKE -j1\" is in order.",
    "created_at": "2011-12-09T22:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137645",
    "user": "jdemeyer"
}
```

Fixed one issue, hit another.  It seems Singular's Makefiles are very broken.  Looks like a "$MAKE -j1" is in order.



---

archive/issue_comments_137646.json:
```json
{
    "body": "At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by \"make -j1\".",
    "created_at": "2011-12-10T11:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137646",
    "user": "malb"
}
```

At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by "make -j1".



---

archive/issue_comments_137647.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-10T11:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137647",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_137648.json:
```json
{
    "body": "Replying to [comment:6 malb]:\n> At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by \"make -j1\".\nFair enough.  I found two problems and fixed them.  I am now continuously building Singular in a loop, so far it seems to work.  So needs_review.",
    "created_at": "2011-12-10T11:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137648",
    "user": "jdemeyer"
}
```

Replying to [comment:6 malb]:
> At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by "make -j1".
Fair enough.  I found two problems and fixed them.  I am now continuously building Singular in a loop, so far it seems to work.  So needs_review.



---

archive/issue_comments_137649.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-10T11:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137649",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_137650.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-10T11:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137650",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_137651.json:
```json
{
    "body": "diff for the new Singular spkg, for review only",
    "created_at": "2011-12-10T12:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137651",
    "user": "jdemeyer"
}
```

diff for the new Singular spkg, for review only



---

archive/issue_comments_137652.json:
```json
{
    "body": "Attachment [singular-3-1-3-3.p1-p2.diff](tarball://root/attachments/some-uuid/ticket12137/singular-3-1-3-3.p1-p2.diff) by vbraun created at 2011-12-10 16:19:08\n\nIs there a particular reason why you are adding the `+` to some commands in the makefile?\n\n```\n-       $(recurse) \n+       +$(recurse) \n```\n\nI'm fine with it as it helps debugging, but it shouldn't change whether or not the Singular spkg builds.",
    "created_at": "2011-12-10T16:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137652",
    "user": "vbraun"
}
```

Attachment [singular-3-1-3-3.p1-p2.diff](tarball://root/attachments/some-uuid/ticket12137/singular-3-1-3-3.p1-p2.diff) by vbraun created at 2011-12-10 16:19:08

Is there a particular reason why you are adding the `+` to some commands in the makefile?

```
-       $(recurse) 
+       +$(recurse) 
```

I'm fine with it as it helps debugging, but it shouldn't change whether or not the Singular spkg builds.



---

archive/issue_comments_137653.json:
```json
{
    "body": "Replying to [comment:12 vbraun]:\n> Is there a particular reason why you are adding the `+` to some commands in the makefile?\nTo fix the warning\n\n```\nmake[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule.\n```\n\nThe problem is that `make` doesn't recognize it as a recursive rule because the command is the result of a variable expansion.\n\n> I'm fine with it as it helps debugging\nDebugging, how?\n\n> but it shouldn't change whether or not the Singular spkg builds.\nTrue.  But it does fit with the theme of fixing parallel building.",
    "created_at": "2011-12-10T16:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137653",
    "user": "jdemeyer"
}
```

Replying to [comment:12 vbraun]:
> Is there a particular reason why you are adding the `+` to some commands in the makefile?
To fix the warning

```
make[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule.
```

The problem is that `make` doesn't recognize it as a recursive rule because the command is the result of a variable expansion.

> I'm fine with it as it helps debugging
Debugging, how?

> but it shouldn't change whether or not the Singular spkg builds.
True.  But it does fit with the theme of fixing parallel building.



---

archive/issue_comments_137654.json:
```json
{
    "body": "I guess the usual use for `+` rules is to execute the command even if you run `make --just-print`. I hadn't thought about the make job server, this is indeed modified as well.",
    "created_at": "2011-12-10T16:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137654",
    "user": "vbraun"
}
```

I guess the usual use for `+` rules is to execute the command even if you run `make --just-print`. I hadn't thought about the make job server, this is indeed modified as well.



---

archive/issue_comments_137655.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-10T16:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137655",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_137656.json:
```json
{
    "body": "This also works for me.  I could force the old version to fail when building in parallel (on sage.math: `MAKEFLAGS='j -l8' ./sage -f ...`, and similar on OS X).  With the new spkg, it has built every time on sage.math (using both `-l30` and `-l2`).  On OS X, I had one failure with the new spkg using `-l8`, although I've had 4 successful builds that way.  The machine only has 2 cores, so `-l8` is probably a bad setting anyway.  With `-l2` on that machine, no problems.",
    "created_at": "2011-12-10T21:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137656",
    "user": "jhpalmieri"
}
```

This also works for me.  I could force the old version to fail when building in parallel (on sage.math: `MAKEFLAGS='j -l8' ./sage -f ...`, and similar on OS X).  With the new spkg, it has built every time on sage.math (using both `-l30` and `-l2`).  On OS X, I had one failure with the new spkg using `-l8`, although I've had 4 successful builds that way.  The machine only has 2 cores, so `-l8` is probably a bad setting anyway.  With `-l2` on that machine, no problems.



---

archive/issue_comments_137657.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-12-10T23:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-137657",
    "user": "jdemeyer"
}
```

Resolution: fixed
