# Issue 11965: Fix parallel building Singular

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-12-09 22:10:32

Assignee: tbd

CC:  jhpalmieri malb




---

Comment by jdemeyer created at 2011-12-09 22:58:40

Fixed one issue, hit another.  It seems Singular's Makefiles are very broken.  Looks like a "$MAKE -j1" is in order.


---

Comment by malb created at 2011-12-10 11:29:59

At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by "make -j1".


---

Comment by jdemeyer created at 2011-12-10 11:38:23

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-12-10 11:38:23

Replying to [comment:6 malb]:
> At some Sage/Singular days there was a push to make Singular compile in parallel and it worked. Perhaps it got broken recently, but the Singular developers do fix these bugs. Hence, they should be reported upstream and fixed,not worked around by "make -j1".
Fair enough.  I found two problems and fixed them.  I am now continuously building Singular in a loop, so far it seems to work.  So needs_review.


---

Comment by jdemeyer created at 2011-12-10 11:51:18

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-12-10 11:58:11

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-12-10 12:42:52

diff for the new Singular spkg, for review only


---

Attachment

Is there a particular reason why you are adding the `+` to some commands in the makefile?

```
-       $(recurse) 
+       +$(recurse) 
```

I'm fine with it as it helps debugging, but it shouldn't change whether or not the Singular spkg builds.


---

Comment by jdemeyer created at 2011-12-10 16:25:15

Replying to [comment:12 vbraun]:
> Is there a particular reason why you are adding the `+` to some commands in the makefile?
To fix the warning

```
make[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule.
```

The problem is that `make` doesn't recognize it as a recursive rule because the command is the result of a variable expansion.

> I'm fine with it as it helps debugging
Debugging, how?

> but it shouldn't change whether or not the Singular spkg builds.
True.  But it does fit with the theme of fixing parallel building.


---

Comment by vbraun created at 2011-12-10 16:38:47

I guess the usual use for `+` rules is to execute the command even if you run `make --just-print`. I hadn't thought about the make job server, this is indeed modified as well.


---

Comment by vbraun created at 2011-12-10 16:38:47

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2011-12-10 21:47:26

This also works for me.  I could force the old version to fail when building in parallel (on sage.math: `MAKEFLAGS='j -l8' ./sage -f ...`, and similar on OS X).  With the new spkg, it has built every time on sage.math (using both `-l30` and `-l2`).  On OS X, I had one failure with the new spkg using `-l8`, although I've had 4 successful builds that way.  The machine only has 2 cores, so `-l8` is probably a bad setting anyway.  With `-l2` on that machine, no problems.


---

Comment by jdemeyer created at 2011-12-10 23:05:38

Resolution: fixed
