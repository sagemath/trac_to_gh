# Issue 19581: Modernize eclib library interface

Issue created by migration from https://trac.sagemath.org/ticket/19818

Original creator: jdemeyer

Original creation time: 2016-01-01 14:01:29

CC:  cremona jpflori

As part of cleaning up library interfaces, clean up `eclib`.


---

Comment by cremona created at 2016-01-01 15:33:19

I have commented at the upstream Issue, but I would not call this a bug.  The build system  causes all the code to be compiled with a certain macro defined (namely NTL_ALL), and the code will not build without that flag being defined, but the build system does not allow any way for that macro not to be defined anyway!


---

Comment by jdemeyer created at 2016-01-01 18:16:00

Replying to [comment:2 cremona]:
> I have commented at the upstream Issue, but I would not call this a bug.

It's at least a _documentation_ bug (it's not true that `NTL_ALL` is the default).

> The build system...

Which "build system" are you talking about and why do you claim that "the build system does not allow any way for that macro not to be defined"


---

Comment by jdemeyer created at 2016-01-01 18:16:52

I am working on cleaning up the Cython interface to `eclib` and got this doctest failure, any quick idea?

```
sage -t src/sage/libs/mwrank/interface.py
**********************************************************************
File "src/sage/libs/mwrank/interface.py", line 283, in sage.libs.mwrank.interface.mwrank_EllipticCurve.isogeny_class
Failed example:
    E.isogeny_class()
Expected:
    ([[0, -1, 1, 0, 0], [0, -1, 1, -10, -20], [0, -1, 1, -7820, -263580]], [[0, 5, 0], [5, 0, 5], [0, 5, 0]])
Got:
    ([[0, -1, 1, 0, 0], [0, -1, 1, -10, -20], [0, -1, 1, -7820, -263580]],
     [[0, 0, 5], [0, 0, 0], [5, 0, 0]])
**********************************************************************
```



---

Comment by jdemeyer created at 2016-01-01 18:45:14

It seems that simply changing the order of `#include "eclib/moddata.h"` causes this doctest failure.


---

Comment by cremona created at 2016-01-01 19:35:30

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 cremona]:
> > I have commented at the upstream Issue, but I would not call this a bug.
> 
> It's at least a _documentation_ bug (it's not true that `NTL_ALL` is the default).
> 
> > The build system...
> 
> Which "build system" are you talking about and why do you claim that "the build system 

I meant the auto tools stuff.



does not allow any way for that macro not to be defined"

There is no option to Configure which affects it.


---

Comment by cremona created at 2016-01-01 19:37:57

The second output is wrong  (the one where the matrix has a zero row ).

moddata.h has nothing at all to do with elliptic curve isogenies!


---

Comment by jdemeyer created at 2016-01-01 20:36:17

Replying to [comment:8 cremona]:
> moddata.h has nothing at all to do with elliptic curve isogenies!

Still, simply including that file earlier breaks that doctest...


---

Comment by jdemeyer created at 2016-01-01 21:46:55

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-01-01 21:46:55

New commits:


---

Comment by jdemeyer created at 2016-01-03 15:28:35

`@`jpflori: could you review this please? It is very similar in spirit to the NTL cleanup we did recently.


---

Comment by cremona created at 2016-01-03 16:02:30

I agree that changing the name from sage.libs.mwrank is a good idea but why not change it to sage.libs.eclib ?


---

Comment by jdemeyer created at 2016-01-03 16:07:21

Replying to [comment:14 cremona]:
> I agree that changing the name from sage.libs.mwrank is a good idea but why not change it to sage.libs.eclib ?

First of all, tt's clear that all `eclib` interface code should be in one place, not split in `sage.libs.mwrank` and `sage.libs.cremona`.

Do you prefer to change both to `sage.libs.eclib`?


---

Comment by cremona created at 2016-01-03 16:11:54

Replying to [comment:15 jdemeyer]:
> Replying to [comment:14 cremona]:
> > I agree that changing the name from sage.libs.mwrank is a good idea but why not change it to sage.libs.eclib ?
> 
> First of all, tt's clear that all `eclib` interface code should be in one place, not split in `sage.libs.mwrank` and `sage.libs.cremona`.
> 
> Do you prefer to change both to `sage.libs.eclib`?

Yes I prefer that.   eclib might outlive me!


---

Comment by jdemeyer created at 2016-01-03 16:15:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-01-03 16:57:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-01-03 18:17:51

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2016-01-05 13:55:43

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2016-01-05 13:55:43

Looks ok to me.


---

Comment by vbraun created at 2016-01-06 12:03:26

Resolution: fixed
