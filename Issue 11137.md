# Issue 11137: Sage sees -x +y > 0, -y + x >= 0,  and  x -y > 0 as equivalent

archive/issues_011137.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kini kcrisman tnv\n\nKeywords: inequality, equality\n\n-x + y > 0 and x - y > 0  are treated the same in Sage.  \n\nsage: version()\n'Sage Version 4.6.2, Release Date: 2011-02-25'\n\nsage: (-x +y < 0) in [x -y < 0] \nTrue \n\nSet([-x +y >= 0,x -y >= 0]) \n{-x + y >= 0} \n\n\nand they have the same Hash\n\nsage: var('x,y') \n(x, y) \nsage: hash(-x + y > 0 )\n1221566266\nsage: hash(-x + y >= 0 )\n1221566266\nsage: hash(x - y >= 0 )\n1221566266\nsage: hash(-y + x >= 0 )\n1221566266\nsage: hash(x - y > 0 )\n1221566266\n\n\nIt seems to me that Sage treats > , >= ,  ==  the same (see http://trac.sagemath.org/sage_trac/ticket/7660).    If this is true then it's a serious problem and needs to be addressed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11309\n\n",
    "created_at": "2011-05-06T22:44:13Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "Sage sees -x +y > 0, -y + x >= 0,  and  x -y > 0 as equivalent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11137",
    "user": "tnv"
}
```
Assignee: burcin

CC:  kini kcrisman tnv

Keywords: inequality, equality

-x + y > 0 and x - y > 0  are treated the same in Sage.  

sage: version()
'Sage Version 4.6.2, Release Date: 2011-02-25'

sage: (-x +y < 0) in [x -y < 0] 
True 

Set([-x +y >= 0,x -y >= 0]) 
{-x + y >= 0} 


and they have the same Hash

sage: var('x,y') 
(x, y) 
sage: hash(-x + y > 0 )
1221566266
sage: hash(-x + y >= 0 )
1221566266
sage: hash(x - y >= 0 )
1221566266
sage: hash(-y + x >= 0 )
1221566266
sage: hash(x - y > 0 )
1221566266


It seems to me that Sage treats > , >= ,  ==  the same (see http://trac.sagemath.org/sage_trac/ticket/7660).    If this is true then it's a serious problem and needs to be addressed.

Issue created by migration from https://trac.sagemath.org/ticket/11309





---

archive/issue_comments_121844.json:
```json
{
    "body": "Ready for review! Thanks to Burcin for walking me through the Cython code.",
    "created_at": "2011-06-16T00:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121844",
    "user": "kini"
}
```

Ready for review! Thanks to Burcin for walking me through the Cython code.



---

archive/issue_comments_121845.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-16T00:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121845",
    "user": "kini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_121846.json:
```json
{
    "body": "Thanks for creating the patch!!\n\n\nI don't know how to apply this patch though  - if you can walk me through it then I can test.  \n\nBut in the mean time, what are the result for these commands ?   If the results are different than the defected version above and as expected then probably the patch is correct.  \n\nsage: (-x +y < 0) in [x -y < 0] \n\nSet([-x +y >= 0,x -y >= 0]) \n\nsage: var('x,y') \n(x, y) \nsage: hash(-x + y > 0 )\nsage: hash(-x + y >= 0 )\nsage: hash(x - y >= 0 )\nsage: hash(-y + x >= 0 )\nsage: hash(x - y > 0 )",
    "created_at": "2011-06-16T04:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121846",
    "user": "tnv"
}
```

Thanks for creating the patch!!


I don't know how to apply this patch though  - if you can walk me through it then I can test.  

But in the mean time, what are the result for these commands ?   If the results are different than the defected version above and as expected then probably the patch is correct.  

sage: (-x +y < 0) in [x -y < 0] 

Set([-x +y >= 0,x -y >= 0]) 

sage: var('x,y') 
(x, y) 
sage: hash(-x + y > 0 )
sage: hash(-x + y >= 0 )
sage: hash(x - y >= 0 )
sage: hash(-y + x >= 0 )
sage: hash(x - y > 0 )



---

archive/issue_comments_121847.json:
```json
{
    "body": "I've changed the patch a little bit just now, by the way.\n\nTo apply the patch, go to `devel/sage/` inside your sage directory, and type `sage -hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-fix-comparison-of-comparisons.patch`, type `sage -hg qpush`, type `sage -b`, and finally launch sage to test the patch!\n\nYour examples are fixed, yes. You can see them listed inside the patch, where I added some more examples in the documentation of the function I changed.",
    "created_at": "2011-06-16T04:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121847",
    "user": "kini"
}
```

I've changed the patch a little bit just now, by the way.

To apply the patch, go to `devel/sage/` inside your sage directory, and type `sage -hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-fix-comparison-of-comparisons.patch`, type `sage -hg qpush`, type `sage -b`, and finally launch sage to test the patch!

Your examples are fixed, yes. You can see them listed inside the patch, where I added some more examples in the documentation of the function I changed.



---

archive/issue_comments_121848.json:
```json
{
    "body": "Oh, by the way, I didn't fix the hashes. They're screwed up anyway, so this solution avoids using them to decide anything about whether expressions are the same or not. We might fix that in a later ticket...",
    "created_at": "2011-06-16T04:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121848",
    "user": "kini"
}
```

Oh, by the way, I didn't fix the hashes. They're screwed up anyway, so this solution avoids using them to decide anything about whether expressions are the same or not. We might fix that in a later ticket...



---

archive/issue_comments_121849.json:
```json
{
    "body": "Thanks for the info.  \n\nWhich Sage version do I apply the patch to ?  the latest 4.7  ?    I'll do that tomorrow at work\n\nif they still give the same hashes then   (-x +y < 0) in [x -y < 0]  still gives True and \nSet([-x +y >= 0,x -y >= 0]) still eliminates one of them .  Correct ?",
    "created_at": "2011-06-16T05:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121849",
    "user": "tnv"
}
```

Thanks for the info.  

Which Sage version do I apply the patch to ?  the latest 4.7  ?    I'll do that tomorrow at work

if they still give the same hashes then   (-x +y < 0) in [x -y < 0]  still gives True and 
Set([-x +y >= 0,x -y >= 0]) still eliminates one of them .  Correct ?



---

archive/issue_comments_121850.json:
```json
{
    "body": "No, incorrect, because I changed the code to not use the hashes at all when doing the comparison. The hashes are now irrelevant to this operation. However kcrisman found a bug in my patch so I will update it again in just a second...",
    "created_at": "2011-06-16T05:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121850",
    "user": "kini"
}
```

No, incorrect, because I changed the code to not use the hashes at all when doing the comparison. The hashes are now irrelevant to this operation. However kcrisman found a bug in my patch so I will update it again in just a second...



---

archive/issue_comments_121851.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-16T05:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121851",
    "user": "kini"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_121852.json:
```json
{
    "body": "OK, this looks like it's going to take a little while, I'm getting some unexpected doctest errors... I'll fix it in the morning :)",
    "created_at": "2011-06-16T05:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121852",
    "user": "kini"
}
```

OK, this looks like it's going to take a little while, I'm getting some unexpected doctest errors... I'll fix it in the morning :)



---

archive/issue_comments_121853.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-16T06:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121853",
    "user": "kini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121854.json:
```json
{
    "body": "Never mind, ready for review again!",
    "created_at": "2011-06-16T06:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121854",
    "user": "kini"
}
```

Never mind, ready for review again!



---

archive/issue_comments_121855.json:
```json
{
    "body": "Remove assignee burcin.",
    "created_at": "2011-06-16T06:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121855",
    "user": "kini"
}
```

Remove assignee burcin.



---

archive/issue_comments_121856.json:
```json
{
    "body": "Set assignee to burcin.",
    "created_at": "2011-06-16T06:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121856",
    "user": "kini"
}
```

Set assignee to burcin.



---

archive/issue_comments_121857.json:
```json
{
    "body": "burcin got deleted from this ticket... that trac bug is annoying!",
    "created_at": "2011-06-16T06:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121857",
    "user": "kini"
}
```

burcin got deleted from this ticket... that trac bug is annoying!



---

archive/issue_comments_121858.json:
```json
{
    "body": "Code is correct (corner cases discussed in person, so that e.g. `(x < y) != x ` is True.\n\n`GEx e` seems far from where it comes from.",
    "created_at": "2011-06-16T06:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121858",
    "user": "kcrisman"
}
```

Code is correct (corner cases discussed in person, so that e.g. `(x < y) != x ` is True.

`GEx e` seems far from where it comes from.



---

archive/issue_comments_121859.json:
```json
{
    "body": "Attachment [trac_11309-fix-comparison-of-comparisons.patch](tarball://root/attachments/some-uuid/ticket11309/trac_11309-fix-comparison-of-comparisons.patch) by kini created at 2011-06-16 06:27:31\n\nfixed! (sorry, that was left over from when I was doing something that made cython not like that declaration where it was)",
    "created_at": "2011-06-16T06:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121859",
    "user": "kini"
}
```

Attachment [trac_11309-fix-comparison-of-comparisons.patch](tarball://root/attachments/some-uuid/ticket11309/trac_11309-fix-comparison-of-comparisons.patch) by kini created at 2011-06-16 06:27:31

fixed! (sorry, that was left over from when I was doing something that made cython not like that declaration where it was)



---

archive/issue_comments_121860.json:
```json
{
    "body": "Changing keywords from \"inequality, equality\" to \"inequality equality relational sd31 __richcmp__\".",
    "created_at": "2011-06-16T06:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121860",
    "user": "kini"
}
```

Changing keywords from "inequality, equality" to "inequality equality relational sd31 __richcmp__".



---

archive/issue_comments_121861.json:
```json
{
    "body": "This looks good.  Passing relevant tests.",
    "created_at": "2011-06-16T06:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121861",
    "user": "kcrisman"
}
```

This looks good.  Passing relevant tests.



---

archive/issue_comments_121862.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-16T06:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121862",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121863.json:
```json
{
    "body": "It now can tell that  -x +y >0 is different than -y + x >= 0  but it says that  -x+y >0  is not the same as y > x  ---  \n\nor may be this is another problem ?  \n\n\n```\nsage: ( -x+y >0 ) == (y > x )\nFalse\n\nsage: (-x + y < 0)  ==  (-x < -y)\nFalse\nsage: (x + y == 0)  ==  (x == -y)\nFalse\nsage: (x - y == 0)  ==  (x == y)\nFalse\nsage: (- x + y == 0)  ==  (0 == -x + y)\nFalse\nsage: (x < y)  ==  (y > x)\nFalse\nsage: (x == y) == (-x == -y)\nFalse\nsage: (x + y < 1 )  ==  (x + y -1 < 0)\nFalse\n\n```\n",
    "created_at": "2011-06-16T22:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121863",
    "user": "tnv"
}
```

It now can tell that  -x +y >0 is different than -y + x >= 0  but it says that  -x+y >0  is not the same as y > x  ---  

or may be this is another problem ?  


```
sage: ( -x+y >0 ) == (y > x )
False

sage: (-x + y < 0)  ==  (-x < -y)
False
sage: (x + y == 0)  ==  (x == -y)
False
sage: (x - y == 0)  ==  (x == y)
False
sage: (- x + y == 0)  ==  (0 == -x + y)
False
sage: (x < y)  ==  (y > x)
False
sage: (x == y) == (-x == -y)
False
sage: (x + y < 1 )  ==  (x + y -1 < 0)
False

```




---

archive/issue_comments_121864.json:
```json
{
    "body": "This patch *breaks* the following \n\n{{\nSage 4.7 (prepatched)\n\nsage: (- x + y == 0)  ==  (0 == -x + y)\nTrue\nsage: (-x + y == 0)  ==  (0 == -x + y)\nTrue\nsage: (x < y)  ==  (y > x)\nTrue\n\n\nSage 4.7 (postpatched)\n\n\nsage: (- x + y == 0)  ==  (0 == -x + y)\nFalse\nsage: (-x + y == 0)  ==  (0 == -x + y)\nFalse\nsage: (x < y)  ==  (y > x)\nFalse\n\n}}}",
    "created_at": "2011-06-16T23:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121864",
    "user": "tnv"
}
```

This patch *breaks* the following 

{{
Sage 4.7 (prepatched)

sage: (- x + y == 0)  ==  (0 == -x + y)
True
sage: (-x + y == 0)  ==  (0 == -x + y)
True
sage: (x < y)  ==  (y > x)
True


Sage 4.7 (postpatched)


sage: (- x + y == 0)  ==  (0 == -x + y)
False
sage: (-x + y == 0)  ==  (0 == -x + y)
False
sage: (x < y)  ==  (y > x)
False

}}}



---

archive/issue_comments_121865.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-06-16T23:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121865",
    "user": "tnv"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_121866.json:
```json
{
    "body": "\n``` \nSage 4.7 (prepatched)\n\nsage: (- x + y == 0) == (0 == -x + y) True sage: (-x + y == 0) == (0 == -x + y) True sage: (x < y) == (y > x) True\n\nSage 4.7 (postpatched)\n\nsage: (- x + y == 0) == (0 == -x + y) False sage: (-x + y == 0) == (0 == -x + y) False sage: (x < y) == (y > x) False\n\n```\n",
    "created_at": "2011-06-16T23:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121866",
    "user": "kcrisman"
}
```


``` 
Sage 4.7 (prepatched)

sage: (- x + y == 0) == (0 == -x + y) True sage: (-x + y == 0) == (0 == -x + y) True sage: (x < y) == (y > x) True

Sage 4.7 (postpatched)

sage: (- x + y == 0) == (0 == -x + y) False sage: (-x + y == 0) == (0 == -x + y) False sage: (x < y) == (y > x) False

```




---

archive/issue_comments_121867.json:
```json
{
    "body": "{{ Sage 4.7 (prepatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nTrue \nsage: (-x + y == 0) == (0 == -x + y) \nTrue \nsage: (x < y) == (y > x) \nTrue\n\nSage 4.7 (postpatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nFalse \nsage: (-x + y == 0) == (0 == -x + y) \nFalse \nsage: (x < y) == (y > x) \nFalse\n\n}}}",
    "created_at": "2011-06-16T23:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121867",
    "user": "kcrisman"
}
```

{{ Sage 4.7 (prepatched)

sage: (- x + y == 0) == (0 == -x + y) 
True 
sage: (-x + y == 0) == (0 == -x + y) 
True 
sage: (x < y) == (y > x) 
True

Sage 4.7 (postpatched)

sage: (- x + y == 0) == (0 == -x + y) 
False 
sage: (-x + y == 0) == (0 == -x + y) 
False 
sage: (x < y) == (y > x) 
False

}}}



---

archive/issue_comments_121868.json:
```json
{
    "body": "Finally used preview...\n\n``` \nSage 4.7 (prepatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nTrue \nsage: (-x + y == 0) == (0 == -x + y) \nTrue \nsage: (x < y) == (y > x) \nTrue\n\nSage 4.7 (postpatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nFalse \nsage: (-x + y == 0) == (0 == -x + y) \nFalse \nsage: (x < y) == (y > x) \nFalse\n\n```\n",
    "created_at": "2011-06-16T23:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121868",
    "user": "kcrisman"
}
```

Finally used preview...

``` 
Sage 4.7 (prepatched)

sage: (- x + y == 0) == (0 == -x + y) 
True 
sage: (-x + y == 0) == (0 == -x + y) 
True 
sage: (x < y) == (y > x) 
True

Sage 4.7 (postpatched)

sage: (- x + y == 0) == (0 == -x + y) 
False 
sage: (-x + y == 0) == (0 == -x + y) 
False 
sage: (x < y) == (y > x) 
False

```




---

archive/issue_comments_121869.json:
```json
{
    "body": "\n```\n-x+y >0 is not the same as y > x\n```\n\nCorrect.  We use the philosophy (used elsewhere) that a comparison is True if you can prove it is True, and that otherwise it is False.  False means that we can't prove it's True, and in general these kinds of simplifications are super hard.   So all your examples need to be False, sadly.  \n\nAs for the thing that breaks... I agree that is a problem.  Great catch!  Can you put your (real) name as a reviewer?  (You should also feel free to add yourself to the [main Trac page](http://trac.sagemath.org/sage_trac/) as a developer/contributor.",
    "created_at": "2011-06-16T23:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121869",
    "user": "kcrisman"
}
```


```
-x+y >0 is not the same as y > x
```

Correct.  We use the philosophy (used elsewhere) that a comparison is True if you can prove it is True, and that otherwise it is False.  False means that we can't prove it's True, and in general these kinds of simplifications are super hard.   So all your examples need to be False, sadly.  

As for the thing that breaks... I agree that is a problem.  Great catch!  Can you put your (real) name as a reviewer?  (You should also feel free to add yourself to the [main Trac page](http://trac.sagemath.org/sage_trac/) as a developer/contributor.



---

archive/issue_comments_121870.json:
```json
{
    "body": "just put my name as reviewer -- thanks.   \n\nFrom your msg,  would it be reasonable to add a SMT theorem prover package to Sage ?   So that it can show equivalence of expressions  (at least under some specific theories).",
    "created_at": "2011-06-17T03:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121870",
    "user": "tnv"
}
```

just put my name as reviewer -- thanks.   

From your msg,  would it be reasonable to add a SMT theorem prover package to Sage ?   So that it can show equivalence of expressions  (at least under some specific theories).



---

archive/issue_comments_121871.json:
```json
{
    "body": "There are some tickets open for things like this, I think, or something related, but I don't really know.  Keshav or Burcin may know more.",
    "created_at": "2011-06-17T03:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121871",
    "user": "kcrisman"
}
```

There are some tickets open for things like this, I think, or something related, but I don't really know.  Keshav or Burcin may know more.



---

archive/issue_comments_121872.json:
```json
{
    "body": "Hm. In order to eventually solve #2778 and other such things, I think we need to allow nested relations after all. I talked to Burcin on IRC and he agrees. So we would plan to have all of these return an output which is the same as the input. If you wanted to force it to resolve, you could run bool() on them, and you would always get false, except when comparing `x < y` and `y > x`, `x <= y` and `y >= x`, `x == y` and `y == x`, and `x != y` and `y != x`, for symbolic expressions `x` and `y` (on kcrisman's insistence :) ). I'll need to implement this and figure out how it influences existing doctests (probably severely), so I'm leaving this as \"needs_work\" for now...",
    "created_at": "2011-06-18T00:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121872",
    "user": "kini"
}
```

Hm. In order to eventually solve #2778 and other such things, I think we need to allow nested relations after all. I talked to Burcin on IRC and he agrees. So we would plan to have all of these return an output which is the same as the input. If you wanted to force it to resolve, you could run bool() on them, and you would always get false, except when comparing `x < y` and `y > x`, `x <= y` and `y >= x`, `x == y` and `y == x`, and `x != y` and `y != x`, for symbolic expressions `x` and `y` (on kcrisman's insistence :) ). I'll need to implement this and figure out how it influences existing doctests (probably severely), so I'm leaving this as "needs_work" for now...



---

archive/issue_comments_121873.json:
```json
{
    "body": "Sorry, I meant #2744, not #2778.",
    "created_at": "2011-06-18T00:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121873",
    "user": "kini"
}
```

Sorry, I meant #2744, not #2778.



---

archive/issue_comments_121874.json:
```json
{
    "body": "Replying to [comment:26 tnv]:\n\n> From your msg,  would it be reasonable to add a SMT theorem prover package to Sage ?   So that it can show equivalence of expressions  (at least under some specific theories).     \n\nSage is really large as it is. While I'd be really interested to have this capability in Sage, I don't know how many others would want it in the standard distribution. The first step is to start with an optional package/prototype. We can see where it goes from there. :)\n\nWhich prover are you thinking of? What would this let us do in Sage? Perhaps you should write a message to sage-devel about this.",
    "created_at": "2011-06-18T01:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121874",
    "user": "burcin"
}
```

Replying to [comment:26 tnv]:

> From your msg,  would it be reasonable to add a SMT theorem prover package to Sage ?   So that it can show equivalence of expressions  (at least under some specific theories).     

Sage is really large as it is. While I'd be really interested to have this capability in Sage, I don't know how many others would want it in the standard distribution. The first step is to start with an optional package/prototype. We can see where it goes from there. :)

Which prover are you thinking of? What would this let us do in Sage? Perhaps you should write a message to sage-devel about this.



---

archive/issue_comments_121875.json:
```json
{
    "body": "> Which prover are you thinking of? What would this let us do in Sage? Perhaps you should write a message to sage-devel about this.\n\nI am thinking about the optional package too.  Someone told me qepcad (not exactly SMT but can be used for many similar purpose) already in Sage as an optional package.  \n\nThe good thing about these SMT solvers is that most of them support a standard language (smtlib) and therefore you can use any of the SMT's out there with a single interface.  SMT can be used to show if something (a set of expressions or constraints) is valid  or  satisfiable under different types of theories (not just boolean), or simplify a set of expression, etc.  I rely on these for implications on my project-- to see if 2 sets of expressions are equi-satisfiable .  \n\nSo all the above examples of whether if exp1 == exp2  should be easily answered with SMT.",
    "created_at": "2011-06-18T01:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121875",
    "user": "tnv"
}
```

> Which prover are you thinking of? What would this let us do in Sage? Perhaps you should write a message to sage-devel about this.

I am thinking about the optional package too.  Someone told me qepcad (not exactly SMT but can be used for many similar purpose) already in Sage as an optional package.  

The good thing about these SMT solvers is that most of them support a standard language (smtlib) and therefore you can use any of the SMT's out there with a single interface.  SMT can be used to show if something (a set of expressions or constraints) is valid  or  satisfiable under different types of theories (not just boolean), or simplify a set of expression, etc.  I rely on these for implications on my project-- to see if 2 sets of expressions are equi-satisfiable .  

So all the above examples of whether if exp1 == exp2  should be easily answered with SMT.



---

archive/issue_comments_121876.json:
```json
{
    "body": "Replying to [comment:31 tnv]:\n\n> So all the above examples of whether if exp1 == exp2  should be easily answered with SMT.\n\nI'd really like to see Sage have it's own framework to handle assumptions (see `assume?` -- this relies completely on maxima right now), so I'm really interested in this. I'd be glad to help with the first steps of making a package, writing an interface, etc. We should have this conversation in sage-devel instead of this ticket though. ;)",
    "created_at": "2011-06-18T02:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121876",
    "user": "burcin"
}
```

Replying to [comment:31 tnv]:

> So all the above examples of whether if exp1 == exp2  should be easily answered with SMT.

I'd really like to see Sage have it's own framework to handle assumptions (see `assume?` -- this relies completely on maxima right now), so I'm really interested in this. I'd be glad to help with the first steps of making a package, writing an interface, etc. We should have this conversation in sage-devel instead of this ticket though. ;)



---

archive/issue_comments_121877.json:
```json
{
    "body": "This still applies, and fixes another issue.\n\n```\n\nsage: c = (x-2<=0)\nsage: assume(c)\nsage: a = (x-1<=0)\nsage:  if a in sage.symbolic.assumptions._assumptions:\n....:     print 'yes'\n....:     \nsage: assumptions()\n[x - 2 <= 0]\nsage: assume(a)\nsage: assumptions()\n[x - 2 <= 0, x - 1 <= 0]\n```\n\nBefore, the second assumption didn't obtain, because currently\n\n```\n\nsage: c = (x-2<=0)\nsage: L = [c]\nsage: L\n[x - 2 <= 0]\nsage: a = (x-1<=0)\nsage: a in L\nTrue\n```\n\nwhich is not good.  See [this sage-support thread](https://groups.google.com/forum/#!topic/sage-support/H-QcXkNCajM).",
    "created_at": "2012-05-11T13:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121877",
    "user": "kcrisman"
}
```

This still applies, and fixes another issue.

```

sage: c = (x-2<=0)
sage: assume(c)
sage: a = (x-1<=0)
sage:  if a in sage.symbolic.assumptions._assumptions:
....:     print 'yes'
....:     
sage: assumptions()
[x - 2 <= 0]
sage: assume(a)
sage: assumptions()
[x - 2 <= 0, x - 1 <= 0]
```

Before, the second assumption didn't obtain, because currently

```

sage: c = (x-2<=0)
sage: L = [c]
sage: L
[x - 2 <= 0]
sage: a = (x-1<=0)
sage: a in L
True
```

which is not good.  See [this sage-support thread](https://groups.google.com/forum/#!topic/sage-support/H-QcXkNCajM).



---

archive/issue_comments_121878.json:
```json
{
    "body": "Since #2744 is on sage-wishlist, would it suffice to do some sort of \"switch lhs and rhs\" check as a last branch in the code to fix tnv's point in comment:21 (formatted in comment:24)?  It would be nice to finally resolve this at the upcoming Bug Days.",
    "created_at": "2012-05-11T13:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121878",
    "user": "kcrisman"
}
```

Since #2744 is on sage-wishlist, would it suffice to do some sort of "switch lhs and rhs" check as a last branch in the code to fix tnv's point in comment:21 (formatted in comment:24)?  It would be nice to finally resolve this at the upcoming Bug Days.



---

archive/issue_comments_121879.json:
```json
{
    "body": "In the patch, why is this evaluated to `True`?\n\n```diff\n+            sage: (x < y) != (y > x)\n+            True\n```\n\n\nEDIT: Oops. I should have read the earlier comments. Sorry.",
    "created_at": "2012-05-11T15:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121879",
    "user": "ppurka"
}
```

In the patch, why is this evaluated to `True`?

```diff
+            sage: (x < y) != (y > x)
+            True
```


EDIT: Oops. I should have read the earlier comments. Sorry.



---

archive/issue_comments_121880.json:
```json
{
    "body": "kcrisman: OK, I'll try to implement those minimal checks for now, and we can do nesting expressions later.",
    "created_at": "2012-05-12T22:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121880",
    "user": "kini"
}
```

kcrisman: OK, I'll try to implement those minimal checks for now, and we can do nesting expressions later.



---

archive/issue_comments_121881.json:
```json
{
    "body": "Added a new patch. Burcin, can you look over it to make sure I'm doing this the right way? In particular are those operator comparisons optimizable somehow?",
    "created_at": "2012-05-13T01:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121881",
    "user": "kini"
}
```

Added a new patch. Burcin, can you look over it to make sure I'm doing this the right way? In particular are those operator comparisons optimizable somehow?



---

archive/issue_comments_121882.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-13T01:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121882",
    "user": "kini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121883.json:
```json
{
    "body": "Update: added three more lines to the doctests",
    "created_at": "2012-05-13T01:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121883",
    "user": "kini"
}
```

Update: added three more lines to the doctests



---

archive/issue_comments_121884.json:
```json
{
    "body": "Hey patchbot:\n\nApply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch",
    "created_at": "2012-05-14T05:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121884",
    "user": "kini"
}
```

Hey patchbot:

Apply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch



---

archive/issue_comments_121885.json:
```json
{
    "body": "The code itself seems fine right now, thanks for such fast action and especially for actual comments in the code!  \n\nDid you do any timing runs on previously-working comparisons?  I agree that it would be good for someone who knows to comment on whether there is some obvious optimization missing.  For instance, lines 1241ff. would be nicer if it so happened there was a \"operator.opposite()\" function which reversed `<=` and `>=` (though someone else might want them to be complements, `<=` and `>`).    Similarly for the rhs/lhs comparisons.\n\nKeshav, do you mind putting in a test in your patch for \n\n```\nsage: (x-1<0) in [x-2<0]\nFalse\n```\n\njust to test for the comment:33 issue?  While we wait for someone more knowledgeable... but as I said it does seem good to go.",
    "created_at": "2012-05-14T18:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121885",
    "user": "kcrisman"
}
```

The code itself seems fine right now, thanks for such fast action and especially for actual comments in the code!  

Did you do any timing runs on previously-working comparisons?  I agree that it would be good for someone who knows to comment on whether there is some obvious optimization missing.  For instance, lines 1241ff. would be nicer if it so happened there was a "operator.opposite()" function which reversed `<=` and `>=` (though someone else might want them to be complements, `<=` and `>`).    Similarly for the rhs/lhs comparisons.

Keshav, do you mind putting in a test in your patch for 

```
sage: (x-1<0) in [x-2<0]
False
```

just to test for the comment:33 issue?  While we wait for someone more knowledgeable... but as I said it does seem good to go.



---

archive/issue_comments_121886.json:
```json
{
    "body": "Attachment [trac_11309-equate-flipped-comparisons.patch](tarball://root/attachments/some-uuid/ticket11309/trac_11309-equate-flipped-comparisons.patch) by kini created at 2012-05-14 18:51:16\n\napply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-05-14T18:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121886",
    "user": "kini"
}
```

Attachment [trac_11309-equate-flipped-comparisons.patch](tarball://root/attachments/some-uuid/ticket11309/trac_11309-equate-flipped-comparisons.patch) by kini created at 2012-05-14 18:51:16

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_121887.json:
```json
{
    "body": "Done! Glad you like the comments :)\n\nI did not do any timing, no. I'm not sure what you mean by \"lines 1241ff\", but function calls should typically be avoided if you're optimizing for speed, afaik. The main thing I was wondering was, the argument `op` to the function `_richcmp_c_impl()` is an integer, but `operator.*` as seen in lines 1245-1252 seem to be strings, if I'm not mistaken. So I'm just wondering if that many string operations for a single comparison of symbolic expression couldn't be better optimized by somehow getting the operator of the lhs and rhs of the big relation as integers rather than strings. Well, not to mention that I'm calling `.operator()` a bunch of times, but I don't know if it would actually be any faster to compute it once and store it in a variable.\n\nThey say you shouldn't try to second-guess compilers... I guess the best way to find out is to try a few different ways and see how `timeit` behaves. I'll do that later, I guess...",
    "created_at": "2012-05-14T19:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121887",
    "user": "kini"
}
```

Done! Glad you like the comments :)

I did not do any timing, no. I'm not sure what you mean by "lines 1241ff", but function calls should typically be avoided if you're optimizing for speed, afaik. The main thing I was wondering was, the argument `op` to the function `_richcmp_c_impl()` is an integer, but `operator.*` as seen in lines 1245-1252 seem to be strings, if I'm not mistaken. So I'm just wondering if that many string operations for a single comparison of symbolic expression couldn't be better optimized by somehow getting the operator of the lhs and rhs of the big relation as integers rather than strings. Well, not to mention that I'm calling `.operator()` a bunch of times, but I don't know if it would actually be any faster to compute it once and store it in a variable.

They say you shouldn't try to second-guess compilers... I guess the best way to find out is to try a few different ways and see how `timeit` behaves. I'll do that later, I guess...



---

archive/issue_comments_121888.json:
```json
{
    "body": "Hey patchbot:\n\nApply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch",
    "created_at": "2012-05-14T19:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121888",
    "user": "kini"
}
```

Hey patchbot:

Apply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch



---

archive/issue_comments_121889.json:
```json
{
    "body": "I guess there isn't any reason to put this off, unless the timing issue really is a biggie.  Did you want to run a few of them first?",
    "created_at": "2012-05-25T14:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121889",
    "user": "kcrisman"
}
```

I guess there isn't any reason to put this off, unless the timing issue really is a biggie.  Did you want to run a few of them first?



---

archive/issue_comments_121890.json:
```json
{
    "body": "Changing keywords from \"inequality equality relational sd31 __richcmp__\" to \"inequality equality relational sd31 __richcmp__ sd40.5\".",
    "created_at": "2012-05-25T14:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121890",
    "user": "kcrisman"
}
```

Changing keywords from "inequality equality relational sd31 __richcmp__" to "inequality equality relational sd31 __richcmp__ sd40.5".



---

archive/issue_comments_121891.json:
```json
{
    "body": "Hmm, this is a big slowdown in at least one case.\n\n```\n# old\nsage: timeit(\"(x < y) != (y > x)\")\n625 loops, best of 3: 2.76 \u00b5s per loop\n# new\nsage: timeit(\"(x < y) != (y > x)\")\n625 loops, best of 3: 13.3 \u00b5s per loop\n```\n\nIt looks like it's fairly constantly adding this.  Here, in the much slower checking of a list\n\n```\n# old\nsage: timeit(\"(x - 1 < 0) in [x - 2 < 0]\")\n625 loops, best of 3: 104 \u00b5s per loop\n# new\nsage: timeit(\"(x - 1 < 0) in [x - 2 < 0]\")\n625 loops, best of 3: 116 \u00b5s per loop\n```\n\nHere's another one.\n\n```\n# old\nsage: timeit(\"(y > y) != (y > y) \")\n625 loops, best of 3: 2.24 \u00b5s per loop\n# new\nsage: timeit(\"(y > y) != (y > y) \")\n625 loops, best of 3: 8.45 \u00b5s per loop\n```\n",
    "created_at": "2012-05-25T15:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121891",
    "user": "kcrisman"
}
```

Hmm, this is a big slowdown in at least one case.

```
# old
sage: timeit("(x < y) != (y > x)")
625 loops, best of 3: 2.76 µs per loop
# new
sage: timeit("(x < y) != (y > x)")
625 loops, best of 3: 13.3 µs per loop
```

It looks like it's fairly constantly adding this.  Here, in the much slower checking of a list

```
# old
sage: timeit("(x - 1 < 0) in [x - 2 < 0]")
625 loops, best of 3: 104 µs per loop
# new
sage: timeit("(x - 1 < 0) in [x - 2 < 0]")
625 loops, best of 3: 116 µs per loop
```

Here's another one.

```
# old
sage: timeit("(y > y) != (y > y) ")
625 loops, best of 3: 2.24 µs per loop
# new
sage: timeit("(y > y) != (y > y) ")
625 loops, best of 3: 8.45 µs per loop
```




---

archive/issue_comments_121892.json:
```json
{
    "body": "I'm kind of OK with this slowdown. It's in the low microseconds range, and it's also understandable considering the new code actually checks some stuff, whereas the old code doesn't really.\n\nI guess I will ping Burcin about this via email.",
    "created_at": "2012-05-26T07:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121892",
    "user": "kini"
}
```

I'm kind of OK with this slowdown. It's in the low microseconds range, and it's also understandable considering the new code actually checks some stuff, whereas the old code doesn't really.

I guess I will ping Burcin about this via email.



---

archive/issue_comments_121893.json:
```json
{
    "body": "Burcin says he's too busy to look carefully but that the code probably can't be optimized much further.",
    "created_at": "2012-05-28T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121893",
    "user": "kini"
}
```

Burcin says he's too busy to look carefully but that the code probably can't be optimized much further.



---

archive/issue_comments_121894.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T22:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121894",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121895.json:
```json
{
    "body": "> Burcin says he's too busy to look carefully but that the code probably can't be optimized much further.\nGood enough for me.",
    "created_at": "2012-05-28T22:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121895",
    "user": "kcrisman"
}
```

> Burcin says he's too busy to look carefully but that the code probably can't be optimized much further.
Good enough for me.



---

archive/issue_comments_121896.json:
```json
{
    "body": "Thanks!",
    "created_at": "2012-05-28T22:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121896",
    "user": "kini"
}
```

Thanks!



---

archive/issue_comments_121897.json:
```json
{
    "body": "I am interested in trying this patch but not sure how to apply it correctly.  This is what I did on Sage 5.0  (Mac OS Snow Leopard) \n\n\n```\n$ pwd\n/Users/tnguyen/Src/Devel/SAGE/sage-5.0/devel/sage\n$ sage -hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-equate-flipped-comparisons.patch\nadding trac_11309-equate-flipped-comparisons.patch to series file\nGodel Wed May 30:23:05:42 (4714) ~/Src/Devel/SAGE/sage-5.0/devel/sage \n$ sage -hg qpushapplying trac_11309-equate-flipped-comparisons.patch\npatching file sage/symbolic/expression.pyx\nHunk #1 FAILED at 1179\nHunk #2 FAILED at 1186\nHunk #3 FAILED at 1204\n3 out of 3 hunks FAILED -- saving rejects to file sage/symbolic/expression.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac_11309-equate-flipped-comparisons.patch\nGodel Wed May 30:23:05:51 (4715) ~/Src/Devel/SAGE/sage-5.0/devel/sage \n```\n",
    "created_at": "2012-05-31T06:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121897",
    "user": "tnv"
}
```

I am interested in trying this patch but not sure how to apply it correctly.  This is what I did on Sage 5.0  (Mac OS Snow Leopard) 


```
$ pwd
/Users/tnguyen/Src/Devel/SAGE/sage-5.0/devel/sage
$ sage -hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-equate-flipped-comparisons.patch
adding trac_11309-equate-flipped-comparisons.patch to series file
Godel Wed May 30:23:05:42 (4714) ~/Src/Devel/SAGE/sage-5.0/devel/sage 
$ sage -hg qpushapplying trac_11309-equate-flipped-comparisons.patch
patching file sage/symbolic/expression.pyx
Hunk #1 FAILED at 1179
Hunk #2 FAILED at 1186
Hunk #3 FAILED at 1204
3 out of 3 hunks FAILED -- saving rejects to file sage/symbolic/expression.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac_11309-equate-flipped-comparisons.patch
Godel Wed May 30:23:05:51 (4715) ~/Src/Devel/SAGE/sage-5.0/devel/sage 
```




---

archive/issue_comments_121898.json:
```json
{
    "body": "Replying to [comment:50 tnv]:\n> I am interested in trying this patch but not sure how to apply it correctly.\nYou need to apply both the patches *in the order mentioned in the description of this ticket*. Try these commands (assuming you are in devel/sage)\n\n```\n../../sage -hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-fix-comparison-of-comparisons.patch\n../../sage -hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-equate-flipped-comparisons.patch\n../../sage -br\n```\n",
    "created_at": "2012-05-31T06:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121898",
    "user": "ppurka"
}
```

Replying to [comment:50 tnv]:
> I am interested in trying this patch but not sure how to apply it correctly.
You need to apply both the patches *in the order mentioned in the description of this ticket*. Try these commands (assuming you are in devel/sage)

```
../../sage -hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-fix-comparison-of-comparisons.patch
../../sage -hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11309/trac_11309-equate-flipped-comparisons.patch
../../sage -br
```




---

archive/issue_comments_121899.json:
```json
{
    "body": "Patchbot: Apply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch",
    "created_at": "2012-05-31T07:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121899",
    "user": "kini"
}
```

Patchbot: Apply trac_11309-fix-comparison-of-comparisons.patch trac_11309-equate-flipped-comparisons.patch



---

archive/issue_comments_121900.json:
```json
{
    "body": "Hi, may be I've missed something but these patches still break things as listed in my comment:24.  \n\n\n\n```\n(prepatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nTrue \nsage: (-x + y == 0) == (0 == -x + y) \nTrue \nsage: (x < y) == (y > x) \nTrue\n\n(postpatched)\n\nsage: (- x + y == 0) == (0 == -x + y) \nFalse \nsage: (-x + y == 0) == (0 == -x + y) \nFalse \nsage: (x < y) == (y > x) \nFalse\n```\n\n\nThe main reason why I report this in the first place is because of this error in which multiplying by -1 does not switch the sign.  I think they are related but not sure.  \n\n\n```\nsage: -1 * (x<5)\n-x < -5\n```\n",
    "created_at": "2012-05-31T20:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121900",
    "user": "tnv"
}
```

Hi, may be I've missed something but these patches still break things as listed in my comment:24.  



```
(prepatched)

sage: (- x + y == 0) == (0 == -x + y) 
True 
sage: (-x + y == 0) == (0 == -x + y) 
True 
sage: (x < y) == (y > x) 
True

(postpatched)

sage: (- x + y == 0) == (0 == -x + y) 
False 
sage: (-x + y == 0) == (0 == -x + y) 
False 
sage: (x < y) == (y > x) 
False
```


The main reason why I report this in the first place is because of this error in which multiplying by -1 does not switch the sign.  I think they are related but not sure.  


```
sage: -1 * (x<5)
-x < -5
```




---

archive/issue_comments_121901.json:
```json
{
    "body": "Did you forget to rebuild Sage after applying the patches?\n\n\n```\n[1] fs-boone@zhenghe /opt/sage/devel/sage $ hg qapplied\ntrac_13057-no-intersphinx.patch\ntrac_11309-fix-comparison-of-comparisons.patch\ntrac_11309-equate-flipped-comparisons.patch\n[1] fs-boone@zhenghe /opt/sage/devel/sage $ sage -b &> /dev/null\n[1] fs-boone@zhenghe /opt/sage/devel/sage $ sage -q\nsage: var('y')\ny\nsage: (- x + y == 0) == (0 == -x + y) \nTrue\nsage: (-x + y == 0) == (0 == -x + y) \nTrue\nsage: (x < y) == (y > x) \nTrue\nsage: -(x < 5)\n-x < -5\nsage: \n```\n\n\nPersonally I don't see why `x * (y < z)` should even be simplified to anything other than `x * (y < z)`. `y < z` is a mathematical object which does not live in a space which has a multiplication operation - it lives in the space of logical predicates. But that is something to address in a different ticket. Testing the title of this ticket:\n\n\n```\nsage: Set([-x + y > 0, -y + x >= 0, x - y > 0])    \n{-x + y > 0, x - y >= 0, x - y > 0}\nsage: len(_)   \n3\n```\n\n\nSo the patches do at least address and solve the issue in the ticket's name.",
    "created_at": "2012-05-31T21:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121901",
    "user": "kini"
}
```

Did you forget to rebuild Sage after applying the patches?


```
[1] fs-boone@zhenghe /opt/sage/devel/sage $ hg qapplied
trac_13057-no-intersphinx.patch
trac_11309-fix-comparison-of-comparisons.patch
trac_11309-equate-flipped-comparisons.patch
[1] fs-boone@zhenghe /opt/sage/devel/sage $ sage -b &> /dev/null
[1] fs-boone@zhenghe /opt/sage/devel/sage $ sage -q
sage: var('y')
y
sage: (- x + y == 0) == (0 == -x + y) 
True
sage: (-x + y == 0) == (0 == -x + y) 
True
sage: (x < y) == (y > x) 
True
sage: -(x < 5)
-x < -5
sage: 
```


Personally I don't see why `x * (y < z)` should even be simplified to anything other than `x * (y < z)`. `y < z` is a mathematical object which does not live in a space which has a multiplication operation - it lives in the space of logical predicates. But that is something to address in a different ticket. Testing the title of this ticket:


```
sage: Set([-x + y > 0, -y + x >= 0, x - y > 0])    
{-x + y > 0, x - y >= 0, x - y > 0}
sage: len(_)   
3
```


So the patches do at least address and solve the issue in the ticket's name.



---

archive/issue_comments_121902.json:
```json
{
    "body": "Replying to [comment:53 tnv]:\n>\n> The main reason why I report this in the first place is because of this error in which multiplying by -1 does not switch the sign.  I think they are related but not sure.  \n> \n> {{{\n> sage: -1 * (x<5)\n> -x < -5\n> }}}\n\nThis is #7660. It would be quite easy to remove the `if is_a_relational(left._gobj)` checks in `_add_, `_mul_`, etc. in `sage/symbolic/expression.pyx` to revert back to GiNaC behavior.",
    "created_at": "2012-06-01T10:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121902",
    "user": "burcin"
}
```

Replying to [comment:53 tnv]:
>
> The main reason why I report this in the first place is because of this error in which multiplying by -1 does not switch the sign.  I think they are related but not sure.  
> 
> {{{
> sage: -1 * (x<5)
> -x < -5
> }}}

This is #7660. It would be quite easy to remove the `if is_a_relational(left._gobj)` checks in `_add_, `_mul_`, etc. in `sage/symbolic/expression.pyx` to revert back to GiNaC behavior.



---

archive/issue_comments_121903.json:
```json
{
    "body": "It seems to work fine now -- not sure what I did previously.  So if you don't use hash for comparison , what do you use ?   Thanks all of those who spend time to create these patches.",
    "created_at": "2012-06-01T20:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121903",
    "user": "tnv"
}
```

It seems to work fine now -- not sure what I did previously.  So if you don't use hash for comparison , what do you use ?   Thanks all of those who spend time to create these patches.



---

archive/issue_comments_121904.json:
```json
{
    "body": "Given two relational expressions `a ? b` and `c ! d`, first I check whether `?` and `!` are the same relation. If so, I have a couple of cases. One, if `?` and `!` are both `==` or are both `!=`, then I check whether `a == c` and `b == d`, or `a == d` and `b == c`. Two, if `?` and `!` are some other relation than `==` or `!=`, then I only allow the case `a == c` and `b == d`.\n\nIf `?` and `!` are different from each other, I check whether they are reversals of each other (like one is `<` and the other is `>`, etc.). If that is the case, then I allow `a == d` and `b == c`.\n\nIn all other cases, the two relational expressions are considered unequal.\n\n... that explanation looks kind of confusing. Maybe it's better if you just look at the patch... it's probably easier to understand :)",
    "created_at": "2012-06-01T20:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121904",
    "user": "kini"
}
```

Given two relational expressions `a ? b` and `c ! d`, first I check whether `?` and `!` are the same relation. If so, I have a couple of cases. One, if `?` and `!` are both `==` or are both `!=`, then I check whether `a == c` and `b == d`, or `a == d` and `b == c`. Two, if `?` and `!` are some other relation than `==` or `!=`, then I only allow the case `a == c` and `b == d`.

If `?` and `!` are different from each other, I check whether they are reversals of each other (like one is `<` and the other is `>`, etc.). If that is the case, then I allow `a == d` and `b == c`.

In all other cases, the two relational expressions are considered unequal.

... that explanation looks kind of confusing. Maybe it's better if you just look at the patch... it's probably easier to understand :)



---

archive/issue_comments_121905.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-05T11:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11137#issuecomment-121905",
    "user": "jdemeyer"
}
```

Resolution: fixed
