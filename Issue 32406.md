# Issue 32406: fix a problem in is_connected

Issue created by migration from https://trac.sagemath.org/ticket/32643

Original creator: chapoton

Original creation time: 2021-10-06 12:53:07

CC:  dcoudert @kliem




---

Comment by chapoton created at 2021-10-06 12:53:35

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-10-06 12:53:35

New commits:


---

Comment by dcoudert created at 2021-10-06 15:33:30

I'm not sure it's the right way to fix the issue. Several backends (`CGraphBackend`, `StaticSparseCGraph`, etc.) have a method `num_edges` (and also `num_verts`), but I'm a bit lost in the inclusion of classes. May be we should instead add missing instances of `num_edges` and `num_verts`.


---

Comment by chapoton created at 2021-10-06 15:49:31

well, doctests do pass...


---

Comment by @kliem created at 2021-10-06 18:05:25

The problem is that we are trying to access `num_edges` in `CGraph` or a derived class and this just does not exist.

`num_edges` of `CGraphBackend` is not what we want, I would say. Way too slow for a quick sanity check.
Locks good so far.
Maybe we could improve the sanity check for the undirected case:


```
if (self._directed and cg.num_arcs < cg.num_verts - 1) or (not self._directed and cg.num_arcs / 2 < cg.num_verts - 1):
```



---

Comment by chapoton created at 2021-10-07 06:33:56

are you sure that there are two arcs for every edge in the undirected case ?


---

Comment by dcoudert created at 2021-10-07 07:12:21

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2021-10-07 07:12:21

You are right, the safest test is what you proposed. So let us go with this solution, and if we have a smarter solution for undirected graphs later, we can open another ticket.


---

Comment by @kliem created at 2021-10-07 07:13:33

From `c_graph.pyx`:

```
2342     cpdef add_edge(self, object u, object v, object l, bint directed):
...
2440         if not directed and self._directed and v_int != u_int:
2441             cg.add_arc_label_unsafe(v_int, u_int, l_int)
```


But this is also how `num_edges` works. I guess it is better and safer to call `self.num_edges(self._directed)`. It's rather quick actually.


---

Comment by chapoton created at 2021-10-07 07:48:49

so backs to needs work ?


---

Comment by @kliem created at 2021-10-07 07:54:32

The current fix is:


```diff
-        if cg.num_edges() < cg.num_verts - 1:
+        if cg.num_arcs < cg.num_verts - 1:
```


I would propose instead


```diff
-        if cg.num_edges() < cg.num_verts - 1:
+        if self.num_edges(self._directed) < cg.num_verts - 1:
```


Both seems to work fine. The later one should help to detect a bit more cases.
However, its not super important, as graphs with fewer edges than vertices minus 1 fail quickly anyway.


---

Comment by vbraun created at 2021-10-19 20:31:50

Resolution: fixed
