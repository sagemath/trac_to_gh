# Issue 30723: one detail in Makefile

Issue created by migration from https://trac.sagemath.org/ticket/30960

Original creator: chapoton

Original creation time: 2020-11-25 13:13:53

CC:  mkoeppe dimpase jhpalmieri saraedum

fix something that breaks the build of docker:

https://gitlab.com/sagemath/sage/-/jobs/870630473


---

Comment by chapoton created at 2020-11-25 13:18:03

New commits:


---

Comment by chapoton created at 2020-11-25 13:18:03

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-11-25 13:24:01

I presume the result of this fix should be visible soon on the [GitLab](GitLab) runner, right?


---

Comment by chapoton created at 2020-11-25 13:39:50

no, because this target inside the makefile is only triggered by the docker-building script, so only for new develop branches (as far as I understand this mess)


---

Comment by mkoeppe created at 2020-11-25 19:02:57

Note that tab characters are part of Makefile syntax


---

Comment by mkoeppe created at 2020-11-25 19:08:09

`src/build` is not used anymore. It is now `build/pkgs/sagelib/src/build`.


---

Comment by chapoton created at 2020-11-25 19:11:55

then please make a better branch


---

Comment by mkoeppe created at 2020-11-25 19:13:30

Overall this make target is problematic and it would be best to clean it up more thoroughly.

- It not only cleans (as the name of the target suggests) but actually uninstalls sagelib (in a rather brutal way)
- This is the same defect as noted in #21775 (make distclean: Don't delete $SAGE_ROOT/local)
- Also, it refers to `local` directly instead of using SAGE_LOCAL (which can be configured using `--prefix`)
- The latter is important for #29536 - make docker images from [GitHub](GitHub) CI workflow and regular Sage Docker images interoperable


---

Comment by mkoeppe created at 2020-11-25 19:13:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-11-25 19:59:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-11-25 20:00:07

Try this branch please


---

Comment by mkoeppe created at 2020-11-25 20:00:07

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-11-26 07:50:43

looks good, but I cannot test


---

Comment by dimpase created at 2020-11-26 14:09:22

Replying to [comment:11 chapoton]:
> looks good, but I cannot test

Some [GitLab](GitLab) pipelines are running and complete, e.g.
this one https://gitlab.com/sagemath/dev/trac/-/pipelines/221142937
for #30925


The pipeline for the current ticket is in the queue:
https://gitlab.com/sagemath/dev/trac/-/pipelines/221294945

I have no idea how many people are using these, and what it takes to test functionality of the current ticket there.


---

Comment by chapoton created at 2020-11-26 16:26:09

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-11-26 16:26:09

ok, let it be. It looks harmless enough, and all it could do would be to help fix the docker building..


---

Comment by vbraun created at 2020-12-05 22:12:57

Resolution: fixed
