# Issue 21232: Enable VPATH builds

archive/issues_021232.json:
```json
{
    "body": "CC:  felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri\n\nIt would be convenient for VPATH builds to work.\n\n```\n mkdir BUILDDIR\n cd BUILDDIR\n SRCDIR/configure --srcdir=SRCDIR\n make\n```\n\n\nProbably #14796 has work into this direction, but it seems to be an abandoned effort.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21469\n\n",
    "created_at": "2016-09-11T03:59:17Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Enable VPATH builds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21232",
    "user": "https://github.com/mkoeppe"
}
```
CC:  felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri

It would be convenient for VPATH builds to work.

```
 mkdir BUILDDIR
 cd BUILDDIR
 SRCDIR/configure --srcdir=SRCDIR
 make
```


Probably #14796 has work into this direction, but it seems to be an abandoned effort.

Issue created by migration from https://trac.sagemath.org/ticket/21469





---

archive/issue_comments_294048.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-11T18:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294048",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_294049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-11T21:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294050.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-11T21:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294050",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_294051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-11T22:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T00:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T00:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T05:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294055.json:
```json
{
    "body": "The current patch makes some high-level preparations for a VPATH build, in particular the package system.\n\n\"make\" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).\n\nI've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.",
    "created_at": "2016-09-12T05:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294055",
    "user": "https://github.com/mkoeppe"
}
```

The current patch makes some high-level preparations for a VPATH build, in particular the package system.

"make" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).

I've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.



---

archive/issue_comments_294056.json:
```json
{
    "body": "I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nThis is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nOther people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.",
    "created_at": "2016-09-12T05:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294056",
    "user": "https://github.com/kiwifb"
}
```

I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

This is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Other people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.



---

archive/issue_comments_294057.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nA VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.",
    "created_at": "2016-09-12T05:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294057",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 fbissey]:
> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

A VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.



---

archive/issue_comments_294058.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T06:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294059.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nYes, this ticket does not address any of the issues that would arise in distribution packaging. \n\nInstead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.",
    "created_at": "2016-09-12T06:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294059",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 fbissey]:
> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Yes, this ticket does not address any of the issues that would arise in distribution packaging. 

Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.



---

archive/issue_comments_294060.json:
```json
{
    "body": "I should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\n\nSeriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n\nI guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.",
    "created_at": "2016-09-12T07:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294060",
    "user": "https://github.com/kiwifb"
}
```

I should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)

Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.

I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.



---

archive/issue_comments_294061.json:
```json
{
    "body": "Replying to [comment:14 fbissey]:\n> I should apologize for being so negative. \nNo worries.\n> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\nThat already works with this patch.\n> \n> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n> \n> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.\nSounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.",
    "created_at": "2016-09-12T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294061",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:14 fbissey]:
> I should apologize for being so negative. 
No worries.
> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)
That already works with this patch.
> 
> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.
> 
> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.
Sounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.



---

archive/issue_comments_294062.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.\n\nI sort of agree with Fran\u00e7ois.\n\nPart of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nFor the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nFor the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.",
    "created_at": "2016-09-12T11:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294062",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 mkoeppe]:
> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.

I sort of agree with François.

Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.



---

archive/issue_comments_294063.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-09-12T12:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294063",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_294064.json:
```json
{
    "body": "I think the ticket description should have a *lot* more information about\n\n1. which problem that this ticket is trying to solve (the **why**).\n\n2. what the branch actually does (the **what**).\n\nNote that this are 2 independent things (which are unfortunately often confused).",
    "created_at": "2016-09-12T12:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294064",
    "user": "https://github.com/jdemeyer"
}
```

I think the ticket description should have a *lot* more information about

1. which problem that this ticket is trying to solve (the **why**).

2. what the branch actually does (the **what**).

Note that this are 2 independent things (which are unfortunately often confused).



---

archive/issue_comments_294065.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-09-12T17:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294065",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_294066.json:
```json
{
    "body": "I've updated the description.",
    "created_at": "2016-09-12T17:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294066",
    "user": "https://github.com/mkoeppe"
}
```

I've updated the description.



---

archive/issue_comments_294067.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Replying to [comment:13 mkoeppe]:\n> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nI've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.\n\n> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nRight, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.\n\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nCertainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).",
    "created_at": "2016-09-12T17:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294067",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:16 jdemeyer]:
> Replying to [comment:13 mkoeppe]:
> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

I've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.

> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

Right, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.

> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Certainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).



---

archive/issue_comments_294068.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nIt seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).",
    "created_at": "2016-09-12T18:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294068",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:16 jdemeyer]:
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).



---

archive/issue_comments_294069.json:
```json
{
    "body": "Replying to [comment:22 mkoeppe]:\n> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).\n\nHowever, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804",
    "created_at": "2016-09-12T19:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294069",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:22 mkoeppe]:
> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).

However, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804



---

archive/issue_comments_294070.json:
```json
{
    "body": "> Replying to [comment:16 jdemeyer]:\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nAlso, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.\n\n```\npython setup.py build --build-base=BUILDDIR\n```\n",
    "created_at": "2016-09-12T19:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294070",
    "user": "https://github.com/mkoeppe"
}
```

> Replying to [comment:16 jdemeyer]:
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Also, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.

```
python setup.py build --build-base=BUILDDIR
```




---

archive/issue_comments_294071.json:
```json
{
    "body": "This is now #21480.",
    "created_at": "2016-09-12T22:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294071",
    "user": "https://github.com/mkoeppe"
}
```

This is now #21480.



---

archive/issue_comments_294072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-13T00:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_057011.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T04:57:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57011"
}
```



---

archive/issue_comments_294073.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-18T21:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294073",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_294074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-27T04:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294075.json:
```json
{
    "body": "squashed into 1 commit to simplify rebasing.",
    "created_at": "2017-08-27T04:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294075",
    "user": "https://github.com/mkoeppe"
}
```

squashed into 1 commit to simplify rebasing.



---

archive/issue_events_057012.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57012"
}
```



---

archive/issue_events_057013.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57013"
}
```



---

archive/issue_comments_294076.json:
```json
{
    "body": "The next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded \"build\").",
    "created_at": "2017-08-27T05:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294076",
    "user": "https://github.com/mkoeppe"
}
```

The next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded "build").



---

archive/issue_comments_294077.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-28T02:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-28T05:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294079.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-28T15:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294080.json:
```json
{
    "body": "Removed #21535 dependency. `setup.py --build-base` actually works already.\n\nWith the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.",
    "created_at": "2017-08-28T15:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294080",
    "user": "https://github.com/mkoeppe"
}
```

Removed #21535 dependency. `setup.py --build-base` actually works already.

With the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.



---

archive/issue_comments_294081.json:
```json
{
    "body": "On OS X, some directories are not being created:\n\n```\n$ mkdir BUILD\n$ cd BUILD\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\n/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory\n```\n\nIf I create that directory, `configure` finishes but with warning messages like this\n\n```\n$ mkdir -p build/make\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\ntouch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory\nfind: /path/to/BUILD/src/ext: No such file or directory\ncat: /path/to/BUILD/build/make/deps: No such file or directory\n...\n$ make\nmake: *** No targets specified and no makefile found.  Stop.\n```\n",
    "created_at": "2017-08-28T16:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294081",
    "user": "https://github.com/jhpalmieri"
}
```

On OS X, some directories are not being created:

```
$ mkdir BUILD
$ cd BUILD
$ /path/to/sage/configure --srcdir=/path/to/sage
...
/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory
```

If I create that directory, `configure` finishes but with warning messages like this

```
$ mkdir -p build/make
$ /path/to/sage/configure --srcdir=/path/to/sage
...
touch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory
find: /path/to/BUILD/src/ext: No such file or directory
cat: /path/to/BUILD/build/make/deps: No such file or directory
...
$ make
make: *** No targets specified and no makefile found.  Stop.
```




---

archive/issue_comments_294082.json:
```json
{
    "body": "Did you autoreconf?",
    "created_at": "2017-08-28T20:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294082",
    "user": "https://github.com/mkoeppe"
}
```

Did you autoreconf?



---

archive/issue_comments_294083.json:
```json
{
    "body": "No, that fixed it.",
    "created_at": "2017-08-28T22:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294083",
    "user": "https://github.com/jhpalmieri"
}
```

No, that fixed it.



---

archive/issue_comments_294084.json:
```json
{
    "body": "With the changes\n\n```diff\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex dc2bd34cc0..8aa523d7ea 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -313,7 +313,7 @@ export SAGE_EXTCODE=\"$SAGE_SHARE/sage/ext\"\n export SAGE_SPKG_INST=\"$SAGE_LOCAL/var/lib/sage/installed\"\n export SAGE_LOGS=\"$SAGE_ROOT/logs/pkgs\"\n export SAGE_SRC=\"$SAGE_ROOT/src\"\n-export SAGE_DOC_SRC=\"$SAGE_SRC/doc\"\n+export SAGE_DOC_SRC=\"$SAGE_SRC_ROOT/src/doc\"\n export SAGE_DOC=\"$SAGE_SHARE/doc/sage\"\n \n if [ -z \"${SAGE_ORIG_PATH_SET}\" ]; then\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 2e115fab88..88f3fdfa4a 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -1,10 +1,10 @@\n import sys, os, sphinx\n-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR\n+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR\n from datetime import date\n from six import iteritems\n \n # If your extensions are in another directory, add it here.\n-sys.path.append(os.path.join(SAGE_SRC, \"sage_setup\", \"docbuild\", \"ext\"))\n+sys.path.append(os.path.join(SAGE_SRC_ROOT, \"src\", \"sage_setup\", \"docbuild\", \"ext\"))\n \n # General configuration\n # ---------------------\n```\n\nthe documentation starts to build, but I eventually get an error:\n\n```\n[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n```\n\nI can't figure out where this is coming from.",
    "created_at": "2017-08-29T03:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294084",
    "user": "https://github.com/jhpalmieri"
}
```

With the changes

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index dc2bd34cc0..8aa523d7ea 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -313,7 +313,7 @@ export SAGE_EXTCODE="$SAGE_SHARE/sage/ext"
 export SAGE_SPKG_INST="$SAGE_LOCAL/var/lib/sage/installed"
 export SAGE_LOGS="$SAGE_ROOT/logs/pkgs"
 export SAGE_SRC="$SAGE_ROOT/src"
-export SAGE_DOC_SRC="$SAGE_SRC/doc"
+export SAGE_DOC_SRC="$SAGE_SRC_ROOT/src/doc"
 export SAGE_DOC="$SAGE_SHARE/doc/sage"
 
 if [ -z "${SAGE_ORIG_PATH_SET}" ]; then
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 2e115fab88..88f3fdfa4a 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -1,10 +1,10 @@
 import sys, os, sphinx
-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR
+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR
 from datetime import date
 from six import iteritems
 
 # If your extensions are in another directory, add it here.
-sys.path.append(os.path.join(SAGE_SRC, "sage_setup", "docbuild", "ext"))
+sys.path.append(os.path.join(SAGE_SRC_ROOT, "src", "sage_setup", "docbuild", "ext"))
 
 # General configuration
 # ---------------------
```

the documentation starts to build, but I eventually get an error:

```
[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
```

I can't figure out where this is coming from.



---

archive/issue_comments_294085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T17:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294086.json:
```json
{
    "body": "Thanks, I've added your changes as a commit.",
    "created_at": "2017-08-29T17:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294086",
    "user": "https://github.com/mkoeppe"
}
```

Thanks, I've added your changes as a commit.



---

archive/issue_comments_294087.json:
```json
{
    "body": "Replying to [comment:42 jhpalmieri]:\n> the documentation starts to build, but I eventually get an error:\n> {{{\n> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n> }}}\n\nI get the same error",
    "created_at": "2017-08-29T17:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294087",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:42 jhpalmieri]:
> the documentation starts to build, but I eventually get an error:
> {{{
> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
> }}}

I get the same error



---

archive/issue_comments_294088.json:
```json
{
    "body": "One more change, to help `make distclean` work:\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex 3128f4c656..03f2c8fff1 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)\n doc-clean: doc-src-clean doc-output-clean\n \n doc-src-clean:\n-       cd \"$(SAGE_SRC)/doc\" && $(MAKE) clean\n+       cd \"$(SAGE_SRC_ROOT)/src/doc\" && $(MAKE) clean\n \n doc-output-clean:\n        rm -rf \"$(SAGE_SHARE)/doc/sage\"\n```\n",
    "created_at": "2017-08-29T18:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294088",
    "user": "https://github.com/jhpalmieri"
}
```

One more change, to help `make distclean` work:

```diff
diff --git a/build/make/deps b/build/make/deps
index 3128f4c656..03f2c8fff1 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)
 doc-clean: doc-src-clean doc-output-clean
 
 doc-src-clean:
-       cd "$(SAGE_SRC)/doc" && $(MAKE) clean
+       cd "$(SAGE_SRC_ROOT)/src/doc" && $(MAKE) clean
 
 doc-output-clean:
        rm -rf "$(SAGE_SHARE)/doc/sage"
```




---

archive/issue_comments_294089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T18:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294090.json:
```json
{
    "body": "Perhaps the sphinx problem is related to failing source discovery for Cython modules:\n\n```\nsage: sage.rings.number_field.number_field_element_quadratic??\nError getting source: s must be a string\nType:            module\n...\n```\n",
    "created_at": "2017-08-29T18:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294090",
    "user": "https://github.com/mkoeppe"
}
```

Perhaps the sphinx problem is related to failing source discovery for Cython modules:

```
sage: sage.rings.number_field.number_field_element_quadratic??
Error getting source: s must be a string
Type:            module
...
```




---

archive/issue_comments_294091.json:
```json
{
    "body": "Yes, that looks like it.",
    "created_at": "2017-08-29T18:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294091",
    "user": "https://github.com/jhpalmieri"
}
```

Yes, that looks like it.



---

archive/issue_comments_294092.json:
```json
{
    "body": "Okay, how about this:\n\n```diff\ndiff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\nindex f9dffc1ce3..3a286c7934 100644\n--- a/src/sage/misc/sageinspect.py\n+++ b/src/sage/misc/sageinspect.py\n@@ -125,7 +125,7 @@ import tokenize\n import types\n import re\n EMBEDDED_MODE = False\n-from sage.env import SAGE_SRC\n+from sage.env import SAGE_SRC_ROOT\n \n def loadable_module_extension():\n     r\"\"\"\n@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):\n         return None\n \n     raw_filename = res.group('FILENAME')\n-    filename = os.path.join(SAGE_SRC, raw_filename)\n+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n     if not os.path.isfile(filename):\n         from sage.misc.misc import SPYX_TMP\n         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n@@ -2308,7 +2308,7 @@ def __internal_tests():\n \n     Test _extract_embedded_position:\n \n-    We cannot test the filename since it depends on SAGE_SRC.\n+    We cannot test the filename since it depends on SAGE_SRC_ROOT.\n \n     Make sure things work with no trailing newline::\n \n```\n",
    "created_at": "2017-08-29T19:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294092",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, how about this:

```diff
diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index f9dffc1ce3..3a286c7934 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -125,7 +125,7 @@ import tokenize
 import types
 import re
 EMBEDDED_MODE = False
-from sage.env import SAGE_SRC
+from sage.env import SAGE_SRC_ROOT
 
 def loadable_module_extension():
     r"""
@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):
         return None
 
     raw_filename = res.group('FILENAME')
-    filename = os.path.join(SAGE_SRC, raw_filename)
+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
     if not os.path.isfile(filename):
         from sage.misc.misc import SPYX_TMP
         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
@@ -2308,7 +2308,7 @@ def __internal_tests():
 
     Test _extract_embedded_position:
 
-    We cannot test the filename since it depends on SAGE_SRC.
+    We cannot test the filename since it depends on SAGE_SRC_ROOT.
 
     Make sure things work with no trailing newline::
 
```




---

archive/issue_comments_294093.json:
```json
{
    "body": "Now the cross-references are wrong or missing:\n\n```\n[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```\n",
    "created_at": "2017-08-29T20:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294093",
    "user": "https://github.com/jhpalmieri"
}
```

Now the cross-references are wrong or missing:

```
[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```




---

archive/issue_comments_294094.json:
```json
{
    "body": "Also, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.",
    "created_at": "2017-08-29T20:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294094",
    "user": "https://github.com/jhpalmieri"
}
```

Also, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.



---

archive/issue_comments_294095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T21:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294096.json:
```json
{
    "body": "Replying to [comment:50 jhpalmieri]:\n> Okay, how about this:\n> {{{\n> #!diff\n> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\n> index f9dffc1ce3..3a286c7934 100644\n> --- a/src/sage/misc/sageinspect.py\n> +++ b/src/sage/misc/sageinspect.py\n> `@``@` -222,7 +222,7 `@``@` def _extract_embedded_position(docstring):\n>          return None\n>  \n>      raw_filename = res.group('FILENAME')\n> -    filename = os.path.join(SAGE_SRC, raw_filename)\n> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n>      if not os.path.isfile(filename):\n>          from sage.misc.misc import SPYX_TMP\n>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n> }}}\n\nInstead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.",
    "created_at": "2017-08-29T21:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294096",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:50 jhpalmieri]:
> Okay, how about this:
> {{{
> #!diff
> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
> index f9dffc1ce3..3a286c7934 100644
> --- a/src/sage/misc/sageinspect.py
> +++ b/src/sage/misc/sageinspect.py
> `@``@` -222,7 +222,7 `@``@` def _extract_embedded_position(docstring):
>          return None
>  
>      raw_filename = res.group('FILENAME')
> -    filename = os.path.join(SAGE_SRC, raw_filename)
> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
>      if not os.path.isfile(filename):
>          from sage.misc.misc import SPYX_TMP
>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
> }}}

Instead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.



---

archive/issue_comments_294097.json:
```json
{
    "body": "I'm now testing the VPATH build using a separate user account that cannot write into the source tree. \nMore changes to the docbuild are necessary to separate sources from built files:\n\n```\n[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'\n```\n",
    "created_at": "2017-08-29T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294097",
    "user": "https://github.com/mkoeppe"
}
```

I'm now testing the VPATH build using a separate user account that cannot write into the source tree. 
More changes to the docbuild are necessary to separate sources from built files:

```
[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'
```




---

archive/issue_comments_294098.json:
```json
{
    "body": "By the way, I get warnings like\n\n```\ntouch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory\n```\n\nI assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.",
    "created_at": "2017-08-29T22:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294098",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, I get warnings like

```
touch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory
```

I assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.



---

archive/issue_comments_294099.json:
```json
{
    "body": "I don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?",
    "created_at": "2017-08-29T22:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294099",
    "user": "https://github.com/mkoeppe"
}
```

I don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?



---

archive/issue_comments_294100.json:
```json
{
    "body": "Sorry, yes, that's what I meant, and that's what most of the warnings have been about.",
    "created_at": "2017-08-29T22:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294100",
    "user": "https://github.com/jhpalmieri"
}
```

Sorry, yes, that's what I meant, and that's what most of the warnings have been about.



---

archive/issue_comments_294101.json:
```json
{
    "body": "The `sage-arch-env` message is harmless.\nBut there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.",
    "created_at": "2017-08-29T22:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294101",
    "user": "https://github.com/mkoeppe"
}
```

The `sage-arch-env` message is harmless.
But there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.



---

archive/issue_comments_294102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T22:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294103.json:
```json
{
    "body": "I'm getting this build error:\n\n```\nmake[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.\n```\n",
    "created_at": "2017-08-30T01:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294103",
    "user": "https://github.com/jhpalmieri"
}
```

I'm getting this build error:

```
make[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.
```




---

archive/issue_comments_294104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-30T03:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294105.json:
```json
{
    "body": "The make target \"sage-starts\" fails for me. This fixes it; is it the right way to fix it?\n\n```diff\ndiff --git a/src/bin/sage-starts b/src/bin/sage-starts\nindex 85cbae67e5..498c930810 100755\n--- a/src/bin/sage-starts\n+++ b/src/bin/sage-starts\n@@ -14,7 +14,7 @@ echo \"[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`\" | tee -a logs\n # sysadmin.  We use --nodotsage so we don't force a .sage directory\n # in the sysadmin's HOME directory.\n cmd='sage.all._write_started_file(); print \"Yes, Sage starts.\"'\n-build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n+\"$SAGE_SRC_ROOT\"/build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n \n if [ $? -ne 0 ]; then\n     echo >&2 \"Sage failed to start up.\"\n```\n",
    "created_at": "2017-08-30T15:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294105",
    "user": "https://github.com/jhpalmieri"
}
```

The make target "sage-starts" fails for me. This fixes it; is it the right way to fix it?

```diff
diff --git a/src/bin/sage-starts b/src/bin/sage-starts
index 85cbae67e5..498c930810 100755
--- a/src/bin/sage-starts
+++ b/src/bin/sage-starts
@@ -14,7 +14,7 @@ echo "[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`" | tee -a logs
 # sysadmin.  We use --nodotsage so we don't force a .sage directory
 # in the sysadmin's HOME directory.
 cmd='sage.all._write_started_file(); print "Yes, Sage starts."'
-build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
+"$SAGE_SRC_ROOT"/build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
 
 if [ $? -ne 0 ]; then
     echo >&2 "Sage failed to start up."
```




---

archive/issue_comments_294106.json:
```json
{
    "body": "With that change, `make ptestlong` fails:\n\n```\nTesting that Sage starts...\n[2017-08-30 09:19:29] \nThis looks like the first time you are running Sage.\nCleaning up, do not interrupt this.\nDone cleaning.\nYes, Sage starts.\n\nreal\t52m33.269s\nuser\t191m2.435s\nsys\t19m38.034s\nSage build/upgrade complete!\n\nTo install small scripts to directly run Sage's versions of GAP,\nthe PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.\njust 'gap' or 'gp') into a standard 'bin' directory, start Sage\nby typing 'sage' (or './sage') and enter something like\n\n    install_scripts('/usr/local/bin')\n\nat the Sage command prompt ('sage:').\n\n/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\nmake: *** [ptestlong] Error 1\n```\n\nI think that the make target\n\n```\nTESTALL = $(top_srcdir)/sage -t --all\n```\n\nneeds to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.\n\n`./sage -t -all` also fails:\n\n```\n$ ./sage -t --all\n/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory\nTraceback (most recent call last):\n  File \"/.../SAGE_SRC_ROOT/src/bin/sage-runtests\", line 97, in <module>\n    DC = DocTestController(options, args)\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 334, in __init__\n    for pkg in list_packages('optional', local=True).values():\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py\", line 230, in list_packages\n    for p in os.listdir(SAGE_PKGS):\nOSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'\n```\n\nThis can almost be fixed by\n\n```diff\ndiff --git a/src/sage/env.py b/src/sage/env.py\nindex 33cd754a06..f91c70ba7d 100644\n--- a/src/sage/env.py\n+++ b/src/sage/env.py\n@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])\n _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))\n \n # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.\n-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))\n+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))\n \n \n _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))\n```\n\nbut there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.",
    "created_at": "2017-08-30T18:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294106",
    "user": "https://github.com/jhpalmieri"
}
```

With that change, `make ptestlong` fails:

```
Testing that Sage starts...
[2017-08-30 09:19:29] 
This looks like the first time you are running Sage.
Cleaning up, do not interrupt this.
Done cleaning.
Yes, Sage starts.

real	52m33.269s
user	191m2.435s
sys	19m38.034s
Sage build/upgrade complete!

To install small scripts to directly run Sage's versions of GAP,
the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.
just 'gap' or 'gp') into a standard 'bin' directory, start Sage
by typing 'sage' (or './sage') and enter something like

    install_scripts('/usr/local/bin')

at the Sage command prompt ('sage:').

/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
make: *** [ptestlong] Error 1
```

I think that the make target

```
TESTALL = $(top_srcdir)/sage -t --all
```

needs to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.

`./sage -t -all` also fails:

```
$ ./sage -t --all
/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory
Traceback (most recent call last):
  File "/.../SAGE_SRC_ROOT/src/bin/sage-runtests", line 97, in <module>
    DC = DocTestController(options, args)
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py", line 334, in __init__
    for pkg in list_packages('optional', local=True).values():
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py", line 230, in list_packages
    for p in os.listdir(SAGE_PKGS):
OSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'
```

This can almost be fixed by

```diff
diff --git a/src/sage/env.py b/src/sage/env.py
index 33cd754a06..f91c70ba7d 100644
--- a/src/sage/env.py
+++ b/src/sage/env.py
@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])
 _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))
 
 # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.
-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))
+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))
 
 
 _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))
```

but there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.



---

archive/issue_comments_294107.json:
```json
{
    "body": "If I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.",
    "created_at": "2017-08-30T20:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294107",
    "user": "https://github.com/jhpalmieri"
}
```

If I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.



---

archive/issue_comments_294108.json:
```json
{
    "body": "Replying to [comment:64 jhpalmieri]:\n> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.\n\nSee #23758.",
    "created_at": "2017-08-30T20:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294108",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:64 jhpalmieri]:
> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.

See #23758.



---

archive/issue_comments_294109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-31T05:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294110.json:
```json
{
    "body": "I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`",
    "created_at": "2017-08-31T05:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294110",
    "user": "https://github.com/mkoeppe"
}
```

I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`



---

archive/issue_comments_294111.json:
```json
{
    "body": "Replying to [comment:68 mkoeppe]:\n> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`\n\nThis is a general problem, nothing to worry in the context of this ticket.\n\nBy the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.",
    "created_at": "2017-08-31T09:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294111",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:68 mkoeppe]:
> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`

This is a general problem, nothing to worry in the context of this ticket.

By the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.



---

archive/issue_comments_294112.json:
```json
{
    "body": "I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nI am still having the problem in comment:63 with `sage-starts`.",
    "created_at": "2017-08-31T17:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294112",
    "user": "https://github.com/jhpalmieri"
}
```

I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

I am still having the problem in comment:63 with `sage-starts`.



---

archive/issue_comments_294113.json:
```json
{
    "body": "Replying to [comment:70 jhpalmieri]:\n> I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nUnfortunately these warnings get upgraded to errors like this:\n\n```\n[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```\n\nwhich stops this build for me.\n\nI'll try with  #23023 as suggested by Dima.",
    "created_at": "2017-08-31T21:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294113",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:70 jhpalmieri]:
> I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

Unfortunately these warnings get upgraded to errors like this:

```
[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```

which stops this build for me.

I'll try with  #23023 as suggested by Dima.



---

archive/issue_comments_294114.json:
```json
{
    "body": "Replying to [comment:71 mkoeppe]:\n> Replying to [comment:70 jhpalmieri]:\n> > I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n> \n> Unfortunately these warnings get upgraded to errors like this:\n> {{{\n> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n> }}}\n> which stops this build for me.\n\nYour change in comment:53 fixed that issue for me. (At least I think that's what fixed it.)",
    "created_at": "2017-08-31T22:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294114",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:71 mkoeppe]:
> Replying to [comment:70 jhpalmieri]:
> > I agree that the docbuild warnings are not new. (My issue in comment:51 was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)
> 
> Unfortunately these warnings get upgraded to errors like this:
> {{{
> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
> }}}
> which stops this build for me.

Your change in comment:53 fixed that issue for me. (At least I think that's what fixed it.)



---

archive/issue_comments_294115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-31T23:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294116.json:
```json
{
    "body": "Replying to [comment:70 jhpalmieri]:\n> I am still having the problem in comment:63 with `sage-starts`.\n\nI agree with your patch and have added a commit; but see #23769.",
    "created_at": "2017-08-31T23:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294116",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:70 jhpalmieri]:
> I am still having the problem in comment:63 with `sage-starts`.

I agree with your patch and have added a commit; but see #23769.



---

archive/issue_comments_294117.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T04:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294118.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-01T04:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294118",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294119.json:
```json
{
    "body": "I think this ticket is ready for broader review.",
    "created_at": "2017-09-01T04:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294119",
    "user": "https://github.com/mkoeppe"
}
```

I think this ticket is ready for broader review.



---

archive/issue_comments_294120.json:
```json
{
    "body": "`make distclean` fails because `make sagelib-clean` fails:\n\n```\ncd \"/.../SAGE_SRC_ROOT/src\" && make -j6 clean\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: *** No rule to make target `clean'.  Stop.\nmake[1]: *** [sagelib-clean] Error 2\n```\n\nI guess it should cd to `/.../BUILDDIR/src` instead.",
    "created_at": "2017-09-01T04:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294120",
    "user": "https://github.com/jhpalmieri"
}
```

`make distclean` fails because `make sagelib-clean` fails:

```
cd "/.../SAGE_SRC_ROOT/src" && make -j6 clean
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: *** No rule to make target `clean'.  Stop.
make[1]: *** [sagelib-clean] Error 2
```

I guess it should cd to `/.../BUILDDIR/src` instead.



---

archive/issue_comments_294121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T05:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T05:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294123.json:
```json
{
    "body": "I tried again from a distcleaned tree. Now I'm running into:\n\n```\n[sagelib-8.1.beta3] Generating auto-generated sources\n[sagelib-8.1.beta3] Building interpreters for fast_callable\n[sagelib-8.1.beta3] -> First build of interpreters\n[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'\n```\n",
    "created_at": "2017-09-01T17:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294123",
    "user": "https://github.com/mkoeppe"
}
```

I tried again from a distcleaned tree. Now I'm running into:

```
[sagelib-8.1.beta3] Generating auto-generated sources
[sagelib-8.1.beta3] Building interpreters for fast_callable
[sagelib-8.1.beta3] -> First build of interpreters
[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'
```




---

archive/issue_comments_294124.json:
```json
{
    "body": "I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?",
    "created_at": "2017-09-01T20:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294124",
    "user": "https://github.com/jhpalmieri"
}
```

I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?



---

archive/issue_comments_294125.json:
```json
{
    "body": "Replying to [comment:82 jhpalmieri]:\n> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n\nYes, this is how I am testing it (except I made `src/doc` writable).\n\nSomething in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\n> Where should those files be created?\n\nThey should be created in `SAGE_ROOT/src/sage/ext`.",
    "created_at": "2017-09-01T20:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294125",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:82 jhpalmieri]:
> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 

Yes, this is how I am testing it (except I made `src/doc` writable).

Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

> Where should those files be created?

They should be created in `SAGE_ROOT/src/sage/ext`.



---

archive/issue_comments_294126.json:
```json
{
    "body": "I think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?",
    "created_at": "2017-09-01T20:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294126",
    "user": "https://github.com/mkoeppe"
}
```

I think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?



---

archive/issue_comments_294127.json:
```json
{
    "body": "Perhaps should:\n- rename SAGE_SRC_ROOT to SAGE_VPATH\n- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)\n- create SAGE_SRC = SAGE_ROOT/src\n- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n- create SAGE_SRC_DOC = SAGE_ROOT/src/doc",
    "created_at": "2017-09-01T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294127",
    "user": "https://github.com/mkoeppe"
}
```

Perhaps should:
- rename SAGE_SRC_ROOT to SAGE_VPATH
- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)
- create SAGE_SRC = SAGE_ROOT/src
- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
- create SAGE_SRC_DOC = SAGE_ROOT/src/doc



---

archive/issue_comments_294128.json:
```json
{
    "body": "Replying to [comment:85 mkoeppe]:\n>  - create SAGE_SRC = SAGE_ROOT/src\n\nHow about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)\n\n>  - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n>  - create SAGE_SRC_DOC = SAGE_ROOT/src/doc \n\nOr `SAGE_ROOT_SRC_DOC`?",
    "created_at": "2017-09-01T21:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294128",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:85 mkoeppe]:
>  - create SAGE_SRC = SAGE_ROOT/src

How about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)

>  - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
>  - create SAGE_SRC_DOC = SAGE_ROOT/src/doc 

Or `SAGE_ROOT_SRC_DOC`?



---

archive/issue_comments_294129.json:
```json
{
    "body": "Thanks, these are good suggestions.",
    "created_at": "2017-09-01T21:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294129",
    "user": "https://github.com/mkoeppe"
}
```

Thanks, these are good suggestions.



---

archive/issue_comments_294130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T21:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294131.json:
```json
{
    "body": "Replying to [comment:83 mkoeppe]:\n> Replying to [comment:82 jhpalmieri]:\n> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n> \n> Yes, this is how I am testing it (except I made `src/doc` writable).\n> \n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n> \n> > Where should those files be created?\n> \n> They should be created in `SAGE_ROOT/src/sage/ext`.\n\nIt looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.",
    "created_at": "2017-09-01T22:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294131",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:83 mkoeppe]:
> Replying to [comment:82 jhpalmieri]:
> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 
> 
> Yes, this is how I am testing it (except I made `src/doc` writable).
> 
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.
> 
> > Where should those files be created?
> 
> They should be created in `SAGE_ROOT/src/sage/ext`.

It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.



---

archive/issue_comments_294132.json:
```json
{
    "body": "Replying to [comment:83 mkoeppe]:\n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\nSee #23774.",
    "created_at": "2017-09-01T22:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294132",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:83 mkoeppe]:
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

See #23774.



---

archive/issue_comments_294133.json:
```json
{
    "body": "Replying to [comment:90 jhpalmieri]:\n> > > Where should those files be created?\n> > \n> > They should be created in `SAGE_ROOT/src/sage/ext`.\n> \n> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...\n\nYes, see `src/sage_setup/autogen/interpreters/__main__.py`.\n\nBut I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.",
    "created_at": "2017-09-01T22:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294133",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:90 jhpalmieri]:
> > > Where should those files be created?
> > 
> > They should be created in `SAGE_ROOT/src/sage/ext`.
> 
> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...

Yes, see `src/sage_setup/autogen/interpreters/__main__.py`.

But I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.



---

archive/issue_comments_294134.json:
```json
{
    "body": "I wonder if instead of\n\n```\n+dnl Set up files for VPATH build\n+AS_IF([test x$srcdir != x.],\n+    [AC_CONFIG_COMMANDS([vpath],\n+\t[\n+\t    SAGE_ROOT=${ac_abs_top_builddir}\n+\t    SAGE_VPATH=${ac_abs_top_srcdir}\n+\t    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream\n+\t    # If new packages are downloaded, they end up in the build directory upstream.\n+\t    mkdir -p upstream\n+\t    for a in $SAGE_VPATH/upstream/* ; do\n+\t\tif test -f \"$a\" -a ! -f \"upstream/`basename $a`\" ; then\n+\t\t    ln -s \"$a\" upstream/\n+\t\tfi\n+\t    done\n+\t    cat > sage <<EOF\n```\n\n\nwe could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.",
    "created_at": "2017-09-05T09:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294134",
    "user": "https://github.com/embray"
}
```

I wonder if instead of

```
+dnl Set up files for VPATH build
+AS_IF([test x$srcdir != x.],
+    [AC_CONFIG_COMMANDS([vpath],
+	[
+	    SAGE_ROOT=${ac_abs_top_builddir}
+	    SAGE_VPATH=${ac_abs_top_srcdir}
+	    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream
+	    # If new packages are downloaded, they end up in the build directory upstream.
+	    mkdir -p upstream
+	    for a in $SAGE_VPATH/upstream/* ; do
+		if test -f "$a" -a ! -f "upstream/`basename $a`" ; then
+		    ln -s "$a" upstream/
+		fi
+	    done
+	    cat > sage <<EOF
```


we could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.



---

archive/issue_comments_294135.json:
```json
{
    "body": "I'm seeing a lot of activity on this ticket that I haven't followed.\n\nAnyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`",
    "created_at": "2017-09-05T15:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294135",
    "user": "https://github.com/jdemeyer"
}
```

I'm seeing a lot of activity on this ticket that I haven't followed.

Anyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`



---

archive/issue_comments_294136.json:
```json
{
    "body": "--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n\nThe vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...",
    "created_at": "2017-09-05T15:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294136",
    "user": "https://github.com/mkoeppe"
}
```

--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.

The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...



---

archive/issue_comments_294137.json:
```json
{
    "body": "Replying to [comment:95 mkoeppe]:\n> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n> \n> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...\n\nThis short reply is much better than the long explanation in the ticket description. It's all totally clear now.",
    "created_at": "2017-09-06T08:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294137",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:95 mkoeppe]:
> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.
> 
> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...

This short reply is much better than the long explanation in the ticket description. It's all totally clear now.



---

archive/issue_comments_294138.json:
```json
{
    "body": "Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?",
    "created_at": "2017-09-08T08:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294138",
    "user": "https://github.com/dimpase"
}
```

Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?



---

archive/issue_comments_294139.json:
```json
{
    "body": "I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).",
    "created_at": "2017-09-08T08:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294139",
    "user": "https://github.com/dimpase"
}
```

I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).



---

archive/issue_comments_294140.json:
```json
{
    "body": "Replying to [comment:98 dimpase]:\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nWhen making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294140",
    "user": "https://github.com/embray"
}
```

Replying to [comment:98 dimpase]:
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_294141.json:
```json
{
    "body": "Replying to [comment:99 embray]:\n> Replying to [comment:98 dimpase]:\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nMaybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...\n\n> \n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294141",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:99 embray]:
> Replying to [comment:98 dimpase]:
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

Maybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...

> 
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_294142.json:
```json
{
    "body": "Replying to [comment:98 dimpase]:\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nIt would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\nBut this is entirely unrelated to the present ticket.",
    "created_at": "2017-09-08T19:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294142",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:98 dimpase]:
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
But this is entirely unrelated to the present ticket.



---

archive/issue_comments_294143.json:
```json
{
    "body": "Replying to [comment:99 embray]:\n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  \n\nJust a quick note. When one says \"VPATH\", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html",
    "created_at": "2017-09-08T19:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294143",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:99 embray]:
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  

Just a quick note. When one says "VPATH", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html



---

archive/issue_comments_294144.json:
```json
{
    "body": "Replying to [comment:97 dimpase]:\n> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?\n\nYes, with this patch one can still do non-VPATH builds, without any change.",
    "created_at": "2017-09-08T19:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294144",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:97 dimpase]:
> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?

Yes, with this patch one can still do non-VPATH builds, without any change.



---

archive/issue_comments_294145.json:
```json
{
    "body": "Replying to [comment:101 mkoeppe]:\n> Replying to [comment:98 dimpase]:\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n> \n> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\n> But this is entirely unrelated to the present ticket.\n\nI suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?",
    "created_at": "2017-09-08T20:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294145",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:101 mkoeppe]:
> Replying to [comment:98 dimpase]:
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).
> 
> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
> But this is entirely unrelated to the present ticket.

I suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?



---

archive/issue_comments_294146.json:
```json
{
    "body": "Are there any immediate issues left here beside comment:93?",
    "created_at": "2017-09-28T18:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294146",
    "user": "https://github.com/jhpalmieri"
}
```

Are there any immediate issues left here beside comment:93?



---

archive/issue_comments_294147.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-14T01:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294147",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_294148.json:
```json
{
    "body": "I actually could really use this feature right now :)\n\nmkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix comment:93?",
    "created_at": "2020-02-28T00:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294148",
    "user": "https://github.com/saraedum"
}
```

I actually could really use this feature right now :)

mkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix comment:93?



---

archive/issue_comments_294149.json:
```json
{
    "body": "I hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...\n\nIf you need this earlier, please feel free to work on it.\n\nI don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.",
    "created_at": "2020-02-28T00:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294149",
    "user": "https://github.com/mkoeppe"
}
```

I hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...

If you need this earlier, please feel free to work on it.

I don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.



---

archive/issue_events_057014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57014"
}
```



---

archive/issue_events_057015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57015"
}
```



---

archive/issue_events_057016.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57016"
}
```



---

archive/issue_events_057017.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57017"
}
```



---

archive/issue_events_057018.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57018"
}
```



---

archive/issue_events_057019.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57019"
}
```



---

archive/issue_comments_294150.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294150",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_294151.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21232#issuecomment-294151",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_057020.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57020"
}
```



---

archive/issue_events_057021.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57021"
}
```



---

archive/issue_events_057022.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57022"
}
```



---

archive/issue_events_057023.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57023"
}
```



---

archive/issue_events_057024.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57024"
}
```



---

archive/issue_events_057025.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57025"
}
```



---

archive/issue_events_057026.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57026"
}
```



---

archive/issue_events_057027.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21232",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21232#event-57027"
}
```
