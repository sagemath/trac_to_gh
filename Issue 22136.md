# Issue 22136: Bug in Poset.is_slender(?)

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-02-12 18:00:52

CC:  mmezzarobba jmantysalo




---

Comment by chapoton created at 2017-02-12 20:42:20

iteritems is not python3-compatible

you should rather use

```
from six import iteritems
for xx in iteritems(dd):
    pass
```

----
New commits:


---

Comment by mmezzarobba created at 2017-02-14 18:51:06

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2017-02-14 18:51:06

Replying to [comment:2 chapoton]:
> iteritems is not python3-compatible

Fixed, thanks!

Without this patch, #22029 made one of the doctests of `is_slender()` fail.
Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029? Thanks!
----
New commits:


---

Comment by jmantysalo created at 2017-02-15 04:54:33

Replying to [comment:4 mmezzarobba]:

> Without this patch, #22029 made one of the doctests of `is_slender()` fail.
> Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029?

What was the failing example?

I would guess that the other patch shows some hidden bug in an example poset. That should be easy to spot, just make all the example posets with and without the patch and try


```
L.hasse_diagram().canonical_label().dig6_string()
```



---

Comment by mmezzarobba created at 2017-02-15 21:57:15

Replying to [comment:5 jmantysalo]:
> What was the failing example?

It must have been the one with `certificate=True`, since my patch only touches the certificate. But I don't remember exactly which changes elsewhere made it fail.


---

Comment by jmantysalo created at 2017-02-16 06:43:25

Yes, I have been an idiot when doing the `certificate`-code. Test code:


```
set_random_seed(332211)
D = Posets.DiamondPoset(5)._hasse_diagram

for i in range(100):
    P = Posets.RandomPoset(randint(10, 20), 0.2)
    if P.is_slender():
        if P._hasse_diagram.subgraph_search(D) is not None:
            print("Bug 1")
            break
    else:
        if P._hasse_diagram.subgraph_search(D) is None:
            print("Bug 2")
            break
        _, cert = P.is_slender(certificate=True)
        P_ = P.subposet(P.interval(cert[0], cert[1]))
        if P_.height() != 3:
            print("Bug 3")
            break
        if P_.cardinality() < 5:
            print("Bug 4")
            break
else:
    print("All OK")
```



---

Comment by jmantysalo created at 2017-02-16 13:55:24

How should we define this to be on


```
LatticePoset({0: [1, 2, 3, 4], 1: [6], 2: [6], 3: [6], 4: [5], 5: [6]})
```


? I think that my test code has error, when I compare it to the definition in the docstring.


---

Comment by chapoton created at 2017-03-15 17:00:49

I added a doctest, currently return the wrong answer 5.

I also changed six.iteritems to iteritems in the full file.
----
New commits:


---

Comment by chapoton created at 2017-03-16 07:18:06

ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.


---

Comment by jmantysalo created at 2017-03-16 08:43:11

Replying to [comment:10 chapoton]:
> ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.

Yes, seems to be OK.


---

Comment by jmantysalo created at 2017-03-16 08:43:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-27 20:42:30

Resolution: fixed
