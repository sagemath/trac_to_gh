# Issue 22136: Bug in Poset.is_slender(?)

archive/issues_022136.json:
```json
{
    "body": "CC:  @mezzarobba @jm58660\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22373\n\n",
    "created_at": "2017-02-12T18:00:52Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Bug in Poset.is_slender(?)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22136",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @mezzarobba @jm58660



Issue created by migration from https://trac.sagemath.org/ticket/22373





---

archive/issue_comments_307086.json:
```json
{
    "body": "iteritems is not python3-compatible\n\nyou should rather use\n\n```\nfrom six import iteritems\nfor xx in iteritems(dd):\n    pass\n```\n\n---\nNew commits:",
    "created_at": "2017-02-12T20:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307086",
    "user": "https://github.com/fchapoton"
}
```

iteritems is not python3-compatible

you should rather use

```
from six import iteritems
for xx in iteritems(dd):
    pass
```

---
New commits:



---

archive/issue_comments_307087.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307087",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_307088.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> iteritems is not python3-compatible\n\n\nFixed, thanks!\n\nWithout this patch, #22029 made one of the doctests of `is_slender()` fail.\nJori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029? Thanks!\n\n---\nNew commits:",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307088",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:2 chapoton]:
> iteritems is not python3-compatible


Fixed, thanks!

Without this patch, #22029 made one of the doctests of `is_slender()` fail.
Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029? Thanks!

---
New commits:



---

archive/issue_comments_307089.json:
```json
{
    "body": "Replying to [comment:4 mmezzarobba]:\n\n> Without this patch, #22029 made one of the doctests of `is_slender()` fail.\n> Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029?\n\n\nWhat was the failing example?\n\nI would guess that the other patch shows some hidden bug in an example poset. That should be easy to spot, just make all the example posets with and without the patch and try\n\n```\nL.hasse_diagram().canonical_label().dig6_string()\n```",
    "created_at": "2017-02-15T04:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307089",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:4 mmezzarobba]:

> Without this patch, #22029 made one of the doctests of `is_slender()` fail.
> Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029?


What was the failing example?

I would guess that the other patch shows some hidden bug in an example poset. That should be easy to spot, just make all the example posets with and without the patch and try

```
L.hasse_diagram().canonical_label().dig6_string()
```



---

archive/issue_comments_307090.json:
```json
{
    "body": "Replying to [comment:5 jmantysalo]:\n> What was the failing example?\n\n\nIt must have been the one with `certificate=True`, since my patch only touches the certificate. But I don't remember exactly which changes elsewhere made it fail.",
    "created_at": "2017-02-15T21:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307090",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:5 jmantysalo]:
> What was the failing example?


It must have been the one with `certificate=True`, since my patch only touches the certificate. But I don't remember exactly which changes elsewhere made it fail.



---

archive/issue_comments_307091.json:
```json
{
    "body": "Yes, I have been an idiot when doing the `certificate`-code. Test code:\n\n```\nset_random_seed(332211)\nD = Posets.DiamondPoset(5)._hasse_diagram\n\nfor i in range(100):\n    P = Posets.RandomPoset(randint(10, 20), 0.2)\n    if P.is_slender():\n        if P._hasse_diagram.subgraph_search(D) is not None:\n            print(\"Bug 1\")\n            break\n    else:\n        if P._hasse_diagram.subgraph_search(D) is None:\n            print(\"Bug 2\")\n            break\n        _, cert = P.is_slender(certificate=True)\n        P_ = P.subposet(P.interval(cert[0], cert[1]))\n        if P_.height() != 3:\n            print(\"Bug 3\")\n            break\n        if P_.cardinality() < 5:\n            print(\"Bug 4\")\n            break\nelse:\n    print(\"All OK\")\n```",
    "created_at": "2017-02-16T06:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307091",
    "user": "https://github.com/jm58660"
}
```

Yes, I have been an idiot when doing the `certificate`-code. Test code:

```
set_random_seed(332211)
D = Posets.DiamondPoset(5)._hasse_diagram

for i in range(100):
    P = Posets.RandomPoset(randint(10, 20), 0.2)
    if P.is_slender():
        if P._hasse_diagram.subgraph_search(D) is not None:
            print("Bug 1")
            break
    else:
        if P._hasse_diagram.subgraph_search(D) is None:
            print("Bug 2")
            break
        _, cert = P.is_slender(certificate=True)
        P_ = P.subposet(P.interval(cert[0], cert[1]))
        if P_.height() != 3:
            print("Bug 3")
            break
        if P_.cardinality() < 5:
            print("Bug 4")
            break
else:
    print("All OK")
```



---

archive/issue_comments_307092.json:
```json
{
    "body": "How should we define this to be on\n\n```\nLatticePoset({0: [1, 2, 3, 4], 1: [6], 2: [6], 3: [6], 4: [5], 5: [6]})\n```\n\n? I think that my test code has error, when I compare it to the definition in the docstring.",
    "created_at": "2017-02-16T13:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307092",
    "user": "https://github.com/jm58660"
}
```

How should we define this to be on

```
LatticePoset({0: [1, 2, 3, 4], 1: [6], 2: [6], 3: [6], 4: [5], 5: [6]})
```

? I think that my test code has error, when I compare it to the definition in the docstring.



---

archive/issue_comments_307093.json:
```json
{
    "body": "I added a doctest, currently return the wrong answer 5.\n\nI also changed six.iteritems to iteritems in the full file.\n\n---\nNew commits:",
    "created_at": "2017-03-15T17:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307093",
    "user": "https://github.com/fchapoton"
}
```

I added a doctest, currently return the wrong answer 5.

I also changed six.iteritems to iteritems in the full file.

---
New commits:



---

archive/issue_comments_307094.json:
```json
{
    "body": "ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.",
    "created_at": "2017-03-16T07:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307094",
    "user": "https://github.com/fchapoton"
}
```

ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.



---

archive/issue_comments_307095.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.\n\n\nYes, seems to be OK.",
    "created_at": "2017-03-16T08:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307095",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:10 chapoton]:
> ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.


Yes, seems to be OK.



---

archive/issue_comments_307096.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-16T08:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307096",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_307097.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22136#issuecomment-307097",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058596.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:42:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22136",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22136#event-58596"
}
```
