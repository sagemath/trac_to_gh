# Issue 14550: Update ATLAS to stable version 3.10.1

archive/issues_014550.json:
```json
{
    "body": "Assignee: @jdemeyer\n\nUpdated **spkg**:\n1. [http://boxen.math.washington.edu/home/jpflori/spkg/atlas-3.10.1.p0.spkg](http://boxen.math.washington.edu/home/jpflori/spkg/atlas-3.10.1.p0.spkg).\n\n**Apply**\n1. [attachment:10508_root.patch] to the SAGE_ROOT repository \n2. [attachment:trac_10508_update_atlas_docs.rebased.patch] to the Sage repository.\n\n**Remove** the lapack and blas packages.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14754\n\n",
    "created_at": "2013-06-17T12:21:29Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Update ATLAS to stable version 3.10.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14550",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: @jdemeyer

Updated **spkg**:
1. [http://boxen.math.washington.edu/home/jpflori/spkg/atlas-3.10.1.p0.spkg](http://boxen.math.washington.edu/home/jpflori/spkg/atlas-3.10.1.p0.spkg).

**Apply**
1. [attachment:10508_root.patch] to the SAGE_ROOT repository 
2. [attachment:trac_10508_update_atlas_docs.rebased.patch] to the Sage repository.

**Remove** the lapack and blas packages.

Issue created by migration from https://trac.sagemath.org/ticket/14754





---

archive/issue_comments_184431.json:
```json
{
    "body": "When removing `3DNow`, it starts using `SSE1` and `SSE2`, which shouldn't happen either. But this also happens with the old ATLAS spkg, so at least it's not a regression.",
    "created_at": "2013-06-17T13:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184431",
    "user": "https://github.com/jdemeyer"
}
```

When removing `3DNow`, it starts using `SSE1` and `SSE2`, which shouldn't happen either. But this also happens with the old ATLAS spkg, so at least it's not a regression.



---

archive/issue_comments_184432.json:
```json
{
    "body": "You should use `isa_ext=('None',)` if you want to explictly disable it, see `ATLAS_ISAEXT`.\n\nThe given extensions are not mandatory but are supposed to let ATLAS try them. Whether or not they end up being used is up to the ATLAS build system and how well they perform. Though it seems that you found a bug with ancient cpus, which is unsurprising since I'm pretty sure that nobody else than us builds ATLAS on museum pieces.",
    "created_at": "2013-06-17T14:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184432",
    "user": "https://github.com/vbraun"
}
```

You should use `isa_ext=('None',)` if you want to explictly disable it, see `ATLAS_ISAEXT`.

The given extensions are not mandatory but are supposed to let ATLAS try them. Whether or not they end up being used is up to the ATLAS build system and how well they perform. Though it seems that you found a bug with ancient cpus, which is unsurprising since I'm pretty sure that nobody else than us builds ATLAS on museum pieces.



---

archive/issue_comments_184433.json:
```json
{
    "body": "Replying to [comment:5 vbraun]:\n> You should use `isa_ext=('None',)` if you want to explictly disable it, see `ATLAS_ISAEXT`.\nDone in linked spkg, not yet tested.",
    "created_at": "2013-06-17T20:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184433",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 vbraun]:
> You should use `isa_ext=('None',)` if you want to explictly disable it, see `ATLAS_ISAEXT`.
Done in linked spkg, not yet tested.



---

archive/issue_comments_184434.json:
```json
{
    "body": "Attachment [14754_root.patch](tarball://root/attachments/some-uuid/ticket14754/14754_root.patch) by @jdemeyer created at 2013-06-18 09:38:10",
    "created_at": "2013-06-18T09:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184434",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14754_root.patch](tarball://root/attachments/some-uuid/ticket14754/14754_root.patch) by @jdemeyer created at 2013-06-18 09:38:10



---

archive/issue_comments_184435.json:
```json
{
    "body": "Attachment [14754_update_atlas_docs.patch](tarball://root/attachments/some-uuid/ticket14754/14754_update_atlas_docs.patch) by @jdemeyer created at 2013-06-18 10:01:55",
    "created_at": "2013-06-18T10:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184435",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14754_update_atlas_docs.patch](tarball://root/attachments/some-uuid/ticket14754/14754_update_atlas_docs.patch) by @jdemeyer created at 2013-06-18 10:01:55



---

archive/issue_comments_184436.json:
```json
{
    "body": "spkg diff",
    "created_at": "2013-06-18T12:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184436",
    "user": "https://github.com/jdemeyer"
}
```

spkg diff



---

archive/issue_comments_184437.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-19T06:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184437",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_184438.json:
```json
{
    "body": "Attachment [atlas-3.10.1.p2.diff](tarball://root/attachments/some-uuid/ticket14754/atlas-3.10.1.p2.diff) by @jdemeyer created at 2013-06-19 06:54:34",
    "created_at": "2013-06-19T06:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184438",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [atlas-3.10.1.p2.diff](tarball://root/attachments/some-uuid/ticket14754/atlas-3.10.1.p2.diff) by @jdemeyer created at 2013-06-19 06:54:34



---

archive/issue_comments_184439.json:
```json
{
    "body": "On 64 bit intel chips we should definitely enable SSE2\n\nEdit: misread the patch, the SSE2 is there but there is no 64-bit x86SSE264 archdef. But I guess thats ok, we wil just run through the tuning. There is no 32-bit archdef for ancient 64-bit intel chips",
    "created_at": "2013-06-19T07:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184439",
    "user": "https://github.com/vbraun"
}
```

On 64 bit intel chips we should definitely enable SSE2

Edit: misread the patch, the SSE2 is there but there is no 64-bit x86SSE264 archdef. But I guess thats ok, we wil just run through the tuning. There is no 32-bit archdef for ancient 64-bit intel chips



---

archive/issue_comments_184440.json:
```json
{
    "body": "And the real question: does it improve the build time on ancient i386 chips without SSE? The only real improvement would be if the pure x87 archdef would be used and is actually faster to compile than the full tuning.",
    "created_at": "2013-06-19T07:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184440",
    "user": "https://github.com/vbraun"
}
```

And the real question: does it improve the build time on ancient i386 chips without SSE? The only real improvement would be if the pure x87 archdef would be used and is actually faster to compile than the full tuning.



---

archive/issue_comments_184441.json:
```json
{
    "body": "Volker, you obviously understand this stuff better than me, so if you want to make a reviewer patch, go ahead.\n\nMy main concern is that `configure_base()` should produce a generic binary, meaning it runs on all processors of a given architecture.\n\n(although note that the oldest i386-architecture processor that we test Sage on is a Pentium 4, which has SSE and SSE2)",
    "created_at": "2013-06-19T07:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184441",
    "user": "https://github.com/jdemeyer"
}
```

Volker, you obviously understand this stuff better than me, so if you want to make a reviewer patch, go ahead.

My main concern is that `configure_base()` should produce a generic binary, meaning it runs on all processors of a given architecture.

(although note that the oldest i386-architecture processor that we test Sage on is a Pentium 4, which has SSE and SSE2)



---

archive/issue_comments_184442.json:
```json
{
    "body": "There is no way to make a binary that will run on all x86 cpus ever made. For starters, the original x86 didn't even have x87. Its an evolving instruction set, and we should aim at \"everything within the last X years\" and not the most dumb binary that we can possibly build. Otherwise we'll just make false claims since nobody is going to be able to test that the binary actually works.\n\nThe only reason for removing the 3DNow would be if that makes build time faster since the naming scheme for the \"generic i386 archdef\" is without it. Which is why I'm asking if it actually helps. And for that I guess we'll have to time builds on cicero, maybe I'll get around to it after the 22nd when you are gone.",
    "created_at": "2013-06-19T14:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184442",
    "user": "https://github.com/vbraun"
}
```

There is no way to make a binary that will run on all x86 cpus ever made. For starters, the original x86 didn't even have x87. Its an evolving instruction set, and we should aim at "everything within the last X years" and not the most dumb binary that we can possibly build. Otherwise we'll just make false claims since nobody is going to be able to test that the binary actually works.

The only reason for removing the 3DNow would be if that makes build time faster since the naming scheme for the "generic i386 archdef" is without it. Which is why I'm asking if it actually helps. And for that I guess we'll have to time builds on cicero, maybe I'll get around to it after the 22nd when you are gone.



---

archive/issue_comments_184443.json:
```json
{
    "body": "Replying to [comment:14 vbraun]:\n> The only reason for removing the 3DNow\nAs far as I know, 3DNow is AMD-only, so you would be excluding all Intel chips...",
    "created_at": "2013-06-19T14:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184443",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 vbraun]:
> The only reason for removing the 3DNow
As far as I know, 3DNow is AMD-only, so you would be excluding all Intel chips...



---

archive/issue_comments_184444.json:
```json
{
    "body": "Indeed, that's what i found as well, so enabling 3DNow was a bad idea.\nI suggest to use:\n* the x86x87 target with no ISA extension on 32 bits, it should cover most CPUs except for the ones which have been even discarded from museum,\n* x86 plus SSE2 for 64 bits.\nNote ATLAS provide archdefs for the former and Volker added archdefs for the latter.",
    "created_at": "2013-06-19T15:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184444",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Indeed, that's what i found as well, so enabling 3DNow was a bad idea.
I suggest to use:
* the x86x87 target with no ISA extension on 32 bits, it should cover most CPUs except for the ones which have been even discarded from museum,
* x86 plus SSE2 for 64 bits.
Note ATLAS provide archdefs for the former and Volker added archdefs for the latter.



---

archive/issue_comments_184445.json:
```json
{
    "body": "So basically I completely agree with what Jeroen did.\n\nHow are the generic and non-generic build going on?",
    "created_at": "2013-06-19T15:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184445",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

So basically I completely agree with what Jeroen did.

How are the generic and non-generic build going on?



---

archive/issue_comments_184446.json:
```json
{
    "body": "(About the x86x87 target, ATLAS doc at http://math-atlas.sourceforge.net/atlas_install/node28.html states:\n\n```\n(I believe this is all Intel architectures from PentiumPRO onwards, and any AMD platform since at least the original Athlon)\n```\n\nI would feel this is quite old enough.",
    "created_at": "2013-06-19T15:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184446",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

(About the x86x87 target, ATLAS doc at http://math-atlas.sourceforge.net/atlas_install/node28.html states:

```
(I believe this is all Intel architectures from PentiumPRO onwards, and any AMD platform since at least the original Athlon)
```

I would feel this is quite old enough.



---

archive/issue_comments_184447.json:
```json
{
    "body": "I agree that the change is correct **if it actually uses the archdef now**. So there is some testing to be done.\n\nIn the absence of archdefs we should still enable 3Dnow (and SSE in a few years). x86x87 is already an isa extension over stone-age x86. And \"enabling\" means: try to build the kernel. Whether or not it is actually used by ATLAS depends on whether it actually compiles, runs, and performs well. Not that I think that there is any particular 3dnow asm in ATLAS, but in the near future this will be important for SSE.",
    "created_at": "2013-06-19T16:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184447",
    "user": "https://github.com/vbraun"
}
```

I agree that the change is correct **if it actually uses the archdef now**. So there is some testing to be done.

In the absence of archdefs we should still enable 3Dnow (and SSE in a few years). x86x87 is already an isa extension over stone-age x86. And "enabling" means: try to build the kernel. Whether or not it is actually used by ATLAS depends on whether it actually compiles, runs, and performs well. Not that I think that there is any particular 3dnow asm in ATLAS, but in the near future this will be important for SSE.



---

archive/issue_comments_184448.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n> we should still enable 3Dnow (and SSE in a few years).\nThat makes no sense at all. Intel Pentium 4 (quite old but not stone-age) has SSE and SSE2 but not 3DNow.\n\n> Not that I think that there is any particular 3dnow asm in ATLAS, but in the near future this will be important for SSE.\nThere surely is, otherwise I wouldn't be seeing all those \"Illegal Instruction\" errors.",
    "created_at": "2013-06-20T06:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184448",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 vbraun]:
> we should still enable 3Dnow (and SSE in a few years).
That makes no sense at all. Intel Pentium 4 (quite old but not stone-age) has SSE and SSE2 but not 3DNow.

> Not that I think that there is any particular 3dnow asm in ATLAS, but in the near future this will be important for SSE.
There surely is, otherwise I wouldn't be seeing all those "Illegal Instruction" errors.



---

archive/issue_comments_184449.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-06-20T16:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184449",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_184450.json:
```json
{
    "body": "In spkg-install, the \"archdef_dir = PATCH_DIR\" line for the base target on x86 64 bits should be removed.\nI've moved the tarballs into a ARCH subdir and reenabled copying of archdefs tarballs into ATLAS proper dir, so it should find them without tweaking archdef_dir.\nOr you could disable the copying and set archdef_dir...\n\nBy the way, for the fast target we could also refactor the archdef_dir setting and isa_ext, potentially setting isa_ext = ('None',) by default as for the base target.\n\nQuestion for Volker, how to tell for sure that archdefs are used? apart from a shorter building time?\n\nApart from this, should we wait for the patchbots reports before putting this to positive_review?\nOr the other way around?",
    "created_at": "2013-06-20T16:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184450",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

In spkg-install, the "archdef_dir = PATCH_DIR" line for the base target on x86 64 bits should be removed.
I've moved the tarballs into a ARCH subdir and reenabled copying of archdefs tarballs into ATLAS proper dir, so it should find them without tweaking archdef_dir.
Or you could disable the copying and set archdef_dir...

By the way, for the fast target we could also refactor the archdef_dir setting and isa_ext, potentially setting isa_ext = ('None',) by default as for the base target.

Question for Volker, how to tell for sure that archdefs are used? apart from a shorter building time?

Apart from this, should we wait for the patchbots reports before putting this to positive_review?
Or the other way around?



---

archive/issue_comments_184451.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> There surely is, otherwise I wouldn't be seeing all those \"Illegal Instruction\" errors.\n\nI don't think so. Unless the build host supports 3dnow there is no way that such a kernel would end up in the atlas library. The illegal instructions are because the previous atlas version (which we are still shipping) erroneously did not respect the given limits to the ISA.",
    "created_at": "2013-06-20T17:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184451",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:20 jdemeyer]:
> There surely is, otherwise I wouldn't be seeing all those "Illegal Instruction" errors.

I don't think so. Unless the build host supports 3dnow there is no way that such a kernel would end up in the atlas library. The illegal instructions are because the previous atlas version (which we are still shipping) erroneously did not respect the given limits to the ISA.



---

archive/issue_comments_184452.json:
```json
{
    "body": "Replying to [comment:21 jpflori]:\n> Question for Volker, how to tell for sure that archdefs are used? apart from a shorter building time?\n\nYou can probably read the log, but the only way I would really trust is to measure the build time.",
    "created_at": "2013-06-20T17:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184452",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:21 jpflori]:
> Question for Volker, how to tell for sure that archdefs are used? apart from a shorter building time?

You can probably read the log, but the only way I would really trust is to measure the build time.



---

archive/issue_comments_184453.json:
```json
{
    "body": "Replying to [comment:22 vbraun]:\n> I don't think so. Unless the build host supports 3dnow there is no way that such a kernel would end up in the atlas library. The illegal instructions are because the previous atlas version (which we are still shipping) erroneously did not respect the given limits to the ISA.\n\nYou can think what you want, but the fact is that the build of ATLAS-3.10.1 on `cicero` failed with `3DNow` (with `Illegal Instruction` messages in the build log) but succeeded without `3DNow` (without `Illegal Instruction` messages in the build log).",
    "created_at": "2013-06-21T06:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184453",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 vbraun]:
> I don't think so. Unless the build host supports 3dnow there is no way that such a kernel would end up in the atlas library. The illegal instructions are because the previous atlas version (which we are still shipping) erroneously did not respect the given limits to the ISA.

You can think what you want, but the fact is that the build of ATLAS-3.10.1 on `cicero` failed with `3DNow` (with `Illegal Instruction` messages in the build log) but succeeded without `3DNow` (without `Illegal Instruction` messages in the build log).



---

archive/issue_comments_184454.json:
```json
{
    "body": "For the record, I built ATLAS with\n\n```\nSAGE_ATLAS_ARCH=x86x87,3DNow\n```\n\nand I do get a working install which passes the Sage doctests. So, just to spell it out again, the ISA extension settings just tell ATLAS which ones it is allowed to try, not which ones end up in the ATLAS library. Its normal to get SIGILL during the atlas tuning.\n\nI also verified that it goes through a full tuning which takes a very long time. Presumably that just doesn't work on cicero, or when you tried it the build system couldn't get stable timings.",
    "created_at": "2013-07-07T13:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184454",
    "user": "https://github.com/vbraun"
}
```

For the record, I built ATLAS with

```
SAGE_ATLAS_ARCH=x86x87,3DNow
```

and I do get a working install which passes the Sage doctests. So, just to spell it out again, the ISA extension settings just tell ATLAS which ones it is allowed to try, not which ones end up in the ATLAS library. Its normal to get SIGILL during the atlas tuning.

I also verified that it goes through a full tuning which takes a very long time. Presumably that just doesn't work on cicero, or when you tried it the build system couldn't get stable timings.



---

archive/issue_comments_184455.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-07T13:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184455",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_184456.json:
```json
{
    "body": "Both the fast and base targets for 32-bit intel did not make use of the existing archdefs because of the isa extension mismatch in the filename. Fixed now.",
    "created_at": "2013-07-07T14:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184456",
    "user": "https://github.com/vbraun"
}
```

Both the fast and base targets for 32-bit intel did not make use of the existing archdefs because of the isa extension mismatch in the filename. Fixed now.



---

archive/issue_comments_184457.json:
```json
{
    "body": "Great that you provided a proper spkg-src script.\nI'll try to review the spkg tomorrow.\n\nAnd about 3DNow (I saw you did not put it in back), we don't want to put it in base or fast anyway because it's AMD only, so if you happen to build a dist tarball of Sage, typically by setting the FAT option, on a computer with 3DNow, it will get in and later segfault if you run it on an Intel computer.",
    "created_at": "2013-07-07T17:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184457",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Great that you provided a proper spkg-src script.
I'll try to review the spkg tomorrow.

And about 3DNow (I saw you did not put it in back), we don't want to put it in base or fast anyway because it's AMD only, so if you happen to build a dist tarball of Sage, typically by setting the FAT option, on a computer with 3DNow, it will get in and later segfault if you run it on an Intel computer.



---

archive/issue_comments_184458.json:
```json
{
    "body": "Replying to [comment:28 jpflori]:\n> And about 3DNow, we don't want to put it in base or fast anyway because it's AMD only\n\nKind of a moot point since we don't distribute binaries built on such an old machine. Also, `SAGE_FAT_BINARY` is \"base\" so the 3DNow would be fair game for the \"fast\" target. Except that, there, we already require SSE2.",
    "created_at": "2013-07-07T21:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184458",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:28 jpflori]:
> And about 3DNow, we don't want to put it in base or fast anyway because it's AMD only

Kind of a moot point since we don't distribute binaries built on such an old machine. Also, `SAGE_FAT_BINARY` is "base" so the 3DNow would be fair game for the "fast" target. Except that, there, we already require SSE2.



---

archive/issue_comments_184459.json:
```json
{
    "body": "When I build the 32-bit base/fast versions in my 32-bit virtual machine then I get doctest errors in Sage. Might be something wrong with my VM, though.",
    "created_at": "2013-07-08T14:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184459",
    "user": "https://github.com/vbraun"
}
```

When I build the 32-bit base/fast versions in my 32-bit virtual machine then I get doctest errors in Sage. Might be something wrong with my VM, though.



---

archive/issue_comments_184460.json:
```json
{
    "body": "The doctest failures go away if I disable threading, so perhaps this breaks because I'm building on an quad-core i7. Unless sombody objects, I'd say we disable threading on 32-bit intel base/fast targets. This should probably be done independent of this issue because the \"generic\" library shouldn't have multithreaded thresholds being derived from the latest CPUs with lots of cores.",
    "created_at": "2013-07-08T17:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184460",
    "user": "https://github.com/vbraun"
}
```

The doctest failures go away if I disable threading, so perhaps this breaks because I'm building on an quad-core i7. Unless sombody objects, I'd say we disable threading on 32-bit intel base/fast targets. This should probably be done independent of this issue because the "generic" library shouldn't have multithreaded thresholds being derived from the latest CPUs with lots of cores.



---

archive/issue_comments_184461.json:
```json
{
    "body": "I don't really like the idea...\nPlease also see #14605, the way threading is dealt with is kindof completely broken right now.",
    "created_at": "2013-07-08T19:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184461",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I don't really like the idea...
Please also see #14605, the way threading is dealt with is kindof completely broken right now.



---

archive/issue_comments_184462.json:
```json
{
    "body": "Tell me about it.. I took your `threads.patch` to make it build at all.\n\nBut IMHO its much more important to get an ATLAS update in Sage than fixing threading bugs. So if that means we have to disable it on 32-bit then that sucks but is still better than the current state.",
    "created_at": "2013-07-08T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184462",
    "user": "https://github.com/vbraun"
}
```

Tell me about it.. I took your `threads.patch` to make it build at all.

But IMHO its much more important to get an ATLAS update in Sage than fixing threading bugs. So if that means we have to disable it on 32-bit then that sucks but is still better than the current state.



---

archive/issue_comments_184463.json:
```json
{
    "body": "PS: The updated spkg makes the thread limit configurable via, for example,\n\n```\nSAGE_ATLAS_ARCH=threads=2,fast\n```\n \nSetting the limit to 0 disables threading. Specifying the thread limit is completely optional. This is useful for testing.",
    "created_at": "2013-07-08T19:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184463",
    "user": "https://github.com/vbraun"
}
```

PS: The updated spkg makes the thread limit configurable via, for example,

```
SAGE_ATLAS_ARCH=threads=2,fast
```
 
Setting the limit to 0 disables threading. Specifying the thread limit is completely optional. This is useful for testing.



---

archive/issue_comments_184464.json:
```json
{
    "body": "In fact, the threaded ATLAS doesn't work on x86_64 either. I must have run the doctests in the wrong Sage install the other day?",
    "created_at": "2013-07-09T17:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184464",
    "user": "https://github.com/vbraun"
}
```

In fact, the threaded ATLAS doesn't work on x86_64 either. I must have run the doctests in the wrong Sage install the other day?



---

archive/issue_comments_184465.json:
```json
{
    "body": "My bad, liblinbox was linked with the system atlas (version 3.8.4). Mixing its threading symbols with ATLAS-3.10.1 is instant disaster.",
    "created_at": "2013-07-09T17:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184465",
    "user": "https://github.com/vbraun"
}
```

My bad, liblinbox was linked with the system atlas (version 3.8.4). Mixing its threading symbols with ATLAS-3.10.1 is instant disaster.



---

archive/issue_comments_184466.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> Replying to [comment:28 jpflori]:\n> > And about 3DNow, we don't want to put it in base or fast anyway because it's AMD only\n> \n> Kind of a moot point since we don't distribute binaries built on such an old machine. Also, `SAGE_FAT_BINARY` is \"base\" so the 3DNow would be fair game for the \"fast\" target. Except that, there, we already require SSE2. \nIt does not tackle the problem that 3DNow is AMD only...\nI could imagine someone wanting to distribute a sage bdist with a \"fast\" but still somehow portable ATLAS.\nYou can still argue that in that case he can very well remove 3DNow himself if he wants ot play with fire...\n\nI just don't like to add non-universal extensions to predifined targets although I completely agree that if we consider that someone who builds with fast should only expect it to work on the machine where it was built then trying 3DNow makes sense.\n\nAnyway, does using 3DNow in addition of SSE or SSE2 gives any speedup?\nI guess not, so let's forget about 3DNow for \"fast\" because we have SSE2 and for \"base\" because we don't want people to end up distributing AMD only binaries (though it's highly unlikely, I agree)...",
    "created_at": "2013-07-09T20:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184466",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:29 vbraun]:
> Replying to [comment:28 jpflori]:
> > And about 3DNow, we don't want to put it in base or fast anyway because it's AMD only
> 
> Kind of a moot point since we don't distribute binaries built on such an old machine. Also, `SAGE_FAT_BINARY` is "base" so the 3DNow would be fair game for the "fast" target. Except that, there, we already require SSE2. 
It does not tackle the problem that 3DNow is AMD only...
I could imagine someone wanting to distribute a sage bdist with a "fast" but still somehow portable ATLAS.
You can still argue that in that case he can very well remove 3DNow himself if he wants ot play with fire...

I just don't like to add non-universal extensions to predifined targets although I completely agree that if we consider that someone who builds with fast should only expect it to work on the machine where it was built then trying 3DNow makes sense.

Anyway, does using 3DNow in addition of SSE or SSE2 gives any speedup?
I guess not, so let's forget about 3DNow for "fast" because we have SSE2 and for "base" because we don't want people to end up distributing AMD only binaries (though it's highly unlikely, I agree)...



---

archive/issue_comments_184467.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> PS: The updated spkg makes the thread limit configurable via, for example,\n> {{{\n> SAGE_ATLAS_ARCH=threads=2,fast\n> }}} \n> Setting the limit to 0 disables threading. Specifying the thread limit is completely optional. This is useful for testing.\nGreat.",
    "created_at": "2013-07-09T20:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184467",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:34 vbraun]:
> PS: The updated spkg makes the thread limit configurable via, for example,
> {{{
> SAGE_ATLAS_ARCH=threads=2,fast
> }}} 
> Setting the limit to 0 disables threading. Specifying the thread limit is completely optional. This is useful for testing.
Great.



---

archive/issue_comments_184468.json:
```json
{
    "body": "Replying to [comment:33 vbraun]:\n> Tell me about it.. I took your `threads.patch` to make it build at all.\n> \n> But IMHO its much more important to get an ATLAS update in Sage than fixing threading bugs. So if that means we have to disable it on 32-bit then that sucks but is still better than the current state.\nIs this really because of the VM (or the OS?) being 32 bits?\nIt seems strange.\nOr did you also get mixed symbols?\n\nAnyway, I agree the base target should disable threading.\nFor the fast one, if we go for \"the \"fast\" target should only run on the machine where it is built\" interpretation, then it's kind of bad. But if threading is indeed broken on all 32 bits OSes, then we don't have a choice.\nIf we want to consider that the \"fast\" build is also \"generic\" and could be redistributed, then disabling threading is completely ok, till we decide that recent enough computers have more than one core :)",
    "created_at": "2013-07-09T20:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184468",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:33 vbraun]:
> Tell me about it.. I took your `threads.patch` to make it build at all.
> 
> But IMHO its much more important to get an ATLAS update in Sage than fixing threading bugs. So if that means we have to disable it on 32-bit then that sucks but is still better than the current state.
Is this really because of the VM (or the OS?) being 32 bits?
It seems strange.
Or did you also get mixed symbols?

Anyway, I agree the base target should disable threading.
For the fast one, if we go for "the "fast" target should only run on the machine where it is built" interpretation, then it's kind of bad. But if threading is indeed broken on all 32 bits OSes, then we don't have a choice.
If we want to consider that the "fast" build is also "generic" and could be redistributed, then disabling threading is completely ok, till we decide that recent enough computers have more than one core :)



---

archive/issue_comments_184469.json:
```json
{
    "body": "Replying to [comment:31 vbraun]:\n> This should probably be done independent of this issue because the \"generic\" library shouldn't have multithreaded thresholds being derived from the latest CPUs with lots of cores.\nYou mean reenabling threading on 32 bits intel?\n(In case it was not broken just because of mixed symbols of course.)",
    "created_at": "2013-07-09T21:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184469",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:31 vbraun]:
> This should probably be done independent of this issue because the "generic" library shouldn't have multithreaded thresholds being derived from the latest CPUs with lots of cores.
You mean reenabling threading on 32 bits intel?
(In case it was not broken just because of mixed symbols of course.)



---

archive/issue_comments_184470.json:
```json
{
    "body": "System ATLAS is (at least on Fedora) libatlas.so.3 and we install libatlas.so.2. Since I rebuilt various packages mixing system atlas (using SAGE_ATLAS_LIB) and self-compiled atlas, I ended up with a mix of symbols. I've changed our versioning to use .3 as well. Upstream doesn't version the library but since it is ATLAS 3.x most distributors will probably opt for .3.\n\nI agree that there is no point in 3DNow on SSE-enabled processors. Its not used anywhere now.\n\nI think that was the problem with 32-bit, too. But I'm still running tests. Will re-enable \"fast\" threads on 32-bit if it works...\n\nI've changed the threads option to colon\n\n```\nSAGE_ATLAS_ARCH=threads:2,static,fast\n```\n\nand added the optional \"static\" to also install static libraries (though built with -fPIC, really only useful for debugging)\n\nFinally, I'm also installing upstream's new ATLAS shared library (libsatlas.so / libtatlas.so). Eventually we'll want to switch Sage over to those, so we might just as well install them already.",
    "created_at": "2013-07-09T21:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184470",
    "user": "https://github.com/vbraun"
}
```

System ATLAS is (at least on Fedora) libatlas.so.3 and we install libatlas.so.2. Since I rebuilt various packages mixing system atlas (using SAGE_ATLAS_LIB) and self-compiled atlas, I ended up with a mix of symbols. I've changed our versioning to use .3 as well. Upstream doesn't version the library but since it is ATLAS 3.x most distributors will probably opt for .3.

I agree that there is no point in 3DNow on SSE-enabled processors. Its not used anywhere now.

I think that was the problem with 32-bit, too. But I'm still running tests. Will re-enable "fast" threads on 32-bit if it works...

I've changed the threads option to colon

```
SAGE_ATLAS_ARCH=threads:2,static,fast
```

and added the optional "static" to also install static libraries (though built with -fPIC, really only useful for debugging)

Finally, I'm also installing upstream's new ATLAS shared library (libsatlas.so / libtatlas.so). Eventually we'll want to switch Sage over to those, so we might just as well install them already.



---

archive/issue_comments_184471.json:
```json
{
    "body": "Great only good news.\nI also kind of disliked the multiple equal signs to control threading.",
    "created_at": "2013-07-09T21:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184471",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Great only good news.
I also kind of disliked the multiple equal signs to control threading.



---

archive/issue_comments_184472.json:
```json
{
    "body": "Note that having a static atlas is useful for Cygwin as libtool won't build the shared library there.",
    "created_at": "2013-07-09T21:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184472",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Note that having a static atlas is useful for Cygwin as libtool won't build the shared library there.



---

archive/issue_comments_184473.json:
```json
{
    "body": "In particular, I suggest that if static is enabled, then don't let the whole spkg-install script fail if building the shared library failed, but building (and installing) the static one did not.",
    "created_at": "2013-07-09T21:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184473",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

In particular, I suggest that if static is enabled, then don't let the whole spkg-install script fail if building the shared library failed, but building (and installing) the static one did not.



---

archive/issue_comments_184474.json:
```json
{
    "body": "Does the Cygwin build actually get that far? ATLAS configure has a bunch of Cygwin-related settings and we don't touch any of that stuff.",
    "created_at": "2013-07-09T22:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184474",
    "user": "https://github.com/vbraun"
}
```

Does the Cygwin build actually get that far? ATLAS configure has a bunch of Cygwin-related settings and we don't touch any of that stuff.



---

archive/issue_comments_184475.json:
```json
{
    "body": "I do get the error reported on #14753\n\n```\nsage -t --long sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"sage/matrix/matrix_double_dense.pyx\", line 3809, in sage.matrix.matrix_double_dense.Matrix_double_dense.is_positive_definite\nFailed example:\n    H.is_positive_definite()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nalso with Fedora's version of ATLAS-3.8.4. I'm not sure that the test is actually numerically well-conditioned, it does:\n\n```\nsage: R = random_matrix(CDF, 200)\nsage: H = R.conjugate_transpose()*R\nsage: import scipy.linalg\nsage: scipy.linalg.cholesky(H.numpy(), lower=1)\n```\n\nDepending on the distribution of `random_matrix` this may be ill-conditioned: http://stackoverflow.com/questions/12322431/generating-a-pseduo-random-positive-definite-matrix. Conditioning numbers are around `10^6` - `10^7` so its not great but not terribly bad either.",
    "created_at": "2013-07-10T03:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184475",
    "user": "https://github.com/vbraun"
}
```

I do get the error reported on #14753

```
sage -t --long sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "sage/matrix/matrix_double_dense.pyx", line 3809, in sage.matrix.matrix_double_dense.Matrix_double_dense.is_positive_definite
Failed example:
    H.is_positive_definite()
Expected:
    True
Got:
    False
**********************************************************************
```

also with Fedora's version of ATLAS-3.8.4. I'm not sure that the test is actually numerically well-conditioned, it does:

```
sage: R = random_matrix(CDF, 200)
sage: H = R.conjugate_transpose()*R
sage: import scipy.linalg
sage: scipy.linalg.cholesky(H.numpy(), lower=1)
```

Depending on the distribution of `random_matrix` this may be ill-conditioned: http://stackoverflow.com/questions/12322431/generating-a-pseduo-random-positive-definite-matrix. Conditioning numbers are around `10^6` - `10^7` so its not great but not terribly bad either.



---

archive/issue_comments_184476.json:
```json
{
    "body": "Attachment [test_atlas.sh](tarball://root/attachments/some-uuid/ticket14754/test_atlas.sh) by @vbraun created at 2013-07-10 03:38:49\n\nScript to build atlas with base, fast, and default settings",
    "created_at": "2013-07-10T03:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184476",
    "user": "https://github.com/vbraun"
}
```

Attachment [test_atlas.sh](tarball://root/attachments/some-uuid/ticket14754/test_atlas.sh) by @vbraun created at 2013-07-10 03:38:49

Script to build atlas with base, fast, and default settings



---

archive/issue_comments_184477.json:
```json
{
    "body": "Replying to [comment:45 vbraun]:\n> Does the Cygwin build actually get that far? ATLAS configure has a bunch of Cygwin-related settings and we don't touch any of that stuff.\nLast time I tried it finished.\n\nI could even build shared libraries by replacing libtool calls to gcc calls for linking.",
    "created_at": "2013-07-10T07:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184477",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:45 vbraun]:
> Does the Cygwin build actually get that far? ATLAS configure has a bunch of Cygwin-related settings and we don't touch any of that stuff.
Last time I tried it finished.

I could even build shared libraries by replacing libtool calls to gcc calls for linking.



---

archive/issue_comments_184478.json:
```json
{
    "body": "for review only",
    "created_at": "2013-07-10T12:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184478",
    "user": "https://github.com/vbraun"
}
```

for review only



---

archive/issue_comments_184479.json:
```json
{
    "body": "Attachment [atlas-p2-p3.diff](tarball://root/attachments/some-uuid/ticket14754/atlas-p2-p3.diff) by @vbraun created at 2013-07-12 13:47:11\n\nI built base, fast, and the default (no `SAGE_ATLAS_ARCH`) on a variety of machines and `make ptestlong` succeeds in all cases. Wall time to build ATLAS:\n\n```\n                  |    base     |     fast    |    default\n------------------+-------------+-------------+--------------\nMy Thinkpad W530  |  20m52.259s |  14m34.608s |  13m52.420s\nFedora 19 x86_64  |             |             |\n------------------+-------------+-------------+--------------\nVirtual Machine   |  22m16.444s |  22m23.433s | 244m25.015s\nFedora 19 i686    |             |             |\n------------------+-------------+-------------+--------------\ncicero on skynet  |  38m49.345s |  38m50.003s |  38m24.546s\n                  |             |             |\n```\n",
    "created_at": "2013-07-12T13:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184479",
    "user": "https://github.com/vbraun"
}
```

Attachment [atlas-p2-p3.diff](tarball://root/attachments/some-uuid/ticket14754/atlas-p2-p3.diff) by @vbraun created at 2013-07-12 13:47:11

I built base, fast, and the default (no `SAGE_ATLAS_ARCH`) on a variety of machines and `make ptestlong` succeeds in all cases. Wall time to build ATLAS:

```
                  |    base     |     fast    |    default
------------------+-------------+-------------+--------------
My Thinkpad W530  |  20m52.259s |  14m34.608s |  13m52.420s
Fedora 19 x86_64  |             |             |
------------------+-------------+-------------+--------------
Virtual Machine   |  22m16.444s |  22m23.433s | 244m25.015s
Fedora 19 i686    |             |             |
------------------+-------------+-------------+--------------
cicero on skynet  |  38m49.345s |  38m50.003s |  38m24.546s
                  |             |             |
```




---

archive/issue_comments_184480.json:
```json
{
    "body": "The new patches introduce a typo:\n\n```\nraise ValuError\n```\n\n\nI guess you could also get rid of \"autom4te.cache\" in spkg-src.\n\nMaybe document the new options threads and static.\n\nOtherwise everything looks fine, I'm testing it right now.",
    "created_at": "2013-07-15T13:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184480",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The new patches introduce a typo:

```
raise ValuError
```


I guess you could also get rid of "autom4te.cache" in spkg-src.

Maybe document the new options threads and static.

Otherwise everything looks fine, I'm testing it right now.



---

archive/issue_comments_184481.json:
```json
{
    "body": "Updated spkg, diff is\n\n```\ndiff -r 4c3c4795e2b6 -r d32570dc368b spkg-install\n--- a/spkg-install\tSun Jul 07 01:00:12 2013 -0400\n+++ b/spkg-install\tTue Jul 16 16:13:17 2013 -0400\n@@ -232,7 +232,7 @@\n             INSTALL_STATIC_LIBRARIES = True\n         elif opt in ATLAS_MACHTYPE + ('fast', 'base'):\n             if arch is not None:\n-                raise ValuError('multiple architectures specified: {0} and {1}'.format(arch, opt))\n+                raise ValueError('multiple architectures specified: {0} and {1}'.format(arch, opt))\n             arch = opt\n         elif opt in ATLAS_ISAEXT:\n             if isa_ext is None:\ndiff -r 4c3c4795e2b6 -r d32570dc368b spkg-src\n--- a/spkg-src\tSun Jul 07 01:00:12 2013 -0400\n+++ b/spkg-src\tTue Jul 16 16:13:17 2013 -0400\n@@ -49,6 +49,7 @@\n cp -rp \"$SPKG_ROOT\"/patches/ATLAS-lib .\n cd ATLAS-lib\n autoreconf -fiv\n+rm -rf autom4te.cache\n \n \n ### Finished creating the src/ directory\n```\n",
    "created_at": "2013-07-16T20:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184481",
    "user": "https://github.com/vbraun"
}
```

Updated spkg, diff is

```
diff -r 4c3c4795e2b6 -r d32570dc368b spkg-install
--- a/spkg-install	Sun Jul 07 01:00:12 2013 -0400
+++ b/spkg-install	Tue Jul 16 16:13:17 2013 -0400
@@ -232,7 +232,7 @@
             INSTALL_STATIC_LIBRARIES = True
         elif opt in ATLAS_MACHTYPE + ('fast', 'base'):
             if arch is not None:
-                raise ValuError('multiple architectures specified: {0} and {1}'.format(arch, opt))
+                raise ValueError('multiple architectures specified: {0} and {1}'.format(arch, opt))
             arch = opt
         elif opt in ATLAS_ISAEXT:
             if isa_ext is None:
diff -r 4c3c4795e2b6 -r d32570dc368b spkg-src
--- a/spkg-src	Sun Jul 07 01:00:12 2013 -0400
+++ b/spkg-src	Tue Jul 16 16:13:17 2013 -0400
@@ -49,6 +49,7 @@
 cp -rp "$SPKG_ROOT"/patches/ATLAS-lib .
 cd ATLAS-lib
 autoreconf -fiv
+rm -rf autom4te.cache
 
 
 ### Finished creating the src/ directory
```




---

archive/issue_comments_184482.json:
```json
{
    "body": "Document new options.",
    "created_at": "2013-07-18T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184482",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Document new options.



---

archive/issue_comments_184483.json:
```json
{
    "body": "Attachment [trac_14754-new_opts.patch](tarball://root/attachments/some-uuid/ticket14754/trac_14754-new_opts.patch) by jpflori created at 2013-07-18 10:01:29\n\nI'm happy with Volker changes.\n\nIf he agrees with my changes to the doc, let's put this as positive review.",
    "created_at": "2013-07-18T10:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184483",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac_14754-new_opts.patch](tarball://root/attachments/some-uuid/ticket14754/trac_14754-new_opts.patch) by jpflori created at 2013-07-18 10:01:29

I'm happy with Volker changes.

If he agrees with my changes to the doc, let's put this as positive review.



---

archive/issue_comments_184484.json:
```json
{
    "body": "Thanks, looks good to me.",
    "created_at": "2013-07-18T13:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184484",
    "user": "https://github.com/vbraun"
}
```

Thanks, looks good to me.



---

archive/issue_comments_184485.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-18T13:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184485",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_184486.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-02T14:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184486",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_184487.json:
```json
{
    "body": "See #15045 for a blocker follow-up.",
    "created_at": "2013-08-14T16:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14550",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14550#issuecomment-184487",
    "user": "https://github.com/jdemeyer"
}
```

See #15045 for a blocker follow-up.
