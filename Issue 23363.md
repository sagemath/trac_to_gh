# Issue 23363: Fix the remaining cpdef declaration issues

archive/issues_023363.json:
```json
{
    "body": "CC:  @jdemeyer\n\nIn #23227 we added `cpdef` declarations to address https://github.com/cython/cython/issues/1732.  A few were not completely straightforward and left for a followup ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23600\n\n",
    "created_at": "2017-08-08T20:37:51Z",
    "labels": [
        "component: cython",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Fix the remaining cpdef declaration issues",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23363",
    "user": "https://github.com/roed314"
}
```
CC:  @jdemeyer

In #23227 we added `cpdef` declarations to address https://github.com/cython/cython/issues/1732.  A few were not completely straightforward and left for a followup ticket.

Issue created by migration from https://trac.sagemath.org/ticket/23600





---

archive/issue_comments_326647.json:
```json
{
    "body": "Jeroen, can you add the code here that you removed from the other branch?",
    "created_at": "2017-08-08T20:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326647",
    "user": "https://github.com/roed314"
}
```

Jeroen, can you add the code here that you removed from the other branch?



---

archive/issue_comments_326648.json:
```json
{
    "body": "I would rather prefer to fix this on a case-by-case basis (for example, one ticket for p-adics, one ticket for quaternion algebras, ...)",
    "created_at": "2017-08-09T08:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326648",
    "user": "https://github.com/jdemeyer"
}
```

I would rather prefer to fix this on a case-by-case basis (for example, one ticket for p-adics, one ticket for quaternion algebras, ...)



---

archive/issue_comments_326649.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-09T09:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326649",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_326650.json:
```json
{
    "body": "To be clear: I am not saying that I'm against all the changes in this remaining branch, only that it's not immediately clear that it's the right thing to do.",
    "created_at": "2017-08-09T09:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326650",
    "user": "https://github.com/jdemeyer"
}
```

To be clear: I am not saying that I'm against all the changes in this remaining branch, only that it's not immediately clear that it's the right thing to do.



---

archive/issue_comments_326651.json:
```json
{
    "body": "Comments in more detail:\n\n1. `sage/algebras/quatalg`: instead, add abstract methods `_add_` and `_mul_` to the base class.\n\n2. `sage/modular/pollack_stevens`: unrelated change to `cpdef normalize`\n\n3. `src/sage/modules`: instead, add abstract methods `_add_` and `_mul_` to the base class.\n\n4. `sage/numerical/backends`: `add_variable` is already declared in the base class `GenericBackend`\n\n5. `sage/rings/finite_rings`: instead, add abstract methods `_add_` and `_mul_` to the base class.\n\n6. `src/sage/rings/number_field`: already in the base class `NumberFieldElement` (but not declared there)\n\n7. `sage/rings/padics`: lots of changes, not looked in detail yet.\n\n8. `src/sage/rings/polynomial` and power series: instead, add abstract methods to the base class.",
    "created_at": "2017-08-09T09:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326651",
    "user": "https://github.com/jdemeyer"
}
```

Comments in more detail:

1. `sage/algebras/quatalg`: instead, add abstract methods `_add_` and `_mul_` to the base class.

2. `sage/modular/pollack_stevens`: unrelated change to `cpdef normalize`

3. `src/sage/modules`: instead, add abstract methods `_add_` and `_mul_` to the base class.

4. `sage/numerical/backends`: `add_variable` is already declared in the base class `GenericBackend`

5. `sage/rings/finite_rings`: instead, add abstract methods `_add_` and `_mul_` to the base class.

6. `src/sage/rings/number_field`: already in the base class `NumberFieldElement` (but not declared there)

7. `sage/rings/padics`: lots of changes, not looked in detail yet.

8. `src/sage/rings/polynomial` and power series: instead, add abstract methods to the base class.



---

archive/issue_comments_326652.json:
```json
{
    "body": "I can try to fix some of these, but we should coordinate to avoid double work. Items 2, 4 and 6 on the list above seem easiest, so I will have a quick look now.\n\nEDIT: 2 and 4 are different `cpdef` declarations issues, they are because of a changed signature. I sent an e-mail to cython-users asking whether the warning is still correct in this case.",
    "created_at": "2017-08-09T09:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326652",
    "user": "https://github.com/jdemeyer"
}
```

I can try to fix some of these, but we should coordinate to avoid double work. Items 2, 4 and 6 on the list above seem easiest, so I will have a quick look now.

EDIT: 2 and 4 are different `cpdef` declarations issues, they are because of a changed signature. I sent an e-mail to cython-users asking whether the warning is still correct in this case.



---

archive/issue_comments_326653.json:
```json
{
    "body": "Okay. I'm traveling at the moment, so I'm not going to work on this immediately. I'll make a comment here before doing anything.",
    "created_at": "2017-08-09T10:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326653",
    "user": "https://github.com/roed314"
}
```

Okay. I'm traveling at the moment, so I'm not going to work on this immediately. I'll make a comment here before doing anything.



---

archive/issue_events_060451.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-29T16:02:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23363#event-60451"
}
```



---

archive/issue_comments_326654.json:
```json
{
    "body": "Every issue has a ticket now, so let's close this.",
    "created_at": "2018-01-29T16:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326654",
    "user": "https://github.com/jdemeyer"
}
```

Every issue has a ticket now, so let's close this.



---

archive/issue_events_060452.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-29T16:02:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23363#event-60452"
}
```



---

archive/issue_comments_326655.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2018-01-29T16:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23363#issuecomment-326655",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
