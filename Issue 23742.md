# Issue 23742: Ignore failure in setrlimit on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/23979

Original creator: embray

Original creation time: 2017-10-06 14:07:25

CC:  jdemeyer

Fixes bug introduced by #23748 that makes it impossible to run the tests on Cygwin.


---

Comment by embray created at 2017-10-06 14:07:32

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-10-06 14:14:13

Do you know why `setrlimit()` does not work? Is it a Python problem or a Cygwin problem?


---

Comment by jdemeyer created at 2017-10-06 14:27:21

I'd like to understand why it doesn't work and check that condition instead of blindly ignoring exceptions. Or, if that doesn't work, only ignore the exception on Cygwin.


---

Comment by jdemeyer created at 2017-10-06 14:27:21

Changing status from needs_review to needs_info.


---

Comment by embray created at 2017-10-09 09:25:29

`setrlimit()` works for some limits on Cygwin but not all.  In particular `RLIMIT_AS` does not work. But the only effect is to return -1 and set EINVAL, so there's no particular way to distinguish this from other failures that can occur setting this limit (in fact the error message that Python gives in this case is misleading).  I suspect this won't be 100% portable in all other cases either; tbh I don't know what motivated this change and the 3300MB setting is pretty arbitrary anyways, so I think it's fine to ignore it if it fails.


---

Comment by embray created at 2017-10-09 09:25:29

Changing component from PLEASE CHANGE to porting: Cygwin.


---

Comment by embray created at 2017-10-12 07:54:26

I could raise an exception if not on Cygwin.  It just seems to me though like something that _should_ fail quietly, or at most with a warning.  It shouldn't just crash the test runner if `setrlimit()` fails for some reason.


---

Comment by jdemeyer created at 2017-10-12 08:52:24

This is only for the doctester, not for running Sage itself. When testing, it is fair to be more strict. You typically want to know when something goes wrong, even if that thing is rather innocent.

So yes, I would be happier to ignore the exception only on Cygwin.


---

Comment by embray created at 2017-10-12 09:58:03

Right but what I'm saying is the behavior of setting the memory limit to 3300 MB is pretty arbitrary and not something most people running the doctester is even going to be aware is happening, so if for some reason it fails it's not very nice if the doctester just crashes.

Another thing that's unfortunate is that there's no way to distinguish a `ValueError` when passing an unsupported limit, versus a `ValueError` when the limits themselves are invalid for some reason.  It's not the best interface.

Well, we can try squelching it just in Cygwin for now.  I'll be curious to see if this causes problems on any other platforms. Perhaps it won't.


---

Comment by git created at 2017-10-12 10:01:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-10-12 10:01:45

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2017-10-12 10:23:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-10-16 22:45:04

Resolution: fixed
