# Issue 23742: Ignore failure in setrlimit on Cygwin

archive/issues_023742.json:
```json
{
    "body": "CC:  jdemeyer\n\nFixes bug introduced by #23748 that makes it impossible to run the tests on Cygwin.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23979\n\n",
    "created_at": "2017-10-06T14:07:25Z",
    "labels": [
        "PLEASE CHANGE",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Ignore failure in setrlimit on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23742",
    "user": "embray"
}
```
CC:  jdemeyer

Fixes bug introduced by #23748 that makes it impossible to run the tests on Cygwin.

Issue created by migration from https://trac.sagemath.org/ticket/23979





---

archive/issue_comments_332633.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-06T14:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332633",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332634.json:
```json
{
    "body": "Do you know why `setrlimit()` does not work? Is it a Python problem or a Cygwin problem?",
    "created_at": "2017-10-06T14:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332634",
    "user": "jdemeyer"
}
```

Do you know why `setrlimit()` does not work? Is it a Python problem or a Cygwin problem?



---

archive/issue_comments_332635.json:
```json
{
    "body": "I'd like to understand why it doesn't work and check that condition instead of blindly ignoring exceptions. Or, if that doesn't work, only ignore the exception on Cygwin.",
    "created_at": "2017-10-06T14:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332635",
    "user": "jdemeyer"
}
```

I'd like to understand why it doesn't work and check that condition instead of blindly ignoring exceptions. Or, if that doesn't work, only ignore the exception on Cygwin.



---

archive/issue_comments_332636.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-10-06T14:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332636",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_332637.json:
```json
{
    "body": "`setrlimit()` works for some limits on Cygwin but not all.  In particular `RLIMIT_AS` does not work. But the only effect is to return -1 and set EINVAL, so there's no particular way to distinguish this from other failures that can occur setting this limit (in fact the error message that Python gives in this case is misleading).  I suspect this won't be 100% portable in all other cases either; tbh I don't know what motivated this change and the 3300MB setting is pretty arbitrary anyways, so I think it's fine to ignore it if it fails.",
    "created_at": "2017-10-09T09:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332637",
    "user": "embray"
}
```

`setrlimit()` works for some limits on Cygwin but not all.  In particular `RLIMIT_AS` does not work. But the only effect is to return -1 and set EINVAL, so there's no particular way to distinguish this from other failures that can occur setting this limit (in fact the error message that Python gives in this case is misleading).  I suspect this won't be 100% portable in all other cases either; tbh I don't know what motivated this change and the 3300MB setting is pretty arbitrary anyways, so I think it's fine to ignore it if it fails.



---

archive/issue_comments_332638.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to porting: Cygwin.",
    "created_at": "2017-10-09T09:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332638",
    "user": "embray"
}
```

Changing component from PLEASE CHANGE to porting: Cygwin.



---

archive/issue_comments_332639.json:
```json
{
    "body": "I could raise an exception if not on Cygwin.  It just seems to me though like something that *should* fail quietly, or at most with a warning.  It shouldn't just crash the test runner if `setrlimit()` fails for some reason.",
    "created_at": "2017-10-12T07:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332639",
    "user": "embray"
}
```

I could raise an exception if not on Cygwin.  It just seems to me though like something that *should* fail quietly, or at most with a warning.  It shouldn't just crash the test runner if `setrlimit()` fails for some reason.



---

archive/issue_comments_332640.json:
```json
{
    "body": "This is only for the doctester, not for running Sage itself. When testing, it is fair to be more strict. You typically want to know when something goes wrong, even if that thing is rather innocent.\n\nSo yes, I would be happier to ignore the exception only on Cygwin.",
    "created_at": "2017-10-12T08:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332640",
    "user": "jdemeyer"
}
```

This is only for the doctester, not for running Sage itself. When testing, it is fair to be more strict. You typically want to know when something goes wrong, even if that thing is rather innocent.

So yes, I would be happier to ignore the exception only on Cygwin.



---

archive/issue_comments_332641.json:
```json
{
    "body": "Right but what I'm saying is the behavior of setting the memory limit to 3300 MB is pretty arbitrary and not something most people running the doctester is even going to be aware is happening, so if for some reason it fails it's not very nice if the doctester just crashes.\n\nAnother thing that's unfortunate is that there's no way to distinguish a `ValueError` when passing an unsupported limit, versus a `ValueError` when the limits themselves are invalid for some reason.  It's not the best interface.\n\nWell, we can try squelching it just in Cygwin for now.  I'll be curious to see if this causes problems on any other platforms. Perhaps it won't.",
    "created_at": "2017-10-12T09:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332641",
    "user": "embray"
}
```

Right but what I'm saying is the behavior of setting the memory limit to 3300 MB is pretty arbitrary and not something most people running the doctester is even going to be aware is happening, so if for some reason it fails it's not very nice if the doctester just crashes.

Another thing that's unfortunate is that there's no way to distinguish a `ValueError` when passing an unsupported limit, versus a `ValueError` when the limits themselves are invalid for some reason.  It's not the best interface.

Well, we can try squelching it just in Cygwin for now.  I'll be curious to see if this causes problems on any other platforms. Perhaps it won't.



---

archive/issue_comments_332642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-12T10:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332643.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-10-12T10:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332643",
    "user": "embray"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_332644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-12T10:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332644",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332645.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-16T22:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23742#issuecomment-332645",
    "user": "vbraun"
}
```

Resolution: fixed
