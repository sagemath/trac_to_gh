# Issue 17163: simplify_full returns odd result from symbolic series input

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-11-26 10:08:06


```
sage: x=var('x')
sage: s=(1/(1-x)).series(x,6)
sage: s.coeffs()
[This is the Trac macro *x^5 + x^4 + x^3 + x^2 + x + Order* that was inherited from the migration called with arguments (x^6) + 1, 0)](https://trac.sagemath.org/wiki/WikiMacros#x^5 + x^4 + x^3 + x^2 + x + Order-macro)
sage: s.simplify_full().coeffs()
[[Order(x^6) + 1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 5]]
```

See also the related #17399.


---

Comment by rws created at 2014-12-04 14:44:49

Probably with symbolic series, only coefficients should be simplified in the `simplify*` functions.


---

Comment by rws created at 2015-01-13 16:52:53

There are no power series objects in Maxima, just conversion to infinite sums, i.e. formal power series:

```
sage: maxima.powerseries(x^2+1/(1-x),x,0)
'sum(_SAGE_VAR_x^i2,i2,0,inf)+_SAGE_VAR_x^2
sage: maxima.powerseries(x^2+1/(1-x),x,0).sage()
x^2 + sum(x^i3, i3, 0, +Infinity)
```

The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage:

```
sage: maxima.taylor(1+x+x^2+x^3,x,0,3)
1+_SAGE_VAR_x+_SAGE_VAR_x^2+_SAGE_VAR_x^3
sage: maxima.taylor(1+x+x^2+x^3,x,0,3).sage()
x^3 + x^2 + x + 1
```

so there is no way around it that `SR`.series will lose the order term when passed to Maxima. Thus only the coefficients may be simplified, and this must be done in or called from all `simplify*` functions.


---

Comment by rws created at 2015-01-13 17:08:11

The following functions call Maxima, have a meaning /wrt series, and therefore need to be modified:
`simplify`, `simplify_trig`, `simplify_rectform`, `simplify_rational`, `simplify_log`, `expand_log`, `expand_trig`.


---

Comment by rws created at 2015-01-23 17:39:20

Proof of concept.
----
New commits:


---

Comment by rws created at 2015-01-25 15:42:15

Squashed it all into one commit.
----
New commits:


---

Comment by rws created at 2015-01-25 15:42:15

Changing status from new to needs_review.


---

Comment by rws created at 2015-03-05 14:24:06

Squashed it all into one commit.
----
New commits:


---

Comment by rws created at 2015-04-20 15:50:15

Pending because #17659 is pending.


---

Comment by vbraun created at 2016-02-23 22:39:19

Still pending?
----
New commits:


---

Comment by rws created at 2016-02-24 06:17:14

No, you're right. Maybe there are conflicts with #17402.


---

Comment by vbraun created at 2016-03-05 22:58:34

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2016-03-05 22:58:34

Merge conflict, possibly with #20088


---

Comment by nbruin created at 2016-03-06 05:37:00

Replying to [comment:4 rws]:
> There are no power series objects in Maxima,
> [...]
> The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage
So there _are_ power series-type object in maxima. We could just access those then and use them to translate back-and-forth. It's a bit of a question how much functionality maxima has for it and whether maxima itself works with them faithfully.

The internal representation seems to be a bit complicated:

```
sage: P=maxima_calculus.taylor(exp(x),x,0,5)
sage: P
1+_SAGE_VAR_x+_SAGE_VAR_x^2/2+_SAGE_VAR_x^3/6+_SAGE_VAR_x^4/24+_SAGE_VAR_x^5/120
sage: P.ecl()
<ECL: ((MRAT SIMP (((MEXPT SIMP) $%E |$_SAGE_VAR_x|) |$_SAGE_VAR_x|)
  (#:|%e^_SAGE_VAR_x2396| #:|_SAGE_VAR_x2397|)
  ((|$_SAGE_VAR_x| ((5 . 1)) 0 NIL #:|_SAGE_VAR_x2397| . 2)) TRUNC)
 PS (#:|_SAGE_VAR_x2397| . 2) ((5 . 1)) ((0 . 1) 1 . 1) ((1 . 1) 1 . 1)
 ((2 . 1) 1 . 2) ((3 . 1) 1 . 6) ((4 . 1) 1 . 24) ((5 . 1) 1 . 120))>
```

but fundamentally everything is there to create/peel apart these objects.

(note that it would be a bit harder to work with these objects via the expect-interface to maxima)

A basic explanation of the MRAT format is here: [http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html](http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html)

*EDIT:* never mind, this isn't suitable for power series. This whole "TRUNC" property is very fickle (and it doesn't carry proper order information). It disappears with very trivial arithmetic already.


---

Comment by git created at 2016-08-03 13:14:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-08-03 13:16:28

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-09-22 07:02:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-11-28 07:03:54

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-11-28 07:03:54

Two doctests failing, see patchbot.
