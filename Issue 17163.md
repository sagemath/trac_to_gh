# Issue 17163: simplify_full returns odd result from symbolic series input

archive/issues_017163.json:
```json
{
    "body": "```\nsage: x=var('x')\nsage: s=(1/(1-x)).series(x,6)\nsage: s.coeffs()\n[[x^5 + x^4 + x^3 + x^2 + x + Order(x^6) + 1, 0]]\nsage: s.simplify_full().coeffs()\n[[Order(x^6) + 1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 5]]\n```\nSee also the related #17399.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17400\n\n",
    "created_at": "2014-11-26T10:08:06Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "simplify_full returns odd result from symbolic series input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17163",
    "user": "https://github.com/rwst"
}
```
```
sage: x=var('x')
sage: s=(1/(1-x)).series(x,6)
sage: s.coeffs()
[[x^5 + x^4 + x^3 + x^2 + x + Order(x^6) + 1, 0]]
sage: s.simplify_full().coeffs()
[[Order(x^6) + 1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 5]]
```
See also the related #17399.

Issue created by migration from https://trac.sagemath.org/ticket/17400





---

archive/issue_comments_227885.json:
```json
{
    "body": "Probably with symbolic series, only coefficients should be simplified in the `simplify*` functions.",
    "created_at": "2014-12-04T14:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227885",
    "user": "https://github.com/rwst"
}
```

Probably with symbolic series, only coefficients should be simplified in the `simplify*` functions.



---

archive/issue_comments_227886.json:
```json
{
    "body": "There are no power series objects in Maxima, just conversion to infinite sums, i.e. formal power series:\n\n```\nsage: maxima.powerseries(x^2+1/(1-x),x,0)\n'sum(_SAGE_VAR_x^i2,i2,0,inf)+_SAGE_VAR_x^2\nsage: maxima.powerseries(x^2+1/(1-x),x,0).sage()\nx^2 + sum(x^i3, i3, 0, +Infinity)\n```\nThe Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage:\n\n```\nsage: maxima.taylor(1+x+x^2+x^3,x,0,3)\n1+_SAGE_VAR_x+_SAGE_VAR_x^2+_SAGE_VAR_x^3\nsage: maxima.taylor(1+x+x^2+x^3,x,0,3).sage()\nx^3 + x^2 + x + 1\n```\nso there is no way around it that `SR`.series will lose the order term when passed to Maxima. Thus only the coefficients may be simplified, and this must be done in or called from all `simplify*` functions.",
    "created_at": "2015-01-13T16:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227886",
    "user": "https://github.com/rwst"
}
```

There are no power series objects in Maxima, just conversion to infinite sums, i.e. formal power series:

```
sage: maxima.powerseries(x^2+1/(1-x),x,0)
'sum(_SAGE_VAR_x^i2,i2,0,inf)+_SAGE_VAR_x^2
sage: maxima.powerseries(x^2+1/(1-x),x,0).sage()
x^2 + sum(x^i3, i3, 0, +Infinity)
```
The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage:

```
sage: maxima.taylor(1+x+x^2+x^3,x,0,3)
1+_SAGE_VAR_x+_SAGE_VAR_x^2+_SAGE_VAR_x^3
sage: maxima.taylor(1+x+x^2+x^3,x,0,3).sage()
x^3 + x^2 + x + 1
```
so there is no way around it that `SR`.series will lose the order term when passed to Maxima. Thus only the coefficients may be simplified, and this must be done in or called from all `simplify*` functions.



---

archive/issue_comments_227887.json:
```json
{
    "body": "The following functions call Maxima, have a meaning /wrt series, and therefore need to be modified:\n`simplify`, `simplify_trig`, `simplify_rectform`, `simplify_rational`, `simplify_log`, `expand_log`, `expand_trig`.",
    "created_at": "2015-01-13T17:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227887",
    "user": "https://github.com/rwst"
}
```

The following functions call Maxima, have a meaning /wrt series, and therefore need to be modified:
`simplify`, `simplify_trig`, `simplify_rectform`, `simplify_rational`, `simplify_log`, `expand_log`, `expand_trig`.



---

archive/issue_comments_227888.json:
```json
{
    "body": "Proof of concept.\n\n---\nNew commits:",
    "created_at": "2015-01-23T17:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227888",
    "user": "https://github.com/rwst"
}
```

Proof of concept.

---
New commits:



---

archive/issue_comments_227889.json:
```json
{
    "body": "Squashed it all into one commit.\n\n---\nNew commits:",
    "created_at": "2015-01-25T15:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227889",
    "user": "https://github.com/rwst"
}
```

Squashed it all into one commit.

---
New commits:



---

archive/issue_comments_227890.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-25T15:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227890",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227891.json:
```json
{
    "body": "Squashed it all into one commit.\n\n---\nNew commits:",
    "created_at": "2015-03-05T14:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227891",
    "user": "https://github.com/rwst"
}
```

Squashed it all into one commit.

---
New commits:



---

archive/issue_events_050110.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-05T14:24:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50110"
}
```



---

archive/issue_comments_227892.json:
```json
{
    "body": "Pending because #17659 is pending.",
    "created_at": "2015-04-20T15:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227892",
    "user": "https://github.com/rwst"
}
```

Pending because #17659 is pending.



---

archive/issue_events_050111.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T15:50:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50111"
}
```



---

archive/issue_events_050112.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T15:50:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50112"
}
```



---

archive/issue_comments_227893.json:
```json
{
    "body": "Still pending?\n\n---\nNew commits:",
    "created_at": "2016-02-23T22:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227893",
    "user": "https://github.com/vbraun"
}
```

Still pending?

---
New commits:



---

archive/issue_comments_227894.json:
```json
{
    "body": "No, you're right. Maybe there are conflicts with #17402.",
    "created_at": "2016-02-24T06:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227894",
    "user": "https://github.com/rwst"
}
```

No, you're right. Maybe there are conflicts with #17402.



---

archive/issue_events_050113.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-02-24T06:17:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50113"
}
```



---

archive/issue_events_050114.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-02-24T06:17:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50114"
}
```



---

archive/issue_comments_227895.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-05T22:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227895",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227896.json:
```json
{
    "body": "Merge conflict, possibly with #20088",
    "created_at": "2016-03-05T22:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227896",
    "user": "https://github.com/vbraun"
}
```

Merge conflict, possibly with #20088



---

archive/issue_comments_227897.json:
```json
{
    "body": "Replying to [comment:4 rws]:\n> There are no power series objects in Maxima,\n> [...]\n> The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage\n\nSo there *are* power series-type object in maxima. We could just access those then and use them to translate back-and-forth. It's a bit of a question how much functionality maxima has for it and whether maxima itself works with them faithfully.\n\nThe internal representation seems to be a bit complicated:\n\n```\nsage: P=maxima_calculus.taylor(exp(x),x,0,5)\nsage: P\n1+_SAGE_VAR_x+_SAGE_VAR_x^2/2+_SAGE_VAR_x^3/6+_SAGE_VAR_x^4/24+_SAGE_VAR_x^5/120\nsage: P.ecl()\n<ECL: ((MRAT SIMP (((MEXPT SIMP) $%E |$_SAGE_VAR_x|) |$_SAGE_VAR_x|)\n  (#:|%e^_SAGE_VAR_x2396| #:|_SAGE_VAR_x2397|)\n  ((|$_SAGE_VAR_x| ((5 . 1)) 0 NIL #:|_SAGE_VAR_x2397| . 2)) TRUNC)\n PS (#:|_SAGE_VAR_x2397| . 2) ((5 . 1)) ((0 . 1) 1 . 1) ((1 . 1) 1 . 1)\n ((2 . 1) 1 . 2) ((3 . 1) 1 . 6) ((4 . 1) 1 . 24) ((5 . 1) 1 . 120))>\n```\nbut fundamentally everything is there to create/peel apart these objects.\n\n(note that it would be a bit harder to work with these objects via the expect-interface to maxima)\n\nA basic explanation of the MRAT format is here: [http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html](http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html)\n\n**EDIT:** never mind, this isn't suitable for power series. This whole \"TRUNC\" property is very fickle (and it doesn't carry proper order information). It disappears with very trivial arithmetic already.",
    "created_at": "2016-03-06T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227897",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:4 rws]:
> There are no power series objects in Maxima,
> [...]
> The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage

So there *are* power series-type object in maxima. We could just access those then and use them to translate back-and-forth. It's a bit of a question how much functionality maxima has for it and whether maxima itself works with them faithfully.

The internal representation seems to be a bit complicated:

```
sage: P=maxima_calculus.taylor(exp(x),x,0,5)
sage: P
1+_SAGE_VAR_x+_SAGE_VAR_x^2/2+_SAGE_VAR_x^3/6+_SAGE_VAR_x^4/24+_SAGE_VAR_x^5/120
sage: P.ecl()
<ECL: ((MRAT SIMP (((MEXPT SIMP) $%E |$_SAGE_VAR_x|) |$_SAGE_VAR_x|)
  (#:|%e^_SAGE_VAR_x2396| #:|_SAGE_VAR_x2397|)
  ((|$_SAGE_VAR_x| ((5 . 1)) 0 NIL #:|_SAGE_VAR_x2397| . 2)) TRUNC)
 PS (#:|_SAGE_VAR_x2397| . 2) ((5 . 1)) ((0 . 1) 1 . 1) ((1 . 1) 1 . 1)
 ((2 . 1) 1 . 2) ((3 . 1) 1 . 6) ((4 . 1) 1 . 24) ((5 . 1) 1 . 120))>
```
but fundamentally everything is there to create/peel apart these objects.

(note that it would be a bit harder to work with these objects via the expect-interface to maxima)

A basic explanation of the MRAT format is here: [http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html](http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html)

**EDIT:** never mind, this isn't suitable for power series. This whole "TRUNC" property is very fickle (and it doesn't carry proper order information). It disappears with very trivial arithmetic already.



---

archive/issue_comments_227898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_050115.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-03T13:16:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50115"
}
```



---

archive/issue_events_050116.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-03T13:16:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17163#event-50116"
}
```



---

archive/issue_comments_227899.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-03T13:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227899",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-22T07:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227901.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-28T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227901",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227902.json:
```json
{
    "body": "Two doctests failing, see patchbot.",
    "created_at": "2017-11-28T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-227902",
    "user": "https://github.com/rwst"
}
```

Two doctests failing, see patchbot.
