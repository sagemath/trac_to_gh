# Issue 17163: simplify_full returns odd result from symbolic series input

archive/issues_017163.json:
```json
{
    "body": "\n```\nsage: x=var('x')\nsage: s=(1/(1-x)).series(x,6)\nsage: s.coeffs()\n[[x^5 + x^4 + x^3 + x^2 + x + Order(x^6) + 1, 0]]\nsage: s.simplify_full().coeffs()\n[[Order(x^6) + 1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 5]]\n```\n\nSee also the related #17399.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17400\n\n",
    "created_at": "2014-11-26T10:08:06Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "simplify_full returns odd result from symbolic series input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17163",
    "user": "@rwst"
}
```

```
sage: x=var('x')
sage: s=(1/(1-x)).series(x,6)
sage: s.coeffs()
[[x^5 + x^4 + x^3 + x^2 + x + Order(x^6) + 1, 0]]
sage: s.simplify_full().coeffs()
[[Order(x^6) + 1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 5]]
```

See also the related #17399.

Issue created by migration from https://trac.sagemath.org/ticket/17400





---

archive/issue_comments_228174.json:
```json
{
    "body": "Probably with symbolic series, only coefficients should be simplified in the `simplify*` functions.",
    "created_at": "2014-12-04T14:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228174",
    "user": "@rwst"
}
```

Probably with symbolic series, only coefficients should be simplified in the `simplify*` functions.



---

archive/issue_comments_228175.json:
```json
{
    "body": "There are no power series objects in Maxima, just conversion to infinite sums, i.e. formal power series:\n\n```\nsage: maxima.powerseries(x^2+1/(1-x),x,0)\n'sum(_SAGE_VAR_x^i2,i2,0,inf)+_SAGE_VAR_x^2\nsage: maxima.powerseries(x^2+1/(1-x),x,0).sage()\nx^2 + sum(x^i3, i3, 0, +Infinity)\n```\n\nThe Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage:\n\n```\nsage: maxima.taylor(1+x+x^2+x^3,x,0,3)\n1+_SAGE_VAR_x+_SAGE_VAR_x^2+_SAGE_VAR_x^3\nsage: maxima.taylor(1+x+x^2+x^3,x,0,3).sage()\nx^3 + x^2 + x + 1\n```\n\nso there is no way around it that `SR`.series will lose the order term when passed to Maxima. Thus only the coefficients may be simplified, and this must be done in or called from all `simplify*` functions.",
    "created_at": "2015-01-13T16:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228175",
    "user": "@rwst"
}
```

There are no power series objects in Maxima, just conversion to infinite sums, i.e. formal power series:

```
sage: maxima.powerseries(x^2+1/(1-x),x,0)
'sum(_SAGE_VAR_x^i2,i2,0,inf)+_SAGE_VAR_x^2
sage: maxima.powerseries(x^2+1/(1-x),x,0).sage()
x^2 + sum(x^i3, i3, 0, +Infinity)
```

The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage:

```
sage: maxima.taylor(1+x+x^2+x^3,x,0,3)
1+_SAGE_VAR_x+_SAGE_VAR_x^2+_SAGE_VAR_x^3
sage: maxima.taylor(1+x+x^2+x^3,x,0,3).sage()
x^3 + x^2 + x + 1
```

so there is no way around it that `SR`.series will lose the order term when passed to Maxima. Thus only the coefficients may be simplified, and this must be done in or called from all `simplify*` functions.



---

archive/issue_comments_228176.json:
```json
{
    "body": "The following functions call Maxima, have a meaning /wrt series, and therefore need to be modified:\n`simplify`, `simplify_trig`, `simplify_rectform`, `simplify_rational`, `simplify_log`, `expand_log`, `expand_trig`.",
    "created_at": "2015-01-13T17:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228176",
    "user": "@rwst"
}
```

The following functions call Maxima, have a meaning /wrt series, and therefore need to be modified:
`simplify`, `simplify_trig`, `simplify_rectform`, `simplify_rational`, `simplify_log`, `expand_log`, `expand_trig`.



---

archive/issue_comments_228177.json:
```json
{
    "body": "Proof of concept.\n----\nNew commits:",
    "created_at": "2015-01-23T17:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228177",
    "user": "@rwst"
}
```

Proof of concept.
----
New commits:



---

archive/issue_comments_228178.json:
```json
{
    "body": "Squashed it all into one commit.\n----\nNew commits:",
    "created_at": "2015-01-25T15:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228178",
    "user": "@rwst"
}
```

Squashed it all into one commit.
----
New commits:



---

archive/issue_comments_228179.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-25T15:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228179",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_228180.json:
```json
{
    "body": "Squashed it all into one commit.\n----\nNew commits:",
    "created_at": "2015-03-05T14:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228180",
    "user": "@rwst"
}
```

Squashed it all into one commit.
----
New commits:



---

archive/issue_comments_228181.json:
```json
{
    "body": "Pending because #17659 is pending.",
    "created_at": "2015-04-20T15:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228181",
    "user": "@rwst"
}
```

Pending because #17659 is pending.



---

archive/issue_comments_228182.json:
```json
{
    "body": "Still pending?\n----\nNew commits:",
    "created_at": "2016-02-23T22:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228182",
    "user": "@vbraun"
}
```

Still pending?
----
New commits:



---

archive/issue_comments_228183.json:
```json
{
    "body": "No, you're right. Maybe there are conflicts with #17402.",
    "created_at": "2016-02-24T06:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228183",
    "user": "@rwst"
}
```

No, you're right. Maybe there are conflicts with #17402.



---

archive/issue_comments_228184.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-05T22:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228184",
    "user": "@vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_228185.json:
```json
{
    "body": "Merge conflict, possibly with #20088",
    "created_at": "2016-03-05T22:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228185",
    "user": "@vbraun"
}
```

Merge conflict, possibly with #20088



---

archive/issue_comments_228186.json:
```json
{
    "body": "Replying to [comment:4 rws]:\n> There are no power series objects in Maxima,\n> [...]\n> The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage\nSo there *are* power series-type object in maxima. We could just access those then and use them to translate back-and-forth. It's a bit of a question how much functionality maxima has for it and whether maxima itself works with them faithfully.\n\nThe internal representation seems to be a bit complicated:\n\n```\nsage: P=maxima_calculus.taylor(exp(x),x,0,5)\nsage: P\n1+_SAGE_VAR_x+_SAGE_VAR_x^2/2+_SAGE_VAR_x^3/6+_SAGE_VAR_x^4/24+_SAGE_VAR_x^5/120\nsage: P.ecl()\n<ECL: ((MRAT SIMP (((MEXPT SIMP) $%E |$_SAGE_VAR_x|) |$_SAGE_VAR_x|)\n  (#:|%e^_SAGE_VAR_x2396| #:|_SAGE_VAR_x2397|)\n  ((|$_SAGE_VAR_x| ((5 . 1)) 0 NIL #:|_SAGE_VAR_x2397| . 2)) TRUNC)\n PS (#:|_SAGE_VAR_x2397| . 2) ((5 . 1)) ((0 . 1) 1 . 1) ((1 . 1) 1 . 1)\n ((2 . 1) 1 . 2) ((3 . 1) 1 . 6) ((4 . 1) 1 . 24) ((5 . 1) 1 . 120))>\n```\n\nbut fundamentally everything is there to create/peel apart these objects.\n\n(note that it would be a bit harder to work with these objects via the expect-interface to maxima)\n\nA basic explanation of the MRAT format is here: [http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html](http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html)\n\n**EDIT:** never mind, this isn't suitable for power series. This whole \"TRUNC\" property is very fickle (and it doesn't carry proper order information). It disappears with very trivial arithmetic already.",
    "created_at": "2016-03-06T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228186",
    "user": "@nbruin"
}
```

Replying to [comment:4 rws]:
> There are no power series objects in Maxima,
> [...]
> The Taylor series objects have an order parameter on creation, but this does not get output or translated to Sage
So there *are* power series-type object in maxima. We could just access those then and use them to translate back-and-forth. It's a bit of a question how much functionality maxima has for it and whether maxima itself works with them faithfully.

The internal representation seems to be a bit complicated:

```
sage: P=maxima_calculus.taylor(exp(x),x,0,5)
sage: P
1+_SAGE_VAR_x+_SAGE_VAR_x^2/2+_SAGE_VAR_x^3/6+_SAGE_VAR_x^4/24+_SAGE_VAR_x^5/120
sage: P.ecl()
<ECL: ((MRAT SIMP (((MEXPT SIMP) $%E |$_SAGE_VAR_x|) |$_SAGE_VAR_x|)
  (#:|%e^_SAGE_VAR_x2396| #:|_SAGE_VAR_x2397|)
  ((|$_SAGE_VAR_x| ((5 . 1)) 0 NIL #:|_SAGE_VAR_x2397| . 2)) TRUNC)
 PS (#:|_SAGE_VAR_x2397| . 2) ((5 . 1)) ((0 . 1) 1 . 1) ((1 . 1) 1 . 1)
 ((2 . 1) 1 . 2) ((3 . 1) 1 . 6) ((4 . 1) 1 . 24) ((5 . 1) 1 . 120))>
```

but fundamentally everything is there to create/peel apart these objects.

(note that it would be a bit harder to work with these objects via the expect-interface to maxima)

A basic explanation of the MRAT format is here: [http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html](http://def.fe.up.pt/pipermail/maxima-discuss/2005/010416.html)

**EDIT:** never mind, this isn't suitable for power series. This whole "TRUNC" property is very fickle (and it doesn't carry proper order information). It disappears with very trivial arithmetic already.



---

archive/issue_comments_228187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228187",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228188.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-03T13:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228188",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_228189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-22T07:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228189",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228190.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-28T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228190",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_228191.json:
```json
{
    "body": "Two doctests failing, see patchbot.",
    "created_at": "2017-11-28T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17163#issuecomment-228191",
    "user": "@rwst"
}
```

Two doctests failing, see patchbot.
