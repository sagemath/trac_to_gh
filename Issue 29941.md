# Issue 29941: Adding Orientibility and Compactness

Issue created by migration from https://trac.sagemath.org/ticket/30178

Original creator: @mjungmath

Original creation time: 2020-07-20 11:49:42

CC:  egourgoulhon tscrim mkoeppe slelievre @tobiasdiez

It would be good if one can state whether a manifold is compact and/or orientable as some statements only apply for these kind of manifolds. Of course, at the end it will be, except for very trivial cases, the user's responsibility that the conditions are actually satisfied.


---

Comment by @mjungmath created at 2020-07-20 15:54:40

**Regarding orientability:**

One could add a method `set_orientation` which takes a list of charts or frames which cover the manifold yielding an orientation. Then it is the user's responsibility to check that this is indeed an orientation. Using this, one can construct things like volume forms etc.

In very easy cases, like if the manifold is covered by only one chart, one can give the orientation right away.

_Remark:_ Notice that the volume form returned by [sage.manifolds.differentiable.metric.PseudoRiemannianMetric.volume_form](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/metric.html#sage.manifolds.differentiable.metric.PseudoRiemannianMetric.volume_form) does not necessarily yield a volume form at all. One indeed needs an oriented atlas. Otherwise, the gluing process could be messed up. This can all be prevented and covered by my proposal above.

**Regarding Compactness:**

I think, the best way would be to state compactness right from the beginning. Not stating compactness should, in my opinion, not exclude compactness. Maybe a new manifold class does a suitable job?


---

Comment by @mjungmath created at 2020-07-21 12:19:28

In the differentiable setting, things are easy and can be managed by using frames. This is quite convenient because there are manifolds which can be covered by one global frame, and therefore admit an orientation, but need at least two charts.

However, I know that there is a notion of orientability in the topological setting, where the use of charts is mandatory. I look for further literature.

I would prefer the chart version because it is applicable to both, topological and differentiable manifolds. Because the former case is easier and more practical, one could also implement orientations only for differentiable manifolds at first. Further opinions on that?

**Addendum:** If someone has an idea of how both cases, charts and frames, can be managed conveniently, I welcome that pretty much.


---

Comment by @mjungmath created at 2020-07-21 13:25:06

I have added a first draft (without documentation). I wait for your opinions before I go on.
----
New commits:


---

Comment by mkoeppe created at 2020-07-27 00:12:16

Just a quick note that there is already an axiom `Compact` provided by `TopologicalSpaces`.


---

Comment by git created at 2020-07-29 18:01:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-29 19:22:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-30 19:03:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-07-30 19:05:22

Changing status from new to needs_review.


---

Comment by @mjungmath created at 2020-07-30 19:07:15

I forgot the authorship...again.


---

Comment by git created at 2020-07-31 10:37:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-31 10:39:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-31 10:44:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-01 07:06:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-05 12:06:13

Patchbot won't go green, startup issues. Can one force another patchbot check?


---

Comment by tscrim created at 2020-08-06 05:02:52

There was a green patchbot run (also that plugin can be a bit more fickle).


---

Comment by @mjungmath created at 2020-08-06 07:34:32

Ah yes, on beta6. Anyway, this ticket is ready for review. :)


---

Comment by tscrim created at 2020-08-08 01:10:52

In response to your questions/comments from comment:2: I think it should just be the user's responsibility as it would be too costly and annoying to include code to check this. Trusting the usuer is done in a number of places in Sage too. As Matthias said, you can use `Manifolds(R).Compact()` to indicate compactness.

A few stylistic things:

You are saving 1 character here

```
            from sage.manifolds.differentiable.vector_bundle \
                                                            import TensorBundle
```

Just go over the 80 char/line limit; it makes it much more readable.

Similar for these changes:

```diff
             sage: repr(TM) # indirect doctest
-            'Tangent bundle TM over the 2-dimensional differentiable manifold M'
+            'Tangent bundle TM over the 2-dimensional differentiable
+             manifold M'
             sage: TM._repr_()
-            'Tangent bundle TM over the 2-dimensional differentiable manifold M'
+            'Tangent bundle TM over the 2-dimensional differentiable
+             manifold M'
```


Further indent the last line on this change and all other similar changes:

```diff
             {(Chart (M, (x, y)),
-              Chart (M, (u, v))): Change of coordinates from Chart (M, (x, y)) to Chart (M, (u, v))}
+              Chart (M, (u, v))): Change of coordinates from Chart (M, (x, y))
+              to Chart (M, (u, v))}
```

to make it (more) clear that it is associated to that item.


---

Comment by @mjungmath created at 2020-08-08 07:14:15

Replying to [comment:22 tscrim]:
> In response to your questions/comments from comment:2: I think it should just be the user's responsibility as it would be too costly and annoying to include code to check this. Trusting the usuer is done in a number of places in Sage too. As Matthias said, you can use `Manifolds(R).Compact()` to indicate compactness.

Right. There are many tickets going on simultaneously. I have to catch them up first.

> 
> A few stylistic things:
> 
> You are saving 1 character here
> {{{
>             from sage.manifolds.differentiable.vector_bundle \
>                                                             import TensorBundle
> }}}
> Just go over the 80 char/line limit; it makes it much more readable.
> 
> Similar for these changes:
> {{{#!diff
>              sage: repr(TM) # indirect doctest
> -            'Tangent bundle TM over the 2-dimensional differentiable manifold M'
> +            'Tangent bundle TM over the 2-dimensional differentiable
> +             manifold M'
>              sage: TM._repr_()
> -            'Tangent bundle TM over the 2-dimensional differentiable manifold M'
> +            'Tangent bundle TM over the 2-dimensional differentiable
> +             manifold M'
> }}}
> 
> Further indent the last line on this change and all other similar changes:
> {{{#!diff
>              {(Chart (M, (x, y)),
> -              Chart (M, (u, v))): Change of coordinates from Chart (M, (x, y)) to Chart (M, (u, v))}
> +              Chart (M, (u, v))): Change of coordinates from Chart (M, (x, y))
> +              to Chart (M, (u, v))}
> }}}
> to make it (more) clear that it is associated to that item.

Mh, okay. Well, I followed the PEP8 guidelines which indicates 79 characters per line: https://www.python.org/dev/peps/pep-0008/#maximum-line-length


---

Comment by @mjungmath created at 2020-08-08 09:01:42

Apparently, the guidelines have changed a couple of years ago. The PEP8 guidelines are linked in the [Sage reference](https://doc.sagemath.org/html/en/developer/coding_basics.html#sage-documentation-style) but their recommendations have not been updated.


---

Comment by tscrim created at 2020-08-08 11:58:47

PEP8 sets guidelines, but code readability is the most important thing. Each of those changes makes it harder to read the code.


---

Comment by @mjungmath created at 2020-08-08 12:06:39

Replying to [comment:25 tscrim]:
> PEP8 sets guidelines, but code readability is the most important thing. Each of those changes makes it harder to read the code.

Fair enough, I'll change it back. Thanks.


---

Comment by git created at 2020-08-08 12:41:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-08 12:45:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-08 12:45:58

Like this?


---

Comment by tscrim created at 2020-08-08 12:48:08

Yes, except I think you are better off leaving this alone:

```
from sage.manifolds.differentiable.vector_bundle import TensorBundle
```

(i.e., on one line).


---

Comment by git created at 2020-08-08 13:01:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-08 13:01:30

Satisfied? :)


---

Comment by @mjungmath created at 2020-08-08 15:57:26

Patchbot is green.


---

Comment by tscrim created at 2020-08-08 23:10:12

Yes, thank you. However, I do have a few other comments from another read-over. However, these should be the last of them.

The `keys()` call here

```
for frame in base_space._get_min_covering(connection._coefficients.keys()):
```

seem like it is not needed.


```diff
         INPUT:
 
-        - an orientation; either a chart / list of charts, or a vector frame /
+        - ``orientation`` -- either a chart / list of charts, or a vector frame /
           list of vector frames, covering ``self``
```

and similar.

This

```
        .. NOTE::

            This assumes that the manifold admits an orientation, see
            :meth:`~sage.manifolds.manifold.DifferentiableManifold.orientation`
            for details.
```

in `volume_form()` (in `differentiable/metric.py`) is wrong. An error is raised if the manifold does not admit an orientation. Subsequently in `hodge_star` as well.

In `set_orientation` is it the default orientation or simply the orientation? I don't think you allow multiple orientations on a manifold. Is that a planned future feature?

`# set a priori no orientation` -> `# default is no orientation` (or `# set no orientation a priori`)


```diff
-        if self.orientation():
-            return True
-        return False
+        return bool(self.orientation())
```



---

Comment by @mjungmath created at 2020-08-09 05:42:27

Replying to [comment:34 tscrim]:
> Yes, thank you. However, I do have a few other comments from another read-over. However, these should be the last of them.
> 
> The `keys()` call here
> {{{
> for frame in base_space._get_min_covering(connection._coefficients.keys()):
> }}}
> seem like it is not needed.

Ah yes. Thank you. 

> 
> {{{#!diff
>          INPUT:
>  
> -        - an orientation; either a chart / list of charts, or a vector frame /
> +        - ``orientation`` -- either a chart / list of charts, or a vector frame /
>            list of vector frames, covering ``self``
> }}}
> and similar.

Good. Thanks.

> 
> This
> {{{
>         .. NOTE::
> 
>             This assumes that the manifold admits an orientation, see
>             :meth:`~sage.manifolds.manifold.DifferentiableManifold.orientation`
>             for details.
> }}}
> in `volume_form()` (in `differentiable/metric.py`) is wrong. An error is raised if the manifold does not admit an orientation. Subsequently in `hodge_star` as well.

You mean wrong in the sense that we should note that having no orientation means this feature is not available? 

> 
> In `set_orientation` is it the default orientation or simply the orientation? I don't think you allow multiple orientations on a manifold. Is that a planned future feature?

I cannot think of a case where a manifold has _the_ orientation. Allowing multiple orientations means also allowing multiple volume forms. But which one then to choose for `hodge_star`? I think it is reasonable to fix just one orientation. 

>
> `# set a priori no orientation` -> `# default is no orientation` (or `# set no orientation a priori`)
> 
> {{{#!diff
> -        if self.orientation():
> -            return True
> -        return False
> +        return bool(self.orientation())
> }}}

Good. Already done.


---

Comment by tscrim created at 2020-08-09 05:52:00

Replying to [comment:35 gh-mjungmath]:
> Replying to [comment:34 tscrim]:
> > 
> > This
> > {{{
> >         .. NOTE::
> > 
> >             This assumes that the manifold admits an orientation, see
> >             :meth:`~sage.manifolds.manifold.DifferentiableManifold.orientation`
> >             for details.
> > }}}
> > in `volume_form()` (in `differentiable/metric.py`) is wrong. An error is raised if the manifold does not admit an orientation. Subsequently in `hodge_star` as well.
> 
> You mean wrong in the sense that we should note that having no orientation means this feature is not available? 

No, as in there is not an assumption being made. If it has not been defined, an error is raised rather than assuming that the manifold admits an orientation (and using that implicit orientation).

> > In `set_orientation` is it the default orientation or simply the orientation? I don't think you allow multiple orientations on a manifold. Is that a planned future feature?
> 
> I cannot think of a case where a manifold has _the_ orientation. Allowing multiple orientations means also allowing multiple volume forms. But which one then to choose for `hodge_star`? I think it is reasonable to fix just one orientation. 

I know there are multiple orientations possible for a manifold, but there is a set orientation for the manifold. There is not a default one where a user can arbitrarily choose another as an input. Contrast this with charts. I would think of this like a manifold with a distinguished orientation (which can be changed later on, but the manifold has still indicated the one orientation to rule them all).


---

Comment by @mjungmath created at 2020-08-09 10:44:38

Okay, I will call it "preferred" orientation instead. It would be good if, in the trivial case, the default chart/frame is used. While applying this, I discovered a bug (see #30320).


---

Comment by git created at 2020-08-09 12:37:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-09 12:40:22

See my new push. This approach is independent of #30320.


---

Comment by tscrim created at 2020-08-09 23:26:35

Just to be clear, as long as you raise an error when there is no orientation, you need to remove that `.. NOTE::` because it is wrong. No assumption is made as an explicit check is performed.


---

Comment by @mjungmath created at 2020-08-10 07:18:02

Replying to [comment:40 tscrim]:
> Just to be clear, as long as you raise an error when there is no orientation, you need to remove that `.. NOTE::` because it is wrong. No assumption is made as an explicit check is performed.

Ah, it's just about the note block. I'll remove it.


---

Comment by git created at 2020-08-10 07:59:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-10 08:01:49

Is this better? If not, could you please suggest an improvement, because then I don't know what you mean.


---

Comment by tscrim created at 2020-08-10 08:15:46

That is perfect, thank you.


---

Comment by tscrim created at 2020-08-10 08:15:46

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2020-08-10 08:19:47

Okay good. Thank you for the review and your patience. :)


---

Comment by vbraun created at 2020-08-10 22:52:32

Merge conflict


---

Comment by vbraun created at 2020-08-10 22:52:32

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-08-10 22:59:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-10 23:05:59

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-08-10 23:06:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-14 22:23:41

Resolution: fixed


---

Comment by egourgoulhon created at 2020-09-06 20:22:09

See #30519 for a follow up.
