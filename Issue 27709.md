# Issue 27709: libgap: distinct __str__ and __repr__ for GapElements

Issue created by migration from https://trac.sagemath.org/ticket/27946

Original creator: embray

Original creation time: 2019-06-07 14:29:01

CC:  nthiery

Keywords: gap libgap

Currently the `libgap.GapElement` objects have a `__repr__` (but no explicit `__str__`, so the two are the same) which is taken from calling the GAP function `ViewObj` on the object and capturing and returning the result.  This is essentially the same as when you display the object in a GAP interpreter prompt without using `Print()`, such as:


```
gap> a := "hello";
"hello"
gap> a;
"hello"
```


Although GAP has many options for displaying/printing variables, this makes `ViewObj` the closest possible thing to the `__repr__` method on Python objects, which is called in similar circumstances:


```
>>> a = "hello"
>>> a
"hello"
```


This is in stark contrast with the pexpect interface's `GapElement` which (through a sequence of calls) effectively implements its `__repr__` by calling `Print(obj)`.  Arguably this was not the best choice, but changing it might be tricky at this point.  However, it does not explicitly implement `__str__`, so `GapElement.__str__` does give a sensible result in this case.

Arguably `Print(obj)` is the right choice for `__str__` since again in rough comparison with Python, when you `print(...)` an object in Python its `__str__` is called.

This proposes to change just the libgap interface to meet this specification: `libgap.GapElement.__str__` captures the output of `Print(obj)` and returns it.  While `libgap.GapElement.__repr__` captures and returns the output of `ViewObj(obj)`.

This gives the best of both worlds, and better consistency in _most_ contexts where GapElements are converted to strings, making replacing pexpect gap with libgap easier and less disruptive.


---

Comment by embray created at 2019-06-07 14:30:53

Here is a branch for this specific change that I extracted from the rest of my work on #18267, since this change is worth considering in its own right.  Still needs a bit more testing to ensure it didn't inadvertently break any other tests.
----
New commits:


---

Comment by embray created at 2019-06-07 14:30:53

Changing status from new to needs_review.


---

Comment by embray created at 2019-06-07 17:19:56

Works without test failures for me.


---

Comment by vdelecroix created at 2019-06-08 12:19:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-06-27 20:13:09

Resolution: fixed


---

Comment by embray created at 2019-07-03 11:34:48

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were _actually_ included, especially when closing tickets.
