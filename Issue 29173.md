# Issue 29173: Addition of some difference matrices and all related objects

archive/issues_029173.json:
```json
{
    "body": "CC:  @dimpase @slel\n\nKeywords: symmetric_nets orthogonal_arrays transversal_designs difference_matrices\n\nI added a few constructions of difference matrices whose \\lambda parameter is not 1.\nI then modified the orthogonal arrays and transversal designs constructions to take advantage of my additions. Finally, I added a new function symmetric_net.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29410\n\n",
    "created_at": "2020-03-26T18:43:45Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Addition of some difference matrices and all related objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29173",
    "user": "https://github.com/Ivo-Maffei"
}
```
CC:  @dimpase @slel

Keywords: symmetric_nets orthogonal_arrays transversal_designs difference_matrices

I added a few constructions of difference matrices whose \lambda parameter is not 1.
I then modified the orthogonal arrays and transversal designs constructions to take advantage of my additions. Finally, I added a new function symmetric_net.

Issue created by migration from https://trac.sagemath.org/ticket/29410





---

archive/issue_comments_412778.json:
```json
{
    "body": "I see failing doctests:\n\n```\nsage -t --warn-long 94.4 src/sage/combinat/designs/latin_squares.py  # 2 doctests failed\nsage -t --warn-long 94.4 src/sage/combinat/designs/designs_pyx.pyx  # 3 doctests failed\n```\n",
    "created_at": "2020-04-07T18:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412778",
    "user": "https://github.com/dimpase"
}
```

I see failing doctests:

```
sage -t --warn-long 94.4 src/sage/combinat/designs/latin_squares.py  # 2 doctests failed
sage -t --warn-long 94.4 src/sage/combinat/designs/designs_pyx.pyx  # 3 doctests failed
```




---

archive/issue_comments_412779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-07T21:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412780.json:
```json
{
    "body": "Do you run tests using [GitHub](GitHub) Actions? (see #29401 for details)\n\nIn your code, to build docs, one needs\n\n```diff\n--- a/src/sage/combinat/designs/orthogonal_arrays.py\n+++ b/src/sage/combinat/designs/orthogonal_arrays.py\n@@ -80,10 +80,10 @@ def symmetric_net(n, lmbda=1, check=True, existence=False):\n       Set to ``True`` by default\n \n     - ``existence`` -- bolean. Instead of returnig a symmetric net, return:\n-      - ``True`` -- such a net can be constructed by Sage\n-      - ``False`` -- no such a net exists\n-      - ``Unknown`` -- Sage does not know how to build such a design\n-        so such design may or may not exist\n+        - ``True`` -- such a net can be constructed by Sage\n+        - ``False`` -- no such a net exists\n+        - ``Unknown`` -- Sage does not know how to build such a design\n+          so such design may or may not exist\n \n     EXAMPLES::\n\n--- a/src/sage/combinat/designs/difference_matrices.py\n+++ b/src/sage/combinat/designs/difference_matrices.py\n@@ -428,9 +428,9 @@ def subgroup_construction(g,k,lmbda,existence=False):\n     - ``g,k,\\lambda`` -- (integers) parameters of the difference matrix to construct\n \n     - ``existence`` -- (boolean) instead of building the design, return:\n-      - ``True`` if Sage can build the difference matrix using the subgroup construction\n-      - ``False`` if Sage can't build the difference matrix using this construction\n-         Note that Sage may be able to build such difference matrix in other ways\n+        - ``True`` if Sage can build the difference matrix using the subgroup construction\n+        - ``False`` if Sage can't build the difference matrix using this construction\n+          Note that Sage may be able to build such difference matrix in other ways\n \n     EXAMPLES::\n \n\n```\n\n\n(sphinx is very sensitive to correct indentation)",
    "created_at": "2020-04-13T09:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412780",
    "user": "https://github.com/dimpase"
}
```

Do you run tests using [GitHub](GitHub) Actions? (see #29401 for details)

In your code, to build docs, one needs

```diff
--- a/src/sage/combinat/designs/orthogonal_arrays.py
+++ b/src/sage/combinat/designs/orthogonal_arrays.py
@@ -80,10 +80,10 @@ def symmetric_net(n, lmbda=1, check=True, existence=False):
       Set to ``True`` by default
 
     - ``existence`` -- bolean. Instead of returnig a symmetric net, return:
-      - ``True`` -- such a net can be constructed by Sage
-      - ``False`` -- no such a net exists
-      - ``Unknown`` -- Sage does not know how to build such a design
-        so such design may or may not exist
+        - ``True`` -- such a net can be constructed by Sage
+        - ``False`` -- no such a net exists
+        - ``Unknown`` -- Sage does not know how to build such a design
+          so such design may or may not exist
 
     EXAMPLES::

--- a/src/sage/combinat/designs/difference_matrices.py
+++ b/src/sage/combinat/designs/difference_matrices.py
@@ -428,9 +428,9 @@ def subgroup_construction(g,k,lmbda,existence=False):
     - ``g,k,\lambda`` -- (integers) parameters of the difference matrix to construct
 
     - ``existence`` -- (boolean) instead of building the design, return:
-      - ``True`` if Sage can build the difference matrix using the subgroup construction
-      - ``False`` if Sage can't build the difference matrix using this construction
-         Note that Sage may be able to build such difference matrix in other ways
+        - ``True`` if Sage can build the difference matrix using the subgroup construction
+        - ``False`` if Sage can't build the difference matrix using this construction
+          Note that Sage may be able to build such difference matrix in other ways
 
     EXAMPLES::
 

```


(sphinx is very sensitive to correct indentation)



---

archive/issue_comments_412781.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412781",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_412782.json:
```json
{
    "body": "One occurrence of \"more than 1 time\" should be \"more than once\" as elsewhere.\n\nCan you do a round of pep8 formatting?\n\nI would use `lamda` as an alternate name for lambda\n(since lambda is a reserved keyword in Python).\nI find it makes code easier to read than lambd or lmbda.",
    "created_at": "2020-06-19T10:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412782",
    "user": "https://github.com/slel"
}
```

One occurrence of "more than 1 time" should be "more than once" as elsewhere.

Can you do a round of pep8 formatting?

I would use `lamda` as an alternate name for lambda
(since lambda is a reserved keyword in Python).
I find it makes code easier to read than lambd or lmbda.



---

archive/issue_comments_412783.json:
```json
{
    "body": "Replying to [comment:5 slelievre]:\n>\n> I would use `lamda` as an alternate name for lambda\n\nAnother option is `la` which I like too.",
    "created_at": "2020-06-19T10:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412783",
    "user": "https://github.com/slel"
}
```

Replying to [comment:5 slelievre]:
>
> I would use `lamda` as an alternate name for lambda

Another option is `la` which I like too.



---

archive/issue_comments_412784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-23T17:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412785.json:
```json
{
    "body": "I did some more work on the \"subgroup_construction\" method and added support for GAP groups in other places.\nSage's tests pass and the documentation builds without errors. However, I've probably missed some formatting issues here and there.\n\n`lmbda` is the keyword used throughout the \"designs_pyx.pyx\" and the \"difference_matrices.py\" files. I introduced it only in the \"orthogonal_arrays.py\" file. If it bothers you, then I'll change it in all three files as I believe it should be consistent across them.\n\nFinally, the definition of difference matrices in the doctoring doesn't seem right and needs some checking.",
    "created_at": "2020-06-23T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412785",
    "user": "https://github.com/Ivo-Maffei"
}
```

I did some more work on the "subgroup_construction" method and added support for GAP groups in other places.
Sage's tests pass and the documentation builds without errors. However, I've probably missed some formatting issues here and there.

`lmbda` is the keyword used throughout the "designs_pyx.pyx" and the "difference_matrices.py" files. I introduced it only in the "orthogonal_arrays.py" file. If it bothers you, then I'll change it in all three files as I believe it should be consistent across them.

Finally, the definition of difference matrices in the doctoring doesn't seem right and needs some checking.



---

archive/issue_comments_412786.json:
```json
{
    "body": "I looked into the definition of difference matrices.\\\\\nThe book \"Design Theory\" by Beth et. al. (Cambridge University Press, 1999) defines a `(g, k, \\lambda)` difference matrix as a `k \\times \\lambda g` matrix such that for any two distinct rows `R_i, R_j` each element of `G` appears `\\lambda` times in the sequence `(R_i[l]-R_j[l])`. This is basically, the definition given in the docstring, but the dimensions of the matrix are flipped (hence the docstring is wrong).\\\\\nThe docstring in `is_difference_matrix`, gives the same definition without specifying the dimensions.\nWhat the codes actually do is redirecting the call to `is_quasi_difference_matrix` which, in this specific case, checks that in any 2  __columns__ `C_i, C_j` each element of `G` appears `\\lambda` times in the sequence `(C_i[l] - C_j[l])`. However we need `G` to be Abelian since the code doesn't check both `C_i - C_j` and `C_j - C_i`.\n\nSo there are 2 issues to fix:\n1. change the docstring of difference matrices to use columns or change the code by taking transposes when needed;\n2. limit difference matrices to Abelian groups or change the `is_quasi_difference_matrix` function to allow for non-Abelian groups\n\nPersonally, I would change the docstring for the difference matrices so that it matches the definition of quasi-difference matrices and then change the code of `is_quasi_difference_matrix` to allow for non-Abelian groups. Are there any reasons I should not go this way?",
    "created_at": "2020-06-24T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412786",
    "user": "https://github.com/Ivo-Maffei"
}
```

I looked into the definition of difference matrices.\\
The book "Design Theory" by Beth et. al. (Cambridge University Press, 1999) defines a `(g, k, \lambda)` difference matrix as a `k \times \lambda g` matrix such that for any two distinct rows `R_i, R_j` each element of `G` appears `\lambda` times in the sequence `(R_i[l]-R_j[l])`. This is basically, the definition given in the docstring, but the dimensions of the matrix are flipped (hence the docstring is wrong).\\
The docstring in `is_difference_matrix`, gives the same definition without specifying the dimensions.
What the codes actually do is redirecting the call to `is_quasi_difference_matrix` which, in this specific case, checks that in any 2  __columns__ `C_i, C_j` each element of `G` appears `\lambda` times in the sequence `(C_i[l] - C_j[l])`. However we need `G` to be Abelian since the code doesn't check both `C_i - C_j` and `C_j - C_i`.

So there are 2 issues to fix:
1. change the docstring of difference matrices to use columns or change the code by taking transposes when needed;
2. limit difference matrices to Abelian groups or change the `is_quasi_difference_matrix` function to allow for non-Abelian groups

Personally, I would change the docstring for the difference matrices so that it matches the definition of quasi-difference matrices and then change the code of `is_quasi_difference_matrix` to allow for non-Abelian groups. Are there any reasons I should not go this way?



---

archive/issue_comments_412787.json:
```json
{
    "body": "do you meanwhile have non-trivial examples of difference sets for non-abelian groups?",
    "created_at": "2020-06-25T12:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412787",
    "user": "https://github.com/dimpase"
}
```

do you meanwhile have non-trivial examples of difference sets for non-abelian groups?



---

archive/issue_comments_412788.json:
```json
{
    "body": "I think changing the docstring is the obvious best option - as it does not break any code.\n\nIn the non-abelian case, do you still use additive notation for the group? This is unusual,\nperhaps needs commenting...",
    "created_at": "2020-06-25T12:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412788",
    "user": "https://github.com/dimpase"
}
```

I think changing the docstring is the obvious best option - as it does not break any code.

In the non-abelian case, do you still use additive notation for the group? This is unusual,
perhaps needs commenting...



---

archive/issue_comments_412789.json:
```json
{
    "body": "While there exist non-abelian difference sets (e.g. http://mathonline.wikidot.com/difference-sets-in-non-abelian-groups), the `difference_family` function explicitly states that it only returns difference families for abelian groups.\n\nAs far as the notation is concerned, it seems standard to use `+` and `-` for difference matrices despite I haven't found any definition that restricts to abelian groups. If we end up allowing non-abelian groups, then I'll add a note in the docstrings.",
    "created_at": "2020-06-25T13:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412789",
    "user": "https://github.com/Ivo-Maffei"
}
```

While there exist non-abelian difference sets (e.g. http://mathonline.wikidot.com/difference-sets-in-non-abelian-groups), the `difference_family` function explicitly states that it only returns difference families for abelian groups.

As far as the notation is concerned, it seems standard to use `+` and `-` for difference matrices despite I haven't found any definition that restricts to abelian groups. If we end up allowing non-abelian groups, then I'll add a note in the docstrings.



---

archive/issue_comments_412790.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29173#issuecomment-412790",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
