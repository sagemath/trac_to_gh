# Issue 11979: Bug in global_integral_model for elliptic curves over number fields

archive/issues_011979.json:
```json
{
    "body": "Assignee: @JohnCremona\n\n\n```\nsage: K.<v> = NumberField(x^2 + 161*x - 150)\nsage: E = EllipticCurve([25105/216*v - 3839/36, 634768555/7776*v - 98002625/1296, 634768555/7776*v - 98002625/1296, 0, 0])\nsage: E.global_integral_model()\n...\nAssertionError: bug in global_integral_model: [-511235417/8*v + 238969025/4, 789861012140869185/32*v - 365842578320087625/16, -434331620876169353603835/32*v + 201170993209979865073875/16, 0, 0]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12151\n\n",
    "created_at": "2011-12-13T15:54:28Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Bug in global_integral_model for elliptic curves over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11979",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```
Assignee: @JohnCremona


```
sage: K.<v> = NumberField(x^2 + 161*x - 150)
sage: E = EllipticCurve([25105/216*v - 3839/36, 634768555/7776*v - 98002625/1296, 634768555/7776*v - 98002625/1296, 0, 0])
sage: E.global_integral_model()
...
AssertionError: bug in global_integral_model: [-511235417/8*v + 238969025/4, 789861012140869185/32*v - 365842578320087625/16, -434331620876169353603835/32*v + 201170993209979865073875/16, 0, 0]
```


Issue created by migration from https://trac.sagemath.org/ticket/12151





---

archive/issue_comments_137675.json:
```json
{
    "body": "This can be fixed by changing\n\n```\nfor P, _ in K.ideal(a.denominator()).factor():\n```\n\non line 564 of ell_number_field.py to\n\n```\nfor P in [P for P,e in K.ideal(a).factor() if e<0]:\n```\n\nor alternatively (I think)\n\n```\nfor P, _ in a.denominator_ideal().factor():\n```\n\nI checked that the first alternative works.\n\nNB I also think that the line\n\n```\npi = K.uniformizer(P,'positive')\n```\n\nshould be \n\n```\npi = K.uniformizer(P,'negative')\n```\n\nsince we will divide by a power of pi and want to make sure that the model stays integral at other primes.  This does not matter in the example given where the class number is 1 so each pi will be an actual generator of the prime ideal.",
    "created_at": "2011-12-13T16:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137675",
    "user": "https://github.com/JohnCremona"
}
```

This can be fixed by changing

```
for P, _ in K.ideal(a.denominator()).factor():
```

on line 564 of ell_number_field.py to

```
for P in [P for P,e in K.ideal(a).factor() if e<0]:
```

or alternatively (I think)

```
for P, _ in a.denominator_ideal().factor():
```

I checked that the first alternative works.

NB I also think that the line

```
pi = K.uniformizer(P,'positive')
```

should be 

```
pi = K.uniformizer(P,'negative')
```

since we will divide by a power of pi and want to make sure that the model stays integral at other primes.  This does not matter in the example given where the class number is 1 so each pi will be an actual generator of the prime ideal.



---

archive/issue_comments_137676.json:
```json
{
    "body": "Attachment [12151.patch](tarball://root/attachments/some-uuid/ticket12151/12151.patch) by johanbosman created at 2011-12-16 18:18:34",
    "created_at": "2011-12-16T18:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137676",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Attachment [12151.patch](tarball://root/attachments/some-uuid/ticket12151/12151.patch) by johanbosman created at 2011-12-16 18:18:34



---

archive/issue_comments_137677.json:
```json
{
    "body": "Changing `negative` into `positive` was done in #7935, so I've decided to keep it `positive`.  ;).",
    "created_at": "2011-12-16T18:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137677",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Changing `negative` into `positive` was done in #7935, so I've decided to keep it `positive`.  ;).



---

archive/issue_comments_137678.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-16T18:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137678",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_137679.json:
```json
{
    "body": "Replying to [comment:2 johanbosman]:\n> Changing `negative` into `positive` was done in #7935, so I've decided to keep it `positive`.  ;).\n\nI have CC'd Chris Wuthrich who made the patch at #7935 (where I made a comment on exactly that line).",
    "created_at": "2011-12-16T18:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137679",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:2 johanbosman]:
> Changing `negative` into `positive` was done in #7935, so I've decided to keep it `positive`.  ;).

I have CC'd Chris Wuthrich who made the patch at #7935 (where I made a comment on exactly that line).



---

archive/issue_comments_137680.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-12T21:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137680",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_137681.json:
```json
{
    "body": "This looks fine to me.",
    "created_at": "2012-03-12T21:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137681",
    "user": "https://github.com/loefflerd"
}
```

This looks fine to me.



---

archive/issue_comments_137682.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-137682",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
