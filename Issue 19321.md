# Issue 19321: NTLError: FFT prime index too large

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2015-11-09 04:28:09

Keywords: random_fail

This happens occasionally (e.g. here on a 32-bit Ubuntu 14.04)

```
sage -t --long src/sage/modular/modform/ambient.py
**********************************************************************
File "src/sage/modular/modform/ambient.py", line 812, in sage.modular.modform.ambient.?._compute_hecke_matrix
Failed example:
    f = t.charpoly()                   # long time (4s)
Exception raised:
    Traceback (most recent call last):
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.modform.ambient.?._compute_hecke_matrix[4]>", line 1, in <module>
        f = t.charpoly()                   # long time (4s)
      File "sage/matrix/matrix_integer_dense.pyx", line 1251, in sage.matrix.matrix_integer_dense.Matrix_integer_dense.charpoly (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/matrix/matrix_integer_dense.c:12813)
        g = self._charpoly_linbox(var)
      File "sage/matrix/matrix_integer_dense.pyx", line 1304, in sage.matrix.matrix_integer_dense.Matrix_integer_dense._charpoly_linbox (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/matrix/matrix_integer_dense.c:13613)
        return self._poly_linbox(var=var, typ='charpoly')
      File "sage/matrix/matrix_integer_dense.pyx", line 1327, in sage.matrix.matrix_integer_dense.Matrix_integer_dense._poly_linbox (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/matrix/matrix_integer_dense.c:13972)
        sig_on()
      File "sage/libs/ntl/error.pyx", line 42, in sage.libs.ntl.error.NTL_error_callback (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/libs/ntl/error.cpp:757)
        raise NTLError(s)
    NTLError: FFT prime index too large
**********************************************************************
File "src/sage/modular/modform/ambient.py", line 813, in sage.modular.modform.ambient.?._compute_hecke_matrix
Failed example:
    [f[0]%p for p in prime_range(100)] # long time (0s, depends on above)
Exception raised:
    Traceback (most recent call last):
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.modform.ambient.?._compute_hecke_matrix[5]>", line 1, in <module>
        [f[Integer(0)]%p for p in prime_range(Integer(100))] # long time (0s, depends on above)
    NameError: name 'f' is not defined
**********************************************************************
File "src/sage/modular/modform/ambient.py", line 815, in sage.modular.modform.ambient.?._compute_hecke_matrix
Failed example:
    [f[42]%p for p in prime_range(100)] # long time (0s, depends on above)
Exception raised:
    Traceback (most recent call last):
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.modform.ambient.?._compute_hecke_matrix[6]>", line 1, in <module>
        [f[Integer(42)]%p for p in prime_range(Integer(100))] # long time (0s, depends on above)
    NameError: name 'f' is not defined
**********************************************************************
1 item had failures:
   3 of   8 in sage.modular.modform.ambient.?._compute_hecke_matrix
    [100 tests, 3 failures, 122.74 s]
```



---

Comment by slelievre created at 2019-01-14 17:45:54

Has this happened after the upgrade to NTL 10.3.0 in #22869
(closed as fixed on 2017-04-28, merged in Sage 8.0.beta5)?


---

Comment by jdemeyer created at 2019-01-14 22:25:28

Resolution: worksforme


---

Comment by jdemeyer created at 2019-01-14 22:25:28

Let's assume not.
