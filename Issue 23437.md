# Issue 23437: preparsing print into python3 format

archive/issues_023437.json:
```json
{
    "body": "CC:  @kevindilks @jplab @kcrisman\n\nHello,\n\nGiven that we are trying to move into python3, should we preparse \n\n```\nprint foo\n```\n\ninto\n\n```\nprint(foo)\n```\n\nwith deprecation warning? \n\nThis will make sure that old code, written in python2 style could still run, and not fail because of a miserable print.\n\nCheers,\n\nEdgar\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23674\n\n",
    "created_at": "2017-08-22T14:26:49Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "preparsing print into python3 format",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23437",
    "user": "@edgarcosta"
}
```
CC:  @kevindilks @jplab @kcrisman

Hello,

Given that we are trying to move into python3, should we preparse 

```
print foo
```

into

```
print(foo)
```

with deprecation warning? 

This will make sure that old code, written in python2 style could still run, and not fail because of a miserable print.

Cheers,

Edgar


Issue created by migration from https://trac.sagemath.org/ticket/23674





---

archive/issue_comments_328029.json:
```json
{
    "body": "I don't think we should go that way. It should not be the goal of Sage to do that. Just use the Python 3 syntax in your own code, possibly with `from __future__ import print_function`.",
    "created_at": "2017-08-22T14:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328029",
    "user": "@jdemeyer"
}
```

I don't think we should go that way. It should not be the goal of Sage to do that. Just use the Python 3 syntax in your own code, possibly with `from __future__ import print_function`.



---

archive/issue_comments_328030.json:
```json
{
    "body": "I understand your point of view, however, with that approach, a lot of homemade code will get broken whenever we do the switch because of a print.\n\nJust consider the case of someone running a long term computation and at the end, it will fail because the user tried to print the result. However, his code run totally fine in the previous version of sage.",
    "created_at": "2017-08-22T14:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328030",
    "user": "@edgarcosta"
}
```

I understand your point of view, however, with that approach, a lot of homemade code will get broken whenever we do the switch because of a print.

Just consider the case of someone running a long term computation and at the end, it will fail because the user tried to print the result. However, his code run totally fine in the previous version of sage.



---

archive/issue_comments_328031.json:
```json
{
    "body": "Changing keywords from \"\" to \"days88\".",
    "created_at": "2017-08-22T14:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328031",
    "user": "@edgarcosta"
}
```

Changing keywords from "" to "days88".



---

archive/issue_comments_328032.json:
```json
{
    "body": "In my mind, the idea is the following.\n\nAt some point (*hopefully*, but this may never happen given the amount of remaining work and the sparsity of workers) there will be a release of sage working and passing all tests with python3. At this point, development of sage for python2 will stop. Users will have the choice either to continue using the \"old python2 sage\" or to switch to the \"new python3 sage\". This will imply that they need to refresh their code, and this will be advertised **LOUDLY**. Transition to python3 is a pain, and we cannot avoid to impose this pain to our users.",
    "created_at": "2017-08-22T15:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328032",
    "user": "@fchapoton"
}
```

In my mind, the idea is the following.

At some point (*hopefully*, but this may never happen given the amount of remaining work and the sparsity of workers) there will be a release of sage working and passing all tests with python3. At this point, development of sage for python2 will stop. Users will have the choice either to continue using the "old python2 sage" or to switch to the "new python3 sage". This will imply that they need to refresh their code, and this will be advertised **LOUDLY**. Transition to python3 is a pain, and we cannot avoid to impose this pain to our users.



---

archive/issue_comments_328033.json:
```json
{
    "body": "Another potential issue could be pre-made notebooks for educational purposes that aren't necessarily being actively maintained.\n\nI think there are lots of people using Sage that won't be reached without deprecation warnings in the code itself no matter how loudly we advertise.",
    "created_at": "2017-08-22T16:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328033",
    "user": "@kevindilks"
}
```

Another potential issue could be pre-made notebooks for educational purposes that aren't necessarily being actively maintained.

I think there are lots of people using Sage that won't be reached without deprecation warnings in the code itself no matter how loudly we advertise.



---

archive/issue_comments_328034.json:
```json
{
    "body": "Replying to [comment:2 edgarcosta]:\n> Just consider the case of someone running a long term computation and at the end, it will fail because the user tried to print the result.\n\nYou should never do a long term computation without testing small cases first. If you test your own code properly, what you describe shouldn't happen.\n\nBesides, there are many more ways how a long term computation could break.",
    "created_at": "2017-08-22T17:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328034",
    "user": "@jdemeyer"
}
```

Replying to [comment:2 edgarcosta]:
> Just consider the case of someone running a long term computation and at the end, it will fail because the user tried to print the result.

You should never do a long term computation without testing small cases first. If you test your own code properly, what you describe shouldn't happen.

Besides, there are many more ways how a long term computation could break.



---

archive/issue_comments_328035.json:
```json
{
    "body": "> I think there are lots of people using Sage that won't be reached without deprecation warnings in the code itself no matter how loudly we advertise.\n\nI agree an alternative is to deprecate the \n\n```\nprint foo\n```\n\njust before we switch to python3.",
    "created_at": "2017-08-22T22:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328035",
    "user": "@edgarcosta"
}
```

> I think there are lots of people using Sage that won't be reached without deprecation warnings in the code itself no matter how loudly we advertise.

I agree an alternative is to deprecate the 

```
print foo
```

just before we switch to python3.



---

archive/issue_comments_328036.json:
```json
{
    "body": "Replying to [comment:7 edgarcosta]:\n> just before we switch to python3.\n\nOr well before.",
    "created_at": "2017-08-22T22:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328036",
    "user": "@jhpalmieri"
}
```

Replying to [comment:7 edgarcosta]:
> just before we switch to python3.

Or well before.



---

archive/issue_comments_328037.json:
```json
{
    "body": "I just got pointed to this ticket. What's the current status? I think it's a real problem if existing textbooks and student assignments (used year after year for teaching) will no longer work because of that change. IMHO it would be ideal to let the preparser understand old print statements. I don't care if there is a deprecation warning or not, just that those old code snippets still work.",
    "created_at": "2019-03-10T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328037",
    "user": "@haraldschilly"
}
```

I just got pointed to this ticket. What's the current status? I think it's a real problem if existing textbooks and student assignments (used year after year for teaching) will no longer work because of that change. IMHO it would be ideal to let the preparser understand old print statements. I don't care if there is a deprecation warning or not, just that those old code snippets still work.



---

archive/issue_comments_328038.json:
```json
{
    "body": "Making print a function is straightforward:\n\nIt basically boils down to making `from __future__ import print_function` the default in the sage interface if we want to do it before switching to Py3 and doing nothing if we don't.\n\nNow for the preparser bit (that's the relatively hard part):\n\nIt's very easy to detect if there's a `print-statement related syntax error`: That's just `print<not followed by whitespace*\\(>` (a regex should be able to do that). The tricky bit is to decide what to do next. If we assume that this is indeed a print statement, I guess that whatever comes after it (until newline of \";\") must be the argument, so probably a reasonable guess is to put that whole thing between parentheses.\nDoing that should probably be accompanied with a warning.\n\nI think this is actually not that bad to do: we're only rewriting code that would otherwise be a syntax error.\n\nOf course there are cases we don't catch, because there are print statements in python2 that are also valid syntax in python3, but with a different result:\n\nPython 2:\n\n```\n>>> print(1,2)\n(1, 2)\n```\n\n\nPython3:\n\n```\n>>> print(1,2)\n1 2\n```\n\n\nI don't think there's anything we can do about that. Our only option is to interpret it as valid Py3.\n\n**Note:** It's tempting to reach into \"2to3\" and use its fixer for print. I don't think that will work very well, because 2to3 actually constructs a parse tree. Probably sage's preparser would be much nicer if it did that too, but it doesn't. So integrating [2to3's fixer](https://bitbucket.org/python_mirrors/2to3/src/8c5b845c14fc3a4f51371531c911745817abd87f/lib2to3/fixes/fix_print.py) would be painful.",
    "created_at": "2019-04-04T03:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328038",
    "user": "@nbruin"
}
```

Making print a function is straightforward:

It basically boils down to making `from __future__ import print_function` the default in the sage interface if we want to do it before switching to Py3 and doing nothing if we don't.

Now for the preparser bit (that's the relatively hard part):

It's very easy to detect if there's a `print-statement related syntax error`: That's just `print<not followed by whitespace*\(>` (a regex should be able to do that). The tricky bit is to decide what to do next. If we assume that this is indeed a print statement, I guess that whatever comes after it (until newline of ";") must be the argument, so probably a reasonable guess is to put that whole thing between parentheses.
Doing that should probably be accompanied with a warning.

I think this is actually not that bad to do: we're only rewriting code that would otherwise be a syntax error.

Of course there are cases we don't catch, because there are print statements in python2 that are also valid syntax in python3, but with a different result:

Python 2:

```
>>> print(1,2)
(1, 2)
```


Python3:

```
>>> print(1,2)
1 2
```


I don't think there's anything we can do about that. Our only option is to interpret it as valid Py3.

**Note:** It's tempting to reach into "2to3" and use its fixer for print. I don't think that will work very well, because 2to3 actually constructs a parse tree. Probably sage's preparser would be much nicer if it did that too, but it doesn't. So integrating [2to3's fixer](https://bitbucket.org/python_mirrors/2to3/src/8c5b845c14fc3a4f51371531c911745817abd87f/lib2to3/fixes/fix_print.py) would be painful.



---

archive/issue_comments_328039.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> I don't think we should go that way. It should not be the goal of Sage to do that. Just use the Python 3 syntax in your own code, possibly with `from __future__ import print_function`.\n\nReplying to [comment:4 chapoton]:\n> In my mind, the idea is the following.\n> \n> At some point (*hopefully*, but this may never happen given the amount of remaining work and the sparsity of workers) there will be a release of sage working and passing all tests with python3. At this point, development of sage for python2 will stop. Users will have the choice either to continue using the \"old python2 sage\" or to switch to the \"new python3 sage\". This will imply that they need to refresh their code, and this will be advertised **LOUDLY**. Transition to python3 is a pain, and we cannot avoid to impose this pain to our users.\n\nI agree with these two comments. The change to Python 3 will most likely break Python 2 written code as there are a lot more incompatible changes than `print`. I do not think, that `print` should be an exception here.\n\nTherefore a -1 for using the preparser for this.",
    "created_at": "2019-04-04T08:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328039",
    "user": "@dkrenn"
}
```

Replying to [comment:1 jdemeyer]:
> I don't think we should go that way. It should not be the goal of Sage to do that. Just use the Python 3 syntax in your own code, possibly with `from __future__ import print_function`.

Replying to [comment:4 chapoton]:
> In my mind, the idea is the following.
> 
> At some point (*hopefully*, but this may never happen given the amount of remaining work and the sparsity of workers) there will be a release of sage working and passing all tests with python3. At this point, development of sage for python2 will stop. Users will have the choice either to continue using the "old python2 sage" or to switch to the "new python3 sage". This will imply that they need to refresh their code, and this will be advertised **LOUDLY**. Transition to python3 is a pain, and we cannot avoid to impose this pain to our users.

I agree with these two comments. The change to Python 3 will most likely break Python 2 written code as there are a lot more incompatible changes than `print`. I do not think, that `print` should be an exception here.

Therefore a -1 for using the preparser for this.



---

archive/issue_comments_328040.json:
```json
{
    "body": "I think this ticket is obsolete.",
    "created_at": "2021-02-24T05:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328040",
    "user": "@DaveWitteMorris"
}
```

I think this ticket is obsolete.



---

archive/issue_comments_328041.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-24T05:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328041",
    "user": "@DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_328042.json:
```json
{
    "body": "I agree, let's close it",
    "created_at": "2021-02-24T06:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328042",
    "user": "@mkoeppe"
}
```

I agree, let's close it



---

archive/issue_comments_328043.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-24T06:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328043",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_328044.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-02-24T13:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23437#issuecomment-328044",
    "user": "@fchapoton"
}
```

Resolution: invalid
