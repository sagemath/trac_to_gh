# Issue 20184: libgap workspace() doctest failures

archive/issues_020184.json:
```json
{
    "body": "CC:  @vbraun\n\nKeywords: random_fail\n\nI regularly get this. I'm not sure whether it is a random failure or not, it might be because of doing `make distclean` first:\n\n```\nsage -t src/sage/libs/gap/assigned_names.py\n**********************************************************************\nFile \"src/sage/libs/gap/assigned_names.py\", line 59, in sage.libs.gap.assigned_names.load_or_compute\nFailed example:\n    workspace(name='globals')\nExpected:\n    ('...', True)\nGot:\n    ('/home/jdemeyer/.sage/gap/libgap-globals-4034600654683281042', False)\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20421\n\n",
    "created_at": "2016-04-11T12:34:40Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "libgap workspace() doctest failures",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20184",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @vbraun

Keywords: random_fail

I regularly get this. I'm not sure whether it is a random failure or not, it might be because of doing `make distclean` first:

```
sage -t src/sage/libs/gap/assigned_names.py
**********************************************************************
File "src/sage/libs/gap/assigned_names.py", line 59, in sage.libs.gap.assigned_names.load_or_compute
Failed example:
    workspace(name='globals')
Expected:
    ('...', True)
Got:
    ('/home/jdemeyer/.sage/gap/libgap-globals-4034600654683281042', False)
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/20421





---

archive/issue_comments_277931.json:
```json
{
    "body": "Happened again. The scenario was:\n1. `make distclean`\n2. build Sage but don't run it\n3. `make ptestlong` -> got this failure",
    "created_at": "2016-04-24T21:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277931",
    "user": "https://github.com/jdemeyer"
}
```

Happened again. The scenario was:
1. `make distclean`
2. build Sage but don't run it
3. `make ptestlong` -> got this failure



---

archive/issue_comments_277932.json:
```json
{
    "body": "For what it's worth I had some doctest failures when the `gap` upgrade landed [https://github.com/cschwan/sage-on-gentoo/issues/412](https://github.com/cschwan/sage-on-gentoo/issues/412). They did go away as mysteriously as they came after a couple of beta releases. They were persistent across rebuilding gap/libgap and sage.",
    "created_at": "2016-04-24T22:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277932",
    "user": "https://github.com/kiwifb"
}
```

For what it's worth I had some doctest failures when the `gap` upgrade landed [https://github.com/cschwan/sage-on-gentoo/issues/412](https://github.com/cschwan/sage-on-gentoo/issues/412). They did go away as mysteriously as they came after a couple of beta releases. They were persistent across rebuilding gap/libgap and sage.



---

archive/issue_comments_277933.json:
```json
{
    "body": "Thats probably a race with building the workspace caches...",
    "created_at": "2016-05-07T23:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277933",
    "user": "https://github.com/vbraun"
}
```

Thats probably a race with building the workspace caches...



---

archive/issue_comments_277934.json:
```json
{
    "body": "also reproduced on OSX: https://groups.google.com/d/msg/sage-release/iNYoT5KK3pw/EAiAqQmMMQAJ",
    "created_at": "2016-05-10T08:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277934",
    "user": "https://github.com/dimpase"
}
```

also reproduced on OSX: https://groups.google.com/d/msg/sage-release/iNYoT5KK3pw/EAiAqQmMMQAJ



---

archive/issue_comments_277935.json:
```json
{
    "body": "I'm getting this pretty regularly in the Docker container.  This is probably because the container always starts with a fresh environment, and doesn't have timings for the tests yet, so runs them in a different order.  At what point are the \"workspace caches\" built, and is there some way we can make sure that is done as a prerequisite to this test?",
    "created_at": "2017-03-01T14:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277935",
    "user": "https://github.com/embray"
}
```

I'm getting this pretty regularly in the Docker container.  This is probably because the container always starts with a fresh environment, and doesn't have timings for the tests yet, so runs them in a different order.  At what point are the "workspace caches" built, and is there some way we can make sure that is done as a prerequisite to this test?



---

archive/issue_comments_277936.json:
```json
{
    "body": "Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)",
    "created_at": "2017-03-16T22:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277936",
    "user": "https://github.com/nthiery"
}
```

Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)



---

archive/issue_comments_277937.json:
```json
{
    "body": "Replying to [comment:6 nthiery]:\n> Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)\nwith #22570, or without?",
    "created_at": "2017-03-16T22:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277937",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:6 nthiery]:
> Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)
with #22570, or without?



---

archive/issue_comments_277938.json:
```json
{
    "body": "That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.",
    "created_at": "2017-03-16T23:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277938",
    "user": "https://github.com/nthiery"
}
```

That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.



---

archive/issue_comments_277939.json:
```json
{
    "body": "Replying to [comment:8 nthiery]:\n> That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.\n\nIf you pull Volker's current development tree at https://github.com/vbraun/sage you'll get #22570. I personnaly follow Volker's dev branch so I can anticipate or discover what's going to land for sage-on-gentoo. If you get an angry message from me on a positively reviewed ticket that's because I discovered you made my life harder from pulling on Volker's tree :P",
    "created_at": "2017-03-17T00:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277939",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:8 nthiery]:
> That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.

If you pull Volker's current development tree at https://github.com/vbraun/sage you'll get #22570. I personnaly follow Volker's dev branch so I can anticipate or discover what's going to land for sage-on-gentoo. If you get an angry message from me on a positively reviewed ticket that's because I discovered you made my life harder from pulling on Volker's tree :P



---

archive/issue_comments_277940.json:
```json
{
    "body": "Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.",
    "created_at": "2017-03-17T07:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277940",
    "user": "https://github.com/vbraun"
}
```

Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.



---

archive/issue_comments_277941.json:
```json
{
    "body": "Replying to [comment:10 vbraun]:\n> Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.\n\nNot the right place to discuss it. But yes I know, and I have been burned a couple of times. But it is very handy for what I do. However it happens on a special branch of the sage-on-gentoo overlay which normal user are not supposed to touch and very few know about.",
    "created_at": "2017-03-17T07:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20184#issuecomment-277941",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:10 vbraun]:
> Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.

Not the right place to discuss it. But yes I know, and I have been burned a couple of times. But it is very handy for what I do. However it happens on a special branch of the sage-on-gentoo overlay which normal user are not supposed to touch and very few know about.
