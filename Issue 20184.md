# Issue 20184: libgap workspace() doctest failures

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2016-04-11 12:34:40

CC:  vbraun

Keywords: random_fail

I regularly get this. I'm not sure whether it is a random failure or not, it might be because of doing `make distclean` first:

```
sage -t src/sage/libs/gap/assigned_names.py
**********************************************************************
File "src/sage/libs/gap/assigned_names.py", line 59, in sage.libs.gap.assigned_names.load_or_compute
Failed example:
    workspace(name='globals')
Expected:
    ('...', True)
Got:
    ('/home/jdemeyer/.sage/gap/libgap-globals-4034600654683281042', False)
**********************************************************************
```



---

Comment by jdemeyer created at 2016-04-24 21:17:34

Happened again. The scenario was:
1. `make distclean`
2. build Sage but don't run it
3. `make ptestlong` -> got this failure


---

Comment by fbissey created at 2016-04-24 22:06:58

For what it's worth I had some doctest failures when the `gap` upgrade landed [https://github.com/cschwan/sage-on-gentoo/issues/412](https://github.com/cschwan/sage-on-gentoo/issues/412). They did go away as mysteriously as they came after a couple of beta releases. They were persistent across rebuilding gap/libgap and sage.


---

Comment by vbraun created at 2016-05-07 23:12:09

Thats probably a race with building the workspace caches...


---

Comment by dimpase created at 2016-05-10 08:37:22

also reproduced on OSX: https://groups.google.com/d/msg/sage-release/iNYoT5KK3pw/EAiAqQmMMQAJ


---

Comment by embray created at 2017-03-01 14:09:26

I'm getting this pretty regularly in the Docker container.  This is probably because the container always starts with a fresh environment, and doesn't have timings for the tests yet, so runs them in a different order.  At what point are the "workspace caches" built, and is there some way we can make sure that is done as a prerequisite to this test?


---

Comment by nthiery created at 2017-03-16 22:32:19

Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)


---

Comment by dimpase created at 2017-03-16 22:39:58

Replying to [comment:6 nthiery]:
> Just for info: I just got this while upgrading to (lib)gap 4.9 (dev)
with #22570, or without?


---

Comment by nthiery created at 2017-03-16 23:44:21

That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.


---

Comment by fbissey created at 2017-03-17 00:15:03

Replying to [comment:8 nthiery]:
> That was with 7.6.beta6 (and some of #22626). So without #22570 I believe.

If you pull Volker's current development tree at https://github.com/vbraun/sage you'll get #22570. I personnaly follow Volker's dev branch so I can anticipate or discover what's going to land for sage-on-gentoo. If you get an angry message from me on a positively reviewed ticket that's because I discovered you made my life harder from pulling on Volker's tree :P


---

Comment by vbraun created at 2017-03-17 07:46:34

Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.


---

Comment by fbissey created at 2017-03-17 07:53:26

Replying to [comment:10 vbraun]:
> Don't do that. You can look at the development branch but don't touch it.... commits may be rewritting / removed until it is published.

Not the right place to discuss it. But yes I know, and I have been burned a couple of times. But it is very handy for what I do. However it happens on a special branch of the sage-on-gentoo overlay which normal user are not supposed to touch and very few know about.
