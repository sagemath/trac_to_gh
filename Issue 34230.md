# Issue 34230: fix random doctest failure in EllipticCurveHom_velusqrt

Issue created by migration from https://trac.sagemath.org/ticket/34467

Original creator: lorenz

Original creation time: 2022-09-01 07:11:48

CC:  arojas

As reported in comment:25:ticket:34303, `EllipticCurveHom_velusqrt` accidentally computes an irrational isogeny for curves defined over `GF(3)` with `7` rational points. The reason is that the computation internally requires a point lying outside the kernel, which _only in this one specific case_ will be defined over a cubic instead of a quadratic extension. This in turn implies the linear factors in the numerator of the isogeny won't match up in conjugate pairs, causing the problem.

Quick fix: Simply restrict the implementation to degrees `â‰¥ 9`. Since the older `EllipticCurveIsogeny` implementation is much faster for degrees this small anyway, this restriction won't be a problem for any remotely realistic code.


---

Comment by lorenz created at 2022-09-01 07:12:09

Changing status from new to needs_review.


---

Comment by klee created at 2022-09-15 02:15:54

How about adding a doctest for this problematic case with an explanation and a link to this ticket?


---

Comment by git created at 2022-09-15 07:03:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by lorenz created at 2022-09-15 07:03:24

Done.


---

Comment by klee created at 2022-09-16 00:14:58

Thanks. LGTM.


---

Comment by klee created at 2022-09-16 00:14:58

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2022-09-16 12:21:04

Changing priority from minor to critical.


---

Comment by vbraun created at 2022-09-20 20:23:25

Resolution: fixed
