# Issue 16647: A database entry for Quasi-difference matrices

archive/issues_016647.json:
```json
{
    "body": "CC:  vdelecroix\n\nA new database entry for quasi-difference matrices. As a result:\n\n- The Vmt vectors are added to the quasi-difference matrices database entry, and not anymore to `OA_constructions`\n\n- The old OA constructions based on QDM are converted to QDM constructors.\n\n- The OA constructor now queries the QDM database entry (and so it gets the QDM+Vmt)\n\nTwo notes:\n\n- There is no `is_quasi_difference_matrix` right now, so the QDM are tested through the OA they generate.\n\n- There is no `designs.quasi_difference_matrix` because I did not know how to write it in such a way that it would be easy to find a QDM that builds an OA. The problem is that a QDM is defined with 5 parameters `(n,_,_,_,u)` and that the `n` of an `OA(k,n)` is the sum `n+u`. Consequently, if you want to build an `OA(k,n)` from a QDM you must try all pairs `n'+u = n` and that's a waste of time.\n\n- Right now the DM are not added to the dictionary of QDM. I did not see the point, given that the DM are already queried by `orthogonal_arrays()` through their constructor (which will also contain additional constructions of DM).\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16884\n\n",
    "created_at": "2014-08-26T22:02:04Z",
    "labels": [
        "combinatorial designs",
        "major",
        "enhancement"
    ],
    "title": "A database entry for Quasi-difference matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16647",
    "user": "ncohen"
}
```
CC:  vdelecroix

A new database entry for quasi-difference matrices. As a result:

- The Vmt vectors are added to the quasi-difference matrices database entry, and not anymore to `OA_constructions`

- The old OA constructions based on QDM are converted to QDM constructors.

- The OA constructor now queries the QDM database entry (and so it gets the QDM+Vmt)

Two notes:

- There is no `is_quasi_difference_matrix` right now, so the QDM are tested through the OA they generate.

- There is no `designs.quasi_difference_matrix` because I did not know how to write it in such a way that it would be easy to find a QDM that builds an OA. The problem is that a QDM is defined with 5 parameters `(n,_,_,_,u)` and that the `n` of an `OA(k,n)` is the sum `n+u`. Consequently, if you want to build an `OA(k,n)` from a QDM you must try all pairs `n'+u = n` and that's a waste of time.

- Right now the DM are not added to the dictionary of QDM. I did not see the point, given that the DM are already queried by `orthogonal_arrays()` through their constructor (which will also contain additional constructions of DM).



Issue created by migration from https://trac.sagemath.org/ticket/16884





---

archive/issue_comments_219709.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-26T22:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219709",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_219710.json:
```json
{
    "body": "Oh, I forgot to say why this patch is useful:\n\nThere is a problem currently with the way Sage manages Vmt vectors. Indeed, from a Vmt ont can build a quasi-difference matrix with `k=m+2` columns, and for `OA(9,514)` (see last commit) the OA construction has to do a small change: 1) build the QDM from the Vmt; 2) Remove a column from the QDM; 3) Build the OA from the reduced QDM.\n\nNow, building the OA from the reduced QDM means filling a hole with an `OA(9,57)` (which exists). If the QDM is not reduced first, turning the QDM into an OA required an `OA(10,57)`, which we don't have.\n\nFor this reason the `OA(9,514)` was not included in the Vmt vectors, and this branch fixes it.\n\nThe good thing is that with this branch everything is handled correctly (and the QDM automatically reduced if needed), which means that we can add to the Vmt database some Vmt that cannot be turned into complete OA.\n\nTwo good points:\n\n1) I can not add another Vmt which had the same problem as this 514 thing and creates an OA that we do not have already\n\n2) I can now add Vmt that will produce incomplete OA that can be used by `incomplete_orthogonal_array` to get OA with holes of size `>1`, and that means perhaps being able to use the Brouwer-van Rees version of Wilson's construction.\n\nNathann",
    "created_at": "2014-08-26T22:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219710",
    "user": "ncohen"
}
```

Oh, I forgot to say why this patch is useful:

There is a problem currently with the way Sage manages Vmt vectors. Indeed, from a Vmt ont can build a quasi-difference matrix with `k=m+2` columns, and for `OA(9,514)` (see last commit) the OA construction has to do a small change: 1) build the QDM from the Vmt; 2) Remove a column from the QDM; 3) Build the OA from the reduced QDM.

Now, building the OA from the reduced QDM means filling a hole with an `OA(9,57)` (which exists). If the QDM is not reduced first, turning the QDM into an OA required an `OA(10,57)`, which we don't have.

For this reason the `OA(9,514)` was not included in the Vmt vectors, and this branch fixes it.

The good thing is that with this branch everything is handled correctly (and the QDM automatically reduced if needed), which means that we can add to the Vmt database some Vmt that cannot be turned into complete OA.

Two good points:

1) I can not add another Vmt which had the same problem as this 514 thing and creates an OA that we do not have already

2) I can now add Vmt that will produce incomplete OA that can be used by `incomplete_orthogonal_array` to get OA with holes of size `>1`, and that means perhaps being able to use the Brouwer-van Rees version of Wilson's construction.

Nathann



---

archive/issue_comments_219711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-08-26T22:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219711",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_219712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-26T22:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219712",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219713.json:
```json
{
    "body": "Except that there is a stupid test that ensures that something wrong holds, i.e. that all Vmt can be turned into full OA.\n\nI will implement a `is_quasi_difference_matrix` to change that test, but in the meantime I will just avoid the bad case.\n\nNathann\n----\nNew commits:",
    "created_at": "2014-08-26T22:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219713",
    "user": "ncohen"
}
```

Except that there is a stupid test that ensures that something wrong holds, i.e. that all Vmt can be turned into full OA.

I will implement a `is_quasi_difference_matrix` to change that test, but in the meantime I will just avoid the bad case.

Nathann
----
New commits:



---

archive/issue_comments_219714.json:
```json
{
    "body": "Here is a real fix.\n\nNathann",
    "created_at": "2014-08-27T17:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219714",
    "user": "ncohen"
}
```

Here is a real fix.

Nathann



---

archive/issue_comments_219715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-27T17:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219715",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_219716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-27T18:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219716",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219717.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2014-08-28T22:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219717",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_219718.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-08-29T11:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219718",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_219719.json:
```json
{
    "body": "Hello,\n\n1) In the definition of quasi difference matrix, why do you require the group G to be Abelian? I saw that your definition coincides with the one from the handbook... but still. The question is just why. I don't mind the restriction since I do not know of any example on a non-commutative group.\n\n2) You did not modify the doctests, is it on purpose\n\n```\n$ sage -coverage database.py\n------------------------------------------------------------------------\nSCORE database.py: 100.0% (68 of 68)\n\nPossibly wrong (function name doesn't occur in doctests):\n     * line 1955: def QDM_19_6_1_0_1()\n     * line 1987: def QDM_21_5_1_0_1()\n     * line 2032: def QDM_21_6_1_0_5()\n     * line 2070: def QDM_25_6_1_0_5()\n     * line 2113: def QDM_33_6_1_0_1()\n     * line 2154: def QDM_37_6_1_0_1()\n     * line 2190: def QDM_35_7_1_0_7()\n     * line 2225: def QDM_45_7_1_0_9()\n     * line 2260: def QDM_54_7_1_0_8()\n     * line 2295: def QDM_57_9_1_0_8()\n------------------------------------------------------------------------\n```\n\n\nFor the following see `public/16884b`\n\n1') I got an error building the doc, because you used `::` instead of `:` in `is_quasi_difference_matrix`.\n\nVincent",
    "created_at": "2014-08-29T11:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219719",
    "user": "vdelecroix"
}
```

Hello,

1) In the definition of quasi difference matrix, why do you require the group G to be Abelian? I saw that your definition coincides with the one from the handbook... but still. The question is just why. I don't mind the restriction since I do not know of any example on a non-commutative group.

2) You did not modify the doctests, is it on purpose

```
$ sage -coverage database.py
------------------------------------------------------------------------
SCORE database.py: 100.0% (68 of 68)

Possibly wrong (function name doesn't occur in doctests):
     * line 1955: def QDM_19_6_1_0_1()
     * line 1987: def QDM_21_5_1_0_1()
     * line 2032: def QDM_21_6_1_0_5()
     * line 2070: def QDM_25_6_1_0_5()
     * line 2113: def QDM_33_6_1_0_1()
     * line 2154: def QDM_37_6_1_0_1()
     * line 2190: def QDM_35_7_1_0_7()
     * line 2225: def QDM_45_7_1_0_9()
     * line 2260: def QDM_54_7_1_0_8()
     * line 2295: def QDM_57_9_1_0_8()
------------------------------------------------------------------------
```


For the following see `public/16884b`

1') I got an error building the doc, because you used `::` instead of `:` in `is_quasi_difference_matrix`.

Vincent



---

archive/issue_comments_219720.json:
```json
{
    "body": "Hello !\n\n> 1) In the definition of quasi difference matrix, why do you require the group G to be Abelian? I saw that your definition coincides with the one from the handbook... but still. The question is just why. I don't mind the restriction since I do not know of any example on a non-commutative group.\n\nNo other reason, I just took the def from the Handbook.\n\n> 2) You did not modify the doctests, is it on purpose\n\nNonono it is a mistake, I first wrote those functions when we had no `is_quasi_difference_matrix` function and I had no other choice. It is fixed. Plus the '0' in the functions was actually a 1 and I had forgotten to update it.\n\nI also changed the layout of the QDM dictionary: as for other dictionaries, the 'k' is a key. It is easier this way, I learned that by writing my update to the Brouwer-van Rees construction (which I will update now).\n\nAnd after the Brouwer-van Rees construction is reviewed I will have to thing hard about a `find_*` function. The good news is that it should make many - disappear `:-P`\n\nNathann",
    "created_at": "2014-08-29T12:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219720",
    "user": "ncohen"
}
```

Hello !

> 1) In the definition of quasi difference matrix, why do you require the group G to be Abelian? I saw that your definition coincides with the one from the handbook... but still. The question is just why. I don't mind the restriction since I do not know of any example on a non-commutative group.

No other reason, I just took the def from the Handbook.

> 2) You did not modify the doctests, is it on purpose

Nonono it is a mistake, I first wrote those functions when we had no `is_quasi_difference_matrix` function and I had no other choice. It is fixed. Plus the '0' in the functions was actually a 1 and I had forgotten to update it.

I also changed the layout of the QDM dictionary: as for other dictionaries, the 'k' is a key. It is easier this way, I learned that by writing my update to the Brouwer-van Rees construction (which I will update now).

And after the Brouwer-van Rees construction is reviewed I will have to thing hard about a `find_*` function. The good news is that it should make many - disappear `:-P`

Nathann



---

archive/issue_comments_219721.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-08-29T13:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219721",
    "user": "ncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_219722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-29T13:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219722",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219723.json:
```json
{
    "body": "Here it is !\n\nNathann",
    "created_at": "2014-08-29T13:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219723",
    "user": "ncohen"
}
```

Here it is !

Nathann



---

archive/issue_comments_219724.json:
```json
{
    "body": "Replying to [comment:11 ncohen]:\n> > 2) You did not modify the doctests, is it on purpose\n> \n> Nonono it is a mistake, I first wrote those functions when we had no `is_quasi_difference_matrix` function and I had no other choice. It is fixed. Plus the '0' in the functions was actually a 1 and I had forgotten to update it.\n> \n> I also changed the layout of the QDM dictionary: as for other dictionaries, the 'k' is a key.\n\nYou mean a value I gues. As the code is\n\n```\nfor ((n,k,lmbda,mu,u),f) in [...]:\n    if not (n+u,lmbda) in QDM:\n        QDM[n+u,lmbda] = {}\n    QDM[n+u,lmbda][n,lmbda,mu,u] = (k,f)\n\n```\n\n\n> And after the Brouwer-van Rees construction is reviewed I will have to thing hard about a `find_*` function. The good news is that it should make many - disappear `:-P`\n\nYou can also set the values by hand (but still try hard to find more values).\n\nMore comments:\n\n3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).\n\n4) I wonder if such things as 3) above is doable with `difference_matrix` as well. For example we could put a call to `_OA_cache_set` inside `difference_matrix` to set the existence to a potentially bigger `k`. Alternatively, one can write `_OA_cache_set(n,difference_matrix(n,None,existence=True))` in the core of `orthogonal_array` but it might be slower.\n\nVincent",
    "created_at": "2014-08-29T18:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219724",
    "user": "vdelecroix"
}
```

Replying to [comment:11 ncohen]:
> > 2) You did not modify the doctests, is it on purpose
> 
> Nonono it is a mistake, I first wrote those functions when we had no `is_quasi_difference_matrix` function and I had no other choice. It is fixed. Plus the '0' in the functions was actually a 1 and I had forgotten to update it.
> 
> I also changed the layout of the QDM dictionary: as for other dictionaries, the 'k' is a key.

You mean a value I gues. As the code is

```
for ((n,k,lmbda,mu,u),f) in [...]:
    if not (n+u,lmbda) in QDM:
        QDM[n+u,lmbda] = {}
    QDM[n+u,lmbda][n,lmbda,mu,u] = (k,f)

```


> And after the Brouwer-van Rees construction is reviewed I will have to thing hard about a `find_*` function. The good news is that it should make many - disappear `:-P`

You can also set the values by hand (but still try hard to find more values).

More comments:

3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).

4) I wonder if such things as 3) above is doable with `difference_matrix` as well. For example we could put a call to `_OA_cache_set` inside `difference_matrix` to set the existence to a potentially bigger `k`. Alternatively, one can write `_OA_cache_set(n,difference_matrix(n,None,existence=True))` in the core of `orthogonal_array` but it might be slower.

Vincent



---

archive/issue_comments_219725.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-08-29T18:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219725",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_219726.json:
```json
{
    "body": "Yo !\n\n> You mean a value I gues. As the code is\n\nIndeed. And I may do the same for 'mu' in the future too. This variable is mostly useless.\n\n> You can also set the values by hand (but still try hard to find more values).\n\nI began to write something which may more or less work. But today I had to clean the house in which I spent the week, tomorrow will be filled with travelling and sunday too. Adventure `:-P`\n\n> 3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).\n\nI don't understand your sentence `O_o`\n\n> 4) I wonder if such things as 3) above is doable with `difference_matrix` as well. For example we could put a call to `_OA_cache_set` inside `difference_matrix` to set the existence to a potentially bigger `k`. Alternatively, one can write `_OA_cache_set(n,difference_matrix(n,None,existence=True))` in the core of `orthogonal_array` but it might be slower.\n\nHmmmm.. I prefer that only the OA constructor plays with the `OA_cache`. I thought once or twice while coding that it was a good thing but I forgot why.\n\nNathann",
    "created_at": "2014-08-29T20:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219726",
    "user": "ncohen"
}
```

Yo !

> You mean a value I gues. As the code is

Indeed. And I may do the same for 'mu' in the future too. This variable is mostly useless.

> You can also set the values by hand (but still try hard to find more values).

I began to write something which may more or less work. But today I had to clean the house in which I spent the week, tomorrow will be filled with travelling and sunday too. Adventure `:-P`

> 3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).

I don't understand your sentence `O_o`

> 4) I wonder if such things as 3) above is doable with `difference_matrix` as well. For example we could put a call to `_OA_cache_set` inside `difference_matrix` to set the existence to a potentially bigger `k`. Alternatively, one can write `_OA_cache_set(n,difference_matrix(n,None,existence=True))` in the core of `orthogonal_array` but it might be slower.

Hmmmm.. I prefer that only the OA constructor plays with the `OA_cache`. I thought once or twice while coding that it was a good thing but I forgot why.

Nathann



---

archive/issue_comments_219727.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-08-29T21:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219727",
    "user": "vdelecroix"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_219728.json:
```json
{
    "body": "Replying to [comment:16 ncohen]:\n\n> > 3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).\n> \n> I don't understand your sentence `O_o`\n\nNevermind. I was wrong. My question should have been: if I ask for `orthogonal_array(None,n,existence=True)` is there a better strategy to adopt when dealing with quasi-difference matrix case. The answer is yes, but it is not nice to write down in your flow of `if/elif/elif/...`.\n\nGood to go!\n\nVincent",
    "created_at": "2014-08-29T21:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219728",
    "user": "vdelecroix"
}
```

Replying to [comment:16 ncohen]:

> > 3) When there does exist a good `QDM` to build an `OA(k,n)`, could we use `_OA_cache_set(kk,n,True)` instead of `_OA_cache_set(k,n,True)`. We will win some few calls (especially when running `MOLS_table`).
> 
> I don't understand your sentence `O_o`

Nevermind. I was wrong. My question should have been: if I ask for `orthogonal_array(None,n,existence=True)` is there a better strategy to adopt when dealing with quasi-difference matrix case. The answer is yes, but it is not nice to write down in your flow of `if/elif/elif/...`.

Good to go!

Vincent



---

archive/issue_comments_219729.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-06T11:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16647#issuecomment-219729",
    "user": "vbraun"
}
```

Resolution: fixed
