# Issue 27033: spkg-configure.m4 for arb

archive/issues_027033.json:
```json
{
    "body": "CC:  embray jdemeyer thansen fbissey\n\nKeywords: spkg-configure\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27270\n\n",
    "created_at": "2019-02-13T09:26:16Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "spkg-configure.m4 for arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27033",
    "user": "dimpase"
}
```
CC:  embray jdemeyer thansen fbissey

Keywords: spkg-configure



Issue created by migration from https://trac.sagemath.org/ticket/27270





---

archive/issue_comments_380753.json:
```json
{
    "body": "this does not implement `--with-arb=...`, as I hope it's not needed.\nAnd no other packages have `--with-arb=`, too.\n----\nLast 10 new commits:",
    "created_at": "2019-03-21T15:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380753",
    "user": "dimpase"
}
```

this does not implement `--with-arb=...`, as I hope it's not needed.
And no other packages have `--with-arb=`, too.
----
Last 10 new commits:



---

archive/issue_comments_380754.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-21T15:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380754",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_380755.json:
```json
{
    "body": "Tests pass, apart from this amusing doctest failure:\n\n```\nFile \"src/sage/misc/package.py\", line 282, in sage.misc.package.installed_packages\nFailed example:\n    installed_packages()\nExpected:\n    {...'arb': ...'pynac': ...}\nGot:\n    {'.dummy': '',\n     'alabaster': '0.7.12',\n     'appnope': '0.1.0.p0',\n...\n```\n\n\nLess amusing is that with arb manually installed to /usr/local on Gentoo Linux, I get a import error upon Sage startup, from deep inside sagelib.\n\nI have to start Sage as `LD_LIBRARY_PATH=/usr/local/lib64 ./sage`, otherwise\nI get \n\n```\nImportError: libarb.so.2: cannot open shared object file: No such file or directory\n```\n\nI do have `/usr/local/lib64` in `/etc/ld.so.conf`, by the way.\nDoes this mean we need do jump through some linking hoops here?\n\nI certainly can add a proper runtime test in `spkg-configure.m4`, but why?",
    "created_at": "2019-03-21T22:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380755",
    "user": "dimpase"
}
```

Tests pass, apart from this amusing doctest failure:

```
File "src/sage/misc/package.py", line 282, in sage.misc.package.installed_packages
Failed example:
    installed_packages()
Expected:
    {...'arb': ...'pynac': ...}
Got:
    {'.dummy': '',
     'alabaster': '0.7.12',
     'appnope': '0.1.0.p0',
...
```


Less amusing is that with arb manually installed to /usr/local on Gentoo Linux, I get a import error upon Sage startup, from deep inside sagelib.

I have to start Sage as `LD_LIBRARY_PATH=/usr/local/lib64 ./sage`, otherwise
I get 

```
ImportError: libarb.so.2: cannot open shared object file: No such file or directory
```

I do have `/usr/local/lib64` in `/etc/ld.so.conf`, by the way.
Does this mean we need do jump through some linking hoops here?

I certainly can add a proper runtime test in `spkg-configure.m4`, but why?



---

archive/issue_comments_380756.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n\n> \n> Less amusing is that with arb manually installed to /usr/local on Gentoo Linux, I get a import error upon Sage startup, from deep inside sagelib.\n\noops, my fault. Forgot to run ldconfig after the installation.\n(maybe arb should do it for you, cf. https://github.com/fredrik-johansson/arb/issues/273).",
    "created_at": "2019-03-22T09:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380756",
    "user": "dimpase"
}
```

Replying to [comment:4 dimpase]:

> 
> Less amusing is that with arb manually installed to /usr/local on Gentoo Linux, I get a import error upon Sage startup, from deep inside sagelib.

oops, my fault. Forgot to run ldconfig after the installation.
(maybe arb should do it for you, cf. https://github.com/fredrik-johansson/arb/issues/273).



---

archive/issue_comments_380757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-22T09:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380757",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380758.json:
```json
{
    "body": "upstream report not directly relevant to this ticket, bit OK.",
    "created_at": "2019-03-22T09:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380758",
    "user": "dimpase"
}
```

upstream report not directly relevant to this ticket, bit OK.



---

archive/issue_comments_380759.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380759",
    "user": "embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_380760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-01T13:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380760",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-04-30T22:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380761",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_380762.json:
```json
{
    "body": "OK, so this branch has mpfr (#27258)\nmpc (#27259)\nntl (#27265)\nflint (#27264) and, naturally, \narb. Would be great to have it all reviewed in one go...",
    "created_at": "2019-04-30T22:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380762",
    "user": "dimpase"
}
```

OK, so this branch has mpfr (#27258)
mpc (#27259)
ntl (#27265)
flint (#27264) and, naturally, 
arb. Would be great to have it all reviewed in one go...



---

archive/issue_comments_380763.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-30T22:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380763",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380764.json:
```json
{
    "body": "Attachment [configure-320.tar.gz](tarball://root/attachments/some-uuid/ticket27270/configure-320.tar.gz) by git created at 2019-04-30 22:58:09\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-30T22:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380764",
    "user": "git"
}
```

Attachment [configure-320.tar.gz](tarball://root/attachments/some-uuid/ticket27270/configure-320.tar.gz) by git created at 2019-04-30 22:58:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-05-21T16:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380765",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_380766.json:
```json
{
    "body": "rebased over #27264, added dependency check",
    "created_at": "2019-05-21T16:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380766",
    "user": "dimpase"
}
```

rebased over #27264, added dependency check



---

archive/issue_comments_380767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-04T11:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380767",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380768.json:
```json
{
    "body": "Attachment [configure-323.tar.gz](tarball://root/attachments/some-uuid/ticket27270/configure-323.tar.gz) by dimpase created at 2019-06-04 11:44:49\n\nthis is now bundled with flint ticket. New configure tarball attached. I also squashed some commits, and rebased over 8.8.beta7",
    "created_at": "2019-06-04T11:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380768",
    "user": "dimpase"
}
```

Attachment [configure-323.tar.gz](tarball://root/attachments/some-uuid/ticket27270/configure-323.tar.gz) by dimpase created at 2019-06-04 11:44:49

this is now bundled with flint ticket. New configure tarball attached. I also squashed some commits, and rebased over 8.8.beta7



---

archive/issue_comments_380769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-04T11:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380769",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380770.json:
```json
{
    "body": "How come that 8.8.rc0 needs configure-323, which is here, not yet merged ??\n\n**EDIT:**\n\nAnd how can this depend on a duplicate/invalid/wontfix ticket ??",
    "created_at": "2019-06-09T18:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380770",
    "user": "chapoton"
}
```

How come that 8.8.rc0 needs configure-323, which is here, not yet merged ??

**EDIT:**

And how can this depend on a duplicate/invalid/wontfix ticket ??



---

archive/issue_comments_380771.json:
```json
{
    "body": "version numbers of these tarballs are autogenerated. they are otherwise pretty much meaningless.\n\nit is merely a bug in our release process that is needed to be workedaround, as builbots don\u2019t have autotools and cannot generate the stuff on the fly...",
    "created_at": "2019-06-09T20:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380771",
    "user": "dimpase"
}
```

version numbers of these tarballs are autogenerated. they are otherwise pretty much meaningless.

it is merely a bug in our release process that is needed to be workedaround, as builbots donâ€™t have autotools and cannot generate the stuff on the fly...



---

archive/issue_comments_380772.json:
```json
{
    "body": "Needs a new confball. I'd suggest to merge this in 8.9.beta0 so hold the horses until 8.8 is out. \n\nYou should remove the dependency on tickets that cannot be merged, the release script will wait until the dependencies are merged which, right now, is never.",
    "created_at": "2019-06-09T20:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380772",
    "user": "vbraun"
}
```

Needs a new confball. I'd suggest to merge this in 8.9.beta0 so hold the horses until 8.8 is out. 

You should remove the dependency on tickets that cannot be merged, the release script will wait until the dependencies are merged which, right now, is never.



---

archive/issue_comments_380773.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-09T20:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380773",
    "user": "vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_380774.json:
```json
{
    "body": "the branch here bundles the work done on #27264.",
    "created_at": "2019-06-10T08:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380774",
    "user": "dimpase"
}
```

the branch here bundles the work done on #27264.



---

archive/issue_comments_380775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-11T11:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380775",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380776.json:
```json
{
    "body": "rebased over 8.8.rc0 (without configure bump, for the time being)",
    "created_at": "2019-06-11T11:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380776",
    "user": "dimpase"
}
```

rebased over 8.8.rc0 (without configure bump, for the time being)



---

archive/issue_comments_380777.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380777",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_380778.json:
```json
{
    "body": "Replying to [comment:21 vbraun]:\n> Needs a new confball. I'd suggest to merge this in 8.9.beta0 so hold the horses until 8.8 is out. \n\nWould you like to get #27978 first?",
    "created_at": "2019-06-16T11:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380778",
    "user": "dimpase"
}
```

Replying to [comment:21 vbraun]:
> Needs a new confball. I'd suggest to merge this in 8.9.beta0 so hold the horses until 8.8 is out. 

Would you like to get #27978 first?



---

archive/issue_comments_380779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-29T08:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380780.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-29T08:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380780",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_380781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-03T15:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380782.json:
```json
{
    "body": "now rebased over 8.9.beta1, using sha1-based configure tarball\n\nPlease test!",
    "created_at": "2019-07-03T15:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380782",
    "user": "dimpase"
}
```

now rebased over 8.9.beta1, using sha1-based configure tarball

Please test!



---

archive/issue_comments_380783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-11T06:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380783",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380784.json:
```json
{
    "body": "rebased, config bump, added another name for the arb library (in Debian), mention it and flint in docs",
    "created_at": "2019-07-11T06:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380784",
    "user": "dimpase"
}
```

rebased, config bump, added another name for the arb library (in Debian), mention it and flint in docs



---

archive/issue_comments_380785.json:
```json
{
    "body": "with the latest branch on Debian buster, building `sage/libs/arb/arith.so` against system's arb (so it needs `-lflint-arb` and not `-larb` breaks with a linking error (as there is no `libarb`)\n\n\n```\n[sagelib-8.9.beta2] gcc -pthread -shared -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/arb/arith.o -L/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -lflint -larb -lgmp -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/libs/arb/arith.so\n[sagelib-8.9.beta2] /usr/bin/ld: cannot find -larb\n```\n\n\nIt apparently derives `-larb` somewhere in Cython, but where, and is there a way to override it?\n\nNote that `-lflint-arb` is known to the global makefile:\n\n```\nbuild/make/Makefile-auto:LIBS = -lrw -lreadline -lmpc -lgf2x -lcurl -lbz2 -lflint-arb -lflint -lmpfr -lgmp -lm  -lntl\n```\n",
    "created_at": "2019-07-11T06:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380785",
    "user": "dimpase"
}
```

with the latest branch on Debian buster, building `sage/libs/arb/arith.so` against system's arb (so it needs `-lflint-arb` and not `-larb` breaks with a linking error (as there is no `libarb`)


```
[sagelib-8.9.beta2] gcc -pthread -shared -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -Wl,-rpath,/home/dimpase/sage/local/lib build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/arb/arith.o -L/home/dimpase/sage/local/lib -L/home/dimpase/sage/local/lib -lflint -larb -lgmp -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/libs/arb/arith.so
[sagelib-8.9.beta2] /usr/bin/ld: cannot find -larb
```


It apparently derives `-larb` somewhere in Cython, but where, and is there a way to override it?

Note that `-lflint-arb` is known to the global makefile:

```
build/make/Makefile-auto:LIBS = -lrw -lreadline -lmpc -lgf2x -lcurl -lbz2 -lflint-arb -lflint -lmpfr -lgmp -lm  -lntl
```




---

archive/issue_comments_380786.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-07-11T06:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380786",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_380787.json:
```json
{
    "body": "I can apply\n\n\n```diff\n--- a/src/module_list.py\n+++ b/src/module_list.py\n@@ -79,7 +79,7 @@ library_order_list = aliases[\"SINGULAR_LIBRARIES\"] + [\n     \"ec\", \"ecm\",\n ] + aliases[\"LINBOX_LIBRARIES\"] + aliases[\"FFLASFFPACK_LIBRARIES\"] + aliases[\"GSL_LIBRARIES\"] + [\n     \"pari\", \"flint\", \"ratpoints\", \"ecl\", \"glpk\", \"ppl\",\n-    \"arb\", \"mpfi\", \"mpfr\", \"mpc\", \"gmp\", \"gmpxx\",\n+    \"flint-arb\", \"mpfi\", \"mpfr\", \"mpc\", \"gmp\", \"gmpxx\",\n     \"brial\",\n     \"brial_groebner\",\n     \"m4rie\",\n@@ -765,7 +765,7 @@ ext_modules = [\n \n     Extension(\"sage.matrix.matrix_complex_ball_dense\",\n               [\"sage/matrix/matrix_complex_ball_dense.pyx\"],\n-              libraries=['arb']),\n+              libraries=['flint-arb']),\n \n     Extension('sage.matrix.matrix_complex_double_dense',\n               sources = ['sage/matrix/matrix_complex_double_dense.pyx']),\n```\n\nand then it builds, but is this the correct way?",
    "created_at": "2019-07-11T09:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380787",
    "user": "dimpase"
}
```

I can apply


```diff
--- a/src/module_list.py
+++ b/src/module_list.py
@@ -79,7 +79,7 @@ library_order_list = aliases["SINGULAR_LIBRARIES"] + [
     "ec", "ecm",
 ] + aliases["LINBOX_LIBRARIES"] + aliases["FFLASFFPACK_LIBRARIES"] + aliases["GSL_LIBRARIES"] + [
     "pari", "flint", "ratpoints", "ecl", "glpk", "ppl",
-    "arb", "mpfi", "mpfr", "mpc", "gmp", "gmpxx",
+    "flint-arb", "mpfi", "mpfr", "mpc", "gmp", "gmpxx",
     "brial",
     "brial_groebner",
     "m4rie",
@@ -765,7 +765,7 @@ ext_modules = [
 
     Extension("sage.matrix.matrix_complex_ball_dense",
               ["sage/matrix/matrix_complex_ball_dense.pyx"],
-              libraries=['arb']),
+              libraries=['flint-arb']),
 
     Extension('sage.matrix.matrix_complex_double_dense',
               sources = ['sage/matrix/matrix_complex_double_dense.pyx']),
```

and then it builds, but is this the correct way?



---

archive/issue_comments_380788.json:
```json
{
    "body": "oops, scratch this, this change does not help, it appears there is some divining of `-larb` by Cython(?)",
    "created_at": "2019-07-11T09:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380788",
    "user": "dimpase"
}
```

oops, scratch this, this change does not help, it appears there is some divining of `-larb` by Cython(?)



---

archive/issue_comments_380789.json:
```json
{
    "body": "OK, so also some `#distutils` entries need to be modified. Debian applies\nhttps://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/d0-arb.patch",
    "created_at": "2019-07-12T11:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380789",
    "user": "dimpase"
}
```

OK, so also some `#distutils` entries need to be modified. Debian applies
https://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/d0-arb.patch



---

archive/issue_comments_380790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-15T18:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-15T20:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380792.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-07-15T20:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380792",
    "user": "dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_380793.json:
```json
{
    "body": "please review - should also work on Debian now...",
    "created_at": "2019-07-15T20:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380793",
    "user": "dimpase"
}
```

please review - should also work on Debian now...



---

archive/issue_comments_380794.json:
```json
{
    "body": "Quick impressions on the `arb` part. I would test for `flint-arb` first, otherwise you could get the other `arb` on a debian system. I would use `AC_SEARCH_LIBS` see https://autotools.io/autoconf/finding.html. When you use `AC_CHECK_LIBS` or `AC_SEARCH_LIBS`  the library found will be added  to `LIBS` and that may be used for all linkings independently of other settings - of course that's what would happen in a fully autotooled package. The question is whether all those `SAGE_${PKG}_LIBRARY` variables are needed at all.",
    "created_at": "2019-07-15T21:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380794",
    "user": "fbissey"
}
```

Quick impressions on the `arb` part. I would test for `flint-arb` first, otherwise you could get the other `arb` on a debian system. I would use `AC_SEARCH_LIBS` see https://autotools.io/autoconf/finding.html. When you use `AC_CHECK_LIBS` or `AC_SEARCH_LIBS`  the library found will be added  to `LIBS` and that may be used for all linkings independently of other settings - of course that's what would happen in a fully autotooled package. The question is whether all those `SAGE_${PKG}_LIBRARY` variables are needed at all.



---

archive/issue_comments_380795.json:
```json
{
    "body": "I have now read the stuff about `src/sage/env.py.in` and this is a no for me. I don't run configure to build the sage python library and don't intend to if I can help it. I certainly can prepare the sources if you force me too but I'd rather not have to do that.",
    "created_at": "2019-07-15T22:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380795",
    "user": "fbissey"
}
```

I have now read the stuff about `src/sage/env.py.in` and this is a no for me. I don't run configure to build the sage python library and don't intend to if I can help it. I certainly can prepare the sources if you force me too but I'd rather not have to do that.



---

archive/issue_comments_380796.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> Quick impressions on the `arb` part. I would test for `flint-arb` first, otherwise you could get the other `arb` on a debian system. \n\nnot really - it tests for a specific function from the \"right\" arb, I cannot imagine the other arb having it.\n\n> I would use `AC_SEARCH_LIBS` see https://autotools.io/autoconf/finding.html.\n\nI tried that, but then you have to analyse the result of its run, and this leads to arcane code (one needs to strip `-l`, etc...)\n \n\n> When you use `AC_CHECK_LIBS` or `AC_SEARCH_LIBS`  the library found will be added  to `LIBS` and that may be used for all linkings independently of other settings - of course that's what would happen in a fully autotooled package. The question is whether all those `SAGE_${PKG}_LIBRARY` variables are needed at all.\n\nThe problem is that sagelib isn't autotooled, and so one needes to get arb/flint-arb strings into `# distutils libraries=` directives in Cython header files.",
    "created_at": "2019-07-15T22:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380796",
    "user": "dimpase"
}
```

Replying to [comment:42 fbissey]:
> Quick impressions on the `arb` part. I would test for `flint-arb` first, otherwise you could get the other `arb` on a debian system. 

not really - it tests for a specific function from the "right" arb, I cannot imagine the other arb having it.

> I would use `AC_SEARCH_LIBS` see https://autotools.io/autoconf/finding.html.

I tried that, but then you have to analyse the result of its run, and this leads to arcane code (one needs to strip `-l`, etc...)
 

> When you use `AC_CHECK_LIBS` or `AC_SEARCH_LIBS`  the library found will be added  to `LIBS` and that may be used for all linkings independently of other settings - of course that's what would happen in a fully autotooled package. The question is whether all those `SAGE_${PKG}_LIBRARY` variables are needed at all.

The problem is that sagelib isn't autotooled, and so one needes to get arb/flint-arb strings into `# distutils libraries=` directives in Cython header files.



---

archive/issue_comments_380797.json:
```json
{
    "body": "Replying to [comment:43 fbissey]:\n> I have now read the stuff about `src/sage/env.py.in` and this is a no for me. I don't run configure to build the sage python library and don't intend to if I can help it. I certainly can prepare the sources if you force me too but I'd rather not have to do that.\n\nwell, I don't see a point of not running `./configure`. Perhaps it was fashionable in Python world 10-15 years ago :-)",
    "created_at": "2019-07-15T22:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380797",
    "user": "dimpase"
}
```

Replying to [comment:43 fbissey]:
> I have now read the stuff about `src/sage/env.py.in` and this is a no for me. I don't run configure to build the sage python library and don't intend to if I can help it. I certainly can prepare the sources if you force me too but I'd rather not have to do that.

well, I don't see a point of not running `./configure`. Perhaps it was fashionable in Python world 10-15 years ago :-)



---

archive/issue_comments_380798.json:
```json
{
    "body": "OK you are right about the library order. Because of the check you make it doesn't matter.\n\nIt is an interesting comment about configure. Unfortunately, as far as I know running configure for a python project is still not a done thing. It doesn't mesh with the other elements of the python toolchain. There is certainly room for some configurability option in sage in regards to the optional libraries. But autotool's configure is definitely not the python way. Apart from cypari I cannot think of another python package using configure.\n\nLet's be honest, a small configure script for sage's optional stuff and the possibly unusual stuff would be fine to run. The full configure script for the whole of the distribution is inappropriate. It all goes back, once again, to \"sagelib\" being treated special instead of as a normal package. So many things would have to click in place once you do that. Other superbuild systems like the one for paraview don't treat the main target in a special way like sage's does.",
    "created_at": "2019-07-15T22:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380798",
    "user": "fbissey"
}
```

OK you are right about the library order. Because of the check you make it doesn't matter.

It is an interesting comment about configure. Unfortunately, as far as I know running configure for a python project is still not a done thing. It doesn't mesh with the other elements of the python toolchain. There is certainly room for some configurability option in sage in regards to the optional libraries. But autotool's configure is definitely not the python way. Apart from cypari I cannot think of another python package using configure.

Let's be honest, a small configure script for sage's optional stuff and the possibly unusual stuff would be fine to run. The full configure script for the whole of the distribution is inappropriate. It all goes back, once again, to "sagelib" being treated special instead of as a normal package. So many things would have to click in place once you do that. Other superbuild systems like the one for paraview don't treat the main target in a special way like sage's does.



---

archive/issue_comments_380799.json:
```json
{
    "body": "Replying to [comment:46 fbissey]:\n\n> It is an interesting comment about configure. Unfortunately, as far as I know running configure for a python project is still not a done thing. It doesn't mesh with the other elements of the python toolchain. There is certainly room for some configurability option in sage in regards to the optional libraries. But autotool's configure is definitely not the python way. Apart from cypari I cannot think of another python package using configure.\n\nHave you ever heard of cpython? :-)\n\n> \n> Let's be honest, a small configure script for sage's optional stuff and the possibly unusual stuff would be fine to run. The full configure script for the whole of the distribution is inappropriate. It all goes back, once again, to \"sagelib\" being treated special instead of as a normal package. So many things would have to click in place once you do that. \n\nwell, writing thousands of lines of Python to do configuration and building is what is (mal)practiced by many Python packages for reasons I don't really get. \n\n\n> Other superbuild systems like the one for paraview don't treat the main target in a special way like sage's does.\n\nI suggest you might look at the build system of Tensorflow (it uses Bazel ;-))",
    "created_at": "2019-07-15T22:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380799",
    "user": "dimpase"
}
```

Replying to [comment:46 fbissey]:

> It is an interesting comment about configure. Unfortunately, as far as I know running configure for a python project is still not a done thing. It doesn't mesh with the other elements of the python toolchain. There is certainly room for some configurability option in sage in regards to the optional libraries. But autotool's configure is definitely not the python way. Apart from cypari I cannot think of another python package using configure.

Have you ever heard of cpython? :-)

> 
> Let's be honest, a small configure script for sage's optional stuff and the possibly unusual stuff would be fine to run. The full configure script for the whole of the distribution is inappropriate. It all goes back, once again, to "sagelib" being treated special instead of as a normal package. So many things would have to click in place once you do that. 

well, writing thousands of lines of Python to do configuration and building is what is (mal)practiced by many Python packages for reasons I don't really get. 


> Other superbuild systems like the one for paraview don't treat the main target in a special way like sage's does.

I suggest you might look at the build system of Tensorflow (it uses Bazel ;-))



---

archive/issue_comments_380800.json:
```json
{
    "body": "`cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.\n\n`bazel` and the way it is used in tensorflow [heck the whole way tensorflow is build] is a whole private hell of its own. Let's not go there. Invoking a worst project does not make yours any better. That reminds of my daughter pretending her room isn't messy because she saw a bigger mess at one of her friend's house.",
    "created_at": "2019-07-15T23:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380800",
    "user": "fbissey"
}
```

`cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.

`bazel` and the way it is used in tensorflow [heck the whole way tensorflow is build] is a whole private hell of its own. Let's not go there. Invoking a worst project does not make yours any better. That reminds of my daughter pretending her room isn't messy because she saw a bigger mess at one of her friend's house.



---

archive/issue_comments_380801.json:
```json
{
    "body": "Replying to [comment:48 fbissey]:\n> `cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.\n\nI don't claim any credibility, but merely observe that Python 3 is moving quite a bit of its build system from setup.py to autotools. \n\nI don't get it why pre-build manipulation of `Python/Cython` code must be done in Python or shell, and not with more suitable tools. Sounds like religion rather than common sense to me.",
    "created_at": "2019-07-15T23:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380801",
    "user": "dimpase"
}
```

Replying to [comment:48 fbissey]:
> `cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.

I don't claim any credibility, but merely observe that Python 3 is moving quite a bit of its build system from setup.py to autotools. 

I don't get it why pre-build manipulation of `Python/Cython` code must be done in Python or shell, and not with more suitable tools. Sounds like religion rather than common sense to me.



---

archive/issue_comments_380802.json:
```json
{
    "body": "Replying to [comment:49 dimpase]:\n> Replying to [comment:48 fbissey]:\n> > `cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.\n> \n> I don't claim any credibility, but merely observe that Python 3 is moving quite a bit of its build system from setup.py to autotools. \n> \n> I don't get it why pre-build manipulation of `Python/Cython` code must be done in Python or shell, and not with more suitable tools. Sounds like religion rather than common sense to me.\n\nI haven't seen that. But that is welcome in some way.\n\nBut the big issue we have in distro if I can pinpoint it better is not necessarily that you want to run configure. It is that you run configure for sage the distro and use it for sage the package. \"sagelib\" should be its own self contained package, and if it had its own configure why not. But leveraging your monster build system in the way you do, is not fine. __We don't want it.__",
    "created_at": "2019-07-16T00:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380802",
    "user": "fbissey"
}
```

Replying to [comment:49 dimpase]:
> Replying to [comment:48 fbissey]:
> > `cpython` is the language. While it would be interesting to see if python could bootstrap itself, I am considering that you are stretching your credibility there.
> 
> I don't claim any credibility, but merely observe that Python 3 is moving quite a bit of its build system from setup.py to autotools. 
> 
> I don't get it why pre-build manipulation of `Python/Cython` code must be done in Python or shell, and not with more suitable tools. Sounds like religion rather than common sense to me.

I haven't seen that. But that is welcome in some way.

But the big issue we have in distro if I can pinpoint it better is not necessarily that you want to run configure. It is that you run configure for sage the distro and use it for sage the package. "sagelib" should be its own self contained package, and if it had its own configure why not. But leveraging your monster build system in the way you do, is not fine. __We don't want it.__



---

archive/issue_comments_380803.json:
```json
{
    "body": "Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.\n\nThis ticket is a part of the unvendoring process. One way or another, the problem here is that arb library does not have pkg-config support, and yes, we want to support !Debian/Ubuntu arb package with non-standard naming.",
    "created_at": "2019-07-16T00:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380803",
    "user": "dimpase"
}
```

Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.

This ticket is a part of the unvendoring process. One way or another, the problem here is that arb library does not have pkg-config support, and yes, we want to support !Debian/Ubuntu arb package with non-standard naming.



---

archive/issue_comments_380804.json:
```json
{
    "body": "I understand perfectly. Since the controversial changes are for the sake of debian, I think a debian developer should give their opinion.\n\n`@`thansen if you would like to oblige or pass it to someone else in debian for review.\n\nAs I said I won't review this any further but won't oppose it further either. I have my own contingency plans.",
    "created_at": "2019-07-16T00:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380804",
    "user": "fbissey"
}
```

I understand perfectly. Since the controversial changes are for the sake of debian, I think a debian developer should give their opinion.

`@`thansen if you would like to oblige or pass it to someone else in debian for review.

As I said I won't review this any further but won't oppose it further either. I have my own contingency plans.



---

archive/issue_comments_380805.json:
```json
{
    "body": "alternatively I can store an environment variable in `src/bin/sage-env-config`\n(which, as you know, is also created by `./configure` :-))\nand then access it from `src/sage/env.py` to populate `ARB_LIBRARY`.\n\nThis would avoid creating `src/sage/env.py.in`.\n\nIf this is more acceptable (after all, distributions already deal with rewriting\n`src/bin/sage-env-config.in`) let me know, I can do this change.",
    "created_at": "2019-07-16T09:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380805",
    "user": "dimpase"
}
```

alternatively I can store an environment variable in `src/bin/sage-env-config`
(which, as you know, is also created by `./configure` :-))
and then access it from `src/sage/env.py` to populate `ARB_LIBRARY`.

This would avoid creating `src/sage/env.py.in`.

If this is more acceptable (after all, distributions already deal with rewriting
`src/bin/sage-env-config.in`) let me know, I can do this change.



---

archive/issue_comments_380806.json:
```json
{
    "body": "Replying to [comment:53 dimpase]:\n> alternatively I can store an environment variable in `src/bin/sage-env-config`\n> (which, as you know, is also created by `./configure` :-))\n> and then access it from `src/sage/env.py` to populate `ARB_LIBRARY`.\n> \n> This would avoid creating `src/sage/env.py.in`.\n> \n> If this is more acceptable (after all, distributions already deal with rewriting\n> `src/bin/sage-env-config.in`) let me know, I can do this change.\n\n+1 to this alternative. Setting env variables at build time is much better than having to tamper with source files.",
    "created_at": "2019-07-16T10:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380806",
    "user": "arojas"
}
```

Replying to [comment:53 dimpase]:
> alternatively I can store an environment variable in `src/bin/sage-env-config`
> (which, as you know, is also created by `./configure` :-))
> and then access it from `src/sage/env.py` to populate `ARB_LIBRARY`.
> 
> This would avoid creating `src/sage/env.py.in`.
> 
> If this is more acceptable (after all, distributions already deal with rewriting
> `src/bin/sage-env-config.in`) let me know, I can do this change.

+1 to this alternative. Setting env variables at build time is much better than having to tamper with source files.



---

archive/issue_comments_380807.json:
```json
{
    "body": "While it feels better to deal with an environment variable I wonder if it is better to elect to touch the source code here. \n\nPeople can compile cython code from sage against sage libraries. If we don't touch the code minimally and someone wants to compile some cython code from sage involving arb, they will have to define the variable unless we put it permanently in the environment in some way (which is also doable of course but I stopped doing that around sage-5.0 I think).",
    "created_at": "2019-07-16T10:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380807",
    "user": "fbissey"
}
```

While it feels better to deal with an environment variable I wonder if it is better to elect to touch the source code here. 

People can compile cython code from sage against sage libraries. If we don't touch the code minimally and someone wants to compile some cython code from sage involving arb, they will have to define the variable unless we put it permanently in the environment in some way (which is also doable of course but I stopped doing that around sage-5.0 I think).



---

archive/issue_comments_380808.json:
```json
{
    "body": "Well, you tell me what you prefer. I think that to compile cython code from sage against sage libraries requires pkg-config knowing about `SAGE_LOCAL/lib/pkgconfig` directory to pick up settings for quite a number of Sage libraries, otherwise it's doomed to fail.\nIn effect, this means either using Sage's pkg-config or providing a properly set `PKG_CONFIG_PATH`. That is you cannot get away from setting some environment variables.\n\nIn fact I plan to work on `spkg-configure.m4` for `pkgconf` Sage package (cf. #27827, a part of #27330) and to install `PKG_CONFIG_PATH` into `src/bin/sage-env-config` in case\na system has pkg-config installed.",
    "created_at": "2019-07-16T10:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380808",
    "user": "dimpase"
}
```

Well, you tell me what you prefer. I think that to compile cython code from sage against sage libraries requires pkg-config knowing about `SAGE_LOCAL/lib/pkgconfig` directory to pick up settings for quite a number of Sage libraries, otherwise it's doomed to fail.
In effect, this means either using Sage's pkg-config or providing a properly set `PKG_CONFIG_PATH`. That is you cannot get away from setting some environment variables.

In fact I plan to work on `spkg-configure.m4` for `pkgconf` Sage package (cf. #27827, a part of #27330) and to install `PKG_CONFIG_PATH` into `src/bin/sage-env-config` in case
a system has pkg-config installed.



---

archive/issue_comments_380809.json:
```json
{
    "body": "If it currently wouldn't work for cython code, then environment is best - it doesn't break something currently working. Thank you for pulling through my painful exhortations with something palatable.",
    "created_at": "2019-07-16T10:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380809",
    "user": "fbissey"
}
```

If it currently wouldn't work for cython code, then environment is best - it doesn't break something currently working. Thank you for pulling through my painful exhortations with something palatable.



---

archive/issue_comments_380810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-16T16:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380810",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380811.json:
```json
{
    "body": "OK, it's changed as discussed. Please review.",
    "created_at": "2019-07-16T16:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380811",
    "user": "dimpase"
}
```

OK, it's changed as discussed. Please review.



---

archive/issue_comments_380812.json:
```json
{
    "body": "FWIW sagelib builds fine against system packages now by just setting SAGE_ARB_LIBRARY (and not running configure)",
    "created_at": "2019-07-16T17:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380812",
    "user": "arojas"
}
```

FWIW sagelib builds fine against system packages now by just setting SAGE_ARB_LIBRARY (and not running configure)



---

archive/issue_comments_380813.json:
```json
{
    "body": "For what its worth, I'm fine with setting an environment variable. There are already lots of env vars to set, one more or less won't make a difference. And I'm also glad we can get around configure. Thanks Fran\u00e7ois for taking the distro standpoint here :)\n\nReplying to [comment:51 dimpase]:\n> Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.\n\nI feel like you're arguing slightly different things here. Treating the sagelib package as just another package could in principle be done without removing any vendoring. You keep the current build system, add a `sagelib` package under build, add basically everything as a dependency for it. `sagelib` can then have its own `./configure`, which configure just sagelib and not everything else. Distros would have not problem running that.",
    "created_at": "2019-07-16T18:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380813",
    "user": "@timokau"
}
```

For what its worth, I'm fine with setting an environment variable. There are already lots of env vars to set, one more or less won't make a difference. And I'm also glad we can get around configure. Thanks FranÃ§ois for taking the distro standpoint here :)

Replying to [comment:51 dimpase]:
> Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.

I feel like you're arguing slightly different things here. Treating the sagelib package as just another package could in principle be done without removing any vendoring. You keep the current build system, add a `sagelib` package under build, add basically everything as a dependency for it. `sagelib` can then have its own `./configure`, which configure just sagelib and not everything else. Distros would have not problem running that.



---

archive/issue_comments_380814.json:
```json
{
    "body": "Replying to [comment:62 gh-timokau]:\n> Replying to [comment:51 dimpase]:\n> > Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.\n> \n> I feel like you're arguing slightly different things here. Treating the sagelib package as just another package could in principle be done without removing any vendoring. \n\nthe main configure configures \"just\" sagelib. What one has in `build/pkgs/` are vendored dependencies, which ought to disappear.\nThese little (or not so little) `spkg-configure.m4` scripts are part of the sagelib configure, they check that the deps are satisfied.\nThey have nothing to do with building the relevant deps (they deal with NOT building them).\n\n> You keep the current build system, add a `sagelib` package under build, add basically everything as a dependency for it. `sagelib` can then have its own `./configure`, which configure just sagelib and not everything else. Distros would have not problem running that.",
    "created_at": "2019-07-16T19:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380814",
    "user": "dimpase"
}
```

Replying to [comment:62 gh-timokau]:
> Replying to [comment:51 dimpase]:
> > Unvendoring everything that was sheepishly vendored into Sage over the years is an essential step towards having a self contained package for sagelib alone.
> 
> I feel like you're arguing slightly different things here. Treating the sagelib package as just another package could in principle be done without removing any vendoring. 

the main configure configures "just" sagelib. What one has in `build/pkgs/` are vendored dependencies, which ought to disappear.
These little (or not so little) `spkg-configure.m4` scripts are part of the sagelib configure, they check that the deps are satisfied.
They have nothing to do with building the relevant deps (they deal with NOT building them).

> You keep the current build system, add a `sagelib` package under build, add basically everything as a dependency for it. `sagelib` can then have its own `./configure`, which configure just sagelib and not everything else. Distros would have not problem running that.



---

archive/issue_comments_380815.json:
```json
{
    "body": "I'll be waiting to see if the patchbot turns green, but in principle I am OK with this and will give it a positive review if no problems turn up.",
    "created_at": "2019-07-16T21:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380815",
    "user": "fbissey"
}
```

I'll be waiting to see if the patchbot turns green, but in principle I am OK with this and will give it a positive review if no problems turn up.



---

archive/issue_comments_380816.json:
```json
{
    "body": "not sure whether patchbots are able to deal well with packages changing configure; basically, for a proper test one needs to have appropriate versions of arb etc installed (so e.g. Debian 10 and Gentoo should be OK - and these are what I tested them on, as well as on other platforms, such as OSX with Homebrew).",
    "created_at": "2019-07-17T10:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380816",
    "user": "dimpase"
}
```

not sure whether patchbots are able to deal well with packages changing configure; basically, for a proper test one needs to have appropriate versions of arb etc installed (so e.g. Debian 10 and Gentoo should be OK - and these are what I tested them on, as well as on other platforms, such as OSX with Homebrew).



---

archive/issue_comments_380817.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-17T10:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380817",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_380818.json:
```json
{
    "body": "I was hoping the changes in the tarball handling would have helped with that. But obviously not. It is good enough, in my opinion, to send to the bots to figure if corner cases have been missed.",
    "created_at": "2019-07-17T10:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380818",
    "user": "fbissey"
}
```

I was hoping the changes in the tarball handling would have helped with that. But obviously not. It is good enough, in my opinion, to send to the bots to figure if corner cases have been missed.



---

archive/issue_comments_380819.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-07-19T11:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380819",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_380820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2019-07-19T11:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380820",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_380821.json:
```json
{
    "body": "fixing a \"minor\" m4 error in the latest change.",
    "created_at": "2019-07-19T11:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380821",
    "user": "dimpase"
}
```

fixing a "minor" m4 error in the latest change.



---

archive/issue_comments_380822.json:
```json
{
    "body": "Could you add a fallback for SAGE_ARB_LIBRARY in env.py? This wouldn't make any difference for users of the Sage build system (since it is set in sage-env-config) or distros that rename the arb library (which need to set it anyway), and would save distros that use the standard arb library name from having to worry about it\n\n\n```\n--- src/sage/env.py.orig        2019-07-19 14:05:32.947459540 +0200\n+++ src/sage/env.py     2019-07-19 14:15:14.193540393 +0200\n@@ -406,6 +406,8 @@\n     # This is not a problem in practice since LinBox depends on\n     # fflas-ffpack and fflas-ffpack does add such a C++11 flag.\n     aliases[\"LINBOX_CFLAGS\"].append(\"-std=gnu++11\")\n-    aliases[\"ARB_LIBRARY\"] = os.environ['SAGE_ARB_LIBRARY']\n-\n+    if os.environ.get('SAGE_ARB_LIBRARY'):\n+        aliases[\"ARB_LIBRARY\"] = os.environ['SAGE_ARB_LIBRARY']\n+    else:\n+        aliases[\"ARB_LIBRARY\"] = 'arb'\n     return aliases\n```\n",
    "created_at": "2019-07-19T12:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380822",
    "user": "arojas"
}
```

Could you add a fallback for SAGE_ARB_LIBRARY in env.py? This wouldn't make any difference for users of the Sage build system (since it is set in sage-env-config) or distros that rename the arb library (which need to set it anyway), and would save distros that use the standard arb library name from having to worry about it


```
--- src/sage/env.py.orig        2019-07-19 14:05:32.947459540 +0200
+++ src/sage/env.py     2019-07-19 14:15:14.193540393 +0200
@@ -406,6 +406,8 @@
     # This is not a problem in practice since LinBox depends on
     # fflas-ffpack and fflas-ffpack does add such a C++11 flag.
     aliases["LINBOX_CFLAGS"].append("-std=gnu++11")
-    aliases["ARB_LIBRARY"] = os.environ['SAGE_ARB_LIBRARY']
-
+    if os.environ.get('SAGE_ARB_LIBRARY'):
+        aliases["ARB_LIBRARY"] = os.environ['SAGE_ARB_LIBRARY']
+    else:
+        aliases["ARB_LIBRARY"] = 'arb'
     return aliases
```




---

archive/issue_comments_380823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-19T12:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380823",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_380824.json:
```json
{
    "body": "Done the fallback.",
    "created_at": "2019-07-19T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380824",
    "user": "dimpase"
}
```

Done the fallback.



---

archive/issue_comments_380825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-21T04:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380825",
    "user": "isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_380826.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2019-07-21T08:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380826",
    "user": "dimpase"
}
```

Last 10 new commits:



---

archive/issue_comments_380827.json:
```json
{
    "body": "merged u/isuruf/arbconfig (which erroneously contained just 1 commit), rebased over 8.9.beta3, bumpled up configure",
    "created_at": "2019-07-21T08:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380827",
    "user": "dimpase"
}
```

merged u/isuruf/arbconfig (which erroneously contained just 1 commit), rebased over 8.9.beta3, bumpled up configure



---

archive/issue_comments_380828.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-26T20:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380828",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_380829.json:
```json
{
    "body": "Recognizing `flint-arb` here broke the optional package `e-antic` (used by `normaliz`). Follow-up = #27952.",
    "created_at": "2020-02-06T23:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27033",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27033#issuecomment-380829",
    "user": "mkoeppe"
}
```

Recognizing `flint-arb` here broke the optional package `e-antic` (used by `normaliz`). Follow-up = #27952.
