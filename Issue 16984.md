# Issue 16984: New method transducers.Recursion

archive/issues_016984.json:
```json
{
    "body": "CC:  skropf @dkrenn\n\nKeywords: recursion\n\nA new transducer generator for sequences given by a certain type of recursions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17221\n\n",
    "created_at": "2014-10-25T15:09:07Z",
    "labels": [
        "component: finite state machines"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "New method transducers.Recursion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16984",
    "user": "https://github.com/cheuberg"
}
```
CC:  skropf @dkrenn

Keywords: recursion

A new transducer generator for sequences given by a certain type of recursions.

Issue created by migration from https://trac.sagemath.org/ticket/17221





---

archive/issue_comments_224909.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-25T15:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224909",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224910.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-24T05:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224910",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224911.json:
```json
{
    "body": "Needs to be rewritten to avoid using the recursion where the sequence is not defined.",
    "created_at": "2015-01-24T05:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224911",
    "user": "https://github.com/cheuberg"
}
```

Needs to be rewritten to avoid using the recursion where the sequence is not defined.



---

archive/issue_comments_224912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-07T14:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224913.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-07T14:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224913",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_049859.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-02-07T14:39:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16984#event-49859"
}
```



---

archive/issue_comments_224914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-09T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224915.json:
```json
{
    "body": "Merged #17752 and adapted `[HKP2015]`.",
    "created_at": "2015-02-09T10:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224915",
    "user": "https://github.com/cheuberg"
}
```

Merged #17752 and adapted `[HKP2015]`.



---

archive/issue_comments_224916.json:
```json
{
    "body": "Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:\n\n- coercions mentioned w.r.t. output rings are conversions\n\n- maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)\n\n- I'm not sure if it is good to mention \"Python int\" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))\n\n- T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.\n\n- example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.\n\n- still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.\n\n- example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.\n\nApart from those things: code looks good, doc builds, tests pass. I did not check the math of the ticket, only the examples (these seem to be correct). I would be happy if someone else could help with this part.\n\nI've also made a couple of small changes (PEP8; docstrings) which I'll upload soon.",
    "created_at": "2015-02-09T13:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224916",
    "user": "https://github.com/dkrenn"
}
```

Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:

- coercions mentioned w.r.t. output rings are conversions

- maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)

- I'm not sure if it is good to mention "Python int" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))

- T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.

- example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.

- still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.

- example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.

Apart from those things: code looks good, doc builds, tests pass. I did not check the math of the ticket, only the examples (these seem to be correct). I would be happy if someone else could help with this part.

I've also made a couple of small changes (PEP8; docstrings) which I'll upload soon.



---

archive/issue_comments_224917.json:
```json
{
    "body": "Added a small reviewer patch.\n----\nNew commits:",
    "created_at": "2015-02-09T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224917",
    "user": "https://github.com/dkrenn"
}
```

Added a small reviewer patch.
----
New commits:



---

archive/issue_comments_224918.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-09T15:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224918",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224919.json:
```json
{
    "body": "Cross-reviewed your reviewer patch, is fine, thank you.",
    "created_at": "2015-02-10T16:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224919",
    "user": "https://github.com/cheuberg"
}
```

Cross-reviewed your reviewer patch, is fine, thank you.



---

archive/issue_comments_224920.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-02-11T19:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224920",
    "user": "https://github.com/cheuberg"
}
```

Last 10 new commits:



---

archive/issue_comments_224921.json:
```json
{
    "body": "Replying to [comment:7 dkrenn]:\n> Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:\n> \n> - coercions mentioned w.r.t. output rings are conversions\n\ndone: [aeaebf1](http://git.sagemath.org/sage.git/commit/?id=aeaebf188c09556603c9ba96894b9188aa4ab340)\n\n> - maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)\n\ndone: [969160c](http://git.sagemath.org/sage.git/commit/?id=969160c46769b11fa93c5681f39f53226fb486f7)\n\n> - I'm not sure if it is good to mention \"Python int\" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))\n\ndone: [f891643](http://git.sagemath.org/sage.git/commit/?id=f8916435d312a1ea0180c756b9e332358d20da15)\n\nIn fact, as a by-product of [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221), Python int cannot occur any more.\n\n> - T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.\n\nThis lead to a new concept for the whole method: it is more general to interpret `+` as addition of words than to interpret it in a ring. So this has been changed in [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221). I somehow reworded this sentence you mention here, please check whether it is clearer now.\n\n> - example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.\n\nI replaced the example by the weight of the ternary expansion; here it should be clearer. Concrete example and more explanations added ([83f1c03](http://git.sagemath.org/sage.git/commit/?id=83f1c033f3a404a5e22a6bd9704a2f25430fea0a)).\n\n> - still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.\n\nDone: [aa37aaf](http://git.sagemath.org/sage.git/commit/?id=aa37aaf70d9a282198962302901cbc4f436636cf)\n\n> - example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.\n\nDone: [9594dca](http://git.sagemath.org/sage.git/commit/?id=9594dcab636c522f90622dd48b4413fabb9bff38)",
    "created_at": "2015-02-11T19:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224921",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:7 dkrenn]:
> Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:
> 
> - coercions mentioned w.r.t. output rings are conversions

done: [aeaebf1](http://git.sagemath.org/sage.git/commit/?id=aeaebf188c09556603c9ba96894b9188aa4ab340)

> - maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)

done: [969160c](http://git.sagemath.org/sage.git/commit/?id=969160c46769b11fa93c5681f39f53226fb486f7)

> - I'm not sure if it is good to mention "Python int" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))

done: [f891643](http://git.sagemath.org/sage.git/commit/?id=f8916435d312a1ea0180c756b9e332358d20da15)

In fact, as a by-product of [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221), Python int cannot occur any more.

> - T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.

This lead to a new concept for the whole method: it is more general to interpret `+` as addition of words than to interpret it in a ring. So this has been changed in [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221). I somehow reworded this sentence you mention here, please check whether it is clearer now.

> - example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.

I replaced the example by the weight of the ternary expansion; here it should be clearer. Concrete example and more explanations added ([83f1c03](http://git.sagemath.org/sage.git/commit/?id=83f1c033f3a404a5e22a6bd9704a2f25430fea0a)).

> - still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.

Done: [aa37aaf](http://git.sagemath.org/sage.git/commit/?id=aa37aaf70d9a282198962302901cbc4f436636cf)

> - example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.

Done: [9594dca](http://git.sagemath.org/sage.git/commit/?id=9594dcab636c522f90622dd48b4413fabb9bff38)



---

archive/issue_comments_224922.json:
```json
{
    "body": "Apart from that, I made three more changes:\n\n* [4d160d7](http://git.sagemath.org/sage.git/commit/?id=4d160d727d8d929b035f30247f4f9800d4476901) Trac #17221: move parsing of equation to a different method\n\n  transducers.Recursions had two major parts: parsing the symbolic\n  equations and actual construction of the transducer. These first part\n  has now been refactored into a new method.\n\n* [446f8f4](http://git.sagemath.org/sage.git/commit/?id=446f8f41aa839181fa1e092cb9431756b8f5efb2) Trac #17221: Allow alternative input format (rules)\n\n  Allow to enter the recursions in the form of rules as they are stored\n  internally. In that case, no symbolic function and no variable are needed,\n  so the order of the parameters has been changed.\n\n* [25e02eb](http://git.sagemath.org/sage.git/commit/?id=25e02eb04cb3ab1b8ac820528f586f637fe1aeca) Trac #17221: Allow negative residues r in recursion rules.",
    "created_at": "2015-02-11T19:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224922",
    "user": "https://github.com/cheuberg"
}
```

Apart from that, I made three more changes:

* [4d160d7](http://git.sagemath.org/sage.git/commit/?id=4d160d727d8d929b035f30247f4f9800d4476901) Trac #17221: move parsing of equation to a different method

  transducers.Recursions had two major parts: parsing the symbolic
  equations and actual construction of the transducer. These first part
  has now been refactored into a new method.

* [446f8f4](http://git.sagemath.org/sage.git/commit/?id=446f8f41aa839181fa1e092cb9431756b8f5efb2) Trac #17221: Allow alternative input format (rules)

  Allow to enter the recursions in the form of rules as they are stored
  internally. In that case, no symbolic function and no variable are needed,
  so the order of the parameters has been changed.

* [25e02eb](http://git.sagemath.org/sage.git/commit/?id=25e02eb04cb3ab1b8ac820528f586f637fe1aeca) Trac #17221: Allow negative residues r in recursion rules.



---

archive/issue_comments_224923.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-11T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224923",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_224924.json:
```json
{
    "body": "Changing keywords from \"recursion\" to \"recursion, sd66\".",
    "created_at": "2015-04-01T18:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224924",
    "user": "https://github.com/dkrenn"
}
```

Changing keywords from "recursion" to "recursion, sd66".



---

archive/issue_comments_224925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-01T18:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224925",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224926.json:
```json
{
    "body": "Looks good. Tests pass. Docstrings good. Positive!\n----\nNew commits:",
    "created_at": "2015-04-01T18:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224926",
    "user": "https://github.com/dkrenn"
}
```

Looks good. Tests pass. Docstrings good. Positive!
----
New commits:



---

archive/issue_comments_224927.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-04-13T07:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224927",
    "user": "https://trac.sagemath.org/admin/accounts/users/skropf"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_224928.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-13T11:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224929.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-13T11:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224929",
    "user": "https://trac.sagemath.org/admin/accounts/users/skropf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224930.json:
```json
{
    "body": "For me, it is also ok. Positive review.",
    "created_at": "2015-04-13T11:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224930",
    "user": "https://trac.sagemath.org/admin/accounts/users/skropf"
}
```

For me, it is also ok. Positive review.



---

archive/issue_comments_224931.json:
```json
{
    "body": "For the record: The doctest removed in [2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba) was a duplicate. This explains its removal.",
    "created_at": "2015-04-13T16:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224931",
    "user": "https://github.com/cheuberg"
}
```

For the record: The doctest removed in [2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba) was a duplicate. This explains its removal.



---

archive/issue_events_049860.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16984#event-49860"
}
```



---

archive/issue_comments_224932.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224932",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_224933.json:
```json
{
    "body": "Replying to [comment:20 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba)||`Trac #17221: Minor changes in the documentation`||\n\nThis last commit has not been merged, see the discussion at [sage-devel](https://groups.google.com/d/msg/sage-devel/tQhromqp9hQ/KDCvCnKEd1kJ). Follow-up ticket is #18206.",
    "created_at": "2015-04-17T04:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16984#issuecomment-224933",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:20 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba)||`Trac #17221: Minor changes in the documentation`||

This last commit has not been merged, see the discussion at [sage-devel](https://groups.google.com/d/msg/sage-devel/tQhromqp9hQ/KDCvCnKEd1kJ). Follow-up ticket is #18206.
