# Issue 16984: New method transducers.Recursion

Issue created by migration from Trac.

Original creator: cheuberg

Original creation time: 2014-10-25 15:09:07

CC:  skropf dkrenn

Keywords: recursion

A new transducer generator for sequences given by a certain type of recursions.


---

Comment by cheuberg created at 2014-10-25 15:09:28

Changing status from new to needs_review.


---

Comment by cheuberg created at 2015-01-24 05:55:50

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2015-01-24 05:55:50

Needs to be rewritten to avoid using the recursion where the sequence is not defined.


---

Comment by git created at 2015-02-07 14:37:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-02-07 14:39:42

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-02-09 10:56:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-02-09 10:57:51

Merged #17752 and adapted `[HKP2015]`.


---

Comment by dkrenn created at 2015-02-09 13:52:52

Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:

- coercions mentioned w.r.t. output rings are conversions

- maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)

- I'm not sure if it is good to mention "Python int" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))

- T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.

- example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.

- still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.

- example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.

Apart from those things: code looks good, doc builds, tests pass. I did not check the math of the ticket, only the examples (these seem to be correct). I would be happy if someone else could help with this part.

I've also made a couple of small changes (PEP8; docstrings) which I'll upload soon.


---

Comment by dkrenn created at 2015-02-09 13:57:30

Added a small reviewer patch.
----
New commits:


---

Comment by dkrenn created at 2015-02-09 15:12:18

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2015-02-10 16:07:22

Cross-reviewed your reviewer patch, is fine, thank you.


---

Comment by cheuberg created at 2015-02-11 19:00:47

Last 10 new commits:


---

Comment by cheuberg created at 2015-02-11 19:04:44

Replying to [comment:7 dkrenn]:
> Review of 1ab837dc5f069e044af903439caa8807b9739102. Here are a couple of things that could be improved:
> 
> - coercions mentioned w.r.t. output rings are conversions

done: [aeaebf1](http://git.sagemath.org/sage.git/commit/?id=aeaebf188c09556603c9ba96894b9188aa4ab340)

> - maybe: range(base.abs())  --> srange(base.abs())  (in code and docstring)

done: [969160c](http://git.sagemath.org/sage.git/commit/?id=969160c46769b11fa93c5681f39f53226fb486f7)

> - I'm not sure if it is good to mention "Python int" at all (in docstring), since usually they shouldn't appear (maybe adapt your code (where necessary) to avoid Python-int output (if any appears; not checked by me))

done: [f891643](http://git.sagemath.org/sage.git/commit/?id=f8916435d312a1ea0180c756b9e332358d20da15)

In fact, as a by-product of [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221), Python int cannot occur any more.

> - T(expansion) ==f(n) is confusing, e.g. in the first example (binary sum of digits) you would have here [1,1,1] = T([1,1,1]) = f(7) = 3.

This lead to a new concept for the whole method: it is more general to interpret `+` as addition of words than to interpret it in a ring. So this has been changed in [85efb10](http://git.sagemath.org/sage.git/commit/?id=85efb10d3e0afc4546093e81de99107848f2b221). I somehow reworded this sentence you mention here, please check whether it is clearer now.

> - example binary sum of digits: Maybe (for a deeper understanding) it helps, if one could see the output of the transducer on a concrete example. Maybe also write one sentence why binary sum of digits gives the Identity-transducer and how one can see the sum of digits somewhere.

I replaced the example by the weight of the ternary expansion; here it should be clearer. Concrete example and more explanations added ([83f1c03](http://git.sagemath.org/sage.git/commit/?id=83f1c033f3a404a5e22a6bd9704a2f25430fea0a)).

> - still example binary sum of digits: there is a lot about output_rings...is this needed in the first example already? Maybe make that a second example or at least separate it from the first example, so that it is clear, this is not needed to understand in the introductory example.

Done: [aa37aaf](http://git.sagemath.org/sage.git/commit/?id=aa37aaf70d9a282198962302901cbc4f436636cf)

> - example nonadjacent form: it would be good to include concrete examples here as well, so that one sees a NAF and its weight. Also: at the moment digits -1 are not considered, but in the wiki-article they are mentioned at the top; this could lead to some confusion.

Done: [9594dca](http://git.sagemath.org/sage.git/commit/?id=9594dcab636c522f90622dd48b4413fabb9bff38)


---

Comment by cheuberg created at 2015-02-11 19:05:01

Apart from that, I made three more changes:

* [4d160d7](http://git.sagemath.org/sage.git/commit/?id=4d160d727d8d929b035f30247f4f9800d4476901) Trac #17221: move parsing of equation to a different method

  transducers.Recursions had two major parts: parsing the symbolic
  equations and actual construction of the transducer. These first part
  has now been refactored into a new method.

* [446f8f4](http://git.sagemath.org/sage.git/commit/?id=446f8f41aa839181fa1e092cb9431756b8f5efb2) Trac #17221: Allow alternative input format (rules)

  Allow to enter the recursions in the form of rules as they are stored
  internally. In that case, no symbolic function and no variable are needed,
  so the order of the parameters has been changed.

* [25e02eb](http://git.sagemath.org/sage.git/commit/?id=25e02eb04cb3ab1b8ac820528f586f637fe1aeca) Trac #17221: Allow negative residues r in recursion rules.


---

Comment by cheuberg created at 2015-02-11 19:05:14

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2015-04-01 18:54:17

Changing keywords from "recursion" to "recursion, sd66".


---

Comment by dkrenn created at 2015-04-01 18:54:17

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2015-04-01 18:54:17

Looks good. Tests pass. Docstrings good. Positive!
----
New commits:


---

Comment by skropf created at 2015-04-13 07:00:58

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-04-13 11:22:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by skropf created at 2015-04-13 11:23:38

Changing status from needs_review to positive_review.


---

Comment by skropf created at 2015-04-13 11:23:38

For me, it is also ok. Positive review.


---

Comment by cheuberg created at 2015-04-13 16:27:45

For the record: The doctest removed in [2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba) was a duplicate. This explains its removal.


---

Comment by vbraun created at 2015-04-14 19:44:07

Resolution: fixed


---

Comment by cheuberg created at 2015-04-17 04:20:18

Replying to [comment:20 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[2e62790](http://git.sagemath.org/sage.git/commit/?id=2e62790eeec6463562120c204a86ebb323fa7cba)||`Trac #17221: Minor changes in the documentation`||

This last commit has not been merged, see the discussion at [sage-devel](https://groups.google.com/d/msg/sage-devel/tQhromqp9hQ/KDCvCnKEd1kJ). Follow-up ticket is #18206.
