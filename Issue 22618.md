# Issue 22618: Add weight space permutahedron for Coxeter matrix group

Issue created by migration from https://trac.sagemath.org/ticket/22855

Original creator: aram.dermenjian

Original creation time: 2017-04-21 19:00:06

CC:  tscrim chapoton stumpc5

Keywords: sagedays86

Using almost the same code from ReflectionGroup and adding it to CoxeterMatrixGroup in order to allow constructing a weight space permutahedron in a Coxeter matrix group and not just in reflection groups.


---

Comment by aram.dermenjian created at 2017-04-21 19:41:13

Changing status from new to needs_review.


---

Comment by aram.dermenjian created at 2017-04-21 19:41:13

New commits:


---

Comment by tscrim created at 2017-04-22 02:17:02

Can we lift this to the category and use more generic code (i.e., by using the `canonical_matrix`)?

I'm also a little worried about using the fundamental weights for a few reasons. The first is the choice of a weight lattice I think means we have chosen a Cartan type, which is a little bit of extra data. The second is that the simple roots are not necessarily linearly independent when described by the fundamental weights, e.g., in affine types you need an extra element `\delta`.

Actually, the `ReflectionGroup_real.permutahedron` says in a `.. NOTE::` that it is in the root system basis. Christian, do you have any comments on this?

Minor doc point, you need an extra blank line:

```diff
         .. NOTE::
+
             The result is expressed in the root basis coordinates.
```



---

Comment by aram.dermenjian created at 2017-04-22 12:54:08

I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.

For the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.

For your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.

I missed that. The extra blank line has been added.


---

Comment by git created at 2017-04-22 12:54:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-22 13:32:14

Replying to [comment:5 aram.dermenjian]:
> I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.

The `canonical_matrix` is suppose to be with respect to the root basis (i.e., the canonical faithful representation), so there is nothing you need to test.

Actually, the bilinear form (can be obtained from the Coxeter matrix, which is basically a required method) and fundamental weights (which comes from the bilinear form) both should be lifted to the category.

> For the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.

Ah, right, it is just the dual basis wrt the bilinear form. Which roots are short and long are not relevant.

> For your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.

Yes, we should definitely check that the group is finite, otherwise the permutahedron would run for forever. For example, I believe this would never terminate:

```
sage: W = CoxeterGroup([[1,7,2],[7,1,3],[2,3,1]])
sage: W.bilinear_form().det()
-1/2*E(7) - 1/4*E(7)^2 - 1/4*E(7)^3 - 1/4*E(7)^4 - 1/4*E(7)^5 - 1/2*E(7)^6
sage: W.permutahedron()
# Wait until the end of the universe
```



---

Comment by tscrim created at 2017-04-22 13:32:43

Also, we should shrink the plot width to `300 px`.


---

Comment by git created at 2017-04-25 13:37:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2017-04-25 13:39:04

I've gone ahead and used the canonical_matrix as desired and also decreased the plot width to 300px. There is now a TypeError warning when the coxeter group is infinite. Let me know if you'd like the wording on that changed.[]
----
New commits:


---

Comment by tscrim created at 2017-04-26 03:16:05

Actually, we could drop the finite check if we lift this to the category of finite Coxeter groups, which I think we should do now as the implementation is generic.


---

Comment by git created at 2017-05-10 20:03:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2017-05-10 20:06:41

Ok, I've pushed it up to the finite coxeter group category. (Thus I've removed the finite test as it's only in finite groups) I couldn't test the ReflectionGroup section as I don't have chevie on my computer. It would be nice to get that double checked though as the code is slightly different than what was there before. (The tests have been ported over)


---

Comment by tscrim created at 2017-05-10 21:32:13

I fixed the indentation of the `permutahedron` method. I made `fundamental_weights` returns a `Family` for the Coxeter matrix group and cached the result. I also changed the base ring to be an input to `permutahedron`, and if it is not given, it defaults to the base ring that the vertices are computed over. IMO this is better because it should be defined over the common ring that contains the fundamental weights and the image of the action of the Coxeter group.

I've tested this with `gap3`. If you agree with my changes, then positive review.
----
New commits:


---

Comment by aram.dermenjian created at 2017-05-11 14:43:01

The changes look ok to me. Your idea for the base ring is a good one. Is there a reason you switched it to a family instead of leaving it as a dictionary? Does it help with performance?


---

Comment by aram.dermenjian created at 2017-05-11 14:43:01

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-05-11 14:50:37

It allows us to cache the result, which has a performance gain, and is a more standard idiom for things like this.


---

Comment by vbraun created at 2017-05-13 20:54:38


```
sage -t --long --warn-long 65.0 src/sage/combinat/subword_complex.py  # 4 doctests failed
```



---

Comment by vbraun created at 2017-05-13 20:54:38

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-05-13 22:37:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-13 22:38:01

Whoops, forgot to retest that file after changing to a `Family`. Simple fix.


---

Comment by tscrim created at 2017-05-13 22:38:01

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-05-18 01:41:11

Patchbot is (essentially) green.


---

Comment by tscrim created at 2017-05-25 05:04:07

ping


---

Comment by aram.dermenjian created at 2017-05-30 10:40:48

Sorry for the delay, it's been a busy couple weeks. Everything looks good from here. Tested things out and everything seems to work ok.


---

Comment by aram.dermenjian created at 2017-05-30 10:40:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-31 22:25:37

Resolution: fixed
