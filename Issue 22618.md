# Issue 22618: Add weight space permutahedron for Coxeter matrix group

archive/issues_022618.json:
```json
{
    "body": "CC:  tscrim chapoton stumpc5\n\nKeywords: sagedays86\n\nUsing almost the same code from ReflectionGroup and adding it to CoxeterMatrixGroup in order to allow constructing a weight space permutahedron in a Coxeter matrix group and not just in reflection groups.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22855\n\n",
    "created_at": "2017-04-21T19:00:06Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Add weight space permutahedron for Coxeter matrix group",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22618",
    "user": "aram.dermenjian"
}
```
CC:  tscrim chapoton stumpc5

Keywords: sagedays86

Using almost the same code from ReflectionGroup and adding it to CoxeterMatrixGroup in order to allow constructing a weight space permutahedron in a Coxeter matrix group and not just in reflection groups.

Issue created by migration from https://trac.sagemath.org/ticket/22855





---

archive/issue_comments_315587.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-21T19:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315587",
    "user": "aram.dermenjian"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315588.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-21T19:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315588",
    "user": "aram.dermenjian"
}
```

New commits:



---

archive/issue_comments_315589.json:
```json
{
    "body": "Can we lift this to the category and use more generic code (i.e., by using the `canonical_matrix`)?\n\nI'm also a little worried about using the fundamental weights for a few reasons. The first is the choice of a weight lattice I think means we have chosen a Cartan type, which is a little bit of extra data. The second is that the simple roots are not necessarily linearly independent when described by the fundamental weights, e.g., in affine types you need an extra element `\\delta`.\n\nActually, the `ReflectionGroup_real.permutahedron` says in a `.. NOTE::` that it is in the root system basis. Christian, do you have any comments on this?\n\nMinor doc point, you need an extra blank line:\n\n```diff\n         .. NOTE::\n+\n             The result is expressed in the root basis coordinates.\n```\n",
    "created_at": "2017-04-22T02:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315589",
    "user": "tscrim"
}
```

Can we lift this to the category and use more generic code (i.e., by using the `canonical_matrix`)?

I'm also a little worried about using the fundamental weights for a few reasons. The first is the choice of a weight lattice I think means we have chosen a Cartan type, which is a little bit of extra data. The second is that the simple roots are not necessarily linearly independent when described by the fundamental weights, e.g., in affine types you need an extra element `\delta`.

Actually, the `ReflectionGroup_real.permutahedron` says in a `.. NOTE::` that it is in the root system basis. Christian, do you have any comments on this?

Minor doc point, you need an extra blank line:

```diff
         .. NOTE::
+
             The result is expressed in the root basis coordinates.
```




---

archive/issue_comments_315590.json:
```json
{
    "body": "I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.\n\nFor the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.\n\nFor your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.\n\nI missed that. The extra blank line has been added.",
    "created_at": "2017-04-22T12:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315590",
    "user": "aram.dermenjian"
}
```

I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.

For the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.

For your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.

I missed that. The extra blank line has been added.



---

archive/issue_comments_315591.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-22T12:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315591",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315592.json:
```json
{
    "body": "Replying to [comment:5 aram.dermenjian]:\n> I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.\n\nThe `canonical_matrix` is suppose to be with respect to the root basis (i.e., the canonical faithful representation), so there is nothing you need to test.\n\nActually, the bilinear form (can be obtained from the Coxeter matrix, which is basically a required method) and fundamental weights (which comes from the bilinear form) both should be lifted to the category.\n\n> For the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.\n\nAh, right, it is just the dual basis wrt the bilinear form. Which roots are short and long are not relevant.\n\n> For your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.\n\nYes, we should definitely check that the group is finite, otherwise the permutahedron would run for forever. For example, I believe this would never terminate:\n\n```\nsage: W = CoxeterGroup([[1,7,2],[7,1,3],[2,3,1]])\nsage: W.bilinear_form().det()\n-1/2*E(7) - 1/4*E(7)^2 - 1/4*E(7)^3 - 1/4*E(7)^4 - 1/4*E(7)^5 - 1/2*E(7)^6\nsage: W.permutahedron()\n# Wait until the end of the universe\n```\n",
    "created_at": "2017-04-22T13:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315592",
    "user": "tscrim"
}
```

Replying to [comment:5 aram.dermenjian]:
> I had looked into moving this up to the category, but there are a few reasons I was a little hesitant. It seems like the way coxeter matrices are constructed/stored are different between the three main Coxeter group classes (CoxeterMatrixGroups, WeylGroups, and ReflectionGroups). In order to make it work in the category we'd need to add individual tests to find the matrix. The canonical matrix is a little tricky as it is only defined on an element. So we'd need to create an element just to grab it's canonical_matrix.

The `canonical_matrix` is suppose to be with respect to the root basis (i.e., the canonical faithful representation), so there is nothing you need to test.

Actually, the bilinear form (can be obtained from the Coxeter matrix, which is basically a required method) and fundamental weights (which comes from the bilinear form) both should be lifted to the category.

> For the fundamental_weights, it actually looks at the bilinear form which is only looking at the coxeter matrix. So in the case of CoxeterMatrixGroups there is not that extra bit of data.

Ah, right, it is just the dual basis wrt the bilinear form. Which roots are short and long are not relevant.

> For your second concern, for affine Coxeter groups, fundamental_weights already breaks on affine Coxeter groups due to the concern you described above. So in this case the permutahedron would throw the same error as fundamental weights will. To alter the error we can always check to make sure the group is finite and throw an error if not and go from there.

Yes, we should definitely check that the group is finite, otherwise the permutahedron would run for forever. For example, I believe this would never terminate:

```
sage: W = CoxeterGroup([[1,7,2],[7,1,3],[2,3,1]])
sage: W.bilinear_form().det()
-1/2*E(7) - 1/4*E(7)^2 - 1/4*E(7)^3 - 1/4*E(7)^4 - 1/4*E(7)^5 - 1/2*E(7)^6
sage: W.permutahedron()
# Wait until the end of the universe
```




---

archive/issue_comments_315593.json:
```json
{
    "body": "Also, we should shrink the plot width to `300 px`.",
    "created_at": "2017-04-22T13:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315593",
    "user": "tscrim"
}
```

Also, we should shrink the plot width to `300 px`.



---

archive/issue_comments_315594.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-25T13:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315594",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315595.json:
```json
{
    "body": "I've gone ahead and used the canonical_matrix as desired and also decreased the plot width to 300px. There is now a TypeError warning when the coxeter group is infinite. Let me know if you'd like the wording on that changed.[]\n----\nNew commits:",
    "created_at": "2017-04-25T13:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315595",
    "user": "aram.dermenjian"
}
```

I've gone ahead and used the canonical_matrix as desired and also decreased the plot width to 300px. There is now a TypeError warning when the coxeter group is infinite. Let me know if you'd like the wording on that changed.[]
----
New commits:



---

archive/issue_comments_315596.json:
```json
{
    "body": "Actually, we could drop the finite check if we lift this to the category of finite Coxeter groups, which I think we should do now as the implementation is generic.",
    "created_at": "2017-04-26T03:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315596",
    "user": "tscrim"
}
```

Actually, we could drop the finite check if we lift this to the category of finite Coxeter groups, which I think we should do now as the implementation is generic.



---

archive/issue_comments_315597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315598.json:
```json
{
    "body": "Ok, I've pushed it up to the finite coxeter group category. (Thus I've removed the finite test as it's only in finite groups) I couldn't test the ReflectionGroup section as I don't have chevie on my computer. It would be nice to get that double checked though as the code is slightly different than what was there before. (The tests have been ported over)",
    "created_at": "2017-05-10T20:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315598",
    "user": "aram.dermenjian"
}
```

Ok, I've pushed it up to the finite coxeter group category. (Thus I've removed the finite test as it's only in finite groups) I couldn't test the ReflectionGroup section as I don't have chevie on my computer. It would be nice to get that double checked though as the code is slightly different than what was there before. (The tests have been ported over)



---

archive/issue_comments_315599.json:
```json
{
    "body": "I fixed the indentation of the `permutahedron` method. I made `fundamental_weights` returns a `Family` for the Coxeter matrix group and cached the result. I also changed the base ring to be an input to `permutahedron`, and if it is not given, it defaults to the base ring that the vertices are computed over. IMO this is better because it should be defined over the common ring that contains the fundamental weights and the image of the action of the Coxeter group.\n\nI've tested this with `gap3`. If you agree with my changes, then positive review.\n----\nNew commits:",
    "created_at": "2017-05-10T21:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315599",
    "user": "tscrim"
}
```

I fixed the indentation of the `permutahedron` method. I made `fundamental_weights` returns a `Family` for the Coxeter matrix group and cached the result. I also changed the base ring to be an input to `permutahedron`, and if it is not given, it defaults to the base ring that the vertices are computed over. IMO this is better because it should be defined over the common ring that contains the fundamental weights and the image of the action of the Coxeter group.

I've tested this with `gap3`. If you agree with my changes, then positive review.
----
New commits:



---

archive/issue_comments_315600.json:
```json
{
    "body": "The changes look ok to me. Your idea for the base ring is a good one. Is there a reason you switched it to a family instead of leaving it as a dictionary? Does it help with performance?",
    "created_at": "2017-05-11T14:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315600",
    "user": "aram.dermenjian"
}
```

The changes look ok to me. Your idea for the base ring is a good one. Is there a reason you switched it to a family instead of leaving it as a dictionary? Does it help with performance?



---

archive/issue_comments_315601.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-11T14:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315601",
    "user": "aram.dermenjian"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315602.json:
```json
{
    "body": "It allows us to cache the result, which has a performance gain, and is a more standard idiom for things like this.",
    "created_at": "2017-05-11T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315602",
    "user": "tscrim"
}
```

It allows us to cache the result, which has a performance gain, and is a more standard idiom for things like this.



---

archive/issue_comments_315603.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 65.0 src/sage/combinat/subword_complex.py  # 4 doctests failed\n```\n",
    "created_at": "2017-05-13T20:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315603",
    "user": "vbraun"
}
```


```
sage -t --long --warn-long 65.0 src/sage/combinat/subword_complex.py  # 4 doctests failed
```




---

archive/issue_comments_315604.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-13T20:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315604",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_315605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-13T22:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315606.json:
```json
{
    "body": "Whoops, forgot to retest that file after changing to a `Family`. Simple fix.",
    "created_at": "2017-05-13T22:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315606",
    "user": "tscrim"
}
```

Whoops, forgot to retest that file after changing to a `Family`. Simple fix.



---

archive/issue_comments_315607.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-13T22:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315607",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_315608.json:
```json
{
    "body": "Patchbot is (essentially) green.",
    "created_at": "2017-05-18T01:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315608",
    "user": "tscrim"
}
```

Patchbot is (essentially) green.



---

archive/issue_comments_315609.json:
```json
{
    "body": "ping",
    "created_at": "2017-05-25T05:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315609",
    "user": "tscrim"
}
```

ping



---

archive/issue_comments_315610.json:
```json
{
    "body": "Sorry for the delay, it's been a busy couple weeks. Everything looks good from here. Tested things out and everything seems to work ok.",
    "created_at": "2017-05-30T10:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315610",
    "user": "aram.dermenjian"
}
```

Sorry for the delay, it's been a busy couple weeks. Everything looks good from here. Tested things out and everything seems to work ok.



---

archive/issue_comments_315611.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-30T10:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315611",
    "user": "aram.dermenjian"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315612.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-31T22:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22618#issuecomment-315612",
    "user": "vbraun"
}
```

Resolution: fixed
