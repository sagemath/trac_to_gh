# Issue 2667: transform.pyx calls matrix() with an RDF vector inside of a list instead of a flat list.

archive/issues_002667.json:
```json
{
    "body": "\nWhen applying the patch for a overhauled matrix() function at \n#2651, I get doctest failures \nfrom sage/plot/plot3d/transform.pyx related to calling \nmatrix() with a list of rows, but specifying a number of rows that \nconflicts.\n\nYou can see these failures by applying the patch and running sage -t \n-long on \ndevel/sage/sage/plot/plot3d/shapes2.py (and the same failures make a \nwhole bunch of other doctests fail too).\n\nFor transform.pyx, the call to matrix on line 44 appears to flatten the \ntrans argument (i.e., list(trans)), but many times what is actually \npassed to Sage is a list containing a single RDF vector instead.\n\n\n**Assignee:** @williamstein\n\nIssue created by migration from https://trac.sagemath.org/ticket/2667\n\n",
    "closed_at": "2008-03-31T19:47:27Z",
    "created_at": "2008-03-25T21:26:00Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0",
    "title": "transform.pyx calls matrix() with an RDF vector inside of a list instead of a flat list.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2667",
    "user": "https://github.com/jasongrout"
}
```

When applying the patch for a overhauled matrix() function at 
#2651, I get doctest failures 
from sage/plot/plot3d/transform.pyx related to calling 
matrix() with a list of rows, but specifying a number of rows that 
conflicts.

You can see these failures by applying the patch and running sage -t 
-long on 
devel/sage/sage/plot/plot3d/shapes2.py (and the same failures make a 
whole bunch of other doctests fail too).

For transform.pyx, the call to matrix on line 44 appears to flatten the 
trans argument (i.e., list(trans)), but many times what is actually 
passed to Sage is a list containing a single RDF vector instead.


**Assignee:** @williamstein

Issue created by migration from https://trac.sagemath.org/ticket/2667





---

archive/attachments_002469.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "transform-trac2667.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2667/transform-trac2667.patch",
    "created_at": "2008-03-29T04:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rhinton"
}
```



---

archive/issue_comments_018015.json:
```json
{
    "body": "<a id='comment:1'></a>\nI discussed this solution with robertwb and cwitty.  I added a `__list__()` method to RealDoubleVectorSpaceElement to allow its elements to be converted to a list.  This makes the hand-off between Transform and matrix() work (see transform.pyx line 44).  \n\nHowever, the vector was still coming into the Transform object wrapped in a one-element list.  The problem was that Graphics3d.translate() allows a variable number of arguments for convenience.  Before, if the first argument was a list or a tuple (note NOT a vector), this sequence was passed directly to self.transform().  As suggested by robertwb, replacing the code\n\n```\n        if isinstance(x[0], (tuple, list)):\n            x = x[0]\n```\nwith \n\n```\n        if len(x)==1:\n            x = x[0]\n```\nworks since a sequence is the only acceptable one-argument input in this case.  This solution also avoids having to check types.\n\nNote that changing the isinstance() call in the scale() method just below DOES NOT work.  I didn't take the time to figure out why; everything seems to be working now.  (The special-case code around line 627 and the fact that scale() is meaningful with only one input argument probably have something to do with it.)",
    "created_at": "2008-03-29T04:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18015",
    "user": "https://github.com/rhinton"
}
```

<a id='comment:1'></a>
I discussed this solution with robertwb and cwitty.  I added a `__list__()` method to RealDoubleVectorSpaceElement to allow its elements to be converted to a list.  This makes the hand-off between Transform and matrix() work (see transform.pyx line 44).  

However, the vector was still coming into the Transform object wrapped in a one-element list.  The problem was that Graphics3d.translate() allows a variable number of arguments for convenience.  Before, if the first argument was a list or a tuple (note NOT a vector), this sequence was passed directly to self.transform().  As suggested by robertwb, replacing the code

```
        if isinstance(x[0], (tuple, list)):
            x = x[0]
```
with 

```
        if len(x)==1:
            x = x[0]
```
works since a sequence is the only acceptable one-argument input in this case.  This solution also avoids having to check types.

Note that changing the isinstance() call in the scale() method just below DOES NOT work.  I didn't take the time to figure out why; everything seems to be working now.  (The special-case code around line 627 and the fact that scale() is meaningful with only one input argument probably have something to do with it.)



---

archive/issue_comments_018016.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-03-29T04:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18016",
    "user": "https://github.com/rhinton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_018017.json:
```json
{
    "body": "<a id='comment:2'></a>\nI don't think `__list__` does anything.  See #2626 .",
    "created_at": "2008-03-29T21:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18017",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
I don't think `__list__` does anything.  See #2626 .



---

archive/attachments_002470.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "2667.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2667/2667.patch",
    "created_at": "2008-03-31T19:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_018018.json:
```json
{
    "body": "",
    "created_at": "2008-03-31T19:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18018",
    "user": "https://github.com/mwhansen"
}
```





---

archive/issue_comments_018019.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2008-03-31T19:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18019",
    "user": "https://github.com/mwhansen"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_018020.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've removed __list__.  The patch applies, and sage -t -long on devel/sage/sage/plot/plot3d/shapes2.py passes when #2651 is applied.",
    "created_at": "2008-03-31T19:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18020",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
I've removed __list__.  The patch applies, and sage -t -long on devel/sage/sage/plot/plot3d/shapes2.py passes when #2651 is applied.



---

archive/issue_comments_018021.json:
```json
{
    "body": "<a id='comment:4'></a>\napply just 2667.patch; rhinton and mhansen (and maybe robertwb and cwitty?) should all probably get credit.",
    "created_at": "2008-03-31T19:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18021",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
apply just 2667.patch; rhinton and mhansen (and maybe robertwb and cwitty?) should all probably get credit.



---

archive/issue_events_007738.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-31T19:47:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2667#event-7738"
}
```



---

archive/issue_comments_018022.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged in Sage 3.0.alpha0",
    "created_at": "2008-03-31T19:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18022",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged in Sage 3.0.alpha0



---

archive/attachments_002471.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "transform-trac2667.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2667/transform-trac2667.2.patch",
    "created_at": "2008-03-31T19:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rhinton"
}
```



---

archive/issue_comments_018023.json:
```json
{
    "body": "Good catch, mhansen.  Apply this patch instead of the previous patch.",
    "created_at": "2008-03-31T19:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18023",
    "user": "https://github.com/rhinton"
}
```

Good catch, mhansen.  Apply this patch instead of the previous patch.



---

archive/issue_comments_018024.json:
```json
{
    "body": "<a id='comment:6'></a>\nSorry, my page must not have refreshed.  Ignore my last patch and use mhansen's instead.",
    "created_at": "2008-04-01T15:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2667#issuecomment-18024",
    "user": "https://github.com/rhinton"
}
```

<a id='comment:6'></a>
Sorry, my page must not have refreshed.  Ignore my last patch and use mhansen's instead.
