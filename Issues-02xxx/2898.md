# Issue 2898: Coerce integral float and RDF to Integers

archive/issues_002898.json:
```json
{
    "body": "\n```\n>  That said, William, is there a reason why this doesn't work?  This is\n> >  what is necessitating the two type conversions above.\n> >\n> >  sage: Integer(float(2))\n> >\n> > ---------------------------------------------------------------------------\n> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)\n> >\n> >  /home/grout/<ipython console> in <module>()\n> >\n> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()\n> >\n> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer\n> >\n> >\n> >  sage: Integer(RDF(2))\n> >\n> > ---------------------------------------------------------------------------\n> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)\n> >\n> >  /home/grout/<ipython console> in <module>()\n> >\n> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()\n> >\n> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer\n> >\n> >\n> >  I guess I would think it was a design decision to not convert floating\n> >  points to ints automatically.  However, the following does work:\n> >\n> >  sage: Integer(RR(2))\n> >  2\n> >\n> >\n> >  This seems inconsistent.\n\nYep.  I think it's just a NotImplementedError.  Please implement it\nand post a patch.  Make sure that it only succeeds if\n\n   Integer(k(a)) == a\n\nand otherwise fails.  I.e., Integer(k(a)) should *not* truncate k(a).\n\nWilliam\n```\n\n\n**Assignee:** @robertwb\n\n**Keywords:** editor_mhansen\n\nIssue created by migration from https://trac.sagemath.org/ticket/2898\n\n",
    "closed_at": "2009-02-09T08:53:42Z",
    "created_at": "2008-04-12T16:08:08Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "Coerce integral float and RDF to Integers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2898",
    "user": "https://github.com/jasongrout"
}
```

```
>  That said, William, is there a reason why this doesn't work?  This is
> >  what is necessitating the two type conversions above.
> >
> >  sage: Integer(float(2))
> >
> > ---------------------------------------------------------------------------
> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)
> >
> >  /home/grout/<ipython console> in <module>()
> >
> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()
> >
> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer
> >
> >
> >  sage: Integer(RDF(2))
> >
> > ---------------------------------------------------------------------------
> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)
> >
> >  /home/grout/<ipython console> in <module>()
> >
> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()
> >
> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer
> >
> >
> >  I guess I would think it was a design decision to not convert floating
> >  points to ints automatically.  However, the following does work:
> >
> >  sage: Integer(RR(2))
> >  2
> >
> >
> >  This seems inconsistent.

Yep.  I think it's just a NotImplementedError.  Please implement it
and post a patch.  Make sure that it only succeeds if

   Integer(k(a)) == a

and otherwise fails.  I.e., Integer(k(a)) should *not* truncate k(a).

William
```


**Assignee:** @robertwb

**Keywords:** editor_mhansen

Issue created by migration from https://trac.sagemath.org/ticket/2898





---

archive/issue_events_015553.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:09:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "component: basic arithmetic",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15553"
}
```



---

archive/issue_events_015554.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:09:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "component: coercion",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15554"
}
```



---

archive/issue_comments_016206.json:
```json
{
    "body": "**Assignee:** @robertwb",
    "created_at": "2008-04-12T16:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16206",
    "user": "https://github.com/jasongrout"
}
```

**Assignee:** @robertwb



---

archive/issue_comments_016207.json:
```json
{
    "body": "<a id='comment:2'></a>\nI've put up a preliminary patch at:\n\nhttp://sage.math.washington.edu/home/jason/trac-2898-coerce-to-Int.patch\n\nThis is undergoing doctesting in alpha3 right now.",
    "created_at": "2008-04-13T04:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16207",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
I've put up a preliminary patch at:

http://sage.math.washington.edu/home/jason/trac-2898-coerce-to-Int.patch

This is undergoing doctesting in alpha3 right now.



---

archive/issue_events_015555.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-04-13T19:00:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "rename": {
        "from": "Coerce float and RDF to Integers",
        "to": "[with preliminary patch, not ready for review?] Coerce float and RDF to Integers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15555"
}
```



---

archive/issue_events_015556.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-06-09T07:01:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "rename": {
        "from": "[with preliminary patch, not ready for review?] Coerce float and RDF to Integers",
        "to": "[with preliminary patch, not ready for review?] Coerce integral float and RDF to Integers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15556"
}
```



---

archive/issue_comments_016208.json:
```json
{
    "body": "<a id='comment:4'></a>\nJason, \n\nany update on this patch? I corrected the subject to be a little clearer.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-09T07:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16208",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Jason, 

any update on this patch? I corrected the subject to be a little clearer.

Cheers,

Michael



---

archive/issue_comments_016209.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"editor_mhansen\".",
    "created_at": "2008-06-20T04:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16209",
    "user": "https://github.com/craigcitro"
}
```

**Changing keywords** from "" to "editor_mhansen".



---

archive/issue_events_015557.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-06-24T00:27:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "rename": {
        "from": "[with preliminary patch, not ready for review?] Coerce integral float and RDF to Integers",
        "to": "[with preliminary patch, needs doctest checking] Coerce integral float and RDF to Integers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15557"
}
```



---

archive/issue_comments_016210.json:
```json
{
    "body": "<a id='comment:6'></a>\nI believe the patch is ready to be doctested (which is where my time gave out before).",
    "created_at": "2008-06-24T00:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16210",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
I believe the patch is ready to be doctested (which is where my time gave out before).



---

archive/issue_comments_016211.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis is supposed to fix #2899, so it would be good to check if the other issue is resolved as well.",
    "created_at": "2008-06-24T00:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16211",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>
This is supposed to fix #2899, so it would be good to check if the other issue is resolved as well.



---

archive/attachments_002754.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "2898-jgrout-coerce-to-integer-1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2898/2898-jgrout-coerce-to-integer-1.patch",
    "created_at": "2008-08-14T00:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ncalexan"
}
```



---

archive/issue_comments_016212.json:
```json
{
    "body": "",
    "created_at": "2008-08-14T00:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16212",
    "user": "https://github.com/ncalexan"
}
```





---

archive/issue_events_015558.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-14T00:34:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "rename": {
        "from": "[with preliminary patch, needs doctest checking] Coerce integral float and RDF to Integers",
        "to": "Coerce integral float and RDF to Integers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15558"
}
```



---

archive/issue_events_015559.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-14T00:34:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15559"
}
```



---

archive/issue_comments_016213.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe patch I posted is basically the same as jgrout's; it sat in my tree for a long time without any problems.\n\nIt looks good to me, but let's get a second opinion.",
    "created_at": "2008-08-14T00:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16213",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:8'></a>
The patch I posted is basically the same as jgrout's; it sat in my tree for a long time without any problems.

It looks good to me, but let's get a second opinion.



---

archive/issue_comments_016214.json:
```json
{
    "body": "<a id='comment:9'></a>\nUnfortunately, this patch gives:\n\n```\nsage: 1.0r/8\n1/8\n```\nwhich is IMHO unacceptable.\n\nI think that the bug is actually in the coercion framework, rather than in this patch; so I've opened a new issue for that bug at #3938.  Once it is fixed, then we can revisit this patch.",
    "created_at": "2008-08-23T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16214",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:9'></a>
Unfortunately, this patch gives:

```
sage: 1.0r/8
1/8
```
which is IMHO unacceptable.

I think that the bug is actually in the coercion framework, rather than in this patch; so I've opened a new issue for that bug at #3938.  Once it is fixed, then we can revisit this patch.



---

archive/issue_comments_016215.json:
```json
{
    "body": "<a id='comment:10'></a>\nI agree with cwitty, I'll be taking a look at #3938.",
    "created_at": "2008-08-23T22:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16215",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>
I agree with cwitty, I'll be taking a look at #3938.



---

archive/issue_comments_016216.json:
```json
{
    "body": "<a id='comment:11'></a>\n#3938 has been resolved.",
    "created_at": "2008-08-30T19:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16216",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:11'></a>
#3938 has been resolved.



---

archive/issue_comments_016217.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [robertwb](#comment%3A11):\n> #3938 has been resolved. \n\n\nHi Robert,\n\nso if I understand you correctly this patch here should not be merged since it fixes a symptom and not the root cause.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-30T23:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16217",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:12'></a>
Replying to [robertwb](#comment%3A11):
> #3938 has been resolved. 


Hi Robert,

so if I understand you correctly this patch here should not be merged since it fixes a symptom and not the root cause.

Cheers,

Michael



---

archive/issue_comments_016218.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis patch should be applied. The problem is that it exposed a bug that was worse than what it fixed. Now the bug has been resolved, they both should be applied.",
    "created_at": "2008-08-31T03:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16218",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:13'></a>
This patch should be applied. The problem is that it exposed a bug that was worse than what it fixed. Now the bug has been resolved, they both should be applied.



---

archive/issue_comments_016219.json:
```json
{
    "body": "<a id='comment:14'></a>\nLooks good to me.  This depends on #3938.",
    "created_at": "2008-09-19T00:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16219",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:14'></a>
Looks good to me.  This depends on #3938.



---

archive/issue_events_015560.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-09-19T00:36:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15560"
}
```



---

archive/issue_events_015561.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-09-19T00:36:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15561"
}
```



---

archive/issue_comments_016220.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe patch no longer applies cleanly and also causes a doctest failure (sorry, forgot the details and no longer have the logs ;)). The rebase should be easy since hunk 2 of integer.pyx is affected and it is only a doctest issue.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-19T02:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16220",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:15'></a>
The patch no longer applies cleanly and also causes a doctest failure (sorry, forgot the details and no longer have the logs ;)). The rebase should be easy since hunk 2 of integer.pyx is affected and it is only a doctest issue.

Cheers,

Michael



---

archive/issue_events_015562.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-09-19T02:56:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15562"
}
```



---

archive/issue_events_015563.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-09-19T02:56:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15563"
}
```



---

archive/attachments_002755.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "2898-jgrout-coerce-to-integer-3.3.alpha2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2898/2898-jgrout-coerce-to-integer-3.3.alpha2.patch",
    "created_at": "2009-01-25T20:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```



---

archive/issue_comments_016221.json:
```json
{
    "body": "",
    "created_at": "2009-01-25T20:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16221",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```





---

archive/issue_events_015564.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-01-25T20:22:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15564"
}
```



---

archive/issue_events_015565.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-01-25T20:22:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15565"
}
```



---

archive/issue_comments_016222.json:
```json
{
    "body": "<a id='comment:16'></a>\nI've attached two patches, 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch.  With #3938 plus these two patches over 3.3.alpha2, all doctests pass (except those that were broken in base 3.3.alpha2).\n\nI'm giving a positive review for 2898-jgrout-coerce-to-integer-3.3.alpha2.patch; somebody else should review trac2898-fixups.patch.",
    "created_at": "2009-01-25T20:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16222",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:16'></a>
I've attached two patches, 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch.  With #3938 plus these two patches over 3.3.alpha2, all doctests pass (except those that were broken in base 3.3.alpha2).

I'm giving a positive review for 2898-jgrout-coerce-to-integer-3.3.alpha2.patch; somebody else should review trac2898-fixups.patch.



---

archive/issue_comments_016223.json:
```json
{
    "body": "<a id='comment:17'></a>\nI get an error applying the fixups patch:\n\n```\napplying trac2898-fixups.patch?format=raw\npatching file sage/rings/real_mpfr.pyx\nHunk #1 FAILED at 396\n1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nErrors during apply, please fix and refresh trac2898-fixups.patch?format=raw\n```",
    "created_at": "2009-01-28T18:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16223",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:17'></a>
I get an error applying the fixups patch:

```
applying trac2898-fixups.patch?format=raw
patching file sage/rings/real_mpfr.pyx
Hunk #1 FAILED at 396
1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
Errors during apply, please fix and refresh trac2898-fixups.patch?format=raw
```



---

archive/issue_comments_016224.json:
```json
{
    "body": "<a id='comment:18'></a>\nI'm confused by the real_mpfr.pyx part of the fixups patch.  I can't find the misspelling \"cannonical\" anywhere in that directory in sage-3.3alpha2.",
    "created_at": "2009-01-28T18:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16224",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:18'></a>
I'm confused by the real_mpfr.pyx part of the fixups patch.  I can't find the misspelling "cannonical" anywhere in that directory in sage-3.3alpha2.



---

archive/issue_comments_016225.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe real_mpfr.pyx part of the fixups patch should be deleted-mabshoff corrected the typo when merging #3938.\n\nDoctests pass in all files touched by the fixups patch.  I'd like someone else to look at the code it touches in free_modules.pyx and verify the changes there.  Other than that, this looks good to me.",
    "created_at": "2009-01-28T19:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16225",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:19'></a>
The real_mpfr.pyx part of the fixups patch should be deleted-mabshoff corrected the typo when merging #3938.

Doctests pass in all files touched by the fixups patch.  I'd like someone else to look at the code it touches in free_modules.pyx and verify the changes there.  Other than that, this looks good to me.



---

archive/attachments_002756.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac2898-fixups.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2898/trac2898-fixups.patch",
    "created_at": "2009-02-06T07:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```



---

archive/issue_comments_016226.json:
```json
{
    "body": "<a id='comment:20'></a>\nWe didn't get this in quite soon enough; in alpha5, this gives failing doctests in symbolic/expression.pyx.  (The following is hand-edited to remove boring bits of the backtraces.)\n\n```\nsage -t  \"devel/sage-mqtmp/sage/symbolic/expression.pyx\"    \n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2169:\n    sage: S(10.0r).gamma()\nExpected:\n    362880.000000000\nGot:\n    362880\n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\nException raised:\n    Traceback (most recent call last):\n...\n      File \"<doctest __main__.example_73[9]>\", line 1, in <module>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\n      File \"/home/cwitty/sage-3.3.alpha5/local/lib/python2.5/site-packages/sage/plot/misc.py\", line 428, in wrapper\n        return func(*args, **kwds)\n...\n      File \"<doctest __main__.example_73[9]>\", line 1, in <lambda>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\n      File \"expression.pyx\", line 2183, in sage.symbolic.expression.Expression.gamma (sage/symbolic/expression.cpp:8410)\n    RuntimeError: tgamma_eval(): simple pole\n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\nException raised:\n    Traceback (most recent call last):\n...\n      File \"<doctest __main__.example_74[7]>\", line 1, in <module>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\n...\n      File \"<doctest __main__.example_74[7]>\", line 1, in <lambda>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\n      File \"expression.pyx\", line 2210, in sage.symbolic.expression.Expression.lgamma (sage/symbolic/expression.cpp:8476)\n    RuntimeError: lgamma_eval(): logarithmic pole\n**********************************************************************\n2 items had failures:\n   2 of  10 in __main__.example_73\n   1 of  10 in __main__.example_74\n***Test Failed*** 3 failures.\n```",
    "created_at": "2009-02-06T07:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16226",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:20'></a>
We didn't get this in quite soon enough; in alpha5, this gives failing doctests in symbolic/expression.pyx.  (The following is hand-edited to remove boring bits of the backtraces.)

```
sage -t  "devel/sage-mqtmp/sage/symbolic/expression.pyx"    
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2169:
    sage: S(10.0r).gamma()
Expected:
    362880.000000000
Got:
    362880
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
Exception raised:
    Traceback (most recent call last):
...
      File "<doctest __main__.example_73[9]>", line 1, in <module>
        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
      File "/home/cwitty/sage-3.3.alpha5/local/lib/python2.5/site-packages/sage/plot/misc.py", line 428, in wrapper
        return func(*args, **kwds)
...
      File "<doctest __main__.example_73[9]>", line 1, in <lambda>
        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
      File "expression.pyx", line 2183, in sage.symbolic.expression.Expression.gamma (sage/symbolic/expression.cpp:8410)
    RuntimeError: tgamma_eval(): simple pole
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
Exception raised:
    Traceback (most recent call last):
...
      File "<doctest __main__.example_74[7]>", line 1, in <module>
        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
...
      File "<doctest __main__.example_74[7]>", line 1, in <lambda>
        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
      File "expression.pyx", line 2210, in sage.symbolic.expression.Expression.lgamma (sage/symbolic/expression.cpp:8476)
    RuntimeError: lgamma_eval(): logarithmic pole
**********************************************************************
2 items had failures:
   2 of  10 in __main__.example_73
   1 of  10 in __main__.example_74
***Test Failed*** 3 failures.
```



---

archive/issue_events_015566.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-02-06T07:42:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15566"
}
```



---

archive/issue_events_015567.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-02-06T07:42:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15567"
}
```



---

archive/issue_comments_016227.json:
```json
{
    "body": "<a id='comment:21'></a>\nI've placed a proposed patch for the above doctest failure at #5199.  So I'm now saying that this is \"ready for review\" again; but the patch now depends on #5199 (and #3938, if the reviewer is using a version of Sage older than 3.3.alpha3).",
    "created_at": "2009-02-07T05:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16227",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:21'></a>
I've placed a proposed patch for the above doctest failure at #5199.  So I'm now saying that this is "ready for review" again; but the patch now depends on #5199 (and #3938, if the reviewer is using a version of Sage older than 3.3.alpha3).



---

archive/issue_events_015568.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-02-07T05:20:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15568"
}
```



---

archive/issue_events_015569.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/cwitty",
    "created_at": "2009-02-07T05:20:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15569"
}
```



---

archive/issue_events_015570.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-08T02:28:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15570"
}
```



---

archive/issue_events_015571.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-08T02:28:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15571"
}
```



---

archive/issue_events_015572.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-02-09T08:01:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15572"
}
```



---

archive/issue_events_015573.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-02-09T08:01:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15573"
}
```



---

archive/issue_comments_016228.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe fixups patch looks good to me except for the following two failures:\n\n```\n**********************************************************************\nFile \"/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx\", line 74:\n    sage: hermite_constant(1) # trivial one-dimensional lattice\nExpected:\n    1.0\nGot:\n    1\n**********************************************************************\nFile \"/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx\", line 80:\n    sage: hermite_constant(8) # E_8\nExpected:\n    2.0\nGot:\n    2\n**********************************************************************\n```",
    "created_at": "2009-02-09T08:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16228",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:23'></a>
The fixups patch looks good to me except for the following two failures:

```
**********************************************************************
File "/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx", line 74:
    sage: hermite_constant(1) # trivial one-dimensional lattice
Expected:
    1.0
Got:
    1
**********************************************************************
File "/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx", line 80:
    sage: hermite_constant(8) # E_8
Expected:
    2.0
Got:
    2
**********************************************************************
```



---

archive/issue_comments_016229.json:
```json
{
    "body": "<a id='comment:24'></a>\nI cannot reproduce the failures Mike saw and I assume #5199 fixed that.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T08:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16229",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:24'></a>
I cannot reproduce the failures Mike saw and I assume #5199 fixed that.

Cheers,

Michael



---

archive/issue_events_015574.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-09T08:53:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15574"
}
```



---

archive/issue_events_015575.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-09T08:53:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2898#event-15575"
}
```



---

archive/issue_comments_016230.json:
```json
{
    "body": "<a id='comment:25'></a>\nMerged 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch in Sage 3.3.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2898#issuecomment-16230",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:25'></a>
Merged 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch in Sage 3.3.rc0.

Cheers,

Michael
