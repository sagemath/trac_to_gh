# Issue 2898: Coerce integral float and RDF to Integers

archive/issues_002898.json:
```json
{
    "assignees": [
        "https://github.com/robertwb"
    ],
    "body": "\n```\n>  That said, William, is there a reason why this doesn't work?  This is\n> >  what is necessitating the two type conversions above.\n> >\n> >  sage: Integer(float(2))\n> >\n> > ---------------------------------------------------------------------------\n> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)\n> >\n> >  /home/grout/<ipython console> in <module>()\n> >\n> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()\n> >\n> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer\n> >\n> >\n> >  sage: Integer(RDF(2))\n> >\n> > ---------------------------------------------------------------------------\n> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)\n> >\n> >  /home/grout/<ipython console> in <module>()\n> >\n> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()\n> >\n> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer\n> >\n> >\n> >  I guess I would think it was a design decision to not convert floating\n> >  points to ints automatically.  However, the following does work:\n> >\n> >  sage: Integer(RR(2))\n> >  2\n> >\n> >\n> >  This seems inconsistent.\n\nYep.  I think it's just a NotImplementedError.  Please implement it\nand post a patch.  Make sure that it only succeeds if\n\n   Integer(k(a)) == a\n\nand otherwise fails.  I.e., Integer(k(a)) should *not* truncate k(a).\n\nWilliam\n```\n\n\nKeywords: **editor_mhansen**\n\nComponent: **coercion**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/2898_\n\n",
    "closed_at": "2009-02-09T08:53:42Z",
    "created_at": "2008-04-12T16:08:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Coerce integral float and RDF to Integers",
    "type": "issue",
    "updated_at": "2009-02-09T08:53:42Z",
    "url": "https://github.com/sagemath/sage/issues/2898",
    "user": "https://github.com/jasongrout"
}
```

```
>  That said, William, is there a reason why this doesn't work?  This is
> >  what is necessitating the two type conversions above.
> >
> >  sage: Integer(float(2))
> >
> > ---------------------------------------------------------------------------
> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)
> >
> >  /home/grout/<ipython console> in <module>()
> >
> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()
> >
> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer
> >
> >
> >  sage: Integer(RDF(2))
> >
> > ---------------------------------------------------------------------------
> >  <type 'exceptions.TypeError'>             Traceback (most recent call last)
> >
> >  /home/grout/<ipython console> in <module>()
> >
> >  /home/grout/integer.pyx in sage.rings.integer.Integer.__init__()
> >
> >  <type 'exceptions.TypeError'>: unable to coerce element to an integer
> >
> >
> >  I guess I would think it was a design decision to not convert floating
> >  points to ints automatically.  However, the following does work:
> >
> >  sage: Integer(RR(2))
> >  2
> >
> >
> >  This seems inconsistent.

Yep.  I think it's just a NotImplementedError.  Please implement it
and post a patch.  Make sure that it only succeeds if

   Integer(k(a)) == a

and otherwise fails.  I.e., Integer(k(a)) should *not* truncate k(a).

William
```


Keywords: **editor_mhansen**

Component: **coercion**

_Issue created by migration from https://trac.sagemath.org/ticket/2898_





---

archive/issue_events_030763.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:08:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30763"
}
```



---

archive/issue_events_030764.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30764"
}
```



---

archive/issue_events_030765.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30765"
}
```



---

archive/issue_events_030766.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30766"
}
```



---

archive/issue_events_030767.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:09:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30767"
}
```



---

archive/issue_events_030768.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-04-12T16:09:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30768"
}
```



---

archive/issue_events_030769.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-04-12T16:09:44Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30769"
}
```



---

archive/issue_comments_015152.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI've put up a preliminary patch at:\n\nhttp://sage.math.washington.edu/home/jason/trac-2898-coerce-to-Int.patch\n\nThis is undergoing doctesting in alpha3 right now.",
    "created_at": "2008-04-13T04:40:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15152",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">comment:2</div>

I've put up a preliminary patch at:

http://sage.math.washington.edu/home/jason/trac-2898-coerce-to-Int.patch

This is undergoing doctesting in alpha3 right now.



---

archive/issue_events_030770.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-13T19:00:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "title_is": "[with preliminary patch, not ready for review?] Coerce float and RDF to Integers",
    "title_was": "Coerce float and RDF to Integers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30770"
}
```



---

archive/issue_events_030771.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-09T07:01:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "title_is": "[with preliminary patch, not ready for review?] Coerce integral float and RDF to Integers",
    "title_was": "[with preliminary patch, not ready for review?] Coerce float and RDF to Integers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30771"
}
```



---

archive/issue_comments_015153.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nJason, \n\nany update on this patch? I corrected the subject to be a little clearer.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-09T07:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15153",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:4" align="right">comment:4</div>

Jason, 

any update on this patch? I corrected the subject to be a little clearer.

Cheers,

Michael



---

archive/issue_comments_015154.json:
```json
{
    "body": "Changed keywords from none to **editor_mhansen**",
    "created_at": "2008-06-20T04:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15154",
    "user": "https://github.com/craigcitro"
}
```

Changed keywords from none to **editor_mhansen**



---

archive/issue_events_030772.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-06-24T00:27:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "title_is": "[with preliminary patch, needs doctest checking] Coerce integral float and RDF to Integers",
    "title_was": "[with preliminary patch, not ready for review?] Coerce integral float and RDF to Integers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30772"
}
```



---

archive/issue_comments_015155.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI believe the patch is ready to be doctested (which is where my time gave out before).",
    "created_at": "2008-06-24T00:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15155",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:6" align="right">comment:6</div>

I believe the patch is ready to be doctested (which is where my time gave out before).



---

archive/issue_comments_015156.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis is supposed to fix #2899, so it would be good to check if the other issue is resolved as well.",
    "created_at": "2008-06-24T00:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15156",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:7" align="right">comment:7</div>

This is supposed to fix #2899, so it would be good to check if the other issue is resolved as well.



---

archive/issue_comments_015157.json:
```json
{
    "body": "Attachment: **[2898-jgrout-coerce-to-integer-1.patch.gz](https://github.com/sagemath/sage/files/ticket2898/2898-jgrout-coerce-to-integer-1.patch.gz)**",
    "created_at": "2008-08-14T00:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15157",
    "user": "https://github.com/ncalexan"
}
```

Attachment: **[2898-jgrout-coerce-to-integer-1.patch.gz](https://github.com/sagemath/sage/files/ticket2898/2898-jgrout-coerce-to-integer-1.patch.gz)**



---

archive/issue_events_030773.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-14T00:34:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "title_is": "Coerce integral float and RDF to Integers",
    "title_was": "[with preliminary patch, needs doctest checking] Coerce integral float and RDF to Integers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30773"
}
```



---

archive/issue_events_030774.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-14T00:34:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30774"
}
```



---

archive/issue_comments_015158.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe patch I posted is basically the same as jgrout's; it sat in my tree for a long time without any problems.\n\nIt looks good to me, but let's get a second opinion.",
    "created_at": "2008-08-14T00:34:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15158",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:8" align="right">comment:8</div>

The patch I posted is basically the same as jgrout's; it sat in my tree for a long time without any problems.

It looks good to me, but let's get a second opinion.



---

archive/issue_comments_015159.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nUnfortunately, this patch gives:\n\n```\nsage: 1.0r/8\n1/8\n```\nwhich is IMHO unacceptable.\n\nI think that the bug is actually in the coercion framework, rather than in this patch; so I've opened a new issue for that bug at #3938.  Once it is fixed, then we can revisit this patch.",
    "created_at": "2008-08-23T21:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15159",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<div id="comment:9" align="right">comment:9</div>

Unfortunately, this patch gives:

```
sage: 1.0r/8
1/8
```
which is IMHO unacceptable.

I think that the bug is actually in the coercion framework, rather than in this patch; so I've opened a new issue for that bug at #3938.  Once it is fixed, then we can revisit this patch.



---

archive/issue_comments_015160.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI agree with cwitty, I'll be taking a look at #3938.",
    "created_at": "2008-08-23T22:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15160",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:10" align="right">comment:10</div>

I agree with cwitty, I'll be taking a look at #3938.



---

archive/issue_comments_015161.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n#3938 has been resolved.",
    "created_at": "2008-08-30T19:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15161",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:11" align="right">comment:11</div>

#3938 has been resolved.



---

archive/issue_comments_015162.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@robertwb](#comment:11):\n> #3938 has been resolved. \n\nHi Robert,\n\nso if I understand you correctly this patch here should not be merged since it fixes a symptom and not the root cause.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-30T23:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15162",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@robertwb](#comment:11):
> #3938 has been resolved. 

Hi Robert,

so if I understand you correctly this patch here should not be merged since it fixes a symptom and not the root cause.

Cheers,

Michael



---

archive/issue_comments_015163.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis patch should be applied. The problem is that it exposed a bug that was worse than what it fixed. Now the bug has been resolved, they both should be applied.",
    "created_at": "2008-08-31T03:27:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15163",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:13" align="right">comment:13</div>

This patch should be applied. The problem is that it exposed a bug that was worse than what it fixed. Now the bug has been resolved, they both should be applied.



---

archive/issue_comments_015164.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLooks good to me.  This depends on #3938.",
    "created_at": "2008-09-19T00:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15164",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:14" align="right">comment:14</div>

Looks good to me.  This depends on #3938.



---

archive/issue_events_030775.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-09-19T00:36:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30775"
}
```



---

archive/issue_events_030776.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-09-19T00:36:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30776"
}
```



---

archive/issue_comments_015165.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe patch no longer applies cleanly and also causes a doctest failure (sorry, forgot the details and no longer have the logs ;)). The rebase should be easy since hunk 2 of integer.pyx is affected and it is only a doctest issue.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-19T02:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15165",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:15" align="right">comment:15</div>

The patch no longer applies cleanly and also causes a doctest failure (sorry, forgot the details and no longer have the logs ;)). The rebase should be easy since hunk 2 of integer.pyx is affected and it is only a doctest issue.

Cheers,

Michael



---

archive/issue_events_030777.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-19T02:56:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30777"
}
```



---

archive/issue_events_030778.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-19T02:56:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30778"
}
```



---

archive/issue_comments_015166.json:
```json
{
    "body": "Attachment: **[2898-jgrout-coerce-to-integer-3.3.alpha2.patch.gz](https://github.com/sagemath/sage/files/ticket2898/2898-jgrout-coerce-to-integer-3.3.alpha2.patch.gz)**",
    "created_at": "2009-01-25T20:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15166",
    "user": "https://github.com/sagetrac-cwitty"
}
```

Attachment: **[2898-jgrout-coerce-to-integer-3.3.alpha2.patch.gz](https://github.com/sagemath/sage/files/ticket2898/2898-jgrout-coerce-to-integer-3.3.alpha2.patch.gz)**



---

archive/issue_events_030779.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-01-25T20:22:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30779"
}
```



---

archive/issue_events_030780.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-01-25T20:22:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30780"
}
```



---

archive/issue_comments_015167.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI've attached two patches, 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch.  With #3938 plus these two patches over 3.3.alpha2, all doctests pass (except those that were broken in base 3.3.alpha2).\n\nI'm giving a positive review for 2898-jgrout-coerce-to-integer-3.3.alpha2.patch; somebody else should review trac2898-fixups.patch.",
    "created_at": "2009-01-25T20:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15167",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<div id="comment:16" align="right">comment:16</div>

I've attached two patches, 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch.  With #3938 plus these two patches over 3.3.alpha2, all doctests pass (except those that were broken in base 3.3.alpha2).

I'm giving a positive review for 2898-jgrout-coerce-to-integer-3.3.alpha2.patch; somebody else should review trac2898-fixups.patch.



---

archive/issue_comments_015168.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI get an error applying the fixups patch:\n\n```\napplying trac2898-fixups.patch?format=raw\npatching file sage/rings/real_mpfr.pyx\nHunk #1 FAILED at 396\n1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nErrors during apply, please fix and refresh trac2898-fixups.patch?format=raw\n```",
    "created_at": "2009-01-28T18:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15168",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:17" align="right">comment:17</div>

I get an error applying the fixups patch:

```
applying trac2898-fixups.patch?format=raw
patching file sage/rings/real_mpfr.pyx
Hunk #1 FAILED at 396
1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
Errors during apply, please fix and refresh trac2898-fixups.patch?format=raw
```



---

archive/issue_comments_015169.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI'm confused by the real_mpfr.pyx part of the fixups patch.  I can't find the misspelling \"cannonical\" anywhere in that directory in sage-3.3alpha2.",
    "created_at": "2009-01-28T18:13:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15169",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:18" align="right">comment:18</div>

I'm confused by the real_mpfr.pyx part of the fixups patch.  I can't find the misspelling "cannonical" anywhere in that directory in sage-3.3alpha2.



---

archive/issue_comments_015170.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe real_mpfr.pyx part of the fixups patch should be deleted-mabshoff corrected the typo when merging #3938.\n\nDoctests pass in all files touched by the fixups patch.  I'd like someone else to look at the code it touches in free_modules.pyx and verify the changes there.  Other than that, this looks good to me.",
    "created_at": "2009-01-28T19:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15170",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:19" align="right">comment:19</div>

The real_mpfr.pyx part of the fixups patch should be deleted-mabshoff corrected the typo when merging #3938.

Doctests pass in all files touched by the fixups patch.  I'd like someone else to look at the code it touches in free_modules.pyx and verify the changes there.  Other than that, this looks good to me.



---

archive/issue_comments_015171.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac2898-fixups.patch.gz](https://github.com/sagemath/sage/files/ticket2898/trac2898-fixups.patch.gz)**\n\nWe didn't get this in quite soon enough; in alpha5, this gives failing doctests in symbolic/expression.pyx.  (The following is hand-edited to remove boring bits of the backtraces.)\n\n```\nsage -t  \"devel/sage-mqtmp/sage/symbolic/expression.pyx\"    \n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2169:\n    sage: S(10.0r).gamma()\nExpected:\n    362880.000000000\nGot:\n    362880\n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\nException raised:\n    Traceback (most recent call last):\n...\n      File \"<doctest __main__.example_73[9]>\", line 1, in <module>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\n      File \"/home/cwitty/sage-3.3.alpha5/local/lib/python2.5/site-packages/sage/plot/misc.py\", line 428, in wrapper\n        return func(*args, **kwds)\n...\n      File \"<doctest __main__.example_73[9]>\", line 1, in <lambda>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:\n    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)\n      File \"expression.pyx\", line 2183, in sage.symbolic.expression.Expression.gamma (sage/symbolic/expression.cpp:8410)\n    RuntimeError: tgamma_eval(): simple pole\n**********************************************************************\nFile \"/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx\", line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\nException raised:\n    Traceback (most recent call last):\n...\n      File \"<doctest __main__.example_74[7]>\", line 1, in <module>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\n...\n      File \"<doctest __main__.example_74[7]>\", line 1, in <lambda>\n        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:\n    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()\n      File \"expression.pyx\", line 2210, in sage.symbolic.expression.Expression.lgamma (sage/symbolic/expression.cpp:8476)\n    RuntimeError: lgamma_eval(): logarithmic pole\n**********************************************************************\n2 items had failures:\n   2 of  10 in __main__.example_73\n   1 of  10 in __main__.example_74\n***Test Failed*** 3 failures.\n```",
    "created_at": "2009-02-06T07:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15171",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac2898-fixups.patch.gz](https://github.com/sagemath/sage/files/ticket2898/trac2898-fixups.patch.gz)**

We didn't get this in quite soon enough; in alpha5, this gives failing doctests in symbolic/expression.pyx.  (The following is hand-edited to remove boring bits of the backtraces.)

```
sage -t  "devel/sage-mqtmp/sage/symbolic/expression.pyx"    
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2169:
    sage: S(10.0r).gamma()
Expected:
    362880.000000000
Got:
    362880
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
Exception raised:
    Traceback (most recent call last):
...
      File "<doctest __main__.example_73[9]>", line 1, in <module>
        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
      File "/home/cwitty/sage-3.3.alpha5/local/lib/python2.5/site-packages/sage/plot/misc.py", line 428, in wrapper
        return func(*args, **kwds)
...
      File "<doctest __main__.example_73[9]>", line 1, in <lambda>
        set_verbose(-Integer(1)); plot(lambda x: S(x).gamma(), -Integer(6),Integer(4)).show(ymin=-Integer(3),ymax=Integer(3))###line 2180:
    sage: set_verbose(-1); plot(lambda x: S(x).gamma(), -6,4).show(ymin=-3,ymax=3)
      File "expression.pyx", line 2183, in sage.symbolic.expression.Expression.gamma (sage/symbolic/expression.cpp:8410)
    RuntimeError: tgamma_eval(): simple pole
**********************************************************************
File "/home/cwitty/sage-3.3.alpha5/devel/sage-mqtmp/sage/symbolic/expression.pyx", line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
Exception raised:
    Traceback (most recent call last):
...
      File "<doctest __main__.example_74[7]>", line 1, in <module>
        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
...
      File "<doctest __main__.example_74[7]>", line 1, in <lambda>
        set_verbose(-Integer(1)); plot(lambda x: S(x).lgamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()###line 2204:
    sage: set_verbose(-1); plot(lambda x: S(x).lgamma(), -7,8, plot_points=1000).show()
      File "expression.pyx", line 2210, in sage.symbolic.expression.Expression.lgamma (sage/symbolic/expression.cpp:8476)
    RuntimeError: lgamma_eval(): logarithmic pole
**********************************************************************
2 items had failures:
   2 of  10 in __main__.example_73
   1 of  10 in __main__.example_74
***Test Failed*** 3 failures.
```



---

archive/issue_events_030781.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-02-06T07:42:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30781"
}
```



---

archive/issue_events_030782.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-02-06T07:42:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30782"
}
```



---

archive/issue_comments_015172.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI've placed a proposed patch for the above doctest failure at #5199.  So I'm now saying that this is \"ready for review\" again; but the patch now depends on #5199 (and #3938, if the reviewer is using a version of Sage older than 3.3.alpha3).",
    "created_at": "2009-02-07T05:20:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15172",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<div id="comment:21" align="right">comment:21</div>

I've placed a proposed patch for the above doctest failure at #5199.  So I'm now saying that this is "ready for review" again; but the patch now depends on #5199 (and #3938, if the reviewer is using a version of Sage older than 3.3.alpha3).



---

archive/issue_events_030783.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-02-07T05:20:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30783"
}
```



---

archive/issue_events_030784.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-02-07T05:20:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30784"
}
```



---

archive/issue_events_030785.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-02-08T02:28:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30785"
}
```



---

archive/issue_events_030786.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-02-08T02:28:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30786"
}
```



---

archive/issue_events_030787.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-02-09T08:01:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30787"
}
```



---

archive/issue_events_030788.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-02-09T08:01:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30788"
}
```



---

archive/issue_comments_015173.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThe fixups patch looks good to me except for the following two failures:\n\n```\n**********************************************************************\nFile \"/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx\", line 74:\n    sage: hermite_constant(1) # trivial one-dimensional lattice\nExpected:\n    1.0\nGot:\n    1\n**********************************************************************\nFile \"/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx\", line 80:\n    sage: hermite_constant(8) # E_8\nExpected:\n    2.0\nGot:\n    2\n**********************************************************************\n```",
    "created_at": "2009-02-09T08:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15173",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:23" align="right">comment:23</div>

The fixups patch looks good to me except for the following two failures:

```
**********************************************************************
File "/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx", line 74:
    sage: hermite_constant(1) # trivial one-dimensional lattice
Expected:
    1.0
Got:
    1
**********************************************************************
File "/home/mhansen/sage-coxeter/devel/sage-main/sage/rings/number_field/totallyreal_data.pyx", line 80:
    sage: hermite_constant(8) # E_8
Expected:
    2.0
Got:
    2
**********************************************************************
```



---

archive/issue_comments_015174.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI cannot reproduce the failures Mike saw and I assume #5199 fixed that.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T08:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15174",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:24" align="right">comment:24</div>

I cannot reproduce the failures Mike saw and I assume #5199 fixed that.

Cheers,

Michael



---

archive/issue_events_030789.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-02-09T08:53:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30789"
}
```



---

archive/issue_events_030790.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-02-09T08:53:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2898#event-30790"
}
```



---

archive/issue_comments_015175.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nMerged 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch in Sage 3.3.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T08:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2898#issuecomment-15175",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:25" align="right">comment:25</div>

Merged 2898-jgrout-coerce-to-integer-3.3.alpha2.patch and trac2898-fixups.patch in Sage 3.3.rc0.

Cheers,

Michael
