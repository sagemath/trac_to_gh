# Issue 2504: [with positive review] number field .units() method caches proof=False result and returns it for proof=True

archive/issues_002504.json:
```json
{
    "body": "The following was reported by Luis Finotti on sage-support, here: http://groups.google.com/group/sage-support/browse_thread/thread/f01e8661743d36d4#\n\nThe following commands return an error:\n\n```\n   P.<x>=PolynomialRing(QQ)\n   f=x^17+3\n   K=NumberField(f,'a')\n   K.units(proof=True) # default\n```\nbecause Sage is incapable of performing the computation with proof=True.\n(The error ends with \"not enough precomputed primes, need primelimit ~  (35)\".)\n\nIf you then do\n\n```\n   K.units(proof=False)\n```\nyou get an answer immediately; then repeating the original\n\n```\n   K.units(proof=True)\n```\ngives you the unproved answer again even though proof=True is specified.\n\nAssignee: @williamstein\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/2504\n\n",
    "closed_at": "2008-04-26T21:58:58Z",
    "created_at": "2008-03-13T03:14:46Z",
    "labels": [
        "component: number theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0.1",
    "title": "[with positive review] number field .units() method caches proof=False result and returns it for proof=True",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2504",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```
The following was reported by Luis Finotti on sage-support, here: http://groups.google.com/group/sage-support/browse_thread/thread/f01e8661743d36d4#

The following commands return an error:

```
   P.<x>=PolynomialRing(QQ)
   f=x^17+3
   K=NumberField(f,'a')
   K.units(proof=True) # default
```
because Sage is incapable of performing the computation with proof=True.
(The error ends with "not enough precomputed primes, need primelimit ~  (35)".)

If you then do

```
   K.units(proof=False)
```
you get an answer immediately; then repeating the original

```
   K.units(proof=True)
```
gives you the unproved answer again even though proof=True is specified.

Assignee: @williamstein

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/2504





---

archive/issue_comments_018818.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [2504-units_cache.patch](tarball://root/attachments/some-uuid/ticket2504/2504-units_cache.patch) by @aghitza created at 2008-04-13 02:27:55\n\nThe attached patch fixes this and adds doctests illustrating the correct behavior.",
    "created_at": "2008-04-13T02:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18818",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:1'></a>
Attachment [2504-units_cache.patch](tarball://root/attachments/some-uuid/ticket2504/2504-units_cache.patch) by @aghitza created at 2008-04-13 02:27:55

The attached patch fixes this and adds doctests illustrating the correct behavior.



---

archive/issue_comments_018819.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2008-04-13T02:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18819",
    "user": "https://github.com/aghitza"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_018820.json:
```json
{
    "body": "<a id='comment:2'></a>\nWait -- if you ask for units with proof, the value is cached.  If you then ask for it without proof, shouldn't we return the cached value?  The code doesn't look like it does that.",
    "created_at": "2008-04-15T16:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18820",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:2'></a>
Wait -- if you ask for units with proof, the value is cached.  If you then ask for it without proof, shouldn't we return the cached value?  The code doesn't look like it does that.



---

archive/issue_comments_018821.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [2504-units_cache.2.patch](tarball://root/attachments/some-uuid/ticket2504/2504-units_cache.2.patch) by @aghitza created at 2008-04-15 20:18:32\n\nYou are completely right.  I've replaced the patch and reorganized the code so it looks a bit cleaner.",
    "created_at": "2008-04-15T20:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18821",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:3'></a>
Attachment [2504-units_cache.2.patch](tarball://root/attachments/some-uuid/ticket2504/2504-units_cache.2.patch) by @aghitza created at 2008-04-15 20:18:32

You are completely right.  I've replaced the patch and reorganized the code so it looks a bit cleaner.



---

archive/issue_events_007443.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "rename": {
        "from": "number field .units() method caches proof=False result and returns it for proof=True",
        "to": "[with positive review] number field .units() method caches proof=False result and returns it for proof=True"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2504#event-7443"
}
```



---

archive/issue_comments_018822.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooks good to me.",
    "created_at": "2008-04-26T17:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18822",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:4'></a>
Looks good to me.



---

archive/issue_comments_018823.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged 2504-units_cache.2.patch in Sage 3.0.1.alpha1",
    "created_at": "2008-04-26T21:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18823",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged 2504-units_cache.2.patch in Sage 3.0.1.alpha1



---

archive/issue_events_007444.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-04-26T21:58:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2504#event-7444"
}
```



---

archive/issue_comments_018824.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-04-26T21:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2504",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2504#issuecomment-18824",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed
