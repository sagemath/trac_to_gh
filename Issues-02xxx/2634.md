# Issue 2634: Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code

archive/issues_002634.json:
```json
{
    "body": "\n```\nsage: k = GF(next_prime(2^31)^2,'x')\nsage: k['y,z']\nTraceback (most recent call last):\n...\nOverflowError: long int too large to convert to int\nsage: PolynomialRing(k,2,'x,y')\nTraceback (most recent call last):\n...\nOverflowError: long int too large to convert to int\n```\n\n\nThis is caused because Sage is trying to use libsingular\nto create the poly ring, but should be using its own code\nwhen the size of the base ring is too big. \n\nMartin Albrecht will be able to fix this very easily.\n\n**Assignee:** @malb\n\nIssue created by migration from https://trac.sagemath.org/ticket/2634\n\n",
    "closed_at": "2008-03-24T08:35:14Z",
    "created_at": "2008-03-21T18:48:19Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.11",
    "title": "Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2634",
    "user": "https://github.com/williamstein"
}
```

```
sage: k = GF(next_prime(2^31)^2,'x')
sage: k['y,z']
Traceback (most recent call last):
...
OverflowError: long int too large to convert to int
sage: PolynomialRing(k,2,'x,y')
Traceback (most recent call last):
...
OverflowError: long int too large to convert to int
```


This is caused because Sage is trying to use libsingular
to create the poly ring, but should be using its own code
when the size of the base ring is too big. 

Martin Albrecht will be able to fix this very easily.

**Assignee:** @malb

Issue created by migration from https://trac.sagemath.org/ticket/2634





---

archive/attachments_002423.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_2634.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2634/trac_2634.patch",
    "created_at": "2008-03-22T14:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/malb"
}
```



---

archive/issue_comments_017735.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe attached patch implements the easy fix and worksforme. However, my installation is FUBAR right now so a referee would have to run `make test` but there should be no surprises. Sorry for the mess.",
    "created_at": "2008-03-22T14:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17735",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>
The attached patch implements the easy fix and worksforme. However, my installation is FUBAR right now so a referee would have to run `make test` but there should be no surprises. Sorry for the mess.



---

archive/issue_events_007650.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "rename": {
        "from": "(easy fix?) Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code",
        "to": "Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2634#event-7650"
}
```



---

archive/issue_comments_017736.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-03-22T14:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17736",
    "user": "https://github.com/malb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_017737.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2008-03-22T14:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17737",
    "user": "https://github.com/malb"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_017738.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi,\n\nIt's good but there are two issues:\n\n1. sage -t sage/schemes/generic/affine_space.py fails:\n\n```\nsage -t  schemes/generic/affine_space.py                    **********************************************************************\nFile \"affine_space.py\", line 196:\n    sage: AffineSpace(ZZ,1, 'a') == AffineSpace(ZZ, 0, 'a')\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.5/doctest.py\", line 1212, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_5[1]>\", line 1, in <module>\n        AffineSpace(ZZ,Integer(1), 'a') == AffineSpace(ZZ, Integer(0), 'a')###line 196:\n    sage: AffineSpace(ZZ,1, 'a') == AffineSpace(ZZ, 0, 'a')\n      File \"/opt/sage/local/lib/python2.5/site-packages/sage/schemes/generic/affine_space.py\", line 204, in __cmp__\n        [right.dimension(), right.coordinate_ring()])\n      File \"/opt/sage/local/lib/python2.5/site-packages/sage/schemes/generic/affine_space.py\", line 262, in coordinate_ring\n        self._coordinate_ring = MPolynomialRing(self.base_ring(), self.dimension(), names=self.variable_names())\n      File \"/opt/sage/local/lib/python2.5/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 248, in PolynomialRing\n        R = _multi_variate(base_ring, names, n, sparse, order)\n      File \"/opt/sage/local/lib/python2.5/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py\", line 365, in _multi_variate\n        R = MPolynomialRing_libsingular(base_ring, n, names, order)\n      File \"multi_polynomial_libsingular.pyx\", line 196, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__init__\n    ArithmeticError: number of variables must be at least 1\n**********************************************************************\n```\n\n\n2. this is minor; there's a typo in the new error message in multi_polynomial_libsingular.pyx: should be\n\n```\nraise NotImplementedError, \"Number fields are not fully supported yet.\" \n```\n\ninstead of \n\n```\nraise NotImplementedError, \"Number fields are not fully support yet.\"\n```\n\nI'll very happily give this a quick positive review as soon as these things get fixed.",
    "created_at": "2008-03-22T14:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17738",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:2'></a>
Hi,

It's good but there are two issues:

1. sage -t sage/schemes/generic/affine_space.py fails:

```
sage -t  schemes/generic/affine_space.py                    **********************************************************************
File "affine_space.py", line 196:
    sage: AffineSpace(ZZ,1, 'a') == AffineSpace(ZZ, 0, 'a')
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.5/doctest.py", line 1212, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_5[1]>", line 1, in <module>
        AffineSpace(ZZ,Integer(1), 'a') == AffineSpace(ZZ, Integer(0), 'a')###line 196:
    sage: AffineSpace(ZZ,1, 'a') == AffineSpace(ZZ, 0, 'a')
      File "/opt/sage/local/lib/python2.5/site-packages/sage/schemes/generic/affine_space.py", line 204, in __cmp__
        [right.dimension(), right.coordinate_ring()])
      File "/opt/sage/local/lib/python2.5/site-packages/sage/schemes/generic/affine_space.py", line 262, in coordinate_ring
        self._coordinate_ring = MPolynomialRing(self.base_ring(), self.dimension(), names=self.variable_names())
      File "/opt/sage/local/lib/python2.5/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 248, in PolynomialRing
        R = _multi_variate(base_ring, names, n, sparse, order)
      File "/opt/sage/local/lib/python2.5/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 365, in _multi_variate
        R = MPolynomialRing_libsingular(base_ring, n, names, order)
      File "multi_polynomial_libsingular.pyx", line 196, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__init__
    ArithmeticError: number of variables must be at least 1
**********************************************************************
```


2. this is minor; there's a typo in the new error message in multi_polynomial_libsingular.pyx: should be

```
raise NotImplementedError, "Number fields are not fully supported yet." 
```

instead of 

```
raise NotImplementedError, "Number fields are not fully support yet."
```

I'll very happily give this a quick positive review as soon as these things get fixed.



---

archive/issue_events_007651.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "rename": {
        "from": "Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code",
        "to": "[negative review] Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2634#event-7651"
}
```



---

archive/issue_comments_017739.json:
```json
{
    "body": "fixes the typo reported by Alex.",
    "created_at": "2008-03-24T00:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17739",
    "user": "https://github.com/malb"
}
```

fixes the typo reported by Alex.



---

archive/attachments_002424.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "2634_0gens.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2634/2634_0gens.patch",
    "created_at": "2008-03-24T00:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/malb"
}
```



---

archive/issue_comments_017740.json:
```json
{
    "body": "allow 0 gens for multivariate polynomial rings (debatable!)",
    "created_at": "2008-03-24T00:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17740",
    "user": "https://github.com/malb"
}
```

allow 0 gens for multivariate polynomial rings (debatable!)



---

archive/issue_comments_017741.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've attached patches for both issues reported by Alex, **but** I am not convinced that it is actually desired to allow 0 generators for multivariate polynomial rings. We allowed that before and thus I reintroduced that behaviour but I would like to get rid of it: It will be a no fun to support once the generic multivariate polynomials get closer to C and I don't see the point.",
    "created_at": "2008-03-24T00:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17741",
    "user": "https://github.com/malb"
}
```

<a id='comment:3'></a>
I've attached patches for both issues reported by Alex, **but** I am not convinced that it is actually desired to allow 0 generators for multivariate polynomial rings. We allowed that before and thus I reintroduced that behaviour but I would like to get rid of it: It will be a no fun to support once the generic multivariate polynomials get closer to C and I don't see the point.



---

archive/issue_comments_017742.json:
```json
{
    "body": "<a id='comment:4'></a>\nI understand your objection.  I'm not comfortable deciding about that, so I'll throw it on sage-devel and see what people say.\n\nIn the mean time, the patches look good and doctest well.  I think we should apply them.",
    "created_at": "2008-03-24T02:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17742",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:4'></a>
I understand your objection.  I'm not comfortable deciding about that, so I'll throw it on sage-devel and see what people say.

In the mean time, the patches look good and doctest well.  I think we should apply them.



---

archive/issue_events_007652.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "rename": {
        "from": "[negative review] Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code",
        "to": "Unable to create certain multivariate polynomial rings since libsingular is invoked instead of generic code"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2634#event-7652"
}
```



---

archive/issue_comments_017743.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2008-03-24T02:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17743",
    "user": "https://github.com/aghitza"
}
```

**Changing status** from new to positive_review.



---

archive/issue_comments_017744.json:
```json
{
    "body": "<a id='comment:5'></a>\nTo quote William from https://groups.google.com/group/sage-devel/t/2d722ebda3887a56\n\n```\nI definitely think multivariate polynomial rings with 0 generators\nshould be supported\nfor exactly the same reason matrices with 0 rows or columns should be\nsupported -- algorithms are much more likely to work in corner cases and code\nis cleaner.\n\nI've been incredibly glad on numerous occasions that across the board\nSage works very well with matrices that have 0 rows or columns, though\nthis took a lot of extra work initially.   The only argument put forth for\nremoving multivariate polynomials rings with 0 generators is \"It will\nbe a no fun to support\".   That is not compelling.\n\nWilliam \n```\n\nThis leads me to merge this patch now to fix the issue. I assume we will revisit this in the future since Martin commented right after William that\n\n```\n\nlibSingular doesn't support it and as soon as more pointers are involved the\ngeneric implementation will too have problems (== NULL pointers). Maybe a\nspecial implementation for zero generators is in order then?\n\nMartin \n```\n\nCheers,\n\nMichael",
    "created_at": "2008-03-24T08:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17744",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
To quote William from https://groups.google.com/group/sage-devel/t/2d722ebda3887a56

```
I definitely think multivariate polynomial rings with 0 generators
should be supported
for exactly the same reason matrices with 0 rows or columns should be
supported -- algorithms are much more likely to work in corner cases and code
is cleaner.

I've been incredibly glad on numerous occasions that across the board
Sage works very well with matrices that have 0 rows or columns, though
this took a lot of extra work initially.   The only argument put forth for
removing multivariate polynomials rings with 0 generators is "It will
be a no fun to support".   That is not compelling.

William 
```

This leads me to merge this patch now to fix the issue. I assume we will revisit this in the future since Martin commented right after William that

```

libSingular doesn't support it and as soon as more pointers are involved the
generic implementation will too have problems (== NULL pointers). Maybe a
special implementation for zero generators is in order then?

Martin 
```

Cheers,

Michael



---

archive/issue_events_007653.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-24T08:35:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2634#event-7653"
}
```



---

archive/issue_comments_017745.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged in Sage 2.11.alpha2",
    "created_at": "2008-03-24T08:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2634#issuecomment-17745",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Merged in Sage 2.11.alpha2
