# Issue 2385: Multivariate Polynomial coefficients

archive/issues_002385.json:
```json
{
    "body": "This patch adds a polynomial_coefficient method which aims to replace the coefficient method for mpolynomials.\n\nSome problems with the coefficient function are:\n\n```\nsage: R.<x,y,z>=ZZ[]\nsage: f=(x^2-2)*(y-1); f\nx^2*y - x^2 - 2*y + 2\nsage: f.coefficient(R(1))\n2\nsage: f.coefficient(x^2)\ny - 1\nsage: f.polynomial_coefficient({x:0})\n-2*y + 2\n```\nNote that ZZ and QQ are not consistent in this either:\n\n```\nsage: R.<x,y,z>=QQ[]\nsage: f=(x^2-2)*(y-1); f\nx^2*y - x^2 - 2*y + 2\nsage: f.coefficient(R(1))\nx^2*y - x^2 - 2*y + 2\n```\n\nSome of the problems are that there is no way to state that I want all the terms which do not have x.  The polynomial_coefficient method fixes that by taking a dictionary with degrees.\n\nI don't think the patch I posted is the end of the story on this.  I believe that the coefficient method should be a synomyn for polynomial_coefficient or monomial_coefficient.  I'm not sure which.  I'm also not sure what the best parameters are for polynomial_coefficient.  The dictionary syntax is my preferred, but I'm aware that some people may not like dictionaries quite as much as I do.\n\n**Assignee:** @malb\n\nIssue created by migration from https://trac.sagemath.org/ticket/2385\n\n",
    "closed_at": "2008-03-12T22:04:40Z",
    "created_at": "2008-03-04T16:19:35Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-2.10.4",
    "title": "Multivariate Polynomial coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/2385",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```
This patch adds a polynomial_coefficient method which aims to replace the coefficient method for mpolynomials.

Some problems with the coefficient function are:

```
sage: R.<x,y,z>=ZZ[]
sage: f=(x^2-2)*(y-1); f
x^2*y - x^2 - 2*y + 2
sage: f.coefficient(R(1))
2
sage: f.coefficient(x^2)
y - 1
sage: f.polynomial_coefficient({x:0})
-2*y + 2
```
Note that ZZ and QQ are not consistent in this either:

```
sage: R.<x,y,z>=QQ[]
sage: f=(x^2-2)*(y-1); f
x^2*y - x^2 - 2*y + 2
sage: f.coefficient(R(1))
x^2*y - x^2 - 2*y + 2
```

Some of the problems are that there is no way to state that I want all the terms which do not have x.  The polynomial_coefficient method fixes that by taking a dictionary with degrees.

I don't think the patch I posted is the end of the story on this.  I believe that the coefficient method should be a synomyn for polynomial_coefficient or monomial_coefficient.  I'm not sure which.  I'm also not sure what the best parameters are for polynomial_coefficient.  The dictionary syntax is my preferred, but I'm aware that some people may not like dictionaries quite as much as I do.

**Assignee:** @malb

Issue created by migration from https://trac.sagemath.org/ticket/2385





---

archive/issue_events_012004.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jbmohler",
    "created_at": "2008-03-04T16:24:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "label": "component: algebraic geometry",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12004"
}
```



---

archive/issue_events_012005.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jbmohler",
    "created_at": "2008-03-04T16:24:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "label": "component: commutative algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12005"
}
```



---

archive/issue_comments_012668.json:
```json
{
    "body": "<a id='comment:1'></a>\nPerhaps I should also mention that I commented out the gens method (in both implementations).  I'm not aware of any reason that the ParentWithGens caching implementation of this is not the preferred option.",
    "created_at": "2008-03-04T16:24:47Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12668",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```

<a id='comment:1'></a>
Perhaps I should also mention that I commented out the gens method (in both implementations).  I'm not aware of any reason that the ParentWithGens caching implementation of this is not the preferred option.



---

archive/issue_comments_012669.json:
```json
{
    "body": "**Changing assignee** from @williamstein to @malb.",
    "created_at": "2008-03-04T16:24:47Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12669",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```

**Changing assignee** from @williamstein to @malb.



---

archive/issue_events_012006.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-03-06T18:01:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "rename": {
        "from": "Multivariate Polynomial coefficients",
        "to": "[needs more review] Multivariate Polynomial coefficients"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12006"
}
```



---

archive/issue_comments_012670.json:
```json
{
    "body": "<a id='comment:2'></a>\nOne comment:  if I ever asked a polynomial for a specific coefficient, I would expect the result to be in the base ring *not* in the polynomial ring.  Why did you do that?",
    "created_at": "2008-03-06T18:01:43Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12670",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
One comment:  if I ever asked a polynomial for a specific coefficient, I would expect the result to be in the base ring *not* in the polynomial ring.  Why did you do that?



---

archive/issue_comments_012671.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm not sure what you meant by \"specific coefficient\".  Did you mean situation !#1 or !#2 below?\n\n```\nsage: R.<x,y,z>=ZZ[]\nsage: f=(x^2+1)*(y-1)\n# Situation 1\nsage: f.monomial_coefficient(x^2)\n-1\nsage: f.monomial_coefficient(x^2).parent()\nInteger Ring\n# Situation 2\nsage: f.polynomial_coefficient({x:2})\ny - 1\nsage: f.polynomial_coefficient({x:2}).parent()\nMultivariate Polynomial Ring in x, y, z over Integer Ring\n```\n\nI took the word specific to imply situation 1 which seems to me the code does what you say it should do.\n\nIf you are meaning situation 2, then I didn't put the result in the ring ZZ[y,z] simply because I didn't really appreciate it in my computational context.  One reason not to create the new ring ZZ[y,z] would be speed concerns both at creation and with later arithmetic.  That is, it could be that I really do want to do arithmetic with this coefficient in the large ring and this is a moderately expensive coercion -- certainly something you would not want to do inside of a tight loop.\n\nHowever, the parent of the result of polynomial_coefficient is a very legitimate point to discuss.  I think my speed concerns are valid and sufficient argument, but this is one of the reasons that I don't think this patch is the final word on this point.",
    "created_at": "2008-03-10T18:07:28Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12671",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```

<a id='comment:3'></a>
I'm not sure what you meant by "specific coefficient".  Did you mean situation !#1 or !#2 below?

```
sage: R.<x,y,z>=ZZ[]
sage: f=(x^2+1)*(y-1)
# Situation 1
sage: f.monomial_coefficient(x^2)
-1
sage: f.monomial_coefficient(x^2).parent()
Integer Ring
# Situation 2
sage: f.polynomial_coefficient({x:2})
y - 1
sage: f.polynomial_coefficient({x:2}).parent()
Multivariate Polynomial Ring in x, y, z over Integer Ring
```

I took the word specific to imply situation 1 which seems to me the code does what you say it should do.

If you are meaning situation 2, then I didn't put the result in the ring ZZ[y,z] simply because I didn't really appreciate it in my computational context.  One reason not to create the new ring ZZ[y,z] would be speed concerns both at creation and with later arithmetic.  That is, it could be that I really do want to do arithmetic with this coefficient in the large ring and this is a moderately expensive coercion -- certainly something you would not want to do inside of a tight loop.

However, the parent of the result of polynomial_coefficient is a very legitimate point to discuss.  I think my speed concerns are valid and sufficient argument, but this is one of the reasons that I don't think this patch is the final word on this point.



---

archive/issue_comments_012672.json:
```json
{
    "body": "<a id='comment:4'></a>\nSorry not to be more specific.\n\nIn your example, the ring is Z[x,y,z] and I would expect the coefficient of any monomial `x<sup>a*y</sup>b*z^c` to be an integer (where here a,b,c may be 0).  In particular, if I asked for the coefficient of `x^a` I would only expect the integer coefficient of `x<sup>a*y</sup>0*z^0` and *not* a polynomial in y,z (together with an implied identification of Z[x,y,z] with Z[y,z][x]).\n\nIn other words, ever polynomial ring has a base (coefficient) ring and I would expect the polynomial_coefficient() function to return an element of that ring.\n\nYou are providing more functionality than that (in your Situation 2).  I can certainly imagine situations where that is what I would need, but then I would expect the result to be an element of a ring in fewer variables.  I agree that this function should not create further rings unless necessary (such as ZZ[y,z] in this case) -- but the user might be prepared to create that themselves (as a subring?), and then how would the result of your f.polynomial_coefficient({x:2}) be coerced into it?",
    "created_at": "2008-03-10T19:10:17Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12672",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Sorry not to be more specific.

In your example, the ring is Z[x,y,z] and I would expect the coefficient of any monomial `x<sup>a*y</sup>b*z^c` to be an integer (where here a,b,c may be 0).  In particular, if I asked for the coefficient of `x^a` I would only expect the integer coefficient of `x<sup>a*y</sup>0*z^0` and *not* a polynomial in y,z (together with an implied identification of Z[x,y,z] with Z[y,z][x]).

In other words, ever polynomial ring has a base (coefficient) ring and I would expect the polynomial_coefficient() function to return an element of that ring.

You are providing more functionality than that (in your Situation 2).  I can certainly imagine situations where that is what I would need, but then I would expect the result to be an element of a ring in fewer variables.  I agree that this function should not create further rings unless necessary (such as ZZ[y,z] in this case) -- but the user might be prepared to create that themselves (as a subring?), and then how would the result of your f.polynomial_coefficient({x:2}) be coerced into it?



---

archive/issue_comments_012673.json:
```json
{
    "body": "<a id='comment:5'></a>\nSo, the crux of the matter (at least, my reading) is that the name of the function 'polynomial_coefficient' led you to believe it answered a fundamentally different question than I made the function to answer.  That is, I think you should be looking at 'monomial_coefficient' -- it does exactly what you want.\n\nI understand your confusion and I don't like the names of these functions either.  I'm somewhat stumped about better alternatives though.  Please make suggestions.",
    "created_at": "2008-03-10T21:31:57Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12673",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```

<a id='comment:5'></a>
So, the crux of the matter (at least, my reading) is that the name of the function 'polynomial_coefficient' led you to believe it answered a fundamentally different question than I made the function to answer.  That is, I think you should be looking at 'monomial_coefficient' -- it does exactly what you want.

I understand your confusion and I don't like the names of these functions either.  I'm somewhat stumped about better alternatives though.  Please make suggestions.



---

archive/issue_comments_012674.json:
```json
{
    "body": "<a id='comment:6'></a>\nI now understand -- and apologise, since I had not fully appreciated the crucial distinction between the existing function monomial_coefficient() and the new one polynomial_coefficient().\n\nNow I understand this distinction, it is important that other Sage users and developers do too -- and that means including some more cross-referencing in the docstrings.  At the very least there should be \"see also polynomial_coefficient()\" to the doc for monomial_coefficient(), as well as  vice versa (which I can see in your patch, but not the former).\n\nAlso, can you give a more precise but succinct definition of your polynomial_coefficient() function, more than just examples?\n\nLastly, in your docstrings you descibe the parameter as a \"list\" while it is in fact a Python dict.  That needs changing.\n\nSorry to be so picky -- the basic idea is certainly a good one.",
    "created_at": "2008-03-10T22:57:55Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12674",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
I now understand -- and apologise, since I had not fully appreciated the crucial distinction between the existing function monomial_coefficient() and the new one polynomial_coefficient().

Now I understand this distinction, it is important that other Sage users and developers do too -- and that means including some more cross-referencing in the docstrings.  At the very least there should be "see also polynomial_coefficient()" to the doc for monomial_coefficient(), as well as  vice versa (which I can see in your patch, but not the former).

Also, can you give a more precise but succinct definition of your polynomial_coefficient() function, more than just examples?

Lastly, in your docstrings you descibe the parameter as a "list" while it is in fact a Python dict.  That needs changing.

Sorry to be so picky -- the basic idea is certainly a good one.



---

archive/attachments_002224.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "mpoly-coeff.patch",
    "asset_url": "tarball://root/attachments/ticket2385/mpoly-coeff.patch",
    "created_at": "2008-03-11T18:25:12Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket2385/mpoly-coeff.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```



---

archive/issue_comments_012675.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Attachment:** [mpoly-coeff.patch](https://github.com/sagemath/sage/files/ticket2385/mpoly-coeff.patch)\n\nThanks very much for the comments.  I think that documentation is the principal hurdle this patch faces so I want to get it right!  I posted a new patch to address your comments.\n\nReplying to [@JohnCremona](#comment%3A6):\n> Also, can you give a more precise but succinct definition of your polynomial_coefficient() function, more than just examples?\n\nWell, I actually thought my description was pretty good.  It's sort of difficult to get succinct.  Feel free to post better alternatives to the first paragraph of polynomial_coefficient doc-string.",
    "created_at": "2008-03-11T18:25:12Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12675",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```

<a id='comment:7'></a>
**Attachment:** [mpoly-coeff.patch](https://github.com/sagemath/sage/files/ticket2385/mpoly-coeff.patch)

Thanks very much for the comments.  I think that documentation is the principal hurdle this patch faces so I want to get it right!  I posted a new patch to address your comments.

Replying to [@JohnCremona](#comment%3A6):
> Also, can you give a more precise but succinct definition of your polynomial_coefficient() function, more than just examples?

Well, I actually thought my description was pretty good.  It's sort of difficult to get succinct.  Feel free to post better alternatives to the first paragraph of polynomial_coefficient doc-string.



---

archive/issue_events_012007.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2008-03-12T05:17:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "milestone": "sage-2.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12007"
}
```



---

archive/issue_events_012008.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2008-03-12T05:17:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "milestone": "sage-2.10.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12008"
}
```



---

archive/issue_events_012009.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-03-12T09:21:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "rename": {
        "from": "[needs more review] Multivariate Polynomial coefficients",
        "to": "Multivariate Polynomial coefficients"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12009"
}
```



---

archive/issue_events_012010.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-03-12T09:21:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12010"
}
```



---

archive/issue_comments_012676.json:
```json
{
    "body": "<a id='comment:9'></a>\nHaving read it again, I now think that it is extremely clear, and am happy to give the whole thing a positive review.\n\nI get the feeling that my review of this just served to delay adoption of the patch.  If so, sorry!",
    "created_at": "2008-03-12T09:21:06Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12676",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
Having read it again, I now think that it is extremely clear, and am happy to give the whole thing a positive review.

I get the feeling that my review of this just served to delay adoption of the patch.  If so, sorry!



---

archive/issue_comments_012677.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerged in Sage 2.10.4.alpha0",
    "created_at": "2008-03-12T22:04:40Z",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2385#issuecomment-12677",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
Merged in Sage 2.10.4.alpha0



---

archive/issue_events_012011.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-12T22:04:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12011"
}
```



---

archive/issue_events_012012.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-12T22:04:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2385",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2385#event-12012"
}
```
