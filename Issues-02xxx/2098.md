# Issue 2098: [with positive review] rudimentary debian package build support

archive/issues_002098.json:
```json
{
    "body": "Add spkg-build-debian, and hook it in to sage-spkg.\n\n**Assignee:** @timabbott\n\nIssue created by migration from https://trac.sagemath.org/ticket/2098\n\n",
    "closed_at": "2008-02-14T15:18:02Z",
    "created_at": "2008-02-08T03:51:37Z",
    "labels": [
        "component: debian-package",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.10.2",
    "title": "[with positive review] rudimentary debian package build support",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2098",
    "user": "https://github.com/timabbott"
}
```
Add spkg-build-debian, and hook it in to sage-spkg.

**Assignee:** @timabbott

Issue created by migration from https://trac.sagemath.org/ticket/2098





---

archive/attachments_001741.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "debian1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2098/debian1.patch",
    "created_at": "2008-02-08T03:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/timabbott"
}
```



---

archive/issue_comments_012589.json:
```json
{
    "body": "",
    "created_at": "2008-02-08T03:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12589",
    "user": "https://github.com/timabbott"
}
```





---

archive/attachments_001742.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "debian2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2098/debian2.patch",
    "created_at": "2008-02-08T21:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/timabbott"
}
```



---

archive/issue_comments_012590.json:
```json
{
    "body": "",
    "created_at": "2008-02-08T21:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12590",
    "user": "https://github.com/timabbott"
}
```





---

archive/attachments_001743.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "debian4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2098/debian4.patch",
    "created_at": "2008-02-10T02:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/timabbott"
}
```



---

archive/issue_comments_012591.json:
```json
{
    "body": "",
    "created_at": "2008-02-10T02:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12591",
    "user": "https://github.com/timabbott"
}
```





---

archive/issue_comments_012592.json:
```json
{
    "body": "<a id='comment:1'></a>\nsage-build-debian will probably eventually want to look something like this.  I'm not applying it as a patch because it'll break the previous patchset:\n\nDEBIAN_REPO would be set to point to a temporary Debian repository that is in the approx sources.list for SAGE, so that each package has its dependencies uploaded to the test repo when it comes time to build it for Debian.\n\n#!/bin/sh -x\necho \"Starting Debian build\"\n[ -d dist/debian ] || exit 0 # exit cleanly for packages we're using the Debian versions of\nmv dist/debian src/\nsage-dasource src/\nsage-sbuildhack \"$DEBIAN_RELEASE\" *.dsc || exit 1\nmkdir -p $SAGE_ROOT/deb\nDEBIAN_ARCH=$(echo lenny-amd64 | cut -f 2 -d-)\nreprepro -b $DEBIAN_REPO --ignore=wrongdistribution include *_${DEBIAN_ARCH}.changes\nmv *.dsc *.changes *.build *.deb *.tar.gz *.diff.gz /deb\necho \"Debian Build complete\"",
    "created_at": "2008-02-10T03:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12592",
    "user": "https://github.com/timabbott"
}
```

<a id='comment:1'></a>
sage-build-debian will probably eventually want to look something like this.  I'm not applying it as a patch because it'll break the previous patchset:

DEBIAN_REPO would be set to point to a temporary Debian repository that is in the approx sources.list for SAGE, so that each package has its dependencies uploaded to the test repo when it comes time to build it for Debian.

#!/bin/sh -x
echo "Starting Debian build"
[ -d dist/debian ] || exit 0 # exit cleanly for packages we're using the Debian versions of
mv dist/debian src/
sage-dasource src/
sage-sbuildhack "$DEBIAN_RELEASE" *.dsc || exit 1
mkdir -p $SAGE_ROOT/deb
DEBIAN_ARCH=$(echo lenny-amd64 | cut -f 2 -d-)
reprepro -b $DEBIAN_REPO --ignore=wrongdistribution include *_${DEBIAN_ARCH}.changes
mv *.dsc *.changes *.build *.deb *.tar.gz *.diff.gz /deb
echo "Debian Build complete"



---

archive/issue_comments_012593.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe 5th patch is to the sage spkg, not sage_scripts.",
    "created_at": "2008-02-10T03:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12593",
    "user": "https://github.com/timabbott"
}
```

<a id='comment:2'></a>
The 5th patch is to the sage spkg, not sage_scripts.



---

archive/attachments_001744.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "debian5.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2098/debian5.patch",
    "created_at": "2008-02-10T03:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/timabbott"
}
```



---

archive/issue_comments_012594.json:
```json
{
    "body": "",
    "created_at": "2008-02-10T03:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12594",
    "user": "https://github.com/timabbott"
}
```





---

archive/issue_events_006233.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "rename": {
        "from": "rudimentary debian package build support",
        "to": "[with positive review] rudimentary debian package build support"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2098#event-6233"
}
```



---

archive/issue_comments_012595.json:
```json
{
    "body": "<a id='comment:3'></a>\nPatches look good to me. I sat next to Tim as he wrote most of the code, so maybe somebody else wants to take another look. In the end we might need to generalize the code a little more for other packaging systems.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-14T13:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12595",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>
Patches look good to me. I sat next to Tim as he wrote most of the code, so maybe somebody else wants to take another look. In the end we might need to generalize the code a little more for other packaging systems.

Cheers,

Michael



---

archive/issue_comments_012596.json:
```json
{
    "body": "<a id='comment:4'></a>\nMerged debian1.patch-debian5.patch in Sage 2.10.2.alpha0",
    "created_at": "2008-02-14T15:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12596",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Merged debian1.patch-debian5.patch in Sage 2.10.2.alpha0



---

archive/issue_events_006234.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-02-14T15:18:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2098#event-6234"
}
```



---

archive/attachments_001745.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "Sage-2.10.2.alpha2-fix-rudimentatry-Debian-support.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2098/Sage-2.10.2.alpha2-fix-rudimentatry-Debian-support.patch",
    "created_at": "2008-02-14T17:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```



---

archive/issue_comments_012597.json:
```json
{
    "body": "This patch is needed to make the non-Debianized build work again",
    "created_at": "2008-02-14T17:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2098#issuecomment-12597",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

This patch is needed to make the non-Debianized build work again
