# Issue 2642: doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()

archive/issues_002642.json:
```json
{
    "body": "The doctest for .small_roots() randomly fails in 2.11.alpha0.\n\n**Assignee:** @malb\n\nIssue created by migration from https://trac.sagemath.org/ticket/2642\n\n",
    "closed_at": "2008-03-28T07:43:23Z",
    "created_at": "2008-03-22T01:44:36Z",
    "labels": [
        "component: commutative algebra",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.11",
    "title": "doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2642",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```
The doctest for .small_roots() randomly fails in 2.11.alpha0.

**Assignee:** @malb

Issue created by migration from https://trac.sagemath.org/ticket/2642





---

archive/attachments_002432.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac2642-small-roots.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2642/trac2642-small-roots.patch",
    "created_at": "2008-03-22T01:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```



---

archive/issue_comments_017801.json:
```json
{
    "body": "",
    "created_at": "2008-03-22T01:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17801",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```





---

archive/issue_comments_017802.json:
```json
{
    "body": "<a id='comment:1'></a>\nI've attached a patch with one possible fix for the .small_roots() problem.\n\nEvidently the current algorithm can return roots much larger than X, which breaks the doctest.  Under the assumption that more roots==good, I left that behavior (and documented it), and fixed the doctest to search for the root it wants.  Another possible fix would be to filter the roots and discard roots larger than X.",
    "created_at": "2008-03-22T01:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17802",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:1'></a>
I've attached a patch with one possible fix for the .small_roots() problem.

Evidently the current algorithm can return roots much larger than X, which breaks the doctest.  Under the assumption that more roots==good, I left that behavior (and documented it), and fixed the doctest to search for the root it wants.  Another possible fix would be to filter the roots and discard roots larger than X.



---

archive/issue_comments_017803.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-03-22T01:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17803",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_017804.json:
```json
{
    "body": "<a id='comment:3'></a>\nWhat exactly is the failure? The code shouldn't return any roots larger than X afaik iff you take into account that e.g. -1 === (N -1). Probably the representation of finite field elements for which the concept of small makes sense should be clarified in the docstring.",
    "created_at": "2008-03-22T14:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17804",
    "user": "https://github.com/malb"
}
```

<a id='comment:3'></a>
What exactly is the failure? The code shouldn't return any roots larger than X afaik iff you take into account that e.g. -1 === (N -1). Probably the representation of finite field elements for which the concept of small makes sense should be clarified in the docstring.



---

archive/issue_comments_017805.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis does not answer the outstanding question, but while looking at this code (and I did not get past the docstring, this is really not something I am familiar with) I found the following:\n\n```\nsage: N=10001\nsage: p,q = map(lambda (r,m): r, N.factor())\n```\nwhich is so opaque that I could not ignore it.  Pleasr replace that last line with\n\n```\nsage: p,q = N.prime_divisors()\n```\n!!!",
    "created_at": "2008-03-23T17:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17805",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
This does not answer the outstanding question, but while looking at this code (and I did not get past the docstring, this is really not something I am familiar with) I found the following:

```
sage: N=10001
sage: p,q = map(lambda (r,m): r, N.factor())
```
which is so opaque that I could not ignore it.  Pleasr replace that last line with

```
sage: p,q = N.prime_divisors()
```
!!!



---

archive/attachments_002433.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "small_roots_fix.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2642/small_roots_fix.patch",
    "created_at": "2008-03-24T00:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/malb"
}
```



---

archive/issue_comments_017806.json:
```json
{
    "body": "",
    "created_at": "2008-03-24T00:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17806",
    "user": "https://github.com/malb"
}
```





---

archive/issue_comments_017807.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2008-03-24T00:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17807",
    "user": "https://github.com/malb"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_017808.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe attached patch\n* replaces the opaque doctest line with `N.prime_divisors()`\n* enforces roots <= X\n\nThis should fix the issue (it does for me on sage.math).",
    "created_at": "2008-03-24T00:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17808",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>
The attached patch
* replaces the opaque doctest line with `N.prime_divisors()`
* enforces roots <= X

This should fix the issue (it does for me on sage.math).



---

archive/issue_comments_017809.json:
```json
{
    "body": "<a id='comment:6'></a>\nTo be precise this patch is a replacement for Carl's patch because I don't think it is correct.",
    "created_at": "2008-03-24T00:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17809",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>
To be precise this patch is a replacement for Carl's patch because I don't think it is correct.



---

archive/issue_comments_017810.json:
```json
{
    "body": "<a id='comment:7'></a>\nREVIEW:\n\nLooks good (though I don't understand/know this LLL algorithm).  One thing -- cwitty's patch fixed some latexing/formating issues around line 320, and your patch doesn't fix those same issue.  You should remake your patch so that it fixes those formatting issues too, though this isn't at all critical.",
    "created_at": "2008-03-28T07:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17810",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:7'></a>
REVIEW:

Looks good (though I don't understand/know this LLL algorithm).  One thing -- cwitty's patch fixed some latexing/formating issues around line 320, and your patch doesn't fix those same issue.  You should remake your patch so that it fixes those formatting issues too, though this isn't at all critical.



---

archive/issue_events_007671.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "rename": {
        "from": "doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()",
        "to": "[mostly positive review] doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2642#event-7671"
}
```



---

archive/issue_comments_017811.json:
```json
{
    "body": "<a id='comment:8'></a>\nApplied small_roots_fix.patch and the \"latex only\" portion from trac2642-small-roots.patch to Sage 2.11.alpha2",
    "created_at": "2008-03-28T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17811",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:8'></a>
Applied small_roots_fix.patch and the "latex only" portion from trac2642-small-roots.patch to Sage 2.11.alpha2



---

archive/issue_events_007672.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-28T07:43:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2642#event-7672"
}
```



---

archive/issue_events_007673.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "rename": {
        "from": "[mostly positive review] doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()",
        "to": "doctest failure in polynomial_modn_dense_ntl.pyx: .small_roots()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2642#event-7673"
}
```



---

archive/issue_comments_017812.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2008-03-28T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2642#issuecomment-17812",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to positive_review.
