# Issue 2468: inverting a non-invertible matrix over RDF returns weird results

archive/issues_002468.json:
```json
{
    "body": "Check this out:\n\n```\nsage: A = Matrix(RDF, [[1, 0], [0, 0]])\nsage: A.inverse()\n\n[nan nan]\n[nan inf]\n```\n\nThis is, to say the least, weird.  This should throw a ZeroDivisionError instead.\n\n\n**Assignee:** @williamstein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/2468\n\n",
    "closed_at": "2008-03-18T03:22:49Z",
    "created_at": "2008-03-11T02:46:35Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.11",
    "title": "inverting a non-invertible matrix over RDF returns weird results",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2468",
    "user": "https://github.com/aghitza"
}
```
Check this out:

```
sage: A = Matrix(RDF, [[1, 0], [0, 0]])
sage: A.inverse()

[nan nan]
[nan inf]
```

This is, to say the least, weird.  This should throw a ZeroDivisionError instead.


**Assignee:** @williamstein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/2468





---

archive/issue_events_007339.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-11T02:51:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "milestone": "sage-2.10.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2468#event-7339"
}
```



---

archive/issue_comments_018523.json:
```json
{
    "body": "<a id='comment:2'></a>\nI don't see why a ZeroDivisionError should be thrown. Note that Matlab doesn't complain either:\n\n```\n>> a = [1 0; 0 0];\n>> inv(a)\nWarning: Matrix is singular to working precision.\n\nans =\n\n   Inf   Inf\n   Inf   Inf\n```",
    "created_at": "2008-03-13T03:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18523",
    "user": "https://github.com/dfdeshom"
}
```

<a id='comment:2'></a>
I don't see why a ZeroDivisionError should be thrown. Note that Matlab doesn't complain either:

```
>> a = [1 0; 0 0];
>> inv(a)
Warning: Matrix is singular to working precision.

ans =

   Inf   Inf
   Inf   Inf
```



---

archive/issue_comments_018524.json:
```json
{
    "body": "<a id='comment:3'></a>\nI agree with dfdeshom.  The relevant code that does the inverse is\n\n```\nresult_invert = gsl_linalg_LU_invert(self._LU,self._p,M._matrix)\n```\n\nNote that 1/RDF(0) also doesn't give ZeroDivisionError:\n\n```\nsage: 1/RDF(0)\ninf\n```\n\nSo I think that (1) this ticket should be resolved with a patch\nthat simply adds a doctest with this nan/inf behavior and says\nwhat the deal is in the docs.",
    "created_at": "2008-03-13T03:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18524",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
I agree with dfdeshom.  The relevant code that does the inverse is

```
result_invert = gsl_linalg_LU_invert(self._LU,self._p,M._matrix)
```

Note that 1/RDF(0) also doesn't give ZeroDivisionError:

```
sage: 1/RDF(0)
inf
```

So I think that (1) this ticket should be resolved with a patch
that simply adds a doctest with this nan/inf behavior and says
what the deal is in the docs.



---

archive/issue_comments_018525.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-03-14T05:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18525",
    "user": "https://github.com/dfdeshom"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_018526.json:
```json
{
    "body": "<a id='comment:4'></a>\nI've added a patch that, in addition:\n\n* adds some doctests to this file\n* corrects a bug where subtraction of RDF matrices would always throw an error",
    "created_at": "2008-03-14T05:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18526",
    "user": "https://github.com/dfdeshom"
}
```

<a id='comment:4'></a>
I've added a patch that, in addition:

* adds some doctests to this file
* corrects a bug where subtraction of RDF matrices would always throw an error



---

archive/attachments_002224.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "2468.hg",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2468/2468.hg",
    "created_at": "2008-03-14T05:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.hg",
    "user": "https://github.com/dfdeshom"
}
```



---

archive/issue_comments_018527.json:
```json
{
    "body": "correct a small typo in patch",
    "created_at": "2008-03-14T05:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18527",
    "user": "https://github.com/dfdeshom"
}
```

correct a small typo in patch



---

archive/issue_comments_018528.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2008-03-18T02:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18528",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_018529.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [dfdeshom](#comment%3A4):\n> I've added a patch that, in addition:\n> \n> * adds some doctests to this file\n> * corrects a bug where subtraction of RDF matrices would always throw an error\n\n\nVery nice! Before the patch:\n\n```\n----------------------------------------------------------------------\n| SAGE Version 2.10.4, Release Date: 2008-03-16                      |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: m = Matrix(RDF, [[1,2],[3,4]])\nsage: n=m^2\nsage: n+m\n\n[ 8.0 12.0]\n[18.0 26.0]\nsage: n-m\n---------------------------------------------------------------------------\n<type 'exceptions.ValueError'>            Traceback (most recent call last)\n\n/scratch/mabshoff/release-cycle/sage-2.11.alpha0/<ipython console> in <module>()\n\n/scratch/mabshoff/release-cycle/sage-2.11.alpha0/element.pyx in sage.structure.element.ModuleElement.__sub__()\n\n/scratch/mabshoff/release-cycle/sage-2.11.alpha0/coerce.pxi in sage.structure.element._sub_c()\n\n/scratch/mabshoff/release-cycle/sage-2.11.alpha0/matrix_real_double_dense.pyx in sage.matrix.matrix_real_double_dense.Matrix_real_double_dense._sub_c_impl()\n\n<type 'exceptions.ValueError'>: GSL routine had an error\nsage:\n```\nI will add a doctest patch for this bug since it is currently missing.\n\nCheers,\n\nMichael",
    "created_at": "2008-03-18T02:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18529",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Replying to [dfdeshom](#comment%3A4):
> I've added a patch that, in addition:
> 
> * adds some doctests to this file
> * corrects a bug where subtraction of RDF matrices would always throw an error


Very nice! Before the patch:

```
----------------------------------------------------------------------
| SAGE Version 2.10.4, Release Date: 2008-03-16                      |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: m = Matrix(RDF, [[1,2],[3,4]])
sage: n=m^2
sage: n+m

[ 8.0 12.0]
[18.0 26.0]
sage: n-m
---------------------------------------------------------------------------
<type 'exceptions.ValueError'>            Traceback (most recent call last)

/scratch/mabshoff/release-cycle/sage-2.11.alpha0/<ipython console> in <module>()

/scratch/mabshoff/release-cycle/sage-2.11.alpha0/element.pyx in sage.structure.element.ModuleElement.__sub__()

/scratch/mabshoff/release-cycle/sage-2.11.alpha0/coerce.pxi in sage.structure.element._sub_c()

/scratch/mabshoff/release-cycle/sage-2.11.alpha0/matrix_real_double_dense.pyx in sage.matrix.matrix_real_double_dense.Matrix_real_double_dense._sub_c_impl()

<type 'exceptions.ValueError'>: GSL routine had an error
sage:
```
I will add a doctest patch for this bug since it is currently missing.

Cheers,

Michael



---

archive/issue_comments_018530.json:
```json
{
    "body": "<a id='comment:6'></a>\nOk, I now figured out that you also added a doctest for the bug you fixed. So disregard my comment about adding a doctest.\n\nCheers,\n\nMichael",
    "created_at": "2008-03-18T03:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18530",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Ok, I now figured out that you also added a doctest for the bug you fixed. So disregard my comment about adding a doctest.

Cheers,

Michael



---

archive/issue_events_007340.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-18T03:22:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2468#event-7340"
}
```



---

archive/issue_comments_018531.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged in Sage 2.11.alpha0",
    "created_at": "2008-03-18T03:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18531",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
Merged in Sage 2.11.alpha0



---

archive/issue_events_007341.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-18T03:22:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "milestone": "sage-2.10.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2468#event-7341"
}
```



---

archive/issue_events_007342.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-18T03:22:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "milestone": "sage-2.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2468#event-7342"
}
```



---

archive/issue_comments_018532.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-03-18T03:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2468",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2468#issuecomment-18532",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed
