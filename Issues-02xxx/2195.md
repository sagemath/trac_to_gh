# Issue 2195: Givaro-related crash in finite fields

archive/issues_002195.json:
```json
{
    "body": "John Cremona reported this crash:\n\n```\nsage:  E=EllipticCurve(GF(5),[1,1])\nsage:  E1=E.base_extend(GF(125,'a'))\nsage:  E2=E1.base_extend(GF(125^2,'b'))\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occured in SAGE.\nThis probably occured because a *compiled* component\nof SAGE has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run SAGE under gdb with 'sage -gdb' to debug this.\nSAGE will now terminate (sorry).\n------------------------------------------------------------ \n```\n\nI got a backtrace for the crash, which looks like this:\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0xb7dfb8c0 (LWP 15819)]\n0xb5443782 in\n__pyx_f_4sage_5rings_19finite_field_givaro_25FiniteField_givaroElement__add_c_impl\n(__pyx_v_self=0x9e10d74, __pyx_v_right=0x9e10f7c)\n    at /home/cwitty/sage/local//include/givaro/givgfq.inl:292\n292     { _GIVARO_GFQ_ADD(r, a, b, GFqDom<TT>::_qm1,\nGFqDom<TT>::_plus1) ; return r; }\n(gdb) bt\n#0  0xb5443782 in\n__pyx_f_4sage_5rings_19finite_field_givaro_25FiniteField_givaroElement__add_c_impl\n(__pyx_v_self=0x9e10d74, __pyx_v_right=0x9e10f7c)\n    at /home/cwitty/sage/local//include/givaro/givgfq.inl:292\n#1  0xb71eac7f in\n__pyx_pf_4sage_9structure_7element_13ModuleElement___add__ (\n    __pyx_v_left=0x9e10d74, __pyx_v_right=0x9e10f7c)\n    at sage/structure/element.c:15976\n#2  0x0805ce33 in binary_op1 (v=0x9e10d74, w=0xbfb53d64, op_slot=0)\n    at Objects/abstract.c:398\n#3  0x0805d310 in PyNumber_Add (v=0x9e10d74, w=0x9e10f7c)\n    at Objects/abstract.c:638 \n```\n\n\n**Assignee:** @ClementPernet\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/2195\n\n",
    "closed_at": "2008-04-14T20:53:54Z",
    "created_at": "2008-02-17T18:57:35Z",
    "labels": [
        "component: finite rings",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0",
    "title": "Givaro-related crash in finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2195",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```
John Cremona reported this crash:

```
sage:  E=EllipticCurve(GF(5),[1,1])
sage:  E1=E.base_extend(GF(125,'a'))
sage:  E2=E1.base_extend(GF(125^2,'b'))

------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occured in SAGE.
This probably occured because a *compiled* component
of SAGE has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run SAGE under gdb with 'sage -gdb' to debug this.
SAGE will now terminate (sorry).
------------------------------------------------------------ 
```

I got a backtrace for the crash, which looks like this:

```
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0xb7dfb8c0 (LWP 15819)]
0xb5443782 in
__pyx_f_4sage_5rings_19finite_field_givaro_25FiniteField_givaroElement__add_c_impl
(__pyx_v_self=0x9e10d74, __pyx_v_right=0x9e10f7c)
    at /home/cwitty/sage/local//include/givaro/givgfq.inl:292
292     { _GIVARO_GFQ_ADD(r, a, b, GFqDom<TT>::_qm1,
GFqDom<TT>::_plus1) ; return r; }
(gdb) bt
#0  0xb5443782 in
__pyx_f_4sage_5rings_19finite_field_givaro_25FiniteField_givaroElement__add_c_impl
(__pyx_v_self=0x9e10d74, __pyx_v_right=0x9e10f7c)
    at /home/cwitty/sage/local//include/givaro/givgfq.inl:292
#1  0xb71eac7f in
__pyx_pf_4sage_9structure_7element_13ModuleElement___add__ (
    __pyx_v_left=0x9e10d74, __pyx_v_right=0x9e10f7c)
    at sage/structure/element.c:15976
#2  0x0805ce33 in binary_op1 (v=0x9e10d74, w=0xbfb53d64, op_slot=0)
    at Objects/abstract.c:398
#3  0x0805d310 in PyNumber_Add (v=0x9e10d74, w=0x9e10f7c)
    at Objects/abstract.c:638 
```


**Assignee:** @ClementPernet

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/2195





---

archive/issue_comments_015832.json:
```json
{
    "body": "<a id='comment:1'></a>\nNote that on sage.math the crash does not happen, instead we get an exception thrown by python complaining about:\n\n```\nsage: E=EllipticCurve(GF(5),[1,1])\nsage: E1=E.base_extend(GF(125,'a'))\nsage: E2=E1.base_extend(GF(125^2,'b'))\n---------------------------------------------------------------------------\n<type 'exceptions.ArithmeticError'>       Traceback (most recent call last)\n\n/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/<ipython console> in <module>()\n\n/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)\n    756         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4\n    757         \"\"\"\n--> 758         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])\n    759\n    760     def base_ring(self):\n\n/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/constructor.py in EllipticCurve(x, y)\n    159\n    160     elif isinstance(x[0], rings.FiniteFieldElement) or rings.is_IntegerMod(x[0]):\n--> 161         return ell_finite_field.EllipticCurve_finite_field(x, y)\n    162\n    163     else:\n\n/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_finite_field.py in __init__(self, x, y)\n     73             raise TypeError\n     74\n---> 75         EllipticCurve_field.__init__(self, ainvs)\n     76\n     77         self._point_class = ell_point.EllipticCurvePoint_finite_field\n\n/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in __init__(self, ainvs, extra)\n    135         if self.discriminant() == 0:\n    136             raise ArithmeticError, \\\n--> 137                   \"Invariants %s define a singular curve.\"%ainvs\n    138         PP = projective_space.ProjectiveSpace(2, K, names='xyz');\n    139         x, y, z = PP.coordinate_ring().gens()\n\n<type 'exceptions.ArithmeticError'>: Invariants [0, 0, 0, 0, 0] define a singular curve.\n```\nI ran the same code under valgrind and there are no leads from that end. It is probably some bug that is only triggered with certain compilers.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-17T19:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15832",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
Note that on sage.math the crash does not happen, instead we get an exception thrown by python complaining about:

```
sage: E=EllipticCurve(GF(5),[1,1])
sage: E1=E.base_extend(GF(125,'a'))
sage: E2=E1.base_extend(GF(125^2,'b'))
---------------------------------------------------------------------------
<type 'exceptions.ArithmeticError'>       Traceback (most recent call last)

/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/<ipython console> in <module>()

/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)
    756         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4
    757         """
--> 758         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])
    759
    760     def base_ring(self):

/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/constructor.py in EllipticCurve(x, y)
    159
    160     elif isinstance(x[0], rings.FiniteFieldElement) or rings.is_IntegerMod(x[0]):
--> 161         return ell_finite_field.EllipticCurve_finite_field(x, y)
    162
    163     else:

/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_finite_field.py in __init__(self, x, y)
     73             raise TypeError
     74
---> 75         EllipticCurve_field.__init__(self, ainvs)
     76
     77         self._point_class = ell_point.EllipticCurvePoint_finite_field

/scratch/mabshoff/release-cycle/sage-2.10.2.alpha1/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in __init__(self, ainvs, extra)
    135         if self.discriminant() == 0:
    136             raise ArithmeticError, \
--> 137                   "Invariants %s define a singular curve."%ainvs
    138         PP = projective_space.ProjectiveSpace(2, K, names='xyz');
    139         x, y, z = PP.coordinate_ring().gens()

<type 'exceptions.ArithmeticError'>: Invariants [0, 0, 0, 0, 0] define a singular curve.
```
I ran the same code under valgrind and there are no leads from that end. It is probably some bug that is only triggered with certain compilers.

Cheers,

Michael



---

archive/issue_comments_015833.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [2195-valgrind](tarball://root/attachments/some-uuid/ticket2195/2195-valgrind) by cwitty created at 2008-02-17 19:22:39\n\nI've attached a valgrind record from my laptop.  (Actually, this is only the beginning of the valgrind record... I cut out the memory leak reports at the end.)\n\nI wonder if it could be a 32-bit vs. 64-bit issue?  My laptop is 32-bit.",
    "created_at": "2008-02-17T19:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15833",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:2'></a>
Attachment [2195-valgrind](tarball://root/attachments/some-uuid/ticket2195/2195-valgrind) by cwitty created at 2008-02-17 19:22:39

I've attached a valgrind record from my laptop.  (Actually, this is only the beginning of the valgrind record... I cut out the memory leak reports at the end.)

I wonder if it could be a 32-bit vs. 64-bit issue?  My laptop is 32-bit.



---

archive/issue_comments_015834.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [cwitty](#comment%3A2):\n> I've attached a valgrind record from my laptop.  (Actually, this is only the beginning of the valgrind record... I cut out the memory leak reports at the end.)\n> \n> I wonder if it could be a 32-bit vs. 64-bit issue?  My laptop is 32-bit.\n\n\nI'm pretty sure that my original report was from a 32-bit machine.",
    "created_at": "2008-02-17T20:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15834",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Replying to [cwitty](#comment%3A2):
> I've attached a valgrind record from my laptop.  (Actually, this is only the beginning of the valgrind record... I cut out the memory leak reports at the end.)
> 
> I wonder if it could be a 32-bit vs. 64-bit issue?  My laptop is 32-bit.


I'm pretty sure that my original report was from a 32-bit machine.



---

archive/issue_comments_015835.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think these are related bugs:\n\n```\nsage: version()\n'SAGE Version 2.10.3.alpha0, Release Date: 2008-02-25'\n\nsage: FF.<z> = GF(3^2,\"z\")\nsage: b = GF(3,\"zz\").random_element()\nsage: FF(b)\n2\n```\nThis works fine. Now try a bigger field:\n\n```\nsage: FF.<z> = GF(13^9,\"z\")\nsage: b = GF(13**3,\"zz\").random_element()\nsage: FF(b)\n---------------------------------------------------------------------------\n<type 'exceptions.TypeError'>             Traceback (most recent call last)\n\n...\n\n<type 'exceptions.TypeError'>: unable to coerce element to an integer\nno coercion defined\n```\nUnless my brain cells are mis-firing, GF(13**3) is a subfield of GF(13**9).\n\nHere is the smallest example I found:\n\n```\nsage: FF.<z> = GF(5^8,\"z\")\nsage: b = GF(5^4,\"zz\").random_element()\nsage: FF(b)\n---------------------------------------------------------------------------\n<type 'exceptions.TypeError'>             Traceback (most recent call last)\n....\n```\n\n(If you replace 5**8 -> 5**6 and 5**4 -> 5**3, it works okay.)\n\nAlso:\n\n```\nsage: FF.<z> = GF(5^6,\"z\")\nsage: b = GF(5^3,\"zz\")(0); b; FF(b)\n0\n2*z^3 + 4*z^2 + 4*z\nsage: b = GF(5^3,\"zz\")(1); b; FF(b)\n1\n2*z^3 + 4*z^2 + 4*z\n```\nIt doesn't give a traceback for some reason, though it is clearly wrong.",
    "created_at": "2008-03-01T13:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15835",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:4'></a>
I think these are related bugs:

```
sage: version()
'SAGE Version 2.10.3.alpha0, Release Date: 2008-02-25'

sage: FF.<z> = GF(3^2,"z")
sage: b = GF(3,"zz").random_element()
sage: FF(b)
2
```
This works fine. Now try a bigger field:

```
sage: FF.<z> = GF(13^9,"z")
sage: b = GF(13**3,"zz").random_element()
sage: FF(b)
---------------------------------------------------------------------------
<type 'exceptions.TypeError'>             Traceback (most recent call last)

...

<type 'exceptions.TypeError'>: unable to coerce element to an integer
no coercion defined
```
Unless my brain cells are mis-firing, GF(13**3) is a subfield of GF(13**9).

Here is the smallest example I found:

```
sage: FF.<z> = GF(5^8,"z")
sage: b = GF(5^4,"zz").random_element()
sage: FF(b)
---------------------------------------------------------------------------
<type 'exceptions.TypeError'>             Traceback (most recent call last)
....
```

(If you replace 5**8 -> 5**6 and 5**4 -> 5**3, it works okay.)

Also:

```
sage: FF.<z> = GF(5^6,"z")
sage: b = GF(5^3,"zz")(0); b; FF(b)
0
2*z^3 + 4*z^2 + 4*z
sage: b = GF(5^3,"zz")(1); b; FF(b)
1
2*z^3 + 4*z^2 + 4*z
```
It doesn't give a traceback for some reason, though it is clearly wrong.



---

archive/issue_events_006471.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-15T02:28:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "milestone": "sage-2.10.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2195#event-6471"
}
```



---

archive/issue_comments_015836.json:
```json
{
    "body": "<a id='comment:6'></a>\nI ran this under 2.10.4.alpha0 with the updated givaro.spkg from #2525 and the valgrind log is clean. I guess time will tell if the problem is gone when cwitty will hopefully test this in the morning on a 32 bit setup.\n\nCheers,\n\nMichael",
    "created_at": "2008-03-15T02:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15836",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
I ran this under 2.10.4.alpha0 with the updated givaro.spkg from #2525 and the valgrind log is clean. I guess time will tell if the problem is gone when cwitty will hopefully test this in the morning on a 32 bit setup.

Cheers,

Michael



---

archive/issue_events_006472.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "label": "component: givaro",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2195#event-6472"
}
```



---

archive/issue_comments_015837.json:
```json
{
    "body": "**Assignee:** @ClementPernet",
    "created_at": "2008-03-16T01:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15837",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Assignee:** @ClementPernet



---

archive/issue_comments_015838.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis is still a problem with the updated Givaro.spkg from #2524. Assigning to Clement so he can hopefully hunt this down.\n\nCheers,\n\nMichael",
    "created_at": "2008-03-16T01:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15838",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
This is still a problem with the updated Givaro.spkg from #2524. Assigning to Clement so he can hopefully hunt this down.

Cheers,

Michael



---

archive/issue_comments_015839.json:
```json
{
    "body": "<a id='comment:8'></a>\nAfter #2916 this should now always throw an exception instead of producing undefined behaviour. As wdj pointed out, casts between finite fields could give weird results.",
    "created_at": "2008-04-14T20:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15839",
    "user": "https://github.com/wjp"
}
```

<a id='comment:8'></a>
After #2916 this should now always throw an exception instead of producing undefined behaviour. As wdj pointed out, casts between finite fields could give weird results.



---

archive/issue_comments_015840.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-04-14T20:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15840",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_006473.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-04-14T20:53:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2195#event-6473"
}
```



---

archive/issue_comments_015841.json:
```json
{
    "body": "<a id='comment:9'></a>\nAfter applying wjp's patch from #2916 I get the following now:\n\n```\nsage: sage:  E=EllipticCurve(GF(5),[1,1])\nsage: sage:  E1=E.base_extend(GF(125,'a'))\nsage: sage:  E2=E1.base_extend(GF(125^2,'b'))\n---------------------------------------------------------------------------\n<type 'exceptions.TypeError'>             Traceback (most recent call last)\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha5/<ipython console> in <module>()\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha5/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)\n    849         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4\n    850         \"\"\"\n--> 851         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])\n    852\n    853     def base_ring(self):\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha5/finite_field_givaro.pyx in sage.rings.finite_field_givaro.FiniteField_givaro.__call__ (sage/rings/finite_field_givaro.cpp:3264)()\n\n<type 'exceptions.TypeError'>: unable to coerce from a finite field other than the prime subfield\nsage:\n```\nwjp confirmed that the issue is also fixed on his computer, so I am closing this.\n\nJohn: once you have 3.0.alpha5 or final can you please check that this is also fixed for you or otherwise reopen?\n\nGreat work wjp.\n\nCheers,\n\nMichael",
    "created_at": "2008-04-14T20:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15841",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
After applying wjp's patch from #2916 I get the following now:

```
sage: sage:  E=EllipticCurve(GF(5),[1,1])
sage: sage:  E1=E.base_extend(GF(125,'a'))
sage: sage:  E2=E1.base_extend(GF(125^2,'b'))
---------------------------------------------------------------------------
<type 'exceptions.TypeError'>             Traceback (most recent call last)

/scratch/mabshoff/release-cycle/sage-3.0.alpha5/<ipython console> in <module>()

/scratch/mabshoff/release-cycle/sage-3.0.alpha5/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)
    849         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4
    850         """
--> 851         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])
    852
    853     def base_ring(self):

/scratch/mabshoff/release-cycle/sage-3.0.alpha5/finite_field_givaro.pyx in sage.rings.finite_field_givaro.FiniteField_givaro.__call__ (sage/rings/finite_field_givaro.cpp:3264)()

<type 'exceptions.TypeError'>: unable to coerce from a finite field other than the prime subfield
sage:
```
wjp confirmed that the issue is also fixed on his computer, so I am closing this.

John: once you have 3.0.alpha5 or final can you please check that this is also fixed for you or otherwise reopen?

Great work wjp.

Cheers,

Michael



---

archive/issue_comments_015842.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [mabshoff](#comment%3A9):\n> After applying wjp's patch from #2916 I get the following now:\n> \n> ```\n> sage: sage:  E=EllipticCurve(GF(5),[1,1])\n> sage: sage:  E1=E.base_extend(GF(125,'a'))\n> sage: sage:  E2=E1.base_extend(GF(125^2,'b'))\n> ---------------------------------------------------------------------------\n> <type 'exceptions.TypeError'>             Traceback (most recent call last)\n> \n> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/<ipython console> in <module>()\n> \n> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)\n>     849         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4\n>     850         \"\"\"\n> --> 851         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])\n>     852\n>     853     def base_ring(self):\n> \n> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/finite_field_givaro.pyx in sage.rings.finite_field_givaro.FiniteField_givaro.__call__ (sage/rings/finite_field_givaro.cpp:3264)()\n> \n> <type 'exceptions.TypeError'>: unable to coerce from a finite field other than the prime subfield\n> sage:\n> ```\n> wjp confirmed that the issue is also fixed on his computer, so I am closing this.\n> \n> John: once you have 3.0.alpha5 or final can you please check that this is also fixed for you or otherwise reopen?\n\n\nOK, I'll do that in the next day or so (I'm at a conference with no evening internet access).\n\nJohn\n\n> \n> Great work wjp.\n> \n> Cheers,\n> \n> Michael\n",
    "created_at": "2008-04-15T16:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15842",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
Replying to [mabshoff](#comment%3A9):
> After applying wjp's patch from #2916 I get the following now:
> 
> ```
> sage: sage:  E=EllipticCurve(GF(5),[1,1])
> sage: sage:  E1=E.base_extend(GF(125,'a'))
> sage: sage:  E2=E1.base_extend(GF(125^2,'b'))
> ---------------------------------------------------------------------------
> <type 'exceptions.TypeError'>             Traceback (most recent call last)
> 
> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/<ipython console> in <module>()
> 
> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_generic.py in base_extend(self, R)
>     849         Elliptic Curve defined by y^2  = x^3 + x + (4*b^3+4*b^2+4*b+3) over Finite Field in b of size 5^4
>     850         """
> --> 851         return constructor.EllipticCurve([R(a) for a in self.a_invariants()])
>     852
>     853     def base_ring(self):
> 
> /scratch/mabshoff/release-cycle/sage-3.0.alpha5/finite_field_givaro.pyx in sage.rings.finite_field_givaro.FiniteField_givaro.__call__ (sage/rings/finite_field_givaro.cpp:3264)()
> 
> <type 'exceptions.TypeError'>: unable to coerce from a finite field other than the prime subfield
> sage:
> ```
> wjp confirmed that the issue is also fixed on his computer, so I am closing this.
> 
> John: once you have 3.0.alpha5 or final can you please check that this is also fixed for you or otherwise reopen?


OK, I'll do that in the next day or so (I'm at a conference with no evening internet access).

John

> 
> Great work wjp.
> 
> Cheers,
> 
> Michael




---

archive/issue_comments_015843.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe issue is resolved (in 3.0.alpha5) in the sense that it throws an exception rather than crashing.\n\nTo get anything better than that we will have to do serious work on the finite field implementationa (as in previous discussions which referred to the Cannon-Bosma-Steele paper describing how Magma does it).\n\nJohn",
    "created_at": "2008-04-16T12:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2195#issuecomment-15843",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>
The issue is resolved (in 3.0.alpha5) in the sense that it throws an exception rather than crashing.

To get anything better than that we will have to do serious work on the finite field implementationa (as in previous discussions which referred to the Cannon-Bosma-Steele paper describing how Magma does it).

John
