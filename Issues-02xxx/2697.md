# Issue 2697: [with patch, positive review] allow integration without explicit variable declaration

archive/issues_002697.json:
```json
{
    "body": "This is right:\n\n```\nsage: integrate(x, x,-1,1)\n0\n```\n\nThis error message (which is because I forgot to give the variable of integration) is\ncompletely broken. The \"raise err\" line in the source code should be just \"raise\", i.e., delete err, which makes no sense. Or?  Anyway, this is just wrong as is.\n\n```\nsage: integrate(x, -1,1)\n---------------------------------------------------------------------------\n<type 'exceptions.ValueError'>            Traceback (most recent call last)\n\n/Users/was/<ipython console> in <module>()\n\n/Users/was/build/sage-2.10.4/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)\n    255         return f.integral(*args, **kwds)\n    256     except ValueError, err:\n--> 257         raise err\n    258     except AttributeError:\n    259         pass\n\n<type 'exceptions.ValueError'>: variable name is not a valid Python identifier\n\n```\n\nAssignee: @kcrisman\n\nCC:  @robertwb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/2697\n\n",
    "closed_at": "2009-01-24T18:41:51Z",
    "created_at": "2008-03-28T07:39:54Z",
    "labels": [
        "component: calculus"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "[with patch, positive review] allow integration without explicit variable declaration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2697",
    "user": "https://github.com/williamstein"
}
```
This is right:

```
sage: integrate(x, x,-1,1)
0
```

This error message (which is because I forgot to give the variable of integration) is
completely broken. The "raise err" line in the source code should be just "raise", i.e., delete err, which makes no sense. Or?  Anyway, this is just wrong as is.

```
sage: integrate(x, -1,1)
---------------------------------------------------------------------------
<type 'exceptions.ValueError'>            Traceback (most recent call last)

/Users/was/<ipython console> in <module>()

/Users/was/build/sage-2.10.4/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)
    255         return f.integral(*args, **kwds)
    256     except ValueError, err:
--> 257         raise err
    258     except AttributeError:
    259         pass

<type 'exceptions.ValueError'>: variable name is not a valid Python identifier

```

Assignee: @kcrisman

CC:  @robertwb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/2697





---

archive/issue_comments_020049.json:
```json
{
    "body": "<a id='comment:1'></a>I am not sure that the suggested fix does solve the problem:\n\n```\nsage: integrate(x, -1,1)\n---------------------------------------------------------------------------\n<type 'exceptions.ValueError'>            Traceback (most recent call last)\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/<ipython console> in <module>()\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)\n    253     \"\"\"\n    254     try:\n--> 255         return f.integral(*args, **kwds)\n    256     except ValueError, err:\n    257         raise\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in integral(self, v, a, b)\n   2475\n   2476         if not isinstance(v, SymbolicVariable):\n-> 2477             v = var(repr(v))\n   2478             #raise TypeError, 'must integrate with respect to a variable'\n   2479         if (a is None and (not b is None)) or (b is None and (not a is None)):\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in var(s, create)\n   5238             raise ValueError, \"the variable '%s' has not been defined\"%var\n   5239         pass\n-> 5240     v = SymbolicVariable(s)\n   5241     _vars[s] = v\n   5242     _syms[s] = v\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in __init__(self, name)\n   5072             raise ValueError, \"variable name must be nonempty\"\n   5073         elif not is_python_identifier.match(name):\n-> 5074             raise ValueError, \"variable name is not a valid Python identifier\"\n   5075\n   5076     def __hash__(self):\n\n<type 'exceptions.ValueError'>: variable name is not a valid Python identifier\nsage:\n```\n\nThoughts?\n\nCheers,\n\nMichael",
    "created_at": "2008-04-09T02:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20049",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>I am not sure that the suggested fix does solve the problem:

```
sage: integrate(x, -1,1)
---------------------------------------------------------------------------
<type 'exceptions.ValueError'>            Traceback (most recent call last)

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/<ipython console> in <module>()

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)
    253     """
    254     try:
--> 255         return f.integral(*args, **kwds)
    256     except ValueError, err:
    257         raise

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in integral(self, v, a, b)
   2475
   2476         if not isinstance(v, SymbolicVariable):
-> 2477             v = var(repr(v))
   2478             #raise TypeError, 'must integrate with respect to a variable'
   2479         if (a is None and (not b is None)) or (b is None and (not a is None)):

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in var(s, create)
   5238             raise ValueError, "the variable '%s' has not been defined"%var
   5239         pass
-> 5240     v = SymbolicVariable(s)
   5241     _vars[s] = v
   5242     _syms[s] = v

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in __init__(self, name)
   5072             raise ValueError, "variable name must be nonempty"
   5073         elif not is_python_identifier.match(name):
-> 5074             raise ValueError, "variable name is not a valid Python identifier"
   5075
   5076     def __hash__(self):

<type 'exceptions.ValueError'>: variable name is not a valid Python identifier
sage:
```

Thoughts?

Cheers,

Michael



---

archive/issue_comments_020050.json:
```json
{
    "body": "Apply this patch to 3.1.4 to integrate without variables (sometimes)",
    "created_at": "2008-10-17T02:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20050",
    "user": "https://github.com/kcrisman"
}
```

Apply this patch to 3.1.4 to integrate without variables (sometimes)



---

archive/issue_comments_020051.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2008-10-17T03:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20051",
    "user": "https://github.com/kcrisman"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_020052.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [int_without_var.patch](tarball://root/attachments/some-uuid/ticket2697/int_without_var.patch) by @kcrisman created at 2008-10-17 03:02:38\n\nThese should now work:\n\n```\nsage: integrate(x, -1,1)\n0\nsage: integrate(sin(x),0,pi)\n2\n```\n\nSadly, because I don't know enough about Maxima to get it to accept the default variable, we still get this joke one might make in freshman calculus:\n\n```\nsage: integrate(sin,0,pi) \npi*sin \n```",
    "created_at": "2008-10-17T03:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20052",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>Attachment [int_without_var.patch](tarball://root/attachments/some-uuid/ticket2697/int_without_var.patch) by @kcrisman created at 2008-10-17 03:02:38

These should now work:

```
sage: integrate(x, -1,1)
0
sage: integrate(sin(x),0,pi)
2
```

Sadly, because I don't know enough about Maxima to get it to accept the default variable, we still get this joke one might make in freshman calculus:

```
sage: integrate(sin,0,pi) 
pi*sin 
```



---

archive/issue_comments_020053.json:
```json
{
    "body": "<a id='comment:3'></a>I'm getting\n\n```\nsage: integrate(sin(x), pi, 2*pi)\n------------------------------------------------------------\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py\", line 254, in integral\n    return f.integral(*args, **kwds)\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2586, in integral\n    raise TypeError, 'only one endpoint given'\nTypeError: only one endpoint given\n```\n\nRather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. \n\n```\nsage: integrate(sin(x))               # 0 args, implicit indefinite\ncos(x)\nsage: integrate(sin(x), y)            # 1 arg, explicit indefinite\nsin(x)*y\nsage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite\n-2\nsage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite\npi*sin(x)\n```",
    "created_at": "2008-10-30T21:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20053",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>I'm getting

```
sage: integrate(sin(x), pi, 2*pi)
------------------------------------------------------------
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py", line 254, in integral
    return f.integral(*args, **kwds)
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2586, in integral
    raise TypeError, 'only one endpoint given'
TypeError: only one endpoint given
```

Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. 

```
sage: integrate(sin(x))               # 0 args, implicit indefinite
cos(x)
sage: integrate(sin(x), y)            # 1 arg, explicit indefinite
sin(x)*y
sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite
-2
sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite
pi*sin(x)
```



---

archive/issue_comments_020054.json:
```json
{
    "body": "Changing assignee from @williamstein to @kcrisman.",
    "created_at": "2008-11-01T03:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20054",
    "user": "https://github.com/kcrisman"
}
```

Changing assignee from @williamstein to @kcrisman.



---

archive/issue_comments_020055.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 robertwb]:\n\nPosting (final? I hope) version of patch, based on 3.2.alpha0.  Passed doctests for calculus.py once, all other times it timed out for me, but I do not believe it changes pre-existing correct behavior.\n\n> I'm getting\n> \n> \n> ```\n> sage: integrate(sin(x), pi, 2*pi)\n> ------------------------------------------------------------\n> Traceback (most recent call last):\n>   File \"<ipython console>\", line 1, in <module>\n>   File \"/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py\", line 254, in integral\n>     return f.integral(*args, **kwds)\n>   File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2586, in integral\n>     raise TypeError, 'only one endpoint given'\n> TypeError: only one endpoint given\n> ```\n> \n\n\nTurns out that this actually comes from the original code, where the second item was turned into a variable in case someone used some already-in-use identifier for the variable; the problem was that it turned things like e and pi into variables.  \n\n> Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. \n> \n> \n> ```\n> sage: integrate(sin(x))               # 0 args, implicit indefinite\n> cos(x)\n> sage: integrate(sin(x), y)            # 1 arg, explicit indefinite\n> sin(x)*y\n> sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite\n> -2\n> sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite\n> pi*sin(x)\n> ```\n\n\nGood idea!  In the end, though, it was easier for me to just jury-rig the code as is.  When I make my own functions I try to do that sort of planning, but I don't feel confident enough (or have enough time) to completely change the way this type of code works.  Hopefully my final solution is still pretty good, though; it does all of the above, except you will have to declare y beforehand (I couldn't find a way around that), and the first integral is -cos(x) :)\n\nAs a bonus, I was finally able to figure out how to do this, which now works:\n\n```\nsage: integrate(sin,0,pi)\n2\n```\nThat alone is worth it for me.",
    "created_at": "2008-11-01T03:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20055",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>Replying to [comment:3 robertwb]:

Posting (final? I hope) version of patch, based on 3.2.alpha0.  Passed doctests for calculus.py once, all other times it timed out for me, but I do not believe it changes pre-existing correct behavior.

> I'm getting
> 
> 
> ```
> sage: integrate(sin(x), pi, 2*pi)
> ------------------------------------------------------------
> Traceback (most recent call last):
>   File "<ipython console>", line 1, in <module>
>   File "/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py", line 254, in integral
>     return f.integral(*args, **kwds)
>   File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2586, in integral
>     raise TypeError, 'only one endpoint given'
> TypeError: only one endpoint given
> ```
> 


Turns out that this actually comes from the original code, where the second item was turned into a variable in case someone used some already-in-use identifier for the variable; the problem was that it turned things like e and pi into variables.  

> Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. 
> 
> 
> ```
> sage: integrate(sin(x))               # 0 args, implicit indefinite
> cos(x)
> sage: integrate(sin(x), y)            # 1 arg, explicit indefinite
> sin(x)*y
> sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite
> -2
> sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite
> pi*sin(x)
> ```


Good idea!  In the end, though, it was easier for me to just jury-rig the code as is.  When I make my own functions I try to do that sort of planning, but I don't feel confident enough (or have enough time) to completely change the way this type of code works.  Hopefully my final solution is still pretty good, though; it does all of the above, except you will have to declare y beforehand (I couldn't find a way around that), and the first integral is -cos(x) :)

As a bonus, I was finally able to figure out how to do this, which now works:

```
sage: integrate(sin,0,pi)
2
```
That alone is worth it for me.



---

archive/issue_comments_020056.json:
```json
{
    "body": "Attachment [int_without_var-final.patch](tarball://root/attachments/some-uuid/ticket2697/int_without_var-final.patch) by @kcrisman created at 2008-11-01 03:20:21\n\nBased on 3.2.alpha0",
    "created_at": "2008-11-01T03:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20056",
    "user": "https://github.com/kcrisman"
}
```

Attachment [int_without_var-final.patch](tarball://root/attachments/some-uuid/ticket2697/int_without_var-final.patch) by @kcrisman created at 2008-11-01 03:20:21

Based on 3.2.alpha0



---

archive/issue_events_006302.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-01T03:23:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "milestone": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6302"
}
```



---

archive/issue_comments_020057.json:
```json
{
    "body": "<a id='comment:6'></a>Hmm... now I get\n\n```\nsage: var('x,a,b')\n(x, a, b)\nsage: integral(x^2, a, b)\n------------------------------------------------------------\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/misc/functional.py\", line 418, in integral\n    return x.integral(*args, **kwds)\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2594, in integral\n    raise TypeError, 'only one endpoint given'\nTypeError: only one endpoint given\n```\n\nwhere I'd expect `(b^3 - a^3)/3`.",
    "created_at": "2008-11-01T03:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20057",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>Hmm... now I get

```
sage: var('x,a,b')
(x, a, b)
sage: integral(x^2, a, b)
------------------------------------------------------------
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/misc/functional.py", line 418, in integral
    return x.integral(*args, **kwds)
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2594, in integral
    raise TypeError, 'only one endpoint given'
TypeError: only one endpoint given
```

where I'd expect `(b^3 - a^3)/3`.



---

archive/issue_comments_020058.json:
```json
{
    "body": "<a id='comment:7'></a>Okay, fair enough.  My philosophy was to improve what was there - all the examples you gave were errors before, too - but I agree that having a very robust function is the best goal long term.  However, it may take a little longer to get there.  Thanks for the careful reading of the code to find these (so far) non-examples; if we can get all of them it will make integrate very intuitive indeed.",
    "created_at": "2008-11-04T02:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20058",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>Okay, fair enough.  My philosophy was to improve what was there - all the examples you gave were errors before, too - but I agree that having a very robust function is the best goal long term.  However, it may take a little longer to get there.  Thanks for the careful reading of the code to find these (so far) non-examples; if we can get all of them it will make integrate very intuitive indeed.



---

archive/issue_events_006303.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-04T02:43:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "milestone": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6303"
}
```



---

archive/issue_events_006304.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-04T02:43:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "milestone": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6304"
}
```



---

archive/issue_comments_020059.json:
```json
{
    "body": "<a id='comment:8'></a>I've attached a new patch that resolves this issue. It should be more robust, as it figures out to do first rather than catching errors.",
    "created_at": "2008-12-20T02:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20059",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>I've attached a new patch that resolves this issue. It should be more robust, as it figures out to do first rather than catching errors.



---

archive/issue_comments_020060.json:
```json
{
    "body": "<a id='comment:9'></a>Attachment [2697-integrate-without-var.patch](tarball://root/attachments/some-uuid/ticket2697/2697-integrate-without-var.patch) by @kcrisman created at 2008-12-21 21:58:44\n\nI don't have a chance to review this yet (tomorrow?) but at least want to point out that the other day I noticed that the functionality did also not work for CallableSymbolicExpression (e.g. lines 5779 or so the integral() method), which seems to have an even more primitive version of the same code.  E.g., to try the original example for this ticket:\n\n```\nsage: f(x)=x\nsage: f\nx |--> x\nsage: type(f)\n<class 'sage.calculus.calculus.CallableSymbolicExpression'>\nsage: integrate(f,-1,1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<snip>\nsage: f.integral(-1,1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<snip>\n```\nBut this does work, so I think one would really have to fix the CallableSymbolicVariable piece:\n\n```\nsage: f.integral(x,-1,1)\n0\nsage: integral(f,x,-1,1)\n0\n```\nThanks for working on this - I knew it would be impossible for me to get to it until after the semester, and that proved to be true.",
    "created_at": "2008-12-21T21:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20060",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>Attachment [2697-integrate-without-var.patch](tarball://root/attachments/some-uuid/ticket2697/2697-integrate-without-var.patch) by @kcrisman created at 2008-12-21 21:58:44

I don't have a chance to review this yet (tomorrow?) but at least want to point out that the other day I noticed that the functionality did also not work for CallableSymbolicExpression (e.g. lines 5779 or so the integral() method), which seems to have an even more primitive version of the same code.  E.g., to try the original example for this ticket:

```
sage: f(x)=x
sage: f
x |--> x
sage: type(f)
<class 'sage.calculus.calculus.CallableSymbolicExpression'>
sage: integrate(f,-1,1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<snip>
sage: f.integral(-1,1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<snip>
```
But this does work, so I think one would really have to fix the CallableSymbolicVariable piece:

```
sage: f.integral(x,-1,1)
0
sage: integral(f,x,-1,1)
0
```
Thanks for working on this - I knew it would be impossible for me to get to it until after the semester, and that proved to be true.



---

archive/issue_comments_020061.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks for starting to look at this. I think integrating symbolic equations should be a separate ticket.",
    "created_at": "2008-12-23T18:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20061",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>Thanks for starting to look at this. I think integrating symbolic equations should be a separate ticket.



---

archive/issue_comments_020062.json:
```json
{
    "body": "<a id='comment:11'></a>Okay, I like your patch.  I do think that there should be support for \n\n```\nsage: f(x)=x\nsage: integrate(f,-1,1)\n0\n```\nI wasn't suggesting integrating a symbolic equation, just that the same behavior results for \n\n```\nsage: integrate(f,-1,1)\n0\nsage: integrate(x,-1,1)\n0\n```\nbecause I don't think most newbie Sage users will get the difference between f(x)=x and f=x, for instance.\nAnyway, the latest patch applies the appropriate parts of your patch to CallableSymbolicExpression as well; there needs to be less checking because of the different return expected, e.g. indefinite integral is already handled by the previous code (still returning a CallableSymbolicExpression, though).\n\nUnfortunately, calculus.py always times out for me when I test it.  I tried to check that I did not change any existing behavior but hopefully you (or someone else) can check this.\n\nOtherwise positive review!",
    "created_at": "2008-12-27T04:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20062",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>Okay, I like your patch.  I do think that there should be support for 

```
sage: f(x)=x
sage: integrate(f,-1,1)
0
```
I wasn't suggesting integrating a symbolic equation, just that the same behavior results for 

```
sage: integrate(f,-1,1)
0
sage: integrate(x,-1,1)
0
```
because I don't think most newbie Sage users will get the difference between f(x)=x and f=x, for instance.
Anyway, the latest patch applies the appropriate parts of your patch to CallableSymbolicExpression as well; there needs to be less checking because of the different return expected, e.g. indefinite integral is already handled by the previous code (still returning a CallableSymbolicExpression, though).

Unfortunately, calculus.py always times out for me when I test it.  I tried to check that I did not change any existing behavior but hopefully you (or someone else) can check this.

Otherwise positive review!



---

archive/issue_comments_020063.json:
```json
{
    "body": "<a id='comment:12'></a>Changing summary - would be good to get this in before bitrot sets in, but wanted robertwb's final followup review on my last tiny change, or to reject that but to open a new ticket for the other thing.  Or whoever else is interested in this ticket could do that; since I made a change I don't feel comfortable doing the last positive review.",
    "created_at": "2009-01-15T02:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20063",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>Changing summary - would be good to get this in before bitrot sets in, but wanted robertwb's final followup review on my last tiny change, or to reject that but to open a new ticket for the other thing.  Or whoever else is interested in this ticket could do that; since I made a change I don't feel comfortable doing the last positive review.



---

archive/issue_events_006305.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-15T02:25:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "milestone": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6305"
}
```



---

archive/issue_events_006306.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-15T02:25:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6306"
}
```



---

archive/issue_comments_020064.json:
```json
{
    "body": "<a id='comment:13'></a>Yes, this would be very nice to get into 3.3, so Robert if you can spare the time please deal with this.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-15T02:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20064",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>Yes, this would be very nice to get into 3.3, so Robert if you can spare the time please deal with this.

Cheers,

Michael



---

archive/issue_comments_020065.json:
```json
{
    "body": "<a id='comment:14'></a>Sorry this got lost in the shuffle--yes, I approve of this patch.",
    "created_at": "2009-01-15T03:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20065",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:14'></a>Sorry this got lost in the shuffle--yes, I approve of this patch.



---

archive/issue_comments_020066.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 robertwb]:\n> Sorry this got lost in the shuffle--yes, I approve of this patch. \n\n\nAnd I approve of your approval and change this formally to a positive review :)\n\nI assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?\n\nCheers,\n\nMichael",
    "created_at": "2009-01-15T12:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20066",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:15'></a>Replying to [comment:14 robertwb]:
> Sorry this got lost in the shuffle--yes, I approve of this patch. 


And I approve of your approval and change this formally to a positive review :)

I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?

Cheers,

Michael



---

archive/issue_comments_020067.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 mabshoff]:\n> And I approve of your approval and change this formally to a positive review :)\n> \n> I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?\n\n\nI think that's right.  It will be good to have this available.",
    "created_at": "2009-01-15T15:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20067",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>Replying to [comment:15 mabshoff]:
> And I approve of your approval and change this formally to a positive review :)
> 
> I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?


I think that's right.  It will be good to have this available.



---

archive/issue_comments_020068.json:
```json
{
    "body": "<a id='comment:17'></a>Re authorship, yep, that's right.",
    "created_at": "2009-01-15T19:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20068",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:17'></a>Re authorship, yep, that's right.



---

archive/issue_comments_020069.json:
```json
{
    "body": "<a id='comment:18'></a>trac_2697.patch causes a doctest failure:\n\n```\nsage -t -long devel/sage/sage/functions/piecewise.py\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha0/devel/sage-main/sage/functions/piecewise.py\", line 600:\n    sage: f.integral()\nExpected:\n    1/2\nGot:\n    2 - x\n**********************************************************************\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-01-18T17:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20069",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:18'></a>trac_2697.patch causes a doctest failure:

```
sage -t -long devel/sage/sage/functions/piecewise.py
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha0/devel/sage-main/sage/functions/piecewise.py", line 600:
    sage: f.integral()
Expected:
    1/2
Got:
    2 - x
**********************************************************************
```

Cheers,

Michael



---

archive/issue_comments_020070.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 mabshoff]:\n> trac_2697.patch causes a doctest failure:\n\n\nOk, this is on the CallableSymbolicExpression side so it's my fault; looks like it is adding 1+(1-x) for some reason, which I think I should be able to track down.  I am downloading 3.3.alpha0 currently, it should build overnight, and then hopefully sometime tomorrow I can fix this.",
    "created_at": "2009-01-20T02:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20070",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>Replying to [comment:18 mabshoff]:
> trac_2697.patch causes a doctest failure:


Ok, this is on the CallableSymbolicExpression side so it's my fault; looks like it is adding 1+(1-x) for some reason, which I think I should be able to track down.  I am downloading 3.3.alpha0 currently, it should build overnight, and then hopefully sometime tomorrow I can fix this.



---

archive/issue_comments_020071.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 kcrisman]:\n> Replying to [comment:18 mabshoff]:\n> > trac_2697.patch causes a doctest failure:\n\n> \n\nFor reference (mainly to myself not to forget in morning) - fix is to replace lines 5806 to 5812\n\n```\n\t        elif b is None and a is not None: \n\t            # two arguments, must be endpoints \n\t            a, b = x, a \n\t            x = self.default_variable() \n\t \n\t        if not isinstance(x, SymbolicVariable): \n\t            x = var(repr(x)) \n```\nwith\n\n```\n\t        elif b is None and a is not None: \n\t            # two arguments, must be endpoints \n\t            a, b = x, a \n\t            x = None\n\n                if x is None:\n                    x = self.default_variable()\n\n\t        elif not isinstance(x, SymbolicVariable): \n\t            x = var(repr(x)) \n```\nas robertwb did in the first part of this. Never occurred to me someone might actually *intentionally* pass None for the variable...\n\nAlso need to add a doctest, and perhaps a comment that Maxima interprets variable=None as intending for integration to be \"d1\" or something like that, while Sage usually looks for whatever variable makes sense. E.g. the surprising last line below:\n\n```\nsage: j(x)=x^2\nsage: integral(j,None,0,1)\n1/3\nsage: j._maxima_().integrate(None,0,1)\nx^2\nsage: j._maxima_().integrate(None,0,2)\n2*x^2\n```\nDoes anyone know if that is a feature or a bug in Maxima?  Either seems plausible, though I would think maybe feature.",
    "created_at": "2009-01-20T02:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20071",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>Replying to [comment:19 kcrisman]:
> Replying to [comment:18 mabshoff]:
> > trac_2697.patch causes a doctest failure:

> 

For reference (mainly to myself not to forget in morning) - fix is to replace lines 5806 to 5812

```
	        elif b is None and a is not None: 
	            # two arguments, must be endpoints 
	            a, b = x, a 
	            x = self.default_variable() 
	 
	        if not isinstance(x, SymbolicVariable): 
	            x = var(repr(x)) 
```
with

```
	        elif b is None and a is not None: 
	            # two arguments, must be endpoints 
	            a, b = x, a 
	            x = None

                if x is None:
                    x = self.default_variable()

	        elif not isinstance(x, SymbolicVariable): 
	            x = var(repr(x)) 
```
as robertwb did in the first part of this. Never occurred to me someone might actually *intentionally* pass None for the variable...

Also need to add a doctest, and perhaps a comment that Maxima interprets variable=None as intending for integration to be "d1" or something like that, while Sage usually looks for whatever variable makes sense. E.g. the surprising last line below:

```
sage: j(x)=x^2
sage: integral(j,None,0,1)
1/3
sage: j._maxima_().integrate(None,0,1)
x^2
sage: j._maxima_().integrate(None,0,2)
2*x^2
```
Does anyone know if that is a feature or a bug in Maxima?  Either seems plausible, though I would think maybe feature.



---

archive/issue_comments_020072.json:
```json
{
    "body": "Based on 3.3.alpha0",
    "created_at": "2009-01-21T03:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20072",
    "user": "https://github.com/kcrisman"
}
```

Based on 3.3.alpha0



---

archive/issue_comments_020073.json:
```json
{
    "body": "<a id='comment:21'></a>Attachment [trac_2697.patch](tarball://root/attachments/some-uuid/ticket2697/trac_2697.patch) by @kcrisman created at 2009-01-21 03:55:04\n\nThis patch (trac_2697.patch) should take care of the piecewise error and still do the new things, plus adds a little documentation for things like f(x)=x^2.  My calculus.py always times out in testing, but hopefully running that test and the piecewise.py test should lead to a final positive review.",
    "created_at": "2009-01-21T03:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20073",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>Attachment [trac_2697.patch](tarball://root/attachments/some-uuid/ticket2697/trac_2697.patch) by @kcrisman created at 2009-01-21 03:55:04

This patch (trac_2697.patch) should take care of the piecewise error and still do the new things, plus adds a little documentation for things like f(x)=x^2.  My calculus.py always times out in testing, but hopefully running that test and the piecewise.py test should lead to a final positive review.



---

archive/issue_comments_020074.json:
```json
{
    "body": "<a id='comment:22'></a>I'm going to go ahead and give this a positive review. I applied the patch, everything passes doctests, and the code looks reasonable. Robert and Karl should still get review credit, though, since they did much more work than me.",
    "created_at": "2009-01-24T15:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20074",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:22'></a>I'm going to go ahead and give this a positive review. I applied the patch, everything passes doctests, and the code looks reasonable. Robert and Karl should still get review credit, though, since they did much more work than me.



---

archive/issue_comments_020075.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-01-24T18:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20075",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_020076.json:
```json
{
    "body": "<a id='comment:23'></a>Merged trac_2697.patch in Sage 3.3.alpha2",
    "created_at": "2009-01-24T18:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2697#issuecomment-20076",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:23'></a>Merged trac_2697.patch in Sage 3.3.alpha2



---

archive/issue_events_006307.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-24T18:41:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2697",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2697#event-6307"
}
```
