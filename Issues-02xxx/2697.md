# Issue 2697: allow integration without explicit variable declaration

archive/issues_002697.json:
```json
{
    "assignees": [
        "https://github.com/kcrisman"
    ],
    "body": "This is right:\n\n```\nsage: integrate(x, x,-1,1)\n0\n```\n\nThis error message (which is because I forgot to give the variable of integration) is\ncompletely broken. The \"raise err\" line in the source code should be just \"raise\", i.e., delete err, which makes no sense. Or?  Anyway, this is just wrong as is.\n\n```\nsage: integrate(x, -1,1)\n---------------------------------------------------------------------------\n<type 'exceptions.ValueError'>            Traceback (most recent call last)\n\n/Users/was/<ipython console> in <module>()\n\n/Users/was/build/sage-2.10.4/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)\n    255         return f.integral(*args, **kwds)\n    256     except ValueError, err:\n--> 257         raise err\n    258     except AttributeError:\n    259         pass\n\n<type 'exceptions.ValueError'>: variable name is not a valid Python identifier\n\n```\n\nCC:  @robertwb\n\nComponent: **calculus**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/2697_\n\n",
    "closed_at": "2009-01-24T18:41:51Z",
    "created_at": "2008-03-28T07:39:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "allow integration without explicit variable declaration",
    "type": "issue",
    "updated_at": "2009-01-24T18:41:51Z",
    "url": "https://github.com/sagemath/sage/issues/2697",
    "user": "https://github.com/williamstein"
}
```
This is right:

```
sage: integrate(x, x,-1,1)
0
```

This error message (which is because I forgot to give the variable of integration) is
completely broken. The "raise err" line in the source code should be just "raise", i.e., delete err, which makes no sense. Or?  Anyway, this is just wrong as is.

```
sage: integrate(x, -1,1)
---------------------------------------------------------------------------
<type 'exceptions.ValueError'>            Traceback (most recent call last)

/Users/was/<ipython console> in <module>()

/Users/was/build/sage-2.10.4/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)
    255         return f.integral(*args, **kwds)
    256     except ValueError, err:
--> 257         raise err
    258     except AttributeError:
    259         pass

<type 'exceptions.ValueError'>: variable name is not a valid Python identifier

```

CC:  @robertwb

Component: **calculus**

_Issue created by migration from https://trac.sagemath.org/ticket/2697_





---

archive/issue_events_028536.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-28T07:39:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28536"
}
```



---

archive/issue_events_028537.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-28T07:39:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28537"
}
```



---

archive/issue_events_028538.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-28T07:39:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28538"
}
```



---

archive/issue_events_028539.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-28T07:39:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28539"
}
```



---

archive/issue_events_028540.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-28T07:39:54Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28540"
}
```



---

archive/issue_comments_014061.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI am not sure that the suggested fix does solve the problem:\n\n```\nsage: integrate(x, -1,1)\n---------------------------------------------------------------------------\n<type 'exceptions.ValueError'>            Traceback (most recent call last)\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/<ipython console> in <module>()\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)\n    253     \"\"\"\n    254     try:\n--> 255         return f.integral(*args, **kwds)\n    256     except ValueError, err:\n    257         raise\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in integral(self, v, a, b)\n   2475\n   2476         if not isinstance(v, SymbolicVariable):\n-> 2477             v = var(repr(v))\n   2478             #raise TypeError, 'must integrate with respect to a variable'\n   2479         if (a is None and (not b is None)) or (b is None and (not a is None)):\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in var(s, create)\n   5238             raise ValueError, \"the variable '%s' has not been defined\"%var\n   5239         pass\n-> 5240     v = SymbolicVariable(s)\n   5241     _vars[s] = v\n   5242     _syms[s] = v\n\n/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in __init__(self, name)\n   5072             raise ValueError, \"variable name must be nonempty\"\n   5073         elif not is_python_identifier.match(name):\n-> 5074             raise ValueError, \"variable name is not a valid Python identifier\"\n   5075\n   5076     def __hash__(self):\n\n<type 'exceptions.ValueError'>: variable name is not a valid Python identifier\nsage:\n```\n\nThoughts?\n\nCheers,\n\nMichael",
    "created_at": "2008-04-09T02:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14061",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:1" align="right">comment:1</div>

I am not sure that the suggested fix does solve the problem:

```
sage: integrate(x, -1,1)
---------------------------------------------------------------------------
<type 'exceptions.ValueError'>            Traceback (most recent call last)

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/<ipython console> in <module>()

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/functional.py in integral(f, *args, **kwds)
    253     """
    254     try:
--> 255         return f.integral(*args, **kwds)
    256     except ValueError, err:
    257         raise

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in integral(self, v, a, b)
   2475
   2476         if not isinstance(v, SymbolicVariable):
-> 2477             v = var(repr(v))
   2478             #raise TypeError, 'must integrate with respect to a variable'
   2479         if (a is None and (not b is None)) or (b is None and (not a is None)):

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in var(s, create)
   5238             raise ValueError, "the variable '%s' has not been defined"%var
   5239         pass
-> 5240     v = SymbolicVariable(s)
   5241     _vars[s] = v
   5242     _syms[s] = v

/scratch/mabshoff/release-cycle/sage-3.0.alpha3/local/lib/python2.5/site-packages/sage/calculus/calculus.py in __init__(self, name)
   5072             raise ValueError, "variable name must be nonempty"
   5073         elif not is_python_identifier.match(name):
-> 5074             raise ValueError, "variable name is not a valid Python identifier"
   5075
   5076     def __hash__(self):

<type 'exceptions.ValueError'>: variable name is not a valid Python identifier
sage:
```

Thoughts?

Cheers,

Michael



---

archive/issue_comments_014062.json:
```json
{
    "body": "Apply this patch to 3.1.4 to integrate without variables (sometimes)",
    "created_at": "2008-10-17T02:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14062",
    "user": "https://github.com/kcrisman"
}
```

Apply this patch to 3.1.4 to integrate without variables (sometimes)



---

archive/issue_events_028541.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-10-17T03:02:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "allow integration without explicit variable declaration",
    "title_was": "stupid bug in integrate (easy to fix)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28541"
}
```



---

archive/issue_events_028542.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-10-17T03:02:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28542"
}
```



---

archive/issue_events_028543.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-10-17T03:02:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28543"
}
```



---

archive/issue_events_028544.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-10-17T03:02:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28544"
}
```



---

archive/issue_comments_014063.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[int_without_var.patch.gz](https://github.com/sagemath/sage/files/ticket2697/int_without_var.patch.gz)**\n\nThese should now work:\n\n```\nsage: integrate(x, -1,1)\n0\nsage: integrate(sin(x),0,pi)\n2\n```\n\nSadly, because I don't know enough about Maxima to get it to accept the default variable, we still get this joke one might make in freshman calculus:\n\n```\nsage: integrate(sin,0,pi) \npi*sin \n```",
    "created_at": "2008-10-17T03:02:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14063",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[int_without_var.patch.gz](https://github.com/sagemath/sage/files/ticket2697/int_without_var.patch.gz)**

These should now work:

```
sage: integrate(x, -1,1)
0
sage: integrate(sin(x),0,pi)
2
```

Sadly, because I don't know enough about Maxima to get it to accept the default variable, we still get this joke one might make in freshman calculus:

```
sage: integrate(sin,0,pi) 
pi*sin 
```



---

archive/issue_comments_014064.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm getting\n\n```\nsage: integrate(sin(x), pi, 2*pi)\n------------------------------------------------------------\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py\", line 254, in integral\n    return f.integral(*args, **kwds)\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2586, in integral\n    raise TypeError, 'only one endpoint given'\nTypeError: only one endpoint given\n```\n\nRather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. \n\n```\nsage: integrate(sin(x))               # 0 args, implicit indefinite\ncos(x)\nsage: integrate(sin(x), y)            # 1 arg, explicit indefinite\nsin(x)*y\nsage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite\n-2\nsage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite\npi*sin(x)\n```",
    "created_at": "2008-10-30T21:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14064",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm getting

```
sage: integrate(sin(x), pi, 2*pi)
------------------------------------------------------------
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py", line 254, in integral
    return f.integral(*args, **kwds)
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2586, in integral
    raise TypeError, 'only one endpoint given'
TypeError: only one endpoint given
```

Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. 

```
sage: integrate(sin(x))               # 0 args, implicit indefinite
cos(x)
sage: integrate(sin(x), y)            # 1 arg, explicit indefinite
sin(x)*y
sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite
-2
sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite
pi*sin(x)
```



---

archive/issue_events_028545.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-10-30T21:31:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "[negative review] allow integration without explicit variable declaration",
    "title_was": "allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28545"
}
```



---

archive/issue_events_028546.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-11-01T03:19:53Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "subject": "https://github.com/kcrisman",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28546"
}
```



---

archive/issue_events_028547.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-01T03:19:53Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "subject": "https://github.com/kcrisman",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28547"
}
```



---

archive/issue_comments_014065.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@robertwb](#comment:3):\n\nPosting (final? I hope) version of patch, based on 3.2.alpha0.  Passed doctests for calculus.py once, all other times it timed out for me, but I do not believe it changes pre-existing correct behavior.\n\n> I'm getting\n> \n> ```\n> sage: integrate(sin(x), pi, 2*pi)\n> ------------------------------------------------------------\n> Traceback (most recent call last):\n>   File \"<ipython console>\", line 1, in <module>\n>   File \"/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py\", line 254, in integral\n>     return f.integral(*args, **kwds)\n>   File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2586, in integral\n>     raise TypeError, 'only one endpoint given'\n> TypeError: only one endpoint given\n> ```\n> \n\nTurns out that this actually comes from the original code, where the second item was turned into a variable in case someone used some already-in-use identifier for the variable; the problem was that it turned things like e and pi into variables.  \n\n> Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. \n> \n> ```\n> sage: integrate(sin(x))               # 0 args, implicit indefinite\n> cos(x)\n> sage: integrate(sin(x), y)            # 1 arg, explicit indefinite\n> sin(x)*y\n> sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite\n> -2\n> sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite\n> pi*sin(x)\n> ```\n\nGood idea!  In the end, though, it was easier for me to just jury-rig the code as is.  When I make my own functions I try to do that sort of planning, but I don't feel confident enough (or have enough time) to completely change the way this type of code works.  Hopefully my final solution is still pretty good, though; it does all of the above, except you will have to declare y beforehand (I couldn't find a way around that), and the first integral is -cos(x) :)\n\nAs a bonus, I was finally able to figure out how to do this, which now works:\n\n```\nsage: integrate(sin,0,pi)\n2\n```\nThat alone is worth it for me.",
    "created_at": "2008-11-01T03:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14065",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@robertwb](#comment:3):

Posting (final? I hope) version of patch, based on 3.2.alpha0.  Passed doctests for calculus.py once, all other times it timed out for me, but I do not believe it changes pre-existing correct behavior.

> I'm getting
> 
> ```
> sage: integrate(sin(x), pi, 2*pi)
> ------------------------------------------------------------
> Traceback (most recent call last):
>   File "<ipython console>", line 1, in <module>
>   File "/Users/robert/sage/sage-3.1.3/local/lib/python2.5/site-packages/sage/calculus/functional.py", line 254, in integral
>     return f.integral(*args, **kwds)
>   File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2586, in integral
>     raise TypeError, 'only one endpoint given'
> TypeError: only one endpoint given
> ```
> 

Turns out that this actually comes from the original code, where the second item was turned into a variable in case someone used some already-in-use identifier for the variable; the problem was that it turned things like e and pi into variables.  

> Rather than catching the error that, say, 0 is not a valid variable name, perhaps one should look at the number of variables passed to determine how to integrate. E.g. 
> 
> ```
> sage: integrate(sin(x))               # 0 args, implicit indefinite
> cos(x)
> sage: integrate(sin(x), y)            # 1 arg, explicit indefinite
> sin(x)*y
> sage: integrate(sin(x), pi, 2*pi)     # 2 args, implicit definite
> -2
> sage: integrate(sin(x), y, pi, 2*pi)  # 3 args, explicit definite
> pi*sin(x)
> ```

Good idea!  In the end, though, it was easier for me to just jury-rig the code as is.  When I make my own functions I try to do that sort of planning, but I don't feel confident enough (or have enough time) to completely change the way this type of code works.  Hopefully my final solution is still pretty good, though; it does all of the above, except you will have to declare y beforehand (I couldn't find a way around that), and the first integral is -cos(x) :)

As a bonus, I was finally able to figure out how to do this, which now works:

```
sage: integrate(sin,0,pi)
2
```
That alone is worth it for me.



---

archive/issue_events_028548.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-01T03:19:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "allow integration without explicit variable declaration",
    "title_was": "[negative review] allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28548"
}
```



---

archive/issue_comments_014066.json:
```json
{
    "body": "Attachment: **[int_without_var-final.patch.gz](https://github.com/sagemath/sage/files/ticket2697/int_without_var-final.patch.gz)**\n\nBased on 3.2.alpha0",
    "created_at": "2008-11-01T03:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14066",
    "user": "https://github.com/kcrisman"
}
```

Attachment: **[int_without_var-final.patch.gz](https://github.com/sagemath/sage/files/ticket2697/int_without_var-final.patch.gz)**

Based on 3.2.alpha0



---

archive/issue_events_028549.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-01T03:23:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28549"
}
```



---

archive/issue_events_028550.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-01T03:23:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28550"
}
```



---

archive/issue_comments_014067.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHmm... now I get\n\n```\nsage: var('x,a,b')\n(x, a, b)\nsage: integral(x^2, a, b)\n------------------------------------------------------------\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/misc/functional.py\", line 418, in integral\n    return x.integral(*args, **kwds)\n  File \"/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py\", line 2594, in integral\n    raise TypeError, 'only one endpoint given'\nTypeError: only one endpoint given\n```\n\nwhere I'd expect `(b^3 - a^3)/3`.",
    "created_at": "2008-11-01T03:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14067",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:6" align="right">comment:6</div>

Hmm... now I get

```
sage: var('x,a,b')
(x, a, b)
sage: integral(x^2, a, b)
------------------------------------------------------------
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/misc/functional.py", line 418, in integral
    return x.integral(*args, **kwds)
  File "/Users/robert/sage/current/local/lib/python2.5/site-packages/sage/calculus/calculus.py", line 2594, in integral
    raise TypeError, 'only one endpoint given'
TypeError: only one endpoint given
```

where I'd expect `(b^3 - a^3)/3`.



---

archive/issue_comments_014068.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOkay, fair enough.  My philosophy was to improve what was there - all the examples you gave were errors before, too - but I agree that having a very robust function is the best goal long term.  However, it may take a little longer to get there.  Thanks for the careful reading of the code to find these (so far) non-examples; if we can get all of them it will make integrate very intuitive indeed.",
    "created_at": "2008-11-04T02:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14068",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Okay, fair enough.  My philosophy was to improve what was there - all the examples you gave were errors before, too - but I agree that having a very robust function is the best goal long term.  However, it may take a little longer to get there.  Thanks for the careful reading of the code to find these (so far) non-examples; if we can get all of them it will make integrate very intuitive indeed.



---

archive/issue_events_028551.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-04T02:43:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28551"
}
```



---

archive/issue_events_028552.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-04T02:43:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28552"
}
```



---

archive/issue_events_028553.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2008-11-04T02:43:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "[do not review] allow integration without explicit variable declaration",
    "title_was": "allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28553"
}
```



---

archive/issue_comments_014069.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI've attached a new patch that resolves this issue. It should be more robust, as it figures out to do first rather than catching errors.",
    "created_at": "2008-12-20T02:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14069",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:8" align="right">comment:8</div>

I've attached a new patch that resolves this issue. It should be more robust, as it figures out to do first rather than catching errors.



---

archive/issue_events_028554.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-12-20T02:52:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "allow integration without explicit variable declaration",
    "title_was": "[do not review] allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28554"
}
```



---

archive/issue_comments_014070.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[2697-integrate-without-var.patch.gz](https://github.com/sagemath/sage/files/ticket2697/2697-integrate-without-var.patch.gz)**\n\nI don't have a chance to review this yet (tomorrow?) but at least want to point out that the other day I noticed that the functionality did also not work for CallableSymbolicExpression (e.g. lines 5779 or so the integral() method), which seems to have an even more primitive version of the same code.  E.g., to try the original example for this ticket:\n\n```\nsage: f(x)=x\nsage: f\nx |--> x\nsage: type(f)\n<class 'sage.calculus.calculus.CallableSymbolicExpression'>\nsage: integrate(f,-1,1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<snip>\nsage: f.integral(-1,1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<snip>\n```\nBut this does work, so I think one would really have to fix the CallableSymbolicVariable piece:\n\n```\nsage: f.integral(x,-1,1)\n0\nsage: integral(f,x,-1,1)\n0\n```\nThanks for working on this - I knew it would be impossible for me to get to it until after the semester, and that proved to be true.",
    "created_at": "2008-12-21T21:58:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14070",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[2697-integrate-without-var.patch.gz](https://github.com/sagemath/sage/files/ticket2697/2697-integrate-without-var.patch.gz)**

I don't have a chance to review this yet (tomorrow?) but at least want to point out that the other day I noticed that the functionality did also not work for CallableSymbolicExpression (e.g. lines 5779 or so the integral() method), which seems to have an even more primitive version of the same code.  E.g., to try the original example for this ticket:

```
sage: f(x)=x
sage: f
x |--> x
sage: type(f)
<class 'sage.calculus.calculus.CallableSymbolicExpression'>
sage: integrate(f,-1,1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<snip>
sage: f.integral(-1,1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<snip>
```
But this does work, so I think one would really have to fix the CallableSymbolicVariable piece:

```
sage: f.integral(x,-1,1)
0
sage: integral(f,x,-1,1)
0
```
Thanks for working on this - I knew it would be impossible for me to get to it until after the semester, and that proved to be true.



---

archive/issue_comments_014071.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThanks for starting to look at this. I think integrating symbolic equations should be a separate ticket.",
    "created_at": "2008-12-23T18:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14071",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:10" align="right">comment:10</div>

Thanks for starting to look at this. I think integrating symbolic equations should be a separate ticket.



---

archive/issue_comments_014072.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOkay, I like your patch.  I do think that there should be support for \n\n```\nsage: f(x)=x\nsage: integrate(f,-1,1)\n0\n```\nI wasn't suggesting integrating a symbolic equation, just that the same behavior results for \n\n```\nsage: integrate(f,-1,1)\n0\nsage: integrate(x,-1,1)\n0\n```\nbecause I don't think most newbie Sage users will get the difference between f(x)=x and f=x, for instance.\nAnyway, the latest patch applies the appropriate parts of your patch to CallableSymbolicExpression as well; there needs to be less checking because of the different return expected, e.g. indefinite integral is already handled by the previous code (still returning a CallableSymbolicExpression, though).\n\nUnfortunately, calculus.py always times out for me when I test it.  I tried to check that I did not change any existing behavior but hopefully you (or someone else) can check this.\n\nOtherwise positive review!",
    "created_at": "2008-12-27T04:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14072",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:11" align="right">comment:11</div>

Okay, I like your patch.  I do think that there should be support for 

```
sage: f(x)=x
sage: integrate(f,-1,1)
0
```
I wasn't suggesting integrating a symbolic equation, just that the same behavior results for 

```
sage: integrate(f,-1,1)
0
sage: integrate(x,-1,1)
0
```
because I don't think most newbie Sage users will get the difference between f(x)=x and f=x, for instance.
Anyway, the latest patch applies the appropriate parts of your patch to CallableSymbolicExpression as well; there needs to be less checking because of the different return expected, e.g. indefinite integral is already handled by the previous code (still returning a CallableSymbolicExpression, though).

Unfortunately, calculus.py always times out for me when I test it.  I tried to check that I did not change any existing behavior but hopefully you (or someone else) can check this.

Otherwise positive review!



---

archive/issue_comments_014073.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nChanging summary - would be good to get this in before bitrot sets in, but wanted robertwb's final followup review on my last tiny change, or to reject that but to open a new ticket for the other thing.  Or whoever else is interested in this ticket could do that; since I made a change I don't feel comfortable doing the last positive review.",
    "created_at": "2009-01-15T02:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14073",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">comment:12</div>

Changing summary - would be good to get this in before bitrot sets in, but wanted robertwb's final followup review on my last tiny change, or to reject that but to open a new ticket for the other thing.  Or whoever else is interested in this ticket could do that; since I made a change I don't feel comfortable doing the last positive review.



---

archive/issue_events_028555.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-15T02:25:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "[nearly positive review] allow integration without explicit variable declaration",
    "title_was": "allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28555"
}
```



---

archive/issue_events_028556.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-15T02:25:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28556"
}
```



---

archive/issue_events_028557.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-15T02:25:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28557"
}
```



---

archive/issue_comments_014074.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nYes, this would be very nice to get into 3.3, so Robert if you can spare the time please deal with this.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-15T02:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14074",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">comment:13</div>

Yes, this would be very nice to get into 3.3, so Robert if you can spare the time please deal with this.

Cheers,

Michael



---

archive/issue_comments_014075.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nSorry this got lost in the shuffle--yes, I approve of this patch.",
    "created_at": "2009-01-15T03:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14075",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:14" align="right">comment:14</div>

Sorry this got lost in the shuffle--yes, I approve of this patch.



---

archive/issue_comments_014076.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@robertwb](#comment:14):\n> Sorry this got lost in the shuffle--yes, I approve of this patch. \n\nAnd I approve of your approval and change this formally to a positive review :)\n\nI assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?\n\nCheers,\n\nMichael",
    "created_at": "2009-01-15T12:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14076",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@robertwb](#comment:14):
> Sorry this got lost in the shuffle--yes, I approve of this patch. 

And I approve of your approval and change this formally to a positive review :)

I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?

Cheers,

Michael



---

archive/issue_events_028558.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-15T12:11:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "title_is": "allow integration without explicit variable declaration",
    "title_was": "[nearly positive review] allow integration without explicit variable declaration",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28558"
}
```



---

archive/issue_events_028559.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-15T12:11:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28559"
}
```



---

archive/issue_events_028560.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-15T12:11:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28560"
}
```



---

archive/issue_comments_014077.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-mabshoff](#comment:15):\n> And I approve of your approval and change this formally to a positive review :)\n> \n> I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?\n\nI think that's right.  It will be good to have this available.",
    "created_at": "2009-01-15T15:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14077",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-mabshoff](#comment:15):
> And I approve of your approval and change this formally to a positive review :)
> 
> I assume I should only apply trac_2697.patch and authorship as well as review credit is shared between Robert and Karl-Dieter?

I think that's right.  It will be good to have this available.



---

archive/issue_comments_014078.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRe authorship, yep, that's right.",
    "created_at": "2009-01-15T19:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14078",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:17" align="right">comment:17</div>

Re authorship, yep, that's right.



---

archive/issue_events_028561.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-18T17:52:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28561"
}
```



---

archive/issue_events_028562.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-18T17:52:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28562"
}
```



---

archive/issue_comments_014079.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\ntrac_2697.patch causes a doctest failure:\n\n```\nsage -t -long devel/sage/sage/functions/piecewise.py\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha0/devel/sage-main/sage/functions/piecewise.py\", line 600:\n    sage: f.integral()\nExpected:\n    1/2\nGot:\n    2 - x\n**********************************************************************\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-01-18T17:52:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14079",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:18" align="right">comment:18</div>

trac_2697.patch causes a doctest failure:

```
sage -t -long devel/sage/sage/functions/piecewise.py
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha0/devel/sage-main/sage/functions/piecewise.py", line 600:
    sage: f.integral()
Expected:
    1/2
Got:
    2 - x
**********************************************************************
```

Cheers,

Michael



---

archive/issue_comments_014080.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@sagetrac-mabshoff](#comment:18):\n> trac_2697.patch causes a doctest failure:\n\nOk, this is on the CallableSymbolicExpression side so it's my fault; looks like it is adding 1+(1-x) for some reason, which I think I should be able to track down.  I am downloading 3.3.alpha0 currently, it should build overnight, and then hopefully sometime tomorrow I can fix this.",
    "created_at": "2009-01-20T02:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14080",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@sagetrac-mabshoff](#comment:18):
> trac_2697.patch causes a doctest failure:

Ok, this is on the CallableSymbolicExpression side so it's my fault; looks like it is adding 1+(1-x) for some reason, which I think I should be able to track down.  I am downloading 3.3.alpha0 currently, it should build overnight, and then hopefully sometime tomorrow I can fix this.



---

archive/issue_comments_014081.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@kcrisman](#comment:19):\n> Replying to [@sagetrac-mabshoff](#comment:18):\n> > trac_2697.patch causes a doctest failure:\n\n> \n\nFor reference (mainly to myself not to forget in morning) - fix is to replace lines 5806 to 5812\n\n```\n\t        elif b is None and a is not None: \n\t            # two arguments, must be endpoints \n\t            a, b = x, a \n\t            x = self.default_variable() \n\t \n\t        if not isinstance(x, SymbolicVariable): \n\t            x = var(repr(x)) \n```\nwith\n\n```\n\t        elif b is None and a is not None: \n\t            # two arguments, must be endpoints \n\t            a, b = x, a \n\t            x = None\n\n                if x is None:\n                    x = self.default_variable()\n\n\t        elif not isinstance(x, SymbolicVariable): \n\t            x = var(repr(x)) \n```\nas robertwb did in the first part of this. Never occurred to me someone might actually *intentionally* pass None for the variable...\n\nAlso need to add a doctest, and perhaps a comment that Maxima interprets variable=None as intending for integration to be \"d1\" or something like that, while Sage usually looks for whatever variable makes sense. E.g. the surprising last line below:\n\n```\nsage: j(x)=x^2\nsage: integral(j,None,0,1)\n1/3\nsage: j._maxima_().integrate(None,0,1)\nx^2\nsage: j._maxima_().integrate(None,0,2)\n2*x^2\n```\nDoes anyone know if that is a feature or a bug in Maxima?  Either seems plausible, though I would think maybe feature.",
    "created_at": "2009-01-20T02:33:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14081",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@kcrisman](#comment:19):
> Replying to [@sagetrac-mabshoff](#comment:18):
> > trac_2697.patch causes a doctest failure:

> 

For reference (mainly to myself not to forget in morning) - fix is to replace lines 5806 to 5812

```
	        elif b is None and a is not None: 
	            # two arguments, must be endpoints 
	            a, b = x, a 
	            x = self.default_variable() 
	 
	        if not isinstance(x, SymbolicVariable): 
	            x = var(repr(x)) 
```
with

```
	        elif b is None and a is not None: 
	            # two arguments, must be endpoints 
	            a, b = x, a 
	            x = None

                if x is None:
                    x = self.default_variable()

	        elif not isinstance(x, SymbolicVariable): 
	            x = var(repr(x)) 
```
as robertwb did in the first part of this. Never occurred to me someone might actually *intentionally* pass None for the variable...

Also need to add a doctest, and perhaps a comment that Maxima interprets variable=None as intending for integration to be "d1" or something like that, while Sage usually looks for whatever variable makes sense. E.g. the surprising last line below:

```
sage: j(x)=x^2
sage: integral(j,None,0,1)
1/3
sage: j._maxima_().integrate(None,0,1)
x^2
sage: j._maxima_().integrate(None,0,2)
2*x^2
```
Does anyone know if that is a feature or a bug in Maxima?  Either seems plausible, though I would think maybe feature.



---

archive/issue_comments_014082.json:
```json
{
    "body": "Based on 3.3.alpha0",
    "created_at": "2009-01-21T03:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14082",
    "user": "https://github.com/kcrisman"
}
```

Based on 3.3.alpha0



---

archive/issue_events_028563.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-21T03:55:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28563"
}
```



---

archive/issue_events_028564.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-21T03:55:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28564"
}
```



---

archive/issue_comments_014083.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[trac_2697.patch.gz](https://github.com/sagemath/sage/files/ticket2697/trac_2697.patch.gz)**\n\nThis patch (trac_2697.patch) should take care of the piecewise error and still do the new things, plus adds a little documentation for things like f(x)=x^2.  My calculus.py always times out in testing, but hopefully running that test and the piecewise.py test should lead to a final positive review.",
    "created_at": "2009-01-21T03:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14083",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[trac_2697.patch.gz](https://github.com/sagemath/sage/files/ticket2697/trac_2697.patch.gz)**

This patch (trac_2697.patch) should take care of the piecewise error and still do the new things, plus adds a little documentation for things like f(x)=x^2.  My calculus.py always times out in testing, but hopefully running that test and the piecewise.py test should lead to a final positive review.



---

archive/issue_comments_014084.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm going to go ahead and give this a positive review. I applied the patch, everything passes doctests, and the code looks reasonable. Robert and Karl should still get review credit, though, since they did much more work than me.",
    "created_at": "2009-01-24T15:20:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14084",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm going to go ahead and give this a positive review. I applied the patch, everything passes doctests, and the code looks reasonable. Robert and Karl should still get review credit, though, since they did much more work than me.



---

archive/issue_events_028565.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-01-24T15:20:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28565"
}
```



---

archive/issue_events_028566.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-01-24T15:20:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28566"
}
```



---

archive/issue_comments_014085.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMerged trac_2697.patch in Sage 3.3.alpha2",
    "created_at": "2009-01-24T18:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2697#issuecomment-14085",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:23" align="right">comment:23</div>

Merged trac_2697.patch in Sage 3.3.alpha2



---

archive/issue_events_028567.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-24T18:41:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28567"
}
```



---

archive/issue_events_028568.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-24T18:41:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2697",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2697#event-28568"
}
```
