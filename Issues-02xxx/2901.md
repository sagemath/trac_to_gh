# Issue 2901: rewrite load_session and save_session to use much better modern techniques (in particular merge the notebook and non-notebook implementations)

archive/issues_002901.json:
```json
{
    "assignees": [],
    "body": "Basically, I know a lot more about how to write Python/Cython code than I used to, so i can write these functions in a way that is (1) vastly better, and (2) will be easily doctested, and (3) work in (almost) the same way in the notebook or command line. \n\nThis depends on the patch up at #2883.  #2883 should be applied then the code attached to this patch, once this patch is accepted.\n\nI've separated this out from #2883, since #2883 really *must* get applied, and the code here should be, but it's really a separate issue, and more nontrivial.\n\nAssignee: **cwitty**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/2901_\n\n",
    "closed_at": "2008-04-13T16:35:19Z",
    "created_at": "2008-04-13T01:42:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "rewrite load_session and save_session to use much better modern techniques (in particular merge the notebook and non-notebook implementations)",
    "type": "issue",
    "updated_at": "2008-04-13T16:35:19Z",
    "url": "https://github.com/sagemath/sage/issues/2901",
    "user": "https://github.com/williamstein"
}
```
Basically, I know a lot more about how to write Python/Cython code than I used to, so i can write these functions in a way that is (1) vastly better, and (2) will be easily doctested, and (3) work in (almost) the same way in the notebook or command line. 

This depends on the patch up at #2883.  #2883 should be applied then the code attached to this patch, once this patch is accepted.

I've separated this out from #2883, since #2883 really *must* get applied, and the code here should be, but it's really a separate issue, and more nontrivial.

Assignee: **cwitty**

_Issue created by migration from https://trac.sagemath.org/ticket/2901_





---

archive/issue_events_026725.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-13T01:42:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "milestone_number": null,
    "milestone_title": "sage-3.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26725"
}
```



---

archive/issue_events_026726.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-13T01:42:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26726"
}
```



---

archive/issue_events_026727.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-13T01:42:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26727"
}
```



---

archive/issue_comments_015939.json:
```json
{
    "body": "Attachment: **[sage-2901.patch.gz](https://github.com/sagemath/sage/files/ticket2901/sage-2901.patch.gz)**",
    "created_at": "2008-04-13T04:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2901#issuecomment-15939",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[sage-2901.patch.gz](https://github.com/sagemath/sage/files/ticket2901/sage-2901.patch.gz)**



---

archive/issue_events_026728.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-13T04:02:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26728"
}
```



---

archive/issue_comments_015940.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nPatch is up.   This basically replaces a bunch of terrifying ugly undocumented miserable scary code (umh, that I wrote) by nice modern well-documented code.",
    "created_at": "2008-04-13T04:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2901#issuecomment-15940",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'>Comment 1:</a>
Patch is up.   This basically replaces a bunch of terrifying ugly undocumented miserable scary code (umh, that I wrote) by nice modern well-documented code.



---

archive/issue_comments_015941.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI am not enough of a notebook user to test this thoroughly, but the code is good and the documentation is good.  I say apply immediately!\n\nOne quibble: could the module comment make it clear why this is in Cython and not Python?  I think there's a locals() trick at play, but it should be made clear none-the-less.",
    "created_at": "2008-04-13T04:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2901#issuecomment-15941",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:2'>Comment 2:</a>
I am not enough of a notebook user to test this thoroughly, but the code is good and the documentation is good.  I say apply immediately!

One quibble: could the module comment make it clear why this is in Cython and not Python?  I think there's a locals() trick at play, but it should be made clear none-the-less.



---

archive/issue_events_026729.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-04-13T04:08:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26729"
}
```



---

archive/issue_events_026730.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-04-13T04:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26730"
}
```



---

archive/issue_comments_015942.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nOk, I tracked down the issue for the reject of hunk two in worksheet.py. It expects:\n\n```\nif t.startswith('load_session'):\n    filename = self.hunt_file(filename)\n```\nBut the file contains:\n\n```\nfilename = self.hunt_file(filename)\n```\nI am deleting hunk two as is and then apply the rest of the patch.\n\nCheers,\n\nMichael",
    "created_at": "2008-04-13T16:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2901#issuecomment-15942",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:3'>Comment 3:</a>
Ok, I tracked down the issue for the reject of hunk two in worksheet.py. It expects:

```
if t.startswith('load_session'):
    filename = self.hunt_file(filename)
```
But the file contains:

```
filename = self.hunt_file(filename)
```
I am deleting hunk two as is and then apply the rest of the patch.

Cheers,

Michael



---

archive/issue_comments_015943.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nMerged in Sage 3.0.alpha5",
    "created_at": "2008-04-13T16:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2901#issuecomment-15943",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:4'>Comment 4:</a>
Merged in Sage 3.0.alpha5



---

archive/issue_events_026731.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-13T16:35:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26731"
}
```



---

archive/issue_events_026732.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-13T16:35:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2901",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2901#event-26732"
}
```
