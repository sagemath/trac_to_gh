# Issue 2064: foo?? doesn't know about cpdef from the command line

archive/issues_002064.json:
```json
{
    "body": "If you cpdef a function foo, and do foo?? from the command line, it displays both foo and the next function after it.\n\n**Assignee:** @ncalexan\n\n**CC:**  @jhpalmieri @robertwb\n\n**Author:** Mitesh Patel\n\n**Reviewer:** David Roe\n\n**Merged:** sage-4.3.3.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/2064\n\n",
    "closed_at": "2010-02-17T20:39:46Z",
    "created_at": "2008-02-05T21:38:25Z",
    "labels": [
        "component: documentation",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.3",
    "title": "foo?? doesn't know about cpdef from the command line",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2064",
    "user": "https://github.com/craigcitro"
}
```
If you cpdef a function foo, and do foo?? from the command line, it displays both foo and the next function after it.

**Assignee:** @ncalexan

**CC:**  @jhpalmieri @robertwb

**Author:** Mitesh Patel

**Reviewer:** David Roe

**Merged:** sage-4.3.3.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/2064





---

archive/issue_events_006113.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "component: misc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6113"
}
```



---

archive/issue_events_006114.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6114"
}
```



---

archive/issue_events_006115.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6115"
}
```



---

archive/issue_comments_012373.json:
```json
{
    "body": "Recognize Cython tokens in source-code introspection.  **sage** repository.",
    "created_at": "2010-02-02T04:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12373",
    "user": "https://github.com/qed777"
}
```

Recognize Cython tokens in source-code introspection.  **sage** repository.



---

archive/issue_comments_012374.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12374",
    "user": "https://github.com/qed777"
}
```

**Author:** Mitesh Patel



---

archive/issue_comments_012375.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12375",
    "user": "https://github.com/qed777"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_012376.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12376",
    "user": "https://github.com/qed777"
}
```

**Upstream:** N/A



---

archive/issue_events_006116.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6116"
}
```



---

archive/issue_events_006117.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6117"
}
```



---

archive/attachments_001710.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_2064-sage_cpdef_inspect.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.patch",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_012377.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've attached a patch uses a modified `inspect.BlockFinder` to recognize the `cdef` and `cpdef` tokens.  This appears to work for me, but I'm not a Cython expert.\n\nCurrently, the notebook has its own `sagenb.misc.sageinspect` and this has diverged in several places from `sage.misc.sageinspect`.  If the approach here is OK, I'll open a separate ticket to reconcile the files and fixes this problem in the notebook.",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12377",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>
I've attached a patch uses a modified `inspect.BlockFinder` to recognize the `cdef` and `cpdef` tokens.  This appears to work for me, but I'm not a Cython expert.

Currently, the notebook has its own `sagenb.misc.sageinspect` and this has diverged in several places from `sage.misc.sageinspect`.  If the approach here is OK, I'll open a separate ticket to reconcile the files and fixes this problem in the notebook.



---

archive/issue_events_006118.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "component: misc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6118"
}
```



---

archive/issue_comments_012378.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis seems to fix the problem for me (I tried `sage.rings.integer.Integer._act_on??` before and after the patch), but I'm not a Cython expert either.  Robert: can you look at it or suggest some else?",
    "created_at": "2010-02-07T19:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12378",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
This seems to fix the problem for me (I tried `sage.rings.integer.Integer._act_on??` before and after the patch), but I'm not a Cython expert either.  Robert: can you look at it or suggest some else?



---

archive/issue_comments_012379.json:
```json
{
    "body": "**Reviewer:** roed",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12379",
    "user": "https://github.com/roed314"
}
```

**Reviewer:** roed



---

archive/issue_comments_012380.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12380",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_012381.json:
```json
{
    "body": "<a id='comment:7'></a>\nI looked at the Python inspect module, and this seems like a sane modification.  It works for all of us.  \n\nMy main suggestion would be to remove \"cdef\" from the list of keywords you're looking for.  Since this is introspection, you can't ever see cdef'd functions, and I'm slightly worried that there's some use case where the other uses of that keyword in Cython could trip you up.\n\nOther than that, I'm happy to give it a positive review.",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12381",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
I looked at the Python inspect module, and this seems like a sane modification.  It works for all of us.  

My main suggestion would be to remove "cdef" from the list of keywords you're looking for.  Since this is introspection, you can't ever see cdef'd functions, and I'm slightly worried that there's some use case where the other uses of that keyword in Cython could trip you up.

Other than that, I'm happy to give it a positive review.



---

archive/issue_comments_012382.json:
```json
{
    "body": "Removes \"cdef\" from keyword list.  Apply only this patch.",
    "created_at": "2010-02-16T21:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12382",
    "user": "https://github.com/qed777"
}
```

Removes "cdef" from keyword list.  Apply only this patch.



---

archive/attachments_001711.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_2064-sage_cpdef_inspect.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.2.patch",
    "created_at": "2010-02-16T21:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_012383.json:
```json
{
    "body": "<a id='comment:8'></a>\nV2 adds only \"cpdef\" to the token search (or search for tokens).",
    "created_at": "2010-02-16T21:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12383",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
V2 adds only "cpdef" to the token search (or search for tokens).



---

archive/issue_comments_012384.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-02-16T21:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12384",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_012385.json:
```json
{
    "body": "<a id='comment:9'></a>\nYep.  Looks fine to me now.",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12385",
    "user": "https://github.com/roed314"
}
```

<a id='comment:9'></a>
Yep.  Looks fine to me now.



---

archive/issue_comments_012386.json:
```json
{
    "body": "**Changing reviewer** from \"roed\" to \"David Roe\".",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12386",
    "user": "https://github.com/roed314"
}
```

**Changing reviewer** from "roed" to "David Roe".



---

archive/issue_comments_012387.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12387",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_006119.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-02-17T20:39:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-6119"
}
```



---

archive/issue_comments_012388.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerged [trac_2064-sage_cpdef_inspect.2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/2064/trac_2064-sage_cpdef_inspect.2.patch).",
    "created_at": "2010-02-17T20:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12388",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:10'></a>
Merged [trac_2064-sage_cpdef_inspect.2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/2064/trac_2064-sage_cpdef_inspect.2.patch).



---

archive/issue_comments_012389.json:
```json
{
    "body": "**Merged:** sage-4.3.3.alpha1",
    "created_at": "2010-02-17T20:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-12389",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** sage-4.3.3.alpha1
