# Issue 2064: foo?? doesn't know about cpdef from the command line

archive/issues_002064.json:
```json
{
    "body": "If you cpdef a function foo, and do foo?? from the command line, it displays both foo and the next function after it.\n\nAssignee: @ncalexan\n\nCC:  @jhpalmieri @robertwb\n\nResolution: fixed\n\nAuthor: Mitesh Patel\n\nReviewer: David Roe\n\nMerged: sage-4.3.3.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/2064\n\n",
    "closed_at": "2010-02-17T20:39:46Z",
    "created_at": "2008-02-05T21:38:25Z",
    "labels": [
        "component: documentation",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.3",
    "title": "foo?? doesn't know about cpdef from the command line",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/2064",
    "user": "https://github.com/craigcitro"
}
```
If you cpdef a function foo, and do foo?? from the command line, it displays both foo and the next function after it.

Assignee: @ncalexan

CC:  @jhpalmieri @robertwb

Resolution: fixed

Author: Mitesh Patel

Reviewer: David Roe

Merged: sage-4.3.3.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/2064





---

archive/issue_events_007062.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "component: misc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-7062"
}
```



---

archive/issue_events_007063.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-7063"
}
```



---

archive/issue_comments_013946.json:
```json
{
    "body": "Recognize Cython tokens in source-code introspection.  **sage** repository.",
    "created_at": "2010-02-02T04:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13946",
    "user": "https://github.com/qed777"
}
```

Recognize Cython tokens in source-code introspection.  **sage** repository.



---

archive/issue_comments_013947.json:
```json
{
    "body": "Changing author from \"\" to \"Mitesh Patel\"",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13947",
    "user": "https://github.com/qed777"
}
```

Changing author from "" to "Mitesh Patel"



---

archive/issue_comments_013948.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13948",
    "user": "https://github.com/qed777"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_013949.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13949",
    "user": "https://github.com/qed777"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_events_007064.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-7064"
}
```



---

archive/issue_comments_013950.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_2064-sage_cpdef_inspect.patch](tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.patch) by @qed777 created at 2010-02-02 04:57:40\n\nI've attached a patch uses a modified `inspect.BlockFinder` to recognize the `cdef` and `cpdef` tokens.  This appears to work for me, but I'm not a Cython expert.\n\nCurrently, the notebook has its own `sagenb.misc.sageinspect` and this has diverged in several places from `sage.misc.sageinspect`.  If the approach here is OK, I'll open a separate ticket to reconcile the files and fixes this problem in the notebook.",
    "created_at": "2010-02-02T04:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13950",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>
Attachment [trac_2064-sage_cpdef_inspect.patch](tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.patch) by @qed777 created at 2010-02-02 04:57:40

I've attached a patch uses a modified `inspect.BlockFinder` to recognize the `cdef` and `cpdef` tokens.  This appears to work for me, but I'm not a Cython expert.

Currently, the notebook has its own `sagenb.misc.sageinspect` and this has diverged in several places from `sage.misc.sageinspect`.  If the approach here is OK, I'll open a separate ticket to reconcile the files and fixes this problem in the notebook.



---

archive/issue_events_007065.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "label": "component: misc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-7065"
}
```



---

archive/issue_comments_013951.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis seems to fix the problem for me (I tried `sage.rings.integer.Integer._act_on??` before and after the patch), but I'm not a Cython expert either.  Robert: can you look at it or suggest some else?",
    "created_at": "2010-02-07T19:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13951",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
This seems to fix the problem for me (I tried `sage.rings.integer.Integer._act_on??` before and after the patch), but I'm not a Cython expert either.  Robert: can you look at it or suggest some else?



---

archive/issue_comments_013952.json:
```json
{
    "body": "Changing reviewer from \"\" to \"roed\"",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13952",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "" to "roed"



---

archive/issue_comments_013953.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13953",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_013954.json:
```json
{
    "body": "<a id='comment:7'></a>\nI looked at the Python inspect module, and this seems like a sane modification.  It works for all of us.  \n\nMy main suggestion would be to remove \"cdef\" from the list of keywords you're looking for.  Since this is introspection, you can't ever see cdef'd functions, and I'm slightly worried that there's some use case where the other uses of that keyword in Cython could trip you up.\n\nOther than that, I'm happy to give it a positive review.",
    "created_at": "2010-02-09T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13954",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
I looked at the Python inspect module, and this seems like a sane modification.  It works for all of us.  

My main suggestion would be to remove "cdef" from the list of keywords you're looking for.  Since this is introspection, you can't ever see cdef'd functions, and I'm slightly worried that there's some use case where the other uses of that keyword in Cython could trip you up.

Other than that, I'm happy to give it a positive review.



---

archive/issue_comments_013955.json:
```json
{
    "body": "Removes \"cdef\" from keyword list.  Apply only this patch.",
    "created_at": "2010-02-16T21:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13955",
    "user": "https://github.com/qed777"
}
```

Removes "cdef" from keyword list.  Apply only this patch.



---

archive/issue_comments_013956.json:
```json
{
    "body": "<a id='comment:8'></a>\nAttachment [trac_2064-sage_cpdef_inspect.2.patch](tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.2.patch) by @qed777 created at 2010-02-16 21:23:47\n\nV2 adds only \"cpdef\" to the token search (or search for tokens).",
    "created_at": "2010-02-16T21:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13956",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
Attachment [trac_2064-sage_cpdef_inspect.2.patch](tarball://root/attachments/some-uuid/ticket2064/trac_2064-sage_cpdef_inspect.2.patch) by @qed777 created at 2010-02-16 21:23:47

V2 adds only "cpdef" to the token search (or search for tokens).



---

archive/issue_comments_013957.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-02-16T21:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13957",
    "user": "https://github.com/qed777"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_013958.json:
```json
{
    "body": "<a id='comment:9'></a>\nYep.  Looks fine to me now.",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13958",
    "user": "https://github.com/roed314"
}
```

<a id='comment:9'></a>
Yep.  Looks fine to me now.



---

archive/issue_comments_013959.json:
```json
{
    "body": "Changing reviewer from \"roed\" to \"David Roe\"",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13959",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "roed" to "David Roe"



---

archive/issue_comments_013960.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-02-16T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13960",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_013961.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-02-17T20:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13961",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_events_007066.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-02-17T20:39:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/2064#event-7066"
}
```



---

archive/issue_comments_013962.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerged [trac_2064-sage_cpdef_inspect.2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/2064/trac_2064-sage_cpdef_inspect.2.patch).",
    "created_at": "2010-02-17T20:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13962",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:10'></a>
Merged [trac_2064-sage_cpdef_inspect.2.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/2064/trac_2064-sage_cpdef_inspect.2.patch).



---

archive/issue_comments_013963.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.3.3.alpha1\"",
    "created_at": "2010-02-17T20:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/2064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/2064#issuecomment-13963",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "" to "sage-4.3.3.alpha1"
