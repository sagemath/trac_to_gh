# Issue 2452: Heaviside step function, Dirac delta needed

archive/issues_002452.json:
```json
{
    "assignees": [
        "https://github.com/garyfurnish"
    ],
    "body": "Symbolic heaviside step function is needed for ease of plotting.  Right now you must \n\n```\nsage: def u(x):\n    if(x<0):\n        return 0\n    else:\n        return 1*cos(x)\nsage: plot(u,-5,5)\n```\ninstead of\n\n```\n plot(heaviside(t)*cos(t),t,-5,5)\n```\n\n**Update:**  Attached patch adds support for three generalized functions: Dirac delta, Heaviside step and unit step in new pynac-based symbolics.\n\nThe adopted convention is discussed here\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/5f7de72642b8e568/f226acf9a6331d4d\n\nThese functions can be used in Sage like any other symbolic functions. \n\nA specialized integration algorithm involving generalized functions is under development and will be posted as a separate ticket.\n\n\n\n\nCC:  @golam-m-hossain\n\nComponent: **symbolics**\n\nAuthor: **Golam Mortuza Hossain**\n\nReviewer: **David Joyner, Burcin Erocal**\n\nMerged: **sage-4.1.rc0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/2452_\n\n",
    "closed_at": "2009-07-04T19:54:26Z",
    "created_at": "2008-03-10T07:52:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Heaviside step function, Dirac delta needed",
    "type": "issue",
    "updated_at": "2009-07-04T19:54:26Z",
    "url": "https://github.com/sagemath/sage/issues/2452",
    "user": "https://github.com/garyfurnish"
}
```
Symbolic heaviside step function is needed for ease of plotting.  Right now you must 

```
sage: def u(x):
    if(x<0):
        return 0
    else:
        return 1*cos(x)
sage: plot(u,-5,5)
```
instead of

```
 plot(heaviside(t)*cos(t),t,-5,5)
```

**Update:**  Attached patch adds support for three generalized functions: Dirac delta, Heaviside step and unit step in new pynac-based symbolics.

The adopted convention is discussed here

http://groups.google.com/group/sage-devel/browse_thread/thread/5f7de72642b8e568/f226acf9a6331d4d

These functions can be used in Sage like any other symbolic functions. 

A specialized integration algorithm involving generalized functions is under development and will be posted as a separate ticket.




CC:  @golam-m-hossain

Component: **symbolics**

Author: **Golam Mortuza Hossain**

Reviewer: **David Joyner, Burcin Erocal**

Merged: **sage-4.1.rc0**

_Issue created by migration from https://trac.sagemath.org/ticket/2452_





---

archive/issue_events_025336.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-10T07:52:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "milestone_number": null,
    "milestone_title": "sage-4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25336"
}
```



---

archive/issue_events_025337.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-10T07:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25337"
}
```



---

archive/issue_events_025338.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-10T07:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25338"
}
```



---

archive/issue_events_025339.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-10T07:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25339"
}
```



---

archive/issue_events_025340.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-10T07:52:27Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "subject": "https://github.com/garyfurnish",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25340"
}
```



---

archive/issue_comments_012391.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nYou can make a Heaviside function with Piecewise. \nsage: f0 = lambda x: 0; f1 = lambda x:x^0; Heaviside = Piecewise([[(-infinity,0),f0],[(0,infinity),f1]])\nsage: Heaviside(3)\n1\nsage: Heaviside(-23)\n0\nHowever, plotting is broken. You have to make a truncated function to plot:\nsage: f0 = lambda x: 0; f1 = lambda x:x^0; Heaviside = Piecewise([[(-10,0),f0],[(0,10),f1]])\nsage: Heaviside.plot()\nworks.\nOf course, improvements to Piecewise would be great...",
    "created_at": "2008-03-10T11:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12391",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:1" align="right">comment:1</div>

You can make a Heaviside function with Piecewise. 
sage: f0 = lambda x: 0; f1 = lambda x:x^0; Heaviside = Piecewise([[(-infinity,0),f0],[(0,infinity),f1]])
sage: Heaviside(3)
1
sage: Heaviside(-23)
0
However, plotting is broken. You have to make a truncated function to plot:
sage: f0 = lambda x: 0; f1 = lambda x:x^0; Heaviside = Piecewise([[(-10,0),f0],[(0,10),f1]])
sage: Heaviside.plot()
works.
Of course, improvements to Piecewise would be great...



---

archive/issue_events_025341.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-03-16T20:12:08Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "subject": "https://github.com/garyfurnish",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25341"
}
```



---

archive/issue_events_025342.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-16T20:12:08Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "subject": "https://github.com/garyfurnish",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25342"
}
```



---

archive/issue_comments_012392.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWhat is the status of this?  I noticed something else when trying to do a diffeq lesson:\n\n```\nsage: def unit_step(c):\n....:         return piecewise( [( (-oo,c), 0), ((c, oo), 1)] )\n....:\nsage: unit_step(2)\nPiecewise defined function with 2 parts, [((-Infinity, 2), 0), ((2, +Infinity), 1)]\nsage: unit_step(2)*unit_step(3)\nPiecewise defined function with 3 parts, [[(2, 3), 0], [(3, -Infinity), 0], [(-Infinity, +Infinity), 1]]\n```\n\nThat last multiplication just plain does not make sense.  Even the intervals are all messed up.",
    "created_at": "2008-10-21T16:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12392",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

What is the status of this?  I noticed something else when trying to do a diffeq lesson:

```
sage: def unit_step(c):
....:         return piecewise( [( (-oo,c), 0), ((c, oo), 1)] )
....:
sage: unit_step(2)
Piecewise defined function with 2 parts, [((-Infinity, 2), 0), ((2, +Infinity), 1)]
sage: unit_step(2)*unit_step(3)
Piecewise defined function with 3 parts, [[(2, 3), 0], [(3, -Infinity), 0], [(-Infinity, +Infinity), 1]]
```

That last multiplication just plain does not make sense.  Even the intervals are all messed up.



---

archive/issue_comments_012393.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis might explain the problem:\n\n```\nsage: def unit_step(c):\n    return piecewise( [( (-Infinity,c), 0), ((c, Infinity), 1)] )\n....:\nsage: unit_step(1)\nPiecewise defined function with 2 parts, [((-Infinity, 1), 0), ((1, +Infinity), 1)]\nsage: unit_step(1)(1/2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/wdj/sagefiles/sage-3.2.alpha0/<ipython console> in <module>()\n\n/home/wdj/sagefiles/sage-3.2.alpha0/local/lib/python2.5/site-packages/sage/functions/piecewise.pyc in __call__(self, x0)\n    591         for i in range(n):\n    592             if endpts[i] < x0 < endpts[i+1]:\n--> 593                 return self.functions()[i](x0)\n    594         raise ValueError,\"Value not defined outside of domain.\"\n    595\n\nTypeError: 'sage.rings.integer.Integer' object is not callable\n```",
    "created_at": "2008-10-21T17:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12393",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:4" align="right">comment:4</div>

This might explain the problem:

```
sage: def unit_step(c):
    return piecewise( [( (-Infinity,c), 0), ((c, Infinity), 1)] )
....:
sage: unit_step(1)
Piecewise defined function with 2 parts, [((-Infinity, 1), 0), ((1, +Infinity), 1)]
sage: unit_step(1)(1/2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/wdj/sagefiles/sage-3.2.alpha0/<ipython console> in <module>()

/home/wdj/sagefiles/sage-3.2.alpha0/local/lib/python2.5/site-packages/sage/functions/piecewise.pyc in __call__(self, x0)
    591         for i in range(n):
    592             if endpts[i] < x0 < endpts[i+1]:
--> 593                 return self.functions()[i](x0)
    594         raise ValueError,"Value not defined outside of domain."
    595

TypeError: 'sage.rings.integer.Integer' object is not callable
```



---

archive/issue_comments_012394.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDescriptions/title are updated and a patch (sage-4.0.2) implementing Dirac delta, Heaviside step and Unit step function is attached.",
    "created_at": "2009-06-28T11:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12394",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:5" align="right">comment:5</div>

Descriptions/title are updated and a patch (sage-4.0.2) implementing Dirac delta, Heaviside step and Unit step function is attached.



---

archive/issue_events_025343.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-28T11:30:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25343"
}
```



---

archive/issue_events_025344.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-28T11:30:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25344"
}
```



---

archive/issue_events_025345.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-28T11:30:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "title_is": "Heaviside step function, Dirac delta needed",
    "title_was": "heaviside step function needed",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25345"
}
```



---

archive/issue_events_025346.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-28T11:30:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25346"
}
```



---

archive/issue_comments_012395.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,16 @@\n ```\n  plot(heaviside(t)*cos(t),t,-5,5)\n ```\n+\n+**Update:**  Attached patch adds support for three generalized functions: Dirac delta, Heaviside step and unit step in new pynac-based symbolics.\n+\n+The adopted convention is discussed here\n+\n+http://groups.google.com/group/sage-devel/browse_thread/thread/5f7de72642b8e568/f226acf9a6331d4d\n+\n+These functions can be used in Sage like any other symbolic functions. \n+\n+A specialized integration algorithm involving generalized functions is under development and will be posted as a separate ticket.\n+\n+\n+\n``````\n",
    "created_at": "2009-06-28T11:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12395",
    "user": "https://github.com/golam-m-hossain"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,16 @@
 ```
  plot(heaviside(t)*cos(t),t,-5,5)
 ```
+
+**Update:**  Attached patch adds support for three generalized functions: Dirac delta, Heaviside step and unit step in new pynac-based symbolics.
+
+The adopted convention is discussed here
+
+http://groups.google.com/group/sage-devel/browse_thread/thread/5f7de72642b8e568/f226acf9a6331d4d
+
+These functions can be used in Sage like any other symbolic functions. 
+
+A specialized integration algorithm involving generalized functions is under development and will be posted as a separate ticket.
+
+
+
``````




---

archive/issue_comments_012396.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nPatch applies to 3.1.alpha1. Running tests now.\n\nOne possible problem: Is\n\n```\nsage: dirac_delta.integral(0)\nheaviside(0)\n```\nmathematically correct?",
    "created_at": "2009-06-28T11:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12396",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:7" align="right">comment:7</div>

Patch applies to 3.1.alpha1. Running tests now.

One possible problem: Is

```
sage: dirac_delta.integral(0)
heaviside(0)
```
mathematically correct?



---

archive/issue_comments_012397.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@wdjoyner](#comment:7):\n> Is\n> \n\n```\nsage: dirac_delta.integral(0)\nheaviside(0)\n```\n> mathematically correct?\n> \n\nThanks, its a good point. I agree, it is ambiguous at best. I guess, it may be a good \nidea to remove .integral() methods from their definitions. Specialized integration \nalgorithm involving these functions will handle the situation much better.\nI will wait for your remaining comments before updating the patch.",
    "created_at": "2009-06-28T12:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12397",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@wdjoyner](#comment:7):
> Is
> 

```
sage: dirac_delta.integral(0)
heaviside(0)
```
> mathematically correct?
> 

Thanks, its a good point. I agree, it is ambiguous at best. I guess, it may be a good 
idea to remove .integral() methods from their definitions. Specialized integration 
algorithm involving these functions will handle the situation much better.
I will wait for your remaining comments before updating the patch.



---

archive/issue_comments_012398.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe testing didn't reveal any failures related to the patch. However, I'm also wondering about\nthis output:\n\n```\nsage: f(x) = heaviside(x)+dirac_delta(x)\nsage: f(1)\ndirac_delta(1) + heaviside(1)\nsage: f = heaviside+dirac_delta\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/wdj/.sage/temp/hera/14949/_home_wdj__sage_init_sage_0.py in <module>()\n\nTypeError: unsupported operand type(s) for +: 'FunctionHeaviside' and 'FunctionDiracDelta'\n```\neven though it has no problem evaluating them:\n\n```\nsage: heaviside(1); dirac_delta(1)\n1\n0\n```\n\nI don't see a problem with the integral methods but I'd prefer definite integrals over indefinite ones.\nIn any case, \n\n```\nsage: dirac_delta.integral(0)\nheaviside(0)\n```\nseems odd. \n\nIf you can address these comments I'd be happy to look at it again.",
    "created_at": "2009-06-28T17:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12398",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:9" align="right">comment:9</div>

The testing didn't reveal any failures related to the patch. However, I'm also wondering about
this output:

```
sage: f(x) = heaviside(x)+dirac_delta(x)
sage: f(1)
dirac_delta(1) + heaviside(1)
sage: f = heaviside+dirac_delta
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/wdj/.sage/temp/hera/14949/_home_wdj__sage_init_sage_0.py in <module>()

TypeError: unsupported operand type(s) for +: 'FunctionHeaviside' and 'FunctionDiracDelta'
```
even though it has no problem evaluating them:

```
sage: heaviside(1); dirac_delta(1)
1
0
```

I don't see a problem with the integral methods but I'd prefer definite integrals over indefinite ones.
In any case, 

```
sage: dirac_delta.integral(0)
heaviside(0)
```
seems odd. 

If you can address these comments I'd be happy to look at it again.



---

archive/issue_events_025347.json:
```json
{
    "actor": "https://github.com/wdjoyner",
    "created_at": "2009-06-28T17:22:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25347"
}
```



---

archive/issue_events_025348.json:
```json
{
    "actor": "https://github.com/wdjoyner",
    "created_at": "2009-06-28T17:22:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25348"
}
```



---

archive/issue_events_025349.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-29T14:45:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25349"
}
```



---

archive/issue_events_025350.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-29T14:45:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25350"
}
```



---

archive/issue_comments_012399.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks David,\n\n> The testing didn't reveal any failures related to the patch. However, I'm also wondering about\n> this output:\n\n\n```\nsage: f(x) = heaviside(x)+dirac_delta(x)\nsage: f(1)\ndirac_delta(1) + heaviside(1)\n```\n\nIt seems, you have hit a bug in new symbolics. The similar non-evaluation\nof symbolic function is happening even with other functions such as sin, cos. \nI posted this issue here\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/3936d1290ee933a6\n\nBurcin wrote that this is a bug and it is to be fixed in the new version of pynac.\n\n>\n\n```\nsage: f = heaviside+dirac_delta\n...\nTypeError\n```\n>\n\nIt seems in new symbolics, arithmetic of bare-bone functions is no-longer allowed. \nFor example, if I try\n\n```\nf = sin + cos \n```\nthen I get the same error. \n\n> I don't see a problem with the integral methods but I'd prefer definite integrals over indefinite ones.\n> In any case,  \n\n\n```\nsage: dirac_delta.integral(0)\nheaviside(0)\n```\n> seems odd. \n\nI agree this is odd. I have removed the integral methods from this patch. Integration algorithm\nthat I am implementing will do both definite and indefinite integrals involving these functions.\nSo I guess, it is better to avoid code-duplication.\n\nApart from above, I have clarified two sentences in doc-strings. The updated patch is attached.",
    "created_at": "2009-06-29T14:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12399",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks David,

> The testing didn't reveal any failures related to the patch. However, I'm also wondering about
> this output:


```
sage: f(x) = heaviside(x)+dirac_delta(x)
sage: f(1)
dirac_delta(1) + heaviside(1)
```

It seems, you have hit a bug in new symbolics. The similar non-evaluation
of symbolic function is happening even with other functions such as sin, cos. 
I posted this issue here

http://groups.google.com/group/sage-devel/browse_thread/thread/3936d1290ee933a6

Burcin wrote that this is a bug and it is to be fixed in the new version of pynac.

>

```
sage: f = heaviside+dirac_delta
...
TypeError
```
>

It seems in new symbolics, arithmetic of bare-bone functions is no-longer allowed. 
For example, if I try

```
f = sin + cos 
```
then I get the same error. 

> I don't see a problem with the integral methods but I'd prefer definite integrals over indefinite ones.
> In any case,  


```
sage: dirac_delta.integral(0)
heaviside(0)
```
> seems odd. 

I agree this is odd. I have removed the integral methods from this patch. Integration algorithm
that I am implementing will do both definite and indefinite integrals involving these functions.
So I guess, it is better to avoid code-duplication.

Apart from above, I have clarified two sentences in doc-strings. The updated patch is attached.



---

archive/issue_events_025351.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-29T17:36:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25351"
}
```



---

archive/issue_events_025352.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-29T17:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25352"
}
```



---

archive/issue_comments_012400.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@golam-m-hossain](#comment:11):\n> > The testing didn't reveal any failures related to the patch. However, I'm also wondering about\n> > this output:\n\n\n ```\n sage: f(x) = heaviside(x)+dirac_delta(x)\n sage: f(1)\n dirac_delta(1) + heaviside(1)\n ```\n> \n> It seems, you have hit a bug in new symbolics. The similar non-evaluation\n> of symbolic function is happening even with other functions such as sin, cos. \n> I posted this issue here\n> \n> http://groups.google.com/group/sage-devel/browse_thread/thread/3936d1290ee933a6\n> \n> Burcin wrote that this is a bug and it is to be fixed in the new version of pynac.\n\nThis is a different issue than the one you posted on sage-devel. \n\nIn your patch, you are not telling pynac how to evaluate the function you define. This is done by defining an `_eval_` method, so if you move the contents of your `__call__` function to `_eval_` and remove the last `SFunction.__call__` line things should work fine. I agree that this is confusing. It's one of the main points I wanted to address while refactoring symbolic functions.\n\nI would also like to see a `.sub()` test added, since this is the easiest way to test if the `_eval_` function is defined properly. E.g.,\n\n```\nsage: dirac_delta(x).sub(x=1)\n0\nsage: heaviside(x).sub(x=1)\n1\n```",
    "created_at": "2009-06-29T17:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12400",
    "user": "https://github.com/burcin"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@golam-m-hossain](#comment:11):
> > The testing didn't reveal any failures related to the patch. However, I'm also wondering about
> > this output:


 ```
 sage: f(x) = heaviside(x)+dirac_delta(x)
 sage: f(1)
 dirac_delta(1) + heaviside(1)
 ```
> 
> It seems, you have hit a bug in new symbolics. The similar non-evaluation
> of symbolic function is happening even with other functions such as sin, cos. 
> I posted this issue here
> 
> http://groups.google.com/group/sage-devel/browse_thread/thread/3936d1290ee933a6
> 
> Burcin wrote that this is a bug and it is to be fixed in the new version of pynac.

This is a different issue than the one you posted on sage-devel. 

In your patch, you are not telling pynac how to evaluate the function you define. This is done by defining an `_eval_` method, so if you move the contents of your `__call__` function to `_eval_` and remove the last `SFunction.__call__` line things should work fine. I agree that this is confusing. It's one of the main points I wanted to address while refactoring symbolic functions.

I would also like to see a `.sub()` test added, since this is the easiest way to test if the `_eval_` function is defined properly. E.g.,

```
sage: dirac_delta(x).sub(x=1)
0
sage: heaviside(x).sub(x=1)
1
```



---

archive/issue_events_025353.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-29T17:36:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25353"
}
```



---

archive/issue_events_025354.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-29T17:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25354"
}
```



---

archive/issue_comments_012401.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI finished testing the patch. It seems to pass tests okay but I totally agree with Burcin's comments above and would appreciate it if you could try to address them. Thanks!",
    "created_at": "2009-06-29T20:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12401",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:13" align="right">comment:13</div>

I finished testing the patch. It seems to pass tests okay but I totally agree with Burcin's comments above and would appreciate it if you could try to address them. Thanks!



---

archive/issue_comments_012402.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@burcin](#comment:12):\n\n**(1)**\n> so if you move the contents of your `__call__` function to `_eval_` and \n> remove the last `SFunction.__call__` line things should work fine. \n\nThanks Burcin! Thats what it needed. As you suggested, I have made those changes and\nexplicit evaluation is now working.\n\n\n**(2)**\n> I would also like to see a `.sub()` test added, \n\nI am assuming you meant \".subs()\". Several new tests are added as you \nsuggested.\n\n\n**(3)** Doctstrings are updated suitably as `__call__` methods are now removed.",
    "created_at": "2009-06-29T21:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12402",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@burcin](#comment:12):

**(1)**
> so if you move the contents of your `__call__` function to `_eval_` and 
> remove the last `SFunction.__call__` line things should work fine. 

Thanks Burcin! Thats what it needed. As you suggested, I have made those changes and
explicit evaluation is now working.


**(2)**
> I would also like to see a `.sub()` test added, 

I am assuming you meant ".subs()". Several new tests are added as you 
suggested.


**(3)** Doctstrings are updated suitably as `__call__` methods are now removed.



---

archive/issue_events_025355.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-29T21:55:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25355"
}
```



---

archive/issue_events_025356.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-06-29T21:55:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25356"
}
```



---

archive/issue_events_025357.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-30T10:08:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25357"
}
```



---

archive/issue_events_025358.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-06-30T10:08:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25358"
}
```



---

archive/issue_comments_012403.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSorry for doing this in such small pieces, but I have one more suggestion. \n\nYou can change the calls to the `_is_real()` function by `x in RR` where you import `RR` from `sage.rings.real_mpfr`. The semantics of the `__contains__()` method in Sage is similar to your `_is_real()`, though it also checks that `approx_x == x` in your code.\n\nBTW, the reason `exp(-100000000000)` is evaluated to be 0 is that we don't use interval fields to do the numerical approximation. This is also ##5993.",
    "created_at": "2009-06-30T10:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12403",
    "user": "https://github.com/burcin"
}
```

<div id="comment:15" align="right">comment:15</div>

Sorry for doing this in such small pieces, but I have one more suggestion. 

You can change the calls to the `_is_real()` function by `x in RR` where you import `RR` from `sage.rings.real_mpfr`. The semantics of the `__contains__()` method in Sage is similar to your `_is_real()`, though it also checks that `approx_x == x` in your code.

BTW, the reason `exp(-100000000000)` is evaluated to be 0 is that we don't use interval fields to do the numerical approximation. This is also ##5993.



---

archive/issue_comments_012404.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@burcin](#comment:15):\n> Sorry for doing this in such small pieces, but I have one more suggestion. \n> \n> You can change the calls to the `_is_real()` function by `x in RR` where you import `RR` from `sage.rings.real_mpfr`. \n> The semantics of the `__contains__()` method in Sage is similar to your `_is_real()`, though it also checks that `approx_x == x` in your code.\n\nHi Burcin. I tried your suggestion. I am not sure whats going wrong but it slows down massively. Could\nyou please check this out?\n\n**With: `_is_real(x)`**\n\n```\nsage: timeit( 'dirac_delta(1 + I*exp(-10000))')\n125 loops, best of 3: 6.47 ms per loop\nsage: timeit( 'dirac_delta(1 + I*exp(-10000000000000000))')\n125 loops, best of 3: 6.23 ms per loop\n```\n\n**with: `x in RR`**\n \n\n```\nsage: timeit( 'dirac_delta(1 + I*exp(-10000))')\n125 loops, best of 3: 6.56 ms per loop\nsage: timeit( 'dirac_delta(1 + I*exp(-10000000000000000))')\n5 loops, best of 3: 154 ms per loop\n```\n\nThanks,",
    "created_at": "2009-06-30T13:29:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12404",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@burcin](#comment:15):
> Sorry for doing this in such small pieces, but I have one more suggestion. 
> 
> You can change the calls to the `_is_real()` function by `x in RR` where you import `RR` from `sage.rings.real_mpfr`. 
> The semantics of the `__contains__()` method in Sage is similar to your `_is_real()`, though it also checks that `approx_x == x` in your code.

Hi Burcin. I tried your suggestion. I am not sure whats going wrong but it slows down massively. Could
you please check this out?

**With: `_is_real(x)`**

```
sage: timeit( 'dirac_delta(1 + I*exp(-10000))')
125 loops, best of 3: 6.47 ms per loop
sage: timeit( 'dirac_delta(1 + I*exp(-10000000000000000))')
125 loops, best of 3: 6.23 ms per loop
```

**with: `x in RR`**
 

```
sage: timeit( 'dirac_delta(1 + I*exp(-10000))')
125 loops, best of 3: 6.56 ms per loop
sage: timeit( 'dirac_delta(1 + I*exp(-10000000000000000))')
5 loops, best of 3: 154 ms per loop
```

Thanks,



---

archive/issue_comments_012405.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHi Golam,\n\nYou're right! When using high precision we start calling maxima to decide if two expressions are equal. This kills performance as you observed.\n\nNow I suggest using `CIF(x).imag() == 0` where `x` is the element you want to test for. This is consistent in timings, and produces correct results:\n\n```\nsage: u = 1 + I*exp(-10000000000000000)\nsage: CIF(u).imag() == 0\nFalse\nsage: timeit('b = (CIF(u).imag() == 0)')\n625 loops, best of 3: 761 \u00b5s per loop\nsage: t = 1 + I*exp(-10000)\nsage: CIF(t).imag() == 0\nFalse\nsage: timeit('b = (CIF(t).imag() == 0)')\n625 loops, best of 3: 784 \u00b5s per loop\n```\n\nThanks.",
    "created_at": "2009-06-30T19:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12405",
    "user": "https://github.com/burcin"
}
```

<div id="comment:17" align="right">comment:17</div>

Hi Golam,

You're right! When using high precision we start calling maxima to decide if two expressions are equal. This kills performance as you observed.

Now I suggest using `CIF(x).imag() == 0` where `x` is the element you want to test for. This is consistent in timings, and produces correct results:

```
sage: u = 1 + I*exp(-10000000000000000)
sage: CIF(u).imag() == 0
False
sage: timeit('b = (CIF(u).imag() == 0)')
625 loops, best of 3: 761 µs per loop
sage: t = 1 + I*exp(-10000)
sage: CIF(t).imag() == 0
False
sage: timeit('b = (CIF(t).imag() == 0)')
625 loops, best of 3: 784 µs per loop
```

Thanks.



---

archive/issue_comments_012406.json:
```json
{
    "body": "Attachment: **[trac_2452-implements-Dirac-delta-Heaviside-and-Unit-step-functions.patch.gz](https://github.com/sagemath/sage/files/ticket2452/trac_2452-implements-Dirac-delta-Heaviside-and-Unit-step-functions.patch.gz)**",
    "created_at": "2009-07-01T00:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12406",
    "user": "https://github.com/golam-m-hossain"
}
```

Attachment: **[trac_2452-implements-Dirac-delta-Heaviside-and-Unit-step-functions.patch.gz](https://github.com/sagemath/sage/files/ticket2452/trac_2452-implements-Dirac-delta-Heaviside-and-Unit-step-functions.patch.gz)**



---

archive/issue_events_025359.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-01T00:58:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25359"
}
```



---

archive/issue_events_025360.json:
```json
{
    "actor": "https://github.com/golam-m-hossain",
    "created_at": "2009-07-01T00:58:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25360"
}
```



---

archive/issue_comments_012407.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@burcin](#comment:17):\n> Now I suggest using `CIF(x).imag() == 0` where `x` is the element you want to test for. \n\nThats great. It now works much faster even for very very small numbers. Here are the \nchanges in the updated patch:\n\n**(1)**:  _is_real(x) removed\n\n**(2)**:  CIF(x) is now being used\n\n**(3)**: Notes on finite precision size removed.\n\n**(4)**: new doctests for very small numbers added",
    "created_at": "2009-07-01T00:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12407",
    "user": "https://github.com/golam-m-hossain"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@burcin](#comment:17):
> Now I suggest using `CIF(x).imag() == 0` where `x` is the element you want to test for. 

Thats great. It now works much faster even for very very small numbers. Here are the 
changes in the updated patch:

**(1)**:  _is_real(x) removed

**(2)**:  CIF(x) is now being used

**(3)**: Notes on finite precision size removed.

**(4)**: new doctests for very small numbers added



---

archive/issue_comments_012408.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThis applies to 4.1.alpha1 on an amd64 ubuntu 9.04 machine and passes all tests except for three which seem unrelated (darwin_utilities, random_tests, and the French programming tutorial).\n\n```\nsage: t = var(\"t\")\nsage: plot(heaviside(t)+2*heaviside(t-1),t,-5,5)\nsage: P1 = plot(t*heaviside(t)+(2-t)*heaviside(t-1),t,-5,5)\nsage: P2 = plot(heaviside(t)*cos(t),t,-5,5, linestyle=\"--\", rgbcolor=(1,0,0), thickness=3)\nsage: show(P1+P2)\n\n```\nI like the fact that plotting like this works so well!",
    "created_at": "2009-07-01T13:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12408",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:19" align="right">comment:19</div>

This applies to 4.1.alpha1 on an amd64 ubuntu 9.04 machine and passes all tests except for three which seem unrelated (darwin_utilities, random_tests, and the French programming tutorial).

```
sage: t = var("t")
sage: plot(heaviside(t)+2*heaviside(t-1),t,-5,5)
sage: P1 = plot(t*heaviside(t)+(2-t)*heaviside(t-1),t,-5,5)
sage: P2 = plot(heaviside(t)*cos(t),t,-5,5, linestyle="--", rgbcolor=(1,0,0), thickness=3)
sage: show(P1+P2)

```
I like the fact that plotting like this works so well!



---

archive/issue_events_025361.json:
```json
{
    "actor": "https://github.com/wdjoyner",
    "created_at": "2009-07-01T13:22:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25361"
}
```



---

archive/issue_events_025362.json:
```json
{
    "actor": "https://github.com/wdjoyner",
    "created_at": "2009-07-01T13:22:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25362"
}
```



---

archive/issue_comments_012409.json:
```json
{
    "body": "fix doctests in random_tests.py",
    "created_at": "2009-07-02T09:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12409",
    "user": "https://github.com/burcin"
}
```

fix doctests in random_tests.py



---

archive/issue_comments_012410.json:
```json
{
    "body": "Reviewer: **David Joyner, Burcin Erocal**",
    "created_at": "2009-07-02T09:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12410",
    "user": "https://github.com/burcin"
}
```

Reviewer: **David Joyner, Burcin Erocal**



---

archive/issue_comments_012411.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac_2452-doctest_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket2452/trac_2452-doctest_fixes.patch.gz)**\n\nThe failing doctests in sage/symbolic/random_tests.py is caused by this ticket. That function constructs a random expression, given all the symbolic functions defined in Sage. Since this patch adds new functions, the probability distribution, hence the result changes.\n\nI attached a small patch to fix these doctests.",
    "created_at": "2009-07-02T09:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12411",
    "user": "https://github.com/burcin"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac_2452-doctest_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket2452/trac_2452-doctest_fixes.patch.gz)**

The failing doctests in sage/symbolic/random_tests.py is caused by this ticket. That function constructs a random expression, given all the symbolic functions defined in Sage. Since this patch adds new functions, the probability distribution, hence the result changes.

I attached a small patch to fix these doctests.



---

archive/issue_comments_012412.json:
```json
{
    "body": "Author: **Golam Mortuza Hossain**",
    "created_at": "2009-07-02T09:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12412",
    "user": "https://github.com/burcin"
}
```

Author: **Golam Mortuza Hossain**



---

archive/issue_comments_012413.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe second patch needs to be rebased. The following hunk fails, applying to my 4.1.rc0 branch:\n\n```\n--- random_tests.py\n+++ random_tests.py\n@@ -202,12 +202,11 @@\n\n         sage: from sage.symbolic.random_tests import *\n         sage: random_expr(50, nvars=3, coeff_generator=CDF.random_element)\n-        ceil(arctanh(-sinh(v2)/floor(-(0.615863165633 + 0.879368031485*I)*v1^2*v3) - gamma(pi) + floor(-(0.708874026302\n - 0.954135400334*I)*v3)))^sinh(arctan2(arcsinh((0.723896589334 + 0.799038508886*I)*(v2 + 0.913564344312 + 0.08980401603\n36*I)*v2), -1/v3)/(v3/v2 + 1.36062750308 - 1.05383406182*I))\n+        arctanh(sinh(-arcsech(v2)/floor(-(0.615863165633 + 0.879368031485*I)*v1^2*v3) - gamma(pi) + floor(-(0.708874026\n302 - 0.954135400334*I)*v3)))^arcsech(-cosh(-polylog((v2 + 0.913564344312 + 0.0898040160336*I)^(-(0.723896589334 - 0.799\n038508886*I)*v2),-v1 - v3))/sin(-(0.0263902659909 + 0.153261789843*I)*arctan2(pi, e^pi)))\n         sage: random_expr(5, verbose=True)\n-        About to apply sec to [1]\n-        About to apply exp to [sec(1)]\n-        About to apply <built-in function mul> to [e^sec(1), v1]\n-        v1*e^sec(1)\n+        About to apply <built-in function add> to [v1, v1]\n+        About to apply <built-in function div> to [-1/3, 2*v1]\n+        -1/6/v1\n     \"\"\"\n     vars = [(1.0, sage.calculus.calculus.var('v%d' % (n+1))) for n in range(nvars)]\n     if ncoeffs is None:\n```",
    "created_at": "2009-07-03T17:26:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12413",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:21" align="right">comment:21</div>

The second patch needs to be rebased. The following hunk fails, applying to my 4.1.rc0 branch:

```
--- random_tests.py
+++ random_tests.py
@@ -202,12 +202,11 @@

         sage: from sage.symbolic.random_tests import *
         sage: random_expr(50, nvars=3, coeff_generator=CDF.random_element)
-        ceil(arctanh(-sinh(v2)/floor(-(0.615863165633 + 0.879368031485*I)*v1^2*v3) - gamma(pi) + floor(-(0.708874026302
 - 0.954135400334*I)*v3)))^sinh(arctan2(arcsinh((0.723896589334 + 0.799038508886*I)*(v2 + 0.913564344312 + 0.08980401603
36*I)*v2), -1/v3)/(v3/v2 + 1.36062750308 - 1.05383406182*I))
+        arctanh(sinh(-arcsech(v2)/floor(-(0.615863165633 + 0.879368031485*I)*v1^2*v3) - gamma(pi) + floor(-(0.708874026
302 - 0.954135400334*I)*v3)))^arcsech(-cosh(-polylog((v2 + 0.913564344312 + 0.0898040160336*I)^(-(0.723896589334 - 0.799
038508886*I)*v2),-v1 - v3))/sin(-(0.0263902659909 + 0.153261789843*I)*arctan2(pi, e^pi)))
         sage: random_expr(5, verbose=True)
-        About to apply sec to [1]
-        About to apply exp to [sec(1)]
-        About to apply <built-in function mul> to [e^sec(1), v1]
-        v1*e^sec(1)
+        About to apply <built-in function add> to [v1, v1]
+        About to apply <built-in function div> to [-1/3, 2*v1]
+        -1/6/v1
     """
     vars = [(1.0, sage.calculus.calculus.var('v%d' % (n+1))) for n in range(nvars)]
     if ncoeffs is None:
```



---

archive/issue_events_025363.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-03T17:26:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25363"
}
```



---

archive/issue_events_025364.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-03T17:26:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25364"
}
```



---

archive/issue_comments_012414.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe second patch depends on #6421. Since #6421 was merged in 4.1.rc0, this can be applied without problems.\n\nSorry for the inconvenience.",
    "created_at": "2009-07-04T07:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12414",
    "user": "https://github.com/burcin"
}
```

<div id="comment:22" align="right">comment:22</div>

The second patch depends on #6421. Since #6421 was merged in 4.1.rc0, this can be applied without problems.

Sorry for the inconvenience.



---

archive/issue_events_025365.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-04T07:30:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25365"
}
```



---

archive/issue_events_025366.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-07-04T07:30:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25366"
}
```



---

archive/issue_events_025367.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T19:54:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25367"
}
```



---

archive/issue_events_025368.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T19:54:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2452#event-25368"
}
```



---

archive/issue_comments_012415.json:
```json
{
    "body": "Merged: **sage-4.1.rc0**",
    "created_at": "2009-07-04T19:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2452#issuecomment-12415",
    "user": "https://github.com/rlmill"
}
```

Merged: **sage-4.1.rc0**
