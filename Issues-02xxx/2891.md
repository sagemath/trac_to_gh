# Issue 2891: Don't use globals() to initialize InlineFortran

archive/issues_002891.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-cwitty"
    ],
    "body": "The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.\n\nCC:  @jdemeyer\n\nBranch/Commit: **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**\n\nReviewer: **Karl-Dieter Crisman**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/2891_\n\n",
    "closed_at": "2014-12-15T17:50:57Z",
    "created_at": "2008-04-12T03:14:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Don't use globals() to initialize InlineFortran",
    "type": "issue",
    "updated_at": "2014-12-15T17:50:57Z",
    "url": "https://github.com/sagemath/sage/issues/2891",
    "user": "https://github.com/williamstein"
}
```
The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.

CC:  @jdemeyer

Branch/Commit: **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**

Reviewer: **Karl-Dieter Crisman**

Author: **Jeroen Demeyer**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/2891_





---

archive/issue_events_030434.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:14:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30434"
}
```



---

archive/issue_events_030435.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:14:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30435"
}
```



---

archive/issue_events_030436.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:14:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30436"
}
```



---

archive/issue_events_030437.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:14:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30437"
}
```



---

archive/issue_events_030438.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2008-04-12T03:14:41Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30438"
}
```



---

archive/issue_events_030439.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30439"
}
```



---

archive/issue_events_030440.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-04-12T03:17:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30440"
}
```



---

archive/issue_comments_015066.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[inline_fortran.py.gz](https://github.com/sagemath/sage/files/ticket2891/inline_fortran.py.gz)**",
    "created_at": "2008-04-12T03:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15066",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[inline_fortran.py.gz](https://github.com/sagemath/sage/files/ticket2891/inline_fortran.py.gz)**



---

archive/issue_events_030441.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-12T12:45:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30441"
}
```



---

archive/issue_events_030442.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-12T12:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30442"
}
```



---

archive/issue_events_030443.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-04-12T12:46:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "title_is": "[with prototype, needs more work] inline_fortran -- completely rewrite to not save a global variable and *not* got hacked into various global structures all over",
    "title_was": "inline_fortran -- completely rewrite to not save a global variable and *not* got hacked into various global structures all over",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30443"
}
```



---

archive/issue_events_030444.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30444"
}
```



---

archive/issue_events_030445.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30445"
}
```



---

archive/issue_events_030446.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30446"
}
```



---

archive/issue_events_030447.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30447"
}
```



---

archive/issue_events_030448.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30448"
}
```



---

archive/issue_events_030449.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30449"
}
```



---

archive/issue_events_030450.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30450"
}
```



---

archive/issue_events_030451.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30451"
}
```



---

archive/issue_events_030452.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-09T16:17:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "title_is": "inline_fortran -- completely rewrite to not save a global variable and *not* got hacked into various global structures all over",
    "title_was": "[with prototype, needs more work] inline_fortran -- completely rewrite to not save a global variable and *not* got hacked into various global structures all over",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30452"
}
```



---

archive/issue_comments_015067.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHey Jeroen, you worked on several related tickets like #13992 and #13887 - is this ticket even needed at this point?  \n\n~~(Also, I can't figure out how exactly `src/sage/misc/inline_fortran.py` gets used, as it doesn't seem to ever be imported, and is only mentioned a comment in the scripts...)~~ The notebook is the only place this is used in any case (maybe also SMC?).  See also #8427.",
    "created_at": "2014-12-09T16:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15067",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

Hey Jeroen, you worked on several related tickets like #13992 and #13887 - is this ticket even needed at this point?  

~~(Also, I can't figure out how exactly `src/sage/misc/inline_fortran.py` gets used, as it doesn't seem to ever be imported, and is only mentioned a comment in the scripts...)~~ The notebook is the only place this is used in any case (maybe also SMC?).  See also #8427.



---

archive/issue_comments_015068.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@kcrisman](#comment%3A8):\n> Hey Jeroen, you worked on several related tickets like #13992 and #13887 - is this ticket even needed at this point?\n\nFor sure, the issue that this ticket talks about (the `globals` variable) hasn't been changed.",
    "created_at": "2014-12-09T17:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15068",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@kcrisman](#comment%3A8):
> Hey Jeroen, you worked on several related tickets like #13992 and #13887 - is this ticket even needed at this point?

For sure, the issue that this ticket talks about (the `globals` variable) hasn't been changed.



---

archive/issue_comments_015069.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n-The InlineFortran stuff in misc/inline_fortran.py is bad.  That global variable should be explicitly passed into the `__eval__` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.\n+The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.\n \n-Also, it's terrible the hacking in server/support.py to get the fortran stuff in there.  This is just really wrong. \n+Also, it's terrible the hacking in `sagenb` to get the fortran stuff in there.  This is just really wrong.\n \n NOTE -- this all works -- it's not a bug.  It's just not good programming. \n``````\n",
    "created_at": "2014-12-09T17:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15069",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
-The InlineFortran stuff in misc/inline_fortran.py is bad.  That global variable should be explicitly passed into the `__eval__` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.
+The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.
 
-Also, it's terrible the hacking in server/support.py to get the fortran stuff in there.  This is just really wrong. 
+Also, it's terrible the hacking in `sagenb` to get the fortran stuff in there.  This is just really wrong.
 
 NOTE -- this all works -- it's not a bug.  It's just not good programming. 
``````




---

archive/issue_comments_015070.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe problem is also that there isn't a single example using this `globals` argument, so it's hard to even know what the code *should* do.",
    "created_at": "2014-12-09T17:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15070",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

The problem is also that there isn't a single example using this `globals` argument, so it's hard to even know what the code *should* do.



---

archive/issue_comments_015071.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWe could probably remove this whole `inline_fortran` thing without anybody noticing...",
    "created_at": "2014-12-09T17:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15071",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

We could probably remove this whole `inline_fortran` thing without anybody noticing...



---

archive/issue_comments_015072.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIf you care, the `inline_fortran` stuff was added in Sage by\n\n```\ncommit d46359f9384268204bd687e2a7aaded15938399d\nAuthor: William Stein <wstein@gmail.com>\nDate:   Tue Jun 26 16:37:36 2007 -0700\n\n    (Josh Kantor and W Stein) Add support for %fortran in the notebook.\n\n```",
    "created_at": "2014-12-09T17:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15072",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

If you care, the `inline_fortran` stuff was added in Sage by

```
commit d46359f9384268204bd687e2a7aaded15938399d
Author: William Stein <wstein@gmail.com>
Date:   Tue Jun 26 16:37:36 2007 -0700

    (Josh Kantor and W Stein) Add support for %fortran in the notebook.

```



---

archive/issue_comments_015073.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> We could probably remove this whole `inline_fortran` thing without anybody noticing...\n\nI thought so too, but I figured out where it is used - in sagenb for `%fortran`.  As it says in the thing you quote, in fact.",
    "created_at": "2014-12-09T18:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15073",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:13" align="right">comment:13</div>

> We could probably remove this whole `inline_fortran` thing without anybody noticing...

I thought so too, but I figured out where it is used - in sagenb for `%fortran`.  As it says in the thing you quote, in fact.



---

archive/issue_events_030453.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-09T18:48:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "title_is": "Don't use globals() to initialize InlineFortran",
    "title_was": "inline_fortran -- completely rewrite to not save a global variable and *not* got hacked into various global structures all over",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30453"
}
```



---

archive/issue_events_030454.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-09T19:46:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30454"
}
```



---

archive/issue_events_030455.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-09T19:46:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30455"
}
```



---

archive/issue_comments_015074.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2014-12-09T19:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15074",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_015075.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n-The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.\n-\n-Also, it's terrible the hacking in `sagenb` to get the fortran stuff in there.  This is just really wrong.\n-\n-NOTE -- this all works -- it's not a bug.  It's just not good programming. \n+The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.\n``````\n",
    "created_at": "2014-12-09T19:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15075",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
-The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.   I've attached what the file *should* roughly be, but I can't get it to work.
-
-Also, it's terrible the hacking in `sagenb` to get the fortran stuff in there.  This is just really wrong.
-
-NOTE -- this all works -- it's not a bug.  It's just not good programming. 
+The `InlineFortran` stuff in `src/sage/misc/inline_fortran.py` is bad.  That `globals` variable should be explicitly passed into the `eval` and `__call__` methods, and should *not* be set on creation.
``````




---

archive/issue_comments_015076.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/2891](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/2891)**",
    "created_at": "2014-12-09T20:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15076",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/2891](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/2891)**



---

archive/issue_comments_015077.json:
```json
{
    "body": "Commit: **[`55e8f1e`](https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501)**",
    "created_at": "2014-12-09T20:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15077",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`55e8f1e`](https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501)**



---

archive/issue_comments_015078.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501\"><code>55e8f1e</code></a></td><td><code>Fix InlineFortran and import fortran() in global namespace</code></td></tr></table>\n",
    "created_at": "2014-12-09T20:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15078",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501"><code>55e8f1e</code></a></td><td><code>Fix InlineFortran and import fortran() in global namespace</code></td></tr></table>




---

archive/issue_comments_015079.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOverall looks good to me, but I would have to take some time to look at the details in a few instances, especially the \n\n```\n# Note that f2py() doesn't raise an exception if it fails.\n```\nbit and checking that the deprecations work.  The reorganization, importing, and removal of much of server/support.py is just fine.",
    "created_at": "2014-12-09T20:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15079",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

Overall looks good to me, but I would have to take some time to look at the details in a few instances, especially the 

```
# Note that f2py() doesn't raise an exception if it fails.
```
bit and checking that the deprecations work.  The reorganization, importing, and removal of much of server/support.py is just fine.



---

archive/issue_comments_015080.json:
```json
{
    "body": "Changed commit from **[`55e8f1e`](https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501)** to **[`8d36b44`](https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860)**",
    "created_at": "2014-12-09T21:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15080",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`55e8f1e`](https://github.com/sagemath/sagetrac-mirror/commit/55e8f1e6b84a90661d6e9f6e06a252e892b5f501)** to **[`8d36b44`](https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860)**



---

archive/issue_comments_015081.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860\"><code>8d36b44</code></a></td><td><code>Fix documentation</code></td></tr></table>\n",
    "created_at": "2014-12-09T21:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15081",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860"><code>8d36b44</code></a></td><td><code>Fix documentation</code></td></tr></table>




---

archive/issue_comments_015082.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7\"><code>15f151b</code></a></td><td><code>Allow doctests in sage/server</code></td></tr></table>\n",
    "created_at": "2014-12-12T10:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15082",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7"><code>15f151b</code></a></td><td><code>Allow doctests in sage/server</code></td></tr></table>




---

archive/issue_comments_015083.json:
```json
{
    "body": "Changed commit from **[`8d36b44`](https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860)** to **[`15f151b`](https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7)**",
    "created_at": "2014-12-12T10:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15083",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8d36b44`](https://github.com/sagemath/sagetrac-mirror/commit/8d36b44de3b3402fe9d68164d692ceabafc61860)** to **[`15f151b`](https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7)**



---

archive/issue_comments_015084.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm not sure why you removed the doctest file, since after you remove `sage/server/misc.py` there are no doctests left in that directory :-) but surely it can't hurt.\n\nHowever, this needs a slight bit of work to be compatible with https://github.com/sagemath/sagenb/pull/291 now in upstream.  Before:\n\n```\nsage: from sage.server.support import save_session\nsage: save_session()\nDeprecationWarning: \nImporting save_session from here is deprecated. If you need to use it, please import it directly from sagenb.misc.support\nSee http://trac.sagemath.org/2891 for details.\n\n```\nafter:\n\n```\nsage: from sage.server.support import save_session\nsage: save_session()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\nAttributeError: 'module' object has no attribute 'save_session'\n```\nand likewise for `load_session` and `variables`, I believe.",
    "created_at": "2014-12-12T16:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15084",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm not sure why you removed the doctest file, since after you remove `sage/server/misc.py` there are no doctests left in that directory :-) but surely it can't hurt.

However, this needs a slight bit of work to be compatible with https://github.com/sagemath/sagenb/pull/291 now in upstream.  Before:

```
sage: from sage.server.support import save_session
sage: save_session()
DeprecationWarning: 
Importing save_session from here is deprecated. If you need to use it, please import it directly from sagenb.misc.support
See http://trac.sagemath.org/2891 for details.

```
after:

```
sage: from sage.server.support import save_session
sage: save_session()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
AttributeError: 'module' object has no attribute 'save_session'
```
and likewise for `load_session` and `variables`, I believe.



---

archive/issue_comments_015085.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nGlad the deprecation works, but I don't know why this failed - and shouldn't your exception `imp` code take care of this if it wasn't there?\n\n```\nsage: fortran('fib1.f')\n/Users/.../sage/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py:23: DeprecationWarning: Calling fortran() with a filename is deprecated, use fortran(open(f).read) instead\nSee http://trac.sagemath.org/2891 for details.\n  return self.eval(*args, **kwds)\nsage: import numpy\nsage: a = numpy.array(range(10), dtype=float)\nsage: fib(a,10)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-5-a86fea2d23a9> in <module>()\n----> 1 fib(a,Integer(10))\n\nNameError: name 'fib' is not defined\nsage: \n```\n\nBut it did find the right file, if I do something else it complains a few lines later because it can't load the file, which makes sense.  If I use `globals` (wasn't that the deprecated part? maybe only elsewhere) I get\n\n```\n\nsage: fortran('./fib1.f',globals())\nsage: fib(a,10)  # so now it exists, anyway!\nsage: a = numpy.array(range(10), dtype=float)\nsage: a\narray([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])\n```\nI'm not saying 'needs work', but I am saying 'reviewer doesn't understand'.",
    "created_at": "2014-12-12T16:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15085",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">comment:22</div>

Glad the deprecation works, but I don't know why this failed - and shouldn't your exception `imp` code take care of this if it wasn't there?

```
sage: fortran('fib1.f')
/Users/.../sage/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py:23: DeprecationWarning: Calling fortran() with a filename is deprecated, use fortran(open(f).read) instead
See http://trac.sagemath.org/2891 for details.
  return self.eval(*args, **kwds)
sage: import numpy
sage: a = numpy.array(range(10), dtype=float)
sage: fib(a,10)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-5-a86fea2d23a9> in <module>()
----> 1 fib(a,Integer(10))

NameError: name 'fib' is not defined
sage: 
```

But it did find the right file, if I do something else it complains a few lines later because it can't load the file, which makes sense.  If I use `globals` (wasn't that the deprecated part? maybe only elsewhere) I get

```

sage: fortran('./fib1.f',globals())
sage: fib(a,10)  # so now it exists, anyway!
sage: a = numpy.array(range(10), dtype=float)
sage: a
array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
```
I'm not saying 'needs work', but I am saying 'reviewer doesn't understand'.



---

archive/issue_comments_015086.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nBut if I write the file in the other test\n\n```\nsage: fortran('./hello.f',globals())\n/Users/.../sage/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py:23: DeprecationWarning: Calling fortran() with a filename is deprecated, use fortran(open(f).read) instead\nSee http://trac.sagemath.org/2891 for details.\n  return self.eval(*args, **kwds)\nsage: hello\n<fortran object>\nsage: hello()\n Hello World!\n```",
    "created_at": "2014-12-12T16:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15086",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>

But if I write the file in the other test

```
sage: fortran('./hello.f',globals())
/Users/.../sage/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py:23: DeprecationWarning: Calling fortran() with a filename is deprecated, use fortran(open(f).read) instead
See http://trac.sagemath.org/2891 for details.
  return self.eval(*args, **kwds)
sage: hello
<fortran object>
sage: hello()
 Hello World!
```



---

archive/issue_comments_015087.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kcrisman](#comment%3A22):\n> If I use `globals`\n\nYes, that's what you should do.\n\n> wasn't that the deprecated part? maybe only elsewhere\n\nIndeed, elsewhere. The idea of this ticket is that the `globals` parameter was moved from `InlineFortran.__init__()` to `InlineFortran.__call__()`.",
    "created_at": "2014-12-12T18:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15087",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kcrisman](#comment%3A22):
> If I use `globals`

Yes, that's what you should do.

> wasn't that the deprecated part? maybe only elsewhere

Indeed, elsewhere. The idea of this ticket is that the `globals` parameter was moved from `InlineFortran.__init__()` to `InlineFortran.__call__()`.



---

archive/issue_comments_015088.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2014-12-12T19:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15088",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_events_030456.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-12T19:26:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30456"
}
```



---

archive/issue_events_030457.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-12T19:26:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30457"
}
```



---

archive/issue_comments_015089.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nGot it, I also see what I was messing up earlier.\n\nSo this is fine other than the import stuff in [comment:21](#comment%3A21), though one way to deal with that is to *not* remove those for now and deal with it when updating sagenb, e.g. #10057.",
    "created_at": "2014-12-12T19:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15089",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

Got it, I also see what I was messing up earlier.

So this is fine other than the import stuff in [comment:21](#comment%3A21), though one way to deal with that is to *not* remove those for now and deal with it when updating sagenb, e.g. #10057.



---

archive/issue_comments_015090.json:
```json
{
    "body": "Changed commit from **[`15f151b`](https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7)** to **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**",
    "created_at": "2014-12-13T07:37:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15090",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`15f151b`](https://github.com/sagemath/sagetrac-mirror/commit/15f151b9c695ec54662aef9974fe5d2fc40101f7)** to **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**



---

archive/issue_comments_015091.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9\"><code>af87443</code></a></td><td><code>Remove save_session, load_session, variables</code></td></tr></table>\n",
    "created_at": "2014-12-13T07:37:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15091",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9"><code>af87443</code></a></td><td><code>Remove save_session, load_session, variables</code></td></tr></table>




---

archive/issue_events_030458.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-13T07:38:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30458"
}
```



---

archive/issue_events_030459.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-13T07:38:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30459"
}
```



---

archive/issue_events_030460.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-13T17:09:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30460"
}
```



---

archive/issue_events_030461.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-13T17:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30461"
}
```



---

archive/issue_comments_015092.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/2891](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/2891)** to **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**",
    "created_at": "2014-12-15T17:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/2891#issuecomment-15092",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/2891](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/2891)** to **[`af87443`](https://github.com/sagemath/sagetrac-mirror/commit/af874432402ff79e9afc6240d6d5d06d362052e9)**



---

archive/issue_events_030462.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-15T17:50:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30462"
}
```



---

archive/issue_events_030463.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "62bf7065d0e1254a32edd911236221e072dfd30a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-12-15T17:50:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/2891",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/2891#event-30463"
}
```
