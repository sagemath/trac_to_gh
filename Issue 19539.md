# Issue 19539: Globally set -L library search path

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2015-12-24 10:22:06

CC:  ncohen jpflori fbissey




---

Comment by vbraun created at 2015-12-24 10:26:35

Changing component from PLEASE CHANGE to build.


---

Comment by vbraun created at 2015-12-24 10:26:35

Changing type from PLEASE CHANGE to defect.


---

Comment by git created at 2015-12-24 11:16:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-12-24 11:45:00

Changing status from new to needs_review.


---

Comment by leif created at 2015-12-24 13:19:18

Can we get rid of the `-Wl,-rpath,$SAGE_LOCAL/lib64`?  (Otherwise, we'd presumably have to add `-L$SAGE_LOCAL/lib64` for consistency as well, which on the other hand doesn't make sense on 32-bit systems.)

After all, `lib64` should be a symlink to `lib` (or the other way around), and we had tons of changes adding `--libdir=$SAGE_LOCAL/lib` to `configure` invocations a while ago.  Probably meanwhile some are missing again.


---

Comment by leif created at 2015-12-24 13:22:10

Changing keywords from "" to "LDFLAGS sage-env".


---

Comment by vbraun created at 2015-12-24 14:00:51

GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).

I thought about the symlink solution and I would prefer that, but it should go to another ticket.


---

Comment by leif created at 2015-12-24 14:05:58

Replying to [comment:9 vbraun]:
> GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).
> 
> I thought about the symlink solution and I would prefer that, but it should go to another ticket.

Ok.  Probably upon updating the GCC spkg... :P


---

Comment by ncohen created at 2015-12-24 16:23:50

I rebuilt Sage from scratch with this patch, and it does the job for me when building the latest release ended in a failure.

Thanks,

Nathann


---

Comment by vbraun created at 2015-12-24 23:48:35

Changing priority from major to blocker.


---

Comment by leif created at 2015-12-25 17:45:53

While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.


---

Comment by fbissey created at 2015-12-25 19:49:20

Replying to [comment:13 leif]:
> While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.

Well I don't use any of this mechanic to install sage-on-gentoo. I have a very simple `sage-env` that I ship in `/etc` but it is nowhere like the beast in vanilla. It just mirrors `sage/env.py`. On Gentoo prefix on the other hand I believe everything is wrapped to add the equivalent of your `LDFLAGS` and probably `CPATH` (for include path) but I am not sure of the details, I would have to dig - my own preference would be to wrap `ld` but I give hashdist a patch to insert a rpath in gcc's spec [this is highly platform dependent, I gave them x86_64 and arm but my OS X patch is not complete].

On `gcc` installing in `lib64`, hashdist's gcc doesn't. gcc on my prefix on a linux x86_64 machine doesn't.


---

Comment by vbraun created at 2015-12-25 20:57:49

Hashstack gcc.yaml does

```
  - name: link_lib64_to_lib
    after: install
    handler: bash
    bash: |
      # Create symbolic links from lib64/* to lib/
      cd ${ARTIFACT}/lib
      ln -s ../lib64/* .
```



---

Comment by git created at 2015-12-30 16:04:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vbraun created at 2016-01-04 17:31:02

bump


---

Comment by fbissey created at 2016-01-04 18:34:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-06 12:03:36

Resolution: fixed
