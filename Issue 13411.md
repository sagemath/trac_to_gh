# Issue 13411: Extend elliptic curve isogenies to arbitrary prime degrees

archive/issues_013411.json:
```json
{
    "body": "Assignee: John Cremona\n\nCC:  kimi @defeo\n\nKeywords: isogenies\n\nAs of Sage 5.4, we can compute l-isogenies of elliptic curves only for l=2,3,5,7,13 (the ones for which X_0(l) has genus 0), together with some \"sporadic\" degrees which can occur over QQ.\n\nIn this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13615\n\n",
    "created_at": "2012-10-18T09:48:43Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Extend elliptic curve isogenies to arbitrary prime degrees",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13411",
    "user": "https://github.com/JohnCremona"
}
```
Assignee: John Cremona

CC:  kimi @defeo

Keywords: isogenies

As of Sage 5.4, we can compute l-isogenies of elliptic curves only for l=2,3,5,7,13 (the ones for which X_0(l) has genus 0), together with some "sporadic" degrees which can occur over QQ.

In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.

Issue created by migration from https://trac.sagemath.org/ticket/13615





---

archive/issue_comments_164928.json:
```json
{
    "body": "I have two patches which are ready for testing.",
    "created_at": "2013-07-22T08:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164928",
    "user": "https://github.com/JohnCremona"
}
```

I have two patches which are ready for testing.



---

archive/issue_comments_164929.json:
```json
{
    "body": "Changing keywords from \"isogenies\" to \"isogenies, sd51\".",
    "created_at": "2013-07-22T08:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164929",
    "user": "https://github.com/JohnCremona"
}
```

Changing keywords from "isogenies" to "isogenies, sd51".



---

archive/issue_comments_164930.json:
```json
{
    "body": "# Files: \n\n1. ell_curve_isogeny_split.patch\n2. isogeny_genus_0.patch\n\n# Description:\n\n1. It splits the current \"ell_curve_isogeny.py\" to two files, namely \n    \"ell_curve_isogeny.py\" and \"isogeny_genus_0.py\".\n\n2. It adds new isogeny codes in \"isogeny_genus_0.py\", including:\n\n \u30fbl-isogeny computation using generic kernel polynomial for \n\u3000\u3000\u3000\u3000\u3000l = 11,17,19,23,29,31,41,47,59,71. (from ch.5 in Kimi's thesis)\n\n \u30fbl-isogeny computation using the l-division polynomial (from ch.3 in Kimi's thesis)\n\n# NOTE:\nPlease apply ell_curve_isogeny_split.patch first and \nthen apply isogeny_genus_0.patch.",
    "created_at": "2013-07-22T08:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164930",
    "user": "https://github.com/JohnCremona"
}
```

# Files: 

1. ell_curve_isogeny_split.patch
2. isogeny_genus_0.patch

# Description:

1. It splits the current "ell_curve_isogeny.py" to two files, namely 
    "ell_curve_isogeny.py" and "isogeny_genus_0.py".

2. It adds new isogeny codes in "isogeny_genus_0.py", including:

 ・l-isogeny computation using generic kernel polynomial for 
　　　　　l = 11,17,19,23,29,31,41,47,59,71. (from ch.5 in Kimi's thesis)

 ・l-isogeny computation using the l-division polynomial (from ch.3 in Kimi's thesis)

# NOTE:
Please apply ell_curve_isogeny_split.patch first and 
then apply isogeny_genus_0.patch.



---

archive/issue_comments_164931.json:
```json
{
    "body": "Attachment [isogeny_genus_0.patch](tarball://root/attachments/some-uuid/ticket13615/isogeny_genus_0.patch) by @JohnCremona created at 2013-07-22 08:52:47",
    "created_at": "2013-07-22T08:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164931",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [isogeny_genus_0.patch](tarball://root/attachments/some-uuid/ticket13615/isogeny_genus_0.patch) by @JohnCremona created at 2013-07-22 08:52:47



---

archive/issue_comments_164932.json:
```json
{
    "body": "The patches apply fine to version 5.11.beta3.  But there are some issues which need to be addressed:\n\n1. The references to John C and Jenny C need to be moved to the new file, and the header information on the new file needs to be completed with additional author, dates, etc. with a citation to Kimi's thesis for justification of all the formulae.\n\n2. Some new functions have no docstring, or no one-line summary:  `hyperelliptic_isogeny_data`,  `Psi2`.\n\n3. `least_semi_primitive` docstring missing an asterisk.\n\n4. The interface to the isogeny function from the elliptic curve class in `ell_field.py` needs to be updated, otherwise the new functionality will not be available to users!   This should include a new helper function in `isogenies_genus_0` which makes the decision about which of the three functions to call.   It will also be necessary to disable the code which allows for an empty list of primes to be given, since we can now handle *all* primes with the sole exception of the characteristic.",
    "created_at": "2013-07-22T15:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164932",
    "user": "https://github.com/JohnCremona"
}
```

The patches apply fine to version 5.11.beta3.  But there are some issues which need to be addressed:

1. The references to John C and Jenny C need to be moved to the new file, and the header information on the new file needs to be completed with additional author, dates, etc. with a citation to Kimi's thesis for justification of all the formulae.

2. Some new functions have no docstring, or no one-line summary:  `hyperelliptic_isogeny_data`,  `Psi2`.

3. `least_semi_primitive` docstring missing an asterisk.

4. The interface to the isogeny function from the elliptic curve class in `ell_field.py` needs to be updated, otherwise the new functionality will not be available to users!   This should include a new helper function in `isogenies_genus_0` which makes the decision about which of the three functions to call.   It will also be necessary to disable the code which allows for an empty list of primes to be given, since we can now handle *all* primes with the sole exception of the characteristic.



---

archive/issue_comments_164933.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-22T15:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164933",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164934.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-22T15:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164934",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164935.json:
```json
{
    "body": "Replying to [comment:7 cremona]:\nI am starting to work on the points listed above.",
    "created_at": "2013-07-25T14:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164935",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:7 cremona]:
I am starting to work on the points listed above.



---

archive/issue_comments_164936.json:
```json
{
    "body": "Attachment [trac_13615_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_review.patch) by @JohnCremona created at 2013-07-26 11:13:49\n\nApply after previous patches",
    "created_at": "2013-07-26T11:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164936",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_13615_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_review.patch) by @JohnCremona created at 2013-07-26 11:13:49

Apply after previous patches



---

archive/issue_events_037963.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-26T11:15:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13411#event-37963"
}
```



---

archive/issue_comments_164937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-26T11:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164937",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164938.json:
```json
{
    "body": "Nice work! I'm reviewing the patch, but of all the new functions in `isogeny_genus_0.py` the only one I could understand is `isogenies_prime_degree_general()`.\n\nI can't seem to find Kimi's thesis online. Could you put it somewhere, so that we can compare with the theory? Also, it would be nice if the docstrings of the new functions pointed to the corresponding sections in Kimi's thesis (assuming that's the only source).\n\nHere's more thoughts:\n\n- It seems weird that `isogenies_prime_degree_general()` is in `isogeny_genus_0.py`. Why is it not in `ell_curve_isogeny.py()` or in some other *generic* place?\n\n- `least_semi_primitive()` is a purely internal function, I would rename it to `_least_semi_primitive()`. \n\n- In the docstring of `least_semi_primitive()`, the `{1,-1}` should be `\\{1,-1\\}` (although this is not very important if you follow my previous suggestion).",
    "created_at": "2013-08-21T18:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164938",
    "user": "https://github.com/defeo"
}
```

Nice work! I'm reviewing the patch, but of all the new functions in `isogeny_genus_0.py` the only one I could understand is `isogenies_prime_degree_general()`.

I can't seem to find Kimi's thesis online. Could you put it somewhere, so that we can compare with the theory? Also, it would be nice if the docstrings of the new functions pointed to the corresponding sections in Kimi's thesis (assuming that's the only source).

Here's more thoughts:

- It seems weird that `isogenies_prime_degree_general()` is in `isogeny_genus_0.py`. Why is it not in `ell_curve_isogeny.py()` or in some other *generic* place?

- `least_semi_primitive()` is a purely internal function, I would rename it to `_least_semi_primitive()`. 

- In the docstring of `least_semi_primitive()`, the `{1,-1}` should be `\{1,-1\}` (although this is not very important if you follow my previous suggestion).



---

archive/issue_comments_164939.json:
```json
{
    "body": "I have put the thesis at http://homepages.warwick.ac.uk/staff/J.E.Cremona/theses/tsukazaki.pdf\nsince it has not appeared on Warwick's official repository (but was approved in July 2013).\n\nI agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the \"general\" one belongs in the other file.\n\n`least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.\n\nI am about to go on holiday, but feel free to ask more questions if you don't mind a little delay.",
    "created_at": "2013-08-21T19:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164939",
    "user": "https://github.com/JohnCremona"
}
```

I have put the thesis at http://homepages.warwick.ac.uk/staff/J.E.Cremona/theses/tsukazaki.pdf
since it has not appeared on Warwick's official repository (but was approved in July 2013).

I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the "general" one belongs in the other file.

`least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.

I am about to go on holiday, but feel free to ask more questions if you don't mind a little delay.



---

archive/issue_comments_164940.json:
```json
{
    "body": "Thanks for the link, and congratulations to Kimi. I quickly read it through. I obviously didn't check line by line, but no doubt that you got the maths and the coding right. So, I'm ready to give a positive review.\n\n> I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the \"general\" one belongs in the other file.\n\nI agree, it is best to keep specific algorithms separate from the isogeny class. On second thought, all the algorithms in that file have something in common: they are generic algorithms only practical for small prime degrees (as you suggest in the title of the doc page). Maybe it's just the filename that needs to be changed. What about `isogenies_small_degree.py`?\n\n> `least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.\n\nI had the same feeling about the variable `isog_table` and the function `hyperelliptic_isogeny_data`. Hence, I renamed all the three by adding an underscore in front of them.\n\nI also \n\n- Edited the copyright banner by adding your names\n- Fixed the docstring of `_least_semi_primitive()`\n- Added `ALGORITHM::` sections to some functions, pointing to the relevant chapter in Kimi's thesis.\n\nI'm attaching my reviewer's patch. I'm working with the git repo, and I'm confused by this directory renaming stuff, so I guess it'll be easier if I link to my git branch on trac.\n\nI'm not giving a positive review right away, so that you can review my patch, and give your opinion on renaming the file. Enjoy vacation!",
    "created_at": "2013-08-22T18:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164940",
    "user": "https://github.com/defeo"
}
```

Thanks for the link, and congratulations to Kimi. I quickly read it through. I obviously didn't check line by line, but no doubt that you got the maths and the coding right. So, I'm ready to give a positive review.

> I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the "general" one belongs in the other file.

I agree, it is best to keep specific algorithms separate from the isogeny class. On second thought, all the algorithms in that file have something in common: they are generic algorithms only practical for small prime degrees (as you suggest in the title of the doc page). Maybe it's just the filename that needs to be changed. What about `isogenies_small_degree.py`?

> `least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.

I had the same feeling about the variable `isog_table` and the function `hyperelliptic_isogeny_data`. Hence, I renamed all the three by adding an underscore in front of them.

I also 

- Edited the copyright banner by adding your names
- Fixed the docstring of `_least_semi_primitive()`
- Added `ALGORITHM::` sections to some functions, pointing to the relevant chapter in Kimi's thesis.

I'm attaching my reviewer's patch. I'm working with the git repo, and I'm confused by this directory renaming stuff, so I guess it'll be easier if I link to my git branch on trac.

I'm not giving a positive review right away, so that you can review my patch, and give your opinion on renaming the file. Enjoy vacation!



---

archive/issue_comments_164941.json:
```json
{
    "body": "reviewer patch",
    "created_at": "2013-08-28T16:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164941",
    "user": "https://github.com/defeo"
}
```

reviewer patch



---

archive/issue_comments_164942.json:
```json
{
    "body": "Attachment [trac_13615_second_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_second_review.patch) by @defeo created at 2013-08-28 16:22:39\n\nFound the time to make a mercurial patch.\n\nApply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b",
    "created_at": "2013-08-28T16:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164942",
    "user": "https://github.com/defeo"
}
```

Attachment [trac_13615_second_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_second_review.patch) by @defeo created at 2013-08-28 16:22:39

Found the time to make a mercurial patch.

Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​



---

archive/issue_comments_164943.json:
```json
{
    "body": "Thanks a lot for making your changes in to a mercurial patch.  Looking at it reminded me that I had always intended to remove the global (to the module) isog_table anyway, replacing it with a function as we did for the hyperelliptic_isogeny_data which plays a rather similar role.  IN addition this meanse that instaed of having these mysterious numbers in there, I can put in a function which by default returns stored values, but can also compute them on the fly, which then (1) allowed doctesting and (2) makes it clearer where they come from (currently this is partially done in an extended comment).  The result will be something like the (cached) function Psi(l, use_stored=True) which was converted to this form when someone noticed that this file contributed a non-negligible amount to Sage's startup time.  I will do that tomorrow.",
    "created_at": "2013-09-03T15:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164943",
    "user": "https://github.com/JohnCremona"
}
```

Thanks a lot for making your changes in to a mercurial patch.  Looking at it reminded me that I had always intended to remove the global (to the module) isog_table anyway, replacing it with a function as we did for the hyperelliptic_isogeny_data which plays a rather similar role.  IN addition this meanse that instaed of having these mysterious numbers in there, I can put in a function which by default returns stored values, but can also compute them on the fly, which then (1) allowed doctesting and (2) makes it clearer where they come from (currently this is partially done in an extended comment).  The result will be something like the (cached) function Psi(l, use_stored=True) which was converted to this form when someone noticed that this file contributed a non-negligible amount to Sage's startup time.  I will do that tomorrow.



---

archive/issue_comments_164944.json:
```json
{
    "body": "Excellent! I should have time to review it before the end of the week.\n\nNote that the patches do not apply anymore, according to patchbot.",
    "created_at": "2013-09-03T16:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164944",
    "user": "https://github.com/defeo"
}
```

Excellent! I should have time to review it before the end of the week.

Note that the patches do not apply anymore, according to patchbot.



---

archive/issue_comments_164945.json:
```json
{
    "body": "Apply after all previous patches",
    "created_at": "2013-09-04T10:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164945",
    "user": "https://github.com/JohnCremona"
}
```

Apply after all previous patches



---

archive/issue_comments_164946.json:
```json
{
    "body": "Attachment [trac_13615_extra.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_extra.patch) by @JohnCremona created at 2013-09-04 10:57:00\n\nI had no trouble in applying the 4 patches to 5.12.beta4.  The additional patch does what I said before, i.e. replaces the global dict called _isog_table with a function _sporadic_Q_data which by default returns precomputed data, but can also compute it from scratch.  The function has a test (which only takes 2 seconds to run) which checks that the computed and stored values are the same for all 11 possible inputs.\n\nI think we have now done everything mentioned above, except for possibly changing the name of the new file from isogeny_genus_0 to isogeny_small_degree.  If you want that, I can change my patch to do that too.  \n\nI am just running a full test...done.",
    "created_at": "2013-09-04T10:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164946",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_13615_extra.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_extra.patch) by @JohnCremona created at 2013-09-04 10:57:00

I had no trouble in applying the 4 patches to 5.12.beta4.  The additional patch does what I said before, i.e. replaces the global dict called _isog_table with a function _sporadic_Q_data which by default returns precomputed data, but can also compute it from scratch.  The function has a test (which only takes 2 seconds to run) which checks that the computed and stored values are the same for all 11 possible inputs.

I think we have now done everything mentioned above, except for possibly changing the name of the new file from isogeny_genus_0 to isogeny_small_degree.  If you want that, I can change my patch to do that too.  

I am just running a full test...done.



---

archive/issue_comments_164947.json:
```json
{
    "body": "Just doctested with `--all --long`. Everything looks ok.\n\nThe patchbot is still skipping my patch, so I guess it won't be able to apply.\n\nMaybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?",
    "created_at": "2013-09-04T13:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164947",
    "user": "https://github.com/defeo"
}
```

Just doctested with `--all --long`. Everything looks ok.

The patchbot is still skipping my patch, so I guess it won't be able to apply.

Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?



---

archive/issue_comments_164948.json:
```json
{
    "body": "Replying to [comment:17 defeo]:\n> Just doctested with `--all --long`. Everything looks ok.\n> \n> The patchbot is still skipping my patch, so I guess it won't be able to apply.\n> \n> Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?\n\nOK, I will do that.  Watch this space.",
    "created_at": "2013-09-04T13:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164948",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:17 defeo]:
> Just doctested with `--all --long`. Everything looks ok.
> 
> The patchbot is still skipping my patch, so I guess it won't be able to apply.
> 
> Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?

OK, I will do that.  Watch this space.



---

archive/issue_comments_164949.json:
```json
{
    "body": "The new patch trac_13615_combined.patch combines all thre previous patches into one, which applies to 5.12.beta4.  The only additional difference is that the new file which was called isogeny_genus_0.py is now  classed isogeny_small_degree.py.\n\nReady for a final review!",
    "created_at": "2013-09-04T13:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164949",
    "user": "https://github.com/JohnCremona"
}
```

The new patch trac_13615_combined.patch combines all thre previous patches into one, which applies to 5.12.beta4.  The only additional difference is that the new file which was called isogeny_genus_0.py is now  classed isogeny_small_degree.py.

Ready for a final review!



---

archive/issue_comments_164950.json:
```json
{
    "body": "Attachment [trac_13615_3rd_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_3rd_review.patch) by @defeo created at 2013-09-04 14:32:25",
    "created_at": "2013-09-04T14:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164950",
    "user": "https://github.com/defeo"
}
```

Attachment [trac_13615_3rd_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_3rd_review.patch) by @defeo created at 2013-09-04 14:32:25



---

archive/issue_comments_164951.json:
```json
{
    "body": "Here's one more review. I've corrected a few spelling mistakes, and modified `isogenies_sporadic_Q` to be slightly more readable and pythonic.\n\nIt is good to go for me. Feel free to give positive review if you accept my reviewer patch.\n\nApply only: trac_13615_combined.patch, trac_13615_3rd_review.patch",
    "created_at": "2013-09-04T14:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164951",
    "user": "https://github.com/defeo"
}
```

Here's one more review. I've corrected a few spelling mistakes, and modified `isogenies_sporadic_Q` to be slightly more readable and pythonic.

It is good to go for me. Feel free to give positive review if you accept my reviewer patch.

Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch



---

archive/issue_comments_164952.json:
```json
{
    "body": "You have done rather more than that in your second change.  Yes, it looks neater;  but I have used the knowledge that isogenies of these degrees exist if and only if the j-invariant is one of the known values.  On the other hand, the _sporadic_Q_data function will quickly determine whichm if any, of these apply.  I still feel something has been lost though:  at most one of these l values gives an isogeny, but your core will try them all.",
    "created_at": "2013-09-04T14:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164952",
    "user": "https://github.com/JohnCremona"
}
```

You have done rather more than that in your second change.  Yes, it looks neater;  but I have used the knowledge that isogenies of these degrees exist if and only if the j-invariant is one of the known values.  On the other hand, the _sporadic_Q_data function will quickly determine whichm if any, of these apply.  I still feel something has been lost though:  at most one of these l values gives an isogeny, but your core will try them all.



---

archive/issue_comments_164953.json:
```json
{
    "body": "Yes, definitely. But,\n\n1. These j-invariants are big numbers, hard to compare visually. Before your last patch they used to be only in one place: `_isog_table`, after they were replicated in `_sporadic_Q_data` **and** `isogenies_sporadic_Q`, making it harder to verify that you did not leave out some j by mistake.\n\n2. Efficiency-wise, your code does 11 + 11 equality tests in `QQ`, mine does 11 * 11. An equality test in `QQ` takes ~3\u03bcs on my laptop, and indeed testing `isogenies_sporadic_Q` I get a ~300\u03bcs slowdown for a curve which has no isogeny (and thus goes through all tests). That's a serious penalty (about 10x) for a curve which has no isogeny, but it's negligible for a sporadic curve (where it takes in the order of milliseconds to return the isogeny). Do we really care?",
    "created_at": "2013-09-04T15:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164953",
    "user": "https://github.com/defeo"
}
```

Yes, definitely. But,

1. These j-invariants are big numbers, hard to compare visually. Before your last patch they used to be only in one place: `_isog_table`, after they were replicated in `_sporadic_Q_data` **and** `isogenies_sporadic_Q`, making it harder to verify that you did not leave out some j by mistake.

2. Efficiency-wise, your code does 11 + 11 equality tests in `QQ`, mine does 11 * 11. An equality test in `QQ` takes ~3μs on my laptop, and indeed testing `isogenies_sporadic_Q` I get a ~300μs slowdown for a curve which has no isogeny (and thus goes through all tests). That's a serious penalty (about 10x) for a curve which has no isogeny, but it's negligible for a sporadic curve (where it takes in the order of milliseconds to return the isogeny). Do we really care?



---

archive/issue_comments_164954.json:
```json
{
    "body": "Changing keywords from \"isogenies, sd51\" to \"isogenies, sd51, sd52\".",
    "created_at": "2013-09-04T15:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164954",
    "user": "https://github.com/defeo"
}
```

Changing keywords from "isogenies, sd51" to "isogenies, sd51, sd52".



---

archive/issue_comments_164955.json:
```json
{
    "body": "I definitely agree that there should be only one place where this finite list of exceptional pairs is listed!  One advantage of the old dict was that one could easily check whether (l,j) was in isog_table.keys(), and perhaps that list should still exist somewhere, and used in the function _sporadic_data_Q instead of what I do now.\n\nYou have certainly done a thorough job checking the timings!  Of course, curves which are not sporadic are the vast majority (and I use this code on files with many thousands of curves) so I would like to eliminate them from consideration as soon as possible.\n\nHere's one possible plan:  have a global dict with 11 entries, the keys are the sporadic j-invariants and the vales are the associated primes l.   Then _sporadic_data_Q can check if the j-invariant is a key and return what it does now if so, while isogenies_sporadic_Q can also use the same dict.  If you like that, I will do it.",
    "created_at": "2013-09-04T15:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164955",
    "user": "https://github.com/JohnCremona"
}
```

I definitely agree that there should be only one place where this finite list of exceptional pairs is listed!  One advantage of the old dict was that one could easily check whether (l,j) was in isog_table.keys(), and perhaps that list should still exist somewhere, and used in the function _sporadic_data_Q instead of what I do now.

You have certainly done a thorough job checking the timings!  Of course, curves which are not sporadic are the vast majority (and I use this code on files with many thousands of curves) so I would like to eliminate them from consideration as soon as possible.

Here's one possible plan:  have a global dict with 11 entries, the keys are the sporadic j-invariants and the vales are the associated primes l.   Then _sporadic_data_Q can check if the j-invariant is a key and return what it does now if so, while isogenies_sporadic_Q can also use the same dict.  If you like that, I will do it.



---

archive/issue_comments_164956.json:
```json
{
    "body": "If it's sheer speed you're looking after, you should revert to the old code. The time for `isogenies_sporadic_Q` on a non-sporadic curve has gone up from ~4\u03bcs before this ticket, to ~35\u03bcs after your patch (to ~340\u03bcs after mine).\n\nEither you can keep the old `_isog_table` and implement `_sporadic_Q_data` just for test purposes (and why not make doctests #optional, in that case), or, if you want to improve startup time, you make `_sporadic_Q_data` return the whole dictionary, and apply the ``@`cached_function` decorator to it.",
    "created_at": "2013-09-04T16:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164956",
    "user": "https://github.com/defeo"
}
```

If it's sheer speed you're looking after, you should revert to the old code. The time for `isogenies_sporadic_Q` on a non-sporadic curve has gone up from ~4μs before this ticket, to ~35μs after your patch (to ~340μs after mine).

Either you can keep the old `_isog_table` and implement `_sporadic_Q_data` just for test purposes (and why not make doctests #optional, in that case), or, if you want to improve startup time, you make `_sporadic_Q_data` return the whole dictionary, and apply the ``@`cached_function` decorator to it.



---

archive/issue_comments_164957.json:
```json
{
    "body": "Attachment [trac_13615_combined.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_combined.patch) by @JohnCremona created at 2013-09-04 16:29:33\n\nReplaces all previous patches",
    "created_at": "2013-09-04T16:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164957",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_13615_combined.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_combined.patch) by @JohnCremona created at 2013-09-04 16:29:33

Replaces all previous patches



---

archive/issue_comments_164958.json:
```json
{
    "body": "I have repalced my combined patch with one which corrects the typo you found and implements an alternative solution to the problem you noted.  Back to you!",
    "created_at": "2013-09-04T16:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164958",
    "user": "https://github.com/JohnCremona"
}
```

I have repalced my combined patch with one which corrects the typo you found and implements an alternative solution to the problem you noted.  Back to you!



---

archive/issue_comments_164959.json:
```json
{
    "body": "I did not notive your last comment until I had posted mine (and the new patch), but I have had enough on this for today...",
    "created_at": "2013-09-04T16:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164959",
    "user": "https://github.com/JohnCremona"
}
```

I did not notive your last comment until I had posted mine (and the new patch), but I have had enough on this for today...



---

archive/issue_comments_164960.json:
```json
{
    "body": "Attachment [trac_13615_combined_4th_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_combined_4th_review.patch) by @defeo created at 2013-09-06 23:15:03\n\nApply only: trac_13615_combined_4th_review.patch\u200b \n\n`_sporadic_Q_data` takes less than 1/2 a second to compute its output from scratch for any j-invariant. I see no reason not to compute the data on the fly and store it with ``@`cached_function`\n\nThis new patch removes the precomputed data from the code (most of it is moved in the doctest), and makes `_sporadic_Q_data` a cached function. `isogeny_sporadic_Q` now tests its input against a dictionary mapping j-invariants to degrees, and is thus much faster on non-sporadic curves.\n\nHere is the timings I get on my laptop.\n\n\n```\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import sporadic_j, _sporadic_Q_data\nsage: for j in sporadic_j.keys():\n....:    timeit('_sporadic_Q_data(j)', globals=globals().update({'j':j}), number=1, repeat=1)\n1 loops, best of 1: 167 ms per loop\n1 loops, best of 1: 71.2 ms per loop\n1 loops, best of 1: 400 ms per loop\n1 loops, best of 1: 69.1 ms per loop\n1 loops, best of 1: 59.7 ms per loop\n1 loops, best of 1: 110 ms per loop\n1 loops, best of 1: 139 ms per loop\n1 loops, best of 1: 64.8 ms per loop\n1 loops, best of 1: 107 ms per loop\n1 loops, best of 1: 113 ms per loop\n1 loops, best of 1: 66.9 ms per loop\n\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_sporadic_Q\nsage: E = EllipticCurve(j=QQ.random_element())\nsage: timeit('isogenies_sporadic_Q(E)', globals=globals())\n625 loops, best of 3: 1.1 \u00b5s per loop\n```\n\n\nWhat do you think of it?",
    "created_at": "2013-09-06T23:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164960",
    "user": "https://github.com/defeo"
}
```

Attachment [trac_13615_combined_4th_review.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_combined_4th_review.patch) by @defeo created at 2013-09-06 23:15:03

Apply only: trac_13615_combined_4th_review.patch​ 

`_sporadic_Q_data` takes less than 1/2 a second to compute its output from scratch for any j-invariant. I see no reason not to compute the data on the fly and store it with ``@`cached_function`

This new patch removes the precomputed data from the code (most of it is moved in the doctest), and makes `_sporadic_Q_data` a cached function. `isogeny_sporadic_Q` now tests its input against a dictionary mapping j-invariants to degrees, and is thus much faster on non-sporadic curves.

Here is the timings I get on my laptop.


```
sage: from sage.schemes.elliptic_curves.isogeny_small_degree import sporadic_j, _sporadic_Q_data
sage: for j in sporadic_j.keys():
....:    timeit('_sporadic_Q_data(j)', globals=globals().update({'j':j}), number=1, repeat=1)
1 loops, best of 1: 167 ms per loop
1 loops, best of 1: 71.2 ms per loop
1 loops, best of 1: 400 ms per loop
1 loops, best of 1: 69.1 ms per loop
1 loops, best of 1: 59.7 ms per loop
1 loops, best of 1: 110 ms per loop
1 loops, best of 1: 139 ms per loop
1 loops, best of 1: 64.8 ms per loop
1 loops, best of 1: 107 ms per loop
1 loops, best of 1: 113 ms per loop
1 loops, best of 1: 66.9 ms per loop

sage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_sporadic_Q
sage: E = EllipticCurve(j=QQ.random_element())
sage: timeit('isogenies_sporadic_Q(E)', globals=globals())
625 loops, best of 3: 1.1 µs per loop
```


What do you think of it?



---

archive/issue_comments_164961.json:
```json
{
    "body": "Apply only: trac_13615_combined_4th_review.patch\u200b",
    "created_at": "2013-09-06T23:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164961",
    "user": "https://github.com/defeo"
}
```

Apply only: trac_13615_combined_4th_review.patch​



---

archive/issue_comments_164962.json:
```json
{
    "body": "Thanks a lot for your work on this.  I'll look at it properly as soon as I can.  \n\nSome explanation:  I generally prefer to do things algebraically,  and when I first coded these `_sporadic_Q_data` things about 4 years ago, I did so algebraically, except for the 163 case for which which that was impractical.  When I started to write the function a few days ago, which returned precomputed data by default but also could do the computations on the fly, I also went for the algebraic approach for the first few (which is very quick for 11, 17, 19), but then for simplicity decided that if any were to be computed via floating point then they all could be.  Precision issues were easy to deal with, since we already knew the correct result, so I just did some experimentation to determine how much precision was required to get it right in each case.   And as you just observed, the result is so quick in every case that having the precomputed values stored is no longer necessary!  I still like the idea of preserving the \"correct\" data in doctests, though they do take up quite a few lines in the file.",
    "created_at": "2013-09-07T13:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164962",
    "user": "https://github.com/JohnCremona"
}
```

Thanks a lot for your work on this.  I'll look at it properly as soon as I can.  

Some explanation:  I generally prefer to do things algebraically,  and when I first coded these `_sporadic_Q_data` things about 4 years ago, I did so algebraically, except for the 163 case for which which that was impractical.  When I started to write the function a few days ago, which returned precomputed data by default but also could do the computations on the fly, I also went for the algebraic approach for the first few (which is very quick for 11, 17, 19), but then for simplicity decided that if any were to be computed via floating point then they all could be.  Precision issues were easy to deal with, since we already knew the correct result, so I just did some experimentation to determine how much precision was required to get it right in each case.   And as you just observed, the result is so quick in every case that having the precomputed values stored is no longer necessary!  I still like the idea of preserving the "correct" data in doctests, though they do take up quite a few lines in the file.



---

archive/issue_comments_164963.json:
```json
{
    "body": "I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.",
    "created_at": "2013-09-07T13:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164963",
    "user": "https://github.com/defeo"
}
```

I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.



---

archive/issue_comments_164964.json:
```json
{
    "body": "Replying to [comment:32 defeo]:\n> I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.\nIt isn't necessary, as any test which computes a 163-isogeny from an elliptic curve with that invariant will implicitly check that the output is correct.",
    "created_at": "2013-09-07T14:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164964",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:32 defeo]:
> I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.
It isn't necessary, as any test which computes a 163-isogeny from an elliptic curve with that invariant will implicitly check that the output is correct.



---

archive/issue_comments_164965.json:
```json
{
    "body": "I'm just investigating this:\n\n```\nFile \"sage/schemes/elliptic_curves/ell_rational_field.py\", line 4191, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.reduction.isogenies_prime_degree\nFailed example:\n    E.isogenies_prime_degree(4) \nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: 4 is not prime.\nGot:\n    []\n```\n\nPreviously the function `isogenies_sporadic_Q` checked that l is primes before tesing to see if (l,j) is in the list.  Now we don't.  But I think that this is fair, since by definition there are no sporadic l-isogenies if l is not prime.  So I am moving the (pseudo-)primality test for l into `ell_rational_field` where the failing doctest is.",
    "created_at": "2013-09-07T14:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164965",
    "user": "https://github.com/JohnCremona"
}
```

I'm just investigating this:

```
File "sage/schemes/elliptic_curves/ell_rational_field.py", line 4191, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.reduction.isogenies_prime_degree
Failed example:
    E.isogenies_prime_degree(4) 
Expected:
    Traceback (most recent call last):
    ...
    ValueError: 4 is not prime.
Got:
    []
```

Previously the function `isogenies_sporadic_Q` checked that l is primes before tesing to see if (l,j) is in the list.  Now we don't.  But I think that this is fair, since by definition there are no sporadic l-isogenies if l is not prime.  So I am moving the (pseudo-)primality test for l into `ell_rational_field` where the failing doctest is.



---

archive/issue_comments_164966.json:
```json
{
    "body": "My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.",
    "created_at": "2013-09-07T14:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164966",
    "user": "https://github.com/defeo"
}
```

My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.



---

archive/issue_comments_164967.json:
```json
{
    "body": "Replying to [comment:35 defeo]:\n> My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.\nNo problem.  I'm about to upload a small addition patch for this.",
    "created_at": "2013-09-07T14:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164967",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:35 defeo]:
> My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.
No problem.  I'm about to upload a small addition patch for this.



---

archive/issue_comments_164968.json:
```json
{
    "body": "Done.  It's slightly better than before since now `E.isogenies_prime_degree(\"rubbish\")` calmly raises an error saying that \"rubbish\" is no prime, rather than an error saying that strings do not have an `is_prime` attribute.  (But I did not add another doctest for that.)\n\nSince I am happy with your other reviewer changes, if you agree with this latest one then I think you can set this to positive review.",
    "created_at": "2013-09-07T14:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164968",
    "user": "https://github.com/JohnCremona"
}
```

Done.  It's slightly better than before since now `E.isogenies_prime_degree("rubbish")` calmly raises an error saying that "rubbish" is no prime, rather than an error saying that strings do not have an `is_prime` attribute.  (But I did not add another doctest for that.)

Since I am happy with your other reviewer changes, if you agree with this latest one then I think you can set this to positive review.



---

archive/issue_comments_164969.json:
```json
{
    "body": "Looks ok to me. Good job.",
    "created_at": "2013-09-07T14:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164969",
    "user": "https://github.com/defeo"
}
```

Looks ok to me. Good job.



---

archive/issue_comments_164970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-07T14:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164970",
    "user": "https://github.com/defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164971.json:
```json
{
    "body": "Apply only: trac_13615_combined_4th_review.patch\u200b, trac_13615_fix.patch\u200b",
    "created_at": "2013-09-07T14:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164971",
    "user": "https://github.com/defeo"
}
```

Apply only: trac_13615_combined_4th_review.patch​, trac_13615_fix.patch​



---

archive/issue_comments_164972.json:
```json
{
    "body": "Replying to [comment:38 defeo]:\n> Looks ok to me. Good job.\nThanks -- and a good case of thorough and constructive reviewing!  Sorry about /d/D/.",
    "created_at": "2013-09-07T14:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164972",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:38 defeo]:
> Looks ok to me. Good job.
Thanks -- and a good case of thorough and constructive reviewing!  Sorry about /d/D/.



---

archive/issue_comments_164973.json:
```json
{
    "body": "Patchbot is still not getting it. I don't know what else to do!\n\nApply trac_13615_combined_4th_review.patch\u200b\n\nApply trac_13615_fix.patch\u200b",
    "created_at": "2013-09-07T15:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164973",
    "user": "https://github.com/defeo"
}
```

Patchbot is still not getting it. I don't know what else to do!

Apply trac_13615_combined_4th_review.patch​

Apply trac_13615_fix.patch​



---

archive/issue_comments_164974.json:
```json
{
    "body": "I changed the formatting of the patching instructions.  Perhaps that will work.",
    "created_at": "2013-09-07T17:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164974",
    "user": "https://github.com/JohnCremona"
}
```

I changed the formatting of the patching instructions.  Perhaps that will work.



---

archive/issue_events_037964.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13411#event-37964"
}
```



---

archive/issue_events_037965.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13411#event-37965"
}
```



---

archive/issue_comments_164975.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-09-29T16:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164975",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164976.json:
```json
{
    "body": "There are problems while building the documentation:\n\n```\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_general:15: WARNING: Literal block expected; none found.\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_0:22: WARNING: Literal block expected; none found.\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_plus_0:21: WARNING: Literal block expected; none found.\n```\n",
    "created_at": "2013-09-29T16:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164976",
    "user": "https://github.com/jdemeyer"
}
```

There are problems while building the documentation:

```
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_general:15: WARNING: Literal block expected; none found.
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_0:22: WARNING: Literal block expected; none found.
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_plus_0:21: WARNING: Literal block expected; none found.
```




---

archive/issue_comments_164977.json:
```json
{
    "body": "Note: the errors above usually arise if you do something like\n\n```\nEXAMPLES::\n\nSome explaining text::\n\n    sage: 1+1\n    2\n```\n\nThe above is **wrong**, the first line should have single colon.",
    "created_at": "2013-09-29T16:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164977",
    "user": "https://github.com/jdemeyer"
}
```

Note: the errors above usually arise if you do something like

```
EXAMPLES::

Some explaining text::

    sage: 1+1
    2
```

The above is **wrong**, the first line should have single colon.



---

archive/issue_comments_164978.json:
```json
{
    "body": "Certainly -- and this will be fixed very soon!  Don't let 5.13 out without this, please!",
    "created_at": "2013-09-29T16:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164978",
    "user": "https://github.com/JohnCremona"
}
```

Certainly -- and this will be fixed very soon!  Don't let 5.13 out without this, please!



---

archive/issue_comments_164979.json:
```json
{
    "body": "Attachment [trac_13615_fix.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_fix.patch) by @JohnCremona created at 2013-09-30 10:48:01\n\nsmall fix for trac_13615_combined_4th_review.patch",
    "created_at": "2013-09-30T10:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164979",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_13615_fix.patch](tarball://root/attachments/some-uuid/ticket13615/trac_13615_fix.patch) by @JohnCremona created at 2013-09-30 10:48:01

small fix for trac_13615_combined_4th_review.patch



---

archive/issue_comments_164980.json:
```json
{
    "body": "I changed the second patch which fixes the three problems (which were, in fact all the same: an ALGORITHM block erroneously had :: instead of :).\n\nI took the liberty of changing back to positive review.",
    "created_at": "2013-09-30T10:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164980",
    "user": "https://github.com/JohnCremona"
}
```

I changed the second patch which fixes the three problems (which were, in fact all the same: an ALGORITHM block erroneously had :: instead of :).

I took the liberty of changing back to positive review.



---

archive/issue_comments_164981.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-09-30T10:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164981",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164982.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-02T06:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164982",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_037966.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:35:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13411#event-37966"
}
```



---

archive/issue_comments_164983.json:
```json
{
    "body": "We have a problem, which I am investigating:\n\n```\nsage: K.<i> = NumberField(x^2+1)                                                                         \nsage: E = EllipticCurve(K,[-2*i-1,0])                                                                   \nsage: E.isogenies_prime_degree(17)\n...\n\nValueError: The polynomial does not define a finite subgroup of the elliptic curve.\n```\n\nwhile in fact this curve does have 2 17-isogenies:\n\n```\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general\nsage: isogenies_prime_degree_general(E,17) # rather slow\n[Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-82*i-641)*x over Number Field in i with defining polynomial x^2 + 1,\n Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-562*i+319)*x over Number Field in i with defining polynomial x^2 + 1]\n```\n\n\nThis was found by Warwick undergraduate Warren Moore, and I am looking into it....\n\nThis problem can be fixed as follows:  in line 1770 of isogeny_small_degree.py replace -27*c4 by -27*c4/1296 (or -c4/48) twice.  Something similar may be needed on line 1690 (the j=0 endomorphism case).  I will check that out and make a patch.\n\nSee #15434 for the extra patch!",
    "created_at": "2013-11-18T09:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13411#issuecomment-164983",
    "user": "https://github.com/JohnCremona"
}
```

We have a problem, which I am investigating:

```
sage: K.<i> = NumberField(x^2+1)                                                                         
sage: E = EllipticCurve(K,[-2*i-1,0])                                                                   
sage: E.isogenies_prime_degree(17)
...

ValueError: The polynomial does not define a finite subgroup of the elliptic curve.
```

while in fact this curve does have 2 17-isogenies:

```
sage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general
sage: isogenies_prime_degree_general(E,17) # rather slow
[Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-82*i-641)*x over Number Field in i with defining polynomial x^2 + 1,
 Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-562*i+319)*x over Number Field in i with defining polynomial x^2 + 1]
```


This was found by Warwick undergraduate Warren Moore, and I am looking into it....

This problem can be fixed as follows:  in line 1770 of isogeny_small_degree.py replace -27*c4 by -27*c4/1296 (or -c4/48) twice.  Something similar may be needed on line 1690 (the j=0 endomorphism case).  I will check that out and make a patch.

See #15434 for the extra patch!
