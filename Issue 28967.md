# Issue 28967: character art: avoid line breaks in elements of lists

archive/issues_028967.json:
```json
{
    "body": "Motivated by #29203, this ticket changes the ASCII and unicode representation of containers such as lists, tuples, sets and dictionaries, so that line breaks inside the container elements are avoided, but line breaks between elements are preferred. For example, a list of lists:\n\nBefore:\n\n```\nsage: %display ascii_art 80\nsage: [[1..5], [1..5], [1..25], [1..5], [1..15]]\n[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n\n 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ], [ 1,\n\n 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]\n```\n\n\nAfter:\n\n```\n[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ],\n\n [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,\n\n 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ],\n\n [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]\n```\n\n\nThis is implemented by changing the internal representation of the breakpoints of character art elements to keep track of the nesting of elements.\n\nThis ticket also deprecates `get_breakpoints` as its output is now less useful due to the change of the internal representation of `_breakpoints`, so it should only be used internally.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29204\n\n",
    "created_at": "2020-02-15T13:00:09Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "character art: avoid line breaks in elements of lists",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28967",
    "user": "@mwageringel"
}
```
Motivated by #29203, this ticket changes the ASCII and unicode representation of containers such as lists, tuples, sets and dictionaries, so that line breaks inside the container elements are avoided, but line breaks between elements are preferred. For example, a list of lists:

Before:

```
sage: %display ascii_art 80
sage: [[1..5], [1..5], [1..25], [1..5], [1..15]]
[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,

 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ], [ 1,

 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]
```


After:

```
[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ],

 [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,

 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ],

 [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]
```


This is implemented by changing the internal representation of the breakpoints of character art elements to keep track of the nesting of elements.

This ticket also deprecates `get_breakpoints` as its output is now less useful due to the change of the internal representation of `_breakpoints`, so it should only be used internally.


Issue created by migration from https://trac.sagemath.org/ticket/29204





---

archive/issue_comments_410043.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-15T13:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410043",
    "user": "@mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_410044.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-02-15T13:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410044",
    "user": "@mwageringel"
}
```

New commits:



---

archive/issue_comments_410045.json:
```json
{
    "body": "Changing keywords from \"\" to \"ascii_art, unicode_art\".",
    "created_at": "2020-02-15T13:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410045",
    "user": "@mwageringel"
}
```

Changing keywords from "" to "ascii_art, unicode_art".



---

archive/issue_comments_410046.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-18T08:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410046",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410047.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-02-22T15:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410047",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_410048.json:
```json
{
    "body": "On python 2:\n\n```\n**********************************************************************\nFile \"src/sage/typeset/character_art_factory.py\", line 376, in sage.typeset.character_art_factory.CharacterArtFactory.build_list\nFailed example:\n    str(ascii_art([[1..5], [1..5], [1..25], [1..5], [1..15]]))\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.typeset.character_art_factory.CharacterArtFactory.build_list[6]>\", line 1, in <module>\n        str(ascii_art([(ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(25))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(15)))]))\n      File \"sage/structure/sage_object.pyx\", line 194, in sage.structure.sage_object.SageObject.__repr__ (build/cythonized/sage/structure/sage_object.c:2436)\n        result = reprfunc()\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py\", line 159, in _repr_\n        return self._split_repr_(hsize)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py\", line 397, in _split_repr_\n        for bp in self._splitting_points(size):\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py\", line 334, in _splitting_points\n        for bp_next in breakpoints:\n    TypeError: instance has no next() method\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.typeset.character_art_factory.CharacterArtFactory.build_list\n    [56 tests, 1 failure, 14.16 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/combinat/shuffle.py  # 1 doctest failed\nsage -t --long src/sage/dynamics/cellular_automata/solitons.py  # 1 doctest failed\nsage -t --long src/sage/groups/fqf_orthogonal.py  # 92 doctests failed\nsage -t --long src/sage/groups/matrix_gps/isometries.py  # 4 doctests failed\nsage -t --long src/sage/matrix/matrix0.pyx  # 2 doctests failed\nsage -t --long src/sage/modules/fg_pid/fgp_module.py  # 17 doctests failed\nsage -t --long src/sage/modules/free_quadratic_module_integer_symmetric.py  # 75 doctests failed\nsage -t --long src/sage/modules/torsion_quadratic_module.py  # 117 doctests failed\nsage -t --long src/sage/quadratic_forms/genera/genus.py  # 7 doctests failed\nsage -t --long src/sage/repl/display/formatter.py  # 1 doctest failed\nsage -t --long src/sage/repl/rich_output/backend_base.py  # 8 doctests failed\nsage -t --long src/sage/repl/ipython_extension.py  # 2 doctests failed\nsage -t --long src/sage/typeset/ascii_art.py  # 1 doctest failed\nsage -t --long src/sage/typeset/character_art.py  # 5 doctests failed\nsage -t --long src/sage/typeset/character_art_factory.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2020-02-22T15:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410048",
    "user": "@vbraun"
}
```

On python 2:

```
**********************************************************************
File "src/sage/typeset/character_art_factory.py", line 376, in sage.typeset.character_art_factory.CharacterArtFactory.build_list
Failed example:
    str(ascii_art([[1..5], [1..5], [1..25], [1..5], [1..15]]))
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.typeset.character_art_factory.CharacterArtFactory.build_list[6]>", line 1, in <module>
        str(ascii_art([(ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(25))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(15)))]))
      File "sage/structure/sage_object.pyx", line 194, in sage.structure.sage_object.SageObject.__repr__ (build/cythonized/sage/structure/sage_object.c:2436)
        result = reprfunc()
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 159, in _repr_
        return self._split_repr_(hsize)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 397, in _split_repr_
        for bp in self._splitting_points(size):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 334, in _splitting_points
        for bp_next in breakpoints:
    TypeError: instance has no next() method
**********************************************************************
1 item had failures:
   1 of   8 in sage.typeset.character_art_factory.CharacterArtFactory.build_list
    [56 tests, 1 failure, 14.16 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/shuffle.py  # 1 doctest failed
sage -t --long src/sage/dynamics/cellular_automata/solitons.py  # 1 doctest failed
sage -t --long src/sage/groups/fqf_orthogonal.py  # 92 doctests failed
sage -t --long src/sage/groups/matrix_gps/isometries.py  # 4 doctests failed
sage -t --long src/sage/matrix/matrix0.pyx  # 2 doctests failed
sage -t --long src/sage/modules/fg_pid/fgp_module.py  # 17 doctests failed
sage -t --long src/sage/modules/free_quadratic_module_integer_symmetric.py  # 75 doctests failed
sage -t --long src/sage/modules/torsion_quadratic_module.py  # 117 doctests failed
sage -t --long src/sage/quadratic_forms/genera/genus.py  # 7 doctests failed
sage -t --long src/sage/repl/display/formatter.py  # 1 doctest failed
sage -t --long src/sage/repl/rich_output/backend_base.py  # 8 doctests failed
sage -t --long src/sage/repl/ipython_extension.py  # 2 doctests failed
sage -t --long src/sage/typeset/ascii_art.py  # 1 doctest failed
sage -t --long src/sage/typeset/character_art.py  # 5 doctests failed
sage -t --long src/sage/typeset/character_art_factory.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_410049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-22T21:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410049",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410050.json:
```json
{
    "body": "Sorry about that. This passes all tests with Python 2 now.",
    "created_at": "2020-02-22T21:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410050",
    "user": "@mwageringel"
}
```

Sorry about that. This passes all tests with Python 2 now.



---

archive/issue_comments_410051.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-22T21:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410051",
    "user": "@mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_410052.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-23T16:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410052",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410053.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-25T19:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28967#issuecomment-410053",
    "user": "@vbraun"
}
```

Resolution: fixed
