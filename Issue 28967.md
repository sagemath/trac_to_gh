# Issue 28967: character art: avoid line breaks in elements of lists

Issue created by migration from https://trac.sagemath.org/ticket/29204

Original creator: @mwageringel

Original creation time: 2020-02-15 13:00:09

Motivated by #29203, this ticket changes the ASCII and unicode representation of containers such as lists, tuples, sets and dictionaries, so that line breaks inside the container elements are avoided, but line breaks between elements are preferred. For example, a list of lists:

Before:

```
sage: %display ascii_art 80
sage: [[1..5], [1..5], [1..25], [1..5], [1..15]]
[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,

 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ], [ 1,

 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]
```


After:

```
[ [ 1, 2, 3, 4, 5 ], [ 1, 2, 3, 4, 5 ],

 [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,

 22, 23, 24, 25 ], [ 1, 2, 3, 4, 5 ],

 [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ] ]
```


This is implemented by changing the internal representation of the breakpoints of character art elements to keep track of the nesting of elements.

This ticket also deprecates `get_breakpoints` as its output is now less useful due to the change of the internal representation of `_breakpoints`, so it should only be used internally.



---

Comment by @mwageringel created at 2020-02-15 13:56:01

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-02-15 13:56:01

New commits:


---

Comment by @mwageringel created at 2020-02-15 13:56:01

Changing keywords from "" to "ascii_art, unicode_art".


---

Comment by vdelecroix created at 2020-02-18 08:39:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-22 15:06:54

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-02-22 15:06:54

On python 2:

```
**********************************************************************
File "src/sage/typeset/character_art_factory.py", line 376, in sage.typeset.character_art_factory.CharacterArtFactory.build_list
Failed example:
    str(ascii_art([[1..5], [1..5], [1..25], [1..5], [1..15]]))
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.typeset.character_art_factory.CharacterArtFactory.build_list[6]>", line 1, in <module>
        str(ascii_art([(ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(25))), (ellipsis_range(Integer(1),Ellipsis,Integer(5))), (ellipsis_range(Integer(1),Ellipsis,Integer(15)))]))
      File "sage/structure/sage_object.pyx", line 194, in sage.structure.sage_object.SageObject.__repr__ (build/cythonized/sage/structure/sage_object.c:2436)
        result = reprfunc()
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 159, in _repr_
        return self._split_repr_(hsize)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 397, in _split_repr_
        for bp in self._splitting_points(size):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/typeset/character_art.py", line 334, in _splitting_points
        for bp_next in breakpoints:
    TypeError: instance has no next() method
**********************************************************************
1 item had failures:
   1 of   8 in sage.typeset.character_art_factory.CharacterArtFactory.build_list
    [56 tests, 1 failure, 14.16 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/shuffle.py  # 1 doctest failed
sage -t --long src/sage/dynamics/cellular_automata/solitons.py  # 1 doctest failed
sage -t --long src/sage/groups/fqf_orthogonal.py  # 92 doctests failed
sage -t --long src/sage/groups/matrix_gps/isometries.py  # 4 doctests failed
sage -t --long src/sage/matrix/matrix0.pyx  # 2 doctests failed
sage -t --long src/sage/modules/fg_pid/fgp_module.py  # 17 doctests failed
sage -t --long src/sage/modules/free_quadratic_module_integer_symmetric.py  # 75 doctests failed
sage -t --long src/sage/modules/torsion_quadratic_module.py  # 117 doctests failed
sage -t --long src/sage/quadratic_forms/genera/genus.py  # 7 doctests failed
sage -t --long src/sage/repl/display/formatter.py  # 1 doctest failed
sage -t --long src/sage/repl/rich_output/backend_base.py  # 8 doctests failed
sage -t --long src/sage/repl/ipython_extension.py  # 2 doctests failed
sage -t --long src/sage/typeset/ascii_art.py  # 1 doctest failed
sage -t --long src/sage/typeset/character_art.py  # 5 doctests failed
sage -t --long src/sage/typeset/character_art_factory.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by git created at 2020-02-22 21:02:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2020-02-22 21:03:26

Sorry about that. This passes all tests with Python 2 now.


---

Comment by @mwageringel created at 2020-02-22 21:03:26

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2020-02-23 16:01:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-25 19:51:07

Resolution: fixed
