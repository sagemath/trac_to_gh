# Issue 32783: debugpy: contains precompiled binaries

Issue created by migration from https://trac.sagemath.org/ticket/33020

Original creator: tornaria

Original creation time: 2021-12-13 17:04:58

CC:  mkoeppe

This new standard package contains precompiled binaries, which are dynamically linked to a particular libc.

In particular this causes some problems building sage with the musl libc.

AFAICT, this was added in #31280 just because it was a new dependency for ipykernel.

OTOH, debugpy was made optional in https://github.com/ipython/ipykernel/pull/767 and this is included in ipykernel 6.4.0 and up (current version 6.6.0).

Is it possible to
- either upgrade ipykernel or add the patch to make debugpy optional;
- and then either remove or make optional debugpy in sagemath
before 9.5, please?


---

Comment by mkoeppe created at 2021-12-13 20:01:49

It is strange that `ipykernel` still declares the dependency on `debugpy` as an `install_requires` (https://github.com/ipython/ipykernel/blob/main/setup.py#L66).


---

Comment by mkoeppe created at 2021-12-13 20:05:28

I'd say for Sage 9.5, let's add PR 767 as a patch, patch out the `install_requires` (otherwise there will be a warning when installing the `ipykernel` package.), and move the dependency on `debugpy` from `ipykernel` to `jupyterlab`


---

Comment by tornaria created at 2021-12-13 21:20:36

Note arch pkg for debugpy removes all these precompiled libs and compiles the one for linux 64 bit (see https://github.com/archlinux/svntogit-community/blob/packages/python-debugpy/trunk/PKGBUILD).

It doesn't even seem difficult, as it is a single file. However, making sure this works for all supported architectures may be nontrivial, but otoh I expect the current package doesn't really work in all supported architectures anyway.


---

Comment by tornaria created at 2021-12-13 21:24:15

Changing status from new to needs_review.


---

Comment by tornaria created at 2021-12-13 21:24:15

New commits:


---

Comment by tornaria created at 2021-12-13 21:27:00

That commit works for me, it includes updating ipykernel to 6.6.0 and patching out setup.py and pyproject.toml.

If you prefer to stay at 6.3.1 and add PR 767 as a patch, that'd be easy to do (I was already testing this when I saw your comment).


---

Comment by mkoeppe created at 2021-12-18 22:44:36

I've put this on top of #32930
----
Last 10 new commits:


---

Comment by git created at 2021-12-18 22:49:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-12-18 23:37:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-18 23:38:05

The `pypi.io` URL didn't seem to work, so I changed it to one that works.


---

Comment by mkoeppe created at 2021-12-18 23:41:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-12-23 20:26:20

Resolution: fixed
