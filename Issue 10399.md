# Issue 10399: Weird behaviour with cusps

Issue created by migration from Trac.

Original creator: davidloeffler

Original creation time: 2010-12-09 16:58:58

Assignee: craigcitro

Keywords: cusps

The command "reduce_cusp" seems to be a bit flaky -- here are two perfectly standard inputs that cause it to fail in different ways: 


```
sage: G = Gamma1(5); G
Congruence Subgroup Gamma1(5)
sage: G.reduce_cusp(1/2) # works
1/2
sage: G.reduce_cusp(3) # boom (1)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)
    658         """
    659 
--> 660         return self._reduce_cusp(c)[0]
    661 
    662     def _reduce_cusp(self, c):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)
    725         if d == 1:
    726             if v in H:
--> 727                 return Cusps((0,1)), 1
    728             if (N-v) in H:
    729                 return Cusps((0,1)), -1

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6462)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3118)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3021)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7312)()

TypeError: unable to coerce <type 'tuple'> to an integer
sage: G.reduce_cusp(oo) # boom (2)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)
    658         """
    659 
--> 660         return self._reduce_cusp(c)[0]
    661 
    662     def _reduce_cusp(self, c):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)
    695         N = int(self.level())
    696         Cusps = c.parent()
--> 697         v = int(c.denominator() % N)
    698         H = self._list_of_elements_in_H()
    699 

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2638)()

AttributeError: 'PlusInfinity' object has no attribute 'denominator'
```


In each case ` G.reduce_cusp(Cusp(...)) ` gives the right answer, so the problem is apparently that various code expects the input to be a Cusp object and raises problems when it isn't.


---

Comment by davidloeffler created at 2010-12-09 17:32:38

Here's a patch. As expected, the problem was that input wasn't being correctly converted to type Cusp. I've also removed a pointless duplicate method stub "are_equivalent", and moved the Sturm bound code to a more natural place.


---

Comment by davidloeffler created at 2010-12-09 17:32:38

Changing status from new to needs_review.


---

Attachment

Apply over "trac_8716-gamma_h_modforms.patch" from #8716


---

Comment by davidloeffler created at 2010-12-09 21:54:44

I just noticed that my original patch conflicted with #8716, which has a positive review, so I've uploaded a new rebased version.


---

Comment by davidloeffler created at 2011-01-25 15:39:07

Changing priority from major to trivial.


---

Comment by AlexGhitza created at 2011-01-29 22:43:18

Looks good to me.


---

Comment by AlexGhitza created at 2011-01-29 22:43:18

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-02-07 08:15:06

Resolution: fixed
