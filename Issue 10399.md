# Issue 10399: Weird behaviour with cusps

archive/issues_010399.json:
```json
{
    "body": "Assignee: craigcitro\n\nKeywords: cusps\n\nThe command \"reduce_cusp\" seems to be a bit flaky -- here are two perfectly standard inputs that cause it to fail in different ways: \n\n\n```\nsage: G = Gamma1(5); G\nCongruence Subgroup Gamma1(5)\nsage: G.reduce_cusp(1/2) # works\n1/2\nsage: G.reduce_cusp(3) # boom (1)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/masiao/<ipython console> in <module>()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)\n    658         \"\"\"\n    659 \n--> 660         return self._reduce_cusp(c)[0]\n    661 \n    662     def _reduce_cusp(self, c):\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)\n    725         if d == 1:\n    726             if v in H:\n--> 727                 return Cusps((0,1)), 1\n    728             if (N-v) in H:\n    729                 return Cusps((0,1)), -1\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6462)()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3118)()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3021)()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7312)()\n\nTypeError: unable to coerce <type 'tuple'> to an integer\nsage: G.reduce_cusp(oo) # boom (2)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/masiao/<ipython console> in <module>()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)\n    658         \"\"\"\n    659 \n--> 660         return self._reduce_cusp(c)[0]\n    661 \n    662     def _reduce_cusp(self, c):\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)\n    695         N = int(self.level())\n    696         Cusps = c.parent()\n--> 697         v = int(c.denominator() % N)\n    698         H = self._list_of_elements_in_H()\n    699 \n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2638)()\n\nAttributeError: 'PlusInfinity' object has no attribute 'denominator'\n```\n\n\nIn each case ` G.reduce_cusp(Cusp(...)) ` gives the right answer, so the problem is apparently that various code expects the input to be a Cusp object and raises problems when it isn't.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10452\n\n",
    "created_at": "2010-12-09T16:58:58Z",
    "labels": [
        "modular forms",
        "major",
        "bug"
    ],
    "title": "Weird behaviour with cusps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10399",
    "user": "davidloeffler"
}
```
Assignee: craigcitro

Keywords: cusps

The command "reduce_cusp" seems to be a bit flaky -- here are two perfectly standard inputs that cause it to fail in different ways: 


```
sage: G = Gamma1(5); G
Congruence Subgroup Gamma1(5)
sage: G.reduce_cusp(1/2) # works
1/2
sage: G.reduce_cusp(3) # boom (1)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)
    658         """
    659 
--> 660         return self._reduce_cusp(c)[0]
    661 
    662     def _reduce_cusp(self, c):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)
    725         if d == 1:
    726             if v in H:
--> 727                 return Cusps((0,1)), 1
    728             if (N-v) in H:
    729                 return Cusps((0,1)), -1

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6462)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3118)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3021)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7312)()

TypeError: unable to coerce <type 'tuple'> to an integer
sage: G.reduce_cusp(oo) # boom (2)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in reduce_cusp(self, c)
    658         """
    659 
--> 660         return self._reduce_cusp(c)[0]
    661 
    662     def _reduce_cusp(self, c):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/arithgroup/congroup_gammaH.pyc in _reduce_cusp(self, c)
    695         N = int(self.level())
    696         Cusps = c.parent()
--> 697         v = int(c.denominator() % N)
    698         H = self._list_of_elements_in_H()
    699 

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2638)()

AttributeError: 'PlusInfinity' object has no attribute 'denominator'
```


In each case ` G.reduce_cusp(Cusp(...)) ` gives the right answer, so the problem is apparently that various code expects the input to be a Cusp object and raises problems when it isn't.

Issue created by migration from https://trac.sagemath.org/ticket/10452





---

archive/issue_comments_107035.json:
```json
{
    "body": "Here's a patch. As expected, the problem was that input wasn't being correctly converted to type Cusp. I've also removed a pointless duplicate method stub \"are_equivalent\", and moved the Sturm bound code to a more natural place.",
    "created_at": "2010-12-09T17:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107035",
    "user": "davidloeffler"
}
```

Here's a patch. As expected, the problem was that input wasn't being correctly converted to type Cusp. I've also removed a pointless duplicate method stub "are_equivalent", and moved the Sturm bound code to a more natural place.



---

archive/issue_comments_107036.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-09T17:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107036",
    "user": "davidloeffler"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_107037.json:
```json
{
    "body": "Attachment [trac_10452-cusps.patch](tarball://root/attachments/some-uuid/ticket10452/trac_10452-cusps.patch) by davidloeffler created at 2010-12-09 21:53:39\n\nApply over \"trac_8716-gamma_h_modforms.patch\" from #8716",
    "created_at": "2010-12-09T21:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107037",
    "user": "davidloeffler"
}
```

Attachment [trac_10452-cusps.patch](tarball://root/attachments/some-uuid/ticket10452/trac_10452-cusps.patch) by davidloeffler created at 2010-12-09 21:53:39

Apply over "trac_8716-gamma_h_modforms.patch" from #8716



---

archive/issue_comments_107038.json:
```json
{
    "body": "I just noticed that my original patch conflicted with #8716, which has a positive review, so I've uploaded a new rebased version.",
    "created_at": "2010-12-09T21:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107038",
    "user": "davidloeffler"
}
```

I just noticed that my original patch conflicted with #8716, which has a positive review, so I've uploaded a new rebased version.



---

archive/issue_comments_107039.json:
```json
{
    "body": "Changing priority from major to trivial.",
    "created_at": "2011-01-25T15:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107039",
    "user": "davidloeffler"
}
```

Changing priority from major to trivial.



---

archive/issue_comments_107040.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2011-01-29T22:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107040",
    "user": "AlexGhitza"
}
```

Looks good to me.



---

archive/issue_comments_107041.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-29T22:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107041",
    "user": "AlexGhitza"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_107042.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-07T08:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10399#issuecomment-107042",
    "user": "jdemeyer"
}
```

Resolution: fixed
