# Issue 17291: bug in difference_family(9,3)

Issue created by migration from https://trac.sagemath.org/ticket/17528

Original creator: vdelecroix

Original creation time: 2014-12-19 11:58:15

CC:  ncohen

Reported by N. Cohen

```
sage: designs.difference_family(9,3)
Traceback (most recent call last):
...
RuntimeError: 
```



---

Comment by vdelecroix created at 2014-12-19 12:42:13

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2014-12-19 12:42:13

New commits:


---

Comment by ncohen created at 2014-12-19 17:06:50

Yop !

Hmmmm... To be honest I would sleep better if this constructor was turned into many functions, each of them checking that their input corresponds to the proved construction.... `:-/`

By the way why did you add a triple loop ? Why wouldn't you change the big doctest which begins with `Other constructions for `\lambda > 1`::` with `lambda>=1` instead ?

Nathann


---

Comment by vdelecroix created at 2014-12-21 21:34:27

Replying to [comment:2 ncohen]:
> Yop !
> 
> Hmmmm... To be honest I would sleep better if this constructor was turned into many functions, each of them checking that their input corresponds to the proved construction.... `:-/`

done

> By the way why did you add a triple loop ? Why wouldn't you change the big doctest which begins with `Other constructions for `\lambda > 1`::` with `lambda>=1` instead ?

true

Vincent


---

Comment by git created at 2014-12-21 21:34:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-12-23 06:30:24

Hello !

I added a small commit at public/17528. Also, you did not change the big doctest to handle `l=1`, is there a reason ?

Nathann


---

Comment by vdelecroix created at 2014-12-23 07:26:41

Replying to [comment:5 ncohen]:
> Hello !
> 
> I added a small commit at public/17528. Also, you did not change the big doctest to handle `l=1`, is there a reason ?

Just forgot... here it is (and with a clearer construction of the Wilson 1972 paper).

Vincent
----
New commits:


---

Comment by ncohen created at 2014-12-23 08:03:15

Hello !

Can you add your new function to the index, as well as some documentation for its existence/check parameters ?

Nathann


---

Comment by ncohen created at 2014-12-23 08:19:44

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-12-23 08:19:44

Also: instead of checking that the cosets are disjoint like you do, wouldn't it be simpler/faster to:

1) Take all elements of A
2) Multiply it in any way possible (except by 1) and check that the result is not in A ?

It removes `already_in` and `nb_seen`.

Nathann


---

Comment by vdelecroix created at 2014-12-23 08:42:52

Replying to [comment:8 ncohen]:
> Also: instead of checking that the cosets are disjoint like you do, wouldn't it be simpler/faster to:
> 
> 1) Take all elements of A
> 2) Multiply it in any way possible (except by 1) and check that the result is not in A ?
> 
> It removes `already_in` and `nb_seen`.

I do not think it works. What you need is to write all elements a_i of A as x^m i_k + j_k^ with j_k < m. Then you need to check that the j_k are different. A possible way to do it along your lines is the following:

```
AA = set(~x*y for x in A for y in A if x != y)
for i in range((v-1)//m):
    if x**(m*i) in AA:
        # bad case
# good case
```

You reduce the iteration over the whole `K` to iteration over `Hm` which is a bit smaller (it has size 2v/k). I will do that.

By the way, `nb_seen` was not needed. It was just to stop the loop as soon as all elements of A are decomposed (instead of enumerating the whole K). The same "trick" is actually used in `singer_difference_set`... the thing is that you know exactly what you are looking for but there is no better way to do it rather then iterating through the whole K. 

Vincent


---

Comment by git created at 2014-12-23 08:51:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-12-23 08:52:20

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2014-12-23 13:24:07

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-12-23 13:24:07

Okayyyyyyyyyyy !

Thanks for the fix+reorganisation !

Nathann


---

Comment by vdelecroix created at 2014-12-23 14:46:28

Indeed. It was needed!

I hope I will have time for #16866 now.

Could you have a look at the almost combinatorial design ticket #17452?

Vincent


---

Comment by ncohen created at 2014-12-23 14:51:05

> Could you have a look at the almost combinatorial design ticket #17452?

I don't know that class, but I can give it a try. Can you look at #17149 ? `:-P`

Nathann


---

Comment by ncohen created at 2014-12-23 14:54:30

By the way there is one guy who was hired by Inria to work full-time on coding theory stuff... Where is he ? `O_o`


---

Comment by vbraun created at 2015-01-02 15:46:06

Resolution: fixed
