# Issue 34621: Fix sagemath-standard sdist

Issue created by migration from https://trac.sagemath.org/ticket/34858

Original creator: mkoeppe

Original creation time: 2022-12-18 22:04:50

CC:  klee fbissey

`./bootstrap && ./sage -sh -c '(cd pkgs/sagemath-standard && tox -v -v -v -e sagepython-sagewheels-nopypi-norequirements)'` fails in 9.8.beta5 because the sdist is broken

```

  cimport cython
  from sage.algebras.fusion_rings.poly_tup_engine cimport (
  ^
  ------------------------------------------------------------

  sage/algebras/fusion_rings/fast_parallel_fmats_methods.pyx:12:0: 'sage/algebras/fusion_rings/poly_tup_engine.pxd' not found

```



---

Comment by git created at 2022-12-18 23:54:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-12-19 00:28:35

Changing status from new to needs_review.


---

Comment by git created at 2022-12-19 00:59:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-12-20 22:42:15

So no more sdist specific code in setup.py so simplification and make sure stuff is properly included in the manifest.

I am wondering if it is possible to first use a global include and then prune some of the files that are collected by that global include. I am just thinking we should explicitly list as few files as we can. It is a risk, because someone will forget to include them in the manifest when they create a new one - or delete one.


---

Comment by mkoeppe created at 2022-12-20 23:28:37

Yes, that's what the MANIFEST.in is doing. We do have to distinguish between the Cython-generated C/C++ files and actual C/C++ source files. Adding new such files is a relatively rare event


---

Comment by fbissey created at 2022-12-20 23:36:09

I am very much in automation these days. While it is relatively short, maintaining this list by hand is a hazard. Which is why this ticket add 3 explicit files to `MANIFEST.in`. I am going to fill that under ideas to develop.

For the rest it looks good to me but I see #34859 has not been reviewed yet.


---

Comment by mkoeppe created at 2022-12-20 23:48:27

I hope to switch from setuptools to meson-python in #34630; then we can revisit this question.


---

Comment by mkoeppe created at 2022-12-23 05:53:35

Replying to [comment:8 FranÃ§ois Bissey]:
> I see #34859 has not been reviewed yet.

Now the dependency has been reviewed


---

Comment by fbissey created at 2022-12-23 06:07:39

Let's move on then.


---

Comment by fbissey created at 2022-12-23 06:07:39

Changing status from needs_review to positive_review.
