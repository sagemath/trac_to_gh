# Issue 20202: eigenmatrix_right gives the conjugate of what it should

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2016-04-13 22:19:25

Here is the example reported at http://ask.sagemath.org/question/33084/bug-in-eigenmatrix-command/


```
sage: A = matrix(CDF, [[-2.53634347567,  2.04801738686, -0.0, -62.166145304], [ 0.7, -0.6, 0.0, 0.0], [0.547271128842, 0.0, -0.3015, -21.7532081652], [0.0, 0.0, 0.3, -0.4]])
sage: D, P = A.eigenmatrix_right()
```


According to the documentation, `D,P` should satisfy `A*P == P*D`, however:


```
sage: (A*P - P*D).norm()
7.454841195108627
```


The conjugate of `P` seems to be the correct answer though:


```
sage: P  = P.conjugate()
sage: (A*P - P*D).norm()
6.716506829378007e-15
```



---

Comment by kedlaya created at 2017-10-24 01:28:59

It appears that both `eigenmatrix_right` and `eigenmatrix_left` are computed using `eigenvectors_left`, which for `CDF` is implemented in `sage/matrix/matrix_double_dense.py`. That in turn is calling `scipy.linalg.eig`, whose documentation

https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.eig.html

states that indeed for left eigenvectors, the reported "eigenvectors" are actually the conjugates thereof.

So I would propose changing `eigenvectors_left` to account for this.


---

Comment by kedlaya created at 2017-10-25 03:28:06

Changing keywords from "" to "sd90".


---

Comment by rparamastri created at 2017-10-25 17:15:20

Conjugated the eigenvectors returned by `scipy.linalg.eig` as suggested [here](https://trac.sagemath.org/ticket/20439#comment:2).


---

Comment by rparamastri created at 2017-10-25 17:15:20

Changing status from new to needs_review.


---

Comment by kedlaya created at 2017-10-25 17:39:44

All tests passed on k8s, so it looks like there were no unexpected side effects. (This is a bit surprising to me, but never mind.) I do have some comments on the doctests, though.

It is a [Sage coding convention](http://doc.sagemath.org/html/en/developer/coding_basics.html) that lines should be no longer than 79 characters; anything longer should be split into multiple lines. In `matrix2.pyx`, the new doctest in `eigenmatrix_left` has a line that violates this convention.

The new doctests should reference this ticket. Sample text to illustrate the formatting:

```
    This test shows that :trac:`20439` has been resolved::
    ...
```

I would add a new doctest to `left_eigenvectors` where the substantive change was made, showing the effect of the change and again referencing this ticket. Repurposing the example from the top of the ticket would suffice.


---

Comment by kedlaya created at 2017-10-25 17:39:44

Changing status from needs_review to needs_work.


---

Comment by rlmiller created at 2017-10-25 17:49:31

There should also be a blank line before and after examples, but not after the last example. Also I would reformat the examples so the lines are shorter.


---

Comment by tscrim created at 2017-10-25 22:23:29

To elaborate a bit more on the character limit `@`kedlaya is referring to, the usual way to split long lines is to do:

```
        sage: A = matrix(CDF, [[-2.53634347567, 2.04801738686, -0.0, -62.166145304],
        ....:                  [0.7, -0.6, 0.0, 0.0],
        ....:                  [0.547271128842, 0.0, -0.3015, -21.7532081652],
        ....:                  [0.0, 0.0, 0.3, -0.4]])
```

In some cases, you might have to go over 79 char/line for readability, but we try to stick to that limit as much as possible.


---

Comment by kedlaya created at 2017-10-29 19:59:47

Changing status from needs_work to needs_review.


---

Comment by kedlaya created at 2017-10-29 19:59:47

Alina was having trouble with trac just now, so I've pushed her changes.
----
New commits:


---

Comment by alina created at 2017-10-29 21:35:21

Added â€‹Travis Scrimshaw, Rebecca Miller to reviewers.


---

Comment by tscrim created at 2017-10-29 22:30:25

`@`kedlaya, you should add yourself to the reviewers list too.

I also have a few additional suggestions for the doctests:

```diff
-            sage: for i in range(A.dimensions()[0]):
-            ....:     ((A - spectrum[i][0]*identity_matrix(A.dimensions()[0]))*Matrix(spectrum[i][1]).transpose()).norm()<10^(-2)
+            sage: all(((A - spectrum[i][0]) * Matrix(spectrum[i][1]).transpose()).norm() < 10^(-2)
+            ....:     for i in range(A.nrows())
```

In fact, all of those `<` should have a space around them by PEP8 (it also is much easier to read quickly).

Two more spaces after the `....:` in these:

```
            sage: for i in range(len(spectrum)):
            ....:   spectrum[i][1][0]=matrix(CDF, spectrum[i][1]).echelon_form()[0]
```



---

Comment by git created at 2017-10-31 01:21:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2017-10-31 01:23:26

Added myself as reviewer and edited the doctests as proposed.


---

Comment by tscrim created at 2017-10-31 01:41:40

Thank you. Almost done.

Replying to [comment:12 tscrim]:
> In fact, all of those `<` should have a space around them by PEP8 (it also is much easier to read quickly).

You missed a few:

```diff
-(P*A - D*P).norm()<10^(-2)
+(P*A - D*P).norm() < 10^(-2)
```


Once that is done, you can set a positive review on my behalf.


---

Comment by git created at 2017-10-31 01:50:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2017-10-31 01:51:12

Replying to [comment:15 tscrim]:
> Thank you. Almost done.
> 
> Replying to [comment:12 tscrim]:
> > In fact, all of those `<` should have a space around them by PEP8 (it also is much easier to read quickly).
> 
> You missed a few:
> {{{#!diff
> -(P*A - D*P).norm()<10^(-2)
> +(P*A - D*P).norm() < 10^(-2)
> }}}
> 
> Once that is done, you can set a positive review on my behalf.

Done and done.


---

Comment by kedlaya created at 2017-10-31 01:51:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-11-02 11:06:08

Resolution: fixed
