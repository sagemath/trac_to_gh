# Issue 31611: Random failure: sage.libs.gap.util.GAPError: Error, OnSets: <set> must be a set

Issue created by migration from https://trac.sagemath.org/ticket/31848

Original creator: vbraun

Original creation time: 2021-05-23 09:22:43


```
# for i in `seq 0 25` ; do sage -t --long src/sage/graphs/graph.py ; done
[...]
----------------------------------------------------------------------
Total time for all tests: 11.6 seconds
    cpu time: 10.7 seconds
    cumulative wall time: 11.4 seconds
Pytest is not installed, skip checking tests that rely on it.
Running doctests with ID 2021-05-23-11-20-41-27ccab84.
Git branch: develop
Using --optional=build,dochtml,fedora,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 44.4 --random-seed=0 src/sage/graphs/graph.py
**********************************************************************
File "src/sage/graphs/graph.py", line 2713, in sage.graphs.graph.Graph.is_edge_transitive
Failed example:
    C.is_edge_transitive()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph.Graph.is_edge_transitive[3]>", line 1, in <module>
        C.is_edge_transitive()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/graphs/graph.py", line 2731, in is_edge_transitive
        return libgap(A).OrbitLength(e, libgap.OnSets) == self.size()
      File "sage/libs/gap/element.pyx", line 2677, in sage.libs.gap.element.GapElement_MethodProxy.__call__ (build/cythonized/sage/libs/gap/element.c:20776)
        return GapElement_Function.__call__(self, * ([self.first_argument] + list(args)))
      File "sage/libs/gap/element.pyx", line 2525, in sage.libs.gap.element.GapElement_Function.__call__ (build/cythonized/sage/libs/gap/element.c:19780)
        sig_on()
    sage.libs.gap.util.GAPError: Error, OnSets: <set> must be a set (not a immutable non-strictly-sorted plain list of cyclotomics)
**********************************************************************
1 item had failures:
   1 of   9 in sage.graphs.graph.Graph.is_edge_transitive
    [1216 tests, 1 failure, 11.14 s]
----------------------------------------------------------------------
sage -t --long --warn-long 44.4 --random-seed=0 src/sage/graphs/graph.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 11.3 seconds
    cpu time: 10.4 seconds
    cumulative wall time: 11.1 seconds
Pytest is not installed, skip checking tests that rely on it.
Running doctests with ID 2021-05-23-11-20-55-6956bb7d.
Git branch: develop
Using --optional=build,dochtml,fedora,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 44.4 --random-seed=0 src/sage/graphs/graph.py
    [1216 tests, 11.18 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2021-05-24 19:10:46

Changing keywords from "" to "random_fail".


---

Comment by vbraun created at 2021-05-24 19:19:52

Possibly ? related to https://github.com/gap-system/gap/commit/965b1c69de723492202659c4c5e53b369d766f11


---

Comment by vbraun created at 2021-05-24 19:19:52

Changing keywords from "random_fail" to "".


---

Comment by vbraun created at 2021-05-24 19:19:59

Changing keywords from "" to "random_fail".


---

Comment by vbraun created at 2021-05-27 20:26:46

Already present in Sage 9.3


---

Comment by dimpase created at 2021-05-27 20:39:33

is it by any chance fixed by updating GAP to 4.11.1 ?


---

Comment by dimpase created at 2021-05-27 20:41:08

the update is on #31498 - needs review


---

Comment by vdelecroix created at 2021-05-27 21:51:54

Can even loop on the single command

```
$ sage-dev -c 'graphs.CubeGraph(3).is_edge_transitive()'
```



---

Comment by vdelecroix created at 2021-05-27 21:55:53

New commits:


---

Comment by vdelecroix created at 2021-05-27 21:55:53

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2021-05-27 22:02:28

This is also reproducible in a GAP console

```
gap> OrbitLength(SymmetricGroup(5), [1,2], OnSets);
10
gap> OrbitLength(SymmetricGroup(5), [2,1], OnSets);
Error, OnSets: <set> must be a set (not a immutable non-strictly-sorted plain list of cyclotomics)
```



---

Comment by dimpase created at 2021-05-29 00:26:57

Replying to [comment:9 vdelecroix]:
> This is also reproducible in a GAP console
> {{{
> gap> OrbitLength(SymmetricGroup(5), [1,2], OnSets);
> 10
> gap> OrbitLength(SymmetricGroup(5), [2,1], OnSets);
> Error, OnSets: <set> must be a set (not a immutable non-strictly-sorted plain list of cyclotomics)
> }}}

this seems to work in GAP 4.11.1 : #31498


---

Comment by dimpase created at 2021-05-29 00:28:15

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-05-29 00:28:15

the doctest fix is good.


---

Comment by vbraun created at 2021-06-06 13:16:43

Resolution: fixed
