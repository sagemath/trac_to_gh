# Issue 27226: Sage cannot open a Jupyter notebook directly

archive/issues_027226.json:
```json
{
    "body": "Keywords: jupyter\n\nWith Sage 8.6, it is possible to open directly a notebook file by\n\n```\nsage -n jupyter file_name.ipynb\n```\n\nWith Sage 8.7.beta7 (python 2 version), the same command yields\n\n```\nPlease wait while the Sage Jupyter Notebook server starts...\n[I 16:42:59.645 NotebookApp] Using MathJax: nbextensions/mathjax/MathJax.js\n[I 16:42:59.837 NotebookApp] The port 8888 is already in use, trying another port.\n[I 16:42:59.842 NotebookApp] Serving notebooks from local directory: /home/eric/sage/8.7.develop\n[I 16:42:59.843 NotebookApp] The Jupyter Notebook is running at:\n[I 16:42:59.843 NotebookApp] http://localhost:8889/?token=4ee2a5663e04a186130a4fec828a17c746fedb6b363bd50f\n[I 16:42:59.843 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\nTraceback (most recent call last):\n  File \"/home/eric/sage/8.7.develop/src/bin/sage-notebook\", line 267, in <module>\n    launcher(unknown)\n  File \"/home/eric/sage/8.7.develop/src/bin/sage-notebook\", line 99, in __init__\n    main(argv)\n  File \"/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/jupyter_core/application.py\", line 266, in launch_instance\n    return super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)\n  File \"/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\n    app.start()\n  File \"/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py\", line 1784, in start\n    self.launch_browser()\n  File \"/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py\", line 1742, in launch_browser\n    with open(fd, 'w', encoding='utf-8') as fh:\nTypeError: coercing to Unicode: need string or buffer, int found\n```\n\nThe command \n\n```\nsage -n jupyter\n```\n\nworks though, so that it is possible to open the notebook by clicking on it in the notebook list. \n\nWith Sage 8.7.beta7 (python 3 version), there is no such issue.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27463\n\n",
    "created_at": "2019-03-11T16:06:04Z",
    "labels": [
        "component: notebook",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Sage cannot open a Jupyter notebook directly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27226",
    "user": "https://github.com/egourgoulhon"
}
```
Keywords: jupyter

With Sage 8.6, it is possible to open directly a notebook file by

```
sage -n jupyter file_name.ipynb
```

With Sage 8.7.beta7 (python 2 version), the same command yields

```
Please wait while the Sage Jupyter Notebook server starts...
[I 16:42:59.645 NotebookApp] Using MathJax: nbextensions/mathjax/MathJax.js
[I 16:42:59.837 NotebookApp] The port 8888 is already in use, trying another port.
[I 16:42:59.842 NotebookApp] Serving notebooks from local directory: /home/eric/sage/8.7.develop
[I 16:42:59.843 NotebookApp] The Jupyter Notebook is running at:
[I 16:42:59.843 NotebookApp] http://localhost:8889/?token=4ee2a5663e04a186130a4fec828a17c746fedb6b363bd50f
[I 16:42:59.843 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
Traceback (most recent call last):
  File "/home/eric/sage/8.7.develop/src/bin/sage-notebook", line 267, in <module>
    launcher(unknown)
  File "/home/eric/sage/8.7.develop/src/bin/sage-notebook", line 99, in __init__
    main(argv)
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/jupyter_core/application.py", line 266, in launch_instance
    return super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/traitlets/config/application.py", line 658, in launch_instance
    app.start()
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py", line 1784, in start
    self.launch_browser()
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py", line 1742, in launch_browser
    with open(fd, 'w', encoding='utf-8') as fh:
TypeError: coercing to Unicode: need string or buffer, int found
```

The command 

```
sage -n jupyter
```

works though, so that it is possible to open the notebook by clicking on it in the notebook list. 

With Sage 8.7.beta7 (python 3 version), there is no such issue.

Issue created by migration from https://trac.sagemath.org/ticket/27463





---

archive/issue_comments_383173.json:
```json
{
    "body": "This is probably an upstream problem.",
    "created_at": "2019-03-11T16:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383173",
    "user": "https://github.com/jdemeyer"
}
```

This is probably an upstream problem.



---

archive/issue_comments_383174.json:
```json
{
    "body": "Note, this was probably introduced by #26969.  We should probably downgrade the notebook package back down to 5.7.1 and/or provide a patch and/or open an issue upstream.  We should also add a regression test for this to `sage/tests/cmdline.py`.",
    "created_at": "2019-03-12T13:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383174",
    "user": "https://github.com/embray"
}
```

Note, this was probably introduced by #26969.  We should probably downgrade the notebook package back down to 5.7.1 and/or provide a patch and/or open an issue upstream.  We should also add a regression test for this to `sage/tests/cmdline.py`.



---

archive/issue_comments_383175.json:
```json
{
    "body": "On my system, `./sage -n jupyter foo.ipynb` works but it opens in a jupyterlab environment.",
    "created_at": "2019-03-14T13:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383175",
    "user": "https://github.com/jdemeyer"
}
```

On my system, `./sage -n jupyter foo.ipynb` works but it opens in a jupyterlab environment.



---

archive/issue_comments_383176.json:
```json
{
    "body": "Changing component from notebook to packages: standard.",
    "created_at": "2019-03-14T13:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383176",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from notebook to packages: standard.



---

archive/issue_comments_383177.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-14T14:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383177",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_383178.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-14T14:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383178",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_383179.json:
```json
{
    "body": "Replying to [comment:4 embray]:\n> We should also add a regression test for this to `sage/tests/cmdline.py`.\n\nI'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.",
    "created_at": "2019-03-14T14:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383179",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 embray]:
> We should also add a regression test for this to `sage/tests/cmdline.py`.

I'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.



---

archive/issue_comments_383180.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-14T14:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383180",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_383181.json:
```json
{
    "body": "Thanks for the fix! I've just checked it.",
    "created_at": "2019-03-14T14:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383181",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the fix! I've just checked it.



---

archive/issue_comments_383182.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Replying to [comment:4 embray]:\n> > We should also add a regression test for this to `sage/tests/cmdline.py`.\n> \n> I'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.\n\nI guess you're right; it doesn't seem worth the effort for what was an upstream bug anyways.",
    "created_at": "2019-03-14T14:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383182",
    "user": "https://github.com/embray"
}
```

Replying to [comment:10 jdemeyer]:
> Replying to [comment:4 embray]:
> > We should also add a regression test for this to `sage/tests/cmdline.py`.
> 
> I'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.

I guess you're right; it doesn't seem worth the effort for what was an upstream bug anyways.



---

archive/issue_events_025270.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-03-15T08:09:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27226#event-25270"
}
```



---

archive/issue_comments_383183.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-15T08:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27226#issuecomment-383183",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
