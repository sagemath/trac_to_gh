# Issue 27226: Sage cannot open a Jupyter notebook directly

Issue created by migration from https://trac.sagemath.org/ticket/27463

Original creator: egourgoulhon

Original creation time: 2019-03-11 16:06:04

Keywords: jupyter

With Sage 8.6, it is possible to open directly a notebook file by

```
sage -n jupyter file_name.ipynb
```

With Sage 8.7.beta7 (python 2 version), the same command yields

```
Please wait while the Sage Jupyter Notebook server starts...
[I 16:42:59.645 NotebookApp] Using MathJax: nbextensions/mathjax/MathJax.js
[I 16:42:59.837 NotebookApp] The port 8888 is already in use, trying another port.
[I 16:42:59.842 NotebookApp] Serving notebooks from local directory: /home/eric/sage/8.7.develop
[I 16:42:59.843 NotebookApp] The Jupyter Notebook is running at:
[I 16:42:59.843 NotebookApp] http://localhost:8889/?token=4ee2a5663e04a186130a4fec828a17c746fedb6b363bd50f
[I 16:42:59.843 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
Traceback (most recent call last):
  File "/home/eric/sage/8.7.develop/src/bin/sage-notebook", line 267, in <module>
    launcher(unknown)
  File "/home/eric/sage/8.7.develop/src/bin/sage-notebook", line 99, in __init__
    main(argv)
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/jupyter_core/application.py", line 266, in launch_instance
    return super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/traitlets/config/application.py", line 658, in launch_instance
    app.start()
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py", line 1784, in start
    self.launch_browser()
  File "/home/eric/sage/8.7.develop/local/lib/python2.7/site-packages/notebook/notebookapp.py", line 1742, in launch_browser
    with open(fd, 'w', encoding='utf-8') as fh:
TypeError: coercing to Unicode: need string or buffer, int found
```

The command 

```
sage -n jupyter
```

works though, so that it is possible to open the notebook by clicking on it in the notebook list. 

With Sage 8.7.beta7 (python 3 version), there is no such issue.


---

Comment by jdemeyer created at 2019-03-11 16:10:32

This is probably an upstream problem.


---

Comment by embray created at 2019-03-12 13:48:05

Note, this was probably introduced by #26969.  We should probably downgrade the notebook package back down to 5.7.1 and/or provide a patch and/or open an issue upstream.  We should also add a regression test for this to `sage/tests/cmdline.py`.


---

Comment by jdemeyer created at 2019-03-14 13:48:33

On my system, `./sage -n jupyter foo.ipynb` works but it opens in a jupyterlab environment.


---

Comment by jdemeyer created at 2019-03-14 13:54:23

Changing component from notebook to packages: standard.


---

Comment by jdemeyer created at 2019-03-14 14:01:47

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2019-03-14 14:01:47

New commits:


---

Comment by jdemeyer created at 2019-03-14 14:02:47

Replying to [comment:4 embray]:
> We should also add a regression test for this to `sage/tests/cmdline.py`.

I'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.


---

Comment by egourgoulhon created at 2019-03-14 14:16:39

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-03-14 14:16:39

Thanks for the fix! I've just checked it.


---

Comment by embray created at 2019-03-14 14:50:56

Replying to [comment:10 jdemeyer]:
> Replying to [comment:4 embray]:
> > We should also add a regression test for this to `sage/tests/cmdline.py`.
> 
> I'm not sure how to do that. I don't think we should run an actual Jupyter server in the testsuite.

I guess you're right; it doesn't seem worth the effort for what was an upstream bug anyways.


---

Comment by vbraun created at 2019-03-15 08:09:43

Resolution: fixed
