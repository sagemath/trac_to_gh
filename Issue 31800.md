# Issue 31800: Upgrade to lcalc-2.0.0

archive/issues_031800.json:
```json
{
    "body": "CC:  @JohnCremona @antonio-rojas @kiwifb @dimpase\n\nI've just tagged a 2.0.0 release of lcalc: https://gitlab.com/sagemath/lcalc/-/tags/2.0.0\n\nThere are a few issues that need to be addressed during the upgrade.\n\n1. The build system is now sane. This should make life easier in the long run, but means that spkg-* need to be rewritten. `./configure --with-pari` should suffice.\n\n2. The lcalc spkg shouldn't depend on mpfr (I'm not sure why it ever did).\n\n3. spkg-configure.m4 should be modified to find the new version, for example...\n\n\n```patch\ndiff --git a/build/pkgs/lcalc/spkg-configure.m4 b/build/pkgs/lcalc/spkg-configure.m4\nindex 19a87c8d30..b332294eae 100644\n--- a/build/pkgs/lcalc/spkg-configure.m4\n+++ b/build/pkgs/lcalc/spkg-configure.m4\n@@ -1,20 +1,20 @@\n SAGE_SPKG_CONFIGURE([lcalc], [\n-    m4_pushdef([SAGE_LCALC_MINVER],[\"1.22\"])\n-    SAGE_SPKG_DEPCHECK([pari mpfr], [\n+    m4_pushdef([SAGE_LCALC_MINVER],[\"2.0.0\"])\n+    SAGE_SPKG_DEPCHECK([pari], [\n         AC_PATH_PROG([LCALC], [lcalc])\n         AS_IF([test x$LCALC = x], [\n            AC_MSG_NOTICE([lcalc not found. Installing lcalc])\n            sage_spkg_install_lcalc=yes], [\n            AC_MSG_CHECKING([is lcalc's version good enough? ])\n-           lcalc_ver=`$LCALC --version 2>>/dev/null | $SED -e 's/lcalc\\ //' | $SED -e 's/\\ .*//g'`\n+           lcalc_ver=$($LCALC --version 2>>/dev/null | $SED -e 's/lcalc\\ //' | cut -d' ' -f2)\n            AX_COMPARE_VERSION([$lcalc_ver], [ge], [$SAGE_LCALC_MINVER], [\n                AC_MSG_RESULT([yes.])\n-               AC_CHECK_HEADER([Lfunction/L.h], [], [sage_spkg_install_lcalc=yes])\n+               AC_CHECK_HEADER([lcalc/L.h], [], [sage_spkg_install_lcalc=yes])\n           AC_MSG_CHECKING([whether we can link and run a program using libLfunction])\n           LCALC_SAVED_LIBS=$LIBS\n           LIBS=\"$LIBS -lLfunction\"\n           AC_RUN_IFELSE([\n-            AC_LANG_PROGRAM([[#include <Lfunction/L.h>]],\n+            AC_LANG_PROGRAM([[#include <lcalc/L.h>]],\n                       [[initialize_globals();\n                         Complex x;\n                         x = Pi*I;\n```\n\n\nHowever, lcalc-2.0.0 comes with a pkg-config file, so we could greatly simplify that.\n\n4. The public API header has moved to `lcalc/L.h`:\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_sage.h b/src/sage/libs/lcalc/lcalc_sage.h\nindex 498528917f..18e5232cbe 100644\n--- a/src/sage/libs/lcalc/lcalc_sage.h\n+++ b/src/sage/libs/lcalc/lcalc_sage.h\n@@ -1,4 +1,4 @@\n-#include \"Lfunction/L.h\"\n+#include \"lcalc/L.h\"\n int *new_ints(int l)\n {\n     return new int[l];\n\n```\n\n\n5. The `find_zeros_via_N_v()` function was removed, and replaced by `find_zeros()`. Here's a patch:\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pxd b/src/sage/libs/lcalc/lcalc_Lfunction.pxd\nindex d1dbb5d95d..5edf0844f3 100644\n--- a/src/sage/libs/lcalc/lcalc_Lfunction.pxd\n+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pxd\n@@ -21,7 +21,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -38,7 +38,7 @@ cdef extern from \"lcalc_sage.h\":\n         double (* N) (double T)\n         double *dirichlet_coefficient\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -54,7 +54,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -70,7 +70,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)#puts result in vector<double> result\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*find_zeros_via_N)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, char *filename) #puts result in filename\n \n         #Constructor and destructor\n@@ -111,7 +111,7 @@ cdef class Lfunction:\n     #strange bug, replacing Double with double gives me a compile error\n     cdef Double __typedN(self, double T)\n     cdef void __find_zeros_v(self, double T1, double T2, double stepsize,doublevec *result)\n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula,doublevec *result)\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n \n     cdef str _repr\n\n```\n\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pyx b/src/sage/libs/lcalc/lcalc_Lfunction.pyx\nindex 7e54d7e78d..409987c5d0 100644\n--- a/src/sage/libs/lcalc/lcalc_Lfunction.pyx\n+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pyx\n@@ -307,8 +307,7 @@ cdef class Lfunction:\n         return returnvalue\n \n     #The default values are from L.h. See L.h\n-    def find_zeros_via_N(self, count=0, do_negative=False, max_refine=1025,\n-                         rank=-1, test_explicit_formula=0):\n+    def find_zeros_via_N(self, count=0, start=0, max_refine=1025, rank=-1):\n         \"\"\"\n         Finds ``count`` number of zeros with positive imaginary part\n         starting at real axis. This function also verifies that all\n@@ -317,8 +316,7 @@ cdef class Lfunction:\n         INPUT:\n \n         - ``count`` - number of zeros to be found\n-        - ``do_negative`` - (default: False) False to ignore zeros below the\n-          real axis.\n+        - ``start`` - (default: 0) how many initial zeros to skip\n         - ``max_refine`` - when some zeros are found to be missing, the step\n           size used to find zeros is refined. max_refine gives an upper limit\n           on when lcalc should give up. Use default value unless you know\n@@ -326,13 +324,9 @@ cdef class Lfunction:\n         - ``rank`` - integer (default: -1) analytic rank of the L-function.\n           If -1 is passed, then we attempt to compute it. (Use default if in\n           doubt)\n-        - ``test_explicit_formula`` - integer (default: 0) If nonzero, test\n-          the explicit formula for additional confidence that all the zeros\n-          have been found and are accurate. This is still being tested, so\n-          using the default is recommended.\n \n         OUTPUT:\n-        \n+\n         list -- A list of the imaginary parts of the zeros that have been found\n \n         EXAMPLES::\n@@ -356,14 +350,10 @@ cdef class Lfunction:\n             sage: L.find_zeros_via_N(3)\n             [14.1347251417..., 21.0220396387..., 25.0108575801...]\n         \"\"\"\n-        cdef Integer count_I = Integer(count)\n-        cdef Integer do_negative_I = Integer(do_negative)\n-        cdef RealNumber max_refine_R = RRR(max_refine)\n-        cdef Integer rank_I = Integer(rank)\n-        cdef Integer test_explicit_I = Integer(test_explicit_formula)\n+        cdef const char *message_stamp = \"\"\n         cdef doublevec result\n         sig_on()\n-        self.__find_zeros_via_N_v(mpz_get_si(count_I.value), mpz_get_si(do_negative_I.value), mpfr_get_d(max_refine_R.value, MPFR_RNDN), mpz_get_si(rank_I.value), mpz_get_si(test_explicit_I.value), &result)\n+        self.__find_zeros(count, start, max_refine, rank, message_stamp, &result)\n         sig_off()\n         returnvalue = []\n         for i in range(result.size()):\n@@ -390,7 +380,7 @@ cdef class Lfunction:\n     cdef void __find_zeros_v(self,double T1, double T2, double stepsize, doublevec *result):\n         raise NotImplementedError\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n         raise NotImplementedError\n \n ##############################################################################\n@@ -486,8 +476,8 @@ cdef class Lfunction_I(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_I *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_I *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_I *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -624,8 +614,8 @@ cdef class Lfunction_D(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_D *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_D *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start,double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_D *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -769,8 +759,8 @@ cdef class Lfunction_C:\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_C *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_C *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_C *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -854,8 +844,8 @@ cdef class Lfunction_Zeta(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_Zeta *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_Zeta *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_Zeta *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     def __dealloc__(self):\n         \"\"\"\n```\n\n\n6. Some tests need tolerance updates because the answers have changed slightly.\n\n7. Two tests give different answers entirely and require help from someone who knows what an L-function is. These are discussed on #24820 as well:\n\n\n```\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\nFailed example:\n    L.hardy_z_function(.4+.3*I)\nExpected:\n    0.2166144222685... - 0.00408187127850...*I\nGot:\n    0.0240947990422036 + 0.215308871779581*I\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 350, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.find_zeros_via_N\nFailed example:\n    L.find_zeros_via_N(3)\nExpected:\n    [6.18357819545..., 8.45722917442..., 12.6749464170...]\nGot:\n    [-4.13290370521286, 6.18357819545086, 8.45722917442320]\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32037\n\n",
    "created_at": "2021-06-23T03:11:42Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Upgrade to lcalc-2.0.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31800",
    "user": "@orlitzky"
}
```
CC:  @JohnCremona @antonio-rojas @kiwifb @dimpase

I've just tagged a 2.0.0 release of lcalc: https://gitlab.com/sagemath/lcalc/-/tags/2.0.0

There are a few issues that need to be addressed during the upgrade.

1. The build system is now sane. This should make life easier in the long run, but means that spkg-* need to be rewritten. `./configure --with-pari` should suffice.

2. The lcalc spkg shouldn't depend on mpfr (I'm not sure why it ever did).

3. spkg-configure.m4 should be modified to find the new version, for example...


```patch
diff --git a/build/pkgs/lcalc/spkg-configure.m4 b/build/pkgs/lcalc/spkg-configure.m4
index 19a87c8d30..b332294eae 100644
--- a/build/pkgs/lcalc/spkg-configure.m4
+++ b/build/pkgs/lcalc/spkg-configure.m4
@@ -1,20 +1,20 @@
 SAGE_SPKG_CONFIGURE([lcalc], [
-    m4_pushdef([SAGE_LCALC_MINVER],["1.22"])
-    SAGE_SPKG_DEPCHECK([pari mpfr], [
+    m4_pushdef([SAGE_LCALC_MINVER],["2.0.0"])
+    SAGE_SPKG_DEPCHECK([pari], [
         AC_PATH_PROG([LCALC], [lcalc])
         AS_IF([test x$LCALC = x], [
            AC_MSG_NOTICE([lcalc not found. Installing lcalc])
            sage_spkg_install_lcalc=yes], [
            AC_MSG_CHECKING([is lcalc's version good enough? ])
-           lcalc_ver=`$LCALC --version 2>>/dev/null | $SED -e 's/lcalc\ //' | $SED -e 's/\ .*//g'`
+           lcalc_ver=$($LCALC --version 2>>/dev/null | $SED -e 's/lcalc\ //' | cut -d' ' -f2)
            AX_COMPARE_VERSION([$lcalc_ver], [ge], [$SAGE_LCALC_MINVER], [
                AC_MSG_RESULT([yes.])
-               AC_CHECK_HEADER([Lfunction/L.h], [], [sage_spkg_install_lcalc=yes])
+               AC_CHECK_HEADER([lcalc/L.h], [], [sage_spkg_install_lcalc=yes])
           AC_MSG_CHECKING([whether we can link and run a program using libLfunction])
           LCALC_SAVED_LIBS=$LIBS
           LIBS="$LIBS -lLfunction"
           AC_RUN_IFELSE([
-            AC_LANG_PROGRAM([[#include <Lfunction/L.h>]],
+            AC_LANG_PROGRAM([[#include <lcalc/L.h>]],
                       [[initialize_globals();
                         Complex x;
                         x = Pi*I;
```


However, lcalc-2.0.0 comes with a pkg-config file, so we could greatly simplify that.

4. The public API header has moved to `lcalc/L.h`:


```patch
diff --git a/src/sage/libs/lcalc/lcalc_sage.h b/src/sage/libs/lcalc/lcalc_sage.h
index 498528917f..18e5232cbe 100644
--- a/src/sage/libs/lcalc/lcalc_sage.h
+++ b/src/sage/libs/lcalc/lcalc_sage.h
@@ -1,4 +1,4 @@
-#include "Lfunction/L.h"
+#include "lcalc/L.h"
 int *new_ints(int l)
 {
     return new int[l];

```


5. The `find_zeros_via_N_v()` function was removed, and replaced by `find_zeros()`. Here's a patch:


```patch
diff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pxd b/src/sage/libs/lcalc/lcalc_Lfunction.pxd
index d1dbb5d95d..5edf0844f3 100644
--- a/src/sage/libs/lcalc/lcalc_Lfunction.pxd
+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pxd
@@ -21,7 +21,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -38,7 +38,7 @@ cdef extern from "lcalc_sage.h":
         double (* N) (double T)
         double *dirichlet_coefficient
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -54,7 +54,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -70,7 +70,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)#puts result in vector<double> result
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*find_zeros_via_N)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, char *filename) #puts result in filename
 
         #Constructor and destructor
@@ -111,7 +111,7 @@ cdef class Lfunction:
     #strange bug, replacing Double with double gives me a compile error
     cdef Double __typedN(self, double T)
     cdef void __find_zeros_v(self, double T1, double T2, double stepsize,doublevec *result)
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula,doublevec *result)
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
 
     cdef str _repr

```



```patch
diff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pyx b/src/sage/libs/lcalc/lcalc_Lfunction.pyx
index 7e54d7e78d..409987c5d0 100644
--- a/src/sage/libs/lcalc/lcalc_Lfunction.pyx
+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pyx
@@ -307,8 +307,7 @@ cdef class Lfunction:
         return returnvalue
 
     #The default values are from L.h. See L.h
-    def find_zeros_via_N(self, count=0, do_negative=False, max_refine=1025,
-                         rank=-1, test_explicit_formula=0):
+    def find_zeros_via_N(self, count=0, start=0, max_refine=1025, rank=-1):
         """
         Finds ``count`` number of zeros with positive imaginary part
         starting at real axis. This function also verifies that all
@@ -317,8 +316,7 @@ cdef class Lfunction:
         INPUT:
 
         - ``count`` - number of zeros to be found
-        - ``do_negative`` - (default: False) False to ignore zeros below the
-          real axis.
+        - ``start`` - (default: 0) how many initial zeros to skip
         - ``max_refine`` - when some zeros are found to be missing, the step
           size used to find zeros is refined. max_refine gives an upper limit
           on when lcalc should give up. Use default value unless you know
@@ -326,13 +324,9 @@ cdef class Lfunction:
         - ``rank`` - integer (default: -1) analytic rank of the L-function.
           If -1 is passed, then we attempt to compute it. (Use default if in
           doubt)
-        - ``test_explicit_formula`` - integer (default: 0) If nonzero, test
-          the explicit formula for additional confidence that all the zeros
-          have been found and are accurate. This is still being tested, so
-          using the default is recommended.
 
         OUTPUT:
-        
+
         list -- A list of the imaginary parts of the zeros that have been found
 
         EXAMPLES::
@@ -356,14 +350,10 @@ cdef class Lfunction:
             sage: L.find_zeros_via_N(3)
             [14.1347251417..., 21.0220396387..., 25.0108575801...]
         """
-        cdef Integer count_I = Integer(count)
-        cdef Integer do_negative_I = Integer(do_negative)
-        cdef RealNumber max_refine_R = RRR(max_refine)
-        cdef Integer rank_I = Integer(rank)
-        cdef Integer test_explicit_I = Integer(test_explicit_formula)
+        cdef const char *message_stamp = ""
         cdef doublevec result
         sig_on()
-        self.__find_zeros_via_N_v(mpz_get_si(count_I.value), mpz_get_si(do_negative_I.value), mpfr_get_d(max_refine_R.value, MPFR_RNDN), mpz_get_si(rank_I.value), mpz_get_si(test_explicit_I.value), &result)
+        self.__find_zeros(count, start, max_refine, rank, message_stamp, &result)
         sig_off()
         returnvalue = []
         for i in range(result.size()):
@@ -390,7 +380,7 @@ cdef class Lfunction:
     cdef void __find_zeros_v(self,double T1, double T2, double stepsize, doublevec *result):
         raise NotImplementedError
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
         raise NotImplementedError
 
 ##############################################################################
@@ -486,8 +476,8 @@ cdef class Lfunction_I(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_I *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_I *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_I *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -624,8 +614,8 @@ cdef class Lfunction_D(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_D *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_D *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start,double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_D *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -769,8 +759,8 @@ cdef class Lfunction_C:
     cdef double __typedN(self, double T):
         return (<c_Lfunction_C *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_C *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_C *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -854,8 +844,8 @@ cdef class Lfunction_Zeta(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_Zeta *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_Zeta *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_Zeta *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     def __dealloc__(self):
         """
```


6. Some tests need tolerance updates because the answers have changed slightly.

7. Two tests give different answers entirely and require help from someone who knows what an L-function is. These are discussed on #24820 as well:


```
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(.4+.3*I)
Expected:
    0.2166144222685... - 0.00408187127850...*I
Got:
    0.0240947990422036 + 0.215308871779581*I
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 350, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.find_zeros_via_N
Failed example:
    L.find_zeros_via_N(3)
Expected:
    [6.18357819545..., 8.45722917442..., 12.6749464170...]
Got:
    [-4.13290370521286, 6.18357819545086, 8.45722917442320]
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/32037





---

archive/issue_comments_454437.json:
```json
{
    "body": "Uh, a branch please?",
    "created_at": "2021-06-23T05:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454437",
    "user": "@mkoeppe"
}
```

Uh, a branch please?



---

archive/issue_comments_454438.json:
```json
{
    "body": "John, L-functions question here...",
    "created_at": "2021-06-23T08:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454438",
    "user": "@dimpase"
}
```

John, L-functions question here...



---

archive/issue_comments_454439.json:
```json
{
    "body": "For the first doctest, the PARI implementation (only available for real input) gives a different answer at 0:\n\n```\nsage: chi = DirichletGroup(5)[2]                                                \nsage: chi.lfunction().hardy(0)                                                  \n0.793597201093544\n```\n\n\n***EDIT***\n\nbut Pari doc of \"lfunhardy\" says this gives a \"Variant of the Hardy Z-function\"",
    "created_at": "2021-06-23T10:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454439",
    "user": "@fchapoton"
}
```

For the first doctest, the PARI implementation (only available for real input) gives a different answer at 0:

```
sage: chi = DirichletGroup(5)[2]                                                
sage: chi.lfunction().hardy(0)                                                  
0.793597201093544
```


***EDIT***

but Pari doc of "lfunhardy" says this gives a "Variant of the Hardy Z-function"



---

archive/issue_comments_454440.json:
```json
{
    "body": "For the second doctest, the values are indeed zeroes, according to pari :\n\n```\nsage: chi = DirichletGroup(5)[1]                                               \nsage: f = chi.lfunction() \nsage: f(1/2+6.18357819545086*I)                                                 \n2.61452836816118e-15 + 6.48370608217824e-15*I\nsage: f(1/2+8.45722917442320*I)                                                 \n3.51419504210656e-14 - 3.69407271406328e-14*I\nsage: f(1/2-4.13290370521286*I)       \n-4.69010768657543e-15 - 8.53389710587884e-15*I\n```\n\n\n\n***EDIT***\n\nBut that doc says that \"L.find_zeros_via_N(3)\" is supposed to find 3 zeroes, ignoring negative ones !",
    "created_at": "2021-06-23T11:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454440",
    "user": "@fchapoton"
}
```

For the second doctest, the values are indeed zeroes, according to pari :

```
sage: chi = DirichletGroup(5)[1]                                               
sage: f = chi.lfunction() 
sage: f(1/2+6.18357819545086*I)                                                 
2.61452836816118e-15 + 6.48370608217824e-15*I
sage: f(1/2+8.45722917442320*I)                                                 
3.51419504210656e-14 - 3.69407271406328e-14*I
sage: f(1/2-4.13290370521286*I)       
-4.69010768657543e-15 - 8.53389710587884e-15*I
```



***EDIT***

But that doc says that "L.find_zeros_via_N(3)" is supposed to find 3 zeroes, ignoring negative ones !



---

archive/issue_comments_454441.json:
```json
{
    "body": "Replying to [comment:1 mkoeppe]:\n> Uh, a branch please?\n\nI hacked together the minimal changes needed to get this to compile (bonus: it doesn't crash), but all of the patches in the description should be viewed with great suspicion. It will take some more time to sort out the right things to do here.",
    "created_at": "2021-06-23T23:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454441",
    "user": "@orlitzky"
}
```

Replying to [comment:1 mkoeppe]:
> Uh, a branch please?

I hacked together the minimal changes needed to get this to compile (bonus: it doesn't crash), but all of the patches in the description should be viewed with great suspicion. It will take some more time to sort out the right things to do here.



---

archive/issue_comments_454442.json:
```json
{
    "body": "Replying to [comment:5 chapoton]:\n> ***EDIT***\n> \n> But that doc says that \"L.find_zeros_via_N(3)\" is supposed to find 3 zeroes, ignoring negative ones !\n\nThere used to be a parameter called `do_negative` that made it look for zeros with a negative imaginary part, but the new libLfunction computes `do_negative` on its own:\n\n\n```C++\nbool do_negative=is_complex();\n...\ntemplate <class ttype>\nbool L_function <ttype>::\nis_complex(){\n\n    if(my_verbose>2) cout << \"#            start is_complex()\" << endl;\n\n    bool do_negative=false;\n\n    int n=0;\n    if(what_type_L!=-1) //if not the zeta function, check if self dual. If so, do_negative stays false                                                     \n    do{\n        n++;\n        if(abs(imag(Complex(dirichlet_coefficient[n])))>.00001){\n            do_negative=true;\n\t    if(my_verbose>2) cout << \"#            is_complex: Dirichlet co\\\neff \" << n << \" \" << setprecision(DIGITS) << dirichlet_coefficient[n] << endl;\n        }\n\t}while(n<number_of_dirichlet_coefficients&&!do_negative);\n    if(my_verbose>2) cout << \"#            is_complex() = \" << do_negative<\\\n< endl;\n\n    return do_negative;\n\n}\n```\n\n\nSo maybe it's just the documentation that needs to be updated. I don't know what self-dual means, or what it's ultimately checking to make that decision in this case.",
    "created_at": "2021-06-24T00:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454442",
    "user": "@orlitzky"
}
```

Replying to [comment:5 chapoton]:
> ***EDIT***
> 
> But that doc says that "L.find_zeros_via_N(3)" is supposed to find 3 zeroes, ignoring negative ones !

There used to be a parameter called `do_negative` that made it look for zeros with a negative imaginary part, but the new libLfunction computes `do_negative` on its own:


```C++
bool do_negative=is_complex();
...
template <class ttype>
bool L_function <ttype>::
is_complex(){

    if(my_verbose>2) cout << "#            start is_complex()" << endl;

    bool do_negative=false;

    int n=0;
    if(what_type_L!=-1) //if not the zeta function, check if self dual. If so, do_negative stays false                                                     
    do{
        n++;
        if(abs(imag(Complex(dirichlet_coefficient[n])))>.00001){
            do_negative=true;
	    if(my_verbose>2) cout << "#            is_complex: Dirichlet co\
eff " << n << " " << setprecision(DIGITS) << dirichlet_coefficient[n] << endl;
        }
	}while(n<number_of_dirichlet_coefficients&&!do_negative);
    if(my_verbose>2) cout << "#            is_complex() = " << do_negative<\
< endl;

    return do_negative;

}
```


So maybe it's just the documentation that needs to be updated. I don't know what self-dual means, or what it's ultimately checking to make that decision in this case.



---

archive/issue_comments_454443.json:
```json
{
    "body": "FWIW, here is my reading of this code: If all of the coefficients of the Dirichlet series are real (up to a tolerance of `.00001`), then the conjugate of any root is also a root.  (This is what \"self-dual\" must mean.) We do not need to look for roots below the real axis in this case (because they are conjugates of roots that are above the real axis), so `do_negative` is set to `False`. Otherwise, `do_negative` is set to `True`.\n\nReplying to [comment:7 mjo]:\n> Replying to [comment:5 chapoton]:\n> ...\n> So maybe it's just the documentation that needs to be updated. I don't know what self-dual means, or what it's ultimately checking to make that decision in this case.",
    "created_at": "2021-06-24T02:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454443",
    "user": "@DaveWitteMorris"
}
```

FWIW, here is my reading of this code: If all of the coefficients of the Dirichlet series are real (up to a tolerance of `.00001`), then the conjugate of any root is also a root.  (This is what "self-dual" must mean.) We do not need to look for roots below the real axis in this case (because they are conjugates of roots that are above the real axis), so `do_negative` is set to `False`. Otherwise, `do_negative` is set to `True`.

Replying to [comment:7 mjo]:
> Replying to [comment:5 chapoton]:
> ...
> So maybe it's just the documentation that needs to be updated. I don't know what self-dual means, or what it's ultimately checking to make that decision in this case.



---

archive/issue_comments_454444.json:
```json
{
    "body": "here is a first branch, just changing version, checksums and lcalc_sage.h\n----\nNew commits:",
    "created_at": "2021-06-24T07:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454444",
    "user": "@fchapoton"
}
```

here is a first branch, just changing version, checksums and lcalc_sage.h
----
New commits:



---

archive/issue_comments_454445.json:
```json
{
    "body": "should we remove all the old patches ?",
    "created_at": "2021-06-24T07:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454445",
    "user": "@fchapoton"
}
```

should we remove all the old patches ?



---

archive/issue_comments_454446.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> should we remove all the old patches ?\n\nYep, all patches are obsolete. The spkg-install.in should now be,\n\n\n```\nsdh_configure --with-pari\nsdh_make_install\n```\n\n\nand we can add an spkg-check.in containing,\n\n\n```\nsdh_make_check\n```\n",
    "created_at": "2021-06-24T12:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454446",
    "user": "@orlitzky"
}
```

Replying to [comment:10 chapoton]:
> should we remove all the old patches ?

Yep, all patches are obsolete. The spkg-install.in should now be,


```
sdh_configure --with-pari
sdh_make_install
```


and we can add an spkg-check.in containing,


```
sdh_make_check
```




---

archive/issue_comments_454447.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T15:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454447",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454448.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T15:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454448",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454449",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454450.json:
```json
{
    "body": "should we \"cd src\" in spkg-install ?\n\nI have not managed to install so far with the current branch, \"sage -i lcalc\" complains as follows\n\n```\n[lcalc-2.0.0] Uninstalling 'lcalc' with legacy uninstaller\n[lcalc-2.0.0] Package 'lcalc' is currently not installed\n[lcalc-2.0.0] Now building lcalc, example programs and the shared library...\n[lcalc-2.0.0] Building lcalc-2.0.0\n[lcalc-2.0.0] make[3]: *** No targets specified and no makefile found.  Stop.\n```\n",
    "created_at": "2021-06-24T17:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454450",
    "user": "@fchapoton"
}
```

should we "cd src" in spkg-install ?

I have not managed to install so far with the current branch, "sage -i lcalc" complains as follows

```
[lcalc-2.0.0] Uninstalling 'lcalc' with legacy uninstaller
[lcalc-2.0.0] Package 'lcalc' is currently not installed
[lcalc-2.0.0] Now building lcalc, example programs and the shared library...
[lcalc-2.0.0] Building lcalc-2.0.0
[lcalc-2.0.0] make[3]: *** No targets specified and no makefile found.  Stop.
```




---

archive/issue_comments_454451.json:
```json
{
    "body": "I don't understand anything about the build system, so it's likely that this is noise (in which case I apologize), but [dimpase says](https://groups.google.com/g/sage-devel/c/euE9MJnfjAo/m/XOB7X1TxBQAJ) not to use \"sage -i\":\n\n```\nwe are trying to switch to a sane building scheme:\n\n./bootstrap\n./configure\nmake build\nmake pynormaliz\n\nsage -i is an old hack noone should use...\n```\n\nSo maybe you are supposed to try \"make lcalc\" ?",
    "created_at": "2021-06-24T18:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454451",
    "user": "@DaveWitteMorris"
}
```

I don't understand anything about the build system, so it's likely that this is noise (in which case I apologize), but [dimpase says](https://groups.google.com/g/sage-devel/c/euE9MJnfjAo/m/XOB7X1TxBQAJ) not to use "sage -i":

```
we are trying to switch to a sane building scheme:

./bootstrap
./configure
make build
make pynormaliz

sage -i is an old hack noone should use...
```

So maybe you are supposed to try "make lcalc" ?



---

archive/issue_comments_454452.json:
```json
{
    "body": "Replying to [comment:15 chapoton]:\n> should we \"cd src\" in spkg-install ?\nyes",
    "created_at": "2021-06-24T18:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454452",
    "user": "@mkoeppe"
}
```

Replying to [comment:15 chapoton]:
> should we "cd src" in spkg-install ?
yes



---

archive/issue_comments_454453.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T22:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454453",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454454.json:
```json
{
    "body": "Should .m4 files mix tabs and spaces?",
    "created_at": "2021-06-24T23:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454454",
    "user": "@slel"
}
```

Should .m4 files mix tabs and spaces?



---

archive/issue_comments_454455.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T23:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454455",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454456.json:
```json
{
    "body": "Replying to [comment:19 slelievre]:\n> Should .m4 files mix tabs and spaces?\n\nAccording to me, no. According to emacs, at every opportunity.",
    "created_at": "2021-06-24T23:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454456",
    "user": "@orlitzky"
}
```

Replying to [comment:19 slelievre]:
> Should .m4 files mix tabs and spaces?

According to me, no. According to emacs, at every opportunity.



---

archive/issue_comments_454457.json:
```json
{
    "body": "Using \"make lcalc\", I am still not able to build, with or without \"cd src\".\n\nComplains of missing makefile, as in comment:17",
    "created_at": "2021-06-25T09:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454457",
    "user": "@fchapoton"
}
```

Using "make lcalc", I am still not able to build, with or without "cd src".

Complains of missing makefile, as in comment:17



---

archive/issue_comments_454458.json:
```json
{
    "body": "Replying to [comment:22 chapoton]:\n> Using \"make lcalc\", I am still not able to build, with or without \"cd src\".\n> \n> Complains of missing makefile, as in comment:17\n\nI think you have to get rid of `spkg-build.in`, too.",
    "created_at": "2021-06-25T14:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454458",
    "user": "@orlitzky"
}
```

Replying to [comment:22 chapoton]:
> Using "make lcalc", I am still not able to build, with or without "cd src".
> 
> Complains of missing makefile, as in comment:17

I think you have to get rid of `spkg-build.in`, too.



---

archive/issue_comments_454459.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T15:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454459",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454460.json:
```json
{
    "body": "ok, now \"make lcalc\" starts doing something and stops at\n\n```\n[lcalc-2.0.0] Thread model: posix\n[lcalc-2.0.0] gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) \n...\n[lcalc-2.0.0] checking for gengetopt... no\n[lcalc-2.0.0] configure: error: GNU gengetopt is required\n```\n",
    "created_at": "2021-06-25T15:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454460",
    "user": "@fchapoton"
}
```

ok, now "make lcalc" starts doing something and stops at

```
[lcalc-2.0.0] Thread model: posix
[lcalc-2.0.0] gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) 
...
[lcalc-2.0.0] checking for gengetopt... no
[lcalc-2.0.0] configure: error: GNU gengetopt is required
```




---

archive/issue_comments_454461.json:
```json
{
    "body": "Well the good news is that it's supposed to do that, but the bad news is that we'll have to add another gengetopt SPKG for lcalc to depend on.",
    "created_at": "2021-06-25T17:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454461",
    "user": "@orlitzky"
}
```

Well the good news is that it's supposed to do that, but the bad news is that we'll have to add another gengetopt SPKG for lcalc to depend on.



---

archive/issue_comments_454462.json:
```json
{
    "body": "I posted a branch for review on #32061 to add the missing dependency.",
    "created_at": "2021-06-25T18:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454462",
    "user": "@orlitzky"
}
```

I posted a branch for review on #32061 to add the missing dependency.



---

archive/issue_comments_454463.json:
```json
{
    "body": "I figured out how to fix the build scripts... and then found a typo in the upstream configure.ac that I had to release a 2.0.1 to fix. I think this will actually work now.",
    "created_at": "2021-06-26T00:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454463",
    "user": "@orlitzky"
}
```

I figured out how to fix the build scripts... and then found a typo in the upstream configure.ac that I had to release a 2.0.1 to fix. I think this will actually work now.



---

archive/issue_comments_454464.json:
```json
{
    "body": "Replying to [comment:8 gh-DaveWitteMorris]:\n> FWIW, here is my reading of this code: If all of the coefficients of the Dirichlet series are real (up to a tolerance of `.00001`), then the conjugate of any root is also a root.  (This is what \"self-dual\" must mean.) We do not need to look for roots below the real axis in this case (because they are conjugates of roots that are above the real axis), so `do_negative` is set to `False`. Otherwise, `do_negative` is set to `True`.\n\nThese functions are supposed to \"return the first `n` zeros.\" That's vague, but scrutable if you're starting from the real axis and moving up: basically, the numbers (imaginary parts) it outputs get bigger. I guess when `do_negative` is true, we output the first `n` zeros in *magnitude*?",
    "created_at": "2021-06-26T00:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454464",
    "user": "@orlitzky"
}
```

Replying to [comment:8 gh-DaveWitteMorris]:
> FWIW, here is my reading of this code: If all of the coefficients of the Dirichlet series are real (up to a tolerance of `.00001`), then the conjugate of any root is also a root.  (This is what "self-dual" must mean.) We do not need to look for roots below the real axis in this case (because they are conjugates of roots that are above the real axis), so `do_negative` is set to `False`. Otherwise, `do_negative` is set to `True`.

These functions are supposed to "return the first `n` zeros." That's vague, but scrutable if you're starting from the real axis and moving up: basically, the numbers (imaginary parts) it outputs get bigger. I guess when `do_negative` is true, we output the first `n` zeros in *magnitude*?



---

archive/issue_comments_454465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-26T13:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-28T02:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454466",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454467.json:
```json
{
    "body": "Replying to [comment:29 mjo]:\n> Replying to [comment:8 gh-DaveWitteMorris]:\n>> ... I guess when `do_negative` is true, we output the first `n` zeros in *magnitude*?\n\nYes, I'm pretty sure that is correct. For example, a comment introducing the `find_zeros` function says \"Finds zeros of L(1/2+It) or of L(1/2+It)*L(1/2-It) (depending on whether self dual or not)\". (The second form will combine the zeros with negative imaginary into the ones with positive imaginary part.) And a comment in the code of the function says \"in the self dual case we only count half the zeros with |t|<T\".",
    "created_at": "2021-06-29T00:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454467",
    "user": "@DaveWitteMorris"
}
```

Replying to [comment:29 mjo]:
> Replying to [comment:8 gh-DaveWitteMorris]:
>> ... I guess when `do_negative` is true, we output the first `n` zeros in *magnitude*?

Yes, I'm pretty sure that is correct. For example, a comment introducing the `find_zeros` function says "Finds zeros of L(1/2+It) or of L(1/2+It)*L(1/2-It) (depending on whether self dual or not)". (The second form will combine the zeros with negative imaginary into the ones with positive imaginary part.) And a comment in the code of the function says "in the self dual case we only count half the zeros with |t|<T".



---

archive/issue_comments_454468.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-01T19:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454468",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-02T23:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454469",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454470.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T12:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454470",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T12:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-03T12:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454472",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454473.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-03T12:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454473",
    "user": "@orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454474.json:
```json
{
    "body": "I've fixed all of the problems I know about, and deleted the one remaining failing doctest that no one knows what to do with. Pending a ptestlong, I think it's ready for a serious look.",
    "created_at": "2021-07-03T12:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454474",
    "user": "@orlitzky"
}
```

I've fixed all of the problems I know about, and deleted the one remaining failing doctest that no one knows what to do with. Pending a ptestlong, I think it's ready for a serious look.



---

archive/issue_comments_454475.json:
```json
{
    "body": "The branch is red. Is there a merge conflict?",
    "created_at": "2021-07-03T18:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454475",
    "user": "@DaveWitteMorris"
}
```

The branch is red. Is there a merge conflict?



---

archive/issue_comments_454476.json:
```json
{
    "body": "Replying to [comment:41 gh-DaveWitteMorris]:\n> The branch is red. Is there a merge conflict?\n\nProbably the gcc-11 patch that was added for the lcalc SPKG before sage-9.4. I can rebase after my ptestlong finishes.",
    "created_at": "2021-07-03T18:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454476",
    "user": "@orlitzky"
}
```

Replying to [comment:41 gh-DaveWitteMorris]:
> The branch is red. Is there a merge conflict?

Probably the gcc-11 patch that was added for the lcalc SPKG before sage-9.4. I can rebase after my ptestlong finishes.



---

archive/issue_comments_454477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T21:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454477",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T21:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454478",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454479.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-04T08:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454479",
    "user": "@antonio-rojas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454480.json:
```json
{
    "body": "Doesn't merge cleanly on current develop, please rebase",
    "created_at": "2021-07-04T08:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454480",
    "user": "@antonio-rojas"
}
```

Doesn't merge cleanly on current develop, please rebase



---

archive/issue_comments_454481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-07-04T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454481",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454482.json:
```json
{
    "body": "should be ok now",
    "created_at": "2021-07-04T12:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454482",
    "user": "@orlitzky"
}
```

should be ok now



---

archive/issue_comments_454483.json:
```json
{
    "body": "This breaks build of sagelib with GCC 11, which worked fine with 1.23 (will all patches on top)\n\n\n```\nIn file included from /usr/include/lcalc/Lglobals.h:70,\n                 from /usr/include/lcalc/L.h:43,\n                 from build/cythonized/sage/libs/lcalc/lcalc_sage.h:1,\n                 from build/cythonized/sage/libs/lcalc/lcalc_Lfunction.cpp:676:\n/usr/include/c++/11.1.0/limits: In static member function \u2018static constexpr double std::numeric_limits<double>::min()\u2019:\n/usr/include/c++/11.1.0/limits:1748:44: error: call to non-\u2018constexpr\u2019 function \u2018double lcalc_to_double(const long double&)\u2019\n 1748 |       min() _GLIBCXX_USE_NOEXCEPT { return __DBL_MIN__; }\n      |                                            ^~~~~~~~~~~\n/usr/include/lcalc/Lcommon.h:35:15: note: \u2018double lcalc_to_double(const long double&)\u2019 declared here\n   35 | inline double lcalc_to_double(const long double& x) { return x; }\n      |               ^~~~~~~~~~~~~~~\n```\n",
    "created_at": "2021-07-04T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454483",
    "user": "@antonio-rojas"
}
```

This breaks build of sagelib with GCC 11, which worked fine with 1.23 (will all patches on top)


```
In file included from /usr/include/lcalc/Lglobals.h:70,
                 from /usr/include/lcalc/L.h:43,
                 from build/cythonized/sage/libs/lcalc/lcalc_sage.h:1,
                 from build/cythonized/sage/libs/lcalc/lcalc_Lfunction.cpp:676:
/usr/include/c++/11.1.0/limits: In static member function ‘static constexpr double std::numeric_limits<double>::min()’:
/usr/include/c++/11.1.0/limits:1748:44: error: call to non-‘constexpr’ function ‘double lcalc_to_double(const long double&)’
 1748 |       min() _GLIBCXX_USE_NOEXCEPT { return __DBL_MIN__; }
      |                                            ^~~~~~~~~~~
/usr/include/lcalc/Lcommon.h:35:15: note: ‘double lcalc_to_double(const long double&)’ declared here
   35 | inline double lcalc_to_double(const long double& x) { return x; }
      |               ^~~~~~~~~~~~~~~
```




---

archive/issue_comments_454484.json:
```json
{
    "body": "Ok, thanks, I'll have to investigate after the holiday (it would take more than a day to build gcc-11 on my laptop). The absence of `constexpr` in lcalc is \"correct,\" since lcalc can use MPFR for its double type and the MPFR type is not a constexpr.",
    "created_at": "2021-07-04T13:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454484",
    "user": "@orlitzky"
}
```

Ok, thanks, I'll have to investigate after the holiday (it would take more than a day to build gcc-11 on my laptop). The absence of `constexpr` in lcalc is "correct," since lcalc can use MPFR for its double type and the MPFR type is not a constexpr.



---

archive/issue_comments_454485.json:
```json
{
    "body": "we can add archlinux, or some other way to get gcc 11, on  lcalc CI.\n\nhttps://stackoverflow.com/a/67406788/557937\n\n\nwe can make a macro expanding to constexpr or to \"\", and set it up at configure time.",
    "created_at": "2021-07-04T16:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454485",
    "user": "@dimpase"
}
```

we can add archlinux, or some other way to get gcc 11, on  lcalc CI.

https://stackoverflow.com/a/67406788/557937


we can make a macro expanding to constexpr or to "", and set it up at configure time.



---

archive/issue_comments_454486.json:
```json
{
    "body": "I'm still not 100% sure what's going on, but this is a `-std=c++11` problem and not a gcc-11 problem. If you let gcc-11 pick the standard, everything works. But if you specify `-std=c++11`, then even the following trivial program will fail,\n\n\n```C\n#include <lcalc/L.h>\n```\n\n\nThe errors suggest that somehow `lcalc_to_double()` from lcalc is being invoked in the C++ standard library's `min()` function that's just trying to return a constant:\n\n\n```\nIn file included from /usr/include/lcalc/Lglobals.h:70,\n                 from /usr/include/lcalc/L.h:43,\n                 from conftest.cpp:1:\n/usr/lib/gcc/x86_64-pc-linux-gnu/11.1.0/include/g++-v11/limits: In static member function 'static constexpr double std::numeric_limits<double>::min()':\n/usr/lib/gcc/x86_64-pc-linux-gnu/11.1.0/include/g++-v11/limits:1748:44: error: call to non-'constexpr' function 'double lcalc_to_double(const long double&)'\n 1748 |       min() _GLIBCXX_USE_NOEXCEPT { return __DBL_MIN__; }\n```\n",
    "created_at": "2021-07-05T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454486",
    "user": "@orlitzky"
}
```

I'm still not 100% sure what's going on, but this is a `-std=c++11` problem and not a gcc-11 problem. If you let gcc-11 pick the standard, everything works. But if you specify `-std=c++11`, then even the following trivial program will fail,


```C
#include <lcalc/L.h>
```


The errors suggest that somehow `lcalc_to_double()` from lcalc is being invoked in the C++ standard library's `min()` function that's just trying to return a constant:


```
In file included from /usr/include/lcalc/Lglobals.h:70,
                 from /usr/include/lcalc/L.h:43,
                 from conftest.cpp:1:
/usr/lib/gcc/x86_64-pc-linux-gnu/11.1.0/include/g++-v11/limits: In static member function 'static constexpr double std::numeric_limits<double>::min()':
/usr/lib/gcc/x86_64-pc-linux-gnu/11.1.0/include/g++-v11/limits:1748:44: error: call to non-'constexpr' function 'double lcalc_to_double(const long double&)'
 1748 |       min() _GLIBCXX_USE_NOEXCEPT { return __DBL_MIN__; }
```




---

archive/issue_comments_454487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-05T14:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454487",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454488.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-05T14:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454488",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454489.json:
```json
{
    "body": "There was a recent change that started adding `-std=gnu++11` to our `CXXFLAGS` and broke lcalc. I released lcalc-2.0.2 which should work again.",
    "created_at": "2021-07-05T14:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454489",
    "user": "@orlitzky"
}
```

There was a recent change that started adding `-std=gnu++11` to our `CXXFLAGS` and broke lcalc. I released lcalc-2.0.2 which should work again.



---

archive/issue_comments_454490.json:
```json
{
    "body": "I confirm sagelib builds fine again with GCC 11",
    "created_at": "2021-07-05T15:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454490",
    "user": "@antonio-rojas"
}
```

I confirm sagelib builds fine again with GCC 11



---

archive/issue_comments_454491.json:
```json
{
    "body": "what change was adding the -std=gnu++11 ?\n\nit is certainly important that all the Sage  C++ libs are compatible wrt to C++ ABI.",
    "created_at": "2021-07-05T15:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454491",
    "user": "@dimpase"
}
```

what change was adding the -std=gnu++11 ?

it is certainly important that all the Sage  C++ libs are compatible wrt to C++ ABI.



---

archive/issue_comments_454492.json:
```json
{
    "body": "I haven't followed the discussion on the ticket, but if a specific C++ standard is needed to use the headers, then it is best to declare it in the `.pxd` file using `distutils: extra_compile_args=-std=c++11`.\n\n`sage_setup.command.sage_build_cython` does set this as a default - but I consider this only legacy behavior of our homegrown build system for sagelib. \n\nIt will have to be tested with `./configure --enable-editable`, which switches the sagelib build to a simpler build system.",
    "created_at": "2021-07-05T16:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454492",
    "user": "@mkoeppe"
}
```

I haven't followed the discussion on the ticket, but if a specific C++ standard is needed to use the headers, then it is best to declare it in the `.pxd` file using `distutils: extra_compile_args=-std=c++11`.

`sage_setup.command.sage_build_cython` does set this as a default - but I consider this only legacy behavior of our homegrown build system for sagelib. 

It will have to be tested with `./configure --enable-editable`, which switches the sagelib build to a simpler build system.



---

archive/issue_comments_454493.json:
```json
{
    "body": "Replying to [comment:55 dimpase]:\n> what change was adding the -std=gnu++11 ?\n\nThe switch to c++11 is actually pretty old (see e.g. 370c03505f290f). What must have changed is that `-std=gnu++11` started being added earlier in the build process, before we try to detect lcalc (I know *something* changed because detecting lcalc-2.0.1 used to work before I rebased onto develop). Regardless, adding the flag early is the right thing to do if we're ultimately going to be compiling code against these libraries with `-std=gnu++11` in `CXXFLAGS`.\n\nFor me now, that flag gets added while detecting GCC.",
    "created_at": "2021-07-06T15:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454493",
    "user": "@orlitzky"
}
```

Replying to [comment:55 dimpase]:
> what change was adding the -std=gnu++11 ?

The switch to c++11 is actually pretty old (see e.g. 370c03505f290f). What must have changed is that `-std=gnu++11` started being added earlier in the build process, before we try to detect lcalc (I know *something* changed because detecting lcalc-2.0.1 used to work before I rebased onto develop). Regardless, adding the flag early is the right thing to do if we're ultimately going to be compiling code against these libraries with `-std=gnu++11` in `CXXFLAGS`.

For me now, that flag gets added while detecting GCC.



---

archive/issue_comments_454494.json:
```json
{
    "body": "Replying to [comment:56 mkoeppe]:\n> I haven't followed the discussion on the ticket, but if a specific C++ standard is needed to use the headers, then it is best to declare it in the `.pxd` file using `distutils: extra_compile_args=-std=c++11`.\n\nNo special flags are needed. The latest lcalc-2.0.2 will work with any of the 11, 14, or 17 standards.",
    "created_at": "2021-07-06T15:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454494",
    "user": "@orlitzky"
}
```

Replying to [comment:56 mkoeppe]:
> I haven't followed the discussion on the ticket, but if a specific C++ standard is needed to use the headers, then it is best to declare it in the `.pxd` file using `distutils: extra_compile_args=-std=c++11`.

No special flags are needed. The latest lcalc-2.0.2 will work with any of the 11, 14, or 17 standards.



---

archive/issue_comments_454495.json:
```json
{
    "body": "With my distro packages, getting one test failure only\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/lfunctions/zero_sums.pyx\", line 832, in sage.lfunctions.zero_sums.LFunctionZeroSum_abstract._zerosum_cauchy\nFailed example:\n    E.lseries().zeros(2)\nExpected:\n    [6.36261389, 8.60353962]\nGot:\n    [6.36261390, 8.60353962]\n**********************************************************************\n```\n",
    "created_at": "2021-07-07T06:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454495",
    "user": "@antonio-rojas"
}
```

With my distro packages, getting one test failure only

```
File "/usr/lib/python3.9/site-packages/sage/lfunctions/zero_sums.pyx", line 832, in sage.lfunctions.zero_sums.LFunctionZeroSum_abstract._zerosum_cauchy
Failed example:
    E.lseries().zeros(2)
Expected:
    [6.36261389, 8.60353962]
Got:
    [6.36261390, 8.60353962]
**********************************************************************
```




---

archive/issue_comments_454496.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T11:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454496",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454497.json:
```json
{
    "body": "tests run on https://github.com/sagemath/sagetrac-mirror/actions/runs/1009717554",
    "created_at": "2021-07-07T22:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454497",
    "user": "@dimpase"
}
```

tests run on https://github.com/sagemath/sagetrac-mirror/actions/runs/1009717554



---

archive/issue_comments_454498.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-07-13T18:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454498",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454499.json:
```json
{
    "body": "I accidentally broke the soname in the last version, so here's v2.0.3 to fix it. Also rebased onto the latest gengetopt branch.",
    "created_at": "2021-07-13T18:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454499",
    "user": "@orlitzky"
}
```

I accidentally broke the soname in the last version, so here's v2.0.3 to fix it. Also rebased onto the latest gengetopt branch.



---

archive/issue_comments_454500.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-19T12:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454500",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454501.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-29T06:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454501",
    "user": "@antonio-rojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454502.json:
```json
{
    "body": "I've been shipping this downstream for 3 months without issues",
    "created_at": "2021-10-29T06:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454502",
    "user": "@antonio-rojas"
}
```

I've been shipping this downstream for 3 months without issues



---

archive/issue_comments_454503.json:
```json
{
    "body": "Ticket description should be cleaned up",
    "created_at": "2021-10-29T06:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454503",
    "user": "@mkoeppe"
}
```

Ticket description should be cleaned up



---

archive/issue_comments_454504.json:
```json
{
    "body": "I tried to reduce the ticket description to a digest.\n\nNot sure what the conclusion was on item 7, so I left that out.\n\nThe ticket description from before my edit is reproduced below.\n\n-----\n\nI've just tagged a 2.0.3 release of lcalc: https://gitlab.com/sagemath/lcalc/-/tags/2.0.3\n\nThere are a few issues that need to be addressed during the upgrade.\n\n0. The build requires GNU gengetopt, so we'll need a new gengetopt SPKG for lcalc to depend on. (It doesn't need to go in the DEPCHECK macro though, since it's a build-only dependency.)\n1. The build system is now sane. This should make life easier in the long run, but means that spkg-* need to be rewritten. `./configure --with-pari` should suffice.\n\n2. The lcalc spkg shouldn't depend on mpfr (I'm not sure why it ever did).\n\n3. spkg-configure.m4 should be modified to find the new version, for example...\n\n\n```patch\ndiff --git a/build/pkgs/lcalc/spkg-configure.m4 b/build/pkgs/lcalc/spkg-configure.m4\nindex 19a87c8d30..b332294eae 100644\n--- a/build/pkgs/lcalc/spkg-configure.m4\n+++ b/build/pkgs/lcalc/spkg-configure.m4\n@@ -1,20 +1,20 @@\n SAGE_SPKG_CONFIGURE([lcalc], [\n-    m4_pushdef([SAGE_LCALC_MINVER],[\"1.22\"])\n-    SAGE_SPKG_DEPCHECK([pari mpfr], [\n+    m4_pushdef([SAGE_LCALC_MINVER],[\"2.0.0\"])\n+    SAGE_SPKG_DEPCHECK([pari], [\n         AC_PATH_PROG([LCALC], [lcalc])\n         AS_IF([test x$LCALC = x], [\n            AC_MSG_NOTICE([lcalc not found. Installing lcalc])\n            sage_spkg_install_lcalc=yes], [\n            AC_MSG_CHECKING([is lcalc's version good enough? ])\n-           lcalc_ver=`$LCALC --version 2>>/dev/null | $SED -e 's/lcalc\\ //' | $SED -e 's/\\ .*//g'`\n+           lcalc_ver=$($LCALC --version 2>>/dev/null | $SED -e 's/lcalc\\ //' | cut -d' ' -f2)\n            AX_COMPARE_VERSION([$lcalc_ver], [ge], [$SAGE_LCALC_MINVER], [\n                AC_MSG_RESULT([yes.])\n-               AC_CHECK_HEADER([Lfunction/L.h], [], [sage_spkg_install_lcalc=yes])\n+               AC_CHECK_HEADER([lcalc/L.h], [], [sage_spkg_install_lcalc=yes])\n           AC_MSG_CHECKING([whether we can link and run a program using libLfunction])\n           LCALC_SAVED_LIBS=$LIBS\n           LIBS=\"$LIBS -lLfunction\"\n           AC_RUN_IFELSE([\n-            AC_LANG_PROGRAM([[#include <Lfunction/L.h>]],\n+            AC_LANG_PROGRAM([[#include <lcalc/L.h>]],\n                       [[initialize_globals();\n                         Complex x;\n                         x = Pi*I;\n```\n\n\nHowever, lcalc-2.0.0 comes with a pkg-config file, so we could greatly simplify that.\n\n4. The public API header has moved to `lcalc/L.h`:\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_sage.h b/src/sage/libs/lcalc/lcalc_sage.h\nindex 498528917f..18e5232cbe 100644\n--- a/src/sage/libs/lcalc/lcalc_sage.h\n+++ b/src/sage/libs/lcalc/lcalc_sage.h\n@@ -1,4 +1,4 @@\n-#include \"Lfunction/L.h\"\n+#include \"lcalc/L.h\"\n int *new_ints(int l)\n {\n     return new int[l];\n\n```\n\n\n5. The `find_zeros_via_N_v()` function was removed, and replaced by `find_zeros()`. Here's a patch:\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pxd b/src/sage/libs/lcalc/lcalc_Lfunction.pxd\nindex d1dbb5d95d..5edf0844f3 100644\n--- a/src/sage/libs/lcalc/lcalc_Lfunction.pxd\n+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pxd\n@@ -21,7 +21,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -38,7 +38,7 @@ cdef extern from \"lcalc_sage.h\":\n         double (* N) (double T)\n         double *dirichlet_coefficient\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -54,7 +54,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*print_data_L)()\n \n         #Constructor and destructor\n@@ -70,7 +70,7 @@ cdef extern from \"lcalc_sage.h\":\n         int (* compute_rank) ()\n         double (* N) (double T)\n         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )\n-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)#puts result in vector<double> result\n+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n         void (*find_zeros_via_N)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, char *filename) #puts result in filename\n \n         #Constructor and destructor\n@@ -111,7 +111,7 @@ cdef class Lfunction:\n     #strange bug, replacing Double with double gives me a compile error\n     cdef Double __typedN(self, double T)\n     cdef void __find_zeros_v(self, double T1, double T2, double stepsize,doublevec *result)\n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula,doublevec *result)\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)\n \n     cdef str _repr\n\n```\n\n\n\n```patch\ndiff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pyx b/src/sage/libs/lcalc/lcalc_Lfunction.pyx\nindex 7e54d7e78d..409987c5d0 100644\n--- a/src/sage/libs/lcalc/lcalc_Lfunction.pyx\n+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pyx\n@@ -307,8 +307,7 @@ cdef class Lfunction:\n         return returnvalue\n \n     #The default values are from L.h. See L.h\n-    def find_zeros_via_N(self, count=0, do_negative=False, max_refine=1025,\n-                         rank=-1, test_explicit_formula=0):\n+    def find_zeros_via_N(self, count=0, start=0, max_refine=1025, rank=-1):\n         \"\"\"\n         Finds ``count`` number of zeros with positive imaginary part\n         starting at real axis. This function also verifies that all\n@@ -317,8 +316,7 @@ cdef class Lfunction:\n         INPUT:\n \n         - ``count`` - number of zeros to be found\n-        - ``do_negative`` - (default: False) False to ignore zeros below the\n-          real axis.\n+        - ``start`` - (default: 0) how many initial zeros to skip\n         - ``max_refine`` - when some zeros are found to be missing, the step\n           size used to find zeros is refined. max_refine gives an upper limit\n           on when lcalc should give up. Use default value unless you know\n@@ -326,13 +324,9 @@ cdef class Lfunction:\n         - ``rank`` - integer (default: -1) analytic rank of the L-function.\n           If -1 is passed, then we attempt to compute it. (Use default if in\n           doubt)\n-        - ``test_explicit_formula`` - integer (default: 0) If nonzero, test\n-          the explicit formula for additional confidence that all the zeros\n-          have been found and are accurate. This is still being tested, so\n-          using the default is recommended.\n \n         OUTPUT:\n-        \n+\n         list -- A list of the imaginary parts of the zeros that have been found\n \n         EXAMPLES::\n@@ -356,14 +350,10 @@ cdef class Lfunction:\n             sage: L.find_zeros_via_N(3)\n             [14.1347251417..., 21.0220396387..., 25.0108575801...]\n         \"\"\"\n-        cdef Integer count_I = Integer(count)\n-        cdef Integer do_negative_I = Integer(do_negative)\n-        cdef RealNumber max_refine_R = RRR(max_refine)\n-        cdef Integer rank_I = Integer(rank)\n-        cdef Integer test_explicit_I = Integer(test_explicit_formula)\n+        cdef const char *message_stamp = \"\"\n         cdef doublevec result\n         sig_on()\n-        self.__find_zeros_via_N_v(mpz_get_si(count_I.value), mpz_get_si(do_negative_I.value), mpfr_get_d(max_refine_R.value, MPFR_RNDN), mpz_get_si(rank_I.value), mpz_get_si(test_explicit_I.value), &result)\n+        self.__find_zeros(count, start, max_refine, rank, message_stamp, &result)\n         sig_off()\n         returnvalue = []\n         for i in range(result.size()):\n@@ -390,7 +380,7 @@ cdef class Lfunction:\n     cdef void __find_zeros_v(self,double T1, double T2, double stepsize, doublevec *result):\n         raise NotImplementedError\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n         raise NotImplementedError\n \n ##############################################################################\n@@ -486,8 +476,8 @@ cdef class Lfunction_I(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_I *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_I *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_I *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -624,8 +614,8 @@ cdef class Lfunction_D(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_D *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_D *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start,double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_D *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -769,8 +759,8 @@ cdef class Lfunction_C:\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_C *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_C *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_C *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     # debug tools\n     def _print_data_to_standard_output(self):\n@@ -854,8 +844,8 @@ cdef class Lfunction_Zeta(Lfunction):\n     cdef double __typedN(self, double T):\n         return (<c_Lfunction_Zeta *>self.thisptr).N(T)\n \n-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):\n-        (<c_Lfunction_Zeta *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])\n+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):\n+        (<c_Lfunction_Zeta *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)\n \n     def __dealloc__(self):\n         \"\"\"\n```\n\n\n6. Some tests need tolerance updates because the answers have changed slightly.\n\n7. Two tests give different answers entirely and require help from someone who knows what an L-function is. These are discussed on #24820 as well:\n\n\n```\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\nFailed example:\n    L.hardy_z_function(.4+.3*I)\nExpected:\n    0.2166144222685... - 0.00408187127850...*I\nGot:\n    0.0240947990422036 + 0.215308871779581*I\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 350, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.find_zeros_via_N\nFailed example:\n    L.find_zeros_via_N(3)\nExpected:\n    [6.18357819545..., 8.45722917442..., 12.6749464170...]\nGot:\n    [-4.13290370521286, 6.18357819545086, 8.45722917442320]\n**********************************************************************\n```\n",
    "created_at": "2021-10-29T15:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454504",
    "user": "@slel"
}
```

I tried to reduce the ticket description to a digest.

Not sure what the conclusion was on item 7, so I left that out.

The ticket description from before my edit is reproduced below.

-----

I've just tagged a 2.0.3 release of lcalc: https://gitlab.com/sagemath/lcalc/-/tags/2.0.3

There are a few issues that need to be addressed during the upgrade.

0. The build requires GNU gengetopt, so we'll need a new gengetopt SPKG for lcalc to depend on. (It doesn't need to go in the DEPCHECK macro though, since it's a build-only dependency.)
1. The build system is now sane. This should make life easier in the long run, but means that spkg-* need to be rewritten. `./configure --with-pari` should suffice.

2. The lcalc spkg shouldn't depend on mpfr (I'm not sure why it ever did).

3. spkg-configure.m4 should be modified to find the new version, for example...


```patch
diff --git a/build/pkgs/lcalc/spkg-configure.m4 b/build/pkgs/lcalc/spkg-configure.m4
index 19a87c8d30..b332294eae 100644
--- a/build/pkgs/lcalc/spkg-configure.m4
+++ b/build/pkgs/lcalc/spkg-configure.m4
@@ -1,20 +1,20 @@
 SAGE_SPKG_CONFIGURE([lcalc], [
-    m4_pushdef([SAGE_LCALC_MINVER],["1.22"])
-    SAGE_SPKG_DEPCHECK([pari mpfr], [
+    m4_pushdef([SAGE_LCALC_MINVER],["2.0.0"])
+    SAGE_SPKG_DEPCHECK([pari], [
         AC_PATH_PROG([LCALC], [lcalc])
         AS_IF([test x$LCALC = x], [
            AC_MSG_NOTICE([lcalc not found. Installing lcalc])
            sage_spkg_install_lcalc=yes], [
            AC_MSG_CHECKING([is lcalc's version good enough? ])
-           lcalc_ver=`$LCALC --version 2>>/dev/null | $SED -e 's/lcalc\ //' | $SED -e 's/\ .*//g'`
+           lcalc_ver=$($LCALC --version 2>>/dev/null | $SED -e 's/lcalc\ //' | cut -d' ' -f2)
            AX_COMPARE_VERSION([$lcalc_ver], [ge], [$SAGE_LCALC_MINVER], [
                AC_MSG_RESULT([yes.])
-               AC_CHECK_HEADER([Lfunction/L.h], [], [sage_spkg_install_lcalc=yes])
+               AC_CHECK_HEADER([lcalc/L.h], [], [sage_spkg_install_lcalc=yes])
           AC_MSG_CHECKING([whether we can link and run a program using libLfunction])
           LCALC_SAVED_LIBS=$LIBS
           LIBS="$LIBS -lLfunction"
           AC_RUN_IFELSE([
-            AC_LANG_PROGRAM([[#include <Lfunction/L.h>]],
+            AC_LANG_PROGRAM([[#include <lcalc/L.h>]],
                       [[initialize_globals();
                         Complex x;
                         x = Pi*I;
```


However, lcalc-2.0.0 comes with a pkg-config file, so we could greatly simplify that.

4. The public API header has moved to `lcalc/L.h`:


```patch
diff --git a/src/sage/libs/lcalc/lcalc_sage.h b/src/sage/libs/lcalc/lcalc_sage.h
index 498528917f..18e5232cbe 100644
--- a/src/sage/libs/lcalc/lcalc_sage.h
+++ b/src/sage/libs/lcalc/lcalc_sage.h
@@ -1,4 +1,4 @@
-#include "Lfunction/L.h"
+#include "lcalc/L.h"
 int *new_ints(int l)
 {
     return new int[l];

```


5. The `find_zeros_via_N_v()` function was removed, and replaced by `find_zeros()`. Here's a patch:


```patch
diff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pxd b/src/sage/libs/lcalc/lcalc_Lfunction.pxd
index d1dbb5d95d..5edf0844f3 100644
--- a/src/sage/libs/lcalc/lcalc_Lfunction.pxd
+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pxd
@@ -21,7 +21,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -38,7 +38,7 @@ cdef extern from "lcalc_sage.h":
         double (* N) (double T)
         double *dirichlet_coefficient
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -54,7 +54,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*print_data_L)()
 
         #Constructor and destructor
@@ -70,7 +70,7 @@ cdef extern from "lcalc_sage.h":
         int (* compute_rank) ()
         double (* N) (double T)
         void  (* find_zeros_v)(double T1, double T2, double stepsize, doublevec result )
-        void (*find_zeros_via_N_v)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec result)#puts result in vector<double> result
+        int (*find_zeros)(long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
         void (*find_zeros_via_N)(long count,int do_negative,double max_refine, int rank, int test_explicit_formula, char *filename) #puts result in filename
 
         #Constructor and destructor
@@ -111,7 +111,7 @@ cdef class Lfunction:
     #strange bug, replacing Double with double gives me a compile error
     cdef Double __typedN(self, double T)
     cdef void __find_zeros_v(self, double T1, double T2, double stepsize,doublevec *result)
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula,doublevec *result)
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec* result)
 
     cdef str _repr

```



```patch
diff --git a/src/sage/libs/lcalc/lcalc_Lfunction.pyx b/src/sage/libs/lcalc/lcalc_Lfunction.pyx
index 7e54d7e78d..409987c5d0 100644
--- a/src/sage/libs/lcalc/lcalc_Lfunction.pyx
+++ b/src/sage/libs/lcalc/lcalc_Lfunction.pyx
@@ -307,8 +307,7 @@ cdef class Lfunction:
         return returnvalue
 
     #The default values are from L.h. See L.h
-    def find_zeros_via_N(self, count=0, do_negative=False, max_refine=1025,
-                         rank=-1, test_explicit_formula=0):
+    def find_zeros_via_N(self, count=0, start=0, max_refine=1025, rank=-1):
         """
         Finds ``count`` number of zeros with positive imaginary part
         starting at real axis. This function also verifies that all
@@ -317,8 +316,7 @@ cdef class Lfunction:
         INPUT:
 
         - ``count`` - number of zeros to be found
-        - ``do_negative`` - (default: False) False to ignore zeros below the
-          real axis.
+        - ``start`` - (default: 0) how many initial zeros to skip
         - ``max_refine`` - when some zeros are found to be missing, the step
           size used to find zeros is refined. max_refine gives an upper limit
           on when lcalc should give up. Use default value unless you know
@@ -326,13 +324,9 @@ cdef class Lfunction:
         - ``rank`` - integer (default: -1) analytic rank of the L-function.
           If -1 is passed, then we attempt to compute it. (Use default if in
           doubt)
-        - ``test_explicit_formula`` - integer (default: 0) If nonzero, test
-          the explicit formula for additional confidence that all the zeros
-          have been found and are accurate. This is still being tested, so
-          using the default is recommended.
 
         OUTPUT:
-        
+
         list -- A list of the imaginary parts of the zeros that have been found
 
         EXAMPLES::
@@ -356,14 +350,10 @@ cdef class Lfunction:
             sage: L.find_zeros_via_N(3)
             [14.1347251417..., 21.0220396387..., 25.0108575801...]
         """
-        cdef Integer count_I = Integer(count)
-        cdef Integer do_negative_I = Integer(do_negative)
-        cdef RealNumber max_refine_R = RRR(max_refine)
-        cdef Integer rank_I = Integer(rank)
-        cdef Integer test_explicit_I = Integer(test_explicit_formula)
+        cdef const char *message_stamp = ""
         cdef doublevec result
         sig_on()
-        self.__find_zeros_via_N_v(mpz_get_si(count_I.value), mpz_get_si(do_negative_I.value), mpfr_get_d(max_refine_R.value, MPFR_RNDN), mpz_get_si(rank_I.value), mpz_get_si(test_explicit_I.value), &result)
+        self.__find_zeros(count, start, max_refine, rank, message_stamp, &result)
         sig_off()
         returnvalue = []
         for i in range(result.size()):
@@ -390,7 +380,7 @@ cdef class Lfunction:
     cdef void __find_zeros_v(self,double T1, double T2, double stepsize, doublevec *result):
         raise NotImplementedError
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
         raise NotImplementedError
 
 ##############################################################################
@@ -486,8 +476,8 @@ cdef class Lfunction_I(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_I *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_I *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_I *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -624,8 +614,8 @@ cdef class Lfunction_D(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_D *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_D *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start,double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_D *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -769,8 +759,8 @@ cdef class Lfunction_C:
     cdef double __typedN(self, double T):
         return (<c_Lfunction_C *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_C *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_C *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     # debug tools
     def _print_data_to_standard_output(self):
@@ -854,8 +844,8 @@ cdef class Lfunction_Zeta(Lfunction):
     cdef double __typedN(self, double T):
         return (<c_Lfunction_Zeta *>self.thisptr).N(T)
 
-    cdef void __find_zeros_via_N_v(self, long count,int do_negative,double max_refine, int rank, int test_explicit_formula, doublevec *result):
-        (<c_Lfunction_Zeta *>self.thisptr).find_zeros_via_N_v(count, do_negative, max_refine, rank, test_explicit_formula, result[0])
+    cdef int __find_zeros(self, long count, long start, double max_refine, int rank, const char* message_stamp, doublevec *result):
+        (<c_Lfunction_Zeta *>self.thisptr).find_zeros(count, start, max_refine, rank, message_stamp, result)
 
     def __dealloc__(self):
         """
```


6. Some tests need tolerance updates because the answers have changed slightly.

7. Two tests give different answers entirely and require help from someone who knows what an L-function is. These are discussed on #24820 as well:


```
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(.4+.3*I)
Expected:
    0.2166144222685... - 0.00408187127850...*I
Got:
    0.0240947990422036 + 0.215308871779581*I
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 350, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.find_zeros_via_N
Failed example:
    L.find_zeros_via_N(3)
Expected:
    [6.18357819545..., 8.45722917442..., 12.6749464170...]
Got:
    [-4.13290370521286, 6.18357819545086, 8.45722917442320]
**********************************************************************
```




---

archive/issue_comments_454505.json:
```json
{
    "body": "Replying to [comment:69 slelievre]:\n> I tried to reduce the ticket description to a digest.\n> \n> Not sure what the conclusion was on item 7, so I left that out.\n> \n\nThanks. One of those doctests was updated for the new output, an expected change now that the API automatically determines that the L-function is complex:\n\nhttps://git.sagemath.org/sage.git/commit/?h=8d1221a4\n\nThe other was ultimately deleted, because no one can explain either the old or new output:\n\nhttps://git.sagemath.org/sage.git/commit/?h=b642382d\n\n> add gengetopt as a new standard SPKG \n\nThis is actually still open as a dependency in #32061.\n\n(Edit: link to the correct commits.)",
    "created_at": "2021-10-29T17:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454505",
    "user": "@orlitzky"
}
```

Replying to [comment:69 slelievre]:
> I tried to reduce the ticket description to a digest.
> 
> Not sure what the conclusion was on item 7, so I left that out.
> 

Thanks. One of those doctests was updated for the new output, an expected change now that the API automatically determines that the L-function is complex:

https://git.sagemath.org/sage.git/commit/?h=8d1221a4

The other was ultimately deleted, because no one can explain either the old or new output:

https://git.sagemath.org/sage.git/commit/?h=b642382d

> add gengetopt as a new standard SPKG 

This is actually still open as a dependency in #32061.

(Edit: link to the correct commits.)



---

archive/issue_comments_454506.json:
```json
{
    "body": "should be good to go now.",
    "created_at": "2021-11-01T13:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454506",
    "user": "@dimpase"
}
```

should be good to go now.



---

archive/issue_comments_454507.json:
```json
{
    "body": "Needs to be rebased on top of #31837, which brings a patch that does not apply to the new version",
    "created_at": "2021-11-06T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454507",
    "user": "@mkoeppe"
}
```

Needs to be rebased on top of #31837, which brings a patch that does not apply to the new version



---

archive/issue_comments_454508.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-06T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454508",
    "user": "@mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454509.json:
```json
{
    "body": "... as seen in https://github.com/mkoeppe/sage/runs/4127380314?check_suite_focus=true",
    "created_at": "2021-11-06T23:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454509",
    "user": "@mkoeppe"
}
```

... as seen in https://github.com/mkoeppe/sage/runs/4127380314?check_suite_focus=true



---

archive/issue_comments_454510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-07T13:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454510",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454511.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-07T13:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454511",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454512.json:
```json
{
    "body": "Rebased cleanly onto develop, and added one additional commit to remove the new patch.",
    "created_at": "2021-11-07T13:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454512",
    "user": "@orlitzky"
}
```

Rebased cleanly onto develop, and added one additional commit to remove the new patch.



---

archive/issue_comments_454513.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-14T09:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454513",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454514.json:
```json
{
    "body": "red branch => needs work",
    "created_at": "2021-11-14T09:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454514",
    "user": "@fchapoton"
}
```

red branch => needs work



---

archive/issue_comments_454515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-14T20:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454515",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454516.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-14T20:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454516",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454517.json:
```json
{
    "body": "Not sure why, it merged cleanly with beta6 for me. Here it is again rebased onto develop.",
    "created_at": "2021-11-14T20:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454517",
    "user": "@orlitzky"
}
```

Not sure why, it merged cleanly with beta6 for me. Here it is again rebased onto develop.



---

archive/issue_comments_454518.json:
```json
{
    "body": "lgtm",
    "created_at": "2021-11-16T14:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454518",
    "user": "@dimpase"
}
```

lgtm



---

archive/issue_comments_454519.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-16T14:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454519",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454520.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-20T10:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454520",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454521.json:
```json
{
    "body": "\n```\nUsing cached file /home/release/Sage/upstream/lcalc-2.0.1.tar.xz\nlcalc-2.0.1\n====================================================\nSetting up build directory for lcalc-2.0.1\nFinished extraction\nApplying patches from ../patches...\nApplying ../patches/lcalc-1.23-gcc11.patch\ncan't find file to patch at input line 5\nPerhaps you used the wrong -p or --strip option?\nThe text leading up to this was:\n--------------------------\n--------------------------\nFile to patch: \nSkip this patch? [y] \nSkipping patch.\n2 out of 2 hunks ignored\nError applying '../patches/lcalc-1.23-gcc11.patch'\n************************************************************************\nError applying patches\n************************************************************************\n```\n",
    "created_at": "2021-11-20T10:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454521",
    "user": "@vbraun"
}
```


```
Using cached file /home/release/Sage/upstream/lcalc-2.0.1.tar.xz
lcalc-2.0.1
====================================================
Setting up build directory for lcalc-2.0.1
Finished extraction
Applying patches from ../patches...
Applying ../patches/lcalc-1.23-gcc11.patch
can't find file to patch at input line 5
Perhaps you used the wrong -p or --strip option?
The text leading up to this was:
--------------------------
--------------------------
File to patch: 
Skip this patch? [y] 
Skipping patch.
2 out of 2 hunks ignored
Error applying '../patches/lcalc-1.23-gcc11.patch'
************************************************************************
Error applying patches
************************************************************************
```




---

archive/issue_comments_454522.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-20T12:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454522",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454523.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-11-20T12:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454523",
    "user": "@orlitzky"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_454524.json:
```json
{
    "body": "stil same error?",
    "created_at": "2021-11-23T21:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454524",
    "user": "@vbraun"
}
```

stil same error?



---

archive/issue_comments_454525.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-23T21:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454525",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454526.json:
```json
{
    "body": "nevermind...",
    "created_at": "2021-11-23T21:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454526",
    "user": "@vbraun"
}
```

nevermind...



---

archive/issue_comments_454527.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-11-23T21:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454527",
    "user": "@vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_454528.json:
```json
{
    "body": "On Debian 9 x86_64:\n\n```\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\nFailed example:\n    L.hardy_z_function(0) # abs tol 1e-8\nExpected:\n    0.793967590477 + 0.0*I\nGot:\n    0.793967590477090\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\n    [105 tests, 1 failure, 0.76 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=234205826713938282410851315937822845647 src/sage/libs/lcalc/lcalc_Lfunction.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\non OSX Big Sur:\n\n```\nIn file included from ../../src/libLfunction/L.h:43:\nIn file included from ../../src/libLfunction/Lglobals.h:55:\n../../src/libLfunction/Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\n#include <bits/c++config.h>\n         ^~~~~~~~~~~~~~~~~~\n1 error generated.\nmake[6]: *** [Lcommandline.o] Error 1\nmake[6]: Target `all' not remade because of errors.\nMaking all in tests\nMaking all in lib\nmake[7]: Nothing to be done for `all'.\nmake[7]: Nothing to be done for `all-am'.\nmake[6]: Nothing to be done for `all-am'.\nmake[5]: *** [all-recursive] Error 1\nmake[5]: Target `all' not remade because of errors.\n********************************************************************************\nError building lcalc-2.0.3\n********************************************************************************\n```\n",
    "created_at": "2021-11-25T00:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454528",
    "user": "@vbraun"
}
```

On Debian 9 x86_64:

```
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(0) # abs tol 1e-8
Expected:
    0.793967590477 + 0.0*I
Got:
    0.793967590477090
**********************************************************************
1 item had failures:
   1 of  14 in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
    [105 tests, 1 failure, 0.76 s]
----------------------------------------------------------------------
sage -t --long --random-seed=234205826713938282410851315937822845647 src/sage/libs/lcalc/lcalc_Lfunction.pyx  # 1 doctest failed
----------------------------------------------------------------------
```

on OSX Big Sur:

```
In file included from ../../src/libLfunction/L.h:43:
In file included from ../../src/libLfunction/Lglobals.h:55:
../../src/libLfunction/Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
#include <bits/c++config.h>
         ^~~~~~~~~~~~~~~~~~
1 error generated.
make[6]: *** [Lcommandline.o] Error 1
make[6]: Target `all' not remade because of errors.
Making all in tests
Making all in lib
make[7]: Nothing to be done for `all'.
make[7]: Nothing to be done for `all-am'.
make[6]: Nothing to be done for `all-am'.
make[5]: *** [all-recursive] Error 1
make[5]: Target `all' not remade because of errors.
********************************************************************************
Error building lcalc-2.0.3
********************************************************************************
```




---

archive/issue_comments_454529.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-25T00:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454529",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454530.json:
```json
{
    "body": "Replying to [comment:85 vbraun]:\n> On Debian 9 x86_64:\n> {{{\n> **********************************************************************\n> File \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\n> Failed example:\n>     L.hardy_z_function(0) # abs tol 1e-8\n> Expected:\n>     0.793967590477 + 0.0*I\n> Got:\n>     0.793967590477090\n> **********************************************************************\n\nWell... all of these `abs_tol` tests involving complex numbers are wrong. I was naively assuming that our doctest framework would do the obvious thing here, but it's using regexps to find strings that look like floating point numbers and then e.g. deciding that the lists `[\"0.793967590477\", \" + 0.0\"]` and  `[\"0.793967590477090\"]` cannot be equivalent because they are of different lengths.\n\nI'll redo all of the tests to compare the real and imaginary parts separately I guess.\n\n> on OSX Big Sur:\n> {{{\n> In file included from ../../src/libLfunction/L.h:43:\n> In file included from ../../src/libLfunction/Lglobals.h:55:\n> ../../src/libLfunction/Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\n> #include <bits/c++config.h>\n>          ^~~~~~~~~~~~~~~~~~\n> }}}\n\nI don't know what to do about this. That's a standard C++ header, and I don't have access to OSX to debug. The full build log *might* help, if something is very obviously wrong.",
    "created_at": "2021-11-25T02:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454530",
    "user": "@orlitzky"
}
```

Replying to [comment:85 vbraun]:
> On Debian 9 x86_64:
> {{{
> **********************************************************************
> File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 194, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
> Failed example:
>     L.hardy_z_function(0) # abs tol 1e-8
> Expected:
>     0.793967590477 + 0.0*I
> Got:
>     0.793967590477090
> **********************************************************************

Well... all of these `abs_tol` tests involving complex numbers are wrong. I was naively assuming that our doctest framework would do the obvious thing here, but it's using regexps to find strings that look like floating point numbers and then e.g. deciding that the lists `["0.793967590477", " + 0.0"]` and  `["0.793967590477090"]` cannot be equivalent because they are of different lengths.

I'll redo all of the tests to compare the real and imaginary parts separately I guess.

> on OSX Big Sur:
> {{{
> In file included from ../../src/libLfunction/L.h:43:
> In file included from ../../src/libLfunction/Lglobals.h:55:
> ../../src/libLfunction/Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
> #include <bits/c++config.h>
>          ^~~~~~~~~~~~~~~~~~
> }}}

I don't know what to do about this. That's a standard C++ header, and I don't have access to OSX to debug. The full build log *might* help, if something is very obviously wrong.



---

archive/issue_comments_454531.json:
```json
{
    "body": "Seen that kind of stuff before when porting to clang. I don't think anything in `bits` should be included directly because they are implementation specific functions. Would have to check what exactly was needed from there.\n\nFrom the file itself\n\n```\n/** @file bits/c++config.h\n  *  This is an internal header file, included by other library headers.\n  *  Do not attempt to use it directly. @headername{iosfwd}\n  */\n```\n",
    "created_at": "2021-11-25T03:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454531",
    "user": "@kiwifb"
}
```

Seen that kind of stuff before when porting to clang. I don't think anything in `bits` should be included directly because they are implementation specific functions. Would have to check what exactly was needed from there.

From the file itself

```
/** @file bits/c++config.h
  *  This is an internal header file, included by other library headers.
  *  Do not attempt to use it directly. @headername{iosfwd}
  */
```




---

archive/issue_comments_454532.json:
```json
{
    "body": "For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.",
    "created_at": "2021-11-25T09:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454532",
    "user": "@kiwifb"
}
```

For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.



---

archive/issue_comments_454533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-25T16:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454534.json:
```json
{
    "body": "Replying to [comment:88 fbissey]:\n> For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.\n\nThis works well with both clang and gcc on linux... but can anyone confirm that it works on OSX before I make a whole new release and upgrade again?",
    "created_at": "2021-11-25T16:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454534",
    "user": "@orlitzky"
}
```

Replying to [comment:88 fbissey]:
> For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.

This works well with both clang and gcc on linux... but can anyone confirm that it works on OSX before I make a whole new release and upgrade again?



---

archive/issue_comments_454535.json:
```json
{
    "body": "If the repo was on GH, I'd send you a PR for portability/integration testing.\n\nLooks like GitLab is also starting to provide macOS testing? https://docs.gitlab.com/ee/ci/runners/saas/macos_saas_runner.html",
    "created_at": "2021-11-25T18:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454535",
    "user": "@mkoeppe"
}
```

If the repo was on GH, I'd send you a PR for portability/integration testing.

Looks like GitLab is also starting to provide macOS testing? https://docs.gitlab.com/ee/ci/runners/saas/macos_saas_runner.html



---

archive/issue_comments_454536.json:
```json
{
    "body": "Replying to [comment:90 mjo]:\n> Replying to [comment:88 fbissey]:\n> > For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.\n> \n> This works well with both clang and gcc on linux... but can anyone confirm that it works on OSX before I make a whole new release and upgrade again?\n\nCould have mentioned that. But clang on linux is not a good test unless you build clang's libstdc++ and make use of it. However, if you do it almost a sure deal. But I couldn't test on mac os because I am not properly set and was missing dependencies.",
    "created_at": "2021-11-25T18:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454536",
    "user": "@kiwifb"
}
```

Replying to [comment:90 mjo]:
> Replying to [comment:88 fbissey]:
> > For gcc, this particular header is included in `<cmath>` which is also included later. So, I'd recommend removing that include altogether.
> 
> This works well with both clang and gcc on linux... but can anyone confirm that it works on OSX before I make a whole new release and upgrade again?

Could have mentioned that. But clang on linux is not a good test unless you build clang's libstdc++ and make use of it. However, if you do it almost a sure deal. But I couldn't test on mac os because I am not properly set and was missing dependencies.



---

archive/issue_comments_454537.json:
```json
{
    "body": "clang's C++ library is libc++, not libstdc++\n\nI'll try checking on macOS 12 now.",
    "created_at": "2021-11-25T19:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454537",
    "user": "@dimpase"
}
```

clang's C++ library is libc++, not libstdc++

I'll try checking on macOS 12 now.



---

archive/issue_comments_454538.json:
```json
{
    "body": "\n```\nlibtool: compile:  clang++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../../src -g -O2 -c Lriemannsiegel.cc  -fno-common -DPIC -o .libs/Lriemannsiegel.o\nIn file included from Lmisc.cc:24:\nIn file included from ./Lmisc.h:27:\nIn file included from ./Lglobals.h:55:\n./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\nIn file included from Lgamma.cc:24:\nIn file included from ./Lgamma.h:#include <bits/c++config.h>\n         ^~~~~~~~~~~~~~~~~~\n28:\nIn file included from ./Lglobals.h:55:\n./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\n#include <bits/c++config.h>\n         ^~~~~~~~~~~~~~~~~~\nIn file included from Lglobals.cc:24:\nIn file included from ./Lglobals.h:55:\n./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\n#include <bits/c++config.h>\n         ^~~~~~~~~~~~~~~~~~\n1 error generated.\nIn file included from Lnumbertheory.cc:24:\nIn file included from ./Lnumbertheory.h:32:\nIn file included from ./Lglobals.h:55:\n./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found\n#include <bits/c++config.h>\n         ^~~~~~~~~~~~~~~~~~\nmake[6]: *** [Lmisc.lo] Error 1\nmake[6]: *** Waiting for unfinished jobs....\n```\n\n\nremoving the offending #include, i.e.\n\n\n```diff\ndiff --git a/src/libLfunction/Lcomplex.h b/src/libLfunction/Lcomplex.h\nindex 639dbfa..be29aab 100644\n--- a/src/libLfunction/Lcomplex.h\n+++ b/src/libLfunction/Lcomplex.h\n@@ -45,7 +45,7 @@\n \n #pragma GCC system_header\n \n-#include <bits/c++config.h>\n+// #include <bits/c++config.h>\n \n //no longer include:\n //#include <bits/cpp_type_traits.h>  only thing used was is_floating... \n```\n\n\nmakes it build",
    "created_at": "2021-11-25T20:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454538",
    "user": "@dimpase"
}
```


```
libtool: compile:  clang++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../../src -g -O2 -c Lriemannsiegel.cc  -fno-common -DPIC -o .libs/Lriemannsiegel.o
In file included from Lmisc.cc:24:
In file included from ./Lmisc.h:27:
In file included from ./Lglobals.h:55:
./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
In file included from Lgamma.cc:24:
In file included from ./Lgamma.h:#include <bits/c++config.h>
         ^~~~~~~~~~~~~~~~~~
28:
In file included from ./Lglobals.h:55:
./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
#include <bits/c++config.h>
         ^~~~~~~~~~~~~~~~~~
In file included from Lglobals.cc:24:
In file included from ./Lglobals.h:55:
./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
#include <bits/c++config.h>
         ^~~~~~~~~~~~~~~~~~
1 error generated.
In file included from Lnumbertheory.cc:24:
In file included from ./Lnumbertheory.h:32:
In file included from ./Lglobals.h:55:
./Lcomplex.h:48:10: fatal error: 'bits/c++config.h' file not found
#include <bits/c++config.h>
         ^~~~~~~~~~~~~~~~~~
make[6]: *** [Lmisc.lo] Error 1
make[6]: *** Waiting for unfinished jobs....
```


removing the offending #include, i.e.


```diff
diff --git a/src/libLfunction/Lcomplex.h b/src/libLfunction/Lcomplex.h
index 639dbfa..be29aab 100644
--- a/src/libLfunction/Lcomplex.h
+++ b/src/libLfunction/Lcomplex.h
@@ -45,7 +45,7 @@
 
 #pragma GCC system_header
 
-#include <bits/c++config.h>
+// #include <bits/c++config.h>
 
 //no longer include:
 //#include <bits/cpp_type_traits.h>  only thing used was is_floating... 
```


makes it build



---

archive/issue_comments_454539.json:
```json
{
    "body": "Thanks, release/upgrade incoming.",
    "created_at": "2021-11-25T20:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454539",
    "user": "@orlitzky"
}
```

Thanks, release/upgrade incoming.



---

archive/issue_comments_454540.json:
```json
{
    "body": "Replying to [comment:92 fbissey]:\n> \n> Could have mentioned that. But clang on linux is not a good test unless you build clang's libstdc++ and make use of it.\n\nArgh, TIL about `USE=default-libcxx` on sys-devel/clang.",
    "created_at": "2021-11-25T21:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454540",
    "user": "@orlitzky"
}
```

Replying to [comment:92 fbissey]:
> 
> Could have mentioned that. But clang on linux is not a good test unless you build clang's libstdc++ and make use of it.

Argh, TIL about `USE=default-libcxx` on sys-devel/clang.



---

archive/issue_comments_454541.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-26T00:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454541",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454542.json:
```json
{
    "body": "Certain (non-sage) builds were failing with newer clangs anyway so I guess this was timely.",
    "created_at": "2021-11-26T00:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454542",
    "user": "@orlitzky"
}
```

Certain (non-sage) builds were failing with newer clangs anyway so I guess this was timely.



---

archive/issue_comments_454543.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-26T00:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454543",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454544.json:
```json
{
    "body": "maybe you can drop all the `register` things, as\n\n```\n warning: 'register' storage class specifier is deprecated and incompatible with C++17 [-Wdeprecated-register]\n```\n\nis all over there on macOS.",
    "created_at": "2021-11-27T18:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454544",
    "user": "@dimpase"
}
```

maybe you can drop all the `register` things, as

```
 warning: 'register' storage class specifier is deprecated and incompatible with C++17 [-Wdeprecated-register]
```

is all over there on macOS.



---

archive/issue_comments_454545.json:
```json
{
    "body": "lgtm, otherwise",
    "created_at": "2021-11-27T21:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454545",
    "user": "@dimpase"
}
```

lgtm, otherwise



---

archive/issue_comments_454546.json:
```json
{
    "body": "Replying to [comment:99 dimpase]:\n> maybe you can drop all the `register` things, as\n> {{{\n>  warning: 'register' storage class specifier is deprecated and incompatible with C++17 [-Wdeprecated-register]\n> }}}\n> is all over there on macOS.\n\nAre you sure this was with v2.0.4? I already fixed a warning like that, and there's no more *register* in the lcalc repo.",
    "created_at": "2021-11-28T23:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454546",
    "user": "@orlitzky"
}
```

Replying to [comment:99 dimpase]:
> maybe you can drop all the `register` things, as
> {{{
>  warning: 'register' storage class specifier is deprecated and incompatible with C++17 [-Wdeprecated-register]
> }}}
> is all over there on macOS.

Are you sure this was with v2.0.4? I already fixed a warning like that, and there's no more *register* in the lcalc repo.



---

archive/issue_comments_454547.json:
```json
{
    "body": "Ah, these came from the included pari headers /usr/local/include/pari/pari.h.\nAll good.",
    "created_at": "2021-11-29T00:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454547",
    "user": "@dimpase"
}
```

Ah, these came from the included pari headers /usr/local/include/pari/pari.h.
All good.



---

archive/issue_comments_454548.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-29T00:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454548",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454549.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454549",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_454550.json:
```json
{
    "body": "This broke cygwin: #33043",
    "created_at": "2021-12-18T18:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31800#issuecomment-454550",
    "user": "@mkoeppe"
}
```

This broke cygwin: #33043
