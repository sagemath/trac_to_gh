# Issue 11808: hyperelliptic curves: count_points and frobenius_polynomial do not work in all cases, not zeta_function available

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2011-11-02 15:07:08

Assignee: cremona

CC:  jantuitman minz defeo vbraun

The following is not implemented (but can be done for hyperelliptic curves):


```
sage: P.<x> = PolynomialRing(GF(9,'a'))
sage: H = HyperellipticCurve(x^5+x^2+1)
sage: H.count_points(5)
Traceback (most recent call last)
...
NotImplementedError: Point counting only implemented for schemes over prime fields
```

Also, having a `count_points` for all cases, the Frobenius polynomial can be calculated. At the moment, this is calculated via `frobenius_matrix`, which is not always available:

```
sage: R.<t> = PolynomialRing(GF(8, 'a'))
sage: H = HyperellipticCurve(t^5 + t + 2, t + 1)
sage: H.frobenius_polynomial()
Traceback (most recent call last):
...
NotImplementedError: only implemented for curves y^2 = f(x)
```


Further, the zeta function can be calculated easily when the Frobenius polynomial is known.

Patch follows.


---

Comment by dkrenn created at 2011-11-02 15:09:30

Changing status from new to needs_review.


---

Attachment


---

Comment by mstreng created at 2011-12-18 22:14:34

With the changes at #11930 it is no longer necessary to use is_singular, so that test could be removed.


---

Comment by mstreng created at 2011-12-18 22:14:34

Changing status from needs_review to needs_work.


---

Comment by mstreng created at 2012-01-03 09:37:24

Changing keywords from "" to "sd35 hyperelliptic curve".


---

Comment by mstreng created at 2012-01-03 09:37:24

In case f has even degree, the points at infinity are counted incorrectly by this patch. To get the correct characteristic polynomial of Frobenius, we must consider the smooth model of the curve. This is what you get when you desingularize at infinity. This smooth curve has 0, 1 or 2 points at infinity defined over the base field, so instead of just with 1, the count must start with 0, 1 or 2. (The count will not always agree with the count from the base class, as the base class thinks about the singular curve. See also #11800.)

In case `H : y^2 = f(x)` with degree(f) > 2, there are three cases:

 * degree(f) is odd: there is a unique point at infinity over the base field (a rational Weierstrass point at infinity)
 * degree(f) is even and its leading coefficient is a square: there are two points at infinity defined over the base field
 * degree(f) is even and its leading coefficient is not a square: there is no point at infinity defined over the base field (there are two points over a quadratic extension, and they are conjugate to each other)

A similar list of cases can be written down in greater generality (including characteristic 2).

Alternative to get the patch in quickly: raise an error if the curve is not of the form `y^2 = f(x)` with f of odd degree > 2.


---

Comment by jpflori created at 2013-09-25 13:10:16

Changing keywords from "sd35 hyperelliptic curve" to "sd35 hyperelliptic curve sd53".


---

Comment by jpflori created at 2013-09-25 13:10:16

See also #15148 where we are modifying count_points to actually use hypellfrob.
(The ticket is not uptodte, I should be uploading there this afternoon hopefully.)


---

Comment by jpflori created at 2013-09-26 17:08:36

Ok, so Ive finished #15148, and after looking at what was I suggested here, I think what has to be done here, on top of #15148:
* we should add the zeta_function method,
* enhance the naive point counting I introduced in #15148 with some ideas from this ticket, namely replace my use of the extension method of finite fields by that of embeddings of a subfield into a super field using the Hom functor and the embedding it computes.


---

Comment by jpflori created at 2013-09-26 17:14:24

And I don't think this should depend on #15115 as it makes no use of the modification there.
Ok the current number of point is wrong, in the spirit of what is fixed in #15115, but in my code at #15148 it is right, so provided we base this ticket on top of #15148, the dependency on #15115 goes away.


---

Comment by jpflori created at 2013-09-27 16:48:59

Changing status from needs_work to needs_review.


---

Comment by git created at 2013-09-27 16:54:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2013-12-25 17:15:15

FYI, this still works fine without modifications after the merge of #15108 and the changes at #15148.


---

Comment by chapoton created at 2014-03-07 16:16:33

There are some failing doctests, see patchbot report.


---

Comment by chapoton created at 2014-03-07 16:16:33

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2014-03-10 22:35:51

Did the patchbot actually managed to use the latest version?

Last time I had a look at it it was stuck with an old comit, anyway, I'll give it a look tomorrow.


---

Comment by git created at 2014-03-12 14:23:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-03-12 14:25:19

I've merged the latest #15148 (hint: please review) and latest trac/develop (I don't know if the patchbot can make that alone, especially the former one using the dependencies field).
No problem in the schemes directory, I'm running the full long testsuite now.


---

Comment by jpflori created at 2014-03-12 14:56:30

I only got one error in ppl.pyx, but I fear it is unrelated.


---

Comment by jpflori created at 2014-03-12 14:56:45

And not reproducible...


---

Comment by jpflori created at 2014-03-12 15:41:11

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-04-25 08:29:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-06-17 19:47:46

This looks good, as far as I can tell, but I am not competent to check that the new results are mathematically correct. I have made two tiny changes to the doc, and also taken the opportunity to run pyflakes on the changed file. Found three unused variable assignements. Two have been removed, the third one looks very suspect, so I have just added a comment besides it. I have also cleaned-up a little bit the code formatting around the suspect variable assignement.

----
New commits:


---

Comment by jpflori created at 2014-07-07 13:43:00

IIRC there is no deep mathematics introduced here.

Just need to use jacobi symbols to know how many ordinates go with an abscissa (0,1 or 2), the number of points at infinity (as here IIRC we're really computing the number of points on the desingularization of the curve).

The zeta funciton thing is just a very simple toy addition.


---

Comment by vbraun created at 2014-07-17 00:01:15

Resolution: fixed
