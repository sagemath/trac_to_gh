# Issue 32630: spkg-configure.m4 for maxima

archive/issues_032630.json:
```json
{
    "body": "CC:  @slel @antonio-rojas\n\nWe handled ECL by itself in #29617, so now maxima needs its own ticket.\n\nThis would actually be \"easy\" at this point if not for our custom `matrixexp.patch` (https://sourceforge.net/p/maxima/bugs/2596/).\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32867\n\n",
    "created_at": "2021-11-13T20:08:56Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "spkg-configure.m4 for maxima",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32630",
    "user": "@orlitzky"
}
```
CC:  @slel @antonio-rojas

We handled ECL by itself in #29617, so now maxima needs its own ticket.

This would actually be "easy" at this point if not for our custom `matrixexp.patch` (https://sourceforge.net/p/maxima/bugs/2596/).


Issue created by migration from https://trac.sagemath.org/ticket/32867





---

archive/issue_comments_465380.json:
```json
{
    "body": "Here's an otherwise-working branch that fails only `matrixexp.patch` tests.\n----\nNew commits:",
    "created_at": "2021-11-13T20:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465380",
    "user": "@orlitzky"
}
```

Here's an otherwise-working branch that fails only `matrixexp.patch` tests.
----
New commits:



---

archive/issue_comments_465381.json:
```json
{
    "body": "I opened #32898 so that removing `matrixexp.patch`\nhas its own ticket.",
    "created_at": "2021-11-18T18:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465381",
    "user": "@slel"
}
```

I opened #32898 so that removing `matrixexp.patch`
has its own ticket.



---

archive/issue_comments_465382.json:
```json
{
    "body": "This works for me on void linux.\n\nNote that debian, arch, and I think also gentoo all include `matrixexp.patch`; I'll include it in void as well, so this ticket should not depend on #32898.",
    "created_at": "2021-11-28T13:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465382",
    "user": "@tornaria"
}
```

This works for me on void linux.

Note that debian, arch, and I think also gentoo all include `matrixexp.patch`; I'll include it in void as well, so this ticket should not depend on #32898.



---

archive/issue_comments_465383.json:
```json
{
    "body": "Maxima is packaged for Cygwin as \"maxima\",\nperhaps add a `distros/cygwin.txt` file?\n\nOr that can be a separate ticket.",
    "created_at": "2021-11-28T13:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465383",
    "user": "@slel"
}
```

Maxima is packaged for Cygwin as "maxima",
perhaps add a `distros/cygwin.txt` file?

Or that can be a separate ticket.



---

archive/issue_comments_465384.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure, maxima\".",
    "created_at": "2021-11-28T13:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465384",
    "user": "@slel"
}
```

Changing keywords from "" to "spkg-configure, maxima".



---

archive/issue_comments_465385.json:
```json
{
    "body": "We don't have the patch in Gentoo...",
    "created_at": "2021-11-28T13:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465385",
    "user": "@orlitzky"
}
```

We don't have the patch in Gentoo...



---

archive/issue_comments_465386.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T13:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465386",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465387.json:
```json
{
    "body": "Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.\n\nFor the command line interface, it seems to me setting MAXIMA to \"maxima\" instead of \"maxima -l ecl\" would work (btw: why eliminate the config option MAXIMA and hardcode \"maxima -l ecl\" everywhere instead of just changing MAXIMA in a single place?)\n\nFor the library interface I don't know if it is possible to compile `maxima.fas` for sbcl; system packages for maxima that are usually compiled for sbcl don't include the library.",
    "created_at": "2021-11-29T02:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465387",
    "user": "@tornaria"
}
```

Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.

For the command line interface, it seems to me setting MAXIMA to "maxima" instead of "maxima -l ecl" would work (btw: why eliminate the config option MAXIMA and hardcode "maxima -l ecl" everywhere instead of just changing MAXIMA in a single place?)

For the library interface I don't know if it is possible to compile `maxima.fas` for sbcl; system packages for maxima that are usually compiled for sbcl don't include the library.



---

archive/issue_comments_465388.json:
```json
{
    "body": "Replying to [comment:7 tornaria]:\n> Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.\n\nSadly it's not possible. Sage interfaces with maxima at a very low level through ECL; see`sage/libs/ecl.pyx` and `sage/interfaces/maxima_lib.py`.\n\n\n> For the command line interface, it seems to me setting MAXIMA to \"maxima\" instead of \"maxima -l ecl\" would work (btw: why eliminate the config option MAXIMA and hardcode \"maxima -l ecl\" everywhere instead of just changing MAXIMA in a single place?)\n\nGiven that we need ECL maxima for Sage, there aren't any other good values for that variable. The `-l ecl` is necessary to support system installations of maxima with (for example) both SBCL and ECL, where running just \"maxima\" would run it with SBCL. And the `-l ecl` flag doesn't do any harm with the maxima SPKG, because we know that the SPKG is built with ECL. The executable name \"maxima\" is standard and `PATH` manipulations in the sage build system ensure that the correct one gets used, so you're almost forced to have `MAXIMA=\"maxima -l ecl\"`.\n\nWith that in mind, removing the variable eliminates a \"configurable\" option that isn't actually configurable in practice, and also gets rid of a tiny bit of coupling between modules.\n\n> For the library interface I don't know if it is possible to compile `maxima.fas` for sbcl; system packages for maxima that are usually compiled for sbcl don't include the library.\n\nNo, until very recently even the ability to create an ECL library required a custom patch. That patch has finally been accepted upstream, but I don't think anything similar is possible with the other lisp implementations. (Sage is married to ECL for the moment either way.)",
    "created_at": "2021-11-29T02:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465388",
    "user": "@orlitzky"
}
```

Replying to [comment:7 tornaria]:
> Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.

Sadly it's not possible. Sage interfaces with maxima at a very low level through ECL; see`sage/libs/ecl.pyx` and `sage/interfaces/maxima_lib.py`.


> For the command line interface, it seems to me setting MAXIMA to "maxima" instead of "maxima -l ecl" would work (btw: why eliminate the config option MAXIMA and hardcode "maxima -l ecl" everywhere instead of just changing MAXIMA in a single place?)

Given that we need ECL maxima for Sage, there aren't any other good values for that variable. The `-l ecl` is necessary to support system installations of maxima with (for example) both SBCL and ECL, where running just "maxima" would run it with SBCL. And the `-l ecl` flag doesn't do any harm with the maxima SPKG, because we know that the SPKG is built with ECL. The executable name "maxima" is standard and `PATH` manipulations in the sage build system ensure that the correct one gets used, so you're almost forced to have `MAXIMA="maxima -l ecl"`.

With that in mind, removing the variable eliminates a "configurable" option that isn't actually configurable in practice, and also gets rid of a tiny bit of coupling between modules.

> For the library interface I don't know if it is possible to compile `maxima.fas` for sbcl; system packages for maxima that are usually compiled for sbcl don't include the library.

No, until very recently even the ability to create an ECL library required a custom patch. That patch has finally been accepted upstream, but I don't think anything similar is possible with the other lisp implementations. (Sage is married to ECL for the moment either way.)



---

archive/issue_comments_465389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-23T17:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465390.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-23T17:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465390",
    "user": "@orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465391.json:
```json
{
    "body": "I've disabled (for now) the one remaining test that needs `matrixexp.patch`, with a pointer to #32898. Otherwise we could wait another decade for this.",
    "created_at": "2021-12-23T17:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465391",
    "user": "@orlitzky"
}
```

I've disabled (for now) the one remaining test that needs `matrixexp.patch`, with a pointer to #32898. Otherwise we could wait another decade for this.



---

archive/issue_comments_465392.json:
```json
{
    "body": "Replying to [comment:7 tornaria]:\n> Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.\n\nAdding to mjo's answer: for the expect-based interface, it may be doable to use SBCL. There are peculiarities in the way the stdin/stdout character streams are driven in different LISPs that may interfere with a simple drop-in replacement.\n\nThe main use in sage now, however, is through maxima_lib which is really using that the E in ECL means \"embeddable\": we link in the ecl, start it through its binary interface, and then instruct it to load maxima.fas. Our interfacing is using an ABI, not I/O streams, and we directly access the memory objects that ECL constructs to translate them to python (or leave them wrapped). I'm pretty sure this is all fundamentally impossible with SBCL. We are getting huge latency and efficiency gains through the ABI interface compared to I/O, so in many cases I suspect we can afford slower execution in ECL, and I think we don't want to go back to expect-based interfaces. That's why we're tied to ECL.",
    "created_at": "2021-12-23T19:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465392",
    "user": "@nbruin"
}
```

Replying to [comment:7 tornaria]:
> Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.

Adding to mjo's answer: for the expect-based interface, it may be doable to use SBCL. There are peculiarities in the way the stdin/stdout character streams are driven in different LISPs that may interfere with a simple drop-in replacement.

The main use in sage now, however, is through maxima_lib which is really using that the E in ECL means "embeddable": we link in the ecl, start it through its binary interface, and then instruct it to load maxima.fas. Our interfacing is using an ABI, not I/O streams, and we directly access the memory objects that ECL constructs to translate them to python (or leave them wrapped). I'm pretty sure this is all fundamentally impossible with SBCL. We are getting huge latency and efficiency gains through the ABI interface compared to I/O, so in many cases I suspect we can afford slower execution in ECL, and I think we don't want to go back to expect-based interfaces. That's why we're tied to ECL.



---

archive/issue_comments_465393.json:
```json
{
    "body": "Replying to [comment:12 nbruin]:\n> Replying to [comment:7 tornaria]:\n> > Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.\n> \n> Adding to mjo's answer: for the expect-based interface, it may be doable to use SBCL. There are peculiarities in the way the stdin/stdout character streams are driven in different LISPs that may interfere with a simple drop-in replacement.\n\nI tried it (using sbcl maxima for the binary but maxima-ecl for maxima_lib) and I think it worked ok (as in: doctests passed).\n\n> The main use in sage now, however, is through maxima_lib which is really using that the E in ECL means \"embeddable\": we link in the ecl, start it through its binary interface, and then instruct it to load maxima.fas. Our interfacing is using an ABI, not I/O streams, and we directly access the memory objects that ECL constructs to translate them to python (or leave them wrapped). I'm pretty sure this is all fundamentally impossible with SBCL. We are getting huge latency and efficiency gains through the ABI interface compared to I/O, so in many cases I suspect we can afford slower execution in ECL, and I think we don't want to go back to expect-based interfaces. That's why we're tied to ECL.\n> \n\nIn theory it may be possible (see http://www.sbcl.org/manual/#Calling-Lisp-From-C) although it might be a lot of work. The speed gains could be considerable for that part of sage, I don't know if it's overall worth the trouble.",
    "created_at": "2021-12-23T20:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465393",
    "user": "@tornaria"
}
```

Replying to [comment:12 nbruin]:
> Replying to [comment:7 tornaria]:
> > Would it be hard to support system maxima compiled with sbcl if available? It seems to be ~ 5-6 times faster than maxima on ecl (at least the time it takes to run the testsuite) and it is also more available in general.
> 
> Adding to mjo's answer: for the expect-based interface, it may be doable to use SBCL. There are peculiarities in the way the stdin/stdout character streams are driven in different LISPs that may interfere with a simple drop-in replacement.

I tried it (using sbcl maxima for the binary but maxima-ecl for maxima_lib) and I think it worked ok (as in: doctests passed).

> The main use in sage now, however, is through maxima_lib which is really using that the E in ECL means "embeddable": we link in the ecl, start it through its binary interface, and then instruct it to load maxima.fas. Our interfacing is using an ABI, not I/O streams, and we directly access the memory objects that ECL constructs to translate them to python (or leave them wrapped). I'm pretty sure this is all fundamentally impossible with SBCL. We are getting huge latency and efficiency gains through the ABI interface compared to I/O, so in many cases I suspect we can afford slower execution in ECL, and I think we don't want to go back to expect-based interfaces. That's why we're tied to ECL.
> 

In theory it may be possible (see http://www.sbcl.org/manual/#Calling-Lisp-From-C) although it might be a lot of work. The speed gains could be considerable for that part of sage, I don't know if it's overall worth the trouble.



---

archive/issue_comments_465394.json:
```json
{
    "body": "Isn't a version check for maxima necessary? On the oldest supported platform, system maxima is 5.32.1. https://repology.org/project/maxima/versions",
    "created_at": "2021-12-25T19:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465394",
    "user": "@mkoeppe"
}
```

Isn't a version check for maxima necessary? On the oldest supported platform, system maxima is 5.32.1. https://repology.org/project/maxima/versions



---

archive/issue_comments_465395.json:
```json
{
    "body": "Replying to [comment:14 mkoeppe]:\n> Isn't a version check for maxima necessary? On the oldest supported platform, system maxima is 5.32.1. https://repology.org/project/maxima/versions\n\nIn spirit yes, but in practice... maybe. The `spkg-configure.m4` checks for a maxima with support for building `maxima.fas` as an ECL library, and that commit hasn't even made it into a released version of maxima yet. The only reason any system maxima would be carrying it as a custom patch is to be able to use maxima with sage, but that means that the system maxima probably works with sage. Up to some version (mis)matching anyway.",
    "created_at": "2021-12-25T23:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465395",
    "user": "@orlitzky"
}
```

Replying to [comment:14 mkoeppe]:
> Isn't a version check for maxima necessary? On the oldest supported platform, system maxima is 5.32.1. https://repology.org/project/maxima/versions

In spirit yes, but in practice... maybe. The `spkg-configure.m4` checks for a maxima with support for building `maxima.fas` as an ECL library, and that commit hasn't even made it into a released version of maxima yet. The only reason any system maxima would be carrying it as a custom patch is to be able to use maxima with sage, but that means that the system maxima probably works with sage. Up to some version (mis)matching anyway.



---

archive/issue_comments_465396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-26T21:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465396",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465397.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-12T18:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465397",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465398.json:
```json
{
    "body": "Removing the `MAXIMA` variable from `sage_conf` and just relying on `PATH` to find `maxima` is a regression on #29038/#30563 for #30818.",
    "created_at": "2022-03-13T04:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465398",
    "user": "@mkoeppe"
}
```

Removing the `MAXIMA` variable from `sage_conf` and just relying on `PATH` to find `maxima` is a regression on #29038/#30563 for #30818.



---

archive/issue_comments_465399.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-13T04:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465399",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_465400.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-14T13:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465400",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465401.json:
```json
{
    "body": "Ok, I've put `sage_conf.MAXIMA` back, and have added `-l ecl` wherever it is used instead.",
    "created_at": "2022-03-14T13:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465401",
    "user": "@orlitzky"
}
```

Ok, I've put `sage_conf.MAXIMA` back, and have added `-l ecl` wherever it is used instead.



---

archive/issue_comments_465402.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-14T13:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465402",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_465403.json:
```json
{
    "body": "Replying to [comment:21 mjo]:\n> Ok, I've put `sage_conf.MAXIMA` back, and have added `-l ecl` wherever it is used instead.\n\nWhat is wrong with just running `maxima` and use whatever is the system default?\n\nIn void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).\n\nIn principle maxima is 5-6 times faster on sbcl than on ecl, although I don't know how much this affects sage.\n\nAnyway, even if there are good reasons to default to `maxima -l ecl`, I think it's better that `sage_conf.MAXIMA` contains the whole command that runs maxima so it's easy to change to just `maxima` if one whishes so.",
    "created_at": "2022-03-14T15:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465403",
    "user": "@tornaria"
}
```

Replying to [comment:21 mjo]:
> Ok, I've put `sage_conf.MAXIMA` back, and have added `-l ecl` wherever it is used instead.

What is wrong with just running `maxima` and use whatever is the system default?

In void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).

In principle maxima is 5-6 times faster on sbcl than on ecl, although I don't know how much this affects sage.

Anyway, even if there are good reasons to default to `maxima -l ecl`, I think it's better that `sage_conf.MAXIMA` contains the whole command that runs maxima so it's easy to change to just `maxima` if one whishes so.



---

archive/issue_comments_465404.json:
```json
{
    "body": "Replying to [comment:22 tornaria]:\n> \n> What is wrong with just running `maxima` and use whatever is the system default?\n> \n> In void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).\n\nI think that's the main problem with it: sage has only been tested with an ECL-only maxima until now. While SBCL might be fine(ish), what about gcl or clozurecl? If for example maxima is built supporting both gcl and ecl, and if using gcl causes the test suite to fail, it'd be nice if sage used the known-good ecl on that machine.\n\nI don't feel strongly about it: on Gentoo we could force the problematic lisps to be disabled in maxima when sage is installed. Binary distros could theoretically run into trouble, but they're probably all using SBCL or ECL anyways, and one patch isn't too bad if they want the test suite to pass.\n\nDoes anyone else care if I drop the `-l ecl`?\n\n\n> In principle maxima is 5-6 times faster on sbcl than on ecl, although I don't know how much this affects sage.\n\nWe already use ECL for the maxima library interface, so there's probably some efficiency to not loading both SBCL and ECL.  But really we should be trying to get rid of the pexpect interface entirely if efficiency is the goal (#30097).",
    "created_at": "2022-03-14T17:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465404",
    "user": "@orlitzky"
}
```

Replying to [comment:22 tornaria]:
> 
> What is wrong with just running `maxima` and use whatever is the system default?
> 
> In void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).

I think that's the main problem with it: sage has only been tested with an ECL-only maxima until now. While SBCL might be fine(ish), what about gcl or clozurecl? If for example maxima is built supporting both gcl and ecl, and if using gcl causes the test suite to fail, it'd be nice if sage used the known-good ecl on that machine.

I don't feel strongly about it: on Gentoo we could force the problematic lisps to be disabled in maxima when sage is installed. Binary distros could theoretically run into trouble, but they're probably all using SBCL or ECL anyways, and one patch isn't too bad if they want the test suite to pass.

Does anyone else care if I drop the `-l ecl`?


> In principle maxima is 5-6 times faster on sbcl than on ecl, although I don't know how much this affects sage.

We already use ECL for the maxima library interface, so there's probably some efficiency to not loading both SBCL and ECL.  But really we should be trying to get rid of the pexpect interface entirely if efficiency is the goal (#30097).



---

archive/issue_comments_465405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-15T01:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465405",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465406.json:
```json
{
    "body": "Replying to [comment:23 mjo]:\n> Replying to [comment:22 tornaria]:\n> > \n> > What is wrong with just running `maxima` and use whatever is the system default?\n> > \n> > In void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).\n> \n> I think that's the main problem with it: sage has only been tested with an ECL-only maxima until now. While SBCL might be fine(ish), what about gcl or clozurecl? If for example maxima is built supporting both gcl and ecl, and if using gcl causes the test suite to fail, it'd be nice if sage used the known-good ecl on that machine.\n\nI'm systematically testing sage with maxima-sbcl and it works ok save that tiny patch (it's a really tiny unstability in the fifth digit of the **error bound** for a numerical integral).\n\n> I don't feel strongly about it: on Gentoo we could force the problematic lisps to be disabled in maxima when sage is installed. Binary distros could theoretically run into trouble, but they're probably all using SBCL or ECL anyways, and one patch isn't too bad if they want the test suite to pass.\n> \n> Does anyone else care if I drop the `-l ecl`?\n\nWhy not have the configure script tests for `maxima -l ecl` working (as before) and if so set `MAXIMA=\"maxima -l ecl\"` in `sage_conf.py`. This way nothing really changes when using system maxima via configure but distro packages can use whatever works better for `MAXIMA`.\n\nI should point out that maxima-sbcl, by default, will NOT use gmp for arithmetic, but some slow quadratic implementation. That will make the test in `src/sage/interfaces/maxima.py:630` to take a very long time. To test this:\n\n```\n$ maxima -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^600 $'\n(%i1) showtime:true\nEvaluation took 0.0000 seconds (0.0000 elapsed) using 0 bytes.\n(%i2) a:10^10^5\nEvaluation took 0.0004 seconds (0.0000 elapsed) using 7.797 KB.\n(%i3) b:a^600\nEvaluation took 0.8037 seconds (0.8060 elapsed) using 23.760 MB.\n```\n\nThis will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.\n\nThis is the main reason why I think keeping the default to `maxima -l ecl` might be easier. Unless you want to run the command above with a timeout in spkg-configure and complain if the timeout triggers.\n\nBTW, could you add my tiny patch from https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch to your branch? It's a numerical integration, the answer is exactly the same, but the error bound is sligthly different in the `e-15` digit.",
    "created_at": "2022-03-15T02:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465406",
    "user": "@tornaria"
}
```

Replying to [comment:23 mjo]:
> Replying to [comment:22 tornaria]:
> > 
> > What is wrong with just running `maxima` and use whatever is the system default?
> > 
> > In void linux we use system maxima which defaults to `sbcl` and there's no issue at all (it only needs a tiny patch due to numerical unstability on 32 bit sbcl: https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch).
> 
> I think that's the main problem with it: sage has only been tested with an ECL-only maxima until now. While SBCL might be fine(ish), what about gcl or clozurecl? If for example maxima is built supporting both gcl and ecl, and if using gcl causes the test suite to fail, it'd be nice if sage used the known-good ecl on that machine.

I'm systematically testing sage with maxima-sbcl and it works ok save that tiny patch (it's a really tiny unstability in the fifth digit of the **error bound** for a numerical integral).

> I don't feel strongly about it: on Gentoo we could force the problematic lisps to be disabled in maxima when sage is installed. Binary distros could theoretically run into trouble, but they're probably all using SBCL or ECL anyways, and one patch isn't too bad if they want the test suite to pass.
> 
> Does anyone else care if I drop the `-l ecl`?

Why not have the configure script tests for `maxima -l ecl` working (as before) and if so set `MAXIMA="maxima -l ecl"` in `sage_conf.py`. This way nothing really changes when using system maxima via configure but distro packages can use whatever works better for `MAXIMA`.

I should point out that maxima-sbcl, by default, will NOT use gmp for arithmetic, but some slow quadratic implementation. That will make the test in `src/sage/interfaces/maxima.py:630` to take a very long time. To test this:

```
$ maxima -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^600 $'
(%i1) showtime:true
Evaluation took 0.0000 seconds (0.0000 elapsed) using 0 bytes.
(%i2) a:10^10^5
Evaluation took 0.0004 seconds (0.0000 elapsed) using 7.797 KB.
(%i3) b:a^600
Evaluation took 0.8037 seconds (0.8060 elapsed) using 23.760 MB.
```

This will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.

This is the main reason why I think keeping the default to `maxima -l ecl` might be easier. Unless you want to run the command above with a timeout in spkg-configure and complain if the timeout triggers.

BTW, could you add my tiny patch from https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch to your branch? It's a numerical integration, the answer is exactly the same, but the error bound is sligthly different in the `e-15` digit.



---

archive/issue_comments_465407.json:
```json
{
    "body": "In debian, there's a package `maxima` which ships a binary `maxima` (using gcl) and a package `maxima-sage` which ships a binary `maxima-sage` (using ecl) together with `maxima.fas`, so just running `maxima -l ecl` fails but `maxima-sage -l ecl` works. I didn't compile sage in debian so I don't know if maxima-gcl would work ok with sage.\n\nAlso, the location of `maxima.fas` in `maxima-sage` is not correct so `ecl --eval \"(require 'maxima)\" --eval \"(quit)\"` fails, but `ecl --eval \"(require 'maxima \\\"/usr/lib/ecl/maxima.fas\\\")\" --eval \"(quit)\"` works.\n\nThis is from a very quick test using `docker run --security-opt seccomp=unconfined -it debian:latest` (beware maxima doesn't run in docker without the seccomp option).",
    "created_at": "2022-03-15T02:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465407",
    "user": "@tornaria"
}
```

In debian, there's a package `maxima` which ships a binary `maxima` (using gcl) and a package `maxima-sage` which ships a binary `maxima-sage` (using ecl) together with `maxima.fas`, so just running `maxima -l ecl` fails but `maxima-sage -l ecl` works. I didn't compile sage in debian so I don't know if maxima-gcl would work ok with sage.

Also, the location of `maxima.fas` in `maxima-sage` is not correct so `ecl --eval "(require 'maxima)" --eval "(quit)"` fails, but `ecl --eval "(require 'maxima \"/usr/lib/ecl/maxima.fas\")" --eval "(quit)"` works.

This is from a very quick test using `docker run --security-opt seccomp=unconfined -it debian:latest` (beware maxima doesn't run in docker without the seccomp option).



---

archive/issue_comments_465408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-15T15:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465408",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465409.json:
```json
{
    "body": "Replying to [comment:25 tornaria]:\n> This will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.\n> \n> This is the main reason why I think keeping the default to `maxima -l ecl` might be easier. Unless you want to run the command above with a timeout in spkg-configure and complain if the timeout triggers.\n\nA priori I consider this a packaging issue and not one that we need to worry about in sage. If a distro supplies a slow maxima... maxima will be slow. It still works though, and I see from the void bug that workarounds are available.\n\nHowever: the point of that test was actually to test a memory limit, in #6772. The corresponding code is,\n\n\n```python\n# Remove limit on the max heapsize (since otherwise it defaults                                                                                                      \n# to 256MB with ECL).                                                                                                                                                \nself._sendline(\":lisp (ext:set-limit 'ext:heap-size 0)\")\n```\n\n\nAt least on my machine, the corresponding (default) limit is 4G, and that line of (ECL specific) code is not needed any longer. Can we just remove it along with the test? 256M is not a serious concern in 2022.\n\n\n> BTW, could you add my tiny patch from https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch to your branch? It's a numerical integration, the answer is exactly the same, but the error bound is sligthly different in the `e-15` digit.\n\nDone, thanks.",
    "created_at": "2022-03-15T15:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465409",
    "user": "@orlitzky"
}
```

Replying to [comment:25 tornaria]:
> This will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.
> 
> This is the main reason why I think keeping the default to `maxima -l ecl` might be easier. Unless you want to run the command above with a timeout in spkg-configure and complain if the timeout triggers.

A priori I consider this a packaging issue and not one that we need to worry about in sage. If a distro supplies a slow maxima... maxima will be slow. It still works though, and I see from the void bug that workarounds are available.

However: the point of that test was actually to test a memory limit, in #6772. The corresponding code is,


```python
# Remove limit on the max heapsize (since otherwise it defaults                                                                                                      
# to 256MB with ECL).                                                                                                                                                
self._sendline(":lisp (ext:set-limit 'ext:heap-size 0)")
```


At least on my machine, the corresponding (default) limit is 4G, and that line of (ECL specific) code is not needed any longer. Can we just remove it along with the test? 256M is not a serious concern in 2022.


> BTW, could you add my tiny patch from https://github.com/void-linux/void-packages/blob/master/srcpkgs/sagemath/patches/09-doctest_numerical_fix.patch to your branch? It's a numerical integration, the answer is exactly the same, but the error bound is sligthly different in the `e-15` digit.

Done, thanks.



---

archive/issue_comments_465410.json:
```json
{
    "body": "Replying to [comment:26 tornaria]:\n> In debian, there's a package `maxima` which ships a binary `maxima` (using gcl) and a package `maxima-sage` which ships a binary `maxima-sage` (using ecl) together with `maxima.fas`, so just running `maxima -l ecl` fails but `maxima-sage -l ecl` works. I didn't compile sage in debian so I don't know if maxima-gcl would work ok with sage.\n> \n> Also, the location of `maxima.fas` in `maxima-sage` is not correct so `ecl --eval \"(require 'maxima)\" --eval \"(quit)\"` fails, but `ecl --eval \"(require 'maxima \\\"/usr/lib/ecl/maxima.fas\\\")\" --eval \"(quit)\"` works.\n> \n\n`distros/debian.txt` suggests installing both maxima and maxima-sage, but the library location issue should cause the SPKG to be built on debian. At least for now I am OK with that because it's not a regression and it makes this ticket easier to review. If however someone wants to try to fix those issues in a follow-up ticket I'd be happy to help.",
    "created_at": "2022-03-15T15:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465410",
    "user": "@orlitzky"
}
```

Replying to [comment:26 tornaria]:
> In debian, there's a package `maxima` which ships a binary `maxima` (using gcl) and a package `maxima-sage` which ships a binary `maxima-sage` (using ecl) together with `maxima.fas`, so just running `maxima -l ecl` fails but `maxima-sage -l ecl` works. I didn't compile sage in debian so I don't know if maxima-gcl would work ok with sage.
> 
> Also, the location of `maxima.fas` in `maxima-sage` is not correct so `ecl --eval "(require 'maxima)" --eval "(quit)"` fails, but `ecl --eval "(require 'maxima \"/usr/lib/ecl/maxima.fas\")" --eval "(quit)"` works.
> 

`distros/debian.txt` suggests installing both maxima and maxima-sage, but the library location issue should cause the SPKG to be built on debian. At least for now I am OK with that because it's not a regression and it makes this ticket easier to review. If however someone wants to try to fix those issues in a follow-up ticket I'd be happy to help.



---

archive/issue_comments_465411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-15T16:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465412.json:
```json
{
    "body": "I think it would be good to figure out `MAXIMA` vs. `SAGE_MAXIMA_COMMAND` (see #33405)",
    "created_at": "2022-03-15T19:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465412",
    "user": "@mkoeppe"
}
```

I think it would be good to figure out `MAXIMA` vs. `SAGE_MAXIMA_COMMAND` (see #33405)



---

archive/issue_comments_465413.json:
```json
{
    "body": "Replying to [comment:31 mkoeppe]:\n> I think it would be good to figure out `MAXIMA` vs. `SAGE_MAXIMA_COMMAND` (see #33405)\n\nThere is no such environment variable. Or are you suggesting we standardize the names?",
    "created_at": "2022-03-15T23:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465413",
    "user": "@orlitzky"
}
```

Replying to [comment:31 mkoeppe]:
> I think it would be good to figure out `MAXIMA` vs. `SAGE_MAXIMA_COMMAND` (see #33405)

There is no such environment variable. Or are you suggesting we standardize the names?



---

archive/issue_comments_465414.json:
```json
{
    "body": "https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/expect.py#L137",
    "created_at": "2022-03-15T23:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465414",
    "user": "@mkoeppe"
}
```

https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/expect.py#L137



---

archive/issue_comments_465415.json:
```json
{
    "body": "Replying to [comment:33 mkoeppe]:\n> https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/expect.py#L137\n\nThat only gets executed if `command is None`. The `Maxima` subclass passes in `command = '{0} -p {1}'.format(MAXIMA, shlex.quote(STARTUP))`.",
    "created_at": "2022-03-15T23:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465415",
    "user": "@orlitzky"
}
```

Replying to [comment:33 mkoeppe]:
> https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/expect.py#L137

That only gets executed if `command is None`. The `Maxima` subclass passes in `command = '{0} -p {1}'.format(MAXIMA, shlex.quote(STARTUP))`.



---

archive/issue_comments_465416.json:
```json
{
    "body": "Some of the interfaces pass `command = os.getenv('SAGE_MATHEMATICA_COMMAND') or 'math -rawterm'`. Maxima doesn't, so a questions is whether it should",
    "created_at": "2022-03-16T00:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465416",
    "user": "@mkoeppe"
}
```

Some of the interfaces pass `command = os.getenv('SAGE_MATHEMATICA_COMMAND') or 'math -rawterm'`. Maxima doesn't, so a questions is whether it should



---

archive/issue_comments_465417.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> Some of the interfaces pass `command = os.getenv('SAGE_MATHEMATICA_COMMAND') or 'math -rawterm'`. Maxima doesn't, so a questions is whether it should\n\nI don't see much value in it, but `MAXIMA` already comes from `sage.env`, so we could accomplish the same thing by renaming that variable to `SAGE_MAXIMA_COMMAND`.\n\nMore generally I think we're better off keeping the `sage_conf` values closer to what autotools detects, so that e.g. `MAXIMA` is the path of the \"maxima\" executable that was found. A path is more useful when you want to call something like `subprocess.run`, or any of the path-specific methods. I also think the environment variable overrides are mostly a pointless layer of indirection -- why have two ways to specify the same value? So ultimately I'd rather see `SAGE_*_COMMAND` disappear, but I don't want to hold this ticket up any more than necessary, so I'll go along with the consensus.",
    "created_at": "2022-03-16T01:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465417",
    "user": "@orlitzky"
}
```

Replying to [comment:35 mkoeppe]:
> Some of the interfaces pass `command = os.getenv('SAGE_MATHEMATICA_COMMAND') or 'math -rawterm'`. Maxima doesn't, so a questions is whether it should

I don't see much value in it, but `MAXIMA` already comes from `sage.env`, so we could accomplish the same thing by renaming that variable to `SAGE_MAXIMA_COMMAND`.

More generally I think we're better off keeping the `sage_conf` values closer to what autotools detects, so that e.g. `MAXIMA` is the path of the "maxima" executable that was found. A path is more useful when you want to call something like `subprocess.run`, or any of the path-specific methods. I also think the environment variable overrides are mostly a pointless layer of indirection -- why have two ways to specify the same value? So ultimately I'd rather see `SAGE_*_COMMAND` disappear, but I don't want to hold this ticket up any more than necessary, so I'll go along with the consensus.



---

archive/issue_comments_465418.json:
```json
{
    "body": "Replying to [comment:28 mjo]:\n> Replying to [comment:25 tornaria]:\n> > This will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.\n>\n> A priori I consider this a packaging issue and not one that we need to worry about in sage. If a distro supplies a slow maxima... maxima will be slow. It still works though, and I see from the void bug that workarounds are available.\n\nFair enough. The workaround is simple (and probably I should submit it upstream).\n\n> {{{#!python\n> # Remove limit on the max heapsize (since otherwise it defaults                                                                                                      \n> # to 256MB with ECL).                                                                                                                                                \n> self._sendline(\":lisp (ext:set-limit 'ext:heap-size 0)\")\n> }}}\n> \n> At least on my machine, the corresponding (default) limit is 4G, and that line of (ECL specific) code is not needed any longer. Can we just remove it along with the test? 256M is not a serious concern in 2022.\n\nDid you try in 32 bits? The limit seems to be 1G. Anyway, the point of setting heap-size to 0 is to forget about the limit, since my computer has 32G > 4G. Indeed (64 bit void linux where ecl default heap limit is 4G):\n\n```\n$ time maxima -l ecl -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^20000 $'\n;;; Loading #P\"/usr/lib64/ecl-21.2.1/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-21.2.1/sockets.fas\"\n(%i1) showtime:true\nEvaluation took 0.0000 seconds (0.0000 elapsed)\n(%i2) a:10^10^5\nEvaluation took 0.0010 seconds (0.0010 elapsed)\n(%i3) b:a^20000\nMaxima encountered a Lisp error:\n\n Memory limit reached. Please jump to an outer pointer, quit program and enlarge the\nmemory limits before executing the program again.\n\nAutomatically continuing.\nTo enable the Lisp debugger set *debugger-hook* to nil.\n\nreal\t0m51.739s\nuser\t0m50.231s\nsys\t0m1.031s\n```\n\n\nHowever setting heap-size to 0:\n\n```\n$ time maxima -l ecl -q --batch-string=\":lisp (ext:set-limit 'ext:heap-size 0)\nshowtime : true $ a : 10^(10^5) $ b : a^20000 $\"\n;;; Loading #P\"/usr/lib64/ecl-21.2.1/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-21.2.1/sockets.fas\"\n0\n(%i1) showtime:true\nEvaluation took 0.0000 seconds (0.0000 elapsed)\n(%i2) a:10^10^5\nEvaluation took 0.0000 seconds (0.0010 elapsed)\n(%i3) b:a^20000\nEvaluation took 101.7190 seconds (104.6690 elapsed)\n\nreal\t1m45.805s\nuser\t1m42.147s\nsys\t0m2.826s\n```\n\n\nFor the sake of comparing with maxima/sbcl:\n\n```\n$ time maxima -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^20000 $'\n(%i1) showtime:true\nEvaluation took 0.0000 seconds (0.0010 elapsed) using 0 bytes.\n(%i2) a:10^10^5\nEvaluation took 0.0004 seconds (0.0000 elapsed) using 8.906 KB.\n(%i3) b:a^20000\nEvaluation took 41.2510 seconds (41.5055 elapsed) using 792.009 MB.\n\nreal\t0m41.704s\nuser\t0m39.644s\nsys\t0m1.725s\n```\n\n\nIn the same spirit as your comment about slow maxima, maybe this should be patched in maxima itself, i.e. add `(ext:set-limit 'ext:heap-size 0)` to its initialization code for ECL, rather than have sage poke at this. It seems nicer if the lisp differences are abstracted out by maxima itself as much as possible.",
    "created_at": "2022-03-16T03:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465418",
    "user": "@tornaria"
}
```

Replying to [comment:28 mjo]:
> Replying to [comment:25 tornaria]:
> > This will take a very long time if arithmetic is slow. See: https://github.com/void-linux/void-packages/issues/34849.
>
> A priori I consider this a packaging issue and not one that we need to worry about in sage. If a distro supplies a slow maxima... maxima will be slow. It still works though, and I see from the void bug that workarounds are available.

Fair enough. The workaround is simple (and probably I should submit it upstream).

> {{{#!python
> # Remove limit on the max heapsize (since otherwise it defaults                                                                                                      
> # to 256MB with ECL).                                                                                                                                                
> self._sendline(":lisp (ext:set-limit 'ext:heap-size 0)")
> }}}
> 
> At least on my machine, the corresponding (default) limit is 4G, and that line of (ECL specific) code is not needed any longer. Can we just remove it along with the test? 256M is not a serious concern in 2022.

Did you try in 32 bits? The limit seems to be 1G. Anyway, the point of setting heap-size to 0 is to forget about the limit, since my computer has 32G > 4G. Indeed (64 bit void linux where ecl default heap limit is 4G):

```
$ time maxima -l ecl -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^20000 $'
;;; Loading #P"/usr/lib64/ecl-21.2.1/sb-bsd-sockets.fas"
;;; Loading #P"/usr/lib64/ecl-21.2.1/sockets.fas"
(%i1) showtime:true
Evaluation took 0.0000 seconds (0.0000 elapsed)
(%i2) a:10^10^5
Evaluation took 0.0010 seconds (0.0010 elapsed)
(%i3) b:a^20000
Maxima encountered a Lisp error:

 Memory limit reached. Please jump to an outer pointer, quit program and enlarge the
memory limits before executing the program again.

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.

real	0m51.739s
user	0m50.231s
sys	0m1.031s
```


However setting heap-size to 0:

```
$ time maxima -l ecl -q --batch-string=":lisp (ext:set-limit 'ext:heap-size 0)
showtime : true $ a : 10^(10^5) $ b : a^20000 $"
;;; Loading #P"/usr/lib64/ecl-21.2.1/sb-bsd-sockets.fas"
;;; Loading #P"/usr/lib64/ecl-21.2.1/sockets.fas"
0
(%i1) showtime:true
Evaluation took 0.0000 seconds (0.0000 elapsed)
(%i2) a:10^10^5
Evaluation took 0.0000 seconds (0.0010 elapsed)
(%i3) b:a^20000
Evaluation took 101.7190 seconds (104.6690 elapsed)

real	1m45.805s
user	1m42.147s
sys	0m2.826s
```


For the sake of comparing with maxima/sbcl:

```
$ time maxima -q --batch-string='showtime : true $ a : 10^(10^5) $ b : a^20000 $'
(%i1) showtime:true
Evaluation took 0.0000 seconds (0.0010 elapsed) using 0 bytes.
(%i2) a:10^10^5
Evaluation took 0.0004 seconds (0.0000 elapsed) using 8.906 KB.
(%i3) b:a^20000
Evaluation took 41.2510 seconds (41.5055 elapsed) using 792.009 MB.

real	0m41.704s
user	0m39.644s
sys	0m1.725s
```


In the same spirit as your comment about slow maxima, maybe this should be patched in maxima itself, i.e. add `(ext:set-limit 'ext:heap-size 0)` to its initialization code for ECL, rather than have sage poke at this. It seems nicer if the lisp differences are abstracted out by maxima itself as much as possible.



---

archive/issue_comments_465419.json:
```json
{
    "body": "Replying to [comment:37 tornaria]:\n> \n> Did you try in 32 bits? The limit seems to be 1G. Anyway, the point of setting heap-size to 0 is to forget about the limit, since my computer has 32G > 4G. Indeed (64 bit void linux where ecl default heap limit is 4G):\n\nI think even 1G is reasonable. This code predates the maxima library (introduced in #7287). When there was only a pexpect interface, it needed to be able to perform any computation asked of it. But today you have to go out of your way to both use the pexpect maxima and then to exceed the default limit.\n\n\n> In the same spirit as your comment about slow maxima, maybe this should be patched in maxima itself, i.e. add `(ext:set-limit 'ext:heap-size 0)` to its initialization code for ECL, rather than have sage poke at this. It seems nicer if the lisp differences are abstracted out by maxima itself as much as possible.\n\nYeah, that's an even better idea since it will affect `maxima_console()` and the system's \"maxima\" command as well. Looking through some old tickets I see that clisp also had memory limits in the past, so if they still exist, it would be nice for maxima to make them consistent.",
    "created_at": "2022-03-16T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465419",
    "user": "@orlitzky"
}
```

Replying to [comment:37 tornaria]:
> 
> Did you try in 32 bits? The limit seems to be 1G. Anyway, the point of setting heap-size to 0 is to forget about the limit, since my computer has 32G > 4G. Indeed (64 bit void linux where ecl default heap limit is 4G):

I think even 1G is reasonable. This code predates the maxima library (introduced in #7287). When there was only a pexpect interface, it needed to be able to perform any computation asked of it. But today you have to go out of your way to both use the pexpect maxima and then to exceed the default limit.


> In the same spirit as your comment about slow maxima, maybe this should be patched in maxima itself, i.e. add `(ext:set-limit 'ext:heap-size 0)` to its initialization code for ECL, rather than have sage poke at this. It seems nicer if the lisp differences are abstracted out by maxima itself as much as possible.

Yeah, that's an even better idea since it will affect `maxima_console()` and the system's "maxima" command as well. Looking through some old tickets I see that clisp also had memory limits in the past, so if they still exist, it would be nice for maxima to make them consistent.



---

archive/issue_comments_465420.json:
```json
{
    "body": "The GH action results for this are now visible and I don't think any of the failures are due to this ticket.",
    "created_at": "2022-03-30T01:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465420",
    "user": "@orlitzky"
}
```

The GH action results for this are now visible and I don't think any of the failures are due to this ticket.



---

archive/issue_comments_465421.json:
```json
{
    "body": "On `archlinux-standard` (https://github.com/sagemath/sage/runs/5569512407):\n\n```\nsage -t --warn-long 10.0 --random-seed=323017505472922216154275490909301858905 src/sage/interfaces/maxima_abstract.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 163, in sage.interfaces.maxima_abstract.MaximaAbstract._command_runner\nFailed example:\n    maxima._command_runner('describe', 'gcd')\nExpected:\n    -- Function: gcd (<p_1>, <p_2>, <x_1>, ...)\n    ...\nGot:\n    ;;; Warning: Maxima is unable to set up the help system.\n    (Details: CL-INFO::LOAD-PRIMARY-INDEX: Filesystem error with pathname #P\"/usr/share/info/maxima-index.lisp\".\n    Either\n     1) the file does not exist, or\n     2) we are not allowed to access the file, or\n     3) the pathname points to a broken symbolic link.)\n    <BLANKLINE>\n      No exact match found for topic `gcd'.\n      Try `?? gcd' (inexact match) instead.\n    <BLANKLINE>\n                                         false\n    <BLANKLINE>\n```\n",
    "created_at": "2022-03-30T01:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465421",
    "user": "@mkoeppe"
}
```

On `archlinux-standard` (https://github.com/sagemath/sage/runs/5569512407):

```
sage -t --warn-long 10.0 --random-seed=323017505472922216154275490909301858905 src/sage/interfaces/maxima_abstract.py
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 163, in sage.interfaces.maxima_abstract.MaximaAbstract._command_runner
Failed example:
    maxima._command_runner('describe', 'gcd')
Expected:
    -- Function: gcd (<p_1>, <p_2>, <x_1>, ...)
    ...
Got:
    ;;; Warning: Maxima is unable to set up the help system.
    (Details: CL-INFO::LOAD-PRIMARY-INDEX: Filesystem error with pathname #P"/usr/share/info/maxima-index.lisp".
    Either
     1) the file does not exist, or
     2) we are not allowed to access the file, or
     3) the pathname points to a broken symbolic link.)
    <BLANKLINE>
      No exact match found for topic `gcd'.
      Try `?? gcd' (inexact match) instead.
    <BLANKLINE>
                                         false
    <BLANKLINE>
```




---

archive/issue_comments_465422.json:
```json
{
    "body": "Antonio, do you know what's going wrong in comment:40? I could add a check for `maxima --very-quiet --batch-string=\"describe(gcd);\"` into spkg-configure but I think that it would be better if it just worked on arch.",
    "created_at": "2022-03-30T23:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465422",
    "user": "@orlitzky"
}
```

Antonio, do you know what's going wrong in comment:40? I could add a check for `maxima --very-quiet --batch-string="describe(gcd);"` into spkg-configure but I think that it would be better if it just worked on arch.



---

archive/issue_comments_465423.json:
```json
{
    "body": "Replying to [comment:41 mjo]:\n> Antonio, do you know what's going wrong in comment:40? I could add a check for `maxima --very-quiet --batch-string=\"describe(gcd);\"` into spkg-configure but I think that it would be better if it just worked on arch.\n\nI have no idea. This works just fine in my distro packages and when building this branch from source locally (which picks up system maxima). I suppose it's some docker weirdness, and adding an additional check to spkg-configure won't fix anything since the check will pass.\n\nI noticed there's another failure\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 608, in sage.interfaces.expect.Expect.quit\nFailed example:\n    maxima.quit(verbose=True)\nExpected:\n    Exiting Maxima with PID ... running .../bin/maxima...\nGot:\n    Exiting Maxima with PID 24915 running /usr/sbin/maxima -p /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/sage-maxima.lisp\n**********************************************************************\n```\n\nwhich is caused by using a wrong PATH:\n\n```\n2022-03-18T09:34:23.7683929Z PATH=/sage/build/bin:/sage/src/bin:/sage/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n```\n\n`/usr/sbin` and `/sbin` should **not** be in PATH on Arch, those are symlinks to `/usr/bin` and having them in PATH before `/usr/bin` itself is known to cause issues with cmake (and from what I can see with autotools too). I don't know whether this is also causing the other failure (I don't see how it could, since the path printed in the error message is correct).",
    "created_at": "2022-03-31T09:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465423",
    "user": "@antonio-rojas"
}
```

Replying to [comment:41 mjo]:
> Antonio, do you know what's going wrong in comment:40? I could add a check for `maxima --very-quiet --batch-string="describe(gcd);"` into spkg-configure but I think that it would be better if it just worked on arch.

I have no idea. This works just fine in my distro packages and when building this branch from source locally (which picks up system maxima). I suppose it's some docker weirdness, and adding an additional check to spkg-configure won't fix anything since the check will pass.

I noticed there's another failure

```
**********************************************************************
File "src/sage/interfaces/expect.py", line 608, in sage.interfaces.expect.Expect.quit
Failed example:
    maxima.quit(verbose=True)
Expected:
    Exiting Maxima with PID ... running .../bin/maxima...
Got:
    Exiting Maxima with PID 24915 running /usr/sbin/maxima -p /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/sage-maxima.lisp
**********************************************************************
```

which is caused by using a wrong PATH:

```
2022-03-18T09:34:23.7683929Z PATH=/sage/build/bin:/sage/src/bin:/sage/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

`/usr/sbin` and `/sbin` should **not** be in PATH on Arch, those are symlinks to `/usr/bin` and having them in PATH before `/usr/bin` itself is known to cause issues with cmake (and from what I can see with autotools too). I don't know whether this is also causing the other failure (I don't see how it could, since the path printed in the error message is correct).



---

archive/issue_comments_465424.json:
```json
{
    "body": "Replying to [comment:42 arojas]:\n> Replying to [comment:41 mjo]:\n> \n> I have no idea. This works just fine in my distro packages and when building this branch from source locally (which picks up system maxima). I suppose it's some docker weirdness, and adding an additional check to spkg-configure won't fix anything since the check will pass.\n> \n\nOk, thanks. Matthias, how do you think we should proceed? Ignore the docker-only errors and try to fix them in another ticket? Try the spkg-configure check? I'd rather not break a CI target if we don't have to, but I'm also not keen on trying to debug a docker container for issues that don't appear in the base distro.",
    "created_at": "2022-03-31T15:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465424",
    "user": "@orlitzky"
}
```

Replying to [comment:42 arojas]:
> Replying to [comment:41 mjo]:
> 
> I have no idea. This works just fine in my distro packages and when building this branch from source locally (which picks up system maxima). I suppose it's some docker weirdness, and adding an additional check to spkg-configure won't fix anything since the check will pass.
> 

Ok, thanks. Matthias, how do you think we should proceed? Ignore the docker-only errors and try to fix them in another ticket? Try the spkg-configure check? I'd rather not break a CI target if we don't have to, but I'm also not keen on trying to debug a docker container for issues that don't appear in the base distro.



---

archive/issue_comments_465425.json:
```json
{
    "body": "Maybe try a re-run first in case this was a transient I/O error during installation of dependencies? It's the only reasonable explanation I can think of. (The failure caused by the wrong PATH will still happen, though)",
    "created_at": "2022-03-31T15:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465425",
    "user": "@antonio-rojas"
}
```

Maybe try a re-run first in case this was a transient I/O error during installation of dependencies? It's the only reasonable explanation I can think of. (The failure caused by the wrong PATH will still happen, though)



---

archive/issue_comments_465426.json:
```json
{
    "body": "Replying to [comment:42 arojas]:\n> `/usr/sbin` and `/sbin` should **not** be in PATH on Arch, those are symlinks to `/usr/bin` and having them in PATH before `/usr/bin` itself is known to cause issues with cmake (and from what I can see with autotools too).\n> \n\nThis is just the standard PATH when running as root.\n\n```\n$ docker run -it archlinux:latest\nUnable to find image 'archlinux:latest' locally\nlatest: Pulling from library/archlinux\n4e498e04970c: Pull complete \nc5582fa67946: Pull complete \nDigest: sha256:45a6ee70ee27af0d343a678bc4382c7034d2184576e46c0e5207d5ab7f6dfd27\nStatus: Downloaded newer image for archlinux:latest\n[root@d124a299445f /]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n```\n",
    "created_at": "2022-03-31T15:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465426",
    "user": "@mkoeppe"
}
```

Replying to [comment:42 arojas]:
> `/usr/sbin` and `/sbin` should **not** be in PATH on Arch, those are symlinks to `/usr/bin` and having them in PATH before `/usr/bin` itself is known to cause issues with cmake (and from what I can see with autotools too).
> 

This is just the standard PATH when running as root.

```
$ docker run -it archlinux:latest
Unable to find image 'archlinux:latest' locally
latest: Pulling from library/archlinux
4e498e04970c: Pull complete 
c5582fa67946: Pull complete 
Digest: sha256:45a6ee70ee27af0d343a678bc4382c7034d2184576e46c0e5207d5ab7f6dfd27
Status: Downloaded newer image for archlinux:latest
[root@d124a299445f /]# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```




---

archive/issue_comments_465427.json:
```json
{
    "body": "Replying to [comment:42 arojas]:\n> {{{\n> **********************************************************************\n> File \"src/sage/interfaces/expect.py\", line 608, in sage.interfaces.expect.Expect.quit\n> Failed example:\n>     maxima.quit(verbose=True)\n> Expected:\n>     Exiting Maxima with PID ... running .../bin/maxima...\n> Got:\n>     Exiting Maxima with PID 24915 running /usr/sbin/maxima -p /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/sage-maxima.lisp\n> **********************************************************************\n> }}}\n\nThis can be easily fixed by just relaxing the doctest to look for `...bin/maxima...` instead.",
    "created_at": "2022-03-31T15:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465427",
    "user": "@mkoeppe"
}
```

Replying to [comment:42 arojas]:
> {{{
> **********************************************************************
> File "src/sage/interfaces/expect.py", line 608, in sage.interfaces.expect.Expect.quit
> Failed example:
>     maxima.quit(verbose=True)
> Expected:
>     Exiting Maxima with PID ... running .../bin/maxima...
> Got:
>     Exiting Maxima with PID 24915 running /usr/sbin/maxima -p /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/sage-maxima.lisp
> **********************************************************************
> }}}

This can be easily fixed by just relaxing the doctest to look for `...bin/maxima...` instead.



---

archive/issue_comments_465428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-31T21:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465429.json:
```json
{
    "body": "I've updated that test to look for `...maxima...`, since in theory, the user could put it anywhere so long as it's in his `PATH`.",
    "created_at": "2022-03-31T22:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465429",
    "user": "@orlitzky"
}
```

I've updated that test to look for `...maxima...`, since in theory, the user could put it anywhere so long as it's in his `PATH`.



---

archive/issue_comments_465430.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n \n> This is just the standard PATH when running as root.\n> {{{\n> $ docker run -it archlinux:latest\n> Unable to find image 'archlinux:latest' locally\n> latest: Pulling from library/archlinux\n> 4e498e04970c: Pull complete \n> c5582fa67946: Pull complete \n> Digest: sha256:45a6ee70ee27af0d343a678bc4382c7034d2184576e46c0e5207d5ab7f6dfd27\n> Status: Downloaded newer image for archlinux:latest\n> [root`@`d124a299445f /]# echo $PATH\n> /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n> }}}\n\nAh, I see. I reported it to the docker image maintainers.",
    "created_at": "2022-04-01T16:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465430",
    "user": "@antonio-rojas"
}
```

Replying to [comment:45 mkoeppe]:
 
> This is just the standard PATH when running as root.
> {{{
> $ docker run -it archlinux:latest
> Unable to find image 'archlinux:latest' locally
> latest: Pulling from library/archlinux
> 4e498e04970c: Pull complete 
> c5582fa67946: Pull complete 
> Digest: sha256:45a6ee70ee27af0d343a678bc4382c7034d2184576e46c0e5207d5ab7f6dfd27
> Status: Downloaded newer image for archlinux:latest
> [root`@`d124a299445f /]# echo $PATH
> /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
> }}}

Ah, I see. I reported it to the docker image maintainers.



---

archive/issue_comments_465431.json:
```json
{
    "body": "For what it's worth, after `brew install maxima` on OS X, `config.log` says\n\n```\n## ------------------------------------------------------- ##\n## Checking whether SageMath should install SPKG maxima... ##\n## ------------------------------------------------------- ##\nconfigure:34270: checking whether any of ecl is installed as or will be installed as SPKG\nconfigure:34280: result: no\nconfigure:34285: checking for maxima\nconfigure:34308: found /usr/local/bin/maxima\nconfigure:34320: result: /usr/local/bin/maxima\nconfigure:34335: checking if ECL can \"require\" the maxima module\nAn error occurred during initialization:\nModule error: Don't know how to REQUIRE MAXIMA..\nconfigure:34346: result: no\nconfigure:34377: no suitable system package found for SPKG maxima\n```\n\nIs this the issue discussed in comment:8 and later?",
    "created_at": "2022-04-07T18:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465431",
    "user": "@jhpalmieri"
}
```

For what it's worth, after `brew install maxima` on OS X, `config.log` says

```
## ------------------------------------------------------- ##
## Checking whether SageMath should install SPKG maxima... ##
## ------------------------------------------------------- ##
configure:34270: checking whether any of ecl is installed as or will be installed as SPKG
configure:34280: result: no
configure:34285: checking for maxima
configure:34308: found /usr/local/bin/maxima
configure:34320: result: /usr/local/bin/maxima
configure:34335: checking if ECL can "require" the maxima module
An error occurred during initialization:
Module error: Don't know how to REQUIRE MAXIMA..
configure:34346: result: no
configure:34377: no suitable system package found for SPKG maxima
```

Is this the issue discussed in comment:8 and later?



---

archive/issue_comments_465432.json:
```json
{
    "body": "Replying to [comment:50 jhpalmieri]:\n> For what it's worth, after `brew install maxima` on OS X, `config.log` says\n> {{{\n> configure:34335: checking if ECL can \"require\" the maxima module\n> An error occurred during initialization:\n> Module error: Don't know how to REQUIRE MAXIMA..\n> }}}\n> Is this the issue discussed in comment:8 and later?\n\nYes, that's going to be typical for a while. The homebrew maxima doesn't install the corresponding ECL library, because the upstream release doesn't install it yet. For now, only distros that have patched maxima specifically to work with sage will have have any success with this test. But until then, the fallback of building the SPKG should continue to work normally.",
    "created_at": "2022-04-07T22:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465432",
    "user": "@orlitzky"
}
```

Replying to [comment:50 jhpalmieri]:
> For what it's worth, after `brew install maxima` on OS X, `config.log` says
> {{{
> configure:34335: checking if ECL can "require" the maxima module
> An error occurred during initialization:
> Module error: Don't know how to REQUIRE MAXIMA..
> }}}
> Is this the issue discussed in comment:8 and later?

Yes, that's going to be typical for a while. The homebrew maxima doesn't install the corresponding ECL library, because the upstream release doesn't install it yet. For now, only distros that have patched maxima specifically to work with sage will have have any success with this test. But until then, the fallback of building the SPKG should continue to work normally.



---

archive/issue_comments_465433.json:
```json
{
    "body": "Please add distro info for Arch (package name is `maxima-fas`)",
    "created_at": "2022-04-08T05:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465433",
    "user": "@antonio-rojas"
}
```

Please add distro info for Arch (package name is `maxima-fas`)



---

archive/issue_comments_465434.json:
```json
{
    "body": "Replying to [comment:52 arojas]:\n> Please add distro info for Arch (package name is `maxima-fas`)\n\n`distros/arch.txt` already contains \"maxima-ecl\". Should \"maxima-fas\" replace that, or be appended to it?",
    "created_at": "2022-04-08T12:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465434",
    "user": "@orlitzky"
}
```

Replying to [comment:52 arojas]:
> Please add distro info for Arch (package name is `maxima-fas`)

`distros/arch.txt` already contains "maxima-ecl". Should "maxima-fas" replace that, or be appended to it?



---

archive/issue_comments_465435.json:
```json
{
    "body": "Replying to [comment:53 mjo]:\n> Replying to [comment:52 arojas]:\n> > Please add distro info for Arch (package name is `maxima-fas`)\n> \n> `distros/arch.txt` already contains \"maxima-ecl\". Should \"maxima-fas\" replace that, or be appended to it?\n\noh, sorry, I didn't expect such a file to exist before an spkg-configure was introduced. I have reworked the maxima packaging recently, the fas module is now in a separate `maxima-fas` package (which will in turn pull maxima as a dependency). So `maxima-ecl` sould be replaced.",
    "created_at": "2022-04-08T12:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465435",
    "user": "@antonio-rojas"
}
```

Replying to [comment:53 mjo]:
> Replying to [comment:52 arojas]:
> > Please add distro info for Arch (package name is `maxima-fas`)
> 
> `distros/arch.txt` already contains "maxima-ecl". Should "maxima-fas" replace that, or be appended to it?

oh, sorry, I didn't expect such a file to exist before an spkg-configure was introduced. I have reworked the maxima packaging recently, the fas module is now in a separate `maxima-fas` package (which will in turn pull maxima as a dependency). So `maxima-ecl` sould be replaced.



---

archive/issue_comments_465436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T18:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465436",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465437.json:
```json
{
    "body": "See #33718 for doctest failures using maxima 5.46.0 (just released).",
    "created_at": "2022-04-15T19:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465437",
    "user": "@tornaria"
}
```

See #33718 for doctest failures using maxima 5.46.0 (just released).



---

archive/issue_comments_465438.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-02T21:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465438",
    "user": "@orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_465439.json:
```json
{
    "body": "We may need a lower version bound if the doctest fixes in #33718 are backwards-incompatible. But either way we have to wait because this branch would accept maxima-5.46.0 and begin to fail tests.",
    "created_at": "2022-05-02T21:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32630#issuecomment-465439",
    "user": "@orlitzky"
}
```

We may need a lower version bound if the doctest fixes in #33718 are backwards-incompatible. But either way we have to wait because this branch would accept maxima-5.46.0 and begin to fail tests.
