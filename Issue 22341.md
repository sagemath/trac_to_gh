# Issue 22341: Polyhedron.bounding_box: New keyword argument integral_hull, use it it .integral_points

Issue created by migration from https://trac.sagemath.org/ticket/22578

Original creator: mkoeppe

Original creation time: 2017-03-10 16:41:22

CC:  vdelecroix jipilab tscrim

An amazing insight is that if one wants to know to bounding box of the integer points, rather than of all points, then one can round down upper bounds and round up lower bounds.

This can make a huge difference for integer points enumeration.



---

Comment by mkoeppe created at 2017-03-10 16:54:32

New commits:


---

Comment by mkoeppe created at 2017-03-10 16:54:32

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2017-03-10 16:54:32

Changing keywords from "" to "days84".


---

Comment by tscrim created at 2017-03-14 19:44:58

This causes doctest failures in sandpiles. My guess is something is now returning a `None` that is fed to a `zip`.


---

Comment by tscrim created at 2017-03-14 19:44:58

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2017-03-14 20:10:40

Thanks for catching this. I'm preparing a fix.


---

Comment by git created at 2017-03-14 23:19:07

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2017-03-14 23:23:30

Fixed the failures that resulted from empty bounding boxes; 
but there remain failures that result from different sorting orders of `integral_points`. 
Should I change all these doctests so that they become independent of the sorting order?


---

Comment by tscrim created at 2017-03-14 23:35:10

If the output of `integral_points` is not subject to location in memory, then you don't have to. I'm prepared to set a positive review once addressed.


---

Comment by tscrim created at 2017-03-14 23:35:10

Changing keywords from "days84" to "days84, days85".


---

Comment by mkoeppe created at 2017-03-15 02:18:22

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-03-15 22:26:10

It looks like the order of some doctests in sandpiles have either changes or does depend on the machine/memory location (which is the case if they pass on your machine). I do agree that they are all trivial failures and can be easily fixed, but I just need an answer to which of the above cases we are in.


---

Comment by mkoeppe created at 2017-03-15 22:30:28

I think the order has changed because a different enumeration strategy is selected. I don't think it's machine or address specific.
In my opinion, doctests should not rely on the order of lists whose ordering is unspecified by documentation; they should be rewritten using `sort` or `set`.


---

Comment by tscrim created at 2017-03-16 21:51:55

If you want to change the tests so that the order is sorted, go ahead. I would avoid using `set` since (unfortunately) the output may not be in a specific order. However, we can just change the output for now too. I can also make these changes if you want me to.


---

Comment by mkoeppe created at 2017-03-16 21:56:42

I would strongly suggest to adjust the tests to use `sort` then; because it is very likely that future changes to the lattice point enumeration code (such as automatic selection of the normaliz backend if it is available) will change the order again. If you'd like to go ahead with this change, that would be great...


---

Comment by tscrim created at 2017-03-16 21:58:03

I will do so now.


---

Comment by tscrim created at 2017-03-16 22:09:33

All tests now pass, and they are now checked by sorting the output. If my changes look good to you, then you can set a positive review.
----
New commits:


---

Comment by mkoeppe created at 2017-03-16 22:19:19

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2017-03-16 22:19:19

Looks good. Thanks very much!


---

Comment by vbraun created at 2017-03-27 20:41:44

Resolution: fixed


---

Comment by jmantysalo created at 2017-04-05 05:58:59

Sorry, my typo in a ticket number.
