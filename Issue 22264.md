# Issue 22264: Make it easier to customize pexpect interfaces

archive/issues_022264.json:
```json
{
    "body": "Keywords: pexpect\n\nWhile working on #22452, I found a couple of issues that might be dealt with in a separate ticket.\n\n- Currently, it is assumed that equality test is done by evaluating the line\n  {{{\n\"%s %s %s\"%(var1, self._equality_symbol(), var2)\n  }}}\n  where `self` is a pexpect interface. However, there is software doing comparison by a prefix rather than an infix operator.\n\n  __Suggestion__\n\n  Let `_equality_symbol` be a format string, so that comparison will in future be done by evaluating\n  {{{\nself._equality_symbol().format(var1, var2)\n  }}}\n- It is not always the case that `self.eval(var)` returns a non-empty string. However, in some places in `sage.interfaces`, it is expected that it returns a string representation, provided that `var` corresponds to an integer or a boolean. However, this assumption does NOT hold for Polymake!\n\n  __Suggestion__\n\n  Introduce a method `self._get_primitive` that defaults to `self.eval` but can be overridden for interfaces in which an explicit print statement is needed to get the string representation of an integer.\n- The pexpect interfaces and the interface elements inherit from `Parent` resp. from `Element`. But they override `__repr__`, which is bad.\n\n  __Suggestion__\n\n  Change `__repr__` into single underscore methods in all interfaces.\n- The methods `_pre_interact` and `_post_interact` are defined in sage.interfaces.interface and overridden in sage.interfaces.gap, and there is also a method `call` defined in sage.interfaces.interface. However it seems that none of the three is used anywhere.\n\n  __Suggestion__\n\n  Remove them (without deprecation?).\n\nIssue created by migration from https://trac.sagemath.org/ticket/22501\n\n",
    "created_at": "2017-03-02T18:47:40Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Make it easier to customize pexpect interfaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22264",
    "user": "@simon-king-jena"
}
```
Keywords: pexpect

While working on #22452, I found a couple of issues that might be dealt with in a separate ticket.

- Currently, it is assumed that equality test is done by evaluating the line
  {{{
"%s %s %s"%(var1, self._equality_symbol(), var2)
  }}}
  where `self` is a pexpect interface. However, there is software doing comparison by a prefix rather than an infix operator.

  __Suggestion__

  Let `_equality_symbol` be a format string, so that comparison will in future be done by evaluating
  {{{
self._equality_symbol().format(var1, var2)
  }}}
- It is not always the case that `self.eval(var)` returns a non-empty string. However, in some places in `sage.interfaces`, it is expected that it returns a string representation, provided that `var` corresponds to an integer or a boolean. However, this assumption does NOT hold for Polymake!

  __Suggestion__

  Introduce a method `self._get_primitive` that defaults to `self.eval` but can be overridden for interfaces in which an explicit print statement is needed to get the string representation of an integer.
- The pexpect interfaces and the interface elements inherit from `Parent` resp. from `Element`. But they override `__repr__`, which is bad.

  __Suggestion__

  Change `__repr__` into single underscore methods in all interfaces.
- The methods `_pre_interact` and `_post_interact` are defined in sage.interfaces.interface and overridden in sage.interfaces.gap, and there is also a method `call` defined in sage.interfaces.interface. However it seems that none of the three is used anywhere.

  __Suggestion__

  Remove them (without deprecation?).

Issue created by migration from https://trac.sagemath.org/ticket/22501





---

archive/issue_comments_309388.json:
```json
{
    "body": "There is one more thing. The methods `_left_list_delim`, `_right_func_delim` and similar are currently only used to make the string representation of an interface element a bit more similar to Python. However, it is conceivable that they could be used in a nice default implementation of `__getitem__` - but I am not sure if such a default implementation would really be of wide use.",
    "created_at": "2017-03-02T18:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309388",
    "user": "@simon-king-jena"
}
```

There is one more thing. The methods `_left_list_delim`, `_right_func_delim` and similar are currently only used to make the string representation of an interface element a bit more similar to Python. However, it is conceivable that they could be used in a nice default implementation of `__getitem__` - but I am not sure if such a default implementation would really be of wide use.



---

archive/issue_comments_309389.json:
```json
{
    "body": "Changing keywords from \"pexpect\" to \"pexpect, days84\".",
    "created_at": "2017-03-02T18:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309389",
    "user": "@simon-king-jena"
}
```

Changing keywords from "pexpect" to "pexpect, days84".



---

archive/issue_comments_309390.json:
```json
{
    "body": "The first commit implements and uses `_get_primitive`. Next, I'll add tests.\n----\nNew commits:",
    "created_at": "2017-03-02T19:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309390",
    "user": "@simon-king-jena"
}
```

The first commit implements and uses `_get_primitive`. Next, I'll add tests.
----
New commits:



---

archive/issue_comments_309391.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-02T19:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309391",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309392.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T00:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309392",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309393.json:
```json
{
    "body": "I have now also sanitised string representation of pexpect elements. \"Sanitise\" means: There is a default `__repr__` method that is not supposed to be overridden, and if anything needs to be overridden then it is the single underscore `_repr_`. The change mainly consisted how invalid objects are printed.\n\nSince I am not particularly eager to remove the superfluous functions mentioned in the ticket description, I'll let this be \"needs review\" --- now I have the prerequisites for #22452.\n----\nNew commits:",
    "created_at": "2017-03-03T00:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309393",
    "user": "@simon-king-jena"
}
```

I have now also sanitised string representation of pexpect elements. "Sanitise" means: There is a default `__repr__` method that is not supposed to be overridden, and if anything needs to be overridden then it is the single underscore `_repr_`. The change mainly consisted how invalid objects are printed.

Since I am not particularly eager to remove the superfluous functions mentioned in the ticket description, I'll let this be "needs review" --- now I have the prerequisites for #22452.
----
New commits:



---

archive/issue_comments_309394.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-03T00:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309394",
    "user": "@simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_309395.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-03T09:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309395",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_309396.json:
```json
{
    "body": "I don't think that you should remove doctests.\n\nIf you remove a method which is no longer needed, then move the doctests somewhere else (say, at the top of the module if you don't see a better place) instead of removing them.",
    "created_at": "2017-03-03T09:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309396",
    "user": "@jdemeyer"
}
```

I don't think that you should remove doctests.

If you remove a method which is no longer needed, then move the doctests somewhere else (say, at the top of the module if you don't see a better place) instead of removing them.



---

archive/issue_comments_309397.json:
```json
{
    "body": "Here\n\n```\n        except ValueError:\n            return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())\n```\n\nyou should use the exception message instead of hardcoding `\"defined in terms of closed session\"`. Maybe there are other reasons why a `ValueError` can be raised. And it might also make sense to replace `except ValueError` by `except Exception`.",
    "created_at": "2017-03-03T09:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309397",
    "user": "@jdemeyer"
}
```

Here

```
        except ValueError:
            return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())
```

you should use the exception message instead of hardcoding `"defined in terms of closed session"`. Maybe there are other reasons why a `ValueError` can be raised. And it might also make sense to replace `except ValueError` by `except Exception`.



---

archive/issue_comments_309398.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> I don't think that you should remove doctests.\n> \n> If you remove a method which is no longer needed, then move the doctests somewhere else (say, at the top of the module if you don't see a better place) instead of removing them.\n\nOK, good point. Actually my plan was to do exactly as you said, but I simply forgot it.",
    "created_at": "2017-03-03T09:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309398",
    "user": "@simon-king-jena"
}
```

Replying to [comment:9 jdemeyer]:
> I don't think that you should remove doctests.
> 
> If you remove a method which is no longer needed, then move the doctests somewhere else (say, at the top of the module if you don't see a better place) instead of removing them.

OK, good point. Actually my plan was to do exactly as you said, but I simply forgot it.



---

archive/issue_comments_309399.json:
```json
{
    "body": "Concerning `invalid None object`: in case that `parent` is `None`, could you use the `type` instead? Just because `None` is not a very interesting value.",
    "created_at": "2017-03-03T09:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309399",
    "user": "@jdemeyer"
}
```

Concerning `invalid None object`: in case that `parent` is `None`, could you use the `type` instead? Just because `None` is not a very interesting value.



---

archive/issue_comments_309400.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Here\n> {{{\n>         except ValueError:\n>             return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())\n> }}}\n> you should use the exception message instead of hardcoding `\"defined in terms of closed session\"`. Maybe there are other reasons why a `ValueError` can be raised.\n\nNo. Here is the code of `_check_valid()`:\n\n```\n    def _check_valid(self):\n        \"\"\"\n        Check that this object is valid, i.e., the session in which this\n        object is defined is still running. This is relevant for\n        interpreters that can't be interrupted via ctrl-C, hence get\n        restarted.\n        \"\"\"\n        try:\n            P = self.parent()\n            if P is None:\n                raise ValueError(\"The %s session in which this object was defined is no longer running.\"%P.name())\n        except AttributeError:\n            raise ValueError(\"The session in which this object was defined is no longer running.\")\n        return P\n```\n\nSo, catching the ValueError is exactly the same as saying \"the session is no longer running or some noob overrode `Element.parent` by something that raises a ValueError and thus the whole interface is broken anyway.",
    "created_at": "2017-03-03T09:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309400",
    "user": "@simon-king-jena"
}
```

Replying to [comment:10 jdemeyer]:
> Here
> {{{
>         except ValueError:
>             return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())
> }}}
> you should use the exception message instead of hardcoding `"defined in terms of closed session"`. Maybe there are other reasons why a `ValueError` can be raised.

No. Here is the code of `_check_valid()`:

```
    def _check_valid(self):
        """
        Check that this object is valid, i.e., the session in which this
        object is defined is still running. This is relevant for
        interpreters that can't be interrupted via ctrl-C, hence get
        restarted.
        """
        try:
            P = self.parent()
            if P is None:
                raise ValueError("The %s session in which this object was defined is no longer running."%P.name())
        except AttributeError:
            raise ValueError("The session in which this object was defined is no longer running.")
        return P
```

So, catching the ValueError is exactly the same as saying "the session is no longer running or some noob overrode `Element.parent` by something that raises a ValueError and thus the whole interface is broken anyway.



---

archive/issue_comments_309401.json:
```json
{
    "body": "Since this whole ticket is about *generalizing* why would you assume that ` _check_valid` will never be generalized?",
    "created_at": "2017-03-03T09:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309401",
    "user": "@jdemeyer"
}
```

Since this whole ticket is about *generalizing* why would you assume that ` _check_valid` will never be generalized?



---

archive/issue_comments_309402.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T09:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309402",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309403.json:
```json
{
    "body": "I don't like silly accessor methods like `_get_custom_name` (but that's just a personal opinion). What's wrong with the more explicit\n\n```\ngetattr(foo, \"__custom_name\", None)\n```\n\ninstead of\n\n```\nfoo._get_custom_name()\n```\n\n\nHowever, if you really insist on using `_get_custom_name`, you should at least allow for it to be overridden and it should be used everywhere to access `__custom_name`.",
    "created_at": "2017-03-03T09:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309403",
    "user": "@jdemeyer"
}
```

I don't like silly accessor methods like `_get_custom_name` (but that's just a personal opinion). What's wrong with the more explicit

```
getattr(foo, "__custom_name", None)
```

instead of

```
foo._get_custom_name()
```


However, if you really insist on using `_get_custom_name`, you should at least allow for it to be overridden and it should be used everywhere to access `__custom_name`.



---

archive/issue_comments_309404.json:
```json
{
    "body": "I'm not convinced for the need of the method `_get_primitive()`. Why cannot you just override `eval()` to do the right thing instead of inventing an additional layer of indirection?",
    "created_at": "2017-03-03T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309404",
    "user": "@jdemeyer"
}
```

I'm not convinced for the need of the method `_get_primitive()`. Why cannot you just override `eval()` to do the right thing instead of inventing an additional layer of indirection?



---

archive/issue_comments_309405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T09:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309405",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309406.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n> Since this whole ticket is about *generalizing* why would you assume that ` _check_valid` will never be generalized?\n\nIf the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.",
    "created_at": "2017-03-03T09:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309406",
    "user": "@simon-king-jena"
}
```

Replying to [comment:14 jdemeyer]:
> Since this whole ticket is about *generalizing* why would you assume that ` _check_valid` will never be generalized?

If the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.



---

archive/issue_comments_309407.json:
```json
{
    "body": "Replying to [comment:19 SimonKing]:\n> If the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.\n\nOr you just make a minor change to the code here such that there won't be any bad consequences.",
    "created_at": "2017-03-03T09:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309407",
    "user": "@jdemeyer"
}
```

Replying to [comment:19 SimonKing]:
> If the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.

Or you just make a minor change to the code here such that there won't be any bad consequences.



---

archive/issue_comments_309408.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> I don't like silly accessor methods like `_get_custom_name` (but that's just a personal opinion). What's wrong with the more explicit\n> {{{\n> getattr(foo, \"__custom_name\", None)\n> }}}\n> instead of\n> {{{\n> foo._get_custom_name()\n> }}}\n\nName mangling. It simply didn't work (and was the reason why I added that method). One could of course change `__custom_name` into a less private attribute. But if we keep it private then there should be an accessor method.",
    "created_at": "2017-03-03T09:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309408",
    "user": "@simon-king-jena"
}
```

Replying to [comment:16 jdemeyer]:
> I don't like silly accessor methods like `_get_custom_name` (but that's just a personal opinion). What's wrong with the more explicit
> {{{
> getattr(foo, "__custom_name", None)
> }}}
> instead of
> {{{
> foo._get_custom_name()
> }}}

Name mangling. It simply didn't work (and was the reason why I added that method). One could of course change `__custom_name` into a less private attribute. But if we keep it private then there should be an accessor method.



---

archive/issue_comments_309409.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Replying to [comment:19 SimonKing]:\n> > If the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.\n> \n> Or you just make a minor change to the code here such that there won't be any bad consequences.\n\nI wish SageMath had followed that idea in the past. Otherwise my group cohomology package wouldn't have been broken so often...",
    "created_at": "2017-03-03T09:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309409",
    "user": "@simon-king-jena"
}
```

Replying to [comment:20 jdemeyer]:
> Replying to [comment:19 SimonKing]:
> > If the semantics of `_check_valid` changes then of course the person who changes it has to deal with the consequences.
> 
> Or you just make a minor change to the code here such that there won't be any bad consequences.

I wish SageMath had followed that idea in the past. Otherwise my group cohomology package wouldn't have been broken so often...



---

archive/issue_comments_309410.json:
```json
{
    "body": "Replying to [comment:21 SimonKing]:\n> Name mangling.\n\nThat prevents `foo.__custom_name` but `getattr(foo, \"__custom_name\")` should still work.",
    "created_at": "2017-03-03T09:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309410",
    "user": "@jdemeyer"
}
```

Replying to [comment:21 SimonKing]:
> Name mangling.

That prevents `foo.__custom_name` but `getattr(foo, "__custom_name")` should still work.



---

archive/issue_comments_309411.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> I'm not convinced for the need of the method `_get_primitive()`. Why cannot you just override `eval()` to do the right thing instead of inventing an additional layer of indirection?\n\nCurrently `eval` and `get` have a different semantics, which I tried to explain in the documentation that I added. The reason to introduce `_get_primitive` is performance: If doing `MyInterface.eval('1')` returns `''` then you need a print statement, such as `MyInterface.eval('print(1)')`. However, if you are in an interface such as Gap or Singular then the print statement is not needed, and of course it is a bit faster to not use the print statement.\n\nThus, for *efficiency*, the default is to not use the print statement, but for an interface that needs the print statement you are able to override the default.",
    "created_at": "2017-03-03T09:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309411",
    "user": "@simon-king-jena"
}
```

Replying to [comment:17 jdemeyer]:
> I'm not convinced for the need of the method `_get_primitive()`. Why cannot you just override `eval()` to do the right thing instead of inventing an additional layer of indirection?

Currently `eval` and `get` have a different semantics, which I tried to explain in the documentation that I added. The reason to introduce `_get_primitive` is performance: If doing `MyInterface.eval('1')` returns `''` then you need a print statement, such as `MyInterface.eval('print(1)')`. However, if you are in an interface such as Gap or Singular then the print statement is not needed, and of course it is a bit faster to not use the print statement.

Thus, for *efficiency*, the default is to not use the print statement, but for an interface that needs the print statement you are able to override the default.



---

archive/issue_comments_309412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T09:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309412",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309413.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Here\n> {{{\n>         except ValueError:\n>             return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())\n> }}}\n> you should use the exception message instead of hardcoding `\"defined in terms of closed session\"`.\n\nBy the way, how do I use the exception message? If I do\n\n```\n    except ValueError, msg:\n```\n\nthen `\"no longer\" in msg` doesn't work (ValueError has no `__contains__` method) and `\"no longer\" in msg.message` gives a DeprecationWarning.\n\nSo, am I really supposed to do `\"no longer\" in repr(msg)`? Or did you mean I should let the `__repr__` method return `'(invalid {} object - {})'.format(self.parent() or type(self), msg)`?\n\n> Maybe there are other reasons why a `ValueError` can be raised. And it might also make sense to replace `except ValueError` by `except Exception`.\n\nI was taught by several people to not catch a general `Exception` (in contrast to a more specific type of error) unless it is absolutely clear that I do not want that exception to be propagated. And that's not the case here. If a different error occurs then I don't want to hide it.",
    "created_at": "2017-03-03T09:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309413",
    "user": "@simon-king-jena"
}
```

Replying to [comment:10 jdemeyer]:
> Here
> {{{
>         except ValueError:
>             return '(invalid {} object -- defined in terms of closed session)'.format(self.parent())
> }}}
> you should use the exception message instead of hardcoding `"defined in terms of closed session"`.

By the way, how do I use the exception message? If I do

```
    except ValueError, msg:
```

then `"no longer" in msg` doesn't work (ValueError has no `__contains__` method) and `"no longer" in msg.message` gives a DeprecationWarning.

So, am I really supposed to do `"no longer" in repr(msg)`? Or did you mean I should let the `__repr__` method return `'(invalid {} object - {})'.format(self.parent() or type(self), msg)`?

> Maybe there are other reasons why a `ValueError` can be raised. And it might also make sense to replace `except ValueError` by `except Exception`.

I was taught by several people to not catch a general `Exception` (in contrast to a more specific type of error) unless it is absolutely clear that I do not want that exception to be propagated. And that's not the case here. If a different error occurs then I don't want to hide it.



---

archive/issue_comments_309414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T10:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309414",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309415.json:
```json
{
    "body": "Meanwhile I think it is in fact a good idea to explicitly include the error message of the `ValueError` raised by `self._check_valid()` into the string representation of an invalid interface element `self`. But it really should be `ValueError`. There is no point in trying to guess future semantical changes to `_check_valid`. If someone lets it raise a different error than it is his/her job to take care of backward compatibility.\n----\nNew commits:",
    "created_at": "2017-03-03T10:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309415",
    "user": "@simon-king-jena"
}
```

Meanwhile I think it is in fact a good idea to explicitly include the error message of the `ValueError` raised by `self._check_valid()` into the string representation of an invalid interface element `self`. But it really should be `ValueError`. There is no point in trying to guess future semantical changes to `_check_valid`. If someone lets it raise a different error than it is his/her job to take care of backward compatibility.
----
New commits:



---

archive/issue_comments_309416.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-03T10:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309416",
    "user": "@simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_309417.json:
```json
{
    "body": "I think I have answered the points that you raised. So, I'll change it back to \"needs review\".",
    "created_at": "2017-03-03T10:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309417",
    "user": "@simon-king-jena"
}
```

I think I have answered the points that you raised. So, I'll change it back to "needs review".



---

archive/issue_comments_309418.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-03T10:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309418",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_309419.json:
```json
{
    "body": "What about [comment:16]",
    "created_at": "2017-03-03T10:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309419",
    "user": "@jdemeyer"
}
```

What about [comment:16]



---

archive/issue_comments_309420.json:
```json
{
    "body": "Replying to [comment:24 SimonKing]:\n> Currently `eval` and `get` have a different semantics, which I tried to explain in the documentation that I added. The reason to introduce `_get_primitive` is performance: If doing `MyInterface.eval('1')` returns `''` then you need a print statement, such as `MyInterface.eval('print(1)')`. However, if you are in an interface such as Gap or Singular then the print statement is not needed, and of course it is a bit faster to not use the print statement.\n\nI guess we are misunderstanding eachother. My point was: why not change `SimonKingsInterface.eval()` to add the `print` statement? Why does it need an *additional* method?",
    "created_at": "2017-03-03T10:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309420",
    "user": "@jdemeyer"
}
```

Replying to [comment:24 SimonKing]:
> Currently `eval` and `get` have a different semantics, which I tried to explain in the documentation that I added. The reason to introduce `_get_primitive` is performance: If doing `MyInterface.eval('1')` returns `''` then you need a print statement, such as `MyInterface.eval('print(1)')`. However, if you are in an interface such as Gap or Singular then the print statement is not needed, and of course it is a bit faster to not use the print statement.

I guess we are misunderstanding eachother. My point was: why not change `SimonKingsInterface.eval()` to add the `print` statement? Why does it need an *additional* method?



---

archive/issue_comments_309421.json:
```json
{
    "body": "Replying to [comment:26 SimonKing]:\n> I was taught by several people to not catch a general `Exception` (in contrast to a more specific type of error) unless it is absolutely clear that I do not want that exception to be propagated.\n\nIn general, that's true. I'm just saying that it's debatable whether you do want the exception to be propagated. Anyway, changing this to `except Exception` was just a suggestion so it's perfectly OK to keep it as `except ValueError`.",
    "created_at": "2017-03-03T10:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309421",
    "user": "@jdemeyer"
}
```

Replying to [comment:26 SimonKing]:
> I was taught by several people to not catch a general `Exception` (in contrast to a more specific type of error) unless it is absolutely clear that I do not want that exception to be propagated.

In general, that's true. I'm just saying that it's debatable whether you do want the exception to be propagated. Anyway, changing this to `except Exception` was just a suggestion so it's perfectly OK to keep it as `except ValueError`.



---

archive/issue_comments_309422.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> What about [comment:16]\n\nI already answered that. I was bitten by name mangling. While\n\n```\nsage: r = singular.ring(0,'(x,y)','dp')\nsage: M = singular.matrix(2,2,\"(25/47*x^2*y^4 + 63/127*x + 27)^3,y,0,1\")\nsage: M.rename('T')\nsage: M.__custom_name\n'T'\n```\n\ndoes work, `hasattr(self,'__custom_name')` returned `False` when I had it in the `_repr_` method.\n\nBut if you use `self.__custom_name` in the same module in which the private attribute is defined (namely `sage.structure.sage_object`) then there is no point to use the accessor method, as it is slower.\n\nJust to be on the safe side (maybe I had a typo such as `hasattr(self,'__custon_name')`?), I'll try to change it into using `self.__custom_name?` and tell you what happens.",
    "created_at": "2017-03-03T10:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309422",
    "user": "@simon-king-jena"
}
```

Replying to [comment:30 jdemeyer]:
> What about [comment:16]

I already answered that. I was bitten by name mangling. While

```
sage: r = singular.ring(0,'(x,y)','dp')
sage: M = singular.matrix(2,2,"(25/47*x^2*y^4 + 63/127*x + 27)^3,y,0,1")
sage: M.rename('T')
sage: M.__custom_name
'T'
```

does work, `hasattr(self,'__custom_name')` returned `False` when I had it in the `_repr_` method.

But if you use `self.__custom_name` in the same module in which the private attribute is defined (namely `sage.structure.sage_object`) then there is no point to use the accessor method, as it is slower.

Just to be on the safe side (maybe I had a typo such as `hasattr(self,'__custon_name')`?), I'll try to change it into using `self.__custom_name?` and tell you what happens.



---

archive/issue_comments_309423.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> I guess we are misunderstanding eachother. My point was: why not change `SimonKingsInterface.eval()` to add the `print` statement? Why does it need an *additional* method?\n\nIf you need the print statement then use the (already existing) method `.get()`, not `.eval()`. The same applies to Singular:\n\n```\nsage: r = singular.ring(0,'(x,y)','dp')\nsage: M = singular.matrix(2,2,\"(25/47*x^2*y^4 + 63/127*x + 27)^3,y,0,1\")\nsage: singular.eval(M._name)\n'sage8[1,1]=15625/103823*x^6*y^12+118125/280543*x^5*y^8+50625/2209*x^4*y^8+297675/758063*x^4*y^4+255150/5969*x^3*y^4+54675/47*x^2*y^4+250047/2048383*x^3+321489/16129*x^2+137781/127*x+19683\\nsage8[1,2]=y\\nsage8[2,1]=0\\nsage8[2,2]=1'\nsage: singular.get(M._name)\n'sage8[1,1],y,\\n0,         1 '\n```\n",
    "created_at": "2017-03-03T10:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309423",
    "user": "@simon-king-jena"
}
```

Replying to [comment:31 jdemeyer]:
> I guess we are misunderstanding eachother. My point was: why not change `SimonKingsInterface.eval()` to add the `print` statement? Why does it need an *additional* method?

If you need the print statement then use the (already existing) method `.get()`, not `.eval()`. The same applies to Singular:

```
sage: r = singular.ring(0,'(x,y)','dp')
sage: M = singular.matrix(2,2,"(25/47*x^2*y^4 + 63/127*x + 27)^3,y,0,1")
sage: singular.eval(M._name)
'sage8[1,1]=15625/103823*x^6*y^12+118125/280543*x^5*y^8+50625/2209*x^4*y^8+297675/758063*x^4*y^4+255150/5969*x^3*y^4+54675/47*x^2*y^4+250047/2048383*x^3+321489/16129*x^2+137781/127*x+19683\nsage8[1,2]=y\nsage8[2,1]=0\nsage8[2,2]=1'
sage: singular.get(M._name)
'sage8[1,1],y,\n0,         1 '
```




---

archive/issue_comments_309424.json:
```json
{
    "body": "Maybe you missed [comment:23]. You can override the mangling with `getattr()`/`setattr()`/`hasattr()`.",
    "created_at": "2017-03-03T10:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309424",
    "user": "@jdemeyer"
}
```

Maybe you missed [comment:23]. You can override the mangling with `getattr()`/`setattr()`/`hasattr()`.



---

archive/issue_comments_309425.json:
```json
{
    "body": "Replying to [comment:34 SimonKing]:\n> If you need the print statement then use the (already existing) method `.get()`, not `.eval()`.\n\nI am getting more and more lost here...\n\nGiven what you just said, what's the difference between `get()` and `_get_primitive()`?",
    "created_at": "2017-03-03T10:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309425",
    "user": "@jdemeyer"
}
```

Replying to [comment:34 SimonKing]:
> If you need the print statement then use the (already existing) method `.get()`, not `.eval()`.

I am getting more and more lost here...

Given what you just said, what's the difference between `get()` and `_get_primitive()`?



---

archive/issue_comments_309426.json:
```json
{
    "body": "Replying to [comment:35 jdemeyer]:\n> Maybe you missed [comment:23]. You can override the mangling with `getattr()`/`setattr()`/`hasattr()`.\n\nYes, I missed it. Thanks for pointing it out. Next commit will be removal of `_get_custom_name`.",
    "created_at": "2017-03-03T10:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309426",
    "user": "@simon-king-jena"
}
```

Replying to [comment:35 jdemeyer]:
> Maybe you missed [comment:23]. You can override the mangling with `getattr()`/`setattr()`/`hasattr()`.

Yes, I missed it. Thanks for pointing it out. Next commit will be removal of `_get_custom_name`.



---

archive/issue_comments_309427.json:
```json
{
    "body": "Replying to [comment:36 jdemeyer]:\n> Replying to [comment:34 SimonKing]:\n> > If you need the print statement then use the (already existing) method `.get()`, not `.eval()`.\n> \n> I am getting more and more lost here...\n> \n> Given what you just said, what's the difference between `get()` and `_get_primitive()`?\n\nFor Singular and Gap, `_get_primitive()` does the same as `eval()`, which is fine because primitives (such as integers) in Gap or Singular do not need to be printed in order to get their string representations. So, blindly using `get()` has a small performance effect.\n\nHowever, note that this ticket is a dependency for #22452. And in Polymake, you need an explicit print statement even for primitives; thus, blindly using `eval()` wouldn't do the right thing.\n\nHence, it is needed to introduce a hook `_get_primitive` to customise it.",
    "created_at": "2017-03-03T10:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309427",
    "user": "@simon-king-jena"
}
```

Replying to [comment:36 jdemeyer]:
> Replying to [comment:34 SimonKing]:
> > If you need the print statement then use the (already existing) method `.get()`, not `.eval()`.
> 
> I am getting more and more lost here...
> 
> Given what you just said, what's the difference between `get()` and `_get_primitive()`?

For Singular and Gap, `_get_primitive()` does the same as `eval()`, which is fine because primitives (such as integers) in Gap or Singular do not need to be printed in order to get their string representations. So, blindly using `get()` has a small performance effect.

However, note that this ticket is a dependency for #22452. And in Polymake, you need an explicit print statement even for primitives; thus, blindly using `eval()` wouldn't do the right thing.

Hence, it is needed to introduce a hook `_get_primitive` to customise it.



---

archive/issue_comments_309428.json:
```json
{
    "body": "Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.",
    "created_at": "2017-03-03T10:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309428",
    "user": "@jdemeyer"
}
```

Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.



---

archive/issue_comments_309429.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.\n\nThe default, I think, should cover the **most frequent** case. So far, Polymake is the only interface I am aware of that would need a print statement to show an integer. That's why I chose it to default to `eval()`, which works for...\n\n```\nsage: gp.eval('1')\n'1'\nsage: singular.eval('1')\n'1'\nsage: gap.eval('1')\n'1'\nsage: maxima.eval('1')\n'1'\n```\n\nwhereas you will have (with #22452)\n\n```\nsage: polymake.eval('1')\n''\n```\n",
    "created_at": "2017-03-03T11:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309429",
    "user": "@simon-king-jena"
}
```

Replying to [comment:39 jdemeyer]:
> Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.

The default, I think, should cover the **most frequent** case. So far, Polymake is the only interface I am aware of that would need a print statement to show an integer. That's why I chose it to default to `eval()`, which works for...

```
sage: gp.eval('1')
'1'
sage: singular.eval('1')
'1'
sage: gap.eval('1')
'1'
sage: maxima.eval('1')
'1'
```

whereas you will have (with #22452)

```
sage: polymake.eval('1')
''
```




---

archive/issue_comments_309430.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T11:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309430",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309431.json:
```json
{
    "body": "After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?\n----\nNew commits:",
    "created_at": "2017-03-03T11:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309431",
    "user": "@simon-king-jena"
}
```

After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?
----
New commits:



---

archive/issue_comments_309432.json:
```json
{
    "body": "Replying to [comment:40 SimonKing]:\n> Replying to [comment:39 jdemeyer]:\n> > Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.\n> \n> The default, I think, should cover the **most frequent** case.\n\nNo, I think the default should cover the case which makes it least likely to make mistakes.\n\nI also think that many interfaces have custom `get()` methods but don't really need it. For example, GP has a custom `get()` method calling `print()` but I don't see how GP would treat variables differently from \"primitive\" objects.\n\nAlso, it is mentally a lot easier to understand if `_get_primitive()` would default to `get()`. Until all your extra explanations I found it hard to understand what `_get_primitive()` is about. If you say that `_get_primitive()` is just an optimization for `get()`, then it makes a lot of sense that `_get_primitive()` would default to `get()`.",
    "created_at": "2017-03-03T11:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309432",
    "user": "@jdemeyer"
}
```

Replying to [comment:40 SimonKing]:
> Replying to [comment:39 jdemeyer]:
> > Given the explanations that you just made that `_get_primitive()` is just a more efficient version of `get()`, I think that `_get_primitive()` should default to calling `get()` instead of `eval()`.
> 
> The default, I think, should cover the **most frequent** case.

No, I think the default should cover the case which makes it least likely to make mistakes.

I also think that many interfaces have custom `get()` methods but don't really need it. For example, GP has a custom `get()` method calling `print()` but I don't see how GP would treat variables differently from "primitive" objects.

Also, it is mentally a lot easier to understand if `_get_primitive()` would default to `get()`. Until all your extra explanations I found it hard to understand what `_get_primitive()` is about. If you say that `_get_primitive()` is just an optimization for `get()`, then it makes a lot of sense that `_get_primitive()` would default to `get()`.



---

archive/issue_comments_309433.json:
```json
{
    "body": "Replying to [comment:42 SimonKing]:\n> After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?\n\nI guess so.\n\nDon't forget the doctests. Speaking of which, you should add a direct doctest for `_get_primitive()` too.",
    "created_at": "2017-03-03T11:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309433",
    "user": "@jdemeyer"
}
```

Replying to [comment:42 SimonKing]:
> After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?

I guess so.

Don't forget the doctests. Speaking of which, you should add a direct doctest for `_get_primitive()` too.



---

archive/issue_comments_309434.json:
```json
{
    "body": "Replying to [comment:44 jdemeyer]:\n> Replying to [comment:42 SimonKing]:\n> > After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?\n> \n> I guess so.\n> \n> Don't forget the doctests. Speaking of which, you should add a direct doctest for `_get_primitive()` too.\n\nO, right! I forgot to run `sage --coverage` yet.",
    "created_at": "2017-03-03T11:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309434",
    "user": "@simon-king-jena"
}
```

Replying to [comment:44 jdemeyer]:
> Replying to [comment:42 SimonKing]:
> > After reverting `_get_custom_name` in the latest commit, I think the only open question at the moment is what should be the default for `_get_primitive`, right?
> 
> I guess so.
> 
> Don't forget the doctests. Speaking of which, you should add a direct doctest for `_get_primitive()` too.

O, right! I forgot to run `sage --coverage` yet.



---

archive/issue_comments_309435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T11:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309435",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309436.json:
```json
{
    "body": "Replying to [comment:43 jdemeyer]:\n> I also think that many interfaces have custom `get()` methods but don't really need it. For example, GP has a custom `get()` method calling `print()` but I don't see how GP would treat variables differently from \"primitive\" objects.\n\nIt does treat them differently:\n\n```\nsage: M = random_matrix(ZZ,3,3)\nsage: m = gp(M); n = gp(15)\nsage: gp.get(m._name), gp.get(n._name)\n('[0, -1, 2; 2, -12, 0; -2, 1, 2]', '15')\nsage: gp.eval(m._name), gp.eval(n._name)\n('\\n[ 0  -1 2]\\n\\n[ 2 -12 0]\\n\\n[-2   1 2]\\n', '15')\n```\n\n\nApparently the creator of the interface thought that the latter result is nicer than the former.\n\n> Also, it is mentally a lot easier to understand if `_get_primitive()` would default to `get()`. Until all your extra explanations I found it hard to understand what `_get_primitive()` is about. If you say that `_get_primitive()` is just an optimization for `get()`, then it makes a lot of sense that `_get_primitive()` would default to `get()`.\n\n__First proposition:__ `_get_primitive_` should be used in the default comparison method.\n\n__Rationale:__ Using `eval()` in the default comparison means I'll have to override the comparison method in the Polymake interface (doable of course, but I'd like to avoid it). Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.\n\n__Second proposition:__ If `_get_primitive_` is used in comparison methods, it should default to `eval`.\n\n__Rationale:__ If instead it would default to `get`, I'd need to override the default in ALL existing interfaces, or I would have to live with a performance loss in comparison.\n\n__Counterargument:__ I do override `_get_primitive` in Polymake mainly in order to avoid overriding `__cmp__` (I also use it in helper methods, but they are cached and thus using `get()` is fine there). Hence, why do I introduce `_get_primitive` and override it in Polymake, rather than I change the helper methods to use `get()` and then override `__cmp__` in Polymake?\n----\nNew commits:",
    "created_at": "2017-03-03T11:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309436",
    "user": "@simon-king-jena"
}
```

Replying to [comment:43 jdemeyer]:
> I also think that many interfaces have custom `get()` methods but don't really need it. For example, GP has a custom `get()` method calling `print()` but I don't see how GP would treat variables differently from "primitive" objects.

It does treat them differently:

```
sage: M = random_matrix(ZZ,3,3)
sage: m = gp(M); n = gp(15)
sage: gp.get(m._name), gp.get(n._name)
('[0, -1, 2; 2, -12, 0; -2, 1, 2]', '15')
sage: gp.eval(m._name), gp.eval(n._name)
('\n[ 0  -1 2]\n\n[ 2 -12 0]\n\n[-2   1 2]\n', '15')
```


Apparently the creator of the interface thought that the latter result is nicer than the former.

> Also, it is mentally a lot easier to understand if `_get_primitive()` would default to `get()`. Until all your extra explanations I found it hard to understand what `_get_primitive()` is about. If you say that `_get_primitive()` is just an optimization for `get()`, then it makes a lot of sense that `_get_primitive()` would default to `get()`.

__First proposition:__ `_get_primitive_` should be used in the default comparison method.

__Rationale:__ Using `eval()` in the default comparison means I'll have to override the comparison method in the Polymake interface (doable of course, but I'd like to avoid it). Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.

__Second proposition:__ If `_get_primitive_` is used in comparison methods, it should default to `eval`.

__Rationale:__ If instead it would default to `get`, I'd need to override the default in ALL existing interfaces, or I would have to live with a performance loss in comparison.

__Counterargument:__ I do override `_get_primitive` in Polymake mainly in order to avoid overriding `__cmp__` (I also use it in helper methods, but they are cached and thus using `get()` is fine there). Hence, why do I introduce `_get_primitive` and override it in Polymake, rather than I change the helper methods to use `get()` and then override `__cmp__` in Polymake?
----
New commits:



---

archive/issue_comments_309437.json:
```json
{
    "body": "Replying to [comment:47 SimonKing]:\n> It does treat them differently:\n\nRight, thanks for actually checking my statements :-)\n\n> {{{\n> sage: M = random_matrix(ZZ,3,3)\n> sage: m = gp(M); n = gp(15)\n> sage: gp.get(m._name), gp.get(n._name)\n> ('[0, -1, 2; 2, -12, 0; -2, 1, 2]', '15')\n> sage: gp.eval(m._name), gp.eval(n._name)\n> ('\\n[ 0  -1 2]\\n\\n[ 2 -12 0]\\n\\n[-2   1 2]\\n', '15')\n> }}}\n> \n> Apparently the creator of the interface thought that the latter result is nicer than the former.\n\nYou mean that the former\n\n```\n[0, -1, 2; 2, -12, 0; -2, 1, 2]\n```\n\nis nicer than the latter\n\n```\n[ 0  -1 2]\n\n[ 2 -12 0]\n\n[-2   1 2]\n```\n\n\nI think it depends a lot on the application. If the output of `get()` is supposed to be machine-readable, then certainly the former is nicer.",
    "created_at": "2017-03-03T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309437",
    "user": "@jdemeyer"
}
```

Replying to [comment:47 SimonKing]:
> It does treat them differently:

Right, thanks for actually checking my statements :-)

> {{{
> sage: M = random_matrix(ZZ,3,3)
> sage: m = gp(M); n = gp(15)
> sage: gp.get(m._name), gp.get(n._name)
> ('[0, -1, 2; 2, -12, 0; -2, 1, 2]', '15')
> sage: gp.eval(m._name), gp.eval(n._name)
> ('\n[ 0  -1 2]\n\n[ 2 -12 0]\n\n[-2   1 2]\n', '15')
> }}}
> 
> Apparently the creator of the interface thought that the latter result is nicer than the former.

You mean that the former

```
[0, -1, 2; 2, -12, 0; -2, 1, 2]
```

is nicer than the latter

```
[ 0  -1 2]

[ 2 -12 0]

[-2   1 2]
```


I think it depends a lot on the application. If the output of `get()` is supposed to be machine-readable, then certainly the former is nicer.



---

archive/issue_comments_309438.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> You mean that the former\n> ...\n> is nicer than the latter\n\nYes, copy-and-paste error (first, I had the code ordered differently).",
    "created_at": "2017-03-03T11:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309438",
    "user": "@simon-king-jena"
}
```

Replying to [comment:48 jdemeyer]:
> You mean that the former
> ...
> is nicer than the latter

Yes, copy-and-paste error (first, I had the code ordered differently).



---

archive/issue_comments_309439.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> I think it depends a lot on the application. If the output of `get()` is supposed to be machine-readable, then certainly the former is nicer.\n\nThis I cannot tell. I added some documentation based on the observation the `get` in all cases that I looked at involves printing, whereas `eval` in all instances that I looked at does not. So, if the purpose of `get()` is to get something machine-readable then it hasn't been documented.",
    "created_at": "2017-03-03T11:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309439",
    "user": "@simon-king-jena"
}
```

Replying to [comment:48 jdemeyer]:
> I think it depends a lot on the application. If the output of `get()` is supposed to be machine-readable, then certainly the former is nicer.

This I cannot tell. I added some documentation based on the observation the `get` in all cases that I looked at involves printing, whereas `eval` in all instances that I looked at does not. So, if the purpose of `get()` is to get something machine-readable then it hasn't been documented.



---

archive/issue_comments_309440.json:
```json
{
    "body": "Replying to [comment:47 SimonKing]:\n> __Counterargument:__ I do override `_get_primitive` in Polymake mainly in order to avoid overriding `__cmp__` (I also use it in helper methods, but they are cached and thus using `get()` is fine there). Hence, why do I introduce `_get_primitive` and override it in Polymake, rather than I change the helper methods to use `get()` and then override `__cmp__` in Polymake?\n\nI found my own counter-argument convincing. Thus, I'll remove `_get_primitive` in my next commit. But that has to wait -- I have to prepare the talk that I'm about to give at sage days 84...",
    "created_at": "2017-03-03T11:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309440",
    "user": "@simon-king-jena"
}
```

Replying to [comment:47 SimonKing]:
> __Counterargument:__ I do override `_get_primitive` in Polymake mainly in order to avoid overriding `__cmp__` (I also use it in helper methods, but they are cached and thus using `get()` is fine there). Hence, why do I introduce `_get_primitive` and override it in Polymake, rather than I change the helper methods to use `get()` and then override `__cmp__` in Polymake?

I found my own counter-argument convincing. Thus, I'll remove `_get_primitive` in my next commit. But that has to wait -- I have to prepare the talk that I'm about to give at sage days 84...



---

archive/issue_comments_309441.json:
```json
{
    "body": "Replying to [comment:47 SimonKing]:\n> Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.\n\nAre you sure that there is a real performance hit? Or is this just some hypothetical consideration?",
    "created_at": "2017-03-03T12:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309441",
    "user": "@jdemeyer"
}
```

Replying to [comment:47 SimonKing]:
> Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.

Are you sure that there is a real performance hit? Or is this just some hypothetical consideration?



---

archive/issue_comments_309442.json:
```json
{
    "body": "Replying to [comment:52 jdemeyer]:\n> Replying to [comment:47 SimonKing]:\n> > Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.\n> \n> Are you sure that there is a real performance hit? Or is this just some hypothetical consideration?\n\nIt is hypothetical. And as I said in my previous post I now plan to leave the default implementation of `__cmp__` as it is, do not introduce `_get_primitive`, and override `__cmp__` for the upcoming Polymake interface.",
    "created_at": "2017-03-03T12:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309442",
    "user": "@simon-king-jena"
}
```

Replying to [comment:52 jdemeyer]:
> Replying to [comment:47 SimonKing]:
> > Using `get()` means to lose performance of comparison (thus, an important operation) in all other interfaces.
> 
> Are you sure that there is a real performance hit? Or is this just some hypothetical consideration?

It is hypothetical. And as I said in my previous post I now plan to leave the default implementation of `__cmp__` as it is, do not introduce `_get_primitive`, and override `__cmp__` for the upcoming Polymake interface.



---

archive/issue_comments_309443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-03T16:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309444.json:
```json
{
    "body": "I think with the current commit I have addressed the objections that we discussed above. Note that I did not remove the seemingly unused methods mentioned in the ticket description. I hope that's fine.\n----\nNew commits:",
    "created_at": "2017-03-03T16:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309444",
    "user": "@simon-king-jena"
}
```

I think with the current commit I have addressed the objections that we discussed above. Note that I did not remove the seemingly unused methods mentioned in the ticket description. I hope that's fine.
----
New commits:



---

archive/issue_comments_309445.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-03T16:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309445",
    "user": "@simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_309446.json:
```json
{
    "body": "What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?",
    "created_at": "2017-03-05T14:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309446",
    "user": "@videlec"
}
```

What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?



---

archive/issue_comments_309447.json:
```json
{
    "body": "Replying to [comment:57 vdelecroix]:\n> What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?\n\nI tried `self.__custom_name` before changing to \"getattr\", and it didn't work.",
    "created_at": "2017-03-05T15:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309447",
    "user": "@simon-king-jena"
}
```

Replying to [comment:57 vdelecroix]:
> What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?

I tried `self.__custom_name` before changing to "getattr", and it didn't work.



---

archive/issue_comments_309448.json:
```json
{
    "body": "Replying to [comment:58 SimonKing]:\n> Replying to [comment:57 vdelecroix]:\n> > What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?\n> \n> I tried `self.__custom_name` before changing to \"getattr\", and it didn't work.\n\nIndeed. `__custom_name` wouldn't work to the Python's name mangling. So the old code could never have worked...",
    "created_at": "2017-03-06T14:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309448",
    "user": "@jdemeyer"
}
```

Replying to [comment:58 SimonKing]:
> Replying to [comment:57 vdelecroix]:
> > What is the point of replacing `self.__custom_name` by `getattr(self, '__custom_name')`?
> 
> I tried `self.__custom_name` before changing to "getattr", and it didn't work.

Indeed. `__custom_name` wouldn't work to the Python's name mangling. So the old code could never have worked...



---

archive/issue_comments_309449.json:
```json
{
    "body": "Replying to [comment:56 SimonKing]:\n> I think with the current commit I have addressed the objections that we discussed above. Note that I did not remove the seemingly unused methods mentioned in the ticket description. I hope that's fine.\n\nI think you should update the ticket description. It's much easier to review a ticket like this when the purpose of the ticket is clear.",
    "created_at": "2017-03-06T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309449",
    "user": "@jdemeyer"
}
```

Replying to [comment:56 SimonKing]:
> I think with the current commit I have addressed the objections that we discussed above. Note that I did not remove the seemingly unused methods mentioned in the ticket description. I hope that's fine.

I think you should update the ticket description. It's much easier to review a ticket like this when the purpose of the ticket is clear.



---

archive/issue_comments_309450.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-03-06T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309450",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_309451.json:
```json
{
    "body": "Replace\n\n```\nexcept ValueError, msg\n```\n\nby\n\n```\nexcept ValueError as msg\n```\n",
    "created_at": "2017-03-06T14:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309451",
    "user": "@jdemeyer"
}
```

Replace

```
except ValueError, msg
```

by

```
except ValueError as msg
```




---

archive/issue_comments_309452.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-03-06T15:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309452",
    "user": "@simon-king-jena"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_309453.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-06T15:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309453",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309454.json:
```json
{
    "body": "Replying to [comment:61 jdemeyer]:\n> Replace\n> {{{\n> except ValueError, msg\n> }}}\n> by\n> {{{\n> except ValueError as msg\n> }}}\n\nI did this in the current commit, and I changed the ticket description to say that I believe the mentioned functions \"could be removed, but not on this ticket\".\n\nSo, I guess that means \"needs review\" again.",
    "created_at": "2017-03-06T15:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309454",
    "user": "@simon-king-jena"
}
```

Replying to [comment:61 jdemeyer]:
> Replace
> {{{
> except ValueError, msg
> }}}
> by
> {{{
> except ValueError as msg
> }}}

I did this in the current commit, and I changed the ticket description to say that I believe the mentioned functions "could be removed, but not on this ticket".

So, I guess that means "needs review" again.



---

archive/issue_comments_309455.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-03-06T15:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309455",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_309456.json:
```json
{
    "body": "The ticket description isn't up-to-date. For example, it still talks about `_get_primitive`.",
    "created_at": "2017-03-06T15:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309456",
    "user": "@jdemeyer"
}
```

The ticket description isn't up-to-date. For example, it still talks about `_get_primitive`.



---

archive/issue_comments_309457.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-03-06T16:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309457",
    "user": "@simon-king-jena"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_309458.json:
```json
{
    "body": "I think the ticket description now clearly states what this ticket is doing.",
    "created_at": "2017-03-06T16:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309458",
    "user": "@simon-king-jena"
}
```

I think the ticket description now clearly states what this ticket is doing.



---

archive/issue_comments_309459.json:
```json
{
    "body": "Is the fricas interface not touched because it is \"experimental\"?  I just checked that there is a `__repr__` method in the `FriCAS` class, with two underscores.  Should that be changed?",
    "created_at": "2017-03-14T09:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309459",
    "user": "@mantepse"
}
```

Is the fricas interface not touched because it is "experimental"?  I just checked that there is a `__repr__` method in the `FriCAS` class, with two underscores.  Should that be changed?



---

archive/issue_comments_309460.json:
```json
{
    "body": "Replying to [comment:69 mantepse]:\n> Is the fricas interface not touched because it is \"experimental\"? \n\nNo, I simply missed that one.\n\n> I just checked that there is a `__repr__` method in the `FriCAS` class, with two underscores.  Should that be changed?\n\nYes.",
    "created_at": "2017-03-14T10:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309460",
    "user": "@simon-king-jena"
}
```

Replying to [comment:69 mantepse]:
> Is the fricas interface not touched because it is "experimental"? 

No, I simply missed that one.

> I just checked that there is a `__repr__` method in the `FriCAS` class, with two underscores.  Should that be changed?

Yes.



---

archive/issue_comments_309461.json:
```json
{
    "body": "Oops! I just realise that there are many double underscore `__repr__` that I forgot to change.\n\nAnyway, the interfaces themselves inherit from parent, the objects represented in the interface inherit from element. And that means it should be single underscore, as a rule of thumb.",
    "created_at": "2017-03-14T10:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309461",
    "user": "@simon-king-jena"
}
```

Oops! I just realise that there are many double underscore `__repr__` that I forgot to change.

Anyway, the interfaces themselves inherit from parent, the objects represented in the interface inherit from element. And that means it should be single underscore, as a rule of thumb.



---

archive/issue_comments_309462.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-14T10:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309462",
    "user": "@simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_309463.json:
```json
{
    "body": "Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.",
    "created_at": "2017-03-14T10:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309463",
    "user": "@jdemeyer"
}
```

Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.



---

archive/issue_comments_309464.json:
```json
{
    "body": "Replying to [comment:73 jdemeyer]:\n> Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.\n\nI didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.\n\nHow should I proceed? Shall I rewrite history, force-push and then rebase #22452 on top of it? Or shall I add a commit that re-introduces the whitespace (probably not)?",
    "created_at": "2017-03-14T11:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309464",
    "user": "@simon-king-jena"
}
```

Replying to [comment:73 jdemeyer]:
> Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.

I didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.

How should I proceed? Shall I rewrite history, force-push and then rebase #22452 on top of it? Or shall I add a commit that re-introduces the whitespace (probably not)?



---

archive/issue_comments_309465.json:
```json
{
    "body": "Replying to [comment:74 SimonKing]:\n> Replying to [comment:73 jdemeyer]:\n> > Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.\n> \n> I didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.\n\nSo the editor is the culprit?\n\n> How should I proceed? Shall I rewrite history, force-push and then rebase #22452 on top of it? Or shall I add a commit that re-introduces the whitespace (probably not)?\n\nForce push would even be more trouble now. But I agree that for diff readers, seeing all these tiny modifications is annoying. For the future I would suggest: just start with a first commit that deal with whitespaces and nothing else. Then add non trivial commits on top of that.",
    "created_at": "2017-03-14T12:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309465",
    "user": "@videlec"
}
```

Replying to [comment:74 SimonKing]:
> Replying to [comment:73 jdemeyer]:
> > Since you're changing the branch anyway, could you please either remove the whitespace changes or move them to a separate commit? I found it quite annoying when reviewing to see that many whitespace changes.
> 
> I didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.

So the editor is the culprit?

> How should I proceed? Shall I rewrite history, force-push and then rebase #22452 on top of it? Or shall I add a commit that re-introduces the whitespace (probably not)?

Force push would even be more trouble now. But I agree that for diff readers, seeing all these tiny modifications is annoying. For the future I would suggest: just start with a first commit that deal with whitespaces and nothing else. Then add non trivial commits on top of that.



---

archive/issue_comments_309466.json:
```json
{
    "body": "Replying to [comment:75 vdelecroix]:\n> > I didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.\n> \n> So the editor is the culprit?\n\nI said \"I didn't *intend* to...\". So, the fact that I have this option by default is a good when creating a new file, but bad when editing an existing file that doesn't conform to the standards that sage has regarding trailing whitespace.\n\n> Force push would even be more trouble now. But I agree that for diff readers, seeing all these tiny modifications is annoying. For the future I would suggest: just start with a first commit that deal with whitespaces and nothing else. Then add non trivial commits on top of that.\n\nI am not talking about future. What to do *now*?",
    "created_at": "2017-03-14T12:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309466",
    "user": "@simon-king-jena"
}
```

Replying to [comment:75 vdelecroix]:
> > I didn't intend to do whitespace changes, however my editor (geany) is configured to change tabs into four blanks and to remove trailing whitespace when saving a file.
> 
> So the editor is the culprit?

I said "I didn't *intend* to...". So, the fact that I have this option by default is a good when creating a new file, but bad when editing an existing file that doesn't conform to the standards that sage has regarding trailing whitespace.

> Force push would even be more trouble now. But I agree that for diff readers, seeing all these tiny modifications is annoying. For the future I would suggest: just start with a first commit that deal with whitespaces and nothing else. Then add non trivial commits on top of that.

I am not talking about future. What to do *now*?



---

archive/issue_comments_309467.json:
```json
{
    "body": "Replying to [comment:75 vdelecroix]:\n> Force push would even be more trouble now.\n\nWhy?\n\nYou should not force-push here and then base #22452. Instead, you should force-push #22452, checkout the commit corresponding to this ticket and force-push that.\n\nThat's very easy to do.",
    "created_at": "2017-03-14T12:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309467",
    "user": "@jdemeyer"
}
```

Replying to [comment:75 vdelecroix]:
> Force push would even be more trouble now.

Why?

You should not force-push here and then base #22452. Instead, you should force-push #22452, checkout the commit corresponding to this ticket and force-push that.

That's very easy to do.



---

archive/issue_comments_309468.json:
```json
{
    "body": "Replying to [comment:77 jdemeyer]:\n> Replying to [comment:75 vdelecroix]:\n> > Force push would even be more trouble now.\n> \n> Why?\n> \n> You should not force-push here and then base #22452. Instead, you should force-push #22452, checkout the commit corresponding to this ticket and force-push that.\n> \n> That's very easy to do.\n\nI don't understand that at all. This ticket is a dependency for #22452. Do you suggest to revert the dependencies?",
    "created_at": "2017-03-14T12:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309468",
    "user": "@simon-king-jena"
}
```

Replying to [comment:77 jdemeyer]:
> Replying to [comment:75 vdelecroix]:
> > Force push would even be more trouble now.
> 
> Why?
> 
> You should not force-push here and then base #22452. Instead, you should force-push #22452, checkout the commit corresponding to this ticket and force-push that.
> 
> That's very easy to do.

I don't understand that at all. This ticket is a dependency for #22452. Do you suggest to revert the dependencies?



---

archive/issue_comments_309469.json:
```json
{
    "body": "Replying to [comment:78 SimonKing]:\n> This ticket is a dependency for #22452. Do you suggest to revert the dependencies?\n\nNo. If I understand things correctly, #22452 contains the commit from this ticket (#22501). So you could rebase #22452 but keeping a separation between the commits which really belong to #22501 and the ones which really belong to #22452 (so not squashing everything together).\n\nThen you can force-push #22452. At this point, the branch from #22501 will no longer be a sub-branch of #22452. But that can be fixed by resetting the branch on #22501 to a commit which was pushed on #22452.\n\nI can easily do this myself if you want.",
    "created_at": "2017-03-14T12:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309469",
    "user": "@jdemeyer"
}
```

Replying to [comment:78 SimonKing]:
> This ticket is a dependency for #22452. Do you suggest to revert the dependencies?

No. If I understand things correctly, #22452 contains the commit from this ticket (#22501). So you could rebase #22452 but keeping a separation between the commits which really belong to #22501 and the ones which really belong to #22452 (so not squashing everything together).

Then you can force-push #22452. At this point, the branch from #22501 will no longer be a sub-branch of #22452. But that can be fixed by resetting the branch on #22501 to a commit which was pushed on #22452.

I can easily do this myself if you want.



---

archive/issue_comments_309470.json:
```json
{
    "body": "Replying to [comment:79 jdemeyer]:\n> Replying to [comment:78 SimonKing]:\n> > This ticket is a dependency for #22452. Do you suggest to revert the dependencies?\n> \n> No. If I understand things correctly, #22452 contains the commit from this ticket (#22501).\n\nYes, it does.\n\n> So you could rebase #22452 but keeping a separation between the commits which really belong to #22501 and the ones which really belong to #22452 (so not squashing everything together).\n\nThat's why I suggested to force a change here and then rebase the commits that really belong to #22452 on top of the new forced commit from here (#22501).\n\n> Then you can force-push #22452. At this point, the branch from #22501 will no longer be a sub-branch of #22452. But that can be fixed by resetting the branch on #22501 to a commit which was pushed on #22452.\n\nIt seems to me that the result is equivalent to what I suggest.\n\nSo, my plan now is:\n\n- Create a new single commit for this ticket (#22501) that removes trailing whitespace only in the lines that have also been edited for other reasons.\n- Force-push the new commit here.\n- Rebase the commits from #22452 that really belong to #22452 on top of the new commit. Push (of course using force) the result there.",
    "created_at": "2017-03-14T13:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309470",
    "user": "@simon-king-jena"
}
```

Replying to [comment:79 jdemeyer]:
> Replying to [comment:78 SimonKing]:
> > This ticket is a dependency for #22452. Do you suggest to revert the dependencies?
> 
> No. If I understand things correctly, #22452 contains the commit from this ticket (#22501).

Yes, it does.

> So you could rebase #22452 but keeping a separation between the commits which really belong to #22501 and the ones which really belong to #22452 (so not squashing everything together).

That's why I suggested to force a change here and then rebase the commits that really belong to #22452 on top of the new forced commit from here (#22501).

> Then you can force-push #22452. At this point, the branch from #22501 will no longer be a sub-branch of #22452. But that can be fixed by resetting the branch on #22501 to a commit which was pushed on #22452.

It seems to me that the result is equivalent to what I suggest.

So, my plan now is:

- Create a new single commit for this ticket (#22501) that removes trailing whitespace only in the lines that have also been edited for other reasons.
- Force-push the new commit here.
- Rebase the commits from #22452 that really belong to #22452 on top of the new commit. Push (of course using force) the result there.



---

archive/issue_comments_309471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-14T13:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_309472.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-14T14:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309472",
    "user": "@simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_309473.json:
```json
{
    "body": "I guess both tickets are changed so that reviewing can be resumed (just make sure that you check out the new force-changed branches).",
    "created_at": "2017-03-14T14:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309473",
    "user": "@simon-king-jena"
}
```

I guess both tickets are changed so that reviewing can be resumed (just make sure that you check out the new force-changed branches).



---

archive/issue_comments_309474.json:
```json
{
    "body": "Why `self._obj._check_valid()` is done in `_repr_`? Could it be moved to `__repr__`? That way we would have the clearer `M = self.parent()` in the multiple `_repr_` methods.",
    "created_at": "2017-03-15T09:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309474",
    "user": "@videlec"
}
```

Why `self._obj._check_valid()` is done in `_repr_`? Could it be moved to `__repr__`? That way we would have the clearer `M = self.parent()` in the multiple `_repr_` methods.



---

archive/issue_comments_309475.json:
```json
{
    "body": "Replying to [comment:83 vdelecroix]:\n> Why `self._obj._check_valid()` is done in `_repr_`? Could it be moved to `__repr__`? That way we would have the clearer `M = self.parent()` in the multiple `_repr_` methods.\n\nIn fact, `_check_valid` *is* done in the default (double underscore) `__repr__` - see `sage.interfaces.interface.InterfaceElement`. So, you are right, it should be safe to just do \"self.parent()\". Will change it in a minute.",
    "created_at": "2017-03-15T10:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309475",
    "user": "@simon-king-jena"
}
```

Replying to [comment:83 vdelecroix]:
> Why `self._obj._check_valid()` is done in `_repr_`? Could it be moved to `__repr__`? That way we would have the clearer `M = self.parent()` in the multiple `_repr_` methods.

In fact, `_check_valid` *is* done in the default (double underscore) `__repr__` - see `sage.interfaces.interface.InterfaceElement`. So, you are right, it should be safe to just do "self.parent()". Will change it in a minute.



---

archive/issue_comments_309476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-15T10:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309476",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309477.json:
```json
{
    "body": "Done.\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2017-03-15T10:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309477",
    "user": "@simon-king-jena"
}
```

Done.
----
New commits:
----
New commits:



---

archive/issue_comments_309478.json:
```json
{
    "body": "PS: I will not put this additional commit into #22452, as it isn't relevant there, and I was told to avoid useless merges.",
    "created_at": "2017-03-15T10:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309478",
    "user": "@simon-king-jena"
}
```

PS: I will not put this additional commit into #22452, as it isn't relevant there, and I was told to avoid useless merges.



---

archive/issue_comments_309479.json:
```json
{
    "body": "Oddly, the patchbot reports failures. But as much as I can see they are unrelated with this ticket.",
    "created_at": "2017-03-16T09:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309479",
    "user": "@simon-king-jena"
}
```

Oddly, the patchbot reports failures. But as much as I can see they are unrelated with this ticket.



---

archive/issue_comments_309480.json:
```json
{
    "body": "Indeed. It is weird.\n\nI am good with this ticket, if nobody have further comment I will set it to positive review.",
    "created_at": "2017-03-16T09:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309480",
    "user": "@videlec"
}
```

Indeed. It is weird.

I am good with this ticket, if nobody have further comment I will set it to positive review.



---

archive/issue_comments_309481.json:
```json
{
    "body": "I am currently recompiling, so I can run the tests of the fricas interface (which still has \"experimental\" status, unfortunately).",
    "created_at": "2017-03-16T10:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309481",
    "user": "@mantepse"
}
```

I am currently recompiling, so I can run the tests of the fricas interface (which still has "experimental" status, unfortunately).



---

archive/issue_comments_309482.json:
```json
{
    "body": "OK, fricas tests are passing.",
    "created_at": "2017-03-16T13:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309482",
    "user": "@mantepse"
}
```

OK, fricas tests are passing.



---

archive/issue_comments_309483.json:
```json
{
    "body": "Let it be!",
    "created_at": "2017-03-18T09:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309483",
    "user": "@videlec"
}
```

Let it be!



---

archive/issue_comments_309484.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-18T09:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309484",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309485.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22264#issuecomment-309485",
    "user": "@vbraun"
}
```

Resolution: fixed
