# Issue 28666: Sympy-conversion of complex numbers

Issue created by migration from https://trac.sagemath.org/ticket/28903

Original creator: @mwageringel

Original creation time: 2019-12-20 21:38:13

Keywords: sympy, unicode_art

This ticket implements conversions to Sympy of elements of `ComplexField`, `CDF` and `QuadraticNumberField(-1)`. This solves some inconsistencies with the unicode art of symbolic expressions involving complex numbers.

Most symbolic expressions use the Sympy symbol `ⅈ` for the unicode art of the imaginary unit, but some do not:


```
sage: unicode_art(sqrt(3) * I)  # correct
√3⋅ⅈ
sage: unicode_art(I)  # should use symbol ⅈ
I
sage: unicode_art(cos(I)), cos(I)  # should render the same
(1.54308063481524, cosh(1))
sage: unicode_art(SR(CC(1/3 + I)))  # should use symbol ⅈ
0.333333333333333 + 1.00000000000000*I
sage: unicode_art(SR(CDF(1/3 + I)))  # should use symbol ⅈ
0.3333333333333333 + 1.0*I
```


The underlying problem is that these complex numbers cannot be converted to Sympy, currently, which is what the `unicode_art` method of symbolic expressions would need. In that case, the fallback is the usual string representation, which does not use the symbol `ⅈ`. Hence, this is solved by implementing the conversions above.

Additionally, this ticket improves the conversion to Sympy of elements of `RealField` by taking into account the `precision` of the field.


```
sage: a = SR(RealField(100)(1/3))
sage: a, unicode_art(a)  # unicode art loses precision
(0.33333333333333333333333333333, 0.333333333333333)
```


-----

Note that other implementations of complex numbers (`QQbar`, `CIF`, `CBF`), that cannot meaningfully by converted to Sympy in general, are not affected by this ticket. For example, the following symbolic expressions still render the same:


```
sage: unicode_art(SR(QQbar(1 + I)))
I + 1
sage: unicode_art(SR(CBF(1/3 + I)))
[0.3333333333333333 +/- 7.04e-17] + 1.000000000000000*I
```




---

Comment by @mwageringel created at 2019-12-20 22:17:38

This branch is based on #28891 to avoid a merge conflict.
----
New commits:


---

Comment by @mwageringel created at 2019-12-20 22:17:38

Changing status from new to needs_review.


---

Comment by git created at 2019-12-21 11:37:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2019-12-21 11:39:35

I added another test case:

```
sage: (10.0^400)._sympy_()  # used to be `inf`
1.00000000000000e+400
```



---

Comment by tscrim created at 2019-12-27 16:51:53

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-12-27 16:51:53

LGTM.


---

Comment by chapoton created at 2020-01-01 21:01:32

9.0 is out


---

Comment by vbraun created at 2020-01-05 15:47:08

Resolution: fixed
