# Issue 25779: py3: miscellaneous fixes and cleanup to sage.sandpiles

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-08-07 09:10:18

This fixes a few errors that occurred in Python 3, and in the process performs some other cleanup tasks that stood out in this module, though there's lots more cleaning up that could be done here.

This doesn't fix _all_ the tests for this module on Python 3, as there are still some failures due to sets being displayed in different orders and things like that--but most of them seem trivial.


---

Comment by embray created at 2018-08-07 09:10:57

Changing status from new to needs_review.


---

Comment by saraedum created at 2018-08-07 16:56:52

Could you also have a look at the pyflakes errors since you are cleaning up anyway?


---

Comment by saraedum created at 2018-08-07 16:57:00

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-08-08 12:11:28

Yes, certainly (there are probably a lot in that module).


---

Comment by embray created at 2018-08-08 12:12:32

Well, actually, it's only reporting one small issue.  I guess however the patchbot is configured to run pyflakes it doesn't do much PEP-8 checking, which is probably a good thing because that would be overwhelming...


---

Comment by embray created at 2018-08-08 12:45:34

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-08-08 12:45:34

As it turns out, I think the "unused variable" pyflakes is complaining about here is actually somewhat necessary, just to ensure that the singular ring it references doesn't get deleted or something.  I'm going to leave it for now, unless there is a particular syntax we're using to mark a line as ignored by linters.  I'm not sure we have a specific syntax for that (most linters do but I'm not sure if we're actually consistently doing that yet...)


---

Comment by saraedum created at 2018-08-08 12:58:11

There's no syntax for that afaik.


---

Comment by saraedum created at 2018-08-08 12:59:59

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2018-08-08 12:59:59

I think that you need a doctest for the method that you move to the top level. (The coverage plugin seems to be rightly complaining.)


---

Comment by embray created at 2018-08-08 13:10:55

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-08-08 13:10:55

I explicitly didn't because it's already covered by the tests for the methods that wrap it.  It's not really a new method so much as refactoring many duplicate ones into one place.


---

Comment by saraedum created at 2018-08-09 00:08:31

I'm sorry but the rules say that you need one "An EXAMPLES block for examples. This is not optional." http://doc.sagemath.org/html/en/developer/coding_basics.html.

Actually I wonder if we should drop all these help methods. We usually don't have them. How are sandpiles different?


---

Comment by saraedum created at 2018-08-09 00:08:31

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-08-09 12:01:19

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-08-09 12:01:19

*sigh* I've had this argument before.  At the very least if we're going to have to have this argument again can you leave the status in place?

These functions already have an EXAMPLES block.  This is just refactoring existing code and moving it verbatim elsewhere.  It is wrapped directly by these functions which provide the usage examples and test coverage.  The fact that doing so technically involves a new function is an implementation detail.  See a previous discussion where we already settled this: https://groups.google.com/d/msg/sage-devel/ptdNkphTa1g/KfanYQGkBQAJ


---

Comment by embray created at 2018-08-09 12:10:06

FWIW, perhaps if nothing else those guidelines need to be revisited or slightly reworded.  I think mostly as written it's good, but it's kind of aimed more towards contributions of _new_ code, specifically end-user APIs (though some have argued that examples can be valuable for underscored internal functions, and I agree that is often the case, though not always). 

But the guidelines don't really make as much sense in the context of refactoring existing code or other miscellaneous skunkworks of that sort.

As you know, I'm also working on getting actual line profiled test coverage working for Sage, which in principle is more valuable.  It's a bit tricky though because all the relevant Cython modules have to be compiled with line profiling enabled which makes them much slower.  I suspect it will be more useful for getting coverage on individual modules.  It will probably also be nice in conjunction with `--short`.


---

Comment by embray created at 2018-08-09 12:43:44

Replying to [comment:10 saraedum]:
> Actually I wonder if we should drop all these help methods. We usually don't have them. How are sandpiles different?

I do actually rather like these `help()` methods.  I have no idea why they just happen to be on classes for sandpiles.  I guess whoever implemented this module wanted it--or maybe it came from a separate package that wasn't originally part of Sage.

My inclination is almost to move the `_sandpile_help()` function to a generic method on `SageObject` (in which case then yes, it _would_ get an `EXAMPLES` section in the docstring), and have all these classes inherit from `SageObject`.


---

Comment by chapoton created at 2018-09-25 12:54:14

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-09-25 12:54:14

ok..


---

Comment by vbraun created at 2018-09-27 17:41:26

Resolution: fixed
