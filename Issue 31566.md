# Issue 31566: Make CombinatorialPolyhedron an element class

Issue created by migration from https://trac.sagemath.org/ticket/31803

Original creator: mkoeppe

Original creation time: 2021-05-09 17:12:53

CC:  @kliem jipilab tscrim jhpalmieri yzh

... of a parent class `CombinatorialPolyhedra` in a new category of `CombinatorialPolyhedralSets`.  A parent is defined by (possibly infinite) sets of allowed vertices and facets; every element's set of vertices and facets is a subset of these.

Morphisms in the category are degenerations.

This setup of element/parent/category is parallel to geometric polyhedra: `Polyhedron`/`Polyhedra`/`PolyhedralSets`.

Assigning coordinates in `QQ^3` to labeled `vertices` then defines a morphism from `CombinatorialPolyhedra(vertices, facets)` to `Polyhedra(QQ, 3)`.


---

Comment by git created at 2021-05-09 19:26:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-09 19:30:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-09 19:53:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-09 20:04:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-09 20:05:43

Here's a beginning, without adding anything useful yet.


---

Comment by @kliem created at 2021-05-10 08:56:18

Thanks for taking care of this.

I have no experience with categories and what is best practice there. But I think it makes sense to mention my ideas/plans for this module so they can be considered if they need to.

Status quo (from my point of view):

`CombinatorialPolyhedron` is mainly a wrapper around `FaceIterator`. To make it complete, there is also `PolyhedronFaceLattice` which collects all faces from the `FaceIterator` and calculates all the cover relations.

`FaceIterator` works for simplicial complexes and for the intersection lattice of reflection groups of a root system (as in `ReflectionGroup(['E',6])`).

Plans, Ideas:

- #31245 uses the `FaceIterator` in parallel for the f-vector. This parallel approach is applicable to other problems.
- Now that we use `data_structures/bitset` the underlying bitsets are much easier to handle. This allows doing polyhedral constructions just on the combinatorial polyhedron (and trusting bitsets to do the right thing instead of rethinking everything).
- Eventually some of the code should be moved to a more generic place in sage. Probably it makes sense to have `CombinatorialPolyhedron` inherit from a more generic interface to `FaceIterator`. (I'm currently waiting for #31245). Then simplicial complexes and reflection groups should have access to it as well. In the end it is just an iterator that works over lattices with one of the following properties (atomic = all elements are joins of atoms):
  - intervals of length 2 contain at least 2 elements (true for polytopes and true enough for unbounded polyhedra)
  - simplicial coatomic lattices (or the dual thing) -- a lattice where each interval not containing the upper bound is boolean (true for simplicial complexes and for simplicial polytopes), this iterator is much faster than the previous version
  - it would also for atomic and coatomic lattices in general with some minor changes (however, I don't see a use case yet)
- There is still the big agenda that `CombinatorialPolyhedron` should replace all combinatorial things in cones, lattice polytopes and polyhedra. In particular it should deprecate `sage/src/sage/geometry/hasse_diagram.py`.


---

Comment by mkoeppe created at 2021-05-10 17:00:55

Thanks a lot for sharing this valuable perspective. 

Regarding `PolyhedronFaceLattice`, perhaps this could become a parent class in the categories `CombinatorialPolyhedralSets` and `FiniteLatticePosets`. (Currently you go through making a digraph and calling Poset -- perhaps this can be implemented more directly.)

I think most of the other things are orthogonal to this ticket.


---

Comment by git created at 2021-05-13 21:40:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-14 16:54:49

Missing: The actual implementation of the morphism (`CombinatorialPolyhedraMorphism.__call__` method).


---

Comment by git created at 2021-05-16 00:45:10

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-05-16 01:16:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-28 00:21:56

Should `SimplicialComplexes` become a subcategory of `CombinatorialPolyhedralSets`?


---

Comment by git created at 2021-05-29 01:39:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-09 20:54:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
