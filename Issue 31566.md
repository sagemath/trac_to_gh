# Issue 31566: Make CombinatorialPolyhedron an element class

archive/issues_031566.json:
```json
{
    "body": "CC:  @kliem jipilab tscrim jhpalmieri yzh\n\n... of a parent class `CombinatorialPolyhedra` in a new category of `CombinatorialPolyhedralSets`.  A parent is defined by (possibly infinite) sets of allowed vertices and facets; every element's set of vertices and facets is a subset of these.\n\nMorphisms in the category are degenerations.\n\nThis setup of element/parent/category is parallel to geometric polyhedra: `Polyhedron`/`Polyhedra`/`PolyhedralSets`.\n\nAssigning coordinates in `QQ^3` to labeled `vertices` then defines a morphism from `CombinatorialPolyhedra(vertices, facets)` to `Polyhedra(QQ, 3)`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31803\n\n",
    "created_at": "2021-05-09T17:12:53Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "title": "Make CombinatorialPolyhedron an element class",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31566",
    "user": "mkoeppe"
}
```
CC:  @kliem jipilab tscrim jhpalmieri yzh

... of a parent class `CombinatorialPolyhedra` in a new category of `CombinatorialPolyhedralSets`.  A parent is defined by (possibly infinite) sets of allowed vertices and facets; every element's set of vertices and facets is a subset of these.

Morphisms in the category are degenerations.

This setup of element/parent/category is parallel to geometric polyhedra: `Polyhedron`/`Polyhedra`/`PolyhedralSets`.

Assigning coordinates in `QQ^3` to labeled `vertices` then defines a morphism from `CombinatorialPolyhedra(vertices, facets)` to `Polyhedra(QQ, 3)`.

Issue created by migration from https://trac.sagemath.org/ticket/31803





---

archive/issue_comments_451100.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-09T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451100",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-09T19:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451101",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-09T19:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451102",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-09T20:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451103",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451104.json:
```json
{
    "body": "Here's a beginning, without adding anything useful yet.",
    "created_at": "2021-05-09T20:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451104",
    "user": "mkoeppe"
}
```

Here's a beginning, without adding anything useful yet.



---

archive/issue_comments_451105.json:
```json
{
    "body": "Thanks for taking care of this.\n\nI have no experience with categories and what is best practice there. But I think it makes sense to mention my ideas/plans for this module so they can be considered if they need to.\n\nStatus quo (from my point of view):\n\n`CombinatorialPolyhedron` is mainly a wrapper around `FaceIterator`. To make it complete, there is also `PolyhedronFaceLattice` which collects all faces from the `FaceIterator` and calculates all the cover relations.\n\n`FaceIterator` works for simplicial complexes and for the intersection lattice of reflection groups of a root system (as in `ReflectionGroup(['E',6])`).\n\nPlans, Ideas:\n\n- #31245 uses the `FaceIterator` in parallel for the f-vector. This parallel approach is applicable to other problems.\n- Now that we use `data_structures/bitset` the underlying bitsets are much easier to handle. This allows doing polyhedral constructions just on the combinatorial polyhedron (and trusting bitsets to do the right thing instead of rethinking everything).\n- Eventually some of the code should be moved to a more generic place in sage. Probably it makes sense to have `CombinatorialPolyhedron` inherit from a more generic interface to `FaceIterator`. (I'm currently waiting for #31245). Then simplicial complexes and reflection groups should have access to it as well. In the end it is just an iterator that works over lattices with one of the following properties (atomic = all elements are joins of atoms):\n  - intervals of length 2 contain at least 2 elements (true for polytopes and true enough for unbounded polyhedra)\n  - simplicial coatomic lattices (or the dual thing) -- a lattice where each interval not containing the upper bound is boolean (true for simplicial complexes and for simplicial polytopes), this iterator is much faster than the previous version\n  - it would also for atomic and coatomic lattices in general with some minor changes (however, I don't see a use case yet)\n- There is still the big agenda that `CombinatorialPolyhedron` should replace all combinatorial things in cones, lattice polytopes and polyhedra. In particular it should deprecate `sage/src/sage/geometry/hasse_diagram.py`.",
    "created_at": "2021-05-10T08:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451105",
    "user": "@kliem"
}
```

Thanks for taking care of this.

I have no experience with categories and what is best practice there. But I think it makes sense to mention my ideas/plans for this module so they can be considered if they need to.

Status quo (from my point of view):

`CombinatorialPolyhedron` is mainly a wrapper around `FaceIterator`. To make it complete, there is also `PolyhedronFaceLattice` which collects all faces from the `FaceIterator` and calculates all the cover relations.

`FaceIterator` works for simplicial complexes and for the intersection lattice of reflection groups of a root system (as in `ReflectionGroup(['E',6])`).

Plans, Ideas:

- #31245 uses the `FaceIterator` in parallel for the f-vector. This parallel approach is applicable to other problems.
- Now that we use `data_structures/bitset` the underlying bitsets are much easier to handle. This allows doing polyhedral constructions just on the combinatorial polyhedron (and trusting bitsets to do the right thing instead of rethinking everything).
- Eventually some of the code should be moved to a more generic place in sage. Probably it makes sense to have `CombinatorialPolyhedron` inherit from a more generic interface to `FaceIterator`. (I'm currently waiting for #31245). Then simplicial complexes and reflection groups should have access to it as well. In the end it is just an iterator that works over lattices with one of the following properties (atomic = all elements are joins of atoms):
  - intervals of length 2 contain at least 2 elements (true for polytopes and true enough for unbounded polyhedra)
  - simplicial coatomic lattices (or the dual thing) -- a lattice where each interval not containing the upper bound is boolean (true for simplicial complexes and for simplicial polytopes), this iterator is much faster than the previous version
  - it would also for atomic and coatomic lattices in general with some minor changes (however, I don't see a use case yet)
- There is still the big agenda that `CombinatorialPolyhedron` should replace all combinatorial things in cones, lattice polytopes and polyhedra. In particular it should deprecate `sage/src/sage/geometry/hasse_diagram.py`.



---

archive/issue_comments_451106.json:
```json
{
    "body": "Thanks a lot for sharing this valuable perspective. \n\nRegarding `PolyhedronFaceLattice`, perhaps this could become a parent class in the categories `CombinatorialPolyhedralSets` and `FiniteLatticePosets`. (Currently you go through making a digraph and calling Poset -- perhaps this can be implemented more directly.)\n\nI think most of the other things are orthogonal to this ticket.",
    "created_at": "2021-05-10T17:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451106",
    "user": "mkoeppe"
}
```

Thanks a lot for sharing this valuable perspective. 

Regarding `PolyhedronFaceLattice`, perhaps this could become a parent class in the categories `CombinatorialPolyhedralSets` and `FiniteLatticePosets`. (Currently you go through making a digraph and calling Poset -- perhaps this can be implemented more directly.)

I think most of the other things are orthogonal to this ticket.



---

archive/issue_comments_451107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-13T21:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451107",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451108.json:
```json
{
    "body": "Missing: The actual implementation of the morphism (`CombinatorialPolyhedraMorphism.__call__` method).",
    "created_at": "2021-05-14T16:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451108",
    "user": "mkoeppe"
}
```

Missing: The actual implementation of the morphism (`CombinatorialPolyhedraMorphism.__call__` method).



---

archive/issue_comments_451109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-05-16T00:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451109",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_451110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-16T01:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451110",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451111.json:
```json
{
    "body": "Should `SimplicialComplexes` become a subcategory of `CombinatorialPolyhedralSets`?",
    "created_at": "2021-05-28T00:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451111",
    "user": "mkoeppe"
}
```

Should `SimplicialComplexes` become a subcategory of `CombinatorialPolyhedralSets`?



---

archive/issue_comments_451112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-29T01:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451112",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451113.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-09T20:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31566#issuecomment-451113",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
