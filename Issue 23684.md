# Issue 23684: Expression.__pow__ should try to coerce in both directions

Issue created by migration from https://trac.sagemath.org/ticket/23921

Original creator: behackl

Original creation time: 2017-09-22 14:47:15

CC:  dkrenn cheuberg rws

When computing `symbolic_expression ** something_else`, the result could also live in a common parent of the respective parents, and not necessarily in `SR`. Example, we want:


```
sage: A.<n> = AsymptoticRing('SR^n * n^SR', SR)
sage: SR(2)^n
2^n
```


Currently, this code yields


```
sage: SR(2)^n
Traceback (most recent call last):
...
TypeError: no canonical coercion from Asymptotic Ring <SR^n * n^SR> over Symbolic Ring to Symbolic Ring
```



---

Comment by behackl created at 2017-09-22 14:47:40

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-09-22 14:54:13

And are you sure that you still want to try the "single-sided" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.


---

Comment by jdemeyer created at 2017-09-22 14:54:13

Changing status from needs_review to needs_work.


---

Comment by behackl created at 2017-09-22 15:25:08

Replying to [comment:2 jdemeyer]:
> And are you sure that you still want to try the "single-sided" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.

Thanks for the hint! I'll have a look at `Element.__add__` and change this branch accordingly.


---

Comment by jdemeyer created at 2017-09-22 15:44:02

Also: the example that motivated this ticket would better become a doctest.


---

Comment by git created at 2017-09-22 16:25:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2017-09-22 16:28:38

`Expression.__pow__` now behaves a litte bit more like `Element.__add__`, is this (at least approximately) what you intended?


---

Comment by behackl created at 2017-09-22 16:28:38

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-09-22 16:49:35

Yes, that is more or less what I had in mind. I'll need to check the details.

In the doctest `2^n`, could you also show the `parent()` of the result?


---

Comment by git created at 2017-09-22 17:06:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2017-09-23 16:35:15

Replying to [comment:8 jdemeyer]:
> Yes, that is more or less what I had in mind. I'll need to check the details.
> 
> In the doctest `2^n`, could you also show the `parent()` of the result?

I forgot to comment: sure, done. :-)


---

Comment by jdemeyer created at 2017-09-26 11:19:10

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-09-26 11:19:10

OK, one more detail: `from sage.structure.element import get_coercion_model` is slow because it's a function and, even worse, a Python function. Better use `from sage.structure.element cimport coercion_model` and use that.


---

Comment by git created at 2017-09-26 11:53:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2017-09-26 12:04:17

... changed and now back up for review!


---

Comment by behackl created at 2017-09-26 12:04:17

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-09-26 13:10:05

positive_review if the patchbot is happy.


---

Comment by dkrenn created at 2017-09-28 19:19:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-10-01 00:18:50

Resolution: fixed
