# Issue 23684: Expression.__pow__ should try to coerce in both directions

archive/issues_023684.json:
```json
{
    "body": "CC:  @dkrenn @cheuberg @rwst\n\nWhen computing `symbolic_expression ** something_else`, the result could also live in a common parent of the respective parents, and not necessarily in `SR`. Example, we want:\n\n\n```\nsage: A.<n> = AsymptoticRing('SR^n * n^SR', SR)\nsage: SR(2)^n\n2^n\n```\n\n\nCurrently, this code yields\n\n\n```\nsage: SR(2)^n\nTraceback (most recent call last):\n...\nTypeError: no canonical coercion from Asymptotic Ring <SR^n * n^SR> over Symbolic Ring to Symbolic Ring\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23921\n\n",
    "created_at": "2017-09-22T14:47:15Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Expression.__pow__ should try to coerce in both directions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23684",
    "user": "@behackl"
}
```
CC:  @dkrenn @cheuberg @rwst

When computing `symbolic_expression ** something_else`, the result could also live in a common parent of the respective parents, and not necessarily in `SR`. Example, we want:


```
sage: A.<n> = AsymptoticRing('SR^n * n^SR', SR)
sage: SR(2)^n
2^n
```


Currently, this code yields


```
sage: SR(2)^n
Traceback (most recent call last):
...
TypeError: no canonical coercion from Asymptotic Ring <SR^n * n^SR> over Symbolic Ring to Symbolic Ring
```


Issue created by migration from https://trac.sagemath.org/ticket/23921





---

archive/issue_comments_331760.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-22T14:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331760",
    "user": "@behackl"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331761.json:
```json
{
    "body": "And are you sure that you still want to try the \"single-sided\" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.",
    "created_at": "2017-09-22T14:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331761",
    "user": "@jdemeyer"
}
```

And are you sure that you still want to try the "single-sided" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.



---

archive/issue_comments_331762.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-22T14:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331762",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331763.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> And are you sure that you still want to try the \"single-sided\" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.\n\nThanks for the hint! I'll have a look at `Element.__add__` and change this branch accordingly.",
    "created_at": "2017-09-22T15:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331763",
    "user": "@behackl"
}
```

Replying to [comment:2 jdemeyer]:
> And are you sure that you still want to try the "single-sided" coercions `base = nexp.coerce_in(self)` and `nexp = base.coerce_in(exp)`? I would try to use code inspired by `Element.__add__`, calling `bin_op` to do the coercion.

Thanks for the hint! I'll have a look at `Element.__add__` and change this branch accordingly.



---

archive/issue_comments_331764.json:
```json
{
    "body": "Also: the example that motivated this ticket would better become a doctest.",
    "created_at": "2017-09-22T15:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331764",
    "user": "@jdemeyer"
}
```

Also: the example that motivated this ticket would better become a doctest.



---

archive/issue_comments_331765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T16:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331765",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331766.json:
```json
{
    "body": "`Expression.__pow__` now behaves a litte bit more like `Element.__add__`, is this (at least approximately) what you intended?",
    "created_at": "2017-09-22T16:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331766",
    "user": "@behackl"
}
```

`Expression.__pow__` now behaves a litte bit more like `Element.__add__`, is this (at least approximately) what you intended?



---

archive/issue_comments_331767.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-22T16:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331767",
    "user": "@behackl"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331768.json:
```json
{
    "body": "Yes, that is more or less what I had in mind. I'll need to check the details.\n\nIn the doctest `2^n`, could you also show the `parent()` of the result?",
    "created_at": "2017-09-22T16:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331768",
    "user": "@jdemeyer"
}
```

Yes, that is more or less what I had in mind. I'll need to check the details.

In the doctest `2^n`, could you also show the `parent()` of the result?



---

archive/issue_comments_331769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T17:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331769",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331770.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> Yes, that is more or less what I had in mind. I'll need to check the details.\n> \n> In the doctest `2^n`, could you also show the `parent()` of the result?\n\nI forgot to comment: sure, done. :-)",
    "created_at": "2017-09-23T16:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331770",
    "user": "@behackl"
}
```

Replying to [comment:8 jdemeyer]:
> Yes, that is more or less what I had in mind. I'll need to check the details.
> 
> In the doctest `2^n`, could you also show the `parent()` of the result?

I forgot to comment: sure, done. :-)



---

archive/issue_comments_331771.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-26T11:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331771",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331772.json:
```json
{
    "body": "OK, one more detail: `from sage.structure.element import get_coercion_model` is slow because it's a function and, even worse, a Python function. Better use `from sage.structure.element cimport coercion_model` and use that.",
    "created_at": "2017-09-26T11:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331772",
    "user": "@jdemeyer"
}
```

OK, one more detail: `from sage.structure.element import get_coercion_model` is slow because it's a function and, even worse, a Python function. Better use `from sage.structure.element cimport coercion_model` and use that.



---

archive/issue_comments_331773.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-26T11:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331773",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331774.json:
```json
{
    "body": "... changed and now back up for review!",
    "created_at": "2017-09-26T12:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331774",
    "user": "@behackl"
}
```

... changed and now back up for review!



---

archive/issue_comments_331775.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-26T12:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331775",
    "user": "@behackl"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331776.json:
```json
{
    "body": "positive_review if the patchbot is happy.",
    "created_at": "2017-09-26T13:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331776",
    "user": "@jdemeyer"
}
```

positive_review if the patchbot is happy.



---

archive/issue_comments_331777.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-28T19:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331777",
    "user": "@dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331778.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-01T00:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23684",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23684#issuecomment-331778",
    "user": "@vbraun"
}
```

Resolution: fixed
