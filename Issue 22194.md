# Issue 22194: py3: sagenb is not python3 compatible

archive/issues_022194.json:
```json
{
    "body": "CC:  @dimpase @vbraun @jdemeyer @kcrisman @embray\n\nat least in the current version 0.13\n\nmaybe the latest git version is slightly better in this respect\n\nIssue created by migration from https://trac.sagemath.org/ticket/22431\n\n",
    "created_at": "2017-02-24T09:56:14Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "py3: sagenb is not python3 compatible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22194",
    "user": "@fchapoton"
}
```
CC:  @dimpase @vbraun @jdemeyer @kcrisman @embray

at least in the current version 0.13

maybe the latest git version is slightly better in this respect

Issue created by migration from https://trac.sagemath.org/ticket/22431





---

archive/issue_comments_308289.json:
```json
{
    "body": "Given that sagenb is essentially a dead project, I don't think that it will ever be Python3 compliant.",
    "created_at": "2017-02-24T10:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308289",
    "user": "@jdemeyer"
}
```

Given that sagenb is essentially a dead project, I don't think that it will ever be Python3 compliant.



---

archive/issue_comments_308290.json:
```json
{
    "body": "I did a lot of work on python3 compliance of sagenb since the last release. At least this should prevent the build to stop on syntax errors.",
    "created_at": "2017-02-24T10:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308290",
    "user": "@fchapoton"
}
```

I did a lot of work on python3 compliance of sagenb since the last release. At least this should prevent the build to stop on syntax errors.



---

archive/issue_comments_308291.json:
```json
{
    "body": "IMHO one does not need supernatural resurrection powers to port a dead python2 project of sagenb size to python3---given that all of its python components are python3 compatible (which was not true for Twisted until a couple of years back).",
    "created_at": "2017-02-24T10:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308291",
    "user": "@dimpase"
}
```

IMHO one does not need supernatural resurrection powers to port a dead python2 project of sagenb size to python3---given that all of its python components are python3 compatible (which was not true for Twisted until a couple of years back).



---

archive/issue_comments_308292.json:
```json
{
    "body": "The update of sagenb is probably dependent of #20922.",
    "created_at": "2017-02-27T13:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308292",
    "user": "@fchapoton"
}
```

The update of sagenb is probably dependent of #20922.



---

archive/issue_comments_308293.json:
```json
{
    "body": "can we hope to make a (maybe last) release of the legacy notebook ?",
    "created_at": "2017-04-04T19:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308293",
    "user": "@fchapoton"
}
```

can we hope to make a (maybe last) release of the legacy notebook ?



---

archive/issue_comments_308294.json:
```json
{
    "body": "At the least https://github.com/sagemath/sagenb/pull/416 and your own https://github.com/sagemath/sagenb/pull/423 would need to be merged first, right?\n\nI don't really see any reason to not keep the legacy notebook around for quite some time, granting that it will not receive much attention.   We just got a support request from someone using Sage 4.6 (!) who really didn't want to upgrade; this is positively new compared to that.\n\nBut I definitely agree that whatever the absolute minimum needed to get sagenb to work minimally with python3 is fine.",
    "created_at": "2017-04-04T19:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308294",
    "user": "@kcrisman"
}
```

At the least https://github.com/sagemath/sagenb/pull/416 and your own https://github.com/sagemath/sagenb/pull/423 would need to be merged first, right?

I don't really see any reason to not keep the legacy notebook around for quite some time, granting that it will not receive much attention.   We just got a support request from someone using Sage 4.6 (!) who really didn't want to upgrade; this is positively new compared to that.

But I definitely agree that whatever the absolute minimum needed to get sagenb to work minimally with python3 is fine.



---

archive/issue_comments_308295.json:
```json
{
    "body": "\u200bhttps://github.com/sagemath/sagenb/pull/423 should now be ready",
    "created_at": "2017-04-06T12:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308295",
    "user": "@fchapoton"
}
```

â€‹https://github.com/sagemath/sagenb/pull/423 should now be ready



---

archive/issue_comments_308296.json:
```json
{
    "body": "Would it be possible to make a new release of sagenb, please ?",
    "created_at": "2017-05-03T13:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308296",
    "user": "@fchapoton"
}
```

Would it be possible to make a new release of sagenb, please ?



---

archive/issue_comments_308297.json:
```json
{
    "body": "Replying to [comment:11 chapoton]:\n> Would it be possible to make a new release of sagenb, please ?\n\nI'll try.",
    "created_at": "2017-05-03T13:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308297",
    "user": "@dimpase"
}
```

Replying to [comment:11 chapoton]:
> Would it be possible to make a new release of sagenb, please ?

I'll try.



---

archive/issue_comments_308298.json:
```json
{
    "body": "Please test https://github.com/sagemath/sagenb/tree/1.0.rc0\n(copy of the current master)\nbefore I go ahead with making a new Sage package.\nIt works for me following the instructions in HACKING (updated, to take care of changed names and of the need to deal with mathjax).\n\nReport issues on github, please",
    "created_at": "2017-05-10T14:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308298",
    "user": "@dimpase"
}
```

Please test https://github.com/sagemath/sagenb/tree/1.0.rc0
(copy of the current master)
before I go ahead with making a new Sage package.
It works for me following the instructions in HACKING (updated, to take care of changed names and of the need to deal with mathjax).

Report issues on github, please



---

archive/issue_comments_308299.json:
```json
{
    "body": "the new sagenb is on #23066 and needs review.",
    "created_at": "2017-05-24T22:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308299",
    "user": "@dimpase"
}
```

the new sagenb is on #23066 and needs review.



---

archive/issue_comments_308300.json:
```json
{
    "body": "> the new sagenb is on #23066 and needs review.\nReading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  \n\nWhat about comment:6 about #20922 - still valid?",
    "created_at": "2017-05-24T23:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308300",
    "user": "@kcrisman"
}
```

> the new sagenb is on #23066 and needs review.
Reading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  

What about comment:6 about #20922 - still valid?



---

archive/issue_comments_308301.json:
```json
{
    "body": "Replying to [comment:15 kcrisman]:\n> > the new sagenb is on #23066 and needs review.\n> Reading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  \n\nGiven that Sage does not run with Python 3 yet, it's a bit early to say, no?\n\n> \n> What about comment:6 about #20922 - still valid?\n\nProbably not really, for it does work without #20922 - I don't get doctest failures mentoined in comment 4 on #20922.\n\n```\n$ sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py\nRunning doctests with ID 2017-05-25-05-57-19-d9e71fa3.\nGit branch: sagenb10\nUsing --optional=ccache,database_gap,gap_packages,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 117.7 local/lib/python2.7/site-packages/sagenb/notebook/challenge.py\n    [113 tests, 0.38 s]\n----------------------------------------------------------------------\nAll tests passed!\n```\n\n\nI also do not see any mention of `click` package in sagenb's installation log.",
    "created_at": "2017-05-25T04:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308301",
    "user": "@dimpase"
}
```

Replying to [comment:15 kcrisman]:
> > the new sagenb is on #23066 and needs review.
> Reading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  

Given that Sage does not run with Python 3 yet, it's a bit early to say, no?

> 
> What about comment:6 about #20922 - still valid?

Probably not really, for it does work without #20922 - I don't get doctest failures mentoined in comment 4 on #20922.

```
$ sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py
Running doctests with ID 2017-05-25-05-57-19-d9e71fa3.
Git branch: sagenb10
Using --optional=ccache,database_gap,gap_packages,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 117.7 local/lib/python2.7/site-packages/sagenb/notebook/challenge.py
    [113 tests, 0.38 s]
----------------------------------------------------------------------
All tests passed!
```


I also do not see any mention of `click` package in sagenb's installation log.



---

archive/issue_comments_308302.json:
```json
{
    "body": "> > > the new sagenb is on #23066 and needs review.\n> > Reading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  \n> \n> Given that Sage does not run with Python 3 yet, it's a bit early to say, no?\n\nHaha, I thought we were closer to that now.  No worries, just checking in.",
    "created_at": "2017-05-25T14:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308302",
    "user": "@kcrisman"
}
```

> > > the new sagenb is on #23066 and needs review.
> > Reading the comments there and at #22787 make it unclear to me whether this one is, in fact, py3 compatible.  
> 
> Given that Sage does not run with Python 3 yet, it's a bit early to say, no?

Haha, I thought we were closer to that now.  No worries, just checking in.



---

archive/issue_comments_308303.json:
```json
{
    "body": "see also https://github.com/sagemath/sagenb/issues/440\n- some of these dependencies should go, indeed.",
    "created_at": "2018-04-16T12:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308303",
    "user": "@dimpase"
}
```

see also https://github.com/sagemath/sagenb/issues/440
- some of these dependencies should go, indeed.



---

archive/issue_comments_308304.json:
```json
{
    "body": "We should also get rid of the sagenb documentation building, which does not work in the python3 sage..\n\nSee\n\nhttps://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-15%2012:37:45?plugin=docbuild",
    "created_at": "2018-05-16T09:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308304",
    "user": "@fchapoton"
}
```

We should also get rid of the sagenb documentation building, which does not work in the python3 sage..

See

https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-15%2012:37:45?plugin=docbuild



---

archive/issue_comments_308305.json:
```json
{
    "body": "see #25382",
    "created_at": "2018-05-17T08:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308305",
    "user": "@fchapoton"
}
```

see #25382



---

archive/issue_comments_308306.json:
```json
{
    "body": "What is the current status of this ticket (as opposed to the documentation build)?  I thought at least some of these issues were dealt with.  If it's just the graph functionality those can certainly be disabled, as I don't think they have worked properly for some time.  If it's certain dependencies that is required for py3 that is somewhat different.",
    "created_at": "2018-05-17T12:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308306",
    "user": "@kcrisman"
}
```

What is the current status of this ticket (as opposed to the documentation build)?  I thought at least some of these issues were dealt with.  If it's just the graph functionality those can certainly be disabled, as I don't think they have worked properly for some time.  If it's certain dependencies that is required for py3 that is somewhat different.



---

archive/issue_comments_308307.json:
```json
{
    "body": "trying to install sagenb, one gets\n\n```\n[sagenb-1.0.1]   Removing source in /tmp/pip-pzy8td0f-build\n[sagenb-1.0.1] Successfully installed sagenb-1.0.1\n[sagenb-1.0.1] Cleaning up...\n[sagenb-1.0.1] ./spkg-install: line 56: cd: /home/chapoton/sage3/local/lib/python2.7/site-packages/sagenb/data: No such file or directory\n[sagenb-1.0.1] Error: Cannot find SageNB data directory.\n[sagenb-1.0.1] \n```\n\nbecause it is looking for sageNB data in the python2 library..",
    "created_at": "2018-05-18T11:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308307",
    "user": "@fchapoton"
}
```

trying to install sagenb, one gets

```
[sagenb-1.0.1]   Removing source in /tmp/pip-pzy8td0f-build
[sagenb-1.0.1] Successfully installed sagenb-1.0.1
[sagenb-1.0.1] Cleaning up...
[sagenb-1.0.1] ./spkg-install: line 56: cd: /home/chapoton/sage3/local/lib/python2.7/site-packages/sagenb/data: No such file or directory
[sagenb-1.0.1] Error: Cannot find SageNB data directory.
[sagenb-1.0.1] 
```

because it is looking for sageNB data in the python2 library..



---

archive/issue_comments_308308.json:
```json
{
    "body": "Dima, could you please make a new release of sagenb ?\n\nCurrently (apart from the mathjax issue above in spkg-install) sagenb 1.0.1 installs with sage3, but fails to run because of \n\n```\nTraceback (most recent call last):\n  File \"/home/chapoton/sage3/src/bin/sage-notebook\", line 268, in <module>\n    launcher(unknown)\n  File \"/home/chapoton/sage3/src/bin/sage-notebook\", line 69, in __init__\n    from sagenb.notebook.notebook_object import notebook\n  File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/sagenb/notebook/notebook_object.py\", line 23, in <module>\n    from . import run_notebook\n  File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/sagenb/notebook/run_notebook.py\", line 21, in <module>\n    from exceptions import SystemExit\nModuleNotFoundError: No module named 'exceptions'\n```\n\nwhich has been fixed after the release of 1.0.1",
    "created_at": "2018-05-18T11:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308308",
    "user": "@fchapoton"
}
```

Dima, could you please make a new release of sagenb ?

Currently (apart from the mathjax issue above in spkg-install) sagenb 1.0.1 installs with sage3, but fails to run because of 

```
Traceback (most recent call last):
  File "/home/chapoton/sage3/src/bin/sage-notebook", line 268, in <module>
    launcher(unknown)
  File "/home/chapoton/sage3/src/bin/sage-notebook", line 69, in __init__
    from sagenb.notebook.notebook_object import notebook
  File "/home/chapoton/sage3/local/lib/python3.6/site-packages/sagenb/notebook/notebook_object.py", line 23, in <module>
    from . import run_notebook
  File "/home/chapoton/sage3/local/lib/python3.6/site-packages/sagenb/notebook/run_notebook.py", line 21, in <module>
    from exceptions import SystemExit
ModuleNotFoundError: No module named 'exceptions'
```

which has been fixed after the release of 1.0.1



---

archive/issue_comments_308309.json:
```json
{
    "body": "OK, I'll try today. Sorry for sitting on this...",
    "created_at": "2018-05-18T12:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308309",
    "user": "@dimpase"
}
```

OK, I'll try today. Sorry for sitting on this...



---

archive/issue_comments_308310.json:
```json
{
    "body": "see also #25394",
    "created_at": "2018-05-18T18:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308310",
    "user": "@fchapoton"
}
```

see also #25394



---

archive/issue_comments_308311.json:
```json
{
    "body": "shouldn't the description say \"current 1.0.1\" ? \n(sorry, I'm still not done with a new release)",
    "created_at": "2018-05-22T16:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308311",
    "user": "@dimpase"
}
```

shouldn't the description say "current 1.0.1" ? 
(sorry, I'm still not done with a new release)



---

archive/issue_comments_308312.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-22T16:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308312",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308313.json:
```json
{
    "body": "here is the latest master from sagenb repo\n----\nNew commits:",
    "created_at": "2018-05-22T16:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308313",
    "user": "@dimpase"
}
```

here is the latest master from sagenb repo
----
New commits:



---

archive/issue_comments_308314.json:
```json
{
    "body": "Thanks for the release, Dima. It will not yet be fully py3-compatible, but this should not prevent us from being able to install sagenb in py3-sage.\n\nThis second part means : first remove the conditional statement on PYTHON3 in spkg_install (on top of the changes in #25394) and do something for the lines about mathjax in this spkg-install. I managed to install sagenb in py3 sage by commenting out these mathjax lines, but this is obviously not a correct solution.",
    "created_at": "2018-05-22T17:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308314",
    "user": "@fchapoton"
}
```

Thanks for the release, Dima. It will not yet be fully py3-compatible, but this should not prevent us from being able to install sagenb in py3-sage.

This second part means : first remove the conditional statement on PYTHON3 in spkg_install (on top of the changes in #25394) and do something for the lines about mathjax in this spkg-install. I managed to install sagenb in py3 sage by commenting out these mathjax lines, but this is obviously not a correct solution.



---

archive/issue_comments_308315.json:
```json
{
    "body": "I have put a tentative branch at public/ticket/22431 for the changes in spkg-install (it needs work).",
    "created_at": "2018-05-22T18:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308315",
    "user": "@fchapoton"
}
```

I have put a tentative branch at public/ticket/22431 for the changes in spkg-install (it needs work).



---

archive/issue_comments_308316.json:
```json
{
    "body": "What would \"full py3 compatibility\" entail?  Just curious.  THANK YOU for this work.",
    "created_at": "2018-05-22T19:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308316",
    "user": "@kcrisman"
}
```

What would "full py3 compatibility" entail?  Just curious.  THANK YOU for this work.



---

archive/issue_comments_308317.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-22T21:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308317",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308318.json:
```json
{
    "body": "Replying to [comment:32 chapoton]:\n> I have put a tentative branch at public/ticket/22431 for the changes in spkg-install (it needs work).\n\nOK, I've merged this branch into the branch on the ticket.",
    "created_at": "2018-05-22T21:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308318",
    "user": "@dimpase"
}
```

Replying to [comment:32 chapoton]:
> I have put a tentative branch at public/ticket/22431 for the changes in spkg-install (it needs work).

OK, I've merged this branch into the branch on the ticket.



---

archive/issue_comments_308319.json:
```json
{
    "body": "Then there probably just remains to understand what to do with the line\n\n```\nln -s ../../../../../share/mathjax/ mathjax\n```\n\nThis way to find the mathjax package seem to be very ugly... Maybe Erik would have an idea for a better replacement that would also work for python3 ?",
    "created_at": "2018-05-23T06:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308319",
    "user": "@fchapoton"
}
```

Then there probably just remains to understand what to do with the line

```
ln -s ../../../../../share/mathjax/ mathjax
```

This way to find the mathjax package seem to be very ugly... Maybe Erik would have an idea for a better replacement that would also work for python3 ?



---

archive/issue_comments_308320.json:
```json
{
    "body": "Replying to [comment:33 kcrisman]:\n> What would \"full py3 compatibility\" entail?  Just curious.  THANK YOU for this work.\n\nWell, this just means that somebody has to install sagenb on py3-sage (using the branch here and also the hacking instructions for sagenb to work with a git branch for sagenb) and try running \"sage -n=sagenb\", fixing step by step all errors (in sagenb code) that occurs until the notebook finally starts. This probably implies caring about unicode (str versus bytes). But there could also be other bad surprises as well. I have started to do that, but have very urgent other matters to handle.",
    "created_at": "2018-05-23T09:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308320",
    "user": "@fchapoton"
}
```

Replying to [comment:33 kcrisman]:
> What would "full py3 compatibility" entail?  Just curious.  THANK YOU for this work.

Well, this just means that somebody has to install sagenb on py3-sage (using the branch here and also the hacking instructions for sagenb to work with a git branch for sagenb) and try running "sage -n=sagenb", fixing step by step all errors (in sagenb code) that occurs until the notebook finally starts. This probably implies caring about unicode (str versus bytes). But there could also be other bad surprises as well. I have started to do that, but have very urgent other matters to handle.



---

archive/issue_comments_308321.json:
```json
{
    "body": "Replying to [comment:36 chapoton]:\n> Then there probably just remains to understand what to do with the line\n> {{{\n> ln -s ../../../../../share/mathjax/ mathjax\n> }}}\n> This way to find the mathjax package seem to be very ugly... Maybe Erik would have an idea for a better replacement that would also work for python3 ?\n\nWhy don't we use `ln -s $SAGE_LOCAL/share/mathjax mathjax`? Or use `$SAGE_SHARE/mathjax`? And are those any better?",
    "created_at": "2018-05-23T16:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308321",
    "user": "@jhpalmieri"
}
```

Replying to [comment:36 chapoton]:
> Then there probably just remains to understand what to do with the line
> {{{
> ln -s ../../../../../share/mathjax/ mathjax
> }}}
> This way to find the mathjax package seem to be very ugly... Maybe Erik would have an idea for a better replacement that would also work for python3 ?

Why don't we use `ln -s $SAGE_LOCAL/share/mathjax mathjax`? Or use `$SAGE_SHARE/mathjax`? And are those any better?



---

archive/issue_comments_308322.json:
```json
{
    "body": "Probably that's what should have been done in the first place, but removing MathJax from sagenb proper was done pretty quickly and this \"just worked\"?  That's my guess.",
    "created_at": "2018-05-23T16:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308322",
    "user": "@kcrisman"
}
```

Probably that's what should have been done in the first place, but removing MathJax from sagenb proper was done pretty quickly and this "just worked"?  That's my guess.



---

archive/issue_comments_308323.json:
```json
{
    "body": "Also, on OS X at least, the command should be `ln -s -h ...` \u2013\u00a0as it is, if the mathjax link already exists, then the current command creates another link within that linked folder. It is okay if the `sagenb/data` directory contains\n\n```\nmathjax -> ../../../../../share/mathjax/\n```\n\nbut it doesn't make sense for `$SAGE_LOCAL/share/mathjax` to contain this.\n\n(On OS X, the documentation for the `-h` flag says \"If the target_file or target_dir is a symbolic link, do not follow it.\" There is also a `-n` flag: \"Same as -h, for compatibility with other ln implementations.\")",
    "created_at": "2018-05-23T18:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308323",
    "user": "@jhpalmieri"
}
```

Also, on OS X at least, the command should be `ln -s -h ...` â€“Â as it is, if the mathjax link already exists, then the current command creates another link within that linked folder. It is okay if the `sagenb/data` directory contains

```
mathjax -> ../../../../../share/mathjax/
```

but it doesn't make sense for `$SAGE_LOCAL/share/mathjax` to contain this.

(On OS X, the documentation for the `-h` flag says "If the target_file or target_dir is a symbolic link, do not follow it." There is also a `-n` flag: "Same as -h, for compatibility with other ln implementations.")



---

archive/issue_comments_308324.json:
```json
{
    "body": "I have modified the ln to mathjax. This seems to work well with python2. Not yet tested with python3. \n\nWe need people that test if the new proposed release of sagenb works well enough. Not much has changed since the last release.\n----\nNew commits:",
    "created_at": "2018-05-27T07:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308324",
    "user": "@fchapoton"
}
```

I have modified the ln to mathjax. This seems to work well with python2. Not yet tested with python3. 

We need people that test if the new proposed release of sagenb works well enough. Not much has changed since the last release.
----
New commits:



---

archive/issue_comments_308325.json:
```json
{
    "body": "I have checked that with this branch, the install of sagenb is successful with python3 on sage 8.3.b2.",
    "created_at": "2018-05-27T14:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308325",
    "user": "@fchapoton"
}
```

I have checked that with this branch, the install of sagenb is successful with python3 on sage 8.3.b2.



---

archive/issue_comments_308326.json:
```json
{
    "body": "ping ?",
    "created_at": "2018-06-01T11:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308326",
    "user": "@fchapoton"
}
```

ping ?



---

archive/issue_comments_308327.json:
```json
{
    "body": "I can try building the latest beta with python3,what should I pull in, besides the branch on this ticket?",
    "created_at": "2018-06-01T12:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308327",
    "user": "@dimpase"
}
```

I can try building the latest beta with python3,what should I pull in, besides the branch on this ticket?



---

archive/issue_comments_308328.json:
```json
{
    "body": "Nothing else to pull, the develop branch itself build fine with python3.",
    "created_at": "2018-06-01T13:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308328",
    "user": "@fchapoton"
}
```

Nothing else to pull, the develop branch itself build fine with python3.



---

archive/issue_comments_308329.json:
```json
{
    "body": "and how do I  start sagenb so that the underlying python is python 3?",
    "created_at": "2018-06-01T14:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308329",
    "user": "@dimpase"
}
```

and how do I  start sagenb so that the underlying python is python 3?



---

archive/issue_comments_308330.json:
```json
{
    "body": "Well, just `sage -n=sagenb`. But it will fail to start, because of twisted or some of the latest commited changes, not yet in the release here.\n\nWe only need to make sure that sage3 builds and starts with the branch here.\n\nWe also need to make sure that for sage2, the upgrade of sagenb does not break something inside the notebook.",
    "created_at": "2018-06-01T16:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308330",
    "user": "@fchapoton"
}
```

Well, just `sage -n=sagenb`. But it will fail to start, because of twisted or some of the latest commited changes, not yet in the release here.

We only need to make sure that sage3 builds and starts with the branch here.

We also need to make sure that for sage2, the upgrade of sagenb does not break something inside the notebook.



---

archive/issue_comments_308331.json:
```json
{
    "body": "I propose to rename this ticket to \"upgrade sagenb and build sagenb in sage/python3\"\n\nand keep for another ticket the goal of being able to run sagenb in sage/python3",
    "created_at": "2018-06-01T17:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308331",
    "user": "@fchapoton"
}
```

I propose to rename this ticket to "upgrade sagenb and build sagenb in sage/python3"

and keep for another ticket the goal of being able to run sagenb in sage/python3



---

archive/issue_comments_308332.json:
```json
{
    "body": "I was going to try this today on py2 to test the notebook but had some troubles upgrading Sage, see sage-devel.",
    "created_at": "2018-06-01T17:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308332",
    "user": "@kcrisman"
}
```

I was going to try this today on py2 to test the notebook but had some troubles upgrading Sage, see sage-devel.



---

archive/issue_comments_308333.json:
```json
{
    "body": "With python3 sage, I get\n\n```\n$ ./sage -n sagenb\nSageMath version 8.3.beta3, Release Date: 2018-05-27\nPlease wait while the old SageNB Notebook server starts...\n/home/dima/sagepy3/local/lib/python3.6/site-packages/sage/misc/inline_fortran.py:8: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\n  import imp\nTraceback (most recent call last):\n  File \"/home/dima/sagepy3/src/bin/sage-notebook\", line 268, in <module>\n    launcher(unknown)\n  File \"/home/dima/sagepy3/src/bin/sage-notebook\", line 74, in __init__\n    notebook(*self.args, **self.kwds)\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook_object.py\", line 243, in __call__\n    return self.notebook(*args, **kwds)\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/run_notebook.py\", line 535, in notebook_run\n    nb = notebook.load_notebook(directory)\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook.py\", line 1839, in load_notebook\n    nb = Notebook(dir)\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook.py\", line 151, in __init__\n    self.__conf = S.load_server_conf()\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/storage/filesystem_storage.py\", line 265, in load_server_conf\n    return self._basic_to_server_conf(self._load('conf.pickle'))\n  File \"/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/storage/filesystem_storage.py\", line 187, in _load\n    result = pickle.load(f)\nTypeError: a bytes-like object is required, not 'str'\n```\n",
    "created_at": "2018-06-03T06:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308333",
    "user": "@dimpase"
}
```

With python3 sage, I get

```
$ ./sage -n sagenb
SageMath version 8.3.beta3, Release Date: 2018-05-27
Please wait while the old SageNB Notebook server starts...
/home/dima/sagepy3/local/lib/python3.6/site-packages/sage/misc/inline_fortran.py:8: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
  import imp
Traceback (most recent call last):
  File "/home/dima/sagepy3/src/bin/sage-notebook", line 268, in <module>
    launcher(unknown)
  File "/home/dima/sagepy3/src/bin/sage-notebook", line 74, in __init__
    notebook(*self.args, **self.kwds)
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook_object.py", line 243, in __call__
    return self.notebook(*args, **kwds)
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/run_notebook.py", line 535, in notebook_run
    nb = notebook.load_notebook(directory)
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook.py", line 1839, in load_notebook
    nb = Notebook(dir)
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/notebook/notebook.py", line 151, in __init__
    self.__conf = S.load_server_conf()
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/storage/filesystem_storage.py", line 265, in load_server_conf
    return self._basic_to_server_conf(self._load('conf.pickle'))
  File "/home/dima/sagepy3/local/lib/python3.6/site-packages/sagenb/storage/filesystem_storage.py", line 187, in _load
    result = pickle.load(f)
TypeError: a bytes-like object is required, not 'str'
```




---

archive/issue_comments_308334.json:
```json
{
    "body": "Thanks Dima. It seems that you got a hard time doing that..\n\nFailing is as expected. Maybe this specific issue is already fixed by the pull request done after you made the release. But this is not so important : let us keep that for another ticket.\n\nDo you confirm that sage3 builds and starts with the branch here ? I think I did check that also. So it seems to be good to go from this point of view.\n\nSo now, there only remains to see if the branch here is not going to break anything in the sage2 sagenb.",
    "created_at": "2018-06-03T06:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308334",
    "user": "@fchapoton"
}
```

Thanks Dima. It seems that you got a hard time doing that..

Failing is as expected. Maybe this specific issue is already fixed by the pull request done after you made the release. But this is not so important : let us keep that for another ticket.

Do you confirm that sage3 builds and starts with the branch here ? I think I did check that also. So it seems to be good to go from this point of view.

So now, there only remains to see if the branch here is not going to break anything in the sage2 sagenb.



---

archive/issue_comments_308335.json:
```json
{
    "body": "I have just checked again with sage3 release 8.3.b4 that sage3 builds and starts.",
    "created_at": "2018-06-03T08:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308335",
    "user": "@fchapoton"
}
```

I have just checked again with sage3 release 8.3.b4 that sage3 builds and starts.



---

archive/issue_comments_308336.json:
```json
{
    "body": "also, for me with beta4. You can give it a positive review, I think.",
    "created_at": "2018-06-03T09:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308336",
    "user": "@dimpase"
}
```

also, for me with beta4. You can give it a positive review, I think.



---

archive/issue_comments_308337.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-03T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308337",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_308338.json:
```json
{
    "body": "ok, let it be. I change the title and description to be more adequate to what is done here.",
    "created_at": "2018-06-03T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308338",
    "user": "@fchapoton"
}
```

ok, let it be. I change the title and description to be more adequate to what is done here.



---

archive/issue_comments_308339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-06T19:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308339",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_308340.json:
```json
{
    "body": "As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.",
    "created_at": "2018-06-21T15:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308340",
    "user": "@kcrisman"
}
```

As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.



---

archive/issue_comments_308341.json:
```json
{
    "body": "Replying to [comment:56 kcrisman]:\n> As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.\n\nDoes sagenb still open for you directly, via `sage -n sagenb` ?",
    "created_at": "2018-06-21T16:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308341",
    "user": "@dimpase"
}
```

Replying to [comment:56 kcrisman]:
> As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.

Does sagenb still open for you directly, via `sage -n sagenb` ?



---

archive/issue_comments_308342.json:
```json
{
    "body": "> > As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.\n> \n> Does sagenb still open for you directly, via `sage -n sagenb` ?\n\nYes, or at least with `sage -notebook=sagenb` it does.  I think there is something with the browser + token not opening.",
    "created_at": "2018-06-21T19:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308342",
    "user": "@kcrisman"
}
```

> > As a followup, in 8.3.beta6 I am having some troubles - see [this post](https://groups.google.com/d/msg/sage-release/P6weuTHdIbE/DDKYLrUsBgAJ) for details.   I am pretty sure this isn't due to some stale process.
> 
> Does sagenb still open for you directly, via `sage -n sagenb` ?

Yes, or at least with `sage -notebook=sagenb` it does.  I think there is something with the browser + token not opening.



---

archive/issue_comments_308343.json:
```json
{
    "body": "could you try when undoing #25548 ?",
    "created_at": "2018-06-21T20:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308343",
    "user": "@fchapoton"
}
```

could you try when undoing #25548 ?



---

archive/issue_comments_308344.json:
```json
{
    "body": "> could you try when undoing #25548 ?\n\nYou are oracular.\n\nIt would be interesting to trace where exactly `quit_sage` is even called that it would be necessary ...",
    "created_at": "2018-06-21T20:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308344",
    "user": "@kcrisman"
}
```

> could you try when undoing #25548 ?

You are oracular.

It would be interesting to trace where exactly `quit_sage` is even called that it would be necessary ...



---

archive/issue_comments_308345.json:
```json
{
    "body": "> > could you try when undoing #25548 ?\n> \n> You are oracular.\n\nMaybe I wasn't clear; that fixes it.  Shouldn't we have a blocker for 8.3 that includes that?",
    "created_at": "2018-06-25T18:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308345",
    "user": "@kcrisman"
}
```

> > could you try when undoing #25548 ?
> 
> You are oracular.

Maybe I wasn't clear; that fixes it.  Shouldn't we have a blocker for 8.3 that includes that?



---

archive/issue_comments_308346.json:
```json
{
    "body": "I can only say that the description of the issue you give it too vague.\nPlease feel free to open a ticket with details on how to reproduce this.",
    "created_at": "2018-06-26T13:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308346",
    "user": "@dimpase"
}
```

I can only say that the description of the issue you give it too vague.
Please feel free to open a ticket with details on how to reproduce this.



---

archive/issue_comments_308347.json:
```json
{
    "body": "Ok; see #25667.",
    "created_at": "2018-06-26T20:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22194#issuecomment-308347",
    "user": "@kcrisman"
}
```

Ok; see #25667.
