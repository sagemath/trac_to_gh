# Issue 22469: Add more conversions from giac

Issue created by migration from Trac.

Original creator: mforets

Original creation time: 2017-03-29 08:19:56

CC:  paulmasson ​frederichan

Keywords: giac, special functions

A "conversion" is a dictionary entry which maps object names in an interface (e.g. Maxima, Mathematica, Giac, ...) to corresponding objects with a different name in Sage.

Some conversions relevant to the Giac interface are missing:

- Dirac delta with support different from 0, as in `Dirac(t, 1)`.
- Special function names at `/functions/orthogonal_polys.py`.

See also: 

- In the file: `local/share/giac/doc/aide_cas`, lines starting by # are keywords followed by synonyms, next lines are for small doc and see also. Full doc it is here: [Symbolic algebra and Mathematics with Xcas](http://www-fourier.ujf-grenoble.fr/~parisse/giac/doc/en/cascmd_en/cascmd_en.html)

- `sage.libs.pynac.pynac.register_symbol` can be used to register new symbols in the `symbols_table`, as in `register_symbol(heaviside,{'giac':'Heaviside'})`.


---

Comment by frederichan created at 2017-03-29 09:50:28

This one doesn't look easy. Any idea to deal with rootof?

```
sage: giac.simplify((exp(2*i*pi/3)+exp(2*i*pi/15))^3)
((-768*i)*(-1)^(2/15)*sqrt(3)-768*(-1)^(2/15)+768*i*(-1)^(4/15)*sqrt(3)-768*(-1)^(4/15)+rootof([[16-16*i,-16+16*i,-400+528*i,144+240*i],[1,0,-30,-40,5]]))/512
```

do we need to chose a name for the variable in the extention field? (if yes  then how? (or what would be a good name))


---

Comment by paulmasson created at 2017-04-02 23:38:25

I went through the files in `sage/functions` to add as many conversions for special functions as possible, but could only find ten that were different from Sage.

The Giac exponential integrals `Ei`, `Si` and `Ci` have existing Sage aliases, so there shouldn't be a problem with those.

The orthogonal polynomials `hermite` and `laguerre` have the same names in Giac and Sage. Same for `erf` and a pending `erfc`, as well as `binomial` and `factorial`.

The Giac function `Psi` has is a different name from Sage `psi`, but the order of the arguments is reversed so I didn't add it now.
----
New commits:


---

Comment by paulmasson created at 2017-04-03 20:57:07

Considering the derivatives of delta functions, I think we'll have to do a string replacement using a regular expression similar to how Maxima conversions are handled starting [here](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py#L1702). Perhaps that should be a separate ticket after #22422 is merged.

The conversions I've entered are not dependent on #22422 and can be merged at any time. If either of you can identify additional functions that can be added easily with this ticket, let me know.


---

Comment by rws created at 2017-04-05 15:06:22

Replying to [comment:5 frederichan]:
> This one doesn't look easy. Any idea to deal with rootof?
> {{{
> sage: giac.simplify((exp(2*i*pi/3)+exp(2*i*pi/15))^3)
> ((-768*i)*(-1)<sup>(2/15)*sqrt(3)-768*(-1)</sup>(2/15)+768*i*(-1)<sup>(4/15)*sqrt(3)-768*(-1)</sup>(4/15)+rootof([[16-16*i,-16+16*i,-400+528*i,144+240*i],[1,0,-30,-40,5]]))/512
> }}}
> do we need to chose a name for the variable in the extention field? (if yes  then how? (or what would be a good name))

This appears to be #22024.


---

Comment by mforets created at 2017-04-06 11:58:32

Replying to [comment:9 paulmasson]:
> The Giac function `Psi` has is a different name from Sage `psi`, but the order of the arguments is reversed so I didn't add it now.

true and they agree if just 1 argument is passed.

also:

- should Giac's `abs` be mapped so `abs_symbolic`? notice that asking for `abs_symbolic??`, there is already some: 


```
"""GinacFunction.__init__(self, "abs", latex_name=r"\mathrm{abs}",
                               conversions=dict(sympy='Abs'))
```


- same for `binomial`, `arg`, `ceil`, `conjugage` (and `conj`), `factorial`, `frac`, `imag` (and `imag_part`), `real` (and `real_part`).


---

Comment by mforets created at 2017-04-08 13:30:47

Replying to [comment:10 paulmasson]:
> Considering the derivatives of delta functions, I think we'll have to do a string replacement using a regular expression similar to how Maxima conversions are handled starting [here](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py#L1702). Perhaps that should be a separate ticket after #22422 is merged.

+1. moreover, it should also fix integration:


```
sage: integrate(dirac_delta(x-2)*sin(x), x, 0, 4)    # unevaluated??
integrate(dirac_delta(x-2)*sin(x), x, 0, 4)
sage: integrate(dirac_delta(x-2)*sin(x), x, 0, 4, algorithm='sympy')    # ok
sin(2)
```



---

Comment by mforets created at 2017-04-18 11:31:26

after this one is done, we could go for "Add giac interface to integrate". what do you think?


---

Comment by mforets created at 2017-04-27 12:04:04

hi,
i've added some simple conversions. 

remaining:

- rootof
- psi function
- derivative of delta function. 

for the last item is not clear to me if it is required to write a `_derivative_` method for `FunctionDiracDelta`, or to write a new a class `FunctionDiracDeltaDerivative`, or if it's about passing a dictionary element with some preprocessing (some arguments) so that say `Dirac(x, 2)` (giac) changes to `diff(dirac_delta(x), x, x)` in sage and conversely.
----
New commits:


---

Comment by mforets created at 2017-04-27 20:52:05

see #22891 for "add giac interface to integrate"


---

Comment by chapoton created at 2017-05-15 20:02:52

something related:

```
sage: integrate(exp(x^3), (x, 1, 2), algorithm='giac') 
1/3*igamma(1/3, -1) - 1/3*igamma(1/3, -8)
```

where `igamma` is giac's name for the incomplete gamma function.


---

Comment by mforets created at 2017-05-16 06:13:17

Replying to [comment:18 chapoton]:
> something related:
> {{{
> sage: integrate(exp(x^3), (x, 1, 2), algorithm='giac') 
> 1/3*igamma(1/3, -1) - 1/3*igamma(1/3, -8)
> }}}
> where `igamma` is giac's name for the incomplete gamma function.

interesting. it seems that giac's `igamma` corresponds to `gamma_inc_lower` in Sage (lower incomplete Gamma). moreover, giac's `ugamma` corresponds to `gamma_inc` in Sage (upper incomplete Gamma). i'll add these conversions asap.


---

Comment by mforets created at 2017-05-16 07:16:33

in this case there is also a difference in their numerical evaluations:

actual value of the integral:


```
sage: numerical_integral(exp(x^3), 1, 2)
(275.51098376331174, 3.0587863771115636e-12)
```


giac:


```
sage: giac('1/3*igamma(1./3, -1) - 1/3*igamma(1./3, -8)')
275.510983763
sage: giac('igamma(1./3, -1)')
-4.02571325393
sage: giac('igamma(1./3, -8)') 
-830.558664544
sage: giac('igamma(1./3, 1)') 
2.42253354642
sage: giac('igamma(1./3, 8)') 
2.67886054288
```


sage:


```
sage: 1/3*gamma_inc_lower(1./3, -1) - 1/3*gamma_inc_lower(1./3, -8)
-137.755491881656 - 238.599510960670*I
sage: gamma_inc_lower(1./3, -1)    # values don't match. imag part => t^(-2/3) ? 
2.01285662696613 + 3.48636994625705*I
sage: gamma_inc_lower(1./3, -8)    # values don't match
415.279332271934 + 719.284902828267*I    
sage: gamma_inc_lower(1./3, 1)    # values match
2.42253354641901
sage: gamma_inc_lower(1./3, 8)    # values match
2.67886054288163
```



---

Comment by mforets created at 2017-05-16 10:53:05

however, 


```
sage: integrate(exp(x^3), x, 1, 2, algorithm='maxima') # OK
-1/3*(-1)^(2/3)*gamma(1/3, -1) + 1/3*(-1)^(2/3)*gamma(1/3, -8)
sage: _.n()
275.510983763312 - 7.21644966006352e-14*I
sage: giac('integrate(exp(x^3), x, 1, 2)')  # OK
1/3*igamma(1/3,-1)-1/3*igamma(1/3,-8)
```


what's going on? is there a problem on the numerical eval of `gamma_inc_lower` or the conversion is not accurate?


---

Comment by chapoton created at 2017-05-16 19:22:03

branch looks good to me and bot is green, but is this in "needs review" state ?


---

Comment by git created at 2017-05-17 06:20:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-17 06:55:45

Replying to [comment:22 chapoton]:
> branch looks good to me and bot is green, but is this in "needs review" state ?

Thanks for the feedback -- not yet but close! I'd like to handle the `psi` function conversion. Have to figure out how to reverse the arguments in the function call. I haven't seen examples of that sort.. 

For the other tasks discussed in this thread, i've separated them into smaller chunks, see  [giac interface wiki section](https://trac.sagemath.org/wiki/symbolics#Giacinterface).


---

Comment by chapoton created at 2017-05-21 20:14:01

branch does not apply


---

Comment by git created at 2017-05-25 21:08:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-25 22:05:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-26 05:56:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-26 06:01:34

partial progress: with the last commit one has


```
sage: giac('Psi(x,1)')._sage_()
psi(1, x)
```


as desired. however the other way round doesn't work get swapped:


```
sage: psi(1, x)._giac_() 
psi(1, x)   # Psi(x, 1) is expected
```



---

Comment by rws created at 2017-05-26 06:48:05

It works if you give a giac conversion in the psi2 init as well.


---

Comment by git created at 2017-05-26 08:08:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-26 08:09:45

Changing status from new to needs_review.


---

Comment by mforets created at 2017-05-26 08:14:01

Replying to [comment:30 rws]:
> It works if you give a giac conversion in the psi2 init as well.
It does!! Thanks.


---

Comment by chapoton created at 2017-06-02 13:54:18

ok, let it be


---

Comment by chapoton created at 2017-06-02 13:54:18

Changing status from needs_review to positive_review.


---

Comment by mforets created at 2017-06-04 08:34:53

Replying to [comment:34 chapoton]:
> ok, let it be

great, thanks for the review and to all participants of this ticket! 

w.r.t [giac symbolics tickets](https://trac.sagemath.org/wiki/symbolics#Giacinterface) i think i'll go on with #23016...


---

Comment by vbraun created at 2017-06-04 10:08:54

Resolution: fixed
