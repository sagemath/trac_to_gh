# Issue 11773: Throw exception instead of printing error in c_graph.pyx

archive/issues_011773.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  @rlmill\n\nKeywords: cython exception cpdef print c_graph\n\nThe following text currently occurs in `$SAGE_ROOT/devel/sage/sage/graphs/base/c_graph.pyx`:\n\n```python\n        # The following is due to a hard to reproduce bug in Cython where except,\n        # cpdef, and classes don't play well together:\n        print \"Not Implemented!\"\n        # raise NotImplementedError() ... results in:\n        # Exception exceptions.NotImplementedError: NotImplementedError() in 'sage.graphs.base.c_graph.CGraph.has_arc' ignored\n        # False\n```\n\nThese lines were written by Robert Miller in 2009. This ticket is just to keep track of this, since it should eventually be done properly once the Cython bug is gone.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11945\n\n",
    "created_at": "2011-10-24T06:23:54Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Throw exception instead of printing error in c_graph.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11773",
    "user": "https://github.com/kini"
}
```
Assignee: jason, ncohen, rlm

CC:  @rlmill

Keywords: cython exception cpdef print c_graph

The following text currently occurs in `$SAGE_ROOT/devel/sage/sage/graphs/base/c_graph.pyx`:

```python
        # The following is due to a hard to reproduce bug in Cython where except,
        # cpdef, and classes don't play well together:
        print "Not Implemented!"
        # raise NotImplementedError() ... results in:
        # Exception exceptions.NotImplementedError: NotImplementedError() in 'sage.graphs.base.c_graph.CGraph.has_arc' ignored
        # False
```

These lines were written by Robert Miller in 2009. This ticket is just to keep track of this, since it should eventually be done properly once the Cython bug is gone.

Issue created by migration from https://trac.sagemath.org/ticket/11945





---

archive/issue_comments_134230.json:
```json
{
    "body": "CCing rlm as he is the most likely to know more about this.\n\nBy the way, the \"exception ignored\" message appears to be showing up on `stderr` rather than `stdout`.",
    "created_at": "2011-10-24T06:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134230",
    "user": "https://github.com/kini"
}
```

CCing rlm as he is the most likely to know more about this.

By the way, the "exception ignored" message appears to be showing up on `stderr` rather than `stdout`.



---

archive/issue_comments_134231.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134231",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_031627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-26T13:12:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11773#event-31627"
}
```



---

archive/issue_comments_134232.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-26T13:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134232",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_134233.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-26T13:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134233",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_134234.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-16T06:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134234",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134235.json:
```json
{
    "body": "`O_o`\n\nI had not noticed this patch. Could you rebase it ? There is a merge conflict.\n\nAlso it may be in conflict with a `needs_review` patch I just wrote (#17163), but nothing complicated in sight.\n\nNathann",
    "created_at": "2014-10-16T06:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134235",
    "user": "https://github.com/nathanncohen"
}
```

`O_o`

I had not noticed this patch. Could you rebase it ? There is a merge conflict.

Also it may be in conflict with a `needs_review` patch I just wrote (#17163), but nothing complicated in sight.

Nathann



---

archive/issue_comments_134236.json:
```json
{
    "body": "`O_o`\n\nWhy would you do that ? `O_o`\n\n```diff\n-        raise ValueError(\"Thou shalt not add a vertex to an immutable graph\")\n+        self.add_vertex_unsafe(k)\n```",
    "created_at": "2014-10-16T06:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134236",
    "user": "https://github.com/nathanncohen"
}
```

`O_o`

Why would you do that ? `O_o`

```diff
-        raise ValueError("Thou shalt not add a vertex to an immutable graph")
+        self.add_vertex_unsafe(k)
```



---

archive/issue_comments_134237.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> Why would you do that ? `O_o`\n> \n> \n> ```\n> #!diff\n> -        raise ValueError(\"Thou shalt not add a vertex to an immutable graph\")\n> +        self.add_vertex_unsafe(k)\n> ```\n\nThrowing the same exception in 2 different places seemed a bit stupid. And it allows to actually test the `add_vertex_unsafe` method.",
    "created_at": "2014-10-16T06:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134237",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 ncohen]:
> Why would you do that ? `O_o`
> 
> 
> ```
> #!diff
> -        raise ValueError("Thou shalt not add a vertex to an immutable graph")
> +        self.add_vertex_unsafe(k)
> ```

Throwing the same exception in 2 different places seemed a bit stupid. And it allows to actually test the `add_vertex_unsafe` method.



---

archive/issue_comments_134238.json:
```json
{
    "body": "Replying to [comment:9 ncohen]:\n> `O_o`\n> \n> I had not noticed this patch.\n\nIf you're interested, there is a similar patch needing review at #16233.",
    "created_at": "2014-10-16T06:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134238",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 ncohen]:
> `O_o`
> 
> I had not noticed this patch.

If you're interested, there is a similar patch needing review at #16233.



---

archive/issue_comments_134239.json:
```json
{
    "body": "> Throwing the same exception in 2 different places seemed a bit stupid. And it allows to actually test the `add_vertex_unsafe` method.\n\n\nCome on, leave it as it is. What is the point ? Keep it simple: this thing is not implemented because the class is immutable, let it return an exception.\n\nNathann",
    "created_at": "2014-10-16T06:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134239",
    "user": "https://github.com/nathanncohen"
}
```

> Throwing the same exception in 2 different places seemed a bit stupid. And it allows to actually test the `add_vertex_unsafe` method.


Come on, leave it as it is. What is the point ? Keep it simple: this thing is not implemented because the class is immutable, let it return an exception.

Nathann



---

archive/issue_comments_134240.json:
```json
{
    "body": "Replying to [comment:13 ncohen]:\n> Come on, leave it as it is. What is the point ?\n\nLike I said: it allows to actually test the `add_vertex_unsafe` method, which is otherwise untested.\n\n> Keep it simple: this thing is not implemented because the class is immutable, let it return an exception.\n\nMy code is equally simple and does exactly the same thing, so why not?",
    "created_at": "2014-10-16T06:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134240",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 ncohen]:
> Come on, leave it as it is. What is the point ?

Like I said: it allows to actually test the `add_vertex_unsafe` method, which is otherwise untested.

> Keep it simple: this thing is not implemented because the class is immutable, let it return an exception.

My code is equally simple and does exactly the same thing, so why not?



---

archive/issue_comments_134241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-16T09:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134242.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-16T09:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134242",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_134243.json:
```json
{
    "body": "How does \"except -1\" work when the return type is bint ?\n\nAlso, won't this cause that some calls which are currently C calls will become Python calls ?\n\n```diff\n cdef class StaticSparseCGraph(CGraph):\n     cdef short_digraph g\n     cdef short_digraph g_rev\n     cdef bint _directed\n \n-    cpdef bint has_vertex(self, int n)\n-    cdef int add_vertex_unsafe(self, int k)\n-    cdef int del_vertex_unsafe(self, int v)\n-    cpdef list verts(self)\n-    cdef int has_arc_unsafe(self, int u, int v)\n-    cpdef bint has_arc(self, int u, int v)\n-    cdef int out_neighbors_unsafe(self, int u, int *neighbors, int size) except? -2\n-    cpdef list out_neighbors(self, int u)\n     cpdef int out_degree(self, int u) except -1\n-    cdef int in_neighbors_unsafe(self, int u, int *neighbors, int size) except? -2\n-    cpdef list in_neighbors(self, int u)\n     cpdef int in_degree(self, int u) except -1\n```\n\nNathann",
    "created_at": "2014-10-16T09:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134243",
    "user": "https://github.com/nathanncohen"
}
```

How does "except -1" work when the return type is bint ?

Also, won't this cause that some calls which are currently C calls will become Python calls ?

```diff
 cdef class StaticSparseCGraph(CGraph):
     cdef short_digraph g
     cdef short_digraph g_rev
     cdef bint _directed
 
-    cpdef bint has_vertex(self, int n)
-    cdef int add_vertex_unsafe(self, int k)
-    cdef int del_vertex_unsafe(self, int v)
-    cpdef list verts(self)
-    cdef int has_arc_unsafe(self, int u, int v)
-    cpdef bint has_arc(self, int u, int v)
-    cdef int out_neighbors_unsafe(self, int u, int *neighbors, int size) except? -2
-    cpdef list out_neighbors(self, int u)
     cpdef int out_degree(self, int u) except -1
-    cdef int in_neighbors_unsafe(self, int u, int *neighbors, int size) except? -2
-    cpdef list in_neighbors(self, int u)
     cpdef int in_degree(self, int u) except -1
```

Nathann



---

archive/issue_comments_134244.json:
```json
{
    "body": "Replying to [comment:17 ncohen]:\n> How does \"except -1\" work when the return type is bint ?\n\nThe actual type is a C `int`. The return values mean the following:\n\n* 0 => `False`\n* 1 => `True`\n* -1 => exception",
    "created_at": "2014-10-16T09:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134244",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 ncohen]:
> How does "except -1" work when the return type is bint ?

The actual type is a C `int`. The return values mean the following:

* 0 => `False`
* 1 => `True`
* -1 => exception



---

archive/issue_comments_134245.json:
```json
{
    "body": "Replying to [comment:17 ncohen]:\n> How does \"except -1\" work when the return type is bint ?\n> \n> Also, won't this cause that some calls which are currently C calls will become Python calls ?\n\nNo, there are already declared in the child class `CGraph`, no point to repeat them.",
    "created_at": "2014-10-16T09:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134245",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 ncohen]:
> How does "except -1" work when the return type is bint ?
> 
> Also, won't this cause that some calls which are currently C calls will become Python calls ?

No, there are already declared in the child class `CGraph`, no point to repeat them.



---

archive/issue_comments_134246.json:
```json
{
    "body": "Okay, then as soon as I am done building the latest beta I will run all tests on your patch, should be done soon.\n\nNathann",
    "created_at": "2014-10-16T09:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134246",
    "user": "https://github.com/nathanncohen"
}
```

Okay, then as soon as I am done building the latest beta I will run all tests on your patch, should be done soon.

Nathann



---

archive/issue_comments_134247.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-16T11:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134247",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_134248.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-16T21:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11773#issuecomment-134248",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-16T21:10:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11773",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11773#event-31628"
}
```
