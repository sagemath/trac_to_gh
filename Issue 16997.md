# Issue 16997: Rich output and the IPython Notebook

archive/issues_016997.json:
```json
{
    "body": "CC:  @novoselt @ohanar @gagern\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17234\n\n",
    "created_at": "2014-10-27T14:18:35Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Rich output and the IPython Notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16997",
    "user": "https://github.com/vbraun"
}
```
CC:  @novoselt @ohanar @gagern



Issue created by migration from https://trac.sagemath.org/ticket/17234





---

archive/issue_comments_225140.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to notebook.",
    "created_at": "2014-10-27T14:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225140",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to notebook.



---

archive/issue_comments_225141.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-10-27T14:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225141",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_225142.json:
```json
{
    "body": "Changing component from notebook to graphics.",
    "created_at": "2014-11-04T21:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225142",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from notebook to graphics.



---

archive/issue_comments_225143.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-27T22:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225144.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-30T23:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-01T23:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-25T12:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-25T15:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-25T15:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225149.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-08T11:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-08T23:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-11T01:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-11T22:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225153.json:
```json
{
    "body": "Regarding changes of the form\n\n```diff\n- def show(self, filename=None, dpi=DEFAULT_DPI, figsize=None, axes=None, **kwds):\n+ def show(self, **kwds):\n```\nI also tried once to make the same simplification as you but people complained.\n\nSee discussion starting at [comment:25:ticket:16533]",
    "created_at": "2015-02-12T20:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225153",
    "user": "https://github.com/jdemeyer"
}
```

Regarding changes of the form

```diff
- def show(self, filename=None, dpi=DEFAULT_DPI, figsize=None, axes=None, **kwds):
+ def show(self, **kwds):
```
I also tried once to make the same simplification as you but people complained.

See discussion starting at [comment:25:ticket:16533]



---

archive/issue_comments_225154.json:
```json
{
    "body": "On the plus side the filename keyword is removed, too: you actually have to call `save()` to save now.  We could add a deprecation workaround but really that was never the intent of the `show()` method nor match its documentation.",
    "created_at": "2015-02-12T20:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225154",
    "user": "https://github.com/vbraun"
}
```

On the plus side the filename keyword is removed, too: you actually have to call `save()` to save now.  We could add a deprecation workaround but really that was never the intent of the `show()` method nor match its documentation.



---

archive/issue_comments_225155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-15T01:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-15T09:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_225157.json:
```json
{
    "body": "This is now feature complete and all doctests pass. I will not rebase the branch any more, all future additions will be incremental.\n\nThe only thing missing is some documentation.",
    "created_at": "2015-02-15T09:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225157",
    "user": "https://github.com/vbraun"
}
```

This is now feature complete and all doctests pass. I will not rebase the branch any more, all future additions will be incremental.

The only thing missing is some documentation.



---

archive/issue_comments_225158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-19T00:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225159.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-19T00:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225159",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_225160.json:
```json
{
    "body": "Documentation is complete now, ready for review.",
    "created_at": "2015-02-19T00:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225160",
    "user": "https://github.com/vbraun"
}
```

Documentation is complete now, ready for review.



---

archive/issue_comments_225161.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-19T06:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225161",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_225162.json:
```json
{
    "body": "Some comments for now:\n\n* It seems like the `show` method should maybe get moved to the `SageObject` class. It pops up everywhere, is more or less the same (other than supporting some deprecated functionality in a small handful of places) and as far as I can tell should work for every child of `SageObject`.\n* Similarly, in graphics.py, a bit of refactoring could be done by creating a common parent for `Graphics` and `GraphicsArray` (maybe something like `GraphicsBase`)\n* In `sage.repl.formatter` there is presumably a debugging print statement still left in `SagePlainTextFormatter`.\n* In the module docstring for `sage.repl.image` you mention the class `SageImage`, which you presumably renamed to just be `Image`. I didn't see any other instances of this, but it warrants a double check.\n* In `sage.repl.interpreter` it would be good to at least have trivial docstrings for the new methods as well as `# not tested` doctests -- hopefully it reduces the number of coverage complaints (even though it is a bit silly in this case).\n* For the display magic, you deprecate some old values, maybe add a proper `deprecation`? (or maybe this doesn't work well with magics, I don't know)\n* The only the first pdf assertion in validate method for the doctest backend is being tested at the moment.\n* The `display_immediately` method on the IPython notebook backend currently does return something.\n* The `display_immediately` doctest for the test backend is actually testing the base backend.\n* For the various backends, wouldn't it make more sense for the supported_types to return frozensets rather than sets (since really the supported types aren't mutable). You do this later in the display manager.\n* For the display manager, why don't you just make a it have a unique instance (either by using a metaclass, or by using `__new__`) rather than just assert that there is only one instance?\n\nOnce I get a chance to test it and give it a second pass I'll add some more comments. It would also be good to get someone familiar with SageNB to take a look at this, since I have no idea what hacks SageNB depends on and can't really review the SageNB backend.",
    "created_at": "2015-02-19T06:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225162",
    "user": "https://github.com/ohanar"
}
```

Some comments for now:

* It seems like the `show` method should maybe get moved to the `SageObject` class. It pops up everywhere, is more or less the same (other than supporting some deprecated functionality in a small handful of places) and as far as I can tell should work for every child of `SageObject`.
* Similarly, in graphics.py, a bit of refactoring could be done by creating a common parent for `Graphics` and `GraphicsArray` (maybe something like `GraphicsBase`)
* In `sage.repl.formatter` there is presumably a debugging print statement still left in `SagePlainTextFormatter`.
* In the module docstring for `sage.repl.image` you mention the class `SageImage`, which you presumably renamed to just be `Image`. I didn't see any other instances of this, but it warrants a double check.
* In `sage.repl.interpreter` it would be good to at least have trivial docstrings for the new methods as well as `# not tested` doctests -- hopefully it reduces the number of coverage complaints (even though it is a bit silly in this case).
* For the display magic, you deprecate some old values, maybe add a proper `deprecation`? (or maybe this doesn't work well with magics, I don't know)
* The only the first pdf assertion in validate method for the doctest backend is being tested at the moment.
* The `display_immediately` method on the IPython notebook backend currently does return something.
* The `display_immediately` doctest for the test backend is actually testing the base backend.
* For the various backends, wouldn't it make more sense for the supported_types to return frozensets rather than sets (since really the supported types aren't mutable). You do this later in the display manager.
* For the display manager, why don't you just make a it have a unique instance (either by using a metaclass, or by using `__new__`) rather than just assert that there is only one instance?

Once I get a chance to test it and give it a second pass I'll add some more comments. It would also be good to get someone familiar with SageNB to take a look at this, since I have no idea what hacks SageNB depends on and can't really review the SageNB backend.



---

archive/issue_comments_225163.json:
```json
{
    "body": "1, 2) I agree on the first two, but I don't want to do any further refactoring on this ticket. It is already way too big...\n\n3) is actually never used, thouugh it might be handy to have a plain IPython formatter. I've clarified the documentation.\n\n6) its still not clear to me what the best syntax is, so for now I think its easiest to just allow different combinations. But I don't like \"simple\" (not expressive, better: \"plain\") and \"typeset\" (probably better: \"mathjax\").\n\n7) was supposed to be `OutputImageDvi`, fixed.\n\n10) The backend supported_output can return any iterable. The display manager then turns that into a nice frozen set and performs checks and type demotion. Nobody interacts with the backends directly, the display manager intentionally has no public accessor for the current backend.\n\n11) Just for simplicity, the display manager's type isn't global so you already have to work to try to make a second instance. You aren't going to accidentally call the ctor.",
    "created_at": "2015-02-20T01:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225163",
    "user": "https://github.com/vbraun"
}
```

1, 2) I agree on the first two, but I don't want to do any further refactoring on this ticket. It is already way too big...

3) is actually never used, thouugh it might be handy to have a plain IPython formatter. I've clarified the documentation.

6) its still not clear to me what the best syntax is, so for now I think its easiest to just allow different combinations. But I don't like "simple" (not expressive, better: "plain") and "typeset" (probably better: "mathjax").

7) was supposed to be `OutputImageDvi`, fixed.

10) The backend supported_output can return any iterable. The display manager then turns that into a nice frozen set and performs checks and type demotion. Nobody interacts with the backends directly, the display manager intentionally has no public accessor for the current backend.

11) Just for simplicity, the display manager's type isn't global so you already have to work to try to make a second instance. You aren't going to accidentally call the ctor.



---

archive/issue_comments_225164.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-20T01:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225165.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-20T01:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225165",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_225166.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-21T00:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225166",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_225167.json:
```json
{
    "body": "A few more comments:\n\n1. I think it would be better to have a latex output type rather than a mathjax output type -- different backends might use different renders for latex, (e.g. the command line currently uses the pdflatex command + a pdf viewer). This should work fine with ipython which supports the text/latex MIME type (which it renders with mathjax).\n\n2. Sure, we can hold off on the show stuff for another ticket, this is already quite big. (Note for future ticket) From talking with William, he convinced me that `show` should be an alias for `pretty_print`, which should always tries to use a rich output for an object (falling back on the plain text), while the plain `print` function should always use the plain text for the object.\n\n3. I don't really like right now how the graphics and text are treated very differently at the moment -- the graphics object are responsible for creating their own output types, while the display manager/backend is responsible for creating text output types. I would define both ascii art and latex output as rich output rather than plain text output, and would then move the logic for an object's rich output to the `_rich_repr_` method of the object itself (in this case it would go into `SageObject._rich_repr_`).\n\n4. I'm getting a lot of doctests failing under `sage.plot` (I can attach a log if you aren't getting them). A lot of them are fixed with changing `tachyon.png.save` to `tachyon.png.save_as` on line 244 of `sage.plot.plot3d.base` (this also fixes 3d plots in SageNB for me).",
    "created_at": "2015-02-21T00:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225167",
    "user": "https://github.com/ohanar"
}
```

A few more comments:

1. I think it would be better to have a latex output type rather than a mathjax output type -- different backends might use different renders for latex, (e.g. the command line currently uses the pdflatex command + a pdf viewer). This should work fine with ipython which supports the text/latex MIME type (which it renders with mathjax).

2. Sure, we can hold off on the show stuff for another ticket, this is already quite big. (Note for future ticket) From talking with William, he convinced me that `show` should be an alias for `pretty_print`, which should always tries to use a rich output for an object (falling back on the plain text), while the plain `print` function should always use the plain text for the object.

3. I don't really like right now how the graphics and text are treated very differently at the moment -- the graphics object are responsible for creating their own output types, while the display manager/backend is responsible for creating text output types. I would define both ascii art and latex output as rich output rather than plain text output, and would then move the logic for an object's rich output to the `_rich_repr_` method of the object itself (in this case it would go into `SageObject._rich_repr_`).

4. I'm getting a lot of doctests failing under `sage.plot` (I can attach a log if you aren't getting them). A lot of them are fixed with changing `tachyon.png.save` to `tachyon.png.save_as` on line 244 of `sage.plot.plot3d.base` (this also fixes 3d plots in SageNB for me).



---

archive/issue_comments_225168.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T00:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225169.json:
```json
{
    "body": "1) sounds good, I can make the change\n\n2) agree but thats yet another ticket for sure. a better name for the `viewer='...'` keyword option that works also for plain text / latex / 2d animation formats / ... would be nice, too. (see also: #17783)\n\n3) our text formatters are special in that they also apply to non-Sage objects, namely tall Python list and alike. So we can't just move them to `SageObject._rich_repr_`\n\n4) I see, I have Java installed and you don't. Fixed.",
    "created_at": "2015-02-21T01:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225169",
    "user": "https://github.com/vbraun"
}
```

1) sounds good, I can make the change

2) agree but thats yet another ticket for sure. a better name for the `viewer='...'` keyword option that works also for plain text / latex / 2d animation formats / ... would be nice, too. (see also: #17783)

3) our text formatters are special in that they also apply to non-Sage objects, namely tall Python list and alike. So we can't just move them to `SageObject._rich_repr_`

4) I see, I have Java installed and you don't. Fixed.



---

archive/issue_comments_225170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T01:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225171.json:
```json
{
    "body": "I've opened #17821 to collect the ideas for refactoring `show` / `pretty_print`",
    "created_at": "2015-02-21T01:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225171",
    "user": "https://github.com/vbraun"
}
```

I've opened #17821 to collect the ideas for refactoring `show` / `pretty_print`



---

archive/issue_comments_225172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T12:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225173.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-21T12:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225173",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_225174.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-21T18:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225175.json:
```json
{
    "body": "Regarding point 3:\n\nBut they don't work consistently, which is precisely the problem with trying to handle the all text with the display manager (the object itself is always going to know best how to represent itself). For instance, the tall list stuff only works for lists and tuples, not sets or dicts or even Sage's Set_object.\n\nI would rather see something like a `_call_plain_repr` method that checks whether an object is a builtin type that we are giving a our own repr method to, and then call our repr method in that case (rather than the the built in one).\n\nRegardless, there would be a lot of redoing of stuff to make something like that work, so it is probably best to put in another ticket anyway.\n\n---\n\nI'm still getting doctest errors on my machine (which as you can tell, doesn't have too much on it). I'll attach a log in a moment.",
    "created_at": "2015-02-25T23:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225175",
    "user": "https://github.com/ohanar"
}
```

Regarding point 3:

But they don't work consistently, which is precisely the problem with trying to handle the all text with the display manager (the object itself is always going to know best how to represent itself). For instance, the tall list stuff only works for lists and tuples, not sets or dicts or even Sage's Set_object.

I would rather see something like a `_call_plain_repr` method that checks whether an object is a builtin type that we are giving a our own repr method to, and then call our repr method in that case (rather than the the built in one).

Regardless, there would be a lot of redoing of stuff to make something like that work, so it is probably best to put in another ticket anyway.

---

I'm still getting doctest errors on my machine (which as you can tell, doesn't have too much on it). I'll attach a log in a moment.



---

archive/issue_comments_225176.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-25T23:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225176",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_225177.json:
```json
{
    "body": "Imho the ascii art is the right way to do it, boxes that are aware of height/width and baseline. Then assemble containers etc. Maybe make ascii art the default at one point. I hesitate to kludge too much on top of the plain text, this would lead to massive changes to the Sage libray doctests.",
    "created_at": "2015-02-25T23:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225177",
    "user": "https://github.com/vbraun"
}
```

Imho the ascii art is the right way to do it, boxes that are aware of height/width and baseline. Then assemble containers etc. Maybe make ascii art the default at one point. I hesitate to kludge too much on top of the plain text, this would lead to massive changes to the Sage libray doctests.



---

archive/issue_comments_225178.json:
```json
{
    "body": "Sure, in that case in the `_call_rich_repr` method you could do something special for builtin python objects.",
    "created_at": "2015-02-25T23:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225178",
    "user": "https://github.com/ohanar"
}
```

Sure, in that case in the `_call_rich_repr` method you could do something special for builtin python objects.



---

archive/issue_comments_225179.json:
```json
{
    "body": "Ok, your libpng puts out a different sub-version of png and no imagemagick/ffmpeg. I'll fix it when I have some time.\n\nThere is already a framework around `_ascii_art_()` methods, so I would recommend to build on top of that.",
    "created_at": "2015-02-25T23:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225179",
    "user": "https://github.com/vbraun"
}
```

Ok, your libpng puts out a different sub-version of png and no imagemagick/ffmpeg. I'll fix it when I have some time.

There is already a framework around `_ascii_art_()` methods, so I would recommend to build on top of that.



---

archive/issue_comments_225180.json:
```json
{
    "body": "Apparently fixes #17858 - I haven't personally confirmed this.",
    "created_at": "2015-02-26T17:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225180",
    "user": "https://github.com/kcrisman"
}
```

Apparently fixes #17858 - I haven't personally confirmed this.



---

archive/issue_comments_225181.json:
```json
{
    "body": "The failing tests for PNG output actually don't work in the released Sage either, e.g.\n\n```\nsage: sum([dodecahedron(center=[2.5*x, 0, 0], color=(1, 0, 0, x/10)) for x in range(2)]).show(viewer='tachyon')\n``` \nproduces no output. It does create a 0-byte png file, and this ticket is the first to test whether it starts with the PNG magic. The tachyon source file is invalid, but tachyon apparently returns 0 on error.",
    "created_at": "2015-02-26T19:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225181",
    "user": "https://github.com/vbraun"
}
```

The failing tests for PNG output actually don't work in the released Sage either, e.g.

```
sage: sum([dodecahedron(center=[2.5*x, 0, 0], color=(1, 0, 0, x/10)) for x in range(2)]).show(viewer='tachyon')
``` 
produces no output. It does create a 0-byte png file, and this ticket is the first to test whether it starts with the PNG magic. The tachyon source file is invalid, but tachyon apparently returns 0 on error.



---

archive/issue_comments_225182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-26T23:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T00:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225184.json:
```json
{
    "body": "The problem was that tachyon doesn't understand rational input like \"Opacity 1/10\". Fixed by normalizing everything to float before handing it to plotting backends.",
    "created_at": "2015-02-27T00:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225184",
    "user": "https://github.com/vbraun"
}
```

The problem was that tachyon doesn't understand rational input like "Opacity 1/10". Fixed by normalizing everything to float before handing it to plotting backends.



---

archive/issue_comments_225185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T00:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225186.json:
```json
{
    "body": "This should fix all of your doctest failures",
    "created_at": "2015-02-27T00:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225186",
    "user": "https://github.com/vbraun"
}
```

This should fix all of your doctest failures



---

archive/issue_comments_225187.json:
```json
{
    "body": "Attachment [failing_doctests.log](tarball://root/attachments/some-uuid/ticket17234/failing_doctests.log) by @ohanar created at 2015-02-27 04:06:43",
    "created_at": "2015-02-27T04:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225187",
    "user": "https://github.com/ohanar"
}
```

Attachment [failing_doctests.log](tarball://root/attachments/some-uuid/ticket17234/failing_doctests.log) by @ohanar created at 2015-02-27 04:06:43



---

archive/issue_comments_225188.json:
```json
{
    "body": "I've attached other various doctest failures throughout the library. They look trivial (just missed).",
    "created_at": "2015-02-27T04:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225188",
    "user": "https://github.com/ohanar"
}
```

I've attached other various doctest failures throughout the library. They look trivial (just missed).



---

archive/issue_comments_225189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T08:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225190.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T23:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225191.json:
```json
{
    "body": "Replying to [comment:51 git]:\n\n[ ... ]\n\nA couple data point for this commit (6.6 beta1 built from scratch + this trac branch) :\n1) code builds OK, but doc building fails (\" make doc-clean && make \" succeeds).\n2) in the Ipython notebook :\n- %display typeset gives typeset (MathJax) output. At last ! This was my motivation for testing this branch.\n- %display ascii_art fails for not having an output stream\n- %display simple restores default output (whew...)\n- no 3D viewer available but tachyon.\"jmol\" and \"canvas3d\" fail silently, \"java3d\" gives a deprecation warning pointing to \"wavefront\", which fails silently.\n\nHoping this helps.",
    "created_at": "2015-02-28T09:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225191",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:51 git]:

[ ... ]

A couple data point for this commit (6.6 beta1 built from scratch + this trac branch) :
1) code builds OK, but doc building fails (" make doc-clean && make " succeeds).
2) in the Ipython notebook :
- %display typeset gives typeset (MathJax) output. At last ! This was my motivation for testing this branch.
- %display ascii_art fails for not having an output stream
- %display simple restores default output (whew...)
- no 3D viewer available but tachyon."jmol" and "canvas3d" fail silently, "java3d" gives a deprecation warning pointing to "wavefront", which fails silently.

Hoping this helps.



---

archive/issue_comments_225192.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-28T10:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225193.json:
```json
{
    "body": "I fixed the ascii art issue.\n\nI'm aware that there is still no 3d graphics in the notebook at this point, but that should go to another ticket.",
    "created_at": "2015-02-28T11:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225193",
    "user": "https://github.com/vbraun"
}
```

I fixed the ascii art issue.

I'm aware that there is still no 3d graphics in the notebook at this point, but that should go to another ticket.



---

archive/issue_comments_225194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-28T12:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225195.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-28T14:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225195",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225196.json:
```json
{
    "body": "Doctests now also pass without ImageMagick",
    "created_at": "2015-02-28T14:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225196",
    "user": "https://github.com/vbraun"
}
```

Doctests now also pass without ImageMagick



---

archive/issue_comments_225197.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-28T14:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225197",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_225198.json:
```json
{
    "body": "I got 3 failures after \"ID 215-02-28-17-11-36-39ff4408\", testlong got three failures in src/sage/plot/plot3d/base.pyx (see below) , all bound to 3D graphics. The rest got no failures.\n\nI got no build failure after integrating the last commit(s), but I did **not** rebuild from scratch.\n\nIs that enough for \"positive review\" ? Do you need a scratch build (long since serial : I didn't integrate #17839...) ?\n\nHTH.\n\nThe three errors :\n\n```\ncharpent@asus16-ec:/usr/local/sage-6.6$ sage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx\nRunning doctests with ID 2015-02-28-19-11-29-0b70177c.\nGit branch: t/17234/rich_output_and_the_ipython_notebook\nDoctesting 1 file.\nsage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx\n**********************************************************************\nFile \"src/sage/plot/plot3d/base.pyx\", line 1422, in sage.plot.plot3d.base.Graphics3d.save_image\nFailed example:\n    G.save_image(gif)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.base.Graphics3d.save_image[5]>\", line 1, in <module>\n        G.save_image(gif)\n      File \"sage/plot/plot3d/base.pyx\", line 1434, in sage.plot.plot3d.base.Graphics3d.save_image (build/cythonized/sage/plot/plot3d/base.c:16182)\n        Image.open(png).save(filename)\n      File \"build/bdist.linux-x86_64/egg/PIL/Image.py\", line 2006, in open\n        raise IOError(\"cannot identify image file\")\n    IOError: cannot identify image file\n**********************************************************************\nFile \"src/sage/plot/plot3d/base.pyx\", line 1423, in sage.plot.plot3d.base.Graphics3d.save_image\nFailed example:\n    assert open(gif).read().startswith('GIF')\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.base.Graphics3d.save_image[6]>\", line 1, in <module>\n        assert open(gif).read().startswith('GIF')\n    AssertionError\n**********************************************************************\nFile \"src/sage/plot/plot3d/base.pyx\", line 1474, in sage.plot.plot3d.base.Graphics3d.save\nFailed example:\n    cube().save(tmp_filename(ext='.gif'))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.base.Graphics3d.save[5]>\", line 1, in <module>\n        cube().save(tmp_filename(ext='.gif'))\n      File \"sage/plot/plot3d/base.pyx\", line 1480, in sage.plot.plot3d.base.Graphics3d.save (build/cythonized/sage/plot/plot3d/base.c:16543)\n        self.save_image(filename)\n      File \"sage/plot/plot3d/base.pyx\", line 1434, in sage.plot.plot3d.base.Graphics3d.save_image (build/cythonized/sage/plot/plot3d/base.c:16182)\n        Image.open(png).save(filename)\n      File \"build/bdist.linux-x86_64/egg/PIL/Image.py\", line 2006, in open\n        raise IOError(\"cannot identify image file\")\n    IOError: cannot identify image file\n**********************************************************************\n2 items had failures:\n   1 of   7 in sage.plot.plot3d.base.Graphics3d.save\n   2 of   8 in sage.plot.plot3d.base.Graphics3d.save_image\n    [297 tests, 3 failures, 44.46 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 44.6 seconds\n    cpu time: 1.3 seconds\n    cumulative wall time: 44.5 seconds\n```",
    "created_at": "2015-02-28T18:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225198",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

I got 3 failures after "ID 215-02-28-17-11-36-39ff4408", testlong got three failures in src/sage/plot/plot3d/base.pyx (see below) , all bound to 3D graphics. The rest got no failures.

I got no build failure after integrating the last commit(s), but I did **not** rebuild from scratch.

Is that enough for "positive review" ? Do you need a scratch build (long since serial : I didn't integrate #17839...) ?

HTH.

The three errors :

```
charpent@asus16-ec:/usr/local/sage-6.6$ sage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx
Running doctests with ID 2015-02-28-19-11-29-0b70177c.
Git branch: t/17234/rich_output_and_the_ipython_notebook
Doctesting 1 file.
sage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx
**********************************************************************
File "src/sage/plot/plot3d/base.pyx", line 1422, in sage.plot.plot3d.base.Graphics3d.save_image
Failed example:
    G.save_image(gif)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.base.Graphics3d.save_image[5]>", line 1, in <module>
        G.save_image(gif)
      File "sage/plot/plot3d/base.pyx", line 1434, in sage.plot.plot3d.base.Graphics3d.save_image (build/cythonized/sage/plot/plot3d/base.c:16182)
        Image.open(png).save(filename)
      File "build/bdist.linux-x86_64/egg/PIL/Image.py", line 2006, in open
        raise IOError("cannot identify image file")
    IOError: cannot identify image file
**********************************************************************
File "src/sage/plot/plot3d/base.pyx", line 1423, in sage.plot.plot3d.base.Graphics3d.save_image
Failed example:
    assert open(gif).read().startswith('GIF')
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.base.Graphics3d.save_image[6]>", line 1, in <module>
        assert open(gif).read().startswith('GIF')
    AssertionError
**********************************************************************
File "src/sage/plot/plot3d/base.pyx", line 1474, in sage.plot.plot3d.base.Graphics3d.save
Failed example:
    cube().save(tmp_filename(ext='.gif'))
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-6.6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.base.Graphics3d.save[5]>", line 1, in <module>
        cube().save(tmp_filename(ext='.gif'))
      File "sage/plot/plot3d/base.pyx", line 1480, in sage.plot.plot3d.base.Graphics3d.save (build/cythonized/sage/plot/plot3d/base.c:16543)
        self.save_image(filename)
      File "sage/plot/plot3d/base.pyx", line 1434, in sage.plot.plot3d.base.Graphics3d.save_image (build/cythonized/sage/plot/plot3d/base.c:16182)
        Image.open(png).save(filename)
      File "build/bdist.linux-x86_64/egg/PIL/Image.py", line 2006, in open
        raise IOError("cannot identify image file")
    IOError: cannot identify image file
**********************************************************************
2 items had failures:
   1 of   7 in sage.plot.plot3d.base.Graphics3d.save
   2 of   8 in sage.plot.plot3d.base.Graphics3d.save_image
    [297 tests, 3 failures, 44.46 s]
----------------------------------------------------------------------
sage -t --long --warn-long 24.8 src/sage/plot/plot3d/base.pyx  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 44.6 seconds
    cpu time: 1.3 seconds
    cumulative wall time: 44.5 seconds
```



---

archive/issue_comments_225199.json:
```json
{
    "body": "I don't know what \"ID 215-02-28-17-11-36-39ff4408\" is, but these failures might be the same ones that I fixed in cc9a5af.",
    "created_at": "2015-02-28T18:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225199",
    "user": "https://github.com/vbraun"
}
```

I don't know what "ID 215-02-28-17-11-36-39ff4408" is, but these failures might be the same ones that I fixed in cc9a5af.



---

archive/issue_comments_225200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-01T00:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225201.json:
```json
{
    "body": "Passed tests on the buildbot!",
    "created_at": "2015-03-01T08:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225201",
    "user": "https://github.com/vbraun"
}
```

Passed tests on the buildbot!



---

archive/issue_comments_225202.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-01T14:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225202",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_225203.json:
```json
{
    "body": "a173e92 builds without a hitch and passes (p)testlong with no failure ; the Ipython notebook is functional and displays Mathjax and asci art ==> positive review.\n\nThe (temporary) loss of 3D plotting is a (small) nuisance, though. Are there already tickets to watch for  this functionality ?\n\nI also note that plot3d(..) or p1=plot3d(...) ; p1 does display in the Ipython notebook, as long as no argument of plot3d has to be passed to show() and friends. Is this \"vestigial\" (or \"embryonic\") 3D displaying the intended behaviour ?",
    "created_at": "2015-03-01T14:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225203",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

a173e92 builds without a hitch and passes (p)testlong with no failure ; the Ipython notebook is functional and displays Mathjax and asci art ==> positive review.

The (temporary) loss of 3D plotting is a (small) nuisance, though. Are there already tickets to watch for  this functionality ?

I also note that plot3d(..) or p1=plot3d(...) ; p1 does display in the Ipython notebook, as long as no argument of plot3d has to be passed to show() and friends. Is this "vestigial" (or "embryonic") 3D displaying the intended behaviour ?



---

archive/issue_comments_225204.json:
```json
{
    "body": "> The (temporary) loss of 3D plotting is a (small) nuisance, though.\n\nI assume you mean only in the IPython notebook, not in the sagenb?",
    "created_at": "2015-03-02T15:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225204",
    "user": "https://github.com/kcrisman"
}
```

> The (temporary) loss of 3D plotting is a (small) nuisance, though.

I assume you mean only in the IPython notebook, not in the sagenb?



---

archive/issue_comments_225205.json:
```json
{
    "body": "Replying to [comment:63 kcrisman]:\n> > The (temporary) loss of 3D plotting is a (small) nuisance, though.\n\n> I assume you mean only in the IPython notebook, not in the sagenb?\n\nYes, indeed. My curiosity was towards the notebook functionality : the Ipython notebook, wit its one-file container, is a real boon. \n\nBut, for me at least, not having typeset math (or at least decent ascii_art display) is a pain. So I'm eager to see an Ipython notebook with typesetting functionality.",
    "created_at": "2015-03-02T21:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225205",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:63 kcrisman]:
> > The (temporary) loss of 3D plotting is a (small) nuisance, though.

> I assume you mean only in the IPython notebook, not in the sagenb?

Yes, indeed. My curiosity was towards the notebook functionality : the Ipython notebook, wit its one-file container, is a real boon. 

But, for me at least, not having typeset math (or at least decent ascii_art display) is a pain. So I'm eager to see an Ipython notebook with typesetting functionality.



---

archive/issue_events_049884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-03T00:25:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16997#event-49884"
}
```



---

archive/issue_comments_225206.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-03T00:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225206",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_225207.json:
```json
{
    "body": "The changes committed here interfere heavily with my work from #7298 for animations displayed in the HTML5 `<video>` tag, and raise new questions for #16650 about APNG integration. I'd be very happy if the people involved in landing this code here could have a look at those tickets as well, advise how to proceed there and perhaps re-evaluate some design decisions made here.",
    "created_at": "2015-03-12T01:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225207",
    "user": "https://github.com/gagern"
}
```

The changes committed here interfere heavily with my work from #7298 for animations displayed in the HTML5 `<video>` tag, and raise new questions for #16650 about APNG integration. I'd be very happy if the people involved in landing this code here could have a look at those tickets as well, advise how to proceed there and perhaps re-evaluate some design decisions made here.



---

archive/issue_comments_225208.json:
```json
{
    "body": "Volker - what is the relation between stuff here and `EMBEDDED_MODE`? The latter is still spread over the source.",
    "created_at": "2015-03-16T19:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225208",
    "user": "https://github.com/novoselt"
}
```

Volker - what is the relation between stuff here and `EMBEDDED_MODE`? The latter is still spread over the source.



---

archive/issue_comments_225209.json:
```json
{
    "body": "This ticket wasn't about removing the remaining 55 occurrences of `EMBEDDED_MODE`, thats another job... It should be removed, but its going to take time.",
    "created_at": "2015-03-16T20:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225209",
    "user": "https://github.com/vbraun"
}
```

This ticket wasn't about removing the remaining 55 occurrences of `EMBEDDED_MODE`, thats another job... It should be removed, but its going to take time.



---

archive/issue_comments_225210.json:
```json
{
    "body": "I would like to use this to typeset the output in Emacs, but I need some sort of delimiters on the latex, so that I don't try to typeset backtraces, the result of print statements, etc.  In fact, it would be nice to have both plain text and latex outputs properly delimited so that I can switch between the two. e.g. display the plain text until the latex rendering is finished.\n\nDoes it make sense to add a OutputDelimitedLatex class and update BackendIPythonCommandline?  I run an ipython shell from inside Emacs.",
    "created_at": "2015-04-02T04:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225210",
    "user": "https://github.com/gvol"
}
```

I would like to use this to typeset the output in Emacs, but I need some sort of delimiters on the latex, so that I don't try to typeset backtraces, the result of print statements, etc.  In fact, it would be nice to have both plain text and latex outputs properly delimited so that I can switch between the two. e.g. display the plain text until the latex rendering is finished.

Does it make sense to add a OutputDelimitedLatex class and update BackendIPythonCommandline?  I run an ipython shell from inside Emacs.



---

archive/issue_comments_225211.json:
```json
{
    "body": "Replying to [comment:69 iandrus]: \n> Does it make sense to add a OutputDelimitedLatex class and update BackendIPythonCommandline?  I run an ipython shell from inside Emacs.  \n\n\nI have a very experimental branch at u/iandrus/emacs-typeset-output with the basics of what I'm thinking of.  It's definitely not finished, but if the general approach seems reasonable, I'll polish it up and open a ticket etc.",
    "created_at": "2015-04-02T05:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225211",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:69 iandrus]: 
> Does it make sense to add a OutputDelimitedLatex class and update BackendIPythonCommandline?  I run an ipython shell from inside Emacs.  


I have a very experimental branch at u/iandrus/emacs-typeset-output with the basics of what I'm thinking of.  It's definitely not finished, but if the general approach seems reasonable, I'll polish it up and open a ticket etc.



---

archive/issue_comments_225212.json:
```json
{
    "body": "IMHO emacs-mode should define its own backend, possibly by inheriting from the ipython command line backend. Thats why there are pluggable backends. Then you can format OutputLatex in precisely the way the emacs-mode needs without stepping on anybody else's toes.",
    "created_at": "2015-04-02T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225212",
    "user": "https://github.com/vbraun"
}
```

IMHO emacs-mode should define its own backend, possibly by inheriting from the ipython command line backend. Thats why there are pluggable backends. Then you can format OutputLatex in precisely the way the emacs-mode needs without stepping on anybody else's toes.



---

archive/issue_comments_225213.json:
```json
{
    "body": "Replying to [comment:71 vbraun]:\n> IMHO emacs-mode should define its own backend, possibly by inheriting from the ipython command line backend. Thats why there are pluggable backends. Then you can format OutputLatex in precisely the way the emacs-mode needs without stepping on anybody else's toes.\n\n\nThanks.  I opened #18115 with the new approach.  It seems to work, but I've probably forgotten something.",
    "created_at": "2015-04-03T04:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16997#issuecomment-225213",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:71 vbraun]:
> IMHO emacs-mode should define its own backend, possibly by inheriting from the ipython command line backend. Thats why there are pluggable backends. Then you can format OutputLatex in precisely the way the emacs-mode needs without stepping on anybody else's toes.


Thanks.  I opened #18115 with the new approach.  It seems to work, but I've probably forgotten something.
