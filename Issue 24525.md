# Issue 24525: py3: miscellaneous minor fixes for sage.rings.polynomial.polydict

Issue created by migration from https://trac.sagemath.org/ticket/24762

Original creator: embray

Original creation time: 2018-02-16 17:05:24




---

Comment by embray created at 2018-02-16 17:05:33

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-02-19 07:10:08

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-02-19 07:10:08

does not apply


---

Comment by embray created at 2018-02-19 16:01:48

I'll just wait until #24761 has positive_review


---

Comment by embray created at 2018-02-19 16:01:59

Set assignee to embray.


---

Comment by chapoton created at 2018-05-11 12:12:00

needs rebase


---

Comment by git created at 2018-05-14 15:06:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-05-14 15:07:24

Rebased


---

Comment by embray created at 2018-05-14 15:07:24

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-05-28 12:22:53

needs rebase again..


---

Comment by chapoton created at 2018-05-28 12:22:59

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-05-28 13:56:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-05-28 13:56:46

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-05-28 19:07:08

ok


---

Comment by chapoton created at 2018-05-28 19:07:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-29 20:39:31

Resolution: fixed


---

Comment by dimpase created at 2018-09-18 10:14:00

for some reason I cannot fetch u/embray/python3/sage-rings-polynomial-polydict/misc
- is it deleted?

I get 

```
$ git remote update
Fetching origin
error: cannot lock ref 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict/misc': 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict' exists; cannot create 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict/misc'
From trac.sagemath.org:sage
 ! [new branch]            u/embray/python3/sage-rings-polynomial-polydict/misc -> u/embray/python3/sage-rings-polynomial-polydict/misc  (unable to update local ref)
error: Could not fetch origin
```



---

Comment by embray created at 2018-09-18 17:42:03

Probably.  I try to delete old branches once they've been merged.  Why?


---

Comment by dimpase created at 2018-09-18 17:53:23

Replying to [comment:16 embray]:
> Probably.  I try to delete old branches once they've been merged.  Why?

I got this error while doing routine mirroring to 
https://github.com/sagemath/sagetrac-mirror/
Never seen such an error before, probably that means it's time for `git fsck` ?


---

Comment by vbraun created at 2018-09-18 22:50:52

I've seen that error before, I think you have a local copy of a branch that Eric deleted on the remote, and then created a new remote branch with a conflicting name. Your local repo is not corrupted (hence git fsck will not help), you just need to get rid of the stale local branch.


---

Comment by dimpase created at 2018-09-19 04:57:21

I do not manipulate the local repo locally, I do mirroring

```
$ git remote update
Fetching origin
X11 forwarding request failed on channel 0
remote: Counting objects: 702, done.
remote: Compressing objects: 100% (384/384), done.
...
[sucessfully getting new/updated branches]
...
error: cannot lock ref 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict/misc': 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict' exists; cannot create 'refs/heads/u/embray/python3/sage-rings-polynomial-polydict/misc'
 ! [new branch]            u/embray/python3/sage-rings-polynomial-polydict/misc -> u/embray/python3/sage-rings-polynomial-polydict/misc  (unable to update local ref)
...
[sucessfully getting new/updated branches]
...
error: Could not fetch origin
```

and indeed:

```
$ git rev-parse refs/heads/u/embray/python3/sage-rings-polynomial-polydict
f3a7904ae5845c7663765b3b5b1760997e3369fa
```

and indeed the latter does exist on the remote just fine.
Now, doing fsck locally shows

```
$ git fsck
Checking object directories: 100% (256/256), done.
Checking objects: 100% (740678/740678), done.
Checking connectivity: 720919, done.
dangling commit 820100e10f17de34633447e8c4a7d235c0185dc0
dangling commit 0f14c03aac747ff8d70a874e6b2fd4db6750e597
dangling commit 1a1d00723c4919e91dd229c422424831cceba13e
dangling commit 2d1ec036be5eed09981bfb30ff0da56c6f4b237e
dangling commit a44d20532d54668db052013b090d728481028fb8
dangling commit 84236154543bf0b2dcf547dcd372d5605d949668
dangling commit c648214b288f031c9771bb8c021f62df814e68cd
dangling commit 2c85617ca7c104c410eeeb07ca51efeaf934a019
dangling commit 516063796c5d465f4320aa1e1adfb09041893e58
dangling commit e86a23e0fb8520e327c3b9ce24a3fcb5800772c9
dangling commit e7a5e3929ef2108094549a97e63e1dba3fb9b09f
dangling commit b9bec315533c5a7a7d600090c21699310a1a78ca
dangling commit cae6a3848650949359c357d33bc74b6968b9a726
dangling commit a219c4b1a15bf46c4724b84a2cd0ed624a85d800
dangling commit 73b684668c1f3aa9df8ddf997196a0d73cb07897
dangling commit c0ea441ebb24019cf7d5e2670671dd2bd4293287
dangling commit f7f3847b26048b3b5f437731230d8dd2ade93eae
dangling commit f14f85b101976b6fb8a408de1f876cb40e130be9
dangling commit 115685b7c25b0bfd3e59802c402be42a99ed21a2
dangling commit 74b2e5098a644489bef564242e4bbebed034b604
dangling commit 1bbf4573b61fdd034db9a9b4276153817f58d377
dangling commit 7be6459e43ef4e9cc96d5fe990ea84335562d591
dangling commit 4d7aa64eec851873106dbd14d0944b9bcda8271b
dangling commit 6b9146a77729028543996ca30cba9ce3ed77c777
dangling commit 0baf86234801c1da822ed8e2aa946ebe6a141d9b
dangling commit c1cf2678e2de2e56297ab0a281b515a61284bd23
dangling commit a62587a08668adf537fb3fcbb418b39dd8508b1f
dangling commit c9a5a79670b8eee73cc8c31617b6266191ca7d50
dangling commit a217a86f3062270cd73059e8589fcf59ad995477
dangling commit 733bc812a2526c31b90b6fb8364faa128e3115c8
dangling commit 5b7da8659f7f8dc44cb7f19d39648436a3617b6e
dangling commit e6f189ed4c331456beda0ede5edf00329d90d7d8
dangling commit c13baa795325050fab10a404be336be82c31e16f
dangling commit d45b4afa37e45cef68250a64d00661cff3a750be
dangling commit cf7a0aa9e1627db79a332def992da45fab7a5f0d
dangling commit 9880ca1c7c9083fd7c9dd8661c9d3137191560da
dangling commit 449a6a29ff85becfefa9b915a9aa0e56a3ea409f
dangling commit a6e4cad8f6d2c965033fb1fea85c4c6eed49df1d
dangling commit abe62ab57699966f8ab56141e19983f68238fec1
dangling commit 938b8bf2984d53213b56cf3d9030ca5834a662ad
dangling commit 33e38b4c80b32aea35d88624b6483bf61c01127f
dangling commit 0fec8b8f5a43345be388f0711c31026d694b795b
dangling commit 4062ec68cca650a62e107a109b9cea64cfcc2041
dangling commit ae76acfe05f5ef3d8885196615692ac3ef9c2983
dangling commit be764c54131991b87cb159722a8bcebf2ee98da2
dangling commit 51012d0a6c7527cbd8e6114207f7f762f39d3710
dangling commit 88474da0f4ae6f70be0c1e4f1e7778ea808fd1aa
dangling commit 862d8e4b74e54745188eb6b75fc894d90768dc53
dangling commit cc9c6eb892eaf9c2eeee4259c20f5d3abbac9a04
dangling commit f3fd8ef19a8bc460581bc79c45fe305852bd4303
dangling commit 2c0b9020157a40ad06c43aea198f5b253e6a77fe
dangling commit 4d2050677eb89a12bd864f100b601ea3dc586887
dangling commit 7e3870da438fcc1074eb8362ed518a509db697c5
dangling commit 133c7059db2d08eb115decddfed1b28424a7e763
dangling commit 5e40504d977c0e9ecf4ab494715667d1e61a7408
dangling commit 219150c1039eb86fabf39a10530cc869b6924580
dangling commit e462f1a47cff55b24e100a2ffd01f958623368fb
dangling commit ecfb511e4375e7fd0bb1e4f222d028d48a8c4ba6
dangling commit 602172366246c788e1aa88efedaddfb96e7dd8a5
dangling commit ba87322409fce0ef037690246d9eafea54382019
dangling commit 6d1493a8cc65b6a2fe869e20e1d92b7c52bd1b87
dangling commit a330d39c12ea918970ca3ac9678e02e3441dd760
dangling commit bd3b9338d7e566e213eab203ed699083f06f748b
dangling commit 86d993bbb84a43ded221d19d67970c97d25dccda
dangling commit 95dd33e3031b29c80edb9c5c9c6c41c827d140af
dangling commit 7af4748cab37d651eaa88be501db88f4a5ffc584
dangling commit 92fb34a66068bd4f1651412102c372e8c883754c
dangling commit 9715f55d97776b31e64d96e356291f12971b1ac0
dangling commit 1030350ee9cfd5729fca07b55f6e941530ee9fb0
dangling commit 208d754a61850cccb34b6a27afc3553fa7dc3bbb
dangling commit b42ad6b02261c81d3eec04eb1da800c0bd306888
dangling commit e12d36d844be5b722e6e295bc3a38c2603ac5414
dangling commit 28c1d69e23121bd3ac96d593283c3491482ae4b9
dangling commit d4d7f6de2fdbe3b248424ea3dcec44b249030dc4
dangling commit d6f75609daa0f637674dd99035344dd76f20a3e3
dangling commit 6969b7430ab52b58f65334fa12e78433ce010421
dangling commit a56f9735ea74cacadf2947165fb7a191f8345fca
dangling commit ee37586975956667073cd0ba672385f1b14f9334
dangling commit bf48b877e1eb805197f78d892b95f15b04a0cf89
dangling commit eecf581b827a7decd0eb0ddd345aef8dd1c9d54e
dangling commit 8168d98365f0114049d13f817e6813c572eda3ae
dangling commit dcd939c6426d1c59f8373972c92d3a989445a807
dangling commit 82467a370bfed05addfe0d240b735c2e08c8ce7c
dangling commit c14afaa0ec53cd34d91a65aa3d29ecc325ca4a44
dangling commit 525c3af4c1e60a230fb4959454552df86054bb48
dangling commit 48ba5ae36815afb34473ef5f28ee100baa2a7f91
dangling commit 54d73ac929f32c1c47443f08c7b835cb0daae46c
dangling commit 833f3ba6e86e83fb64b39ed53864e3e2d7116321
dangling commit efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf
dangling commit de0dbde4defb7809ae0dfaf94e5ad0aec8143ce9
dangling commit dba0dd66ddcb13f04413f62fca0081c12c2d4afd
dangling commit 4ec81df858ffcce060a1ca95e3a3aa1eacc7c20a
dangling commit 6e6e1eb6ebcbcf304443af0829308701568d3176
dangling commit 08c93e26bdfe3239e168598b25dc354f40e98b8a
dangling commit ba047f9c78f100dd7b7de8faabade2eaf10213ba
dangling commit b85a7fdad6ec8e5d23119ed310852f31bf8b770a
$ 
```


The latter seems to suggest that the remote has a bunch of inconsistencies too...


---

Comment by vbraun created at 2018-09-19 07:24:39

Dangling commits are normal, they are just commits that you have locally that are not referenced anywhere (e.g. because their branch was deleted). The problem is that you can't have a directory and normal file with the same name, so its forbidden to have both branches

```
u/embray/python3/sage-rings-polynomial-polydict
u/embray/python3/sage-rings-polynomial-polydict/misc
```

in a (local) git repository.

Now u/embray/python3/sage-rings-polynomial-polydict (without the /misc) does not exist on the remote any more, but u/embray/python3/sage-rings-polynomial-polydict/misc does:

```
$ git ls-remote trac | grep ython3/sage-rings-polynomi
4d7aa64eec851873106dbd14d0944b9bcda8271b	refs/heads/u/embray/python3/sage-rings-polynomial-polydict/misc
```


Your local repo still has a copy of the old u/embray/python3/sage-rings-polynomial-polydict (without /misc), so you cannot download the new ../misc branch. You need to `git branch -d u/embray/python3/sage-rings-polynomial-polydict` in your local repo to fix it.


---

Comment by dimpase created at 2018-09-19 09:39:02

I just did the latter, followed by `git remote update` (which completed normally)
but then

```
git push --mirror git@github.com:sagemath/sagetrac-mirror.git
```

fails with errors.

```
Counting objects: 371, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (154/154), done.
Writing objects: 100% (371/371), 121.97 KiB | 9.38 MiB/s, done.
Total 371 (delta 300), reused 267 (delta 215)
remote: Resolving deltas: 100% (300/300), completed with 109 local objects.
To github.com:sagemath/sagetrac-mirror.git
 ! [remote rejected]       public/25097/qnormaliz-algebraic -> public/25097/qnormaliz-algebraic (failed)
 ! [remote rejected]       public/group_theory/improve_iterator_perm_gps-25477 -> public/group_theory/improve_iterator_perm_gps-25477 (failed)
...
(many more)
...
error: failed to push some refs to 'git@github.com:sagemath/sagetrac-mirror.git'
```



---

Comment by vbraun created at 2018-09-19 17:12:33

Well github rejected your push, probably something wrong with authentication. Whats the output of `ssh -T git`@`github.com`


---

Comment by dimpase created at 2018-09-22 18:15:53

It rejected my push for some other reason, not because I cannot authenticate...

```
$ ssh -T git@github.com
Enter passphrase for key '/users/dimpase/.ssh/id_rsa': 
Hi dimpase! You've successfully authenticated, but GitHub does not provide shell access.
```


Please also see https://groups.google.com/d/msg/sage-devel/cbdR32HRVX4/8-PAK2HuCgAJ
(a post regarding the same branch...)


---

Comment by dimpase created at 2018-09-22 18:17:16

I suspect it's because I push in a mirror mode, and this does some extra checks...


---

Comment by vbraun created at 2018-09-22 23:02:39

Have you tried adding `--force`? I don't know what you have locally, but this is the expected result if the branch change is not just a fast-forward.


---

Comment by dimpase created at 2018-09-23 09:51:38

The local repo is a mirror of git at trac.sagemath.org

I've ended up deleting github.com:sagemath/sagetrac-mirror and re-creating it from scratch.
