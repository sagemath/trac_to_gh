# Issue 31275: Implementation of the graded quasimodular forms ring

Issue created by migration from https://trac.sagemath.org/ticket/31512

Original creator: @DavidAyotte

Original creation time: 2021-03-18 18:01:05

CC:  slelievre vdelecroix

Keywords: graded quasimodular forms gsoc2021

The goal of this ticket is to implement the ring of graded quasimodular forms as there are no such functionality in [SageMath](SageMath) (as of v9.2). More precisely, the goal is to first implement a class named `QuasiModularFormsRing` with similar methods and feature as the class `ModularFormsRing`. Second, it would be desirable to implement the Block-Okounkov bracket that, given a shifed symmetric polynomial, produces a quasimodular form.

This initial implementation is really "primitive" and work only for the full modular groups. However, it would be great to support quasimodular forms for higher level congruence subgroups.

This is my first ticket for a new enhancement, so any comments and insight about how to correctly do this is more than welcome.


---

Comment by @DavidAyotte created at 2021-03-18 18:06:33

New commits:


---

Comment by @DavidAyotte created at 2021-03-18 18:06:33

Set assignee to @DavidAyotte.


---

Comment by git created at 2021-03-18 19:45:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-03-19 10:29:29

Hi David,

Great start.

Let us stick to `SL(2,Z)` in this ticket. Further improvements (other congruence subgroups, Bloch-Okounkov brackets should be reserved for other tickets).

Some concrete remarks
- `QuasiModularFormsRing` could simply be `QuasiModularForms`
- The main class should inherit from `Parent` and the category should be properly initialized, see https://doc.sagemath.org/html/en/thematic_tutorials/coercion_and_categories.html
- The objective is to manipulate exact formal objects. Not approximate q-series. The following operations should be available on the elements
  - equality tests between two qm-forms
  - decomposition of a qm-form with respect to the grading (ie by level)
  - testing modularity
  - computing the q-series expansion of a qm-form (arbitrary precision)
  - multiplication by a modular form (maybe the simplest to achieve this is to define qm-forms as an algebra over modular forms?)
  - (further ticket) computing algebraic or differential equations (for that purpose it is necessary to have formal derivatives, not the derivative of the q-expansion)
  - (further ticket) asymptotics of coefficients
- The following methods should be available on the parent (the algebra itself)
  - vector space basis of a given graded component
  - basis and generators up to modular forms


---

Comment by git created at 2021-03-24 14:39:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2021-03-24 20:44:28

Replying to [comment:6 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[9fa1397](https://git.sagemath.org/sage.git/commit/?id=9fa1397adf5b3412c1974551f1ebe8d564892d38)||`Changed the name of the main class to QuasiModularForms. Added inheritance from Parent and UniqueRepresentation. Implemented category framework to the main class`||

I just realized that there are some inconsistencies in the code of that commit. They will be fixed this week.


---

Comment by git created at 2021-03-25 15:32:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-03-25 18:13:16

Changing keywords from "graded quasimodular forms gsoc2021" to "quasimodular-forms gsoc2021".


---

Comment by git created at 2021-06-09 18:47:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-22 14:37:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-28 02:36:02

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-08-03 02:04:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-03 03:12:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-03 16:03:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-03 18:29:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-04 16:58:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-05 14:55:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-05 20:06:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2021-08-05 20:07:13

Changing status from new to needs_review.


---

Comment by git created at 2021-08-06 13:25:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-08-07 10:33:18

This

```
        if not self._polynomial.degree():
            return self._polynomial[0].is_modular_form()
        else:
            return False
```

is equivalent to

```
return not self._polynomial.degree() and self._polynomial[0].is_modular_form()
```



Why do you store base ring in the element (attribute `__base_ring`)? This would better be accessed through the parent. Note that `ModuleElement` has a default implementation of the method `base_ring` as

```
def base_ring(self):
    return self._parent.base_ring()
```

Also, since you inherit from `Parent`, there is already a slot dedicated to that. Namely `_base`. This is initialized inside the constructor

```
Parent.__init__(self, base=..., category=...)
```

So : remove `__base_ring` from both `QuasiModularForms` and `QuasiModularFormsElement`.
(I believe the same could be done for modular forms. But leave that to another ticket)


---

Comment by vdelecroix created at 2021-08-07 10:33:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-08-09 14:53:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2021-08-09 14:57:20

Thanks a lot! I had forgotten about the base ring attribute after implementing the parent/element framework. I will open a ticket to fix this for the class `ModularFormsRing`.


---

Comment by @DavidAyotte created at 2021-08-09 14:57:20

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2021-08-16 15:03:35

Why is it only implemented for SL(2,Z)? The isomorphism `QM = M[E2]` is valid in general.


---

Comment by vdelecroix created at 2021-08-16 15:04:16

typo: `def weigt_2_eisenstein_series(self):` (missing a h)


---

Comment by @DavidAyotte created at 2021-08-16 15:17:32

Replying to [comment:28 vdelecroix]:
> Why is it only implemented for SL(2,Z)? The isomorphism `QM = M[E2]` is valid in general.

I will check if this doesn't break anything, but I mostly stick to the case of SL2Z because of comment:5. But thanks for reminding me this isomorphism, it should not be a problem.


---

Comment by vdelecroix created at 2021-08-16 15:31:12

Better to switch `DAVID AYOTTE` -> `David Ayotte`


---

Comment by vdelecroix created at 2021-08-16 15:36:03

Maybe we made a mistake, but the initialization from polynomial is confusing. The reason is that both `E2 * E4 - 3 * E2^2` and `-1/24 + q + 3*q^2 + 4*q^3 + 7*q^4 + 6*q^5` are polynomials.


---

Comment by @DavidAyotte created at 2021-08-16 15:50:20

Replying to [comment:32 vdelecroix]:
> Maybe we made a mistake, but the initialization from polynomial is confusing. The reason is that both `E2 * E4 - 3 * E2^2` and `-1/24 + q + 3*q^2 + 4*q^3 + 7*q^4 + 6*q^5` are polynomials.

This is in fact really important. To fix this confusion, my idea would be to give more examples and explanations in the doc. Do you have an other idea to fix this?


---

Comment by vdelecroix created at 2021-08-16 15:57:04

In the case of `ModularFormsRing._element_constructor_`, when the input is a polynomial the code calls `from_polynomial`. This is very different from what is happening with the quasimodular forms.


---

Comment by @DavidAyotte created at 2021-08-16 17:09:18

Replying to [comment:34 vdelecroix]:
> In the case of `ModularFormsRing._element_constructor_`, when the input is a polynomial the code calls `from_polynomial`. This is very different from what is happening with the quasimodular forms.

Ok, so maybe the element constructor of `ModularFormsRing` should not call `from_polynomial`. What do you think?


---

Comment by vdelecroix created at 2021-08-16 17:43:50

Replying to [comment:35 gh-DavidAyotte]:
> Replying to [comment:34 vdelecroix]:
> > In the case of `ModularFormsRing._element_constructor_`, when the input is a polynomial the code calls `from_polynomial`. This is very different from what is happening with the quasimodular forms.
> 
> Ok, so maybe the element constructor of `ModularFormsRing` should not call `from_polynomial`. What do you think?

I think it would be fine to allow both. It just needs more parsing of the input
- univariate polynomial ring with generator `q` -> q-expansion (raise a `NotImplementedError` for now)
- multivariate polynomial ring with rational or finite field coefficients -> call `from_polynomial` as it is now.


---

Comment by git created at 2021-08-16 19:17:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-30 14:25:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-08 13:49:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-08 13:55:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-09-08 15:49:41

Two small remarks:

In the element, why are you storing both the polynomial and its coefficients? The latter is only used in `q_expansion` for which you could have use equally the polynomial.

The methods `is_modular_form` and `is_graded_modular_form` are not quite right for the zero element as

```
sage: QQ['x'].zero().degree()
-1
```



---

Comment by @DavidAyotte created at 2021-09-08 16:13:20

> Two small remarks:
> 
> In the element, why are you storing both the polynomial and its coefficients? The latter is only used in `q_expansion` for which you could have use equally the polynomial.

Since the coefficient attribute is used only once, I will drop it.

\\
> The methods `is_modular_form` and `is_graded_modular_form` are not quite right for the zero element as
> {{{
> sage: QQ['x'].zero().degree()
> -1
> }}}

Oops, thanks for finding this! I had forgotten that there was a special rule for the degree of the zero polynomial. I'll fix this.


---

Comment by git created at 2021-09-08 16:18:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-09-09 06:55:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-09-25 23:17:39

Resolution: fixed
