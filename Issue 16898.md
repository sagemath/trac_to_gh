# Issue 16898: help

Issue created by migration from https://trac.sagemath.org/ticket/17135

Original creator: dcoudert

Original creation time: 2014-10-11 15:17:17

CC:  ncohen




---

Comment by dcoudert created at 2014-10-11 15:21:56

Changing component from PLEASE CHANGE to graph theory.


---

Comment by dcoudert created at 2014-10-11 15:21:56

Changing priority from major to minor.


---

Comment by dcoudert created at 2014-10-11 15:21:56

Changing type from PLEASE CHANGE to enhancement.


---

Comment by dcoudert created at 2014-10-11 16:50:25

Changing status from new to needs_review.


---

Comment by dcoudert created at 2014-10-11 16:50:25

New commits:


---

Comment by git created at 2014-10-16 22:54:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-10-19 14:30:16

Yo !!

A second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...

- About `seen`. "It must be initialized, but there is no need to initialize it".


```
+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling
+      this method. owever, there is no nead to initialize it.
```


- `this method check is all` --> checkS iF all

- `this helps saving` --> save

- `when we already known` --> know

- About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?


```diff
-return distances[waiting_list[waiting_end]]
+return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX
```


  It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !

- `This method search for` -> searches

- `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`

  By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?

- In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`

- Is it only me or is the `4sweep` function doing much more that 4 sweeps ?

- `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`

- I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.

- There are useless variables in this function

Nathann


---

Comment by ncohen created at 2014-10-19 14:30:16

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-10-25 10:00:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2014-10-25 10:02:10

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2014-10-25 10:02:10

Replying to [comment:5 ncohen]:
> Yo !!
> 
> A second pass on this code. With this I guess that the 'technical review' is done, but I haven't checked the correction yet, i.e. looked at the papers and what they prove. I don't really like to make a non-obvious algorithm the default one when we have a much simpler way to compute the same value, but well, if it is faster ...
> 
> - About `seen`. "It must be initialized, but there is no need to initialize it".
> 
> {{{
> +    - ``seen`` -- bitset of size ``n`` that must be initialized before calling
> +      this method. owever, there is no nead to initialize it.
> }}}

I have revised the text as follows:

```
+    - ``seen`` -- bitset of size ``n`` that must be initialized before calling 
       this method (i.e., bitset_init(seen, n)). However, there is no need to 
       clear it. 
```

 

> - `this method check is all` --> checkS iF all
> 
> - `this helps saving` --> save
> 
> - `when we already known` --> know
> 
> - About your check for connected graphs: I find your `if test_is_connected and len(seen)<n: return big_number` a bit weird given that you just ran a BFS which is supposed to return the eccentricity of a vertex (which, in particular, tests if the graph is connected}}}. And actually, while you say that the ` simple_BFS` function returns the eccentricity of `source`, it only does so when the graph is connected. If it is not, it returns the (finite) eccentricity of `source` in its connected component. Is there any reason why you should not do that `simple_BFS` ?
> 
> {{{
> #!diff
> -return distances[waiting_list[waiting_end]]
> +return distances[waiting_list[waiting_end]] if waiting_end == waiting_list+n-1 else UINT32_MAX
> }}}
> 
>   It would make the `simple_BFS` function more correct, and it also means that you do not need to define this `is_connected` parameter as ... checking this is totally free !

You are perfectly right! I have changed the code. I have removed the useless parameter and now return the eccentricity of the source in the graph:

```
return distances[waiting_list[waiting_end]] if waiting_end==n-1 else UINT32_MAX 
```

 

> - `This method search for` -> searches
ok
 
> - `diameter_lower_bound_4sweep_select_dichotomy`: really the dichotomy should be done through bsearch (http://www.cplusplus.com/reference/cstdlib/bsearch/) but I don't exactly know how to provide `distances` as an argument. Too bad `:-/`
> 
>   By the way, do you really need the if `i==j-1` block ? Or would it be sufficient to just replace `i=k` with `i=k+1` ?
>
> - In `lower_bound_4sweep`: you do not need a `improved` variable. Use a `break` with a `while True`. And you can even have a `while tmp>LB` and no `break` if you compute `tmp` at the end of the loop `:-P`

I agree that calling `bsearch` would be better, but I don't know how to do it without introducing extra data structure (e.g., array of pairs (vertex, distance)). I have simplified the code and removed the `diameter_lower_bound_4sweep_select_dichotomy` method.
 

> - Is it only me or is the `4sweep` function doing much more that 4 sweeps ?

You are right. I don't know why they call it `4sweep` instead of `multisweep`. I can change the name if you think it is more natural.
 

> - `diameter_iFUB` frees memory that it did not allocate itself. This feels wrong `O_o`

I have removed these instructions.
 

> - I do not think that the comments about the data structure in `diameter()` are necessary. All that this function does is call others.
> 
> - There are useless variables in this function

I have shortened the comments and remove useless variables. It should be cleaner now.
 

> Nathann

Thanks a lot for all the comments.
----
New commits:


---

Comment by ncohen created at 2014-10-27 13:42:18

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-10-27 13:42:18

You say in the documentation of the 4sweep method that the vertex `w` should be at the same distance from `u` and `v`, but your dichotomy search does not do that. You only check that the vertex you take is at distance LB/2 from `u`, but you do not know anything about `v`. For all you know `w` may be a leaf.

Nathann


---

Comment by git created at 2014-10-27 17:24:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2014-10-27 17:30:50

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2014-10-27 17:30:50

You are perfectly right.

I found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.

Thanks.


---

Comment by ncohen created at 2014-10-28 12:36:26

Yo !

> I found no other way than storing the predecessors and then following the path from a destination to the source to find that vertex. Let me know if you have a smarter approach.

No I don't see anything better `:-/`

Too bad for the fast search.

Nathann


---

Comment by dcoudert created at 2014-10-28 12:46:38

Since most of the computation time is in iFUB, this is not so bad.


---

Comment by git created at 2014-10-28 15:05:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-10-29 10:03:17

Hello again !

Okay, I finally understood how this thing works and it is quite simple and clear. Cool !

Aaaaaand so I added a paragraph of doc that explains how the algorithm works.

I also replace a couple of 4sweeps->multisweep, and remove the references from `GenericGraph.diameter` as Sphinx complained of having them twice as they are in `distances_all_pairs` too.

Now, while I updated the doc of `distances_all_pairs.diameter` I did not update the doc of `GenericGraph.diameter` because I have a question: why on earth do we define `GenericGraph.diameter` instead of just importing into `GenericGraph` the function from `distances_all_pairs` ? All the documentation is mostly a copy/paste !?

Also in multi-sweep/diameter_iFUB: the documentation says that the `int *` store the result of a BFS from `source`, while actually not much can be claimed about their content when the function returns. Just say that it is memory space used by the function while it runs unless you can say something more ?..

I added a commit with my changes at public/17135, tell me what you think !

Nathann


---

Comment by git created at 2014-11-01 10:38:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2014-11-01 10:54:09

Hello,

thanks for the improvements. It is much better now.

Following your comments, I'm now importing the new method as `GenericGraph.diameter`.
I have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.

David.

PS: git is powerful but not intuitive/easy for non experts.


---

Comment by ncohen created at 2014-11-02 22:32:16

Hello !

> Following your comments, I'm now importing the new method as `GenericGraph.diameter`.
> I have also removed some `int *` parameters from iFUB and multi-sweep. It avoids confusion. Also, since we only need to allocate tables (no need to initialize them), the extra cost of allocating some tables in 2 different methods is negligible.

Well.

1) Looks ready to go
2) Good job
3) Thanks for this patch !

> PS: git is powerful but not intuitive/easy for non experts.

Yep. Contributing to Sage is really hard at first `:-/`

Nathann


---

Comment by ncohen created at 2014-11-02 22:33:01

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2014-11-02 22:35:37

Thank you Nathann.


---

Comment by vbraun created at 2014-11-15 16:18:55

Resolution: fixed
