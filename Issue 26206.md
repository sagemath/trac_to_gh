# Issue 26206: no conversion between number fields over base rings which have conversion

archive/issues_026206.json:
```json
{
    "body": "CC:  vdelecroix jipilab\n\n\n```     \nsage: CyclotomicField(3).extension(x^2+1, 'i')(QQ.extension(x^2+1, 'i').gen())\n```\n\nreturns\n\n```\nTypeError: Cannot coerce element into this number field\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26443\n\n",
    "created_at": "2018-10-09T14:48:26Z",
    "labels": [
        "number fields",
        "major",
        "bug"
    ],
    "title": "no conversion between number fields over base rings which have conversion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26206",
    "user": "dkrenn"
}
```
CC:  vdelecroix jipilab


```     
sage: CyclotomicField(3).extension(x^2+1, 'i')(QQ.extension(x^2+1, 'i').gen())
```

returns

```
TypeError: Cannot coerce element into this number field
```



Issue created by migration from https://trac.sagemath.org/ticket/26443





---

archive/issue_comments_369363.json:
```json
{
    "body": "While in sage it would make sense that a homomorphism sending i to i would be the preferred one, it requires some work to see if that's valid. For instance, you'd have to distinguish it from\n\n```\nCyclotomicField(4).extension(x^2+3, 'i')(QQ.extension(x^2+1, 'i').gen())\n```\n\nI'm not sure we can fix this easily.",
    "created_at": "2018-10-18T20:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369363",
    "user": "nbruin"
}
```

While in sage it would make sense that a homomorphism sending i to i would be the preferred one, it requires some work to see if that's valid. For instance, you'd have to distinguish it from

```
CyclotomicField(4).extension(x^2+3, 'i')(QQ.extension(x^2+1, 'i').gen())
```

I'm not sure we can fix this easily.



---

archive/issue_comments_369364.json:
```json
{
    "body": "Replying to [comment:1 nbruin]:\n> While in sage it would make sense that a homomorphism sending i to i would be the preferred one, it requires some work to see if that's valid. For instance, you'd have to distinguish it from\n> {{{\n> CyclotomicField(4).extension(x^2+3, 'i')(QQ.extension(x^2+1, 'i').gen())\n> }}}\n> I'm not sure we can fix this easily.\n\nI see your point. So a conversion in general is difficult.\n\nHowever, we could focus on (special) coercions (in contrast to conversions): If we have two bases `A` and `B` where `B` has a coercion map from `A`, then `B.extensions(f, 'i')` should have a coercion map from `A.extension(f, 'i')` for I guess all `f`.",
    "created_at": "2018-10-19T07:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369364",
    "user": "dkrenn"
}
```

Replying to [comment:1 nbruin]:
> While in sage it would make sense that a homomorphism sending i to i would be the preferred one, it requires some work to see if that's valid. For instance, you'd have to distinguish it from
> {{{
> CyclotomicField(4).extension(x^2+3, 'i')(QQ.extension(x^2+1, 'i').gen())
> }}}
> I'm not sure we can fix this easily.

I see your point. So a conversion in general is difficult.

However, we could focus on (special) coercions (in contrast to conversions): If we have two bases `A` and `B` where `B` has a coercion map from `A`, then `B.extensions(f, 'i')` should have a coercion map from `A.extension(f, 'i')` for I guess all `f`.



---

archive/issue_comments_369365.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-19T08:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369365",
    "user": "dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369366.json:
```json
{
    "body": "I've made some changes that do what I expected from this ticket. Please have a look (as I am no expert on the insights of the implementation of number fields in SageMath).\n----\nNew commits:",
    "created_at": "2018-10-19T08:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369366",
    "user": "dkrenn"
}
```

I've made some changes that do what I expected from this ticket. Please have a look (as I am no expert on the insights of the implementation of number fields in SageMath).
----
New commits:



---

archive/issue_comments_369367.json:
```json
{
    "body": "While working on polyhedron over algebraic numbers, we struggled around something that might (or not) be related. But in anycase is something similar.\n\nvdelecroix might have good pointers about this.",
    "created_at": "2019-09-03T18:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369367",
    "user": "jipilab"
}
```

While working on polyhedron over algebraic numbers, we struggled around something that might (or not) be related. But in anycase is something similar.

vdelecroix might have good pointers about this.



---

archive/issue_comments_369368.json:
```json
{
    "body": "What you ask for is not a well defined operation! The answer could equally be `i` or `-i`. You should specify what you actually want.\n\nThe current (clean but tedious) way to do it is\n\n```\nsage: K = CyclotomicField(3).extension(x^2+1, 'i')\nsage: L = QQ.extension(x^2+1, 'i')\nsage: f = Hom(L, K)([K.gen()])\nsage: f\nRing morphism:\n  From: Number Field in i with defining polynomial x^2 + 1\n  To:   Number Field in i with defining polynomial x^2 + 1 over its base field\n  Defn: i |--> i\nsage: f(L.gen())\ni\n```\n",
    "created_at": "2019-09-03T19:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369368",
    "user": "vdelecroix"
}
```

What you ask for is not a well defined operation! The answer could equally be `i` or `-i`. You should specify what you actually want.

The current (clean but tedious) way to do it is

```
sage: K = CyclotomicField(3).extension(x^2+1, 'i')
sage: L = QQ.extension(x^2+1, 'i')
sage: f = Hom(L, K)([K.gen()])
sage: f
Ring morphism:
  From: Number Field in i with defining polynomial x^2 + 1
  To:   Number Field in i with defining polynomial x^2 + 1 over its base field
  Defn: i |--> i
sage: f(L.gen())
i
```




---

archive/issue_comments_369369.json:
```json
{
    "body": "This is even more true if you specify complex embedding for your number fields! The conversion that you implemented (\"the obvious algebraic one\") might not be the one the user expect...",
    "created_at": "2019-09-03T19:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369369",
    "user": "vdelecroix"
}
```

This is even more true if you specify complex embedding for your number fields! The conversion that you implemented ("the obvious algebraic one") might not be the one the user expect...



---

archive/issue_comments_369370.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-02-22T22:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369370",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_369371.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369371",
    "user": "mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_369372.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369372",
    "user": "mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_369373.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369373",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_369374.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26206#issuecomment-369374",
    "user": "mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
