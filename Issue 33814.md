# Issue 33814: Update FriCAS to 1.3.8

archive/issues_033814.json:
```json
{
    "body": "CC:  @fchapoton\n\nKeywords: FriCAS\n\nThis ticket is to upgrade to FriCAS 1.3.8 and track dependencies.\n\nTarball: see checksums.ini\n\nNote that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:\n\n- https://fricas.sourceforge.net\n- https://github.com/fricas/fricas/releases\n\nOur last update was to Fricas 1.3.7 in #32049.\n\nTo try this ticket from your Sage root directory, with `git-trac-command` installed:\n\n1. `git trac try `\n2. `SAGE_SPKG=\"sage-spkg -o\" ./sage -i fricas` (or use `./configure --enable-download-from-upstream-url` first)\n3. `./sage -t --optional=fricas,sage src/sage/interfaces/fricas.py`\n\nIssue created by migration from https://trac.sagemath.org/ticket/34051\n\n",
    "created_at": "2022-06-22T12:22:02Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Update FriCAS to 1.3.8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33814",
    "user": "https://github.com/mantepse"
}
```
CC:  @fchapoton

Keywords: FriCAS

This ticket is to upgrade to FriCAS 1.3.8 and track dependencies.

Tarball: see checksums.ini

Note that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:

- https://fricas.sourceforge.net
- https://github.com/fricas/fricas/releases

Our last update was to Fricas 1.3.7 in #32049.

To try this ticket from your Sage root directory, with `git-trac-command` installed:

1. `git trac try `
2. `SAGE_SPKG="sage-spkg -o" ./sage -i fricas` (or use `./configure --enable-download-from-upstream-url` first)
3. `./sage -t --optional=fricas,sage src/sage/interfaces/fricas.py`

Issue created by migration from https://trac.sagemath.org/ticket/34051





---

archive/issue_comments_479847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-24T19:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479848.json:
```json
{
    "body": "not completely sure whether package-version.txt shouldn't contain 1.3.8p1, but if I do, it tries to download fricas-1.3.8p1 from upstream, which obviously fails.",
    "created_at": "2022-06-24T19:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479848",
    "user": "https://github.com/mantepse"
}
```

not completely sure whether package-version.txt shouldn't contain 1.3.8p1, but if I do, it tries to download fricas-1.3.8p1 from upstream, which obviously fails.



---

archive/issue_comments_479849.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-24T19:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479849",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479850.json:
```json
{
    "body": "To indicate a patchlevel from patches added in Sage, you would use `1.3.8.p1` (note the extra dot)",
    "created_at": "2022-06-25T19:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479850",
    "user": "https://github.com/mkoeppe"
}
```

To indicate a patchlevel from patches added in Sage, you would use `1.3.8.p1` (note the extra dot)



---

archive/issue_comments_479851.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-26T07:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479852.json:
```json
{
    "body": "Please test!  I removed two patches, because it is unclear to me what they do and it works without them on my system (ubuntu 21.04), but I can imagine that they are needed on other systems.\n\nI did not touch `macos_list.patch`.\n\nI am slightly unsure whether it would be better to use a tolerance instead of an ellipsis here:\n\n```diff\n@@ -1563,7 +1563,7 @@ class FriCASElement(ExpectElement):\n             sage: psi(1.0)\n             -0.577215664901533\n             sage: fricas.polygamma(1, 1.0)                                      # optional - fricas\n-            1.6449340668482269\n+            1.644934066848226...\n             sage: psi(1, 1).n()\n             1.64493406684823\n```\n",
    "created_at": "2022-06-26T07:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479852",
    "user": "https://github.com/mantepse"
}
```

Please test!  I removed two patches, because it is unclear to me what they do and it works without them on my system (ubuntu 21.04), but I can imagine that they are needed on other systems.

I did not touch `macos_list.patch`.

I am slightly unsure whether it would be better to use a tolerance instead of an ellipsis here:

```diff
@@ -1563,7 +1563,7 @@ class FriCASElement(ExpectElement):
             sage: psi(1.0)
             -0.577215664901533
             sage: fricas.polygamma(1, 1.0)                                      # optional - fricas
-            1.6449340668482269
+            1.644934066848226...
             sage: psi(1, 1).n()
             1.64493406684823
```




---

archive/issue_comments_479853.json:
```json
{
    "body": "Fails on macOS:\nhttps://github.com/mkoeppe/sage/runs/7056483127?check_suite_focus=true\n\n```\nchecking host system type... x86_64-apple-darwin19.6.0\nchecking target system type... x86_64-apple-darwin19.6.0\nchecking for in-tree build on case insensitive file system... configure: error: in tree build on case insensitive file system is not supported. Use out-of-source-tree build instead.\n********************************************************************************\n```\n",
    "created_at": "2022-06-27T22:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479853",
    "user": "https://github.com/mkoeppe"
}
```

Fails on macOS:
https://github.com/mkoeppe/sage/runs/7056483127?check_suite_focus=true

```
checking host system type... x86_64-apple-darwin19.6.0
checking target system type... x86_64-apple-darwin19.6.0
checking for in-tree build on case insensitive file system... configure: error: in tree build on case insensitive file system is not supported. Use out-of-source-tree build instead.
********************************************************************************
```




---

archive/issue_comments_479854.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-27T22:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479854",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479855.json:
```json
{
    "body": "I don't know how to do that: I think we want to pass `enable_case_insensitive_file_system_check=no` to `configure`.",
    "created_at": "2022-06-28T07:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479855",
    "user": "https://github.com/mantepse"
}
```

I don't know how to do that: I think we want to pass `enable_case_insensitive_file_system_check=no` to `configure`.



---

archive/issue_comments_479856.json:
```json
{
    "body": "Could you try the following?\n\n```diff\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00f..5bd4f903148 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,6 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+sdh_configure --with-lisp=ecl --enable_case_insensitive_file_system_check=no\n sdh_make\n sdh_make_install -j1\n```\n",
    "created_at": "2022-06-28T07:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479856",
    "user": "https://github.com/mantepse"
}
```

Could you try the following?

```diff
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00f..5bd4f903148 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,6 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+sdh_configure --with-lisp=ecl --enable_case_insensitive_file_system_check=no
 sdh_make
 sdh_make_install -j1
```




---

archive/issue_comments_479857.json:
```json
{
    "body": "I first tried the out-of-source-tree build that was suggested by that error message:\n\n```\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00..bf9f559cc7 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,9 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+mkdir build\n+cd build\n+ln -s ../configure .\n+sdh_configure --srcdir=.. --with-lisp=ecl\n sdh_make\n sdh_make_install -j1\n```\n\n\nBut it appears to be broken:\n\n```\n[fricas-1.3.8.p1] FRICAS-LISP> \n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.\n[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0\n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341\n[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)\n[fricas-1.3.8.p1] ;;;   ! The variable S is not used.\n[fricas-1.3.8.p1] ;;; End of Pass 1.\n[fricas-1.3.8.p1] ;;; Internal error:\n[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing\n[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM \"clang\" (\"-I.\" \"-I/usr/local/Cellar/ecl/21.2.1_2/include/\" \"-I/usr/local/opt/gmp/include\" \"-I/usr/local/opt/libffi/include\" \"-I/usr/local/opt/bdw-gc/include\" \"-g\" \"-O2\" \"-fPIC\" \"-fno-common\" \"-D_THREAD_SAFE\" \"-Ddarwin\" \"-O2\" \"-c\" \"fricas-lisp.c\" \"-o\" \"fricas-lisp.o\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/\")):\n[fricas-1.3.8.p1] ;;; In file included from fricas-lisp.c:6:\n[fricas-1.3.8.p1] ;;; In file included from ./fricas-lisp.eclh:7:\n[fricas-1.3.8.p1] ;;; //Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/com.h:45:10: fatal error: 'fricas_c_macros.h' file not found\n[fricas-1.3.8.p1] ;;; #include \"fricas_c_macros.h\"\n[fricas-1.3.8.p1] ;;;          ^~~~~~~~~~~~~~~~~~~\n[fricas-1.3.8.p1] ;;; 1 error generated.\n[fricas-1.3.8.p1] NIL\n[fricas-1.3.8.p1] T\n[fricas-1.3.8.p1] T\n```\n",
    "created_at": "2022-06-28T18:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479857",
    "user": "https://github.com/mkoeppe"
}
```

I first tried the out-of-source-tree build that was suggested by that error message:

```
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00..bf9f559cc7 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,9 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+mkdir build
+cd build
+ln -s ../configure .
+sdh_configure --srcdir=.. --with-lisp=ecl
 sdh_make
 sdh_make_install -j1
```


But it appears to be broken:

```
[fricas-1.3.8.p1] FRICAS-LISP> 
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.
[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341
[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)
[fricas-1.3.8.p1] ;;;   ! The variable S is not used.
[fricas-1.3.8.p1] ;;; End of Pass 1.
[fricas-1.3.8.p1] ;;; Internal error:
[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing
[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM "clang" ("-I." "-I/usr/local/Cellar/ecl/21.2.1_2/include/" "-I/usr/local/opt/gmp/include" "-I/usr/local/opt/libffi/include" "-I/usr/local/opt/bdw-gc/include" "-g" "-O2" "-fPIC" "-fno-common" "-D_THREAD_SAFE" "-Ddarwin" "-O2" "-c" "fricas-lisp.c" "-o" "fricas-lisp.o" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/")):
[fricas-1.3.8.p1] ;;; In file included from fricas-lisp.c:6:
[fricas-1.3.8.p1] ;;; In file included from ./fricas-lisp.eclh:7:
[fricas-1.3.8.p1] ;;; //Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/com.h:45:10: fatal error: 'fricas_c_macros.h' file not found
[fricas-1.3.8.p1] ;;; #include "fricas_c_macros.h"
[fricas-1.3.8.p1] ;;;          ^~~~~~~~~~~~~~~~~~~
[fricas-1.3.8.p1] ;;; 1 error generated.
[fricas-1.3.8.p1] NIL
[fricas-1.3.8.p1] T
[fricas-1.3.8.p1] T
```




---

archive/issue_comments_479858.json:
```json
{
    "body": "But your fix (after a spelling fix) also does not work:\n\n```\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00..62a15704f1 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,6 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+sdh_configure --with-lisp=ecl --enable-case-insensitive-file-system-check=no\n sdh_make\n sdh_make_install -j1\n```\n\n\n```\n[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.\n[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0\n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341\n[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)\n[fricas-1.3.8.p1] ;;;   ! The variable S is not used.\n[fricas-1.3.8.p1] ;;; End of Pass 1.\n[fricas-1.3.8.p1] ;;; Internal error:\n[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing\n[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM \"clang\" (\"-I.\" \"-I/usr/local/Cellar/ecl/21.2.1_2/include/\" \"-I/usr/local/opt/gmp/include\" \"-I/usr/local/opt/libffi/include\" \"-I/usr/local/opt/bdw-gc/include\" \"-g\" \"-O2\" \"-fPIC\" \"-fno-common\" \"-D_THREAD_SAFE\" \"-Ddarwin\" \"-O2\" \"-c\" \"fricas-lisp.c\" \"-o\" \"fricas-lisp.o\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/\")):\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: error: implicit declaration of function 'remove_directory' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\n[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(remove_directory(ecl_base_string_pointer_safe(v2)));\n[fricas-1.3.8.p1] ;;;                         ^\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: note: did you mean 'L25_remove_directory_'?\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; ./fricas-lisp.eclh:38:18: note: 'L25_remove_directory_' declared here\n[fricas-1.3.8.p1] ;;; static cl_object L25_remove_directory_(cl_object );\n[fricas-1.3.8.p1] ;;;                  ^\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:921:25: error: implicit declaration of function 'makedir' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\n[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(makedir(ecl_base_string_pointer_safe(v2)));\n[fricas-1.3.8.p1] ;;;                         ^\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; 2 errors generated.\n[fricas-1.3.8.p1] NIL\n[fricas-1.3.8.p1] T\n[fricas-1.3.8.p1] T\n```\n",
    "created_at": "2022-06-28T18:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479858",
    "user": "https://github.com/mkoeppe"
}
```

But your fix (after a spelling fix) also does not work:

```
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00..62a15704f1 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,6 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+sdh_configure --with-lisp=ecl --enable-case-insensitive-file-system-check=no
 sdh_make
 sdh_make_install -j1
```


```
[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.
[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341
[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)
[fricas-1.3.8.p1] ;;;   ! The variable S is not used.
[fricas-1.3.8.p1] ;;; End of Pass 1.
[fricas-1.3.8.p1] ;;; Internal error:
[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing
[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM "clang" ("-I." "-I/usr/local/Cellar/ecl/21.2.1_2/include/" "-I/usr/local/opt/gmp/include" "-I/usr/local/opt/libffi/include" "-I/usr/local/opt/bdw-gc/include" "-g" "-O2" "-fPIC" "-fno-common" "-D_THREAD_SAFE" "-Ddarwin" "-O2" "-c" "fricas-lisp.c" "-o" "fricas-lisp.o" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/")):
[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: error: implicit declaration of function 'remove_directory' is invalid in C99 [-Werror,-Wimplicit-function-declaration]
[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(remove_directory(ecl_base_string_pointer_safe(v2)));
[fricas-1.3.8.p1] ;;;                         ^
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: note: did you mean 'L25_remove_directory_'?
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; ./fricas-lisp.eclh:38:18: note: 'L25_remove_directory_' declared here
[fricas-1.3.8.p1] ;;; static cl_object L25_remove_directory_(cl_object );
[fricas-1.3.8.p1] ;;;                  ^
[fricas-1.3.8.p1] ;;; fricas-lisp.c:921:25: error: implicit declaration of function 'makedir' is invalid in C99 [-Werror,-Wimplicit-function-declaration]
[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(makedir(ecl_base_string_pointer_safe(v2)));
[fricas-1.3.8.p1] ;;;                         ^
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; 2 errors generated.
[fricas-1.3.8.p1] NIL
[fricas-1.3.8.p1] T
[fricas-1.3.8.p1] T
```




---

archive/issue_comments_479859.json:
```json
{
    "body": "OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.\n\n```\ndiff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1\nindex af23933a..8e458c6c 100644\n--- a/src/include/cfuns-c.H1\n+++ b/src/include/cfuns-c.H1\n@@ -1,2 +1,4 @@\n extern int directoryp(char *);\n extern int writeablep(char *);\n+extern int remove_directory(char *);\n+extern int makedir(char *);\n```\n",
    "created_at": "2022-06-28T19:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479859",
    "user": "https://github.com/mantepse"
}
```

OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.

```
diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1
index af23933a..8e458c6c 100644
--- a/src/include/cfuns-c.H1
+++ b/src/include/cfuns-c.H1
@@ -1,2 +1,4 @@
 extern int directoryp(char *);
 extern int writeablep(char *);
+extern int remove_directory(char *);
+extern int makedir(char *);
```




---

archive/issue_comments_479860.json:
```json
{
    "body": "That out-of-source check in the makefile seems broken too:\nhttps://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true",
    "created_at": "2022-06-28T19:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479860",
    "user": "https://github.com/mkoeppe"
}
```

That out-of-source check in the makefile seems broken too:
https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true



---

archive/issue_comments_479861.json:
```json
{
    "body": "sorry, that's way over my head :-(",
    "created_at": "2022-06-28T19:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479861",
    "user": "https://github.com/mantepse"
}
```

sorry, that's way over my head :-(



---

archive/issue_comments_479862.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> That out-of-source check in the makefile seems broken too:\n> https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true\n\nI'm taking this back.",
    "created_at": "2022-06-28T19:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479862",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:15 mkoeppe]:
> That out-of-source check in the makefile seems broken too:
> https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true

I'm taking this back.



---

archive/issue_comments_479863.json:
```json
{
    "body": "Looks like FriCAS does not have sufficient CI coverage. I have prepared one at https://github.com/fricas/fricas/pull/102, please take a look",
    "created_at": "2022-06-28T19:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479863",
    "user": "https://github.com/mkoeppe"
}
```

Looks like FriCAS does not have sufficient CI coverage. I have prepared one at https://github.com/fricas/fricas/pull/102, please take a look



---

archive/issue_comments_479864.json:
```json
{
    "body": "I am not really a fricas developer, and I know nothing about CI :-(",
    "created_at": "2022-06-28T20:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479864",
    "user": "https://github.com/mantepse"
}
```

I am not really a fricas developer, and I know nothing about CI :-(



---

archive/issue_comments_479865.json:
```json
{
    "body": "Replying to [comment:14 mantepse]:\n> OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.\n> {{{\n> diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1\n> index af23933a..8e458c6c 100644\n> --- a/src/include/cfuns-c.H1\n> +++ b/src/include/cfuns-c.H1\n> `@``@` -1,2 +1,4 `@``@`\n>  extern int directoryp(char *);\n>  extern int writeablep(char *);\n> +extern int remove_directory(char *);\n> +extern int makedir(char *);\n> }}}\n\nHow about sending this as a PR to FriCAS\n----\nNew commits:",
    "created_at": "2022-06-29T06:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479865",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:14 mantepse]:
> OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.
> {{{
> diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1
> index af23933a..8e458c6c 100644
> --- a/src/include/cfuns-c.H1
> +++ b/src/include/cfuns-c.H1
> `@``@` -1,2 +1,4 `@``@`
>  extern int directoryp(char *);
>  extern int writeablep(char *);
> +extern int remove_directory(char *);
> +extern int makedir(char *);
> }}}

How about sending this as a PR to FriCAS
----
New commits:



---

archive/issue_comments_479866.json:
```json
{
    "body": "re comment:14: does it work?  I don't have access to a mac, so I cannot say.\n\nProvided it does: FriCAS 1.3.8 is released, and the content of `cfuns-c.H1` changed so much that the original patch did not even apply.  So, yes, we should mention it to the FriCAS people, but it doesn't make sense to wait for the next release.",
    "created_at": "2022-06-29T06:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479866",
    "user": "https://github.com/mantepse"
}
```

re comment:14: does it work?  I don't have access to a mac, so I cannot say.

Provided it does: FriCAS 1.3.8 is released, and the content of `cfuns-c.H1` changed so much that the original patch did not even apply.  So, yes, we should mention it to the FriCAS people, but it doesn't make sense to wait for the next release.



---

archive/issue_comments_479867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-29T15:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479868.json:
```json
{
    "body": "Yes, it works",
    "created_at": "2022-06-29T15:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479868",
    "user": "https://github.com/mkoeppe"
}
```

Yes, it works



---

archive/issue_comments_479869.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-29T15:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479869",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479870.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-29T15:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479870",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_479871.json:
```json
{
    "body": "Also `./sage -tp src/sage/interfaces/fricas.py src/sage/calculus src/sage/functions src/sage/symbolic`:\n\n```\nAll tests passed!\n```\n",
    "created_at": "2022-06-29T15:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479871",
    "user": "https://github.com/mkoeppe"
}
```

Also `./sage -tp src/sage/interfaces/fricas.py src/sage/calculus src/sage/functions src/sage/symbolic`:

```
All tests passed!
```




---

archive/issue_comments_479872.json:
```json
{
    "body": "Great! Thank you so much!\n\nIs there any other platform which should absolutely be tested?  If not so, please go ahead!",
    "created_at": "2022-06-29T15:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479872",
    "user": "https://github.com/mantepse"
}
```

Great! Thank you so much!

Is there any other platform which should absolutely be tested?  If not so, please go ahead!



---

archive/issue_comments_479873.json:
```json
{
    "body": "Take a look at the discussion in https://github.com/fricas/fricas/pull/102 - using the CI, it was discovered that fricas is broken on recent-ish Fedora when the Fedora-provided ECL is in use.\n\nThat's a regression in platform support. See https://github.com/sagemath/sage/runs/6443849430?check_suite_focus=true - where fricas built successfully in Sage 9.6 for one of the affected platforms.",
    "created_at": "2022-06-29T15:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479873",
    "user": "https://github.com/mkoeppe"
}
```

Take a look at the discussion in https://github.com/fricas/fricas/pull/102 - using the CI, it was discovered that fricas is broken on recent-ish Fedora when the Fedora-provided ECL is in use.

That's a regression in platform support. See https://github.com/sagemath/sage/runs/6443849430?check_suite_focus=true - where fricas built successfully in Sage 9.6 for one of the affected platforms.



---

archive/issue_comments_479874.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-09T22:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33814#issuecomment-479874",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_030478.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-07-09T22:33:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33814#event-30478"
}
```
