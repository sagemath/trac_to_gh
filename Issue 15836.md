# Issue 15836: Python 3 preparation: The semantic of map() function is changed

archive/issues_015836.json:
```json
{
    "body": "CC:  embray jdemeyer fbissey tscrim jhpalmieri vklein\n\nKeywords: python3\n\nIn Py2 `map()` returns a list, while in Py3 `map()` returns an iterator (as `itertools.imap()` does in Py2).\n\nThe tool 2to3 wraps `map()` usages with a call to `list()`.\n\n\nAn alternative approach is to add `from future_builtins import map` and to check the code.\n\nThere are 171 effected modules. \n\nThis ticket is tracked as a dependency of meta-ticket ticket:16052.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16073\n\n",
    "created_at": "2014-04-07T08:48:41Z",
    "labels": [
        "distribution",
        "major",
        "enhancement"
    ],
    "title": "Python 3 preparation: The semantic of map() function is changed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15836",
    "user": "wluebbe"
}
```
CC:  embray jdemeyer fbissey tscrim jhpalmieri vklein

Keywords: python3

In Py2 `map()` returns a list, while in Py3 `map()` returns an iterator (as `itertools.imap()` does in Py2).

The tool 2to3 wraps `map()` usages with a call to `list()`.


An alternative approach is to add `from future_builtins import map` and to check the code.

There are 171 effected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.

Issue created by migration from https://trac.sagemath.org/ticket/16073





---

archive/issue_comments_205479.json:
```json
{
    "body": "This first commit was generated by `2to3`. **It has failing doctests! ** These will be fixed with a separate commit.\n----\nNew commits:",
    "created_at": "2014-05-22T09:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205479",
    "user": "wluebbe"
}
```

This first commit was generated by `2to3`. **It has failing doctests! ** These will be fixed with a separate commit.
----
New commits:



---

archive/issue_comments_205480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-22T13:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205480",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205481.json:
```json
{
    "body": "The problem was that in one module the standard library function `list` had been overwritten. Now all doctests pass.",
    "created_at": "2014-05-22T13:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205481",
    "user": "wluebbe"
}
```

The problem was that in one module the standard library function `list` had been overwritten. Now all doctests pass.



---

archive/issue_comments_205482.json:
```json
{
    "body": "The code would now certainly benefit from changing expressions like `list(map(...))` into a list comprehension. \n\nThis is more pythonic, more readable (especially in the case `list(map(lambda ...))` ) and it avoids redundant list creation in Python 2. But it's a lot of stuff to check and change ...",
    "created_at": "2014-05-22T13:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205482",
    "user": "wluebbe"
}
```

The code would now certainly benefit from changing expressions like `list(map(...))` into a list comprehension. 

This is more pythonic, more readable (especially in the case `list(map(lambda ...))` ) and it avoids redundant list creation in Python 2. But it's a lot of stuff to check and change ...



---

archive/issue_comments_205483.json:
```json
{
    "body": "This patch will cause a lot of merge conflicts with #16067 `filter`. It seems advisable to wait until #16067 is merged and then regenerate this patch.\n\nSomebody to review #16067 ... ;-)",
    "created_at": "2014-05-22T13:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205483",
    "user": "wluebbe"
}
```

This patch will cause a lot of merge conflicts with #16067 `filter`. It seems advisable to wait until #16067 is merged and then regenerate this patch.

Somebody to review #16067 ... ;-)



---

archive/issue_comments_205484.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-22T13:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205484",
    "user": "wluebbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_205485.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-22T13:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205485",
    "user": "wluebbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205486.json:
```json
{
    "body": "Rebased.\n----\nNew commits:",
    "created_at": "2014-10-07T18:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205486",
    "user": "aapitzsch"
}
```

Rebased.
----
New commits:



---

archive/issue_comments_205487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-09T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205487",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205488.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-09T20:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205488",
    "user": "aapitzsch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205489.json:
```json
{
    "body": "The patch is red.\n\nEither way, shouldn't it be only wrapping some of the uses, rather than all of them?",
    "created_at": "2014-11-13T19:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205489",
    "user": "darij"
}
```

The patch is red.

Either way, shouldn't it be only wrapping some of the uses, rather than all of them?



---

archive/issue_comments_205490.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-13T20:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205490",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205491.json:
```json
{
    "body": "OK, but as I expected there are some questionable things here.\n\n```\n- r = sum ( map( lambda x: x[2], cycle ) )\n+ r = sum ( [x[2] for x in cycle] )\n```\n\nWouldn't keeping the old line be better? Summing an iterator should be faster than summing a list which has been constructed merely to be summed.",
    "created_at": "2014-11-13T20:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205491",
    "user": "darij"
}
```

OK, but as I expected there are some questionable things here.

```
- r = sum ( map( lambda x: x[2], cycle ) )
+ r = sum ( [x[2] for x in cycle] )
```

Wouldn't keeping the old line be better? Summing an iterator should be faster than summing a list which has been constructed merely to be summed.



---

archive/issue_comments_205492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-13T21:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205492",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205493.json:
```json
{
    "body": "Replying to [comment:15 darij]:\n> OK, but as I expected there are some questionable things here.\n> {{{\n> - r = sum ( map( lambda x: x[2], cycle ) )\n> + r = sum ( [x[2] for x in cycle] )\n> }}}\n> Wouldn't keeping the old line be better? Summing an iterator should be faster than summing a list which has been constructed merely to be summed.\n\nYou are right.\n\nIn this case we should write\n\n```\nr = sum ( (x[2] for x in cycle) )\n```\n\n\nFeel free to fix it (and others), currently I have no time to check the necessity of `list()` wrapping.",
    "created_at": "2014-11-13T21:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205493",
    "user": "aapitzsch"
}
```

Replying to [comment:15 darij]:
> OK, but as I expected there are some questionable things here.
> {{{
> - r = sum ( map( lambda x: x[2], cycle ) )
> + r = sum ( [x[2] for x in cycle] )
> }}}
> Wouldn't keeping the old line be better? Summing an iterator should be faster than summing a list which has been constructed merely to be summed.

You are right.

In this case we should write

```
r = sum ( (x[2] for x in cycle) )
```


Feel free to fix it (and others), currently I have no time to check the necessity of `list()` wrapping.



---

archive/issue_comments_205494.json:
```json
{
    "body": "\n```\n- return \"\".join(map(lambda x: self._character_to_code[x], string))\n+ return \"\".join([self._character_to_code[x] for x in string])\n```\n\nWondering if this is a good step forward, given that you can join an iterator to a string:\n\n```\n>>> map(lambda x: x+x, ['a','b','c'])\n<map object at 0x7fd747ddee10>\n>>> \"blah\".join(map(lambda x: x+x, ['a','b','c']))\n'aablahbbblahcc'\n```\n\n(Python 3).\n\n--------\n\n\n```\n- map(\n- lambda x: chr(ord(x) + 49),\n- list(str(num[0]))),\n+ [chr(ord(x) + 49) for x in list(str(num[0]))],\n```\n\nCan't we get rid of the `list`?\n\n--------\n\n\n```\n- a,b,c,d,e,f = map(G,R)\n+ a,b,c,d,e,f = list(map(G,R))\n```\n\nThis seems to not be necessary:\n\n```\n>>> a,b,c = iter([1,2,3])\n>>> a\n1\n>>> b\n2\n>>> c\n3\n```\n\n\n--------\n\nThis is unnecessary:\n\n```\n- if all(map(lambda s: s.is_final, state.label())):\n+ if all([s.is_final for s in state.label()]):\n```\n\nIf anything then `all` definitely works on iterators.\n\n--------\n\nHere is the thing that worries me the most: There are tools for automatic translation of python2 into 3. I am not sure if we should, or are going to, release them on the Sage library; but if we are, I would rather not do any manual work unless we can make sure that it will not interfere with the automated changes. I have a hunches that a well-written bot could do better than some of the changes in this patch (for instance, it should be a rule that `all(map(...))` can stay as it is rather than being replaced by `all(list(map(...)))`), thus leading to better speed, whereas with the changes already done it would not simplify them back to what they should be. This does not speak against edits such as replacing `list` variables by `list_` and likewise, which are the right thing to do either way. But I would be wary of making changes that possibly complicate the situation without knowing that it will become untangled when the time comes to actually switch to python 3.",
    "created_at": "2014-11-14T21:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205494",
    "user": "darij"
}
```


```
- return "".join(map(lambda x: self._character_to_code[x], string))
+ return "".join([self._character_to_code[x] for x in string])
```

Wondering if this is a good step forward, given that you can join an iterator to a string:

```
>>> map(lambda x: x+x, ['a','b','c'])
<map object at 0x7fd747ddee10>
>>> "blah".join(map(lambda x: x+x, ['a','b','c']))
'aablahbbblahcc'
```

(Python 3).

--------


```
- map(
- lambda x: chr(ord(x) + 49),
- list(str(num[0]))),
+ [chr(ord(x) + 49) for x in list(str(num[0]))],
```

Can't we get rid of the `list`?

--------


```
- a,b,c,d,e,f = map(G,R)
+ a,b,c,d,e,f = list(map(G,R))
```

This seems to not be necessary:

```
>>> a,b,c = iter([1,2,3])
>>> a
1
>>> b
2
>>> c
3
```


--------

This is unnecessary:

```
- if all(map(lambda s: s.is_final, state.label())):
+ if all([s.is_final for s in state.label()]):
```

If anything then `all` definitely works on iterators.

--------

Here is the thing that worries me the most: There are tools for automatic translation of python2 into 3. I am not sure if we should, or are going to, release them on the Sage library; but if we are, I would rather not do any manual work unless we can make sure that it will not interfere with the automated changes. I have a hunches that a well-written bot could do better than some of the changes in this patch (for instance, it should be a rule that `all(map(...))` can stay as it is rather than being replaced by `all(list(map(...)))`), thus leading to better speed, whereas with the changes already done it would not simplify them back to what they should be. This does not speak against edits such as replacing `list` variables by `list_` and likewise, which are the right thing to do either way. But I would be wary of making changes that possibly complicate the situation without knowing that it will become untangled when the time comes to actually switch to python 3.



---

archive/issue_comments_205495.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-15T21:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205495",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205496.json:
```json
{
    "body": "Darij thanks. I hopefully made all the changes you suggested.\n\nReplying to [comment:18 darij]:\n> Here is the thing that worries me the most: There are tools for automatic translation of python2 into 3. I am not sure if we should, or are going to, release them on the Sage library; but if we are, I would rather not do any manual work unless we can make sure that it will not interfere with the automated changes. I have a hunches that a well-written bot could do better than some of the changes in this patch (for instance, it should be a rule that `all(map(...))` can stay as it is rather than being replaced by `all(list(map(...)))`), thus leading to better speed, whereas with the changes already done it would not simplify them back to what they should be. This does not speak against edits such as replacing `list` variables by `list_` and likewise, which are the right thing to do either way. But I would be wary of making changes that possibly complicate the situation without knowing that it will become untangled when the time comes to actually switch to python 3.\n\nThese tools don't work well in all cases and usually one can disable special fixes. So manual work won't interfere with automated changes.\n\nThe target of these changes is to simplify the switch to python 3 without complicating the situation. :)",
    "created_at": "2014-11-15T21:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205496",
    "user": "aapitzsch"
}
```

Darij thanks. I hopefully made all the changes you suggested.

Replying to [comment:18 darij]:
> Here is the thing that worries me the most: There are tools for automatic translation of python2 into 3. I am not sure if we should, or are going to, release them on the Sage library; but if we are, I would rather not do any manual work unless we can make sure that it will not interfere with the automated changes. I have a hunches that a well-written bot could do better than some of the changes in this patch (for instance, it should be a rule that `all(map(...))` can stay as it is rather than being replaced by `all(list(map(...)))`), thus leading to better speed, whereas with the changes already done it would not simplify them back to what they should be. This does not speak against edits such as replacing `list` variables by `list_` and likewise, which are the right thing to do either way. But I would be wary of making changes that possibly complicate the situation without knowing that it will become untangled when the time comes to actually switch to python 3.

These tools don't work well in all cases and usually one can disable special fixes. So manual work won't interfere with automated changes.

The target of these changes is to simplify the switch to python 3 without complicating the situation. :)



---

archive/issue_comments_205497.json:
```json
{
    "body": "I got \n\n```\n1 item had failures:\n   3 of 211 in sage.tests.cmdline.test_executable\n    [210 tests, 3 failures, 29.22 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/tests/cmdline.py  # 3 doctests failed\n```\n\nwhile there were no failures with plain sage 6.4. I have not yet found the cause.",
    "created_at": "2014-11-16T13:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205497",
    "user": "wluebbe"
}
```

I got 

```
1 item had failures:
   3 of 211 in sage.tests.cmdline.test_executable
    [210 tests, 3 failures, 29.22 s]
----------------------------------------------------------------------
sage -t --long src/sage/tests/cmdline.py  # 3 doctests failed
```

while there were no failures with plain sage 6.4. I have not yet found the cause.



---

archive/issue_comments_205498.json:
```json
{
    "body": "Replying to [comment:21 wluebbe]:\n> I got \n> {{{\n> 1 item had failures:\n>    3 of 211 in sage.tests.cmdline.test_executable\n>     [210 tests, 3 failures, 29.22 s]\n> ----------------------------------------------------------------------\n> sage -t --long src/sage/tests/cmdline.py  # 3 doctests failed\n> }}}\n> while there were no failures with plain sage 6.4. I have not yet found the cause.\n\nI have no problems with `cmdline.py`. Results keep the same with and without merging `origin/develop` into `16073`.\n\n\n```\nsage -t --long src/sage/tests/cmdline.py\n    [210 tests, 32.88 s]\n----------------------------------------------------------------------\nAll tests passed!\n```\n",
    "created_at": "2014-11-16T16:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205498",
    "user": "aapitzsch"
}
```

Replying to [comment:21 wluebbe]:
> I got 
> {{{
> 1 item had failures:
>    3 of 211 in sage.tests.cmdline.test_executable
>     [210 tests, 3 failures, 29.22 s]
> ----------------------------------------------------------------------
> sage -t --long src/sage/tests/cmdline.py  # 3 doctests failed
> }}}
> while there were no failures with plain sage 6.4. I have not yet found the cause.

I have no problems with `cmdline.py`. Results keep the same with and without merging `origin/develop` into `16073`.


```
sage -t --long src/sage/tests/cmdline.py
    [210 tests, 32.88 s]
----------------------------------------------------------------------
All tests passed!
```




---

archive/issue_comments_205499.json:
```json
{
    "body": "Strange! And Volker just released sage-6.5.beta0 and auto-merge failed again ... :-(\n\nBy the way, back in June I was working to replace `map` with list comprehension or generator expressions (mostly). It was not quite complete when I took some time off.\n\nI want to give that approach a fresh start on sage-6.5.beta0. I will describe the reasoning tomorrow (or so ...).",
    "created_at": "2014-11-16T16:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205499",
    "user": "wluebbe"
}
```

Strange! And Volker just released sage-6.5.beta0 and auto-merge failed again ... :-(

By the way, back in June I was working to replace `map` with list comprehension or generator expressions (mostly). It was not quite complete when I took some time off.

I want to give that approach a fresh start on sage-6.5.beta0. I will describe the reasoning tomorrow (or so ...).



---

archive/issue_comments_205500.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-16T17:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205500",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205501.json:
```json
{
    "body": "I uploaded a new branch `u/wluebbe/ticket/16073-2`.\n\nMy goal is to replace all `map` calls with list comprehension or generator expressions. Currently there are still about 40 `list(map(...` in the code (somehow my regexp did not find them :-/ ) and a number of `map`s in the doctests. So there is still some work to do.\n\nThe drawback of wrapping `map` with `list` is that in Python2 this is redundant.\nIf a context accepts iterators then in Python2 `map` cannot exploit this (as it returns a list). Remapping `map` in Python2 on its iterator version `itertools.imap` requires extra code.\n\nThe current branch does change list comprehensions to generator expressions in all possible cases. I would rather leave this refactoring to a new ticket since there are lots of applicable cases separate from 16073.\n\nI am very much interested in feedback to `u/wluebbe/ticket/16073-2`.",
    "created_at": "2014-11-18T16:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205501",
    "user": "wluebbe"
}
```

I uploaded a new branch `u/wluebbe/ticket/16073-2`.

My goal is to replace all `map` calls with list comprehension or generator expressions. Currently there are still about 40 `list(map(...` in the code (somehow my regexp did not find them :-/ ) and a number of `map`s in the doctests. So there is still some work to do.

The drawback of wrapping `map` with `list` is that in Python2 this is redundant.
If a context accepts iterators then in Python2 `map` cannot exploit this (as it returns a list). Remapping `map` in Python2 on its iterator version `itertools.imap` requires extra code.

The current branch does change list comprehensions to generator expressions in all possible cases. I would rather leave this refactoring to a new ticket since there are lots of applicable cases separate from 16073.

I am very much interested in feedback to `u/wluebbe/ticket/16073-2`.



---

archive/issue_comments_205502.json:
```json
{
    "body": "wluebbe: sorry for the stupid question, but what is the precise difference between the two branches? I cannot tell it from the post.",
    "created_at": "2014-11-18T16:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205502",
    "user": "darij"
}
```

wluebbe: sorry for the stupid question, but what is the precise difference between the two branches? I cannot tell it from the post.



---

archive/issue_comments_205503.json:
```json
{
    "body": "The 2 branches (the current `public/16073` and `u/wluebbe/ticket/16073-2`) are alternative approaches. \nI did not want to be so impolite and just swap the branches :-)\nAnd I did not think it is appropriate to open a separate ticket.",
    "created_at": "2014-11-18T16:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205503",
    "user": "wluebbe"
}
```

The 2 branches (the current `public/16073` and `u/wluebbe/ticket/16073-2`) are alternative approaches. 
I did not want to be so impolite and just swap the branches :-)
And I did not think it is appropriate to open a separate ticket.



---

archive/issue_comments_205504.json:
```json
{
    "body": "I have added your branch to #15379 (an accidental duplicate ticket I made a year ago) to be able to see it on the trac viewer.\n\nI have to say I have no idea which of your two branches is the better one :/",
    "created_at": "2014-11-19T06:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205504",
    "user": "darij"
}
```

I have added your branch to #15379 (an accidental duplicate ticket I made a year ago) to be able to see it on the trac viewer.

I have to say I have no idea which of your two branches is the better one :/



---

archive/issue_comments_205505.json:
```json
{
    "body": "My branch gets rid of (mostly) all `map(...)` and `list(map(...))` calls replacing them with list comprehension or generator expressions.\nThere are currently a few (about 40) `list(map(...))` calls left over (as e.g. in  `src/sage/graphs/bipartite_graph.py` lines 643ff).",
    "created_at": "2014-11-19T08:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205505",
    "user": "wluebbe"
}
```

My branch gets rid of (mostly) all `map(...)` and `list(map(...))` calls replacing them with list comprehension or generator expressions.
There are currently a few (about 40) `list(map(...))` calls left over (as e.g. in  `src/sage/graphs/bipartite_graph.py` lines 643ff).



---

archive/issue_comments_205506.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-02T21:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205506",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205507.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-05T19:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205507",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205508.json:
```json
{
    "body": "does not apply",
    "created_at": "2015-05-05T19:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205508",
    "user": "chapoton"
}
```

does not apply



---

archive/issue_comments_205509.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-06T18:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205509",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205510.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-06T18:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205510",
    "user": "aapitzsch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205511.json:
```json
{
    "body": "I find `[func(_) for _ in L]` more readable than `list(map(func, L))`.",
    "created_at": "2015-05-06T19:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205511",
    "user": "jdemeyer"
}
```

I find `[func(_) for _ in L]` more readable than `list(map(func, L))`.



---

archive/issue_comments_205512.json:
```json
{
    "body": "Replying to [comment:34 jdemeyer]:\n> I find `[func(_) for _ in L]` more readable than `list(map(func, L))`.\n\nI will change it.",
    "created_at": "2015-05-06T20:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205512",
    "user": "aapitzsch"
}
```

Replying to [comment:34 jdemeyer]:
> I find `[func(_) for _ in L]` more readable than `list(map(func, L))`.

I will change it.



---

archive/issue_comments_205513.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-06T20:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205513",
    "user": "aapitzsch"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205514.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-08T09:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205514",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205515.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-08T09:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205515",
    "user": "aapitzsch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205516.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-08T10:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205516",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205517.json:
```json
{
    "body": "I'm sorry but this is much too boring to review.",
    "created_at": "2015-05-12T08:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205517",
    "user": "jdemeyer"
}
```

I'm sorry but this is much too boring to review.



---

archive/issue_comments_205518.json:
```json
{
    "body": "Are the changes scripted? If so, can you just tell me which script you used to generate them, then I'll review the script instead.",
    "created_at": "2015-05-12T08:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205518",
    "user": "jdemeyer"
}
```

Are the changes scripted? If so, can you just tell me which script you used to generate them, then I'll review the script instead.



---

archive/issue_comments_205519.json:
```json
{
    "body": "Replying to [comment:40 jdemeyer]:\n> Are the changes scripted? If so, can you just tell me which script you used to generate them, then I'll review the script instead.\n\nThere is no script. But if necessary we can split this ticket.",
    "created_at": "2015-05-12T16:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205519",
    "user": "aapitzsch"
}
```

Replying to [comment:40 jdemeyer]:
> Are the changes scripted? If so, can you just tell me which script you used to generate them, then I'll review the script instead.

There is no script. But if necessary we can split this ticket.



---

archive/issue_comments_205520.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-14T08:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205520",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205521.json:
```json
{
    "body": "Replying to [comment:41 aapitzsch]:\n> There is no script.\nThat actually worries me. If one has to manually review each individual change, that is *a lot* of changes to review and a lot of potential for mistakes also.",
    "created_at": "2015-05-21T10:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205521",
    "user": "jdemeyer"
}
```

Replying to [comment:41 aapitzsch]:
> There is no script.
That actually worries me. If one has to manually review each individual change, that is *a lot* of changes to review and a lot of potential for mistakes also.



---

archive/issue_comments_205522.json:
```json
{
    "body": "I still can split this ticket. Would it be sufficient to move the changes in `src/sage/combinat/` to a new ticket?",
    "created_at": "2015-05-22T12:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205522",
    "user": "aapitzsch"
}
```

I still can split this ticket. Would it be sufficient to move the changes in `src/sage/combinat/` to a new ticket?



---

archive/issue_comments_205523.json:
```json
{
    "body": "Well, my preferred solution would be if the majority of the changes would be scripted.\n\nSplitting would help also but maybe 2 pieces are not enough.",
    "created_at": "2015-05-22T15:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205523",
    "user": "jdemeyer"
}
```

Well, my preferred solution would be if the majority of the changes would be scripted.

Splitting would help also but maybe 2 pieces are not enough.



---

archive/issue_comments_205524.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-22T16:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205524",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205525.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-22T16:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205525",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205526.json:
```json
{
    "body": "I added three additional tickets (#18472, #18473, #18474).",
    "created_at": "2015-05-22T16:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205526",
    "user": "aapitzsch"
}
```

I added three additional tickets (#18472, #18473, #18474).



---

archive/issue_comments_205527.json:
```json
{
    "body": "Can this now be set to closed?",
    "created_at": "2015-05-27T22:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205527",
    "user": "darij"
}
```

Can this now be set to closed?



---

archive/issue_comments_205528.json:
```json
{
    "body": "No, unfortunately there are still a significant number of `map`s in the code base.\n\n`@`Andr\u00e9: Can you please move the branch `public/16073` from this ticket into a new, separate ticket. Then I will review the change. - Reason: I will create one (maybe two) extra tickets/changes (this is now #18531) for the leftover `map`s that I found during the review of #18473 and #18474. And I would prefer that this tickets only refers to the tickets containing the changes.",
    "created_at": "2015-05-28T06:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205528",
    "user": "wluebbe"
}
```

No, unfortunately there are still a significant number of `map`s in the code base.

`@`André: Can you please move the branch `public/16073` from this ticket into a new, separate ticket. Then I will review the change. - Reason: I will create one (maybe two) extra tickets/changes (this is now #18531) for the leftover `map`s that I found during the review of #18473 and #18474. And I would prefer that this tickets only refers to the tickets containing the changes.



---

archive/issue_comments_205529.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-28T06:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205529",
    "user": "wluebbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205530.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-28T06:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205530",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_205531.json:
```json
{
    "body": "There are still a lot of `map()` call in the code. \n\nBut //not all// occurrences must be  removed: there are a number of places where a Py3 `map()`-iterator leads to the same result as the Py2 `map()`.\n\nHere is a long (but incomplete) list:\n\n```\nall(here_is_an_iterable_allowed)\nany(here_is_an_iterable_allowed)\nbytearray(here_is_an_iterable_allowed)\ndict(here_is_an_iterable_of_key_value_pairs_allowed)\nfilter(function, here_is_an_iterable_allowed)\nfrozenset(here_is_an_iterable_allowed)\nlist(here_is_an_iterable_allowed)\nmap(function, here_is_an_iterable_allowed)\nmax(here_is_an_iterable_allowed)\nmin(here_is_an_iterable_allowed)\nreduce(function, here_is_an_iterable_allowed)\nset(here_is_an_iterable_allowed)\nsorted(here_is_an_iterable_allowed)\nsum(here_is_an_iterable_allowed)\ntuple(here_is_an_iterable_allowed)\nzip(here_is_an_iterable_allowed)\n\n''.join(here_is_an_iterable_allowed)\na,b,c* = here_is_an_iterable_allowed\nx[i:j] = here_is_an_iterable_allowed\na_dict.update(here_is_an_iterable_of_key_value_pairs_allowed)\nfile.writelines(here_is_an_iterable_allowed)\nmath.fsum(here_is_an_iterable_allowed)\n\nand MANY functions in module itertools.\n\nfor i in here_is_an_iterable_allowed:\n    pass\n[2*x for x in here_is_an_iterable_allowed]\n(2*x for x in here_is_an_iterable_allowed)\n```\n\n\nBut if the use of `map` includes a `lambda` then replacing it with a list comprehension improves the readability!",
    "created_at": "2015-05-28T12:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205531",
    "user": "wluebbe"
}
```

There are still a lot of `map()` call in the code. 

But //not all// occurrences must be  removed: there are a number of places where a Py3 `map()`-iterator leads to the same result as the Py2 `map()`.

Here is a long (but incomplete) list:

```
all(here_is_an_iterable_allowed)
any(here_is_an_iterable_allowed)
bytearray(here_is_an_iterable_allowed)
dict(here_is_an_iterable_of_key_value_pairs_allowed)
filter(function, here_is_an_iterable_allowed)
frozenset(here_is_an_iterable_allowed)
list(here_is_an_iterable_allowed)
map(function, here_is_an_iterable_allowed)
max(here_is_an_iterable_allowed)
min(here_is_an_iterable_allowed)
reduce(function, here_is_an_iterable_allowed)
set(here_is_an_iterable_allowed)
sorted(here_is_an_iterable_allowed)
sum(here_is_an_iterable_allowed)
tuple(here_is_an_iterable_allowed)
zip(here_is_an_iterable_allowed)

''.join(here_is_an_iterable_allowed)
a,b,c* = here_is_an_iterable_allowed
x[i:j] = here_is_an_iterable_allowed
a_dict.update(here_is_an_iterable_of_key_value_pairs_allowed)
file.writelines(here_is_an_iterable_allowed)
math.fsum(here_is_an_iterable_allowed)

and MANY functions in module itertools.

for i in here_is_an_iterable_allowed:
    pass
[2*x for x in here_is_an_iterable_allowed]
(2*x for x in here_is_an_iterable_allowed)
```


But if the use of `map` includes a `lambda` then replacing it with a list comprehension improves the readability!



---

archive/issue_comments_205532.json:
```json
{
    "body": "Changing component from distribution to python3.",
    "created_at": "2016-04-28T06:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205532",
    "user": "chapoton"
}
```

Changing component from distribution to python3.



---

archive/issue_comments_205533.json:
```json
{
    "body": "see #22121 and #22127 for steps in this direction",
    "created_at": "2017-01-03T09:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205533",
    "user": "chapoton"
}
```

see #22121 and #22127 for steps in this direction



---

archive/issue_comments_205534.json:
```json
{
    "body": "another step in #23084",
    "created_at": "2017-05-26T09:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205534",
    "user": "chapoton"
}
```

another step in #23084



---

archive/issue_comments_205535.json:
```json
{
    "body": "another step in #23130",
    "created_at": "2017-06-02T19:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205535",
    "user": "chapoton"
}
```

another step in #23130



---

archive/issue_comments_205536.json:
```json
{
    "body": "next #24382",
    "created_at": "2017-12-15T14:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205536",
    "user": "chapoton"
}
```

next #24382



---

archive/issue_comments_205537.json:
```json
{
    "body": "next in #24572",
    "created_at": "2018-01-19T16:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205537",
    "user": "chapoton"
}
```

next in #24572



---

archive/issue_comments_205538.json:
```json
{
    "body": "Some more in #25231",
    "created_at": "2018-04-23T14:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205538",
    "user": "embray"
}
```

Some more in #25231



---

archive/issue_comments_205539.json:
```json
{
    "body": "Some more in #25418",
    "created_at": "2018-05-21T18:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205539",
    "user": "embray"
}
```

Some more in #25418



---

archive/issue_comments_205540.json:
```json
{
    "body": "Some more in #25925",
    "created_at": "2018-07-25T13:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205540",
    "user": "vklein"
}
```

Some more in #25925



---

archive/issue_comments_205541.json:
```json
{
    "body": "Probably one coud close this one too ? Agreed ?",
    "created_at": "2019-06-04T09:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205541",
    "user": "chapoton"
}
```

Probably one coud close this one too ? Agreed ?



---

archive/issue_comments_205542.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-04T14:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205542",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205543.json:
```json
{
    "body": "Sure.",
    "created_at": "2019-06-04T14:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205543",
    "user": "vklein"
}
```

Sure.



---

archive/issue_comments_205544.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-04T14:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205544",
    "user": "vklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_205545.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-04T15:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15836#issuecomment-205545",
    "user": "chapoton"
}
```

Resolution: fixed
