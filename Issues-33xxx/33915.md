# Issue 33915: inseparable elliptic-curve isogenies

archive/issues_033678.json:
```json
{
    "body": "CC:  @defeo @JohnCremona @categorie @tscrim @videlec @fchapoton @kwankyu\n\nWe implement an `EllipticCurveHom` child class `EllipticCurveHom_frobenius` encapsulating purely inseparable *Frobenius isogenies*. As every isogeny decomposes into a separable and a purely inseparable part, we can (together with `EllipticCurveHom_composite`) now express any isogeny between two elliptic curves in Sage.\n\nOne immediate application (also implemented in the patch) is that separable isogenies of degree divisible by the characteristic now have a working `.dual()` method. Other than that, changes to the existing codebase are kept minimal.\n\nThis is one of the items on the \"isogeny wish-list\" #7368. It is also an important step towards implementing endomorphism rings later; cf. comment:3:ticket:32826.\n\nDiff without the dependency: https://git.sagemath.org/sage.git/diff?id2=79ae46846467aba747b2a94377dbd2524a6c1460&id=e953939d23995c0c26964dc969fa69cea52ee1c4\n\nIssue created by migration from https://trac.sagemath.org/ticket/33915\n\n",
    "created_at": "2022-05-27T17:14:07Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "inseparable elliptic-curve isogenies",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33915",
    "user": "https://github.com/yyyyx4"
}
```
CC:  @defeo @JohnCremona @categorie @tscrim @videlec @fchapoton @kwankyu

We implement an `EllipticCurveHom` child class `EllipticCurveHom_frobenius` encapsulating purely inseparable *Frobenius isogenies*. As every isogeny decomposes into a separable and a purely inseparable part, we can (together with `EllipticCurveHom_composite`) now express any isogeny between two elliptic curves in Sage.

One immediate application (also implemented in the patch) is that separable isogenies of degree divisible by the characteristic now have a working `.dual()` method. Other than that, changes to the existing codebase are kept minimal.

This is one of the items on the "isogeny wish-list" #7368. It is also an important step towards implementing endomorphism rings later; cf. comment:3:ticket:32826.

Diff without the dependency: https://git.sagemath.org/sage.git/diff?id2=79ae46846467aba747b2a94377dbd2524a6c1460&id=e953939d23995c0c26964dc969fa69cea52ee1c4

Issue created by migration from https://trac.sagemath.org/ticket/33915





---

archive/issue_comments_478694.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-27T17:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478695.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-27T17:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478695",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-31T14:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478697.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-24T06:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478697",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-26T14:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-17T22:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_088922.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33915#event-88922"
}
```



---

archive/issue_comments_478700.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T10:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-17T16:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-17T21:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-08T14:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-30T08:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-21T08:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-22T05:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478707.json:
```json
{
    "body": "Similar remarks as comment:24:ticket:32826 apply here. Hoping someone can spare a few minutes for a review.",
    "created_at": "2022-12-22T06:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478707",
    "user": "https://github.com/yyyyx4"
}
```

Similar remarks as comment:24:ticket:32826 apply here. Hoping someone can spare a few minutes for a review.



---

archive/issue_comments_478708.json:
```json
{
    "body": "Replying to [comment:20 Lorenz Panny]:\n> Similar remarks as comment:24:ticket:32826 apply here. Hoping someone can spare a few minutes for a review.\n\nI'm on it",
    "created_at": "2022-12-22T09:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478708",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:20 Lorenz Panny]:
> Similar remarks as comment:24:ticket:32826 apply here. Hoping someone can spare a few minutes for a review.

I'm on it



---

archive/issue_comments_478709.json:
```json
{
    "body": "(I have been looking at the diffs excluding the dependency now that #32826 has positive review :))\n\n1. In `find_post_isomorphism()` the 'else' on the line after the break looks wrong, is this a syntax error?  Apologies if my python is inadequate.\n\n2. (apologies) As in #32826 `scaling_factor()` returns an integer (0 or 1 here), and should more properly be coerced into the base field.\n\n3. Good to have the method `frobenius_isogeny()` added to the generic elliptic curve class.  Should we also have a mthod `frobenius_endomorphism()` or just `frobenius()` as a special case too?  Either for generic elliptic curves (with an error if the base field is not finite), or only when the base field is finite?",
    "created_at": "2022-12-22T10:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478709",
    "user": "https://github.com/JohnCremona"
}
```

(I have been looking at the diffs excluding the dependency now that #32826 has positive review :))

1. In `find_post_isomorphism()` the 'else' on the line after the break looks wrong, is this a syntax error?  Apologies if my python is inadequate.

2. (apologies) As in #32826 `scaling_factor()` returns an integer (0 or 1 here), and should more properly be coerced into the base field.

3. Good to have the method `frobenius_isogeny()` added to the generic elliptic curve class.  Should we also have a mthod `frobenius_endomorphism()` or just `frobenius()` as a special case too?  Either for generic elliptic curves (with an error if the base field is not finite), or only when the base field is finite?



---

archive/issue_comments_478710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-22T10:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478711.json:
```json
{
    "body": "Replying to [comment:22 John Cremona]:\n>    1. In `find_post_isomorphism()` the 'else' on the line after the break looks wrong, is this a syntax error?  Apologies if my python is inadequate.\n\n\nThis is indeed a less well-known Pythonism: `else` after `for` means \"if we did not `break` out of the loop\". It can often be used in situations where you'd have to use a flag boolean (\"`found`\", \"`done`\") in other languages.\n\n>    3. Good to have the method `frobenius_isogeny()` added to the generic elliptic curve class.  Should we also have a mthod `frobenius_endomorphism()` or just `frobenius()` as a special case too?  Either for generic elliptic curves (with an error if the base field is not finite), or only when the base field is finite?\n\n\nDone, for curves over finite fields. Good idea! (`.frobenius()` already exists, by the way, and returns a quadratic integer.)",
    "created_at": "2022-12-22T11:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478711",
    "user": "https://github.com/yyyyx4"
}
```

Replying to [comment:22 John Cremona]:
>    1. In `find_post_isomorphism()` the 'else' on the line after the break looks wrong, is this a syntax error?  Apologies if my python is inadequate.


This is indeed a less well-known Pythonism: `else` after `for` means "if we did not `break` out of the loop". It can often be used in situations where you'd have to use a flag boolean ("`found`", "`done`") in other languages.

>    3. Good to have the method `frobenius_isogeny()` added to the generic elliptic curve class.  Should we also have a mthod `frobenius_endomorphism()` or just `frobenius()` as a special case too?  Either for generic elliptic curves (with an error if the base field is not finite), or only when the base field is finite?


Done, for curves over finite fields. Good idea! (`.frobenius()` already exists, by the way, and returns a quadratic integer.)



---

archive/issue_comments_478712.json:
```json
{
    "body": "Thanks for explaining that Pythonism to me!  Ah, the hidden benefits of reviewing trac tickets...   I'm sure my own python code is littered with things I don't need, as is my C++ code.\n\nJust looking over the latest changes...",
    "created_at": "2022-12-22T11:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478712",
    "user": "https://github.com/JohnCremona"
}
```

Thanks for explaining that Pythonism to me!  Ah, the hidden benefits of reviewing trac tickets...   I'm sure my own python code is littered with things I don't need, as is my C++ code.

Just looking over the latest changes...



---

archive/issue_comments_478713.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-22T11:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478713",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478714.json:
```json
{
    "body": "All good!\n\nI think it was me (years ago) who wrote the existing `frobenius()` method.  We'll have to work out at some point exactly when an endomorphism is an actual map from the curve to itself, and when it is an element of the abstract endomorphism ring.  But that's for another day.",
    "created_at": "2022-12-22T11:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478714",
    "user": "https://github.com/JohnCremona"
}
```

All good!

I think it was me (years ago) who wrote the existing `frobenius()` method.  We'll have to work out at some point exactly when an endomorphism is an actual map from the curve to itself, and when it is an element of the abstract endomorphism ring.  But that's for another day.



---

archive/issue_comments_478715.json:
```json
{
    "body": "Great, thanks so much for your time!",
    "created_at": "2022-12-22T12:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478715",
    "user": "https://github.com/yyyyx4"
}
```

Great, thanks so much for your time!



---

archive/issue_comments_478716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-12-23T09:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_478717.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-12-23T09:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_478718.json:
```json
{
    "body": "Setting back to positive review after a tiny doctest correction.",
    "created_at": "2022-12-23T09:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478718",
    "user": "https://github.com/yyyyx4"
}
```

Setting back to positive review after a tiny doctest correction.



---

archive/issue_comments_478719.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-23T09:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33915#issuecomment-478719",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_review to positive_review.
