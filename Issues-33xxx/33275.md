# Issue 33275: Bug fixes for finitely presented graded modules (#32505)

archive/issues_033038.json:
```json
{
    "assignees": [],
    "body": "Some bug fixes for the ticket #32505.\n\nDepends on #32505\n\n**CC:**  @sverre320 kvanwoerden @tscrim @rrbruner @cnassau @louisng114\n\n**Branch/Commit:** [29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** John Palmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/33275\n\n",
    "closed_at": "2022-02-16T23:57:12Z",
    "created_at": "2022-02-02T17:53:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bug fixes for finitely presented graded modules (#32505)",
    "type": "issue",
    "updated_at": "2022-02-16T23:57:12Z",
    "url": "https://github.com/sagemath/sage/issues/33275",
    "user": "https://github.com/jhpalmieri"
}
```
Some bug fixes for the ticket #32505.

Depends on #32505

**CC:**  @sverre320 kvanwoerden @tscrim @rrbruner @cnassau @louisng114

**Branch/Commit:** [29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)

**Reviewer:** Travis Scrimshaw

**Author:** John Palmieri

Issue created by migration from https://trac.sagemath.org/ticket/33275





---

archive/issue_events_403291.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-02T17:53:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403291"
}
```



---

archive/issue_events_403292.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-02T17:53:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "08517b",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403292"
}
```



---

archive/issue_events_403293.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-02T17:53:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403293"
}
```



---

archive/issue_comments_540496.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/fp-module-bugs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/fp-module-bugs)",
    "created_at": "2022-02-02T17:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540496",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/fp-module-bugs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/fp-module-bugs)



---

archive/issue_comments_540497.json:
```json
{
    "body": "**Commit:** [e3d4234f617ffb7757a3a66a797cbf05afb84604](https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604)",
    "created_at": "2022-02-02T17:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540497",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [e3d4234f617ffb7757a3a66a797cbf05afb84604](https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604)



---

archive/issue_comments_540498.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nAnother item that I think needs to be fixed: in the `resolution` method:\n\n```\n            sage: E.<x,y> = ExteriorAlgebra(QQ)\n            sage: triv = FPModule(E, [0], [[x], [y]]) # trivial module\n            sage: triv.resolution(3)\n            [Free module morphism:\n               From: Free graded left module on 1 generator over The exterior algebra of rank 2 over Rational Field\n               To:   Finitely presented left module on 1 generator and 2 relations over The exterior algebra of rank 2 over Rational Field\n               Defn: g[0] |--> g[0],\n             Free module morphism:\n               From: Free graded left module on 2 generators over The exterior algebra of rank 2 over Rational Field\n               To:   Free graded left module on 1 generator over The exterior algebra of rank 2 over Rational Field\n               Defn: g[1, 0] |--> x*g[0]\n                     g[1, 1] |--> y*g[0],\n```\nThe first map here is not a \"Free module morphism\" because its codomain is not free.\n\n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72e455ea30c98e5c5408bf8fa646ea28b430a2da\">72e455e</a></td><td><code>We do not require the base algebra's base ring to be a field.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11b37258a9c3fa8989f0e7c42bd839b643014a2a\">11b3725</a></td><td><code>trac 32505: allow the resolution to be made up of maps between</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcce24d7af5efefe94048db407bde108da78dfee\">fcce24d</a></td><td><code>Merge branch 'public/modules/free_graded_modules-32505' of git://trac.sagemath.org/sage into public/modules/free_graded_modules-32505</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e0518f314df9371277710745ae5b8b8ffb07553\">2e0518f</a></td><td><code>Using free modules where possible and improved compatibility.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c1ab8dc9a5f2a932297bf5256dab88dbb5f27e1\">6c1ab8d</a></td><td><code>trac 32505: more fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6cf6d146d5f19a35035d3c270cc2968ec6fcc8b4\">6cf6d14</a></td><td><code>Merge branch 'public/modules/free_graded_modules-32505' of git://trac.sagemath.org/sage into public/modules/free_graded_modules-32505</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50744642c4c07b3987729988501d7347b5286b9d\">5074464</a></td><td><code>Some last fixes and removing redundancy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffe7179490704efe9157a6796cdbf2ae68f27c46\">ffe7179</a></td><td><code>trac 32505: replace \"PlusInfinity()\" with \"infinity\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1a9467e95cd05a6439b4b2765e62c6aad6dc960\">a1a9467</a></td><td><code>trac 32505: remove redundant \"zero\" and \"identity\" methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604\">e3d4234</a></td><td><code>trac 33275: bug fixes for finitely presented graded modules.</code></td></tr></table>\n",
    "created_at": "2022-02-02T17:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540498",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'>**Comment 2:**</a>
Another item that I think needs to be fixed: in the `resolution` method:

```
            sage: E.<x,y> = ExteriorAlgebra(QQ)
            sage: triv = FPModule(E, [0], [[x], [y]]) # trivial module
            sage: triv.resolution(3)
            [Free module morphism:
               From: Free graded left module on 1 generator over The exterior algebra of rank 2 over Rational Field
               To:   Finitely presented left module on 1 generator and 2 relations over The exterior algebra of rank 2 over Rational Field
               Defn: g[0] |--> g[0],
             Free module morphism:
               From: Free graded left module on 2 generators over The exterior algebra of rank 2 over Rational Field
               To:   Free graded left module on 1 generator over The exterior algebra of rank 2 over Rational Field
               Defn: g[1, 0] |--> x*g[0]
                     g[1, 1] |--> y*g[0],
```
The first map here is not a "Free module morphism" because its codomain is not free.

---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72e455ea30c98e5c5408bf8fa646ea28b430a2da">72e455e</a></td><td><code>We do not require the base algebra's base ring to be a field.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11b37258a9c3fa8989f0e7c42bd839b643014a2a">11b3725</a></td><td><code>trac 32505: allow the resolution to be made up of maps between</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcce24d7af5efefe94048db407bde108da78dfee">fcce24d</a></td><td><code>Merge branch 'public/modules/free_graded_modules-32505' of git://trac.sagemath.org/sage into public/modules/free_graded_modules-32505</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e0518f314df9371277710745ae5b8b8ffb07553">2e0518f</a></td><td><code>Using free modules where possible and improved compatibility.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c1ab8dc9a5f2a932297bf5256dab88dbb5f27e1">6c1ab8d</a></td><td><code>trac 32505: more fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6cf6d146d5f19a35035d3c270cc2968ec6fcc8b4">6cf6d14</a></td><td><code>Merge branch 'public/modules/free_graded_modules-32505' of git://trac.sagemath.org/sage into public/modules/free_graded_modules-32505</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50744642c4c07b3987729988501d7347b5286b9d">5074464</a></td><td><code>Some last fixes and removing redundancy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffe7179490704efe9157a6796cdbf2ae68f27c46">ffe7179</a></td><td><code>trac 32505: replace "PlusInfinity()" with "infinity"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1a9467e95cd05a6439b4b2765e62c6aad6dc960">a1a9467</a></td><td><code>trac 32505: remove redundant "zero" and "identity" methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604">e3d4234</a></td><td><code>trac 33275: bug fixes for finitely presented graded modules.</code></td></tr></table>




---

archive/issue_comments_540499.json:
```json
{
    "body": "**Dependencies:** #32505",
    "created_at": "2022-02-02T18:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540499",
    "user": "https://github.com/jhpalmieri"
}
```

**Dependencies:** #32505



---

archive/issue_comments_540500.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nAnother view of the problem above:\n\n```\nsage: from sage.modules.fp_graded.module import FPModule\nsage: from sage.modules.fp_graded.free_module import FreeGradedModule\nsage: E.<x,y> = ExteriorAlgebra(QQ)\nsage: triv = FPModule(E, [0], [[x], [y]])\nsage: M = FreeGradedModule(E, [0, 1])\nsage: type(Hom(M, triv))\n<class 'sage.modules.fp_graded.free_homspace.FreeGradedModuleHomspace_with_category_with_equality_by_id'>\nsage: type(Hom(triv, M))\n<class 'sage.modules.fp_graded.homspace.FPModuleHomspace_with_category_with_equality_by_id'>\n```\nIt seems to be determining the type of homset from the domain, not paying attention to the codomain.",
    "created_at": "2022-02-02T20:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540500",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>**Comment 4:**</a>
Another view of the problem above:

```
sage: from sage.modules.fp_graded.module import FPModule
sage: from sage.modules.fp_graded.free_module import FreeGradedModule
sage: E.<x,y> = ExteriorAlgebra(QQ)
sage: triv = FPModule(E, [0], [[x], [y]])
sage: M = FreeGradedModule(E, [0, 1])
sage: type(Hom(M, triv))
<class 'sage.modules.fp_graded.free_homspace.FreeGradedModuleHomspace_with_category_with_equality_by_id'>
sage: type(Hom(triv, M))
<class 'sage.modules.fp_graded.homspace.FPModuleHomspace_with_category_with_equality_by_id'>
```
It seems to be determining the type of homset from the domain, not paying attention to the codomain.



---

archive/issue_comments_540501.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nReplying to [@jhpalmieri](#comment%3A4):\n> Another view of the problem above:\n\n>\n> [snip]\n>\n> It seems to be determining the type of homset from the domain, not paying attention to the codomain.\n\nI thought about this, and I made a deliberate choice here (one which the code was actually already doing, it just didn't show up explicitly in the doctests). Having it be a free module homomorphism I think is the correct thing to do because we can take advantage of the fact the domain is a free module. I don't think I changed the doc for `FreeGradedModuleMorphism`, which only says that the codomain must be a graded module. So the output mentioned in [comment:2](#comment%3A2) is correct IMO. For the code as it is now, there is no need to make a distinction based on the codomain AFAICS.",
    "created_at": "2022-02-02T23:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540501",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'>**Comment 5:**</a>
Replying to [@jhpalmieri](#comment%3A4):
> Another view of the problem above:

>
> [snip]
>
> It seems to be determining the type of homset from the domain, not paying attention to the codomain.

I thought about this, and I made a deliberate choice here (one which the code was actually already doing, it just didn't show up explicitly in the doctests). Having it be a free module homomorphism I think is the correct thing to do because we can take advantage of the fact the domain is a free module. I don't think I changed the doc for `FreeGradedModuleMorphism`, which only says that the codomain must be a graded module. So the output mentioned in [comment:2](#comment%3A2) is correct IMO. For the code as it is now, there is no need to make a distinction based on the codomain AFAICS.



---

archive/issue_comments_540502.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nOkay. It looks a little strange, but it does mean that all of the maps in `M.resolution()` are composable, which is nice (and could be awkward to handle if the 0th map is of a different type than the rest). If something related to this is contributing to issues in #30680, we can revisit it.\n\nI'll mark this as \"needs review\" now.",
    "created_at": "2022-02-03T00:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540502",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'>**Comment 6:**</a>
Okay. It looks a little strange, but it does mean that all of the maps in `M.resolution()` are composable, which is nice (and could be awkward to handle if the 0th map is of a different type than the rest). If something related to this is contributing to issues in #30680, we can revisit it.

I'll mark this as "needs review" now.



---

archive/issue_events_403294.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-03T00:07:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403294"
}
```



---

archive/issue_comments_540503.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nWhy are you testing `degree()` in `FPModuleElement.coefficients()`? Was this meant to be in `degree()`?\n\n```diff\n     - ``check`` -- boolean (default: ``True``); if ``True``, check\n-      that the morphism is well-defined.\n+      that the morphism is well-defined\n```\n\nThis is more of an optimization, but it might be better to use `self.codomain().linear_combination()` in `__call__` instead of\n\n```\n        value = sum((c * v for c, v in zip(x.coefficients(), self._values)),\n                    self.codomain().zero())\n```\nIf the `FPModule` class does not implement it, we should add it for compatibility.\n\nI am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.\n\nNote that `coefficients()` for the free module now has a different behavior than for `CFM` and from the category as it contains `0` entries. (Something I missed previously.) I think this should be changed and within the code we should use `dense_coefficient_list()` (with possibly passing the fixed order where necessary). In particular, I consider this to be a bug.",
    "created_at": "2022-02-03T01:55:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540503",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>**Comment 7:**</a>
Why are you testing `degree()` in `FPModuleElement.coefficients()`? Was this meant to be in `degree()`?

```diff
     - ``check`` -- boolean (default: ``True``); if ``True``, check
-      that the morphism is well-defined.
+      that the morphism is well-defined
```

This is more of an optimization, but it might be better to use `self.codomain().linear_combination()` in `__call__` instead of

```
        value = sum((c * v for c, v in zip(x.coefficients(), self._values)),
                    self.codomain().zero())
```
If the `FPModule` class does not implement it, we should add it for compatibility.

I am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.

Note that `coefficients()` for the free module now has a different behavior than for `CFM` and from the category as it contains `0` entries. (Something I missed previously.) I think this should be changed and within the code we should use `dense_coefficient_list()` (with possibly passing the fixed order where necessary). In particular, I consider this to be a bug.



---

archive/issue_comments_540504.json:
```json
{
    "body": "**Changing commit** from \"[e3d4234f617ffb7757a3a66a797cbf05afb84604](https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604)\" to \"[e873dc80e093ff79c068a55fd97cd7b8158cfd7c](https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c)\".",
    "created_at": "2022-02-03T03:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540504",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e3d4234f617ffb7757a3a66a797cbf05afb84604](https://github.com/sagemath/sagetrac-mirror/commit/e3d4234f617ffb7757a3a66a797cbf05afb84604)" to "[e873dc80e093ff79c068a55fd97cd7b8158cfd7c](https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c)".



---

archive/issue_comments_540505.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c\">e873dc8</a></td><td><code>trac 33275: change \"coefficients\" to \"dense_coefficients\"</code></td></tr></table>\n",
    "created_at": "2022-02-03T03:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540505",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c">e873dc8</a></td><td><code>trac 33275: change "coefficients" to "dense_coefficients"</code></td></tr></table>




---

archive/issue_comments_540506.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nReplying to [@tscrim](#comment%3A7):\n> Why are you testing `degree()` in `FPModuleElement.coefficients()`? Was this meant to be in `degree()`?\n\nIt was a test of the change in the `coefficients` method (removing the sorting), but it might make more sense in `degree`.\n\n> ```diff\n>      - ``check`` -- boolean (default: ``True``); if ``True``, check\n> -      that the morphism is well-defined.\n> +      that the morphism is well-defined\n> ```\n\nDone, and also got rid of an extra blank line there, too.\n\n> This is more of an optimization, but it might be better to use `self.codomain().linear_combination()` in `__call__` instead of\n> \n> ```\n>         value = sum((c * v for c, v in zip(x.coefficients(), self._values)),\n>                     self.codomain().zero())\n> ```\n> If the `FPModule` class does not implement it, we should add it for compatibility.\n\nIt's already implemented, so I used it.\n\n> I am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.\n\nI haven't done this. Things are working without it, but we could make this change. We could do the same for coefficients for elements.\n \n> Note that `coefficients()` for the free module now has a different behavior than for `CFM` and from the category as it contains `0` entries. (Something I missed previously.) I think this should be changed and within the code we should use `dense_coefficient_list()` (with possibly passing the fixed order where necessary). In particular, I consider this to be a bug.\n\nI changed the name to `dense_coefficient_list`.",
    "created_at": "2022-02-03T03:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540506",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'>**Comment 9:**</a>
Replying to [@tscrim](#comment%3A7):
> Why are you testing `degree()` in `FPModuleElement.coefficients()`? Was this meant to be in `degree()`?

It was a test of the change in the `coefficients` method (removing the sorting), but it might make more sense in `degree`.

> ```diff
>      - ``check`` -- boolean (default: ``True``); if ``True``, check
> -      that the morphism is well-defined.
> +      that the morphism is well-defined
> ```

Done, and also got rid of an extra blank line there, too.

> This is more of an optimization, but it might be better to use `self.codomain().linear_combination()` in `__call__` instead of
> 
> ```
>         value = sum((c * v for c, v in zip(x.coefficients(), self._values)),
>                     self.codomain().zero())
> ```
> If the `FPModule` class does not implement it, we should add it for compatibility.

It's already implemented, so I used it.

> I am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.

I haven't done this. Things are working without it, but we could make this change. We could do the same for coefficients for elements.
 
> Note that `coefficients()` for the free module now has a different behavior than for `CFM` and from the category as it contains `0` entries. (Something I missed previously.) I think this should be changed and within the code we should use `dense_coefficient_list()` (with possibly passing the fixed order where necessary). In particular, I consider this to be a bug.

I changed the name to `dense_coefficient_list`.



---

archive/issue_comments_540507.json:
```json
{
    "body": "**Changing commit** from \"[e873dc80e093ff79c068a55fd97cd7b8158cfd7c](https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c)\" to \"[f9ff6654ceb05ebd177d9944c3164047c7004e1d](https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d)\".",
    "created_at": "2022-02-03T03:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540507",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e873dc80e093ff79c068a55fd97cd7b8158cfd7c](https://github.com/sagemath/sagetrac-mirror/commit/e873dc80e093ff79c068a55fd97cd7b8158cfd7c)" to "[f9ff6654ceb05ebd177d9944c3164047c7004e1d](https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d)".



---

archive/issue_comments_540508.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d\">f9ff665</a></td><td><code>trac 33275: change \"coefficients\" to \"dense_coefficient_list\"</code></td></tr></table>\n",
    "created_at": "2022-02-03T03:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540508",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>**Comment 10:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d">f9ff665</a></td><td><code>trac 33275: change "coefficients" to "dense_coefficient_list"</code></td></tr></table>




---

archive/issue_comments_540509.json:
```json
{
    "body": "**Changing commit** from \"[f9ff6654ceb05ebd177d9944c3164047c7004e1d](https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d)\" to \"[f550b617edd228084345337040279156aac0f519](https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519)\".",
    "created_at": "2022-02-03T06:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540509",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f9ff6654ceb05ebd177d9944c3164047c7004e1d](https://github.com/sagemath/sagetrac-mirror/commit/f9ff6654ceb05ebd177d9944c3164047c7004e1d)" to "[f550b617edd228084345337040279156aac0f519](https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519)".



---

archive/issue_comments_540510.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519\">f550b61</a></td><td><code>trac 33275: use linear_combination in a few more places</code></td></tr></table>\n",
    "created_at": "2022-02-03T06:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540510",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519">f550b61</a></td><td><code>trac 33275: use linear_combination in a few more places</code></td></tr></table>




---

archive/issue_comments_540511.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nThank you for the changes.\n\nReplying to [@jhpalmieri](#comment%3A9):\n> Replying to [@tscrim](#comment%3A7):\n> > I am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.\n\n> \n> I haven't done this. Things are working without it, but we could make this change. We could do the same for coefficients for elements.\n\nRight now all of the examples are effectively acting like dense modules or are small rank. This would be a more invasive change, so I would postpone it for later unless you have a strong desire for it.",
    "created_at": "2022-02-03T08:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540511",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'>**Comment 12:**</a>
Thank you for the changes.

Replying to [@jhpalmieri](#comment%3A9):
> Replying to [@tscrim](#comment%3A7):
> > I am also thinking if we should store `_values` for a `FreeMorphism` as a `dict`, then we could use `x.monomial_coefficients(copy=False)` to only get the non-zero entries. This would also make it order independent. Although then we get into issues of sparse-vs-dense implementations.

> 
> I haven't done this. Things are working without it, but we could make this change. We could do the same for coefficients for elements.

Right now all of the examples are effectively acting like dense modules or are small rank. This would be a more invasive change, so I would postpone it for later unless you have a strong desire for it.



---

archive/issue_comments_540512.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nHopefully the patchbot will come around, but otherwise I am happy with this ticket modulo I would use `super()` instead of directly calling the category in `dense_coefficient_list()`.",
    "created_at": "2022-02-03T08:12:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540512",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'>**Comment 13:**</a>
Hopefully the patchbot will come around, but otherwise I am happy with this ticket modulo I would use `super()` instead of directly calling the category in `dense_coefficient_list()`.



---

archive/issue_comments_540513.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nReplying to [@tscrim](#comment%3A13):\n> Hopefully the patchbot will come around, but otherwise I am happy with this ticket modulo I would use `super()` instead of directly calling the category in `dense_coefficient_list()`.\n\nI'm probably doing something stupid, but I can't figure out how to do that:\n\n```python\nsage: from sage.modules.fp_graded.free_module import FreeGradedModule\nsage: A = SteenrodAlgebra()\nsage: M = FreeGradedModule(A, (0, 2))\nsage: a = M.an_element()\nsage: super(FiniteDimensionalModulesWithBasis, a.parent())\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-68-e3772131b543> in <module>\n----> 1 super(FiniteDimensionalModulesWithBasis, a.parent())\n\nTypeError: super(type, obj): obj must be an instance or subtype of type\n\nsage: super(FiniteDimensionalModulesWithBasis.element_class, a)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-70-28003f3b5fda> in <module>\n----> 1 super(FiniteDimensionalModulesWithBasis.element_class, a)\n\nTypeError: super() argument 1 must be type, not lazy_attribute\n```\nI've tried a few other variations, but no luck so far.",
    "created_at": "2022-02-03T17:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540513",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'>**Comment 14:**</a>
Replying to [@tscrim](#comment%3A13):
> Hopefully the patchbot will come around, but otherwise I am happy with this ticket modulo I would use `super()` instead of directly calling the category in `dense_coefficient_list()`.

I'm probably doing something stupid, but I can't figure out how to do that:

```python
sage: from sage.modules.fp_graded.free_module import FreeGradedModule
sage: A = SteenrodAlgebra()
sage: M = FreeGradedModule(A, (0, 2))
sage: a = M.an_element()
sage: super(FiniteDimensionalModulesWithBasis, a.parent())
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-68-e3772131b543> in <module>
----> 1 super(FiniteDimensionalModulesWithBasis, a.parent())

TypeError: super(type, obj): obj must be an instance or subtype of type

sage: super(FiniteDimensionalModulesWithBasis.element_class, a)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-70-28003f3b5fda> in <module>
----> 1 super(FiniteDimensionalModulesWithBasis.element_class, a)

TypeError: super() argument 1 must be type, not lazy_attribute
```
I've tried a few other variations, but no luck so far.



---

archive/issue_comments_540514.json:
```json
{
    "body": "**Changing commit** from \"[f550b617edd228084345337040279156aac0f519](https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519)\" to \"[29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)\".",
    "created_at": "2022-02-04T01:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540514",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[f550b617edd228084345337040279156aac0f519](https://github.com/sagemath/sagetrac-mirror/commit/f550b617edd228084345337040279156aac0f519)" to "[29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)".



---

archive/issue_comments_540515.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/fp-module-bugs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/fp-module-bugs)\" to \"[u/tscrim/fp_module_bugs-33275](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fp_module_bugs-33275)\".",
    "created_at": "2022-02-04T01:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540515",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/jhpalmieri/fp-module-bugs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/fp-module-bugs)" to "[u/tscrim/fp_module_bugs-33275](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fp_module_bugs-33275)".



---

archive/issue_comments_540516.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2022-02-04T01:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540516",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_540517.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nHere we go. Just use `super()`. `:)` If my change is good, then positive review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8\">29dbd23</a></td><td><code>Last tweaks using super().</code></td></tr></table>\n",
    "created_at": "2022-02-04T01:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540517",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>**Comment 16:**</a>
Here we go. Just use `super()`. `:)` If my change is good, then positive review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8">29dbd23</a></td><td><code>Last tweaks using super().</code></td></tr></table>




---

archive/issue_comments_540518.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nGreat, thanks!",
    "created_at": "2022-02-04T01:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540518",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'>**Comment 17:**</a>
Great, thanks!



---

archive/issue_events_403295.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-04T01:27:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403295"
}
```



---

archive/issue_events_403296.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2022-02-04T01:27:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403296"
}
```



---

archive/issue_comments_540519.json:
```json
{
    "body": "**Changing branch** from \"[u/tscrim/fp_module_bugs-33275](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fp_module_bugs-33275)\" to \"[29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)\".",
    "created_at": "2022-02-16T23:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33275#issuecomment-540519",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tscrim/fp_module_bugs-33275](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fp_module_bugs-33275)" to "[29dbd232425d3c5b82a16894a76c7c669feeb9e8](https://github.com/sagemath/sagetrac-mirror/commit/29dbd232425d3c5b82a16894a76c7c669feeb9e8)".



---

archive/issue_events_403297.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-16T23:57:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403297"
}
```



---

archive/issue_events_403298.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d02679904280916820aa18a82a40bb5bbdf63b45",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-02-16T23:57:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33275",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33275#event-403298"
}
```
