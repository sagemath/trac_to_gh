# Issue 33012: Bug in bitset_copy_flex

archive/issues_032775.json:
```json
{
    "body": "`bitset_copy_flex` doesn't work at all, due to a sign error.\n\nThe following gives a segmentation fault:\n\n```\nsage: polytopes.hypercube(8).combinatorial_polyhedron().pyramid()\n```\n\nThe problem is that we are trying to copy a bitset with 256 bits to a bitset with 257 bits. This bitset is guaranteed to have more limbs and the bug shows.\n\nCC:  @tscrim\n\nBranch/Commit: f446cce1e82b004018f983c519c0c14ceb73dd77\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jonathan Kliem\n\nDependencies: #32827\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33012\n\n",
    "closed_at": "2021-12-28T21:15:40Z",
    "created_at": "2021-12-12T07:14:51Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Bug in bitset_copy_flex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33012",
    "user": "https://github.com/kliem"
}
```
`bitset_copy_flex` doesn't work at all, due to a sign error.

The following gives a segmentation fault:

```
sage: polytopes.hypercube(8).combinatorial_polyhedron().pyramid()
```

The problem is that we are trying to copy a bitset with 256 bits to a bitset with 257 bits. This bitset is guaranteed to have more limbs and the bug shows.

CC:  @tscrim

Branch/Commit: f446cce1e82b004018f983c519c0c14ceb73dd77

Reviewer: Travis Scrimshaw

Author: Jonathan Kliem

Dependencies: #32827

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33012





---

archive/issue_comments_650160.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[c4f0e1d](https://github.com/sagemath/sagetrac-mirror/commit/c4f0e1db59df6238d146c2baf0f364d8c7da0a7b)|`fix sign error in bitset_base`|",
    "created_at": "2021-12-12T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650160",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[c4f0e1d](https://github.com/sagemath/sagetrac-mirror/commit/c4f0e1db59df6238d146c2baf0f364d8c7da0a7b)|`fix sign error in bitset_base`|



---

archive/issue_comments_650161.json:
```json
{
    "body": "Changing branch from \"\" to \"public/33012\"",
    "created_at": "2021-12-12T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650161",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/33012"



---

archive/issue_comments_650162.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-12T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650162",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_650163.json:
```json
{
    "body": "Changing commit from \"\" to \"c4f0e1db59df6238d146c2baf0f364d8c7da0a7b\"",
    "created_at": "2021-12-12T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650163",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "c4f0e1db59df6238d146c2baf0f364d8c7da0a7b"



---

archive/issue_events_106043.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "rename": {
        "from": "But in bitset_copy_flex",
        "to": "Bug in bitset_copy_flex"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33012#event-106043"
}
```



---

archive/issue_comments_650164.json:
```json
{
    "body": "<a id='comment:3'></a>\nUnfortunatly, this seems not to be issue causing #32827.",
    "created_at": "2021-12-12T07:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650164",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Unfortunatly, this seems not to be issue causing #32827.



---

archive/issue_comments_650165.json:
```json
{
    "body": "<a id='comment:4'></a>\nStill is a good fix. LGTM.",
    "created_at": "2021-12-13T01:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650165",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
Still is a good fix. LGTM.



---

archive/issue_comments_650166.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-12-13T01:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650166",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_650167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-13T01:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650167",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_650168.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks. Definitely good to fix it. Just wanted to remark that we shouldn't hope that this fixes #32827.",
    "created_at": "2021-12-13T07:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650168",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
Thanks. Definitely good to fix it. Just wanted to remark that we shouldn't hope that this fixes #32827.



---

archive/issue_comments_650169.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-21T23:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650169",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_650170.json:
```json
{
    "body": "<a id='comment:6'></a>\nOn 32-bit: \n\n```\nsage -t --long --random-seed=156231420724284516434849771117684755838 src/sage/data_structures/bitset_base.pxd  # Timed out\n```",
    "created_at": "2021-12-21T23:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650170",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
On 32-bit: 

```
sage -t --long --random-seed=156231420724284516434849771117684755838 src/sage/data_structures/bitset_base.pxd  # Timed out
```



---

archive/issue_comments_650171.json:
```json
{
    "body": "Changing commit from \"c4f0e1db59df6238d146c2baf0f364d8c7da0a7b\" to \"f446cce1e82b004018f983c519c0c14ceb73dd77\"",
    "created_at": "2021-12-22T07:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c4f0e1db59df6238d146c2baf0f364d8c7da0a7b" to "f446cce1e82b004018f983c519c0c14ceb73dd77"



---

archive/issue_comments_650172.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|\n|[450e8ff](https://github.com/sagemath/sagetrac-mirror/commit/450e8ff10fce25dc9b987da75be596ab3a90e50d)|`Merge branch 'public/33012' of git://trac.sagemath.org/sage into public/33012-reb`|\n|[f446cce](https://github.com/sagemath/sagetrac-mirror/commit/f446cce1e82b004018f983c519c0c14ceb73dd77)|`simplify doctest`|",
    "created_at": "2021-12-22T07:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
|[450e8ff](https://github.com/sagemath/sagetrac-mirror/commit/450e8ff10fce25dc9b987da75be596ab3a90e50d)|`Merge branch 'public/33012' of git://trac.sagemath.org/sage into public/33012-reb`|
|[f446cce](https://github.com/sagemath/sagetrac-mirror/commit/f446cce1e82b004018f983c519c0c14ceb73dd77)|`simplify doctest`|



---

archive/issue_comments_650173.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe bug seems unrelated and might just be #32827 showing off again.\n\nI simplified the doctest.",
    "created_at": "2021-12-22T07:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650173",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
The bug seems unrelated and might just be #32827 showing off again.

I simplified the doctest.



---

archive/issue_comments_650174.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-22T07:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650174",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_650175.json:
```json
{
    "body": "<a id='comment:9'></a>\nLGTM.",
    "created_at": "2021-12-22T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650175",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
LGTM.



---

archive/issue_comments_650176.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-22T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650176",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_650177.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32827\"",
    "created_at": "2021-12-22T18:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650177",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32827"



---

archive/issue_comments_650178.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've added #32827 as a dependency",
    "created_at": "2021-12-22T18:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650178",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
I've added #32827 as a dependency



---

archive/issue_comments_650179.json:
```json
{
    "body": "<a id='comment:11'></a>\nThat was with #32827 applied...",
    "created_at": "2021-12-23T20:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650179",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
That was with #32827 applied...



---

archive/issue_comments_650180.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-28T21:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650180",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_106044.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-28T21:15:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33012#event-106044"
}
```



---

archive/issue_comments_650181.json:
```json
{
    "body": "Changing branch from \"public/33012\" to \"f446cce1e82b004018f983c519c0c14ceb73dd77\"",
    "created_at": "2021-12-28T21:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33012#issuecomment-650181",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/33012" to "f446cce1e82b004018f983c519c0c14ceb73dd77"
