# Issue 33386: MR55: Make orders unique parents

archive/issues_033149.json:
```json
{
    "body": "Julian R\u00fcth ([`@`saraedum](https://gitlab.com/sagemath/dev/tracmirror/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/55:\n\n---\n\n```markdown\nOrders in number fields are currently not unique parents:\n\n```\nsage: K.<i> = NumberField(x^2 + 1)\nsage: OK = K.order(i)\nsage: OK is loads(dumps(OK))\nFalse\nsage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\nFalse\nsage: K.maximal_order([2]) is K.maximal_order([2, 2])\nFalse\nsage: K.maximal_order([2]) is K.maximal_order([-2])\nFalse\n```\n\nAlso, maximality of orders is sometimes wrong:\n\n```\nsage: OK = K.maximal_order()\nsage: (OK & OK).is_maximal()\nFalse\nsage: OK = K.maximal_order(2)\nsage: OK == K.maximal_order()\nTrue\nsage: OK.is_maximal()\nFalse\n```\n\n---\n\nHere, we try to do a better job about making orders unique parents by using a unique factory.\n\nAlso, we normalize the primes at which we maximize and do not use them anymore to identify the order.\n\nFinally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.\n```\n\n\nKeywords: pAdicBordeaux\n\nBranch/Commit: 145777800f182c13e1bfb0f94de7e1f0c677465d\n\nReviewer: David Roe\n\nAuthor: Julian R\u00fcth\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33386\n\n",
    "closed_at": "2022-02-27T22:00:16Z",
    "created_at": "2022-02-20T02:54:43Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "MR55: Make orders unique parents",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33386",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```
Julian Rüth ([`@`saraedum](https://gitlab.com/sagemath/dev/tracmirror/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/55:

---

```markdown
Orders in number fields are currently not unique parents:

```
sage: K.<i> = NumberField(x^2 + 1)
sage: OK = K.order(i)
sage: OK is loads(dumps(OK))
False
sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([2, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([-2])
False
```

Also, maximality of orders is sometimes wrong:

```
sage: OK = K.maximal_order()
sage: (OK & OK).is_maximal()
False
sage: OK = K.maximal_order(2)
sage: OK == K.maximal_order()
True
sage: OK.is_maximal()
False
```

---

Here, we try to do a better job about making orders unique parents by using a unique factory.

Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.

Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.
```


Keywords: pAdicBordeaux

Branch/Commit: 145777800f182c13e1bfb0f94de7e1f0c677465d

Reviewer: David Roe

Author: Julian Rüth

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33386





---

archive/issue_comments_504437.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n ```markdown\n Orders in number fields are currently not unique parents:\n \n-{{{\n+```\n sage: K.<i> = NumberField(x^2 + 1)\n sage: OK = K.order(i)\n sage: OK is loads(dumps(OK))\n@@ -16,11 +16,11 @@\n False\n sage: K.maximal_order([2]) is K.maximal_order([-2])\n False\n-}}}\n+```\n \n Also, maximality of orders is sometimes wrong:\n \n-{{{\n+```\n sage: OK = K.maximal_order()\n sage: (OK & OK).is_maximal()\n False\n@@ -29,7 +29,7 @@\n True\n sage: OK.is_maximal()\n False\n-}}}\n+```\n \n ---\n \n@@ -39,6 +39,7 @@\n \n Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.\n ```\n+\n \n Author: Julian R\u00fcth\n \n```\n",
    "created_at": "2022-02-20T02:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504437",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

Description changed:
```diff
--- 
+++ 
@@ -5,7 +5,7 @@
 ```markdown
 Orders in number fields are currently not unique parents:
 
-{{{
+```
 sage: K.<i> = NumberField(x^2 + 1)
 sage: OK = K.order(i)
 sage: OK is loads(dumps(OK))
@@ -16,11 +16,11 @@
 False
 sage: K.maximal_order([2]) is K.maximal_order([-2])
 False
-}}}
+```
 
 Also, maximality of orders is sometimes wrong:
 
-{{{
+```
 sage: OK = K.maximal_order()
 sage: (OK & OK).is_maximal()
 False
@@ -29,7 +29,7 @@
 True
 sage: OK.is_maximal()
 False
-}}}
+```
 
 ---
 
@@ -39,6 +39,7 @@
 
 Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.
 ```
+
 
 Author: Julian Rüth
 
```




---

archive/issue_comments_504438.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to number fields.",
    "created_at": "2022-02-20T03:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504438",
    "user": "https://github.com/saraedum"
}
```

Changing component from PLEASE CHANGE to number fields.



---

archive/issue_comments_504439.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,44 @@\n+Julian R\u00fcth ([`@`saraedum](https://gitlab.com/sagemath/dev/tracmirror/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/55:\n+\n+---\n+\n+```markdown\n+Orders in number fields are currently not unique parents:\n+\n+```\n+sage: K.<i> = NumberField(x^2 + 1)\n+sage: OK = K.order(i)\n+sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([2, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([-2])\n+False\n+```\n+\n+Also, maximality of orders is sometimes wrong:\n+\n+```\n+sage: OK = K.maximal_order()\n+sage: (OK & OK).is_maximal()\n+False\n+sage: OK = K.maximal_order(2)\n+sage: OK == K.maximal_order()\n+True\n+sage: OK.is_maximal()\n+False\n+```\n+\n+---\n+\n+Here, we try to do a better job about making orders unique parents by using a unique factory.\n+\n+Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.\n+\n+Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.\n+```\n \n \n Author: Julian R\u00fcth\n```\n",
    "created_at": "2022-02-20T03:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504439",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,44 @@
+Julian Rüth ([`@`saraedum](https://gitlab.com/sagemath/dev/tracmirror/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/55:
+
+---
+
+```markdown
+Orders in number fields are currently not unique parents:
+
+```
+sage: K.<i> = NumberField(x^2 + 1)
+sage: OK = K.order(i)
+sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([2, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([-2])
+False
+```
+
+Also, maximality of orders is sometimes wrong:
+
+```
+sage: OK = K.maximal_order()
+sage: (OK & OK).is_maximal()
+False
+sage: OK = K.maximal_order(2)
+sage: OK == K.maximal_order()
+True
+sage: OK.is_maximal()
+False
+```
+
+---
+
+Here, we try to do a better job about making orders unique parents by using a unique factory.
+
+Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.
+
+Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.
+```
 
 
 Author: Julian Rüth
```




---

archive/issue_comments_504440.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-02-20T03:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504440",
    "user": "https://github.com/saraedum"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_504441.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-20T03:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504441",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_504442.json:
```json
{
    "body": "<a id='comment:4'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T05:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504442",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:4'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504443.json:
```json
{
    "body": "<a id='comment:5'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T06:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504443",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:5'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504444.json:
```json
{
    "body": "<a id='comment:6'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T06:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504444",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:6'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504445.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-20T06:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504445",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_504446.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2022-02-20T06:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504446",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_comments_504447.json:
```json
{
    "body": "<a id='comment:8'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T08:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504447",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:8'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504448.json:
```json
{
    "body": "<a id='comment:9'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T21:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504448",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:9'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504449.json:
```json
{
    "body": "<a id='comment:10'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2022-02-20T21:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504449",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:10'></a>New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_504450.json:
```json
{
    "body": "<a id='comment:11'></a>I ran long tests locally and they passed.  Giving a positive review.",
    "created_at": "2022-02-20T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504450",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'></a>I ran long tests locally and they passed.  Giving a positive review.



---

archive/issue_comments_504451.json:
```json
{
    "body": "Changing keywords from \"\" to \"pAdicBordeaux\".",
    "created_at": "2022-02-20T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504451",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "pAdicBordeaux".



---

archive/issue_comments_504452.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-20T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504452",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088070.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33386#event-88070"
}
```



---

archive/issue_comments_504453.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33386#issuecomment-504453",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
