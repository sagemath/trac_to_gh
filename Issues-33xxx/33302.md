# Issue 33302: fpylll might not find system-wide fplll's strategies json

archive/issues_033065.json:
```json
{
    "body": "This in particular is observed on Debian 11, see\nhttps://github.com/fplll/fpylll/issues/221\n\n```\nsage: from sage.modules.free_module_integer import IntegerLattice\nsage: L = IntegerLattice(sage.crypto.gen_lattice(type='modular', m=10, seed=1337, dual=True))\nsage: L.shortest_vector()\nterminate called after throwing an instance of 'std::runtime_error'\n  what():  Cannot open strategies file.\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n~/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)()\n   1942             try:\n-> 1943                 return cache[k]\n   1944             except TypeError:  # k is not hashable\n\nKeyError: ((True, 'fplll'), ())\n...\n```\n\nThe latter is an extract from a failing doctest.\n\nWhile it's fixed in fplll's master, we need a fix for the current fpylll.\n\n**Branch:** [20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Reviewer:** Martin Albrecht\n\n**Author:** Dima Pasechnik\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33302\n\n",
    "closed_at": "2022-02-16T23:57:01Z",
    "created_at": "2022-02-06T11:38:23Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "fpylll might not find system-wide fplll's strategies json",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33302",
    "user": "https://github.com/dimpase"
}
```
This in particular is observed on Debian 11, see
https://github.com/fplll/fpylll/issues/221

```
sage: from sage.modules.free_module_integer import IntegerLattice
sage: L = IntegerLattice(sage.crypto.gen_lattice(type='modular', m=10, seed=1337, dual=True))
sage: L.shortest_vector()
terminate called after throwing an instance of 'std::runtime_error'
  what():  Cannot open strategies file.
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
~/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: ((True, 'fplll'), ())
...
```

The latter is an extract from a failing doctest.

While it's fixed in fplll's master, we need a fix for the current fpylll.

**Branch:** [20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)

**Upstream:** Fixed upstream, in a later stable release.

**Reviewer:** Martin Albrecht

**Author:** Dima Pasechnik

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/33302





---

archive/issue_comments_664152.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think it should be enough to update FPLLL to fix this, no? I can cut a new release (for both).",
    "created_at": "2022-02-07T10:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664152",
    "user": "https://github.com/malb"
}
```


<a id='comment:1'></a>
I think it should be enough to update FPLLL to fix this, no? I can cut a new release (for both).



---

archive/issue_comments_664153.json:
```json
{
    "body": "<a id='comment:2'></a>\nWe are allowing system-wide versions of fplll. I.e. we are stuck with this little bug for some time.",
    "created_at": "2022-02-07T11:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664153",
    "user": "https://github.com/dimpase"
}
```


<a id='comment:2'></a>
We are allowing system-wide versions of fplll. I.e. we are stuck with this little bug for some time.



---

archive/issue_comments_664154.json:
```json
{
    "body": "**Branch:** [u/dimpase/fpylll/stategies_path_fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fpylll/stategies_path_fix)",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664154",
    "user": "https://github.com/dimpase"
}
```


**Branch:** [u/dimpase/fpylll/stategies_path_fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fpylll/stategies_path_fix)



---

archive/issue_comments_664155.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664155",
    "user": "https://github.com/dimpase"
}
```


**Changing upstream** from "N/A" to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_664156.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664156",
    "user": "https://github.com/dimpase"
}
```


**Changing status** from new to needs_review.



---

archive/issue_comments_664157.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664157",
    "user": "https://github.com/dimpase"
}
```


**Author:** Dima Pasechnik



---

archive/issue_comments_664158.json:
```json
{
    "body": "**Commit:** [20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664158",
    "user": "https://github.com/dimpase"
}
```


**Commit:** [20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)



---

archive/issue_comments_664159.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310\">20ca9f7</a></td><td><code>compose the path to strategies/default.json</code></td></tr></table>\n",
    "created_at": "2022-02-09T15:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664159",
    "user": "https://github.com/dimpase"
}
```


<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310">20ca9f7</a></td><td><code>compose the path to strategies/default.json</code></td></tr></table>




---

archive/issue_comments_664160.json:
```json
{
    "body": "**Reviewer:** Martin Albrecht",
    "created_at": "2022-02-11T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664160",
    "user": "https://github.com/malb"
}
```


**Reviewer:** Martin Albrecht



---

archive/issue_comments_664161.json:
```json
{
    "body": "<a id='comment:4'></a>\nI am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.",
    "created_at": "2022-02-11T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664161",
    "user": "https://github.com/malb"
}
```


<a id='comment:4'></a>
I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.



---

archive/issue_comments_664162.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2022-02-11T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664162",
    "user": "https://github.com/malb"
}
```


**Changing status** from needs_review to positive_review.



---

archive/issue_comments_664163.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [malb](#comment%3A4):\n> I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.\n\n\nThanks. On Debian 11 BKZ.DEFAULT_STRATEGY is not full path, it's just `default.json`. So the path has to be prepended.\nIn some other cases it's full path, so either nothing should be prepended, or it can be done as in the patch.",
    "created_at": "2022-02-11T12:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664163",
    "user": "https://github.com/dimpase"
}
```


<a id='comment:5'></a>
Replying to [malb](#comment%3A4):
> I am a bit puzzled how this situation can arise but the fix doesn't make it wrong, so thumbs up from me. I didn't run doctests, though.


Thanks. On Debian 11 BKZ.DEFAULT_STRATEGY is not full path, it's just `default.json`. So the path has to be prepended.
In some other cases it's full path, so either nothing should be prepended, or it can be done as in the patch.



---

archive/issue_comments_664164.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2022-02-16T23:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664164",
    "user": "https://github.com/vbraun"
}
```


**Resolution:** fixed



---

archive/issue_events_098897.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-16T23:57:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33302#event-98897"
}
```




---

archive/issue_comments_664165.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/fpylll/stategies_path_fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fpylll/stategies_path_fix)\" to \"[20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)\".",
    "created_at": "2022-02-16T23:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664165",
    "user": "https://github.com/vbraun"
}
```


**Changing branch** from "[u/dimpase/fpylll/stategies_path_fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fpylll/stategies_path_fix)" to "[20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)".



---

archive/issue_comments_664166.json:
```json
{
    "body": "**Changing commit** from \"[20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)\" to \"\".",
    "created_at": "2022-03-02T04:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664166",
    "user": "https://github.com/mkoeppe"
}
```


**Changing commit** from "[20ca9f7021d53e63f28e9a97ed607769c1b86310](https://github.com/sagemath/sagetrac-mirror/commit/20ca9f7021d53e63f28e9a97ed607769c1b86310)" to "".



---

archive/issue_comments_664167.json:
```json
{
    "body": "<a id='comment:7'></a>\nAgain on `opensuse-tumbleweed` - #33448",
    "created_at": "2022-03-02T04:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33302#issuecomment-664167",
    "user": "https://github.com/mkoeppe"
}
```


<a id='comment:7'></a>
Again on `opensuse-tumbleweed` - #33448
