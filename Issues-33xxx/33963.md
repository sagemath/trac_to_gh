# Issue 33963: wrong sign for symbolic Legendre polynomial at 0

archive/issues_033726.json:
```json
{
    "body": "Trac ticket #33962 fixed the sign of `legendre_P(n, 0)` when `n` is an explicit integer. The patch also tried to fix the sign when `n` is a symbolic integer variable, but the patch does not work. Even with the patch, we have:\n\n```\nsage: n = var(\"n\")\nsage: assume(n, \"integer\")\nsage: assume(n, \"even\")\nsage: legendre_P(n, 0)\n2^(-n + 2)*gamma(n)/(n*gamma(1/2*n)^2)\n```\nThis is missing a factor of `(-1)^(n/2)`.\n\nThe incorrect value arises because pynac erroneously simplifies the expression `pow(_ex_1, n / _ex2)` to `1`. (The constant `_ex_1` is pynac's name for `-1`.)\nThe problem seems to be that pynac thinks `n / _ex2` is even: printing `(n / _ex2).info(info_flags::even)` at this point in the code yields `1` (meaning the flag is set).\n\nKeywords: parity, sign error, pynac\n\nBranch/Commit: a3608a41a27c55eed9de19c40fb85c9c84db32db\n\nReviewer: Travis Scrimshaw\n\nAuthor: Dave Morris\n\nDependencies: #33962\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33963\n\n",
    "closed_at": "2022-06-12T23:08:32Z",
    "created_at": "2022-06-08T19:31:18Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "wrong sign for symbolic Legendre polynomial at 0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33963",
    "user": "https://github.com/DaveWitteMorris"
}
```
Trac ticket #33962 fixed the sign of `legendre_P(n, 0)` when `n` is an explicit integer. The patch also tried to fix the sign when `n` is a symbolic integer variable, but the patch does not work. Even with the patch, we have:

```
sage: n = var("n")
sage: assume(n, "integer")
sage: assume(n, "even")
sage: legendre_P(n, 0)
2^(-n + 2)*gamma(n)/(n*gamma(1/2*n)^2)
```
This is missing a factor of `(-1)^(n/2)`.

The incorrect value arises because pynac erroneously simplifies the expression `pow(_ex_1, n / _ex2)` to `1`. (The constant `_ex_1` is pynac's name for `-1`.)
The problem seems to be that pynac thinks `n / _ex2` is even: printing `(n / _ex2).info(info_flags::even)` at this point in the code yields `1` (meaning the flag is set).

Keywords: parity, sign error, pynac

Branch/Commit: a3608a41a27c55eed9de19c40fb85c9c84db32db

Reviewer: Travis Scrimshaw

Author: Dave Morris

Dependencies: #33962

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33963





---

archive/issue_comments_668785.json:
```json
{
    "body": "Changing branch from \"\" to \"public/33963\"",
    "created_at": "2022-06-09T04:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668785",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "" to "public/33963"



---

archive/issue_comments_668786.json:
```json
{
    "body": "Changing commit from \"\" to \"e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a\"",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668786",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "" to "e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a"



---

archive/issue_comments_668787.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668787",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_668788.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#33962\"",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668788",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing dependencies from "" to "#33962"



---

archive/issue_comments_668789.json:
```json
{
    "body": "Changing author from \"\" to \"Dave Morris\"",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668789",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing author from "" to "Dave Morris"



---

archive/issue_comments_668790.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe bug is in `case info_flags::even` of pynac's `mul::info` method. A product is even if all of the factors are integers, and at least one of the factors is even. However, one of the factors in a `mul` object is the `overall coefficient`, and the method neglected to check that this coefficient is an integer. \n\nIn the example of the ticket description, pynac represents the expression `n/2` as the product `1/2 * n`, where `1/2` is the overall coefficient. This coefficient is obviously not an integer.\n\n---\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[c011409](https://github.com/sagemath/sagetrac-mirror/commit/c0114095a3706112f5bda36fa5b6a50ce97b9c94)|`trac 33962: fix legendre polynomial`|\n|[e29fdaf](https://github.com/sagemath/sagetrac-mirror/commit/e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a)|`trac 33963: fix legendre polynomial`|",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668790",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>
The bug is in `case info_flags::even` of pynac's `mul::info` method. A product is even if all of the factors are integers, and at least one of the factors is even. However, one of the factors in a `mul` object is the `overall coefficient`, and the method neglected to check that this coefficient is an integer. 

In the example of the ticket description, pynac represents the expression `n/2` as the product `1/2 * n`, where `1/2` is the overall coefficient. This coefficient is obviously not an integer.

---
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[c011409](https://github.com/sagemath/sagetrac-mirror/commit/c0114095a3706112f5bda36fa5b6a50ce97b9c94)|`trac 33962: fix legendre polynomial`|
|[e29fdaf](https://github.com/sagemath/sagetrac-mirror/commit/e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a)|`trac 33963: fix legendre polynomial`|



---

archive/issue_comments_668791.json:
```json
{
    "body": "Changing branch from \"public/33963\" to \"public/33963r1\"",
    "created_at": "2022-06-09T05:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668791",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "public/33963" to "public/33963r1"



---

archive/issue_comments_668792.json:
```json
{
    "body": "Changing commit from \"e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a\" to \"d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a\"",
    "created_at": "2022-06-09T05:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668792",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "e29fdaf10f5c6a9bec8d9737d13e9c78ca30393a" to "d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a"



---

archive/issue_comments_668793.json:
```json
{
    "body": "<a id='comment:4'></a>\nFollow-up: #33964. When `n` is odd, `legendre_P(n, 0)` should be 0.\n\n---\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[d967fb0](https://github.com/sagemath/sagetrac-mirror/commit/d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a)|`trac 33963: fix legendre polynomial`|",
    "created_at": "2022-06-09T05:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668793",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:4'></a>
Follow-up: #33964. When `n` is odd, `legendre_P(n, 0)` should be 0.

---
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[d967fb0](https://github.com/sagemath/sagetrac-mirror/commit/d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a)|`trac 33963: fix legendre polynomial`|



---

archive/issue_comments_668794.json:
```json
{
    "body": "<a id='comment:5'></a>\nLGTM modulo the doc change:\n\n```diff\n-        # verify that :trac:`33963` is fixed\n+\n+    Verify that :trac:`33963` is fixed::\n+\n         sage: n = var(\"n\")\n```",
    "created_at": "2022-06-10T04:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668794",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
LGTM modulo the doc change:

```diff
-        # verify that :trac:`33963` is fixed
+
+    Verify that :trac:`33963` is fixed::
+
         sage: n = var("n")
```



---

archive/issue_comments_668795.json:
```json
{
    "body": "<a id='comment:6'></a>\nOnce changed, you can set a positive review on my behalf.",
    "created_at": "2022-06-10T04:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668795",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Once changed, you can set a positive review on my behalf.



---

archive/issue_comments_668796.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-06-10T04:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668796",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_668797.json:
```json
{
    "body": "Changing branch from \"public/33963r1\" to \"public/33963r2\"",
    "created_at": "2022-06-11T00:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668797",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "public/33963r1" to "public/33963r2"



---

archive/issue_comments_668798.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks for the review and corrections of this ticket, too.  \n\nI rebased on #33962, and will set to positive review when the patchbot is green again.\n\n---\nNew commits:\n|                                                                                                                                          |                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[8131256](https://github.com/sagemath/sagetrac-mirror/commit/8131256c2145a5645e0bb5cf33cf4eff330d0320)|`reviewer corrections`|\n|[a3608a4](https://github.com/sagemath/sagetrac-mirror/commit/a3608a41a27c55eed9de19c40fb85c9c84db32db)|`trac 33963: fix legendre polynomial`|",
    "created_at": "2022-06-11T00:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668798",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:8'></a>
Thanks for the review and corrections of this ticket, too.  

I rebased on #33962, and will set to positive review when the patchbot is green again.

---
New commits:
|                                                                                                                                          |                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[8131256](https://github.com/sagemath/sagetrac-mirror/commit/8131256c2145a5645e0bb5cf33cf4eff330d0320)|`reviewer corrections`|
|[a3608a4](https://github.com/sagemath/sagetrac-mirror/commit/a3608a41a27c55eed9de19c40fb85c9c84db32db)|`trac 33963: fix legendre polynomial`|



---

archive/issue_comments_668799.json:
```json
{
    "body": "Changing commit from \"d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a\" to \"a3608a41a27c55eed9de19c40fb85c9c84db32db\"",
    "created_at": "2022-06-11T00:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668799",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "d967fb0b73513b9ea3ff3d7bff6b1f5c7de0e32a" to "a3608a41a27c55eed9de19c40fb85c9c84db32db"



---

archive/issue_comments_668800.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-11T03:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668800",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_108069.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-12T23:08:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33963#event-108069"
}
```



---

archive/issue_comments_668801.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T23:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668801",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_668802.json:
```json
{
    "body": "Changing branch from \"public/33963r2\" to \"a3608a41a27c55eed9de19c40fb85c9c84db32db\"",
    "created_at": "2022-06-12T23:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33963#issuecomment-668802",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/33963r2" to "a3608a41a27c55eed9de19c40fb85c9c84db32db"
