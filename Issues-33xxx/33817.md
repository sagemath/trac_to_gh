# Issue 33817: GH Actions: Add test of the modularized distributions

archive/issues_033580.json:
```json
{
    "body": "... as part of the workflow `build.yml`. This is to catch modularization regressions on tickets.\n\nTo this end, we extend `build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install` scripts so that they build and store wheels in `SAGE_SPKG_WHEELS` (but do not install them!), and then run `tox` on the wheels (unless disabled by setting `SAGE_CHECK=no`).\n\nA new top-level make target `pypi-wheels` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if `configure --enable-editable` is in use.\n\nAnother top-level make target `wheels` does the same but also includes `sage_conf` and `sagemath_standard`. This is useful for venv installs and helps with the problem noted in #32913.\n\nWe also extend the script `src/bin/sage-update-version` so that it automatically updates the `install-requires.txt` files for our distribution packages. \n\n\nCC:  @dimpase @saraedum @kwankyu @jhpalmieri\n\nBranch/Commit: 64b212caa93f9e9c4f0868eb065bb35fd22cfc6a\n\nReviewer: Tobias Diez, Kwankyu Lee\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33817\n\n",
    "closed_at": "2022-08-01T20:23:07Z",
    "created_at": "2022-05-06T17:59:19Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "GH Actions: Add test of the modularized distributions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33817",
    "user": "https://github.com/mkoeppe"
}
```
... as part of the workflow `build.yml`. This is to catch modularization regressions on tickets.

To this end, we extend `build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install` scripts so that they build and store wheels in `SAGE_SPKG_WHEELS` (but do not install them!), and then run `tox` on the wheels (unless disabled by setting `SAGE_CHECK=no`).

A new top-level make target `pypi-wheels` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if `configure --enable-editable` is in use.

Another top-level make target `wheels` does the same but also includes `sage_conf` and `sagemath_standard`. This is useful for venv installs and helps with the problem noted in #32913.

We also extend the script `src/bin/sage-update-version` so that it automatically updates the `install-requires.txt` files for our distribution packages. 


CC:  @dimpase @saraedum @kwankyu @jhpalmieri

Branch/Commit: 64b212caa93f9e9c4f0868eb065bb35fd22cfc6a

Reviewer: Tobias Diez, Kwankyu Lee

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33817





---

archive/issue_comments_510545.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-06T21:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510546.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-06T22:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510546",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510547.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n ... as part of the workflow \\`build.yml\\`. This is to catch modularization regressions on tickets.\n \n-To this end, we add \\`build/pkgs/sagemath-{objects,categories}/spkg-install\\` scripts, which build and store wheels (but do not install them!), and add tox environments \\`python-sagewheels-nopypi\\` as in \\`pkg/sagemath-standard/tox.ini\\`.\n+To this end, we extend \\`build/pkgs/sagemath-{objects,categories}/spkg-install\\` scripts so that they build and store wheels in \\`SAGE_SPKG_WHEELS\\` (but do not install them!), and then run \\`tox\\` on the wheels.\n+\n+A new top-level make target \\`pypi-wheels\\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \\`configure --editable\\` is in use.\n+\n+Another top-level make target \\`wheels\\` does the same but also includes \\`sage_conf\\` and \\`sagemath_standard\\`. This is useful for venv installs and helps with the problem noted in #32913.\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2022-05-06T22:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510547",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,11 @@
 ... as part of the workflow \`build.yml\`. This is to catch modularization regressions on tickets.
 
-To this end, we add \`build/pkgs/sagemath-{objects,categories}/spkg-install\` scripts, which build and store wheels (but do not install them!), and add tox environments \`python-sagewheels-nopypi\` as in \`pkg/sagemath-standard/tox.ini\`.
+To this end, we extend \`build/pkgs/sagemath-{objects,categories}/spkg-install\` scripts so that they build and store wheels in \`SAGE_SPKG_WHEELS\` (but do not install them!), and then run \`tox\` on the wheels.
+
+A new top-level make target \`pypi-wheels\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \`configure --editable\` is in use.
+
+Another top-level make target \`wheels\` does the same but also includes \`sage_conf\` and \`sagemath_standard\`. This is useful for venv installs and helps with the problem noted in #32913.
+
 
 Comment: 1
 
```




---

archive/issue_comments_510548.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510549.json:
```json
{
    "body": "<a id='comment:8'></a>How much longer does the build workflow now take?",
    "created_at": "2022-05-07T21:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510549",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>How much longer does the build workflow now take?



---

archive/issue_comments_510550.json:
```json
{
    "body": "<a id='comment:9'></a>Running right now at https://github.com/sagemath/sagetrac-mirror/runs/6336808131?check_suite_focus=true",
    "created_at": "2022-05-07T21:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510550",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Running right now at https://github.com/sagemath/sagetrac-mirror/runs/6336808131?check_suite_focus=true



---

archive/issue_comments_510551.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T21:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510552.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T22:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510553.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T22:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510554.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T23:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510555.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T23:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510556.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-07T23:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510557.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T00:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510558.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:8 gh-tobiasdiez]:\n> How much longer does the build workflow now take? \n\n\n4 minutes longer - \nhttps://github.com/sagemath/sagetrac-mirror/runs/6337876092?check_suite_focus=true",
    "created_at": "2022-05-08T01:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510558",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:8 gh-tobiasdiez]:
> How much longer does the build workflow now take? 


4 minutes longer - 
https://github.com/sagemath/sagetrac-mirror/runs/6337876092?check_suite_focus=true



---

archive/issue_comments_510559.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T01:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510560.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-08T01:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510560",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_510561.json:
```json
{
    "body": "<a id='comment:21'></a>> This step has been truncated due to its large size. Download the full logs from the menu once the workflow run has completed. \n\n\nCan you please decrease the verbosity of the install steps (e.g. there is no need to see the verbose logs for the dependencies).\n\nMoreover many tests are actually failing but the step still succeeds. Eg:\n> [sagemath_objects-9.6.rc3]     NameError: name 'ZZ' is not defined",
    "created_at": "2022-05-08T21:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510561",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:21'></a>> This step has been truncated due to its large size. Download the full logs from the menu once the workflow run has completed. 


Can you please decrease the verbosity of the install steps (e.g. there is no need to see the verbose logs for the dependencies).

Moreover many tests are actually failing but the step still succeeds. Eg:
> [sagemath_objects-9.6.rc3]     NameError: name 'ZZ' is not defined



---

archive/issue_comments_510562.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-08T21:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510562",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_510563.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 gh-tobiasdiez]:\n> Moreover many tests are actually failing but the step still succeeds. Eg:\n> > [sagemath_objects-9.6.rc3]     NameError: name 'ZZ' is not defined\n\n\nYes, this is normal.",
    "created_at": "2022-05-08T21:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510563",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Replying to [comment:21 gh-tobiasdiez]:
> Moreover many tests are actually failing but the step still succeeds. Eg:
> > [sagemath_objects-9.6.rc3]     NameError: name 'ZZ' is not defined


Yes, this is normal.



---

archive/issue_comments_510564.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T21:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510564",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510565.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T21:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510565",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510566.json:
```json
{
    "body": "<a id='comment:25'></a>Cherry-picked some improvements from #33812",
    "created_at": "2022-05-08T21:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510566",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Cherry-picked some improvements from #33812



---

archive/issue_comments_510567.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+... as part of the workflow \\`build.yml\\`. This is to catch modularization regressions on tickets.\n+\n+To this end, we extend \\`build/pkgs/sagemath-{objects,categories}/spkg-install\\` scripts so that they build and store wheels in \\`SAGE_SPKG_WHEELS\\` (but do not install them!), and then run \\`tox\\` on the wheels (unless disabled by setting \\`SAGE_CHECK=no\\`).\n+\n+A new top-level make target \\`pypi-wheels\\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \\`configure --editable\\` is in use.\n+\n+Another top-level make target \\`wheels\\` does the same but also includes \\`sage_conf\\` and \\`sagemath_standard\\`. This is useful for venv installs and helps with the problem noted in #32913.\n \n \n Comment: 1\n```\n",
    "created_at": "2022-05-08T21:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510567",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,10 @@
+... as part of the workflow \`build.yml\`. This is to catch modularization regressions on tickets.
+
+To this end, we extend \`build/pkgs/sagemath-{objects,categories}/spkg-install\` scripts so that they build and store wheels in \`SAGE_SPKG_WHEELS\` (but do not install them!), and then run \`tox\` on the wheels (unless disabled by setting \`SAGE_CHECK=no\`).
+
+A new top-level make target \`pypi-wheels\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \`configure --editable\` is in use.
+
+Another top-level make target \`wheels\` does the same but also includes \`sage_conf\` and \`sagemath_standard\`. This is useful for venv installs and helps with the problem noted in #32913.
 
 
 Comment: 1
```




---

archive/issue_comments_510568.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-08T21:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510568",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_510569.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T22:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510570.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-08T22:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510570",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_510571.json:
```json
{
    "body": "<a id='comment:29'></a>Here's a solution, running at https://github.com/sagemath/sagetrac-mirror/runs/6343730808?check_suite_focus=true\n\nI've made the test dependency installs silent and reduced the tests of sagemath-objects to a minimum (as I was doing anyway in #33812).\n\nsagemath-categories continues to run the full test suite of `sage.structure`, showing lots of (ignored) errors. They will be fixed gradually by marking doctests `# optional`",
    "created_at": "2022-05-08T22:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510571",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Here's a solution, running at https://github.com/sagemath/sagetrac-mirror/runs/6343730808?check_suite_focus=true

I've made the test dependency installs silent and reduced the tests of sagemath-objects to a minimum (as I was doing anyway in #33812).

sagemath-categories continues to run the full test suite of `sage.structure`, showing lots of (ignored) errors. They will be fixed gradually by marking doctests `# optional`



---

archive/issue_comments_510572.json:
```json
{
    "body": "<a id='comment:30'></a>Now the distribution check needs over 10min, is this expected?",
    "created_at": "2022-05-09T20:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510572",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:30'></a>Now the distribution check needs over 10min, is this expected?



---

archive/issue_comments_510573.json:
```json
{
    "body": "<a id='comment:31'></a>I think these are just random fluctuations. The job looks OK.",
    "created_at": "2022-05-09T20:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510573",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>I think these are just random fluctuations. The job looks OK.



---

archive/issue_comments_510574.json:
```json
{
    "body": "<a id='comment:32'></a>Indeed, one a newly triggered run it only takes about 4min. The changes to the build workflow look good to me, I cannot say anything about the rest.",
    "created_at": "2022-05-10T18:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510574",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:32'></a>Indeed, one a newly triggered run it only takes about 4min. The changes to the build workflow look good to me, I cannot say anything about the rest.



---

archive/issue_comments_510575.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-12T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510575",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510576.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-18T00:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510576",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510577.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+... as part of the workflow \\`build.yml\\`. This is to catch modularization regressions on tickets.\n+\n+To this end, we extend \\`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\\` scripts so that they build and store wheels in \\`SAGE_SPKG_WHEELS\\` (but do not install them!), and then run \\`tox\\` on the wheels (unless disabled by setting \\`SAGE_CHECK=no\\`).\n+\n+A new top-level make target \\`pypi-wheels\\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \\`configure --editable\\` is in use.\n+\n+Another top-level make target \\`wheels\\` does the same but also includes \\`sage_conf\\` and \\`sagemath_standard\\`. This is useful for venv installs and helps with the problem noted in #32913.\n \n \n Comment: 1\n```\n",
    "created_at": "2022-06-18T00:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510577",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,10 @@
+... as part of the workflow \`build.yml\`. This is to catch modularization regressions on tickets.
+
+To this end, we extend \`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\` scripts so that they build and store wheels in \`SAGE_SPKG_WHEELS\` (but do not install them!), and then run \`tox\` on the wheels (unless disabled by setting \`SAGE_CHECK=no\`).
+
+A new top-level make target \`pypi-wheels\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \`configure --editable\` is in use.
+
+Another top-level make target \`wheels\` does the same but also includes \`sage_conf\` and \`sagemath_standard\`. This is useful for venv installs and helps with the problem noted in #32913.
 
 
 Comment: 1
```




---

archive/issue_comments_510578.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-25T23:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510579.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-07-03T18:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_510580.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-03T18:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510581.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-09T23:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510582.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-11T00:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510583.json:
```json
{
    "body": "<a id='comment:44'></a>All dependencies have been merged",
    "created_at": "2022-07-11T00:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510583",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>All dependencies have been merged



---

archive/issue_comments_510584.json:
```json
{
    "body": "<a id='comment:46'></a>From Build&Test badge, I see\n\n```\n[sagemath_environment-9.7.beta5] using tox.ini: /__w/sagetrac-mirror/sagetrac-mirror/pkgs/sagemath-environment/tox.ini (pid 24071)\n[sagemath_environment-9.7.beta5] ERROR: unknown environment 'sagepython-norequirements'\n```\nIs this normal?",
    "created_at": "2022-07-25T07:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510584",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'></a>From Build&Test badge, I see

```
[sagemath_environment-9.7.beta5] using tox.ini: /__w/sagetrac-mirror/sagetrac-mirror/pkgs/sagemath-environment/tox.ini (pid 24071)
[sagemath_environment-9.7.beta5] ERROR: unknown environment 'sagepython-norequirements'
```
Is this normal?



---

archive/issue_comments_510585.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-25T16:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510585",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_510586.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T16:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510587.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510588.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T18:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510589.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T18:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510590.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+... as part of the workflow \\`build.yml\\`. This is to catch modularization regressions on tickets.\n+\n+To this end, we extend \\`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\\` scripts so that they build and store wheels in \\`SAGE_SPKG_WHEELS\\` (but do not install them!), and then run \\`tox\\` on the wheels (unless disabled by setting \\`SAGE_CHECK=no\\`).\n+\n+A new top-level make target \\`pypi-wheels\\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \\`configure --editable\\` is in use.\n+\n+Another top-level make target \\`wheels\\` does the same but also includes \\`sage_conf\\` and \\`sagemath_standard\\`. This is useful for venv installs and helps with the problem noted in #32913.\n+\n+We also extend the script \\`src/bin/sage-update-version\\` so that it automatically updates the \\`install-requires.txt\\` files for our distribution packages. \n \n \n Comment: 1\n```\n",
    "created_at": "2022-07-25T18:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510590",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,12 @@
+... as part of the workflow \`build.yml\`. This is to catch modularization regressions on tickets.
+
+To this end, we extend \`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\` scripts so that they build and store wheels in \`SAGE_SPKG_WHEELS\` (but do not install them!), and then run \`tox\` on the wheels (unless disabled by setting \`SAGE_CHECK=no\`).
+
+A new top-level make target \`pypi-wheels\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \`configure --editable\` is in use.
+
+Another top-level make target \`wheels\` does the same but also includes \`sage_conf\` and \`sagemath_standard\`. This is useful for venv installs and helps with the problem noted in #32913.
+
+We also extend the script \`src/bin/sage-update-version\` so that it automatically updates the \`install-requires.txt\` files for our distribution packages. 
 
 
 Comment: 1
```




---

archive/issue_comments_510591.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T20:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510592.json:
```json
{
    "body": "<a id='comment:54'></a>(last commit cherry-picked from #33812)",
    "created_at": "2022-07-25T20:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510592",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>(last commit cherry-picked from #33812)



---

archive/issue_comments_510593.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T22:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510594.json:
```json
{
    "body": "<a id='comment:56'></a>New test running at https://github.com/mkoeppe/sage/actions/runs/2736095948",
    "created_at": "2022-07-26T00:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510594",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>New test running at https://github.com/mkoeppe/sage/actions/runs/2736095948



---

archive/issue_comments_510595.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-26T00:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510595",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_510596.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-26T01:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510597.json:
```json
{
    "body": "<a id='comment:59'></a>I removed some white spaces.\n\nOther than that, the code looks good to me as far as I can read (not very far as usual).\n\nThe new workflow seems work well in github.\n\nBut on my machine (mac), I get\n\n```\n$ ./configure --editable; make SAGE_CHECK=yes pypi-wheels\n...\n...\n[sagemath_categories-9.7.beta6] WARNING: Discarding $PYTHONPATH from environment, to override specify PYTHONPATH in 'passenv' in your configuration.\n[sagemath_categories-9.7.beta6] [40038] /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories$ /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/bin/python -m pip install --no-deps -U .tox/.tmp/package/1/sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl >.tox/sagepython-norequirements/log/sagepython-norequirements-2.log\n[sagemath_categories-9.7.beta6] ERROR: invocation failed (exit code 1), logfile: /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/log/sagepython-norequirements-2.log\n[sagemath_categories-9.7.beta6] ================================== log start ===================================\n[sagemath_categories-9.7.beta6] Looking in links: file:///Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels\n[sagemath_categories-9.7.beta6] ERROR: sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl is not a supported wheel on this platform.\n[sagemath_categories-9.7.beta6] \n[sagemath_categories-9.7.beta6] =================================== log end ====================================\n[sagemath_categories-9.7.beta6] ___________________________________ summary ____________________________________\n[sagemath_categories-9.7.beta6] ERROR:   sagepython-norequirements: InvocationError for command /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/bin/python -m pip install --no-deps -U .tox/.tmp/package/1/sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl (exited with code 1)\nmake[3]: *** [sagemath_categories-SAGE_VENV-no-deps] Error 1\nmake[2]: *** [/Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/sagemath_categories-9.7.beta6] Error 2\n\nreal\t2m58.107s\nuser\t2m41.881s\nsys\t0m14.927s\n***************************************************************\nError building Sage.\n```\nIs this expected?\n\n---\nNew commits:",
    "created_at": "2022-07-26T05:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510597",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:59'></a>I removed some white spaces.

Other than that, the code looks good to me as far as I can read (not very far as usual).

The new workflow seems work well in github.

But on my machine (mac), I get

```
$ ./configure --editable; make SAGE_CHECK=yes pypi-wheels
...
...
[sagemath_categories-9.7.beta6] WARNING: Discarding $PYTHONPATH from environment, to override specify PYTHONPATH in 'passenv' in your configuration.
[sagemath_categories-9.7.beta6] [40038] /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories$ /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/bin/python -m pip install --no-deps -U .tox/.tmp/package/1/sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl >.tox/sagepython-norequirements/log/sagepython-norequirements-2.log
[sagemath_categories-9.7.beta6] ERROR: invocation failed (exit code 1), logfile: /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/log/sagepython-norequirements-2.log
[sagemath_categories-9.7.beta6] ================================== log start ===================================
[sagemath_categories-9.7.beta6] Looking in links: file:///Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
[sagemath_categories-9.7.beta6] ERROR: sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl is not a supported wheel on this platform.
[sagemath_categories-9.7.beta6] 
[sagemath_categories-9.7.beta6] =================================== log end ====================================
[sagemath_categories-9.7.beta6] ___________________________________ summary ____________________________________
[sagemath_categories-9.7.beta6] ERROR:   sagepython-norequirements: InvocationError for command /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/sagepython-norequirements/bin/python -m pip install --no-deps -U .tox/.tmp/package/1/sagemath_categories-9.7b6-cp39-cp39-macosx_12_0_x86_64.whl (exited with code 1)
make[3]: *** [sagemath_categories-SAGE_VENV-no-deps] Error 1
make[2]: *** [/Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/sagemath_categories-9.7.beta6] Error 2

real	2m58.107s
user	2m41.881s
sys	0m14.927s
***************************************************************
Error building Sage.
```
Is this expected?

---
New commits:



---

archive/issue_comments_510598.json:
```json
{
    "body": "<a id='comment:60'></a>I still get the same even with `make distclean; ./configure; make pypi-wheels`.",
    "created_at": "2022-07-26T07:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510598",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:60'></a>I still get the same even with `make distclean; ./configure; make pypi-wheels`.



---

archive/issue_comments_510599.json:
```json
{
    "body": "<a id='comment:61'></a>Is this python3.9 from Homebrew? And is this `tox` from Homebrew?",
    "created_at": "2022-07-26T15:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510599",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>Is this python3.9 from Homebrew? And is this `tox` from Homebrew?



---

archive/issue_comments_510600.json:
```json
{
    "body": "<a id='comment:62'></a>Homebrew python3.9 according to `./configure`,\n\n```\nChecking whether SageMath should install SPKG python3...\nchecking whether any of bzip2 liblzma libffi is installed as or will be installed as SPKG... no\nchecking for python3 >= 3.8.0, < 3.11.0 with modules sqlite3, ctypes, math, hashlib, crypt, socket, zlib, distutils.core, ssl, ensurepip... \nchecking ... whether /usr/local/bin/python3 is good... yes\nchecking for python3 >= 3.8.0, < 3.11.0 with modules sqlite3, ctypes, math, hashlib, crypt, socket, zlib, distutils.core, ssl, ensurepip... /usr/local/bin/python3\nconfigure: will use system package and not install SPKG python3\nchecking whether /usr/local/bin/python3 is configured to build multiarch extensions... no\nchecking whether \"-march=native\" works with the C/C++ compilers configured for building extensions for /usr/local/bin/python3... yes\n```",
    "created_at": "2022-07-26T15:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510600",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:62'></a>Homebrew python3.9 according to `./configure`,

```
Checking whether SageMath should install SPKG python3...
checking whether any of bzip2 liblzma libffi is installed as or will be installed as SPKG... no
checking for python3 >= 3.8.0, < 3.11.0 with modules sqlite3, ctypes, math, hashlib, crypt, socket, zlib, distutils.core, ssl, ensurepip... 
checking ... whether /usr/local/bin/python3 is good... yes
checking for python3 >= 3.8.0, < 3.11.0 with modules sqlite3, ctypes, math, hashlib, crypt, socket, zlib, distutils.core, ssl, ensurepip... /usr/local/bin/python3
configure: will use system package and not install SPKG python3
checking whether /usr/local/bin/python3 is configured to build multiarch extensions... no
checking whether "-march=native" works with the C/C++ compilers configured for building extensions for /usr/local/bin/python3... yes
```



---

archive/issue_comments_510601.json:
```json
{
    "body": "<a id='comment:63'></a>If I run `tox` from `SAGE_ROOT`, it is the `tox` of Homebrew.",
    "created_at": "2022-07-26T15:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510601",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:63'></a>If I run `tox` from `SAGE_ROOT`, it is the `tox` of Homebrew.



---

archive/issue_comments_510602.json:
```json
{
    "body": "<a id='comment:64'></a>It is Hombrew tox according to ./configure,\n\n```\nChecking whether SageMath should install SPKG tox...\nchecking for tox >= 3.21.4... /usr/local/bin/tox\nconfigure: will use system package and not install SPKG tox\n```",
    "created_at": "2022-07-26T15:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510602",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:64'></a>It is Hombrew tox according to ./configure,

```
Checking whether SageMath should install SPKG tox...
checking for tox >= 3.21.4... /usr/local/bin/tox
configure: will use system package and not install SPKG tox
```



---

archive/issue_comments_510603.json:
```json
{
    "body": "<a id='comment:65'></a>Thanks. I can reproduce this error here. I'll investigate",
    "created_at": "2022-07-26T15:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510603",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>Thanks. I can reproduce this error here. I'll investigate



---

archive/issue_comments_510604.json:
```json
{
    "body": "<a id='comment:66'></a>OK I solved the same problem before for sagemath-standard. Fix coming up",
    "created_at": "2022-07-26T18:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510604",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>OK I solved the same problem before for sagemath-standard. Fix coming up



---

archive/issue_comments_510605.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-26T18:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_510606.json:
```json
{
    "body": "<a id='comment:69'></a>Replying to [comment:59 klee]:\n> But on my machine (mac), I get\n> \n> ```\n> $ ./configure --editable; make SAGE_CHECK=yes pypi-wheels\n> ```\n> Is this expected?\n\n\nDid you mean/do `--enable-editable`? For what it's worth, I tend to use `&&` rather than `;` between commands so if the first one fails, it doesn't continue to the second one.",
    "created_at": "2022-07-26T19:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510606",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:69'></a>Replying to [comment:59 klee]:
> But on my machine (mac), I get
> 
> ```
> $ ./configure --editable; make SAGE_CHECK=yes pypi-wheels
> ```
> Is this expected?


Did you mean/do `--enable-editable`? For what it's worth, I tend to use `&&` rather than `;` between commands so if the first one fails, it doesn't continue to the second one.



---

archive/issue_comments_510607.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+... as part of the workflow \\`build.yml\\`. This is to catch modularization regressions on tickets.\n+\n+To this end, we extend \\`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\\` scripts so that they build and store wheels in \\`SAGE_SPKG_WHEELS\\` (but do not install them!), and then run \\`tox\\` on the wheels (unless disabled by setting \\`SAGE_CHECK=no\\`).\n+\n+A new top-level make target \\`pypi-wheels\\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \\`configure --enable-editable\\` is in use.\n+\n+Another top-level make target \\`wheels\\` does the same but also includes \\`sage_conf\\` and \\`sagemath_standard\\`. This is useful for venv installs and helps with the problem noted in #32913.\n+\n+We also extend the script \\`src/bin/sage-update-version\\` so that it automatically updates the \\`install-requires.txt\\` files for our distribution packages. \n \n \n Comment: 1\n```\n",
    "created_at": "2022-07-26T19:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510607",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,12 @@
+... as part of the workflow \`build.yml\`. This is to catch modularization regressions on tickets.
+
+To this end, we extend \`build/pkgs/sagemath-{objects,categories,environment,repl}/spkg-install\` scripts so that they build and store wheels in \`SAGE_SPKG_WHEELS\` (but do not install them!), and then run \`tox\` on the wheels (unless disabled by setting \`SAGE_CHECK=no\`).
+
+A new top-level make target \`pypi-wheels\` runs these scripts for these and other small distribution packages, ensuring that wheels are present even if \`configure --enable-editable\` is in use.
+
+Another top-level make target \`wheels\` does the same but also includes \`sage_conf\` and \`sagemath_standard\`. This is useful for venv installs and helps with the problem noted in #32913.
+
+We also extend the script \`src/bin/sage-update-version\` so that it automatically updates the \`install-requires.txt\` files for our distribution packages. 
 
 
 Comment: 1
```




---

archive/issue_comments_510608.json:
```json
{
    "body": "<a id='comment:71'></a>Thanks. This `./configure --enable-editable && make pypi-wheels` now works well.\n\nThen I am positive with this ticket.",
    "created_at": "2022-07-27T00:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510608",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:71'></a>Thanks. This `./configure --enable-editable && make pypi-wheels` now works well.

Then I am positive with this ticket.



---

archive/issue_comments_510609.json:
```json
{
    "body": "<a id='comment:72'></a>Thank you!",
    "created_at": "2022-07-27T01:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510609",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>Thank you!



---

archive/issue_comments_510610.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-28T00:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510610",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088802.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-01T20:23:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33817#event-88802"
}
```



---

archive/issue_comments_510611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33817",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33817#issuecomment-510611",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
