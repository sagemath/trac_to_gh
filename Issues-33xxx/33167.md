# Issue 33167: Improve is_functional of lrs feature

archive/issues_032930.json:
```json
{
    "body": "From #33101#comment:3 :\n\n\"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*\"\n\n```\n## ------------------------------------------------------- ##\n## Checking whether SageMath should install SPKG lrslib... ##\n## ------------------------------------------------------- ##\nconfigure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG\nconfigure:30194: result: yes; install lrslib as well\nconfigure:30296: no suitable system package found for SPKG lrslib\n```\n\n---\n\nIn this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.\n\n\n\nCC:  @mwageringel @orlitzky\n\nReviewer: Matthias Koeppe\n\nAuthor: S\u00e9bastien Labb\u00e9, Markus Wageringel\n\nBranch: 16e1b241bff8e0485f773c7b420fd7b2fc4defa5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33167\n\n",
    "closed_at": "2022-02-13T10:17:10Z",
    "created_at": "2022-01-14T14:11:17Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Improve is_functional of lrs feature",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33167",
    "user": "https://github.com/seblabbe"
}
```
From #33101#comment:3 :

"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*"

```
## ------------------------------------------------------- ##
## Checking whether SageMath should install SPKG lrslib... ##
## ------------------------------------------------------- ##
configure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG
configure:30194: result: yes; install lrslib as well
configure:30296: no suitable system package found for SPKG lrslib
```

---

In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.



CC:  @mwageringel @orlitzky

Reviewer: Matthias Koeppe

Author: Sébastien Labbé, Markus Wageringel

Branch: 16e1b241bff8e0485f773c7b420fd7b2fc4defa5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33167





---

archive/issue_comments_501669.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2022-01-14T14:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501669",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_501670.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-14T14:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501670",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_501671.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-14T14:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_501672.json:
```json
{
    "body": "<a id='comment:3'></a>Forced push to rename the commit message to mention #33167 instead of #33101.",
    "created_at": "2022-01-14T14:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501672",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>Forced push to rename the commit message to mention #33167 instead of #33101.



---

archive/issue_comments_501673.json:
```json
{
    "body": "<a id='comment:4'></a>I wonder if we should not check both `lrs` and `lrsnash` executables in the same `is_functional` method. Maybe a `JoinFeature` would be better here, as it is done for instance for `graphviz`. What does the reviewer think?",
    "created_at": "2022-01-14T14:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501673",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>I wonder if we should not check both `lrs` and `lrsnash` executables in the same `is_functional` method. Maybe a `JoinFeature` would be better here, as it is done for instance for `graphviz`. What does the reviewer think?



---

archive/issue_comments_501674.json:
```json
{
    "body": "<a id='comment:5'></a>(this comment is copied from #33101#comment:19 where I originally posted the branch)\n\nFor now, I just imported the test made in the m4 file into the `is_functional` method. On my machine everything works, so I can not test it properly. If I made stuff correctly, the following should now return False for affected users like gh-mwageringel :\n\n```\nsage: from sage.features.lrs import Lrs\nsage: Lrs().is_present()\nFeatureTestResult('lrslib', True)\nsage: Lrs().is_functional()\nFeatureTestResult('lrslib', True)\n```",
    "created_at": "2022-01-14T14:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501674",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:5'></a>(this comment is copied from #33101#comment:19 where I originally posted the branch)

For now, I just imported the test made in the m4 file into the `is_functional` method. On my machine everything works, so I can not test it properly. If I made stuff correctly, the following should now return False for affected users like gh-mwageringel :

```
sage: from sage.features.lrs import Lrs
sage: Lrs().is_present()
FeatureTestResult('lrslib', True)
sage: Lrs().is_functional()
FeatureTestResult('lrslib', True)
```



---

archive/issue_comments_501675.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n \n ---\n \n-In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, than it is not picked up by sagemath at runtime or during doctests.\n+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.\n \n Comment: 1\n \n```\n",
    "created_at": "2022-01-14T16:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501675",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -13,7 +13,7 @@
 
 ---
 
-In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, than it is not picked up by sagemath at runtime or during doctests.
+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.
 
 Comment: 1
 
```




---

archive/issue_comments_501676.json:
```json
{
    "body": "<a id='comment:9'></a>Why do we need a feature for lrs at all when we have an optional package for it? If we simply remove the feature, the spkg-configure check will handle this, won't it?",
    "created_at": "2022-01-15T00:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501676",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>Why do we need a feature for lrs at all when we have an optional package for it? If we simply remove the feature, the spkg-configure check will handle this, won't it?



---

archive/issue_comments_501677.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 mjo]:\n> Why do we need a feature for lrs at all when we have an optional package for it? If we simply remove the feature, the spkg-configure check will handle this, won't it?\n\n\nNevermind, I found #30746.",
    "created_at": "2022-01-15T03:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501677",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>Replying to [comment:9 mjo]:
> Why do we need a feature for lrs at all when we have an optional package for it? If we simply remove the feature, the spkg-configure check will handle this, won't it?


Nevermind, I found #30746.



---

archive/issue_comments_501678.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:5 slabbe]:\n> For now, I just imported the test made in the m4 file into the `is_functional` method. On my machine everything works, so I can not test it properly. If I made stuff correctly, the following should now return False for affected users like gh-mwageringel :\n\n\nThis is not the case, I am afraid. I get the same output:\n\n```\nsage: from sage.features.lrs import Lrs\nsage: Lrs().is_present()\nFeatureTestResult('lrslib', True)\nsage: Lrs().is_functional()\nFeatureTestResult('lrslib', True)\n```\nMy system lrslib seems to be mostly functional, as all the doctests apart from #33101 pass. But it is rejected by the .m4 file because of the dependency on flint \u2013 my Sage builds its own flint, so would also build its own lrslib.",
    "created_at": "2022-01-15T12:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501678",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:11'></a>Replying to [comment:5 slabbe]:
> For now, I just imported the test made in the m4 file into the `is_functional` method. On my machine everything works, so I can not test it properly. If I made stuff correctly, the following should now return False for affected users like gh-mwageringel :


This is not the case, I am afraid. I get the same output:

```
sage: from sage.features.lrs import Lrs
sage: Lrs().is_present()
FeatureTestResult('lrslib', True)
sage: Lrs().is_functional()
FeatureTestResult('lrslib', True)
```
My system lrslib seems to be mostly functional, as all the doctests apart from #33101 pass. But it is rejected by the .m4 file because of the dependency on flint – my Sage builds its own flint, so would also build its own lrslib.



---

archive/issue_comments_501679.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 gh-mwageringel]:\n> My system lrslib seems to be mostly functional, as all the doctests apart from #33101 pass. But it is rejected by the .m4 file because of the dependency on flint \u2013 my Sage builds its own flint, so would also build its own lrslib.\n\n\nThis is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.",
    "created_at": "2022-01-15T14:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501679",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>Replying to [comment:11 gh-mwageringel]:
> My system lrslib seems to be mostly functional, as all the doctests apart from #33101 pass. But it is rejected by the .m4 file because of the dependency on flint – my Sage builds its own flint, so would also build its own lrslib.


This is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.



---

archive/issue_comments_501680.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 mjo]:\n> Replying to [comment:11 gh-mwageringel]:\n> This is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.\n\n\nYes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. Now it works as I would expect \u2013 this is the relevant output of configure:\n\n```\nChecking whether SageMath should install SPKG lrslib...\nchecking for lrsnash... lrsnash\nchecking whether lrsnash can handle the new input format... yes\nconfigure: will use system package and not install SPKG lrslib\n```\nThis is the first time I have edited an .m4 file, so I hope I did not break anything.\n\nBesides that, I have removed a `print` call from the `is_functional` check which was probably not intended in the first place.\n\n---\nNew commits:",
    "created_at": "2022-01-17T20:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501680",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:13'></a>Replying to [comment:12 mjo]:
> Replying to [comment:11 gh-mwageringel]:
> This is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.


Yes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. Now it works as I would expect – this is the relevant output of configure:

```
Checking whether SageMath should install SPKG lrslib...
checking for lrsnash... lrsnash
checking whether lrsnash can handle the new input format... yes
configure: will use system package and not install SPKG lrslib
```
This is the first time I have edited an .m4 file, so I hope I did not break anything.

Besides that, I have removed a `print` call from the `is_functional` check which was probably not intended in the first place.

---
New commits:



---

archive/issue_comments_501681.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+From #33101#comment:3 :\n \n+\"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*\"\n+\n+```\n+## ------------------------------------------------------- ##\n+## Checking whether SageMath should install SPKG lrslib... ##\n+## ------------------------------------------------------- ##\n+configure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG\n+configure:30194: result: yes; install lrslib as well\n+configure:30296: no suitable system package found for SPKG lrslib\n+```\n+\n+---\n+\n+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.\n+\n+Additionally, we remove the check for gmp/flint from the `spkg-configure.m4` for lrslib, as Sage only uses the lrs and lrsnash binaries.\n \n Comment: 1\n \n```\n",
    "created_at": "2022-01-17T20:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501681",
    "user": "https://github.com/mwageringel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,21 @@
+From #33101#comment:3 :
 
+"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*"
+
+```
+## ------------------------------------------------------- ##
+## Checking whether SageMath should install SPKG lrslib... ##
+## ------------------------------------------------------- ##
+configure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG
+configure:30194: result: yes; install lrslib as well
+configure:30296: no suitable system package found for SPKG lrslib
+```
+
+---
+
+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.
+
+Additionally, we remove the check for gmp/flint from the `spkg-configure.m4` for lrslib, as Sage only uses the lrs and lrsnash binaries.
 
 Comment: 1
 
```




---

archive/issue_comments_501682.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 gh-mwageringel]:\n> This is the first time I have edited an .m4 file, so I hope I did not break anything.\n\n\nIt looks like you deleted the `DEPCHECK` line and its matching `])`, and then un-indented the stuff between? That should be right.\n\nm4 and the `./configure` script are all \"stringly typed,\" so really the only way we have of testing is to run `./configure` in every configuration and watch the output.",
    "created_at": "2022-01-18T00:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501682",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>Replying to [comment:13 gh-mwageringel]:
> This is the first time I have edited an .m4 file, so I hope I did not break anything.


It looks like you deleted the `DEPCHECK` line and its matching `])`, and then un-indented the stuff between? That should be right.

m4 and the `./configure` script are all "stringly typed," so really the only way we have of testing is to run `./configure` in every configuration and watch the output.



---

archive/issue_comments_501683.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 mjo]:\n> It looks like you deleted the `DEPCHECK` line and its matching `])`, and then un-indented the stuff between?\n\n\nYes, exactly.\n\n> m4 and the `./configure` script are all \"stringly typed,\" so really the only way we have of testing is to run `./configure` in every configuration and watch the output.\n\n\nFor another data point, I have tested this by replacing the lrsnash binary by a non-functional one, which also leads to the intended result:\n\n```\nChecking whether SageMath should install SPKG lrslib...\nchecking for lrsnash... lrsnash\nchecking whether lrsnash can handle the new input format... no\nconfigure: no suitable system package found for SPKG lrslib\n```",
    "created_at": "2022-01-19T18:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501683",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:16'></a>Replying to [comment:15 mjo]:
> It looks like you deleted the `DEPCHECK` line and its matching `])`, and then un-indented the stuff between?


Yes, exactly.

> m4 and the `./configure` script are all "stringly typed," so really the only way we have of testing is to run `./configure` in every configuration and watch the output.


For another data point, I have tested this by replacing the lrsnash binary by a non-functional one, which also leads to the intended result:

```
Checking whether SageMath should install SPKG lrslib...
checking for lrsnash... lrsnash
checking whether lrsnash can handle the new input format... no
configure: no suitable system package found for SPKG lrslib
```



---

archive/issue_comments_501684.json:
```json
{
    "body": "<a id='comment:17'></a>Since I saw the problem described in #33231, I wonder if the line\n\n```\nresult = subprocess.run(command, capture_output=True, text=True)\n```\nshould be put inside of a `try` to catch `OSError` type of failures?",
    "created_at": "2022-01-26T20:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501684",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:17'></a>Since I saw the problem described in #33231, I wonder if the line

```
result = subprocess.run(command, capture_output=True, text=True)
```
should be put inside of a `try` to catch `OSError` type of failures?



---

archive/issue_comments_501685.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 slabbe]:\n> Since I saw the problem described in #33231, I wonder if the line\n> \n> ```\n> result = subprocess.run(command, capture_output=True, text=True)\n> ```\n> should be put inside of a `try` to catch `OSError` type of failures?\n\n\nYeah, just about anything can go wrong. Another example:\n\n```\nsage: from sage.features.imagemagick import ImageMagick\nsage: ImageMagick().is_functional()\n...\nPermissionError: [Errno 13] Permission denied: 'convert'\n```\n\nOr with a dangling symlink from graphicsmagick,\n\n```\n...\nFileNotFoundError: [Errno 2] No such file or directory: 'convert'\n```\n\nThese aren't normal scenarios, but if there's no way to disable the check, the test suite can't crash whenever e.g. someone installs a broken tool in `/usr/local/bin`.",
    "created_at": "2022-01-27T01:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501685",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>Replying to [comment:17 slabbe]:
> Since I saw the problem described in #33231, I wonder if the line
> 
> ```
> result = subprocess.run(command, capture_output=True, text=True)
> ```
> should be put inside of a `try` to catch `OSError` type of failures?


Yeah, just about anything can go wrong. Another example:

```
sage: from sage.features.imagemagick import ImageMagick
sage: ImageMagick().is_functional()
...
PermissionError: [Errno 13] Permission denied: 'convert'
```

Or with a dangling symlink from graphicsmagick,

```
...
FileNotFoundError: [Errno 2] No such file or directory: 'convert'
```

These aren't normal scenarios, but if there's no way to disable the check, the test suite can't crash whenever e.g. someone installs a broken tool in `/usr/local/bin`.



---

archive/issue_comments_501686.json:
```json
{
    "body": "<a id='comment:19'></a>I am now wondering if it should be a join feature instead.\n\n---\nNew commits:",
    "created_at": "2022-01-27T08:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501686",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:19'></a>I am now wondering if it should be a join feature instead.

---
New commits:



---

archive/issue_comments_501687.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-27T14:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_501688.json:
```json
{
    "body": "<a id='comment:21'></a>I made an error in the commit message. I just force-pushed the last commit.",
    "created_at": "2022-01-27T14:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501688",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:21'></a>I made an error in the commit message. I just force-pushed the last commit.



---

archive/issue_comments_501689.json:
```json
{
    "body": "<a id='comment:22'></a>Set milestone to sage-9.6 after Sage 9.5 release.",
    "created_at": "2022-01-30T15:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501689",
    "user": "https://github.com/slel"
}
```

<a id='comment:22'></a>Set milestone to sage-9.6 after Sage 9.5 release.



---

archive/issue_events_087626.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:44:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33167#event-87626"
}
```



---

archive/issue_comments_501690.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-03T00:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501690",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_501691.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:13 gh-mwageringel]:\n> Replying to [comment:12 mjo]:\n> > Replying to [comment:11 gh-mwageringel]:\n> > This is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.\n\n> \n> Yes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. \n\n\nI don't like this change. `polymake` does using lrslib as a library. This is why we need the DEPCHECK.",
    "created_at": "2022-02-03T00:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501691",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Replying to [comment:13 gh-mwageringel]:
> Replying to [comment:12 mjo]:
> > Replying to [comment:11 gh-mwageringel]:
> > This is probably a mistake in the `spkg-configure.m4` for lrslib. If all we do is run the executables from lrslib, we don't care if they're linked to a mismatched version of flint/gmp.

> 
> Yes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. 


I don't like this change. `polymake` does using lrslib as a library. This is why we need the DEPCHECK.



---

archive/issue_comments_501692.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 mkoeppe]:\n> > \n> > Yes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. \n\n> \n> I don't like this change. `polymake` does using lrslib as a library. This is why we need the DEPCHECK.\n> \n\n\nDo we link against polymake?",
    "created_at": "2022-02-03T01:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501692",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>Replying to [comment:23 mkoeppe]:
> > 
> > Yes, this seems to be the case. I have removed the check for gmp/flint from the .m4 file. 

> 
> I don't like this change. `polymake` does using lrslib as a library. This is why we need the DEPCHECK.
> 


Do we link against polymake?



---

archive/issue_comments_501693.json:
```json
{
    "body": "<a id='comment:25'></a>Yes",
    "created_at": "2022-02-03T01:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501693",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Yes



---

archive/issue_comments_501694.json:
```json
{
    "body": "<a id='comment:26'></a>Ok, I guess put it back then. A comment would be nice too. We can't expect people to be aware of all second-order optional reverse dependencies when reading these files.",
    "created_at": "2022-02-03T01:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501694",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:26'></a>Ok, I guess put it back then. A comment would be nice too. We can't expect people to be aware of all second-order optional reverse dependencies when reading these files.



---

archive/issue_comments_501695.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mjo]:\n> Ok, I guess put it back then. A comment would be nice too.\n\n\nI have removed the respective commit from the branch and added a comment instead in the last commit.\n\n---\nNew commits:",
    "created_at": "2022-02-03T08:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501695",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:27'></a>Replying to [comment:26 mjo]:
> Ok, I guess put it back then. A comment would be nice too.


I have removed the respective commit from the branch and added a comment instead in the last commit.

---
New commits:



---

archive/issue_comments_501696.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-03T08:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501696",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_501697.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+From #33101#comment:3 :\n+\n+\"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*\"\n+\n+```\n+## ------------------------------------------------------- ##\n+## Checking whether SageMath should install SPKG lrslib... ##\n+## ------------------------------------------------------- ##\n+configure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG\n+configure:30194: result: yes; install lrslib as well\n+configure:30296: no suitable system package found for SPKG lrslib\n+```\n+\n+---\n+\n+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2022-02-03T17:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501697",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,20 @@
+From #33101#comment:3 :
+
+"*This was after a distclean. I had not explicitly installed lrslib, it was on the system. If I understand the config.log correctly, the system lrslib was not accepted by Sage. Yet, ptestlong runs the optional lrslib tests.*"
+
+```
+## ------------------------------------------------------- ##
+## Checking whether SageMath should install SPKG lrslib... ##
+## ------------------------------------------------------- ##
+configure:30190: checking whether any of gmp flint is installed as or will be installed as SPKG
+configure:30194: result: yes; install lrslib as well
+configure:30296: no suitable system package found for SPKG lrslib
+```
+
+---
+
+In this ticket, we add to the `is_functional` method a check corresponding to the check made in `build/pkgs/lrslib/spkg-configure.m4` so that if `lrslib` is not picked up by sagemath at configuration/build time, then it is not picked up by sagemath at runtime or during doctests.
+
 
 
 Comment: 1
```




---

archive/issue_comments_501698.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-03T17:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501698",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_501699.json:
```json
{
    "body": "<a id='comment:30'></a>Thanks.",
    "created_at": "2022-02-05T12:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501699",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:30'></a>Thanks.



---

archive/issue_events_087627.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-13T10:17:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33167#event-87627"
}
```



---

archive/issue_comments_501700.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-13T10:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501700",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_501701.json:
```json
{
    "body": "<a id='comment:32'></a>Follow-up: #33466",
    "created_at": "2022-03-05T20:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33167#issuecomment-501701",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Follow-up: #33466
