# Issue 33056: conda-forge-standard: Runtime error in sage.libs.giac

archive/issues_032819.json:
```json
{
    "body": "... while docbuilding\n\n```\n[sagemath_doc_html-none] Traceback (most recent call last):\n[sagemath_doc_html-none]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143102)\n[sagemath_doc_html-none]     result=GIAC_protecteval(self.gptr[0],giacsettings.eval_level,context_ptr)\n[sagemath_doc_html-none]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10554)\n[sagemath_doc_html-none]     return (self.cas_setup()[7][3])._val\n[sagemath_doc_html-none]   File \"sage/libs/giac/giac.pyx\", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142533)\n[sagemath_doc_html-none]     ans=Pygen(cmd).eval()\n[sagemath_doc_html-none]   File \"sage/libs/giac/giac.pyx\", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143178)\n[sagemath_doc_html-none]     raise RuntimeError\n[sagemath_doc_html-none] RuntimeError\n[sagemath_doc_html-none] \n[sagemath_doc_html-none] During handling of the above exception, another exception occurred:\n[sagemath_doc_html-none] \n```\n\n\n(Previously reported in ticket:32087#comment:33)\n\n\nAlso various giac-related errors in doctests.\n\n```\nFile \"src/sage/functions/other.py\", line 1803, in sage.functions.other.Function_prod.__init__\nFailed example:\n    giac(sprod(m, m, 1, n)).sage()\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 516, in _start\n        self._expect.expect(self._prompt)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py\", line 343, in expect\n        return self.expect_list(compiled_pattern_list,\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py\", line 372, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py\", line 179, in expect_loop\n        return self.eof(e)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py\", line 122, in eof\n        raise exc\n    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.\n    Giac with PID 33060 running /opt/conda/bin/giac --sage\n    command: /opt/conda/bin/giac\n    args: ['/opt/conda/bin/giac', '--sage']\n    buffer (last 100 chars): b''\n    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n    after: <class 'pexpect.exceptions.EOF'>\n    match: None\n    match_index: None\n    exitstatus: None\n    flag_eof: True\n    pid: 33060\n    child_fd: 64\n    closed: False\n    timeout: None\n    delimiter: <class 'pexpect.exceptions.EOF'>\n    logfile: None\n    logfile_read: None\n    logfile_send: None\n    maxread: 4194304\n    ignorecase: False\n    searchwindowsize: None\n    delaybeforesend: None\n    delayafterclose: 0.1\n    delayafterterminate: 0.1\n    searcher: searcher_re:\n        0: re.compile(b'[0-9]*>> ')\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1470, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 513, in _create\n        self.set(name, value)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 666, in set\n        out = self.eval(cmd)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 650, in eval\n        ans = Expect.eval(self, code, strip=strip, **kwds).strip()\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1382, in eval\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1382, in <listcomp>\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 616, in _eval_line\n        z = Expect._eval_line(self, line, allow_use_file=allow_use_file,\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 948, in _eval_line\n        self._start()\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 520, in _start\n        raise RuntimeError(\"unable to start %s: %s\" % (self.name(), msg))\n    RuntimeError: unable to start giac: End Of File (EOF). Exception style platform.\n    Giac with PID 33060 running /opt/conda/bin/giac --sage\n    command: /opt/conda/bin/giac\n    args: ['/opt/conda/bin/giac', '--sage']\n    buffer (last 100 chars): b''\n    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n    after: <class 'pexpect.exceptions.EOF'>\n    match: None\n    match_index: None\n    exitstatus: None\n    flag_eof: True\n    pid: 33060\n    child_fd: 64\n    closed: False\n    timeout: None\n    delimiter: <class 'pexpect.exceptions.EOF'>\n    logfile: None\n    logfile_read: None\n    logfile_send: None\n    maxread: 4194304\n    ignorecase: False\n    searchwindowsize: None\n    delaybeforesend: None\n    delayafterclose: 0.1\n    delayafterterminate: 0.1\n    searcher: searcher_re:\n        0: re.compile(b'[0-9]*>> ')\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.other.Function_prod.__init__[5]>\", line 1, in <module>\n        giac(sprod(m, m, Integer(1), n)).sage()\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 302, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 330, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage/structure/sage_object.pyx\", line 782, in sage.structure.sage_object.SageObject._giac_ (build/cythonized/sage/structure/sage_object.c:7937)\n        return self._interface_(G)\n      File \"sage/symbolic/expression.pyx\", line 1204, in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:35138)\n        return super(Expression, self)._interface_(I)\n      File \"sage/structure/sage_object.pyx\", line 694, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5783)\n        X = I(s)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n        return cls(self, x, name=name)\n      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1475, in __init__\n        raise TypeError(*x.args)\n    TypeError: unable to start giac: End Of File (EOF). Exception style platform.\n    Giac with PID 33060 running /opt/conda/bin/giac --sage\n    command: /opt/conda/bin/giac\n    args: ['/opt/conda/bin/giac', '--sage']\n    buffer (last 100 chars): b''\n    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n    after: <class 'pexpect.exceptions.EOF'>\n    match: None\n    match_index: None\n    exitstatus: None\n    flag_eof: True\n    pid: 33060\n    child_fd: 64\n    closed: False\n    timeout: None\n    delimiter: <class 'pexpect.exceptions.EOF'>\n    logfile: None\n    logfile_read: None\n    logfile_send: None\n    maxread: 4194304\n    ignorecase: False\n    searchwindowsize: None\n    delaybeforesend: None\n    delayafterclose: 0.1\n    delayafterterminate: 0.1\n    searcher: searcher_re:\n        0: re.compile(b'[0-9]*>> ')\n```\n\n**CC:**  @isuruf @kiwifb @dimpase @videlec\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Reviewer:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/33056\n\n",
    "closed_at": "2022-02-20T14:33:43Z",
    "created_at": "2021-12-21T05:06:12Z",
    "labels": [
        "component: porting",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "conda-forge-standard: Runtime error in sage.libs.giac",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33056",
    "user": "https://github.com/mkoeppe"
}
```
... while docbuilding

```
[sagemath_doc_html-none] Traceback (most recent call last):
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143102)
[sagemath_doc_html-none]     result=GIAC_protecteval(self.gptr[0],giacsettings.eval_level,context_ptr)
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10554)
[sagemath_doc_html-none]     return (self.cas_setup()[7][3])._val
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142533)
[sagemath_doc_html-none]     ans=Pygen(cmd).eval()
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143178)
[sagemath_doc_html-none]     raise RuntimeError
[sagemath_doc_html-none] RuntimeError
[sagemath_doc_html-none] 
[sagemath_doc_html-none] During handling of the above exception, another exception occurred:
[sagemath_doc_html-none] 
```


(Previously reported in ticket:32087#comment:33)


Also various giac-related errors in doctests.

```
File "src/sage/functions/other.py", line 1803, in sage.functions.other.Function_prod.__init__
Failed example:
    giac(sprod(m, m, 1, n)).sage()
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 516, in _start
        self._expect.expect(self._prompt)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py", line 343, in expect
        return self.expect_list(compiled_pattern_list,
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py", line 372, in expect_list
        return exp.expect_loop(timeout)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py", line 179, in expect_loop
        return self.eof(e)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py", line 122, in eof
        raise exc
    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.
    Giac with PID 33060 running /opt/conda/bin/giac --sage
    command: /opt/conda/bin/giac
    args: ['/opt/conda/bin/giac', '--sage']
    buffer (last 100 chars): b''
    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
    after: <class 'pexpect.exceptions.EOF'>
    match: None
    match_index: None
    exitstatus: None
    flag_eof: True
    pid: 33060
    child_fd: 64
    closed: False
    timeout: None
    delimiter: <class 'pexpect.exceptions.EOF'>
    logfile: None
    logfile_read: None
    logfile_send: None
    maxread: 4194304
    ignorecase: False
    searchwindowsize: None
    delaybeforesend: None
    delayafterclose: 0.1
    delayafterterminate: 0.1
    searcher: searcher_re:
        0: re.compile(b'[0-9]*>> ')

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1470, in __init__
        self._name = parent._create(value, name=name)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 513, in _create
        self.set(name, value)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 666, in set
        out = self.eval(cmd)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 650, in eval
        ans = Expect.eval(self, code, strip=strip, **kwds).strip()
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1382, in eval
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1382, in <listcomp>
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 616, in _eval_line
        z = Expect._eval_line(self, line, allow_use_file=allow_use_file,
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 948, in _eval_line
        self._start()
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 520, in _start
        raise RuntimeError("unable to start %s: %s" % (self.name(), msg))
    RuntimeError: unable to start giac: End Of File (EOF). Exception style platform.
    Giac with PID 33060 running /opt/conda/bin/giac --sage
    command: /opt/conda/bin/giac
    args: ['/opt/conda/bin/giac', '--sage']
    buffer (last 100 chars): b''
    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
    after: <class 'pexpect.exceptions.EOF'>
    match: None
    match_index: None
    exitstatus: None
    flag_eof: True
    pid: 33060
    child_fd: 64
    closed: False
    timeout: None
    delimiter: <class 'pexpect.exceptions.EOF'>
    logfile: None
    logfile_read: None
    logfile_send: None
    maxread: 4194304
    ignorecase: False
    searchwindowsize: None
    delaybeforesend: None
    delayafterclose: 0.1
    delayafterterminate: 0.1
    searcher: searcher_re:
        0: re.compile(b'[0-9]*>> ')

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.other.Function_prod.__init__[5]>", line 1, in <module>
        giac(sprod(m, m, Integer(1), n)).sage()
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 302, in __call__
        result = self._coerce_from_special_method(x)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 330, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage/structure/sage_object.pyx", line 782, in sage.structure.sage_object.SageObject._giac_ (build/cythonized/sage/structure/sage_object.c:7937)
        return self._interface_(G)
      File "sage/symbolic/expression.pyx", line 1204, in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:35138)
        return super(Expression, self)._interface_(I)
      File "sage/structure/sage_object.pyx", line 694, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5783)
        X = I(s)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 295, in __call__
        return cls(self, x, name=name)
      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1475, in __init__
        raise TypeError(*x.args)
    TypeError: unable to start giac: End Of File (EOF). Exception style platform.
    Giac with PID 33060 running /opt/conda/bin/giac --sage
    command: /opt/conda/bin/giac
    args: ['/opt/conda/bin/giac', '--sage']
    buffer (last 100 chars): b''
    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
    after: <class 'pexpect.exceptions.EOF'>
    match: None
    match_index: None
    exitstatus: None
    flag_eof: True
    pid: 33060
    child_fd: 64
    closed: False
    timeout: None
    delimiter: <class 'pexpect.exceptions.EOF'>
    logfile: None
    logfile_read: None
    logfile_send: None
    maxread: 4194304
    ignorecase: False
    searchwindowsize: None
    delaybeforesend: None
    delayafterclose: 0.1
    delayafterterminate: 0.1
    searcher: searcher_re:
        0: re.compile(b'[0-9]*>> ')
```

**CC:**  @isuruf @kiwifb @dimpase @videlec

**Upstream:** Fixed upstream, in a later stable release.

**Reviewer:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/33056





---

archive/issue_comments_629046.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,3 +19,5 @@\n \n (Previously reported in ticket:32087#comment:33)\n \n+\n+Also various giac-related errors in doctests.\n``````\n",
    "created_at": "2021-12-21T05:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629046",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,3 +19,5 @@
 
 (Previously reported in ticket:32087#comment:33)
 
+
+Also various giac-related errors in doctests.
``````




---

archive/issue_comments_629047.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,3 +21,148 @@\n \n \n Also various giac-related errors in doctests.\n+\n+```\n+File \"src/sage/functions/other.py\", line 1803, in sage.functions.other.Function_prod.__init__\n+Failed example:\n+    giac(sprod(m, m, 1, n)).sage()\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 516, in _start\n+        self._expect.expect(self._prompt)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py\", line 343, in expect\n+        return self.expect_list(compiled_pattern_list,\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py\", line 372, in expect_list\n+        return exp.expect_loop(timeout)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py\", line 179, in expect_loop\n+        return self.eof(e)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py\", line 122, in eof\n+        raise exc\n+    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.\n+    Giac with PID 33060 running /opt/conda/bin/giac --sage\n+    command: /opt/conda/bin/giac\n+    args: ['/opt/conda/bin/giac', '--sage']\n+    buffer (last 100 chars): b''\n+    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n+    after: <class 'pexpect.exceptions.EOF'>\n+    match: None\n+    match_index: None\n+    exitstatus: None\n+    flag_eof: True\n+    pid: 33060\n+    child_fd: 64\n+    closed: False\n+    timeout: None\n+    delimiter: <class 'pexpect.exceptions.EOF'>\n+    logfile: None\n+    logfile_read: None\n+    logfile_send: None\n+    maxread: 4194304\n+    ignorecase: False\n+    searchwindowsize: None\n+    delaybeforesend: None\n+    delayafterclose: 0.1\n+    delayafterterminate: 0.1\n+    searcher: searcher_re:\n+        0: re.compile(b'[0-9]*>> ')\n+\n+    During handling of the above exception, another exception occurred:\n+\n+    Traceback (most recent call last):\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1470, in __init__\n+        self._name = parent._create(value, name=name)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 513, in _create\n+        self.set(name, value)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 666, in set\n+        out = self.eval(cmd)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 650, in eval\n+        ans = Expect.eval(self, code, strip=strip, **kwds).strip()\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1382, in eval\n+        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1382, in <listcomp>\n+        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py\", line 616, in _eval_line\n+        z = Expect._eval_line(self, line, allow_use_file=allow_use_file,\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 948, in _eval_line\n+        self._start()\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 520, in _start\n+        raise RuntimeError(\"unable to start %s: %s\" % (self.name(), msg))\n+    RuntimeError: unable to start giac: End Of File (EOF). Exception style platform.\n+    Giac with PID 33060 running /opt/conda/bin/giac --sage\n+    command: /opt/conda/bin/giac\n+    args: ['/opt/conda/bin/giac', '--sage']\n+    buffer (last 100 chars): b''\n+    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n+    after: <class 'pexpect.exceptions.EOF'>\n+    match: None\n+    match_index: None\n+    exitstatus: None\n+    flag_eof: True\n+    pid: 33060\n+    child_fd: 64\n+    closed: False\n+    timeout: None\n+    delimiter: <class 'pexpect.exceptions.EOF'>\n+    logfile: None\n+    logfile_read: None\n+    logfile_send: None\n+    maxread: 4194304\n+    ignorecase: False\n+    searchwindowsize: None\n+    delaybeforesend: None\n+    delayafterclose: 0.1\n+    delayafterterminate: 0.1\n+    searcher: searcher_re:\n+        0: re.compile(b'[0-9]*>> ')\n+\n+    During handling of the above exception, another exception occurred:\n+\n+    Traceback (most recent call last):\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.functions.other.Function_prod.__init__[5]>\", line 1, in <module>\n+        giac(sprod(m, m, Integer(1), n)).sage()\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 302, in __call__\n+        result = self._coerce_from_special_method(x)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 330, in _coerce_from_special_method\n+        return (x.__getattribute__(s))(self)\n+      File \"sage/structure/sage_object.pyx\", line 782, in sage.structure.sage_object.SageObject._giac_ (build/cythonized/sage/structure/sage_object.c:7937)\n+        return self._interface_(G)\n+      File \"sage/symbolic/expression.pyx\", line 1204, in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:35138)\n+        return super(Expression, self)._interface_(I)\n+      File \"sage/structure/sage_object.pyx\", line 694, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5783)\n+        X = I(s)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n+        return cls(self, x, name=name)\n+      File \"/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py\", line 1475, in __init__\n+        raise TypeError(*x.args)\n+    TypeError: unable to start giac: End Of File (EOF). Exception style platform.\n+    Giac with PID 33060 running /opt/conda/bin/giac --sage\n+    command: /opt/conda/bin/giac\n+    args: ['/opt/conda/bin/giac', '--sage']\n+    buffer (last 100 chars): b''\n+    before (last 100 chars): b'// Maximum number of parallel threads 10\\r\\nWarning adding 1 ) at end of input\\r\\n'\n+    after: <class 'pexpect.exceptions.EOF'>\n+    match: None\n+    match_index: None\n+    exitstatus: None\n+    flag_eof: True\n+    pid: 33060\n+    child_fd: 64\n+    closed: False\n+    timeout: None\n+    delimiter: <class 'pexpect.exceptions.EOF'>\n+    logfile: None\n+    logfile_read: None\n+    logfile_send: None\n+    maxread: 4194304\n+    ignorecase: False\n+    searchwindowsize: None\n+    delaybeforesend: None\n+    delayafterclose: 0.1\n+    delayafterterminate: 0.1\n+    searcher: searcher_re:\n+        0: re.compile(b'[0-9]*>> ')\n+```\n``````\n",
    "created_at": "2021-12-21T05:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629047",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,3 +21,148 @@
 
 
 Also various giac-related errors in doctests.
+
+```
+File "src/sage/functions/other.py", line 1803, in sage.functions.other.Function_prod.__init__
+Failed example:
+    giac(sprod(m, m, 1, n)).sage()
+Exception raised:
+    Traceback (most recent call last):
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 516, in _start
+        self._expect.expect(self._prompt)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py", line 343, in expect
+        return self.expect_list(compiled_pattern_list,
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/spawnbase.py", line 372, in expect_list
+        return exp.expect_loop(timeout)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py", line 179, in expect_loop
+        return self.eof(e)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pexpect/expect.py", line 122, in eof
+        raise exc
+    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.
+    Giac with PID 33060 running /opt/conda/bin/giac --sage
+    command: /opt/conda/bin/giac
+    args: ['/opt/conda/bin/giac', '--sage']
+    buffer (last 100 chars): b''
+    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
+    after: <class 'pexpect.exceptions.EOF'>
+    match: None
+    match_index: None
+    exitstatus: None
+    flag_eof: True
+    pid: 33060
+    child_fd: 64
+    closed: False
+    timeout: None
+    delimiter: <class 'pexpect.exceptions.EOF'>
+    logfile: None
+    logfile_read: None
+    logfile_send: None
+    maxread: 4194304
+    ignorecase: False
+    searchwindowsize: None
+    delaybeforesend: None
+    delayafterclose: 0.1
+    delayafterterminate: 0.1
+    searcher: searcher_re:
+        0: re.compile(b'[0-9]*>> ')
+
+    During handling of the above exception, another exception occurred:
+
+    Traceback (most recent call last):
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1470, in __init__
+        self._name = parent._create(value, name=name)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 513, in _create
+        self.set(name, value)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 666, in set
+        out = self.eval(cmd)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 650, in eval
+        ans = Expect.eval(self, code, strip=strip, **kwds).strip()
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1382, in eval
+        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1382, in <listcomp>
+        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/giac.py", line 616, in _eval_line
+        z = Expect._eval_line(self, line, allow_use_file=allow_use_file,
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 948, in _eval_line
+        self._start()
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 520, in _start
+        raise RuntimeError("unable to start %s: %s" % (self.name(), msg))
+    RuntimeError: unable to start giac: End Of File (EOF). Exception style platform.
+    Giac with PID 33060 running /opt/conda/bin/giac --sage
+    command: /opt/conda/bin/giac
+    args: ['/opt/conda/bin/giac', '--sage']
+    buffer (last 100 chars): b''
+    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
+    after: <class 'pexpect.exceptions.EOF'>
+    match: None
+    match_index: None
+    exitstatus: None
+    flag_eof: True
+    pid: 33060
+    child_fd: 64
+    closed: False
+    timeout: None
+    delimiter: <class 'pexpect.exceptions.EOF'>
+    logfile: None
+    logfile_read: None
+    logfile_send: None
+    maxread: 4194304
+    ignorecase: False
+    searchwindowsize: None
+    delaybeforesend: None
+    delayafterclose: 0.1
+    delayafterterminate: 0.1
+    searcher: searcher_re:
+        0: re.compile(b'[0-9]*>> ')
+
+    During handling of the above exception, another exception occurred:
+
+    Traceback (most recent call last):
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.functions.other.Function_prod.__init__[5]>", line 1, in <module>
+        giac(sprod(m, m, Integer(1), n)).sage()
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 302, in __call__
+        result = self._coerce_from_special_method(x)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 330, in _coerce_from_special_method
+        return (x.__getattribute__(s))(self)
+      File "sage/structure/sage_object.pyx", line 782, in sage.structure.sage_object.SageObject._giac_ (build/cythonized/sage/structure/sage_object.c:7937)
+        return self._interface_(G)
+      File "sage/symbolic/expression.pyx", line 1204, in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:35138)
+        return super(Expression, self)._interface_(I)
+      File "sage/structure/sage_object.pyx", line 694, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5783)
+        X = I(s)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/interface.py", line 295, in __call__
+        return cls(self, x, name=name)
+      File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/interfaces/expect.py", line 1475, in __init__
+        raise TypeError(*x.args)
+    TypeError: unable to start giac: End Of File (EOF). Exception style platform.
+    Giac with PID 33060 running /opt/conda/bin/giac --sage
+    command: /opt/conda/bin/giac
+    args: ['/opt/conda/bin/giac', '--sage']
+    buffer (last 100 chars): b''
+    before (last 100 chars): b'// Maximum number of parallel threads 10\r\nWarning adding 1 ) at end of input\r\n'
+    after: <class 'pexpect.exceptions.EOF'>
+    match: None
+    match_index: None
+    exitstatus: None
+    flag_eof: True
+    pid: 33060
+    child_fd: 64
+    closed: False
+    timeout: None
+    delimiter: <class 'pexpect.exceptions.EOF'>
+    logfile: None
+    logfile_read: None
+    logfile_send: None
+    maxread: 4194304
+    ignorecase: False
+    searchwindowsize: None
+    delaybeforesend: None
+    delayafterclose: 0.1
+    delayafterterminate: 0.1
+    searcher: searcher_re:
+        0: re.compile(b'[0-9]*>> ')
+```
``````




---

archive/issue_comments_629048.json:
```json
{
    "body": "<a id='comment:3'></a>\nDoes `giac` even start and work on that machine - without going through sage.",
    "created_at": "2021-12-21T06:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629048",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Does `giac` even start and work on that machine - without going through sage.



---

archive/issue_comments_629049.json:
```json
{
    "body": "<a id='comment:4'></a>\nNo, it looks it's broken\n\n```\n(base) root@a22492f2faa5:/sage# which giac\n/opt/conda/bin/giac\n(base) root@a22492f2faa5:/sage# giac\n// Maximum number of parallel threads 10\nWarning adding 1 ) at end of input\nSegmentation fault\n```\n\n(This is an image built with `tox -e docker-conda-forge-standard`)",
    "created_at": "2021-12-21T06:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629049",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
No, it looks it's broken

```
(base) root@a22492f2faa5:/sage# which giac
/opt/conda/bin/giac
(base) root@a22492f2faa5:/sage# giac
// Maximum number of parallel threads 10
Warning adding 1 ) at end of input
Segmentation fault
```

(This is an image built with `tox -e docker-conda-forge-standard`)



---

archive/issue_comments_629050.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK, that's one suspicion correct from the doctest failure. It is still quite strange, it starts and then breaks down rather than just going straight to segfault. Multiple versions of some libraries trying to load?",
    "created_at": "2021-12-21T06:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629050",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
OK, that's one suspicion correct from the doctest failure. It is still quite strange, it starts and then breaks down rather than just going straight to segfault. Multiple versions of some libraries trying to load?



---

archive/issue_events_098609.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-01-29T08:58:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33056#event-98609"
}
```



---

archive/issue_comments_629051.json:
```json
{
    "body": "<a id='comment:6'></a>\nbump to 9.6",
    "created_at": "2022-01-29T08:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629051",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
bump to 9.6



---

archive/issue_comments_629052.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-02-16T20:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629052",
    "user": "https://github.com/isuruf"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_629053.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2022-02-16T20:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629053",
    "user": "https://github.com/isuruf"
}
```

**Changing upstream** from "N/A" to "Fixed upstream, in a later stable release.".



---

archive/issue_events_098610.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2022-02-16T20:23:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33056#event-98610"
}
```



---

archive/issue_events_098611.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2022-02-16T20:23:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33056#event-98611"
}
```



---

archive/issue_comments_629054.json:
```json
{
    "body": "<a id='comment:7'></a>\nFixed in https://github.com/conda-forge/giac-feedstock/pull/28\n\nGiac was storing aide_cas location in the build machine in a C++\nstring and that failed with conda's relocation helper which only\nworks with C strings.\n\nFixed it by using dladdr to get the full path to lib/libgiac.so.0\nand reconstructed the path.",
    "created_at": "2022-02-16T20:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629054",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:7'></a>
Fixed in https://github.com/conda-forge/giac-feedstock/pull/28

Giac was storing aide_cas location in the build machine in a C++
string and that failed with conda's relocation helper which only
works with C strings.

Fixed it by using dladdr to get the full path to lib/libgiac.so.0
and reconstructed the path.



---

archive/issue_comments_629055.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2022-02-17T16:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629055",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_629056.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2022-02-17T16:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33056#issuecomment-629056",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_098612.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-20T14:33:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33056",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33056#event-98612"
}
```
