# Issue 33238: a bijectionist's toolkit

archive/issues_033001.json:
```json
{
    "assignees": [],
    "body": "We provide a toolkit for the combinatorialist to help find functions (\"statistics\") `s: A -> Z` and bijections `A -> B` given sequences of finite sets `A` and `B` that satisfy various constraints.\n\nDepends on #34881\nDepends on #34878\n\nCC:  @stumpc5 @tscrim @fchapoton\n\nBranch/Commit: **[u/mantepse/a_bijectionist_s_toolkit](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/a_bijectionist_s_toolkit) @ [`db8947b`](https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb)**\n\nReviewer: **Matthias Koeppe, ...**\n\nAuthor: **Alexander Grosz, Tobias Kietreiber, Stephan Pfannerer, Martin Rubey**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33238_\n\n",
    "created_at": "2022-01-28T10:16:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "a bijectionist's toolkit",
    "type": "issue",
    "updated_at": "2023-01-04T20:17:43Z",
    "url": "https://github.com/sagemath/sage/issues/33238",
    "user": "https://github.com/mantepse"
}
```
We provide a toolkit for the combinatorialist to help find functions ("statistics") `s: A -> Z` and bijections `A -> B` given sequences of finite sets `A` and `B` that satisfy various constraints.

Depends on #34881
Depends on #34878

CC:  @stumpc5 @tscrim @fchapoton

Branch/Commit: **[u/mantepse/a_bijectionist_s_toolkit](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/a_bijectionist_s_toolkit) @ [`db8947b`](https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb)**

Reviewer: **Matthias Koeppe, ...**

Author: **Alexander Grosz, Tobias Kietreiber, Stephan Pfannerer, Martin Rubey**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/33238_





---

archive/issue_events_459456.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-01-28T10:16:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459456"
}
```



---

archive/issue_events_459457.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-01-28T10:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459457"
}
```



---

archive/issue_events_459458.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-01-28T10:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459458"
}
```



---

archive/issue_events_459459.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-01-28T10:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459459"
}
```



---

archive/issue_events_459460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459460"
}
```



---

archive/issue_events_459461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459461"
}
```



---

archive/issue_events_459462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459462"
}
```



---

archive/issue_events_459463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459463"
}
```



---

archive/issue_comments_537095.json:
```json
{
    "body": "Branch: **[u/mantepse/a_bijectionist_s_toolkit](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/a_bijectionist_s_toolkit)**",
    "created_at": "2022-10-18T12:56:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537095",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/a_bijectionist_s_toolkit](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/a_bijectionist_s_toolkit)**



---

archive/issue_events_459464.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-10-18T13:04:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459464"
}
```



---

archive/issue_comments_537096.json:
```json
{
    "body": "Commit: **[`6d7ab9c`](https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77)**",
    "created_at": "2022-10-18T13:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537096",
    "user": "https://github.com/mantepse"
}
```

Commit: **[`6d7ab9c`](https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77)**



---

archive/issue_comments_537097.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nComments welcome!  In particular, it would be wonderful to find more interesting applications.  \n\nIn short: given two finite sets `A` and `B`, a statistic `tau: B -> Z`, and a set partition `P` of `A`, the program finds all possible statistics `s: A -> Z` which have the same distribution as `tau` but are constant on the blocks of `P`.\n\nThere is still some ongoing work. In particular, we try to implement a cache of solutions, which is checked for counterexamples before asking the solver to produce a counterexample from scratch.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77\"><code>6d7ab9c</code></a></td><td><code>initial commit</code></td></tr></table>\n",
    "created_at": "2022-10-18T13:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537097",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">comment:4</div>

Comments welcome!  In particular, it would be wonderful to find more interesting applications.  

In short: given two finite sets `A` and `B`, a statistic `tau: B -> Z`, and a set partition `P` of `A`, the program finds all possible statistics `s: A -> Z` which have the same distribution as `tau` but are constant on the blocks of `P`.

There is still some ongoing work. In particular, we try to implement a cache of solutions, which is checked for counterexamples before asking the solver to produce a counterexample from scratch.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77"><code>6d7ab9c</code></a></td><td><code>initial commit</code></td></tr></table>




---

archive/issue_comments_537098.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc\"><code>6149eb2</code></a></td><td><code>make the linter happier</code></td></tr></table>\n",
    "created_at": "2022-10-18T13:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537098",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc"><code>6149eb2</code></a></td><td><code>make the linter happier</code></td></tr></table>




---

archive/issue_comments_537099.json:
```json
{
    "body": "Changed commit from **[`6d7ab9c`](https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77)** to **[`6149eb2`](https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc)**",
    "created_at": "2022-10-18T13:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537099",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d7ab9c`](https://github.com/sagemath/sagetrac-mirror/commit/6d7ab9c14e94bffa959e9c310ee3d16529006d77)** to **[`6149eb2`](https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc)**



---

archive/issue_comments_537100.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621\"><code>9d4bfb9</code></a></td><td><code>remove useless assignment</code></td></tr></table>\n",
    "created_at": "2022-10-18T16:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537100",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621"><code>9d4bfb9</code></a></td><td><code>remove useless assignment</code></td></tr></table>




---

archive/issue_comments_537101.json:
```json
{
    "body": "Changed commit from **[`6149eb2`](https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc)** to **[`9d4bfb9`](https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621)**",
    "created_at": "2022-10-18T16:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537101",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6149eb2`](https://github.com/sagemath/sagetrac-mirror/commit/6149eb25ff2301cd9ac7f41f8c2c6a6da367dccc)** to **[`9d4bfb9`](https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621)**



---

archive/issue_comments_537102.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a\"><code>6ee34e1</code></a></td><td><code>make initialisation more efficient</code></td></tr></table>\n",
    "created_at": "2022-10-18T22:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537102",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a"><code>6ee34e1</code></a></td><td><code>make initialisation more efficient</code></td></tr></table>




---

archive/issue_comments_537103.json:
```json
{
    "body": "Changed commit from **[`9d4bfb9`](https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621)** to **[`6ee34e1`](https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a)**",
    "created_at": "2022-10-18T22:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537103",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9d4bfb9`](https://github.com/sagemath/sagetrac-mirror/commit/9d4bfb97b1667fc7fc7e58527a9d8beae9e1f621)** to **[`6ee34e1`](https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a)**



---

archive/issue_comments_537104.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797\"><code>1a14bcf</code></a></td><td><code>consistently name variable</code></td></tr></table>\n",
    "created_at": "2022-10-18T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537104",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797"><code>1a14bcf</code></a></td><td><code>consistently name variable</code></td></tr></table>




---

archive/issue_comments_537105.json:
```json
{
    "body": "Changed commit from **[`6ee34e1`](https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a)** to **[`1a14bcf`](https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797)**",
    "created_at": "2022-10-18T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537105",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6ee34e1`](https://github.com/sagemath/sagetrac-mirror/commit/6ee34e1d761af4b8ec23c721a12a0d123318661a)** to **[`1a14bcf`](https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797)**



---

archive/issue_comments_537106.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb\"><code>0901ec7</code></a></td><td><code>slightly improve documentation</code></td></tr></table>\n",
    "created_at": "2022-10-19T15:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537106",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb"><code>0901ec7</code></a></td><td><code>slightly improve documentation</code></td></tr></table>




---

archive/issue_comments_537107.json:
```json
{
    "body": "Changed commit from **[`1a14bcf`](https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797)** to **[`0901ec7`](https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb)**",
    "created_at": "2022-10-19T15:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537107",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1a14bcf`](https://github.com/sagemath/sagetrac-mirror/commit/1a14bcfcbd8202fb81481a0017c1df0974547797)** to **[`0901ec7`](https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb)**



---

archive/issue_comments_537108.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360\"><code>c39d653</code></a></td><td><code>non-copying intersection, to save memory when there are almost no restrictions on the values of a block</code></td></tr></table>\n",
    "created_at": "2022-11-02T09:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537108",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360"><code>c39d653</code></a></td><td><code>non-copying intersection, to save memory when there are almost no restrictions on the values of a block</code></td></tr></table>




---

archive/issue_comments_537109.json:
```json
{
    "body": "Changed commit from **[`0901ec7`](https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb)** to **[`c39d653`](https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360)**",
    "created_at": "2022-11-02T09:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537109",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0901ec7`](https://github.com/sagemath/sagetrac-mirror/commit/0901ec7a2dd6de58de2307489e844dd2978d79bb)** to **[`c39d653`](https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360)**



---

archive/issue_comments_537110.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb\"><code>2f0bb0e</code></a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr></table>\n",
    "created_at": "2022-12-05T08:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537110",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb"><code>2f0bb0e</code></a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr></table>




---

archive/issue_comments_537111.json:
```json
{
    "body": "Changed commit from **[`c39d653`](https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360)** to **[`2f0bb0e`](https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb)**",
    "created_at": "2022-12-05T08:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537111",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c39d653`](https://github.com/sagemath/sagetrac-mirror/commit/c39d653071d1d00b73fca4bf961bab8d4a7ba360)** to **[`2f0bb0e`](https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb)**



---

archive/issue_comments_537112.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92\"><code>321ba43</code></a></td><td><code>start to cache solutions</code></td></tr></table>\n",
    "created_at": "2022-12-05T08:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537112",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92"><code>321ba43</code></a></td><td><code>start to cache solutions</code></td></tr></table>




---

archive/issue_comments_537113.json:
```json
{
    "body": "Changed commit from **[`2f0bb0e`](https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb)** to **[`321ba43`](https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92)**",
    "created_at": "2022-12-05T08:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537113",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2f0bb0e`](https://github.com/sagemath/sagetrac-mirror/commit/2f0bb0e7fd9620f47ece110e2364295205923ecb)** to **[`321ba43`](https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92)**



---

archive/issue_comments_537114.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2\"><code>306395c</code></a></td><td><code>finish implementation of cache</code></td></tr></table>\n",
    "created_at": "2022-12-21T15:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537114",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2"><code>306395c</code></a></td><td><code>finish implementation of cache</code></td></tr></table>




---

archive/issue_comments_537115.json:
```json
{
    "body": "Changed commit from **[`321ba43`](https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92)** to **[`306395c`](https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2)**",
    "created_at": "2022-12-21T15:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537115",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`321ba43`](https://github.com/sagemath/sagetrac-mirror/commit/321ba43b09501549f459a0ec0e70349ade428c92)** to **[`306395c`](https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2)**



---

archive/issue_comments_537116.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a8e564b8fa42f37f52bfbc8706c56c1ce2e5029\"><code>1a8e564</code></a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446\"><code>1ac0978</code></a></td><td><code>add some documentation and doctests, slightly simplify code</code></td></tr></table>\n",
    "created_at": "2022-12-21T23:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537116",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a8e564b8fa42f37f52bfbc8706c56c1ce2e5029"><code>1a8e564</code></a></td><td><code>Merge branch 'develop' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446"><code>1ac0978</code></a></td><td><code>add some documentation and doctests, slightly simplify code</code></td></tr></table>




---

archive/issue_comments_537117.json:
```json
{
    "body": "Changed commit from **[`306395c`](https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2)** to **[`1ac0978`](https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446)**",
    "created_at": "2022-12-21T23:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537117",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`306395c`](https://github.com/sagemath/sagetrac-mirror/commit/306395cf92435f6abc1656c7677cbb68ef7b02b2)** to **[`1ac0978`](https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446)**



---

archive/issue_comments_537118.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThere are still some doctests and some documentation missing, but otherwise this is ready.",
    "created_at": "2022-12-21T23:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537118",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:15" align="right">comment:15</div>

There are still some doctests and some documentation missing, but otherwise this is ready.



---

archive/issue_comments_537119.json:
```json
{
    "body": "Changed commit from **[`1ac0978`](https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446)** to **[`47945ac`](https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c)**",
    "created_at": "2022-12-22T00:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537119",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ac0978`](https://github.com/sagemath/sagetrac-mirror/commit/1ac09787fd03c114725a775cdf22b6e14f108446)** to **[`47945ac`](https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c)**



---

archive/issue_comments_537120.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c\"><code>47945ac</code></a></td><td><code>add missing documentation in table of contents</code></td></tr></table>\n",
    "created_at": "2022-12-22T00:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537120",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c"><code>47945ac</code></a></td><td><code>add missing documentation in table of contents</code></td></tr></table>




---

archive/issue_comments_537121.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7\"><code>19c3d8f</code></a></td><td><code>mark doctests as long, slightly simplify logic</code></td></tr></table>\n",
    "created_at": "2022-12-22T10:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537121",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7"><code>19c3d8f</code></a></td><td><code>mark doctests as long, slightly simplify logic</code></td></tr></table>




---

archive/issue_comments_537122.json:
```json
{
    "body": "Changed commit from **[`47945ac`](https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c)** to **[`19c3d8f`](https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7)**",
    "created_at": "2022-12-22T10:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537122",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`47945ac`](https://github.com/sagemath/sagetrac-mirror/commit/47945ac2bbdbd927a6aaef8c72ead62d2922c94c)** to **[`19c3d8f`](https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7)**



---

archive/issue_comments_537123.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5\"><code>eca857e</code></a></td><td><code>slightly simplify, more doctests</code></td></tr></table>\n",
    "created_at": "2022-12-22T22:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537123",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5"><code>eca857e</code></a></td><td><code>slightly simplify, more doctests</code></td></tr></table>




---

archive/issue_comments_537124.json:
```json
{
    "body": "Changed commit from **[`19c3d8f`](https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7)** to **[`eca857e`](https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5)**",
    "created_at": "2022-12-22T22:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537124",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`19c3d8f`](https://github.com/sagemath/sagetrac-mirror/commit/19c3d8fdc82471993ab800923eaeb2494c7551c7)** to **[`eca857e`](https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5)**



---

archive/issue_comments_537125.json:
```json
{
    "body": "Changed commit from **[`eca857e`](https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5)** to **[`a04d146`](https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f)**",
    "created_at": "2022-12-22T22:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537125",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eca857e`](https://github.com/sagemath/sagetrac-mirror/commit/eca857ebb1c8f29abd4e7afb7f386f98b18584d5)** to **[`a04d146`](https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f)**



---

archive/issue_comments_537126.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f\"><code>a04d146</code></a></td><td><code>doctest _find_counter_example</code></td></tr></table>\n",
    "created_at": "2022-12-22T22:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537126",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f"><code>a04d146</code></a></td><td><code>doctest _find_counter_example</code></td></tr></table>




---

archive/issue_comments_537127.json:
```json
{
    "body": "Changed commit from **[`a04d146`](https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f)** to **[`3508426`](https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c)**",
    "created_at": "2022-12-22T23:08:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537127",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a04d146`](https://github.com/sagemath/sagetrac-mirror/commit/a04d1460832a87550ef18bb1f6767f4240d6230f)** to **[`3508426`](https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c)**



---

archive/issue_comments_537128.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c\"><code>3508426</code></a></td><td><code>doctest add_distribution_constraints and add_intertwing_relation_constraints</code></td></tr></table>\n",
    "created_at": "2022-12-22T23:08:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537128",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c"><code>3508426</code></a></td><td><code>doctest add_distribution_constraints and add_intertwing_relation_constraints</code></td></tr></table>




---

archive/issue_comments_537129.json:
```json
{
    "body": "Changed commit from **[`3508426`](https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c)** to **[`0ac618c`](https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d)**",
    "created_at": "2022-12-22T23:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537129",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3508426`](https://github.com/sagemath/sagetrac-mirror/commit/3508426a9d10c3c904f998cdfe55447c4753cf5c)** to **[`0ac618c`](https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d)**



---

archive/issue_comments_537130.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d\"><code>0ac618c</code></a></td><td><code>doctest _preprocess_intertwining_relations, _solution, _show_bmilp, _initialize_new_bmilp, _veto_current_solution</code></td></tr></table>\n",
    "created_at": "2022-12-22T23:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537130",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d"><code>0ac618c</code></a></td><td><code>doctest _preprocess_intertwining_relations, _solution, _show_bmilp, _initialize_new_bmilp, _veto_current_solution</code></td></tr></table>




---

archive/issue_events_459465.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-22T23:43:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459465"
}
```



---

archive/issue_events_459466.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-22T23:43:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459466"
}
```



---

archive/issue_comments_537131.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nYou may want to try this with a better IP solver - see #31329 for SCIP",
    "created_at": "2022-12-23T00:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537131",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

You may want to try this with a better IP solver - see #31329 for SCIP



---

archive/issue_comments_537132.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2\"><code>d50b62c</code></a></td><td><code>expand docstring of main class</code></td></tr></table>\n",
    "created_at": "2022-12-23T08:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537132",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2"><code>d50b62c</code></a></td><td><code>expand docstring of main class</code></td></tr></table>




---

archive/issue_comments_537133.json:
```json
{
    "body": "Changed commit from **[`0ac618c`](https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d)** to **[`d50b62c`](https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2)**",
    "created_at": "2022-12-23T08:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537133",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0ac618c`](https://github.com/sagemath/sagetrac-mirror/commit/0ac618c968e976d19fd2c61c2462611ce8f0cc3d)** to **[`d50b62c`](https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2)**



---

archive/issue_comments_537134.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:24):\n> You may want to try this with a better IP solver - see #31329 for SCIP\n\nExcellent, I have now managed to install SCIP, and indeed, many doctests fail :-)\n\nPreviously, I only tested with gurobi (which was much faster), but apparently, we got sloppy during the last few big reorganisations.",
    "created_at": "2022-12-23T12:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537134",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [Matthias KÃ¶ppe](#comment:24):
> You may want to try this with a better IP solver - see #31329 for SCIP

Excellent, I have now managed to install SCIP, and indeed, many doctests fail :-)

Previously, I only tested with gurobi (which was much faster), but apparently, we got sloppy during the last few big reorganisations.



---

archive/issue_events_459467.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-23T12:42:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459467"
}
```



---

archive/issue_events_459468.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-23T12:42:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459468"
}
```



---

archive/issue_comments_537135.json:
```json
{
    "body": "Changed commit from **[`d50b62c`](https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2)** to **[`288e391`](https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e)**",
    "created_at": "2022-12-23T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537135",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d50b62c`](https://github.com/sagemath/sagetrac-mirror/commit/d50b62c2008a96849f99004a4c2ad883fab7d0f2)** to **[`288e391`](https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e)**



---

archive/issue_comments_537136.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e\"><code>288e391</code></a></td><td><code>copy milp instead of adding and removing constraints</code></td></tr></table>\n",
    "created_at": "2022-12-23T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537136",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e"><code>288e391</code></a></td><td><code>copy milp instead of adding and removing constraints</code></td></tr></table>




---

archive/issue_comments_537137.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nWith the simple fix from #31329, [#31329 comment:45](https://github.com/sagemath/sage/issues/31329#comment:45), this now also seems to work with SCIP.  However, SCIP seems to be much slower, by far.  In particular, GLPK finishes the doctest in line 3157-3171\n\n```\n    sage: As = Bs = [[],\n    ....:            [(1,i,j) for i in [-1,0,1] for j in [-1,1]],\n    ....:            [(2,i,j) for i in [-1,0,1] for j in [-1,1]],\n    ....:            [(3,i,j) for i in [-2,-1,0,1,2] for j in [-1,1]]]\n\n    sage: c1 = lambda a, b: (a[0]+b[0], a[1]*b[1], a[2]*b[2])\n    sage: c2 = lambda a: (a[0], -a[1], a[2])\n\n    sage: bij = Bijectionist(sum(As, []), sum(Bs, []))\n    sage: bij.set_statistics((lambda x: x[0], lambda x: x[0]))\n    sage: bij.set_intertwining_relations((2, c1, c1), (1, c2, c2))\n    sage: l = list(bij.solutions_iterator()); len(l)                            # long time\n    64\n```\nin about 1 minute on my laptop, while SCIP seems to take about an hour.  Is there a way to find out what's going on?  Even finding the first solution takes 25 seconds, vs. 0.3 seconds with GLPK.",
    "created_at": "2022-12-23T15:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537137",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:29" align="right">comment:29</div>

With the simple fix from #31329, [#31329 comment:45](https://github.com/sagemath/sage/issues/31329#comment:45), this now also seems to work with SCIP.  However, SCIP seems to be much slower, by far.  In particular, GLPK finishes the doctest in line 3157-3171

```
    sage: As = Bs = [[],
    ....:            [(1,i,j) for i in [-1,0,1] for j in [-1,1]],
    ....:            [(2,i,j) for i in [-1,0,1] for j in [-1,1]],
    ....:            [(3,i,j) for i in [-2,-1,0,1,2] for j in [-1,1]]]

    sage: c1 = lambda a, b: (a[0]+b[0], a[1]*b[1], a[2]*b[2])
    sage: c2 = lambda a: (a[0], -a[1], a[2])

    sage: bij = Bijectionist(sum(As, []), sum(Bs, []))
    sage: bij.set_statistics((lambda x: x[0], lambda x: x[0]))
    sage: bij.set_intertwining_relations((2, c1, c1), (1, c2, c2))
    sage: l = list(bij.solutions_iterator()); len(l)                            # long time
    64
```
in about 1 minute on my laptop, while SCIP seems to take about an hour.  Is there a way to find out what's going on?  Even finding the first solution takes 25 seconds, vs. 0.3 seconds with GLPK.



---

archive/issue_comments_537138.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI have found the culprit already - `deepcopy` takes forever:\n\n```\nsage: %prun next(bij.solutions_iterator())\n         54830 function calls (54618 primitive calls) in 25.558 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1   24.908   24.908   24.908   24.908 {method '__deepcopy__' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}\n   ...\n```\nvs.\n\n```\nsage: %prun next(bij.solutions_iterator())\n         53403 function calls (53231 primitive calls) in 0.353 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.123    0.123    0.287    0.287 bijectionist.py:3005(add_intertwining_relation_constraints)\n     4093    0.114    0.000    0.124    0.000 {method 'add_constraint' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}\n        1    0.051    0.051    0.051    0.051 {method 'solve' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}\n     4083    0.021    0.000    0.031    0.000 {built-in method builtins.sum}\n     4372    0.010    0.000    0.010    0.000 <ipython-input-3-f7b4b09ab02e>:1(<lambda>)\n    12008    0.009    0.000    0.009    0.000 bijectionist.py:3068(<genexpr>)\n     4096    0.004    0.000    0.006    0.000 copy.py:66(copy)\n     4082    0.004    0.000    0.004    0.000 {method 'is_zero' of 'sage.numerical.linear_functions.LinearFunction' objects}\n        1    0.003    0.003    0.006    0.006 bijectionist.py:2026(_preprocess_intertwining_relations)\n     4093    0.003    0.000    0.003    0.000 {built-in method builtins.isinstance}\n        1    0.002    0.002    0.003    0.003 bijectionist.py:2892(add_alpha_beta_constraints)\n     4093    0.002    0.000    0.004    0.000 linear_tensor.py:112(is_LinearTensor)\n      194    0.001    0.000    0.001    0.000 bijectionist.py:2671(<genexpr>)\n      628    0.001    0.000    0.001    0.000 {method 'find' of 'sage.sets.disjoint_set.DisjointSet_of_hashables' objects}\n     4098    0.001    0.000    0.001    0.000 {method 'get' of 'dict' objects}\n     4095    0.001    0.000    0.001    0.000 {method 'copy' of 'dict' objects}\n        1    0.001    0.001    0.001    0.001 {method '__deepcopy__' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}\n```",
    "created_at": "2022-12-23T15:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537138",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:30" align="right">comment:30</div>

I have found the culprit already - `deepcopy` takes forever:

```
sage: %prun next(bij.solutions_iterator())
         54830 function calls (54618 primitive calls) in 25.558 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1   24.908   24.908   24.908   24.908 {method '__deepcopy__' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}
   ...
```
vs.

```
sage: %prun next(bij.solutions_iterator())
         53403 function calls (53231 primitive calls) in 0.353 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.123    0.123    0.287    0.287 bijectionist.py:3005(add_intertwining_relation_constraints)
     4093    0.114    0.000    0.124    0.000 {method 'add_constraint' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}
        1    0.051    0.051    0.051    0.051 {method 'solve' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}
     4083    0.021    0.000    0.031    0.000 {built-in method builtins.sum}
     4372    0.010    0.000    0.010    0.000 <ipython-input-3-f7b4b09ab02e>:1(<lambda>)
    12008    0.009    0.000    0.009    0.000 bijectionist.py:3068(<genexpr>)
     4096    0.004    0.000    0.006    0.000 copy.py:66(copy)
     4082    0.004    0.000    0.004    0.000 {method 'is_zero' of 'sage.numerical.linear_functions.LinearFunction' objects}
        1    0.003    0.003    0.006    0.006 bijectionist.py:2026(_preprocess_intertwining_relations)
     4093    0.003    0.000    0.003    0.000 {built-in method builtins.isinstance}
        1    0.002    0.002    0.003    0.003 bijectionist.py:2892(add_alpha_beta_constraints)
     4093    0.002    0.000    0.004    0.000 linear_tensor.py:112(is_LinearTensor)
      194    0.001    0.000    0.001    0.000 bijectionist.py:2671(<genexpr>)
      628    0.001    0.000    0.001    0.000 {method 'find' of 'sage.sets.disjoint_set.DisjointSet_of_hashables' objects}
     4098    0.001    0.000    0.001    0.000 {method 'get' of 'dict' objects}
     4095    0.001    0.000    0.001    0.000 {method 'copy' of 'dict' objects}
        1    0.001    0.001    0.001    0.001 {method '__deepcopy__' of 'sage.numerical.mip.MixedIntegerLinearProgram' objects}
```



---

archive/issue_comments_537139.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n(I don't know whether copy would suffice for my purpose, but it takes forever, too)\n\nSince this is almost certainly a SCIP problem, I'm going back to needs-review.",
    "created_at": "2022-12-23T15:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537139",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:31" align="right">comment:31</div>

(I don't know whether copy would suffice for my purpose, but it takes forever, too)

Since this is almost certainly a SCIP problem, I'm going back to needs-review.



---

archive/issue_comments_537140.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716\"><code>d57c8e5</code></a></td><td><code>derandomize a test, mark example as random</code></td></tr></table>\n",
    "created_at": "2022-12-23T16:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537140",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716"><code>d57c8e5</code></a></td><td><code>derandomize a test, mark example as random</code></td></tr></table>




---

archive/issue_comments_537141.json:
```json
{
    "body": "Changed commit from **[`288e391`](https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e)** to **[`d57c8e5`](https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716)**",
    "created_at": "2022-12-23T16:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537141",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`288e391`](https://github.com/sagemath/sagetrac-mirror/commit/288e3917aaa8a2d56ec45c2137c5f4889842488e)** to **[`d57c8e5`](https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716)**



---

archive/issue_events_459469.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-23T16:22:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459469"
}
```



---

archive/issue_events_459470.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-12-23T16:22:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33238#event-459470"
}
```



---

archive/issue_comments_537142.json:
```json
{
    "body": "Changed commit from **[`d57c8e5`](https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716)** to **[`7353fb5`](https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a)**",
    "created_at": "2022-12-23T21:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d57c8e5`](https://github.com/sagemath/sagetrac-mirror/commit/d57c8e5295144152214c870f3a206ab0dc5a7716)** to **[`7353fb5`](https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a)**



---

archive/issue_comments_537143.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a\"><code>7353fb5</code></a></td><td><code>correct typo, remove useless assignment</code></td></tr></table>\n",
    "created_at": "2022-12-23T21:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a"><code>7353fb5</code></a></td><td><code>correct typo, remove useless assignment</code></td></tr></table>




---

archive/issue_comments_537144.json:
```json
{
    "body": "Changed commit from **[`7353fb5`](https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a)** to **[`db850f0`](https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1)**",
    "created_at": "2022-12-23T22:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7353fb5`](https://github.com/sagemath/sagetrac-mirror/commit/7353fb523075c798dd3afe2cd57108b88909c94a)** to **[`db850f0`](https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1)**



---

archive/issue_comments_537145.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1\"><code>db850f0</code></a></td><td><code>add and remove constraints instead of copying the whole program</code></td></tr></table>\n",
    "created_at": "2022-12-23T22:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537145",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1"><code>db850f0</code></a></td><td><code>add and remove constraints instead of copying the whole program</code></td></tr></table>




---

archive/issue_comments_537146.json:
```json
{
    "body": "Changed commit from **[`db850f0`](https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1)** to **[`ec3271c`](https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e)**",
    "created_at": "2022-12-23T23:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537146",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`db850f0`](https://github.com/sagemath/sagetrac-mirror/commit/db850f00bdcea2011ed9194de177fbcbcc8b93d1)** to **[`ec3271c`](https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e)**



---

archive/issue_comments_537147.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e\"><code>ec3271c</code></a></td><td><code>fix problem with SCIP, add timings</code></td></tr></table>\n",
    "created_at": "2022-12-23T23:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537147",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e"><code>ec3271c</code></a></td><td><code>fix problem with SCIP, add timings</code></td></tr></table>




---

archive/issue_comments_537148.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n\n```\n+            d = minimal_subdistribution.get_values(D)  # a dict from P to multiplicities\n[...]\n+                support = [X[p] for p in P if d[p]]\n```\nI would recommend to use the recently added `convert` parameter of `get_values` https://doc.sagemath.org/html/en/reference/numerical/sage/numerical/mip.html#sage.numerical.mip.MixedIntegerLinearProgram.get_values, which makes such tests much more robust.",
    "created_at": "2022-12-23T23:19:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537148",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>


```
+            d = minimal_subdistribution.get_values(D)  # a dict from P to multiplicities
[...]
+                support = [X[p] for p in P if d[p]]
```
I would recommend to use the recently added `convert` parameter of `get_values` https://doc.sagemath.org/html/en/reference/numerical/sage/numerical/mip.html#sage.numerical.mip.MixedIntegerLinearProgram.get_values, which makes such tests much more robust.



---

archive/issue_comments_537149.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de\"><code>dfdc6ba</code></a></td><td><code>use convert for MixedIntegerLinearProgram.get_values</code></td></tr></table>\n",
    "created_at": "2022-12-24T13:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537149",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de"><code>dfdc6ba</code></a></td><td><code>use convert for MixedIntegerLinearProgram.get_values</code></td></tr></table>




---

archive/issue_comments_537150.json:
```json
{
    "body": "Changed commit from **[`ec3271c`](https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e)** to **[`dfdc6ba`](https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de)**",
    "created_at": "2022-12-24T13:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537150",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ec3271c`](https://github.com/sagemath/sagetrac-mirror/commit/ec3271c0e0d79727e2f5f80867bcb253eb6a639e)** to **[`dfdc6ba`](https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de)**



---

archive/issue_comments_537151.json:
```json
{
    "body": "Changed commit from **[`dfdc6ba`](https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de)** to **[`d0836cb`](https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04)**",
    "created_at": "2022-12-25T21:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dfdc6ba`](https://github.com/sagemath/sagetrac-mirror/commit/dfdc6bacdcdbc2198fd62b96167aedc3bf94e1de)** to **[`d0836cb`](https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04)**



---

archive/issue_comments_537152.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04\"><code>d0836cb</code></a></td><td><code>include information on MILP also in public documentation</code></td></tr></table>\n",
    "created_at": "2022-12-25T21:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537152",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04"><code>d0836cb</code></a></td><td><code>include information on MILP also in public documentation</code></td></tr></table>




---

archive/issue_comments_537153.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c\"><code>563af98</code></a></td><td><code>remove unnecessary copy</code></td></tr></table>\n",
    "created_at": "2022-12-25T22:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c"><code>563af98</code></a></td><td><code>remove unnecessary copy</code></td></tr></table>




---

archive/issue_comments_537154.json:
```json
{
    "body": "Changed commit from **[`d0836cb`](https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04)** to **[`563af98`](https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c)**",
    "created_at": "2022-12-25T22:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d0836cb`](https://github.com/sagemath/sagetrac-mirror/commit/d0836cb93095985a933c549ea8a8893ba4d94a04)** to **[`563af98`](https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c)**



---

archive/issue_comments_537155.json:
```json
{
    "body": "Changed commit from **[`563af98`](https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c)** to **[`590bae2`](https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55)**",
    "created_at": "2022-12-26T18:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537155",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`563af98`](https://github.com/sagemath/sagetrac-mirror/commit/563af988ae4e282cc2778599c73b728e8eb71f0c)** to **[`590bae2`](https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55)**



---

archive/issue_comments_537156.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55\"><code>590bae2</code></a></td><td><code>add possibility to constrain to involutions</code></td></tr></table>\n",
    "created_at": "2022-12-26T18:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537156",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55"><code>590bae2</code></a></td><td><code>add possibility to constrain to involutions</code></td></tr></table>




---

archive/issue_comments_537157.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nSee https://mathoverflow.net/questions/437261/standard-or-good-names-for-relations-between-maps for a question on terminology.\n\nIf you have a nice test for the constraint `s o psi o s = phi`, with non-identity `psi` and `phi`, I'd love to add it.",
    "created_at": "2022-12-26T18:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537157",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:42" align="right">comment:42</div>

See https://mathoverflow.net/questions/437261/standard-or-good-names-for-relations-between-maps for a question on terminology.

If you have a nice test for the constraint `s o psi o s = phi`, with non-identity `psi` and `phi`, I'd love to add it.



---

archive/issue_comments_537158.json:
```json
{
    "body": "Changed commit from **[`590bae2`](https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55)** to **[`da0655b`](https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786)**",
    "created_at": "2022-12-26T22:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537158",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`590bae2`](https://github.com/sagemath/sagetrac-mirror/commit/590bae24937ea07a1d5f22216b0900cce949ce55)** to **[`da0655b`](https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786)**



---

archive/issue_comments_537159.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786\"><code>da0655b</code></a></td><td><code>correct indentation</code></td></tr></table>\n",
    "created_at": "2022-12-26T22:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537159",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786"><code>da0655b</code></a></td><td><code>correct indentation</code></td></tr></table>




---

archive/issue_comments_537160.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nA question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.\n\nThe idea in creating it was to separate the MILP from the user interface.  More precisely, the methods `Bijectionist.set_*` in the main class are responsible to normalizing and organizing the input, whereas the methods `_BijectionistMILP.add_*_constraint` in the helper class actually turn the input into constraints.\n\nAlso, the helper class organizes a cache of solutions, and, whenever a new solution is found, a veto constraint is added to the MILP.  Put differently, the set of solutions in the cache together with the set of solutions in the MILP is always constant.\n\nI think the current solution is OK, but I am open to improvements.",
    "created_at": "2022-12-27T08:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537160",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:44" align="right">comment:44</div>

A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.

The idea in creating it was to separate the MILP from the user interface.  More precisely, the methods `Bijectionist.set_*` in the main class are responsible to normalizing and organizing the input, whereas the methods `_BijectionistMILP.add_*_constraint` in the helper class actually turn the input into constraints.

Also, the helper class organizes a cache of solutions, and, whenever a new solution is found, a veto constraint is added to the MILP.  Put differently, the set of solutions in the cache together with the set of solutions in the MILP is always constant.

I think the current solution is OK, but I am open to improvements.



---

archive/issue_comments_537161.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nConcerning the `foreign_latex` plugin: it is triggered by `overset` because of the regexp `over[^l]`.  I believe that my use of `overset` is valid, I do not know of a better construct here.  In any case, the commutative diagram is typpeset correctly.",
    "created_at": "2022-12-27T08:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537161",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:45" align="right">comment:45</div>

Concerning the `foreign_latex` plugin: it is triggered by `overset` because of the regexp `over[^l]`.  I believe that my use of `overset` is valid, I do not know of a better construct here.  In any case, the commutative diagram is typpeset correctly.



---

archive/issue_comments_537162.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nPossibly, using the `indices` argument of `new_variable`, I could slightly simplify parts of the code.  Currently, variables are added as needed, and blocks where this is not allowed are guarded by checking whether the number of variables changed.\n\nI am not sure how easy it is to determine the allowed indices - they are a subset of `P x Z`, where `P` is the set of constant blocks and `Z` is the set of values.",
    "created_at": "2022-12-27T08:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537162",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:46" align="right">comment:46</div>

Possibly, using the `indices` argument of `new_variable`, I could slightly simplify parts of the code.  Currently, variables are added as needed, and blocks where this is not allowed are guarded by checking whether the number of variables changed.

I am not sure how easy it is to determine the allowed indices - they are a subset of `P x Z`, where `P` is the set of constant blocks and `Z` is the set of values.



---

archive/issue_comments_537163.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [Martin Rubey](#comment:44):\n> A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.\n\nIt may help to think about the overall structure of the code by considering whether 1. other enumeration technologies could be supported, or 2. whether some of your code could be generalized. \n\n1. Alternative techniques for the 0/1 enumeration: lattice point enumeration (`Polyhedron.integral_points()`), SAT (e.g. #33461 cvc5). \n\n2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP -- which could be a useful addition to the Sage library. (It could later be improved by solver-specific techniques such as accessing the solver's solution pools, or using solver callbacks.)",
    "created_at": "2022-12-27T18:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537163",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [Martin Rubey](#comment:44):
> A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.

It may help to think about the overall structure of the code by considering whether 1. other enumeration technologies could be supported, or 2. whether some of your code could be generalized. 

1. Alternative techniques for the 0/1 enumeration: lattice point enumeration (`Polyhedron.integral_points()`), SAT (e.g. #33461 cvc5). 

2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP -- which could be a useful addition to the Sage library. (It could later be improved by solver-specific techniques such as accessing the solver's solution pools, or using solver callbacks.)



---

archive/issue_comments_537164.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [Martin Rubey](#comment:45):\n> Concerning the `foreign_latex` plugin: it is triggered by `overset` because of the regexp `over[^l]`.  I believe that my use of `overset` is valid, I do not know of a better construct here.  In any case, the commutative diagram is typpeset correctly.\n\nYes, it's safe to ignore this warning. When we switch to GitHub, the patchbot will be retired anyway. The checks on GH Actions (`tox -e relint`) have a better pattern for `foreign_latex`, see `src/.relint.yml`.",
    "created_at": "2022-12-27T19:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537164",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [Martin Rubey](#comment:45):
> Concerning the `foreign_latex` plugin: it is triggered by `overset` because of the regexp `over[^l]`.  I believe that my use of `overset` is valid, I do not know of a better construct here.  In any case, the commutative diagram is typpeset correctly.

Yes, it's safe to ignore this warning. When we switch to GitHub, the patchbot will be retired anyway. The checks on GH Actions (`tox -e relint`) have a better pattern for `foreign_latex`, see `src/.relint.yml`.



---

archive/issue_comments_537165.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:47):\n> Replying to [Martin Rubey](#comment:44):\n> > A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.\n\n> \n> It may help to think about the overall structure of the code by considering whether 1. other enumeration technologies could be supported, or 2. whether some of your code could be generalized. \n> \n> 1. Alternative techniques for the 0/1 enumeration: lattice point enumeration (`Polyhedron.integral_points()`), SAT (e.g. #33461 cvc5). \n> \n> 2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP -- which could be a useful addition to the Sage library. (It could later be improved by solver-specific techniques such as accessing the solver's solution pools, or using solver callbacks.)\n\nCould you please expand?  I do not really understand what you mean.  In particular, I do not know what a cut is, and what you mean with \"equal cardinality\".  Is the idea that to have a class that gets you all solutions for a MIP, instead of just one?\n\nI admit that I am slightly afraid of increasing the scope of the project at this stage.  Did you have a look at the MILPs solved?  (some are documented in `solutions_iterator`, there are some more in `_forced_constant_blocks`, `minimal_subdistributions_iterator` and `minimal_subdistributions_block_iterator`)",
    "created_at": "2022-12-27T19:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537165",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [Matthias KÃ¶ppe](#comment:47):
> Replying to [Martin Rubey](#comment:44):
> > A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.

> 
> It may help to think about the overall structure of the code by considering whether 1. other enumeration technologies could be supported, or 2. whether some of your code could be generalized. 
> 
> 1. Alternative techniques for the 0/1 enumeration: lattice point enumeration (`Polyhedron.integral_points()`), SAT (e.g. #33461 cvc5). 
> 
> 2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP -- which could be a useful addition to the Sage library. (It could later be improved by solver-specific techniques such as accessing the solver's solution pools, or using solver callbacks.)

Could you please expand?  I do not really understand what you mean.  In particular, I do not know what a cut is, and what you mean with "equal cardinality".  Is the idea that to have a class that gets you all solutions for a MIP, instead of just one?

I admit that I am slightly afraid of increasing the scope of the project at this stage.  Did you have a look at the MILPs solved?  (some are documented in `solutions_iterator`, there are some more in `_forced_constant_blocks`, `minimal_subdistributions_iterator` and `minimal_subdistributions_block_iterator`)



---

archive/issue_comments_537166.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nPlease excuse, I have yet another question.  I was trying to simplify `evaluate_linear_function`, is there code to check whether a given set of values satisfies a constraint?\n\nBesides, I asked chatGPT.  It answered as follows:\n\n--- begin quote ---\n\nYes, you can use the MILP class from the `MixedIntegerLinearProgram` module in [SageMath](../wiki/SageMath) to check whether a given set of values satisfies a constraint of a MILP.\n\nHere is an example of how you can use the MILP class to check whether a given set of values satisfies a constraint of a MILP:\n\n```\nfrom sage.numerical.mip import MixedIntegerLinearProgram\n\n# Create a new MILP\nmilp = MixedIntegerLinearProgram()\n\n# Set up variables\nx = milp.new_variable(real=True, nonnegative=True)\ny = milp.new_variable(real=True, nonnegative=True)\n\n# Set up constraints\nmilp.add_constraint(x + y <= 1)\nmilp.add_constraint(x - y >= 0)\n\n# Check whether the given set of values satisfies the constraints\nsatisfies_constraints = milp.check_feasibility([x: 0.5, y: 0.5])\n\nprint(satisfies_constraints)  # prints True\n```\n\nCould you show me the definition of check_feasibility?\n\nCertainly! Here is the definition of the `check_feasibility` method of the MILP class from the `MixedIntegerLinearProgram` module in [SageMath](../wiki/SageMath):\n\n```\ndef check_feasibility(self, values=None, variable_order=None, solver=None):\n    \"\"\"\n    Check the feasibility of a given set of values.\n    \n    INPUT:\n    \n    - ``values`` -- a dictionary of variable names to values.\n    \n    - ``variable_order`` -- a list of variable names in the order in which they\n      should be presented to the solver. If not specified, the default\n      order is used.\n    \n    - ``solver`` -- the name of the solver to use. If not specified, the\n      default solver is used.\n    \n    OUTPUT:\n    \n    Returns True if the given set of values satisfies all of the constraints\n    of the MILP, and False otherwise.\n    \n    EXAMPLES:\n    \n    Check the feasibility of a given set of values::\n    \n        sage: from sage.numerical.mip import MixedIntegerLinearProgram\n        sage: milp = MixedIntegerLinearProgram()\n        sage: x = milp.new_variable(real=True, nonnegative=True)\n        sage: y = milp.new_variable(real=True, nonnegative=True)\n        sage: milp.add_constraint(x + y <= 1)\n        sage: milp.add_constraint(x - y >= 0)\n        sage: milp.check_feasibility([x: 0.5, y: 0.5])\n        True\n    \n    \"\"\"\n    # ...\n```\n\n--- end quote ---\nUnfortunately, this method does not exist in the current sagemath develop branch :-(",
    "created_at": "2022-12-27T20:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537166",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:50" align="right">comment:50</div>

Please excuse, I have yet another question.  I was trying to simplify `evaluate_linear_function`, is there code to check whether a given set of values satisfies a constraint?

Besides, I asked chatGPT.  It answered as follows:

--- begin quote ---

Yes, you can use the MILP class from the `MixedIntegerLinearProgram` module in [SageMath](../wiki/SageMath) to check whether a given set of values satisfies a constraint of a MILP.

Here is an example of how you can use the MILP class to check whether a given set of values satisfies a constraint of a MILP:

```
from sage.numerical.mip import MixedIntegerLinearProgram

# Create a new MILP
milp = MixedIntegerLinearProgram()

# Set up variables
x = milp.new_variable(real=True, nonnegative=True)
y = milp.new_variable(real=True, nonnegative=True)

# Set up constraints
milp.add_constraint(x + y <= 1)
milp.add_constraint(x - y >= 0)

# Check whether the given set of values satisfies the constraints
satisfies_constraints = milp.check_feasibility([x: 0.5, y: 0.5])

print(satisfies_constraints)  # prints True
```

Could you show me the definition of check_feasibility?

Certainly! Here is the definition of the `check_feasibility` method of the MILP class from the `MixedIntegerLinearProgram` module in [SageMath](../wiki/SageMath):

```
def check_feasibility(self, values=None, variable_order=None, solver=None):
    """
    Check the feasibility of a given set of values.
    
    INPUT:
    
    - ``values`` -- a dictionary of variable names to values.
    
    - ``variable_order`` -- a list of variable names in the order in which they
      should be presented to the solver. If not specified, the default
      order is used.
    
    - ``solver`` -- the name of the solver to use. If not specified, the
      default solver is used.
    
    OUTPUT:
    
    Returns True if the given set of values satisfies all of the constraints
    of the MILP, and False otherwise.
    
    EXAMPLES:
    
    Check the feasibility of a given set of values::
    
        sage: from sage.numerical.mip import MixedIntegerLinearProgram
        sage: milp = MixedIntegerLinearProgram()
        sage: x = milp.new_variable(real=True, nonnegative=True)
        sage: y = milp.new_variable(real=True, nonnegative=True)
        sage: milp.add_constraint(x + y <= 1)
        sage: milp.add_constraint(x - y >= 0)
        sage: milp.check_feasibility([x: 0.5, y: 0.5])
        True
    
    """
    # ...
```

--- end quote ---
Unfortunately, this method does not exist in the current sagemath develop branch :-(



---

archive/issue_comments_537167.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [Martin Rubey](#comment:49):\n> Replying to [Matthias K\u00f6ppe](#comment:47):\n> > 2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP\n\n> \n> Could you please expand?  I do not really understand what you mean.  In particular, I do not know what a cut is, and what you mean with \"equal cardinality\". \n\nSorry for the jargon. \"Cut\" is short for \"inequality\". What you call a \"veto inequality\" is commonly called a \"no-good cut\". \n\nWhen you have a solution x1=1, x2=1, x3=0, x4=0,\nyou are generating an inequality x1+x2 <= 1 in order to cut off this solution, but \nthis is only valid because you know that x1+x2+x3+x4 = 2.\nThe more general form of the no-good cut would be (1-x1)+(1-x2)+x3+x4 >= 1, which is linearly equivalent to your inequality given x1+x2+x3+x4 = 2.",
    "created_at": "2022-12-27T21:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537167",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [Martin Rubey](#comment:49):
> Replying to [Matthias KÃ¶ppe](#comment:47):
> > 2. Here you enumerate 0/1 solutions by repeatedly solving a MIP with no-good cuts added. If you generalize the form of your cuts a bit (so that their validity does not depend on equal cardinality), then you'd have a general algorithm for enumeration that could take as input any 0/1 IP

> 
> Could you please expand?  I do not really understand what you mean.  In particular, I do not know what a cut is, and what you mean with "equal cardinality". 

Sorry for the jargon. "Cut" is short for "inequality". What you call a "veto inequality" is commonly called a "no-good cut". 

When you have a solution x1=1, x2=1, x3=0, x4=0,
you are generating an inequality x1+x2 <= 1 in order to cut off this solution, but 
this is only valid because you know that x1+x2+x3+x4 = 2.
The more general form of the no-good cut would be (1-x1)+(1-x2)+x3+x4 >= 1, which is linearly equivalent to your inequality given x1+x2+x3+x4 = 2.



---

archive/issue_comments_537168.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nIs it really the case that `LinearConstraint` does not know its variables, other than by integer index, and that, given an index, there is no way to obtain the key?\n\nExplicitly:\n\n```\nsage: m = MixedIntegerLinearProgram()\nsage: x = m.new_variable(indices=[\"a\", \"b\", \"c\"])\nsage: c = x[\"a\"] + 2*x[\"b\"] >= 3\nsage: low, f = next(c.inequalities())\nsage: x.items()\ndict_items([('a', x_0), ('b', x_1), ('c', x_2)])\nsage: f.dict()\n{0: 1.0, 1: 2.0}\n```\nWhat I'd like to do is to \"evaluate\" `f`, and I think that this should be a method in `LinearConstraint`, possibly it should be the `subs` method, but I am unsure, because I'd like it to return `True` or `False` if the constraint is satisfied by the given values.",
    "created_at": "2022-12-27T22:50:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537168",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:52" align="right">comment:52</div>

Is it really the case that `LinearConstraint` does not know its variables, other than by integer index, and that, given an index, there is no way to obtain the key?

Explicitly:

```
sage: m = MixedIntegerLinearProgram()
sage: x = m.new_variable(indices=["a", "b", "c"])
sage: c = x["a"] + 2*x["b"] >= 3
sage: low, f = next(c.inequalities())
sage: x.items()
dict_items([('a', x_0), ('b', x_1), ('c', x_2)])
sage: f.dict()
{0: 1.0, 1: 2.0}
```
What I'd like to do is to "evaluate" `f`, and I think that this should be a method in `LinearConstraint`, possibly it should be the `subs` method, but I am unsure, because I'd like it to return `True` or `False` if the constraint is satisfied by the given values.



---

archive/issue_comments_537169.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [Martin Rubey](#comment:52):\n> Is it really the case that `LinearConstraint` does not know its variables, other than by integer index, and that, given an index, there is no way to obtain the key?\n\nYes, unfortunately. That's basically #26302.",
    "created_at": "2022-12-27T23:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537169",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [Martin Rubey](#comment:52):
> Is it really the case that `LinearConstraint` does not know its variables, other than by integer index, and that, given an index, there is no way to obtain the key?

Yes, unfortunately. That's basically #26302.



---

archive/issue_comments_537170.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nsee also #20664.",
    "created_at": "2022-12-27T23:28:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537170",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

see also #20664.



---

archive/issue_comments_537171.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nI admit I am confused by the multitude of tickets, and I also lack understanding the basic design of the frontend.  In particular, it is unclear to me, why some classes and methods seem to use integers to index the variables (\"columns\", I guess), such as `LinearFunction.dict`, and some use the indices by the user, such as `get_values`.\n\nWouldn't it be better to use the user supplied indices always, except in the backend?",
    "created_at": "2022-12-28T14:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537171",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:55" align="right">comment:55</div>

I admit I am confused by the multitude of tickets, and I also lack understanding the basic design of the frontend.  In particular, it is unclear to me, why some classes and methods seem to use integers to index the variables ("columns", I guess), such as `LinearFunction.dict`, and some use the indices by the user, such as `get_values`.

Wouldn't it be better to use the user supplied indices always, except in the backend?



---

archive/issue_comments_537172.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [Martin Rubey](#comment:55):\n> I also lack understanding the basic design of the frontend.\n\nWell, it's inconsistent. In the long run, I hope that we can replace our frontend with something more disciplined. My current candidate for this is CVXPY (#34251).",
    "created_at": "2022-12-28T19:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537172",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [Martin Rubey](#comment:55):
> I also lack understanding the basic design of the frontend.

Well, it's inconsistent. In the long run, I hope that we can replace our frontend with something more disciplined. My current candidate for this is CVXPY (#34251).



---

archive/issue_comments_537173.json:
```json
{
    "body": "Changed commit from **[`da0655b`](https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786)** to **[`03b1fb8`](https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670)**",
    "created_at": "2022-12-29T12:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537173",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`da0655b`](https://github.com/sagemath/sagetrac-mirror/commit/da0655b5e1dcd4b1b1a35943fbbedf2698900786)** to **[`03b1fb8`](https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670)**



---

archive/issue_comments_537174.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670\"><code>03b1fb8</code></a></td><td><code>better handling of empty constraints</code></td></tr></table>\n",
    "created_at": "2022-12-29T12:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537174",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670"><code>03b1fb8</code></a></td><td><code>better handling of empty constraints</code></td></tr></table>




---

archive/issue_comments_537175.json:
```json
{
    "body": "Dependencies: **#34881**",
    "created_at": "2022-12-29T19:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537175",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#34881**



---

archive/issue_comments_537176.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [Martin Rubey](#comment:44):\n> A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.\n\nSome more comments on this:\n- the steps of `_initialize_new_bmilp` could be merged into `_BijectionistMILP.__init__`\n- `_show_bmilp` would make more sense as a method of `_BijectionistMILP` (it breaks the abstraction of `_BijectionistMILP`)\n- also `_solution` could be changed to a (public) method of `_BijectionistMILP`; and perhaps there could be a slightly more high-level function so that various Bijectionist methods do not have to repeat the \"try ... solve ... except MIPSolverException ... else solution\" pattern",
    "created_at": "2022-12-29T19:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537176",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [Martin Rubey](#comment:44):
> A question about the general design: currently there is a helper class `_BijectionistMILP`.  I am not quite sure whether it might be better to merge it into the main class or not.

Some more comments on this:
- the steps of `_initialize_new_bmilp` could be merged into `_BijectionistMILP.__init__`
- `_show_bmilp` would make more sense as a method of `_BijectionistMILP` (it breaks the abstraction of `_BijectionistMILP`)
- also `_solution` could be changed to a (public) method of `_BijectionistMILP`; and perhaps there could be a slightly more high-level function so that various Bijectionist methods do not have to repeat the "try ... solve ... except MIPSolverException ... else solution" pattern



---

archive/issue_comments_537177.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nI would also suggest to introduce a method in `_BijectionistMILP` that returns the variable `_x[p, z]` so that you can remove the direct use of this attribute from the `Bijectionist` class.",
    "created_at": "2022-12-29T19:52:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537177",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

I would also suggest to introduce a method in `_BijectionistMILP` that returns the variable `_x[p, z]` so that you can remove the direct use of this attribute from the `Bijectionist` class.



---

archive/issue_comments_537178.json:
```json
{
    "body": "Changed dependencies from **#34881** to **#34881, #34878**",
    "created_at": "2022-12-29T20:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537178",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#34881** to **#34881, #34878**



---

archive/issue_comments_537179.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nBy the way, in the benchmark example (`bij`), instead of using `list(bij.solutions_iterator())`, the following works:\n\n```\nsage: bmilp = bij._initialize_new_bmilp()\nsage: %time p = bmilp.milp.polyhedron(base_ring=QQ)\nCPU times: user 126 ms, sys: 13.9 ms, total: 140 ms\nWall time: 164 ms\nsage: p.is_lattice_polytope()\nTrue\nsage: len(p.vertices())\n504\n```",
    "created_at": "2022-12-29T20:17:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537179",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">comment:62</div>

By the way, in the benchmark example (`bij`), instead of using `list(bij.solutions_iterator())`, the following works:

```
sage: bmilp = bij._initialize_new_bmilp()
sage: %time p = bmilp.milp.polyhedron(base_ring=QQ)
CPU times: user 126 ms, sys: 13.9 ms, total: 140 ms
Wall time: 164 ms
sage: p.is_lattice_polytope()
True
sage: len(p.vertices())
504
```



---

archive/issue_comments_537180.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a\"><code>a3364de</code></a></td><td><code>move _show to the _BijectionistMILP class</code></td></tr></table>\n",
    "created_at": "2022-12-29T22:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537180",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a"><code>a3364de</code></a></td><td><code>move _show to the _BijectionistMILP class</code></td></tr></table>




---

archive/issue_comments_537181.json:
```json
{
    "body": "Changed commit from **[`03b1fb8`](https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670)** to **[`a3364de`](https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a)**",
    "created_at": "2022-12-29T22:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`03b1fb8`](https://github.com/sagemath/sagetrac-mirror/commit/03b1fb836611da4674cb8c34ea3faad709418670)** to **[`a3364de`](https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a)**



---

archive/issue_comments_537182.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:62):\n> By the way, in the benchmark example (`bij`), instead of using `list(bij.solutions_iterator())`, the following works:\n> \n> ```\n> sage: bmilp = bij._initialize_new_bmilp()\n> sage: %time p = bmilp.milp.polyhedron(base_ring=QQ)\n> CPU times: user 126 ms, sys: 13.9 ms, total: 140 ms\n> Wall time: 164 ms\n> sage: p.is_lattice_polytope()\n> True\n> sage: len(p.vertices())\n> 504\n> ```\n\nWow, this is very impressive.  Why is this so much faster?  Can I always use this method instead?",
    "created_at": "2022-12-29T22:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537182",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [Matthias KÃ¶ppe](#comment:62):
> By the way, in the benchmark example (`bij`), instead of using `list(bij.solutions_iterator())`, the following works:
> 
> ```
> sage: bmilp = bij._initialize_new_bmilp()
> sage: %time p = bmilp.milp.polyhedron(base_ring=QQ)
> CPU times: user 126 ms, sys: 13.9 ms, total: 140 ms
> Wall time: 164 ms
> sage: p.is_lattice_polytope()
> True
> sage: len(p.vertices())
> 504
> ```

Wow, this is very impressive.  Why is this so much faster?  Can I always use this method instead?



---

archive/issue_comments_537183.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI guess that, in general, we want `integral_points`, right?\n\nOh, but then we are back to a long time.  Or do I misunderstand something?  But that's strange, it should be fast to filter out non-integral points.",
    "created_at": "2022-12-29T22:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537183",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:65" align="right">comment:65</div>

I guess that, in general, we want `integral_points`, right?

Oh, but then we are back to a long time.  Or do I misunderstand something?  But that's strange, it should be fast to filter out non-integral points.



---

archive/issue_comments_537184.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nIt's problem-dependent how well this works.",
    "created_at": "2022-12-29T22:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537184",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

It's problem-dependent how well this works.



---

archive/issue_comments_537185.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nFor a 0/1 problem, every 0/1 solution is a vertex solution of any polyhedral relaxation that keeps the constraints 0<=x_i<=1.\n\nSo you can enumerate the 0/1 solutions by filtering all vertex solutions to any such polyhedral relaxation. Whether this works well depends on the relaxation. In the example, your problem formulation happens to be perfect: Every vertex is a 0/1 solution. In general, you can have exponentially more vertex solutions than 0/1 solutions. In that case, this algorithm will not work so well.",
    "created_at": "2022-12-29T22:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537185",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

For a 0/1 problem, every 0/1 solution is a vertex solution of any polyhedral relaxation that keeps the constraints 0<=x_i<=1.

So you can enumerate the 0/1 solutions by filtering all vertex solutions to any such polyhedral relaxation. Whether this works well depends on the relaxation. In the example, your problem formulation happens to be perfect: Every vertex is a 0/1 solution. In general, you can have exponentially more vertex solutions than 0/1 solutions. In that case, this algorithm will not work so well.



---

archive/issue_comments_537186.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [Martin Rubey](#comment:65):\n> I guess that, in general, we want `integral_points`, right?\n> \n> Oh, but then we are back to a long time.\n\nThe default implementation of `integral_points` is not very good for this use case.\nBut after `sage -i pynormaliz`, you can do \n\n```\nsage: bmilp = bij._initialize_new_bmilp()\nsage: %time p = bmilp.milp.polyhedron(base_ring=QQ, backend='normaliz')\nCPU times: user 110 ms, sys: 3.31 ms, total: 113 ms\nWall time: 112 ms\nsage: %time p = bmilp.milp.polyhedron(base_ring=QQ, backend='normaliz').integral_points()\nCPU times: user 317 ms, sys: 35.3 ms, total: 352 ms\nWall time: 380 ms\n```\nIn this example (perfect formulation), it only adds overhead.\n\nIt would be interesting to investigate bijectionist examples in which the IP solver actually has to do something nontrivial.",
    "created_at": "2022-12-29T22:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537186",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [Martin Rubey](#comment:65):
> I guess that, in general, we want `integral_points`, right?
> 
> Oh, but then we are back to a long time.

The default implementation of `integral_points` is not very good for this use case.
But after `sage -i pynormaliz`, you can do 

```
sage: bmilp = bij._initialize_new_bmilp()
sage: %time p = bmilp.milp.polyhedron(base_ring=QQ, backend='normaliz')
CPU times: user 110 ms, sys: 3.31 ms, total: 113 ms
Wall time: 112 ms
sage: %time p = bmilp.milp.polyhedron(base_ring=QQ, backend='normaliz').integral_points()
CPU times: user 317 ms, sys: 35.3 ms, total: 352 ms
Wall time: 380 ms
```
In this example (perfect formulation), it only adds overhead.

It would be interesting to investigate bijectionist examples in which the IP solver actually has to do something nontrivial.



---

archive/issue_comments_537187.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nIn any case I would like to structure the program so that we can try either method easily.  Possibly this guides us towards a good design?\n\nI should add, the most important use case is probably `minimal_subdistributions_iterator`.  Will it work there, too?\n\nUnfortunately, I am running out of time myself :-(",
    "created_at": "2022-12-29T22:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537187",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:69" align="right">comment:69</div>

In any case I would like to structure the program so that we can try either method easily.  Possibly this guides us towards a good design?

I should add, the most important use case is probably `minimal_subdistributions_iterator`.  Will it work there, too?

Unfortunately, I am running out of time myself :-(



---

archive/issue_comments_537188.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [Martin Rubey](#comment:69):\n> In any case I would like to structure the program so that we can try either method easily.  Possibly this guides us towards a good design?\n\nYes, I think my suggestions in [comment:59](#comment:59), in particular avoiding use of `MIPSolverException` in the main class, will go in this direction",
    "created_at": "2022-12-29T23:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537188",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [Martin Rubey](#comment:69):
> In any case I would like to structure the program so that we can try either method easily.  Possibly this guides us towards a good design?

Yes, I think my suggestions in [comment:59](#comment:59), in particular avoiding use of `MIPSolverException` in the main class, will go in this direction



---

archive/issue_comments_537189.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [Martin Rubey](#comment:69):\n> the most important use case is probably `minimal_subdistributions_iterator`.  Will it work there, too?\n\nI haven't looked at the IP formulation that you use there, but I see that you have some general integer variables in addition to 0/1 variables. Is it true that a choice of the values of the 0/1 variables uniquely determines the values of the other variables? Then the same method applies.",
    "created_at": "2022-12-29T23:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537189",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [Martin Rubey](#comment:69):
> the most important use case is probably `minimal_subdistributions_iterator`.  Will it work there, too?

I haven't looked at the IP formulation that you use there, but I see that you have some general integer variables in addition to 0/1 variables. Is it true that a choice of the values of the 0/1 variables uniquely determines the values of the other variables? Then the same method applies.



---

archive/issue_comments_537190.json:
```json
{
    "body": "Changed commit from **[`a3364de`](https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a)** to **[`864029d`](https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac)**",
    "created_at": "2022-12-30T13:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537190",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a3364de`](https://github.com/sagemath/sagetrac-mirror/commit/a3364dec31f6eee2ca1c2f2777a39df5a57a716a)** to **[`864029d`](https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac)**



---

archive/issue_comments_537191.json:
```json
{
    "body": "<div id=\"comment:72\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d83a6c50c0da26065e7fda350b7a7980e98f52e\"><code>9d83a6c</code></a></td><td><code>remove unused code for backends that do not support removing constraints</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac\"><code>864029d</code></a></td><td><code>make _solution a public method of _BijectionistMILP, simplify solve</code></td></tr></table>\n",
    "created_at": "2022-12-30T13:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537191",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:72"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d83a6c50c0da26065e7fda350b7a7980e98f52e"><code>9d83a6c</code></a></td><td><code>remove unused code for backends that do not support removing constraints</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac"><code>864029d</code></a></td><td><code>make _solution a public method of _BijectionistMILP, simplify solve</code></td></tr></table>




---

archive/issue_comments_537192.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d\"><code>64101a8</code></a></td><td><code>eliminate _initialize_new_bmilp</code></td></tr></table>\n",
    "created_at": "2022-12-30T14:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537192",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d"><code>64101a8</code></a></td><td><code>eliminate _initialize_new_bmilp</code></td></tr></table>




---

archive/issue_comments_537193.json:
```json
{
    "body": "Changed commit from **[`864029d`](https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac)** to **[`64101a8`](https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d)**",
    "created_at": "2022-12-30T14:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537193",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`864029d`](https://github.com/sagemath/sagetrac-mirror/commit/864029dc1800ac3af007a58f50f9f19c2ccb98ac)** to **[`64101a8`](https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d)**



---

archive/issue_comments_537194.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nI have now completed most of your suggestions.  The remaining ones are:\n\n* perhaps there could be a slightly more high-level function [replacing `_BijectionistMILP.solution`] so that various Bijectionist methods do not have to repeat the `try ... solve ... except MIPSolverException ... else solution` pattern \n\n* I would also suggest to introduce a method in `_BijectionistMILP` that returns the variable `_x[p, z]` so that you can remove the direct use of this attribute from the Bijectionist class.\n\nI am not completely sure how exactly I should go about these.  I am still not convinced that it is a good idea to have the helper class at all.  The distinction between \"temporary constraints\", which are built in the main class and passed to `_BijectionistMILP.solve` and \"permanent constraints\", which are built by `_BijectionistMILP` itself, doesn't look completely right to me.\n\nAlso, it seems a bit strange that `_BijectionistMILP` calls methods of the main class, `_preprocess_intertwining_relations` and `_compute_possible_block_values`.  Maybe these should be moved to the helper class also?  \n\nOn a quite different level, I am pretty sure that the logic of `_forced_constant_blocks` can be simplified.  Apart from the main routine, note that at the very end we do `self.set_constant_blocks`, which invalidates the MILP and therefore all solutions in the cache.\n\nYet another thing, which is truly a detail: the method `_is_solution` really should be a method of `LinearConstraint`.\n\nIn summary, there is still a lot of work that could be done, but I am not sure whether the right time for this is now.",
    "created_at": "2022-12-30T14:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537194",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:74" align="right">comment:74</div>

I have now completed most of your suggestions.  The remaining ones are:

* perhaps there could be a slightly more high-level function [replacing `_BijectionistMILP.solution`] so that various Bijectionist methods do not have to repeat the `try ... solve ... except MIPSolverException ... else solution` pattern 

* I would also suggest to introduce a method in `_BijectionistMILP` that returns the variable `_x[p, z]` so that you can remove the direct use of this attribute from the Bijectionist class.

I am not completely sure how exactly I should go about these.  I am still not convinced that it is a good idea to have the helper class at all.  The distinction between "temporary constraints", which are built in the main class and passed to `_BijectionistMILP.solve` and "permanent constraints", which are built by `_BijectionistMILP` itself, doesn't look completely right to me.

Also, it seems a bit strange that `_BijectionistMILP` calls methods of the main class, `_preprocess_intertwining_relations` and `_compute_possible_block_values`.  Maybe these should be moved to the helper class also?  

On a quite different level, I am pretty sure that the logic of `_forced_constant_blocks` can be simplified.  Apart from the main routine, note that at the very end we do `self.set_constant_blocks`, which invalidates the MILP and therefore all solutions in the cache.

Yet another thing, which is truly a detail: the method `_is_solution` really should be a method of `LinearConstraint`.

In summary, there is still a lot of work that could be done, but I am not sure whether the right time for this is now.



---

archive/issue_comments_537195.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nThere is now a weird bug with SCIP:\n\nCurrently (after adding `default_mip_solver(\"SCIP\")` at the very beginning, most tests fail with an error like\n\n```\nFile \"src/sage/combinat/bijectionist.py\", line 160, in sage.combinat.bijectionist\nFailed example:\n    for D in sorted(bij.minimal_subdistributions_iterator(), key=lambda x: (len(x[0][0]), x)):\n        ascii_art(D)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.bijectionist[37]>\", line 1, in <module>\n        for D in sorted(bij.minimal_subdistributions_iterator(), key=lambda x: (len(x[Integer(0)][Integer(0)]), x)):\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 1901, in minimal_subdistributions_iterator\n        new_s = self._find_counter_example(self._A, s, d, False)\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 1967, in _find_counter_example\n        bmilp.solve(tmp_constraints)\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 2752, in solve\n        self.milp.remove_constraints(new_indices)\n      File \"sage/numerical/mip.pyx\", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints\n        self._backend.remove_constraints(constraints)\n      File \"sage/numerical/backends/generic_backend.pyx\", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints\n        self.remove_constraint(c)\n      File \"sage/numerical/backends/scip_backend.pyx\", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint\n        raise ValueError(\"The constraint's index i must satisfy 0 <= i < number_of_constraints\")\n    ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints\n```\n\n\nAdding\n\n```\n!#diff\ndiff --git a/src/sage/combinat/bijectionist.py b/src/sage/combinat/bijectionist.py\nindex 4da0be9fd9f..661677f78e3 100644\n--- a/src/sage/combinat/bijectionist.py\n+++ b/src/sage/combinat/bijectionist.py\n@@ -38,6 +38,7 @@ A guided tour\n     We find a statistic `s` such that\n     `(s, wex, fix) \\sim (llis, des, adj)`::\n \n+        sage: default_mip_solver(\"SCIP\")\n         sage: N = 3\n         sage: As = [list(Permutations(n)) for n in range(N+1)]\n         sage: A = B = sum(As, [])\n@@ -2747,6 +2748,7 @@ class _BijectionistMILP():\n             self.last_solution = self.milp.get_values(self._x,\n                                                       convert=bool, tolerance=0.1)\n         finally:\n+            repr(self.milp)\n             self.milp.remove_constraints(new_indices)\n \n         # veto the solution, by requiring that not all variables with\n```\nthis problem goes away, and the output of the tests is OK.  What could this be?",
    "created_at": "2022-12-30T17:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537195",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:75" align="right">comment:75</div>

There is now a weird bug with SCIP:

Currently (after adding `default_mip_solver("SCIP")` at the very beginning, most tests fail with an error like

```
File "src/sage/combinat/bijectionist.py", line 160, in sage.combinat.bijectionist
Failed example:
    for D in sorted(bij.minimal_subdistributions_iterator(), key=lambda x: (len(x[0][0]), x)):
        ascii_art(D)
Exception raised:
    Traceback (most recent call last):
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.bijectionist[37]>", line 1, in <module>
        for D in sorted(bij.minimal_subdistributions_iterator(), key=lambda x: (len(x[Integer(0)][Integer(0)]), x)):
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 1901, in minimal_subdistributions_iterator
        new_s = self._find_counter_example(self._A, s, d, False)
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 1967, in _find_counter_example
        bmilp.solve(tmp_constraints)
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 2752, in solve
        self.milp.remove_constraints(new_indices)
      File "sage/numerical/mip.pyx", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints
        self._backend.remove_constraints(constraints)
      File "sage/numerical/backends/generic_backend.pyx", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints
        self.remove_constraint(c)
      File "sage/numerical/backends/scip_backend.pyx", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint
        raise ValueError("The constraint's index i must satisfy 0 <= i < number_of_constraints")
    ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints
```


Adding

```
!#diff
diff --git a/src/sage/combinat/bijectionist.py b/src/sage/combinat/bijectionist.py
index 4da0be9fd9f..661677f78e3 100644
--- a/src/sage/combinat/bijectionist.py
+++ b/src/sage/combinat/bijectionist.py
@@ -38,6 +38,7 @@ A guided tour
     We find a statistic `s` such that
     `(s, wex, fix) \sim (llis, des, adj)`::
 
+        sage: default_mip_solver("SCIP")
         sage: N = 3
         sage: As = [list(Permutations(n)) for n in range(N+1)]
         sage: A = B = sum(As, [])
@@ -2747,6 +2748,7 @@ class _BijectionistMILP():
             self.last_solution = self.milp.get_values(self._x,
                                                       convert=bool, tolerance=0.1)
         finally:
+            repr(self.milp)
             self.milp.remove_constraints(new_indices)
 
         # veto the solution, by requiring that not all variables with
```
this problem goes away, and the output of the tests is OK.  What could this be?



---

archive/issue_comments_537196.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nInstead of `repr(self.milp)`, doing\n\n```\n            m = self.milp\n            b = m.get_backend()\n            [b.objective_coefficient(i) for i in range(b.ncols())]\n```\nis enough to make things work.",
    "created_at": "2022-12-30T18:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537196",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:76" align="right">comment:76</div>

Instead of `repr(self.milp)`, doing

```
            m = self.milp
            b = m.get_backend()
            [b.objective_coefficient(i) for i in range(b.ncols())]
```
is enough to make things work.



---

archive/issue_comments_537197.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\n\n```\n            m = self.milp.get_backend()._get_model()\n            if m.getStatus() != 'unknown':            \n                m.freeTransform()\n```\nis also enough.",
    "created_at": "2022-12-30T18:28:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537197",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:77" align="right">comment:77</div>


```
            m = self.milp.get_backend()._get_model()
            if m.getStatus() != 'unknown':            
                m.freeTransform()
```
is also enough.



---

archive/issue_comments_537198.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nThis raises yet another question: according to the documentation, https://scipopt.github.io/PySCIPOpt/docs/html/classpyscipopt_1_1scip_1_1Model.html#a13c33bbfda259edd6249879a8cc3bcb8:\n\n```\nFrees all solution process data including presolving and transformed problem, only original problem is kept\n```\n\nBut this means that adding and removing constraints again is really expensive, no?",
    "created_at": "2022-12-30T18:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537198",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:78" align="right">comment:78</div>

This raises yet another question: according to the documentation, https://scipopt.github.io/PySCIPOpt/docs/html/classpyscipopt_1_1scip_1_1Model.html#a13c33bbfda259edd6249879a8cc3bcb8:

```
Frees all solution process data including presolving and transformed problem, only original problem is kept
```

But this means that adding and removing constraints again is really expensive, no?



---

archive/issue_comments_537199.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [Martin Rubey](#comment:78):\n> This raises yet another question: according to the documentation, https://scipopt.github.io/PySCIPOpt/docs/html/classpyscipopt_1_1scip_1_1Model.html#a13c33bbfda259edd6249879a8cc3bcb8:\n> \n> ```\n> Frees all solution process data including presolving and transformed problem, only original problem is kept\n> ```\n> \n> But this means that adding and removing constraints again is really expensive, no?\n\nYes.",
    "created_at": "2022-12-30T19:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537199",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [Martin Rubey](#comment:78):
> This raises yet another question: according to the documentation, https://scipopt.github.io/PySCIPOpt/docs/html/classpyscipopt_1_1scip_1_1Model.html#a13c33bbfda259edd6249879a8cc3bcb8:
> 
> ```
> Frees all solution process data including presolving and transformed problem, only original problem is kept
> ```
> 
> But this means that adding and removing constraints again is really expensive, no?

Yes.



---

archive/issue_comments_537200.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [Martin Rubey](#comment:77):\n> \n> ```\n>             m = self.milp.get_backend()._get_model()\n>             if m.getStatus() != 'unknown':            \n>                 m.freeTransform()\n> ```\n> is also enough.\n\nCan you find a fix for scip_backend.pyx?",
    "created_at": "2022-12-30T19:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537200",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [Martin Rubey](#comment:77):
> 
> ```
>             m = self.milp.get_backend()._get_model()
>             if m.getStatus() != 'unknown':            
>                 m.freeTransform()
> ```
> is also enough.

Can you find a fix for scip_backend.pyx?



---

archive/issue_comments_537201.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nNo, I have no idea what's going on, because we have\n\n```\n    cpdef remove_constraint(self, int i):\n...\n        if i < 0 or i >= self.nrows():\n            raise ValueError(\"The constraint's index i must satisfy 0 <= i < number_of_constraints\")\n        if self.model.getStatus() != 'unknown':\n            self.model.freeTransform()\n        self.model.delCons(self.model.getConss()[i])\n```\nand using this method (instead of using `remove_constraints`)  fails also.",
    "created_at": "2022-12-30T19:26:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537201",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:81" align="right">comment:81</div>

No, I have no idea what's going on, because we have

```
    cpdef remove_constraint(self, int i):
...
        if i < 0 or i >= self.nrows():
            raise ValueError("The constraint's index i must satisfy 0 <= i < number_of_constraints")
        if self.model.getStatus() != 'unknown':
            self.model.freeTransform()
        self.model.delCons(self.model.getConss()[i])
```
and using this method (instead of using `remove_constraints`)  fails also.



---

archive/issue_comments_537202.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nUnrelated comment:\n\n```\n+        # convert input to set of block representatives\n+        blocks = set()\n+        if p in self._A:\n+            blocks.add(self._P.find(p))\n+        elif type(p) is list:  # TODO: this looks very brittle\n+            for p1 in p:\n+                if p1 in self._A:\n+                    blocks.add(self._P.find(p1))\n+                elif type(p1) is list:\n+                    for p2 in p1:\n+                        blocks.add(self._P.find(p2))\n```\nInstead of `type(...) is list`, you can use `isinstance(..., collections.abc.Iterable)` - https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes\n\nAlso after each the `elif` blocks, there should probably be an `else` block that raises an error.",
    "created_at": "2022-12-30T19:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537202",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

Unrelated comment:

```
+        # convert input to set of block representatives
+        blocks = set()
+        if p in self._A:
+            blocks.add(self._P.find(p))
+        elif type(p) is list:  # TODO: this looks very brittle
+            for p1 in p:
+                if p1 in self._A:
+                    blocks.add(self._P.find(p1))
+                elif type(p1) is list:
+                    for p2 in p1:
+                        blocks.add(self._P.find(p2))
```
Instead of `type(...) is list`, you can use `isinstance(..., collections.abc.Iterable)` - https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes

Also after each the `elif` blocks, there should probably be an `else` block that raises an error.



---

archive/issue_comments_537203.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:82):\n\n> Instead of `type(...) is list`, you can use `isinstance(..., collections.abc.Iterable)` - https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes\n\nI don't think so, because elements of `A` might be iterable.  We require the objects to be hashable, so we can allow lists.",
    "created_at": "2022-12-30T19:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537203",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [Matthias KÃ¶ppe](#comment:82):

> Instead of `type(...) is list`, you can use `isinstance(..., collections.abc.Iterable)` - https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes

I don't think so, because elements of `A` might be iterable.  We require the objects to be hashable, so we can allow lists.



---

archive/issue_comments_537204.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nOK, I'll take care of [#21003 comment:139](https://github.com/sagemath/sage/issues/21003#comment:139) first and then try to reproduce [comment:75](#comment:75)",
    "created_at": "2022-12-30T20:10:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537204",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

OK, I'll take care of [#21003 comment:139](https://github.com/sagemath/sage/issues/21003#comment:139) first and then try to reproduce [comment:75](#comment:75)



---

archive/issue_comments_537205.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nI've pushed a branch with merged dependencies to `public/33238`. Can't reproduce the problem",
    "created_at": "2022-12-30T21:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537205",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

I've pushed a branch with merged dependencies to `public/33238`. Can't reproduce the problem



---

archive/issue_comments_537206.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nUnrelated:\n\n```\n            # function adding a solution to dict of solutions\n            def add_solution(solutions, solution):\n                for p, value in solution.items():\n                    if p not in solutions:\n                        solutions[p] = set()\n                    solutions[p].add(value)\n\n            [...]\n\n            solutions = {}\n            add_solution(solutions, solution)\n```\nThis can be simplified using `solutions = defaultdict(set)`",
    "created_at": "2022-12-30T22:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537206",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:86" align="right">comment:86</div>

Unrelated:

```
            # function adding a solution to dict of solutions
            def add_solution(solutions, solution):
                for p, value in solution.items():
                    if p not in solutions:
                        solutions[p] = set()
                    solutions[p].add(value)

            [...]

            solutions = {}
            add_solution(solutions, solution)
```
This can be simplified using `solutions = defaultdict(set)`



---

archive/issue_comments_537207.json:
```json
{
    "body": "Changed commit from **[`64101a8`](https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d)** to **[`2d34911`](https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7)**",
    "created_at": "2022-12-30T23:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537207",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`64101a8`](https://github.com/sagemath/sagetrac-mirror/commit/64101a8ffe9fabffa5a33faca001b4292ba6e28d)** to **[`2d34911`](https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7)**



---

archive/issue_comments_537208.json:
```json
{
    "body": "<div id=\"comment:87\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7\"><code>2d34911</code></a></td><td><code>slightly simplify logic of _forced_constant_blocks, use defaultdict</code></td></tr></table>\n",
    "created_at": "2022-12-30T23:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537208",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:87"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7"><code>2d34911</code></a></td><td><code>slightly simplify logic of _forced_constant_blocks, use defaultdict</code></td></tr></table>




---

archive/issue_comments_537209.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32\"><code>c2f0062</code></a></td><td><code>slight simplification</code></td></tr></table>\n",
    "created_at": "2022-12-30T23:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537209",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32"><code>c2f0062</code></a></td><td><code>slight simplification</code></td></tr></table>




---

archive/issue_comments_537210.json:
```json
{
    "body": "Changed commit from **[`2d34911`](https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7)** to **[`c2f0062`](https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32)**",
    "created_at": "2022-12-30T23:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537210",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d34911`](https://github.com/sagemath/sagetrac-mirror/commit/2d349114a367d5c7196ad50f1e847dfe466857c7)** to **[`c2f0062`](https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32)**



---

archive/issue_comments_537211.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:79):\n> Replying to [Martin Rubey](#comment:78):\n> > But this means that adding and removing constraints again is really expensive, no?\n\n> \n> Yes.\n\nI think it would make sense to rework it so that you only make copies and add constraints, rather than trying to remove constraints. This would probably simplify the logic of the code (helping to get rid of the notion of \"temporary constraints\").\n\nAnd it also makes sense from the viewpoint of the polyhedral enumeration method: Some polyhedral computation backends (including Normaliz) have some support for adding constraints (although this is not exposed yet in Sage's Polyhedron classes)",
    "created_at": "2022-12-30T23:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537211",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [Matthias KÃ¶ppe](#comment:79):
> Replying to [Martin Rubey](#comment:78):
> > But this means that adding and removing constraints again is really expensive, no?

> 
> Yes.

I think it would make sense to rework it so that you only make copies and add constraints, rather than trying to remove constraints. This would probably simplify the logic of the code (helping to get rid of the notion of "temporary constraints").

And it also makes sense from the viewpoint of the polyhedral enumeration method: Some polyhedral computation backends (including Normaliz) have some support for adding constraints (although this is not exposed yet in Sage's Polyhedron classes)



---

archive/issue_comments_537212.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nWell, currently removing is *much* faster, even after the patch in #21003.\n\nThe difference in code is quite local - it only affects the `_BijectionistMILP.solve` method.\n\nSo, if possible I'd rather concentrate on the design and, if this is reasonable, get it into sage in the hope that some interesting use cases pop up.  I am using it in my day to day research, but of course, that's a rather biased view.",
    "created_at": "2022-12-30T23:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537212",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:90" align="right">comment:90</div>

Well, currently removing is *much* faster, even after the patch in #21003.

The difference in code is quite local - it only affects the `_BijectionistMILP.solve` method.

So, if possible I'd rather concentrate on the design and, if this is reasonable, get it into sage in the hope that some interesting use cases pop up.  I am using it in my day to day research, but of course, that's a rather biased view.



---

archive/issue_comments_537213.json:
```json
{
    "body": "Changed commit from **[`c2f0062`](https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32)** to **[`78968ae`](https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a)**",
    "created_at": "2022-12-31T19:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537213",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c2f0062`](https://github.com/sagemath/sagetrac-mirror/commit/c2f0062e977fe6ff595862ce72e061d87aaf2d32)** to **[`78968ae`](https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a)**



---

archive/issue_comments_537214.json:
```json
{
    "body": "<div id=\"comment:91\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a\"><code>78968ae</code></a></td><td><code>copy (instead of deepcopy) should be correct</code></td></tr></table>\n",
    "created_at": "2022-12-31T19:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:91"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a"><code>78968ae</code></a></td><td><code>copy (instead of deepcopy) should be correct</code></td></tr></table>




---

archive/issue_comments_537215.json:
```json
{
    "body": "<div id=\"comment:92\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74\"><code>6ddaeae</code></a></td><td><code>slightly simplify _preprocess_intertwining_relations</code></td></tr></table>\n",
    "created_at": "2022-12-31T19:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537215",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74"><code>6ddaeae</code></a></td><td><code>slightly simplify _preprocess_intertwining_relations</code></td></tr></table>




---

archive/issue_comments_537216.json:
```json
{
    "body": "Changed commit from **[`78968ae`](https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a)** to **[`6ddaeae`](https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74)**",
    "created_at": "2022-12-31T19:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`78968ae`](https://github.com/sagemath/sagetrac-mirror/commit/78968aebf38b7ca80295a67c296ef0e8df213b7a)** to **[`6ddaeae`](https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74)**



---

archive/issue_comments_537217.json:
```json
{
    "body": "Changed commit from **[`6ddaeae`](https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74)** to **[`60286e6`](https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a)**",
    "created_at": "2022-12-31T19:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6ddaeae`](https://github.com/sagemath/sagetrac-mirror/commit/6ddaeae19c78bb860744fba4bf2b00dc3ef7cd74)** to **[`60286e6`](https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a)**



---

archive/issue_comments_537218.json:
```json
{
    "body": "<div id=\"comment:93\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a\"><code>60286e6</code></a></td><td><code>slightly improve non_copying_intersection</code></td></tr></table>\n",
    "created_at": "2022-12-31T19:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537218",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:93"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a"><code>60286e6</code></a></td><td><code>slightly improve non_copying_intersection</code></td></tr></table>




---

archive/issue_comments_537219.json:
```json
{
    "body": "<div id=\"comment:94\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65\"><code>c38f5b9</code></a></td><td><code>add some internal documentation</code></td></tr></table>\n",
    "created_at": "2022-12-31T20:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537219",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:94"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65"><code>c38f5b9</code></a></td><td><code>add some internal documentation</code></td></tr></table>




---

archive/issue_comments_537220.json:
```json
{
    "body": "Changed commit from **[`60286e6`](https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a)** to **[`c38f5b9`](https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65)**",
    "created_at": "2022-12-31T20:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537220",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60286e6`](https://github.com/sagemath/sagetrac-mirror/commit/60286e60eafe0206430176074e0b158a6d6f9d0a)** to **[`c38f5b9`](https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65)**



---

archive/issue_comments_537221.json:
```json
{
    "body": "Changed commit from **[`c38f5b9`](https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65)** to **[`6fb06f0`](https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11)**",
    "created_at": "2023-01-02T11:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537221",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c38f5b9`](https://github.com/sagemath/sagetrac-mirror/commit/c38f5b94d92171a2d18e884f9bdb095ff34ffc65)** to **[`6fb06f0`](https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11)**



---

archive/issue_comments_537222.json:
```json
{
    "body": "<div id=\"comment:95\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11\"><code>6fb06f0</code></a></td><td><code>untangle _preprocess_intertwining_relations</code></td></tr></table>\n",
    "created_at": "2023-01-02T11:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537222",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11"><code>6fb06f0</code></a></td><td><code>untangle _preprocess_intertwining_relations</code></td></tr></table>




---

archive/issue_comments_537223.json:
```json
{
    "body": "Changed commit from **[`6fb06f0`](https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11)** to **[`706056e`](https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142)**",
    "created_at": "2023-01-02T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537223",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6fb06f0`](https://github.com/sagemath/sagetrac-mirror/commit/6fb06f0b17b08528f53e7299d610b67ecf216b11)** to **[`706056e`](https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142)**



---

archive/issue_comments_537224.json:
```json
{
    "body": "<div id=\"comment:96\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142\"><code>706056e</code></a></td><td><code>add possibility to require a homomesy</code></td></tr></table>\n",
    "created_at": "2023-01-02T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537224",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:96"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142"><code>706056e</code></a></td><td><code>add possibility to require a homomesy</code></td></tr></table>




---

archive/issue_comments_537225.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nconcerning performance - it would be very nice if we could improve tasks like the following:\n\n```\nsage: default_mip_solver(\"SCIP\")\nsage: from sage.combinat.cyclic_sieving_phenomenon import orbit_decomposition\nsage: f = findstat()\nsage: f._allow_execution=True\nsage: %cpaste\nPasting code; enter '--' alone on the line to stop or use Ctrl-D.\n:def rotate_permutation(p):\n:    cycle = Permutation(tuple(range(1, len(p)+1)))\n:    return Permutation([cycle.inverse()(p(cycle(i))) for i in range(1, len(p)+1)])\n:\n:--\nsage: s = findstat(1377)\nsage: n=5; A = B = Permutations(n)\nsage: Q = orbit_decomposition(A, rotate_permutation)\nsage: bij = Bijectionist(A, B, s)\nsage: bij.set_homomesic(Q)\nsage: %time bij.constant_blocks(optimal=True)\nCPU times: user 9.12 s, sys: 40 ms, total: 9.16 s\nWall time: 9.17 s\n{{[1, 2, 3, 4, 5], [2, 3, 4, 5, 1], [3, 4, 5, 1, 2], [4, 5, 1, 2, 3], [5, 1, 2, 3, 4]}}\nsage: it = bij.minimal_subdistributions_iterator()\nsage: next(it)\n([[5, 1, 2, 3, 4]], [0])\nsage: next(it)\n([[4, 5, 1, 2, 3]], [0])\nsage: next(it)\n([[3, 4, 5, 1, 2]], [0])\nsage: next(it)\n([[2, 3, 4, 5, 1]], [0])\nsage: next(it)\n([[1, 2, 3, 4, 5]], [0])\nsage: %time next(it)\n... takes \"forever\" ...\n```",
    "created_at": "2023-01-02T16:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537225",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:97" align="right">comment:97</div>

concerning performance - it would be very nice if we could improve tasks like the following:

```
sage: default_mip_solver("SCIP")
sage: from sage.combinat.cyclic_sieving_phenomenon import orbit_decomposition
sage: f = findstat()
sage: f._allow_execution=True
sage: %cpaste
Pasting code; enter '--' alone on the line to stop or use Ctrl-D.
:def rotate_permutation(p):
:    cycle = Permutation(tuple(range(1, len(p)+1)))
:    return Permutation([cycle.inverse()(p(cycle(i))) for i in range(1, len(p)+1)])
:
:--
sage: s = findstat(1377)
sage: n=5; A = B = Permutations(n)
sage: Q = orbit_decomposition(A, rotate_permutation)
sage: bij = Bijectionist(A, B, s)
sage: bij.set_homomesic(Q)
sage: %time bij.constant_blocks(optimal=True)
CPU times: user 9.12 s, sys: 40 ms, total: 9.16 s
Wall time: 9.17 s
{{[1, 2, 3, 4, 5], [2, 3, 4, 5, 1], [3, 4, 5, 1, 2], [4, 5, 1, 2, 3], [5, 1, 2, 3, 4]}}
sage: it = bij.minimal_subdistributions_iterator()
sage: next(it)
([[5, 1, 2, 3, 4]], [0])
sage: next(it)
([[4, 5, 1, 2, 3]], [0])
sage: next(it)
([[3, 4, 5, 1, 2]], [0])
sage: next(it)
([[2, 3, 4, 5, 1]], [0])
sage: next(it)
([[1, 2, 3, 4, 5]], [0])
sage: %time next(it)
... takes "forever" ...
```



---

archive/issue_comments_537226.json:
```json
{
    "body": "<div id=\"comment:98\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bd8f39f95e9f4df09945f12fd452b037d16f930\"><code>5bd8f39</code></a></td><td><code>MixedIntegerLinearProgram.add_constraint: Return row index</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7df5212cf9dfebe12177a409cc4a47b47d75e16\"><code>e7df521</code></a></td><td><code>MixedIntegerLinearProgram.add_constraint: Do not refuse to add empty constraints; they could be infeasible or we may need their row index for later</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1fad0cb9dfe2469451a9679df4a7069fe9c1b74\"><code>d1fad0c</code></a></td><td><code>src/sage/features/mip_backends.py: Add CVXOPT feature</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c57da31dc988e1ad23c4a9013c8b93ff973fcf76\"><code>c57da31</code></a></td><td><code>return indices of added rows only on demand and return a list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31\"><code>cfe24fe</code></a></td><td><code>add a doctest for adding and removing constraints</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7\"><code>6c34bc3</code></a></td><td><code>make linter happy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca\"><code>3b929f8</code></a></td><td><code>forgot newline in docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8a066303b076c1c28df955939f0035033e7023a\"><code>d8a0663</code></a></td><td><code>Merge branch 'u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b03cf22dc0abc3e76566e7975fb94d5a08d11450\"><code>b03cf22</code></a></td><td><code>take care of the corner case for all backends in the frontend</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3\"><code>4e90280</code></a></td><td><code>Merge branch 'u/mantepse/allow_to_remove_no_constraints' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr></table>\n",
    "created_at": "2023-01-02T19:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537226",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:98"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bd8f39f95e9f4df09945f12fd452b037d16f930"><code>5bd8f39</code></a></td><td><code>MixedIntegerLinearProgram.add_constraint: Return row index</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7df5212cf9dfebe12177a409cc4a47b47d75e16"><code>e7df521</code></a></td><td><code>MixedIntegerLinearProgram.add_constraint: Do not refuse to add empty constraints; they could be infeasible or we may need their row index for later</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1fad0cb9dfe2469451a9679df4a7069fe9c1b74"><code>d1fad0c</code></a></td><td><code>src/sage/features/mip_backends.py: Add CVXOPT feature</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c57da31dc988e1ad23c4a9013c8b93ff973fcf76"><code>c57da31</code></a></td><td><code>return indices of added rows only on demand and return a list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfe24fe41656e678df6014c11eed35e4cdf6da31"><code>cfe24fe</code></a></td><td><code>add a doctest for adding and removing constraints</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c34bc3273b821304b9d8403bf936a5f9add88a7"><code>6c34bc3</code></a></td><td><code>make linter happy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b929f89b56dd1347df6a125460262cfaae62eca"><code>3b929f8</code></a></td><td><code>forgot newline in docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8a066303b076c1c28df955939f0035033e7023a"><code>d8a0663</code></a></td><td><code>Merge branch 'u/mantepse/mixedintegerlinearprogram_add_constraint__return_row_index' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b03cf22dc0abc3e76566e7975fb94d5a08d11450"><code>b03cf22</code></a></td><td><code>take care of the corner case for all backends in the frontend</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3"><code>4e90280</code></a></td><td><code>Merge branch 'u/mantepse/allow_to_remove_no_constraints' of trac.sagemath.org:sage into t/33238/a_bijectionist_s_toolkit</code></td></tr></table>




---

archive/issue_comments_537227.json:
```json
{
    "body": "Changed commit from **[`706056e`](https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142)** to **[`4e90280`](https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3)**",
    "created_at": "2023-01-02T19:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537227",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`706056e`](https://github.com/sagemath/sagetrac-mirror/commit/706056e5dbdaf049f56963d2cf67300267899142)** to **[`4e90280`](https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3)**



---

archive/issue_comments_537228.json:
```json
{
    "body": "<div id=\"comment:99\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6\"><code>65b0c4a</code></a></td><td><code>preserve the cache of solutions after computing the optimal constant blocks</code></td></tr></table>\n",
    "created_at": "2023-01-02T23:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537228",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:99"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6"><code>65b0c4a</code></a></td><td><code>preserve the cache of solutions after computing the optimal constant blocks</code></td></tr></table>




---

archive/issue_comments_537229.json:
```json
{
    "body": "Changed commit from **[`4e90280`](https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3)** to **[`65b0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6)**",
    "created_at": "2023-01-02T23:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537229",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e90280`](https://github.com/sagemath/sagetrac-mirror/commit/4e90280d313c7d06ab39e04d4941e302a18dabc3)** to **[`65b0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6)**



---

archive/issue_comments_537230.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nI don't think I can improve this much further now.  Please review!",
    "created_at": "2023-01-03T01:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537230",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:0" align="right">comment:0</div>

I don't think I can improve this much further now.  Please review!



---

archive/issue_comments_537231.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI'd suggest to combine \"solve\" and \"solution\" into one method to eliminate some state from the interface",
    "created_at": "2023-01-03T01:23:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537231",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

I'd suggest to combine "solve" and "solution" into one method to eliminate some state from the interface



---

archive/issue_comments_537232.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n... and to eliminate `solution_index`",
    "created_at": "2023-01-03T01:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537232",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

... and to eliminate `solution_index`



---

archive/issue_comments_537233.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nDo you mean to combine `solve` and `solution` into something like the following?\n\n```\ndef solution(self, on_blocks, temporary_constraints, new_solution):\n```\nI agree that this makes sense.\n\nI don't see how to eliminate `solution_index` entirely (other than making it Boolean).  There are three (slightly) differen clients:\n\n1. get any (initial) solution\n2. get a solution with some additional, temporary, constraints\n3. get a new solution\n\nThe last version is needed in the `solutions_iterator`.  It differs from 1., because it may be quite hard to find a new solution, but easy to get just any.\n\nI could also offer two different methods, `solution` and `new_solution`, but this would split the code in a very artificial way - `solution` may need to call `new_solution` with temporary constraints.",
    "created_at": "2023-01-03T09:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537233",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

Do you mean to combine `solve` and `solution` into something like the following?

```
def solution(self, on_blocks, temporary_constraints, new_solution):
```
I agree that this makes sense.

I don't see how to eliminate `solution_index` entirely (other than making it Boolean).  There are three (slightly) differen clients:

1. get any (initial) solution
2. get a solution with some additional, temporary, constraints
3. get a new solution

The last version is needed in the `solutions_iterator`.  It differs from 1., because it may be quite hard to find a new solution, but easy to get just any.

I could also offer two different methods, `solution` and `new_solution`, but this would split the code in a very artificial way - `solution` may need to call `new_solution` with temporary constraints.



---

archive/issue_comments_537234.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.",
    "created_at": "2023-01-03T10:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537234",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">comment:4</div>

It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.



---

archive/issue_comments_537235.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177\"><code>21cb54f</code></a></td><td><code>make _BijectionistMILP.solution the only entrypoint</code></td></tr></table>\n",
    "created_at": "2023-01-03T12:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537235",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177"><code>21cb54f</code></a></td><td><code>make _BijectionistMILP.solution the only entrypoint</code></td></tr></table>




---

archive/issue_comments_537236.json:
```json
{
    "body": "Changed commit from **[`65b0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6)** to **[`21cb54f`](https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177)**",
    "created_at": "2023-01-03T12:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537236",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`65b0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/65b0c4adfff850b54c98695d8c027dc20a510ff6)** to **[`21cb54f`](https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177)**



---

archive/issue_comments_537237.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nReplying to [Martin Rubey](#comment:104):\n> It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.\n\nThen why not push the solution generator from Bijectionist down to _BijectistMILP?",
    "created_at": "2023-01-03T17:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537237",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:106" align="right">comment:106</div>

Replying to [Martin Rubey](#comment:104):
> It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.

Then why not push the solution generator from Bijectionist down to _BijectistMILP?



---

archive/issue_comments_537238.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:106):\n> Replying to [Martin Rubey](#comment:104):\n> > It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.\n\n> \n> Then why not push the solution generator from Bijectionist down to _BijectistMILP?\n\nWhy would this get rid of `solution_index`?\n\nApart from that, I repeat that it is not at all clear to me whether there should be one class or two classes, or, more generally, which methods should be in which class.\n\nThe general idea so far was, that the `Bijectionist.set`-methods only normalize the data, the `_BijectionistMILP` class sets up the constraints, and the other methods in `Bijectionist` retrieve solutions (of various kinds) from the `_BijectionistMILP` class.\n\nIt seems desirable that after retrieving certain kinds of solutions (e.g., `constant_blocks(optimal=True)`, the MILP should be rewritten.  However, I don't know in which cases this makes sense.  For example, currently this is not done for `possible_values(optimal=True)`, because I was unable to find a situation where this makes sense.  I also suspect that this might also depend a lot on the solver and how we use it.\n\nIn any case, maybe we should be more radical and move even more stuff into `_BijectionistMILP` - i.e., make the `Bijectionist` mainly a wrapper for methods from the `_BijectionistMILP` class?\n\nOne further remark: the method `Bijectionist.statistics_fibers` is probably one of the most useful methods, and does not involve any MILP at all.  It is important that this is lightweight.",
    "created_at": "2023-01-03T17:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537238",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:107" align="right">comment:107</div>

Replying to [Matthias KÃ¶ppe](#comment:106):
> Replying to [Martin Rubey](#comment:104):
> > It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.

> 
> Then why not push the solution generator from Bijectionist down to _BijectistMILP?

Why would this get rid of `solution_index`?

Apart from that, I repeat that it is not at all clear to me whether there should be one class or two classes, or, more generally, which methods should be in which class.

The general idea so far was, that the `Bijectionist.set`-methods only normalize the data, the `_BijectionistMILP` class sets up the constraints, and the other methods in `Bijectionist` retrieve solutions (of various kinds) from the `_BijectionistMILP` class.

It seems desirable that after retrieving certain kinds of solutions (e.g., `constant_blocks(optimal=True)`, the MILP should be rewritten.  However, I don't know in which cases this makes sense.  For example, currently this is not done for `possible_values(optimal=True)`, because I was unable to find a situation where this makes sense.  I also suspect that this might also depend a lot on the solver and how we use it.

In any case, maybe we should be more radical and move even more stuff into `_BijectionistMILP` - i.e., make the `Bijectionist` mainly a wrapper for methods from the `_BijectionistMILP` class?

One further remark: the method `Bijectionist.statistics_fibers` is probably one of the most useful methods, and does not involve any MILP at all.  It is important that this is lightweight.



---

archive/issue_comments_537239.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\nReplying to [Martin Rubey](#comment:107):\n> Replying to [Matthias K\u00f6ppe](#comment:106):\n> > Replying to [Martin Rubey](#comment:104):\n> > > It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.\n\n> > \n> > Then why not push the solution generator from Bijectionist down to _BijectistMILP?\n\n> \n> Why would this get rid of `solution_index`?\n\nAsking the model to provide an iterator for solutions is a better interface than asking it to provide the n-th solution if iterating through the solutions is all you need.",
    "created_at": "2023-01-03T17:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537239",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:108" align="right">comment:108</div>

Replying to [Martin Rubey](#comment:107):
> Replying to [Matthias KÃ¶ppe](#comment:106):
> > Replying to [Martin Rubey](#comment:104):
> > > It turns out that just `new` instead of `solution_index` is not enough, because I want to be able to guarantee the same order of solutions, see doctests of `solution_iterator`.

> > 
> > Then why not push the solution generator from Bijectionist down to _BijectistMILP?

> 
> Why would this get rid of `solution_index`?

Asking the model to provide an iterator for solutions is a better interface than asking it to provide the n-th solution if iterating through the solutions is all you need.



---

archive/issue_comments_537240.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSee also #34888 for a general design of a solution enumerator given a `MixedIntegerLinearProgram`.",
    "created_at": "2023-01-03T18:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537240",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

See also #34888 for a general design of a solution enumerator given a `MixedIntegerLinearProgram`.



---

archive/issue_comments_537241.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:108):\n\n> > > Then why not push the solution generator from Bijectionist down to _BijectistMILP?\n\n> > \n> > Why would this get rid of `solution_index`?\n\n> \n> Asking the model to provide an iterator for solutions is a better interface than asking it to provide the n-th solution if iterating through the solutions is all you need.\n\nAlthout I do not understand how this answers my question, I assume it might be better to push down the implementations of `solutions_iterator`, `minimal_subdistributions_iterator`, `minimal_subdistribution_blocks_iterator`, `possible_values` and `constant_blocks`.\n\nDo you agree, and would this be a step towards a positive review?",
    "created_at": "2023-01-03T18:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537241",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:110" align="right">comment:110</div>

Replying to [Matthias KÃ¶ppe](#comment:108):

> > > Then why not push the solution generator from Bijectionist down to _BijectistMILP?

> > 
> > Why would this get rid of `solution_index`?

> 
> Asking the model to provide an iterator for solutions is a better interface than asking it to provide the n-th solution if iterating through the solutions is all you need.

Althout I do not understand how this answers my question, I assume it might be better to push down the implementations of `solutions_iterator`, `minimal_subdistributions_iterator`, `minimal_subdistribution_blocks_iterator`, `possible_values` and `constant_blocks`.

Do you agree, and would this be a step towards a positive review?



---

archive/issue_comments_537242.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI think it is better to think about `_BijectionistMILP` as a class that manages one family of MIP models - the one set up by its `__init__` method and possibly additional (\"temporary\") constraints. The class translates between the natural presentation of solutions and the technical presentation (encoding) that is used by the MIP model.\n\nThe method `minimal_subdistributions_iterator` uses a different, unrelated MIP model. It should not be managed by the same class. If you want, you can create a separate class for it.\n\nLikewise for `minimal_subdistributions_blocks_iterator`.",
    "created_at": "2023-01-03T18:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537242",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

I think it is better to think about `_BijectionistMILP` as a class that manages one family of MIP models - the one set up by its `__init__` method and possibly additional ("temporary") constraints. The class translates between the natural presentation of solutions and the technical presentation (encoding) that is used by the MIP model.

The method `minimal_subdistributions_iterator` uses a different, unrelated MIP model. It should not be managed by the same class. If you want, you can create a separate class for it.

Likewise for `minimal_subdistributions_blocks_iterator`.



---

archive/issue_comments_537243.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSo, do I understand correctly that I should *only* move the implementation of `solutions_iterator`?",
    "created_at": "2023-01-03T19:09:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537243",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:2" align="right">comment:2</div>

So, do I understand correctly that I should *only* move the implementation of `solutions_iterator`?



---

archive/issue_comments_537244.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nYes",
    "created_at": "2023-01-03T19:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537244",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

Yes



---

archive/issue_comments_537245.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a573bb4cdb914a689e20eaaa51c43860f1e48a7d\"><code>a573bb4</code></a></td><td><code>remove unnecessary calls to list in doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89\"><code>6868261</code></a></td><td><code>move iterator over all solutions to _BijectionistMILP</code></td></tr></table>\n",
    "created_at": "2023-01-03T19:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537245",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a573bb4cdb914a689e20eaaa51c43860f1e48a7d"><code>a573bb4</code></a></td><td><code>remove unnecessary calls to list in doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89"><code>6868261</code></a></td><td><code>move iterator over all solutions to _BijectionistMILP</code></td></tr></table>




---

archive/issue_comments_537246.json:
```json
{
    "body": "Changed commit from **[`21cb54f`](https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177)** to **[`6868261`](https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89)**",
    "created_at": "2023-01-03T19:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537246",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`21cb54f`](https://github.com/sagemath/sagetrac-mirror/commit/21cb54f6e116d3b89db4a4d3789c904cc1ce5177)** to **[`6868261`](https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89)**



---

archive/issue_comments_537247.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNow try to merge `_solve`, `solution`, and `__iter__` into a single method and get rid of `last_solution` and `index`/`solution_index`",
    "created_at": "2023-01-03T20:05:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537247",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Now try to merge `_solve`, `solution`, and `__iter__` into a single method and get rid of `last_solution` and `index`/`solution_index`



---

archive/issue_comments_537248.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDo you know how to do this?  It is quite stressful for me to deal with this, although it is certainly important to me to get this ticket into sage, and I must say that it looks like an implementation detail to me.  In fact, it smells like premature optimization.  Anyway.\n\nWe have a cache of solutions.\n\nThe iterator is supposed to yield from this cache, and only if it is at the end of the cache, generate new solutions.  However, other methods may also request that solutions - with special properties - are added to the cache.",
    "created_at": "2023-01-03T20:25:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537248",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">comment:6</div>

Do you know how to do this?  It is quite stressful for me to deal with this, although it is certainly important to me to get this ticket into sage, and I must say that it looks like an implementation detail to me.  In fact, it smells like premature optimization.  Anyway.

We have a cache of solutions.

The iterator is supposed to yield from this cache, and only if it is at the end of the cache, generate new solutions.  However, other methods may also request that solutions - with special properties - are added to the cache.



---

archive/issue_comments_537249.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'd say the cache is a workaround (premature optimization) for a very inefficient method to generate all feasible solutions of a MIP model.",
    "created_at": "2023-01-03T20:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537249",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

I'd say the cache is a workaround (premature optimization) for a very inefficient method to generate all feasible solutions of a MIP model.



---

archive/issue_comments_537250.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAh, no, I don't think so.  Some of these problems have very few solutions, and I want to look at all of them.  However, frequently we wil have a huge number of solutions (just try the \"benchmark\" problem with `N=6` or `N=7`, of which only few solutions are interesting.  \n\nAs I mentioned before, generating all solutions is not really what the tool is about.  The most interesting methods is probably `minimal_subdistributions_iterator` (whereas the method which is likely to be used most frequently is just `statistics_fibers`).\n\nThe cache allows the user to switch between these methods.  For example, I might first want to check that a solution exists (this was the main motivation, using the \"benchmark\" example, which is now https://arxiv.org/abs/2004.01140).  However, it may then be interesting to see whether we can compute at least a few minimal subdistributions, etc.\n\nThis is the reason why I am also so disappointed that adding and removing constraints in SCIP forgets all of the information accumulated so far.",
    "created_at": "2023-01-03T20:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537250",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:8" align="right">comment:8</div>

Ah, no, I don't think so.  Some of these problems have very few solutions, and I want to look at all of them.  However, frequently we wil have a huge number of solutions (just try the "benchmark" problem with `N=6` or `N=7`, of which only few solutions are interesting.  

As I mentioned before, generating all solutions is not really what the tool is about.  The most interesting methods is probably `minimal_subdistributions_iterator` (whereas the method which is likely to be used most frequently is just `statistics_fibers`).

The cache allows the user to switch between these methods.  For example, I might first want to check that a solution exists (this was the main motivation, using the "benchmark" example, which is now https://arxiv.org/abs/2004.01140).  However, it may then be interesting to see whether we can compute at least a few minimal subdistributions, etc.

This is the reason why I am also so disappointed that adding and removing constraints in SCIP forgets all of the information accumulated so far.



---

archive/issue_comments_537251.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nBasically my recommendation is to check whether for any of the MIPs for which you need more than 1 solution, the iterated MIP solving with \"veto constraints\" is faster than polyhedral vertex enumeration & filtering.",
    "created_at": "2023-01-03T20:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Basically my recommendation is to check whether for any of the MIPs for which you need more than 1 solution, the iterated MIP solving with "veto constraints" is faster than polyhedral vertex enumeration & filtering.



---

archive/issue_comments_537252.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nMaintaining a solution candidate pool when you solve many related problems certainly has merit. But using an index to refer to an initial segment of the cache is a very awkward interface. Hence my suggestion to just have a method like the following: \n\n```\ndef solutions_iterator(self, on_blocks, additional_constraints)\n```\nBy writing it as a generator, the control and data flow can be expressed naturally.\n\nIf you only need 1 solution, just call it as `next(bmilp.solutions_iterator(...))`.",
    "created_at": "2023-01-03T20:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537252",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:0" align="right">comment:0</div>

Maintaining a solution candidate pool when you solve many related problems certainly has merit. But using an index to refer to an initial segment of the cache is a very awkward interface. Hence my suggestion to just have a method like the following: 

```
def solutions_iterator(self, on_blocks, additional_constraints)
```
By writing it as a generator, the control and data flow can be expressed naturally.

If you only need 1 solution, just call it as `next(bmilp.solutions_iterator(...))`.



---

archive/issue_comments_537253.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nReplying to [Martin Rubey](#comment:118):\n> The most interesting methods is probably `minimal_subdistributions_iterator` \n\nDo you have a computationally nontrivial example of using this one?",
    "created_at": "2023-01-03T20:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537253",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:121" align="right">comment:121</div>

Replying to [Martin Rubey](#comment:118):
> The most interesting methods is probably `minimal_subdistributions_iterator` 

Do you have a computationally nontrivial example of using this one?



---

archive/issue_comments_537254.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:121):\n> Replying to [Martin Rubey](#comment:118):\n> > The most interesting methods is probably `minimal_subdistributions_iterator` \n\n> \n> Do you have a computationally nontrivial example of using this one?\n\nIt is not so interesting anymore, since the problem has been solved, but you could look at the \"benchmark example\" for larger N, perhaps 7 or 8 (with `minimal_subdistributions_blocks_iterator`).  For N=6 the output is just 18 lines, and takes about 40 seconds on my laptop.  In this case, just 104 solutions of the original problem are generated (and almost all the computation goes into the milp set up in line 2075).",
    "created_at": "2023-01-03T21:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537254",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:122" align="right">comment:122</div>

Replying to [Matthias KÃ¶ppe](#comment:121):
> Replying to [Martin Rubey](#comment:118):
> > The most interesting methods is probably `minimal_subdistributions_iterator` 

> 
> Do you have a computationally nontrivial example of using this one?

It is not so interesting anymore, since the problem has been solved, but you could look at the "benchmark example" for larger N, perhaps 7 or 8 (with `minimal_subdistributions_blocks_iterator`).  For N=6 the output is just 18 lines, and takes about 40 seconds on my laptop.  In this case, just 104 solutions of the original problem are generated (and almost all the computation goes into the milp set up in line 2075).



---

archive/issue_comments_537255.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0\"><code>61e97bc</code></a></td><td><code>merge _solve, solution and __iter__</code></td></tr></table>\n",
    "created_at": "2023-01-04T00:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537255",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0"><code>61e97bc</code></a></td><td><code>merge _solve, solution and __iter__</code></td></tr></table>




---

archive/issue_comments_537256.json:
```json
{
    "body": "Changed commit from **[`6868261`](https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89)** to **[`61e97bc`](https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0)**",
    "created_at": "2023-01-04T00:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537256",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6868261`](https://github.com/sagemath/sagetrac-mirror/commit/686826127927622f10e97b8f0189ed46d3e55f89)** to **[`61e97bc`](https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0)**



---

archive/issue_comments_537257.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNice!",
    "created_at": "2023-01-04T00:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537257",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

Nice!



---

archive/issue_comments_537258.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n\n```\n+                    # moving this out of the try...finally block breaks SCIP\n+                    solution = self.milp.get_values(self._x,\n+                                                    convert=bool, tolerance=0.1)\n```\nDoes get_values throw an error?",
    "created_at": "2023-01-04T00:24:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537258",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>


```
+                    # moving this out of the try...finally block breaks SCIP
+                    solution = self.milp.get_values(self._x,
+                                                    convert=bool, tolerance=0.1)
```
Does get_values throw an error?



---

archive/issue_comments_537259.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nYes, `Warning: method cannot be called before problem is solved`.\n\n(and I agree that it is better - it took me just 3 hours)",
    "created_at": "2023-01-04T00:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537259",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">comment:6</div>

Yes, `Warning: method cannot be called before problem is solved`.

(and I agree that it is better - it took me just 3 hours)



---

archive/issue_comments_537260.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe `finally` block removes the transformed problem -- it's fair that it forgets the solution",
    "created_at": "2023-01-04T00:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537260",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

The `finally` block removes the transformed problem -- it's fair that it forgets the solution



---

archive/issue_comments_537261.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNow that you have the clean interface `solutions_iterator`, you can write an alternative implementation using polyhedral vertex enumeration",
    "created_at": "2023-01-04T00:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537261",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Now that you have the clean interface `solutions_iterator`, you can write an alternative implementation using polyhedral vertex enumeration



---

archive/issue_comments_537262.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYes.  Removing the other stuff, i.e.,\n\n```\n                    b = self.milp.get_backend()\n                    if hasattr(b, \"_get_model\"):\n                        m = b._get_model()\n                        if m.getStatus() != 'unknown':\n                            m.freeTransform()\n```\ngives me\n\n```\n        self.milp.remove_constraints(new_indices)\n      File \"sage/numerical/mip.pyx\", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints\n        self._backend.remove_constraints(constraints)\n      File \"sage/numerical/backends/generic_backend.pyx\", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints\n        self.remove_constraint(c)\n      File \"sage/numerical/backends/scip_backend.pyx\", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint\n        raise ValueError(\"The constraint's index i must satisfy 0 <= i < number_of_constraints\")\n    ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints\n```",
    "created_at": "2023-01-04T00:37:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537262",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:9" align="right">comment:9</div>

Yes.  Removing the other stuff, i.e.,

```
                    b = self.milp.get_backend()
                    if hasattr(b, "_get_model"):
                        m = b._get_model()
                        if m.getStatus() != 'unknown':
                            m.freeTransform()
```
gives me

```
        self.milp.remove_constraints(new_indices)
      File "sage/numerical/mip.pyx", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints
        self._backend.remove_constraints(constraints)
      File "sage/numerical/backends/generic_backend.pyx", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints
        self.remove_constraint(c)
      File "sage/numerical/backends/scip_backend.pyx", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint
        raise ValueError("The constraint's index i must satisfy 0 <= i < number_of_constraints")
    ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints
```



---

archive/issue_comments_537263.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">comment:130</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:128):\n> Now that you have the clean interface `solutions_iterator`, you can write an alternative implementation using polyhedral vertex enumeration\n\nI must not do this before somebody uses the tool, or I have completed my other duties.  My fantasy was to finish this ticket before Christmas (last year :-)\n\nBut I am very grateful for your feedback and time!",
    "created_at": "2023-01-04T00:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537263",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:130" align="right">comment:130</div>

Replying to [Matthias KÃ¶ppe](#comment:128):
> Now that you have the clean interface `solutions_iterator`, you can write an alternative implementation using polyhedral vertex enumeration

I must not do this before somebody uses the tool, or I have completed my other duties.  My fantasy was to finish this ticket before Christmas (last year :-)

But I am very grateful for your feedback and time!



---

archive/issue_comments_537264.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nReplying to [Martin Rubey](#comment:129):\n> Yes.  Removing the other stuff, i.e.,\n> \n> ```\n>                     b = self.milp.get_backend()\n>                     if hasattr(b, \"_get_model\"):\n>                         m = b._get_model()\n>                         if m.getStatus() != 'unknown':\n>                             m.freeTransform()\n> ```\n> gives me\n> \n> ```\n>         self.milp.remove_constraints(new_indices)\n>       File \"sage/numerical/mip.pyx\", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints\n>         self._backend.remove_constraints(constraints)\n>       File \"sage/numerical/backends/generic_backend.pyx\", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints\n>         self.remove_constraint(c)\n>       File \"sage/numerical/backends/scip_backend.pyx\", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint\n>         raise ValueError(\"The constraint's index i must satisfy 0 <= i < number_of_constraints\")\n>     ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints\n> ```\n\nNot exactly sure what's happening there, but try if it's still necessary if you merge the (just updated) #34890",
    "created_at": "2023-01-04T00:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537264",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:131" align="right">comment:131</div>

Replying to [Martin Rubey](#comment:129):
> Yes.  Removing the other stuff, i.e.,
> 
> ```
>                     b = self.milp.get_backend()
>                     if hasattr(b, "_get_model"):
>                         m = b._get_model()
>                         if m.getStatus() != 'unknown':
>                             m.freeTransform()
> ```
> gives me
> 
> ```
>         self.milp.remove_constraints(new_indices)
>       File "sage/numerical/mip.pyx", line 2382, in sage.numerical.mip.MixedIntegerLinearProgram.remove_constraints
>         self._backend.remove_constraints(constraints)
>       File "sage/numerical/backends/generic_backend.pyx", line 432, in sage.numerical.backends.generic_backend.GenericBackend.remove_constraints
>         self.remove_constraint(c)
>       File "sage/numerical/backends/scip_backend.pyx", line 360, in sage.numerical.backends.scip_backend.SCIPBackend.remove_constraint
>         raise ValueError("The constraint's index i must satisfy 0 <= i < number_of_constraints")
>     ValueError: The constraint's index i must satisfy 0 <= i < number_of_constraints
> ```

Not exactly sure what's happening there, but try if it's still necessary if you merge the (just updated) #34890



---

archive/issue_comments_537265.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNo, this gives me several errors.  For example:\n\n```\nFile \"src/sage/combinat/bijectionist.py\", line 1149, in sage.combinat.bijectionist.Bijectionist.set_distributions\nFailed example:\n    bij.constant_blocks(optimal=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.bijectionist.Bijectionist.set_distributions[6]>\", line 1, in <module>\n        bij.constant_blocks(optimal=True)\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 647, in constant_blocks\n        self._forced_constant_blocks()\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 1705, in _forced_constant_blocks\n        updated_multiple_preimages[tZ + (solution[p],)].append(p)\n    KeyError: [1, 3, 2]\n**********************************************************************\nFile \"src/sage/combinat/bijectionist.py\", line 1151, in sage.combinat.bijectionist.Bijectionist.set_distributions\nFailed example:\n    sorted(bij.minimal_subdistributions_blocks_iterator(), key=lambda d: (len(d[0]), d[0]))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/martin/sage-develop/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.bijectionist.Bijectionist.set_distributions[7]>\", line 1, in <module>\n        sorted(bij.minimal_subdistributions_blocks_iterator(), key=lambda d: (len(d[Integer(0)]), d[Integer(0)]))\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 2120, in minimal_subdistributions_blocks_iterator\n        add_counter_example_constraint(s)\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 2093, in add_counter_example_constraint\n        minimal_subdistribution.add_constraint(sum(D[p] for p in P\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 2094, in <genexpr>\n        if s[p] == v) == V[v])\n    KeyError: [1, 2, 3]\n```\n\nI have to stop now, it's 2:30am.",
    "created_at": "2023-01-04T01:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537265",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:2" align="right">comment:2</div>

No, this gives me several errors.  For example:

```
File "src/sage/combinat/bijectionist.py", line 1149, in sage.combinat.bijectionist.Bijectionist.set_distributions
Failed example:
    bij.constant_blocks(optimal=True)
Exception raised:
    Traceback (most recent call last):
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.bijectionist.Bijectionist.set_distributions[6]>", line 1, in <module>
        bij.constant_blocks(optimal=True)
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 647, in constant_blocks
        self._forced_constant_blocks()
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 1705, in _forced_constant_blocks
        updated_multiple_preimages[tZ + (solution[p],)].append(p)
    KeyError: [1, 3, 2]
**********************************************************************
File "src/sage/combinat/bijectionist.py", line 1151, in sage.combinat.bijectionist.Bijectionist.set_distributions
Failed example:
    sorted(bij.minimal_subdistributions_blocks_iterator(), key=lambda d: (len(d[0]), d[0]))
Exception raised:
    Traceback (most recent call last):
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/martin/sage-develop/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.bijectionist.Bijectionist.set_distributions[7]>", line 1, in <module>
        sorted(bij.minimal_subdistributions_blocks_iterator(), key=lambda d: (len(d[Integer(0)]), d[Integer(0)]))
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 2120, in minimal_subdistributions_blocks_iterator
        add_counter_example_constraint(s)
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 2093, in add_counter_example_constraint
        minimal_subdistribution.add_constraint(sum(D[p] for p in P
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 2094, in <genexpr>
        if s[p] == v) == V[v])
    KeyError: [1, 2, 3]
```

I have to stop now, it's 2:30am.



---

archive/issue_comments_537266.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, ...**",
    "created_at": "2023-01-04T03:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537266",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe, ...**



---

archive/issue_comments_537267.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is now OK from my side, but I've really only looked at the code from the viewpoint of managing the MIPs and getting solutions out of them. So it would be good if other reviewers could take a look on the combinatorial statistics side of things.\n\nThe code-style police will say that\n\n```\n+        evaluate = lambda f: sum(coeff if index == -1 else\n+                                 coeff * values[index_block_value_dict[index]]\n+                                 for index, coeff in f.dict().items())\n```\nshould be a nested `def` instead. \n\nSince the linter is currently broken, I'd recommend to run `./sage -tox -- src/sage/combinat/bijectionist.py` and fix any reported issues",
    "created_at": "2023-01-04T18:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537267",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

This is now OK from my side, but I've really only looked at the code from the viewpoint of managing the MIPs and getting solutions out of them. So it would be good if other reviewers could take a look on the combinatorial statistics side of things.

The code-style police will say that

```
+        evaluate = lambda f: sum(coeff if index == -1 else
+                                 coeff * values[index_block_value_dict[index]]
+                                 for index, coeff in f.dict().items())
```
should be a nested `def` instead. 

Since the linter is currently broken, I'd recommend to run `./sage -tox -- src/sage/combinat/bijectionist.py` and fix any reported issues



---

archive/issue_comments_537268.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThank you!  `./sage -tox -- src/sage/combinat/bijectionist.py` does not emit any warnings on my machine.\n\nOn the combinatorics side, there is still the issue with the name of `set_pseudo_inverse_relation`, which is currently as silly as can be, but I don't know any better and did not yet receive an answer on https://mathoverflow.net/q/437261.",
    "created_at": "2023-01-04T18:49:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537268",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:5" align="right">comment:5</div>

Thank you!  `./sage -tox -- src/sage/combinat/bijectionist.py` does not emit any warnings on my machine.

On the combinatorics side, there is still the issue with the name of `set_pseudo_inverse_relation`, which is currently as silly as can be, but I don't know any better and did not yet receive an answer on https://mathoverflow.net/q/437261.



---

archive/issue_comments_537269.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nYou can also try `./sage -tox -e pycodestyle -- src/sage/combinat/bijectionist.py`",
    "created_at": "2023-01-04T19:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537269",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

You can also try `./sage -tox -e pycodestyle -- src/sage/combinat/bijectionist.py`



---

archive/issue_comments_537270.json:
```json
{
    "body": "Changed commit from **[`61e97bc`](https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0)** to **[`db8947b`](https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb)**",
    "created_at": "2023-01-04T20:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537270",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`61e97bc`](https://github.com/sagemath/sagetrac-mirror/commit/61e97bc64d9742026ad8486784b25ea4c730b4f0)** to **[`db8947b`](https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb)**



---

archive/issue_comments_537271.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb\"><code>db8947b</code></a></td><td><code>pycodestyle stuff</code></td></tr></table>\n",
    "created_at": "2023-01-04T20:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33238#issuecomment-537271",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db8947bfe5f116492b6fc864b36e6d9054bc34cb"><code>db8947b</code></a></td><td><code>pycodestyle stuff</code></td></tr></table>

