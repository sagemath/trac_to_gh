# Issue 33589: Gitpod: track remote trac branch

archive/issues_033352.json:
```json
{
    "body": "Currently, gitpod tracks the branch on github as the remote. Thus, one might accidentally changes to github instead of trac. With this ticket, the remote is changed to trac. \n\n**CC:**  @mkoeppe\n\n**Branch/Commit:** [bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)\n\n**Reviewer:** Matthias Koeppe\n\n**Author:** Tobias Diez\n\nIssue created by migration from https://trac.sagemath.org/ticket/33589\n\n",
    "closed_at": "2022-04-03T11:13:40Z",
    "created_at": "2022-03-29T13:59:54Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "title": "Gitpod: track remote trac branch",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/33589",
    "user": "https://github.com/tobiasdiez"
}
```
Currently, gitpod tracks the branch on github as the remote. Thus, one might accidentally changes to github instead of trac. With this ticket, the remote is changed to trac. 

**CC:**  @mkoeppe

**Branch/Commit:** [bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)

**Reviewer:** Matthias Koeppe

**Author:** Tobias Diez

Issue created by migration from https://trac.sagemath.org/ticket/33589





---

archive/issue_events_300533.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2022-03-29T13:59:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33589#event-300533"
}
```



---

archive/issue_comments_545255.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think `git remote set-url --push origin git@trac.sagemath.org:sage.git` would also be good to add",
    "created_at": "2022-03-29T19:00:20Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545255",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
I think `git remote set-url --push origin git@trac.sagemath.org:sage.git` would also be good to add



---

archive/issue_comments_545256.json:
```json
{
    "body": "<a id='comment:3'></a>\nNot sure if that's really a good idea. The git manual contains\n\n>Note that the push URL and the fetch URL, even though they can be set differently, must still refer to the same place. What you pushed to the push URL should be what you would see if you immediately fetched from the fetch URL. If you are trying to fetch from one place (e.g. your upstream) and push to another (e.g. your publishing repository), use two separate remotes.\n\n\nYour idea was to prevent accidental commits to github, right? Would it be possible to restrict write access for the trac mirror repo to only allow the sync-hook to have write access?",
    "created_at": "2022-03-29T19:18:39Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545256",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'></a>
Not sure if that's really a good idea. The git manual contains

>Note that the push URL and the fetch URL, even though they can be set differently, must still refer to the same place. What you pushed to the push URL should be what you would see if you immediately fetched from the fetch URL. If you are trying to fetch from one place (e.g. your upstream) and push to another (e.g. your publishing repository), use two separate remotes.


Your idea was to prevent accidental commits to github, right? Would it be possible to restrict write access for the trac mirror repo to only allow the sync-hook to have write access?



---

archive/issue_comments_545257.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt's already documented as standard procedure in `src/doc/en/developer/manual_git.rst`",
    "created_at": "2022-03-29T19:21:35Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545257",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
It's already documented as standard procedure in `src/doc/en/developer/manual_git.rst`



---

archive/issue_comments_545258.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhere exactly? I can only find `git remote set-url --push trac git@trac.sagemath.org:sage.git` at https://doc.sagemath.org/html/en/developer/manual_git.html",
    "created_at": "2022-03-29T19:24:21Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545258",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
Where exactly? I can only find `git remote set-url --push trac git@trac.sagemath.org:sage.git` at https://doc.sagemath.org/html/en/developer/manual_git.html



---

archive/issue_comments_545259.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes, that's the one.",
    "created_at": "2022-03-31T15:24:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545259",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Yes, that's the one.



---

archive/issue_comments_545260.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis is already included in the gitpod config:\n\n```\n      git remote add trac git@trac.sagemath.org:sage.git -t master -t develop -t $(git branch --show-current)\n      git remote set-url --push trac git@trac.sagemath.org:sage.git\n      git fetch trac\n      git branch -u trac/$(git branch --show-current)\n```",
    "created_at": "2022-03-31T15:25:56Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545260",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'></a>
This is already included in the gitpod config:

```
      git remote add trac git@trac.sagemath.org:sage.git -t master -t develop -t $(git branch --show-current)
      git remote set-url --push trac git@trac.sagemath.org:sage.git
      git fetch trac
      git branch -u trac/$(git branch --show-current)
```



---

archive/issue_comments_545261.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, the first line is setting the wrong URL for fetching.",
    "created_at": "2022-03-31T15:32:54Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545261",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
No, the first line is setting the wrong URL for fetching.



---

archive/issue_comments_545262.json:
```json
{
    "body": "<a id='comment:9'></a>\nI took this from the docs: https://doc.sagemath.org/html/en/developer/manual_git.html#the-trac-server\n\n```\ngit remote add trac git@trac.sagemath.org:sage.git -t master\n```\nWhat is then the correct url?",
    "created_at": "2022-03-31T15:37:00Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545262",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>
I took this from the docs: https://doc.sagemath.org/html/en/developer/manual_git.html#the-trac-server

```
git remote add trac git@trac.sagemath.org:sage.git -t master
```
What is then the correct url?



---

archive/issue_comments_545263.json:
```json
{
    "body": "<a id='comment:10'></a>\nFurther up in the same section.",
    "created_at": "2022-03-31T15:50:28Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545263",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Further up in the same section.



---

archive/issue_comments_545264.json:
```json
{
    "body": "<a id='comment:11'></a>\n\n```\ngit remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master\n```\nDoes not work well. If you then push something to trac, VS still notifies you that there are changes between your local and remote branch. The reason is that VS invokes `git fetch` directly after pushing, but then the sync hook has not yet been executed so it still fetches the old branch on github.",
    "created_at": "2022-03-31T15:56:14Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545264",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>

```
git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master
```
Does not work well. If you then push something to trac, VS still notifies you that there are changes between your local and remote branch. The reason is that VS invokes `git fetch` directly after pushing, but then the sync hook has not yet been executed so it still fetches the old branch on github.



---

archive/issue_comments_545265.json:
```json
{
    "body": "<a id='comment:12'></a>\nOK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.",
    "created_at": "2022-03-31T15:59:11Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545265",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
OK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.



---

archive/issue_comments_545266.json:
```json
{
    "body": "<a id='comment:13'></a>\nWe should probably also note this in the documentation (https://doc.sagemath.org/html/en/developer/manual_git.html) that the first configuration is not recommended for users who use VS Code.",
    "created_at": "2022-03-31T16:00:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545266",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
We should probably also note this in the documentation (https://doc.sagemath.org/html/en/developer/manual_git.html) that the first configuration is not recommended for users who use VS Code.



---

archive/issue_comments_545267.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mkoeppe](#comment%3A12):\n> OK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.\n\nThe point of this ticket was that this happens automatically for each ticket/gitpod session without manual intervention.",
    "created_at": "2022-03-31T16:01:28Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545267",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:14'></a>
Replying to [mkoeppe](#comment%3A12):
> OK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.

The point of this ticket was that this happens automatically for each ticket/gitpod session without manual intervention.



---

archive/issue_comments_545268.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [mkoeppe](#comment%3A13):\n> We should probably also note this in the documentation (https://doc.sagemath.org/html/en/developer/manual_git.html) that the first configuration is not recommended for users who use VS Code.\n\nWhat's the reason for this config in the first place? It is also against the git recommendations that I've cited above.",
    "created_at": "2022-03-31T16:02:04Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545268",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>
Replying to [mkoeppe](#comment%3A13):
> We should probably also note this in the documentation (https://doc.sagemath.org/html/en/developer/manual_git.html) that the first configuration is not recommended for users who use VS Code.

What's the reason for this config in the first place? It is also against the git recommendations that I've cited above.



---

archive/issue_comments_545269.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [gh-tobiasdiez](#comment%3A15):\n> What's the reason for this config in the first place? It is also against the git recommendations that I've cited above.\n\nThat's what read-only mirrors are for - they scale better than 1 read/write server.\n\nI don't think that recommendation that you found in the doc is intended to rule out mirrors.",
    "created_at": "2022-03-31T16:04:32Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545269",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Replying to [gh-tobiasdiez](#comment%3A15):
> What's the reason for this config in the first place? It is also against the git recommendations that I've cited above.

That's what read-only mirrors are for - they scale better than 1 read/write server.

I don't think that recommendation that you found in the doc is intended to rule out mirrors.



---

archive/issue_comments_545270.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [gh-tobiasdiez](#comment%3A14):\n> Replying to [mkoeppe](#comment%3A12):\n> > OK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.\n\n> \n> The point of this ticket was that this happens automatically for each ticket/gitpod session without manual intervention.\n\nI think we shouldn't force users to do the SSH key thing if all they want to do is fetch from trac.",
    "created_at": "2022-03-31T16:08:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545270",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Replying to [gh-tobiasdiez](#comment%3A14):
> Replying to [mkoeppe](#comment%3A12):
> > OK. Then I'd suggest that we make switching to the ssh remote (`git@trac.sagemath.org:sage.git`) part of the instructions for adding the SSH key.

> 
> The point of this ticket was that this happens automatically for each ticket/gitpod session without manual intervention.

I think we shouldn't force users to do the SSH key thing if all they want to do is fetch from trac.



---

archive/issue_comments_545271.json:
```json
{
    "body": "<a id='comment:18'></a>\nMaybe it should be made conditional on `PRIVATE_SSH_KEY` being set already?\nBy the way, the current script in `.gitpod.yml` creates an empty id_rsa file if `PRIVATE_SSH_KEY` is not provided; creating that should probably be avoided too",
    "created_at": "2022-03-31T16:21:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545271",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Maybe it should be made conditional on `PRIVATE_SSH_KEY` being set already?
By the way, the current script in `.gitpod.yml` creates an empty id_rsa file if `PRIVATE_SSH_KEY` is not provided; creating that should probably be avoided too



---

archive/issue_comments_545272.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0\">77b11ea</a></td><td><code>Only add trac if sshkey is set</code></td></tr></table>\n",
    "created_at": "2022-03-31T16:33:09Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0">77b11ea</a></td><td><code>Only add trac if sshkey is set</code></td></tr></table>




---

archive/issue_comments_545273.json:
```json
{
    "body": "**Changing commit** from \"[ac4ec055744192abd4840abe91c520bd13e34ae6](https://github.com/sagemath/sagetrac-mirror/commit/ac4ec055744192abd4840abe91c520bd13e34ae6)\" to \"[77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0](https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0)\".",
    "created_at": "2022-03-31T16:33:09Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ac4ec055744192abd4840abe91c520bd13e34ae6](https://github.com/sagemath/sagetrac-mirror/commit/ac4ec055744192abd4840abe91c520bd13e34ae6)" to "[77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0](https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0)".



---

archive/issue_comments_545274.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A18):\n> Maybe it should be made conditional on `PRIVATE_SSH_KEY` being set already?\n> By the way, the current script in `.gitpod.yml` creates an empty id_rsa file if `PRIVATE_SSH_KEY` is not provided; creating that should probably be avoided too\n\nGood suggestion, thanks. I've implemented that now.",
    "created_at": "2022-03-31T16:33:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545274",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A18):
> Maybe it should be made conditional on `PRIVATE_SSH_KEY` being set already?
> By the way, the current script in `.gitpod.yml` creates an empty id_rsa file if `PRIVATE_SSH_KEY` is not provided; creating that should probably be avoided too

Good suggestion, thanks. I've implemented that now.



---

archive/issue_comments_545275.json:
```json
{
    "body": "<a id='comment:21'></a>\nThat should be \"-n \"${PRIVATE_SSH_KEY}\"`",
    "created_at": "2022-03-31T16:34:30Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545275",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
That should be "-n "${PRIVATE_SSH_KEY}"`



---

archive/issue_comments_545276.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes...",
    "created_at": "2022-03-31T16:36:03Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545276",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:22'></a>
Yes...



---

archive/issue_comments_545277.json:
```json
{
    "body": "<a id='comment:23'></a>\nAnd everyone needs the `trac` remote. \nWhen `PRIVATE_SSH_KEY` is set, just switch the fetch URL to the good one.",
    "created_at": "2022-03-31T16:36:45Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545277",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
And everyone needs the `trac` remote. 
When `PRIVATE_SSH_KEY` is set, just switch the fetch URL to the good one.



---

archive/issue_comments_545278.json:
```json
{
    "body": "**Changing commit** from \"[77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0](https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0)\" to \"[a5d10a2bef6d2503ed793912217c3ff74a52e84d](https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d)\".",
    "created_at": "2022-03-31T16:40:49Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0](https://github.com/sagemath/sagetrac-mirror/commit/77b11ea3ef560b61eaa4ee1031bb0c79a0176ad0)" to "[a5d10a2bef6d2503ed793912217c3ff74a52e84d](https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d)".



---

archive/issue_comments_545279.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d\">a5d10a2</a></td><td><code>Fix typo</code></td></tr></table>\n",
    "created_at": "2022-03-31T16:40:49Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d">a5d10a2</a></td><td><code>Fix typo</code></td></tr></table>




---

archive/issue_comments_545280.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mkoeppe](#comment%3A23):\n> And everyone needs the `trac` remote. \n> When `PRIVATE_SSH_KEY` is set, just switch the fetch URL to the good one.\n\nBut this is `origin` already, so where is the point of adding trac as the same alias?",
    "created_at": "2022-03-31T16:41:36Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545280",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:25'></a>
Replying to [mkoeppe](#comment%3A23):
> And everyone needs the `trac` remote. 
> When `PRIVATE_SSH_KEY` is set, just switch the fetch URL to the good one.

But this is `origin` already, so where is the point of adding trac as the same alias?



---

archive/issue_comments_545281.json:
```json
{
    "body": "<a id='comment:26'></a>\n`trac` is the name used in the developer's guide; and it is also the hardcoded name of the remote that is used in git-trac-command.",
    "created_at": "2022-03-31T16:43:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545281",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
`trac` is the name used in the developer's guide; and it is also the hardcoded name of the remote that is used in git-trac-command.



---

archive/issue_comments_545282.json:
```json
{
    "body": "**Changing commit** from \"[a5d10a2bef6d2503ed793912217c3ff74a52e84d](https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d)\" to \"[4950bcfed0f313db02ca96894a95ccc006df7a15](https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15)\".",
    "created_at": "2022-03-31T16:44:04Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a5d10a2bef6d2503ed793912217c3ff74a52e84d](https://github.com/sagemath/sagetrac-mirror/commit/a5d10a2bef6d2503ed793912217c3ff74a52e84d)" to "[4950bcfed0f313db02ca96894a95ccc006df7a15](https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15)".



---

archive/issue_comments_545283.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15\">4950bcf</a></td><td><code>Add fallback to github mirror</code></td></tr></table>\n",
    "created_at": "2022-03-31T16:44:04Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15">4950bcf</a></td><td><code>Add fallback to github mirror</code></td></tr></table>




---

archive/issue_comments_545284.json:
```json
{
    "body": "<a id='comment:28'></a>\n\n```\n+      else\n+        # Fallback to sagemath mirror\n+        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop\n+      fi\n+\n```\nbut only for fetch, not for push!",
    "created_at": "2022-03-31T16:47:07Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545284",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>

```
+      else
+        # Fallback to sagemath mirror
+        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop
+      fi
+
```
but only for fetch, not for push!



---

archive/issue_comments_545285.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454\">c235ead</a></td><td><code>Disable pushing to github</code></td></tr></table>\n",
    "created_at": "2022-03-31T16:57:10Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545285",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454">c235ead</a></td><td><code>Disable pushing to github</code></td></tr></table>




---

archive/issue_comments_545286.json:
```json
{
    "body": "**Changing commit** from \"[4950bcfed0f313db02ca96894a95ccc006df7a15](https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15)\" to \"[c235eadd675d05d8b8429f72edd76dacdcc5d454](https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454)\".",
    "created_at": "2022-03-31T16:57:10Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4950bcfed0f313db02ca96894a95ccc006df7a15](https://github.com/sagemath/sagetrac-mirror/commit/4950bcfed0f313db02ca96894a95ccc006df7a15)" to "[c235eadd675d05d8b8429f72edd76dacdcc5d454](https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454)".



---

archive/issue_comments_545287.json:
```json
{
    "body": "<a id='comment:30'></a>\nThis line should probably be run in both cases\n\n```\n+        git remote set-url --push origin pushing-only-via-trac\n```",
    "created_at": "2022-03-31T17:24:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545287",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
This line should probably be run in both cases

```
+        git remote set-url --push origin pushing-only-via-trac
```



---

archive/issue_comments_545288.json:
```json
{
    "body": "<a id='comment:31'></a>\nAlso [comment:12](#comment%3A12), [comment:13](#comment%3A13)",
    "created_at": "2022-03-31T17:24:54Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545288",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Also [comment:12](#comment%3A12), [comment:13](#comment%3A13)



---

archive/issue_comments_545289.json:
```json
{
    "body": "**Changing commit** from \"[c235eadd675d05d8b8429f72edd76dacdcc5d454](https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454)\" to \"[89591c4a40f185d62846fdc6b1dcd6a7688385dc](https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc)\".",
    "created_at": "2022-03-31T17:50:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c235eadd675d05d8b8429f72edd76dacdcc5d454](https://github.com/sagemath/sagetrac-mirror/commit/c235eadd675d05d8b8429f72edd76dacdcc5d454)" to "[89591c4a40f185d62846fdc6b1dcd6a7688385dc](https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc)".



---

archive/issue_comments_545290.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40d1e23ab49ddb366022390ab6dcd64b5791ea35\">40d1e23</a></td><td><code>Always disable pushing to origin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc\">89591c4</a></td><td><code>Remove wrong trac from prebuild</code></td></tr></table>\n",
    "created_at": "2022-03-31T17:50:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40d1e23ab49ddb366022390ab6dcd64b5791ea35">40d1e23</a></td><td><code>Always disable pushing to origin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc">89591c4</a></td><td><code>Remove wrong trac from prebuild</code></td></tr></table>




---

archive/issue_comments_545291.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [mkoeppe](#comment%3A30):\n> This line should probably be run in both cases\n> \n> ```\n> +        git remote set-url --push origin pushing-only-via-trac\n> ```\n\nDone.",
    "created_at": "2022-03-31T17:51:00Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545291",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:33'></a>
Replying to [mkoeppe](#comment%3A30):
> This line should probably be run in both cases
> 
> ```
> +        git remote set-url --push origin pushing-only-via-trac
> ```

Done.



---

archive/issue_comments_545292.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [mkoeppe](#comment%3A31):\n> Also [comment:12](#comment%3A12), [comment:13](#comment%3A13)\n\nI think [comment:12](#comment%3A12) is obsolete now (or I misunderstand it), and [comment:13](#comment%3A13) is not in the scope of this ticket.",
    "created_at": "2022-03-31T17:51:27Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545292",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:34'></a>
Replying to [mkoeppe](#comment%3A31):
> Also [comment:12](#comment%3A12), [comment:13](#comment%3A13)

I think [comment:12](#comment%3A12) is obsolete now (or I misunderstand it), and [comment:13](#comment%3A13) is not in the scope of this ticket.



---

archive/issue_comments_545293.json:
```json
{
    "body": "<a id='comment:35'></a>\ncomment:12 - when the user sets up the key the first time (https://620901c077fb7caa9f914f33--sagemath-tobias.netlify.app/developer/workspace.html#section-gitpod), the user needs to change the remote - this needs to be added to the instructions",
    "created_at": "2022-03-31T17:53:14Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545293",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
comment:12 - when the user sets up the key the first time (https://620901c077fb7caa9f914f33--sagemath-tobias.netlify.app/developer/workspace.html#section-gitpod), the user needs to change the remote - this needs to be added to the instructions



---

archive/issue_comments_545294.json:
```json
{
    "body": "<a id='comment:36'></a>\n\n```\n+        git remote remove trac # might still exists from a previous run/prebuild\n```\ndoes this not give an error if the remote is not there?",
    "created_at": "2022-03-31T17:54:30Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545294",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>

```
+        git remote remove trac # might still exists from a previous run/prebuild
```
does this not give an error if the remote is not there?



---

archive/issue_comments_545295.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [mkoeppe](#comment%3A36):\n> \n> ```\n> +        git remote remove trac # might still exists from a previous run/prebuild\n> ```\n> does this not give an error if the remote is not there?\n\nYes, it prints an error (during the prebuild) but the script keeps executing.",
    "created_at": "2022-03-31T18:00:25Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545295",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'></a>
Replying to [mkoeppe](#comment%3A36):
> 
> ```
> +        git remote remove trac # might still exists from a previous run/prebuild
> ```
> does this not give an error if the remote is not there?

Yes, it prints an error (during the prebuild) but the script keeps executing.



---

archive/issue_comments_545296.json:
```json
{
    "body": "<a id='comment:38'></a>\nYou can silence it by appending `2> /dev/null`",
    "created_at": "2022-03-31T18:06:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545296",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
You can silence it by appending `2> /dev/null`



---

archive/issue_comments_545297.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d450f36a251147178fba1f8931c3be50a08c366\">3d450f3</a></td><td><code>Update docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac\">e9035ae</a></td><td><code>Silence semi-expected errors during (pre)build</code></td></tr></table>\n",
    "created_at": "2022-03-31T18:11:47Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d450f36a251147178fba1f8931c3be50a08c366">3d450f3</a></td><td><code>Update docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac">e9035ae</a></td><td><code>Silence semi-expected errors during (pre)build</code></td></tr></table>




---

archive/issue_comments_545298.json:
```json
{
    "body": "**Changing commit** from \"[89591c4a40f185d62846fdc6b1dcd6a7688385dc](https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc)\" to \"[e9035ae0330755ccd54bf179a1481fa901b632ac](https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac)\".",
    "created_at": "2022-03-31T18:11:47Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[89591c4a40f185d62846fdc6b1dcd6a7688385dc](https://github.com/sagemath/sagetrac-mirror/commit/89591c4a40f185d62846fdc6b1dcd6a7688385dc)" to "[e9035ae0330755ccd54bf179a1481fa901b632ac](https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac)".



---

archive/issue_comments_545299.json:
```json
{
    "body": "<a id='comment:40'></a>\nI've added [comment:13](#comment%3A13) to #33088",
    "created_at": "2022-03-31T18:22:36Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545299",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
I've added [comment:13](#comment%3A13) to #33088



---

archive/issue_comments_545300.json:
```json
{
    "body": "<a id='comment:41'></a>\n\n```\n+ 4. Close this Gitpod workspace.\n```\nOK, that's a good solution too",
    "created_at": "2022-03-31T18:24:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545300",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>

```
+ 4. Close this Gitpod workspace.
```
OK, that's a good solution too



---

archive/issue_comments_545301.json:
```json
{
    "body": "<a id='comment:42'></a>\nI think all of these steps:\n\n```\n+        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n```\nand\n\n```\n+        git remote set-url --push trac git@trac.sagemath.org:sage.git\n+        git fetch trac\n+        git branch -u trac/$(git branch --show-current)\n```\nshould be unconditional",
    "created_at": "2022-03-31T20:27:07Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545301",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
I think all of these steps:

```
+        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
```
and

```
+        git remote set-url --push trac git@trac.sagemath.org:sage.git
+        git fetch trac
+        git branch -u trac/$(git branch --show-current)
```
should be unconditional



---

archive/issue_comments_545302.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mkoeppe](#comment%3A42):\n> I think all of these steps:\n> \n> ```\n> +        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n> ```\n\nDuring the prebuild there is never a ssh key set, so the trac remote is always either unset or set to the github mirror.\n\n> and\n> \n> ```\n> +        git remote set-url --push trac git@trac.sagemath.org:sage.git\n> +        git fetch trac\n> +        git branch -u trac/$(git branch --show-current)\n> ```\n> should be unconditional\n\nFetching trac doesn't work without ssh keys (at least for me).",
    "created_at": "2022-03-31T21:35:17Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545302",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:43'></a>
Replying to [mkoeppe](#comment%3A42):
> I think all of these steps:
> 
> ```
> +        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
> ```

During the prebuild there is never a ssh key set, so the trac remote is always either unset or set to the github mirror.

> and
> 
> ```
> +        git remote set-url --push trac git@trac.sagemath.org:sage.git
> +        git fetch trac
> +        git branch -u trac/$(git branch --show-current)
> ```
> should be unconditional

Fetching trac doesn't work without ssh keys (at least for me).



---

archive/issue_comments_545303.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [gh-tobiasdiez](#comment%3A43):\n> Fetching trac doesn't work without ssh keys (at least for me).\n\nIt doesn't if the remote is ssh, which is why we have changed that.",
    "created_at": "2022-03-31T22:41:01Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545303",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Replying to [gh-tobiasdiez](#comment%3A43):
> Fetching trac doesn't work without ssh keys (at least for me).

It doesn't if the remote is ssh, which is why we have changed that.



---

archive/issue_comments_545304.json:
```json
{
    "body": "<a id='comment:45'></a>\nI don't get what you want.\n\n```\n+        git remote set-url --push trac git@trac.sagemath.org:sage.git\n```\nis in conflict with\n\n```\n+        git remote set-url --push trac pushing-needs-ssh-key\n```\nSince the ssh setup is more involved for gitpod, its better in my opinion to explicitly tell the user that something is off so he might look this up in the docs.\n\nPs: can we please migrate to github/gitlab; their server are beefy enough to don't need a special mirror setup ;-)",
    "created_at": "2022-03-31T23:30:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545304",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:45'></a>
I don't get what you want.

```
+        git remote set-url --push trac git@trac.sagemath.org:sage.git
```
is in conflict with

```
+        git remote set-url --push trac pushing-needs-ssh-key
```
Since the ssh setup is more involved for gitpod, its better in my opinion to explicitly tell the user that something is off so he might look this up in the docs.

Ps: can we please migrate to github/gitlab; their server are beefy enough to don't need a special mirror setup ;-)



---

archive/issue_comments_545305.json:
```json
{
    "body": "<a id='comment:46'></a>\nI mean like this (untested).\n\n```\ndiff --git a/.gitpod.yml b/.gitpod.yml\nindex 7c6800ab8f..8244bafae9 100644\n--- a/.gitpod.yml\n+++ b/.gitpod.yml\n@@ -36,7 +36,9 @@ image:\n tasks:\n   - name: Setup\n     before: |\n+      git remote set-url --push origin pushing-only-via-trac\n       # Setup trac as remote\n+      git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n       ## In order to push to trac, generate a new key with `ssh-keygen -f tempkey` and save the private key to gitpod `gp env PRIVATE_SSH_KEY=\"$(<tempkey)\"` (or by following https://www.gitpod.io/docs/environment-variables#using-the-account-settings)\n       ## then follow https://doc.sagemath.org/html/en/developer/trac.html#linking-your-public-key-to-your-trac-account to register the public key with trac.\n       ## Afterwards, create a new gitpod workspace.\n@@ -50,18 +52,15 @@ tasks:\n         ssh-keyscan -H trac.sagemath.org >> ~/.ssh/known_hosts\n \n         # Setup trac repo\n-        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n         git remote add trac git@trac.sagemath.org:sage.git -t master -t develop -t $(git branch --show-current)\n         git remote set-url --push trac git@trac.sagemath.org:sage.git\n-        git fetch trac\n-        git branch -u trac/$(git branch --show-current)\n-        git remote set-url --push origin pushing-only-via-trac\n       else\n         # Fallback to sagemath mirror\n-        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop\n+        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop -t $(git branch --show-current)\n         git remote set-url --push trac pushing-needs-ssh-key\n-        git remote set-url --push origin pushing-only-via-trac\n       fi\n+      git fetch trac\n+      git branch -u trac/$(git branch --show-current)\n       \n       ## No need for pyenv\n       pyenv shell --unset 2> /dev/null\n```",
    "created_at": "2022-03-31T23:46:48Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545305",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
I mean like this (untested).

```
diff --git a/.gitpod.yml b/.gitpod.yml
index 7c6800ab8f..8244bafae9 100644
--- a/.gitpod.yml
+++ b/.gitpod.yml
@@ -36,7 +36,9 @@ image:
 tasks:
   - name: Setup
     before: |
+      git remote set-url --push origin pushing-only-via-trac
       # Setup trac as remote
+      git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
       ## In order to push to trac, generate a new key with `ssh-keygen -f tempkey` and save the private key to gitpod `gp env PRIVATE_SSH_KEY="$(<tempkey)"` (or by following https://www.gitpod.io/docs/environment-variables#using-the-account-settings)
       ## then follow https://doc.sagemath.org/html/en/developer/trac.html#linking-your-public-key-to-your-trac-account to register the public key with trac.
       ## Afterwards, create a new gitpod workspace.
@@ -50,18 +52,15 @@ tasks:
         ssh-keyscan -H trac.sagemath.org >> ~/.ssh/known_hosts
 
         # Setup trac repo
-        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
         git remote add trac git@trac.sagemath.org:sage.git -t master -t develop -t $(git branch --show-current)
         git remote set-url --push trac git@trac.sagemath.org:sage.git
-        git fetch trac
-        git branch -u trac/$(git branch --show-current)
-        git remote set-url --push origin pushing-only-via-trac
       else
         # Fallback to sagemath mirror
-        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop
+        git remote add trac https://github.com/sagemath/sagetrac-mirror.git -t master -t develop -t $(git branch --show-current)
         git remote set-url --push trac pushing-needs-ssh-key
-        git remote set-url --push origin pushing-only-via-trac
       fi
+      git fetch trac
+      git branch -u trac/$(git branch --show-current)
       
       ## No need for pyenv
       pyenv shell --unset 2> /dev/null
```



---

archive/issue_comments_545306.json:
```json
{
    "body": "<a id='comment:47'></a>\nThat would work, I guess. But I fail to see the point of setting the upstream to \"trac\" even if you don't have the ssh keys configured. Why change the gitpod default? \n\nI would like to leave the whole trac remote business as minimal as possible.",
    "created_at": "2022-04-01T00:02:00Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545306",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'></a>
That would work, I guess. But I fail to see the point of setting the upstream to "trac" even if you don't have the ssh keys configured. Why change the gitpod default? 

I would like to leave the whole trac remote business as minimal as possible.



---

archive/issue_comments_545307.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [gh-tobiasdiez](#comment%3A47):\n> That would work, I guess. But I fail to see the point of setting the upstream to \"trac\" even if you don't have the ssh keys configured. \n\nBecause it means that there are fewer differences between \"without ssh key\" and \"with ssh key\", which reduces the complexity in explaining it to developers?",
    "created_at": "2022-04-01T00:09:26Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545307",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Replying to [gh-tobiasdiez](#comment%3A47):
> That would work, I guess. But I fail to see the point of setting the upstream to "trac" even if you don't have the ssh keys configured. 

Because it means that there are fewer differences between "without ssh key" and "with ssh key", which reduces the complexity in explaining it to developers?



---

archive/issue_comments_545308.json:
```json
{
    "body": "<a id='comment:49'></a>\nIf you cannot push anything, then you don't need to worry about trac at all. Everything you need is in \"origin\". The remove trac is only added because of the limitations of git-trac you mentioned above.",
    "created_at": "2022-04-01T00:14:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545308",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:49'></a>
If you cannot push anything, then you don't need to worry about trac at all. Everything you need is in "origin". The remove trac is only added because of the limitations of git-trac you mentioned above.



---

archive/issue_comments_545309.json:
```json
{
    "body": "<a id='comment:50'></a>\nOK, I think this makes sense",
    "created_at": "2022-04-01T00:16:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545309",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
OK, I think this makes sense



---

archive/issue_comments_545310.json:
```json
{
    "body": "<a id='comment:51'></a>\nNow if we also want to support a development model in which users use their own [GitHub](../wikis/GitHub) forks as `origin`, then we should probably do the line `git remote set-url --push origin pushing-only-via-trac` in the \"else\" branch only when `origin` is in the `sagemath` organization.",
    "created_at": "2022-04-01T00:17:54Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545310",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>
Now if we also want to support a development model in which users use their own [GitHub](../wikis/GitHub) forks as `origin`, then we should probably do the line `git remote set-url --push origin pushing-only-via-trac` in the "else" branch only when `origin` is in the `sagemath` organization.



---

archive/issue_comments_545311.json:
```json
{
    "body": "<a id='comment:52'></a>\nAnd I'd still prefer to move the line\n\n```\n+        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n```\nto the very beginning so that it runs in both cases - it's easier to understand that it is correct",
    "created_at": "2022-04-01T00:20:03Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545311",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:52'></a>
And I'd still prefer to move the line

```
+        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
```
to the very beginning so that it runs in both cases - it's easier to understand that it is correct



---

archive/issue_comments_545312.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [mkoeppe](#comment%3A51):\n> Now if we also want to support a development model in which users use their own [GitHub](../wikis/GitHub) forks as `origin`, then we should probably do the line `git remote set-url --push origin pushing-only-via-trac` in the \"else\" branch only when `origin` is in the `sagemath` organization.\n\nDo you know how/with which credentials the sync hook pushes to the github mirror? Maybe its easy to setup a branch protection rule that would prevent any pushes to the mirror (except for the syncs).",
    "created_at": "2022-04-01T00:31:35Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545312",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:53'></a>
Replying to [mkoeppe](#comment%3A51):
> Now if we also want to support a development model in which users use their own [GitHub](../wikis/GitHub) forks as `origin`, then we should probably do the line `git remote set-url --push origin pushing-only-via-trac` in the "else" branch only when `origin` is in the `sagemath` organization.

Do you know how/with which credentials the sync hook pushes to the github mirror? Maybe its easy to setup a branch protection rule that would prevent any pushes to the mirror (except for the syncs).



---

archive/issue_comments_545313.json:
```json
{
    "body": "<a id='comment:54'></a>\nNo idea, sorry",
    "created_at": "2022-04-01T05:04:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545313",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
No idea, sorry



---

archive/issue_comments_545314.json:
```json
{
    "body": "<a id='comment:55'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6\">80e8e2e</a></td><td><code>Remove special treatment of origin for pushes</code></td></tr></table>\n",
    "created_at": "2022-04-01T14:40:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6">80e8e2e</a></td><td><code>Remove special treatment of origin for pushes</code></td></tr></table>




---

archive/issue_comments_545315.json:
```json
{
    "body": "**Changing commit** from \"[e9035ae0330755ccd54bf179a1481fa901b632ac](https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac)\" to \"[80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6](https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6)\".",
    "created_at": "2022-04-01T14:40:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e9035ae0330755ccd54bf179a1481fa901b632ac](https://github.com/sagemath/sagetrac-mirror/commit/e9035ae0330755ccd54bf179a1481fa901b632ac)" to "[80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6](https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6)".



---

archive/issue_comments_545316.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0250accef262739445d81302a35c345b1fbf8a04\">0250acc</a></td><td><code>Test commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4\">cc45a3b</a></td><td><code>Revert</code></td></tr></table>\n",
    "created_at": "2022-04-01T14:47:20Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0250accef262739445d81302a35c345b1fbf8a04">0250acc</a></td><td><code>Test commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4">cc45a3b</a></td><td><code>Revert</code></td></tr></table>




---

archive/issue_comments_545317.json:
```json
{
    "body": "**Changing commit** from \"[80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6](https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6)\" to \"[cc45a3bfaa40905b72527dc1254e1e1e5086e0e4](https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4)\".",
    "created_at": "2022-04-01T14:47:20Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6](https://github.com/sagemath/sagetrac-mirror/commit/80e8e2e64d5e9544c61f51b2c527b727b8ae2ee6)" to "[cc45a3bfaa40905b72527dc1254e1e1e5086e0e4](https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4)".



---

archive/issue_comments_545318.json:
```json
{
    "body": "<a id='comment:57'></a>\nAccording to \n\n```\ncurl -H \"Accept: application/vnd.github.v3+json\" https://api.github.com/networks/sagemath/sagetrac-mirror/events?per_page=100 | ConvertFrom-Json | where { $_.type -eq \"PushEvent\" } | Select actor\n```\nit is always `sageb0t`. I've now added a branch protection rule, see https://groups.google.com/g/sage-devel/c/Z1rx_uP7LtY. Thus the special handling of origin is no longer needed.",
    "created_at": "2022-04-01T14:55:07Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545318",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:57'></a>
According to 

```
curl -H "Accept: application/vnd.github.v3+json" https://api.github.com/networks/sagemath/sagetrac-mirror/events?per_page=100 | ConvertFrom-Json | where { $_.type -eq "PushEvent" } | Select actor
```
it is always `sageb0t`. I've now added a branch protection rule, see https://groups.google.com/g/sage-devel/c/Z1rx_uP7LtY. Thus the special handling of origin is no longer needed.



---

archive/issue_comments_545319.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [mkoeppe](#comment%3A52):\n> And I'd still prefer to move the line\n> \n> ```\n> +        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild\n> ```\n> to the very beginning so that it runs in both cases - it's easier to understand that it is correct\n\nI agree.",
    "created_at": "2022-04-01T14:55:15Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545319",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:58'></a>
Replying to [mkoeppe](#comment%3A52):
> And I'd still prefer to move the line
> 
> ```
> +        git remote remove trac 2> /dev/null # might still exists from a previous run/prebuild
> ```
> to the very beginning so that it runs in both cases - it's easier to understand that it is correct

I agree.



---

archive/issue_comments_545320.json:
```json
{
    "body": "<a id='comment:59'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc\">bbe8724</a></td><td><code>Move reset of trac remote</code></td></tr></table>\n",
    "created_at": "2022-04-01T14:57:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc">bbe8724</a></td><td><code>Move reset of trac remote</code></td></tr></table>




---

archive/issue_comments_545321.json:
```json
{
    "body": "**Changing commit** from \"[cc45a3bfaa40905b72527dc1254e1e1e5086e0e4](https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4)\" to \"[bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)\".",
    "created_at": "2022-04-01T14:57:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cc45a3bfaa40905b72527dc1254e1e1e5086e0e4](https://github.com/sagemath/sagetrac-mirror/commit/cc45a3bfaa40905b72527dc1254e1e1e5086e0e4)" to "[bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)".



---

archive/issue_comments_545322.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2022-04-01T15:50:36Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545322",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_events_300534.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T15:50:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33589#event-300534"
}
```



---

archive/issue_events_300535.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T15:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33589#event-300535"
}
```



---

archive/issue_comments_545323.json:
```json
{
    "body": "<a id='comment:61'></a>\nThanks for the review and the many helpful suggestions!",
    "created_at": "2022-04-01T16:03:05Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545323",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:61'></a>
Thanks for the review and the many helpful suggestions!



---

archive/issue_comments_545324.json:
```json
{
    "body": "**Changing branch** from \"[public/build/gitpod_trac_tracking](https://github.com/sagemath/sagetrac-mirror/tree/public/build/gitpod_trac_tracking)\" to \"[bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)\".",
    "created_at": "2022-04-03T11:13:40Z",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33589#issuecomment-545324",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/build/gitpod_trac_tracking](https://github.com/sagemath/sagetrac-mirror/tree/public/build/gitpod_trac_tracking)" to "[bbe8724fede61a8e52795e48a9ef2c328f338adc](https://github.com/sagemath/sagetrac-mirror/commit/bbe8724fede61a8e52795e48a9ef2c328f338adc)".



---

archive/issue_events_300536.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-03T11:13:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33589#event-300536"
}
```



---

archive/issue_events_300537.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "97533a71f920fc17f1e2aac8b73e8fbd0dac9201",
    "created_at": "2022-04-03T11:13:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33589",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33589#event-300537"
}
```
