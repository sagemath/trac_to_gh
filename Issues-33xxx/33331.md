# Issue 33331: Meta-ticket: improve conda setup

archive/issues_033094.json:
```json
{
    "body": "- #33330: `primecountpy` is not installed in the conda env because it is not listed in `environment.yml`\n- #33056: giac installed via conda is not usable and leads to many doctest failures\n- #33358: fix for downgrades in `src/environment-optional.yml`\n- #30845: Fix the conda-for-Sage-developers installation method, add GH Actions workflow\n- Updated https://wiki.sagemath.org/Conda to match #30845\n  - use `configure --prefix=$CONDA_PREFIX`\n  - use `configure --with-system-...=force`\n  - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n- #33642 Update `build/pkgs/matplotlib/install-requires.txt`\n- #33088 More updates for installation and developer guides\n- #33613 Pip package git_trac_command, add pip packages to conda environments\n- On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n- Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.\n\nFix remaining tests that fail:\n- sage distutils classes\n\n```\nFile \"src/sage/interfaces/sage0.py\", line 208, in sage.interfaces.sage0.Sage.cputime\nFailed example:\n    sage0.cputime()     # random output\nException raised:\n    Traceback (most recent call last):\n      File \"/home/runner/work/sage/sage/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/runner/work/sage/sage/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.sage0.Sage.cputime[0]>\", line 1, in <module>\n        sage0.cputime()     # random output\n      File \"/home/runner/work/sage/sage/src/sage/interfaces/sage0.py\", line 219, in cputime\n        return float(s)\n    ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\\n  other = LooseVersion(other)\\n1.60718'\n```\n\n- #34298: threejs path\n\n```\n File \"src/sage/repl/ipython_kernel/install.py\", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs\nFailed example:\n    os.path.isdir(threejs)\nExpected:\n    True\nGot:\n    False\n```\n\n**CC:**  @isuruf @dimpase @saraedum @mkoeppe @slel\n\nIssue created by migration from https://trac.sagemath.org/ticket/33331\n\n",
    "created_at": "2022-02-13T13:57:32Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Meta-ticket: improve conda setup",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/33331",
    "user": "https://github.com/tobiasdiez"
}
```
- #33330: `primecountpy` is not installed in the conda env because it is not listed in `environment.yml`
- #33056: giac installed via conda is not usable and leads to many doctest failures
- #33358: fix for downgrades in `src/environment-optional.yml`
- #30845: Fix the conda-for-Sage-developers installation method, add GH Actions workflow
- Updated https://wiki.sagemath.org/Conda to match #30845
  - use `configure --prefix=$CONDA_PREFIX`
  - use `configure --with-system-...=force`
  - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
- #33642 Update `build/pkgs/matplotlib/install-requires.txt`
- #33088 More updates for installation and developer guides
- #33613 Pip package git_trac_command, add pip packages to conda environments
- On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
- Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.

Fix remaining tests that fail:
- sage distutils classes

```
File "src/sage/interfaces/sage0.py", line 208, in sage.interfaces.sage0.Sage.cputime
Failed example:
    sage0.cputime()     # random output
Exception raised:
    Traceback (most recent call last):
      File "/home/runner/work/sage/sage/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/runner/work/sage/sage/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.sage0.Sage.cputime[0]>", line 1, in <module>
        sage0.cputime()     # random output
      File "/home/runner/work/sage/sage/src/sage/interfaces/sage0.py", line 219, in cputime
        return float(s)
    ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n  other = LooseVersion(other)\n1.60718'
```

- #34298: threejs path

```
 File "src/sage/repl/ipython_kernel/install.py", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs
Failed example:
    os.path.isdir(threejs)
Expected:
    True
Got:
    False
```

**CC:**  @isuruf @dimpase @saraedum @mkoeppe @slel

Issue created by migration from https://trac.sagemath.org/ticket/33331





---

archive/issue_comments_541426.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,6 +3,7 @@\n - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n+- #33056: giac installed via conda is not usable and leads to many doctest failures\n - Installation with `src/environment-optional.yml` uses rather old packages such as lcalc 1 and pari 2.11.4. This leads to issues such as the one below. Or that the package is then rejected by `configure` as being too old. This is most likely an issue with some of the optional packages that get installed and that still relies on an old version of some conda package, which then leads to various downgrades. See discussion at #30845.\n \n ```\n``````\n",
    "created_at": "2022-02-13T13:58:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541426",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,6 +3,7 @@
 - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
+- #33056: giac installed via conda is not usable and leads to many doctest failures
 - Installation with `src/environment-optional.yml` uses rather old packages such as lcalc 1 and pari 2.11.4. This leads to issues such as the one below. Or that the package is then rejected by `configure` as being too old. This is most likely an issue with some of the optional packages that get installed and that still relies on an old version of some conda package, which then leads to various downgrades. See discussion at #30845.
 
 ```
``````




---

archive/issue_comments_541427.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n - Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs\n-- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n+- On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n - #33056: giac installed via conda is not usable and leads to many doctest failures\n``````\n",
    "created_at": "2022-02-15T12:24:30Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541427",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
 - Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs
-- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
+- On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
 - #33056: giac installed via conda is not usable and leads to many doctest failures
``````




---

archive/issue_comments_541428.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,15 +4,6 @@\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n - #33056: giac installed via conda is not usable and leads to many doctest failures\n-- Installation with `src/environment-optional.yml` uses rather old packages such as lcalc 1 and pari 2.11.4. This leads to issues such as the one below. Or that the package is then rejected by `configure` as being too old. This is most likely an issue with some of the optional packages that get installed and that still relies on an old version of some conda package, which then leads to various downgrades. See discussion at #30845.\n+- #33358: fix for downgrades in src/environment-optional.yml\n+}}}\n \n-```\n-building 'sage.libs.lcalc.lcalc_Lfunction' extension\n-    cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++\n-    In file included from sage/libs/lcalc/lcalc_Lfunction.cpp:740:\n-    sage/libs/lcalc/lcalc_sage.h:1:10: fatal error: lcalc/L.h: No such file or directory\n-        1 | #include \"lcalc/L.h\"\n-          |          ^~~~~~~~~~~\n-    compilation terminated.\n-```\n-\n``````\n",
    "created_at": "2022-02-16T20:27:12Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541428",
    "user": "https://github.com/isuruf"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,15 +4,6 @@
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
 - #33056: giac installed via conda is not usable and leads to many doctest failures
-- Installation with `src/environment-optional.yml` uses rather old packages such as lcalc 1 and pari 2.11.4. This leads to issues such as the one below. Or that the package is then rejected by `configure` as being too old. This is most likely an issue with some of the optional packages that get installed and that still relies on an old version of some conda package, which then leads to various downgrades. See discussion at #30845.
+- #33358: fix for downgrades in src/environment-optional.yml
+}}}
 
-```
-building 'sage.libs.lcalc.lcalc_Lfunction' extension
-    cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++
-    In file included from sage/libs/lcalc/lcalc_Lfunction.cpp:740:
-    sage/libs/lcalc/lcalc_sage.h:1:10: fatal error: lcalc/L.h: No such file or directory
-        1 | #include "lcalc/L.h"
-          |          ^~~~~~~~~~~
-    compilation terminated.
-```
-
``````




---

archive/issue_comments_541429.json:
```json
{
    "body": "<a id='comment:4'></a>\n> The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding conda.txt files \n\n`@`gh-tobiasdiez, is this fixed by #33358 too?",
    "created_at": "2022-02-17T01:00:34Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541429",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:4'></a>
> The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding conda.txt files 

`@`gh-tobiasdiez, is this fixed by #33358 too?



---

archive/issue_comments_541430.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [isuruf](#comment%3A4):\n> > The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding conda.txt files \n\n> \n> `@`gh-tobiasdiez, is this fixed by #33358 too?\n\nNope, still present. See e.g. output of https://pipelines.actions.githubusercontent.com/wUvxDab7ZCURYAl3HeSwsAoJVAdvXg6u4iTbsP5NChUqrJ4TKs/_apis/pipelines/1/runs/9243/signedlogcontent/3?urlExpires=2022-02-17T12%3A02%3A43.1351322Z&urlSigningMethod=HMACV1&urlSignature=ildfTJhaQ2KGVywf69MDFQSVOl7GTONDSdIOurIphKI%3D\n\nConda is installing rpy2 v3.4.5, while sagelib install requires specify <3.4,>=3.3. Thus pip will download an older version. I think it should be enough to specify the same upper constraint (for the few python packages that have one) in the distros/conda.txt.",
    "created_at": "2022-02-17T12:06:57Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541430",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
Replying to [isuruf](#comment%3A4):
> > The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding conda.txt files 

> 
> `@`gh-tobiasdiez, is this fixed by #33358 too?

Nope, still present. See e.g. output of https://pipelines.actions.githubusercontent.com/wUvxDab7ZCURYAl3HeSwsAoJVAdvXg6u4iTbsP5NChUqrJ4TKs/_apis/pipelines/1/runs/9243/signedlogcontent/3?urlExpires=2022-02-17T12%3A02%3A43.1351322Z&urlSigningMethod=HMACV1&urlSignature=ildfTJhaQ2KGVywf69MDFQSVOl7GTONDSdIOurIphKI%3D

Conda is installing rpy2 v3.4.5, while sagelib install requires specify <3.4,>=3.3. Thus pip will download an older version. I think it should be enough to specify the same upper constraint (for the few python packages that have one) in the distros/conda.txt.



---

archive/issue_comments_541431.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n-- Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs\n+- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n``````\n",
    "created_at": "2022-02-28T18:31:28Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541431",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
-- Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs
+- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
``````




---

archive/issue_comments_541432.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n-- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs\n+- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n``````\n",
    "created_at": "2022-02-28T20:38:22Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541432",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
-- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer docs
+- #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
``````




---

archive/issue_comments_541433.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n+- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n+\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n``````\n",
    "created_at": "2022-03-18T16:05:10Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541433",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
+- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
+
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
``````




---

archive/issue_comments_541434.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+- #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n \n``````\n",
    "created_at": "2022-03-18T17:10:02Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541434",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+- #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
 - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
 
``````




---

archive/issue_comments_541435.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n+- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n+- #33056: giac installed via conda is not usable and leads to many doctest failures\n+- #33358: fix for downgrades in src/environment-optional.yml\n - #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow\n - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n@@ -5,8 +8,5 @@\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n-- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n-- #33056: giac installed via conda is not usable and leads to many doctest failures\n-- #33358: fix for downgrades in src/environment-optional.yml\n-}}}\n \n+\n``````\n",
    "created_at": "2022-03-18T17:10:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541435",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
+- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
+- #33056: giac installed via conda is not usable and leads to many doctest failures
+- #33358: fix for downgrades in src/environment-optional.yml
 - #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow
 - Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
 - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
@@ -5,8 +8,5 @@
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
-- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
-- #33056: giac installed via conda is not usable and leads to many doctest failures
-- #33358: fix for downgrades in src/environment-optional.yml
-}}}
 
+
``````




---

archive/issue_comments_541436.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,11 @@\n - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n - #33056: giac installed via conda is not usable and leads to many doctest failures\n - #33358: fix for downgrades in src/environment-optional.yml\n-- #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow\n-- Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`\n-- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n-\n+- #30845: Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow\n+- Updated https://wiki.sagemath.org/Conda to match #30845\n+  - use `configure --prefix=$CONDA_PREFIX`\n+  - use `configure --with-system-...=force`\n+  - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n``````\n",
    "created_at": "2022-03-21T07:24:24Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541436",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,11 @@
 - #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
 - #33056: giac installed via conda is not usable and leads to many doctest failures
 - #33358: fix for downgrades in src/environment-optional.yml
-- #30845 Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow
-- Update documentation to use conda to manage python dependencies instead of relying on `pip -r requirements.txt`
-- Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)
-
+- #30845: Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow
+- Updated https://wiki.sagemath.org/Conda to match #30845
+  - use `configure --prefix=$CONDA_PREFIX`
+  - use `configure --with-system-...=force`
+  - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
``````




---

archive/issue_comments_541437.json:
```json
{
    "body": "<a id='comment:12'></a>\nin \u200bhttps://wiki.sagemath.org/Conda there is a confusing mix of conda and mamba commands. Can they all be mamba?",
    "created_at": "2022-03-21T09:37:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541437",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
in ​https://wiki.sagemath.org/Conda there is a confusing mix of conda and mamba commands. Can they all be mamba?



---

archive/issue_comments_541438.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think after running `mamba init` you can\nalways use `mamba` instead of `conda`.",
    "created_at": "2022-03-21T10:40:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541438",
    "user": "https://github.com/slel"
}
```

<a id='comment:13'></a>
I think after running `mamba init` you can
always use `mamba` instead of `conda`.



---

archive/issue_comments_541439.json:
```json
{
    "body": "<a id='comment:14'></a>\nI followed the \"Conda for Sage developers\"\nsection of the Conda page on the Sage wiki.\n\nI noticed it downgrades the openssl version from 3.0.0 to 1.1.1l.\nCan that be fixed?",
    "created_at": "2022-03-21T10:41:48Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541439",
    "user": "https://github.com/slel"
}
```

<a id='comment:14'></a>
I followed the "Conda for Sage developers"
section of the Conda page on the Sage wiki.

I noticed it downgrades the openssl version from 3.0.0 to 1.1.1l.
Can that be fixed?



---

archive/issue_comments_541440.json:
```json
{
    "body": "<a id='comment:15'></a>\nUsing `src/environment-optional.yml`\ndowngrades a few more packages:\n\n- `boost-cpp` from 1.77.0 to 1.74.0\n- `cmake` from 3.22.3 to 3.21.3\n- `ncurses`from 6.3 to 6.2\n- `python` from 3.10.2 to 3.8.12\n- `singular` from 4.2.1.p3 to 4.2.0.p3\n- `sqlite` from 3.37.1 to 3.37.0",
    "created_at": "2022-03-21T10:47:27Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541440",
    "user": "https://github.com/slel"
}
```

<a id='comment:15'></a>
Using `src/environment-optional.yml`
downgrades a few more packages:

- `boost-cpp` from 1.77.0 to 1.74.0
- `cmake` from 3.22.3 to 3.21.3
- `ncurses`from 6.3 to 6.2
- `python` from 3.10.2 to 3.8.12
- `singular` from 4.2.1.p3 to 4.2.0.p3
- `sqlite` from 3.37.1 to 3.37.0



---

archive/issue_comments_541441.json:
```json
{
    "body": "<a id='comment:16'></a>\nDid you use the branch of #30845?",
    "created_at": "2022-03-21T11:53:54Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541441",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Did you use the branch of #30845?



---

archive/issue_comments_541442.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [dimpase](#comment%3A12):\n> in \u200bhttps://wiki.sagemath.org/Conda there is a confusing mix of conda and mamba commands. Can they all be mamba?\n\nThey can, but I'm not sure if it would be an improvement to this documentation.\nI have added a comment to the step \"conda install mamba\", please take a look",
    "created_at": "2022-03-21T11:58:20Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541442",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Replying to [dimpase](#comment%3A12):
> in ​https://wiki.sagemath.org/Conda there is a confusing mix of conda and mamba commands. Can they all be mamba?

They can, but I'm not sure if it would be an improvement to this documentation.
I have added a comment to the step "conda install mamba", please take a look



---

archive/issue_comments_541443.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,4 @@\n   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n-- The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files\n \n-\n``````\n",
    "created_at": "2022-03-21T17:34:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541443",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,4 @@
   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
-- The correct version of rpy2, scipy, sphinx among other packages is not installed in the conda env, so add version constraints in the corresponding `conda.txt` files
 
-
``````




---

archive/issue_comments_541444.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mkoeppe](#comment%3A16):\n> Did you use the branch of #30845?\n\nOops, I had not used that branch.\nUsing it, only `openssl` gets downgraded,\n\n- whether using `src/environment.yml`\n- or using  `src/environment-optional.yml`\n\nThis is on macOS 11.6.5 Big Sur.",
    "created_at": "2022-03-22T00:01:34Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541444",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'></a>
Replying to [mkoeppe](#comment%3A16):
> Did you use the branch of #30845?

Oops, I had not used that branch.
Using it, only `openssl` gets downgraded,

- whether using `src/environment.yml`
- or using  `src/environment-optional.yml`

This is on macOS 11.6.5 Big Sur.



---

archive/issue_comments_541445.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,3 +9,52 @@\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n \n+\n+Fix remaining tests that fail:\n+- matplotlib distutils classes\n+\n+```\n+/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py:169: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n+      if LooseVersion(module.__version__) < minver:\n+    /usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n+      other = LooseVersion(other)\n+```\n+Should be fixed by https://github.com/matplotlib/matplotlib/pull/21073, which is in included in matplotlib 3.5.1 (but for some reason conda installs only 3.3.2, to be investigated)\n+\n+- matplotlib colormaps\n+\n+```\n+     sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)\n+```\n+Probably introduced by #33491.\n+\n+- sage distutils classes\n+\n+```\n+File \"src/sage/interfaces/sage0.py\", line 208, in sage.interfaces.sage0.Sage.cputime\n+Failed example:\n+    sage0.cputime()     # random output\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/home/runner/work/sage/sage/src/sage/doctest/forker.py\", line 695, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/runner/work/sage/sage/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.interfaces.sage0.Sage.cputime[0]>\", line 1, in <module>\n+        sage0.cputime()     # random output\n+      File \"/home/runner/work/sage/sage/src/sage/interfaces/sage0.py\", line 219, in cputime\n+        return float(s)\n+    ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\\n  other = LooseVersion(other)\\n1.60718'\n+```\n+\n+- threejs path\n+\n+```\n+ File \"src/sage/repl/ipython_kernel/install.py\", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs\n+Failed example:\n+    os.path.isdir(threejs)\n+Expected:\n+    True\n+Got:\n+    False\n+```\n``````\n",
    "created_at": "2022-04-04T11:55:52Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541445",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,3 +9,52 @@
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 
+
+Fix remaining tests that fail:
+- matplotlib distutils classes
+
+```
+/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py:169: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
+      if LooseVersion(module.__version__) < minver:
+    /usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
+      other = LooseVersion(other)
+```
+Should be fixed by https://github.com/matplotlib/matplotlib/pull/21073, which is in included in matplotlib 3.5.1 (but for some reason conda installs only 3.3.2, to be investigated)
+
+- matplotlib colormaps
+
+```
+     sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)
+```
+Probably introduced by #33491.
+
+- sage distutils classes
+
+```
+File "src/sage/interfaces/sage0.py", line 208, in sage.interfaces.sage0.Sage.cputime
+Failed example:
+    sage0.cputime()     # random output
+Exception raised:
+    Traceback (most recent call last):
+      File "/home/runner/work/sage/sage/src/sage/doctest/forker.py", line 695, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/runner/work/sage/sage/src/sage/doctest/forker.py", line 1093, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.interfaces.sage0.Sage.cputime[0]>", line 1, in <module>
+        sage0.cputime()     # random output
+      File "/home/runner/work/sage/sage/src/sage/interfaces/sage0.py", line 219, in cputime
+        return float(s)
+    ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n  other = LooseVersion(other)\n1.60718'
+```
+
+- threejs path
+
+```
+ File "src/sage/repl/ipython_kernel/install.py", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs
+Failed example:
+    os.path.isdir(threejs)
+Expected:
+    True
+Got:
+    False
+```
``````




---

archive/issue_comments_541446.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,27 +7,10 @@\n   - use `configure --with-system-...=force`\n   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n+- #33642 `Update build/pkgs/matplotlib/install-requires.txt`\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n \n-\n Fix remaining tests that fail:\n-- matplotlib distutils classes\n-\n-```\n-/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py:169: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n-      if LooseVersion(module.__version__) < minver:\n-    /usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n-      other = LooseVersion(other)\n-```\n-Should be fixed by https://github.com/matplotlib/matplotlib/pull/21073, which is in included in matplotlib 3.5.1 (but for some reason conda installs only 3.3.2, to be investigated)\n-\n-- matplotlib colormaps\n-\n-```\n-     sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)\n-```\n-Probably introduced by #33491.\n-\n - sage distutils classes\n \n ```\n``````\n",
    "created_at": "2022-04-04T21:49:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541446",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,27 +7,10 @@
   - use `configure --with-system-...=force`
   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
+- #33642 `Update build/pkgs/matplotlib/install-requires.txt`
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 
-
 Fix remaining tests that fail:
-- matplotlib distutils classes
-
-```
-/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py:169: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
-      if LooseVersion(module.__version__) < minver:
-    /usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
-      other = LooseVersion(other)
-```
-Should be fixed by https://github.com/matplotlib/matplotlib/pull/21073, which is in included in matplotlib 3.5.1 (but for some reason conda installs only 3.3.2, to be investigated)
-
-- matplotlib colormaps
-
-```
-     sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)
-```
-Probably introduced by #33491.
-
 - sage distutils classes
 
 ```
``````




---

archive/issue_comments_541447.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,7 @@\n   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - #33642 `Update build/pkgs/matplotlib/install-requires.txt`\n+- #33088 More updates for installation and developer guides\n - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n \n Fix remaining tests that fail:\n``````\n",
    "created_at": "2022-04-05T21:08:34Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541447",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,7 @@
   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - #33642 `Update build/pkgs/matplotlib/install-requires.txt`
+- #33088 More updates for installation and developer guides
 - On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 
 Fix remaining tests that fail:
``````




---

archive/issue_comments_541448.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,15 @@\n-- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`\n+- #33330: `primecountpy` is not installed in the conda env because it is not listed in `environment.yml`\n - #33056: giac installed via conda is not usable and leads to many doctest failures\n-- #33358: fix for downgrades in src/environment-optional.yml\n-- #30845: Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow\n+- #33358: fix for downgrades in `src/environment-optional.yml`\n+- #30845: Fix the conda-for-Sage-developers installation method, add GH Actions workflow\n - Updated https://wiki.sagemath.org/Conda to match #30845\n   - use `configure --prefix=$CONDA_PREFIX`\n   - use `configure --with-system-...=force`\n   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n-- #33642 `Update build/pkgs/matplotlib/install-requires.txt`\n+- #33642 Update `build/pkgs/matplotlib/install-requires.txt`\n - #33088 More updates for installation and developer guides\n-- On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n+- On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n \n Fix remaining tests that fail:\n - sage distutils classes\n``````\n",
    "created_at": "2022-04-06T12:24:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541448",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,15 @@
-- #33330: primecountpy is not installed in the conda env because its not listed in `environment.yml`
+- #33330: `primecountpy` is not installed in the conda env because it is not listed in `environment.yml`
 - #33056: giac installed via conda is not usable and leads to many doctest failures
-- #33358: fix for downgrades in src/environment-optional.yml
-- #30845: Fixes for the conda-for-Sage-developers installation method, add GH Actions workflow
+- #33358: fix for downgrades in `src/environment-optional.yml`
+- #30845: Fix the conda-for-Sage-developers installation method, add GH Actions workflow
 - Updated https://wiki.sagemath.org/Conda to match #30845
   - use `configure --prefix=$CONDA_PREFIX`
   - use `configure --with-system-...=force`
   - use conda for all python dependencies instead of relying on `pip -r requirements.txt`
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
-- #33642 `Update build/pkgs/matplotlib/install-requires.txt`
+- #33642 Update `build/pkgs/matplotlib/install-requires.txt`
 - #33088 More updates for installation and developer guides
-- On WSL, gc and thus ecl are not found, see discussion starting with [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
+- On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 
 Fix remaining tests that fail:
 - sage distutils classes
``````




---

archive/issue_comments_541449.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n - #33642 Update `build/pkgs/matplotlib/install-requires.txt`\n - #33088 More updates for installation and developer guides\n - On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n+- Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.\n \n Fix remaining tests that fail:\n - sage distutils classes\n``````\n",
    "created_at": "2022-04-07T22:43:13Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541449",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 - #33642 Update `build/pkgs/matplotlib/install-requires.txt`
 - #33088 More updates for installation and developer guides
 - On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
+- Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.
 
 Fix remaining tests that fail:
 - sage distutils classes
``````




---

archive/issue_events_298711.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33331#event-298711"
}
```



---

archive/issue_events_298712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33331#event-298712"
}
```



---

archive/issue_comments_541450.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,7 @@\n - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs\n - #33642 Update `build/pkgs/matplotlib/install-requires.txt`\n - #33088 More updates for installation and developer guides\n+- #33613 Pip package git_trac_command, add pip packages to conda environments\n - On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)\n - Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.\n \n``````\n",
    "created_at": "2022-05-29T23:36:21Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541450",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,7 @@
 - #33426 Migrate documentation from wiki https://wiki.sagemath.org/Conda to developer and installation docs
 - #33642 Update `build/pkgs/matplotlib/install-requires.txt`
 - #33088 More updates for installation and developer guides
+- #33613 Pip package git_trac_command, add pip packages to conda environments
 - On WSL, `gc` and thus `ecl` are not found, as discussed at [#30845 comment:152](https://github.com/sagemath/sage/issues/30845#comment:152)
 - Make sure conda installs only python packages that are satisfying the version constraints specified in `install_requires`. Notably, ptyprocess, iniconfig, sphinx, pytest, rpy2 are currently reinstalled by pip. Also add `--no-dependencies` to `pip install` in the conda ci workflow.
 
``````




---

archive/issue_comments_541451.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -33,7 +33,7 @@\n     ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\\n  other = LooseVersion(other)\\n1.60718'\n ```\n \n-- threejs path\n+- #34298: threejs path\n \n ```\n  File \"src/sage/repl/ipython_kernel/install.py\", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs\n``````\n",
    "created_at": "2022-08-07T17:25:25Z",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33331#issuecomment-541451",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -33,7 +33,7 @@
     ValueError: could not convert string to float: 'iniconda/envs/sage-build/lib/python3.8/site-packages/setuptools/_distutils/version.py:351: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.\n  other = LooseVersion(other)\n1.60718'
 ```
 
-- threejs path
+- #34298: threejs path
 
 ```
  File "src/sage/repl/ipython_kernel/install.py", line 127, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_threejs
``````




---

archive/issue_events_298713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33331#event-298713"
}
```



---

archive/issue_events_298714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33331",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33331#event-298714"
}
```
