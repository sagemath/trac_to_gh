# Issue 33091: labels in multiline doctests

archive/issues_032854.json:
```json
{
    "assignees": [],
    "body": "I'm occasionally getting this timeout:\n\n```\nsage -t --random-seed=39014585829676668007219039140784171913 src/sage/matrix/matrix2.pyx\n    Timed out\n**********************************************************************\nTests run before process (pid=6202) timed out:\n...\n...\nsage: all(L.change_ring(SR).is_Z_operator_on(K)\n    for L in K.Z_operators_gens())  # long time ## line 17218 ##\n------------------------------------------------------------------------\n```\n\nI'm not using `--long` here, but this test is still running.\n\nThis is fixed if the `# long time` label is moved to the first line of the doctest.\n\nThe same file contains other multiline doctests labeled long in the second line.\n\nIn this ticket:\n- We document that the label belongs on the first line.\n- We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)\n- We fix all uses\n\n\nDepends on #33096\n\nCC:  @orlitzky\n\nBranch/Commit: **[u/mkoeppe/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/33091) @ [`0d84d15`](https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8)**\n\nReviewer: **Matthias Koeppe, ...**\n\nAuthor: **Michael Orlitzky, Matthias Koeppe**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33091_\n\n",
    "created_at": "2021-12-28T17:04:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "labels in multiline doctests",
    "type": "issue",
    "updated_at": "2022-08-31T05:25:02Z",
    "url": "https://github.com/sagemath/sage/issues/33091",
    "user": "https://github.com/tornaria"
}
```
I'm occasionally getting this timeout:

```
sage -t --random-seed=39014585829676668007219039140784171913 src/sage/matrix/matrix2.pyx
    Timed out
**********************************************************************
Tests run before process (pid=6202) timed out:
...
...
sage: all(L.change_ring(SR).is_Z_operator_on(K)
    for L in K.Z_operators_gens())  # long time ## line 17218 ##
------------------------------------------------------------------------
```

I'm not using `--long` here, but this test is still running.

This is fixed if the `# long time` label is moved to the first line of the doctest.

The same file contains other multiline doctests labeled long in the second line.

In this ticket:
- We document that the label belongs on the first line.
- We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)
- We fix all uses


Depends on #33096

CC:  @orlitzky

Branch/Commit: **[u/mkoeppe/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/33091) @ [`0d84d15`](https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8)**

Reviewer: **Matthias Koeppe, ...**

Author: **Michael Orlitzky, Matthias Koeppe**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/33091_





---

archive/issue_events_457517.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2021-12-28T17:04:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457517"
}
```



---

archive/issue_events_457518.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2021-12-28T17:04:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457518"
}
```



---

archive/issue_events_457519.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2021-12-28T17:04:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457519"
}
```



---

archive/issue_events_457520.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2021-12-28T17:04:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457520"
}
```



---

archive/issue_comments_534316.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI honestly don't know if the label needs to be on the first line, or on all of them. I would think the \"correct\" place for the label is at the end of the logical line, though, since this is python.\n\nI'm responsible for that doctest and likely others in matrix2.py and sage.geometry.cone. At some point I started adding the `# long time` on each line, but those are older. I'm happy to fix them.",
    "created_at": "2021-12-28T18:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534316",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:1" align="right">comment:1</div>

I honestly don't know if the label needs to be on the first line, or on all of them. I would think the "correct" place for the label is at the end of the logical line, though, since this is python.

I'm responsible for that doctest and likely others in matrix2.py and sage.geometry.cone. At some point I started adding the `# long time` on each line, but those are older. I'm happy to fix them.



---

archive/issue_comments_534317.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nCurrently doctest annotations belong on the first line\nof each doctest.\n\nTicket #17404 proposes to change that.",
    "created_at": "2021-12-28T19:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534317",
    "user": "https://github.com/slel"
}
```

<div id="comment:2" align="right">comment:2</div>

Currently doctest annotations belong on the first line
of each doctest.

Ticket #17404 proposes to change that.



---

archive/issue_events_457521.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-28T20:17:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457521"
}
```



---

archive/issue_events_457522.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-28T20:17:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457522"
}
```



---

archive/issue_events_457523.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-28T20:17:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457523"
}
```



---

archive/issue_events_457524.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-28T20:17:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457524"
}
```



---

archive/issue_comments_534318.json:
```json
{
    "body": "Dependencies: **#17404**",
    "created_at": "2021-12-28T20:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534318",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#17404**



---

archive/issue_events_457525.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-28T20:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457525"
}
```



---

archive/issue_events_457526.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-28T20:37:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457526"
}
```



---

archive/issue_events_457527.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-28T20:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457527"
}
```



---

archive/issue_comments_534319.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAt least let me fix the doctests that we know are labeled incorrectly...",
    "created_at": "2021-12-28T20:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534319",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:4" align="right">comment:4</div>

At least let me fix the doctests that we know are labeled incorrectly...



---

archive/issue_comments_534320.json:
```json
{
    "body": "Changed dependencies from **#17404** to none",
    "created_at": "2021-12-28T20:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534320",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **#17404** to none



---

archive/issue_comments_534321.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOf course - I missed that",
    "created_at": "2021-12-28T20:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534321",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Of course - I missed that



---

archive/issue_events_457528.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-29T19:28:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457528"
}
```



---

archive/issue_events_457529.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-29T19:28:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457529"
}
```



---

archive/issue_comments_534322.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThere weren't too many of these in the sage library, so I've tried to fix them all.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080\"><code>464f0c4</code></a></td><td><code>Trac #33091: fix mislabeled multiline \"long time\" tests.</code></td></tr></table>\n",
    "created_at": "2021-12-29T19:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534322",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:6" align="right">comment:6</div>

There weren't too many of these in the sage library, so I've tried to fix them all.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080"><code>464f0c4</code></a></td><td><code>Trac #33091: fix mislabeled multiline "long time" tests.</code></td></tr></table>




---

archive/issue_comments_534323.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33091)**",
    "created_at": "2021-12-29T19:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534323",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33091)**



---

archive/issue_comments_534324.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2021-12-29T19:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534324",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_comments_534325.json:
```json
{
    "body": "Commit: **[`464f0c4`](https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080)**",
    "created_at": "2021-12-29T19:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534325",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[`464f0c4`](https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080)**



---

archive/issue_comments_534326.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWhy are you adding them on all lines of the multi-line tests? I don't think this is standard.",
    "created_at": "2021-12-29T19:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534326",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Why are you adding them on all lines of the multi-line tests? I don't think this is standard.



---

archive/issue_events_457530.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T19:47:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457530"
}
```



---

archive/issue_events_457531.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T19:47:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457531"
}
```



---

archive/issue_comments_534327.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mkoeppe](#comment:7):\n> Why are you adding them on all lines of the multi-line tests? I don't think this is standard.\n\nIt's not standard, but it is actually pretty common, since the correct place to put the tag is undocumented and placing it at the end doesn't work. I mention it in the commit message,\n\n> This commit fixes a few doctests whose last (but not first) lines were\n> tagged, updating them instead to bear the \"# long time\" tag on each\n> line. This is overkill, but will save us time in the event that the\n> parser is ever changed.\n\nI think we should standardize on the tag being at the end of the logical line (as all of the examples in the developer's guide show) rather than in the middle of the logical line, which makes no sense at all to me. If we ever do try to make that change, having every line decorated will make the job easier; and it doesn't hurt anything otherwise.",
    "created_at": "2021-12-29T19:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534327",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mkoeppe](#comment:7):
> Why are you adding them on all lines of the multi-line tests? I don't think this is standard.

It's not standard, but it is actually pretty common, since the correct place to put the tag is undocumented and placing it at the end doesn't work. I mention it in the commit message,

> This commit fixes a few doctests whose last (but not first) lines were
> tagged, updating them instead to bear the "# long time" tag on each
> line. This is overkill, but will save us time in the event that the
> parser is ever changed.

I think we should standardize on the tag being at the end of the logical line (as all of the examples in the developer's guide show) rather than in the middle of the logical line, which makes no sense at all to me. If we ever do try to make that change, having every line decorated will make the job easier; and it doesn't hurt anything otherwise.



---

archive/issue_comments_534328.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@orlitzky](#comment:8):\n> Replying to [@mkoeppe](#comment:7):\n> > Why are you adding them on all lines of the multi-line tests? I don't think this is standard.\n\n> \n> It's not standard, but it is actually pretty common, since the correct place to put the tag is undocumented and placing it at the end doesn't work.\n\nThere's a total of 190 such lines in the entire codebase, per `$ git grep -E '[.][.][.][.]:.*#.*(long|optional)'  | wc -l`\n\nThis is markup based on guesswork, let's just fix it to match what actually works (first line marked).\n\nI'm strongly -1 on changing the standard. In particular, I have been adding thousands of `# optional` tags in modularization tickets and I would hate to have to change multiline tests for this.\n\nLet's just document what is correct and fix the 190 outliers. Easy to do with one `git grep -l ... | xargs sed ...`.",
    "created_at": "2021-12-29T20:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534328",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@orlitzky](#comment:8):
> Replying to [@mkoeppe](#comment:7):
> > Why are you adding them on all lines of the multi-line tests? I don't think this is standard.

> 
> It's not standard, but it is actually pretty common, since the correct place to put the tag is undocumented and placing it at the end doesn't work.

There's a total of 190 such lines in the entire codebase, per `$ git grep -E '[.][.][.][.]:.*#.*(long|optional)'  | wc -l`

This is markup based on guesswork, let's just fix it to match what actually works (first line marked).

I'm strongly -1 on changing the standard. In particular, I have been adding thousands of `# optional` tags in modularization tickets and I would hate to have to change multiline tests for this.

Let's just document what is correct and fix the 190 outliers. Easy to do with one `git grep -l ... | xargs sed ...`.



---

archive/issue_comments_534329.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@orlitzky](#comment:8):\n> [...] in the middle of the logical line, which makes no sense at all to me [...]\n\nAs you know, line breaks are significant in Python. The markup is not \"in the middle of a logical line\"; it is on the first line of the block.",
    "created_at": "2021-12-29T20:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534329",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@orlitzky](#comment:8):
> [...] in the middle of the logical line, which makes no sense at all to me [...]

As you know, line breaks are significant in Python. The markup is not "in the middle of a logical line"; it is on the first line of the block.



---

archive/issue_comments_534330.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI'll push a commit that adds to the developer documentation.",
    "created_at": "2021-12-29T20:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534330",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

I'll push a commit that adds to the developer documentation.



---

archive/issue_comments_534331.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33091)** to **[u/mkoeppe/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/33091)**",
    "created_at": "2021-12-29T20:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534331",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33091)** to **[u/mkoeppe/ticket/33091](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/33091)**



---

archive/issue_comments_534332.json:
```json
{
    "body": "Changed commit from **[`464f0c4`](https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080)** to **[`5145f73`](https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85)**",
    "created_at": "2021-12-29T20:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534332",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`464f0c4`](https://github.com/sagemath/sagetrac-mirror/commit/464f0c4242366b619223061584c081a0f1f0d080)** to **[`5145f73`](https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85)**



---

archive/issue_comments_534333.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85\"><code>5145f73</code></a></td><td><code>src/.relint.yml (multiline_doctest_comment): New</code></td></tr></table>\n",
    "created_at": "2021-12-29T20:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534333",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85"><code>5145f73</code></a></td><td><code>src/.relint.yml (multiline_doctest_comment): New</code></td></tr></table>




---

archive/issue_comments_534334.json:
```json
{
    "body": "Dependencies: **#33096**",
    "created_at": "2021-12-29T20:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534334",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#33096**



---

archive/issue_events_457532.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T20:47:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457532"
}
```



---

archive/issue_events_457533.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T20:47:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457533"
}
```



---

archive/issue_comments_534335.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,4 +18,8 @@\n \n The same file contains other multiline doctests labeled long in the second line.\n \n-I wonder if this should be changed in doctests, or in the label parser.\n+In this ticket:\n+- We document that the label belongs on the first line.\n+- We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)\n+- We fix all uses\n+\n``````\n",
    "created_at": "2021-12-29T20:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534335",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,4 +18,8 @@
 
 The same file contains other multiline doctests labeled long in the second line.
 
-I wonder if this should be changed in doctests, or in the label parser.
+In this ticket:
+- We document that the label belongs on the first line.
+- We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)
+- We fix all uses
+
``````




---

archive/issue_comments_534336.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d48cc0fec4e9a5aa527a618af964fc95ed6bf999\"><code>d48cc0f</code></a></td><td><code>src/tox.ini (relint): Exclude editor temp files etc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18af18e70a714045b7551c93e3b8ba3cac015875\"><code>18af18e</code></a></td><td><code>Merge #33096</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f\"><code>9899ee9</code></a></td><td><code>git grep -E -l '[.][.][.][.]:.*#' | xargs sed -E -i.bak '/^ *[.][.][.][.].*#/s/ *# *(arb216|arb218|py2|py3|long time|not implemented|not tested|known bug|optional|indirect doctest).*//'</code></td></tr></table>\n",
    "created_at": "2021-12-29T20:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534336",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d48cc0fec4e9a5aa527a618af964fc95ed6bf999"><code>d48cc0f</code></a></td><td><code>src/tox.ini (relint): Exclude editor temp files etc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18af18e70a714045b7551c93e3b8ba3cac015875"><code>18af18e</code></a></td><td><code>Merge #33096</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f"><code>9899ee9</code></a></td><td><code>git grep -E -l '[.][.][.][.]:.*#' | xargs sed -E -i.bak '/^ *[.][.][.][.].*#/s/ *# *(arb216|arb218|py2|py3|long time|not implemented|not tested|known bug|optional|indirect doctest).*//'</code></td></tr></table>




---

archive/issue_comments_534337.json:
```json
{
    "body": "Changed commit from **[`5145f73`](https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85)** to **[`9899ee9`](https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f)**",
    "created_at": "2021-12-29T20:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5145f73`](https://github.com/sagemath/sagetrac-mirror/commit/5145f735a2a05502849126da83cd1ea74695ad85)** to **[`9899ee9`](https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f)**



---

archive/issue_comments_534338.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nA few corrections to this automated edit will be necessary",
    "created_at": "2021-12-29T20:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534338",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

A few corrections to this automated edit will be necessary



---

archive/issue_comments_534339.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069\"><code>be4c928</code></a></td><td><code>Restore lost # indirect doctest</code></td></tr></table>\n",
    "created_at": "2021-12-29T21:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534339",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069"><code>be4c928</code></a></td><td><code>Restore lost # indirect doctest</code></td></tr></table>




---

archive/issue_comments_534340.json:
```json
{
    "body": "Changed commit from **[`9899ee9`](https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f)** to **[`be4c928`](https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069)**",
    "created_at": "2021-12-29T21:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534340",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9899ee9`](https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f)** to **[`be4c928`](https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069)**



---

archive/issue_comments_534341.json:
```json
{
    "body": "Changed commit from **[`be4c928`](https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069)** to **[`daceeff`](https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335)**",
    "created_at": "2021-12-29T21:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534341",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`be4c928`](https://github.com/sagemath/sagetrac-mirror/commit/be4c928ca98fc55e96f922f3d2f26f875e713069)** to **[`daceeff`](https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335)**



---

archive/issue_comments_534342.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3000276a3ddd48e9641b0b34d86920f46a0fa991\"><code>3000276</code></a></td><td><code>src/doc/pt/tutorial/interfaces.rst: Fix indentation in doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335\"><code>daceeff</code></a></td><td><code>Restore lost # indirect doctest, # known bug</code></td></tr></table>\n",
    "created_at": "2021-12-29T21:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534342",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3000276a3ddd48e9641b0b34d86920f46a0fa991"><code>3000276</code></a></td><td><code>src/doc/pt/tutorial/interfaces.rst: Fix indentation in doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335"><code>daceeff</code></a></td><td><code>Restore lost # indirect doctest, # known bug</code></td></tr></table>




---

archive/issue_comments_534343.json:
```json
{
    "body": "Changed author from **Michael Orlitzky** to **Michael Orlitzky, Matthias Koeppe**",
    "created_at": "2021-12-29T21:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534343",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Michael Orlitzky** to **Michael Orlitzky, Matthias Koeppe**



---

archive/issue_comments_534344.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, ...**",
    "created_at": "2021-12-29T21:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534344",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe, ...**



---

archive/issue_events_457534.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T21:37:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457534"
}
```



---

archive/issue_events_457535.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-29T21:37:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457535"
}
```



---

archive/issue_comments_534345.json:
```json
{
    "body": "Changed commit from **[`daceeff`](https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335)** to **[`d3f4925`](https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b)**",
    "created_at": "2021-12-29T22:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534345",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`daceeff`](https://github.com/sagemath/sagetrac-mirror/commit/daceeff4a7a72346ef0c3b5b12d48357f0c3c335)** to **[`d3f4925`](https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b)**



---

archive/issue_comments_534346.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b\"><code>d3f4925</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Expand an example, add doctest output</code></td></tr></table>\n",
    "created_at": "2021-12-29T22:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534346",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b"><code>d3f4925</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Expand an example, add doctest output</code></td></tr></table>




---

archive/issue_comments_534347.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mkoeppe](#comment:10):\n> Replying to [@orlitzky](#comment:8):\n> > [...] in the middle of the logical line, which makes no sense at all to me [...]\n\n> \n> As you know, line breaks are significant in Python. The markup is not \"in the middle of a logical line\"; it is on the first line of the block.\n\nI'm not talking about blocks. I'm talking about how\n\n```\n(a + b) # long time\n```\n\nis correct, but\n\n```\n(a +\n b) # long time \n```\n\nsilently does the wrong thing because sage wants\n\n```\n(a + # long time \n b)\n```\n\nThe latter is bordering on the absurd to me.",
    "created_at": "2021-12-29T22:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534347",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mkoeppe](#comment:10):
> Replying to [@orlitzky](#comment:8):
> > [...] in the middle of the logical line, which makes no sense at all to me [...]

> 
> As you know, line breaks are significant in Python. The markup is not "in the middle of a logical line"; it is on the first line of the block.

I'm not talking about blocks. I'm talking about how

```
(a + b) # long time
```

is correct, but

```
(a +
 b) # long time 
```

silently does the wrong thing because sage wants

```
(a + # long time 
 b)
```

The latter is bordering on the absurd to me.



---

archive/issue_comments_534348.json:
```json
{
    "body": "Changed commit from **[`d3f4925`](https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b)** to **[`faf5b74`](https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da)**",
    "created_at": "2021-12-29T23:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534348",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d3f4925`](https://github.com/sagemath/sagetrac-mirror/commit/d3f492577948e3cdcf39b222c764ee372ee4b90b)** to **[`faf5b74`](https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da)**



---

archive/issue_comments_534349.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da\"><code>faf5b74</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Refer to python reference for 'physical line'</code></td></tr></table>\n",
    "created_at": "2021-12-29T23:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534349",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da"><code>faf5b74</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Refer to python reference for 'physical line'</code></td></tr></table>




---

archive/issue_comments_534350.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@orlitzky](#comment:22):\n> I'm talking about how\n> \n> ```\n> (a + b) # long time\n> ```\n> \n> is correct, but\n> \n> ```\n> (a +\n>  b) # long time \n> ```\n> \n> silently does the wrong thing because sage wants\n> \n> ```\n> (a + # long time \n>  b)\n> ```\n> \n> The latter is bordering on the absurd to me.\n\nThe above examples make immediate sense if you don't omit the prompts.\n\n```\nsage: (a + b) # long time\n```\n\nis correct, but\n\n```\nsage: (a +\n....:  b) # long time     # WRONG\n```\nsilently does the wrong thing because sage wants\n\n```\nsage: (a + # long time \n....: b)\n```\nby the very simple rule \"magic comments go on the first physical line\".\n(which has always been in force and is now documented.)",
    "created_at": "2021-12-29T23:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534350",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@orlitzky](#comment:22):
> I'm talking about how
> 
> ```
> (a + b) # long time
> ```
> 
> is correct, but
> 
> ```
> (a +
>  b) # long time 
> ```
> 
> silently does the wrong thing because sage wants
> 
> ```
> (a + # long time 
>  b)
> ```
> 
> The latter is bordering on the absurd to me.

The above examples make immediate sense if you don't omit the prompts.

```
sage: (a + b) # long time
```

is correct, but

```
sage: (a +
....:  b) # long time     # WRONG
```
silently does the wrong thing because sage wants

```
sage: (a + # long time 
....: b)
```
by the very simple rule "magic comments go on the first physical line".
(which has always been in force and is now documented.)



---

archive/issue_comments_534351.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@orlitzky](#comment:22):\n> line breaks are significant in Python. The markup is not \"in the middle of a logical line\"; it is on the first line of the block.\n> \n> I'm not talking about blocks. I'm talking about how\n\nInstead of \"blocks\" I should have said \"statements\".",
    "created_at": "2021-12-29T23:21:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534351",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@orlitzky](#comment:22):
> line breaks are significant in Python. The markup is not "in the middle of a logical line"; it is on the first line of the block.
> 
> I'm not talking about blocks. I'm talking about how

Instead of "blocks" I should have said "statements".



---

archive/issue_comments_534352.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n The same file contains other multiline doctests labeled long in the second line.\n \n In this ticket:\n-- We document that the label belongs on the first line.\n+- We document that the label belongs on the first physical line.\n - We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)\n - We fix all uses\n \n``````\n",
    "created_at": "2021-12-29T23:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534352",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 The same file contains other multiline doctests labeled long in the second line.
 
 In this ticket:
-- We document that the label belongs on the first line.
+- We document that the label belongs on the first physical line.
 - We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)
 - We fix all uses
 
``````




---

archive/issue_comments_534353.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n The same file contains other multiline doctests labeled long in the second line.\n \n In this ticket:\n-- We document that the label belongs on the first physical line.\n+- We document that the label belongs on the first line.\n - We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)\n - We fix all uses\n \n``````\n",
    "created_at": "2021-12-29T23:26:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534353",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 The same file contains other multiline doctests labeled long in the second line.
 
 In this ticket:
-- We document that the label belongs on the first physical line.
+- We document that the label belongs on the first line.
 - We add a test for this fairly common mistake to the linter (`./sage -tox -e relint`)
 - We fix all uses
 
``````




---

archive/issue_comments_534354.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n> The above examples make immediate sense if you don't omit the prompts.\n\n```\n(a +\n b)\n```\n\nis valid python, and consists of one logical line, per your own reference.\n\n> by the very simple rule \"magic comments go on the first physical line\". (which has always been in force and is now documented.) \n\nIt's very simple, but obviously wrong. Documenting something counter-intuitive when we could just fix it is only going to create more work down the line as developers repeatedly assume that these tags work in the way that makes sense. (Why would I even bother to look this up in the documentation?)",
    "created_at": "2021-12-29T23:26:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534354",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:27" align="right">comment:27</div>

> The above examples make immediate sense if you don't omit the prompts.

```
(a +
 b)
```

is valid python, and consists of one logical line, per your own reference.

> by the very simple rule "magic comments go on the first physical line". (which has always been in force and is now documented.) 

It's very simple, but obviously wrong. Documenting something counter-intuitive when we could just fix it is only going to create more work down the line as developers repeatedly assume that these tags work in the way that makes sense. (Why would I even bother to look this up in the documentation?)



---

archive/issue_comments_534355.json:
```json
{
    "body": "Changed commit from **[`faf5b74`](https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da)** to **[`974cb4d`](https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50)**",
    "created_at": "2021-12-29T23:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534355",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`faf5b74`](https://github.com/sagemath/sagetrac-mirror/commit/faf5b749b01eb6d086a0f0809d03e9eb3d5cb7da)** to **[`974cb4d`](https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50)**



---

archive/issue_comments_534356.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50\"><code>974cb4d</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Fix RST markup</code></td></tr></table>\n",
    "created_at": "2021-12-29T23:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534356",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50"><code>974cb4d</code></a></td><td><code>src/doc/en/developer/coding_basics.rst: Fix RST markup</code></td></tr></table>




---

archive/issue_comments_534357.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@mkoeppe](#comment:10):\n> The markup is not \"in the middle of a logical line\"\n\nI should have said: The concept of logical lines is irrelevant for the placement of magic doctest comments.",
    "created_at": "2021-12-29T23:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534357",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@mkoeppe](#comment:10):
> The markup is not "in the middle of a logical line"

I should have said: The concept of logical lines is irrelevant for the placement of magic doctest comments.



---

archive/issue_comments_534358.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWe've wound up with way more work than is necessary here. I think most people would agree that\n\n```\n(a +\n b) # long time\n```\n\nis where that tag should be, but that also\n\n```\nwhile x < y: # long time\n    do_foo()\n    do_bar()\n    if baz(): break\n```\n\nhas the tag the best place. We could just merge my one simple commit here, and then update the parser in #17404 to support both placements (or anywhere in the logical line). Then nobody needs to be beaten to death with the documentation. Everyone can do what makes intuitive sense, and things will just work. Moreover no tests need to be immediately changed.",
    "created_at": "2021-12-29T23:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534358",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:30" align="right">comment:30</div>

We've wound up with way more work than is necessary here. I think most people would agree that

```
(a +
 b) # long time
```

is where that tag should be, but that also

```
while x < y: # long time
    do_foo()
    do_bar()
    if baz(): break
```

has the tag the best place. We could just merge my one simple commit here, and then update the parser in #17404 to support both placements (or anywhere in the logical line). Then nobody needs to be beaten to death with the documentation. Everyone can do what makes intuitive sense, and things will just work. Moreover no tests need to be immediately changed.



---

archive/issue_comments_534359.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@orlitzky](#comment:27):\n> It's very simple, but obviously wrong. Documenting something counter-intuitive when we could just fix it \n\nThe doctest format is designed this way, it has been documented in `sage.doctest.parsing.parse_optional_tags`, and has been like this since at least 2012.\n\n> only going to create more work down the line as developers repeatedly assume that these tags work in the way that makes sense.\n\nWell, I have added a linter and documentation. Together they eliminate the previous potential for confusion.",
    "created_at": "2021-12-29T23:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534359",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@orlitzky](#comment:27):
> It's very simple, but obviously wrong. Documenting something counter-intuitive when we could just fix it 

The doctest format is designed this way, it has been documented in `sage.doctest.parsing.parse_optional_tags`, and has been like this since at least 2012.

> only going to create more work down the line as developers repeatedly assume that these tags work in the way that makes sense.

Well, I have added a linter and documentation. Together they eliminate the previous potential for confusion.



---

archive/issue_comments_534360.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@orlitzky](#comment:30):\n> update the parser in #17404 to support both placements (or anywhere in the logical line)\n\n-1 on this change",
    "created_at": "2021-12-29T23:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534360",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@orlitzky](#comment:30):
> update the parser in #17404 to support both placements (or anywhere in the logical line)

-1 on this change



---

archive/issue_comments_534361.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@orlitzky](#comment:30):\n> most people\n\ncitation needed",
    "created_at": "2021-12-29T23:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534361",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@orlitzky](#comment:30):
> most people

citation needed



---

archive/issue_comments_534362.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@mkoeppe](#comment:33):\n> Replying to [@orlitzky](#comment:30):\n> > most people\n\n> citation needed\n\nThis is some strong evidence: https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f",
    "created_at": "2021-12-29T23:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534362",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@mkoeppe](#comment:33):
> Replying to [@orlitzky](#comment:30):
> > most people

> citation needed

This is some strong evidence: https://github.com/sagemath/sagetrac-mirror/commit/9899ee9a2246ea74fbcc9ac63aa98650b78b007f



---

archive/issue_comments_534363.json:
```json
{
    "body": "Changed commit from **[`974cb4d`](https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50)** to **[`0d84d15`](https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8)**",
    "created_at": "2021-12-30T00:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534363",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`974cb4d`](https://github.com/sagemath/sagetrac-mirror/commit/974cb4deb6b097fc899bc61a9a092c18f9670c50)** to **[`0d84d15`](https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8)**



---

archive/issue_comments_534364.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8\"><code>0d84d15</code></a></td><td><code>src/sage/interfaces/kenzo.py: Fix up doctest markup</code></td></tr></table>\n",
    "created_at": "2021-12-30T00:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33091#issuecomment-534364",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d84d1504e9949e180d5f6fd61716410128aeba8"><code>0d84d15</code></a></td><td><code>src/sage/interfaces/kenzo.py: Fix up doctest markup</code></td></tr></table>




---

archive/issue_events_457536.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457536"
}
```



---

archive/issue_events_457537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457537"
}
```



---

archive/issue_events_457538.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457538"
}
```



---

archive/issue_events_457539.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33091",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33091#event-457539"
}
```
