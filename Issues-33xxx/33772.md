# Issue 33772: Update ipykernel to 6.13.0 - reintroduces psutil

archive/issues_033535.json:
```json
{
    "body": "ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656\n\n\nPrevious update of ipykernel was done in #33020.\n\n\nCC:  @orlitzky @williamstein @tornaria\n\nBranch: u/mkoeppe/update_ipykernel_to_6_13_0___reintroduces_psutil\n\nStatus: new\n\nCommit: 6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58\n\nIssue created by migration from https://trac.sagemath.org/ticket/33772\n\n",
    "created_at": "2022-04-29T18:21:33Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Update ipykernel to 6.13.0 - reintroduces psutil",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33772",
    "user": "https://github.com/mkoeppe"
}
```
ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656


Previous update of ipykernel was done in #33020.


CC:  @orlitzky @williamstein @tornaria

Branch: u/mkoeppe/update_ipykernel_to_6_13_0___reintroduces_psutil

Status: new

Commit: 6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58

Issue created by migration from https://trac.sagemath.org/ticket/33772





---

archive/issue_comments_673354.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/update_ipykernel_to_6_13_0___reintroduces_psutil\"",
    "created_at": "2022-04-29T18:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673354",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/update_ipykernel_to_6_13_0___reintroduces_psutil"



---

archive/issue_comments_673355.json:
```json
{
    "body": "Changing commit from \"\" to \"6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58\"",
    "created_at": "2022-04-29T18:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673355",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58"



---

archive/issue_comments_673356.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[6bc0e43](https://github.com/sagemath/sagetrac-mirror/commit/6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58)|`build/pkgs/ipykernel: Update to 6.13.0`|",
    "created_at": "2022-04-29T18:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673356",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[6bc0e43](https://github.com/sagemath/sagetrac-mirror/commit/6bc0e433ccaf0d05cf69c7aa10ff9ce5ba606d58)|`build/pkgs/ipykernel: Update to 6.13.0`|



---

archive/issue_comments_673357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33\n+ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656\n+\n+\n``````\n",
    "created_at": "2022-04-29T18:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673357",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33
+ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656
+
+
``````




---

archive/issue_comments_673358.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656\n \n \n+Previous update of ipykernel was done in #33020.\n+\n``````\n",
    "created_at": "2022-04-29T18:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673358",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656
 
 
+Previous update of ipykernel was done in #33020.
+
``````




---

archive/issue_comments_673359.json:
```json
{
    "body": "<a id='comment:4'></a>\nWell it depends on a python package named psutils because it mimics that functionality, but the python package in question do not require the C package psutil.\n\nhttps://github.com/giampaolo/psutil https://pypi.org/project/psutil/\n\nSo the plot twist is that we can really dump the old \"psutil\" package in favor of something designed to be more cross platform from the start.",
    "created_at": "2022-04-29T19:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673359",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Well it depends on a python package named psutils because it mimics that functionality, but the python package in question do not require the C package psutil.

https://github.com/giampaolo/psutil https://pypi.org/project/psutil/

So the plot twist is that we can really dump the old "psutil" package in favor of something designed to be more cross platform from the start.



---

archive/issue_comments_673360.json:
```json
{
    "body": "<a id='comment:5'></a>\nHm? No, it's the same Python package that was dumped in #32656 but is now needed again for ipykernel.",
    "created_at": "2022-04-29T19:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673360",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Hm? No, it's the same Python package that was dumped in #32656 but is now needed again for ipykernel.



---

archive/issue_comments_673361.json:
```json
{
    "body": "<a id='comment:6'></a>\nUpstream psutil still doesn't support Cygwin (as far as I can see)",
    "created_at": "2022-04-29T19:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673361",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Upstream psutil still doesn't support Cygwin (as far as I can see)



---

archive/issue_comments_673362.json:
```json
{
    "body": "<a id='comment:7'></a>\nMy mistake, I always thought it was another package that was being discussed. In fact I may have had a wrong dependency for a while :(",
    "created_at": "2022-04-29T19:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673362",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
My mistake, I always thought it was another package that was being discussed. In fact I may have had a wrong dependency for a while :(



---

archive/issue_comments_673363.json:
```json
{
    "body": "<a id='comment:8'></a>\nWell, I know when I'm beaten. It looks like ipykernel is making the same mistakes that sage did; (a) reckless introduction of dependencies to obtain (b) meaningless memory metrics.\n\nI don't have the energy to fight it, I'm going outside.",
    "created_at": "2022-04-29T19:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673363",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>
Well, I know when I'm beaten. It looks like ipykernel is making the same mistakes that sage did; (a) reckless introduction of dependencies to obtain (b) meaningless memory metrics.

I don't have the energy to fight it, I'm going outside.



---

archive/issue_comments_673364.json:
```json
{
    "body": "<a id='comment:9'></a>\nAfter some fresh air, we can try to get a simple patch into `psutil` that minimally supports Cygwin by just returning a meaningless positive constant.\n\n(The last attempt to get Cygwin support into `psutil` was trying to get a highly intrusive megapatch in.)",
    "created_at": "2022-04-29T20:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673364",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
After some fresh air, we can try to get a simple patch into `psutil` that minimally supports Cygwin by just returning a meaningless positive constant.

(The last attempt to get Cygwin support into `psutil` was trying to get a highly intrusive megapatch in.)



---

archive/issue_comments_673365.json:
```json
{
    "body": "<a id='comment:10'></a>\nI doubt `psutil` will take any Cygwin patches (Erik's attempts to get the patch considered deteriorated into a huge fight).\n\nWe'd need a drop-in replacement on Cygwin :-(",
    "created_at": "2022-04-30T08:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673365",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
I doubt `psutil` will take any Cygwin patches (Erik's attempts to get the patch considered deteriorated into a huge fight).

We'd need a drop-in replacement on Cygwin :-(



---

archive/issue_comments_673366.json:
```json
{
    "body": "<a id='comment:11'></a>\nIMHO less and less projects are willing to mess with Cygwin, (rightly) considering it to be a dying, obsolete, semi-broken, and dodgy.",
    "created_at": "2022-04-30T08:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673366",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
IMHO less and less projects are willing to mess with Cygwin, (rightly) considering it to be a dying, obsolete, semi-broken, and dodgy.



---

archive/issue_comments_673367.json:
```json
{
    "body": "<a id='comment:12'></a>\nI don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action\nAlso, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)",
    "created_at": "2022-06-26T18:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673367",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)



---

archive/issue_comments_673368.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mkoeppe](#comment%3A12):\n> I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action\n> Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)\n> \n\n\nbut the upstream (Jupyter & Co) don't even try to support Cygwin.",
    "created_at": "2022-06-27T06:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673368",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Replying to [mkoeppe](#comment%3A12):
> I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
> Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)
> 


but the upstream (Jupyter & Co) don't even try to support Cygwin.



---

archive/issue_comments_673369.json:
```json
{
    "body": "<a id='comment:14'></a>\nI think it's OK to make ipython and jupyter optional. After all, although I'm not 100% sure, it ought to be possible to use a native Windows Jupyter to connect to the cygwin Sage jupyter kernel.",
    "created_at": "2022-06-30T16:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673369",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
I think it's OK to make ipython and jupyter optional. After all, although I'm not 100% sure, it ought to be possible to use a native Windows Jupyter to connect to the cygwin Sage jupyter kernel.



---

archive/issue_comments_673370.json:
```json
{
    "body": "<a id='comment:15'></a>\n#30306 lists a number of tickets to try out and document such setups, but nobody has done the work",
    "created_at": "2022-06-30T17:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33772#issuecomment-673370",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
#30306 lists a number of tickets to try out and document such setups, but nobody has done the work



---

archive/issue_events_099860.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-11T04:07:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33772",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33772#event-99860"
}
```
