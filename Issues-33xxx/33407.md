# Issue 33407: sage -t --installed

archive/issues_033170.json:
```json
{
    "body": "This new option is similar to `--all` but \n- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions such as #32601.)\n- it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.\n\n```\n$ ./sage -tp --installed\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2022-02-23-21-52-47-11831639.\nUsing --optional=ccache,cryptominisat,debugpy,e_antic,homebrew,igraph,jupymake,lrslib,normaliz,pip,polytopes_db_4d,pycryptosat,pynormaliz,sage,sage_spkg\nFeatures to be detected: [...] \nDoctesting all installed modules of the Sage library.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 3522 files using 8 threads.\nsage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/groups/matrix_gps/heisenberg.py\n    [32 tests, 1.83 s]\nsage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/crystals/alcove_path.py\n    [293 tests, 4.16 s]\n...\n```\n\n(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n\nThis would also make sense for distribution packaging, which no longer would have to rely on the fallbacks `SAGE_SRC` -> `SAGE_LIB` and `SAGE_DOC_SRC -> SAGE_DOC`.\n\n\n\nPart of Meta-ticket #33037.\n\n\n**CC:**  @kiwifb @antonio-rojas @tobiasdiez\n\n**Branch/Commit:** [b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)\n\n**Reviewer:** Fran\u00e7ois Bissey, Antonio Rojas\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/33407\n\n",
    "closed_at": "2022-03-21T23:34:29Z",
    "created_at": "2022-02-23T18:52:04Z",
    "labels": [
        "component: doctest framework",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "title": "sage -t --installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/33407",
    "user": "https://github.com/mkoeppe"
}
```
This new option is similar to `--all` but 
- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions such as #32601.)
- it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.

```
$ ./sage -tp --installed
too many failed tests, not using stored timings
Running doctests with ID 2022-02-23-21-52-47-11831639.
Using --optional=ccache,cryptominisat,debugpy,e_antic,homebrew,igraph,jupymake,lrslib,normaliz,pip,polytopes_db_4d,pycryptosat,pynormaliz,sage,sage_spkg
Features to be detected: [...] 
Doctesting all installed modules of the Sage library.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 3522 files using 8 threads.
sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/groups/matrix_gps/heisenberg.py
    [32 tests, 1.83 s]
sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/crystals/alcove_path.py
    [293 tests, 4.16 s]
...
```

(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)

This would also make sense for distribution packaging, which no longer would have to rely on the fallbacks `SAGE_SRC` -> `SAGE_LIB` and `SAGE_DOC_SRC -> SAGE_DOC`.



Part of Meta-ticket #33037.


**CC:**  @kiwifb @antonio-rojas @tobiasdiez

**Branch/Commit:** [b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)

**Reviewer:** Fran√ßois Bissey, Antonio Rojas

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/33407





---

archive/issue_comments_542302.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n This new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.\n \n+(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n+\n+Part of Meta-ticket #33037.\n+\n``````\n",
    "created_at": "2022-02-23T18:56:19Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542302",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
 This new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.
 
+(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)
+
+Part of Meta-ticket #33037.
+
``````




---

archive/issue_events_299195.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-24T05:55:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "rename": {
        "from": "sage -t --all-installed",
        "to": "sage -t --installed"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299195"
}
```



---

archive/issue_comments_542303.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2022-02-24T05:55:43Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542303",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_299196.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-24T05:55:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299196"
}
```



---

archive/issue_comments_542304.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n-This new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.\n+This new option is similar to `--all` but it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This will be useful for testing modularized distributions.\n+\n+```\n+$ ./sage -tp --installed\n+too many failed tests, not using stored timings\n+Running doctests with ID 2022-02-23-21-52-47-11831639.\n+Using --optional=ccache,cryptominisat,debugpy,e_antic,homebrew,igraph,jupymake,lrslib,normaliz,pip,polytopes_db_4d,pycryptosat,pynormaliz,sage,sage_spkg\n+Features to be detected: [...] \n+Doctesting all installed modules of the Sage library.\n+Sorting sources by runtime so that slower doctests are run first....\n+Doctesting 3522 files using 8 threads.\n+sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/groups/matrix_gps/heisenberg.py\n+    [32 tests, 1.83 s]\n+sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/crystals/alcove_path.py\n+    [293 tests, 4.16 s]\n+...\n+```\n+\n \n (Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n \n``````\n",
    "created_at": "2022-02-24T05:55:43Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542304",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,21 @@
-This new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.
+This new option is similar to `--all` but it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This will be useful for testing modularized distributions.
+
+```
+$ ./sage -tp --installed
+too many failed tests, not using stored timings
+Running doctests with ID 2022-02-23-21-52-47-11831639.
+Using --optional=ccache,cryptominisat,debugpy,e_antic,homebrew,igraph,jupymake,lrslib,normaliz,pip,polytopes_db_4d,pycryptosat,pynormaliz,sage,sage_spkg
+Features to be detected: [...] 
+Doctesting all installed modules of the Sage library.
+Sorting sources by runtime so that slower doctests are run first....
+Doctesting 3522 files using 8 threads.
+sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/groups/matrix_gps/heisenberg.py
+    [32 tests, 1.83 s]
+sage -t --random-seed=334799075370772165291245032923424842623 local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/crystals/alcove_path.py
+    [293 tests, 4.16 s]
+...
+```
+
 
 (Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)
 
``````




---

archive/issue_comments_542305.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sage__t___all_installed](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__t___all_installed)",
    "created_at": "2022-02-24T05:56:27Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542305",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/sage__t___all_installed](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__t___all_installed)



---

archive/issue_comments_542306.json:
```json
{
    "body": "**Commit:** [de649beca7dee12c51d3d8838e9c406d763859e3](https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3)",
    "created_at": "2022-02-24T22:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542306",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [de649beca7dee12c51d3d8838e9c406d763859e3](https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3)



---

archive/issue_comments_542307.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,8 +16,11 @@\n ...\n ```\n \n+(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n \n-(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n+This would also make sense for distribution packaging, which no longer would have to rely on the fallback `SAGE_SRC` -> `SAGE_LIB`.\n+\n+\n \n Part of Meta-ticket #33037.\n \n``````\n",
    "created_at": "2022-02-24T22:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542307",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,8 +16,11 @@
 ...
 ```
 
+(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)
 
-(Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)
+This would also make sense for distribution packaging, which no longer would have to rely on the fallback `SAGE_SRC` -> `SAGE_LIB`.
+
+
 
 Part of Meta-ticket #33037.
 
``````




---

archive/issue_comments_542308.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3\">de649be</a></td><td><code>src/sage/doctest/control.py, src/bin/sage-runtests: Implement sage -t --installed</code></td></tr></table>\n",
    "created_at": "2022-02-24T22:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542308",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3">de649be</a></td><td><code>src/sage/doctest/control.py, src/bin/sage-runtests: Implement sage -t --installed</code></td></tr></table>




---

archive/issue_comments_542309.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think the move makes some sense especially in the context of the elimination of `SAGE_LIB` and potentially more variables as sage matures more in the future.\n\nThe only thing I am not sure is introducing a new option. Why not make it the default instead? What workflow would that prevent?",
    "created_at": "2022-02-24T22:47:21Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542309",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I think the move makes some sense especially in the context of the elimination of `SAGE_LIB` and potentially more variables as sage matures more in the future.

The only thing I am not sure is introducing a new option. Why not make it the default instead? What workflow would that prevent?



---

archive/issue_comments_542310.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [fbissey](#comment%3A5):\n> Why not make it the default instead? What workflow would that prevent?\n\n\nI think the default is valuable because doctests can be written / updated and immediately tested without having to build the Sage library.",
    "created_at": "2022-02-24T22:51:26Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542310",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [fbissey](#comment%3A5):
> Why not make it the default instead? What workflow would that prevent?


I think the default is valuable because doctests can be written / updated and immediately tested without having to build the Sage library.



---

archive/issue_comments_542311.json:
```json
{
    "body": "<a id='comment:7'></a>\nValid for pure python files but not `.pyx`, you need to build those before testing them. But on the numbers they probably are the minority.",
    "created_at": "2022-02-24T22:53:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542311",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Valid for pure python files but not `.pyx`, you need to build those before testing them. But on the numbers they probably are the minority.



---

archive/issue_comments_542312.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [fbissey](#comment%3A7):\n> Valid for pure python files but not `.pyx`, you need to build those before testing them. \n\n\nWhen you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.",
    "created_at": "2022-02-24T23:07:33Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542312",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [fbissey](#comment%3A7):
> Valid for pure python files but not `.pyx`, you need to build those before testing them. 


When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.



---

archive/issue_comments_542313.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mkoeppe](#comment%3A8):\n> Replying to [fbissey](#comment%3A7):\n> > Valid for pure python files but not `.pyx`, you need to build those before testing them. \n\n> \n> When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.\n\n\nMore to the point, it is a pain in the workflow to recompile in that case. But you should explicitly test a file or directory in that case. But let's go with a developer focused for now.\n\nWe may want to suggest not to use `--installed` and `--all` at the same time for distros as it will try to add a non-existent path once we remove the default `SAGE_SRC` -> `SAGE_LIB`. Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?",
    "created_at": "2022-02-24T23:19:09Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542313",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Replying to [mkoeppe](#comment%3A8):
> Replying to [fbissey](#comment%3A7):
> > Valid for pure python files but not `.pyx`, you need to build those before testing them. 

> 
> When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.


More to the point, it is a pain in the workflow to recompile in that case. But you should explicitly test a file or directory in that case. But let's go with a developer focused for now.

We may want to suggest not to use `--installed` and `--all` at the same time for distros as it will try to add a non-existent path once we remove the default `SAGE_SRC` -> `SAGE_LIB`. Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?



---

archive/issue_comments_542314.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [fbissey](#comment%3A9):\n> We may want to suggest not to use `--installed` and `--all` at the same time\n\n\nYes, they are mutually exclusive options",
    "created_at": "2022-02-24T23:42:45Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542314",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [fbissey](#comment%3A9):
> We may want to suggest not to use `--installed` and `--all` at the same time


Yes, they are mutually exclusive options



---

archive/issue_comments_542315.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A10):\n> Replying to [fbissey](#comment%3A9):\n> > We may want to suggest not to use `--installed` and `--all` at the same time\n\n> \n> Yes, they are mutually exclusive options\n\n\nI didn't pay enough attention to that part of the code. I see it now.",
    "created_at": "2022-02-24T23:44:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542315",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A10):
> Replying to [fbissey](#comment%3A9):
> > We may want to suggest not to use `--installed` and `--all` at the same time

> 
> Yes, they are mutually exclusive options


I didn't pay enough attention to that part of the code. I see it now.



---

archive/issue_comments_542316.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269\">5dd2dd2</a></td><td><code>src/sage/doctest/control.py: In sage -t --installed, also handle sage_setup, sage_docbuild</code></td></tr></table>\n",
    "created_at": "2022-02-24T23:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269">5dd2dd2</a></td><td><code>src/sage/doctest/control.py: In sage -t --installed, also handle sage_setup, sage_docbuild</code></td></tr></table>




---

archive/issue_comments_542317.json:
```json
{
    "body": "**Changing commit** from \"[de649beca7dee12c51d3d8838e9c406d763859e3](https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3)\" to \"[5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269](https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269)\".",
    "created_at": "2022-02-24T23:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[de649beca7dee12c51d3d8838e9c406d763859e3](https://github.com/sagemath/sagetrac-mirror/commit/de649beca7dee12c51d3d8838e9c406d763859e3)" to "[5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269](https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269)".



---

archive/issue_comments_542318.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [fbissey](#comment%3A9):\n> Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?\n\n\nI have added `sage_setup`, `sage_docbuild` but I'm not sure about `SAGE_DOC_SRC` because Sage does not install it; do you install it in the Gentoo package?",
    "created_at": "2022-02-24T23:54:00Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542318",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Replying to [fbissey](#comment%3A9):
> Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?


I have added `sage_setup`, `sage_docbuild` but I'm not sure about `SAGE_DOC_SRC` because Sage does not install it; do you install it in the Gentoo package?



---

archive/issue_comments_542319.json:
```json
{
    "body": "<a id='comment:14'></a>\nNo, I don't install SAGE_DOC_SRC. But as I said it points to the installed `SAGE_DOC` which effectively tests nothing. Because the point would be to test the `.rst` files, but all those are installed as `.rst.txt` for some reason. It would make sense to me to add `SAGE_DOC` for `--installed` if we could test those.",
    "created_at": "2022-02-24T23:57:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542319",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
No, I don't install SAGE_DOC_SRC. But as I said it points to the installed `SAGE_DOC` which effectively tests nothing. Because the point would be to test the `.rst` files, but all those are installed as `.rst.txt` for some reason. It would make sense to me to add `SAGE_DOC` for `--installed` if we could test those.



---

archive/issue_comments_542320.json:
```json
{
    "body": "<a id='comment:15'></a>\nAh, I see, in the `_sources` subdirectories",
    "created_at": "2022-02-25T00:07:37Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542320",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Ah, I see, in the `_sources` subdirectories



---

archive/issue_comments_542321.json:
```json
{
    "body": "<a id='comment:16'></a>\nI looked at these files but they do not seem useful",
    "created_at": "2022-02-25T00:19:46Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542321",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I looked at these files but they do not seem useful



---

archive/issue_comments_542322.json:
```json
{
    "body": "<a id='comment:17'></a>\nWhat else do you test in `SAGE_DOC_SRC`? `conf.py` files? Those do not have doctests either. If there is no value in testing a `.rst.txt` in `SAGE_DOC`, I am not sure there is value in testing the corresponding `.rst` in `SAGE_DOC_SRC`.",
    "created_at": "2022-02-25T00:24:55Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542322",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
What else do you test in `SAGE_DOC_SRC`? `conf.py` files? Those do not have doctests either. If there is no value in testing a `.rst.txt` in `SAGE_DOC`, I am not sure there is value in testing the corresponding `.rst` in `SAGE_DOC_SRC`.



---

archive/issue_comments_542323.json:
```json
{
    "body": "<a id='comment:18'></a>\nNone of these files have `TESTS` blocks but a few have stuff that does get tested\n\n```\n$ sage -t --long src/doc/en/thematic_tutorials/sandpile.rst\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2022-02-25-13-31-30-ea5e5e11.\nUsing --optional=pip,sage\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,pdftocairo,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\nDoctesting 1 file.\nsage -t --long --random-seed=249406959745805344364707629509298952414 src/doc/en/thematic_tutorials/sandpile.rst\n    [705 tests, 12.50 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```",
    "created_at": "2022-02-25T00:36:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542323",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
None of these files have `TESTS` blocks but a few have stuff that does get tested

```
$ sage -t --long src/doc/en/thematic_tutorials/sandpile.rst
too many failed tests, not using stored timings
Running doctests with ID 2022-02-25-13-31-30-ea5e5e11.
Using --optional=pip,sage
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,pdftocairo,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Doctesting 1 file.
sage -t --long --random-seed=249406959745805344364707629509298952414 src/doc/en/thematic_tutorials/sandpile.rst
    [705 tests, 12.50 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

archive/issue_comments_542324.json:
```json
{
    "body": "<a id='comment:19'></a>\nYes, my mistake",
    "created_at": "2022-02-25T00:38:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542324",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Yes, my mistake



---

archive/issue_comments_542325.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf\">07f37d0</a></td><td><code>src/sage/doctest/{control,sources}.py: Handle .rst.txt files like .rst files</code></td></tr></table>\n",
    "created_at": "2022-02-25T00:41:10Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf">07f37d0</a></td><td><code>src/sage/doctest/{control,sources}.py: Handle .rst.txt files like .rst files</code></td></tr></table>




---

archive/issue_comments_542326.json:
```json
{
    "body": "**Changing commit** from \"[5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269](https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269)\" to \"[07f37d099a77db4f99b5d723ec487248eda5ffdf](https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf)\".",
    "created_at": "2022-02-25T00:41:10Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269](https://github.com/sagemath/sagetrac-mirror/commit/5dd2dd24db56ed7e05e0be39e4a1fdde8ad7a269)" to "[07f37d099a77db4f99b5d723ec487248eda5ffdf](https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf)".



---

archive/issue_comments_542327.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff\">e837614</a></td><td><code>src/sage/doctest/control.py: In sage -t --installed, also test SAGE_DOC</code></td></tr></table>\n",
    "created_at": "2022-02-25T00:44:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff">e837614</a></td><td><code>src/sage/doctest/control.py: In sage -t --installed, also test SAGE_DOC</code></td></tr></table>




---

archive/issue_comments_542328.json:
```json
{
    "body": "**Changing commit** from \"[07f37d099a77db4f99b5d723ec487248eda5ffdf](https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf)\" to \"[e8376142493b17eccb95a8e850e26a6320e7fdff](https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff)\".",
    "created_at": "2022-02-25T00:44:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[07f37d099a77db4f99b5d723ec487248eda5ffdf](https://github.com/sagemath/sagetrac-mirror/commit/07f37d099a77db4f99b5d723ec487248eda5ffdf)" to "[e8376142493b17eccb95a8e850e26a6320e7fdff](https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff)".



---

archive/issue_comments_542329.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-This new option is similar to `--all` but it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This will be useful for testing modularized distributions.\n+This new option is similar to `--all` but \n+- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions.)\n+- it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.\n \n ```\n $ ./sage -tp --installed\n``````\n",
    "created_at": "2022-02-25T00:45:55Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542329",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-This new option is similar to `--all` but it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This will be useful for testing modularized distributions.
+This new option is similar to `--all` but 
+- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions.)
+- it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.
 
 ```
 $ ./sage -tp --installed
``````




---

archive/issue_comments_542330.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -20,7 +20,7 @@\n \n (Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)\n \n-This would also make sense for distribution packaging, which no longer would have to rely on the fallback `SAGE_SRC` -> `SAGE_LIB`.\n+This would also make sense for distribution packaging, which no longer would have to rely on the fallbacks `SAGE_SRC` -> `SAGE_LIB` and `SAGE_DOC_SRC -> SAGE_DOC`.\n \n \n \n``````\n",
    "created_at": "2022-02-25T00:48:38Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542330",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -20,7 +20,7 @@
 
 (Actually, because portions of namespace packages can be installed in separate locations, the variable `sage.env.SAGE_LIB` is no longer meaningful. Instead, we make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.)
 
-This would also make sense for distribution packaging, which no longer would have to rely on the fallback `SAGE_SRC` -> `SAGE_LIB`.
+This would also make sense for distribution packaging, which no longer would have to rely on the fallbacks `SAGE_SRC` -> `SAGE_LIB` and `SAGE_DOC_SRC -> SAGE_DOC`.
 
 
 
``````




---

archive/issue_comments_542331.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4\">f1c4ee7</a></td><td><code>src/sage/doctest/sources.py: Update doctest output</code></td></tr></table>\n",
    "created_at": "2022-02-25T00:52:34Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4">f1c4ee7</a></td><td><code>src/sage/doctest/sources.py: Update doctest output</code></td></tr></table>




---

archive/issue_comments_542332.json:
```json
{
    "body": "**Changing commit** from \"[e8376142493b17eccb95a8e850e26a6320e7fdff](https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff)\" to \"[f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4](https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4)\".",
    "created_at": "2022-02-25T00:52:34Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e8376142493b17eccb95a8e850e26a6320e7fdff](https://github.com/sagemath/sagetrac-mirror/commit/e8376142493b17eccb95a8e850e26a6320e7fdff)" to "[f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4](https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4)".



---

archive/issue_comments_542333.json:
```json
{
    "body": "<a id='comment:25'></a>\nShould I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?",
    "created_at": "2022-02-25T01:10:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542333",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?



---

archive/issue_comments_542334.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2022-02-25T01:15:51Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542334",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Fran√ßois Bissey



---

archive/issue_comments_542335.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mkoeppe](#comment%3A25):\n> Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?\n\n\nLet's leave it for another clean up ticket. I am already quite happy that we fixed the `.rst.txt` thing in this one. I'll want a clean slate in my brain to think properly of all the consequences when we get to it.\n\nIt was good work on this one, thank you for all the commits :)\n\nIf you have nothing to add, it is a positive review from me.",
    "created_at": "2022-02-25T01:15:51Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542335",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>
Replying to [mkoeppe](#comment%3A25):
> Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?


Let's leave it for another clean up ticket. I am already quite happy that we fixed the `.rst.txt` thing in this one. I'll want a clean slate in my brain to think properly of all the consequences when we get to it.

It was good work on this one, thank you for all the commits :)

If you have nothing to add, it is a positive review from me.



---

archive/issue_comments_542336.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710\">1627cc9</a></td><td><code>src/sage/doctest/control.py: Fall back from --all to --installed explicitly</code></td></tr></table>\n",
    "created_at": "2022-02-25T01:20:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710">1627cc9</a></td><td><code>src/sage/doctest/control.py: Fall back from --all to --installed explicitly</code></td></tr></table>




---

archive/issue_comments_542337.json:
```json
{
    "body": "**Changing commit** from \"[f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4](https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4)\" to \"[1627cc98a1dcb42ca2416b2b958198fabb70f710](https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710)\".",
    "created_at": "2022-02-25T01:20:18Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4](https://github.com/sagemath/sagetrac-mirror/commit/f1c4ee73ddd1d555b98bf640b0866fa4cfd3e3f4)" to "[1627cc98a1dcb42ca2416b2b958198fabb70f710](https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710)".



---

archive/issue_comments_542338.json:
```json
{
    "body": "<a id='comment:28'></a>\nHere's another change, just stopping short of actually removing the fallbacks",
    "created_at": "2022-02-25T01:21:20Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542338",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Here's another change, just stopping short of actually removing the fallbacks



---

archive/issue_comments_542339.json:
```json
{
    "body": "<a id='comment:29'></a>\nBut we can leave this for another ticket if you prefer.",
    "created_at": "2022-02-25T01:21:58Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542339",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
But we can leave this for another ticket if you prefer.



---

archive/issue_comments_542340.json:
```json
{
    "body": "<a id='comment:30'></a>\nWell, I'll be going for the school run in 20-25 minutes, I'll try to wrap my head around what this commit is about before going.",
    "created_at": "2022-02-25T01:23:59Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542340",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Well, I'll be going for the school run in 20-25 minutes, I'll try to wrap my head around what this commit is about before going.



---

archive/issue_comments_542341.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2\">e80c135</a></td><td><code>src/sage/doctest/control.py: Use elif because options are exclusive</code></td></tr></table>\n",
    "created_at": "2022-02-25T01:25:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2">e80c135</a></td><td><code>src/sage/doctest/control.py: Use elif because options are exclusive</code></td></tr></table>




---

archive/issue_comments_542342.json:
```json
{
    "body": "**Changing commit** from \"[1627cc98a1dcb42ca2416b2b958198fabb70f710](https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710)\" to \"[e80c13562299dd2eea02d679f9a4e9ea19e028c2](https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2)\".",
    "created_at": "2022-02-25T01:25:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1627cc98a1dcb42ca2416b2b958198fabb70f710](https://github.com/sagemath/sagetrac-mirror/commit/1627cc98a1dcb42ca2416b2b958198fabb70f710)" to "[e80c13562299dd2eea02d679f9a4e9ea19e028c2](https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2)".



---

archive/issue_comments_542343.json:
```json
{
    "body": "<a id='comment:32'></a>\nGood spotting that last commit. The previous commit is neat, it almost negates the need for having the `--installed` option. I can continue doing `--all` on distro and it will behave as `--installed`. It is only distinctive on vanilla sage where it does something different.\n\nIt feels like I won my first point about making it the default without you really conceding anything. Really well done. The code reorganisation around it is also quite good. It is all more clear about what each part does.",
    "created_at": "2022-02-25T01:40:41Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542343",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
Good spotting that last commit. The previous commit is neat, it almost negates the need for having the `--installed` option. I can continue doing `--all` on distro and it will behave as `--installed`. It is only distinctive on vanilla sage where it does something different.

It feels like I won my first point about making it the default without you really conceding anything. Really well done. The code reorganisation around it is also quite good. It is all more clear about what each part does.



---

archive/issue_comments_542344.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [fbissey](#comment%3A32):\n> The previous commit is neat, it almost negates the need for having the `--installed` option. \n\n\nYes, for the Sage-on-distro use case, but not for my use case (doctesting a modularized subset distribution like **sagemath-polyhedra**).",
    "created_at": "2022-02-25T04:34:41Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542344",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [fbissey](#comment%3A32):
> The previous commit is neat, it almost negates the need for having the `--installed` option. 


Yes, for the Sage-on-distro use case, but not for my use case (doctesting a modularized subset distribution like **sagemath-polyhedra**).



---

archive/issue_comments_542345.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n This new option is similar to `--all` but \n-- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions.)\n+- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions such as #32601.)\n - it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.\n \n ```\n``````\n",
    "created_at": "2022-02-27T21:06:45Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542345",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 This new option is similar to `--all` but 
-- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions.)
+- it tests all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. (This will be useful for testing modularized distributions such as #32601.)
 - it tests the installed Sage documentation (specifically, the `.rst.txt` files installed in `html/**/_sources`) instead of `SAGE_DOC_SRC`.
 
 ```
``````




---

archive/issue_events_299197.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-27T21:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299197"
}
```



---

archive/issue_events_299198.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-27T21:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299198"
}
```



---

archive/issue_comments_542346.json:
```json
{
    "body": "<a id='comment:36'></a>\nThank you!",
    "created_at": "2022-02-28T02:07:38Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542346",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Thank you!



---

archive/issue_comments_542347.json:
```json
{
    "body": "<a id='comment:37'></a>\nTest fail",
    "created_at": "2022-02-28T22:27:19Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542347",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>
Test fail



---

archive/issue_events_299199.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-28T22:27:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299199"
}
```



---

archive/issue_events_299200.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-28T22:27:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299200"
}
```



---

archive/issue_comments_542348.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158\">b4d2b8e</a></td><td><code>src/sage/doctest/control.py: Update doctest output</code></td></tr></table>\n",
    "created_at": "2022-02-28T22:57:09Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158">b4d2b8e</a></td><td><code>src/sage/doctest/control.py: Update doctest output</code></td></tr></table>




---

archive/issue_comments_542349.json:
```json
{
    "body": "**Changing commit** from \"[e80c13562299dd2eea02d679f9a4e9ea19e028c2](https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2)\" to \"[b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)\".",
    "created_at": "2022-02-28T22:57:09Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e80c13562299dd2eea02d679f9a4e9ea19e028c2](https://github.com/sagemath/sagetrac-mirror/commit/e80c13562299dd2eea02d679f9a4e9ea19e028c2)" to "[b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)".



---

archive/issue_events_299201.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-28T22:57:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299201"
}
```



---

archive/issue_events_299202.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-28T22:57:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299202"
}
```



---

archive/issue_comments_542350.json:
```json
{
    "body": "<a id='comment:40'></a>\nApologies, that was very sloppy of me.",
    "created_at": "2022-02-28T23:03:52Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542350",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>
Apologies, that was very sloppy of me.



---

archive/issue_comments_542351.json:
```json
{
    "body": "<a id='comment:41'></a>\nPatchbots have been on strike, hard to see failures.",
    "created_at": "2022-03-01T01:04:17Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542351",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Patchbots have been on strike, hard to see failures.



---

archive/issue_comments_542352.json:
```json
{
    "body": "<a id='comment:42'></a>\nI have now run a full doctest on sage-on-gentoo with `--installed`. Because we have not acted yet on `SAGE_SRC`/`SAGE_LIB`/`SAGE_DOC_SRC` checking with `--all` was just business as usual. But nothing else came up (apart from the current lot of failures in #33141 and new giac issues that I have to inspect more closely).",
    "created_at": "2022-03-01T01:10:50Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542352",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
I have now run a full doctest on sage-on-gentoo with `--installed`. Because we have not acted yet on `SAGE_SRC`/`SAGE_LIB`/`SAGE_DOC_SRC` checking with `--all` was just business as usual. But nothing else came up (apart from the current lot of failures in #33141 and new giac issues that I have to inspect more closely).



---

archive/issue_comments_542353.json:
```json
{
    "body": "<a id='comment:43'></a>\nWhile it is unrelated to eliminating `SAGE_*` variables, there is something related to testing an installed sage that we need to address in a follow up. pytest doesn't work if you cannot write in the \"rootdir\" of what is tested.\n\nThere are two issues with that. First it may leave unwanted files all over the place. Second it fails miserably if you try to test something that is read-only.\n\n```\n============================= test session starts ==============================\nplatform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0\nrootdir: /usr\nplugins: hypothesis-6.38.0\ncollected 0 items\n\n=============================== warnings summary ===============================\n../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433\n  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids\n    config.cache.set(\"cache/nodeids\", sorted(self.cached_nodeids))\n\n../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52\n  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise\n    session.config.cache.set(STEPWISE_CACHE_DIR, [])\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n```\n\n\nThere seem to be some option to change where the cache is created (`-o cache_dir=$somelocation`) but I have so far failed to integrate it successfully in `sage-runtest` when `pytest` is called.",
    "created_at": "2022-03-17T09:07:02Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542353",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
While it is unrelated to eliminating `SAGE_*` variables, there is something related to testing an installed sage that we need to address in a follow up. pytest doesn't work if you cannot write in the "rootdir" of what is tested.

There are two issues with that. First it may leave unwanted files all over the place. Second it fails miserably if you try to test something that is read-only.

```
============================= test session starts ==============================
platform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0
rootdir: /usr
plugins: hypothesis-6.38.0
collected 0 items

=============================== warnings summary ===============================
../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433
  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids
    config.cache.set("cache/nodeids", sorted(self.cached_nodeids))

../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52
  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise
    session.config.cache.set(STEPWISE_CACHE_DIR, [])

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
```


There seem to be some option to change where the cache is created (`-o cache_dir=$somelocation`) but I have so far failed to integrate it successfully in `sage-runtest` when `pytest` is called.



---

archive/issue_comments_542354.json:
```json
{
    "body": "<a id='comment:45'></a>\nFollow up for `pytest` at #33521.",
    "created_at": "2022-03-17T19:47:42Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542354",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
Follow up for `pytest` at #33521.



---

archive/issue_comments_542355.json:
```json
{
    "body": "**Changing reviewer** from \"Fran\u00e7ois Bissey\" to \"Fran\u00e7ois Bissey, Antonio Rojas\".",
    "created_at": "2022-03-17T22:45:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542355",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing reviewer** from "Fran√ßois Bissey" to "Fran√ßois Bissey, Antonio Rojas".



---

archive/issue_events_299203.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-03-17T22:45:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299203"
}
```



---

archive/issue_events_299204.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-03-17T22:45:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299204"
}
```



---

archive/issue_comments_542356.json:
```json
{
    "body": "<a id='comment:46'></a>\nWorking fine here.",
    "created_at": "2022-03-17T22:45:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542356",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:46'></a>
Working fine here.



---

archive/issue_comments_542357.json:
```json
{
    "body": "<a id='comment:47'></a>\nThanks all for the review!",
    "created_at": "2022-03-17T22:46:26Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542357",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Thanks all for the review!



---

archive/issue_comments_542358.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage__t___all_installed](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__t___all_installed)\" to \"[b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)\".",
    "created_at": "2022-03-21T23:34:29Z",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33407#issuecomment-542358",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/sage__t___all_installed](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__t___all_installed)" to "[b4d2b8ebb98eff0e5931ffc19fa15a5adb463158](https://github.com/sagemath/sagetrac-mirror/commit/b4d2b8ebb98eff0e5931ffc19fa15a5adb463158)".



---

archive/issue_events_299205.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-21T23:34:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299205"
}
```



---

archive/issue_events_299206.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a6364982871cc63abd0f4e69254fa9561eb8b9cf",
    "created_at": "2022-03-21T23:34:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33407",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33407#event-299206"
}
```
