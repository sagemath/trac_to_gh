# Issue 33058: doctest in generic_graph.py can fail due to rounding error

archive/issues_032821.json:
```json
{
    "body": "`sage -t --long --random-seed=285615421785840867793774705868421856551 src/sage/graphs/generic_graph.py` reports the following doctest failure:\n\n```\nFile \"src/sage/graphs/generic_graph.py\", line 7945, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    for i in range(20):\n        g = Graph()\n        g.allow_multiple_edges(False)\n        for u, v in graphs.RandomGNP(n,.2).edges(labels=False, sort=False):\n             g.add_edge(u, v, round(random(), 5))\n        for u, v in graphs.CycleGraph(n).edges(labels=False, sort=False):\n             if not g.has_edge(u, v):\n                 g.add_edge(u, v, round(random(),5))\n        v1 = g.traveling_salesman_problem(constraint_generation=False, use_edge_labels=True)\n        v2 = g.traveling_salesman_problem(use_edge_labels=True)\n        c1 = sum(v1.edge_labels())\n        c2 = sum(v2.edge_labels())\n        if c1 != c2:\n            print(\"Error !\", c1, c2)\n            break\nExpected nothing\nGot:\n    Error ! 6.59867 6.5986699999999985\n```\nThis seems to clearly be a rounding error. Should tolerance be added to the doctest, or is this a fundamental problem?\n\nThe problem was discovered by a patchbot testing ticket #30999 (but I confirmed with 9.5b8 on MacOS 11.5.2 and `CoCalc` Ubuntu 20.04). \n\nCC:  @kliem\n\nBranch/Commit: 6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee\n\nReviewer: Jonathan Kliem\n\nAuthor: Michael Orlitzky\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33058\n\n",
    "closed_at": "2022-01-01T00:23:18Z",
    "created_at": "2021-12-21T06:31:58Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "doctest in generic_graph.py can fail due to rounding error",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33058",
    "user": "https://github.com/DaveWitteMorris"
}
```
`sage -t --long --random-seed=285615421785840867793774705868421856551 src/sage/graphs/generic_graph.py` reports the following doctest failure:

```
File "src/sage/graphs/generic_graph.py", line 7945, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    for i in range(20):
        g = Graph()
        g.allow_multiple_edges(False)
        for u, v in graphs.RandomGNP(n,.2).edges(labels=False, sort=False):
             g.add_edge(u, v, round(random(), 5))
        for u, v in graphs.CycleGraph(n).edges(labels=False, sort=False):
             if not g.has_edge(u, v):
                 g.add_edge(u, v, round(random(),5))
        v1 = g.traveling_salesman_problem(constraint_generation=False, use_edge_labels=True)
        v2 = g.traveling_salesman_problem(use_edge_labels=True)
        c1 = sum(v1.edge_labels())
        c2 = sum(v2.edge_labels())
        if c1 != c2:
            print("Error !", c1, c2)
            break
Expected nothing
Got:
    Error ! 6.59867 6.5986699999999985
```
This seems to clearly be a rounding error. Should tolerance be added to the doctest, or is this a fundamental problem?

The problem was discovered by a patchbot testing ticket #30999 (but I confirmed with 9.5b8 on MacOS 11.5.2 and `CoCalc` Ubuntu 20.04). 

CC:  @kliem

Branch/Commit: 6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee

Reviewer: Jonathan Kliem

Author: Michael Orlitzky

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33058





---

archive/issue_comments_650850.json:
```json
{
    "body": "<a id='comment:1'></a>\n`round(random(), 5)` is returning an element of `RDF`, so this should either (a) have a tolerance associated with it, or (b) be using an exact ring.\n\nMoreover, this doctest shouldn't be repeating the same test 20 times... it looks like there are four other tests in this file doing the same thing.",
    "created_at": "2021-12-21T17:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650850",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
`round(random(), 5)` is returning an element of `RDF`, so this should either (a) have a tolerance associated with it, or (b) be using an exact ring.

Moreover, this doctest shouldn't be repeating the same test 20 times... it looks like there are four other tests in this file doing the same thing.



---

archive/issue_comments_650851.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650851",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_650852.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650852",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_650853.json:
```json
{
    "body": "Changing commit from \"\" to \"69b0cbe811fe63bcb121f74a99417616977a3bdb\"",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650853",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "" to "69b0cbe811fe63bcb121f74a99417616977a3bdb"



---

archive/issue_comments_650854.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mjo/ticket/33058\"",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650854",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "" to "u/mjo/ticket/33058"



---

archive/issue_comments_650855.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[b53fdd9](https://github.com/sagemath/sagetrac-mirror/commit/b53fdd9b8016ce3c1e8c8496d113213f8fcb71ef)|`Trac #33058: don't repeat random tests in sage.graphs.generic_graph.`|\n|[f22ff03](https://github.com/sagemath/sagetrac-mirror/commit/f22ff03b982ab2dbbaf4103cec3537ad66340bd8)|`Trac #33058: use integer edge labels in TSP tests.`|\n|[69b0cbe](https://github.com/sagemath/sagetrac-mirror/commit/69b0cbe811fe63bcb121f74a99417616977a3bdb)|`Trac #33058: remove a set_random_seed(0).`|",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650855",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[b53fdd9](https://github.com/sagemath/sagetrac-mirror/commit/b53fdd9b8016ce3c1e8c8496d113213f8fcb71ef)|`Trac #33058: don't repeat random tests in sage.graphs.generic_graph.`|
|[f22ff03](https://github.com/sagemath/sagetrac-mirror/commit/f22ff03b982ab2dbbaf4103cec3537ad66340bd8)|`Trac #33058: use integer edge labels in TSP tests.`|
|[69b0cbe](https://github.com/sagemath/sagetrac-mirror/commit/69b0cbe811fe63bcb121f74a99417616977a3bdb)|`Trac #33058: remove a set_random_seed(0).`|



---

archive/issue_comments_650856.json:
```json
{
    "body": "<a id='comment:3'></a>\nTypo: `on a random graphs`\n\nAlso the original test was basically on integers in `range(1, 100000)`. Does this make a difference?",
    "created_at": "2021-12-22T07:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650856",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Typo: `on a random graphs`

Also the original test was basically on integers in `range(1, 100000)`. Does this make a difference?



---

archive/issue_comments_650857.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[fa8456e](https://github.com/sagemath/sagetrac-mirror/commit/fa8456e2676f29ca57adfddefc6902420c6d8d24)|`Trac #33058: fix a typo and increase random integer bounds.`|",
    "created_at": "2021-12-22T13:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[fa8456e](https://github.com/sagemath/sagetrac-mirror/commit/fa8456e2676f29ca57adfddefc6902420c6d8d24)|`Trac #33058: fix a typo and increase random integer bounds.`|



---

archive/issue_comments_650858.json:
```json
{
    "body": "Changing commit from \"69b0cbe811fe63bcb121f74a99417616977a3bdb\" to \"fa8456e2676f29ca57adfddefc6902420c6d8d24\"",
    "created_at": "2021-12-22T13:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69b0cbe811fe63bcb121f74a99417616977a3bdb" to "fa8456e2676f29ca57adfddefc6902420c6d8d24"



---

archive/issue_comments_650859.json:
```json
{
    "body": "<a id='comment:5'></a>\nSorry, there is actually one more typo here:\n\n```\n+        Let us compute longest paths on a random graph with random\n```\n\nLooks to me, like we compute only one longest path on a random graph.\n\nOtherwise looks good to me.",
    "created_at": "2021-12-22T14:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650859",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
Sorry, there is actually one more typo here:

```
+        Let us compute longest paths on a random graph with random
```

Looks to me, like we compute only one longest path on a random graph.

Otherwise looks good to me.



---

archive/issue_comments_650860.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2021-12-22T14:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650860",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_comments_650861.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[6a6851c](https://github.com/sagemath/sagetrac-mirror/commit/6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee)|`Trac #33058: fix another typo in sage.graphs.generic_graph.`|",
    "created_at": "2021-12-22T15:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[6a6851c](https://github.com/sagemath/sagetrac-mirror/commit/6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee)|`Trac #33058: fix another typo in sage.graphs.generic_graph.`|



---

archive/issue_comments_650862.json:
```json
{
    "body": "Changing commit from \"fa8456e2676f29ca57adfddefc6902420c6d8d24\" to \"6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee\"",
    "created_at": "2021-12-22T15:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fa8456e2676f29ca57adfddefc6902420c6d8d24" to "6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee"



---

archive/issue_comments_650863.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM.",
    "created_at": "2021-12-22T17:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650863",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
LGTM.



---

archive/issue_comments_650864.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-22T17:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650864",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_650865.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/33058\" to \"6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee\"",
    "created_at": "2022-01-01T00:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650865",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mjo/ticket/33058" to "6a6851c048ff5a812e29f2aa89b8bcc6a937b7ee"



---

archive/issue_comments_650866.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-01T00:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33058#issuecomment-650866",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_106174.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33058",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33058#event-106174"
}
```
