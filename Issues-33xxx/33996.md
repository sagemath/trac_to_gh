# Issue 33996: ascii_art fail in jupyter notebook

archive/issues_033759.json:
```json
{
    "body": "When running sage in Jupyter notebook, \n\n```\nsage: ascii_art(list(Partitions(5)))\n<repr(<sage.typeset.ascii_art.AsciiArt at 0x7f8f358aa250>) failed: OSError: [Errno 25] Inappropriate ioctl for device>\n```\n\nThis is because the `_terminal_width()` method does not work with Jupiter. \n\nBranch/Commit: 5aa8cd57c9de0a5ecbed437aa225a6eb15566749\n\nReviewer: Dima Pasechnik\n\nAuthor: Kwankyu Lee\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33996\n\n",
    "closed_at": "2022-06-28T22:12:18Z",
    "created_at": "2022-06-15T00:29:24Z",
    "labels": [
        "component: user interface",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "ascii_art fail in jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33996",
    "user": "https://github.com/kwankyu"
}
```
When running sage in Jupyter notebook, 

```
sage: ascii_art(list(Partitions(5)))
<repr(<sage.typeset.ascii_art.AsciiArt at 0x7f8f358aa250>) failed: OSError: [Errno 25] Inappropriate ioctl for device>
```

This is because the `_terminal_width()` method does not work with Jupiter. 

Branch/Commit: 5aa8cd57c9de0a5ecbed437aa225a6eb15566749

Reviewer: Dima Pasechnik

Author: Kwankyu Lee

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33996





---

archive/issue_comments_512801.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2022-06-15T00:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512801",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_512802.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-15T00:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512802",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_512803.json:
```json
{
    "body": "<a id='comment:4'></a>This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?",
    "created_at": "2022-06-15T06:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512803",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?



---

archive/issue_comments_512804.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 dimpase]:\n> This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?\n\n\nIt is explained in the comment. Not necessary anymore.",
    "created_at": "2022-06-15T06:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512804",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:5'></a>Replying to [comment:4 dimpase]:
> This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?


It is explained in the comment. Not necessary anymore.



---

archive/issue_comments_512805.json:
```json
{
    "body": "<a id='comment:6'></a>There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...",
    "created_at": "2022-06-15T07:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512805",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...



---

archive/issue_comments_512806.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 dimpase]:\n> There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...\n\n\nAccording to the comment, the author of the code, Volker, only considered terminal and IPython. So the `try/except` code is only for those two cases.\n\nThere is no reason to suspect that this change will make the situation with other user interfaces worse or better... In any case, it could be dealt with in other tickets if reported by users of those interfaces.",
    "created_at": "2022-06-15T07:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512806",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>Replying to [comment:6 dimpase]:
> There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...


According to the comment, the author of the code, Volker, only considered terminal and IPython. So the `try/except` code is only for those two cases.

There is no reason to suspect that this change will make the situation with other user interfaces worse or better... In any case, it could be dealt with in other tickets if reported by users of those interfaces.



---

archive/issue_comments_512807.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 klee]:\n> In any case, it could be dealt with in other tickets if reported by users of those interfaces.\n\n\nOr in this ticket. We can wait.",
    "created_at": "2022-06-15T08:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512807",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>Replying to [comment:7 klee]:
> In any case, it could be dealt with in other tickets if reported by users of those interfaces.


Or in this ticket. We can wait.



---

archive/issue_comments_512808.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 klee]:\n> There is no reason to suspect that this change will make the situation with other user interfaces worse or better... \n\n\nIf any other user interface is affected, then it would be rather because of replacing `os.isatty(sys.stdout.fileno())` with `sys.stdout.isatty()`.",
    "created_at": "2022-06-15T08:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512808",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:9'></a>Replying to [comment:7 klee]:
> There is no reason to suspect that this change will make the situation with other user interfaces worse or better... 


If any other user interface is affected, then it would be rather because of replacing `os.isatty(sys.stdout.fileno())` with `sys.stdout.isatty()`.



---

archive/issue_comments_512809.json:
```json
{
    "body": "<a id='comment:10'></a>I put a post in sage-devel: https://groups.google.com/g/sage-devel/c/EHCPeH5BXh4",
    "created_at": "2022-06-15T08:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512809",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'></a>I put a post in sage-devel: https://groups.google.com/g/sage-devel/c/EHCPeH5BXh4



---

archive/issue_comments_512810.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-06-15T08:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512810",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_512811.json:
```json
{
    "body": "<a id='comment:11'></a>to copy my sage-dev message:\n\n---\n\nI think this fix is an API change. We have no control over what fake\nttys Sage users are using.\nWhat earlier returned False might now lead to an error.\nSo if you want to remove that try/except, you must deprecate it first.\n\nIMHO I'd better have try/except retained (your fix applied in the body of try)",
    "created_at": "2022-06-15T08:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512811",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>to copy my sage-dev message:

---

I think this fix is an API change. We have no control over what fake
ttys Sage users are using.
What earlier returned False might now lead to an error.
So if you want to remove that try/except, you must deprecate it first.

IMHO I'd better have try/except retained (your fix applied in the body of try)



---

archive/issue_comments_512812.json:
```json
{
    "body": "<a id='comment:12'></a>By the way, I checked that emacs-mode works with this change. Another tricky case might be sage cell.",
    "created_at": "2022-06-15T09:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512812",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>By the way, I checked that emacs-mode works with this change. Another tricky case might be sage cell.



---

archive/issue_comments_512813.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-15T10:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_512814.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 dimpase]:\n> IMHO I'd better have try/except retained (your fix applied in the body of try)\n\n\nOkay. Being cautious doesn't hurt. Thanks.",
    "created_at": "2022-06-15T10:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512814",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>Replying to [comment:11 dimpase]:
> IMHO I'd better have try/except retained (your fix applied in the body of try)


Okay. Being cautious doesn't hurt. Thanks.



---

archive/issue_comments_512815.json:
```json
{
    "body": "<a id='comment:15'></a>OK, good.",
    "created_at": "2022-06-15T14:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512815",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>OK, good.



---

archive/issue_comments_512816.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2022-06-15T14:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512816",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_events_089007.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-28T22:12:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33996#event-89007"
}
```



---

archive/issue_comments_512817.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-28T22:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33996#issuecomment-512817",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
