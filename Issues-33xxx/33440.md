# Issue 33440: sage.libs.singular: Do not fail if the Singular binary is not in PATH

archive/issues_033203.json:
```json
{
    "body": "This code from #29024\n\n```\n    os.environ[\"SINGULAR_BIN_DIR\"] = dirname(which(\"Singular\"))\n```\nassumes that `Singular` is in PATH\n\nThis causes errors when users attempt to use sagelib outside of the environment set up by `sage-env`.\n\nhttps://groups.google.com/g/sage-support/c/XBxpl-JjaNU/m/FtRvcoW0AgAJ\n\n\nCC:  @orlitzky @dimpase @koffie\n\nBranch/Commit: 4cd31308ac154f4d23e69b3706fb54023834d0e5\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nDependencies: #31292, #31296\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33440\n\n",
    "closed_at": "2022-03-21T23:34:23Z",
    "created_at": "2022-03-01T19:12:07Z",
    "labels": [
        "component: refactoring",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "sage.libs.singular: Do not fail if the Singular binary is not in PATH",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33440",
    "user": "https://github.com/mkoeppe"
}
```
This code from #29024

```
    os.environ["SINGULAR_BIN_DIR"] = dirname(which("Singular"))
```
assumes that `Singular` is in PATH

This causes errors when users attempt to use sagelib outside of the environment set up by `sage-env`.

https://groups.google.com/g/sage-support/c/XBxpl-JjaNU/m/FtRvcoW0AgAJ


CC:  @orlitzky @dimpase @koffie

Branch/Commit: 4cd31308ac154f4d23e69b3706fb54023834d0e5

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Dependencies: #31292, #31296

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33440





---

archive/issue_comments_505068.json:
```json
{
    "body": "<a id='comment:1'></a>Fix should be via `sage.features` / #31296",
    "created_at": "2022-03-01T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505068",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Fix should be via `sage.features` / #31296



---

archive/issue_comments_505069.json:
```json
{
    "body": "<a id='comment:3'></a>We have this problem in a lot of packages and we usually use`sage_conf`to store one of two values: the system location, or the sage location -- depending on what's detected at `./configure` time. The `spkg-configure.m4` for singular already detects `SINGULAR_BIN`; we probably just need to record its `dirname()` if it's not in the system's `PATH`.",
    "created_at": "2022-03-01T21:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505069",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>We have this problem in a lot of packages and we usually use`sage_conf`to store one of two values: the system location, or the sage location -- depending on what's detected at `./configure` time. The `spkg-configure.m4` for singular already detects `SINGULAR_BIN`; we probably just need to record its `dirname()` if it's not in the system's `PATH`.



---

archive/issue_comments_505070.json:
```json
{
    "body": "<a id='comment:4'></a>I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.",
    "created_at": "2022-03-01T23:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505070",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.



---

archive/issue_comments_505071.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:\n> I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.\n\n\nThe `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.",
    "created_at": "2022-03-01T23:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505071",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:
> I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.


The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.



---

archive/issue_comments_505072.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 mjo]:\n> \n> The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.\n> \n\n\nSorry, that's half nonsense. If we **don't** find `Singular` in the `PATH`, we know that it's in the `SAGE_LOCAL` location, and we put that value into `sage_conf` so that later we don't need to rely on `PATH`.",
    "created_at": "2022-03-01T23:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505072",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'></a>Replying to [comment:5 mjo]:
> 
> The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.
> 


Sorry, that's half nonsense. If we **don't** find `Singular` in the `PATH`, we know that it's in the `SAGE_LOCAL` location, and we put that value into `sage_conf` so that later we don't need to rely on `PATH`.



---

archive/issue_comments_505073.json:
```json
{
    "body": "<a id='comment:8'></a>I know you know this already, but I think adding geographically varied runtime checks for things that are known at build time is the wrong solution.\n\n---\nNew commits:",
    "created_at": "2022-03-01T23:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505073",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>I know you know this already, but I think adding geographically varied runtime checks for things that are known at build time is the wrong solution.

---
New commits:



---

archive/issue_comments_505074.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-01T23:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_505075.json:
```json
{
    "body": "<a id='comment:10'></a>No objection if you want to provide `SINGULAR_BIN` via `sage_conf`",
    "created_at": "2022-03-01T23:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505075",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>No objection if you want to provide `SINGULAR_BIN` via `sage_conf`



---

archive/issue_comments_505076.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-02T00:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_505077.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:\n> No objection if you want to provide `SINGULAR_BIN` via `sage_conf`\n\n\nThis variable would be used in `src/sage/features/singular.py`",
    "created_at": "2022-03-02T00:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505077",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:
> No objection if you want to provide `SINGULAR_BIN` via `sage_conf`


This variable would be used in `src/sage/features/singular.py`



---

archive/issue_comments_505078.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-02T05:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_505079.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-02T05:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_505080.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-02T05:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505080",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_505081.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-03T02:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_505082.json:
```json
{
    "body": "<a id='comment:18'></a>Let's get this in please",
    "created_at": "2022-03-12T18:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505082",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Let's get this in please



---

archive/issue_comments_505083.json:
```json
{
    "body": "<a id='comment:19'></a>How does one test this? I tried the way given in the link, but it ends up as follows:\n\n```\nima@hilbert /mnt/opt/Sage $ ./sage-dev/sage -python3 -m venv --system-site-packages venv\ndima@hilbert /mnt/opt/Sage $ source venv/bin/activate\n(venv) dima@hilbert /mnt/opt/Sage $ python3\nPython 3.9.10 (main, Mar  4 2022, 14:46:20) \n[GCC 11.2.1 20211127] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.all import *\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nModuleNotFoundError: No module named 'sage'\n>>> \n```\n\nAm I doing something wrong?",
    "created_at": "2022-03-12T20:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505083",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>How does one test this? I tried the way given in the link, but it ends up as follows:

```
ima@hilbert /mnt/opt/Sage $ ./sage-dev/sage -python3 -m venv --system-site-packages venv
dima@hilbert /mnt/opt/Sage $ source venv/bin/activate
(venv) dima@hilbert /mnt/opt/Sage $ python3
Python 3.9.10 (main, Mar  4 2022, 14:46:20) 
[GCC 11.2.1 20211127] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.all import *
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ModuleNotFoundError: No module named 'sage'
>>> 
```

Am I doing something wrong?



---

archive/issue_comments_505084.json:
```json
{
    "body": "<a id='comment:20'></a>The method of setting up the venv that was tried in that post only works when Sage has built its own Python. One cannot make a venv from a venv.",
    "created_at": "2022-03-12T20:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505084",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>The method of setting up the venv that was tried in that post only works when Sage has built its own Python. One cannot make a venv from a venv.



---

archive/issue_comments_505085.json:
```json
{
    "body": "<a id='comment:21'></a>You can test it by just using command lines like the ones I showed in #31296",
    "created_at": "2022-03-12T20:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505085",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>You can test it by just using command lines like the ones I showed in #31296



---

archive/issue_comments_505086.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-12T21:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505086",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_505087.json:
```json
{
    "body": "<a id='comment:22'></a>OK, this works.",
    "created_at": "2022-03-12T21:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505087",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>OK, this works.



---

archive/issue_comments_505088.json:
```json
{
    "body": "<a id='comment:23'></a>Thank you!",
    "created_at": "2022-03-12T21:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505088",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Thank you!



---

archive/issue_comments_505089.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-21T23:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33440#issuecomment-505089",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088149.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-21T23:34:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33440",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33440#event-88149"
}
```
