# Issue 33027: zombie maxima process -  if invoked from a script

archive/issues_032790.json:
```json
{
    "assignees": [],
    "body": "invoking `maxima` in a Sage script leads to a zombie process. E.g.\nrun the following in terminal\n\n```\necho \"t=maxima('2+2')\" > /tmp/foo.sage && ./sage /tmp/foo.sage\n```\nand observe zombie `maxima` process after this terminates.\nDon't forget to \n\n```\nkillall maxima\n```\nnow and then.\n\n\nA slightly shorter\n\n```\necho \"t=maxima('2+2')\" | ./sage\n```\ndoes not lead to a zombie - in fact, it prints on exit:\n\n```\nsage: sage: Exiting Sage (CPU time 0m0.08s, Wall time 0m0.67s).\nExiting Maxima with PID 2318 running <SAGEROOT>/local/bin/maxima -p <SAGEROOT>/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp\n```\n\nThis was observed while testing `sagetex` spkg with `SAGE_CHECK=yes make sagetex` on #32887.\n\nUsing `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.\n\n---\n\nApparently, this only happens with ecl installed in Sage rather than with system-wide ecl.\n\n\n\nCC:  @nbruin @vbraun @mkoeppe @spaghettisalat\n\nBranch/Commit: **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**\n\nReviewer: **Michael Orlitzky**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33027_\n\n",
    "closed_at": "2022-02-13T10:17:53Z",
    "created_at": "2021-12-15T13:52:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "zombie maxima process -  if invoked from a script",
    "type": "issue",
    "updated_at": "2022-02-13T10:17:53Z",
    "url": "https://github.com/sagemath/sage/issues/33027",
    "user": "https://github.com/dimpase"
}
```
invoking `maxima` in a Sage script leads to a zombie process. E.g.
run the following in terminal

```
echo "t=maxima('2+2')" > /tmp/foo.sage && ./sage /tmp/foo.sage
```
and observe zombie `maxima` process after this terminates.
Don't forget to 

```
killall maxima
```
now and then.


A slightly shorter

```
echo "t=maxima('2+2')" | ./sage
```
does not lead to a zombie - in fact, it prints on exit:

```
sage: sage: Exiting Sage (CPU time 0m0.08s, Wall time 0m0.67s).
Exiting Maxima with PID 2318 running <SAGEROOT>/local/bin/maxima -p <SAGEROOT>/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp
```

This was observed while testing `sagetex` spkg with `SAGE_CHECK=yes make sagetex` on #32887.

Using `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.

---

Apparently, this only happens with ecl installed in Sage rather than with system-wide ecl.



CC:  @nbruin @vbraun @mkoeppe @spaghettisalat

Branch/Commit: **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**

Reviewer: **Michael Orlitzky**

Author: **Dima Pasechnik**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/33027_





---

archive/issue_events_454506.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-15T13:52:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454506"
}
```



---

archive/issue_events_454507.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-15T13:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454507"
}
```



---

archive/issue_events_454508.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-15T13:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454508"
}
```



---

archive/issue_events_454509.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-15T13:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454509"
}
```



---

archive/issue_comments_533390.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nMoving this to critical, as it seems to efficiently kill the patchbots.",
    "created_at": "2021-12-15T15:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533390",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1" align="right">comment:1</div>

Moving this to critical, as it seems to efficiently kill the patchbots.



---

archive/issue_events_454510.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-15T15:47:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454510"
}
```



---

archive/issue_events_454511.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-15T15:47:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454511"
}
```



---

archive/issue_comments_533391.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis might be related to #32167.",
    "created_at": "2022-01-21T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533391",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

This might be related to #32167.



---

archive/issue_comments_533392.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI think it was observed without fricas installed, too.",
    "created_at": "2022-01-21T10:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533392",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

I think it was observed without fricas installed, too.



---

archive/issue_comments_533393.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,13 @@\n echo \"t=maxima('2+2')\" > /tmp/foo.sage && ./sage /tmp/foo.sage\n ```\n and observe zombie `maxima` process after this terminates.\n+Don't forget to \n+\n+```\n+killall maxima\n+```\n+now and then.\n+\n \n A slightly shorter\n \n``````\n",
    "created_at": "2022-01-21T10:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533393",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,13 @@
 echo "t=maxima('2+2')" > /tmp/foo.sage && ./sage /tmp/foo.sage
 ```
 and observe zombie `maxima` process after this terminates.
+Don't forget to 
+
+```
+killall maxima
+```
+now and then.
+
 
 A slightly shorter
 
``````




---

archive/issue_comments_533394.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI've noticed that one gets\n`.sage/maxima/binary/5_45_0/ecl/21_2_1/` created in DOTSAGE. (no matter with the reproducer, or the non-reproducer `echo \"t=maxima('2+2')\" | ./sage`",
    "created_at": "2022-01-21T11:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533394",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

I've noticed that one gets
`.sage/maxima/binary/5_45_0/ecl/21_2_1/` created in DOTSAGE. (no matter with the reproducer, or the non-reproducer `echo "t=maxima('2+2')" | ./sage`



---

archive/issue_comments_533395.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,3 +27,5 @@\n \n This was observed while testing `sagetex` spkg with `SAGE_CHECK=yes make sagetex` on #32887.\n \n+Using `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.\n+\n``````\n",
    "created_at": "2022-01-21T11:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533395",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,3 +27,5 @@
 
 This was observed while testing `sagetex` spkg with `SAGE_CHECK=yes make sagetex` on #32887.
 
+Using `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.
+
``````




---

archive/issue_comments_533396.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis effectively kills the patchbots, thus a blocker, IMHO.\nhttps://groups.google.com/d/msgid/sage-devel/997e9f75-8e92-4a67-b43a-1777074cbe45n%40googlegroups.com",
    "created_at": "2022-01-21T11:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533396",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

This effectively kills the patchbots, thus a blocker, IMHO.
https://groups.google.com/d/msgid/sage-devel/997e9f75-8e92-4a67-b43a-1777074cbe45n%40googlegroups.com



---

archive/issue_events_454512.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T11:14:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454512"
}
```



---

archive/issue_events_454513.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T11:14:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454513"
}
```



---

archive/issue_comments_533397.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nwhat I meant to say is that it might be a similar underlying problem.",
    "created_at": "2022-01-21T11:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533397",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:8" align="right">comment:8</div>

what I meant to say is that it might be a similar underlying problem.



---

archive/issue_comments_533398.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@dimpase](#comment:7):\n> This effectively kills the patchbots, thus a blocker, IMHO.\n> https://groups.google.com/d/msgid/sage-devel/997e9f75-8e92-4a67-b43a-1777074cbe45n%40googlegroups.com\n\nApparently a ticket introduced in 9.5beta8 https://groups.google.com/g/sage-release/c/vo_m79EHAVc/m/mMlNPz5sBAAJ introduced this problem. My patchbot worked fine until then and I got contacted by the IT on December 13th (it is a virtual machine and I'm guessing this also affected other people).",
    "created_at": "2022-01-21T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533398",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@dimpase](#comment:7):
> This effectively kills the patchbots, thus a blocker, IMHO.
> https://groups.google.com/d/msgid/sage-devel/997e9f75-8e92-4a67-b43a-1777074cbe45n%40googlegroups.com

Apparently a ticket introduced in 9.5beta8 https://groups.google.com/g/sage-release/c/vo_m79EHAVc/m/mMlNPz5sBAAJ introduced this problem. My patchbot worked fine until then and I got contacted by the IT on December 13th (it is a virtual machine and I'm guessing this also affected other people).



---

archive/issue_comments_533399.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n1. Never execute code from a predictable filename under `/tmp` =)\n2. FWIW, I can't reproduce this on rc2.",
    "created_at": "2022-01-21T12:31:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533399",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:10" align="right">comment:10</div>

1. Never execute code from a predictable filename under `/tmp` =)
2. FWIW, I can't reproduce this on rc2.



---

archive/issue_comments_533400.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@orlitzky](#comment:10):\n> 1. Never execute code from a predictable filename under `/tmp` =)\n> 2. FWIW, I can't reproduce this on rc2.\n\nPerhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.",
    "created_at": "2022-01-21T13:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533400",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@orlitzky](#comment:10):
> 1. Never execute code from a predictable filename under `/tmp` =)
> 2. FWIW, I can't reproduce this on rc2.

Perhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.



---

archive/issue_comments_533401.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@dimpase](#comment:11):\n> Replying to [@orlitzky](#comment:10):\n> > 1. Never execute code from a predictable filename under `/tmp` =)\n> > 2. FWIW, I can't reproduce this on rc2.\n\n> \n> Perhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.\n\nNo, my config.log states, `already installed as an SPKG`.",
    "created_at": "2022-01-21T14:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533401",
    "user": "https://github.com/kliem"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@dimpase](#comment:11):
> Replying to [@orlitzky](#comment:10):
> > 1. Never execute code from a predictable filename under `/tmp` =)
> > 2. FWIW, I can't reproduce this on rc2.

> 
> Perhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.

No, my config.log states, `already installed as an SPKG`.



---

archive/issue_comments_533402.json:
```json
{
    "body": "Attachment: **[config.log](https://github.com/sagemath/sage/files/ticket33027/config.log)**\n\nA config.log of some debian buster with this problem",
    "created_at": "2022-01-21T14:23:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533402",
    "user": "https://github.com/kliem"
}
```

Attachment: **[config.log](https://github.com/sagemath/sage/files/ticket33027/config.log)**

A config.log of some debian buster with this problem



---

archive/issue_comments_533403.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@kliem](#comment:12):\n> Replying to [@dimpase](#comment:11):\n> > Replying to [@orlitzky](#comment:10):\n> > > 1. Never execute code from a predictable filename under `/tmp` =)\n> > > 2. FWIW, I can't reproduce this on rc2.\n\n> > \n> > Perhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.\n\n> \n> No, my config.log states, `already installed as an SPKG`.\n\nI meant that a system ecl is the reason that Michael cannot reproduce this.",
    "created_at": "2022-01-21T14:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533403",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@kliem](#comment:12):
> Replying to [@dimpase](#comment:11):
> > Replying to [@orlitzky](#comment:10):
> > > 1. Never execute code from a predictable filename under `/tmp` =)
> > > 2. FWIW, I can't reproduce this on rc2.

> > 
> > Perhaps it's due to ecl from the system? I see this on Debian 11 with ecl built by Sage.

> 
> No, my config.log states, `already installed as an SPKG`.

I meant that a system ecl is the reason that Michael cannot reproduce this.



---

archive/issue_comments_533404.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAh yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.",
    "created_at": "2022-01-21T14:38:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533404",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.



---

archive/issue_comments_533405.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kliem](#comment:14):\n> Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.\n\nYes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.",
    "created_at": "2022-01-21T17:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533405",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kliem](#comment:14):
> Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.

Yes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.



---

archive/issue_comments_533406.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,8 @@\n \n Using `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.\n \n+---\n+\n+Apparently, this only happens with ecl installed in Sage rather than with system-wide ecl.\n+\n+\n``````\n",
    "created_at": "2022-01-21T17:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533406",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,8 @@
 
 Using `maxima_calculus()` (the library interface) rather than `maxima()` (pexpect interface) does not lead to zombies.
 
+---
+
+Apparently, this only happens with ecl installed in Sage rather than with system-wide ecl.
+
+
``````




---

archive/issue_comments_533407.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment:15):\n> Replying to [@kliem](#comment:14):\n> > Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.\n\n> \n> Yes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.\n\nMaybe delete that `write_error.patch` that the SPKG applies, and try again?",
    "created_at": "2022-01-21T18:21:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533407",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment:15):
> Replying to [@kliem](#comment:14):
> > Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.

> 
> Yes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.

Maybe delete that `write_error.patch` that the SPKG applies, and try again?



---

archive/issue_comments_533408.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe other obvious difference is that the SPKG is built with `--disable-threads`. But the patch is more suspicious to me.",
    "created_at": "2022-01-21T18:24:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533408",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:19" align="right">comment:19</div>

The other obvious difference is that the SPKG is built with `--disable-threads`. But the patch is more suspicious to me.



---

archive/issue_comments_533409.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nCould you check whether using spkg ecl / system ecl also makes the difference for #32167?",
    "created_at": "2022-01-21T18:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533409",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:20" align="right">comment:20</div>

Could you check whether using spkg ecl / system ecl also makes the difference for #32167?



---

archive/issue_comments_533410.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@orlitzky](#comment:18):\n> Replying to [@dimpase](#comment:15):\n> > Replying to [@kliem](#comment:14):\n> > > Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.\n\n> > \n> > Yes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.\n\n> \n> Maybe delete that `write_error.patch` that the SPKG applies, and try again?\n\npatch or no patch, the same picture.",
    "created_at": "2022-01-21T18:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533410",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@orlitzky](#comment:18):
> Replying to [@dimpase](#comment:15):
> > Replying to [@kliem](#comment:14):
> > > Ah yes, this might be the reason. I can also observe this on ubuntu focal with ecl installed as SPKG.

> > 
> > Yes, I can reproduce this - on a Gentoo machine with systemwide ecl there is no zombie, but installing ecl+maxima in Sage leads to zombies.

> 
> Maybe delete that `write_error.patch` that the SPKG applies, and try again?

patch or no patch, the same picture.



---

archive/issue_comments_533411.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\naccoring to [comment:9](#comment:9), something happened in 9.5.beta8, which caused this. Time for `git bisect` I suppose...",
    "created_at": "2022-01-21T18:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533411",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

accoring to [comment:9](#comment:9), something happened in 9.5.beta8, which caused this. Time for `git bisect` I suppose...



---

archive/issue_comments_533412.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@orlitzky](#comment:19):\n> The other obvious difference is that the SPKG is built with `--disable-threads`. But the patch is more suspicious to me.\n\nThis was the correct guess.\nIf I remove `--disable-threads` then no zombies pop up.\n\nCan this also be done on macOS?",
    "created_at": "2022-01-21T20:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533412",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@orlitzky](#comment:19):
> The other obvious difference is that the SPKG is built with `--disable-threads`. But the patch is more suspicious to me.

This was the correct guess.
If I remove `--disable-threads` then no zombies pop up.

Can this also be done on macOS?



---

archive/issue_comments_533413.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nposting a branch in a moment",
    "created_at": "2022-01-21T21:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533413",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

posting a branch in a moment



---

archive/issue_comments_533414.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2022-01-21T21:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533414",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_454514.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T21:07:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454514"
}
```



---

archive/issue_events_454515.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T21:07:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454515"
}
```



---

archive/issue_events_454516.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T21:07:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454516"
}
```



---

archive/issue_comments_533415.json:
```json
{
    "body": "Commit: **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**",
    "created_at": "2022-01-21T21:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533415",
    "user": "https://github.com/dimpase"
}
```

Commit: **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**



---

archive/issue_events_454517.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T21:37:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454517"
}
```



---

archive/issue_events_454518.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-21T21:37:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454518"
}
```



---

archive/issue_comments_533416.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/ecl/nozombies](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/ecl/nozombies)**",
    "created_at": "2022-01-21T21:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533416",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/ecl/nozombies](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/ecl/nozombies)**



---

archive/issue_comments_533417.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882\">abafddc</a></td><td><code>disable-threads led to zombies</code></td></tr></table>\n",
    "created_at": "2022-01-21T21:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533417",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882">abafddc</a></td><td><code>disable-threads led to zombies</code></td></tr></table>




---

archive/issue_comments_533418.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOn OS X, after running `./configure --with-system-ecl=no`, I don't see any zombie maxima processes no matter how many times I run `./sage /path/to/foo.sage`.",
    "created_at": "2022-01-22T02:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533418",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

On OS X, after running `./configure --with-system-ecl=no`, I don't see any zombie maxima processes no matter how many times I run `./sage /path/to/foo.sage`.



---

archive/issue_comments_533419.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIs there any way this is connected to #31796? That's the only obvious ticket merged in 9.5.beta8 which is connected to maxima, but it doesn't look problematic to me.",
    "created_at": "2022-01-22T02:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533419",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

Is there any way this is connected to #31796? That's the only obvious ticket merged in 9.5.beta8 which is connected to maxima, but it doesn't look problematic to me.



---

archive/issue_comments_533420.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jhpalmieri](#comment:27):\n> On OS X, after running `./configure --with-system-ecl=no`, I don't see any zombie maxima processes no matter how many times I run `./sage /path/to/foo.sage`.\n\nmacOS is sufficiently different from Linux, I'm not surprised. I noticed that Homebrew builds ecl with threads enabled, so the change proposed here should be fine on macOS too.\n\nNot sure about cygwin though.",
    "created_at": "2022-01-22T11:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533420",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jhpalmieri](#comment:27):
> On OS X, after running `./configure --with-system-ecl=no`, I don't see any zombie maxima processes no matter how many times I run `./sage /path/to/foo.sage`.

macOS is sufficiently different from Linux, I'm not surprised. I noticed that Homebrew builds ecl with threads enabled, so the change proposed here should be fine on macOS too.

Not sure about cygwin though.



---

archive/issue_comments_533421.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jhpalmieri](#comment:28):\n> Is there any way this is connected to #31796? That's the only obvious ticket merged in 9.5.beta8 which is connected to maxima, but it doesn't look problematic to me.\n\nI even tried reverting it, to no avail.\nPerhaps the behaviour was always there, it's just a test introduced in beta8 that led to these zombie processes?",
    "created_at": "2022-01-22T11:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533421",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jhpalmieri](#comment:28):
> Is there any way this is connected to #31796? That's the only obvious ticket merged in 9.5.beta8 which is connected to maxima, but it doesn't look problematic to me.

I even tried reverting it, to no avail.
Perhaps the behaviour was always there, it's just a test introduced in beta8 that led to these zombie processes?



---

archive/issue_comments_533422.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI am fairly certain that this is a race condition and enabling threads will not help in general.\n\nAttaching a debugger to the maxima zombie process shows that the process hangs in a loop where it tries to flush the standard output, gets an error, tries to report that error to the standard error stream, then gets an error for that and so on. The following script\n\n```\nimport atexit\natexit.register(lambda : maxima.quit())\nt=maxima('2+2')\n```\n\nworks fine and leaves no maxima zombies.\n\nI don't have time to dig into the maxima interface code, but I am pretty sure that sage just doesn't shut down maxima properly.",
    "created_at": "2022-01-22T14:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533422",
    "user": "https://github.com/spaghettisalat"
}
```

<div id="comment:31" align="right">comment:31</div>

I am fairly certain that this is a race condition and enabling threads will not help in general.

Attaching a debugger to the maxima zombie process shows that the process hangs in a loop where it tries to flush the standard output, gets an error, tries to report that error to the standard error stream, then gets an error for that and so on. The following script

```
import atexit
atexit.register(lambda : maxima.quit())
t=maxima('2+2')
```

works fine and leaves no maxima zombies.

I don't have time to dig into the maxima interface code, but I am pretty sure that sage just doesn't shut down maxima properly.



---

archive/issue_comments_533423.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@spaghettisalat](#comment:31):\n> I am fairly certain that this is a race condition and enabling threads will not help in general.\n> \n> Attaching a debugger to the maxima zombie process shows that the process hangs in a loop where it tries to flush the standard output, gets an error, tries to report that error to the standard error stream, then gets an error for that and so on.\n\nSounds related to https://gitlab.com/embeddable-common-lisp/ecl/-/issues/634?\n\nThe fact that it works with threads enabled could be due to https://gitlab.com/embeddable-common-lisp/ecl/-/issues/129. If that's the case then indeed we shouldn't rely on it.\n\nThe following script\n> \n> ```\n> import atexit\n> atexit.register(lambda : maxima.quit())\n> t=maxima('2+2')\n> ```\n> \n> works fine and leaves no maxima zombies.\n> \n> I don't have time to dig into the maxima interface code, but I am pretty sure that sage just doesn't shut down maxima properly.\n\nThe pexpect interface has been deprecated forever, so it's not unlikely. And I don't think adding a `quit()` hook could hurt in any case.",
    "created_at": "2022-01-22T15:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533423",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@spaghettisalat](#comment:31):
> I am fairly certain that this is a race condition and enabling threads will not help in general.
> 
> Attaching a debugger to the maxima zombie process shows that the process hangs in a loop where it tries to flush the standard output, gets an error, tries to report that error to the standard error stream, then gets an error for that and so on.

Sounds related to https://gitlab.com/embeddable-common-lisp/ecl/-/issues/634?

The fact that it works with threads enabled could be due to https://gitlab.com/embeddable-common-lisp/ecl/-/issues/129. If that's the case then indeed we shouldn't rely on it.

The following script
> 
> ```
> import atexit
> atexit.register(lambda : maxima.quit())
> t=maxima('2+2')
> ```
> 
> works fine and leaves no maxima zombies.
> 
> I don't have time to dig into the maxima interface code, but I am pretty sure that sage just doesn't shut down maxima properly.

The pexpect interface has been deprecated forever, so it's not unlikely. And I don't think adding a `quit()` hook could hurt in any case.



---

archive/issue_comments_533424.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe patchbots will use the develop branch so there is little to be gained and a lot to potentially screw up by pushing the proposed patch into 9.5",
    "created_at": "2022-01-22T17:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533424",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:33" align="right">comment:33</div>

The patchbots will use the develop branch so there is little to be gained and a lot to potentially screw up by pushing the proposed patch into 9.5



---

archive/issue_events_454519.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-22T17:27:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454519"
}
```



---

archive/issue_events_454520.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-22T17:27:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454520"
}
```



---

archive/issue_comments_533425.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@orlitzky](#comment:32):\n> The pexpect interface has been deprecated forever\n\nNo, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.",
    "created_at": "2022-01-22T17:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533425",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@orlitzky](#comment:32):
> The pexpect interface has been deprecated forever

No, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.



---

archive/issue_comments_533426.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mkoeppe](#comment:34):\n> Replying to [@orlitzky](#comment:32):\n> > The pexpect interface has been deprecated forever\n\n> \n> No, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.\n\nI agree that the pexpect interface is not deprecated, but I don't think it's the only interface that's meant to be user-facing. In fact, I expect (no pun intended) that most uses for maxima in sage *are* through the internal one, because the integration with symbolics makes it easier to get the things in/out. For instance `SR(x)._maxima_()` gets you an object through the `maxima_lib` interface.\n\nThe pexpect interface is convenient if you want multiple sessions (managed through different processes) and if you want \"vanilla\" maxima: the maxima_lib one has some tweaks and configurations motivated by its use for SR.",
    "created_at": "2022-01-22T18:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533426",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mkoeppe](#comment:34):
> Replying to [@orlitzky](#comment:32):
> > The pexpect interface has been deprecated forever

> 
> No, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.

I agree that the pexpect interface is not deprecated, but I don't think it's the only interface that's meant to be user-facing. In fact, I expect (no pun intended) that most uses for maxima in sage *are* through the internal one, because the integration with symbolics makes it easier to get the things in/out. For instance `SR(x)._maxima_()` gets you an object through the `maxima_lib` interface.

The pexpect interface is convenient if you want multiple sessions (managed through different processes) and if you want "vanilla" maxima: the maxima_lib one has some tweaks and configurations motivated by its use for SR.



---

archive/issue_comments_533427.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@mkoeppe](#comment:34):\n> Replying to [@orlitzky](#comment:32):\n> > The pexpect interface has been deprecated forever\n\n> \n> No, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.\n\nSemantics? The *name* `maxima()` isn't deprecated, but the library interface is faster and more robust than pexpect ever can be. There are several tickets open to replace pexpect calls and documentation with the library interface. You yourself started to make `maxima()` use the library in #30097.",
    "created_at": "2022-01-22T18:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533427",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@mkoeppe](#comment:34):
> Replying to [@orlitzky](#comment:32):
> > The pexpect interface has been deprecated forever

> 
> No, it's not. We have 2 maxima interfaces. `maxima_calculus` is the unique instance of the library-based interface and is for internal use by symbolics. `maxima` is the user-facing interface and is pexpect-based.

Semantics? The *name* `maxima()` isn't deprecated, but the library interface is faster and more robust than pexpect ever can be. There are several tickets open to replace pexpect calls and documentation with the library interface. You yourself started to make `maxima()` use the library in #30097.



---

archive/issue_comments_533428.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nYes, that's correct, #30097 would be a solution.",
    "created_at": "2022-01-22T18:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533428",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Yes, that's correct, #30097 would be a solution.



---

archive/issue_comments_533429.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@orlitzky](#comment:36):\n> Semantics? The *name* `maxima()` isn't deprecated, but the library interface is faster and more robust than pexpect ever can be.\n\nThat would depend. The pexpect interface could in principle work with, say, maxima on SBCL, which probably would run faster than on ECL. So jobs with maxima that aren't particularly I/O-bound need not be faster through maxima_lib.\n\nStability: sure. pexpect inferfaces have shown to be quite fragile; particular with LISP, which tends to have I/O that isn't particularly compatible with C-type I/O (character devices may be driver really one-character-at-a-time).",
    "created_at": "2022-01-22T19:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533429",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@orlitzky](#comment:36):
> Semantics? The *name* `maxima()` isn't deprecated, but the library interface is faster and more robust than pexpect ever can be.

That would depend. The pexpect interface could in principle work with, say, maxima on SBCL, which probably would run faster than on ECL. So jobs with maxima that aren't particularly I/O-bound need not be faster through maxima_lib.

Stability: sure. pexpect inferfaces have shown to be quite fragile; particular with LISP, which tends to have I/O that isn't particularly compatible with C-type I/O (character devices may be driver really one-character-at-a-time).



---

archive/issue_comments_533430.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@orlitzky](#comment:32):\n> And I don't think adding a `quit()` hook could hurt in any case.\n\nit's there, no?\n\n```\nsage: maxima._quit_string()\n'quit();'\n```",
    "created_at": "2022-01-22T20:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533430",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@orlitzky](#comment:32):
> And I don't think adding a `quit()` hook could hurt in any case.

it's there, no?

```
sage: maxima._quit_string()
'quit();'
```



---

archive/issue_comments_533431.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI think I am noticing zombie processes also with the gap3 (optional) interface.",
    "created_at": "2022-01-22T21:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533431",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:40" align="right">comment:40</div>

I think I am noticing zombie processes also with the gap3 (optional) interface.



---

archive/issue_comments_533432.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@dimpase](#comment:39):\n> Replying to [@orlitzky](#comment:32):\n> > And I don't think adding a `quit()` hook could hurt in any case.\n\n> \n> it's there, no?\n> \n> ```\n> sage: maxima._quit_string()\n> 'quit();'\n> ```\n> \n\nBut when is that string sent to the running maxima process? I meant something like [comment:31](#comment:31).\n\nI see now that there's a function called `quit_sage()` in `src/sage/all.py`,\n\n```python\ndef quit_sage(verbose=True):\n    \"\"\"                                                                                                                                                                      \n    If you use Sage in library mode, you should call this function                                                                                                           \n    when your application quits.                                                                                                                                             \n                                                                                                                                                                             \n    It makes sure any child processes are also killed, etc.                                                                                                                  \n    \"\"\"\n    ...\n    from sage.interfaces.quit import expect_quitall\n    expect_quitall(verbose=verbose)\n    ...\n```\n\nwhich kills all running pexpect processes. And apparently you are supposed to call this function yourself. So, I guess we can blame sagetex for not calling `quit_sage()` at the end of the scripts it generates? =)",
    "created_at": "2022-01-22T22:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533432",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@dimpase](#comment:39):
> Replying to [@orlitzky](#comment:32):
> > And I don't think adding a `quit()` hook could hurt in any case.

> 
> it's there, no?
> 
> ```
> sage: maxima._quit_string()
> 'quit();'
> ```
> 

But when is that string sent to the running maxima process? I meant something like [comment:31](#comment:31).

I see now that there's a function called `quit_sage()` in `src/sage/all.py`,

```python
def quit_sage(verbose=True):
    """                                                                                                                                                                      
    If you use Sage in library mode, you should call this function                                                                                                           
    when your application quits.                                                                                                                                             
                                                                                                                                                                             
    It makes sure any child processes are also killed, etc.                                                                                                                  
    """
    ...
    from sage.interfaces.quit import expect_quitall
    expect_quitall(verbose=verbose)
    ...
```

which kills all running pexpect processes. And apparently you are supposed to call this function yourself. So, I guess we can blame sagetex for not calling `quit_sage()` at the end of the scripts it generates? =)



---

archive/issue_comments_533433.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nshouldn't EOF in a .sage script trigger `quit_sage()`?",
    "created_at": "2022-01-22T22:40:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533433",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

shouldn't EOF in a .sage script trigger `quit_sage()`?



---

archive/issue_comments_533434.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@dimpase](#comment:42):\n> shouldn't EOF in a .sage script trigger `quit_sage()`?\n\nYes, obviously. (Or something like that). I only use sage as a library, and I just learned about that function 20 minutes ago. It's outrageous to expect the user to manually clean up after the library.\n\nHowever I think an atexit hook is a cleaner approach, at least for pexpect processes. They all support `quit()`, and could register their own atexit hook upon being initialized. It won't help with crashes or when killed by a signal, but then, neither does calling `quit_sage()` at EOF.",
    "created_at": "2022-01-22T23:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533434",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@dimpase](#comment:42):
> shouldn't EOF in a .sage script trigger `quit_sage()`?

Yes, obviously. (Or something like that). I only use sage as a library, and I just learned about that function 20 minutes ago. It's outrageous to expect the user to manually clean up after the library.

However I think an atexit hook is a cleaner approach, at least for pexpect processes. They all support `quit()`, and could register their own atexit hook upon being initialized. It won't help with crashes or when killed by a signal, but then, neither does calling `quit_sage()` at EOF.



---

archive/issue_comments_533435.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI'm going to experiment with a cleanup hook for symmetrica on another ticket. Our interface to that library has `start()` and `end()` functions that are supposed to be called manually. The `start()` function gets called when you import `sage.libs.symmetrica.all`, but `end()` never does unless you call `quit_sage()`. So I'm going to have `start()` register a hook that calls `end()`, and remove the corresponding bits from `quit_sage()`. The body of `quit_sage()` isn't very long so we may be able to obsolete it rather quickly.",
    "created_at": "2022-01-22T23:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533435",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:44" align="right">comment:44</div>

I'm going to experiment with a cleanup hook for symmetrica on another ticket. Our interface to that library has `start()` and `end()` functions that are supposed to be called manually. The `start()` function gets called when you import `sage.libs.symmetrica.all`, but `end()` never does unless you call `quit_sage()`. So I'm going to have `start()` register a hook that calls `end()`, and remove the corresponding bits from `quit_sage()`. The body of `quit_sage()` isn't very long so we may be able to obsolete it rather quickly.



---

archive/issue_comments_533436.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI posted a branch on #8784 that eliminates `quit_sage()` and puts all of the cleanup chores (including the termination of pexpect processes) into atexit hooks.\n\nIt's a more-invasive change, but the right thing to do if it doesn't cause any subtle new bugs.",
    "created_at": "2022-01-25T22:53:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533436",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:45" align="right">comment:45</div>

I posted a branch on #8784 that eliminates `quit_sage()` and puts all of the cleanup chores (including the termination of pexpect processes) into atexit hooks.

It's a more-invasive change, but the right thing to do if it doesn't cause any subtle new bugs.



---

archive/issue_comments_533437.json:
```json
{
    "body": "Reviewer: **Michael Orlitzky**",
    "created_at": "2022-01-26T12:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533437",
    "user": "https://github.com/orlitzky"
}
```

Reviewer: **Michael Orlitzky**



---

archive/issue_events_454521.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-26T12:49:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454521"
}
```



---

archive/issue_events_454522.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-26T12:49:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454522"
}
```



---

archive/issue_comments_533438.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nLet's take the easy route for the 9.5 release and worry about `quit_sage()` afterwards.",
    "created_at": "2022-01-26T12:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533438",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:46" align="right">comment:46</div>

Let's take the easy route for the 9.5 release and worry about `quit_sage()` afterwards.



---

archive/issue_comments_533439.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nSetting milestone to 9.6 now that 9.5 is out.",
    "created_at": "2022-01-30T15:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533439",
    "user": "https://github.com/slel"
}
```

<div id="comment:47" align="right">comment:47</div>

Setting milestone to 9.6 now that 9.5 is out.



---

archive/issue_events_454523.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:39:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454523"
}
```



---

archive/issue_events_454524.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:39:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454524"
}
```



---

archive/issue_comments_533440.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nWith this ticket I'm seeing a lot of flakiness with maxima-related tests, e.g. \n\n```\nsage -t --long --warn-long 50.7 --random-seed=36889336955867588730901666695941730921 src/sage/interfaces/maxima_abstract.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 314, in sage.interfaces.maxima_abstract.MaximaAbstract._commands\nFailed example:\n    sorted(maxima._commands(verbose=False))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.maxima_abstract.MaximaAbstract._commands[0]>\", line 1, in <module>\n        sorted(maxima._commands(verbose=False))\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 327, in _commands\n        [self.completions(chr(65+n), verbose=verbose)+\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 327, in <listcomp>\n        [self.completions(chr(65+n), verbose=verbose)+\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 296, in completions\n        cmd_list = self._eval_line('apropos(\"%s\")'%s, error_check=False)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py\", line 814, in _eval_line\n        self._expect_expr(self._display_prompt)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py\", line 731, in _expect_expr\n        i = self._expect.expect(expr)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py\", line 343, in expect\n        return self.expect_list(compiled_pattern_list,\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py\", line 372, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py\", line 179, in expect_loop\n        return self.eof(e)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py\", line 122, in eof\n        raise exc\n    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.\n    Maxima with PID 1795009 running /home/release/Sage/local/bin/maxima -p /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp\n    command: /home/release/Sage/local/bin/maxima\n    args: ['/home/release/Sage/local/bin/maxima', '-p', '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp']\n    buffer (last 100 chars): b''\n    before (last 100 chars): ''\n    after: <class 'pexpect.exceptions.EOF'>\n    match: None\n    match_index: None\n    exitstatus: None\n    flag_eof: True\n    pid: 1795009\n    child_fd: 20\n    closed: False\n    timeout: None\n    delimiter: <class 'pexpect.exceptions.EOF'>\n    logfile: None\n    logfile_read: None\n    logfile_send: None\n    maxread: 4194304\n    ignorecase: False\n    searchwindowsize: None\n    delaybeforesend: None\n    delayafterclose: 0.1\n    delayafterterminate: 0.1\n    searcher: searcher_re:\n        0: re.compile(b'<sage-display>')\n**********************************************************************\n```\nAlways disappears when testing individually, but running multiple maxima-using tests in parallel triggers them quite reliably. E.g.\n\n```\n./sage -t -p 8 --long src/sage/interfaces/maxima_abstract.py src/sage/dynamics/complex_dynamics/mandel_julia.py src/sage/interfaces/maxima.py src/sage/tests/books/computational-mathematics-with-sagemath/sol/mpoly_doctest.py src/sage/coding/kasami_codes.pyx\n\n```",
    "created_at": "2022-01-30T20:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533440",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:48" align="right">comment:48</div>

With this ticket I'm seeing a lot of flakiness with maxima-related tests, e.g. 

```
sage -t --long --warn-long 50.7 --random-seed=36889336955867588730901666695941730921 src/sage/interfaces/maxima_abstract.py
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 314, in sage.interfaces.maxima_abstract.MaximaAbstract._commands
Failed example:
    sorted(maxima._commands(verbose=False))
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.maxima_abstract.MaximaAbstract._commands[0]>", line 1, in <module>
        sorted(maxima._commands(verbose=False))
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 327, in _commands
        [self.completions(chr(65+n), verbose=verbose)+
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 327, in <listcomp>
        [self.completions(chr(65+n), verbose=verbose)+
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 296, in completions
        cmd_list = self._eval_line('apropos("%s")'%s, error_check=False)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py", line 814, in _eval_line
        self._expect_expr(self._display_prompt)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py", line 731, in _expect_expr
        i = self._expect.expect(expr)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py", line 343, in expect
        return self.expect_list(compiled_pattern_list,
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py", line 372, in expect_list
        return exp.expect_loop(timeout)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py", line 179, in expect_loop
        return self.eof(e)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py", line 122, in eof
        raise exc
    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.
    Maxima with PID 1795009 running /home/release/Sage/local/bin/maxima -p /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp
    command: /home/release/Sage/local/bin/maxima
    args: ['/home/release/Sage/local/bin/maxima', '-p', '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp']
    buffer (last 100 chars): b''
    before (last 100 chars): ''
    after: <class 'pexpect.exceptions.EOF'>
    match: None
    match_index: None
    exitstatus: None
    flag_eof: True
    pid: 1795009
    child_fd: 20
    closed: False
    timeout: None
    delimiter: <class 'pexpect.exceptions.EOF'>
    logfile: None
    logfile_read: None
    logfile_send: None
    maxread: 4194304
    ignorecase: False
    searchwindowsize: None
    delaybeforesend: None
    delayafterclose: 0.1
    delayafterterminate: 0.1
    searcher: searcher_re:
        0: re.compile(b'<sage-display>')
**********************************************************************
```
Always disappears when testing individually, but running multiple maxima-using tests in parallel triggers them quite reliably. E.g.

```
./sage -t -p 8 --long src/sage/interfaces/maxima_abstract.py src/sage/dynamics/complex_dynamics/mandel_julia.py src/sage/interfaces/maxima.py src/sage/tests/books/computational-mathematics-with-sagemath/sol/mpoly_doctest.py src/sage/coding/kasami_codes.pyx

```



---

archive/issue_events_454525.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T20:16:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454525"
}
```



---

archive/issue_events_454526.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T20:16:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454526"
}
```



---

archive/issue_comments_533441.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nActually seems to be due to #32986",
    "created_at": "2022-01-30T23:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533441",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:49" align="right">comment:49</div>

Actually seems to be due to #32986



---

archive/issue_events_454527.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-31T13:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454527"
}
```



---

archive/issue_events_454528.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-31T13:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454528"
}
```



---

archive/issue_comments_533442.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI have just been hit by this problem on the patchbot as well. For me, running ptestlong now leaves about 47 maxima processes running at around 130% cpu usage on average, as well as two ecl and several fricas processes.\n\nWith the current branch, the problem seems to go away.",
    "created_at": "2022-02-07T22:06:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533442",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:51" align="right">comment:51</div>

I have just been hit by this problem on the patchbot as well. For me, running ptestlong now leaves about 47 maxima processes running at around 130% cpu usage on average, as well as two ecl and several fricas processes.

With the current branch, the problem seems to go away.



---

archive/issue_comments_533443.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nfeel free to give it positive review, again...",
    "created_at": "2022-02-07T22:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533443",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

feel free to give it positive review, again...



---

archive/issue_comments_533444.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nLonger term we will probably want threads enabled anyway (the upstream and most distros default), even if #8784 goes in, so.",
    "created_at": "2022-02-08T01:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533444",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:53" align="right">comment:53</div>

Longer term we will probably want threads enabled anyway (the upstream and most distros default), even if #8784 goes in, so.



---

archive/issue_events_454529.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-08T01:02:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454529"
}
```



---

archive/issue_events_454530.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-08T01:02:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454530"
}
```



---

archive/issue_comments_533445.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nAt first, I thought the branch would disable threads, but actually it is the other way around. If threads had been disabled before, I am surprised the zombie processes use more than 100% cpu.",
    "created_at": "2022-02-08T08:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533445",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:54" align="right">comment:54</div>

At first, I thought the branch would disable threads, but actually it is the other way around. If threads had been disabled before, I am surprised the zombie processes use more than 100% cpu.



---

archive/issue_comments_533446.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThe patch resulted from an observation that a system-wide `ecl` with threads enabled does not produce zombie processes. Probably `sage-cleaner` works better on them.",
    "created_at": "2022-02-08T09:02:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533446",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

The patch resulted from an observation that a system-wide `ecl` with threads enabled does not produce zombie processes. Probably `sage-cleaner` works better on them.



---

archive/issue_comments_533447.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/ecl/nozombies](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/ecl/nozombies)** to **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**",
    "created_at": "2022-02-13T10:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33027#issuecomment-533447",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/packages/ecl/nozombies](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/ecl/nozombies)** to **[abafddc](https://github.com/sagemath/sagetrac-mirror/commit/abafddc33ff85ad50eb67c6532984985a856e882)**



---

archive/issue_events_454531.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-13T10:17:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454531"
}
```



---

archive/issue_events_454532.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "55fd5edb38923183ac0d0b48dc8ed03df5b1d1d1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-02-13T10:17:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33027#event-454532"
}
```
