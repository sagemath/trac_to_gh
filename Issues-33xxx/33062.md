# Issue 33062: GH Actions (docker): Run a job for "make build-local" first, cache image for job "make build"

archive/issues_032825.json:
```json
{
    "body": "Follow up from #32703, where this was implemented for macOS.\n\nHere we implement it for the `docker`-based workflows \nvia incremental builds (#34228) on top of previous stages pushed to ghcr.io\n\n\n\nCC:  @tobiasdiez @dimpase\n\nBranch/Commit: 5713937de7ed72810013e0856b7ac0cca0d9b3e8\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nDependencies: #34115, #34228\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33062\n\n",
    "closed_at": "2022-09-25T16:34:31Z",
    "created_at": "2021-12-21T17:27:28Z",
    "labels": [
        "component: porting",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "GH Actions (docker): Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33062",
    "user": "https://github.com/mkoeppe"
}
```
Follow up from #32703, where this was implemented for macOS.

Here we implement it for the `docker`-based workflows 
via incremental builds (#34228) on top of previous stages pushed to ghcr.io



CC:  @tobiasdiez @dimpase

Branch/Commit: 5713937de7ed72810013e0856b7ac0cca0d9b3e8

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Dependencies: #34115, #34228

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33062





---

archive/issue_comments_499661.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,9 +1,10 @@\n Follow up from #32703, where this was implemented for macOS.\n \n-Here we implement it for the \\`docker\\`-based workflows.\n+Here we implement it for the \\`docker\\`-based workflows by Docker layer caching via ghcr.io\n \n-References\n-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching\n+\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2022-01-30T22:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499661",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,9 +1,10 @@
 Follow up from #32703, where this was implemented for macOS.
 
-Here we implement it for the \`docker\`-based workflows.
+Here we implement it for the \`docker\`-based workflows by Docker layer caching via ghcr.io
 
-References
-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching
+
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_499662.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows by Docker layer caching via ghcr.io\n+\n+(split out from #33222)\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2022-02-05T19:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499662",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,9 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows by Docker layer caching via ghcr.io
+
+(split out from #33222)
+
 
 
 Comment: 1
```




---

archive/issue_comments_499663.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,29 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows by Docker layer caching via ghcr.io\n+\n+To use:\n+\n+\\`\\`\\`\n+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard\n+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s\n+\\`\\`\\`\n+\n+\n+(split out from #33222)\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2022-02-07T00:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499663",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,29 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows by Docker layer caching via ghcr.io
+
+To use:
+
+\`\`\`
+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard
+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s
+\`\`\`
+
+
+(split out from #33222)
+
 
 
 Comment: 1
```




---

archive/issue_comments_499664.json:
```json
{
    "body": "<a id='comment:5'></a>Last 10 new commits:",
    "created_at": "2022-02-07T00:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499664",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Last 10 new commits:



---

archive/issue_comments_499665.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,29 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows by Docker layer caching via ghcr.io\n+\n+To use for local builds via tox:\n+\n+\\`\\`\\`\n+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard\n+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s\n+\\`\\`\\`\n+\n+\n+(split out from #33222)\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2022-02-07T00:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499665",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,29 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows by Docker layer caching via ghcr.io
+
+To use for local builds via tox:
+
+\`\`\`
+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard
+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s
+\`\`\`
+
+
+(split out from #33222)
+
 
 
 Comment: 1
```




---

archive/issue_comments_499666.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T02:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499667.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,30 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows by Docker layer caching via ghcr.io\n+\n+To use for local builds via tox:\n+\n+\\`\\`\\`\n+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard\n+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s\n+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s\n+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s\n+\\`\\`\\`\n+\n+\n+(split out from #33222)\n+\n+We reorganize the CI workflows: \\`ci-linux.yml\\` and \\`ci-macos.yml\\` replace \\`tox.yml\\`, \\`tox-optional.yml\\`, \\`tox-experimental.yml\\`. \n \n \n Comment: 1\n```\n",
    "created_at": "2022-02-07T02:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499667",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,30 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows by Docker layer caching via ghcr.io
+
+To use for local builds via tox:
+
+\`\`\`
+$ DOCKER_BUILDKIT=1 EXTRA_CACHE_FROM_REPOSITORIES=ghcr.io/mkoeppe/sage/ tox -e docker-ubuntu-focal-standard
+ => [internal] load metadata for docker.io/library/ubuntu:focal                                                                                                                                                      0.0s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:dev                                                                                                      1.3s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:9.6.beta0-133-gc9c7d9f8d9                                                                        1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:dev                                                                                                        2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:9.6.beta0-133-gc9c7d9f8d9                                                                                  1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-configured:dev                                                                                                              2.5s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-pre:9.6.beta0-133-gc9c7d9f8d9                                                                            1.6s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:dev                                                                                                            2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets:9.6.beta0-133-gc9c7d9f8d9                                                                                1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:dev                                                                                                   2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-targets-optional:9.6.beta0-133-gc9c7d9f8d9                                                                       1.4s
+ => importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-with-system-packages:dev                                                                                                    2.4s
+ => ERROR importing cache manifest from ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-standard-bootstrapped:9.6.beta0-133-gc9c7d9f8d9                                                                                1.5s
+\`\`\`
+
+
+(split out from #33222)
+
+We reorganize the CI workflows: \`ci-linux.yml\` and \`ci-macos.yml\` replace \`tox.yml\`, \`tox-optional.yml\`, \`tox-experimental.yml\`. 
 
 
 Comment: 1
```




---

archive/issue_comments_499668.json:
```json
{
    "body": "<a id='comment:11'></a>Obviously there is again a lot of cut+paste going on here, but I'm not sure yet whether this is best refactored using (1) scripts to be put in `.ci/`; (2) new top-level `Makefile` targets; (3) reusable workflows in the same repo; (4) reusable workflows from a different repo. So until then, copy+paste it is",
    "created_at": "2022-02-07T02:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499668",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Obviously there is again a lot of cut+paste going on here, but I'm not sure yet whether this is best refactored using (1) scripts to be put in `.ci/`; (2) new top-level `Makefile` targets; (3) reusable workflows in the same repo; (4) reusable workflows from a different repo. So until then, copy+paste it is



---

archive/issue_comments_499669.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T06:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499670.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-07T06:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499670",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_499671.json:
```json
{
    "body": "<a id='comment:14'></a>A lot of jobs are failing because there doesn't exist a corresponding `maximal` image. \n\nWhat is the distinction between the `docker` and `docker-optional` jobs?",
    "created_at": "2022-02-07T12:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499671",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:14'></a>A lot of jobs are failing because there doesn't exist a corresponding `maximal` image. 

What is the distinction between the `docker` and `docker-optional` jobs?



---

archive/issue_comments_499672.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 gh-tobiasdiez]:\n> What is the distinction between the `docker` and `docker-optional` jobs?\n\n\n`docker-optional` also runs the stages that build optional and experimental packages.",
    "created_at": "2022-02-07T16:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499672",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Replying to [comment:14 gh-tobiasdiez]:
> What is the distinction between the `docker` and `docker-optional` jobs?


`docker-optional` also runs the stages that build optional and experimental packages.



---

archive/issue_comments_499673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-07T16:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499673",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_499674.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:14 gh-tobiasdiez]:\n> A lot of jobs are failing because there doesn't exist a corresponding `maximal` image. \n\n\nNot sure if that's it but there are a number of new failures introduced by switching to `DOCKER_BUILDKIT=1`, for example https://github.com/mkoeppe/sage/runs/5087229478?check_suite_focus=true\n\n```\n > [with-system-packages 130/204] RUN zypper --ignore-unknown install --no-confirm --auto-agree-with-licenses --no-recommends --details \"pkgconfig(gf2x)\" || echo \"(ignoring error)\":\n------\nfailed to prepare d4bec9ys962tp15dnd39jkkya: max depth exceeded\n```\n\nThis will require some changes in `build/bin/write-dockerfile.sh`",
    "created_at": "2022-02-07T16:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499674",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Replying to [comment:14 gh-tobiasdiez]:
> A lot of jobs are failing because there doesn't exist a corresponding `maximal` image. 


Not sure if that's it but there are a number of new failures introduced by switching to `DOCKER_BUILDKIT=1`, for example https://github.com/mkoeppe/sage/runs/5087229478?check_suite_focus=true

```
 > [with-system-packages 130/204] RUN zypper --ignore-unknown install --no-confirm --auto-agree-with-licenses --no-recommends --details "pkgconfig(gf2x)" || echo "(ignoring error)":
------
failed to prepare d4bec9ys962tp15dnd39jkkya: max depth exceeded
```

This will require some changes in `build/bin/write-dockerfile.sh`



---

archive/issue_comments_499675.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:15 mkoeppe]:\n> Replying to [comment:14 gh-tobiasdiez]:\n> > What is the distinction between the `docker` and `docker-optional` jobs?\n\n> \n> `docker-optional` also runs the stages that build optional and experimental packages.\n> \n\n\nOkay, thanks! Would it then make sense to base the `docker-optional` on the image created in the `docker` job to speed up the build (i.e. as a \"stage\")?",
    "created_at": "2022-02-07T17:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499675",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'></a>Replying to [comment:15 mkoeppe]:
> Replying to [comment:14 gh-tobiasdiez]:
> > What is the distinction between the `docker` and `docker-optional` jobs?

> 
> `docker-optional` also runs the stages that build optional and experimental packages.
> 


Okay, thanks! Would it then make sense to base the `docker-optional` on the image created in the `docker` job to speed up the build (i.e. as a "stage")?



---

archive/issue_comments_499676.json:
```json
{
    "body": "<a id='comment:19'></a>It's currently using a different package configuration (`-maximal` instead of `-standard`)",
    "created_at": "2022-02-07T18:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499676",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>It's currently using a different package configuration (`-maximal` instead of `-standard`)



---

archive/issue_comments_499677.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 mkoeppe]:\n> It's currently using a different package configuration (`-maximal` instead of `-standard`)\n\n\nBut wasn't your idea with the stages, that the first stage should build all required images (i.e. minimal, standard, maximum) which could then be reused in different ways for the other stages?",
    "created_at": "2022-02-07T21:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499677",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>Replying to [comment:19 mkoeppe]:
> It's currently using a different package configuration (`-maximal` instead of `-standard`)


But wasn't your idea with the stages, that the first stage should build all required images (i.e. minimal, standard, maximum) which could then be reused in different ways for the other stages?



---

archive/issue_comments_499678.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:\n> wasn't your idea with the stages, that the first stage should build all required images (i.e. minimal, standard, maximum) which could then be reused in different ways for the other stages?\n\n\nYes, it is doing that. But it is only building optional packages on top of the `-maximal` configuration, not on top of the other configurations.",
    "created_at": "2022-02-07T22:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499678",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:
> wasn't your idea with the stages, that the first stage should build all required images (i.e. minimal, standard, maximum) which could then be reused in different ways for the other stages?


Yes, it is doing that. But it is only building optional packages on top of the `-maximal` configuration, not on top of the other configurations.



---

archive/issue_comments_499679.json:
```json
{
    "body": "<a id='comment:22'></a>Okay, what confuses me is that it seems to not be part of the \"stage\" design in the sense that it's not using the stage-1 of the normal `docker` job.",
    "created_at": "2022-02-07T22:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499679",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:22'></a>Okay, what confuses me is that it seems to not be part of the "stage" design in the sense that it's not using the stage-1 of the normal `docker` job.



---

archive/issue_comments_499680.json:
```json
{
    "body": "<a id='comment:23'></a>It's using stage-1 of its own docker job because it needs \"maximal\", not \"minimal\"/\"standard\".",
    "created_at": "2022-02-07T22:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499680",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>It's using stage-1 of its own docker job because it needs "maximal", not "minimal"/"standard".



---

archive/issue_comments_499681.json:
```json
{
    "body": "<a id='comment:24'></a>Ah okay, now I understand. And it is not possible to have one common \"stage-1\" that build all three variants?",
    "created_at": "2022-02-07T22:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499681",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>Ah okay, now I understand. And it is not possible to have one common "stage-1" that build all three variants?



---

archive/issue_comments_499682.json:
```json
{
    "body": "<a id='comment:25'></a>GH Actions appears to be running on 8-bit technology: Matrix jobs that would create > 256 jobs are silently dropped from the workflow.",
    "created_at": "2022-02-07T23:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499682",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>GH Actions appears to be running on 8-bit technology: Matrix jobs that would create > 256 jobs are silently dropped from the workflow.



---

archive/issue_comments_499683.json:
```json
{
    "body": "<a id='comment:26'></a>... and 6 stages * 3 packages factors * 46(?) system factors would exceed that.",
    "created_at": "2022-02-07T23:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499683",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>... and 6 stages * 3 packages factors * 46(?) system factors would exceed that.



---

archive/issue_comments_499684.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:\n> ... and 6 stages * 3 packages factors * 46(?) system factors would exceed that.\n\n\nWhy 6 stages? What I meant is that you have one job creating all docker images, then build jobs on top of this. I feel like this design is also more flexible, since you can easily run certain follow up stages only on a subset of configs.",
    "created_at": "2022-02-07T23:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499684",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:
> ... and 6 stages * 3 packages factors * 46(?) system factors would exceed that.


Why 6 stages? What I meant is that you have one job creating all docker images, then build jobs on top of this. I feel like this design is also more flexible, since you can easily run certain follow up stages only on a subset of configs.



---

archive/issue_comments_499685.json:
```json
{
    "body": "<a id='comment:28'></a>2 stages * 3 * 46 also exceeds 256.",
    "created_at": "2022-02-07T23:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499685",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>2 stages * 3 * 46 also exceeds 256.



---

archive/issue_comments_499686.json:
```json
{
    "body": "<a id='comment:29'></a>In any case, the scope of the ticket is to change how it is build (= in 2 stages, to solve the 6-hour timeouts for some platforms).  I am keeping *what* is built/tested the same as before. One ticket, one change.",
    "created_at": "2022-02-08T00:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499686",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>In any case, the scope of the ticket is to change how it is build (= in 2 stages, to solve the 6-hour timeouts for some platforms).  I am keeping *what* is built/tested the same as before. One ticket, one change.



---

archive/issue_comments_499687.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 mkoeppe]:\n> 2 stages * 3 * 46 also exceeds 256.\n\n\nMy point was that you shouldn't use the matrix for stages, so that you don't run into these constraints.\n- Job \"build\": (min, standard, max) for each system (=3 * 46 < 256) - build docker image\n- Job \"test-basic\": (min, standard) for each system - build sage, run tests\n- Job \"test-optional\": max for each system - build sage with optional packages, run tests\n\nThis would also keep what is build and runs in stages.",
    "created_at": "2022-02-08T10:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499687",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:30'></a>Replying to [comment:28 mkoeppe]:
> 2 stages * 3 * 46 also exceeds 256.


My point was that you shouldn't use the matrix for stages, so that you don't run into these constraints.
- Job "build": (min, standard, max) for each system (=3 * 46 < 256) - build docker image
- Job "test-basic": (min, standard) for each system - build sage, run tests
- Job "test-optional": max for each system - build sage with optional packages, run tests

This would also keep what is build and runs in stages.



---

archive/issue_comments_499688.json:
```json
{
    "body": "<a id='comment:31'></a>Job \"build\" does not reliably fit into 6 hours.",
    "created_at": "2022-02-08T18:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499688",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Job "build" does not reliably fit into 6 hours.



---

archive/issue_comments_499689.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 mkoeppe]:\n> Job \"build\" does not reliably fit into 6 hours.\n\n\nYou seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). \n\nIn this case, you can selectively add a second stage for these problematic systems using matrices as in https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#example-including-new-combinations",
    "created_at": "2022-02-08T19:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499689",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:32'></a>Replying to [comment:31 mkoeppe]:
> Job "build" does not reliably fit into 6 hours.


You seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). 

In this case, you can selectively add a second stage for these problematic systems using matrices as in https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#example-including-new-combinations



---

archive/issue_comments_499690.json:
```json
{
    "body": "<a id='comment:33'></a>Another reason for the split into the 2 build stages is explained in the ticket description of #32703.",
    "created_at": "2022-02-08T19:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499690",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Another reason for the split into the 2 build stages is explained in the ticket description of #32703.



---

archive/issue_comments_499691.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:32 gh-tobiasdiez]:\n> you can selectively add a second stage for these problematic systems using matrices\n\n\n-1",
    "created_at": "2022-02-08T19:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499691",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>Replying to [comment:32 gh-tobiasdiez]:
> you can selectively add a second stage for these problematic systems using matrices


-1



---

archive/issue_comments_499692.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:33 mkoeppe]:\n> Another reason for the split into the 2 build stages is explained in the ticket description of #32703.\n> \n\n\nI don't see anything there that would be easier with matrix-stages over job-stages. In the contrary, the design I proposed above can easily be extended using additional jobs (that run on top of \"build\"). While your matrix-stage design would need an additional stage, which is not possible due to 3 stages * 2 configs * 46 systems > 256.",
    "created_at": "2022-02-08T20:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499692",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:35'></a>Replying to [comment:33 mkoeppe]:
> Another reason for the split into the 2 build stages is explained in the ticket description of #32703.
> 


I don't see anything there that would be easier with matrix-stages over job-stages. In the contrary, the design I proposed above can easily be extended using additional jobs (that run on top of "build"). While your matrix-stage design would need an additional stage, which is not possible due to 3 stages * 2 configs * 46 systems > 256.



---

archive/issue_comments_499693.json:
```json
{
    "body": "<a id='comment:36'></a>comment:31",
    "created_at": "2022-02-08T20:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499693",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>comment:31



---

archive/issue_comments_499694.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:32 gh-tobiasdiez]:\n> Replying to [comment:31 mkoeppe]:\n> > Job \"build\" does not reliably fit into 6 hours.\n\n> \n> You seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). \n\n\nNo, that's likely only a sporadic failure.",
    "created_at": "2022-02-08T20:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499694",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Replying to [comment:32 gh-tobiasdiez]:
> Replying to [comment:31 mkoeppe]:
> > Job "build" does not reliably fit into 6 hours.

> 
> You seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). 


No, that's likely only a sporadic failure.



---

archive/issue_comments_499695.json:
```json
{
    "body": "<a id='comment:38'></a>Here is a version where I converted your first stage to a \"prebuild\" job. It runs exactly the same code (except if I made a mistake and missed some hidden environment variables). So the prebuild job timeouts iff if your stage 1 job would time out.\n\nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/1814856715\nhttps://github.com/sagemath/sagetrac-mirror/blob/public/build/refactor-ci-runtests/.github/workflows/ci-docker.yml",
    "created_at": "2022-02-08T23:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499695",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'></a>Here is a version where I converted your first stage to a "prebuild" job. It runs exactly the same code (except if I made a mistake and missed some hidden environment variables). So the prebuild job timeouts iff if your stage 1 job would time out.

https://github.com/sagemath/sagetrac-mirror/actions/runs/1814856715
https://github.com/sagemath/sagetrac-mirror/blob/public/build/refactor-ci-runtests/.github/workflows/ci-docker.yml



---

archive/issue_comments_499696.json:
```json
{
    "body": "<a id='comment:39'></a>OK, so to summarize, the revised plan of comment:30 would be:\n\n- Job \"prebuild\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images\n- Job \"build\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images\n- Job \"test-basic\": (minimal, standard) for each system - build sage, run tests\n- Job \"test-optional\": (maximal) for each system - build sage with optional packages, run tests\n\nThis would work. Minor detail: After this change, prebuild and build would build the union of the platforms currently run for \"standard\" and for \"maximal\". That's a small change, but that would be fine with me.",
    "created_at": "2022-02-09T21:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499696",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>OK, so to summarize, the revised plan of comment:30 would be:

- Job "prebuild": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images
- Job "build": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images
- Job "test-basic": (minimal, standard) for each system - build sage, run tests
- Job "test-optional": (maximal) for each system - build sage with optional packages, run tests

This would work. Minor detail: After this change, prebuild and build would build the union of the platforms currently run for "standard" and for "maximal". That's a small change, but that would be fine with me.



---

archive/issue_comments_499697.json:
```json
{
    "body": "<a id='comment:40'></a>In fact, the first two jobs should probably be named \"targets-pre\" and \"targets\"",
    "created_at": "2022-02-09T21:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499697",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>In fact, the first two jobs should probably be named "targets-pre" and "targets"



---

archive/issue_comments_499698.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:39 mkoeppe]:\n> OK, so to summarize, the revised plan of comment:30 would be:\n> \n> - Job \"prebuild\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images\n> - Job \"build\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images\n> - Job \"test-basic\": (minimal, standard) for each system - build sage, run tests\n> - Job \"test-optional\": (maximal) for each system - build sage with optional packages, run tests\n> \n\n\nYes, that's what I had in mind. And if you extract the current workflow into an reusable workflow and replace the tox command by an input, then this should also be possible without any code duplication (except for the duplicate matrix).",
    "created_at": "2022-02-10T15:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499698",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:41'></a>Replying to [comment:39 mkoeppe]:
> OK, so to summarize, the revised plan of comment:30 would be:
> 
> - Job "prebuild": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images
> - Job "build": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images
> - Job "test-basic": (minimal, standard) for each system - build sage, run tests
> - Job "test-optional": (maximal) for each system - build sage with optional packages, run tests
> 


Yes, that's what I had in mind. And if you extract the current workflow into an reusable workflow and replace the tox command by an input, then this should also be possible without any code duplication (except for the duplicate matrix).



---

archive/issue_comments_499699.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:40 mkoeppe]:\n> In fact, the first two jobs should probably be named \"targets-pre\" and \"targets\" \n\n\nTo be honest, I don't find \"targets\" a very illuminating name.",
    "created_at": "2022-02-10T15:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499699",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:42'></a>Replying to [comment:40 mkoeppe]:
> In fact, the first two jobs should probably be named "targets-pre" and "targets" 


To be honest, I don't find "targets" a very illuminating name.



---

archive/issue_comments_499700.json:
```json
{
    "body": "<a id='comment:43'></a>A \"target\" is what make makes",
    "created_at": "2022-02-10T18:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499700",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>A "target" is what make makes



---

archive/issue_comments_499701.json:
```json
{
    "body": "<a id='comment:44'></a>But why is this information important for the docker images and the ci steps? I find something like `with-system-packages` or `with-python-packages` more descriptive.",
    "created_at": "2022-02-11T08:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499701",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:44'></a>But why is this information important for the docker images and the ci steps? I find something like `with-system-packages` or `with-python-packages` more descriptive.



---

archive/issue_comments_499702.json:
```json
{
    "body": "<a id='comment:45'></a>`with-system-packages` already exists and it's not that",
    "created_at": "2022-02-11T18:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499702",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>`with-system-packages` already exists and it's not that



---

archive/issue_comments_499703.json:
```json
{
    "body": "<a id='comment:46'></a>Consistency matters. Can't invent a new name for the same thing at every turn.",
    "created_at": "2022-02-11T18:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499703",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Consistency matters. Can't invent a new name for the same thing at every turn.



---

archive/issue_comments_499704.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-13T18:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499705.json:
```json
{
    "body": "<a id='comment:48'></a>Rebased",
    "created_at": "2022-02-13T18:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499705",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Rebased



---

archive/issue_comments_499706.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:41 gh-tobiasdiez]:\n> Replying to [comment:39 mkoeppe]:\n> > OK, so to summarize, the revised plan of comment:30 would be:\n> > \n> > - Job \"prebuild\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images\n> > - Job \"build\": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images\n> > - Job \"test-basic\": (minimal, standard) for each system - build sage, run tests\n> > - Job \"test-optional\": (maximal) for each system - build sage with optional packages, run tests\n> > \n\n> \n> Yes, that's what I had in mind. And if you extract the current workflow into an reusable workflow and replace the tox command by an input, then this should also be possible without any code duplication (except for the duplicate matrix).\n\n\nNo objections if you want to do this work. On the present ticket, I don't want to start with reusable workflows though. I have opened #33338 for such refactoring steps.",
    "created_at": "2022-02-13T19:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499706",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Replying to [comment:41 gh-tobiasdiez]:
> Replying to [comment:39 mkoeppe]:
> > OK, so to summarize, the revised plan of comment:30 would be:
> > 
> > - Job "prebuild": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets-pre` images
> > - Job "build": (minimal, standard, maximal) for each system (=3 * 46 < 256) - build `-with-targets` images
> > - Job "test-basic": (minimal, standard) for each system - build sage, run tests
> > - Job "test-optional": (maximal) for each system - build sage with optional packages, run tests
> > 

> 
> Yes, that's what I had in mind. And if you extract the current workflow into an reusable workflow and replace the tox command by an input, then this should also be possible without any code duplication (except for the duplicate matrix).


No objections if you want to do this work. On the present ticket, I don't want to start with reusable workflows though. I have opened #33338 for such refactoring steps.



---

archive/issue_comments_499707.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-13T19:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499708.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T01:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499709.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-14T01:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499710.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-14T04:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499710",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_499711.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:37 mkoeppe]:\n> Replying to [comment:32 gh-tobiasdiez]:\n> > Replying to [comment:31 mkoeppe]:\n> > > Job \"build\" does not reliably fit into 6 hours.\n\n> > \n> > You seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). \n\n> \n> No, that's likely only a sporadic failure.\n\n\nActually it was building too much, fixed now in bfe561f",
    "created_at": "2022-02-14T04:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499711",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>Replying to [comment:37 mkoeppe]:
> Replying to [comment:32 gh-tobiasdiez]:
> > Replying to [comment:31 mkoeppe]:
> > > Job "build" does not reliably fit into 6 hours.

> > 
> > You seem to have the same problem with the current setup as well (e.g. first stage of debian-bookworm fails due timeout). 

> 
> No, that's likely only a sporadic failure.


Actually it was building too much, fixed now in bfe561f



---

archive/issue_comments_499712.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T07:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499713.json:
```json
{
    "body": "<a id='comment:58'></a>`opensuse-15.3-maximal`:\n\n```\n#135 [with-system-packages 130/204] RUN zypper --ignore-unknown install --no-confirm --auto-agree-with-licenses --no-recommends --details \"pkgconfig(gf2x)\" || echo \"(ignoring error)\"\n#135 sha256:da2e30a5ebcf7a7f99e521987cff4345a05792735e3866c4f70a29402e19512e\n#135 ERROR: failed to prepare 956694vunjg38oyu4pzr7kgxx: max depth exceeded\n```\nHere `build/bin/write-dockerfile.sh` uses too many `RUN` commands because `$EXISTS` is not defined",
    "created_at": "2022-02-14T17:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499713",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>`opensuse-15.3-maximal`:

```
#135 [with-system-packages 130/204] RUN zypper --ignore-unknown install --no-confirm --auto-agree-with-licenses --no-recommends --details "pkgconfig(gf2x)" || echo "(ignoring error)"
#135 sha256:da2e30a5ebcf7a7f99e521987cff4345a05792735e3866c4f70a29402e19512e
#135 ERROR: failed to prepare 956694vunjg38oyu4pzr7kgxx: max depth exceeded
```
Here `build/bin/write-dockerfile.sh` uses too many `RUN` commands because `$EXISTS` is not defined



---

archive/issue_comments_499714.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-14T17:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499714",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_499715.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T22:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499716.json:
```json
{
    "body": "<a id='comment:60'></a>Also caching still does not seem to work reliably.\n\nFor example, https://github.com/mkoeppe/sage/runs/5178183571?check_suite_focus=true has pushed like `ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-minimal-configured:9.5-81701-ge8de33c091`, and https://github.com/mkoeppe/sage/runs/5178187220?check_suite_focus=true is able to download it; but it proceeds to build everything from scratch, which leads to the 6h-timeout",
    "created_at": "2022-02-14T22:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499716",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Also caching still does not seem to work reliably.

For example, https://github.com/mkoeppe/sage/runs/5178183571?check_suite_focus=true has pushed like `ghcr.io/mkoeppe/sage/sage-docker-ubuntu-focal-minimal-configured:9.5-81701-ge8de33c091`, and https://github.com/mkoeppe/sage/runs/5178187220?check_suite_focus=true is able to download it; but it proceeds to build everything from scratch, which leads to the 6h-timeout



---

archive/issue_comments_499717.json:
```json
{
    "body": "<a id='comment:61'></a>Maybe use the github workflow run id as the docker tag?",
    "created_at": "2022-02-15T12:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499717",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:61'></a>Maybe use the github workflow run id as the docker tag?



---

archive/issue_comments_499718.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-15T17:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499719.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:61 gh-tobiasdiez]:\n> Maybe use the github workflow run id as the docker tag?\n\nI think this was not the problem",
    "created_at": "2022-02-15T19:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499719",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>Replying to [comment:61 gh-tobiasdiez]:
> Maybe use the github workflow run id as the docker tag?

I think this was not the problem



---

archive/issue_comments_499720.json:
```json
{
    "body": "<a id='comment:65'></a>Still broken - e.g. https://github.com/mkoeppe/sage/runs/5204591833?check_suite_focus=true",
    "created_at": "2022-02-16T19:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499720",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>Still broken - e.g. https://github.com/mkoeppe/sage/runs/5204591833?check_suite_focus=true



---

archive/issue_events_087361.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:45:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33062#event-87361"
}
```



---

archive/issue_comments_499721.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-28T04:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_499722.json:
```json
{
    "body": "<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-28T06:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499723.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows \n+via incremental builds (#34228) on top of previous stages pushed to ghcr.io\n \n \n Comment: 1\n```\n",
    "created_at": "2022-07-28T06:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499723",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,7 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows 
+via incremental builds (#34228) on top of previous stages pushed to ghcr.io
 
 
 Comment: 1
```




---

archive/issue_comments_499724.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-28T23:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499725.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-28T23:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499726.json:
```json
{
    "body": "<a id='comment:76'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-29T10:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499727.json:
```json
{
    "body": "<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-01T06:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499727",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_499728.json:
```json
{
    "body": "<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T06:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499729.json:
```json
{
    "body": "<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T06:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499730.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-01T06:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499730",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_499731.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+Follow up from #32703, where this was implemented for macOS.\n+\n+Here we implement it for the \\`docker\\`-based workflows \n+via incremental builds (#34228) on top of previous stages pushed to ghcr.io\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2022-08-01T06:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499731",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+Follow up from #32703, where this was implemented for macOS.
+
+Here we implement it for the \`docker\`-based workflows 
+via incremental builds (#34228) on top of previous stages pushed to ghcr.io
+
 
 
 Comment: 1
```




---

archive/issue_comments_499732.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-03T04:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499732",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_499733.json:
```json
{
    "body": "<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-03T05:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_499734.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-03T06:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499734",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_499735.json:
```json
{
    "body": "<a id='comment:85'></a>Marking it as critical because it is a dependency of #34266",
    "created_at": "2022-09-19T16:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499735",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'></a>Marking it as critical because it is a dependency of #34266



---

archive/issue_comments_499736.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-09-19T16:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499736",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_events_087362.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33062#event-87362"
}
```



---

archive/issue_events_087363.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33062#event-87363"
}
```



---

archive/issue_comments_499737.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-21T15:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499737",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_499738.json:
```json
{
    "body": "<a id='comment:87'></a>lgtm",
    "created_at": "2022-09-21T15:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499738",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:87'></a>lgtm



---

archive/issue_comments_499739.json:
```json
{
    "body": "<a id='comment:88'></a>Thanks!",
    "created_at": "2022-09-21T15:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499739",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:88'></a>Thanks!



---

archive/issue_events_087364.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-25T16:34:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33062#event-87364"
}
```



---

archive/issue_comments_499740.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-25T16:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33062#issuecomment-499740",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
