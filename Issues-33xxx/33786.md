# Issue 33786: Top-level sage script: Unconditionally set SAGE_ROOT

archive/issues_033549.json:
```json
{
    "body": "This will make it more robust when accidentally invoked from a sage shell inside another Sage installation.\n\nRelated to https://groups.google.com/g/sage-release/c/GOGWk66zaCQ/m/0o9KtVDIAAAJ\n\nCC:  @dimpase @orlitzky @jhpalmieri\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nBranch: 01caa38de213af25a1ba6501e5419d35ca711561\n\nDependencies: #33787\n\nCommit: 01caa38de213af25a1ba6501e5419d35ca711561\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33786\n\n",
    "closed_at": "2022-05-24T22:45:01Z",
    "created_at": "2022-05-02T16:54:16Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Top-level sage script: Unconditionally set SAGE_ROOT",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33786",
    "user": "https://github.com/mkoeppe"
}
```
This will make it more robust when accidentally invoked from a sage shell inside another Sage installation.

Related to https://groups.google.com/g/sage-release/c/GOGWk66zaCQ/m/0o9KtVDIAAAJ

CC:  @dimpase @orlitzky @jhpalmieri

Reviewer: John Palmieri

Author: Matthias Koeppe

Branch: 01caa38de213af25a1ba6501e5419d35ca711561

Dependencies: #33787

Commit: 01caa38de213af25a1ba6501e5419d35ca711561

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33786





---

archive/issue_events_088761.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-02T21:03:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33786#event-88761"
}
```



---

archive/issue_comments_476954.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2022-05-02T21:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476954",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_476955.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-02T21:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476955",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_476956.json:
```json
{
    "body": "<a id='comment:5'></a>It looks like this doesn't change the behavior of `SAGE_ROOT/sage`, just the documentation. Is that correct?",
    "created_at": "2022-05-10T23:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476956",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>It looks like this doesn't change the behavior of `SAGE_ROOT/sage`, just the documentation. Is that correct?



---

archive/issue_comments_476957.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-10T23:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476957",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_476958.json:
```json
{
    "body": "<a id='comment:6'></a>Looks like I forgot to push a commit",
    "created_at": "2022-05-10T23:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476958",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Looks like I forgot to push a commit



---

archive/issue_comments_476959.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-10T23:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_476960.json:
```json
{
    "body": "<a id='comment:8'></a>Here it is",
    "created_at": "2022-05-10T23:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476960",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Here it is



---

archive/issue_comments_476961.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-10T23:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476961",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_476962.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-10T23:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_476963.json:
```json
{
    "body": "<a id='comment:10'></a>How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break? Should we deprecate the setting of `SAGE_ROOT` first?\n\n```\nif [ -z \"$SAGE_ROOT\" ];  then\n   ...\nelse\n   (print deprecation warning)\nfi\n```",
    "created_at": "2022-05-11T05:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476963",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break? Should we deprecate the setting of `SAGE_ROOT` first?

```
if [ -z "$SAGE_ROOT" ];  then
   ...
else
   (print deprecation warning)
fi
```



---

archive/issue_comments_476964.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 jhpalmieri]:\n> How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break?\n\n\nI don't think this change can break anyone's installation if that was done using the old instructions (\"system-wide install\"):\n- the first variant, using symlinks, still works (we just don't advertise it any more)\n\n- in the second variant, using a copy of the script, there's no problem because users were instructed to make the change (setting SAGE_ROOT) in the copy, not in the original. Their old copy will continue to work. If they attempt to copy and make the change again, they will see that there is no longer a place that prompts them to make the change.",
    "created_at": "2022-05-11T05:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476964",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:10 jhpalmieri]:
> How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break?


I don't think this change can break anyone's installation if that was done using the old instructions ("system-wide install"):
- the first variant, using symlinks, still works (we just don't advertise it any more)

- in the second variant, using a copy of the script, there's no problem because users were instructed to make the change (setting SAGE_ROOT) in the copy, not in the original. Their old copy will continue to work. If they attempt to copy and make the change again, they will see that there is no longer a place that prompts them to make the change.



---

archive/issue_comments_476965.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-12T03:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476965",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_476966.json:
```json
{
    "body": "<a id='comment:12'></a>Okay, let's merge it (in 9.7).",
    "created_at": "2022-05-12T03:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476966",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Okay, let's merge it (in 9.7).



---

archive/issue_comments_476967.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks!",
    "created_at": "2022-05-12T04:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476967",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Thanks!



---

archive/issue_events_088762.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-24T22:45:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33786#event-88762"
}
```



---

archive/issue_comments_476968.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-24T22:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33786#issuecomment-476968",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
