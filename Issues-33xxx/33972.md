# Issue 33972: Another error in height_difference_bound

archive/issues_033735.json:
```json
{
    "body": "Similar to #33971, the height of a polynomial is not typically the max of the heights of the coefficients. In this application the height of the polynomial should be the height of the coefficients if they are thought of as a projective point (i.e., the height is independent of scaling). This is sometimes called the \"projective\" height of a polynomial. However, this function is computing `h(g_i)` as the max of the heights of the coefficients of `g_i`.\n\n```\nfor k in range(N + 1):\n    CoeffPolys = (CR.gen(k) ** D).lift(I)\n    h = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])\n    maxh = max(maxh, h)\n```\n\n\nCC:  @bhutz @enderwannabe\n\nKeywords: gsoc2022\n\nBranch/Commit: 97ae98d43829256ae7b7cfa509c2aa569bcd648d\n\nReviewer: Ben Hutz\n\nAuthor: Jing Guo\n\nDependencies: #34175\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33972\n\n",
    "closed_at": "2022-08-30T19:04:55Z",
    "created_at": "2022-06-10T11:51:29Z",
    "labels": [
        "component: dynamics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Another error in height_difference_bound",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33972",
    "user": "https://github.com/guojing0"
}
```
Similar to #33971, the height of a polynomial is not typically the max of the heights of the coefficients. In this application the height of the polynomial should be the height of the coefficients if they are thought of as a projective point (i.e., the height is independent of scaling). This is sometimes called the "projective" height of a polynomial. However, this function is computing `h(g_i)` as the max of the heights of the coefficients of `g_i`.

```
for k in range(N + 1):
    CoeffPolys = (CR.gen(k) ** D).lift(I)
    h = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])
    maxh = max(maxh, h)
```


CC:  @bhutz @enderwannabe

Keywords: gsoc2022

Branch/Commit: 97ae98d43829256ae7b7cfa509c2aa569bcd648d

Reviewer: Ben Hutz

Author: Jing Guo

Dependencies: #34175

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33972





---

archive/issue_comments_512574.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Similiar to #33971, the height of a polynomial is not the max of the heights of the coefficients. However, it is computing \\`h(g_i)\\` as the max of the heights of the coefficients of \\`g_i\\`.\n+Similar to #33971, the height of a polynomial is not typically the max of the heights of the coefficients. In this application the height of the polynomial should be the height of the coefficients if they are thought of as a projective point (i.e., the height is independent of scaling). This is sometimes called the \"projective\" height of a polynomial. However, this function is computing \\`h(g_i)\\` as the max of the heights of the coefficients of \\`g_i\\`.\n \n \\`\\`\\`\n for k in range(N + 1):\n@@ -7,6 +7,7 @@\n     maxh = max(maxh, h)\n \\`\\`\\`\n \n+\n Author: Jing Guo\n \n Comment: 1\n```\n",
    "created_at": "2022-06-10T16:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512574",
    "user": "https://github.com/bhutz"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Similiar to #33971, the height of a polynomial is not the max of the heights of the coefficients. However, it is computing \`h(g_i)\` as the max of the heights of the coefficients of \`g_i\`.
+Similar to #33971, the height of a polynomial is not typically the max of the heights of the coefficients. In this application the height of the polynomial should be the height of the coefficients if they are thought of as a projective point (i.e., the height is independent of scaling). This is sometimes called the "projective" height of a polynomial. However, this function is computing \`h(g_i)\` as the max of the heights of the coefficients of \`g_i\`.
 
 \`\`\`
 for k in range(N + 1):
@@ -7,6 +7,7 @@
     maxh = max(maxh, h)
 \`\`\`
 
+
 Author: Jing Guo
 
 Comment: 1
```




---

archive/issue_comments_512575.json:
```json
{
    "body": "<a id='comment:1'></a>It may makes sense to first implement a height function for polynomials and then use that height function in height_difference_bound",
    "created_at": "2022-06-10T16:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512575",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:1'></a>It may makes sense to first implement a height function for polynomials and then use that height function in height_difference_bound



---

archive/issue_comments_512576.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2022-07-05T14:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512576",
    "user": "https://github.com/guojing0"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_512577.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-05T14:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512577",
    "user": "https://github.com/guojing0"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_512578.json:
```json
{
    "body": "<a id='comment:6'></a>Update with latest code from polynomial height.\n\n---\nNew commits:",
    "created_at": "2022-07-08T07:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512578",
    "user": "https://github.com/guojing0"
}
```

<a id='comment:6'></a>Update with latest code from polynomial height.

---
New commits:



---

archive/issue_comments_512579.json:
```json
{
    "body": "<a id='comment:7'></a>Only failure (with actual return value `2.9957322...`):\n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ, 1)\nsage: f = DynamicalSystem([5*x^2 + 3*x*y , y^2 + 3*x^2])\nsage: f.height_difference_bound(prec=100)\n5.3375380797013179737224159274\n```",
    "created_at": "2022-07-08T07:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512579",
    "user": "https://github.com/guojing0"
}
```

<a id='comment:7'></a>Only failure (with actual return value `2.9957322...`):

```
sage: P.<x,y> = ProjectiveSpace(QQ, 1)
sage: f = DynamicalSystem([5*x^2 + 3*x*y , y^2 + 3*x^2])
sage: f.height_difference_bound(prec=100)
5.3375380797013179737224159274
```



---

archive/issue_comments_512580.json:
```json
{
    "body": "<a id='comment:8'></a>This change is wrong:\n\n```\n-        CR = f.domain().coordinate_ring()\n-        I = CR.ideal(f.defining_polynomials())\n-        maxh = 0\n-        for k in range(N + 1):\n-            CoeffPolys = (CR.gen(k) ** D).lift(I)\n-            h = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])\n-            maxh = max(maxh, h)\n-        L = R((N + 1) * binomial(N + D - d, D - d)).log() + maxh\n+        L = R((N + 1) * binomial(N + D - d, D - d)).log() + f.global_height(prec)\n```\n\nThe error of the existing code is the line\n\n```\nh = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])\n```\nWhat is wrong is that it is taking the height of g to be the max of the height of its coefficients. You still need to take maxh to be the max of the heights of the CoeffPolys, but the correction is to use the new height code (#34060) to compute the heights of each g.",
    "created_at": "2022-07-11T13:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512580",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>This change is wrong:

```
-        CR = f.domain().coordinate_ring()
-        I = CR.ideal(f.defining_polynomials())
-        maxh = 0
-        for k in range(N + 1):
-            CoeffPolys = (CR.gen(k) ** D).lift(I)
-            h = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])
-            maxh = max(maxh, h)
-        L = R((N + 1) * binomial(N + D - d, D - d)).log() + maxh
+        L = R((N + 1) * binomial(N + D - d, D - d)).log() + f.global_height(prec)
```

The error of the existing code is the line

```
h = max([c.global_height(prec) for g in CoeffPolys for c in (g).coefficients()])
```
What is wrong is that it is taking the height of g to be the max of the height of its coefficients. You still need to take maxh to be the max of the heights of the CoeffPolys, but the correction is to use the new height code (#34060) to compute the heights of each g.



---

archive/issue_comments_512581.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-11T13:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512581",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_512582.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-12T12:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_512583.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-13T11:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_512584.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-13T11:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512584",
    "user": "https://github.com/guojing0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_512585.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-13T13:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_512586.json:
```json
{
    "body": "<a id='comment:13'></a>This looks fine at this point. The difference in the examples is because of correcting the height of the ``g'' polynomials. They are monomials in these examples, so have (logarithmic) height 0 rather than the height of the coefficient.\n\nSo I'll mark this positive modulo any issues that show up when the dependency gets merged.",
    "created_at": "2022-07-26T15:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512586",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>This looks fine at this point. The difference in the examples is because of correcting the height of the ``g'' polynomials. They are monomials in these examples, so have (logarithmic) height 0 rather than the height of the coefficient.

So I'll mark this positive modulo any issues that show up when the dependency gets merged.



---

archive/issue_comments_512587.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-26T15:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512587",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_512588.json:
```json
{
    "body": "<a id='comment:14'></a>\n```\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 2116, in sage.dynamics.arithmetic_dynamics.projective_ds.?.height_difference_bound\nFailed example:\n    f.height_difference_bound()\nExpected:\n    11.0020998412042\nGot:\n    10.3089526606443\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 2128, in sage.dynamics.arithmetic_dynamics.projective_ds.?.height_difference_bound\nFailed example:\n    f.height_difference_bound()\nExpected:\n    11.0020998412042\nGot:\n    11.3683039374269\n\nq^CKilling test src/sage/dynamics/arithmetic_dynamics/projective_ds.py\n----------------------------------------------------------------------\nDoctests interrupted: 0/1 files tested\n----------------------------------------------------------------------\n```",
    "created_at": "2022-08-05T20:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512588",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>
```
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 2116, in sage.dynamics.arithmetic_dynamics.projective_ds.?.height_difference_bound
Failed example:
    f.height_difference_bound()
Expected:
    11.0020998412042
Got:
    10.3089526606443
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 2128, in sage.dynamics.arithmetic_dynamics.projective_ds.?.height_difference_bound
Failed example:
    f.height_difference_bound()
Expected:
    11.0020998412042
Got:
    11.3683039374269

q^CKilling test src/sage/dynamics/arithmetic_dynamics/projective_ds.py
----------------------------------------------------------------------
Doctests interrupted: 0/1 files tested
----------------------------------------------------------------------
```



---

archive/issue_comments_512589.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-08-05T20:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512589",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_512590.json:
```json
{
    "body": "<a id='comment:15'></a>I'm also getting these errors on a clean branch. The first one is in the example\n\n```\n            sage: P.<x,y,z> = ProjectiveSpace(ZZ, 2)\n            sage: f = DynamicalSystem_projective([4*x^2 + 100*y^2, 210*x*y, 10000*z^2])\n            sage: f.height_difference_bound()\n            11.0020998412042\n            sage: f.normalize_coordinates()\n            sage: f.height_difference_bound()\n            10.3089526606443\n```\nIt doesn't make sense to keep .normalize in here anymore as the height of the polynomials is independent of the normalization. The 10.308... is the correct value. So condense this example down to a single (correct) value.\n\nThe second failure is just the wrong value.",
    "created_at": "2022-08-10T17:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512590",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:15'></a>I'm also getting these errors on a clean branch. The first one is in the example

```
            sage: P.<x,y,z> = ProjectiveSpace(ZZ, 2)
            sage: f = DynamicalSystem_projective([4*x^2 + 100*y^2, 210*x*y, 10000*z^2])
            sage: f.height_difference_bound()
            11.0020998412042
            sage: f.normalize_coordinates()
            sage: f.height_difference_bound()
            10.3089526606443
```
It doesn't make sense to keep .normalize in here anymore as the height of the polynomials is independent of the normalization. The 10.308... is the correct value. So condense this example down to a single (correct) value.

The second failure is just the wrong value.



---

archive/issue_comments_512591.json:
```json
{
    "body": "<a id='comment:16'></a>Build and pass all tests on the new branch based on the latest `develop` branch.\n\n---\nNew commits:",
    "created_at": "2022-08-11T08:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512591",
    "user": "https://github.com/guojing0"
}
```

<a id='comment:16'></a>Build and pass all tests on the new branch based on the latest `develop` branch.

---
New commits:



---

archive/issue_comments_512592.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-11T08:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512592",
    "user": "https://github.com/guojing0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_512593.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-11T18:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512593",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_512594.json:
```json
{
    "body": "<a id='comment:17'></a>This looks fine and the tests pass for me.\n\nIn the future it's better to edit the existing ticket to fix the issues rather than create a whole new branch that erases the history.",
    "created_at": "2022-08-11T18:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512594",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>This looks fine and the tests pass for me.

In the future it's better to edit the existing ticket to fix the issues rather than create a whole new branch that erases the history.



---

archive/issue_comments_512595.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-30T19:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33972#issuecomment-512595",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088981.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-30T19:04:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33972",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33972#event-88981"
}
```
