# Issue 33424: Don't test files created by jupyter-sphinx

archive/issues_033424.json:
```json
{
    "body": "CC:  @mkoeppe @kiwifb\n\n`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:\n\n```\nsage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py\n    SyntaxError in doctesting framework\n**********************************************************************\nTraceback (most recent call last):\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2490, in __call__\n    doctests, extras = self._run(runner, options, results)\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2538, in _run\n    doctests, extras = self.source.create_doctests(sage_namespace)\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/sources.py\", line 751, in create_doctests\n    load(filename, namespace) # errors raised here will be caught in DocTestTask\n  File \"/usr/lib/python3.10/site-packages/sage/repl/load.py\", line 251, in load\n    code = compile(f.read(), fpath, 'exec')\n  File \"./plot3d.py\", line 278\n    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]\n    ^^^^^^^^^^^^^^^^^^^^^^^^\nSyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/33661\n\n",
    "closed_at": "2022-04-10T13:12:50Z",
    "created_at": "2022-04-08T18:53:31Z",
    "labels": [
        "component: doctest framework",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Don't test files created by jupyter-sphinx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33424",
    "user": "https://github.com/antonio-rojas"
}
```
CC:  @mkoeppe @kiwifb

`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:

```
sage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py
    SyntaxError in doctesting framework
**********************************************************************
Traceback (most recent call last):
  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2490, in __call__
    doctests, extras = self._run(runner, options, results)
  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2538, in _run
    doctests, extras = self.source.create_doctests(sage_namespace)
  File "/usr/lib/python3.10/site-packages/sage/doctest/sources.py", line 751, in create_doctests
    load(filename, namespace) # errors raised here will be caught in DocTestTask
  File "/usr/lib/python3.10/site-packages/sage/repl/load.py", line 251, in load
    code = compile(f.read(), fpath, 'exec')
  File "./plot3d.py", line 278
    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]
    ^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?
```

Issue created by migration from https://trac.sagemath.org/ticket/33661





---

archive/issue_comments_475245.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to doctest framework.",
    "created_at": "2022-04-08T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475245",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to doctest framework.



---

archive/issue_comments_475246.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-04-08T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475246",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_475247.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-08T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475247",
    "user": "https://github.com/antonio-rojas"
}
```

New commits:



---

archive/issue_comments_475248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-08T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475248",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T19:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475250.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-04-08T19:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475250",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_475251.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-08T19:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475251",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475252.json:
```json
{
    "body": "That's one of those things, I am surprised it only becomes apparent now. I historically had that issue before the use of `jupyter_sphinx` in sage-on-gentoo. For some reason some python files are left over from all the plots. And I don't know how they are avoided in vanilla sage. So, I am just removing them before install.\n\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/sage-doc-9999.ebuild#L137\n\nhttps://github.com/cschwan/sage-on-gentoo/issues/402\n\nMy net above is sufficiently wide that it probably caught all those `jupyter_sphinx` files and I never noticed. I never quite got to the bottom of why I had those files in the first place, but they shouldn't be installed and neither should those.",
    "created_at": "2022-04-08T19:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475252",
    "user": "https://github.com/kiwifb"
}
```

That's one of those things, I am surprised it only becomes apparent now. I historically had that issue before the use of `jupyter_sphinx` in sage-on-gentoo. For some reason some python files are left over from all the plots. And I don't know how they are avoided in vanilla sage. So, I am just removing them before install.

https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/sage-doc-9999.ebuild#L137

https://github.com/cschwan/sage-on-gentoo/issues/402

My net above is sufficiently wide that it probably caught all those `jupyter_sphinx` files and I never noticed. I never quite got to the bottom of why I had those files in the first place, but they shouldn't be installed and neither should those.



---

archive/issue_comments_475253.json:
```json
{
    "body": "I had never tested the docs dir before `sage -t --installed` was introduced, so never noticed that. Anyway, that seems to have been fixed at some point - the only py files installed with docs in 9.6.beta7 are\n\n```\n/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py\n/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/repl/ipython_kernel/interact.py\n```",
    "created_at": "2022-04-08T20:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475253",
    "user": "https://github.com/antonio-rojas"
}
```

I had never tested the docs dir before `sage -t --installed` was introduced, so never noticed that. Anyway, that seems to have been fixed at some point - the only py files installed with docs in 9.6.beta7 are

```
/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py
/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/repl/ipython_kernel/interact.py
```



---

archive/issue_comments_475254.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-10T13:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33424#issuecomment-475254",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088505.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-10T13:12:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33424",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33424#event-88505"
}
```
