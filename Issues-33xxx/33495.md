# Issue 33495: Fix tests with networkx 2.7

archive/issues_033258.json:
```json
{
    "body": "The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:\n\n```\nsage: G=graphs.CompleteGraph(4)\nsage: m=G.matching(); m\n[(1, 2, None), (0, 3, None)]\nsage: (3, 0, None) in m\nFalse\n```\n\nAlso, `networkx.node_clique_number` now outputs a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.\n\nCC:  @mkoeppe @kiwifb @tornaria\n\nBranch/Commit: 8452003846a7303100847d8d0ed642fc642c11d6\n\nReviewer: David Coudert\n\nAuthor: Antonio Rojas\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33495\n\n",
    "closed_at": "2022-03-27T15:43:57Z",
    "created_at": "2022-03-13T14:05:14Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Fix tests with networkx 2.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33495",
    "user": "https://github.com/antonio-rojas"
}
```
The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:

```
sage: G=graphs.CompleteGraph(4)
sage: m=G.matching(); m
[(1, 2, None), (0, 3, None)]
sage: (3, 0, None) in m
False
```

Also, `networkx.node_clique_number` now outputs a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.

CC:  @mkoeppe @kiwifb @tornaria

Branch/Commit: 8452003846a7303100847d8d0ed642fc642c11d6

Reviewer: David Coudert

Author: Antonio Rojas

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33495





---

archive/issue_comments_505745.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2022-03-13T14:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505745",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_505746.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2022-03-13T14:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505746",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_505747.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:\n \n+```\n+sage: G=graphs.CompleteGraph(4)\n+sage: m=G.matching(); m\n+[(1, 2, None), (0, 3, None)]\n+sage: (3, 0, None) in m\n+False\n+```\n+\n+Also, `networkx.node_clique_number` now defaults a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.\n \n Comment: 1\n \n```\n",
    "created_at": "2022-03-13T14:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505747",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:
 
+```
+sage: G=graphs.CompleteGraph(4)
+sage: m=G.matching(); m
+[(1, 2, None), (0, 3, None)]
+sage: (3, 0, None) in m
+False
+```
+
+Also, `networkx.node_clique_number` now defaults a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.
 
 Comment: 1
 
```




---

archive/issue_comments_505748.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-13T14:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505748",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_505749.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-03-13T14:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505749",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_505750.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:\n \n+```\n+sage: G=graphs.CompleteGraph(4)\n+sage: m=G.matching(); m\n+[(1, 2, None), (0, 3, None)]\n+sage: (3, 0, None) in m\n+False\n+```\n+\n+Also, `networkx.node_clique_number` now outputs a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.\n \n Comment: 1\n \n```\n",
    "created_at": "2022-03-13T14:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505750",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+The output of `matching` displays edges in reverse order in 2.7, which break tests. To fix it, we make the output of `matching` and `Edgesview`, which also fixes some other issues, such as:
 
+```
+sage: G=graphs.CompleteGraph(4)
+sage: m=G.matching(); m
+[(1, 2, None), (0, 3, None)]
+sage: (3, 0, None) in m
+False
+```
+
+Also, `networkx.node_clique_number` now outputs a `collections.defaultdict` object, so we explicitly cast it to `dict` for backwards compatibility.
 
 Comment: 1
 
```




---

archive/issue_comments_505751.json:
```json
{
    "body": "<a id='comment:4'></a>You should\n-  specify the input format to `Graph` to reduce the overhead of building the graph before returning the result.\n\n```diff\n-                return EdgesView(Graph([(u, v, L[frozenset((u, v))]) for u, v in d]))\n+                return EdgesView(Graph([(u, v, L[frozenset((u, v))]) for u, v in d], format='list_of_edges'))\n```\n- update the documentation to clarify that the output is now a `EdgesView`\n- modify a doctest to show that the result is of type `EdgesView`, for instance like\n\n```diff\n-            sage: sorted(g.matching(use_edge_labels=True))\n-            [(0, 3, 3), (1, 2, 6)]\n+            sage: m = g.matching(use_edge_labels=True)\n+            sage: type(m)\n+            <class 'sage.graphs.views.EdgesView'>\n+            sage: sorted(m)\n+            [(0, 3, 3), (1, 2, 6)]\n```",
    "created_at": "2022-03-14T09:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505751",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>You should
-  specify the input format to `Graph` to reduce the overhead of building the graph before returning the result.

```diff
-                return EdgesView(Graph([(u, v, L[frozenset((u, v))]) for u, v in d]))
+                return EdgesView(Graph([(u, v, L[frozenset((u, v))]) for u, v in d], format='list_of_edges'))
```
- update the documentation to clarify that the output is now a `EdgesView`
- modify a doctest to show that the result is of type `EdgesView`, for instance like

```diff
-            sage: sorted(g.matching(use_edge_labels=True))
-            [(0, 3, 3), (1, 2, 6)]
+            sage: m = g.matching(use_edge_labels=True)
+            sage: type(m)
+            <class 'sage.graphs.views.EdgesView'>
+            sage: sorted(m)
+            [(0, 3, 3), (1, 2, 6)]
```



---

archive/issue_comments_505752.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-14T20:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_505753.json:
```json
{
    "body": "<a id='comment:6'></a>Done, thanks",
    "created_at": "2022-03-14T20:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505753",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:6'></a>Done, thanks



---

archive/issue_comments_505754.json:
```json
{
    "body": "<a id='comment:7'></a>LGTM.",
    "created_at": "2022-03-15T07:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505754",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>LGTM.



---

archive/issue_comments_505755.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-15T07:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505755",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_505756.json:
```json
{
    "body": "<a id='comment:8'></a>Follow-up: #33520",
    "created_at": "2022-03-17T19:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505756",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Follow-up: #33520



---

archive/issue_comments_505757.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33495#issuecomment-505757",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088232.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-27T15:43:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33495",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33495#event-88232"
}
```
