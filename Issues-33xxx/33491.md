# Issue 33491: fix usage of Matplotlib color maps

archive/issues_033254.json:
```json
{
    "body": "Matplotlib used to have a global dictionary of color maps. By now, it is considered internal API and does not contain newer color maps anymore, so some of them cannot be used in Sage:\n\n```\nsage: density_plot(x, (-1,1), (-1,1), cmap='turbo')\n/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:608: RichReprWarning: Exception in _rich_repr_ while displaying object:\nColor map turbo not known (type import matplotlib.cm; matplotlib.cm.datad.keys() for valid names)\n```\n\n\nCC:  @tscrim davidlowry\n\nKeywords: matplotlib\n\nReviewer: Travis Scrimshaw\n\nAuthor: Markus Wageringel\n\nBranch: 2022ed60966d4b2357c032201ca8f7c6044e43fa\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33491\n\n",
    "closed_at": "2022-03-27T15:43:19Z",
    "created_at": "2022-03-11T17:56:28Z",
    "labels": [
        "component: graphics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "fix usage of Matplotlib color maps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33491",
    "user": "https://github.com/mwageringel"
}
```
Matplotlib used to have a global dictionary of color maps. By now, it is considered internal API and does not contain newer color maps anymore, so some of them cannot be used in Sage:

```
sage: density_plot(x, (-1,1), (-1,1), cmap='turbo')
/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:608: RichReprWarning: Exception in _rich_repr_ while displaying object:
Color map turbo not known (type import matplotlib.cm; matplotlib.cm.datad.keys() for valid names)
```


CC:  @tscrim davidlowry

Keywords: matplotlib

Reviewer: Travis Scrimshaw

Author: Markus Wageringel

Branch: 2022ed60966d4b2357c032201ca8f7c6044e43fa

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33491





---

archive/issue_comments_667567.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667567",
    "user": "https://github.com/mwageringel"
}
```

Changing priority from major to minor.



---

archive/issue_comments_667568.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mwageringel/33491\"",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667568",
    "user": "https://github.com/mwageringel"
}
```

Changing branch from "" to "u/gh-mwageringel/33491"



---

archive/issue_comments_667569.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667569",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_667570.json:
```json
{
    "body": "Changing commit from \"\" to \"2022ed60966d4b2357c032201ca8f7c6044e43fa\"",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667570",
    "user": "https://github.com/mwageringel"
}
```

Changing commit from "" to "2022ed60966d4b2357c032201ca8f7c6044e43fa"



---

archive/issue_comments_667571.json:
```json
{
    "body": "Changing author from \"\" to \"Markus Wageringel\"",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667571",
    "user": "https://github.com/mwageringel"
}
```

Changing author from "" to "Markus Wageringel"



---

archive/issue_comments_667572.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis branch obtains the colormaps from `matplotlib.colormaps` instead of `matplotlib.cm`.\n\nI have removed the module-wide `cm` variable as I do not see a purpose of it. The code is more than 10 years old, so it is probably not related to modularization. My best guess is that it has to do with lazy imports in Python 2.\n\nIn the long run, we can also consider removing Sage's `Colormaps` collection and replace it by Matplotlib functionality, since Matplotlib already has support for registering new color maps.\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[2022ed6](https://git.sagemath.org/sage.git/commit?id=2022ed60966d4b2357c032201ca8f7c6044e43fa)|`33491: fix usage of matplotlib colormaps`|",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667572",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>
This branch obtains the colormaps from `matplotlib.colormaps` instead of `matplotlib.cm`.

I have removed the module-wide `cm` variable as I do not see a purpose of it. The code is more than 10 years old, so it is probably not related to modularization. My best guess is that it has to do with lazy imports in Python 2.

In the long run, we can also consider removing Sage's `Colormaps` collection and replace it by Matplotlib functionality, since Matplotlib already has support for registering new color maps.

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[2022ed6](https://git.sagemath.org/sage.git/commit?id=2022ed60966d4b2357c032201ca8f7c6044e43fa)|`33491: fix usage of matplotlib colormaps`|



---

archive/issue_comments_667573.json:
```json
{
    "body": "<a id='comment:2'></a>\nI agree that there is no reason to nail that in memory. This is a good step towards removing redundancy in Sage that can be achieved elsewhere. LGTM.",
    "created_at": "2022-03-12T02:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667573",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
I agree that there is no reason to nail that in memory. This is a good step towards removing redundancy in Sage that can be achieved elsewhere. LGTM.



---

archive/issue_comments_667574.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-03-12T02:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667574",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_667575.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-12T02:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667575",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_667576.json:
```json
{
    "body": "<a id='comment:3'></a>\nThank you.",
    "created_at": "2022-03-12T18:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667576",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>
Thank you.



---

archive/issue_comments_667577.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667577",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088226.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-27T15:43:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33491#event-88226"
}
```



---

archive/issue_comments_667578.json:
```json
{
    "body": "Changing branch from \"u/gh-mwageringel/33491\" to \"2022ed60966d4b2357c032201ca8f7c6044e43fa\"",
    "created_at": "2022-03-27T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667578",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-mwageringel/33491" to "2022ed60966d4b2357c032201ca8f7c6044e43fa"



---

archive/issue_comments_667579.json:
```json
{
    "body": "Changing commit from \"2022ed60966d4b2357c032201ca8f7c6044e43fa\" to \"\"",
    "created_at": "2022-04-04T11:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667579",
    "user": "https://github.com/tobiasdiez"
}
```

Changing commit from "2022ed60966d4b2357c032201ca8f7c6044e43fa" to ""



---

archive/issue_comments_667580.json:
```json
{
    "body": "<a id='comment:5'></a>\nOn conda, one sees now the following error\n\n```\nsage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)\n```\nI think this may be introduced by this ticket, see https://github.com/sagemath/sage/runs/5800737359?check_suite_focus=true. (Not sure if it's only conda-related).",
    "created_at": "2022-04-04T11:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667580",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
On conda, one sees now the following error

```
sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)
```
I think this may be introduced by this ticket, see https://github.com/sagemath/sage/runs/5800737359?check_suite_focus=true. (Not sure if it's only conda-related).



---

archive/issue_comments_667581.json:
```json
{
    "body": "<a id='comment:6'></a>\nSounds like `build/pkgs/matplotlib/install-requires.txt` should have been adjusted?\nIt says `matplotlib >=3.3.1`",
    "created_at": "2022-04-04T18:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667581",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Sounds like `build/pkgs/matplotlib/install-requires.txt` should have been adjusted?
It says `matplotlib >=3.3.1`



---

archive/issue_comments_667582.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think you're right. This seems to require `matplotlib >= 3.5.0` (https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.5.0.html#id13).",
    "created_at": "2022-04-04T19:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667582",
    "user": "https://github.com/davidlowryduda"
}
```

<a id='comment:7'></a>
I think you're right. This seems to require `matplotlib >= 3.5.0` (https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.5.0.html#id13).



---

archive/issue_comments_667583.json:
```json
{
    "body": "<a id='comment:8'></a>\nI've opened #33642 for this",
    "created_at": "2022-04-04T19:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33491#issuecomment-667583",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
I've opened #33642 for this
