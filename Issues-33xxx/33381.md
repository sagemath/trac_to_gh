# Issue 33381: Make orders unique parents

archive/issues_033144.json:
```json
{
    "body": "Orders in number fields are currently not unique parents:\n\n```\nsage: K.<i> = NumberField(x^2 + 1)\nsage: OK = K.order(i)\nsage: OK is loads(dumps(OK))\nFalse\nsage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\nFalse\nsage: K.maximal_order([2]) is K.maximal_order([2, 2])\nFalse\nsage: K.maximal_order([2]) is K.maximal_order([-2])\nFalse\n```\n\nAlso, maximality of orders is sometimes wrong:\n\n```\nsage: OK = K.maximal_order()\nsage: (OK & OK).is_maximal()\nFalse\nsage: OK = K.maximal_order(2)\nsage: OK == K.maximal_order()\nTrue\nsage: OK.is_maximal()\nFalse\n```\n\n---\n\nHere, we try to do a better job about making orders unique parents by using a unique factory.\n\nAlso, we normalize the primes at which we maximize and do not use them anymore to identify the order.\n\nFinally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.\n\nCC:  @roed314 xcaruso\n\nAuthor: Julian R\u00fcth\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/33381\n\n",
    "closed_at": "2022-02-20T09:10:34Z",
    "created_at": "2022-02-19T18:59:01Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make orders unique parents",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33381",
    "user": "https://github.com/saraedum"
}
```
Orders in number fields are currently not unique parents:

```
sage: K.<i> = NumberField(x^2 + 1)
sage: OK = K.order(i)
sage: OK is loads(dumps(OK))
False
sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([2, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([-2])
False
```

Also, maximality of orders is sometimes wrong:

```
sage: OK = K.maximal_order()
sage: (OK & OK).is_maximal()
False
sage: OK = K.maximal_order(2)
sage: OK == K.maximal_order()
True
sage: OK.is_maximal()
False
```

---

Here, we try to do a better job about making orders unique parents by using a unique factory.

Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.

Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.

CC:  @roed314 xcaruso

Author: Julian Rüth

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/33381





---

archive/issue_comments_504378.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n sage: K.<i> = NumberField(x^2 + 1)\n sage: OK = K.order(i)\n sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n False\n \\`\\`\\`\n \n```\n",
    "created_at": "2022-02-19T19:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504378",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -4,6 +4,8 @@
 sage: K.<i> = NumberField(x^2 + 1)
 sage: OK = K.order(i)
 sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
 False
 \`\`\`
 
```




---

archive/issue_comments_504379.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+Orders in number fields are currently not unique parents:\n \n+\\`\\`\\`\n+sage: K.<i> = NumberField(x^2 + 1)\n+sage: OK = K.order(i)\n+sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n+False\n+sage: R.maximal_order([2]) is R.maximal_order([2, 2])\n+False\n+\\`\\`\\`\n+\n+Also, maximality of orders is sometimes wrong:\n+\n+\\`\\`\\`\n+sage: OK = K.maximal_order()\n+sage: (OK & OK).is_maximal()\n+False\n+sage: OK = K.maximal_order(2)\n+sage: OK == K.maximal_order()\n+True\n+sage: OK.is_maximal()\n+False\n+\\`\\`\\`\n \n Author: Julian R\u00fcth\n \n```\n",
    "created_at": "2022-02-19T19:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504379",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,28 @@
+Orders in number fields are currently not unique parents:
 
+\`\`\`
+sage: K.<i> = NumberField(x^2 + 1)
+sage: OK = K.order(i)
+sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
+False
+sage: R.maximal_order([2]) is R.maximal_order([2, 2])
+False
+\`\`\`
+
+Also, maximality of orders is sometimes wrong:
+
+\`\`\`
+sage: OK = K.maximal_order()
+sage: (OK & OK).is_maximal()
+False
+sage: OK = K.maximal_order(2)
+sage: OK == K.maximal_order()
+True
+sage: OK.is_maximal()
+False
+\`\`\`
 
 Author: Julian Rüth
 
```




---

archive/issue_comments_504380.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+Orders in number fields are currently not unique parents:\n \n+\\`\\`\\`\n+sage: K.<i> = NumberField(x^2 + 1)\n+sage: OK = K.order(i)\n+sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([2, 2])\n+False\n+\\`\\`\\`\n+\n+Also, maximality of orders is sometimes wrong:\n+\n+\\`\\`\\`\n+sage: OK = K.maximal_order()\n+sage: (OK & OK).is_maximal()\n+False\n+sage: OK = K.maximal_order(2)\n+sage: OK == K.maximal_order()\n+True\n+sage: OK.is_maximal()\n+False\n+\\`\\`\\`\n \n Author: Julian R\u00fcth\n \n```\n",
    "created_at": "2022-02-19T19:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504380",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,28 @@
+Orders in number fields are currently not unique parents:
 
+\`\`\`
+sage: K.<i> = NumberField(x^2 + 1)
+sage: OK = K.order(i)
+sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([2, 2])
+False
+\`\`\`
+
+Also, maximality of orders is sometimes wrong:
+
+\`\`\`
+sage: OK = K.maximal_order()
+sage: (OK & OK).is_maximal()
+False
+sage: OK = K.maximal_order(2)
+sage: OK == K.maximal_order()
+True
+sage: OK.is_maximal()
+False
+\`\`\`
 
 Author: Julian Rüth
 
```




---

archive/issue_comments_504381.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+Orders in number fields are currently not unique parents:\n \n+\\`\\`\\`\n+sage: K.<i> = NumberField(x^2 + 1)\n+sage: OK = K.order(i)\n+sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([2, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([-2])\n+False\n+\\`\\`\\`\n+\n+Also, maximality of orders is sometimes wrong:\n+\n+\\`\\`\\`\n+sage: OK = K.maximal_order()\n+sage: (OK & OK).is_maximal()\n+False\n+sage: OK = K.maximal_order(2)\n+sage: OK == K.maximal_order()\n+True\n+sage: OK.is_maximal()\n+False\n+\\`\\`\\`\n \n Author: Julian R\u00fcth\n \n```\n",
    "created_at": "2022-02-19T19:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504381",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,30 @@
+Orders in number fields are currently not unique parents:
 
+\`\`\`
+sage: K.<i> = NumberField(x^2 + 1)
+sage: OK = K.order(i)
+sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([2, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([-2])
+False
+\`\`\`
+
+Also, maximality of orders is sometimes wrong:
+
+\`\`\`
+sage: OK = K.maximal_order()
+sage: (OK & OK).is_maximal()
+False
+sage: OK = K.maximal_order(2)
+sage: OK == K.maximal_order()
+True
+sage: OK.is_maximal()
+False
+\`\`\`
 
 Author: Julian Rüth
 
```




---

archive/issue_comments_504382.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+Orders in number fields are currently not unique parents:\n \n+\\`\\`\\`\n+sage: K.<i> = NumberField(x^2 + 1)\n+sage: OK = K.order(i)\n+sage: OK is loads(dumps(OK))\n+False\n+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([2, 2])\n+False\n+sage: K.maximal_order([2]) is K.maximal_order([-2])\n+False\n+\\`\\`\\`\n+\n+Also, maximality of orders is sometimes wrong:\n+\n+\\`\\`\\`\n+sage: OK = K.maximal_order()\n+sage: (OK & OK).is_maximal()\n+False\n+sage: OK = K.maximal_order(2)\n+sage: OK == K.maximal_order()\n+True\n+sage: OK.is_maximal()\n+False\n+\\`\\`\\`\n+\n+---\n+\n+Here, we try to do a better job about making orders unique parents by using a unique factory.\n+\n+Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.\n+\n+Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be \\`assume_maximal=None\\`, i.e., we make no assumptions about maximality at other primes.\n \n Author: Julian R\u00fcth\n \n```\n",
    "created_at": "2022-02-19T19:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504382",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,38 @@
+Orders in number fields are currently not unique parents:
 
+\`\`\`
+sage: K.<i> = NumberField(x^2 + 1)
+sage: OK = K.order(i)
+sage: OK is loads(dumps(OK))
+False
+sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([2, 2])
+False
+sage: K.maximal_order([2]) is K.maximal_order([-2])
+False
+\`\`\`
+
+Also, maximality of orders is sometimes wrong:
+
+\`\`\`
+sage: OK = K.maximal_order()
+sage: (OK & OK).is_maximal()
+False
+sage: OK = K.maximal_order(2)
+sage: OK == K.maximal_order()
+True
+sage: OK.is_maximal()
+False
+\`\`\`
+
+---
+
+Here, we try to do a better job about making orders unique parents by using a unique factory.
+
+Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.
+
+Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be \`assume_maximal=None\`, i.e., we make no assumptions about maximality at other primes.
 
 Author: Julian Rüth
 
```




---

archive/issue_events_088056.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2022-02-20T02:56:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33381#event-88056"
}
```



---

archive/issue_comments_504383.json:
```json
{
    "body": "<a id='comment:6'></a>superseded by the identical #33386",
    "created_at": "2022-02-20T02:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504383",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:6'></a>superseded by the identical #33386



---

archive/issue_comments_504384.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-20T02:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504384",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_504385.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-20T02:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504385",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088057.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-02-20T09:10:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33381#event-88057"
}
```



---

archive/issue_comments_504386.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2022-02-20T09:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33381#issuecomment-504386",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate
