# Issue 33882: .coordinate_vector() for IntegerLattice does not respect the base ring (ZZ)

archive/issues_033645.json:
```json
{
    "body": "The following code demonstrates that despite `IntegerLattice` being defined as a module over `ZZ`, its `.component_vector()` method fails to recognize that a given vector is not in `self` and proceeds with representing it as a linear combination with fractional coefficients. \n\n```\nfrom sage.modules.free_module_integer import IntegerLattice\n\nL = IntegerLattice([2,2,2])\nr = vector(ZZ,[1,1,1])\n\nprint(r in L)                             # this is False\nprint(L.coordinate_vector(r,check=True))  # check should fail, and exception should be raised but it's not\n```\n\n\nOn a related note, it is unclear how `L.coordinate_vector(r)` behaves when `r` does belong to `L`. I'd expect it to return a vector with integer components, but given the above behavior it seems that it may return a vector with fractional components anyway. It should stick to the base ring, i.e. `ZZ` in this case, or at least have an option to enforce this.\n\nCC:  @yyyyx4\n\nStopgaps: todo\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/33882\n\n",
    "created_at": "2022-05-22T17:15:21Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": ".coordinate_vector() for IntegerLattice does not respect the base ring (ZZ)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33882",
    "user": "https://github.com/maxale"
}
```
The following code demonstrates that despite `IntegerLattice` being defined as a module over `ZZ`, its `.component_vector()` method fails to recognize that a given vector is not in `self` and proceeds with representing it as a linear combination with fractional coefficients. 

```
from sage.modules.free_module_integer import IntegerLattice

L = IntegerLattice([2,2,2])
r = vector(ZZ,[1,1,1])

print(r in L)                             # this is False
print(L.coordinate_vector(r,check=True))  # check should fail, and exception should be raised but it's not
```


On a related note, it is unclear how `L.coordinate_vector(r)` behaves when `r` does belong to `L`. I'd expect it to return a vector with integer components, but given the above behavior it seems that it may return a vector with fractional components anyway. It should stick to the base ring, i.e. `ZZ` in this case, or at least have an option to enforce this.

CC:  @yyyyx4

Stopgaps: todo

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/33882





---

archive/issue_comments_676070.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following code demonstrates that despite that `IntegerLattice` is defined as a module over `ZZ`, `.component_vector()` represents a vector `r` not belonging to a lattice `L` as a linear combination of the basis vectors of `L` with fractional coefficients. \n+The following code demonstrates that despite `IntegerLattice` being defined as a module over `ZZ`, its `.component_vector()` method fails to recognize that a given vector is not in `self` and proceeds with representing it as a linear combination with fractional coefficients. \n \n ```\n from sage.modules.free_module_integer import IntegerLattice\n``````\n",
    "created_at": "2022-05-22T17:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33882#issuecomment-676070",
    "user": "https://github.com/maxale"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following code demonstrates that despite that `IntegerLattice` is defined as a module over `ZZ`, `.component_vector()` represents a vector `r` not belonging to a lattice `L` as a linear combination of the basis vectors of `L` with fractional coefficients. 
+The following code demonstrates that despite `IntegerLattice` being defined as a module over `ZZ`, its `.component_vector()` method fails to recognize that a given vector is not in `self` and proceeds with representing it as a linear combination with fractional coefficients. 
 
 ```
 from sage.modules.free_module_integer import IntegerLattice
``````




---

archive/issue_comments_676071.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n ```\n \n \n-\n+On a related note, it is unclear how `L.coordinate_vector(r)` behaves when `r` does belong to `L`. I'd expect it to return a vector with integer components, but given the above behavior it seems that it may return a vector with fractional components anyway. It should stick to the base ring, i.e. `ZZ` in this case, or at least have an option to enforce this.\n``````\n",
    "created_at": "2022-05-22T17:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33882#issuecomment-676071",
    "user": "https://github.com/maxale"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 ```
 
 
-
+On a related note, it is unclear how `L.coordinate_vector(r)` behaves when `r` does belong to `L`. I'd expect it to return a vector with integer components, but given the above behavior it seems that it may return a vector with fractional components anyway. It should stick to the base ring, i.e. `ZZ` in this case, or at least have an option to enforce this.
``````




---

archive/issue_comments_676072.json:
```json
{
    "body": "Changing stopgaps from \"\" to \"todo\"",
    "created_at": "2022-07-27T16:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33882#issuecomment-676072",
    "user": "https://github.com/maxale"
}
```

Changing stopgaps from "" to "todo"



---

archive/issue_events_088878.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33882",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33882#event-88878"
}
```
