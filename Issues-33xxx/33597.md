# Issue 33597: Wrong computation of Hilbert polynomials

archive/issues_033360.json:
```json
{
    "body": "\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\n-t - 5\n```\nThe Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.\n\nInspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.\n\n**Branch/Commit:** [98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)\n\n**Reviewer:** Kwankyu Lee, Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Kwankyu Lee\n\nIssue created by migration from https://trac.sagemath.org/ticket/33597\n\n",
    "closed_at": "2022-10-11T09:14:48Z",
    "created_at": "2022-03-30T07:37:42Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Wrong computation of Hilbert polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/33597",
    "user": "https://github.com/loefflerd"
}
```

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
-t - 5
```
The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.

Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.

**Branch/Commit:** [98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)

**Reviewer:** Kwankyu Lee, Frédéric Chapoton

**Author:** Frédéric Chapoton, Kwankyu Lee

Issue created by migration from https://trac.sagemath.org/ticket/33597





---

archive/issue_comments_545396.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n sage: I.hilbert_polynomial()\n -t - 5\n ```\n-The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. \n+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. \n \n Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.\n \n``````\n",
    "created_at": "2022-03-30T07:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545396",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 sage: I.hilbert_polynomial()
 -t - 5
 ```
-The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. 
+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. 
 
 Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.
 
``````




---

archive/issue_comments_545397.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,8 +5,6 @@\n sage: I.hilbert_polynomial()\n -t - 5\n ```\n-The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. \n+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.\n \n-Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.\n-\n-I am rather suspicious about the correctness of the \"hilbert_series\" method as well, which also seems to assume the generators have degree 1.\n+Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.\n``````\n",
    "created_at": "2022-03-30T08:00:53Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545397",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,8 +5,6 @@
 sage: I.hilbert_polynomial()
 -t - 5
 ```
-The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. 
+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.
 
-Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.
-
-I am rather suspicious about the correctness of the "hilbert_series" method as well, which also seems to assume the generators have degree 1.
+Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.
``````




---

archive/issue_events_300589.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300589"
}
```



---

archive/issue_events_300590.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300590"
}
```



---

archive/issue_events_300591.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300591"
}
```



---

archive/issue_events_300592.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300592"
}
```



---

archive/issue_comments_545398.json:
```json
{
    "body": "**Branch:** [u/chapoton/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/33597)",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545398",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/33597)



---

archive/issue_events_300593.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-09-28T12:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300593"
}
```



---

archive/issue_comments_545399.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545399",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_545400.json:
```json
{
    "body": "<a id='comment:5'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366\">51cb095</a></td><td><code>fixes in Hilbert polynomial</code></td></tr></table>\n",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545400",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366">51cb095</a></td><td><code>fixes in Hilbert polynomial</code></td></tr></table>




---

archive/issue_comments_545401.json:
```json
{
    "body": "**Commit:** [51cb095bbe891fbaafd5b6aa26a795cd31abb366](https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366)",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545401",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [51cb095bbe891fbaafd5b6aa26a795cd31abb366](https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366)



---

archive/issue_comments_545402.json:
```json
{
    "body": "<a id='comment:6'></a>\nbot is morally green, so please review",
    "created_at": "2022-09-28T14:29:08Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545402",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
bot is morally green, so please review



---

archive/issue_comments_545403.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/33597)\" to \"[u/klee/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/33597)\".",
    "created_at": "2022-09-30T04:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545403",
    "user": "https://github.com/kwankyu"
}
```

**Changing branch** from "[u/chapoton/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/33597)" to "[u/klee/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/33597)".



---

archive/issue_comments_545404.json:
```json
{
    "body": "**Reviewer:** Kwankyu Lee",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545404",
    "user": "https://github.com/kwankyu"
}
```

**Reviewer:** Kwankyu Lee



---

archive/issue_comments_545405.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry for hijacking this ticket. I made a few modifications to the patch so that\n\n(1) we do not assume `denom[0]` can be only `-1`.\n\n(2) the code is a bit more efficient.\n\nBefore your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial() \nsage: I.hilbert_polynomial()\n-t - 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 409 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 416 \u03bcs per loop\n```\nAfter your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 299 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 298 \u03bcs per loop\n```\nAfter my modifications\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 230 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 235 \u03bcs per loop\n```\n\nI am positive to the patch.",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545405",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>
Sorry for hijacking this ticket. I made a few modifications to the patch so that

(1) we do not assume `denom[0]` can be only `-1`.

(2) the code is a bit more efficient.

Before your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial() 
sage: I.hilbert_polynomial()
-t - 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 409 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 416 μs per loop
```
After your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 299 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 298 μs per loop
```
After my modifications

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 230 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 235 μs per loop
```

I am positive to the patch.



---

archive/issue_comments_545406.json:
```json
{
    "body": "**Changing commit** from \"[51cb095bbe891fbaafd5b6aa26a795cd31abb366](https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366)\" to \"[b8630ace295ff5b33fe4dd40e15ebeee9bd74263](https://github.com/sagemath/sagetrac-mirror/commit/b8630ace295ff5b33fe4dd40e15ebeee9bd74263)\".",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545406",
    "user": "https://github.com/kwankyu"
}
```

**Changing commit** from "[51cb095bbe891fbaafd5b6aa26a795cd31abb366](https://github.com/sagemath/sagetrac-mirror/commit/51cb095bbe891fbaafd5b6aa26a795cd31abb366)" to "[b8630ace295ff5b33fe4dd40e15ebeee9bd74263](https://github.com/sagemath/sagetrac-mirror/commit/b8630ace295ff5b33fe4dd40e15ebeee9bd74263)".



---

archive/issue_comments_545407.json:
```json
{
    "body": "**Changing commit** from \"[b8630ace295ff5b33fe4dd40e15ebeee9bd74263](https://github.com/sagemath/sagetrac-mirror/commit/b8630ace295ff5b33fe4dd40e15ebeee9bd74263)\" to \"[98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)\".",
    "created_at": "2022-09-30T04:34:36Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b8630ace295ff5b33fe4dd40e15ebeee9bd74263](https://github.com/sagemath/sagetrac-mirror/commit/b8630ace295ff5b33fe4dd40e15ebeee9bd74263)" to "[98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)".



---

archive/issue_comments_545408.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91\">98f118d</a></td><td><code>Minor edits</code></td></tr></table>\n",
    "created_at": "2022-09-30T04:34:36Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91">98f118d</a></td><td><code>Minor edits</code></td></tr></table>




---

archive/issue_events_300594.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-09-30T08:13:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300594"
}
```



---

archive/issue_events_300595.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-09-30T08:13:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300595"
}
```



---

archive/issue_comments_545409.json:
```json
{
    "body": "<a id='comment:10'></a>\nok, good to go, thanks",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545409",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok, good to go, thanks



---

archive/issue_comments_545410.json:
```json
{
    "body": "**Changing reviewer** from \"Kwankyu Lee\" to \"Kwankyu Lee, Fr\u00e9d\u00e9ric Chapoton\".",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545410",
    "user": "https://github.com/fchapoton"
}
```

**Changing reviewer** from "Kwankyu Lee" to "Kwankyu Lee, Frédéric Chapoton".



---

archive/issue_comments_545411.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Kwankyu Lee\".",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545411",
    "user": "https://github.com/fchapoton"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Kwankyu Lee".



---

archive/issue_comments_545412.json:
```json
{
    "body": "<a id='comment:11'></a>\nThank you!",
    "created_at": "2022-09-30T22:35:48Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545412",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'></a>
Thank you!



---

archive/issue_events_300596.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-11T09:14:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300596"
}
```



---

archive/issue_events_300597.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b670d032bf511e99349e8f621da4c0cc9574313a",
    "created_at": "2022-10-11T09:14:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33597#event-300597"
}
```



---

archive/issue_comments_545413.json:
```json
{
    "body": "**Changing branch** from \"[u/klee/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/33597)\" to \"[98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)\".",
    "created_at": "2022-10-11T09:14:48Z",
    "issue": "https://github.com/sagemath/sage/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33597#issuecomment-545413",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/klee/33597](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/33597)" to "[98f118dc6595400d0c4667b006f426616e35ee91](https://github.com/sagemath/sagetrac-mirror/commit/98f118dc6595400d0c4667b006f426616e35ee91)".
