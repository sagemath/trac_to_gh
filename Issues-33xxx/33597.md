# Issue 33597: Wrong computation of Hilbert polynomials

archive/issues_033360.json:
```json
{
    "body": "```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\n-t - 5\n```\nThe Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.\n\nInspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.\n\nBranch/Commit: 98f118dc6595400d0c4667b006f426616e35ee91\n\nReviewer: Kwankyu Lee, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Kwankyu Lee\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33597\n\n",
    "closed_at": "2022-10-11T09:14:48Z",
    "created_at": "2022-03-30T07:37:42Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Wrong computation of Hilbert polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33597",
    "user": "https://github.com/loefflerd"
}
```
```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
-t - 5
```
The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.

Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.

Branch/Commit: 98f118dc6595400d0c4667b006f426616e35ee91

Reviewer: Kwankyu Lee, Frédéric Chapoton

Author: Frédéric Chapoton, Kwankyu Lee

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33597





---

archive/issue_comments_507313.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n sage: I.hilbert_polynomial()\n -t - 5\n ```\n-The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. \n+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. \n \n Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.\n \n```\n",
    "created_at": "2022-03-30T07:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507313",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
```diff
--- 
+++ 
@@ -4,7 +4,7 @@
 sage: I.hilbert_polynomial()
 -t - 5
 ```
-The Hilbert polynomial is, by definition, a positive integer for all sufficiently large integers t, so this computation can't possibly be right. 
+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. 
 
 Inspecting the code suggests that the algorithm is silently assuming all the generators to be homogenous of degree 1. Fortunately there is an independent implementation `hilbert_polynomial(algorithm='singular')` which gives the right answer.
 
```




---

archive/issue_comments_507314.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+```\n+sage: R.<X, Y, Z> = QQ[]\n+sage: I = R.ideal([X^2*Y^3, X*Z])\n+sage: I.hilbert_polynomial()\n+-t - 5\n+```\n+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.\n \n+Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.\n \n Comment: 1\n \n```\n",
    "created_at": "2022-03-30T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507314",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+```
+sage: R.<X, Y, Z> = QQ[]
+sage: I = R.ideal([X^2*Y^3, X*Z])
+sage: I.hilbert_polynomial()
+-t - 5
+```
+The Hilbert polynomial, by definition, has to take non-negative integer values at all sufficiently large integers t, so this computation can't possibly be right. The correct answer is ` t + 5 `, which is what one gets with the ` algorithm='singular' ` option.
 
+Inspecting the code, it looks like the denominator of the Hilbert series is getting normalised wrongly in some cases.
 
 Comment: 1
 
```




---

archive/issue_events_088394.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33597#event-88394"
}
```



---

archive/issue_events_088395.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33597#event-88395"
}
```



---

archive/issue_events_088396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33597#event-88396"
}
```



---

archive/issue_comments_507315.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507315",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_507316.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2022-09-28T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507316",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_507317.json:
```json
{
    "body": "<a id='comment:6'></a>bot is morally green, so please review",
    "created_at": "2022-09-28T14:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507317",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>bot is morally green, so please review



---

archive/issue_comments_507318.json:
```json
{
    "body": "<a id='comment:8'></a>Sorry for hijacking this ticket. I made a few modifications to the patch so that\n\n(1) we do not assume `denom[0]` can be only `-1`.\n\n(2) the code is a bit more efficient.\n\nBefore your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial() \nsage: I.hilbert_polynomial()\n-t - 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 409 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 416 \u03bcs per loop\n```\nAfter your patch\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 299 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 298 \u03bcs per loop\n```\nAfter my modifications\n\n```\nsage: R.<X, Y, Z> = QQ[]\nsage: I = R.ideal([X^2*Y^3, X*Z])\nsage: I.hilbert_polynomial()\nt + 5\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 230 \u03bcs per loop\nsage: timeit('I.hilbert_polynomial()')\n625 loops, best of 3: 235 \u03bcs per loop\n```\n\nI am positive to the patch.",
    "created_at": "2022-09-30T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507318",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>Sorry for hijacking this ticket. I made a few modifications to the patch so that

(1) we do not assume `denom[0]` can be only `-1`.

(2) the code is a bit more efficient.

Before your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial() 
sage: I.hilbert_polynomial()
-t - 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 409 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 416 μs per loop
```
After your patch

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 299 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 298 μs per loop
```
After my modifications

```
sage: R.<X, Y, Z> = QQ[]
sage: I = R.ideal([X^2*Y^3, X*Z])
sage: I.hilbert_polynomial()
t + 5
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 230 μs per loop
sage: timeit('I.hilbert_polynomial()')
625 loops, best of 3: 235 μs per loop
```

I am positive to the patch.



---

archive/issue_comments_507319.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-30T04:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_507320.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507320",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_507321.json:
```json
{
    "body": "<a id='comment:10'></a>ok, good to go, thanks",
    "created_at": "2022-09-30T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507321",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>ok, good to go, thanks



---

archive/issue_comments_507322.json:
```json
{
    "body": "<a id='comment:11'></a>Thank you!",
    "created_at": "2022-09-30T22:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507322",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'></a>Thank you!



---

archive/issue_events_088397.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-11T09:14:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33597#event-88397"
}
```



---

archive/issue_comments_507323.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-10-11T09:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-507323",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
