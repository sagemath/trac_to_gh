# Issue 33391: Remove compile dependency on flint from CombinatorialPolyhedron

archive/issues_033154.json:
```json
{
    "body": "As a preparation of #33385, we cimport from `Matrix_dense` instead of `Matrix_integer_dense`. In particular this removes the compile time dependency on flint.\n\nCC:  @mkoeppe\n\nBranch/Commit: 69ad1e0a4be9f67f74395c37be958e3e9d629d82\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nDependencies: #32688\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33391\n\n",
    "closed_at": "2022-02-27T22:00:08Z",
    "created_at": "2022-02-21T06:25:59Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Remove compile dependency on flint from CombinatorialPolyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33391",
    "user": "https://github.com/kliem"
}
```
As a preparation of #33385, we cimport from `Matrix_dense` instead of `Matrix_integer_dense`. In particular this removes the compile time dependency on flint.

CC:  @mkoeppe

Branch/Commit: 69ad1e0a4be9f67f74395c37be958e3e9d629d82

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Dependencies: #32688

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33391





---

archive/issue_comments_665850.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[0f0f72c](https://git.sagemath.org/sage.git/commit?id=0f0f72c558d6955ade7ef482b13c54cc491943e1)|`Merge branch 'public/32666' of git://trac.sagemath.org/sage into public/32688`|\n|[bc3ba65](https://git.sagemath.org/sage.git/commit?id=bc3ba655f6da4c0fe2aa9a9f7f7112afd7134b93)|`get_unsafe_si -> get_unsafe_long`|\n|[77c462e](https://git.sagemath.org/sage.git/commit?id=77c462e5f54360e780a4dd20050854bc625e7dcc)|`Merge branch 'public/32688' of git://trac.sagemath.org/sage into public/32688-reb`|\n|[1ebf822](https://git.sagemath.org/sage.git/commit?id=1ebf8226dae5cfaba3c6aee400263aab7e1704ab)|`remove set/get_unsafe_long and mark output of set_unsafe_int as irrelevant`|\n|[c308d8f](https://git.sagemath.org/sage.git/commit?id=c308d8f74a59adc75d3a6544863ae35996cf6ad0)|`leave set_unsafe_si with deprecation note`|\n|[7a4bcc6](https://git.sagemath.org/sage.git/commit?id=7a4bcc62822da367529504a9e4aa77d501baf641)|`Merge branch 'public/32688' of git://trac.sagemath.org/sage into public/32688-reb`|\n|[e844732](https://git.sagemath.org/sage.git/commit?id=e8447329a7d92f3092e79b83a1f88ab09065700c)|`remove set_unsafe_si`|\n|[69ad1e0](https://git.sagemath.org/sage.git/commit?id=69ad1e0a4be9f67f74395c37be958e3e9d629d82)|`cimport from Matrix_dense instead of Matrix_integer_dense in combinatorial_polyhedron`|",
    "created_at": "2022-02-21T06:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665850",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[0f0f72c](https://git.sagemath.org/sage.git/commit?id=0f0f72c558d6955ade7ef482b13c54cc491943e1)|`Merge branch 'public/32666' of git://trac.sagemath.org/sage into public/32688`|
|[bc3ba65](https://git.sagemath.org/sage.git/commit?id=bc3ba655f6da4c0fe2aa9a9f7f7112afd7134b93)|`get_unsafe_si -> get_unsafe_long`|
|[77c462e](https://git.sagemath.org/sage.git/commit?id=77c462e5f54360e780a4dd20050854bc625e7dcc)|`Merge branch 'public/32688' of git://trac.sagemath.org/sage into public/32688-reb`|
|[1ebf822](https://git.sagemath.org/sage.git/commit?id=1ebf8226dae5cfaba3c6aee400263aab7e1704ab)|`remove set/get_unsafe_long and mark output of set_unsafe_int as irrelevant`|
|[c308d8f](https://git.sagemath.org/sage.git/commit?id=c308d8f74a59adc75d3a6544863ae35996cf6ad0)|`leave set_unsafe_si with deprecation note`|
|[7a4bcc6](https://git.sagemath.org/sage.git/commit?id=7a4bcc62822da367529504a9e4aa77d501baf641)|`Merge branch 'public/32688' of git://trac.sagemath.org/sage into public/32688-reb`|
|[e844732](https://git.sagemath.org/sage.git/commit?id=e8447329a7d92f3092e79b83a1f88ab09065700c)|`remove set_unsafe_si`|
|[69ad1e0](https://git.sagemath.org/sage.git/commit?id=69ad1e0a4be9f67f74395c37be958e3e9d629d82)|`cimport from Matrix_dense instead of Matrix_integer_dense in combinatorial_polyhedron`|



---

archive/issue_comments_665851.json:
```json
{
    "body": "Changing branch from \"\" to \"public/33391\"",
    "created_at": "2022-02-21T06:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665851",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/33391"



---

archive/issue_comments_665852.json:
```json
{
    "body": "Changing commit from \"\" to \"69ad1e0a4be9f67f74395c37be958e3e9d629d82\"",
    "created_at": "2022-02-21T06:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665852",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "69ad1e0a4be9f67f74395c37be958e3e9d629d82"



---

archive/issue_comments_665853.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe difference is measurable (for larger instances), but I think this is fine. Those operations are still pretty fast in comparison to anything related:\n\nBefore:\n\n```\nsage: P = polytopes.permutahedron(8, backend='field')\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n653 ms \u00b1 2.62 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n61.9 ms \u00b1 60.8 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: P = polytopes.hypercube(10)\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n1.08 ms \u00b1 538 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n1.06 ms \u00b1 922 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\n\nAfter:\n\n```\nsage: P = polytopes.permutahedron(8, backend='field')\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n656 ms \u00b1 3.06 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n62.9 ms \u00b1 61.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: P = polytopes.hypercube(10)\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n1.07 ms \u00b1 2.1 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n1.06 ms \u00b1 1.02 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```",
    "created_at": "2022-02-21T06:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665853",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
The difference is measurable (for larger instances), but I think this is fine. Those operations are still pretty fast in comparison to anything related:

Before:

```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
653 ms ± 2.62 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
61.9 ms ± 60.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.08 ms ± 538 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 922 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```

After:

```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
656 ms ± 3.06 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
62.9 ms ± 61.4 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.07 ms ± 2.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 1.02 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```



---

archive/issue_comments_665854.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-21T06:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665854",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_665855.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor the larger instances, would using a generic sparse matrix be faster?",
    "created_at": "2022-02-21T06:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
For the larger instances, would using a generic sparse matrix be faster?



---

archive/issue_comments_665856.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-21T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665856",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_665857.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis seems to work well, thanks a lot!",
    "created_at": "2022-02-21T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665857",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
This seems to work well, thanks a lot!



---

archive/issue_comments_665858.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-02-21T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665858",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_665859.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665859",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_665860.json:
```json
{
    "body": "Changing branch from \"public/33391\" to \"69ad1e0a4be9f67f74395c37be958e3e9d629d82\"",
    "created_at": "2022-02-27T22:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33391#issuecomment-665860",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/33391" to "69ad1e0a4be9f67f74395c37be958e3e9d629d82"



---

archive/issue_events_088075.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33391#event-88075"
}
```
