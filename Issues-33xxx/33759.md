# Issue 33759: storage of graph embeddings buggy

archive/issues_033522.json:
```json
{
    "assignees": [],
    "body": "This ticket fixes the following issue\n\n```\nsage: G = Graph([(1,4), (2, 3)])\nsage: G.is_planar(set_embedding=True, set_pos=True)\nsage: G.delete_vertices([3])\nsage: G.is_planar()\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\nInput In [27], in <cell line: 4>()\n      2 G.is_planar(set_embedding=True)\n      3 G.delete_vertices([Integer(3)])\n----> 4 G.is_planar()\n\nFile /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:4995, in GenericGraph.is_planar(self, on_embedding, kuratowski, set_embedding, set_pos)\n   4993 if hasattr(G, '_immutable'):\n   4994     G = copy(G)\n-> 4995 planar = is_planar(G,kuratowski=kuratowski, set_pos=set_pos, set_embedding=set_embedding)\n   4996 if kuratowski:\n   4997     bool_result = planar[0]\n\nFile /usr/lib/python3.10/site-packages/sage/graphs/planarity.pyx:114, in sage.graphs.planarity.is_planar (build/cythonized/sage/graphs/planarity.c:2071)()\n    112 cdef dict ffrom = {vvv: i + 1 for i, vvv in enumerate(listto)}\n    113 cdef dict to = {i + 1: vvv for i, vvv in enumerate(listto)}\n--> 114 g.relabel(ffrom)\n    115 \n    116 cdef graphP theGraph\n\nFile /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:21878, in GenericGraph.relabel(self, perm, inplace, return_map, check_input, complete_partial_function, immutable)\n  21876                 new_attr[perm[v]] = value\n  21877             else:\n> 21878                 new_attr[perm[v]] = [perm[w] for w in value]\n  21880         setattr(self, attr, new_attr)\n  21882 if return_map:\n\nFile /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:21878, in <listcomp>(.0)\n  21876                 new_attr[perm[v]] = value\n  21877             else:\n> 21878                 new_attr[perm[v]] = [perm[w] for w in value]\n  21880         setattr(self, attr, new_attr)\n  21882 if return_map:\n\nKeyError: 3\n```\n\nIt also deprecates parameter `circular` in method `is_planar`.\n\n---\nFollow up: #33760, #33769\n\nCC:  @dcoudert\n\nBranch/Commit: **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**\n\nReviewer: **David Coudert**\n\nAuthor: **Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33759_\n\n",
    "closed_at": "2022-05-12T21:42:32Z",
    "created_at": "2022-04-25T20:43:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "storage of graph embeddings buggy",
    "type": "issue",
    "updated_at": "2022-05-12T21:42:32Z",
    "url": "https://github.com/sagemath/sage/issues/33759",
    "user": "https://github.com/videlec"
}
```
This ticket fixes the following issue

```
sage: G = Graph([(1,4), (2, 3)])
sage: G.is_planar(set_embedding=True, set_pos=True)
sage: G.delete_vertices([3])
sage: G.is_planar()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
Input In [27], in <cell line: 4>()
      2 G.is_planar(set_embedding=True)
      3 G.delete_vertices([Integer(3)])
----> 4 G.is_planar()

File /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:4995, in GenericGraph.is_planar(self, on_embedding, kuratowski, set_embedding, set_pos)
   4993 if hasattr(G, '_immutable'):
   4994     G = copy(G)
-> 4995 planar = is_planar(G,kuratowski=kuratowski, set_pos=set_pos, set_embedding=set_embedding)
   4996 if kuratowski:
   4997     bool_result = planar[0]

File /usr/lib/python3.10/site-packages/sage/graphs/planarity.pyx:114, in sage.graphs.planarity.is_planar (build/cythonized/sage/graphs/planarity.c:2071)()
    112 cdef dict ffrom = {vvv: i + 1 for i, vvv in enumerate(listto)}
    113 cdef dict to = {i + 1: vvv for i, vvv in enumerate(listto)}
--> 114 g.relabel(ffrom)
    115 
    116 cdef graphP theGraph

File /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:21878, in GenericGraph.relabel(self, perm, inplace, return_map, check_input, complete_partial_function, immutable)
  21876                 new_attr[perm[v]] = value
  21877             else:
> 21878                 new_attr[perm[v]] = [perm[w] for w in value]
  21880         setattr(self, attr, new_attr)
  21882 if return_map:

File /usr/lib/python3.10/site-packages/sage/graphs/generic_graph.py:21878, in <listcomp>(.0)
  21876                 new_attr[perm[v]] = value
  21877             else:
> 21878                 new_attr[perm[v]] = [perm[w] for w in value]
  21880         setattr(self, attr, new_attr)
  21882 if return_map:

KeyError: 3
```

It also deprecates parameter `circular` in method `is_planar`.

---
Follow up: #33760, #33769

CC:  @dcoudert

Branch/Commit: **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**

Reviewer: **David Coudert**

Author: **Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/33759_





---

archive/issue_events_430407.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-25T20:43:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430407"
}
```



---

archive/issue_events_430408.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-25T20:43:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430408"
}
```



---

archive/issue_events_430409.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-25T20:43:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430409"
}
```



---

archive/issue_events_430410.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-25T20:43:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430410"
}
```



---

archive/issue_comments_548871.json:
```json
{
    "body": "Branch: **[u/vdelecroix/33759](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/33759)**",
    "created_at": "2022-04-25T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548871",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/33759](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/33759)**



---

archive/issue_comments_548872.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2022-04-25T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548872",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_548873.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896\">5cbb17b</a></td><td><code>33759: correctly clean embedding</code></td></tr></table>\n",
    "created_at": "2022-04-25T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548873",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896">5cbb17b</a></td><td><code>33759: correctly clean embedding</code></td></tr></table>




---

archive/issue_events_430411.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-25T20:57:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430411"
}
```



---

archive/issue_comments_548874.json:
```json
{
    "body": "Commit: **[5cbb17b](https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896)**",
    "created_at": "2022-04-25T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548874",
    "user": "https://github.com/videlec"
}
```

Commit: **[5cbb17b](https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896)**



---

archive/issue_comments_548875.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,3 +41,5 @@\n \n KeyError: 3\n ```\n+\n+Follow up: #33760\n``````\n",
    "created_at": "2022-04-25T21:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548875",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,3 +41,5 @@
 
 KeyError: 3
 ```
+
+Follow up: #33760
``````




---

archive/issue_comments_548876.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nSeveral doctests errors due to \n\n```diff\n-                for vertex in vertices:\n-                    attr_dict.pop(vertex, None)\n+                for v in vertices:\n+                    del attr_dict[v]\n```",
    "created_at": "2022-04-26T09:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548876",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'>Comment 3:</a>
Several doctests errors due to 

```diff
-                for vertex in vertices:
-                    attr_dict.pop(vertex, None)
+                for v in vertices:
+                    del attr_dict[v]
```



---

archive/issue_comments_548877.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621\">35b8028</a></td><td><code>33759: use d.pop(v) instead of del d[v]</code></td></tr></table>\n",
    "created_at": "2022-04-26T18:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548877",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621">35b8028</a></td><td><code>33759: use d.pop(v) instead of del d[v]</code></td></tr></table>




---

archive/issue_comments_548878.json:
```json
{
    "body": "Changed commit from **[5cbb17b](https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896)** to **[35b8028](https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621)**",
    "created_at": "2022-04-26T18:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548878",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5cbb17b](https://github.com/sagemath/sagetrac-mirror/commit/5cbb17bdec5979f0220dae3dd8c79a115dae7896)** to **[35b8028](https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621)**



---

archive/issue_comments_548879.json:
```json
{
    "body": "Changed commit from **[35b8028](https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621)** to **[0e1b3f5](https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b)**",
    "created_at": "2022-04-27T10:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548879",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[35b8028](https://github.com/sagemath/sagetrac-mirror/commit/35b802869fa90f03a17198f7b5e14f5a8cd44621)** to **[0e1b3f5](https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b)**



---

archive/issue_comments_548880.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b\">0e1b3f5</a></td><td><code>33759: also fix delete_vertex</code></td></tr></table>\n",
    "created_at": "2022-04-27T10:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548880",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b">0e1b3f5</a></td><td><code>33759: also fix delete_vertex</code></td></tr></table>




---

archive/issue_events_430412.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-28T10:43:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430412"
}
```



---

archive/issue_events_430413.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-28T10:43:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430413"
}
```



---

archive/issue_comments_548881.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI have several errors\n\n```\nsage -t --warn-long 293.2 --random-seed=30092742952270998397219008776926923749 src/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5239, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    g439.is_circular_planar(kuratowski=True, boundary=[1, 2, 3])\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[4]>\", line 1, in <module>\n        g439.is_circular_planar(kuratowski=True, boundary=[Integer(1), Integer(2), Integer(3)])\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 5328, in is_circular_planar\n        graph._embedding[w].pop(graph._embedding[w].index(extra))\n    ValueError: 0 is not in list\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5241, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    g439.get_embedding()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[5]>\", line 1, in <module>\n        g439.get_embedding()\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 2684, in get_embedding\n        raise ValueError('%s has been modified and the embedding is no longer valid'%self)\n    ValueError: Graph on 7 vertices has been modified and the embedding is no longer valid\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5253, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    K23.is_circular_planar(boundary=[0, 1, 2, 3])\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[7]>\", line 1, in <module>\n        K23.is_circular_planar(boundary=[Integer(0), Integer(1), Integer(2), Integer(3)])\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 5328, in is_circular_planar\n        graph._embedding[w].pop(graph._embedding[w].index(extra))\n    ValueError: 5 is not in list\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5260, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    K23.is_circular_planar(set_embedding=True, boundary=[0, 2, 1, 3])\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[9]>\", line 1, in <module>\n        K23.is_circular_planar(set_embedding=True, boundary=[Integer(0), Integer(2), Integer(1), Integer(3)])\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 5328, in is_circular_planar\n        graph._embedding[w].pop(graph._embedding[w].index(extra))\n    ValueError: 5 is not in list\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5269, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    Graph(1).is_circular_planar()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.?[11]>\", line 1, in <module>\n        Graph(Integer(1)).is_circular_planar()\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 5328, in is_circular_planar\n        graph._embedding[w].pop(graph._embedding[w].index(extra))\n    ValueError: 1 is not in list\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 5740, in sage.graphs.generic_graph.GenericGraph.genus\nFailed example:\n    cube.is_circular_planar()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.genus[12]>\", line 1, in <module>\n        cube.is_circular_planar()\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 5328, in is_circular_planar\n        graph._embedding[w].pop(graph._embedding[w].index(extra))\n    ValueError: 0 is not in list\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 10268, in sage.graphs.generic_graph.GenericGraph.delete_vertex\nFailed example:\n    G.delete_vertex([3])\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.delete_vertex[17]>\", line 1, in <module>\n        G.delete_vertex([Integer(3)])\n      File \"/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py\", line 10276, in delete_vertex\n        raise ValueError(\"vertex (%s) not in the graph\"%str(vertex))\n    ValueError: vertex ([3]) not in the graph\n```\n\n- in the doctest of `delete_vertex`, change `[3]` -> `3`\n- instead of `neighbors.difference_update([vertex])`, you can do `neighbors.discard(vertex)`",
    "created_at": "2022-04-28T10:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548881",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'>Comment 6:</a>
I have several errors

```
sage -t --warn-long 293.2 --random-seed=30092742952270998397219008776926923749 src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5239, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    g439.is_circular_planar(kuratowski=True, boundary=[1, 2, 3])
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[4]>", line 1, in <module>
        g439.is_circular_planar(kuratowski=True, boundary=[Integer(1), Integer(2), Integer(3)])
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 5328, in is_circular_planar
        graph._embedding[w].pop(graph._embedding[w].index(extra))
    ValueError: 0 is not in list
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5241, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    g439.get_embedding()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[5]>", line 1, in <module>
        g439.get_embedding()
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 2684, in get_embedding
        raise ValueError('%s has been modified and the embedding is no longer valid'%self)
    ValueError: Graph on 7 vertices has been modified and the embedding is no longer valid
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5253, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    K23.is_circular_planar(boundary=[0, 1, 2, 3])
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[7]>", line 1, in <module>
        K23.is_circular_planar(boundary=[Integer(0), Integer(1), Integer(2), Integer(3)])
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 5328, in is_circular_planar
        graph._embedding[w].pop(graph._embedding[w].index(extra))
    ValueError: 5 is not in list
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5260, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    K23.is_circular_planar(set_embedding=True, boundary=[0, 2, 1, 3])
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[9]>", line 1, in <module>
        K23.is_circular_planar(set_embedding=True, boundary=[Integer(0), Integer(2), Integer(1), Integer(3)])
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 5328, in is_circular_planar
        graph._embedding[w].pop(graph._embedding[w].index(extra))
    ValueError: 5 is not in list
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5269, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    Graph(1).is_circular_planar()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.?[11]>", line 1, in <module>
        Graph(Integer(1)).is_circular_planar()
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 5328, in is_circular_planar
        graph._embedding[w].pop(graph._embedding[w].index(extra))
    ValueError: 1 is not in list
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 5740, in sage.graphs.generic_graph.GenericGraph.genus
Failed example:
    cube.is_circular_planar()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.genus[12]>", line 1, in <module>
        cube.is_circular_planar()
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 5328, in is_circular_planar
        graph._embedding[w].pop(graph._embedding[w].index(extra))
    ValueError: 0 is not in list
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 10268, in sage.graphs.generic_graph.GenericGraph.delete_vertex
Failed example:
    G.delete_vertex([3])
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.delete_vertex[17]>", line 1, in <module>
        G.delete_vertex([Integer(3)])
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/generic_graph.py", line 10276, in delete_vertex
        raise ValueError("vertex (%s) not in the graph"%str(vertex))
    ValueError: vertex ([3]) not in the graph
```

- in the doctest of `delete_vertex`, change `[3]` -> `3`
- instead of `neighbors.difference_update([vertex])`, you can do `neighbors.discard(vertex)`



---

archive/issue_comments_548882.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nWill fix that.\n\nWhat about also fixing `_embedding` when calling `delete_edge`, `delete_edges`, `contract_edge`, `contract_edges` in this ticket?",
    "created_at": "2022-04-28T13:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548882",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'>Comment 7:</a>
Will fix that.

What about also fixing `_embedding` when calling `delete_edge`, `delete_edges`, `contract_edge`, `contract_edges` in this ticket?



---

archive/issue_comments_548883.json:
```json
{
    "body": "Changed commit from **[0e1b3f5](https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b)** to **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**",
    "created_at": "2022-04-28T15:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548883",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0e1b3f5](https://github.com/sagemath/sagetrac-mirror/commit/0e1b3f5b5880e25a2aa3cc8ba2b27e8417345d7b)** to **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**



---

archive/issue_comments_548884.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221\">f2b86c7</a></td><td><code>33759: more embedding fixes</code></td></tr></table>\n",
    "created_at": "2022-04-28T15:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548884",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221">f2b86c7</a></td><td><code>33759: more embedding fixes</code></td></tr></table>




---

archive/issue_events_430414.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-28T15:30:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430414"
}
```



---

archive/issue_events_430415.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-04-28T15:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430415"
}
```



---

archive/issue_comments_548885.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nCan you list the changes you have done and the introduced deprecation in the ticket description.\n\nI agree that we can also fix `contract_edge` and `contract_edges` in this ticket.",
    "created_at": "2022-04-29T09:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548885",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'>Comment 10:</a>
Can you list the changes you have done and the introduced deprecation in the ticket description.

I agree that we can also fix `contract_edge` and `contract_edges` in this ticket.



---

archive/issue_comments_548886.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThe good news is that all tests pass with the last commit ;)",
    "created_at": "2022-04-29T09:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548886",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:11'>Comment 11:</a>
The good news is that all tests pass with the last commit ;)



---

archive/issue_comments_548887.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nSimply some cleaning in `sage.graphs.planarity.is_planar`: the argument `circular` was ignored unless `set_pos=True`. The corresponding operation (ie setting positions) is more logically done in `Graph.is_circular_planar`.",
    "created_at": "2022-04-29T09:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548887",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'>Comment 12:</a>
Simply some cleaning in `sage.graphs.planarity.is_planar`: the argument `circular` was ignored unless `set_pos=True`. The corresponding operation (ie setting positions) is more logically done in `Graph.is_circular_planar`.



---

archive/issue_comments_548888.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nMaybe it is enough for a first step. I opened #33769 for dealing with edge deletion/contraction.",
    "created_at": "2022-04-29T10:03:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548888",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'>Comment 13:</a>
Maybe it is enough for a first step. I opened #33769 for dealing with edge deletion/contraction.



---

archive/issue_comments_548889.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -42,4 +42,4 @@\n KeyError: 3\n ```\n \n-Follow up: #33760\n+Follow up: #33760, #33769\n``````\n",
    "created_at": "2022-04-29T10:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548889",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -42,4 +42,4 @@
 KeyError: 3
 ```
 
-Follow up: #33760
+Follow up: #33760, #33769
``````




---

archive/issue_comments_548890.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+This ticket fixes the following issue\n \n ```\n sage: G = Graph([(1,4), (2, 3)])\n@@ -42,4 +43,7 @@\n KeyError: 3\n ```\n \n+It also deprecates parameter `circular` in method `is_planar`.\n+\n+---\n Follow up: #33760, #33769\n``````\n",
    "created_at": "2022-04-29T11:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548890",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+This ticket fixes the following issue
 
 ```
 sage: G = Graph([(1,4), (2, 3)])
@@ -42,4 +43,7 @@
 KeyError: 3
 ```
 
+It also deprecates parameter `circular` in method `is_planar`.
+
+---
 Follow up: #33760, #33769
``````




---

archive/issue_comments_548891.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2022-04-29T11:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548891",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_548892.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI have updated the ticket description.",
    "created_at": "2022-04-29T11:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548892",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'>Comment 15:</a>
I have updated the ticket description.



---

archive/issue_events_430416.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-29T11:12:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430416"
}
```



---

archive/issue_events_430417.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-29T11:12:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430417"
}
```



---

archive/issue_events_430418.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-07T18:35:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430418"
}
```



---

archive/issue_events_430419.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-07T18:35:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430419"
}
```



---

archive/issue_events_430420.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-12T21:42:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430420"
}
```



---

archive/issue_events_430421.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7020df12edbeec47bca882d59bc111db3894ca31",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-05-12T21:42:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33759#event-430421"
}
```



---

archive/issue_comments_548893.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/33759](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/33759)** to **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**",
    "created_at": "2022-05-12T21:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33759#issuecomment-548893",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/33759](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/33759)** to **[f2b86c7](https://github.com/sagemath/sagetrac-mirror/commit/f2b86c7a888d55d2d27585441f05863505628221)**
