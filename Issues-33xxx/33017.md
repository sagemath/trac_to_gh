# Issue 33017: LazyImport.__instancecheck__, __subclasscheck__: Return False on ImportError

archive/issues_032780.json:
```json
{
    "body": "No object is an instance of a class that cannot be imported.\n\nNo class is a subclass of a class that cannot be imported.\n\nHence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.\n\n(We do not use the stronger versions of these two statements: \"No object is an instance of a class that has not been imported yet (i.e., the module name is not in `sys.modules`).\" These are true only if there are no re-exports.)\n\nWith this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)\n\n\nCC:  @tscrim @kliem\n\nBranch: [7adef969f2dcb713b570fdafbb780a8b3081c5e6](https://github.com/sagemath/sagetrac-mirror/commit/7adef969f2dcb713b570fdafbb780a8b3081c5e6)\n\nReviewer: Jonathan Kliem\n\nAuthor: Matthias Koeppe\n\nDependencies: #32899\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33017\n\n",
    "closed_at": "2022-04-10T13:12:41Z",
    "created_at": "2021-12-13T06:33:25Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "LazyImport.__instancecheck__, __subclasscheck__: Return False on ImportError",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33017",
    "user": "https://github.com/mkoeppe"
}
```
No object is an instance of a class that cannot be imported.

No class is a subclass of a class that cannot be imported.

Hence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.

(We do not use the stronger versions of these two statements: "No object is an instance of a class that has not been imported yet (i.e., the module name is not in `sys.modules`)." These are true only if there are no re-exports.)

With this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)


CC:  @tscrim @kliem

Branch: [7adef969f2dcb713b570fdafbb780a8b3081c5e6](https://github.com/sagemath/sagetrac-mirror/commit/7adef969f2dcb713b570fdafbb780a8b3081c5e6)

Reviewer: Jonathan Kliem

Author: Matthias Koeppe

Dependencies: #32899

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33017





---

archive/issue_comments_658373.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/lazyimport___instancecheck______subclasscheck____return_false_on_importerror\"",
    "created_at": "2021-12-13T06:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658373",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/lazyimport___instancecheck______subclasscheck____return_false_on_importerror"



---

archive/issue_comments_658374.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-12-13T06:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658374",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_658375.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-13T06:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658375",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_658376.json:
```json
{
    "body": "Changing commit from \"\" to \"447df69f6c7b638177ac369f20902a9f84bb19a5\"",
    "created_at": "2021-12-13T06:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658376",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "447df69f6c7b638177ac369f20902a9f84bb19a5"



---

archive/issue_comments_658377.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|\n|[447df69](https://github.com/sagemath/sagetrac-mirror/commit/447df69f6c7b638177ac369f20902a9f84bb19a5)|`LazyImport.__instancecheck__, __subclasscheck__: Return False on ImportError`|",
    "created_at": "2021-12-13T06:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658377",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
|[447df69](https://github.com/sagemath/sagetrac-mirror/commit/447df69f6c7b638177ac369f20902a9f84bb19a5)|`LazyImport.__instancecheck__, __subclasscheck__: Return False on ImportError`|



---

archive/issue_comments_658378.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,9 @@\n \n No class is a subclass of a class that cannot be imported.\n \n+Hence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.\n+\n+(We do not use the stronger versions of these two statements: \"No object is an instance of a class that has not been imported yet (i.e., the module is in `sys.modules`.\" These are true only if there are no re-exports.)\n+\n+With this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)\n+\n``````\n",
    "created_at": "2021-12-13T08:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658378",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,9 @@
 
 No class is a subclass of a class that cannot be imported.
 
+Hence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.
+
+(We do not use the stronger versions of these two statements: "No object is an instance of a class that has not been imported yet (i.e., the module is in `sys.modules`." These are true only if there are no re-exports.)
+
+With this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)
+
``````




---

archive/issue_comments_658379.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n Hence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.\n \n-(We do not use the stronger versions of these two statements: \"No object is an instance of a class that has not been imported yet (i.e., the module is in `sys.modules`.\" These are true only if there are no re-exports.)\n+(We do not use the stronger versions of these two statements: \"No object is an instance of a class that has not been imported yet (i.e., the module name is not in `sys.modules`).\" These are true only if there are no re-exports.)\n \n With this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)\n \n``````\n",
    "created_at": "2021-12-13T08:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658379",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 Hence, we change `LazyImport` so that the special methods `__instancecheck__`, `__subclasscheck__` catch `ImportError` and just return False.
 
-(We do not use the stronger versions of these two statements: "No object is an instance of a class that has not been imported yet (i.e., the module is in `sys.modules`." These are true only if there are no re-exports.)
+(We do not use the stronger versions of these two statements: "No object is an instance of a class that has not been imported yet (i.e., the module name is not in `sys.modules`)." These are true only if there are no re-exports.)
 
 With this change to `LazyImport`, we have another instrument for modularization of code that uses `isinstance` checks. (The use of `isinstance` with ABCs (#32566) is preferable because it avoids importing an otherwise unused implementation class.)
 
``````




---

archive/issue_comments_658380.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt's not fast I suspect, as it tries an import and fails every time. But it is correct at least.",
    "created_at": "2021-12-13T09:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658380",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
It's not fast I suspect, as it tries an import and fails every time. But it is correct at least.



---

archive/issue_comments_658381.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2021-12-13T09:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658381",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_comments_658382.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32899\"",
    "created_at": "2021-12-13T19:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658382",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32899"



---

archive/issue_comments_658383.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'll add some documentation to discuss performance",
    "created_at": "2021-12-13T20:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658383",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
I'll add some documentation to discuss performance



---

archive/issue_comments_658384.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|\n|[821d16e](https://github.com/sagemath/sagetrac-mirror/commit/821d16e64c9506f33fcc57992bfe77512d707231)|`src/doc/en/developer/packaging_sage_library.rst: Add bootstrap to testing instructions to avoid the trap of #32868`|\n|[77c957f](https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d)|`src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher`|\n|[9375ef8](https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651)|`pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels`|\n|[c6fc111](https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9)|`Prettier diagram`|\n|[7d6a44c](https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb)|`Use :mod: as markup for packages/modules`|\n|[f83d424](https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc)|`Improve ABC example`|\n|[817a8d0](https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f)|`src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup`|\n|[b555735](https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f)|`src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata`|\n|[fb151ea](https://github.com/sagemath/sagetrac-mirror/commit/fb151eafb2c5ed86f48d45cf142f55b7ce36ef1b)|`Merge #32899`|\n|[907f8e8](https://github.com/sagemath/sagetrac-mirror/commit/907f8e8f664beb9a1a268f2a5aba232ea33a8781)|`src/doc/en/developer/packaging_sage_library.rst: Expand on LazyImport, add timings`|",
    "created_at": "2021-12-14T00:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658384",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|[821d16e](https://github.com/sagemath/sagetrac-mirror/commit/821d16e64c9506f33fcc57992bfe77512d707231)|`src/doc/en/developer/packaging_sage_library.rst: Add bootstrap to testing instructions to avoid the trap of #32868`|
|[77c957f](https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d)|`src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher`|
|[9375ef8](https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651)|`pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels`|
|[c6fc111](https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9)|`Prettier diagram`|
|[7d6a44c](https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb)|`Use :mod: as markup for packages/modules`|
|[f83d424](https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc)|`Improve ABC example`|
|[817a8d0](https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f)|`src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup`|
|[b555735](https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f)|`src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata`|
|[fb151ea](https://github.com/sagemath/sagetrac-mirror/commit/fb151eafb2c5ed86f48d45cf142f55b7ce36ef1b)|`Merge #32899`|
|[907f8e8](https://github.com/sagemath/sagetrac-mirror/commit/907f8e8f664beb9a1a268f2a5aba232ea33a8781)|`src/doc/en/developer/packaging_sage_library.rst: Expand on LazyImport, add timings`|



---

archive/issue_comments_658385.json:
```json
{
    "body": "Changing commit from \"447df69f6c7b638177ac369f20902a9f84bb19a5\" to \"907f8e8f664beb9a1a268f2a5aba232ea33a8781\"",
    "created_at": "2021-12-14T00:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "447df69f6c7b638177ac369f20902a9f84bb19a5" to "907f8e8f664beb9a1a268f2a5aba232ea33a8781"



---

archive/issue_comments_658386.json:
```json
{
    "body": "<a id='comment:10'></a>\nNo patchbot yet, due to\n\nhttps://groups.google.com/g/sage-devel/c/epajAbPvg6s/m/-yWW1gFyCAAJ",
    "created_at": "2021-12-15T14:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658386",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
No patchbot yet, due to

https://groups.google.com/g/sage-devel/c/epajAbPvg6s/m/-yWW1gFyCAAJ



---

archive/issue_comments_658387.json:
```json
{
    "body": "<a id='comment:11'></a>\nEdited to remove unrelated failure.\n\n```\n$ sage -t --long --random-seed=57900501385357039198738698054253811820 src/doc/en/developer/packaging_sage_library.rst  # 8 doctests failed\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-12-17-15-38-43-8b38ad21.\nGit branch: test_33017\nUsing --optional=4ti2,build,debian,dochtml,e_antic,latte_int,lidia,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg\nDoctesting 1 file.\nsage -t --long --random-seed=57900501385357039198738698054253811820 src/doc/en/developer/packaging_sage_library.rst\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 285, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(object, pAdicFieldGeneric)            # fast                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[2]>\", line 1\n        %timeit isinstance(object, pAdicFieldGeneric)            # fast                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 289, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(object, sage.rings.abc.pAdicField)    # also fast                      # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[4]>\", line 1\n        %timeit isinstance(object, sage.rings.abc.pAdicField)    # also fast                      # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 311, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit is_Scheme_or_Pluffe(sZZ)                         # fast                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[3]>\", line 1\n        %timeit is_Scheme_or_Pluffe(sZZ)                         # fast                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 314, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit is_Scheme_or_Pluffe(ZZ)                          # slow                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[4]>\", line 1\n        %timeit is_Scheme_or_Pluffe(ZZ)                          # slow                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 323, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[1]>\", line 1\n        %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 326, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(ZZ, (Scheme, Pluffe))                 # slow                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[2]>\", line 1\n        %timeit isinstance(ZZ, (Scheme, Pluffe))                 # slow                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 340, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[1]>\", line 1\n        %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\nFile \"src/doc/en/developer/packaging_sage_library.rst\", line 343, in doc.en.developer.packaging_sage_library\nFailed example:\n    %timeit isinstance(ZZ, (Scheme, Pluffe))                 # fast                           # random\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        compiled = compiler(example)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 662, in compiler\n        compileflags, 1)\n      File \"<doctest doc.en.developer.packaging_sage_library[2]>\", line 1\n        %timeit isinstance(ZZ, (Scheme, Pluffe))                 # fast                           # random\n        ^\n    SyntaxError: invalid syntax\n```",
    "created_at": "2021-12-17T14:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658387",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>
Edited to remove unrelated failure.

```
$ sage -t --long --random-seed=57900501385357039198738698054253811820 src/doc/en/developer/packaging_sage_library.rst  # 8 doctests failed
too many failed tests, not using stored timings
Running doctests with ID 2021-12-17-15-38-43-8b38ad21.
Git branch: test_33017
Using --optional=4ti2,build,debian,dochtml,e_antic,latte_int,lidia,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg
Doctesting 1 file.
sage -t --long --random-seed=57900501385357039198738698054253811820 src/doc/en/developer/packaging_sage_library.rst
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 285, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(object, pAdicFieldGeneric)            # fast                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[2]>", line 1
        %timeit isinstance(object, pAdicFieldGeneric)            # fast                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 289, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(object, sage.rings.abc.pAdicField)    # also fast                      # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[4]>", line 1
        %timeit isinstance(object, sage.rings.abc.pAdicField)    # also fast                      # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 311, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit is_Scheme_or_Pluffe(sZZ)                         # fast                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[3]>", line 1
        %timeit is_Scheme_or_Pluffe(sZZ)                         # fast                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 314, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit is_Scheme_or_Pluffe(ZZ)                          # slow                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[4]>", line 1
        %timeit is_Scheme_or_Pluffe(ZZ)                          # slow                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 323, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[1]>", line 1
        %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 326, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(ZZ, (Scheme, Pluffe))                 # slow                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[2]>", line 1
        %timeit isinstance(ZZ, (Scheme, Pluffe))                 # slow                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 340, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[1]>", line 1
        %timeit isinstance(sZZ, (Scheme, Pluffe))                # fast                           # random
        ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/doc/en/developer/packaging_sage_library.rst", line 343, in doc.en.developer.packaging_sage_library
Failed example:
    %timeit isinstance(ZZ, (Scheme, Pluffe))                 # fast                           # random
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        compiled = compiler(example)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 662, in compiler
        compileflags, 1)
      File "<doctest doc.en.developer.packaging_sage_library[2]>", line 1
        %timeit isinstance(ZZ, (Scheme, Pluffe))                 # fast                           # random
        ^
    SyntaxError: invalid syntax
```



---

archive/issue_comments_658388.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-17T14:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658388",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_658389.json:
```json
{
    "body": "Changing commit from \"907f8e8f664beb9a1a268f2a5aba232ea33a8781\" to \"7adef969f2dcb713b570fdafbb780a8b3081c5e6\"",
    "created_at": "2021-12-17T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "907f8e8f664beb9a1a268f2a5aba232ea33a8781" to "7adef969f2dcb713b570fdafbb780a8b3081c5e6"



---

archive/issue_comments_658390.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[7adef96](https://github.com/sagemath/sagetrac-mirror/commit/7adef969f2dcb713b570fdafbb780a8b3081c5e6)|`src/doc/en/developer/packaging_sage_library.rst: Mark %timeit # not tested`|",
    "created_at": "2021-12-17T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[7adef96](https://github.com/sagemath/sagetrac-mirror/commit/7adef969f2dcb713b570fdafbb780a8b3081c5e6)|`src/doc/en/developer/packaging_sage_library.rst: Mark %timeit # not tested`|



---

archive/issue_comments_658391.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-17T18:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658391",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_098143.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T21:42:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98143"
}
```



---

archive/issue_events_098144.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98144"
}
```



---

archive/issue_events_098145.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98145"
}
```



---

archive/issue_comments_658392.json:
```json
{
    "body": "<a id='comment:16'></a>\nSorry, I completely forgot about this. I think figured to wait on a patchbot.\n\nYou know, you can also ping me. I might not react, but I won't be annoyed.",
    "created_at": "2022-04-08T19:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658392",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>
Sorry, I completely forgot about this. I think figured to wait on a patchbot.

You know, you can also ping me. I might not react, but I won't be annoyed.



---

archive/issue_comments_658393.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-08T19:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658393",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_658394.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks! There was no urgency",
    "created_at": "2022-04-08T20:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658394",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Thanks! There was no urgency



---

archive/issue_comments_658395.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-10T13:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658395",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_098146.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-10T13:12:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98146"
}
```



---

archive/issue_comments_658396.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/lazyimport___instancecheck______subclasscheck____return_false_on_importerror\" to \"7adef969f2dcb713b570fdafbb780a8b3081c5e6\"",
    "created_at": "2022-04-10T13:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658396",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/lazyimport___instancecheck______subclasscheck____return_false_on_importerror" to "7adef969f2dcb713b570fdafbb780a8b3081c5e6"



---

archive/issue_comments_658397.json:
```json
{
    "body": "Changing commit from \"7adef969f2dcb713b570fdafbb780a8b3081c5e6\" to \"\"",
    "created_at": "2022-04-10T16:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33017#issuecomment-658397",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "7adef969f2dcb713b570fdafbb780a8b3081c5e6" to ""



---

archive/issue_events_098147.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-10T16:40:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98147"
}
```



---

archive/issue_events_098148.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-10T16:40:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33017",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33017#event-98148"
}
```
