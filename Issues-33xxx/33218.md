# Issue 33218: speed up poly.valuation(other_poly)

archive/issues_032981.json:
```json
{
    "body": "```\nsage: pol = (27122036833024*z^43 + 8208413201024064*z^42 + 1028987679702510976*z^41 + 75518451137118783792*z^40 + 3743195619381989907184*z^39 + 135369638077546936261428*z^38 + 3745615314367420203992832*z^37 + 81811619367860049045984675*z^36 + 1440466637248203913774334250*z^35 + 20724331113040275023719172850*z^34 + 245446627541652046097792768214*z^33 + 2395828801191215780780578117794*z^32 + 19147407470673111231862249418166*z^31 + 122863963621496746370188659696702*z^30 + 602621255648485924378700672331054*z^29 + 1935192664301617476137337671088360*z^28 + 694152712036783264243644290673234*z^27 - 39030042885818935455901289133872622*z^26 - 297645962803933196564873733670191774*z^25 - 1329742929728007215704002549281591538*z^24 - 3903989614825648819224432657208727646*z^23 - 6038015534019664017777438417359311914*z^22 + 7565280951156009750992823479550694170*z^21 + 83328126336960183101771239549883786325*z^20 + 297859836972471180382017327162905955900*z^19 + 681226694393685252017130073908325840500*z^18 + 1055504316932586226613390044310017920000*z^17 + 974982625144110654834660688990434600000*z^16 + 80921481727424794623135930623472000000*z^15 - 1245692778975371208980497936649580000000*z^14 - 1877612972166046542841525891548000000000*z^13 - 1186201691981014544058180007080000000000*z^12 - 4424139263701398029187830400000000000*z^11 + 526588498855023559134177312000000000000*z^10 + 410999234738834010247469568000000000000*z^9 + 174333012213810958051184640000000000000*z^8 + 29950530354743793153638400000000000000*z^7 + 2276991208061142220800000000000000000*z^6)\n\n# before:\nsage: sage: %timeit pol.valuation(z-3)\n140 \u00b5s \u00b1 272 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n\n# after:\nsage: %timeit pol.valuation(z-3)\n90.7 \u00b5s \u00b1 119 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nBranch/Commit: fba70398c05016d05b0738888b196426d57ce0e7\n\nReviewer: Lorenz Panny, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Marc Mezzarobba\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33218\n\n",
    "closed_at": "2022-02-13T10:16:44Z",
    "created_at": "2022-01-22T16:58:51Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "speed up poly.valuation(other_poly)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33218",
    "user": "https://github.com/mezzarobba"
}
```
```
sage: pol = (27122036833024*z^43 + 8208413201024064*z^42 + 1028987679702510976*z^41 + 75518451137118783792*z^40 + 3743195619381989907184*z^39 + 135369638077546936261428*z^38 + 3745615314367420203992832*z^37 + 81811619367860049045984675*z^36 + 1440466637248203913774334250*z^35 + 20724331113040275023719172850*z^34 + 245446627541652046097792768214*z^33 + 2395828801191215780780578117794*z^32 + 19147407470673111231862249418166*z^31 + 122863963621496746370188659696702*z^30 + 602621255648485924378700672331054*z^29 + 1935192664301617476137337671088360*z^28 + 694152712036783264243644290673234*z^27 - 39030042885818935455901289133872622*z^26 - 297645962803933196564873733670191774*z^25 - 1329742929728007215704002549281591538*z^24 - 3903989614825648819224432657208727646*z^23 - 6038015534019664017777438417359311914*z^22 + 7565280951156009750992823479550694170*z^21 + 83328126336960183101771239549883786325*z^20 + 297859836972471180382017327162905955900*z^19 + 681226694393685252017130073908325840500*z^18 + 1055504316932586226613390044310017920000*z^17 + 974982625144110654834660688990434600000*z^16 + 80921481727424794623135930623472000000*z^15 - 1245692778975371208980497936649580000000*z^14 - 1877612972166046542841525891548000000000*z^13 - 1186201691981014544058180007080000000000*z^12 - 4424139263701398029187830400000000000*z^11 + 526588498855023559134177312000000000000*z^10 + 410999234738834010247469568000000000000*z^9 + 174333012213810958051184640000000000000*z^8 + 29950530354743793153638400000000000000*z^7 + 2276991208061142220800000000000000000*z^6)

# before:
sage: sage: %timeit pol.valuation(z-3)
140 µs ± 272 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)

# after:
sage: %timeit pol.valuation(z-3)
90.7 µs ± 119 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

Branch/Commit: fba70398c05016d05b0738888b196426d57ce0e7

Reviewer: Lorenz Panny, Frédéric Chapoton

Author: Marc Mezzarobba

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33218





---

archive/issue_comments_502274.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-22T17:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502274",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_502275.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+\\`\\`\\`\n+sage: pol = (27122036833024*z^43 + 8208413201024064*z^42 + 1028987679702510976*z^41 + 75518451137118783792*z^40 + 3743195619381989907184*z^39 + 135369638077546936261428*z^38 + 3745615314367420203992832*z^37 + 81811619367860049045984675*z^36 + 1440466637248203913774334250*z^35 + 20724331113040275023719172850*z^34 + 245446627541652046097792768214*z^33 + 2395828801191215780780578117794*z^32 + 19147407470673111231862249418166*z^31 + 122863963621496746370188659696702*z^30 + 602621255648485924378700672331054*z^29 + 1935192664301617476137337671088360*z^28 + 694152712036783264243644290673234*z^27 - 39030042885818935455901289133872622*z^26 - 297645962803933196564873733670191774*z^25 - 1329742929728007215704002549281591538*z^24 - 3903989614825648819224432657208727646*z^23 - 6038015534019664017777438417359311914*z^22 + 7565280951156009750992823479550694170*z^21 + 83328126336960183101771239549883786325*z^20 + 297859836972471180382017327162905955900*z^19 + 681226694393685252017130073908325840500*z^18 + 1055504316932586226613390044310017920000*z^17 + 974982625144110654834660688990434600000*z^16 + 80921481727424794623135930623472000000*z^15 - 1245692778975371208980497936649580000000*z^14 - 1877612972166046542841525891548000000000*z^13 - 1186201691981014544058180007080000000000*z^12 - 4424139263701398029187830400000000000*z^11 + 526588498855023559134177312000000000000*z^10 + 410999234738834010247469568000000000000*z^9 + 174333012213810958051184640000000000000*z^8 + 29950530354743793153638400000000000000*z^7 + 2276991208061142220800000000000000000*z^6)\n \n+# before:\n+sage: sage: %timeit pol.valuation(z-3)\n+140 \u00b5s \u00b1 272 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+\n+# after:\n+sage: %timeit pol.valuation(z-3)\n+90.7 \u00b5s \u00b1 119 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+\\`\\`\\`\n \n Author: Marc Mezzarobba\n \n```\n",
    "created_at": "2022-01-22T17:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502275",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+\`\`\`
+sage: pol = (27122036833024*z^43 + 8208413201024064*z^42 + 1028987679702510976*z^41 + 75518451137118783792*z^40 + 3743195619381989907184*z^39 + 135369638077546936261428*z^38 + 3745615314367420203992832*z^37 + 81811619367860049045984675*z^36 + 1440466637248203913774334250*z^35 + 20724331113040275023719172850*z^34 + 245446627541652046097792768214*z^33 + 2395828801191215780780578117794*z^32 + 19147407470673111231862249418166*z^31 + 122863963621496746370188659696702*z^30 + 602621255648485924378700672331054*z^29 + 1935192664301617476137337671088360*z^28 + 694152712036783264243644290673234*z^27 - 39030042885818935455901289133872622*z^26 - 297645962803933196564873733670191774*z^25 - 1329742929728007215704002549281591538*z^24 - 3903989614825648819224432657208727646*z^23 - 6038015534019664017777438417359311914*z^22 + 7565280951156009750992823479550694170*z^21 + 83328126336960183101771239549883786325*z^20 + 297859836972471180382017327162905955900*z^19 + 681226694393685252017130073908325840500*z^18 + 1055504316932586226613390044310017920000*z^17 + 974982625144110654834660688990434600000*z^16 + 80921481727424794623135930623472000000*z^15 - 1245692778975371208980497936649580000000*z^14 - 1877612972166046542841525891548000000000*z^13 - 1186201691981014544058180007080000000000*z^12 - 4424139263701398029187830400000000000*z^11 + 526588498855023559134177312000000000000*z^10 + 410999234738834010247469568000000000000*z^9 + 174333012213810958051184640000000000000*z^8 + 29950530354743793153638400000000000000*z^7 + 2276991208061142220800000000000000000*z^6)
 
+# before:
+sage: sage: %timeit pol.valuation(z-3)
+140 µs ± 272 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+
+# after:
+sage: %timeit pol.valuation(z-3)
+90.7 µs ± 119 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+\`\`\`
 
 Author: Marc Mezzarobba
 
```




---

archive/issue_comments_502276.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2022-01-22T17:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502276",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_502277.json:
```json
{
    "body": "<a id='comment:2'></a>Looks good! Just two small suggestions.\n\n- This appears to make it a tiny bit faster:\n\n```diff\n-        rem = self.parent().zero()\n+        cdef Polynomial rem = self.parent().zero()\n```\n\n- While we're at it, we could also fix this (to catch `p=0`):\n\n```diff\n-        if p.degree() == 0:\n-            raise ArithmeticError(\"The polynomial, p, must have positive degree.\")\n+        if p.is_constant():\n+            raise ArithmeticError(\"The polynomial, p, must be non-constant.\")\n```",
    "created_at": "2022-01-25T09:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502277",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:2'></a>Looks good! Just two small suggestions.

- This appears to make it a tiny bit faster:

```diff
-        rem = self.parent().zero()
+        cdef Polynomial rem = self.parent().zero()
```

- While we're at it, we could also fix this (to catch `p=0`):

```diff
-        if p.degree() == 0:
-            raise ArithmeticError("The polynomial, p, must have positive degree.")
+        if p.is_constant():
+            raise ArithmeticError("The polynomial, p, must be non-constant.")
```



---

archive/issue_comments_502278.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-25T09:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502279.json:
```json
{
    "body": "<a id='comment:4'></a>thanks for your comments! the new version seems to be 1-2% faster on the example in the description",
    "created_at": "2022-01-25T09:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502279",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>thanks for your comments! the new version seems to be 1-2% faster on the example in the description



---

archive/issue_comments_502280.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-06T07:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502280",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_502281.json:
```json
{
    "body": "<a id='comment:5'></a>ok",
    "created_at": "2022-02-06T07:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502281",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>ok



---

archive/issue_comments_502282.json:
```json
{
    "body": "<a id='comment:6'></a>thank you!",
    "created_at": "2022-02-06T12:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502282",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>thank you!



---

archive/issue_events_087742.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-13T10:16:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33218#event-87742"
}
```



---

archive/issue_comments_502283.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-13T10:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33218#issuecomment-502283",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
