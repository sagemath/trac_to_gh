# Issue 33661: Don't test files created by jupyter-sphinx

archive/issues_033424.json:
```json
{
    "assignees": [],
    "body": "`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:\n\n```\nsage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py\n    SyntaxError in doctesting framework\n**********************************************************************\nTraceback (most recent call last):\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2490, in __call__\n    doctests, extras = self._run(runner, options, results)\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2538, in _run\n    doctests, extras = self.source.create_doctests(sage_namespace)\n  File \"/usr/lib/python3.10/site-packages/sage/doctest/sources.py\", line 751, in create_doctests\n    load(filename, namespace) # errors raised here will be caught in DocTestTask\n  File \"/usr/lib/python3.10/site-packages/sage/repl/load.py\", line 251, in load\n    code = compile(f.read(), fpath, 'exec')\n  File \"./plot3d.py\", line 278\n    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]\n    ^^^^^^^^^^^^^^^^^^^^^^^^\nSyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?\n```\n\nCC:  @mkoeppe @kiwifb\n\nBranch/Commit: **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Antonio Rojas**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33661_\n\n",
    "closed_at": "2022-04-10T13:12:50Z",
    "created_at": "2022-04-08T18:53:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Don't test files created by jupyter-sphinx",
    "type": "issue",
    "updated_at": "2022-04-10T13:12:50Z",
    "url": "https://github.com/sagemath/sage/issues/33661",
    "user": "https://github.com/antonio-rojas"
}
```
`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:

```
sage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py
    SyntaxError in doctesting framework
**********************************************************************
Traceback (most recent call last):
  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2490, in __call__
    doctests, extras = self._run(runner, options, results)
  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2538, in _run
    doctests, extras = self.source.create_doctests(sage_namespace)
  File "/usr/lib/python3.10/site-packages/sage/doctest/sources.py", line 751, in create_doctests
    load(filename, namespace) # errors raised here will be caught in DocTestTask
  File "/usr/lib/python3.10/site-packages/sage/repl/load.py", line 251, in load
    code = compile(f.read(), fpath, 'exec')
  File "./plot3d.py", line 278
    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]
    ^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?
```

CC:  @mkoeppe @kiwifb

Branch/Commit: **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**

Reviewer: **Matthias Koeppe**

Author: **Antonio Rojas**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/33661_





---

archive/issue_events_462096.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-04-08T18:53:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462096"
}
```



---

archive/issue_events_462097.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-04-08T18:53:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462097"
}
```



---

archive/issue_comments_544043.json:
```json
{
    "body": "Branch: **[u/arojas/don_t_test_files_created_by_jupyter_sphinx](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/don_t_test_files_created_by_jupyter_sphinx)**",
    "created_at": "2022-04-08T18:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544043",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/don_t_test_files_created_by_jupyter_sphinx](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/don_t_test_files_created_by_jupyter_sphinx)**



---

archive/issue_events_462098.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-04-08T18:58:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462098"
}
```



---

archive/issue_comments_544044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,20 @@\n+`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:\n \n+```\n+sage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py\n+    SyntaxError in doctesting framework\n+**********************************************************************\n+Traceback (most recent call last):\n+  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2490, in __call__\n+    doctests, extras = self._run(runner, options, results)\n+  File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2538, in _run\n+    doctests, extras = self.source.create_doctests(sage_namespace)\n+  File \"/usr/lib/python3.10/site-packages/sage/doctest/sources.py\", line 751, in create_doctests\n+    load(filename, namespace) # errors raised here will be caught in DocTestTask\n+  File \"/usr/lib/python3.10/site-packages/sage/repl/load.py\", line 251, in load\n+    code = compile(f.read(), fpath, 'exec')\n+  File \"./plot3d.py\", line 278\n+    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]\n+    ^^^^^^^^^^^^^^^^^^^^^^^^\n+SyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?\n+```\n``````\n",
    "created_at": "2022-04-08T18:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544044",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,20 @@
+`jupyter-sphinx` creates some python files for internal use which are installed along with documentation. These files are included in the list of files to test when running `sage -t --installed`, and they are causing a failure already in 9.6.beta7:
 
+```
+sage -t --long --random-seed=6061970077882220822199301624486576060 /usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py
+    SyntaxError in doctesting framework
+**********************************************************************
+Traceback (most recent call last):
+  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2490, in __call__
+    doctests, extras = self._run(runner, options, results)
+  File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2538, in _run
+    doctests, extras = self.source.create_doctests(sage_namespace)
+  File "/usr/lib/python3.10/site-packages/sage/doctest/sources.py", line 751, in create_doctests
+    load(filename, namespace) # errors raised here will be caught in DocTestTask
+  File "/usr/lib/python3.10/site-packages/sage/repl/load.py", line 251, in load
+    code = compile(f.read(), fpath, 'exec')
+  File "./plot3d.py", line 278
+    cylindrical(r, theta, z) = [r*cos(theta), r*sin(theta), z]
+    ^^^^^^^^^^^^^^^^^^^^^^^^
+SyntaxError: cannot assign to function call here. Maybe you meant '==' instead of '='?
+```
``````




---

archive/issue_events_462099.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-04-08T18:58:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462099"
}
```



---

archive/issue_comments_544045.json:
```json
{
    "body": "Commit: **[`443dc77`](https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c)**",
    "created_at": "2022-04-08T18:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544045",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[`443dc77`](https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c)**



---

archive/issue_comments_544046.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c\">443dc77</a></td><td><code>Skip files created by jupyter-sphinx</code></td></tr></table>\n",
    "created_at": "2022-04-08T18:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544046",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c">443dc77</a></td><td><code>Skip files created by jupyter-sphinx</code></td></tr></table>




---

archive/issue_comments_544047.json:
```json
{
    "body": "Author: **Antonio Rojas**",
    "created_at": "2022-04-08T18:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544047",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas**



---

archive/issue_events_462100.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-04-08T18:58:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462100"
}
```



---

archive/issue_comments_544048.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f\">34fcaa0</a></td><td><code>Use filename instead of base, base might not be defined</code></td></tr></table>\n",
    "created_at": "2022-04-08T19:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544048",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f">34fcaa0</a></td><td><code>Use filename instead of base, base might not be defined</code></td></tr></table>




---

archive/issue_comments_544049.json:
```json
{
    "body": "Changed commit from **[`443dc77`](https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c)** to **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**",
    "created_at": "2022-04-08T19:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544049",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`443dc77`](https://github.com/sagemath/sagetrac-mirror/commit/443dc7790ce82712621240de2880e87ba112548c)** to **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**



---

archive/issue_events_462101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-08T19:19:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462101"
}
```



---

archive/issue_events_462102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-08T19:19:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462102"
}
```



---

archive/issue_comments_544050.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-04-08T19:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544050",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_462103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-08T19:19:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462103"
}
```



---

archive/issue_events_462104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-08T19:19:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462104"
}
```



---

archive/issue_comments_544051.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThat's one of those things, I am surprised it only becomes apparent now. I historically had that issue before the use of `jupyter_sphinx` in sage-on-gentoo. For some reason some python files are left over from all the plots. And I don't know how they are avoided in vanilla sage. So, I am just removing them before install.\n\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/sage-doc-9999.ebuild#L137\n\nhttps://github.com/cschwan/sage-on-gentoo/issues/402\n\nMy net above is sufficiently wide that it probably caught all those `jupyter_sphinx` files and I never noticed. I never quite got to the bottom of why I had those files in the first place, but they shouldn't be installed and neither should those.",
    "created_at": "2022-04-08T19:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544051",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">comment:5</div>

That's one of those things, I am surprised it only becomes apparent now. I historically had that issue before the use of `jupyter_sphinx` in sage-on-gentoo. For some reason some python files are left over from all the plots. And I don't know how they are avoided in vanilla sage. So, I am just removing them before install.

https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/sage-doc-9999.ebuild#L137

https://github.com/cschwan/sage-on-gentoo/issues/402

My net above is sufficiently wide that it probably caught all those `jupyter_sphinx` files and I never noticed. I never quite got to the bottom of why I had those files in the first place, but they shouldn't be installed and neither should those.



---

archive/issue_comments_544052.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI had never tested the docs dir before `sage -t --installed` was introduced, so never noticed that. Anyway, that seems to have been fixed at some point - the only py files installed with docs in 9.6.beta7 are\n\n```\n/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py\n/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/repl/ipython_kernel/interact.py\n```",
    "created_at": "2022-04-08T20:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544052",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:6" align="right">comment:6</div>

I had never tested the docs dir before `sage -t --installed` was introduced, so never noticed that. Anyway, that seems to have been fixed at some point - the only py files installed with docs in 9.6.beta7 are

```
/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/plot/plot3d/plot3d.py
/usr/share/doc/sage/html/en/reference/jupyter_execute/sage/repl/ipython_kernel/interact.py
```



---

archive/issue_events_462105.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-10T13:12:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462105"
}
```



---

archive/issue_events_462106.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "cf219d6eb25883ca67666aae4826a158bfd5d310",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-04-10T13:12:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33661#event-462106"
}
```



---

archive/issue_comments_544053.json:
```json
{
    "body": "Changed branch from **[u/arojas/don_t_test_files_created_by_jupyter_sphinx](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/don_t_test_files_created_by_jupyter_sphinx)** to **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**",
    "created_at": "2022-04-10T13:12:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33661#issuecomment-544053",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arojas/don_t_test_files_created_by_jupyter_sphinx](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/don_t_test_files_created_by_jupyter_sphinx)** to **[`34fcaa0`](https://github.com/sagemath/sagetrac-mirror/commit/34fcaa00d7635fb5b83f76fdcedf22b6810fd03f)**
