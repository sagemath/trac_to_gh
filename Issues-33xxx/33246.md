# Issue 33246: canonical_label returns incorrect partite sets

archive/issues_033009.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n`.canonical_label` on bipartite graph returns a graph with incorrect partite sets. The following code illustrates an example, where the resulting graph `C` has vertices `1` and `9` in the same left partite set and also an edge between them. \n\nThe graph `C` itself seems to be correct, but partition of its vertices into `C.left` and `C.right` is not (they should be `{0,1,2,3,4}` and `{5,6,7,8,9}`).\n\n```\nB = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9), (7, 9)] )\nC = B.canonical_label(partition=(B.left,B.right))\nprint( (1 in C.left) and (9 in C.left) and C.has_edge(1,9) )\n```\n\n\nCC:  @dimpase @dcoudert\n\nComponent: **graph theory**\n\nAuthor: **Enjeck Cleopatra**\n\nBranch/Commit: **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**\n\nReviewer: **David Coudert**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33246_\n\n",
    "closed_at": "2022-04-10T13:13:01Z",
    "created_at": "2022-01-30T02:06:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "canonical_label returns incorrect partite sets",
    "type": "issue",
    "updated_at": "2022-04-10T13:13:01Z",
    "url": "https://github.com/sagemath/sage/issues/33246",
    "user": "https://github.com/maxale"
}
```
<div id="comment:0"></div>

`.canonical_label` on bipartite graph returns a graph with incorrect partite sets. The following code illustrates an example, where the resulting graph `C` has vertices `1` and `9` in the same left partite set and also an edge between them. 

The graph `C` itself seems to be correct, but partition of its vertices into `C.left` and `C.right` is not (they should be `{0,1,2,3,4}` and `{5,6,7,8,9}`).

```
B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9), (7, 9)] )
C = B.canonical_label(partition=(B.left,B.right))
print( (1 in C.left) and (9 in C.left) and C.has_edge(1,9) )
```


CC:  @dimpase @dcoudert

Component: **graph theory**

Author: **Enjeck Cleopatra**

Branch/Commit: **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**

Reviewer: **David Coudert**

_Issue created by migration from https://trac.sagemath.org/ticket/33246_





---

archive/issue_events_454041.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-30T02:06:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454041"
}
```



---

archive/issue_events_454042.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-30T02:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454042"
}
```



---

archive/issue_events_454043.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-30T02:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454043"
}
```



---

archive/issue_events_454044.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-30T02:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454044"
}
```



---

archive/issue_comments_537326.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe `BipartiteGraph` module requires several improvements and bug fix (#1941). This one seems non trivial.",
    "created_at": "2022-01-31T10:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537326",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1" align="right">comment:1</div>

The `BipartiteGraph` module requires several improvements and bug fix (#1941). This one seems non trivial.



---

archive/issue_comments_537327.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs a workaround for *connected* graphs, we can recompute the partite sets from just edges of `canonical_label()` - like:\n\n```\nC = BipartiteGraph( B.canonical_label(partition=(B.left,B.right)).edges() )\n```\n\nIf `B` is not connected, recomputing the partite sets may shuffle them from different connected components inconsistently with the partite set in `B`.",
    "created_at": "2022-01-31T14:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537327",
    "user": "https://github.com/maxale"
}
```

<div id="comment:2" align="right">comment:2</div>

As a workaround for *connected* graphs, we can recompute the partite sets from just edges of `canonical_label()` - like:

```
C = BipartiteGraph( B.canonical_label(partition=(B.left,B.right)).edges() )
```

If `B` is not connected, recomputing the partite sets may shuffle them from different connected components inconsistently with the partite set in `B`.



---

archive/issue_comments_537328.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSince `canonical_label()` can return a certificate (mapping of the vertices of given graph to the relabeled one), correct partition of vertices can be computed from this certificate. I found the following workaround quite stable:\n\n\n```\ndef correct_canonical_label(B):\n    C, cert = B.canonical_label(partition=(B.left,B.right),certificate=True)\n    C.left = { cert[v] for v in B.left }\n    C.right = { cert[v] for v in B.right }\n    return C\n```",
    "created_at": "2022-02-01T18:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537328",
    "user": "https://github.com/maxale"
}
```

<div id="comment:3" align="right">comment:3</div>

Since `canonical_label()` can return a certificate (mapping of the vertices of given graph to the relabeled one), correct partition of vertices can be computed from this certificate. I found the following workaround quite stable:


```
def correct_canonical_label(B):
    C, cert = B.canonical_label(partition=(B.left,B.right),certificate=True)
    C.left = { cert[v] for v in B.left }
    C.right = { cert[v] for v in B.right }
    return C
```



---

archive/issue_comments_537329.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAny devs already working on this ticket? I'd like to attempt to fix it :)",
    "created_at": "2022-03-12T10:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537329",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:4" align="right">comment:4</div>

Any devs already working on this ticket? I'd like to attempt to fix it :)



---

archive/issue_comments_537330.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFeel free to give it a try. Any help is more than welcome.",
    "created_at": "2022-03-12T10:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537330",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

Feel free to give it a try. Any help is more than welcome.



---

archive/issue_comments_537331.json:
```json
{
    "body": "Branch: **[u/gh-enjeck/canonical_label_returns_incorrect_partite_sets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-enjeck/canonical_label_returns_incorrect_partite_sets)**",
    "created_at": "2022-03-17T00:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537331",
    "user": "https://github.com/enjeck"
}
```

Branch: **[u/gh-enjeck/canonical_label_returns_incorrect_partite_sets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-enjeck/canonical_label_returns_incorrect_partite_sets)**



---

archive/issue_comments_537332.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks for the proposal. I have some comments/questions:\n- what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way\n- when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.\n- Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops\n- the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?\n- `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`\n \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18\"><code>43727d3</code></a></td><td><code>Fixed the incorrect labelling of partite sets</code></td></tr></table>\n",
    "created_at": "2022-03-17T12:59:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537332",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks for the proposal. I have some comments/questions:
- what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way
- when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.
- Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops
- the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?
- `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`
 
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18"><code>43727d3</code></a></td><td><code>Fixed the incorrect labelling of partite sets</code></td></tr></table>




---

archive/issue_comments_537333.json:
```json
{
    "body": "Commit: **[`43727d3`](https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18)**",
    "created_at": "2022-03-17T12:59:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537333",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`43727d3`](https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18)**



---

archive/issue_comments_537334.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@dcoudert](#comment%3A7):\n> Thanks for the proposal. I have some comments/questions:\n> - what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way\n\nI'm trying to implement the [workaround suggested by gh-maxale](#comment%3A3), using the certificate. Indeed, I did just copy from the main canonical_label function. If the user sets certificate to \"True\", I just call the original function, since it returns a certificate (mapping of the vertices of given graph to the relabeled one) by default. If certificate is not set to \"True\", I then compute the vertices (this part is just copied from the original). There's probably some more elegant way of implementing this, but I couldn't figure it out. \n\n> - when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.\n\nOkay. I can change that\n\n> - Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops\n\nWhoops. That's an oversight on my part. Gotcha!\n> - the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?\n\nOkay. I'll need to test this out and see. \n\n\n> - `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`\n\nNoted",
    "created_at": "2022-03-17T13:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537334",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@dcoudert](#comment%3A7):
> Thanks for the proposal. I have some comments/questions:
> - what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way

I'm trying to implement the [workaround suggested by gh-maxale](#comment%3A3), using the certificate. Indeed, I did just copy from the main canonical_label function. If the user sets certificate to "True", I just call the original function, since it returns a certificate (mapping of the vertices of given graph to the relabeled one) by default. If certificate is not set to "True", I then compute the vertices (this part is just copied from the original). There's probably some more elegant way of implementing this, but I couldn't figure it out. 

> - when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.

Okay. I can change that

> - Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops

Whoops. That's an oversight on my part. Gotcha!
> - the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?

Okay. I'll need to test this out and see. 


> - `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`

Noted



---

archive/issue_comments_537335.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059\"><code>d4d98e6</code></a></td><td><code>Remove digraph, loops and fix styling</code></td></tr></table>\n",
    "created_at": "2022-03-20T12:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059"><code>d4d98e6</code></a></td><td><code>Remove digraph, loops and fix styling</code></td></tr></table>




---

archive/issue_comments_537336.json:
```json
{
    "body": "Changed commit from **[`43727d3`](https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18)** to **[`d4d98e6`](https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059)**",
    "created_at": "2022-03-20T12:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537336",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`43727d3`](https://github.com/sagemath/sagetrac-mirror/commit/43727d3d4eda3be5a14ae773d9b76485aff20f18)** to **[`d4d98e6`](https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059)**



---

archive/issue_comments_537337.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n@dcoudert, I've made changes. What do you think?",
    "created_at": "2022-03-20T12:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537337",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:10" align="right">comment:10</div>

@dcoudert, I've made changes. What do you think?



---

archive/issue_comments_537338.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nyou need to\n- remove `dig = (self._directed or self.has_loops())`\n- use `dig=False` \n- replace `self_directed` with `False`\n\nAlso, in the example, write like this (not mandatory but nicer):\n\n```diff\n-            sage: B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8\n-            ....: ), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9),\n-            ....:  (7, 9)] )\n+            sage: B = BipartiteGraph([(0, 4), (0, 5), (0, 6), (0, 8), (1, 5),\n+            ....:                     (1, 7), (1, 8), (2, 6), (2, 7), (2, 8),\n+            ....:                     (3, 4), (3, 7), (3, 8), (4, 9), (5, 9),\n+            ....:                     (6, 9), (7, 9)])\n```\n\nLats, add (small) examples with `certificate=True`, `edge_labels=True` and a bipartite with multiple edges. This is to ensure that the method is working well.",
    "created_at": "2022-03-20T13:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537338",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:11" align="right">comment:11</div>

you need to
- remove `dig = (self._directed or self.has_loops())`
- use `dig=False` 
- replace `self_directed` with `False`

Also, in the example, write like this (not mandatory but nicer):

```diff
-            sage: B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8
-            ....: ), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9),
-            ....:  (7, 9)] )
+            sage: B = BipartiteGraph([(0, 4), (0, 5), (0, 6), (0, 8), (1, 5),
+            ....:                     (1, 7), (1, 8), (2, 6), (2, 7), (2, 8),
+            ....:                     (3, 4), (3, 7), (3, 8), (4, 9), (5, 9),
+            ....:                     (6, 9), (7, 9)])
```

Lats, add (small) examples with `certificate=True`, `edge_labels=True` and a bipartite with multiple edges. This is to ensure that the method is working well.



---

archive/issue_comments_537339.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAlso, add your full name to the \"Authors\" field of the ticket\nand set it to \"needs review\".",
    "created_at": "2022-03-21T21:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537339",
    "user": "https://github.com/slel"
}
```

<div id="comment:12" align="right">comment:12</div>

Also, add your full name to the "Authors" field of the ticket
and set it to "needs review".



---

archive/issue_comments_537340.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52\"><code>0d9975e</code></a></td><td><code>Remove dig, add more examples</code></td></tr></table>\n",
    "created_at": "2022-03-22T04:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537340",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52"><code>0d9975e</code></a></td><td><code>Remove dig, add more examples</code></td></tr></table>




---

archive/issue_comments_537341.json:
```json
{
    "body": "Changed commit from **[`d4d98e6`](https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059)** to **[`0d9975e`](https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52)**",
    "created_at": "2022-03-22T04:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537341",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d4d98e6`](https://github.com/sagemath/sagetrac-mirror/commit/d4d98e6825ec8908c6f7e8587bcaf62fe3a3d059)** to **[`0d9975e`](https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52)**



---

archive/issue_events_454045.json:
```json
{
    "actor": "https://github.com/enjeck",
    "created_at": "2022-03-22T05:13:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454045"
}
```



---

archive/issue_comments_537342.json:
```json
{
    "body": "Author: **Enjeck Cleopatra**",
    "created_at": "2022-03-22T11:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537342",
    "user": "https://github.com/dimpase"
}
```

Author: **Enjeck Cleopatra**



---

archive/issue_comments_537343.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt's improving, but I still have few remarks\n- remove\n\n```diff\n+                print(G._directed)\n```\n- Why do you need `G_directed` in `HB.add_edge(G_to[u], G_to[v], None, G._directed)` ?\n- When `certificate=True`, you must also return the certificate. Currently it's only the graph. Add a docket.\n- For the coding style, we prefer `i, u` and `a, b, c`, so with some spaces\n- Also, comments should be aligned in 80 columns mode",
    "created_at": "2022-03-22T12:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537343",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

It's improving, but I still have few remarks
- remove

```diff
+                print(G._directed)
```
- Why do you need `G_directed` in `HB.add_edge(G_to[u], G_to[v], None, G._directed)` ?
- When `certificate=True`, you must also return the certificate. Currently it's only the graph. Add a docket.
- For the coding style, we prefer `i, u` and `a, b, c`, so with some spaces
- Also, comments should be aligned in 80 columns mode



---

archive/issue_comments_537344.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWhoops! I did intend to remove `G._directed`, reason why I tried to print it out to see what it does. But I somehow forgot to remove it *facepalm*",
    "created_at": "2022-03-22T14:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537344",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:17" align="right">comment:17</div>

Whoops! I did intend to remove `G._directed`, reason why I tried to print it out to see what it does. But I somehow forgot to remove it *facepalm*



---

archive/issue_comments_537345.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871\"><code>2e03e2d</code></a></td><td><code>Remove G._directed, return certificate</code></td></tr></table>\n",
    "created_at": "2022-03-23T14:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537345",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871"><code>2e03e2d</code></a></td><td><code>Remove G._directed, return certificate</code></td></tr></table>




---

archive/issue_comments_537346.json:
```json
{
    "body": "Changed commit from **[`0d9975e`](https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52)** to **[`2e03e2d`](https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871)**",
    "created_at": "2022-03-23T14:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537346",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d9975e`](https://github.com/sagemath/sagetrac-mirror/commit/0d9975e7793f76495121c0177a99f627f6b9ba52)** to **[`2e03e2d`](https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871)**



---

archive/issue_comments_537347.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe patchbot reports errors:\n\n```\nsage -t --long --warn-long 65.9 --random-seed=139219076014934287513221791550255114412 src/sage/graphs/bipartite_graph.py\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2286, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C.left\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[6]>\", line 1, in <module>\n        C.left\n    AttributeError: 'tuple' object has no attribute 'left'\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2288, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C.right\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[7]>\", line 1, in <module>\n        C.right\n    AttributeError: 'tuple' object has no attribute 'right'\n```\nIndeed, when `certificate` is `True`, you output 2 objects, and not only the graph.",
    "created_at": "2022-03-24T07:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537347",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

The patchbot reports errors:

```
sage -t --long --warn-long 65.9 --random-seed=139219076014934287513221791550255114412 src/sage/graphs/bipartite_graph.py
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2286, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C.left
Exception raised:
    Traceback (most recent call last):
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[6]>", line 1, in <module>
        C.left
    AttributeError: 'tuple' object has no attribute 'left'
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2288, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C.right
Exception raised:
    Traceback (most recent call last):
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[7]>", line 1, in <module>
        C.right
    AttributeError: 'tuple' object has no attribute 'right'
```
Indeed, when `certificate` is `True`, you output 2 objects, and not only the graph.



---

archive/issue_comments_537348.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\ndcoudert, concerning your last comment, I believe I already addressed it in my last commit?",
    "created_at": "2022-03-28T09:12:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537348",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:20" align="right">comment:20</div>

dcoudert, concerning your last comment, I believe I already addressed it in my last commit?



---

archive/issue_comments_537349.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nyes",
    "created_at": "2022-03-28T09:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537349",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:21" align="right">comment:21</div>

yes



---

archive/issue_comments_537350.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThere might be a misunderstanding: the issue reported in #comment:19 has not been fixed (see the patchbot).",
    "created_at": "2022-04-02T15:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537350",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

There might be a misunderstanding: the issue reported in #comment:19 has not been fixed (see the patchbot).



---

archive/issue_events_454046.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-02T15:21:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454046"
}
```



---

archive/issue_events_454047.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-02T15:21:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454047"
}
```



---

archive/issue_comments_537351.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2022-04-02T15:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537351",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_537352.json:
```json
{
    "body": "Changed commit from **[`2e03e2d`](https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871)** to **[`4a067c8`](https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242)**",
    "created_at": "2022-04-03T06:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537352",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e03e2d`](https://github.com/sagemath/sagetrac-mirror/commit/2e03e2d175da1813acf560e8aa1af33d2316c871)** to **[`4a067c8`](https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242)**



---

archive/issue_comments_537353.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242\"><code>4a067c8</code></a></td><td><code>Edit examples</code></td></tr></table>\n",
    "created_at": "2022-04-03T06:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537353",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242"><code>4a067c8</code></a></td><td><code>Edit examples</code></td></tr></table>




---

archive/issue_comments_537354.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0\"><code>cfad96f</code></a></td><td><code>Edit examples</code></td></tr></table>\n",
    "created_at": "2022-04-03T06:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537354",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0"><code>cfad96f</code></a></td><td><code>Edit examples</code></td></tr></table>




---

archive/issue_comments_537355.json:
```json
{
    "body": "Changed commit from **[`4a067c8`](https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242)** to **[`cfad96f`](https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0)**",
    "created_at": "2022-04-03T06:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537355",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a067c8`](https://github.com/sagemath/sagetrac-mirror/commit/4a067c848af9ed9209dd032a010e6cd9f1034242)** to **[`cfad96f`](https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0)**



---

archive/issue_comments_537356.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIn the doctests, can you add `algorithm='sage'` each time you call `B.canonical_label(...)`. This is to prevent getting different results when you have optional package `bliss` installed (which is my case).\n\nThe canonical label returned by `bliss` is not the same as the one returned when using algorithm `'sage'`, but both labelings are correct.\n\nYou can also remove the doctest `sage: C[1]`. The certificate has already been printed with the line `sage: C`.",
    "created_at": "2022-04-03T12:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537356",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

In the doctests, can you add `algorithm='sage'` each time you call `B.canonical_label(...)`. This is to prevent getting different results when you have optional package `bliss` installed (which is my case).

The canonical label returned by `bliss` is not the same as the one returned when using algorithm `'sage'`, but both labelings are correct.

You can also remove the doctest `sage: C[1]`. The certificate has already been printed with the line `sage: C`.



---

archive/issue_comments_537357.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05\"><code>8fcaed2</code></a></td><td><code>Use sage algorithm, remove repeated doctest</code></td></tr></table>\n",
    "created_at": "2022-04-03T13:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537357",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05"><code>8fcaed2</code></a></td><td><code>Use sage algorithm, remove repeated doctest</code></td></tr></table>




---

archive/issue_comments_537358.json:
```json
{
    "body": "Changed commit from **[`cfad96f`](https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0)** to **[`8fcaed2`](https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05)**",
    "created_at": "2022-04-03T13:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537358",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cfad96f`](https://github.com/sagemath/sagetrac-mirror/commit/cfad96fcc404d9992cc2a89ff2ed8324201073e0)** to **[`8fcaed2`](https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05)**



---

archive/issue_events_454048.json:
```json
{
    "actor": "https://github.com/enjeck",
    "created_at": "2022-04-03T13:03:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454048"
}
```



---

archive/issue_events_454049.json:
```json
{
    "actor": "https://github.com/enjeck",
    "created_at": "2022-04-03T13:03:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454049"
}
```



---

archive/issue_comments_537359.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n- I'm on macOS with sage 9.5.beta7 and I get\n\n```\nsage -t --warn-long 291.0 --random-seed=75080170672752573414336716079288479852 src/sage/graphs/bipartite_graph.py\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2289, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C\nExpected:\n    (Bipartite graph on 10 vertices,\n     {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})\nGot:\n    (Bipartite graph on 10 vertices,\n     {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4})\n**********************************************************************\n```\n I'm not sure where the problem comes from. \n\n\n- Concerning the call\n\n```\n            C = GenericGraph.canonical_label(self, partition, certificate, edge_labels, algorithm, return_graph)\n```\n May be I'm missing something, but isn't it better to simply do:\n\n```\n            C = self.relabel(perm=cert, inplace=False)\n```\n This way you avoid repeating computations you have already done.",
    "created_at": "2022-04-03T13:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537359",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:28" align="right">comment:28</div>

- I'm on macOS with sage 9.5.beta7 and I get

```
sage -t --warn-long 291.0 --random-seed=75080170672752573414336716079288479852 src/sage/graphs/bipartite_graph.py
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2289, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C
Expected:
    (Bipartite graph on 10 vertices,
     {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})
Got:
    (Bipartite graph on 10 vertices,
     {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4})
**********************************************************************
```
 I'm not sure where the problem comes from. 


- Concerning the call

```
            C = GenericGraph.canonical_label(self, partition, certificate, edge_labels, algorithm, return_graph)
```
 May be I'm missing something, but isn't it better to simply do:

```
            C = self.relabel(perm=cert, inplace=False)
```
 This way you avoid repeating computations you have already done.



---

archive/issue_comments_537360.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI'm running the same Sage version, on Ubuntu 20.04.3 and I do get the expected result of ` (Bipartite graph on 10 vertices, {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9}) `. I'm also not sure where the inconsistency is coming from.\n\nAnd yes, using ` C = self.relabel(perm=cert, inplace=False) ` works fine",
    "created_at": "2022-04-03T13:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537360",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:29" align="right">comment:29</div>

I'm running the same Sage version, on Ubuntu 20.04.3 and I do get the expected result of ` (Bipartite graph on 10 vertices, {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9}) `. I'm also not sure where the inconsistency is coming from.

And yes, using ` C = self.relabel(perm=cert, inplace=False) ` works fine



---

archive/issue_comments_537361.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI suggest the following change with a more robust test of the certificate:\n\n```diff\n-            sage: C = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')\n-            sage: C\n-            (Bipartite graph on 10 vertices,\n-             {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})\n-            sage: C[0].left\n-            {0, 1, 2, 3, 4}\n-            sage: C[0].right\n-            {5, 6, 7, 8, 9}\n+            sage: C, cert = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')\n+            sage: C\n+            Bipartite graph on 10 vertices\n+            sage: C.left\n+            {0, 1, 2, 3, 4}\n+            sage: C.right\n+            {5, 6, 7, 8, 9}\n+            sage: cert == {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4}\n+            True\n```",
    "created_at": "2022-04-03T14:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537361",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:30" align="right">comment:30</div>

I suggest the following change with a more robust test of the certificate:

```diff
-            sage: C = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')
-            sage: C
-            (Bipartite graph on 10 vertices,
-             {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})
-            sage: C[0].left
-            {0, 1, 2, 3, 4}
-            sage: C[0].right
-            {5, 6, 7, 8, 9}
+            sage: C, cert = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')
+            sage: C
+            Bipartite graph on 10 vertices
+            sage: C.left
+            {0, 1, 2, 3, 4}
+            sage: C.right
+            {5, 6, 7, 8, 9}
+            sage: cert == {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4}
+            True
```



---

archive/issue_comments_537362.json:
```json
{
    "body": "Changed commit from **[`8fcaed2`](https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05)** to **[`f49cc6b`](https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8)**",
    "created_at": "2022-04-03T14:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8fcaed2`](https://github.com/sagemath/sagetrac-mirror/commit/8fcaed294bb0195ca938ecff71fa11f152998b05)** to **[`f49cc6b`](https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8)**



---

archive/issue_comments_537363.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8\"><code>f49cc6b</code></a></td><td><code>Change certificate doctest, use relabel</code></td></tr></table>\n",
    "created_at": "2022-04-03T14:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537363",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8"><code>f49cc6b</code></a></td><td><code>Change certificate doctest, use relabel</code></td></tr></table>




---

archive/issue_events_454050.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-03T18:50:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454050"
}
```



---

archive/issue_events_454051.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-03T18:50:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454051"
}
```



---

archive/issue_comments_537364.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThis time I think it's OK. Thanks.",
    "created_at": "2022-04-03T18:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537364",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:32" align="right">comment:32</div>

This time I think it's OK. Thanks.



---

archive/issue_comments_537365.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nMerge failure on top of:\n\n216d60bb1b Trac #33633: fix indentation (E111) in pyx files in graphs, libs, proba\n\n39d402cb75 Trac #33629: add negative for continued fractions\n\n4955762701 Trac #33565: Add CODE_OF_CONDUCT.md to the repo\n\n00bc51075d Trac #33560: pytest: ignore cython files\n\na02eec36bf Trac #33582: clean up docstring formatting in schemes/elliptic_curves/\n\n31995b748a Trac #33618: docbuild: typo in arguments check leads to confusing error\n\n94a131cc20 Trac #33612: sage.matrix.matrix_space: Rename a test_... function to _test_... (with deprecation)\n\n823194cfff Trac #33605: cbc: Add system package information for gentoo, nix\n\n6eb1f67d62 Trac #33593: fix W391 in groups/ and algebras/\n\n5ec6108788 Trac #33571: Correct wrong paths in the developer's guide\n\nb886d89536 Trac #33628: Fig bug in graphs.RandomToleranceGraph\n\n5ee8a50e85 Trac #33616: Simplify inventory builder\n\n0a7c8f485c Trac #33615: full cleanup of modules/fp_graded/\n\n97533a71f9 Trac #33589: Gitpod: track remote trac branch\n\nb8d5371aae Trac #33576: Modernize coercion for SpecialHyperellipticQuotientRing\n\n55da3e109e Trac #33572: sage -pytest\n\n2f104e6454 Trac #33533: Update nbconvert to 6.4.x, add optional package pyppeteer\n\n7a5714ac65 Trac #33366: BipartiteGraph() fails to create graph from graph6 string\n\ndfd98a710e Trac #31006: Add more typing information to manifold package\n\n360ee4c168 Trac #30540: Add package phitigra: Graph editor that works with Jupyter\n\n3f93cd0a9c Trac #29640: Create an AUTHORS.md file with links\n\nd8f76fb1bd Trac #33624: doctest unnecessarily assumes SAGE_VENV/bin contains `sage` binary\n\nb438a78918 Trac #33608: Building documentation is broken in Sage 9.6.beta6\n\n88e25dd77b Trac #33631: Github workflow: Fix pyright\n\n78bfb6c7ad Updated [SageMath](../wiki/SageMath) version to 9.6.beta7\n\n\n\nmerge was not clean: conflicts in src/sage/graphs/bipartite_graph.py",
    "created_at": "2022-04-03T23:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537365",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:33" align="right">comment:33</div>

Merge failure on top of:

216d60bb1b Trac #33633: fix indentation (E111) in pyx files in graphs, libs, proba

39d402cb75 Trac #33629: add negative for continued fractions

4955762701 Trac #33565: Add CODE_OF_CONDUCT.md to the repo

00bc51075d Trac #33560: pytest: ignore cython files

a02eec36bf Trac #33582: clean up docstring formatting in schemes/elliptic_curves/

31995b748a Trac #33618: docbuild: typo in arguments check leads to confusing error

94a131cc20 Trac #33612: sage.matrix.matrix_space: Rename a test_... function to _test_... (with deprecation)

823194cfff Trac #33605: cbc: Add system package information for gentoo, nix

6eb1f67d62 Trac #33593: fix W391 in groups/ and algebras/

5ec6108788 Trac #33571: Correct wrong paths in the developer's guide

b886d89536 Trac #33628: Fig bug in graphs.RandomToleranceGraph

5ee8a50e85 Trac #33616: Simplify inventory builder

0a7c8f485c Trac #33615: full cleanup of modules/fp_graded/

97533a71f9 Trac #33589: Gitpod: track remote trac branch

b8d5371aae Trac #33576: Modernize coercion for SpecialHyperellipticQuotientRing

55da3e109e Trac #33572: sage -pytest

2f104e6454 Trac #33533: Update nbconvert to 6.4.x, add optional package pyppeteer

7a5714ac65 Trac #33366: BipartiteGraph() fails to create graph from graph6 string

dfd98a710e Trac #31006: Add more typing information to manifold package

360ee4c168 Trac #30540: Add package phitigra: Graph editor that works with Jupyter

3f93cd0a9c Trac #29640: Create an AUTHORS.md file with links

d8f76fb1bd Trac #33624: doctest unnecessarily assumes SAGE_VENV/bin contains `sage` binary

b438a78918 Trac #33608: Building documentation is broken in Sage 9.6.beta6

88e25dd77b Trac #33631: Github workflow: Fix pyright

78bfb6c7ad Updated [SageMath](../wiki/SageMath) version to 9.6.beta7



merge was not clean: conflicts in src/sage/graphs/bipartite_graph.py



---

archive/issue_events_454052.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-03T23:15:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454052"
}
```



---

archive/issue_events_454053.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-03T23:15:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454053"
}
```



---

archive/issue_comments_537366.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nshould be a conflict with  #33366. Can you try to fix the merge conflict ?",
    "created_at": "2022-04-04T06:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537366",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:34" align="right">comment:34</div>

should be a conflict with  #33366. Can you try to fix the merge conflict ?



---

archive/issue_comments_537367.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3603be36bd287a24af0fa723073248cfa1193082\"><code>3603be3</code></a></td><td><code>Create bipartite graph from graph6 string</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2175d09048265ba083a28a62df85deecc209b179\"><code>2175d09</code></a></td><td><code>Change Alist file check, Add docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12a598c3f65e410a7ef370758144c715374c5ee3\"><code>12a598c</code></a></td><td><code>Change alist file check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d70523cfa6e2cf1738528bf56fccd5b2a6d1857\"><code>6d70523</code></a></td><td><code>Remove docstring newline</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27\"><code>a5f96ef</code></a></td><td><code>Merge branch 't/33366/bipartitegraph___fails_to_create_graph_from_graph6_string' into t/33246/canonical_label_returns_incorrect_partite_sets</code></td></tr></table>\n",
    "created_at": "2022-04-04T12:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3603be36bd287a24af0fa723073248cfa1193082"><code>3603be3</code></a></td><td><code>Create bipartite graph from graph6 string</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2175d09048265ba083a28a62df85deecc209b179"><code>2175d09</code></a></td><td><code>Change Alist file check, Add docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12a598c3f65e410a7ef370758144c715374c5ee3"><code>12a598c</code></a></td><td><code>Change alist file check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d70523cfa6e2cf1738528bf56fccd5b2a6d1857"><code>6d70523</code></a></td><td><code>Remove docstring newline</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27"><code>a5f96ef</code></a></td><td><code>Merge branch 't/33366/bipartitegraph___fails_to_create_graph_from_graph6_string' into t/33246/canonical_label_returns_incorrect_partite_sets</code></td></tr></table>




---

archive/issue_comments_537368.json:
```json
{
    "body": "Changed commit from **[`f49cc6b`](https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8)** to **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**",
    "created_at": "2022-04-04T12:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537368",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f49cc6b`](https://github.com/sagemath/sagetrac-mirror/commit/f49cc6b40f7aae0aa6abaf309d7b4c01a70a00e8)** to **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**



---

archive/issue_events_454054.json:
```json
{
    "actor": "https://github.com/enjeck",
    "created_at": "2022-04-04T12:25:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454054"
}
```



---

archive/issue_events_454055.json:
```json
{
    "actor": "https://github.com/enjeck",
    "created_at": "2022-04-04T12:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454055"
}
```



---

archive/issue_comments_537369.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nDid you have to fix any merge conflict ?",
    "created_at": "2022-04-04T12:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537369",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:37" align="right">comment:37</div>

Did you have to fix any merge conflict ?



---

archive/issue_comments_537370.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nYes. A single conflict with my name in the \"AUTHORS\" list",
    "created_at": "2022-04-04T12:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537370",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:38" align="right">comment:38</div>

Yes. A single conflict with my name in the "AUTHORS" list



---

archive/issue_comments_537371.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThanks.",
    "created_at": "2022-04-04T12:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537371",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:39" align="right">comment:39</div>

Thanks.



---

archive/issue_events_454056.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-04T12:41:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454056"
}
```



---

archive/issue_events_454057.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-04T12:41:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454057"
}
```



---

archive/issue_events_454058.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-10T13:13:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454058"
}
```



---

archive/issue_events_454059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7acdc3d66203dc78bd2ed50c734f80589d87e2ed",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-04-10T13:13:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33246#event-454059"
}
```



---

archive/issue_comments_537372.json:
```json
{
    "body": "Changed branch from **[u/gh-enjeck/canonical_label_returns_incorrect_partite_sets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-enjeck/canonical_label_returns_incorrect_partite_sets)** to **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**",
    "created_at": "2022-04-10T13:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33246#issuecomment-537372",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-enjeck/canonical_label_returns_incorrect_partite_sets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-enjeck/canonical_label_returns_incorrect_partite_sets)** to **[`a5f96ef`](https://github.com/sagemath/sagetrac-mirror/commit/a5f96ef2093a62cbed949e0edca71e373db59b27)**
