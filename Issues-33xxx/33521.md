# Issue 33521: doctesting with pytest fails on system install of sage

archive/issues_033284.json:
```json
{
    "assignees": [],
    "body": "pytest assumes the directory containing the code to be tested is writable. This is not currently the case on sage-on-distro were most of the time testing is done after installing on the system.\n\nHere is a typical result\n\n```\n============================= test session starts ==============================\nplatform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0\nrootdir: /usr\nplugins: hypothesis-6.38.0\ncollected 0 items\n\n=============================== warnings summary ===============================\n../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433\n  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids\n    config.cache.set(\"cache/nodeids\", sorted(self.cached_nodeids))\n\n../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52\n  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise\n    session.config.cache.set(STEPWISE_CACHE_DIR, [])\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n```\npytest can be started with some option to change the location of the cache directory `-o cache_dir=...`. pytest is currently called from `sage-runtest` and this is where we may want to apply any changes.\n\nCC:  @tobiasdiez @orlitzky @dimpase\n\nBranch/Commit: **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33521_\n\n",
    "closed_at": "2022-04-21T21:07:25Z",
    "created_at": "2022-03-17T19:45:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "doctesting with pytest fails on system install of sage",
    "type": "issue",
    "updated_at": "2022-04-21T21:07:25Z",
    "url": "https://github.com/sagemath/sage/issues/33521",
    "user": "https://github.com/kiwifb"
}
```
pytest assumes the directory containing the code to be tested is writable. This is not currently the case on sage-on-distro were most of the time testing is done after installing on the system.

Here is a typical result

```
============================= test session starts ==============================
platform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0
rootdir: /usr
plugins: hypothesis-6.38.0
collected 0 items

=============================== warnings summary ===============================
../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433
  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids
    config.cache.set("cache/nodeids", sorted(self.cached_nodeids))

../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52
  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise
    session.config.cache.set(STEPWISE_CACHE_DIR, [])

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
```
pytest can be started with some option to change the location of the cache directory `-o cache_dir=...`. pytest is currently called from `sage-runtest` and this is where we may want to apply any changes.

CC:  @tobiasdiez @orlitzky @dimpase

Branch/Commit: **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**

Reviewer: **Fran√ßois Bissey**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/33521_





---

archive/issue_events_442066.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-17T19:45:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442066"
}
```



---

archive/issue_events_442067.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-17T19:45:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20distribution",
    "label_color": "000080",
    "label_name": "component: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442067"
}
```



---

archive/issue_events_442068.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-17T19:45:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442068"
}
```



---

archive/issue_events_442069.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-17T19:45:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442069"
}
```



---

archive/issue_comments_544467.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI have tried inserting the right option in `sage-runtest` with variation of \n\n```\n    try:\n        exit_code_pytest = 0\n        import pytest\n        pytest_options = [\"-o cache_dir=/tmp\", \"--import-mode\", \"importlib\"]\n        if args.verbose:\n            pytest_options.append(\"-v\")\n        exit_code_pytest = pytest.main(pytest_options + args.filenames)\n        if exit_code_pytest == 5:\n            # Exit code 5 means there were no test files, pass in this case\n            exit_code_pytest = 0\n```\nwithout success. Suggestions welcome.",
    "created_at": "2022-03-17T19:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544467",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'>Comment 1:</a>
I have tried inserting the right option in `sage-runtest` with variation of 

```
    try:
        exit_code_pytest = 0
        import pytest
        pytest_options = ["-o cache_dir=/tmp", "--import-mode", "importlib"]
        if args.verbose:
            pytest_options.append("-v")
        exit_code_pytest = pytest.main(pytest_options + args.filenames)
        if exit_code_pytest == 5:
            # Exit code 5 means there were no test files, pass in this case
            exit_code_pytest = 0
```
without success. Suggestions welcome.



---

archive/issue_events_442070.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-19T17:33:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442070"
}
```



---

archive/issue_events_442071.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-19T17:33:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442071"
}
```



---

archive/issue_comments_544468.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI think if we include #33531 it can join the list of less urgent stuff to fix about `pytest`.",
    "created_at": "2022-03-19T20:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544468",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'>Comment 4:</a>
I think if we include #33531 it can join the list of less urgent stuff to fix about `pytest`.



---

archive/issue_comments_544469.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI just realised it may make more sense to just disable `pytest` for `sage -t --installed`. Running `pytest` relies on the presence of `src/conftest.py` which is not installed (not sure it would make sense to install it). So, a system install of sage would run `pytest` without fixtures and ignore list - unless you manually point to a copy.",
    "created_at": "2022-03-22T21:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544469",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'>Comment 5:</a>
I just realised it may make more sense to just disable `pytest` for `sage -t --installed`. Running `pytest` relies on the presence of `src/conftest.py` which is not installed (not sure it would make sense to install it). So, a system install of sage would run `pytest` without fixtures and ignore list - unless you manually point to a copy.



---

archive/issue_comments_544470.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI'm not sure about the exact use case of `--installed` but if you completely disable pytest in this situation then users no longer run the existing pytests (like the ones for the symplectic form).",
    "created_at": "2022-03-22T22:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544470",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'>Comment 6:</a>
I'm not sure about the exact use case of `--installed` but if you completely disable pytest in this situation then users no longer run the existing pytests (like the ones for the symplectic form).



---

archive/issue_comments_544471.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@kiwifb](#comment%3A1):\n> I have tried inserting the right option in `sage-runtest` with variation of \n> \n> ```\n>     try:\n>         exit_code_pytest = 0\n>         import pytest\n>         pytest_options = [\"-o cache_dir=/tmp\", \"--import-mode\", \"importlib\"]\n>         if args.verbose:\n>             pytest_options.append(\"-v\")\n>         exit_code_pytest = pytest.main(pytest_options + args.filenames)\n>         if exit_code_pytest == 5:\n>             # Exit code 5 means there were no test files, pass in this case\n>             exit_code_pytest = 0\n> ```\n> without success. Suggestions welcome.\n\n\nCan you please try running pytest with `--rootdir SAGE_SRC` and/or `-c SAGE_SRC/tox.ini`.",
    "created_at": "2022-03-22T22:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544471",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@kiwifb](#comment%3A1):
> I have tried inserting the right option in `sage-runtest` with variation of 
> 
> ```
>     try:
>         exit_code_pytest = 0
>         import pytest
>         pytest_options = ["-o cache_dir=/tmp", "--import-mode", "importlib"]
>         if args.verbose:
>             pytest_options.append("-v")
>         exit_code_pytest = pytest.main(pytest_options + args.filenames)
>         if exit_code_pytest == 5:
>             # Exit code 5 means there were no test files, pass in this case
>             exit_code_pytest = 0
> ```
> without success. Suggestions welcome.


Can you please try running pytest with `--rootdir SAGE_SRC` and/or `-c SAGE_SRC/tox.ini`.



---

archive/issue_comments_544472.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\n`--installed` is for running against a sage install as opposed to running on the source. pytest default on running on source. As for your latest suggestion, in the normal use case for this ticket, `SAGE_SRC` is usually pointing to `SAGE_LIB` and `tox.ini` may not be available.",
    "created_at": "2022-03-22T22:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544472",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'>Comment 8:</a>
`--installed` is for running against a sage install as opposed to running on the source. pytest default on running on source. As for your latest suggestion, in the normal use case for this ticket, `SAGE_SRC` is usually pointing to `SAGE_LIB` and `tox.ini` may not be available.



---

archive/issue_comments_544473.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@kiwifb](#comment%3A5):\n> I just realised it may make more sense to just disable `pytest` for `sage -t --installed`. Running `pytest` relies on the presence of `src/conftest.py` which is not installed (not sure it would make sense to install it). So, a system install of sage would run `pytest` without fixtures and ignore list - unless you manually point to a copy.\n\nYes, I agree",
    "created_at": "2022-03-22T22:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544473",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@kiwifb](#comment%3A5):
> I just realised it may make more sense to just disable `pytest` for `sage -t --installed`. Running `pytest` relies on the presence of `src/conftest.py` which is not installed (not sure it would make sense to install it). So, a system install of sage would run `pytest` without fixtures and ignore list - unless you manually point to a copy.

Yes, I agree



---

archive/issue_comments_544474.json:
```json
{
    "body": "Dependencies: **#31924**",
    "created_at": "2022-03-23T00:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544474",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31924**



---

archive/issue_comments_544475.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nSetting #31924 as a dependency because it modifies `src/bin/sage-runtests` in the same place that needs modifying here.",
    "created_at": "2022-03-23T00:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544475",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Setting #31924 as a dependency because it modifies `src/bin/sage-runtests` in the same place that needs modifying here.



---

archive/issue_comments_544476.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nNeed to get on with that ticket. Not sure how long it will take me to get to it, I am trying to diagnose flaky RAM on my main dev machine. Compilations breaking in random places is a good signal of issue.",
    "created_at": "2022-03-23T01:03:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544476",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'>Comment 11:</a>
Need to get on with that ticket. Not sure how long it will take me to get to it, I am trying to diagnose flaky RAM on my main dev machine. Compilations breaking in random places is a good signal of issue.



---

archive/issue_comments_544477.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@kiwifb](#comment%3A8):\n> `--installed` is for running against a sage install as opposed to running on the source. pytest default on running on source. As for your latest suggestion, in the normal use case for this ticket, `SAGE_SRC` is usually pointing to `SAGE_LIB` and `tox.ini` may not be available.\n\nThanks for the explanation. Pytest is able to test everything that can be imported using importlib, so testing the existing sage install should be possible as well. However, the \"normal\" setup would be to run pytest on the source code of the tests but use the installed version of the package (this is for example how pytest works in the context of tox environments).\n\nMaybe its worth a try to distribute/install the tox.ini file as well, or export the pytest config to `pytest.ini` or `pyproject.toml` and distribute that?\n\n\nI cannot judge if it would be okay to skip pytest for `--installed`. That probably depends on the context when `--installed` is used. You definitely skip the existing pytests in that case. (Admittedly, this is not a huge lost atm).",
    "created_at": "2022-03-24T16:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544477",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@kiwifb](#comment%3A8):
> `--installed` is for running against a sage install as opposed to running on the source. pytest default on running on source. As for your latest suggestion, in the normal use case for this ticket, `SAGE_SRC` is usually pointing to `SAGE_LIB` and `tox.ini` may not be available.

Thanks for the explanation. Pytest is able to test everything that can be imported using importlib, so testing the existing sage install should be possible as well. However, the "normal" setup would be to run pytest on the source code of the tests but use the installed version of the package (this is for example how pytest works in the context of tox environments).

Maybe its worth a try to distribute/install the tox.ini file as well, or export the pytest config to `pytest.ini` or `pyproject.toml` and distribute that?


I cannot judge if it would be okay to skip pytest for `--installed`. That probably depends on the context when `--installed` is used. You definitely skip the existing pytests in that case. (Admittedly, this is not a huge lost atm).



---

archive/issue_comments_544478.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThere are two major use cases for `--installed`: In downstream distributions and for testing modularized distribution packages. For the latter, an example is #32601. In this context, there is no problem with providing the pytest configuration, as the source is available.",
    "created_at": "2022-03-24T16:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544478",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>Comment 13:</a>
There are two major use cases for `--installed`: In downstream distributions and for testing modularized distribution packages. For the latter, an example is #32601. In this context, there is no problem with providing the pytest configuration, as the source is available.



---

archive/issue_comments_544479.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2022-03-25T18:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544479",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_544480.json:
```json
{
    "body": "Changed dependencies from **#31924** to none",
    "created_at": "2022-03-25T18:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544480",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31924** to none



---

archive/issue_comments_544481.json:
```json
{
    "body": "Branch: **[u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage)**",
    "created_at": "2022-03-25T18:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544481",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage)**



---

archive/issue_comments_544482.json:
```json
{
    "body": "Commit: **[d0831c1](https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d)**",
    "created_at": "2022-03-25T18:46:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544482",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[d0831c1](https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d)**



---

archive/issue_events_442072.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-25T18:46:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442072"
}
```



---

archive/issue_comments_544483.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nHere's an attempt at a solution following [comment:5](#comment%3A5)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d\">d0831c1</a></td><td><code>src/bin/sage-runtests: Do not run pytest if the pytest configuration is not available</code></td></tr></table>\n",
    "created_at": "2022-03-25T18:46:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544483",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>Comment 16:</a>
Here's an attempt at a solution following [comment:5](#comment%3A5)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d">d0831c1</a></td><td><code>src/bin/sage-runtests: Do not run pytest if the pytest configuration is not available</code></td></tr></table>




---

archive/issue_comments_544484.json:
```json
{
    "body": "Changed commit from **[d0831c1](https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d)** to **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**",
    "created_at": "2022-04-12T02:48:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544484",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d0831c1](https://github.com/sagemath/sagetrac-mirror/commit/d0831c194b0c2d9aeabd1302fa6b75bfecbbe33d)** to **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**



---

archive/issue_comments_544485.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c46c086cf81fe32ae8e1210a89650d869831111\">7c46c08</a></td><td><code>src/bin/sage-runtests: Do not run pytest if the pytest configuration is not available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998\">84d3d9e</a></td><td><code>src/bin/sage-runtests: Clarify where pytest would have to be installed</code></td></tr></table>\n",
    "created_at": "2022-04-12T02:48:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544485",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c46c086cf81fe32ae8e1210a89650d869831111">7c46c08</a></td><td><code>src/bin/sage-runtests: Do not run pytest if the pytest configuration is not available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998">84d3d9e</a></td><td><code>src/bin/sage-runtests: Clarify where pytest would have to be installed</code></td></tr></table>




---

archive/issue_comments_544486.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI have been busy the last couple of weeks and completely forgotten about this ticket. I will try to do a proper review later today.",
    "created_at": "2022-04-12T20:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544486",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'>Comment 19:</a>
I have been busy the last couple of weeks and completely forgotten about this ticket. I will try to do a proper review later today.



---

archive/issue_comments_544487.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nIt works as expected for me in sage-on-gentoo. pytest are not run on system install lacking the right configuration files anymore.",
    "created_at": "2022-04-12T23:58:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544487",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'>Comment 20:</a>
It works as expected for me in sage-on-gentoo. pytest are not run on system install lacking the right configuration files anymore.



---

archive/issue_comments_544488.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2022-04-12T23:58:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544488",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_events_442073.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-04-12T23:58:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442073"
}
```



---

archive/issue_events_442074.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-04-12T23:58:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442074"
}
```



---

archive/issue_comments_544489.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThank you!",
    "created_at": "2022-04-13T01:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544489",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Thank you!



---

archive/issue_events_442075.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-19T21:07:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442075"
}
```



---

archive/issue_events_442076.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-19T21:07:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442076"
}
```



---

archive/issue_comments_544490.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage)** to **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**",
    "created_at": "2022-04-21T21:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33521#issuecomment-544490",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/doctesting_with_pytest_fails_on_system_install_of_sage)** to **[84d3d9e](https://github.com/sagemath/sagetrac-mirror/commit/84d3d9e5ca7b6d15355743f94c6c917359136998)**



---

archive/issue_events_442077.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-21T21:07:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442077"
}
```



---

archive/issue_events_442078.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "781a14a17d576ca7a53d25d31fe3d2da3c0cd8b4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-04-21T21:07:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33521",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33521#event-442078"
}
```
