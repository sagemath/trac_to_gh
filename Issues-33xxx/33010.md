# Issue 33010: Update bliss to 0.77

archive/issues_032773.json:
```json
{
    "assignees": [],
    "body": "Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.\n\nNeeds changes in sagelib for the new `canonical_form` and `find_automorphisms` API.\n\nCC:  @mkoeppe @kiwifb\n\nBranch/Commit: **[u/arojas/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/bliss-0.77) @ [5fb71e5](https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc)**\n\nAuthor: **Antonio Rojas, Fran\u00e7ois Bissey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33010_\n\n",
    "created_at": "2021-12-10T17:50:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update bliss to 0.77",
    "type": "issue",
    "updated_at": "2022-12-31T21:31:21Z",
    "url": "https://github.com/sagemath/sage/issues/33010",
    "user": "https://github.com/antonio-rojas"
}
```
Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.

Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.

CC:  @mkoeppe @kiwifb

Branch/Commit: **[u/arojas/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/bliss-0.77) @ [5fb71e5](https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc)**

Author: **Antonio Rojas, Fran√ßois Bissey**

_Issue created by migration from https://trac.sagemath.org/ticket/33010_





---

archive/issue_events_435980.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-12-10T17:50:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435980"
}
```



---

archive/issue_events_435981.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-12-10T17:50:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435981"
}
```



---

archive/issue_comments_536034.json:
```json
{
    "body": "Branch: **[u/arojas/update_bliss_to_0_77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/update_bliss_to_0_77)**",
    "created_at": "2021-12-10T18:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536034",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/update_bliss_to_0_77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/update_bliss_to_0_77)**



---

archive/issue_events_435982.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-12-10T18:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435982"
}
```



---

archive/issue_comments_536035.json:
```json
{
    "body": "Author: **Antonio Rojas, ...**",
    "created_at": "2021-12-10T18:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536035",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas, ...**



---

archive/issue_events_435983.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-12-10T18:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435983"
}
```



---

archive/issue_comments_536036.json:
```json
{
    "body": "Commit: **[68c32fc](https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1)**",
    "created_at": "2021-12-10T18:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536036",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[68c32fc](https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1)**



---

archive/issue_comments_536037.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThe `automorphism_group_gens_from_edge_list` method still needs porting to the new `find_automorphisms` signature. Its `report` parameter no longer takes a `user_param` argument, so it can't be used to update the sage automorphism list. Some cython experts should take a look.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/154ae68f57c933ea385217fce90cfffabbdcc2d3\">154ae68</a></td><td><code>Port to changes in canonical_form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1\">68c32fc</a></td><td><code>Update bliss to 0.77</code></td></tr></table>\n",
    "created_at": "2021-12-10T18:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536037",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2" align="right">Comment 2</div>

The `automorphism_group_gens_from_edge_list` method still needs porting to the new `find_automorphisms` signature. Its `report` parameter no longer takes a `user_param` argument, so it can't be used to update the sage automorphism list. Some cython experts should take a look.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/154ae68f57c933ea385217fce90cfffabbdcc2d3">154ae68</a></td><td><code>Port to changes in canonical_form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1">68c32fc</a></td><td><code>Update bliss to 0.77</code></td></tr></table>




---

archive/issue_comments_536038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.\n \n+Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.\n``````\n",
    "created_at": "2021-12-10T18:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536038",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.
 
+Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.
``````




---

archive/issue_comments_536039.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\n+1 for dropping my fork. I have archived it now: https://github.com/mkoeppe/bliss",
    "created_at": "2021-12-10T18:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536039",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">Comment 3</div>

+1 for dropping my fork. I have archived it now: https://github.com/mkoeppe/bliss



---

archive/issue_comments_536040.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nDoes the new cmake build system not have a working install target?\n\nIf it doesn't, please use `sdh_install` instead of `install` so that the installation is staged correctly",
    "created_at": "2021-12-10T18:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536040",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">Comment 4</div>

Does the new cmake build system not have a working install target?

If it doesn't, please use `sdh_install` instead of `install` so that the installation is staged correctly



---

archive/issue_comments_536041.json:
```json
{
    "body": "Changed commit from **[68c32fc](https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1)** to **[d7373dc](https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0)**",
    "created_at": "2021-12-10T18:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536041",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[68c32fc](https://github.com/sagemath/sagetrac-mirror/commit/68c32fc44ac71a518bb72311fec38d85e6d2bbf1)** to **[d7373dc](https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0)**



---

archive/issue_comments_536042.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0\">d7373dc</a></td><td><code>use sdh_install</code></td></tr></table>\n",
    "created_at": "2021-12-10T18:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536042",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0">d7373dc</a></td><td><code>use sdh_install</code></td></tr></table>




---

archive/issue_comments_536043.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nWorking on a patch to fix the install. Since it is cmake and not autoconf there is no need to regenerate anything. It makes downstream packagers life easier in that regard.",
    "created_at": "2021-12-13T01:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536043",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

Working on a patch to fix the install. Since it is cmake and not autoconf there is no need to regenerate anything. It makes downstream packagers life easier in that regard.



---

archive/issue_comments_536044.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nWhile working on my patch, I noticed you forgot the C header header `bliss_C.h` in your installation. I missed it on my first pass too.\n\nBut I believe it is now ready\n\n```\ndiff --git a/CMakeLists.txt b/CMakeLists.txt\nindex 01ed093..9d3085d 100644\n--- a/CMakeLists.txt\n+++ b/CMakeLists.txt\n@@ -62,3 +62,27 @@ if(USE_GMP)\n   target_link_libraries(bliss-executable ${GMP_LIBRARIES})\n endif(USE_GMP)\n set_target_properties(bliss-executable PROPERTIES OUTPUT_NAME bliss)\n+\n+include(GNUInstallDirs)\n+\n+set(\n+  BLISS_HEADERS\n+  src/bliss_C.h\n+  src/uintseqhash.hh\n+  src/abstractgraph.hh\n+  src/stats.hh\n+  src/digraph.hh\n+  src/defs.hh\n+  src/heap.hh\n+  src/graph.hh\n+  src/partition.hh\n+  src/kqueue.hh\n+  src/utils.hh\n+  src/orbit.hh\n+  src/timer.hh\n+  src/bignum.hh\n+)\n+\n+install(TARGETS bliss-executable RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})\n+install(TARGETS bliss LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})\n+install(FILES ${BLISS_HEADERS} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/bliss)\n```",
    "created_at": "2021-12-13T02:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536044",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">Comment 8</div>

While working on my patch, I noticed you forgot the C header header `bliss_C.h` in your installation. I missed it on my first pass too.

But I believe it is now ready

```
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 01ed093..9d3085d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -62,3 +62,27 @@ if(USE_GMP)
   target_link_libraries(bliss-executable ${GMP_LIBRARIES})
 endif(USE_GMP)
 set_target_properties(bliss-executable PROPERTIES OUTPUT_NAME bliss)
+
+include(GNUInstallDirs)
+
+set(
+  BLISS_HEADERS
+  src/bliss_C.h
+  src/uintseqhash.hh
+  src/abstractgraph.hh
+  src/stats.hh
+  src/digraph.hh
+  src/defs.hh
+  src/heap.hh
+  src/graph.hh
+  src/partition.hh
+  src/kqueue.hh
+  src/utils.hh
+  src/orbit.hh
+  src/timer.hh
+  src/bignum.hh
+)
+
+install(TARGETS bliss-executable RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})
+install(TARGETS bliss LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})
+install(FILES ${BLISS_HEADERS} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/bliss)
```



---

archive/issue_comments_536045.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIndeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.",
    "created_at": "2021-12-13T11:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536045",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:9" align="right">Comment 9</div>

Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.



---

archive/issue_comments_536046.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@antonio-rojas](#comment%3A9):\n> Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.\n\nUnfortunately it seems that `bliss_C.h` only implements `find_automorphisms` for graphs, not for digraphs, so it is not enough. This still needs porting work.",
    "created_at": "2021-12-13T19:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536046",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@antonio-rojas](#comment%3A9):
> Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.

Unfortunately it seems that `bliss_C.h` only implements `find_automorphisms` for graphs, not for digraphs, so it is not enough. This still needs porting work.



---

archive/issue_comments_536047.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIt's fine. We don't need to absolutely use it, but some other downstream packages may want it. I'll refresh the branch.",
    "created_at": "2021-12-13T20:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536047",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">Comment 11</div>

It's fine. We don't need to absolutely use it, but some other downstream packages may want it. I'll refresh the branch.



---

archive/issue_comments_536048.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nDo we want to provide a .pc file? Debian will probably want to add a man page again when they pick it up (policy for anything installed under `/usr/bin/`).",
    "created_at": "2021-12-13T21:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536048",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

Do we want to provide a .pc file? Debian will probably want to add a man page again when they pick it up (policy for anything installed under `/usr/bin/`).



---

archive/issue_comments_536049.json:
```json
{
    "body": "Changed author from **Antonio Rojas, ...** to **Antonio Rojas, Fran\u00e7ois Bissey**",
    "created_at": "2021-12-13T21:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536049",
    "user": "https://github.com/kiwifb"
}
```

Changed author from **Antonio Rojas, ...** to **Antonio Rojas, Fran√ßois Bissey**



---

archive/issue_comments_536050.json:
```json
{
    "body": "Changed commit from **[d7373dc](https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0)** to **[b12a8d2](https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)**",
    "created_at": "2021-12-13T21:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536050",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[d7373dc](https://github.com/sagemath/sagetrac-mirror/commit/d7373dcac4329c2fe98b75e0eeb02fb27927fff0)** to **[b12a8d2](https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)**



---

archive/issue_comments_536051.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73af72a4f0349648c933d1514de8274b2511b7b9\">73af72a</a></td><td><code>Merge branch 'develop' into bliss-0.77</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb6f0c24d4884bf9e63df91ec0a932b90914a9ce\">bb6f0c2</a></td><td><code>patch an install target for bliss</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0\">b12a8d2</a></td><td><code>update bliss' SPKG.rst</code></td></tr></table>\n",
    "created_at": "2021-12-13T21:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536051",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">Comment 13</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73af72a4f0349648c933d1514de8274b2511b7b9">73af72a</a></td><td><code>Merge branch 'develop' into bliss-0.77</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb6f0c24d4884bf9e63df91ec0a932b90914a9ce">bb6f0c2</a></td><td><code>patch an install target for bliss</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0">b12a8d2</a></td><td><code>update bliss' SPKG.rst</code></td></tr></table>




---

archive/issue_comments_536052.json:
```json
{
    "body": "Changed branch from **[u/arojas/update_bliss_to_0_77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/update_bliss_to_0_77)** to **[u/fbissey/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/bliss-0.77)**",
    "created_at": "2021-12-13T21:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536052",
    "user": "https://github.com/kiwifb"
}
```

Changed branch from **[u/arojas/update_bliss_to_0_77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/update_bliss_to_0_77)** to **[u/fbissey/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/bliss-0.77)**



---

archive/issue_comments_536053.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nI have done some patch inspection on Gentoo and Matthias' repo. I don't think anything much has made it in the new upstream. However some changes in the code makes it hard to figure out where some patches should be applied now - if they are still needed.",
    "created_at": "2021-12-13T21:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536053",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">Comment 14</div>

I have done some patch inspection on Gentoo and Matthias' repo. I don't think anything much has made it in the new upstream. However some changes in the code makes it hard to figure out where some patches should be applied now - if they are still needed.



---

archive/issue_events_435984.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435984"
}
```



---

archive/issue_events_435985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435985"
}
```



---

archive/issue_comments_536054.json:
```json
{
    "body": "Changed branch from **[u/fbissey/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/bliss-0.77)** to **[u/arojas/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/bliss-0.77)**",
    "created_at": "2021-12-26T13:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536054",
    "user": "https://github.com/antonio-rojas"
}
```

Changed branch from **[u/fbissey/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/bliss-0.77)** to **[u/arojas/bliss-0.77](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/bliss-0.77)**



---

archive/issue_comments_536055.json:
```json
{
    "body": "Changed commit from **[b12a8d2](https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)** to **[e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99)**",
    "created_at": "2021-12-26T13:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536055",
    "user": "https://github.com/antonio-rojas"
}
```

Changed commit from **[b12a8d2](https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)** to **[e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99)**



---

archive/issue_comments_536056.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThe latest commit reimplements the old `find_automorphisms` API in a separate header. With this branch Sage builds fine and all tests in `sage.graphs.bliss` pass.\n\nThis is a band-aid solution and I don't expect it to be merged as it is, but at least it can be useful for distros that ship an updated bliss until someone looks into porting the cython code properly.\n\nAlso, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99\">e5539c5</a></td><td><code>Reimplement old find_automorphisms API in an external header</code></td></tr></table>\n",
    "created_at": "2021-12-26T13:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536056",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:17" align="right">Comment 17</div>

The latest commit reimplements the old `find_automorphisms` API in a separate header. With this branch Sage builds fine and all tests in `sage.graphs.bliss` pass.

This is a band-aid solution and I don't expect it to be merged as it is, but at least it can be useful for distros that ship an updated bliss until someone looks into porting the cython code properly.

Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99">e5539c5</a></td><td><code>Reimplement old find_automorphisms API in an external header</code></td></tr></table>




---

archive/issue_comments_536057.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@antonio-rojas](#comment%3A17):\n> Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.\n\nIndeed, the following segfaults when bliss is compiled with GMP:\n\n```\n#include <bliss/graph.hh>\n\nint main() {\n  bliss::Graph *g = new bliss::Graph(2);\n  bliss::Stats s;\n  g->canonical_form(s);\n  return 0;\n}\n```\nUnfortunately they don't seem to have a bug tracker.",
    "created_at": "2021-12-26T14:48:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536057",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@antonio-rojas](#comment%3A17):
> Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.

Indeed, the following segfaults when bliss is compiled with GMP:

```
#include <bliss/graph.hh>

int main() {
  bliss::Graph *g = new bliss::Graph(2);
  bliss::Stats s;
  g->canonical_form(s);
  return 0;
}
```
Unfortunately they don't seem to have a bug tracker.



---

archive/issue_comments_536058.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nThe GMP issue is not new. This is exactly why the sage package is built without GMP support. I probably should ask the GMP support option to be removed in Gentoo since it is buggy.",
    "created_at": "2021-12-26T19:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536058",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">Comment 19</div>

The GMP issue is not new. This is exactly why the sage package is built without GMP support. I probably should ask the GMP support option to be removed in Gentoo since it is buggy.



---

archive/issue_comments_536059.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73af72a4f0349648c933d1514de8274b2511b7b9\">73af72a</a></td><td><code>Merge branch 'develop' into bliss-0.77</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb6f0c24d4884bf9e63df91ec0a932b90914a9ce\">bb6f0c2</a></td><td><code>patch an install target for bliss</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0\">b12a8d2</a></td><td><code>update bliss' SPKG.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454\">69d8da4</a></td><td><code>Merge branch 'u/fbissey/bliss-0.77' of git://trac.sagemath.org/sage into t/33010/update_bliss_to_0_77</code></td></tr></table>\n",
    "created_at": "2021-12-26T21:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536059",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20" align="right">Comment 20</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73af72a4f0349648c933d1514de8274b2511b7b9">73af72a</a></td><td><code>Merge branch 'develop' into bliss-0.77</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb6f0c24d4884bf9e63df91ec0a932b90914a9ce">bb6f0c2</a></td><td><code>patch an install target for bliss</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0">b12a8d2</a></td><td><code>update bliss' SPKG.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454">69d8da4</a></td><td><code>Merge branch 'u/fbissey/bliss-0.77' of git://trac.sagemath.org/sage into t/33010/update_bliss_to_0_77</code></td></tr></table>




---

archive/issue_comments_536060.json:
```json
{
    "body": "Changed commit from **[e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99)** to **[69d8da4](https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454)**",
    "created_at": "2021-12-26T21:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536060",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99)** to **[69d8da4](https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454)**



---

archive/issue_comments_536061.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@antonio-rojas](#comment%3A17):\n> This is a band-aid solution and I don't expect it to be merged as it is\n\nin order to successfully use [e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99) today, I had to update **bliss.pyx**-related part of it:\n\n```diff\n--- a/src/sage/graphs/bliss.pyx\n+++ b/src/sage/graphs/bliss.pyx\n@@ -1,3 +1,4 @@\n+# cython: language_level=3\n # distutils: language = c++\n # distutils: libraries = bliss\n # sage_setup: distribution = sagemath-bliss\n@@ -47,22 +48,31 @@\n     cdef cppclass Graph(AbstractGraph):\n         Graph(const unsigned int)\n         void add_edge(const unsigned int, const unsigned int)\n-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,\n-                    const unsigned int*), void*)\n         void change_color(const unsigned int, const unsigned int);\n-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,\n+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,\n                     const unsigned int*), void*)\n \n+cdef extern from \"bliss/digraph.hh\" namespace \"bliss\":\n+\n+    cdef cppclass Stats:\n+        pass\n+\n+    cdef cppclass AbstractGraph:\n+        pass\n+\n     cdef cppclass Digraph(AbstractGraph):\n         Digraph(const unsigned int)\n         void add_edge(const unsigned int, const unsigned int)\n-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,\n-                    const unsigned int*), void*)\n         void change_color(const unsigned int, const unsigned int);\n-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,\n+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,\n                     const unsigned int*), void*)\n         unsigned int get_hash()\n \n+cdef extern from \"bliss_find_automorphisms.h\":\n+\n+    void bliss_find_automorphisms(Graph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)\n+    void bliss_find_automorphisms(Digraph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)\n+\n \n cdef int encoding_numbits(int n):\n     r\"\"\"\n@@ -124,7 +134,7 @@\n \n     sig_free(done)\n \n-cdef void empty_hook(void *user_param , unsigned int n, const unsigned int *aut):\n+cdef void empty_hook(unsigned int n, const unsigned int *aut):\n     return\n \n #####################################################\n@@ -640,11 +650,11 @@\n \n     if directed:\n         d = bliss_digraph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)\n-        d.find_automorphisms(s, add_gen, <void*>data)\n+        bliss_find_automorphisms(d, add_gen, <void*>data, s)\n         del d\n     else:\n         g = bliss_graph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)\n-        g.find_automorphisms(s, add_gen, <void*>data)\n+        bliss_find_automorphisms(g, add_gen, <void*>data, s)\n         del g\n \n     return [[cyc for cyc in gen if cyc[0] is not None] for gen in gens]\n```",
    "created_at": "2022-02-03T21:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536061",
    "user": "https://github.com/sheerluck"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@antonio-rojas](#comment%3A17):
> This is a band-aid solution and I don't expect it to be merged as it is

in order to successfully use [e5539c5](https://github.com/sagemath/sagetrac-mirror/commit/e5539c563cb285a2455849bd9b56933c7da97b99) today, I had to update **bliss.pyx**-related part of it:

```diff
--- a/src/sage/graphs/bliss.pyx
+++ b/src/sage/graphs/bliss.pyx
@@ -1,3 +1,4 @@
+# cython: language_level=3
 # distutils: language = c++
 # distutils: libraries = bliss
 # sage_setup: distribution = sagemath-bliss
@@ -47,22 +48,31 @@
     cdef cppclass Graph(AbstractGraph):
         Graph(const unsigned int)
         void add_edge(const unsigned int, const unsigned int)
-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,
-                    const unsigned int*), void*)
         void change_color(const unsigned int, const unsigned int);
-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,
+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,
                     const unsigned int*), void*)
 
+cdef extern from "bliss/digraph.hh" namespace "bliss":
+
+    cdef cppclass Stats:
+        pass
+
+    cdef cppclass AbstractGraph:
+        pass
+
     cdef cppclass Digraph(AbstractGraph):
         Digraph(const unsigned int)
         void add_edge(const unsigned int, const unsigned int)
-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,
-                    const unsigned int*), void*)
         void change_color(const unsigned int, const unsigned int);
-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,
+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,
                     const unsigned int*), void*)
         unsigned int get_hash()
 
+cdef extern from "bliss_find_automorphisms.h":
+
+    void bliss_find_automorphisms(Graph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)
+    void bliss_find_automorphisms(Digraph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)
+
 
 cdef int encoding_numbits(int n):
     r"""
@@ -124,7 +134,7 @@
 
     sig_free(done)
 
-cdef void empty_hook(void *user_param , unsigned int n, const unsigned int *aut):
+cdef void empty_hook(unsigned int n, const unsigned int *aut):
     return
 
 #####################################################
@@ -640,11 +650,11 @@
 
     if directed:
         d = bliss_digraph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)
-        d.find_automorphisms(s, add_gen, <void*>data)
+        bliss_find_automorphisms(d, add_gen, <void*>data, s)
         del d
     else:
         g = bliss_graph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)
-        g.find_automorphisms(s, add_gen, <void*>data)
+        bliss_find_automorphisms(g, add_gen, <void*>data, s)
         del g
 
     return [[cyc for cyc in gen if cyc[0] is not None] for gen in gens]
```



---

archive/issue_comments_536062.json:
```json
{
    "body": "Changed commit from **[69d8da4](https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454)** to **[5fb71e5](https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc)**",
    "created_at": "2022-02-28T19:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536062",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[69d8da4](https://github.com/sagemath/sagetrac-mirror/commit/69d8da40e9190c583bc1b675ad8e44e32b874454)** to **[5fb71e5](https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc)**



---

archive/issue_comments_536063.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc\">5fb71e5</a></td><td><code>Merge remote-tracking branch 'origin' into t/33010/update_bliss_to_0_77</code></td></tr></table>\n",
    "created_at": "2022-02-28T19:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33010#issuecomment-536063",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22" align="right">Comment 22</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fb71e501c369e3c74a76184bdf020ced08a9fdc">5fb71e5</a></td><td><code>Merge remote-tracking branch 'origin' into t/33010/update_bliss_to_0_77</code></td></tr></table>




---

archive/issue_events_435986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435986"
}
```



---

archive/issue_events_435987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435987"
}
```



---

archive/issue_events_435988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435988"
}
```



---

archive/issue_events_435989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435989"
}
```



---

archive/issue_events_435990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-31T21:31:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435990"
}
```



---

archive/issue_events_435991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-31T21:31:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33010",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33010#event-435991"
}
```
