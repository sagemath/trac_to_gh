# Issue 33010: Update bliss to 0.77

archive/issues_032773.json:
```json
{
    "body": "Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.\n\nNeeds changes in sagelib for the new `canonical_form` and `find_automorphisms` API.\n\nCC:  @mkoeppe @kiwifb\n\nAuthor: Antonio Rojas, Fran\u00e7ois Bissey\n\nBranch: u/arojas/bliss-0.77\n\nStatus: new\n\nCommit: 5fb71e501c369e3c74a76184bdf020ced08a9fdc\n\nIssue created by migration from https://trac.sagemath.org/ticket/33010\n\n",
    "created_at": "2021-12-10T17:50:02Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Update bliss to 0.77",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33010",
    "user": "https://github.com/antonio-rojas"
}
```
Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.

Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.

CC:  @mkoeppe @kiwifb

Author: Antonio Rojas, François Bissey

Branch: u/arojas/bliss-0.77

Status: new

Commit: 5fb71e501c369e3c74a76184bdf020ced08a9fdc

Issue created by migration from https://trac.sagemath.org/ticket/33010





---

archive/issue_comments_658110.json:
```json
{
    "body": "Changing branch from \"\" to \"u/arojas/update_bliss_to_0_77\"",
    "created_at": "2021-12-10T18:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658110",
    "user": "https://github.com/antonio-rojas"
}
```

Changing branch from "" to "u/arojas/update_bliss_to_0_77"



---

archive/issue_comments_658111.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658111",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_658112.json:
```json
{
    "body": "Changing author from \"\" to \"Antonio Rojas, ...\"",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658112",
    "user": "https://github.com/antonio-rojas"
}
```

Changing author from "" to "Antonio Rojas, ..."



---

archive/issue_comments_658113.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658113",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_658114.json:
```json
{
    "body": "Changing commit from \"\" to \"68c32fc44ac71a518bb72311fec38d85e6d2bbf1\"",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658114",
    "user": "https://github.com/antonio-rojas"
}
```

Changing commit from "" to "68c32fc44ac71a518bb72311fec38d85e6d2bbf1"



---

archive/issue_comments_658115.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe `automorphism_group_gens_from_edge_list` method still needs porting to the new `find_automorphisms` signature. Its `report` parameter no longer takes a `user_param` argument, so it can't be used to update the sage automorphism list. Some cython experts should take a look.\n\n---\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[154ae68](https://git.sagemath.org/sage.git/commit?id=154ae68f57c933ea385217fce90cfffabbdcc2d3)|`Port to changes in canonical_form`|\n|[68c32fc](https://git.sagemath.org/sage.git/commit?id=68c32fc44ac71a518bb72311fec38d85e6d2bbf1)|`Update bliss to 0.77`|",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658115",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>
The `automorphism_group_gens_from_edge_list` method still needs porting to the new `find_automorphisms` signature. Its `report` parameter no longer takes a `user_param` argument, so it can't be used to update the sage automorphism list. Some cython experts should take a look.

---
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[154ae68](https://git.sagemath.org/sage.git/commit?id=154ae68f57c933ea385217fce90cfffabbdcc2d3)|`Port to changes in canonical_form`|
|[68c32fc](https://git.sagemath.org/sage.git/commit?id=68c32fc44ac71a518bb72311fec38d85e6d2bbf1)|`Update bliss to 0.77`|



---

archive/issue_comments_658116.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.\n \n+Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.\n``````\n",
    "created_at": "2021-12-10T18:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658116",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Comes with a cmake-based build system now (albeit with no install target), so the autotoolization patches shouldn't be needed. Not sure about the other patches included in the fork, but in case any of them is still needed we might consider to keep them here rather than in an outside fork for transparency.
 
+Needs changes in sagelib for the new `canonical_form` and `find_automorphisms` API.
``````




---

archive/issue_comments_658117.json:
```json
{
    "body": "<a id='comment:3'></a>\n+1 for dropping my fork. I have archived it now: https://github.com/mkoeppe/bliss",
    "created_at": "2021-12-10T18:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
+1 for dropping my fork. I have archived it now: https://github.com/mkoeppe/bliss



---

archive/issue_comments_658118.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoes the new cmake build system not have a working install target?\n\nIf it doesn't, please use `sdh_install` instead of `install` so that the installation is staged correctly",
    "created_at": "2021-12-10T18:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Does the new cmake build system not have a working install target?

If it doesn't, please use `sdh_install` instead of `install` so that the installation is staged correctly



---

archive/issue_comments_658119.json:
```json
{
    "body": "Changing commit from \"68c32fc44ac71a518bb72311fec38d85e6d2bbf1\" to \"d7373dcac4329c2fe98b75e0eeb02fb27927fff0\"",
    "created_at": "2021-12-10T18:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "68c32fc44ac71a518bb72311fec38d85e6d2bbf1" to "d7373dcac4329c2fe98b75e0eeb02fb27927fff0"



---

archive/issue_comments_658120.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[d7373dc](https://git.sagemath.org/sage.git/commit/?id=d7373dcac4329c2fe98b75e0eeb02fb27927fff0)|`use sdh_install`|",
    "created_at": "2021-12-10T18:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[d7373dc](https://git.sagemath.org/sage.git/commit/?id=d7373dcac4329c2fe98b75e0eeb02fb27927fff0)|`use sdh_install`|



---

archive/issue_comments_658121.json:
```json
{
    "body": "<a id='comment:7'></a>\nWorking on a patch to fix the install. Since it is cmake and not autoconf there is no need to regenerate anything. It makes downstream packagers life easier in that regard.",
    "created_at": "2021-12-13T01:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658121",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Working on a patch to fix the install. Since it is cmake and not autoconf there is no need to regenerate anything. It makes downstream packagers life easier in that regard.



---

archive/issue_comments_658122.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhile working on my patch, I noticed you forgot the C header header `bliss_C.h` in your installation. I missed it on my first pass too.\n\nBut I believe it is now ready\n\n```\ndiff --git a/CMakeLists.txt b/CMakeLists.txt\nindex 01ed093..9d3085d 100644\n--- a/CMakeLists.txt\n+++ b/CMakeLists.txt\n@@ -62,3 +62,27 @@ if(USE_GMP)\n   target_link_libraries(bliss-executable ${GMP_LIBRARIES})\n endif(USE_GMP)\n set_target_properties(bliss-executable PROPERTIES OUTPUT_NAME bliss)\n+\n+include(GNUInstallDirs)\n+\n+set(\n+  BLISS_HEADERS\n+  src/bliss_C.h\n+  src/uintseqhash.hh\n+  src/abstractgraph.hh\n+  src/stats.hh\n+  src/digraph.hh\n+  src/defs.hh\n+  src/heap.hh\n+  src/graph.hh\n+  src/partition.hh\n+  src/kqueue.hh\n+  src/utils.hh\n+  src/orbit.hh\n+  src/timer.hh\n+  src/bignum.hh\n+)\n+\n+install(TARGETS bliss-executable RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})\n+install(TARGETS bliss LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})\n+install(FILES ${BLISS_HEADERS} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/bliss)\n```",
    "created_at": "2021-12-13T02:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658122",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
While working on my patch, I noticed you forgot the C header header `bliss_C.h` in your installation. I missed it on my first pass too.

But I believe it is now ready

```
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 01ed093..9d3085d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -62,3 +62,27 @@ if(USE_GMP)
   target_link_libraries(bliss-executable ${GMP_LIBRARIES})
 endif(USE_GMP)
 set_target_properties(bliss-executable PROPERTIES OUTPUT_NAME bliss)
+
+include(GNUInstallDirs)
+
+set(
+  BLISS_HEADERS
+  src/bliss_C.h
+  src/uintseqhash.hh
+  src/abstractgraph.hh
+  src/stats.hh
+  src/digraph.hh
+  src/defs.hh
+  src/heap.hh
+  src/graph.hh
+  src/partition.hh
+  src/kqueue.hh
+  src/utils.hh
+  src/orbit.hh
+  src/timer.hh
+  src/bignum.hh
+)
+
+install(TARGETS bliss-executable RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})
+install(TARGETS bliss LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})
+install(FILES ${BLISS_HEADERS} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/bliss)
```



---

archive/issue_comments_658123.json:
```json
{
    "body": "<a id='comment:9'></a>\nIndeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.",
    "created_at": "2021-12-13T11:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658123",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'></a>
Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.



---

archive/issue_comments_658124.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [arojas](#comment%3A9):\n> Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.\n\n\nUnfortunately it seems that `bliss_C.h` only implements `find_automorphisms` for graphs, not for digraphs, so it is not enough. This still needs porting work.",
    "created_at": "2021-12-13T19:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658124",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:10'></a>
Replying to [arojas](#comment%3A9):
> Indeed, I completely missed that, and it seems that `bliss_C.h` does provide the old `find_automorphisms` API, so it might make porting easier. OTOH, there is no C API for `canonical form`, and I don't know how feasible it is to mix C and C++ in the same pyx file.


Unfortunately it seems that `bliss_C.h` only implements `find_automorphisms` for graphs, not for digraphs, so it is not enough. This still needs porting work.



---

archive/issue_comments_658125.json:
```json
{
    "body": "<a id='comment:11'></a>\nIt's fine. We don't need to absolutely use it, but some other downstream packages may want it. I'll refresh the branch.",
    "created_at": "2021-12-13T20:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658125",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
It's fine. We don't need to absolutely use it, but some other downstream packages may want it. I'll refresh the branch.



---

archive/issue_comments_658126.json:
```json
{
    "body": "<a id='comment:12'></a>\nDo we want to provide a .pc file? Debian will probably want to add a man page again when they pick it up (policy for anything installed under `/usr/bin/`).",
    "created_at": "2021-12-13T21:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658126",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Do we want to provide a .pc file? Debian will probably want to add a man page again when they pick it up (policy for anything installed under `/usr/bin/`).



---

archive/issue_comments_658127.json:
```json
{
    "body": "<a id='comment:13'></a>\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[73af72a](https://git.sagemath.org/sage.git/commit?id=73af72a4f0349648c933d1514de8274b2511b7b9)|`Merge branch 'develop' into bliss-0.77`|\n|[bb6f0c2](https://git.sagemath.org/sage.git/commit?id=bb6f0c24d4884bf9e63df91ec0a932b90914a9ce)|`patch an install target for bliss`|\n|[b12a8d2](https://git.sagemath.org/sage.git/commit?id=b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)|`update bliss' SPKG.rst`|",
    "created_at": "2021-12-13T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658127",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[73af72a](https://git.sagemath.org/sage.git/commit?id=73af72a4f0349648c933d1514de8274b2511b7b9)|`Merge branch 'develop' into bliss-0.77`|
|[bb6f0c2](https://git.sagemath.org/sage.git/commit?id=bb6f0c24d4884bf9e63df91ec0a932b90914a9ce)|`patch an install target for bliss`|
|[b12a8d2](https://git.sagemath.org/sage.git/commit?id=b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)|`update bliss' SPKG.rst`|



---

archive/issue_comments_658128.json:
```json
{
    "body": "Changing author from \"Antonio Rojas, ...\" to \"Antonio Rojas, Fran\u00e7ois Bissey\"",
    "created_at": "2021-12-13T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658128",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "Antonio Rojas, ..." to "Antonio Rojas, François Bissey"



---

archive/issue_comments_658129.json:
```json
{
    "body": "Changing commit from \"d7373dcac4329c2fe98b75e0eeb02fb27927fff0\" to \"b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0\"",
    "created_at": "2021-12-13T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658129",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "d7373dcac4329c2fe98b75e0eeb02fb27927fff0" to "b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0"



---

archive/issue_comments_658130.json:
```json
{
    "body": "Changing branch from \"u/arojas/update_bliss_to_0_77\" to \"u/fbissey/bliss-0.77\"",
    "created_at": "2021-12-13T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658130",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "u/arojas/update_bliss_to_0_77" to "u/fbissey/bliss-0.77"



---

archive/issue_comments_658131.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have done some patch inspection on Gentoo and Matthias' repo. I don't think anything much has made it in the new upstream. However some changes in the code makes it hard to figure out where some patches should be applied now - if they are still needed.",
    "created_at": "2021-12-13T21:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658131",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
I have done some patch inspection on Gentoo and Matthias' repo. I don't think anything much has made it in the new upstream. However some changes in the code makes it hard to figure out where some patches should be applied now - if they are still needed.



---

archive/issue_events_087229.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33010#event-87229"
}
```



---

archive/issue_comments_658132.json:
```json
{
    "body": "Changing branch from \"u/fbissey/bliss-0.77\" to \"u/arojas/bliss-0.77\"",
    "created_at": "2021-12-26T13:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658132",
    "user": "https://github.com/antonio-rojas"
}
```

Changing branch from "u/fbissey/bliss-0.77" to "u/arojas/bliss-0.77"



---

archive/issue_comments_658133.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe latest commit reimplements the old `find_automorphisms` API in a separate header. With this branch Sage builds fine and all tests in `sage.graphs.bliss` pass.\n\nThis is a band-aid solution and I don't expect it to be merged as it is, but at least it can be useful for distros that ship an updated bliss until someone looks into porting the cython code properly.\n\nAlso, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.\n\n---\nNew commits:\n|                                                                                                                                          |                                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[e5539c5](https://git.sagemath.org/sage.git/commit?id=e5539c563cb285a2455849bd9b56933c7da97b99)|`Reimplement old find_automorphisms API in an external header`|",
    "created_at": "2021-12-26T13:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658133",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:17'></a>
The latest commit reimplements the old `find_automorphisms` API in a separate header. With this branch Sage builds fine and all tests in `sage.graphs.bliss` pass.

This is a band-aid solution and I don't expect it to be merged as it is, but at least it can be useful for distros that ship an updated bliss until someone looks into porting the cython code properly.

Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.

---
New commits:
|                                                                                                                                          |                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[e5539c5](https://git.sagemath.org/sage.git/commit?id=e5539c563cb285a2455849bd9b56933c7da97b99)|`Reimplement old find_automorphisms API in an external header`|



---

archive/issue_comments_658134.json:
```json
{
    "body": "Changing commit from \"b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0\" to \"e5539c563cb285a2455849bd9b56933c7da97b99\"",
    "created_at": "2021-12-26T13:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658134",
    "user": "https://github.com/antonio-rojas"
}
```

Changing commit from "b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0" to "e5539c563cb285a2455849bd9b56933c7da97b99"



---

archive/issue_comments_658135.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [arojas](#comment%3A17):\n> Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.\n\n\nIndeed, the following segfaults when bliss is compiled with GMP:\n\n```\n#include <bliss/graph.hh>\n\nint main() {\n  bliss::Graph *g = new bliss::Graph(2);\n  bliss::Stats s;\n  g->canonical_form(s);\n  return 0;\n}\n```\nUnfortunately they don't seem to have a bug tracker.",
    "created_at": "2021-12-26T14:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658135",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:18'></a>
Replying to [arojas](#comment%3A17):
> Also, this segfaults when bliss is built with GMP support (which is not the case in Sage), but that might be an upstream issue.


Indeed, the following segfaults when bliss is compiled with GMP:

```
#include <bliss/graph.hh>

int main() {
  bliss::Graph *g = new bliss::Graph(2);
  bliss::Stats s;
  g->canonical_form(s);
  return 0;
}
```
Unfortunately they don't seem to have a bug tracker.



---

archive/issue_comments_658136.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe GMP issue is not new. This is exactly why the sage package is built without GMP support. I probably should ask the GMP support option to be removed in Gentoo since it is buggy.",
    "created_at": "2021-12-26T19:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658136",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
The GMP issue is not new. This is exactly why the sage package is built without GMP support. I probably should ask the GMP support option to be removed in Gentoo since it is buggy.



---

archive/issue_comments_658137.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[73af72a](https://git.sagemath.org/sage.git/commit/?id=73af72a4f0349648c933d1514de8274b2511b7b9)|`Merge branch 'develop' into bliss-0.77`|\n|[bb6f0c2](https://git.sagemath.org/sage.git/commit/?id=bb6f0c24d4884bf9e63df91ec0a932b90914a9ce)|`patch an install target for bliss`|\n|[b12a8d2](https://git.sagemath.org/sage.git/commit/?id=b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)|`update bliss' SPKG.rst`|\n|[69d8da4](https://git.sagemath.org/sage.git/commit/?id=69d8da40e9190c583bc1b675ad8e44e32b874454)|`Merge branch 'u/fbissey/bliss-0.77' of git://trac.sagemath.org/sage into t/33010/update_bliss_to_0_77`|",
    "created_at": "2021-12-26T21:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[73af72a](https://git.sagemath.org/sage.git/commit/?id=73af72a4f0349648c933d1514de8274b2511b7b9)|`Merge branch 'develop' into bliss-0.77`|
|[bb6f0c2](https://git.sagemath.org/sage.git/commit/?id=bb6f0c24d4884bf9e63df91ec0a932b90914a9ce)|`patch an install target for bliss`|
|[b12a8d2](https://git.sagemath.org/sage.git/commit/?id=b12a8d2f2585dbf26c849f0abd1af5d80dafb8a0)|`update bliss' SPKG.rst`|
|[69d8da4](https://git.sagemath.org/sage.git/commit/?id=69d8da40e9190c583bc1b675ad8e44e32b874454)|`Merge branch 'u/fbissey/bliss-0.77' of git://trac.sagemath.org/sage into t/33010/update_bliss_to_0_77`|



---

archive/issue_comments_658138.json:
```json
{
    "body": "Changing commit from \"e5539c563cb285a2455849bd9b56933c7da97b99\" to \"69d8da40e9190c583bc1b675ad8e44e32b874454\"",
    "created_at": "2021-12-26T21:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e5539c563cb285a2455849bd9b56933c7da97b99" to "69d8da40e9190c583bc1b675ad8e44e32b874454"



---

archive/issue_comments_658139.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [arojas](#comment%3A17):\n> This is a band-aid solution and I don't expect it to be merged as it is\n\n\nin order to successfully use [e5539c5](https://git.sagemath.org/sage.git/commit?id=e5539c563cb285a2455849bd9b56933c7da97b99) today, I had to update **bliss.pyx**-related part of it:\n\n```diff\n--- a/src/sage/graphs/bliss.pyx\n+++ b/src/sage/graphs/bliss.pyx\n@@ -1,3 +1,4 @@\n+# cython: language_level=3\n # distutils: language = c++\n # distutils: libraries = bliss\n # sage_setup: distribution = sagemath-bliss\n@@ -47,22 +48,31 @@\n     cdef cppclass Graph(AbstractGraph):\n         Graph(const unsigned int)\n         void add_edge(const unsigned int, const unsigned int)\n-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,\n-                    const unsigned int*), void*)\n         void change_color(const unsigned int, const unsigned int);\n-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,\n+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,\n                     const unsigned int*), void*)\n \n+cdef extern from \"bliss/digraph.hh\" namespace \"bliss\":\n+\n+    cdef cppclass Stats:\n+        pass\n+\n+    cdef cppclass AbstractGraph:\n+        pass\n+\n     cdef cppclass Digraph(AbstractGraph):\n         Digraph(const unsigned int)\n         void add_edge(const unsigned int, const unsigned int)\n-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,\n-                    const unsigned int*), void*)\n         void change_color(const unsigned int, const unsigned int);\n-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,\n+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,\n                     const unsigned int*), void*)\n         unsigned int get_hash()\n \n+cdef extern from \"bliss_find_automorphisms.h\":\n+\n+    void bliss_find_automorphisms(Graph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)\n+    void bliss_find_automorphisms(Digraph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)\n+\n \n cdef int encoding_numbits(int n):\n     r\"\"\"\n@@ -124,7 +134,7 @@\n \n     sig_free(done)\n \n-cdef void empty_hook(void *user_param , unsigned int n, const unsigned int *aut):\n+cdef void empty_hook(unsigned int n, const unsigned int *aut):\n     return\n \n #####################################################\n@@ -640,11 +650,11 @@\n \n     if directed:\n         d = bliss_digraph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)\n-        d.find_automorphisms(s, add_gen, <void*>data)\n+        bliss_find_automorphisms(d, add_gen, <void*>data, s)\n         del d\n     else:\n         g = bliss_graph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)\n-        g.find_automorphisms(s, add_gen, <void*>data)\n+        bliss_find_automorphisms(g, add_gen, <void*>data, s)\n         del g\n \n     return [[cyc for cyc in gen if cyc[0] is not None] for gen in gens]\n```",
    "created_at": "2022-02-03T21:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658139",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:21'></a>
Replying to [arojas](#comment%3A17):
> This is a band-aid solution and I don't expect it to be merged as it is


in order to successfully use [e5539c5](https://git.sagemath.org/sage.git/commit?id=e5539c563cb285a2455849bd9b56933c7da97b99) today, I had to update **bliss.pyx**-related part of it:

```diff
--- a/src/sage/graphs/bliss.pyx
+++ b/src/sage/graphs/bliss.pyx
@@ -1,3 +1,4 @@
+# cython: language_level=3
 # distutils: language = c++
 # distutils: libraries = bliss
 # sage_setup: distribution = sagemath-bliss
@@ -47,22 +48,31 @@
     cdef cppclass Graph(AbstractGraph):
         Graph(const unsigned int)
         void add_edge(const unsigned int, const unsigned int)
-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,
-                    const unsigned int*), void*)
         void change_color(const unsigned int, const unsigned int);
-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,
+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,
                     const unsigned int*), void*)
 
+cdef extern from "bliss/digraph.hh" namespace "bliss":
+
+    cdef cppclass Stats:
+        pass
+
+    cdef cppclass AbstractGraph:
+        pass
+
     cdef cppclass Digraph(AbstractGraph):
         Digraph(const unsigned int)
         void add_edge(const unsigned int, const unsigned int)
-        void find_automorphisms(Stats&, void (*)(void* , unsigned int,
-                    const unsigned int*), void*)
         void change_color(const unsigned int, const unsigned int);
-        const unsigned int* canonical_form(Stats&, void (*)(void*,unsigned int,
+        const unsigned int* canonical_form(Stats&, void (*)(unsigned int,
                     const unsigned int*), void*)
         unsigned int get_hash()
 
+cdef extern from "bliss_find_automorphisms.h":
+
+    void bliss_find_automorphisms(Graph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)
+    void bliss_find_automorphisms(Digraph*, void (*)(void*, unsigned int, const unsigned int*), void*, Stats&)
+
 
 cdef int encoding_numbits(int n):
     r"""
@@ -124,7 +134,7 @@
 
     sig_free(done)
 
-cdef void empty_hook(void *user_param , unsigned int n, const unsigned int *aut):
+cdef void empty_hook(unsigned int n, const unsigned int *aut):
     return
 
 #####################################################
@@ -640,11 +650,11 @@
 
     if directed:
         d = bliss_digraph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)
-        d.find_automorphisms(s, add_gen, <void*>data)
+        bliss_find_automorphisms(d, add_gen, <void*>data, s)
         del d
     else:
         g = bliss_graph_from_labelled_edges(Vnr, Lnr, Vout, Vin, labels, partition)
-        g.find_automorphisms(s, add_gen, <void*>data)
+        bliss_find_automorphisms(g, add_gen, <void*>data, s)
         del g
 
     return [[cyc for cyc in gen if cyc[0] is not None] for gen in gens]
```



---

archive/issue_comments_658140.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[5fb71e5](https://git.sagemath.org/sage.git/commit/?id=5fb71e501c369e3c74a76184bdf020ced08a9fdc)|`Merge remote-tracking branch 'origin' into t/33010/update_bliss_to_0_77`|",
    "created_at": "2022-02-28T19:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[5fb71e5](https://git.sagemath.org/sage.git/commit/?id=5fb71e501c369e3c74a76184bdf020ced08a9fdc)|`Merge remote-tracking branch 'origin' into t/33010/update_bliss_to_0_77`|



---

archive/issue_comments_658141.json:
```json
{
    "body": "Changing commit from \"69d8da40e9190c583bc1b675ad8e44e32b874454\" to \"5fb71e501c369e3c74a76184bdf020ced08a9fdc\"",
    "created_at": "2022-02-28T19:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33010#issuecomment-658141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69d8da40e9190c583bc1b675ad8e44e32b874454" to "5fb71e501c369e3c74a76184bdf020ced08a9fdc"



---

archive/issue_events_087230.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33010#event-87230"
}
```



---

archive/issue_events_087231.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33010#event-87231"
}
```



---

archive/issue_events_087232.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33010#event-87232"
}
```



---

archive/issue_events_087233.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33010",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33010#event-87233"
}
```
