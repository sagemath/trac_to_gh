# Issue 33294: Ticket CI

archive/issues_033057.json:
```json
{
    "body": "The aim of this ticket is to:\n* add CI that runs on each ticket (using github actions)\n* use self-hosted runner that is fast enough to build all tickets from scratch\n* prevents tickets from being merged unless it succeeds\n* add status badge to trac\n\nThe code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.\n\nExample runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml\n\nBranch: u/vbraun/33294-ticket-ci\n\nStatus: new\n\nCommit: 50d9277979287273f0ee31ea5fa8e6770f754953\n\nIssue created by migration from https://trac.sagemath.org/ticket/33294\n\n",
    "created_at": "2022-02-05T14:46:40Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Ticket CI",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33294",
    "user": "https://github.com/vbraun"
}
```
The aim of this ticket is to:
* add CI that runs on each ticket (using github actions)
* use self-hosted runner that is fast enough to build all tickets from scratch
* prevents tickets from being merged unless it succeeds
* add status badge to trac

The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.

Example runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml

Branch: u/vbraun/33294-ticket-ci

Status: new

Commit: 50d9277979287273f0ee31ea5fa8e6770f754953

Issue created by migration from https://trac.sagemath.org/ticket/33294





---

archive/issue_comments_503267.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-02-05T14:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_503268.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,8 @@\n \n The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.\n \n+Example runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/33294\n``````\n",
    "created_at": "2022-02-05T14:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503268",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,8 @@
 
 The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.
 
+Example runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/33294
``````




---

archive/issue_comments_503269.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+The aim of this ticket is to:\n+* add CI that runs on each ticket (using github actions)\n+* use self-hosted runner that is fast enough to build all tickets from scratch\n+* prevents tickets from being merged unless it succeeds\n+* add status badge to trac\n \n+The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.\n+\n+Example runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-02-05T15:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503269",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+The aim of this ticket is to:
+* add CI that runs on each ticket (using github actions)
+* use self-hosted runner that is fast enough to build all tickets from scratch
+* prevents tickets from being merged unless it succeeds
+* add status badge to trac
 
+The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.
+
+Example runs: https://github.com/vbraun/sage/actions/workflows/ticket.yaml
 
 Comment: 1
 
``````




---

archive/issue_comments_503270.json:
```json
{
    "body": "<a id='comment:5'></a>Just as a heads-up: something similar is done in #33263 (already ready for merge)",
    "created_at": "2022-02-05T15:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503270",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>Just as a heads-up: something similar is done in #33263 (already ready for merge)



---

archive/issue_comments_503271.json:
```json
{
    "body": "<a id='comment:6'></a>+1 on providing fast self-hosted runners if you have them\n\n-1 on designing workflows that only can succeed on self-hosted runners\n\n(I haven't looked at the yml)",
    "created_at": "2022-02-05T18:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503271",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>+1 on providing fast self-hosted runners if you have them

-1 on designing workflows that only can succeed on self-hosted runners

(I haven't looked at the yml)



---

archive/issue_comments_503272.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-06T14:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503273.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-06T16:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503274.json:
```json
{
    "body": "<a id='comment:9'></a>Full (not incremental) build + html docs + long tests takes about 50 mins\n\nThere are necessarily going to be some differences with a self-hosted runner, like\n* No docker\n* Use local fs cache (ccache and /upstream)\nbut what can be shared should, of course.",
    "created_at": "2022-02-06T19:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503274",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>Full (not incremental) build + html docs + long tests takes about 50 mins

There are necessarily going to be some differences with a self-hosted runner, like
* No docker
* Use local fs cache (ccache and /upstream)
but what can be shared should, of course.



---

archive/issue_comments_503275.json:
```json
{
    "body": "<a id='comment:10'></a>I'd suggest to put the script that provisions the runner next to the yml script, to eliminate the guesswork what may be installed on the runner.",
    "created_at": "2022-02-06T19:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503275",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>I'd suggest to put the script that provisions the runner next to the yml script, to eliminate the guesswork what may be installed on the runner.



---

archive/issue_comments_503276.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-17T00:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503277.json:
```json
{
    "body": "Replying to [ticket:33294 vbraun]:\n> The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.\n\n\nhttps://github.com/sagemath/sagetrac-mirror already has all trac branches. Do you have a script already that would push branches that merge the trac branch into the current beta?\n(related - #33113#comment:18)",
    "created_at": "2022-02-17T20:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503277",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [ticket:33294 vbraun]:
> The code from trac ticket will be pushed by an external script to a branch ticket/12345, and this will trigger the CI run.


https://github.com/sagemath/sagetrac-mirror already has all trac branches. Do you have a script already that would push branches that merge the trac branch into the current beta?
(related - #33113#comment:18)



---

archive/issue_comments_503278.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-20T14:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503279.json:
```json
{
    "body": "<a id='comment:14'></a>I'm working on a script to push the merged tickets to branches named `ticket/12354`, currently on https://github.com/vbraun/sage until I have worked out the kinks",
    "created_at": "2022-02-20T14:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503279",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>I'm working on a script to push the merged tickets to branches named `ticket/12354`, currently on https://github.com/vbraun/sage until I have worked out the kinks



---

archive/issue_comments_503280.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-08T11:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503281.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-27T18:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_087889.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33294#event-87889"
}
```



---

archive/issue_comments_503282.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-30T20:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_503283.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-08T22:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33294#issuecomment-503283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_087890.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33294#event-87890"
}
```



---

archive/issue_events_087891.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33294",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33294#event-87891"
}
```
