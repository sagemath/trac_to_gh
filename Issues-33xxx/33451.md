# Issue 33451: Change "hasattr(x, '__call__')" to "callable(x)" etc

archive/issues_033214.json:
```json
{
    "body": "Make three changes:\n\n- `hasattr(x, '__call__')` -> `callable(x)`\n- `hasattr(x, '__iter__')` -> `instance(x, Iterable)`\n- `hasattr(x, '__getitem__')` -> `isinstance(x, (Sequence, Mapping))`\n\nwhere `Iterable`, `Mapping`, `Sequence` are imported from [collections.abc](https://docs.python.org/3/library/collections.abc.html). See \nthe more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.\n\nBranch/Commit: 12a48e62d548b1dc663b6fa87792160459af91a1\n\nReviewer: Matthias Koeppe\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33451\n\n",
    "closed_at": "2022-03-27T15:43:21Z",
    "created_at": "2022-03-02T18:57:11Z",
    "labels": [
        "component: python3",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Change \"hasattr(x, '__call__')\" to \"callable(x)\" etc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33451",
    "user": "https://github.com/jhpalmieri"
}
```
Make three changes:

- `hasattr(x, '__call__')` -> `callable(x)`
- `hasattr(x, '__iter__')` -> `instance(x, Iterable)`
- `hasattr(x, '__getitem__')` -> `isinstance(x, (Sequence, Mapping))`

where `Iterable`, `Mapping`, `Sequence` are imported from [collections.abc](https://docs.python.org/3/library/collections.abc.html). See 
the more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.

Branch/Commit: 12a48e62d548b1dc663b6fa87792160459af91a1

Reviewer: Matthias Koeppe

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33451





---

archive/issue_comments_666878.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jhpalmieri/no-hasattr-call\"",
    "created_at": "2022-03-02T18:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666878",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "" to "u/jhpalmieri/no-hasattr-call"



---

archive/issue_comments_666879.json:
```json
{
    "body": "Changing commit from \"\" to \"4b921977b7f0e61bee5454c7a34a168399edbda4\"",
    "created_at": "2022-03-02T18:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666879",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "4b921977b7f0e61bee5454c7a34a168399edbda4"



---

archive/issue_comments_666880.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2022-03-02T18:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666880",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_666881.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-02T18:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666881",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_666882.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n - `hasattr(x, '__call__')` -> `callable(x)`\n - `hasattr(x, '__iter__')` -> `instance(x, Iterable)`\n-- `hasattr(x, '__item__')` -> `isinstance(x, Mapping)`\n+- `hasattr(x, '__getitem__')` -> `isinstance(x, Mapping)`\n \n where `Iterable` and `Mapping` are imported from `collections.abc`. See \n the more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.\n``````\n",
    "created_at": "2022-03-02T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666882",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 - `hasattr(x, '__call__')` -> `callable(x)`
 - `hasattr(x, '__iter__')` -> `instance(x, Iterable)`
-- `hasattr(x, '__item__')` -> `isinstance(x, Mapping)`
+- `hasattr(x, '__getitem__')` -> `isinstance(x, Mapping)`
 
 where `Iterable` and `Mapping` are imported from `collections.abc`. See 
 the more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.
``````




---

archive/issue_comments_666883.json:
```json
{
    "body": "<a id='comment:4'></a>Not sure about this change; should it really iterate over the keys of a dictionary?\n\n```\n--- a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py\n+++ b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py\n@@ -60,6 +60,7 @@ Some more examples::\n #                  http://www.gnu.org/licenses/\n #***********************************************************************\n \n+from collections.abc import Iterable, Mapping\n from sage.structure.element import Element\n from sage.structure.richcmp import richcmp, op_NE\n from sage.symbolic.constants import I\n@@ -532,7 +533,8 @@ class HyperbolicPoint(Element):\n         else:  # It is an interior point\n             if p in RR:\n                 p = CC(p)\n-            elif hasattr(p, 'items') or hasattr(p, '__iter__'):\n+            elif isinstance(p, (Iterable, Mapping)):\n+                # p is iterable or a dict (or similar).\n                 p = [numerical_approx(k) for k in p]\n             else:\n                 p = numerical_approx(p)\n```",
    "created_at": "2022-03-02T20:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666883",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Not sure about this change; should it really iterate over the keys of a dictionary?

```
--- a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py
+++ b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py
@@ -60,6 +60,7 @@ Some more examples::
 #                  http://www.gnu.org/licenses/
 #***********************************************************************
 
+from collections.abc import Iterable, Mapping
 from sage.structure.element import Element
 from sage.structure.richcmp import richcmp, op_NE
 from sage.symbolic.constants import I
@@ -532,7 +533,8 @@ class HyperbolicPoint(Element):
         else:  # It is an interior point
             if p in RR:
                 p = CC(p)
-            elif hasattr(p, 'items') or hasattr(p, '__iter__'):
+            elif isinstance(p, (Iterable, Mapping)):
+                # p is iterable or a dict (or similar).
                 p = [numerical_approx(k) for k in p]
             else:
                 p = numerical_approx(p)
```



---

archive/issue_comments_666884.json:
```json
{
    "body": "<a id='comment:5'></a>Also `Mapping` is not the only ABC that provides `__getitem__`, also `Sequence` does https://docs.python.org/3/library/collections.abc.html",
    "created_at": "2022-03-02T20:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666884",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Also `Mapping` is not the only ABC that provides `__getitem__`, also `Sequence` does https://docs.python.org/3/library/collections.abc.html



---

archive/issue_comments_666885.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:\n> Not sure about this change; should it really iterate over the keys of a dictionary?\n\n\nThat's not a change, though.",
    "created_at": "2022-03-02T20:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666885",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:
> Not sure about this change; should it really iterate over the keys of a dictionary?


That's not a change, though.



---

archive/issue_comments_666886.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 mkoeppe]:\n> Also `Mapping` is not the only ABC that provides `__getitem__`, also `Sequence` does https://docs.python.org/3/library/collections.abc.html\n\n\nWe could try `isinstance(x, dict)` instead.",
    "created_at": "2022-03-02T20:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666886",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>Replying to [comment:5 mkoeppe]:
> Also `Mapping` is not the only ABC that provides `__getitem__`, also `Sequence` does https://docs.python.org/3/library/collections.abc.html


We could try `isinstance(x, dict)` instead.



---

archive/issue_comments_666887.json:
```json
{
    "body": "<a id='comment:8'></a>Is there a doctest that illustrates this use? It seems rather strange to me",
    "created_at": "2022-03-02T20:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666887",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Is there a doctest that illustrates this use? It seems rather strange to me



---

archive/issue_comments_666888.json:
```json
{
    "body": "<a id='comment:9'></a>I didn't mean to make the change\n\n```\n-                    elif hasattr(other._deepcopy_labels_, '__getitem__'):\n+                    elif isinstance(other._deepcopy_labels_, Mapping):\n```\nin `finite_state_machine.py`. I'll undo that one.",
    "created_at": "2022-03-02T20:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666888",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>I didn't mean to make the change

```
-                    elif hasattr(other._deepcopy_labels_, '__getitem__'):
+                    elif isinstance(other._deepcopy_labels_, Mapping):
```
in `finite_state_machine.py`. I'll undo that one.



---

archive/issue_comments_666889.json:
```json
{
    "body": "Changing commit from \"4b921977b7f0e61bee5454c7a34a168399edbda4\" to \"69173e91e2603c4401374b987bb3c312cd8d171a\"",
    "created_at": "2022-03-02T20:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4b921977b7f0e61bee5454c7a34a168399edbda4" to "69173e91e2603c4401374b987bb3c312cd8d171a"



---

archive/issue_comments_666890.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-02T20:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_666891.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:8 mkoeppe]:\n> Is there a doctest that illustrates this use? It seems rather strange to me\n\n\nIt doesn't look like it, since that method doesn't work for a tuple, let alone a dict:\n\n```\nsage: p1 = UHP.get_point(.2 + .3*I)\nsage: p1.coordinates()\n0.200000000000000 + 0.300000000000000*I\nsage: p1.show()\nLaunched png viewer for Graphics object consisting of 2 graphics primitives\nsage: p2 = UHP.get_point((.2, .3))\nsage: p2.coordinates()\n(0.200000000000000, 0.300000000000000)\nsage: p2.show()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unsupported operand parent(s) for +: 'Vector space of dimension 2 over Real Field with 53 bits of precision' and 'Symbolic Ring'\n```",
    "created_at": "2022-03-02T20:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666891",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>Replying to [comment:8 mkoeppe]:
> Is there a doctest that illustrates this use? It seems rather strange to me


It doesn't look like it, since that method doesn't work for a tuple, let alone a dict:

```
sage: p1 = UHP.get_point(.2 + .3*I)
sage: p1.coordinates()
0.200000000000000 + 0.300000000000000*I
sage: p1.show()
Launched png viewer for Graphics object consisting of 2 graphics primitives
sage: p2 = UHP.get_point((.2, .3))
sage: p2.coordinates()
(0.200000000000000, 0.300000000000000)
sage: p2.show()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unsupported operand parent(s) for +: 'Vector space of dimension 2 over Real Field with 53 bits of precision' and 'Symbolic Ring'
```



---

archive/issue_comments_666892.json:
```json
{
    "body": "<a id='comment:12'></a>I guess that's not relevant. A modification of an existing doctest\n\n```\nsage: HyperbolicPlane().KM().get_point((0,0)).show()\n```\nnamely replacing `(0,0)` by `[0,0]`, would use that code. I am not particularly happy with the following but I don't want to put a lot of work into this particular module:\n\n```python\nsage: p1 = HyperbolicPlane().KM().get_point((0,1/2))\nsage: p2 = HyperbolicPlane().KM().get_point([0,1/2])\nsage: p1 == p2\nFalse\nsage: p1\nPoint in KM (0, 1/2)\nsage: p2\nPoint in KM [0, 1/2]\nsage: p1.coordinates()\n(0, 1/2)\nsage: type(p1.coordinates())\n<class 'sage.modules.vector_rational_dense.Vector_rational_dense'>\nsage: p2.coordinates()\n[0, 1/2]\nsage: type(p2.coordinates())\n<class 'list'>\n```\nIt would be better if the input were normalized: any iterable converted to a vector. Maybe this would help:\n\n```diff\ndiff --git a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py\nindex 5ad5b5342c..c386f0057b 100644\n--- a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py\n+++ b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py\n@@ -193,6 +193,10 @@ class HyperbolicPoint(Element):\n \n             sage: p = HyperbolicPlane().UHP().get_point(I)\n             sage: TestSuite(p).run()\n+            sage: p1 = HyperbolicPlane().KM().get_point((0,0))\n+            sage: p2 = HyperbolicPlane().KM().get_point([0,0])\n+            sage: p1 == p2\n+            True\n         \"\"\"\n         if is_boundary:\n             if not model.is_bounded():\n@@ -206,7 +210,7 @@ class HyperbolicPoint(Element):\n                 \"{0} is not a valid\".format(coordinates) +\n                 \" point in the {0} model\".format(model.short_name()))\n \n-        if isinstance(coordinates, tuple):\n+        if isinstance(coordinates, Iterable):\n             coordinates = vector(coordinates)\n         self._coordinates = coordinates\n         self._bdry = is_boundary\n```\nThen I would be tempted to delete the `elif isinstance(p, (Iterable, Mapping))` block.",
    "created_at": "2022-03-02T22:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666892",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>I guess that's not relevant. A modification of an existing doctest

```
sage: HyperbolicPlane().KM().get_point((0,0)).show()
```
namely replacing `(0,0)` by `[0,0]`, would use that code. I am not particularly happy with the following but I don't want to put a lot of work into this particular module:

```python
sage: p1 = HyperbolicPlane().KM().get_point((0,1/2))
sage: p2 = HyperbolicPlane().KM().get_point([0,1/2])
sage: p1 == p2
False
sage: p1
Point in KM (0, 1/2)
sage: p2
Point in KM [0, 1/2]
sage: p1.coordinates()
(0, 1/2)
sage: type(p1.coordinates())
<class 'sage.modules.vector_rational_dense.Vector_rational_dense'>
sage: p2.coordinates()
[0, 1/2]
sage: type(p2.coordinates())
<class 'list'>
```
It would be better if the input were normalized: any iterable converted to a vector. Maybe this would help:

```diff
diff --git a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py
index 5ad5b5342c..c386f0057b 100644
--- a/src/sage/geometry/hyperbolic_space/hyperbolic_point.py
+++ b/src/sage/geometry/hyperbolic_space/hyperbolic_point.py
@@ -193,6 +193,10 @@ class HyperbolicPoint(Element):
 
             sage: p = HyperbolicPlane().UHP().get_point(I)
             sage: TestSuite(p).run()
+            sage: p1 = HyperbolicPlane().KM().get_point((0,0))
+            sage: p2 = HyperbolicPlane().KM().get_point([0,0])
+            sage: p1 == p2
+            True
         """
         if is_boundary:
             if not model.is_bounded():
@@ -206,7 +210,7 @@ class HyperbolicPoint(Element):
                 "{0} is not a valid".format(coordinates) +
                 " point in the {0} model".format(model.short_name()))
 
-        if isinstance(coordinates, tuple):
+        if isinstance(coordinates, Iterable):
             coordinates = vector(coordinates)
         self._coordinates = coordinates
         self._bdry = is_boundary
```
Then I would be tempted to delete the `elif isinstance(p, (Iterable, Mapping))` block.



---

archive/issue_comments_666893.json:
```json
{
    "body": "Changing commit from \"69173e91e2603c4401374b987bb3c312cd8d171a\" to \"c731d4edd99bbed8061ad892caba3d3969152960\"",
    "created_at": "2022-03-02T23:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69173e91e2603c4401374b987bb3c312cd8d171a" to "c731d4edd99bbed8061ad892caba3d3969152960"



---

archive/issue_comments_666894.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-02T23:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_666895.json:
```json
{
    "body": "<a id='comment:14'></a>Yes, I think this is a good change",
    "created_at": "2022-03-03T00:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666895",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Yes, I think this is a good change



---

archive/issue_comments_666896.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n - `hasattr(x, '__call__')` -> `callable(x)`\n - `hasattr(x, '__iter__')` -> `instance(x, Iterable)`\n-- `hasattr(x, '__getitem__')` -> `isinstance(x, Mapping)`\n+- `hasattr(x, '__getitem__')` -> `isinstance(x, (Sequence, Mapping))`\n \n-where `Iterable` and `Mapping` are imported from `collections.abc`. See \n+where `Iterable`, `Mapping`, `Sequence` are imported from [collections.abc](https://docs.python.org/3/library/collections.abc.html). See \n the more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.\n``````\n",
    "created_at": "2022-03-03T01:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666896",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 - `hasattr(x, '__call__')` -> `callable(x)`
 - `hasattr(x, '__iter__')` -> `instance(x, Iterable)`
-- `hasattr(x, '__getitem__')` -> `isinstance(x, Mapping)`
+- `hasattr(x, '__getitem__')` -> `isinstance(x, (Sequence, Mapping))`
 
-where `Iterable` and `Mapping` are imported from `collections.abc`. See 
+where `Iterable`, `Mapping`, `Sequence` are imported from [collections.abc](https://docs.python.org/3/library/collections.abc.html). See 
 the more recent (Python 3 specific) answers at https://stackoverflow.com/questions/1952464/in-python-how-do-i-determine-if-an-object-is-iterable and https://stackoverflow.com/questions/25231989/how-to-check-if-a-variable-is-a-dictionary-in-python.
``````




---

archive/issue_comments_666897.json:
```json
{
    "body": "<a id='comment:16'></a>Note that my changes replace `hasattr(x, 'items')`, not `hasattr(x, '__getitem__')`. We can do the second one, but that wasn't part of the original plan. I did the first replacement because of the comment \"# data is a dict (or something similar)\" after one of those tests, so it was clear why they were testing `hasattr(x, 'items')`.",
    "created_at": "2022-03-03T03:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666897",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>Note that my changes replace `hasattr(x, 'items')`, not `hasattr(x, '__getitem__')`. We can do the second one, but that wasn't part of the original plan. I did the first replacement because of the comment "# data is a dict (or something similar)" after one of those tests, so it was clear why they were testing `hasattr(x, 'items')`.



---

archive/issue_comments_666898.json:
```json
{
    "body": "<a id='comment:17'></a>Ah, now I get what `items` was supposed to do. Thanks",
    "created_at": "2022-03-03T04:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Ah, now I get what `items` was supposed to do. Thanks



---

archive/issue_comments_666899.json:
```json
{
    "body": "<a id='comment:18'></a>There are also a small number of `hasattr(..., '__len__')` in the library",
    "created_at": "2022-03-03T05:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>There are also a small number of `hasattr(..., '__len__')` in the library



---

archive/issue_comments_666900.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-03T05:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666900",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_666901.json:
```json
{
    "body": "<a id='comment:19'></a>But all of this can be taken care of in a follow-up ticket. \n\nThe present branch looks good and passes tests.",
    "created_at": "2022-03-03T05:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666901",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>But all of this can be taken care of in a follow-up ticket. 

The present branch looks good and passes tests.



---

archive/issue_comments_666902.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-03-03T05:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666902",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_666903.json:
```json
{
    "body": "<a id='comment:20'></a>Thanks!\n\nBy the way, among other things I see:\n\n- `hasattr(..., '__len__')`\n- `hasattr(..., '__getitem__')`\n- `hasattr(..., '__dict__')`\n- `hasattr(..., '__contains__')`\n- `hasattr(..., '__classcall__')`\n\nI'm not sure what these are trying to accomplish. Maybe we should document some of this in the developer's guide: \"A good way to test [or The preferred way to test\"] if an object is a dictionary/iterable/whatever is ...\".",
    "created_at": "2022-03-03T05:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666903",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>Thanks!

By the way, among other things I see:

- `hasattr(..., '__len__')`
- `hasattr(..., '__getitem__')`
- `hasattr(..., '__dict__')`
- `hasattr(..., '__contains__')`
- `hasattr(..., '__classcall__')`

I'm not sure what these are trying to accomplish. Maybe we should document some of this in the developer's guide: "A good way to test [or The preferred way to test"] if an object is a dictionary/iterable/whatever is ...".



---

archive/issue_comments_666904.json:
```json
{
    "body": "<a id='comment:21'></a>Merge failure on top of:\n\n70aa673e95 Trac #33447: Doctest failure on ubuntu-jammy because system Singular is accepted\n\n503795926f Trac #33452: adjust error messages in topology/\n\n599d44584f Trac #33449: Move plotting and affine hull to Polyhedron_base6\n\n719453b6a6 Trac #33443: slow doctest improvements (isogeny_small_degree, function_field, doctest/test.py)\n\n5d33ab9323 Trac #33442: Remove package ratpoints deprecated 4 years ago\n\n9550637260 Trac #33435: Move complex number powering test to correct location\n\n397ca79b4b Trac #33355: Generate coverage results and upload to codecov\n\na8777acf47 Trac #33223: make PARI the default for EllipticCurve_field.weierstrass_p()\n\nc7adc6cc57 Trac #33112: some speedups in AdditiveAbelianGroupWrapper.discrete_log()\n\n8230df5b38 Trac #32770: Expose and access `tachyon` command line flags\n\n135c8e5bb1 Trac #31426: Apply flat shading when plotting 3d polyhedra with Three.js\n\n32e26f275f Trac #24536: find_local_maximum/minimum() fails with expressions containing complex numbers\n\nc0b15ffde0 Trac #33450: Improve vs code config\n\na76af34b81 Trac #33312: WeierstrassIsomorphism.degree() returns a Python int\n\n8368718592 Trac #33094: update URLs in SPKG.rst for ECL\n\n4f76f139db Trac #32922: Change parameter name\n\n44b5d43de7 Trac #32384: make some AdditiveAbelianGroupWrapper methods visible\n\n232f88fe88 Trac #32251: Fix doctest in the \"Y pentamino\" example from Donald Knuth\n\n6adf64eec4 Trac #30999: expose method hyperbolicity in graphs\n\n14e3e755d2 Trac #25787: Remove documentation configuration from micro_release\n\n87d5c62133 Trac #33414: Remove sage-open\n\nc254f33235 Trac #33413: Remove sage-native-execute\n\n6dcb3dc676 Trac #33412: Remove sage-update-src\n\naeb3fb2594 Trac #33411: include time for checking doctest output in '--warn-long'\n\nb20aeb7ee9 Trac #33322: Several ImageMagick tests need \"long time\"\n\ndb459d4eb3 Trac #33318: speed up is_prime() for very small integers\n\n0df0bad12f Trac #33308: Remove expired deprecations that use lazy_import(MODULE, \"*\")\n\n7c9535ef80 Trac #33292: mark invlex ordering as global\n\ne6d8672713 Trac #33286: Put topology in the reference manual\n\n6e45b9e469 Trac #33270: Difference between a formula and an image in Contour Plots\n\n895ded3c44 Trac #33224: PARI-backed LaurentSeries truncates exact polynomials to default precision\n\needa513423 Trac #33434: Fix pyflake in sage.graphs.graph\n\nf45550a9d3 Trac #33424: pep8 for function field maps\n\n9553cc37d8 Trac #33319: polynomial rings should not attempt to use Singular in characteristic >= 2^31\n\n13d038fd9f Trac #33147: use PARI's ellmul() for elliptic curves over finite fields\n\n0c85ad2f59 Trac #33433: Correct order of parameters in min_spanning_tree\n\n8e935af159 Trac #33421: Add elliptic_curves dependency to sagemath_doc_html\n\n111bcfa1f7 Trac #33216: reduce precision for .formal() in EllipticCurveIsogeny.dual()\n\n195cf6ab4d Trac #33215: WeierstrassIsomorphism should coerce its inputs to a common parent\n\ndf9c2612a6 Trac #33210: Fix Cython warnings in sage.rings.polynomial.polynomial_modn_dense_ntl\n\nac61ea8b62 Trac #33208: Remove unused code from sage/rings/padics/pow_computer_ext.pyx\n\nbc069a7cb2 Trac #33193: Fix Cython incompatible redefinition warnings in padics\n\n8a21049265 Trac #33186: Fix \"referenced before assignment\" warnings in padics\n\n490fdfded3 Trac #33055: conda-forge: Fix build of python3 spkg\n\nbeedaabc7e Trac #32997: docker image fails to build on tigerlake\n\n28f2f9a48b Trac #32786: opportunistic caching of elliptic-curve and point orders\n\n1ac2b995a4 Trac #12419: factorization of 0 in GF(p)[x,y] fails\n\n9349a36d34 Trac #33429: some cleanup in toric schemes\n\ndf9d1d77aa Trac #33427: numerical noise in effective_resistance involving RDF\n\nc6f2af1800 Trac #33425: adjust error messages in combinat/words\n\n449c7f1d66 Trac #33423: Cancel the linter\n\nb30c72fe86 Trac #33420: fix E111 (indentation) in quadratic_forms\n\ncc8a39082b Trac #33419: fix E111 (indentation) in manifolds, stats, finance\n\n6410a7cd86 Trac #33415: fix the linter\n\nec318c0d08 Trac #33410: Polyhedron_base.volume(engine='lrs', measure='induced')\n\nb6fecc7464 Trac #33399: Bug in ExpressionNice with composite variables\n\n6779f414bf Trac #33363: (Too) long doctest in sage/matrix/matrix_integer_dense.pyx\n\n9e90afaba0 Trac #29215: valuation error\n\n2a16069f4c Trac #29114: Only ./bootstrap should glob build/pkgs\n\n062a90c9d1 Trac #33403: Polyhedron._test_product, _test_dilation: Skip tests if test prereqs cannot be imported\n\ncc4ffb3fa1 Trac #33402: sage.geometry.polyhedron: More # optional\n\n9333fa5dc3 Trac #33395: document using Wolfram Engine (a.k.a. wolframscript) with Sage\n\nf346730807 Trac #33394: correct docs for running notebook on a specific port\n\n1e8ba0aac4 Updated [SageMath](SageMath) version to 9.6.beta3\n\n\n\nmerge was not clean: conflicts in src/sage/plot/misc.py",
    "created_at": "2022-03-03T23:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666904",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Merge failure on top of:

70aa673e95 Trac #33447: Doctest failure on ubuntu-jammy because system Singular is accepted

503795926f Trac #33452: adjust error messages in topology/

599d44584f Trac #33449: Move plotting and affine hull to Polyhedron_base6

719453b6a6 Trac #33443: slow doctest improvements (isogeny_small_degree, function_field, doctest/test.py)

5d33ab9323 Trac #33442: Remove package ratpoints deprecated 4 years ago

9550637260 Trac #33435: Move complex number powering test to correct location

397ca79b4b Trac #33355: Generate coverage results and upload to codecov

a8777acf47 Trac #33223: make PARI the default for EllipticCurve_field.weierstrass_p()

c7adc6cc57 Trac #33112: some speedups in AdditiveAbelianGroupWrapper.discrete_log()

8230df5b38 Trac #32770: Expose and access `tachyon` command line flags

135c8e5bb1 Trac #31426: Apply flat shading when plotting 3d polyhedra with Three.js

32e26f275f Trac #24536: find_local_maximum/minimum() fails with expressions containing complex numbers

c0b15ffde0 Trac #33450: Improve vs code config

a76af34b81 Trac #33312: WeierstrassIsomorphism.degree() returns a Python int

8368718592 Trac #33094: update URLs in SPKG.rst for ECL

4f76f139db Trac #32922: Change parameter name

44b5d43de7 Trac #32384: make some AdditiveAbelianGroupWrapper methods visible

232f88fe88 Trac #32251: Fix doctest in the "Y pentamino" example from Donald Knuth

6adf64eec4 Trac #30999: expose method hyperbolicity in graphs

14e3e755d2 Trac #25787: Remove documentation configuration from micro_release

87d5c62133 Trac #33414: Remove sage-open

c254f33235 Trac #33413: Remove sage-native-execute

6dcb3dc676 Trac #33412: Remove sage-update-src

aeb3fb2594 Trac #33411: include time for checking doctest output in '--warn-long'

b20aeb7ee9 Trac #33322: Several ImageMagick tests need "long time"

db459d4eb3 Trac #33318: speed up is_prime() for very small integers

0df0bad12f Trac #33308: Remove expired deprecations that use lazy_import(MODULE, "*")

7c9535ef80 Trac #33292: mark invlex ordering as global

e6d8672713 Trac #33286: Put topology in the reference manual

6e45b9e469 Trac #33270: Difference between a formula and an image in Contour Plots

895ded3c44 Trac #33224: PARI-backed LaurentSeries truncates exact polynomials to default precision

eeda513423 Trac #33434: Fix pyflake in sage.graphs.graph

f45550a9d3 Trac #33424: pep8 for function field maps

9553cc37d8 Trac #33319: polynomial rings should not attempt to use Singular in characteristic >= 2^31

13d038fd9f Trac #33147: use PARI's ellmul() for elliptic curves over finite fields

0c85ad2f59 Trac #33433: Correct order of parameters in min_spanning_tree

8e935af159 Trac #33421: Add elliptic_curves dependency to sagemath_doc_html

111bcfa1f7 Trac #33216: reduce precision for .formal() in EllipticCurveIsogeny.dual()

195cf6ab4d Trac #33215: WeierstrassIsomorphism should coerce its inputs to a common parent

df9c2612a6 Trac #33210: Fix Cython warnings in sage.rings.polynomial.polynomial_modn_dense_ntl

ac61ea8b62 Trac #33208: Remove unused code from sage/rings/padics/pow_computer_ext.pyx

bc069a7cb2 Trac #33193: Fix Cython incompatible redefinition warnings in padics

8a21049265 Trac #33186: Fix "referenced before assignment" warnings in padics

490fdfded3 Trac #33055: conda-forge: Fix build of python3 spkg

beedaabc7e Trac #32997: docker image fails to build on tigerlake

28f2f9a48b Trac #32786: opportunistic caching of elliptic-curve and point orders

1ac2b995a4 Trac #12419: factorization of 0 in GF(p)[x,y] fails

9349a36d34 Trac #33429: some cleanup in toric schemes

df9d1d77aa Trac #33427: numerical noise in effective_resistance involving RDF

c6f2af1800 Trac #33425: adjust error messages in combinat/words

449c7f1d66 Trac #33423: Cancel the linter

b30c72fe86 Trac #33420: fix E111 (indentation) in quadratic_forms

cc8a39082b Trac #33419: fix E111 (indentation) in manifolds, stats, finance

6410a7cd86 Trac #33415: fix the linter

ec318c0d08 Trac #33410: Polyhedron_base.volume(engine='lrs', measure='induced')

b6fecc7464 Trac #33399: Bug in ExpressionNice with composite variables

6779f414bf Trac #33363: (Too) long doctest in sage/matrix/matrix_integer_dense.pyx

9e90afaba0 Trac #29215: valuation error

2a16069f4c Trac #29114: Only ./bootstrap should glob build/pkgs

062a90c9d1 Trac #33403: Polyhedron._test_product, _test_dilation: Skip tests if test prereqs cannot be imported

cc4ffb3fa1 Trac #33402: sage.geometry.polyhedron: More # optional

9333fa5dc3 Trac #33395: document using Wolfram Engine (a.k.a. wolframscript) with Sage

f346730807 Trac #33394: correct docs for running notebook on a specific port

1e8ba0aac4 Updated [SageMath](SageMath) version to 9.6.beta3



merge was not clean: conflicts in src/sage/plot/misc.py



---

archive/issue_comments_666905.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-03-03T23:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666905",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_666906.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-03-17T16:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666906",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_666907.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/no-hasattr-call\" to \"public/ticket/33451\"",
    "created_at": "2022-03-17T16:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666907",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/jhpalmieri/no-hasattr-call" to "public/ticket/33451"



---

archive/issue_comments_666908.json:
```json
{
    "body": "<a id='comment:22'></a>after trivial rebase, setting back to positive\n\n---\nNew commits:",
    "created_at": "2022-03-17T16:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666908",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>after trivial rebase, setting back to positive

---
New commits:



---

archive/issue_comments_666909.json:
```json
{
    "body": "Changing commit from \"c731d4edd99bbed8061ad892caba3d3969152960\" to \"12a48e62d548b1dc663b6fa87792160459af91a1\"",
    "created_at": "2022-03-17T16:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666909",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "c731d4edd99bbed8061ad892caba3d3969152960" to "12a48e62d548b1dc663b6fa87792160459af91a1"



---

archive/issue_comments_666910.json:
```json
{
    "body": "<a id='comment:23'></a>Thank you for taking care of that. I didn't get the email notification about the merge failure so I didn't even know there was a problem.",
    "created_at": "2022-03-17T17:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666910",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>Thank you for taking care of that. I didn't get the email notification about the merge failure so I didn't even know there was a problem.



---

archive/issue_comments_666911.json:
```json
{
    "body": "Changing branch from \"public/ticket/33451\" to \"12a48e62d548b1dc663b6fa87792160459af91a1\"",
    "created_at": "2022-03-27T15:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666911",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/33451" to "12a48e62d548b1dc663b6fa87792160459af91a1"



---

archive/issue_events_088167.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-27T15:43:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33451#event-88167"
}
```



---

archive/issue_comments_666912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33451#issuecomment-666912",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
