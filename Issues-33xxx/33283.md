# Issue 33283: Improve sign consistency in rational polynomial factorization

archive/issues_033046.json:
```json
{
    "body": "The placement of the minus sign when factoring multivariate polynomials over `QQ` lost consistency at some point between Sage 9.2 and 9.4.\n\nDefine a multivariate polynomial ring:\n\n```\nsage: R.<ax,bx,ay,by,Az,Bz,Ai,Bi> = PolynomialRing(QQ, 8, order='invlex')\nsage: R\nMultivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Rational Field\n```\n\nThen, in Sage 9.2:\n\n```\nsage: R((-2 * (bx - ax)) ^ 1).factor()\n(2) * (-bx + ax)\nsage: R((-2 * (bx - ax)) ^ 2).factor()\n(4) * (-bx + ax)^2\nsage: R((-2 * (bx - ax)) ^ 3).factor()\n(8) * (-bx + ax)^3\n```\nwhile in Sage 9.4 or Sage 9.5:\n\n```\nsage: R((-2 * (bx - ax)) ^ 1).factor()\n(-2) * (bx - ax)\nsage: R((-2 * (bx - ax)) ^ 2).factor()\n(4) * (-bx + ax)^2\nsage: R((-2 * (bx - ax)) ^ 3).factor()\n(8) * (-bx + ax)^3\n```\n\nThis broke our code in\n\n- https://github.com/bitcoin-core/secp256k1/pull/1068#discussion_r796515727\n\nIt would be good to output a canonical form. A natural choice seems to make the leading coefficient of each factor positive. \n\nIt may then also be good to document that the factors will be primitive.\n\nThe `invlex` monomial ordering is not the culprit: the inconsistency also occurs with `lex` (see one comment down at the GitHub link).\n\nIssue created by migration from https://trac.sagemath.org/ticket/33283\n\n",
    "created_at": "2022-02-03T13:46:11Z",
    "labels": [
        "component: factorization",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Improve sign consistency in rational polynomial factorization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33283",
    "user": "https://github.com/real-or-random"
}
```
The placement of the minus sign when factoring multivariate polynomials over `QQ` lost consistency at some point between Sage 9.2 and 9.4.

Define a multivariate polynomial ring:

```
sage: R.<ax,bx,ay,by,Az,Bz,Ai,Bi> = PolynomialRing(QQ, 8, order='invlex')
sage: R
Multivariate Polynomial Ring in ax, bx, ay, by, Az, Bz, Ai, Bi over Rational Field
```

Then, in Sage 9.2:

```
sage: R((-2 * (bx - ax)) ^ 1).factor()
(2) * (-bx + ax)
sage: R((-2 * (bx - ax)) ^ 2).factor()
(4) * (-bx + ax)^2
sage: R((-2 * (bx - ax)) ^ 3).factor()
(8) * (-bx + ax)^3
```
while in Sage 9.4 or Sage 9.5:

```
sage: R((-2 * (bx - ax)) ^ 1).factor()
(-2) * (bx - ax)
sage: R((-2 * (bx - ax)) ^ 2).factor()
(4) * (-bx + ax)^2
sage: R((-2 * (bx - ax)) ^ 3).factor()
(8) * (-bx + ax)^3
```

This broke our code in

- https://github.com/bitcoin-core/secp256k1/pull/1068#discussion_r796515727

It would be good to output a canonical form. A natural choice seems to make the leading coefficient of each factor positive. 

It may then also be good to document that the factors will be primitive.

The `invlex` monomial ordering is not the culprit: the inconsistency also occurs with `lex` (see one comment down at the GitHub link).

Issue created by migration from https://trac.sagemath.org/ticket/33283





---

archive/issue_events_087869.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33283",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33283#event-87869"
}
```



---

archive/issue_events_087870.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33283",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33283#event-87870"
}
```



---

archive/issue_events_087871.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33283",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33283#event-87871"
}
```
