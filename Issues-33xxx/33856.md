# Issue 33856: Fix a few issues occuring when doctesting with pytest

archive/issues_033619.json:
```json
{
    "body": "Namely\n\n```\nE   ValueError: line 18 of the docstring for sage.databases.findstat._submit has inconsistent leading whitespace: '[1,2,3]=>83\",'\nE   ValueError: line 42 of the docstring for sage.databases.sql_db._create_print_table has inconsistent leading whitespace: '--------------------'\nE   ValueError: line 8 of the docstring for sage.doctest.control.Logger.__init__ has inconsistent leading whitespace: '\")  # no-op'\nE   ValueError: line 12 of the docstring for sage.doctest.sources.StringDocTestSource.__iter__ has inconsistent leading whitespace: '\\'\\'\\'\"'\nE   ValueError: line 29 of the docstring for sage.game_theory.normal_form_game.NormalFormGame._lrs_nash_format has inconsistent leading whitespace: \"', legacy_format[0])\"\nE   ValueError: line 36 of the docstring for sage.repl.rich_output.backend_emacs.BackendEmacs.displayhook has inconsistent leading whitespace: \"BEGIN_LATEX:\\\\newcommand{\\\\Bold}[1]{\\\\mathbf{#1}}\\\\int \\\\sin\\\\left(x\\\\right)\\\\,{d x}:END_LATEX'},\"\nE   ValueError: line 17 of the docstring for sage.parallel.decorate.ParallelFunction._instancedoc_ has inconsistent leading whitespace: \"'\"\nE   ValueError: line 13 of the docstring for sage.databases.findstat.FindStatStatistic._fetch_data has inconsistent leading whitespace: \"    return len(x.nestings())',\"\n```\n-> convert to `r\"\"\"...\"\"\"` strings\n\n```\n___________ ERROR collecting sage/ext_data/nbconvert/postprocess.py ____________\nsage/ext_data/nbconvert/postprocess.py:20: in <module>\n    with open(file_name, 'r') as f:\nE   FileNotFoundError: [Errno 2] No such file or directory: '-c'\n\nsage/repl/ipython_kernel/__main__.py:3: in <module>\n...\n__main__.py: error: unrecognized arguments: --doctest-modules\n\nsage_setup/autogen/giacpy-mkkeywords.py:49: in <module>\n    with open('aide_cas.txt') as f:\nE   FileNotFoundError: [Errno 2] No such file or directory: 'aide_cas.txt'\n\n\n __________________________ ERROR collecting setup.py ___________________________\n E   getopt.GetoptError: option -c not recognized\n\n_________________________ ERROR collecting sage/all.py _________________________\nsage/all.py:285: in <module>\n    sage.misc.lazy_import.finish_startup()\nsage/misc/lazy_import.pyx:87: in sage.misc.lazy_import.finish_startup\n    cpdef finish_startup():\nsage/misc/lazy_import.pyx:103: in sage.misc.lazy_import.finish_startup\n    assert startup_guard, 'finish_startup() must be called exactly once'\nE   AssertionError: finish_startup() must be called exactly once\n```\n-> ignore from test collection\n\n```\n________ ERROR collecting sage/geometry/polyhedron/backend_normaliz.py _________\nsage/misc/lazy_import.pyx:253: in sage.misc.lazy_import.LazyImport._get_object\n    self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)\nE   ModuleNotFoundError: No module named 'PyNormaliz'\n```\n-> skip if feature is not installed\n\n```\nsage/homology/cubical_complex.py:16: in <module>\n    cubical_complexes = deprecated_function_alias(31925,\nsage/misc/superseded.py:558: in deprecated_function_alias\n    return DeprecatedFunctionAlias(trac_number, func, module_name)\nsage/misc/superseded.py:379: in __init__\n    doc += 'Use :' + sphinxrole + ':`' + self.func.__name__ + '` instead.\\n'\nE   AttributeError: 'CubicalComplexExamples' object has no attribute '__name__'\n```\n-> add proper handling of classes \n\nCC:  @mkoeppe @fchapoton @jhpalmieri diampase\n\nAuthor: Tobias Diez\n\nBranch: public/build/pytest_doctests_fixes\n\nStatus: new\n\nDependencies: #33546, #33879\n\nCommit: fba348869b49151dfad0c292a82f6bf74dbb44fd\n\nIssue created by migration from https://trac.sagemath.org/ticket/33856\n\n",
    "created_at": "2022-05-16T18:49:05Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Fix a few issues occuring when doctesting with pytest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33856",
    "user": "https://github.com/tobiasdiez"
}
```
Namely

```
E   ValueError: line 18 of the docstring for sage.databases.findstat._submit has inconsistent leading whitespace: '[1,2,3]=>83",'
E   ValueError: line 42 of the docstring for sage.databases.sql_db._create_print_table has inconsistent leading whitespace: '--------------------'
E   ValueError: line 8 of the docstring for sage.doctest.control.Logger.__init__ has inconsistent leading whitespace: '")  # no-op'
E   ValueError: line 12 of the docstring for sage.doctest.sources.StringDocTestSource.__iter__ has inconsistent leading whitespace: '\'\'\'"'
E   ValueError: line 29 of the docstring for sage.game_theory.normal_form_game.NormalFormGame._lrs_nash_format has inconsistent leading whitespace: "', legacy_format[0])"
E   ValueError: line 36 of the docstring for sage.repl.rich_output.backend_emacs.BackendEmacs.displayhook has inconsistent leading whitespace: "BEGIN_LATEX:\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\int \\sin\\left(x\\right)\\,{d x}:END_LATEX'},"
E   ValueError: line 17 of the docstring for sage.parallel.decorate.ParallelFunction._instancedoc_ has inconsistent leading whitespace: "'"
E   ValueError: line 13 of the docstring for sage.databases.findstat.FindStatStatistic._fetch_data has inconsistent leading whitespace: "    return len(x.nestings())',"
```
-> convert to `r"""..."""` strings

```
___________ ERROR collecting sage/ext_data/nbconvert/postprocess.py ____________
sage/ext_data/nbconvert/postprocess.py:20: in <module>
    with open(file_name, 'r') as f:
E   FileNotFoundError: [Errno 2] No such file or directory: '-c'

sage/repl/ipython_kernel/__main__.py:3: in <module>
...
__main__.py: error: unrecognized arguments: --doctest-modules

sage_setup/autogen/giacpy-mkkeywords.py:49: in <module>
    with open('aide_cas.txt') as f:
E   FileNotFoundError: [Errno 2] No such file or directory: 'aide_cas.txt'


 __________________________ ERROR collecting setup.py ___________________________
 E   getopt.GetoptError: option -c not recognized

_________________________ ERROR collecting sage/all.py _________________________
sage/all.py:285: in <module>
    sage.misc.lazy_import.finish_startup()
sage/misc/lazy_import.pyx:87: in sage.misc.lazy_import.finish_startup
    cpdef finish_startup():
sage/misc/lazy_import.pyx:103: in sage.misc.lazy_import.finish_startup
    assert startup_guard, 'finish_startup() must be called exactly once'
E   AssertionError: finish_startup() must be called exactly once
```
-> ignore from test collection

```
________ ERROR collecting sage/geometry/polyhedron/backend_normaliz.py _________
sage/misc/lazy_import.pyx:253: in sage.misc.lazy_import.LazyImport._get_object
    self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
E   ModuleNotFoundError: No module named 'PyNormaliz'
```
-> skip if feature is not installed

```
sage/homology/cubical_complex.py:16: in <module>
    cubical_complexes = deprecated_function_alias(31925,
sage/misc/superseded.py:558: in deprecated_function_alias
    return DeprecatedFunctionAlias(trac_number, func, module_name)
sage/misc/superseded.py:379: in __init__
    doc += 'Use :' + sphinxrole + ':`' + self.func.__name__ + '` instead.\n'
E   AttributeError: 'CubicalComplexExamples' object has no attribute '__name__'
```
-> add proper handling of classes 

CC:  @mkoeppe @fchapoton @jhpalmieri diampase

Author: Tobias Diez

Branch: public/build/pytest_doctests_fixes

Status: new

Dependencies: #33546, #33879

Commit: fba348869b49151dfad0c292a82f6bf74dbb44fd

Issue created by migration from https://trac.sagemath.org/ticket/33856





---

archive/issue_comments_478043.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-21T13:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33856#issuecomment-478043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478044.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-21T14:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33856#issuecomment-478044",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478045.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-22T14:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33856#issuecomment-478045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478046.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-03T15:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33856#issuecomment-478046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_088847.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33856",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33856#event-88847"
}
```
