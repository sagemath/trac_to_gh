# Issue 33162: Fix installation of cryptominisat and pycryptosat

archive/issues_032925.json:
```json
{
    "body": "pycryptosat is meant to be installed as a part of cryptominisat,\nbut it does not happen.\n\nThis is because it's installing the Python module in SAGE_ROOT/local/\nFrom the log:\n\n```\n-- Found python interpreter, libs and header files\n-- Building python interface\n-- Python CFLAGS:  '-Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -ffile-prefix-map=/build/python3.9-RNBry6/python3.9-3.9.2=.  -fstack-protector-strong -Wformat -Werror=format-security  -g -fwrapv -O2   '\n-- Python LDFLAGS: '-lcrypt -lpthread -ldl  -lutil -lm'\n-- Python LINKFORSHARED flags: '-Xlinker -export-dynamic -Wl,-O1 -Wl,-Bsymbolic-functions'\n-- Python module will be installed to : '/home/dimpase/work/sage/local'\n-- Configuring done\n```\n\nSee\n https://groups.google.com/d/msgid/sage-release/cc134257-34d8-4c26-8719-24a994dc42dan%40googlegroups.com\n\n```\n./sage --pip install pycryptosat\n```\ncan be used as a workaround\n\n\nCC:  @mkoeppe @slel @vbraun\n\nKeywords: cryptominisat\n\nReviewer: Matthias Koeppe\n\nAuthor: Dima Pasechnik\n\nBranch: cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33162\n\n",
    "closed_at": "2022-01-15T18:58:37Z",
    "created_at": "2022-01-13T19:07:18Z",
    "labels": [
        "component: packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Fix installation of cryptominisat and pycryptosat",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33162",
    "user": "https://github.com/dimpase"
}
```
pycryptosat is meant to be installed as a part of cryptominisat,
but it does not happen.

This is because it's installing the Python module in SAGE_ROOT/local/
From the log:

```
-- Found python interpreter, libs and header files
-- Building python interface
-- Python CFLAGS:  '-Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -ffile-prefix-map=/build/python3.9-RNBry6/python3.9-3.9.2=.  -fstack-protector-strong -Wformat -Werror=format-security  -g -fwrapv -O2   '
-- Python LDFLAGS: '-lcrypt -lpthread -ldl  -lutil -lm'
-- Python LINKFORSHARED flags: '-Xlinker -export-dynamic -Wl,-O1 -Wl,-Bsymbolic-functions'
-- Python module will be installed to : '/home/dimpase/work/sage/local'
-- Configuring done
```

See
 https://groups.google.com/d/msgid/sage-release/cc134257-34d8-4c26-8719-24a994dc42dan%40googlegroups.com

```
./sage --pip install pycryptosat
```
can be used as a workaround


CC:  @mkoeppe @slel @vbraun

Keywords: cryptominisat

Reviewer: Matthias Koeppe

Author: Dima Pasechnik

Branch: cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33162





---

archive/issue_comments_653516.json:
```json
{
    "body": "<a id='comment:1'></a>\nin cmake [config of cryptominisat](https://github.com/msoos/cryptominisat/blob/master/python/CMakeLists.txt) on sees\n\n```\nif(DEFINED ENV{PYCRYPTOSAT_INSTALL_PATH})\n    set(PY_INSTALL_PREFIX \"--prefix=$ENV{PYCRYPTOSAT_INSTALL_PATH}\")\nelseif(DEFINED ENV{VIRTUAL_ENV})\n    set(PY_INSTALL_PREFIX \"\")\nelse()\n    set(PY_INSTALL_PREFIX \"--prefix=${CMAKE_INSTALL_PREFIX}\")\nendif()\n```\n\nso one can explicitly set the path for the module. But to what value?",
    "created_at": "2022-01-13T19:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653516",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
in cmake [config of cryptominisat](https://github.com/msoos/cryptominisat/blob/master/python/CMakeLists.txt) on sees

```
if(DEFINED ENV{PYCRYPTOSAT_INSTALL_PATH})
    set(PY_INSTALL_PREFIX "--prefix=$ENV{PYCRYPTOSAT_INSTALL_PATH}")
elseif(DEFINED ENV{VIRTUAL_ENV})
    set(PY_INSTALL_PREFIX "")
else()
    set(PY_INSTALL_PREFIX "--prefix=${CMAKE_INSTALL_PREFIX}")
endif()
```

so one can explicitly set the path for the module. But to what value?



---

archive/issue_comments_653517.json:
```json
{
    "body": "<a id='comment:2'></a>\nSee also\n\n- #25374: Upgrade cryptominisat to fix cryptominisat build on Cygwin",
    "created_at": "2022-01-13T20:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653517",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>
See also

- #25374: Upgrade cryptominisat to fix cryptominisat build on Cygwin



---

archive/issue_comments_653518.json:
```json
{
    "body": "Changing keywords from \"\" to \"cryptominisat\".",
    "created_at": "2022-01-13T20:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653518",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "cryptominisat".



---

archive/issue_events_106485.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "rename": {
        "from": "installation of pycryprosat/cryptominisat is broken",
        "to": "Fix installation of cryptominisat and pycryptosat"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33162#event-106485"
}
```



---

archive/issue_comments_653519.json:
```json
{
    "body": "<a id='comment:4'></a>\nIn principle, it would be set to ${SAGE_VENV}. \nBut it is not a correct solution, as explained in #25374#comment:39",
    "created_at": "2022-01-13T20:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653519",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
In principle, it would be set to ${SAGE_VENV}. 
But it is not a correct solution, as explained in #25374#comment:39



---

archive/issue_comments_653520.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mkoeppe](#comment%3A4):\n> In principle, it would be set to ${SAGE_VENV}. \n> But it is not a correct solution, as explained in #25374#comment:39\n\n\nI don't see why it's not OK. Passing `PYCRYPTOSAT_INSTALL_PATH=$SAGE_VENV`\nwould make sure the python package installs in the correct venv, while the rest goes where it should.",
    "created_at": "2022-01-13T20:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653520",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Replying to [mkoeppe](#comment%3A4):
> In principle, it would be set to ${SAGE_VENV}. 
> But it is not a correct solution, as explained in #25374#comment:39


I don't see why it's not OK. Passing `PYCRYPTOSAT_INSTALL_PATH=$SAGE_VENV`
would make sure the python package installs in the correct venv, while the rest goes where it should.



---

archive/issue_comments_653521.json:
```json
{
    "body": "<a id='comment:6'></a>\nBecause of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.",
    "created_at": "2022-01-13T20:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653521",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.



---

archive/issue_comments_653522.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A6):\n> Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.\n> \n\n\ncan we allow Python modules in SAGE_LOCAL, too? As a temporary fix, at least.",
    "created_at": "2022-01-13T21:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653522",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A6):
> Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.
> 


can we allow Python modules in SAGE_LOCAL, too? As a temporary fix, at least.



---

archive/issue_comments_653523.json:
```json
{
    "body": "<a id='comment:8'></a>\nno, they won't be in the load path.",
    "created_at": "2022-01-14T03:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653523",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
no, they won't be in the load path.



---

archive/issue_comments_653524.json:
```json
{
    "body": "<a id='comment:9'></a>\nSolution is as I said in #25374#comment:48",
    "created_at": "2022-01-14T03:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653524",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Solution is as I said in #25374#comment:48



---

archive/issue_comments_653525.json:
```json
{
    "body": "Changing commit from \"\" to \"cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\"",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653525",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430"



---

archive/issue_comments_653526.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653526",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_653527.json:
```json
{
    "body": "Changing author from \"\" to \"Dima Pasechnik\"",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653527",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Dima Pasechnik"



---

archive/issue_comments_653528.json:
```json
{
    "body": "<a id='comment:10'></a>\nhere is an easier fix. \n\nMade it blocker, as this fixes an otherwise totally broken optional package.\n\n---\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[cdd19b0](https://github.com/sagemath/sagetrac-mirror/commit/cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430)|`correctly install pycryptosat`|",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653528",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
here is an easier fix. 

Made it blocker, as this fixes an otherwise totally broken optional package.

---
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[cdd19b0](https://github.com/sagemath/sagetrac-mirror/commit/cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430)|`correctly install pycryptosat`|



---

archive/issue_comments_653529.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dimpase/packages/cryptominisat-fix\"",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653529",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "u/dimpase/packages/cryptominisat-fix"



---

archive/issue_comments_653530.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis is not enough because it will break when you switch to a different Python.",
    "created_at": "2022-01-14T15:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653530",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
This is not enough because it will break when you switch to a different Python.



---

archive/issue_comments_653531.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-01-14T15:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653531",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_653532.json:
```json
{
    "body": "<a id='comment:12'></a>\ncryptominisat depends on\n$(PYTHON), thus such a switch will trigger a rebuild.",
    "created_at": "2022-01-14T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653532",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
cryptominisat depends on
$(PYTHON), thus such a switch will trigger a rebuild.



---

archive/issue_comments_653533.json:
```json
{
    "body": "<a id='comment:13'></a>\nNope",
    "created_at": "2022-01-14T17:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653533",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Nope



---

archive/issue_comments_653534.json:
```json
{
    "body": "<a id='comment:14'></a>\nthen I don't understand what \"switch\" means.",
    "created_at": "2022-01-14T18:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653534",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
then I don't understand what "switch" means.



---

archive/issue_comments_653535.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhen a system python is in use, `$(PYTHON)` is the path to `$(SAGE_VENV)/pyvenv.cfg`. This file is created on creation of the venv for the configured python and is never updated.\n\nSwitching between pythons = Re-running `configure`, with or without `--with-python=....`, which selects different system python versions.",
    "created_at": "2022-01-14T18:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653535",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
When a system python is in use, `$(PYTHON)` is the path to `$(SAGE_VENV)/pyvenv.cfg`. This file is created on creation of the venv for the configured python and is never updated.

Switching between pythons = Re-running `configure`, with or without `--with-python=....`, which selects different system python versions.



---

archive/issue_comments_653536.json:
```json
{
    "body": "<a id='comment:16'></a>\nand how does one trigger rebuild of a Pyhton package in such a case?",
    "created_at": "2022-01-14T18:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653536",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
and how does one trigger rebuild of a Pyhton package in such a case?



---

archive/issue_comments_653537.json:
```json
{
    "body": "<a id='comment:17'></a>\nInstallation records for Python packages are kept in $(SAGE_VENV)/var/lib/sage/installed.\nDifferent Python version -> Different SAGE_VENV -> different installation records.",
    "created_at": "2022-01-14T18:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653537",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Installation records for Python packages are kept in $(SAGE_VENV)/var/lib/sage/installed.
Different Python version -> Different SAGE_VENV -> different installation records.



---

archive/issue_comments_653538.json:
```json
{
    "body": "<a id='comment:18'></a>\nthis does not answer my question.",
    "created_at": "2022-01-14T18:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653538",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
this does not answer my question.



---

archive/issue_comments_653539.json:
```json
{
    "body": "<a id='comment:19'></a>\nThen I don't understand your question - what should trigger a rebuild of what?",
    "created_at": "2022-01-14T18:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653539",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Then I don't understand your question - what should trigger a rebuild of what?



---

archive/issue_comments_653540.json:
```json
{
    "body": "<a id='comment:20'></a>\nhow does using another Python in a configure run sets up rebuilt of python packages? Suppose you have \n\n```\n./configure --with-python=foo\nmake\n./configure --with-python=bar\nmake\n```\nWhat is triggering building Python packages for `bar` ?",
    "created_at": "2022-01-14T19:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653540",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
how does using another Python in a configure run sets up rebuilt of python packages? Suppose you have 

```
./configure --with-python=foo
make
./configure --with-python=bar
make
```
What is triggering building Python packages for `bar` ?



---

archive/issue_comments_653541.json:
```json
{
    "body": "<a id='comment:21'></a>\nIf foo is python3.8 and bar is python3.9, \nthen first, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.8`\nand after reconfiguration, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.9`.\n\nInstallation records for Python packages are kept in `$SAGE_VENV/var/lib/sage/installed`.\nAfter reconfiguration, no Python package will have installation records. So all Python packages are built.",
    "created_at": "2022-01-14T19:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653541",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
If foo is python3.8 and bar is python3.9, 
then first, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.8`
and after reconfiguration, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.9`.

Installation records for Python packages are kept in `$SAGE_VENV/var/lib/sage/installed`.
After reconfiguration, no Python package will have installation records. So all Python packages are built.



---

archive/issue_comments_653542.json:
```json
{
    "body": "<a id='comment:22'></a>\nI've added some explanation of this in https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages",
    "created_at": "2022-01-14T19:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653542",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
I've added some explanation of this in https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages



---

archive/issue_comments_653543.json:
```json
{
    "body": "<a id='comment:23'></a>\ncan we set up a \"dummy\" Python package pycryptosat, a dependency of cryptominisat, which sole purpose is to trigger rebuild of cryptominisat ?",
    "created_at": "2022-01-14T19:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653543",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
can we set up a "dummy" Python package pycryptosat, a dependency of cryptominisat, which sole purpose is to trigger rebuild of cryptominisat ?



---

archive/issue_comments_653544.json:
```json
{
    "body": "<a id='comment:24'></a>\nWhy not just make it an ordinary package?",
    "created_at": "2022-01-14T19:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653544",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Why not just make it an ordinary package?



---

archive/issue_comments_653545.json:
```json
{
    "body": "<a id='comment:25'></a>\nbecause I have no idea how to decouple pycryptosat from cryptominisat.\n\nthe former is generated on the fly from templates, by the latter.",
    "created_at": "2022-01-14T20:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653545",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
because I have no idea how to decouple pycryptosat from cryptominisat.

the former is generated on the fly from templates, by the latter.



---

archive/issue_comments_653546.json:
```json
{
    "body": "<a id='comment:26'></a>\nThere is not a separate Makefile target for just installing the Python package?\nOK to build the C library twice; but we should avoid to install it twice.",
    "created_at": "2022-01-14T20:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653546",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
There is not a separate Makefile target for just installing the Python package?
OK to build the C library twice; but we should avoid to install it twice.



---

archive/issue_comments_653547.json:
```json
{
    "body": "<a id='comment:27'></a>\nmakefiles generated by cmake are usually a mess.",
    "created_at": "2022-01-14T20:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653547",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
makefiles generated by cmake are usually a mess.



---

archive/issue_comments_653548.json:
```json
{
    "body": "<a id='comment:28'></a>\nI would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.\n\nHow about just renaming cryptominisat spkg to pycryptosat ?",
    "created_at": "2022-01-14T21:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653548",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.

How about just renaming cryptominisat spkg to pycryptosat ?



---

archive/issue_comments_653549.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [dimpase](#comment%3A28):\n> I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.\n\n\nI don't see how it could fail. All the rpaths are set correctly by the build system.",
    "created_at": "2022-01-14T21:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653549",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Replying to [dimpase](#comment%3A28):
> I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.


I don't see how it could fail. All the rpaths are set correctly by the build system.



---

archive/issue_comments_653550.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [dimpase](#comment%3A28):\n> How about just renaming cryptominisat spkg to pycryptosat ?\n\n\nFine with me; then you could add an `install-requires.txt`, which will ensure installation will go into SAGE_VENV.",
    "created_at": "2022-01-14T21:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653550",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Replying to [dimpase](#comment%3A28):
> How about just renaming cryptominisat spkg to pycryptosat ?


Fine with me; then you could add an `install-requires.txt`, which will ensure installation will go into SAGE_VENV.



---

archive/issue_comments_653551.json:
```json
{
    "body": "<a id='comment:31'></a>\nimho using `sdh_pip_install` already makes sure it goes to SAGE_VENV, no?",
    "created_at": "2022-01-14T21:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653551",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
imho using `sdh_pip_install` already makes sure it goes to SAGE_VENV, no?



---

archive/issue_comments_653552.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe installation of the Python package yes, but not the library and not the installation record!",
    "created_at": "2022-01-14T22:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653552",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
The installation of the Python package yes, but not the library and not the installation record!



---

archive/issue_comments_653553.json:
```json
{
    "body": "<a id='comment:33'></a>\nBut the present branch is certainly an improvement, so let's consider it a hotfix for Sage 9.5",
    "created_at": "2022-01-14T23:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653553",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
But the present branch is certainly an improvement, so let's consider it a hotfix for Sage 9.5



---

archive/issue_comments_653554.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-01-14T23:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653554",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_653555.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-01-15T01:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653555",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_653556.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [mkoeppe](#comment%3A32):\n> The installation of the Python package yes, but not the library and not the installation record!\n\n\n\nthe library still goes to SAGE_LOCAL.\n\nImho all the sdh_ - scripts correctly set installation records of Sage.",
    "created_at": "2022-01-15T09:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653556",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
Replying to [mkoeppe](#comment%3A32):
> The installation of the Python package yes, but not the library and not the installation record!



the library still goes to SAGE_LOCAL.

Imho all the sdh_ - scripts correctly set installation records of Sage.



---

archive/issue_comments_653557.json:
```json
{
    "body": "<a id='comment:36'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[e3d8e91](https://github.com/sagemath/sagetrac-mirror/commit/e3d8e9190033b14a3da5626a19701429fa9633fb)|`spin off installation of cryptominisat's Python`|",
    "created_at": "2022-01-15T14:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[e3d8e91](https://github.com/sagemath/sagetrac-mirror/commit/e3d8e9190033b14a3da5626a19701429fa9633fb)|`spin off installation of cryptominisat's Python`|



---

archive/issue_comments_653558.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-01-15T14:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_653559.json:
```json
{
    "body": "Changing commit from \"cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\" to \"e3d8e9190033b14a3da5626a19701429fa9633fb\"",
    "created_at": "2022-01-15T14:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430" to "e3d8e9190033b14a3da5626a19701429fa9633fb"



---

archive/issue_comments_653560.json:
```json
{
    "body": "<a id='comment:37'></a>\nIs this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.",
    "created_at": "2022-01-15T14:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653560",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.



---

archive/issue_comments_653561.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [dimpase](#comment%3A35):\n> Imho all the sdh_ - scripts correctly set installation records of Sage. \n\n\nThe installation records are set by `sage-spkg`, not by `sdh_...`.\nOne record for one package.",
    "created_at": "2022-01-15T16:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653561",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Replying to [dimpase](#comment%3A35):
> Imho all the sdh_ - scripts correctly set installation records of Sage. 


The installation records are set by `sage-spkg`, not by `sdh_...`.
One record for one package.



---

archive/issue_comments_653562.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [dimpase](#comment%3A37):\n> Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.\n\n\nAlmost. Still need `build/pkgs/pycryptosat/install-requires.txt` so that the installation record goes into SAGE_VENV, not in SAGE_LOCAL",
    "created_at": "2022-01-15T16:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653562",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Replying to [dimpase](#comment%3A37):
> Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.


Almost. Still need `build/pkgs/pycryptosat/install-requires.txt` so that the installation record goes into SAGE_VENV, not in SAGE_LOCAL



---

archive/issue_comments_653563.json:
```json
{
    "body": "<a id='comment:40'></a>\nAnd `build/pkgs/pycryptosat/checksums.ini` should be a symlink, not a copy, of `cryptominisat`'s.\n(Like it is done for `gcc`/`gfortran`)",
    "created_at": "2022-01-15T16:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653563",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
And `build/pkgs/pycryptosat/checksums.ini` should be a symlink, not a copy, of `cryptominisat`'s.
(Like it is done for `gcc`/`gfortran`)



---

archive/issue_comments_653564.json:
```json
{
    "body": "<a id='comment:41'></a>\nAre the `pycryptosat` `distros` correct? Do the \"cryptominisat\" distro packages really install the Python bindings?",
    "created_at": "2022-01-15T16:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653564",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Are the `pycryptosat` `distros` correct? Do the "cryptominisat" distro packages really install the Python bindings?



---

archive/issue_comments_653565.json:
```json
{
    "body": "<a id='comment:42'></a>\nAlso a good moment to add `upstream_url` in `checksums.ini`",
    "created_at": "2022-01-15T16:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653565",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Also a good moment to add `upstream_url` in `checksums.ini`



---

archive/issue_comments_653566.json:
```json
{
    "body": "<a id='comment:43'></a>\nAlso note that the positively reviewed version of this ticket is already on Volker's branch, so best to reset to that and continue on a follow-up ticket",
    "created_at": "2022-01-15T16:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653566",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Also note that the positively reviewed version of this ticket is already on Volker's branch, so best to reset to that and continue on a follow-up ticket



---

archive/issue_comments_653567.json:
```json
{
    "body": "<a id='comment:44'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-15T17:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653567",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_653568.json:
```json
{
    "body": "Changing commit from \"e3d8e9190033b14a3da5626a19701429fa9633fb\" to \"cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\"",
    "created_at": "2022-01-15T17:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653568",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e3d8e9190033b14a3da5626a19701429fa9633fb" to "cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430"



---

archive/issue_comments_653569.json:
```json
{
    "body": "<a id='comment:45'></a>\nok, this is the old fix",
    "created_at": "2022-01-15T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653569",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>
ok, this is the old fix



---

archive/issue_comments_653570.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-15T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653570",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_653571.json:
```json
{
    "body": "<a id='comment:46'></a>\nfollowup on #33183",
    "created_at": "2022-01-15T17:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653571",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>
followup on #33183



---

archive/issue_comments_653572.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [mkoeppe](#comment%3A41):\n> Are the `pycryptosat` `distros` correct? Do the \"cryptominisat\" distro packages really install the Python bindings?\n\n\nI don't know - as spkg-configure is not yet there, it can be left as such for the time being.",
    "created_at": "2022-01-15T17:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653572",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>
Replying to [mkoeppe](#comment%3A41):
> Are the `pycryptosat` `distros` correct? Do the "cryptominisat" distro packages really install the Python bindings?


I don't know - as spkg-configure is not yet there, it can be left as such for the time being.



---

archive/issue_events_106486.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-15T18:58:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33162#event-106486"
}
```



---

archive/issue_comments_653573.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-15T18:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653573",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_653574.json:
```json
{
    "body": "Changing branch from \"u/dimpase/packages/cryptominisat-fix\" to \"cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\"",
    "created_at": "2022-01-15T18:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653574",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dimpase/packages/cryptominisat-fix" to "cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430"



---

archive/issue_comments_653575.json:
```json
{
    "body": "<a id='comment:49'></a>\nIt seems something is missing (maybe a dependency) as it is now broken on my machine, see https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/Tm7RSWINAgAJ\n\nIs there a ticket for it already? I think I have seen a report of the failure earlier this week by someone else, I don't remember where.",
    "created_at": "2022-01-21T16:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653575",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:49'></a>
It seems something is missing (maybe a dependency) as it is now broken on my machine, see https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/Tm7RSWINAgAJ

Is there a ticket for it already? I think I have seen a report of the failure earlier this week by someone else, I don't remember where.



---

archive/issue_comments_653576.json:
```json
{
    "body": "Changing commit from \"cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430\" to \"\"",
    "created_at": "2022-01-21T16:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653576",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "cdd19b0ac19b7c1cd3c9df1e55468e3cd5d23430" to ""



---

archive/issue_comments_653577.json:
```json
{
    "body": "<a id='comment:50'></a>\nmissing python toolchain in deps of cryptominisat.\n\nsee #33183",
    "created_at": "2022-01-21T21:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33162#issuecomment-653577",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>
missing python toolchain in deps of cryptominisat.

see #33183
