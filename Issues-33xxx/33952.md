# Issue 33952: Add methods to compute holomorphic differentials of function field

archive/issues_033715.json:
```json
{
    "body": "CC:  @brentbaccala\n\nIt is simple to compute the space of holomorphic differentials based on the current function field machinery.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33952\n\n",
    "closed_at": "2022-07-09T22:31:05Z",
    "created_at": "2022-06-05T02:52:50Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Add methods to compute holomorphic differentials of function field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33952",
    "user": "https://github.com/kwankyu"
}
```
CC:  @brentbaccala

It is simple to compute the space of holomorphic differentials based on the current function field machinery.

Issue created by migration from https://trac.sagemath.org/ticket/33952





---

archive/issue_comments_479042.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-05T02:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479043.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-05T02:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479043",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479044.json:
```json
{
    "body": "The code can be very slow and presumably use a lot of memory as in the following case, where for me Sage eventually crashes. \n\n```\nF.<s5> = QQ.extension(polygen(QQ)^2-5, embedding=2)\nK.<x> = FunctionField(F)\n_.<Y> = K[]\nf = -20*x^6 + (45*s5 + 75)*x^4*Y + 68*x^3*Y^2 + (-180*s5 - 400)*x^3*Y + (189*s5 + 441)*x^2*Y^2 + (45*s5 + 75)*x*Y^3 - 20*Y^4 + (-63*s5 - 141)*x*Y^2 + (-180*s5 - 400)*Y^3 + (144*s5 + 322)*Y^2\nL.<y> = K.extension(f)\nL.basis_of_holomorphic_differentials()\n```\nThis example comes from a genuine use case I have wanted differentials for, and Maple can do the corresponding calculation in less than a second. Perhaps add a warning or a note about this in the documentation, otherwise the code looks good.",
    "created_at": "2022-06-27T08:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479044",
    "user": "https://github.com/DisneyHogg"
}
```

The code can be very slow and presumably use a lot of memory as in the following case, where for me Sage eventually crashes. 

```
F.<s5> = QQ.extension(polygen(QQ)^2-5, embedding=2)
K.<x> = FunctionField(F)
_.<Y> = K[]
f = -20*x^6 + (45*s5 + 75)*x^4*Y + 68*x^3*Y^2 + (-180*s5 - 400)*x^3*Y + (189*s5 + 441)*x^2*Y^2 + (45*s5 + 75)*x*Y^3 - 20*Y^4 + (-63*s5 - 141)*x*Y^2 + (-180*s5 - 400)*Y^3 + (144*s5 + 322)*Y^2
L.<y> = K.extension(f)
L.basis_of_holomorphic_differentials()
```
This example comes from a genuine use case I have wanted differentials for, and Maple can do the corresponding calculation in less than a second. Perhaps add a warning or a note about this in the documentation, otherwise the code looks good.



---

archive/issue_comments_479045.json:
```json
{
    "body": "Replying to [comment:5 gh-DisneyHogg]:\n> The code can be very slow and presumably use a lot of memory as in the following case, where for me Sage eventually crashes. \n> \n> ```\n> F.<s5> = QQ.extension(polygen(QQ)^2-5, embedding=2)\n> K.<x> = FunctionField(F)\n> _.<Y> = K[]\n> f = -20*x^6 + (45*s5 + 75)*x^4*Y + 68*x^3*Y^2 + (-180*s5 - 400)*x^3*Y + (189*s5 + 441)*x^2*Y^2 + (45*s5 + 75)*x*Y^3 - 20*Y^4 + (-63*s5 - 141)*x*Y^2 + (-180*s5 - 400)*Y^3 + (144*s5 + 322)*Y^2\n> L.<y> = K.extension(f)\n> L.basis_of_holomorphic_differentials()\n> ```\n> This example comes from a genuine use case I have wanted differentials for, and Maple can do the corresponding calculation in less than a second. \n\n\nSorry that the method does not help your genuine use case. Indeed it takes forever just to compute `L.maximal_order_infinite()`, which needs to be done before any computation can proceed. It does the computation through Singular's `normal` function that computes the integral closure of a given ideal. It seems that the Singular function does not work well with number fields...  \n\n> Perhaps add a warning or a note about this in the documentation, otherwise the code looks good. \n\n\nThe above failure is not directly related with the code here. So it seems inappropriate to add a warning or note to the new method.",
    "created_at": "2022-06-27T09:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479045",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:5 gh-DisneyHogg]:
> The code can be very slow and presumably use a lot of memory as in the following case, where for me Sage eventually crashes. 
> 
> ```
> F.<s5> = QQ.extension(polygen(QQ)^2-5, embedding=2)
> K.<x> = FunctionField(F)
> _.<Y> = K[]
> f = -20*x^6 + (45*s5 + 75)*x^4*Y + 68*x^3*Y^2 + (-180*s5 - 400)*x^3*Y + (189*s5 + 441)*x^2*Y^2 + (45*s5 + 75)*x*Y^3 - 20*Y^4 + (-63*s5 - 141)*x*Y^2 + (-180*s5 - 400)*Y^3 + (144*s5 + 322)*Y^2
> L.<y> = K.extension(f)
> L.basis_of_holomorphic_differentials()
> ```
> This example comes from a genuine use case I have wanted differentials for, and Maple can do the corresponding calculation in less than a second. 


Sorry that the method does not help your genuine use case. Indeed it takes forever just to compute `L.maximal_order_infinite()`, which needs to be done before any computation can proceed. It does the computation through Singular's `normal` function that computes the integral closure of a given ideal. It seems that the Singular function does not work well with number fields...  

> Perhaps add a warning or a note about this in the documentation, otherwise the code looks good. 


The above failure is not directly related with the code here. So it seems inappropriate to add a warning or note to the new method.



---

archive/issue_comments_479046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-27T09:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479047.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-27T10:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479047",
    "user": "https://github.com/DisneyHogg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_479048.json:
```json
{
    "body": "Replying to [comment:6 klee]:\n\n> The above failure is not directly related with the code here. So it seems inappropriate to add a warning or note to the new method.\n\n\nHappy with this approach, so give positive review.",
    "created_at": "2022-06-27T10:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479048",
    "user": "https://github.com/DisneyHogg"
}
```

Replying to [comment:6 klee]:

> The above failure is not directly related with the code here. So it seems inappropriate to add a warning or note to the new method.


Happy with this approach, so give positive review.



---

archive/issue_comments_479049.json:
```json
{
    "body": "Thanks!\n\ncc-ed to the characteristic-zero function field expert.",
    "created_at": "2022-06-27T11:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479049",
    "user": "https://github.com/kwankyu"
}
```

Thanks!

cc-ed to the characteristic-zero function field expert.



---

archive/issue_comments_479050.json:
```json
{
    "body": "Replying to [comment:10 klee]:\n> Thanks!\n> \n> cc-ed to the characteristic-zero function field expert.\n\n\nThanks for the cc, klee, I'll take a look.",
    "created_at": "2022-07-02T00:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479050",
    "user": "https://github.com/BrentBaccala"
}
```

Replying to [comment:10 klee]:
> Thanks!
> 
> cc-ed to the characteristic-zero function field expert.


Thanks for the cc, klee, I'll take a look.



---

archive/issue_comments_479051.json:
```json
{
    "body": "Replying to [comment:11 gh-BrentBaccala]:\n> Replying to [comment:10 klee]:\n> > Thanks!\n> > \n> > cc-ed to the characteristic-zero function field expert.\n\n> \n> Thanks for the cc, klee, I'll take a look.\n\n\nMeanwhile, I narrowed it down to this singular code (which computes the integral basis of the infinite maximal order of the example function field):\n\n```\nLIB \"normal.lib\";\nring S = (0,s5),(x,y),dp;\nminpoly = s5^2 - 5;\nideal i = x^18+(9*s5+20)*y*x^15+(-9/4*s5-15/4)*y*x^14+(-36/5*s5-161/10)*y^2*x^12+(63/20*s5+141/20)*y^2*x^11+(-189/20*s5-441/20)*y^2*x^10-17/5*y^2*x^9+(9*s5+20)*y^3*x^6+(-9/4*s5-15/4)*y^3*x^5+y^4;\nnormal(i);\n```\n\nwhich takes forever.",
    "created_at": "2022-07-02T01:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479051",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:11 gh-BrentBaccala]:
> Replying to [comment:10 klee]:
> > Thanks!
> > 
> > cc-ed to the characteristic-zero function field expert.

> 
> Thanks for the cc, klee, I'll take a look.


Meanwhile, I narrowed it down to this singular code (which computes the integral basis of the infinite maximal order of the example function field):

```
LIB "normal.lib";
ring S = (0,s5),(x,y),dp;
minpoly = s5^2 - 5;
ideal i = x^18+(9*s5+20)*y*x^15+(-9/4*s5-15/4)*y*x^14+(-36/5*s5-161/10)*y^2*x^12+(63/20*s5+141/20)*y^2*x^11+(-189/20*s5-441/20)*y^2*x^10-17/5*y^2*x^9+(9*s5+20)*y^3*x^6+(-9/4*s5-15/4)*y^3*x^5+y^4;
normal(i);
```

which takes forever.



---

archive/issue_comments_479052.json:
```json
{
    "body": "I received this reply from the author of `normal.lib`, Gert-Martin Greuel:\n\n---\nThe ideal is fine and the algorithm works well. However, due to\ncoefficient swell in char 0 it takes long.\nYou can control the computational progress by setting `option(prot);`\nbefore the computation (the manual explains the symbols).\n\nI did the computation in a large finite char and then it took 31 sec\n(on my MacBook Air M1). The protocol gives you an impression of the\nlarge number of Groebner basis computations. Here is my input\n\n```\noption(prot);\nLIB \"normal.lib\";\nring S = (32003,s5),(x,y),dp;\nminpoly = s5^2 - 5;\nideal i = x^18+(9*s5+20)*y*x^15+(-9/4*s5-15/4)*y*x^14+(-36/5*s5-161/10)*y^2*x^12+(63/20*s5+141/20)*y^2*x^11+(-189/20*s5-441/20)*y^2*x^10-17/5*y^2*x^9+(9*s5+20)*y^3*x^6+(-9/4*s5-15/4)*y^3*x^5+y^4;\nint t=timer;\nlist nor = normal(i);\ntimer-t;   //shows the time in sec\nnor;\n```\nI stopped the computation in char 0 after 5 h but the protocol shows\nthat it works correctly. However the total time to finish is\nunpredictable.",
    "created_at": "2022-07-02T23:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479052",
    "user": "https://github.com/kwankyu"
}
```

I received this reply from the author of `normal.lib`, Gert-Martin Greuel:

---
The ideal is fine and the algorithm works well. However, due to
coefficient swell in char 0 it takes long.
You can control the computational progress by setting `option(prot);`
before the computation (the manual explains the symbols).

I did the computation in a large finite char and then it took 31 sec
(on my MacBook Air M1). The protocol gives you an impression of the
large number of Groebner basis computations. Here is my input

```
option(prot);
LIB "normal.lib";
ring S = (32003,s5),(x,y),dp;
minpoly = s5^2 - 5;
ideal i = x^18+(9*s5+20)*y*x^15+(-9/4*s5-15/4)*y*x^14+(-36/5*s5-161/10)*y^2*x^12+(63/20*s5+141/20)*y^2*x^11+(-189/20*s5-441/20)*y^2*x^10-17/5*y^2*x^9+(9*s5+20)*y^3*x^6+(-9/4*s5-15/4)*y^3*x^5+y^4;
int t=timer;
list nor = normal(i);
timer-t;   //shows the time in sec
nor;
```
I stopped the computation in char 0 after 5 h but the protocol shows
that it works correctly. However the total time to finish is
unpredictable.



---

archive/issue_events_088960.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:31:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33952#event-88960"
}
```



---

archive/issue_comments_479053.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-09T22:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33952#issuecomment-479053",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
