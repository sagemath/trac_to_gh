# Issue 33811: Conversion of already exactified algebraic numbers to number field elements is very slow

archive/issues_033574.json:
```json
{
    "body": "Consider:\n\n```\nsage: P.<t> = QQ[]\nsage: coefficients_as_integer_ratios = [\n....:     (-2774600080567517563395913264491323241652779066919616441429094563840,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (-24216324060414384566983400245979288839929814383090701293489050615808,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (325579773864372490083706670433410006284520887405882567940047555526656,\n....:      180143564412823751787837643000565238870031999674661705128541236331583133845246252269971),\n....:     (-86736048492777879473586471630941922517134071457946320753641122078523392,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (-2338058278498910195688689352766977573607428722429118859280880481590329344,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (105830270645785996318880019945503938356315302592627229453391693256551317504,\n....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),\n....:     (1110926147990548796149597141538460730252912439930561079348611699181798425600,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (-89705438380888704653335165590083767769953879654958783855317882966200828559360,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (1151092895747371986483047191334923516591005329489629755485810229546333821625856,\n....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),\n....:     (24725641793859400310483886670136079788266826658111372723121573233077840328938576,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (-31051495080139473677925068000403254349133134904365702868216464107777210775457136,\n....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),\n....:     (9431591461895130351865642769482226964622378075329823505708119342634182162193000560,\n....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n....:     (1721694880863483428337378731387732043714427651970488363462560317808769716807148992,\n....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),\n....:     (255327752077837584624694974814916395144764296822788813014081161094149724325120096,\n....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),\n....:     (238105337335596176836773151768694069523377650990453522899627157538495252117232992338,\n....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),\n....:     (1255826892296350234297164500548658984205287902407560187136301197703464130999349114638,\n....:      14336685057075938723599535602121108975815695475838128781856222960645024492874269211797),\n....:     (1, 1)]\nsage: p = P(coefficients_as_integer_ratios)\nsage: from sage.rings.qqbar import *\nsage: F = NumberField(p, 'a', check=False)\nsage: za = RIF(-RR(0.036151142425748496), -RR(0.036151142425748489))\nsage: zb = RIF(-RR(0.011298617187916445), -RR(0.011298617187916443))\nsage: r = ANRoot(p, CIF(za, zb))\nsage: gen = AlgebraicGenerator(F, r)\nsage: a = AlgebraicNumber(ANExtensionElement(gen, F.gen()))\n```\nWe can check that internally, `a` is represented as a number field element, and `a.exactify()` has nothing to do:\n\n```\nsage: type(a._descr)\n<class 'sage.rings.qqbar.ANExtensionElement'>\nsage: a._descr\na where a^16 + 1255826892296350234297164500548658984205287902407560187136301197703464130999349114638/14336685057075938723599535602121108975815695475838128781856222960645024492874269211797*a^15 + 238105337335596176836773151768694069523377650990453522899627157538495252117232992338/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^14 + 255327752077837584624694974814916395144764296822788813014081161094149724325120096/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^13 + 1721694880863483428337378731387732043714427651970488363462560317808769716807148992/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^12 + 9431591461895130351865642769482226964622378075329823505708119342634182162193000560/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^11 - 31051495080139473677925068000403254349133134904365702868216464107777210775457136/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^10 + 24725641793859400310483886670136079788266826658111372723121573233077840328938576/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^9 + 1151092895747371986483047191334923516591005329489629755485810229546333821625856/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^8 - 89705438380888704653335165590083767769953879654958783855317882966200828559360/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^7 + 1110926147990548796149597141538460730252912439930561079348611699181798425600/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^6 + 105830270645785996318880019945503938356315302592627229453391693256551317504/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^5 - 2338058278498910195688689352766977573607428722429118859280880481590329344/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^4 - 86736048492777879473586471630941922517134071457946320753641122078523392/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^3 + 325579773864372490083706670433410006284520887405882567940047555526656/180143564412823751787837643000565238870031999674661705128541236331583133845246252269971*a^2 - 24216324060414384566983400245979288839929814383090701293489050615808/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a - 2774600080567517563395913264491323241652779066919616441429094563840/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333 = 0 and a in -0.03615114242574849? - 0.011298617187916444?*I\nsage: a.exactify()\n```\nHowever, this does not finish in reasonable time:\n\n```\nsage: a.as_number_field_element()\n```\n\nMy understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero\u2014which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.\n\nEven then, exactifying an expression of the form pol(a) where pol\u00a0\u2208\u00a0\u211a[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over\u00a0\u211a (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.\n\nCC:  @mwageringel @jplab @videlec @slel\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/33811\n\n",
    "created_at": "2022-05-05T15:47:48Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Conversion of already exactified algebraic numbers to number field elements is very slow",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33811",
    "user": "https://github.com/mezzarobba"
}
```
Consider:

```
sage: P.<t> = QQ[]
sage: coefficients_as_integer_ratios = [
....:     (-2774600080567517563395913264491323241652779066919616441429094563840,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (-24216324060414384566983400245979288839929814383090701293489050615808,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (325579773864372490083706670433410006284520887405882567940047555526656,
....:      180143564412823751787837643000565238870031999674661705128541236331583133845246252269971),
....:     (-86736048492777879473586471630941922517134071457946320753641122078523392,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (-2338058278498910195688689352766977573607428722429118859280880481590329344,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (105830270645785996318880019945503938356315302592627229453391693256551317504,
....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),
....:     (1110926147990548796149597141538460730252912439930561079348611699181798425600,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (-89705438380888704653335165590083767769953879654958783855317882966200828559360,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (1151092895747371986483047191334923516591005329489629755485810229546333821625856,
....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),
....:     (24725641793859400310483886670136079788266826658111372723121573233077840328938576,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (-31051495080139473677925068000403254349133134904365702868216464107777210775457136,
....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),
....:     (9431591461895130351865642769482226964622378075329823505708119342634182162193000560,
....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
....:     (1721694880863483428337378731387732043714427651970488363462560317808769716807148992,
....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),
....:     (255327752077837584624694974814916395144764296822788813014081161094149724325120096,
....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),
....:     (238105337335596176836773151768694069523377650990453522899627157538495252117232992338,
....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),
....:     (1255826892296350234297164500548658984205287902407560187136301197703464130999349114638,
....:      14336685057075938723599535602121108975815695475838128781856222960645024492874269211797),
....:     (1, 1)]
sage: p = P(coefficients_as_integer_ratios)
sage: from sage.rings.qqbar import *
sage: F = NumberField(p, 'a', check=False)
sage: za = RIF(-RR(0.036151142425748496), -RR(0.036151142425748489))
sage: zb = RIF(-RR(0.011298617187916445), -RR(0.011298617187916443))
sage: r = ANRoot(p, CIF(za, zb))
sage: gen = AlgebraicGenerator(F, r)
sage: a = AlgebraicNumber(ANExtensionElement(gen, F.gen()))
```
We can check that internally, `a` is represented as a number field element, and `a.exactify()` has nothing to do:

```
sage: type(a._descr)
<class 'sage.rings.qqbar.ANExtensionElement'>
sage: a._descr
a where a^16 + 1255826892296350234297164500548658984205287902407560187136301197703464130999349114638/14336685057075938723599535602121108975815695475838128781856222960645024492874269211797*a^15 + 238105337335596176836773151768694069523377650990453522899627157538495252117232992338/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^14 + 255327752077837584624694974814916395144764296822788813014081161094149724325120096/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^13 + 1721694880863483428337378731387732043714427651970488363462560317808769716807148992/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^12 + 9431591461895130351865642769482226964622378075329823505708119342634182162193000560/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^11 - 31051495080139473677925068000403254349133134904365702868216464107777210775457136/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^10 + 24725641793859400310483886670136079788266826658111372723121573233077840328938576/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^9 + 1151092895747371986483047191334923516591005329489629755485810229546333821625856/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^8 - 89705438380888704653335165590083767769953879654958783855317882966200828559360/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^7 + 1110926147990548796149597141538460730252912439930561079348611699181798425600/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^6 + 105830270645785996318880019945503938356315302592627229453391693256551317504/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^5 - 2338058278498910195688689352766977573607428722429118859280880481590329344/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^4 - 86736048492777879473586471630941922517134071457946320753641122078523392/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^3 + 325579773864372490083706670433410006284520887405882567940047555526656/180143564412823751787837643000565238870031999674661705128541236331583133845246252269971*a^2 - 24216324060414384566983400245979288839929814383090701293489050615808/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a - 2774600080567517563395913264491323241652779066919616441429094563840/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333 = 0 and a in -0.03615114242574849? - 0.011298617187916444?*I
sage: a.exactify()
```
However, this does not finish in reasonable time:

```
sage: a.as_number_field_element()
```

My understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero—which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.

Even then, exactifying an expression of the form pol(a) where pol ∈ ℚ[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over ℚ (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.

CC:  @mwageringel @jplab @videlec @slel

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/33811





---

archive/issue_comments_674173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -50,7 +50,10 @@\n ```\n sage: a.as_number_field_element()\n ```\n-My is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is exactified to check that it is zero\u2014which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.\n+\n+My understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero\u2014which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.\n+\n+Even then, exactifying an expression of the form pol(a) where pol\u00a0\u2208\u00a0\u211a[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over\u00a0\u211a (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-05-05T18:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33811#issuecomment-674173",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -50,7 +50,10 @@
 ```
 sage: a.as_number_field_element()
 ```
-My is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is exactified to check that it is zero—which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.
+
+My understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero—which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.
+
+Even then, exactifying an expression of the form pol(a) where pol ∈ ℚ[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over ℚ (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.
 
 Comment: 1
 
``````




---

archive/issue_comments_674174.json:
```json
{
    "body": "<a id='comment:2'></a>`number_field_elements_from_algebraics()` also seems to waste a lot of time trying to decide if the number(s) to be converted are real.",
    "created_at": "2022-05-07T04:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33811#issuecomment-674174",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:2'></a>`number_field_elements_from_algebraics()` also seems to waste a lot of time trying to decide if the number(s) to be converted are real.



---

archive/issue_comments_674175.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-05-16T13:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33811#issuecomment-674175",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_674176.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to number fields.",
    "created_at": "2022-05-16T13:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33811#issuecomment-674176",
    "user": "https://github.com/slel"
}
```

Changing component from PLEASE CHANGE to number fields.



---

archive/issue_comments_674177.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,68 @@\n+Consider:\n \n+```\n+sage: P.<t> = QQ[]\n+sage: coefficients_as_integer_ratios = [\n+....:     (-2774600080567517563395913264491323241652779066919616441429094563840,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (-24216324060414384566983400245979288839929814383090701293489050615808,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (325579773864372490083706670433410006284520887405882567940047555526656,\n+....:      180143564412823751787837643000565238870031999674661705128541236331583133845246252269971),\n+....:     (-86736048492777879473586471630941922517134071457946320753641122078523392,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (-2338058278498910195688689352766977573607428722429118859280880481590329344,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (105830270645785996318880019945503938356315302592627229453391693256551317504,\n+....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),\n+....:     (1110926147990548796149597141538460730252912439930561079348611699181798425600,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (-89705438380888704653335165590083767769953879654958783855317882966200828559360,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (1151092895747371986483047191334923516591005329489629755485810229546333821625856,\n+....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),\n+....:     (24725641793859400310483886670136079788266826658111372723121573233077840328938576,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (-31051495080139473677925068000403254349133134904365702868216464107777210775457136,\n+....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),\n+....:     (9431591461895130351865642769482226964622378075329823505708119342634182162193000560,\n+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),\n+....:     (1721694880863483428337378731387732043714427651970488363462560317808769716807148992,\n+....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),\n+....:     (255327752077837584624694974814916395144764296822788813014081161094149724325120096,\n+....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),\n+....:     (238105337335596176836773151768694069523377650990453522899627157538495252117232992338,\n+....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),\n+....:     (1255826892296350234297164500548658984205287902407560187136301197703464130999349114638,\n+....:      14336685057075938723599535602121108975815695475838128781856222960645024492874269211797),\n+....:     (1, 1)]\n+sage: p = P(coefficients_as_integer_ratios)\n+sage: from sage.rings.qqbar import *\n+sage: F = NumberField(p, 'a', check=False)\n+sage: za = RIF(-RR(0.036151142425748496), -RR(0.036151142425748489))\n+sage: zb = RIF(-RR(0.011298617187916445), -RR(0.011298617187916443))\n+sage: r = ANRoot(p, CIF(za, zb))\n+sage: gen = AlgebraicGenerator(F, r)\n+sage: a = AlgebraicNumber(ANExtensionElement(gen, F.gen()))\n+```\n+We can check that internally, `a` is represented as a number field element, and `a.exactify()` has nothing to do:\n+\n+```\n+sage: type(a._descr)\n+<class 'sage.rings.qqbar.ANExtensionElement'>\n+sage: a._descr\n+a where a^16 + 1255826892296350234297164500548658984205287902407560187136301197703464130999349114638/14336685057075938723599535602121108975815695475838128781856222960645024492874269211797*a^15 + 238105337335596176836773151768694069523377650990453522899627157538495252117232992338/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^14 + 255327752077837584624694974814916395144764296822788813014081161094149724325120096/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^13 + 1721694880863483428337378731387732043714427651970488363462560317808769716807148992/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^12 + 9431591461895130351865642769482226964622378075329823505708119342634182162193000560/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^11 - 31051495080139473677925068000403254349133134904365702868216464107777210775457136/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^10 + 24725641793859400310483886670136079788266826658111372723121573233077840328938576/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^9 + 1151092895747371986483047191334923516591005329489629755485810229546333821625856/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^8 - 89705438380888704653335165590083767769953879654958783855317882966200828559360/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^7 + 1110926147990548796149597141538460730252912439930561079348611699181798425600/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^6 + 105830270645785996318880019945503938356315302592627229453391693256551317504/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^5 - 2338058278498910195688689352766977573607428722429118859280880481590329344/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^4 - 86736048492777879473586471630941922517134071457946320753641122078523392/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^3 + 325579773864372490083706670433410006284520887405882567940047555526656/180143564412823751787837643000565238870031999674661705128541236331583133845246252269971*a^2 - 24216324060414384566983400245979288839929814383090701293489050615808/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a - 2774600080567517563395913264491323241652779066919616441429094563840/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333 = 0 and a in -0.03615114242574849? - 0.011298617187916444?*I\n+sage: a.exactify()\n+```\n+However, this does not finish in reasonable time:\n+\n+```\n+sage: a.as_number_field_element()\n+```\n+\n+My understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero\u2014which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.\n+\n+Even then, exactifying an expression of the form pol(a) where pol\u00a0\u2208\u00a0\u211a[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over\u00a0\u211a (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-05-16T13:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33811#issuecomment-674177",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,68 @@
+Consider:
 
+```
+sage: P.<t> = QQ[]
+sage: coefficients_as_integer_ratios = [
+....:     (-2774600080567517563395913264491323241652779066919616441429094563840,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (-24216324060414384566983400245979288839929814383090701293489050615808,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (325579773864372490083706670433410006284520887405882567940047555526656,
+....:      180143564412823751787837643000565238870031999674661705128541236331583133845246252269971),
+....:     (-86736048492777879473586471630941922517134071457946320753641122078523392,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (-2338058278498910195688689352766977573607428722429118859280880481590329344,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (105830270645785996318880019945503938356315302592627229453391693256551317504,
+....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),
+....:     (1110926147990548796149597141538460730252912439930561079348611699181798425600,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (-89705438380888704653335165590083767769953879654958783855317882966200828559360,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (1151092895747371986483047191334923516591005329489629755485810229546333821625856,
+....:      1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111),
+....:     (24725641793859400310483886670136079788266826658111372723121573233077840328938576,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (-31051495080139473677925068000403254349133134904365702868216464107777210775457136,
+....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),
+....:     (9431591461895130351865642769482226964622378075329823505708119342634182162193000560,
+....:      4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333),
+....:     (1721694880863483428337378731387732043714427651970488363462560317808769716807148992,
+....:      153455628944257270041491325519000018296693925648785896961349942060237484386691251933679),
+....:     (255327752077837584624694974814916395144764296822788813014081161094149724325120096,
+....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),
+....:     (238105337335596176836773151768694069523377650990453522899627157538495252117232992338,
+....:      27080405107810106477910233915117650287651869232138687699061754481218379597651397400061),
+....:     (1255826892296350234297164500548658984205287902407560187136301197703464130999349114638,
+....:      14336685057075938723599535602121108975815695475838128781856222960645024492874269211797),
+....:     (1, 1)]
+sage: p = P(coefficients_as_integer_ratios)
+sage: from sage.rings.qqbar import *
+sage: F = NumberField(p, 'a', check=False)
+sage: za = RIF(-RR(0.036151142425748496), -RR(0.036151142425748489))
+sage: zb = RIF(-RR(0.011298617187916445), -RR(0.011298617187916443))
+sage: r = ANRoot(p, CIF(za, zb))
+sage: gen = AlgebraicGenerator(F, r)
+sage: a = AlgebraicNumber(ANExtensionElement(gen, F.gen()))
+```
+We can check that internally, `a` is represented as a number field element, and `a.exactify()` has nothing to do:
+
+```
+sage: type(a._descr)
+<class 'sage.rings.qqbar.ANExtensionElement'>
+sage: a._descr
+a where a^16 + 1255826892296350234297164500548658984205287902407560187136301197703464130999349114638/14336685057075938723599535602121108975815695475838128781856222960645024492874269211797*a^15 + 238105337335596176836773151768694069523377650990453522899627157538495252117232992338/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^14 + 255327752077837584624694974814916395144764296822788813014081161094149724325120096/27080405107810106477910233915117650287651869232138687699061754481218379597651397400061*a^13 + 1721694880863483428337378731387732043714427651970488363462560317808769716807148992/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^12 + 9431591461895130351865642769482226964622378075329823505708119342634182162193000560/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^11 - 31051495080139473677925068000403254349133134904365702868216464107777210775457136/153455628944257270041491325519000018296693925648785896961349942060237484386691251933679*a^10 + 24725641793859400310483886670136079788266826658111372723121573233077840328938576/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^9 + 1151092895747371986483047191334923516591005329489629755485810229546333821625856/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^8 - 89705438380888704653335165590083767769953879654958783855317882966200828559360/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^7 + 1110926147990548796149597141538460730252912439930561079348611699181798425600/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^6 + 105830270645785996318880019945503938356315302592627229453391693256551317504/1381100660498315430373421929671000164670245330839073072652149478542137359480221267403111*a^5 - 2338058278498910195688689352766977573607428722429118859280880481590329344/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^4 - 86736048492777879473586471630941922517134071457946320753641122078523392/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a^3 + 325579773864372490083706670433410006284520887405882567940047555526656/180143564412823751787837643000565238870031999674661705128541236331583133845246252269971*a^2 - 24216324060414384566983400245979288839929814383090701293489050615808/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333*a - 2774600080567517563395913264491323241652779066919616441429094563840/4143301981494946291120265789013000494010735992517219217956448435626412078440663802209333 = 0 and a in -0.03615114242574849? - 0.011298617187916444?*I
+sage: a.exactify()
+```
+However, this does not finish in reasonable time:
+
+```
+sage: a.as_number_field_element()
+```
+
+My understanding is that `number_field_elements_from_algebraic()` essentially converts `a` from an `ANExtensionElement` to an `ANRoot` `exact_generator`. Then the minimal polynomial is evaluated on the `ANRoot` to check that the embedding being set up makes sense. (Is it necessary to perform this check at all, in this context?) The evaluation results in an expression tree that is `exactify()`ed to check that it is zero—which would have been obvious if the evaluation point has been kept in `ANExtensionElement` form.
+
+Even then, exactifying an expression of the form pol(a) where pol ∈ ℚ[x] should be easy once a is exactified, and exactifying an `ANRoot` defined over ℚ (by an irreducible polynomial, in our case) should be easy... See #33810 about that part.
 
 Comment: 1
 
``````




---

archive/issue_events_088792.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33811",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33811#event-88792"
}
```
