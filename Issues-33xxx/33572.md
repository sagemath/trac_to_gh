# Issue 33572: sage -pytest

archive/issues_033335.json:
```json
{
    "body": "Thin wrapper around `pytest` for running it in the Sage environment.\n\nas suggested in #31924#comment:94\n\n\nSimilar to our existing wrapper `sage -tox`.\n\n\n\n\nCC:  @tornaria @tobiasdiez @soehms\n\nBranch/Commit: [8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)\n\nReviewer: Tobias Diez\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33572\n\n",
    "closed_at": "2022-04-03T11:13:45Z",
    "created_at": "2022-03-26T18:39:31Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "sage -pytest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33572",
    "user": "https://github.com/mkoeppe"
}
```
Thin wrapper around `pytest` for running it in the Sage environment.

as suggested in #31924#comment:94


Similar to our existing wrapper `sage -tox`.




CC:  @tornaria @tobiasdiez @soehms

Branch/Commit: [8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)

Reviewer: Tobias Diez

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33572





---

archive/issue_comments_669142.json:
```json
{
    "body": "Branch: [u/mkoeppe/sage__pytest](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__pytest)",
    "created_at": "2022-03-26T19:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669142",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/sage__pytest](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__pytest)



---

archive/issue_comments_669143.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's an attempt at this command, but I think I'll need some help here to make it actually work:\n\n```\n$ ./sage -pytest src/sage/numerical/\n============================================================================================================ test session starts ============================================================================================================\nplatform darwin -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0\nrootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src, configfile: tox.ini\ncollected 0 items / 5 errors                                                                                                                                                                                                                \n\n================================================================================================================== ERRORS ===================================================================================================================\n______________________________________________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py ______________________________________________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/numerical/backends/cvxopt_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nsrc/sage/numerical/backends/cvxopt_backend_test.py:5: in <module>\n    from sage.numerical.mip import MixedIntegerLinearProgram\nsage/numerical/mip.pyx:242: in init sage.numerical.mip\n    ???\nsage/rings/integer_ring.pyx:1: in init sage.rings.integer_ring\n    ???\nsage/rings/integer.pyx:1: in init sage.rings.integer\n    ???\nsage/rings/rational.pyx:79: in init sage.rings.rational\n    ???\nE   ImportError: cannot import name ZZ\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[9385501](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)|`src/bin/sage: Implement 'sage --pytest'`|",
    "created_at": "2022-03-26T19:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Here's an attempt at this command, but I think I'll need some help here to make it actually work:

```
$ ./sage -pytest src/sage/numerical/
============================================================================================================ test session starts ============================================================================================================
platform darwin -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0
rootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src, configfile: tox.ini
collected 0 items / 5 errors                                                                                                                                                                                                                

================================================================================================================== ERRORS ===================================================================================================================
______________________________________________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py ______________________________________________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/numerical/backends/cvxopt_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
src/sage/numerical/backends/cvxopt_backend_test.py:5: in <module>
    from sage.numerical.mip import MixedIntegerLinearProgram
sage/numerical/mip.pyx:242: in init sage.numerical.mip
    ???
sage/rings/integer_ring.pyx:1: in init sage.rings.integer_ring
    ???
sage/rings/integer.pyx:1: in init sage.rings.integer
    ???
sage/rings/rational.pyx:79: in init sage.rings.rational
    ???
E   ImportError: cannot import name ZZ
```

---
New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[9385501](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)|`src/bin/sage: Implement 'sage --pytest'`|



---

archive/issue_comments_669144.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"Matthias Koeppe, ...\"",
    "created_at": "2022-03-26T19:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669144",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe" to "Matthias Koeppe, ..."



---

archive/issue_comments_669145.json:
```json
{
    "body": "Commit: [93855017ba6d46a7e83c289b29defc9e82a24d55](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)",
    "created_at": "2022-03-26T19:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669145",
    "user": "https://github.com/mkoeppe"
}
```

Commit: [93855017ba6d46a7e83c289b29defc9e82a24d55](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)



---

archive/issue_comments_669146.json:
```json
{
    "body": "<a id='comment:3'></a>\nThat looks like a typical cyclic import that relies on `sage.all` to be broken. It is also not specific to pytest as the following example fails with the same error (when run through `./sage src/test_module_load.py`).\n\n```\nimport importlib.util\nspec = importlib.util.spec_from_file_location(\"module.name\", \"src/sage/numerical/backends/cvxopt_backend_test.py\")\nmodule = importlib.util.module_from_spec(spec)\nspec.loader.exec_module(module)\n```",
    "created_at": "2022-03-27T12:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669146",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'></a>
That looks like a typical cyclic import that relies on `sage.all` to be broken. It is also not specific to pytest as the following example fails with the same error (when run through `./sage src/test_module_load.py`).

```
import importlib.util
spec = importlib.util.spec_from_file_location("module.name", "src/sage/numerical/backends/cvxopt_backend_test.py")
module = importlib.util.module_from_spec(spec)
spec.loader.exec_module(module)
```



---

archive/issue_comments_669147.json:
```json
{
    "body": "<a id='comment:4'></a>\nMoreover, there are a few dozens of such import errors:\n\n```\nimport importlib.util\nimport pathlib\nfor file in pathlib.Path().glob(\"src/sage/**/*.py\"):\n    try: \n        spec = importlib.util.spec_from_file_location(\"module.name\", file)\n        module = importlib.util.module_from_spec(spec)\n        spec.loader.exec_module(module)\n    except:\n        print(file)\n```",
    "created_at": "2022-03-27T12:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669147",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'></a>
Moreover, there are a few dozens of such import errors:

```
import importlib.util
import pathlib
for file in pathlib.Path().glob("src/sage/**/*.py"):
    try: 
        spec = importlib.util.spec_from_file_location("module.name", file)
        module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(module)
    except:
        print(file)
```



---

archive/issue_comments_669148.json:
```json
{
    "body": "<a id='comment:5'></a>\nCan't you just add `import sage.all` in `conftest.py`?",
    "created_at": "2022-03-27T15:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Can't you just add `import sage.all` in `conftest.py`?



---

archive/issue_comments_669149.json:
```json
{
    "body": "<a id='comment:6'></a>\nThere is already a hook which adds `sage.all`, but that one is only executed after the collection phase.",
    "created_at": "2022-03-27T15:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669149",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>
There is already a hook which adds `sage.all`, but that one is only executed after the collection phase.



---

archive/issue_comments_669150.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[abbb61f](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)|`src/conftest.py: import sage.all to avoid cyclic import errors`|",
    "created_at": "2022-03-27T15:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[abbb61f](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)|`src/conftest.py: import sage.all to avoid cyclic import errors`|



---

archive/issue_comments_669151.json:
```json
{
    "body": "Changing commit from \"[93855017ba6d46a7e83c289b29defc9e82a24d55](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)\" to \"[abbb61fd2cb99836ab37448326dab7e7e7f37fd7](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)\"",
    "created_at": "2022-03-27T15:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[93855017ba6d46a7e83c289b29defc9e82a24d55](https://github.com/sagemath/sagetrac-mirror/commit/93855017ba6d46a7e83c289b29defc9e82a24d55)" to "[abbb61fd2cb99836ab37448326dab7e7e7f37fd7](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)"



---

archive/issue_comments_669152.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-27T15:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669152",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_669153.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe, ...\" to \"Matthias Koeppe\"",
    "created_at": "2022-03-27T15:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669153",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe, ..." to "Matthias Koeppe"



---

archive/issue_comments_669154.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-27T16:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669154",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_669155.json:
```json
{
    "body": "<a id='comment:9'></a>\nAh that's what you had in mind. Seems to work indeed. Can you please add a comment that prevents pyright to complain about the unused import and add a link to #33580. Thanks!",
    "created_at": "2022-03-27T16:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669155",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>
Ah that's what you had in mind. Seems to work indeed. Can you please add a comment that prevents pyright to complain about the unused import and add a link to #33580. Thanks!



---

archive/issue_comments_669156.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[9bb72ea](https://github.com/sagemath/sagetrac-mirror/commit/9bb72ea9ec314940f3c874d492de241fdec96548)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|\n|[2c16704](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)|`src/conftest.py: Remove outdated text`|",
    "created_at": "2022-03-27T16:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[9bb72ea](https://github.com/sagemath/sagetrac-mirror/commit/9bb72ea9ec314940f3c874d492de241fdec96548)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|
|[2c16704](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)|`src/conftest.py: Remove outdated text`|



---

archive/issue_comments_669157.json:
```json
{
    "body": "Changing commit from \"[abbb61fd2cb99836ab37448326dab7e7e7f37fd7](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)\" to \"[2c167045d66e049751876ddc755304940265c32a](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)\"",
    "created_at": "2022-03-27T16:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669157",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[abbb61fd2cb99836ab37448326dab7e7e7f37fd7](https://github.com/sagemath/sagetrac-mirror/commit/abbb61fd2cb99836ab37448326dab7e7e7f37fd7)" to "[2c167045d66e049751876ddc755304940265c32a](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)"



---

archive/issue_comments_669158.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-27T16:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669158",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_669159.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-27T17:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669159",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_669160.json:
```json
{
    "body": "<a id='comment:12'></a>\n\n```\n$ ./sage -pytest\n========================================================================================================= test session starts ==========================================================================================================\nplatform linux -- Python 3.8.10, pytest-7.0.1, pluggy-1.0.0\nrootdir: /workspace/sagetrac-mirror/src\ncollected 0 items / 1 error                                                                                                                                                                                                            \n\n================================================================================================================ ERRORS ================================================================================================================\n____________________________________________________________________________________________________ ERROR collecting test session _____________________________________________________________________________________________________\nlocal/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/IPython/conftest.py:9: in <module>\n    from .testing import tools\nE   ModuleNotFoundError: No module named 'workspace'\n```\nshould probably fallback to `./sage -pytest src`",
    "created_at": "2022-03-27T17:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669160",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'></a>

```
$ ./sage -pytest
========================================================================================================= test session starts ==========================================================================================================
platform linux -- Python 3.8.10, pytest-7.0.1, pluggy-1.0.0
rootdir: /workspace/sagetrac-mirror/src
collected 0 items / 1 error                                                                                                                                                                                                            

================================================================================================================ ERRORS ================================================================================================================
____________________________________________________________________________________________________ ERROR collecting test session _____________________________________________________________________________________________________
local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/IPython/conftest.py:9: in <module>
    from .testing import tools
E   ModuleNotFoundError: No module named 'workspace'
```
should probably fallback to `./sage -pytest src`



---

archive/issue_comments_669161.json:
```json
{
    "body": "Changing commit from \"[2c167045d66e049751876ddc755304940265c32a](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)\" to \"[30642ba190ae9a6a6090b11e51a317a2534028db](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)\"",
    "created_at": "2022-03-27T18:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[2c167045d66e049751876ddc755304940265c32a](https://github.com/sagemath/sagetrac-mirror/commit/2c167045d66e049751876ddc755304940265c32a)" to "[30642ba190ae9a6a6090b11e51a317a2534028db](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)"



---

archive/issue_comments_669162.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[30642ba](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)|`src/bin/sage: Handle 'sage -pytest' without file args`|",
    "created_at": "2022-03-27T18:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[30642ba](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)|`src/bin/sage: Handle 'sage -pytest' without file args`|



---

archive/issue_comments_669163.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-27T18:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669163",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_669164.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-27T19:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669164",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_669165.json:
```json
{
    "body": "<a id='comment:15'></a>\nSeems to work, thanks!",
    "created_at": "2022-03-27T19:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669165",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>
Seems to work, thanks!



---

archive/issue_comments_669166.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks",
    "created_at": "2022-03-27T19:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669166",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Thanks



---

archive/issue_comments_669167.json:
```json
{
    "body": "Reviewer: Tobias Diez",
    "created_at": "2022-03-27T19:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669167",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: Tobias Diez



---

archive/issue_comments_669168.json:
```json
{
    "body": "<a id='comment:17'></a>\nmerge conflict",
    "created_at": "2022-03-29T14:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669168",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>
merge conflict



---

archive/issue_comments_669169.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-03-29T14:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669169",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_669170.json:
```json
{
    "body": "<a id='comment:18'></a>\nAnd while you are at it, can you please move the import mode cmd flag to `addopts = --import-mode importlib` in `tox.ini`. https://docs.pytest.org/en/6.2.x/customize.html#tox-ini Thanks!",
    "created_at": "2022-03-29T14:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669170",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'></a>
And while you are at it, can you please move the import mode cmd flag to `addopts = --import-mode importlib` in `tox.ini`. https://docs.pytest.org/en/6.2.x/customize.html#tox-ini Thanks!



---

archive/issue_comments_669171.json:
```json
{
    "body": "<a id='comment:19'></a>\nWhile playing around, I've also discovered the following error:\n\n```\n$ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py\n========================================================================================================= test session starts ==========================================================================================================\nplatform linux -- Python 3.8.10, pytest-7.0.1, pluggy-1.0.0\nrootdir: /workspace/sagetrac-mirror/src, configfile: tox.ini\ncollected 0 items / 1 error                                                                                                                                                                                                            \n\n================================================================================================================ ERRORS ================================================================================================================\n_______________________________________________________________________________________ ERROR collecting sage/ext_data/nbconvert/postprocess.py ________________________________________________________________________________________\nsrc/sage/ext_data/nbconvert/postprocess.py:20: in <module>\n    with open(file_name, 'r') as f:\nE   FileNotFoundError: [Errno 2] No such file or directory: '--rootdir=/workspace/sagetrac-mirror/src'\n======================================================================================================= short test summary info ========================================================================================================\nERROR src/sage/ext_data/nbconvert/postprocess.py - FileNotFoundError: [Errno 2] No such file or directory: '--rootdir=/workspace/sagetrac-mirror/src'\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n=========================================================================================================== 1 error in 0.19s ===========================================================================================================\n```\nwhich seems to be introduced in this ticket.",
    "created_at": "2022-03-29T15:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669171",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:19'></a>
While playing around, I've also discovered the following error:

```
$ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py
========================================================================================================= test session starts ==========================================================================================================
platform linux -- Python 3.8.10, pytest-7.0.1, pluggy-1.0.0
rootdir: /workspace/sagetrac-mirror/src, configfile: tox.ini
collected 0 items / 1 error                                                                                                                                                                                                            

================================================================================================================ ERRORS ================================================================================================================
_______________________________________________________________________________________ ERROR collecting sage/ext_data/nbconvert/postprocess.py ________________________________________________________________________________________
src/sage/ext_data/nbconvert/postprocess.py:20: in <module>
    with open(file_name, 'r') as f:
E   FileNotFoundError: [Errno 2] No such file or directory: '--rootdir=/workspace/sagetrac-mirror/src'
======================================================================================================= short test summary info ========================================================================================================
ERROR src/sage/ext_data/nbconvert/postprocess.py - FileNotFoundError: [Errno 2] No such file or directory: '--rootdir=/workspace/sagetrac-mirror/src'
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
=========================================================================================================== 1 error in 0.19s ===========================================================================================================
```
which seems to be introduced in this ticket.



---

archive/issue_comments_669172.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[1ab83b2](https://github.com/sagemath/sagetrac-mirror/commit/1ab83b27cffeadcbb78b919390064714b735424d)|`src/bin/sage: Implement 'sage --pytest'`|\n|[9036ca8](https://github.com/sagemath/sagetrac-mirror/commit/9036ca89cf11c8b249f7658aed65ee4305affebb)|`src/conftest.py: import sage.all to avoid cyclic import errors`|\n|[3c09949](https://github.com/sagemath/sagetrac-mirror/commit/3c09949849e29992ac4bc3122cf51cfd8ad82511)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|\n|[07b5852](https://github.com/sagemath/sagetrac-mirror/commit/07b5852d0b2e8b832599f3f3149893511a929c1c)|`src/conftest.py: Remove outdated text`|\n|[f53bbc7](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)|`src/bin/sage: Handle 'sage -pytest' without file args`|",
    "created_at": "2022-03-29T23:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[1ab83b2](https://github.com/sagemath/sagetrac-mirror/commit/1ab83b27cffeadcbb78b919390064714b735424d)|`src/bin/sage: Implement 'sage --pytest'`|
|[9036ca8](https://github.com/sagemath/sagetrac-mirror/commit/9036ca89cf11c8b249f7658aed65ee4305affebb)|`src/conftest.py: import sage.all to avoid cyclic import errors`|
|[3c09949](https://github.com/sagemath/sagetrac-mirror/commit/3c09949849e29992ac4bc3122cf51cfd8ad82511)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|
|[07b5852](https://github.com/sagemath/sagetrac-mirror/commit/07b5852d0b2e8b832599f3f3149893511a929c1c)|`src/conftest.py: Remove outdated text`|
|[f53bbc7](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)|`src/bin/sage: Handle 'sage -pytest' without file args`|



---

archive/issue_comments_669173.json:
```json
{
    "body": "Changing commit from \"[30642ba190ae9a6a6090b11e51a317a2534028db](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)\" to \"[f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)\"",
    "created_at": "2022-03-29T23:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[30642ba190ae9a6a6090b11e51a317a2534028db](https://github.com/sagemath/sagetrac-mirror/commit/30642ba190ae9a6a6090b11e51a317a2534028db)" to "[f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)"



---

archive/issue_comments_669174.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|\n|[11219e5](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)|`src/tox.ini (pytest): Set --import-mode importlib here, not in src/bin/sage, src/bin/sage-runtests`|",
    "created_at": "2022-03-29T23:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
|[11219e5](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)|`src/tox.ini (pytest): Set --import-mode importlib here, not in src/bin/sage, src/bin/sage-runtests`|



---

archive/issue_comments_669175.json:
```json
{
    "body": "Changing commit from \"[f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)\" to \"[11219e5ca5819f09f9afe72e0c97c74fa367094a](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)\"",
    "created_at": "2022-03-29T23:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484](https://github.com/sagemath/sagetrac-mirror/commit/f53bbc7afa99b2a0f727c79a3cfe780bb3aa8484)" to "[11219e5ca5819f09f9afe72e0c97c74fa367094a](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)"



---

archive/issue_comments_669176.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-29T23:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669176",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_669177.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [gh-tobiasdiez](#comment%3A19):\n> While playing around, I've also discovered the following error:\n> \n> ```\n> $ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py\n\n\nThis file is to be considered a data file; it's not a module of the Sage library",
    "created_at": "2022-03-29T23:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669177",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Replying to [gh-tobiasdiez](#comment%3A19):
> While playing around, I've also discovered the following error:
> 
> ```
> $ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py


This file is to be considered a data file; it's not a module of the Sage library



---

archive/issue_comments_669178.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-30T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669178",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_669179.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks for the follow-up. However, during the merge something seems to went wrong. The collect_ignore in the test config shouldn't be readded.",
    "created_at": "2022-03-30T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669179",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>
Thanks for the follow-up. However, during the merge something seems to went wrong. The collect_ignore in the test config shouldn't be readded.



---

archive/issue_comments_669180.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mkoeppe](#comment%3A23):\n> Replying to [gh-tobiasdiez](#comment%3A19):\n> > While playing around, I've also discovered the following error:\n> > \n> > ```\n> > $ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py\n\n> \n> This file is to be considered a data file; it's not a module of the Sage library\n\nSo you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.",
    "created_at": "2022-03-30T12:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669180",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:25'></a>
Replying to [mkoeppe](#comment%3A23):
> Replying to [gh-tobiasdiez](#comment%3A19):
> > While playing around, I've also discovered the following error:
> > 
> > ```
> > $ ./sage --pytest src/sage/ext_data/nbconvert/postprocess.py

> 
> This file is to be considered a data file; it's not a module of the Sage library

So you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.



---

archive/issue_comments_669181.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[f0d5f84](https://github.com/sagemath/sagetrac-mirror/commit/f0d5f840f8442c327a98c9b06bae253c684d243f)|`src/conftest.py: import sage.all to avoid cyclic import errors`|\n|[d881a5a](https://github.com/sagemath/sagetrac-mirror/commit/d881a5a154c751e79cfb68ecaf60653d8e6bdc65)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|\n|[1242e1f](https://github.com/sagemath/sagetrac-mirror/commit/1242e1f5daedfac348824f47b988f55ad653b107)|`src/conftest.py: Remove outdated text`|\n|[0d9225d](https://github.com/sagemath/sagetrac-mirror/commit/0d9225d87c57f7bda7247836194ec962de476e7b)|`src/bin/sage: Handle 'sage -pytest' without file args`|\n|[05bc58f](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)|`src/tox.ini (pytest): Set --import-mode importlib here, not in src/bin/sage, src/bin/sage-runtests`|",
    "created_at": "2022-03-30T16:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[f0d5f84](https://github.com/sagemath/sagetrac-mirror/commit/f0d5f840f8442c327a98c9b06bae253c684d243f)|`src/conftest.py: import sage.all to avoid cyclic import errors`|
|[d881a5a](https://github.com/sagemath/sagetrac-mirror/commit/d881a5a154c751e79cfb68ecaf60653d8e6bdc65)|`src/conftest.py: Add # type: ignore, add reference to trac ticket`|
|[1242e1f](https://github.com/sagemath/sagetrac-mirror/commit/1242e1f5daedfac348824f47b988f55ad653b107)|`src/conftest.py: Remove outdated text`|
|[0d9225d](https://github.com/sagemath/sagetrac-mirror/commit/0d9225d87c57f7bda7247836194ec962de476e7b)|`src/bin/sage: Handle 'sage -pytest' without file args`|
|[05bc58f](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)|`src/tox.ini (pytest): Set --import-mode importlib here, not in src/bin/sage, src/bin/sage-runtests`|



---

archive/issue_comments_669182.json:
```json
{
    "body": "Changing commit from \"[11219e5ca5819f09f9afe72e0c97c74fa367094a](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)\" to \"[05bc58f97cb8b3a8712f7fb129b40d0446bc35de](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)\"",
    "created_at": "2022-03-30T16:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[11219e5ca5819f09f9afe72e0c97c74fa367094a](https://github.com/sagemath/sagetrac-mirror/commit/11219e5ca5819f09f9afe72e0c97c74fa367094a)" to "[05bc58f97cb8b3a8712f7fb129b40d0446bc35de](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)"



---

archive/issue_comments_669183.json:
```json
{
    "body": "<a id='comment:27'></a>\nIndeed. Thanks for catching the mistake in rebasing",
    "created_at": "2022-03-30T16:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669183",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Indeed. Thanks for catching the mistake in rebasing



---

archive/issue_comments_669184.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [gh-tobiasdiez](#comment%3A25):\n> So you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.\n\n\nThe directories marked by the presence of a `nodoctest` file are ignored by the doctester. \n\n```\n$ find src -name nodoctest\nsrc/sage/ext_data/nodoctest\nsrc/sage/doctest/tests/nodoctest\n```\nNot sure if we want to use this mechanism somehow or just hardcode it in `conftest.py`",
    "created_at": "2022-03-30T16:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669184",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Replying to [gh-tobiasdiez](#comment%3A25):
> So you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.


The directories marked by the presence of a `nodoctest` file are ignored by the doctester. 

```
$ find src -name nodoctest
src/sage/ext_data/nodoctest
src/sage/doctest/tests/nodoctest
```
Not sure if we want to use this mechanism somehow or just hardcode it in `conftest.py`



---

archive/issue_comments_669185.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-30T16:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669185",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_669186.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [mkoeppe](#comment%3A28):\n> Replying to [gh-tobiasdiez](#comment%3A25):\n> > So you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.\n\n> \n> The directories marked by the presence of a `nodoctest` file are ignored by the doctester. \n> \n> ```\n> $ find src -name nodoctest\n> src/sage/ext_data/nodoctest\n> src/sage/doctest/tests/nodoctest\n> ```\n> Not sure if we want to use this mechanism somehow or just hardcode it in `conftest.py`\n\n\nI would say its simpler to exclude these two directories in conftest. As you already know, I'm not a big fan of such marker files in general.",
    "created_at": "2022-03-30T18:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669186",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:30'></a>
Replying to [mkoeppe](#comment%3A28):
> Replying to [gh-tobiasdiez](#comment%3A25):
> > So you are saying it should be removed during collection? Then please do so by adding a filter in pytest_collect_file similar to  #33560.

> 
> The directories marked by the presence of a `nodoctest` file are ignored by the doctester. 
> 
> ```
> $ find src -name nodoctest
> src/sage/ext_data/nodoctest
> src/sage/doctest/tests/nodoctest
> ```
> Not sure if we want to use this mechanism somehow or just hardcode it in `conftest.py`


I would say its simpler to exclude these two directories in conftest. As you already know, I'm not a big fan of such marker files in general.



---

archive/issue_comments_669187.json:
```json
{
    "body": "<a id='comment:31'></a>\nOK, sounds good.",
    "created_at": "2022-03-30T18:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669187",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
OK, sounds good.



---

archive/issue_comments_669188.json:
```json
{
    "body": "<a id='comment:32'></a>\nGiven that `./sage --pytest src/sage/ext_data/nbconvert/` collects nothing, I don't think we need to do anything about `./sage --pytest src/sage/ext_data/nbconvert/postprocess.py`.",
    "created_at": "2022-03-30T23:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669188",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Given that `./sage --pytest src/sage/ext_data/nbconvert/` collects nothing, I don't think we need to do anything about `./sage --pytest src/sage/ext_data/nbconvert/postprocess.py`.



---

archive/issue_comments_669189.json:
```json
{
    "body": "<a id='comment:33'></a>\nWhy not?\nIt's the same issue as with `sage -t` and #33560. It works if you specify a folder and let pytest do the collection, but doesn't work correctly if you overwrite the collection by specifying the complete path.",
    "created_at": "2022-03-31T08:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669189",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:33'></a>
Why not?
It's the same issue as with `sage -t` and #33560. It works if you specify a folder and let pytest do the collection, but doesn't work correctly if you overwrite the collection by specifying the complete path.



---

archive/issue_comments_669190.json:
```json
{
    "body": "<a id='comment:34'></a>\nNot the same because there is no existing practice of running pytest on that file.",
    "created_at": "2022-03-31T14:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669190",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Not the same because there is no existing practice of running pytest on that file.



---

archive/issue_comments_669191.json:
```json
{
    "body": "Changing commit from \"[05bc58f97cb8b3a8712f7fb129b40d0446bc35de](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)\" to \"[8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)\"",
    "created_at": "2022-03-31T14:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[05bc58f97cb8b3a8712f7fb129b40d0446bc35de](https://github.com/sagemath/sagetrac-mirror/commit/05bc58f97cb8b3a8712f7fb129b40d0446bc35de)" to "[8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)"



---

archive/issue_comments_669192.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[8825079](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)|`src/doc/en/developer/tools.rst: Update section on pytest`|",
    "created_at": "2022-03-31T14:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[8825079](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)|`src/doc/en/developer/tools.rst: Update section on pytest`|



---

archive/issue_comments_669193.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [mkoeppe](#comment%3A34):\n> Not the same because there is no existing practice of running pytest on that file.\n\n\nThat applies to Cython files as well, or not? We still exclude them in #33560.",
    "created_at": "2022-03-31T14:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669193",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:36'></a>
Replying to [mkoeppe](#comment%3A34):
> Not the same because there is no existing practice of running pytest on that file.


That applies to Cython files as well, or not? We still exclude them in #33560.



---

archive/issue_comments_669194.json:
```json
{
    "body": "<a id='comment:37'></a>\nThere is very much existing practice of running `sage -t` on Cython files.",
    "created_at": "2022-03-31T14:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669194",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
There is very much existing practice of running `sage -t` on Cython files.



---

archive/issue_comments_669195.json:
```json
{
    "body": "<a id='comment:38'></a>\nLet's get this in please",
    "created_at": "2022-04-01T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669195",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Let's get this in please



---

archive/issue_comments_669196.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-01T17:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669196",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_669197.json:
```json
{
    "body": "<a id='comment:39'></a>\nOkay. I still think these folders with `nodoctest` files should be skipped; but that can be done in a follow-up ticket. (The sagebot issues don't seem to be related to this ticket.)",
    "created_at": "2022-04-01T17:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669197",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:39'></a>
Okay. I still think these folders with `nodoctest` files should be skipped; but that can be done in a follow-up ticket. (The sagebot issues don't seem to be related to this ticket.)



---

archive/issue_comments_669198.json:
```json
{
    "body": "<a id='comment:40'></a>\nThanks!",
    "created_at": "2022-04-01T17:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669198",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Thanks!



---

archive/issue_comments_669199.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/sage__pytest](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__pytest)\" to \"[8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)\"",
    "created_at": "2022-04-03T11:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669199",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/mkoeppe/sage__pytest](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage__pytest)" to "[8825079d65f07e9cf13bb3e65197d276a43b9591](https://github.com/sagemath/sagetrac-mirror/commit/8825079d65f07e9cf13bb3e65197d276a43b9591)"



---

archive/issue_events_099411.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-03T11:13:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33572#event-99411"
}
```



---

archive/issue_comments_669200.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-03T11:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33572#issuecomment-669200",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
