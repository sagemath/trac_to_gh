# Issue 33112: some speedups in AdditiveAbelianGroupWrapper.discrete_log()

archive/issues_032875.json:
```json
{
    "body": "Currently, the `.discrete_log()` method for `AdditiveAbelianGroupWrapper`s contains several unnecessary calls to `.order()` for the underlying group elements. In some cases (e.g., elliptic curves over large finite fields), these calls incur significant overhead. We eliminate them and also apply some smaller performance tweaks while we're at it (such as using the exponent instead of the order and `isqrt` instead of `sqrt`).\n\nExample:\n\n```sage\nsage: p = 4*prod(primes(3,117))-1\nsage: E = EllipticCurve(GF(p^2),[1,0])\nsage: A = E.abelian_group()\nsage: %timeit A.discrete_log(E.random_point())\n```\n\nResult before this patch:\n\n```\n22.6 s \u00b1 765 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nResult after this patch:\n\n```\n3.74 s \u00b1 78.2 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\n\nChanges not including the dependency: https://git.sagemath.org/sage.git/diff/?id=c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0&id2=41983ca059b4c5ed6ab6a76b2ca0934a29834079\n\n**CC:**  @videlec\n\n**Branch/Commit:** [b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Lorenz Panny\n\n**Dependencies:** #32384\n\nIssue created by migration from https://trac.sagemath.org/ticket/33112\n\n",
    "closed_at": "2022-03-08T08:12:13Z",
    "created_at": "2022-01-03T08:03:22Z",
    "labels": [
        "component: group theory",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "some speedups in AdditiveAbelianGroupWrapper.discrete_log()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33112",
    "user": "https://github.com/yyyyx4"
}
```
Currently, the `.discrete_log()` method for `AdditiveAbelianGroupWrapper`s contains several unnecessary calls to `.order()` for the underlying group elements. In some cases (e.g., elliptic curves over large finite fields), these calls incur significant overhead. We eliminate them and also apply some smaller performance tweaks while we're at it (such as using the exponent instead of the order and `isqrt` instead of `sqrt`).

Example:

```sage
sage: p = 4*prod(primes(3,117))-1
sage: E = EllipticCurve(GF(p^2),[1,0])
sage: A = E.abelian_group()
sage: %timeit A.discrete_log(E.random_point())
```

Result before this patch:

```
22.6 s ± 765 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

Result after this patch:

```
3.74 s ± 78.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```


Changes not including the dependency: https://git.sagemath.org/sage.git/diff/?id=c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0&id2=41983ca059b4c5ed6ab6a76b2ca0934a29834079

**CC:**  @videlec

**Branch/Commit:** [b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)

**Reviewer:** Travis Scrimshaw

**Author:** Lorenz Panny

**Dependencies:** #32384

Issue created by migration from https://trac.sagemath.org/ticket/33112





---

archive/issue_events_301792.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-03T08:04:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33112#event-301792"
}
```



---

archive/issue_comments_539263.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/294f5bddfa4dcc10973aa30834a7ee0f22ebb043\">294f5bd</a></td><td><code>add missing copyright comment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41983ca059b4c5ed6ab6a76b2ca0934a29834079\">41983ca</a></td><td><code>Merge tag '9.5' into public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/636c927502da12c55f8a09a871673927d990eb2d\">636c927</a></td><td><code>some optimizations in AdditiveAbelianGroupWrapper.discrete_log()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0\">c64156e</a></td><td><code>make type conversions slightly more robust</code></td></tr></table>\n",
    "created_at": "2022-02-08T08:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/294f5bddfa4dcc10973aa30834a7ee0f22ebb043">294f5bd</a></td><td><code>add missing copyright comment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41983ca059b4c5ed6ab6a76b2ca0934a29834079">41983ca</a></td><td><code>Merge tag '9.5' into public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/636c927502da12c55f8a09a871673927d990eb2d">636c927</a></td><td><code>some optimizations in AdditiveAbelianGroupWrapper.discrete_log()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0">c64156e</a></td><td><code>make type conversions slightly more robust</code></td></tr></table>




---

archive/issue_comments_539264.json:
```json
{
    "body": "**Changing commit** from \"[43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c](https://github.com/sagemath/sagetrac-mirror/commit/43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c)\" to \"[c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0](https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0)\".",
    "created_at": "2022-02-08T08:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c](https://github.com/sagemath/sagetrac-mirror/commit/43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c)" to "[c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0](https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0)".



---

archive/issue_comments_539265.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -22,4 +22,4 @@\n ```\n \n \n-Changes not including the dependency: https://git.sagemath.org/sage.git/diff?id2=20d32835c7c3da63316f66d9dcd040f927d3d69d&id=43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c\n+Changes not including the dependency: https://git.sagemath.org/sage.git/diff/?id=c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0&id2=41983ca059b4c5ed6ab6a76b2ca0934a29834079\n``````\n",
    "created_at": "2022-02-08T08:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539265",
    "user": "https://github.com/yyyyx4"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -22,4 +22,4 @@
 ```
 
 
-Changes not including the dependency: https://git.sagemath.org/sage.git/diff?id2=20d32835c7c3da63316f66d9dcd040f927d3d69d&id=43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c
+Changes not including the dependency: https://git.sagemath.org/sage.git/diff/?id=c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0&id2=41983ca059b4c5ed6ab6a76b2ca0934a29834079
``````




---

archive/issue_comments_539266.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think the list comprehension is faster (in python) than using `map` with a `lambda` function.\n\nI would make `_discrete_log_pgroup` into its own function rather than a `@staticmethod`. This can make it easier if you decide you want to Cythonize it too.",
    "created_at": "2022-02-15T06:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539266",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
I think the list comprehension is faster (in python) than using `map` with a `lambda` function.

I would make `_discrete_log_pgroup` into its own function rather than a `@staticmethod`. This can make it easier if you decide you want to Cythonize it too.



---

archive/issue_comments_539267.json:
```json
{
    "body": "**Changing commit** from \"[c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0](https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0)\" to \"[b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)\".",
    "created_at": "2022-02-15T08:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0](https://github.com/sagemath/sagetrac-mirror/commit/c64156e2cfd95a1b7f5b9b431dad4b80ff757ac0)" to "[b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)".



---

archive/issue_comments_539268.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10ac2e85a83e42810a047813f1faade6b5b6069d\">10ac2e8</a></td><td><code>Merge tag '9.6.beta1' into public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7\">b8f4127</a></td><td><code>use list comprehension instead of lambda; move _discrete_log_pgroup outside class</code></td></tr></table>\n",
    "created_at": "2022-02-15T08:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10ac2e85a83e42810a047813f1faade6b5b6069d">10ac2e8</a></td><td><code>Merge tag '9.6.beta1' into public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7">b8f4127</a></td><td><code>use list comprehension instead of lambda; move _discrete_log_pgroup outside class</code></td></tr></table>




---

archive/issue_comments_539269.json:
```json
{
    "body": "<a id='comment:6'></a>\nThank you, done.",
    "created_at": "2022-02-15T08:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539269",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:6'></a>
Thank you, done.



---

archive/issue_comments_539270.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2022-02-27T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539270",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_301793.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-02-27T00:51:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33112#event-301793"
}
```



---

archive/issue_events_301794.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-02-27T00:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33112#event-301794"
}
```



---

archive/issue_comments_539271.json:
```json
{
    "body": "<a id='comment:7'></a>\nThank you. LGTM.",
    "created_at": "2022-02-27T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539271",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Thank you. LGTM.



---

archive/issue_events_301795.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-08T08:12:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33112#event-301795"
}
```



---

archive/issue_events_301796.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-08T08:12:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33112#event-301796"
}
```



---

archive/issue_comments_539272.json:
```json
{
    "body": "**Changing branch** from \"[public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups](https://github.com/sagemath/sagetrac-mirror/tree/public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups)\" to \"[b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)\".",
    "created_at": "2022-03-08T08:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33112#issuecomment-539272",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups](https://github.com/sagemath/sagetrac-mirror/tree/public/some_AdditiveAbelianGroupWrapper_discrete_log_speedups)" to "[b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7](https://github.com/sagemath/sagetrac-mirror/commit/b8f4127228cca2dd74c7bde5e092f6ed51a8d9c7)".
