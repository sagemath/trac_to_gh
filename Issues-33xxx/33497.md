# Issue 33497: variety() for polynomial systems over ℚ using msolve

archive/issues_033497.json:
```json
{
    "body": "Add the option of using the external package [msolve](https://msolve.lip6.fr/) for computing the variety of a polynomial system. Only systems over\u00a0\u211a are supported at the moment, because I cannot make sense of msolve's output in the positive characteristic case.\n\nNote that this ticket does not add msolve as a dependency\u2014see #31664 for that.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33734\n\n",
    "closed_at": "2022-05-22T16:32:23Z",
    "created_at": "2022-04-20T08:36:32Z",
    "labels": [
        "component: commutative algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "variety() for polynomial systems over \u211a using msolve",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33497",
    "user": "https://github.com/mezzarobba"
}
```
Add the option of using the external package [msolve](https://msolve.lip6.fr/) for computing the variety of a polynomial system. Only systems over ℚ are supported at the moment, because I cannot make sense of msolve's output in the positive characteristic case.

Note that this ticket does not add msolve as a dependency—see #31664 for that.


Issue created by migration from https://trac.sagemath.org/ticket/33734





---

archive/issue_comments_476303.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-20T08:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476303",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_476304.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-20T08:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476304",
    "user": "https://github.com/mezzarobba"
}
```

New commits:



---

archive/issue_comments_476305.json:
```json
{
    "body": "8 lines of triangLfak part uses 2 space identation, 4 spaces are preferred",
    "created_at": "2022-04-20T09:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476305",
    "user": "https://github.com/sheerluck"
}
```

8 lines of triangLfak part uses 2 space identation, 4 spaces are preferred



---

archive/issue_comments_476306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-20T09:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_476307.json:
```json
{
    "body": "Replying to [comment:2 gh-sheerluck]:\n> 8 lines of triangLfak part uses 2 space identation, 4 spaces are preferred\n\n\nOops, rebasing mistake (I guess). Thanks!",
    "created_at": "2022-04-20T09:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476307",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:2 gh-sheerluck]:
> 8 lines of triangLfak part uses 2 space identation, 4 spaces are preferred


Oops, rebasing mistake (I guess). Thanks!



---

archive/issue_comments_476308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-20T09:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_476309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-20T09:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_476310.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-20T10:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476310",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_476311.json:
```json
{
    "body": "I think it is preferable to add within this ticket a file `sage/features/msolve.py` which would check the presence (and functionality) of `msolve`. You can check other similar files in `sage/features` which are based on a single command available in PATH. For instance, check at `sage/features/pdf2svg.py` which also has a `spkg=` since such a dummy sage package exists, but this is not mandatory, see for instance `sage/features/dvipng.py` which I think you can essentially copy paste.\n\nIf you want, you may also add a `is_functional` method. See `sage/features/latex.py` and `sage/features/lrs.py` for such examples. The `is_functional` method is not to be used from outside: it is automatically called by `is_present()` and by `require()`, see #33114.\n\nThe following lines\n\n```\n+    except FileNotFoundError:\n+        raise RuntimeError(\n+            \"could not find the msolve binary. Please install msolve \"\n+            \"(https://msolve.lip6.fr/) and try again.\")\n```\nwill get replaced by\n\n```\nfrom sage.features.msolve import msolve\nmsolve.require()\n```\nbefore you use the `msolve` command.\n\nAlso, this will automatically select the optional tag `msolve` when doctesting the new added file (provided you define the `all_features()` function at the end of the file `sage/features/msolve.py`).",
    "created_at": "2022-04-20T10:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476311",
    "user": "https://github.com/seblabbe"
}
```

I think it is preferable to add within this ticket a file `sage/features/msolve.py` which would check the presence (and functionality) of `msolve`. You can check other similar files in `sage/features` which are based on a single command available in PATH. For instance, check at `sage/features/pdf2svg.py` which also has a `spkg=` since such a dummy sage package exists, but this is not mandatory, see for instance `sage/features/dvipng.py` which I think you can essentially copy paste.

If you want, you may also add a `is_functional` method. See `sage/features/latex.py` and `sage/features/lrs.py` for such examples. The `is_functional` method is not to be used from outside: it is automatically called by `is_present()` and by `require()`, see #33114.

The following lines

```
+    except FileNotFoundError:
+        raise RuntimeError(
+            "could not find the msolve binary. Please install msolve "
+            "(https://msolve.lip6.fr/) and try again.")
```
will get replaced by

```
from sage.features.msolve import msolve
msolve.require()
```
before you use the `msolve` command.

Also, this will automatically select the optional tag `msolve` when doctesting the new added file (provided you define the `all_features()` function at the end of the file `sage/features/msolve.py`).



---

archive/issue_comments_476312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-20T11:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_476313.json:
```json
{
    "body": "Replying to [comment:7 slabbe]:\n> I think it is preferable to add within this ticket a file `sage/features/msolve.py` which would check the presence (and functionality) of `msolve`.\n\n\nMakes sense; thanks for the pointers!",
    "created_at": "2022-04-20T11:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476313",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:7 slabbe]:
> I think it is preferable to add within this ticket a file `sage/features/msolve.py` which would check the presence (and functionality) of `msolve`.


Makes sense; thanks for the pointers!



---

archive/issue_comments_476314.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-20T11:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476314",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_476315.json:
```json
{
    "body": "Few comments on the code:\n\n1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.\n\n```\n+import os\n+import tempfile\n+import subprocess\n+\n+import sage.structure.proof.proof\n+\n+from sage.features.msolve import msolve\n+from sage.misc.all import SAGE_TMP\n+from sage.misc.converting_dict import KeyConvertingDict\n+from sage.misc.sage_eval import sage_eval\n+from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing\n+from sage.rings.rational_field import QQ\n+from sage.rings.real_arb import RealBallField\n+from sage.rings.real_double import RealDoubleField_class\n+from sage.rings.real_mpfr import RealField_class\n+from sage.rings.real_mpfi import RealIntervalField_class, RealIntervalField\n```\n\nMaybe few could be moved into where they are needed, for instance `sage_eval`, `SAGE_TMP` and `KeyConvertingDict`. Also `RealDoubleField_class`, `RealField_class` and `RealIntervalField_class`.\n\nI would maybe move `import subprocess` into the method also in the `sage/features/msolve.py`.\n\n2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:\n\n```\n+    try:\n+        print(\",\".join(drlpolring.variable_names()), file=msolve_in)\n+        print(base.characteristic(), file=msolve_in)\n+        print(*(pol._repr_().replace(\" \", \"\") for pol in polys),\n+                sep=',\\n', file=msolve_in)\n+        msolve_in.close()\n+        msolve_out = subprocess.run(command, capture_output=True)\n+    finally:\n+        os.unlink(msolve_in.name)\n```\n\n3. You write `.decode('ascii')` here:\n\n```\ndata = sage_eval(msolve_out.stdout[:-2].decode('ascii'))\n```\n\nMaybe instead, you can use the option `text=True` in the call to `subprocess.run`?\n\n4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?",
    "created_at": "2022-04-20T12:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476315",
    "user": "https://github.com/seblabbe"
}
```

Few comments on the code:

1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.

```
+import os
+import tempfile
+import subprocess
+
+import sage.structure.proof.proof
+
+from sage.features.msolve import msolve
+from sage.misc.all import SAGE_TMP
+from sage.misc.converting_dict import KeyConvertingDict
+from sage.misc.sage_eval import sage_eval
+from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing
+from sage.rings.rational_field import QQ
+from sage.rings.real_arb import RealBallField
+from sage.rings.real_double import RealDoubleField_class
+from sage.rings.real_mpfr import RealField_class
+from sage.rings.real_mpfi import RealIntervalField_class, RealIntervalField
```

Maybe few could be moved into where they are needed, for instance `sage_eval`, `SAGE_TMP` and `KeyConvertingDict`. Also `RealDoubleField_class`, `RealField_class` and `RealIntervalField_class`.

I would maybe move `import subprocess` into the method also in the `sage/features/msolve.py`.

2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:

```
+    try:
+        print(",".join(drlpolring.variable_names()), file=msolve_in)
+        print(base.characteristic(), file=msolve_in)
+        print(*(pol._repr_().replace(" ", "") for pol in polys),
+                sep=',\n', file=msolve_in)
+        msolve_in.close()
+        msolve_out = subprocess.run(command, capture_output=True)
+    finally:
+        os.unlink(msolve_in.name)
```

3. You write `.decode('ascii')` here:

```
data = sage_eval(msolve_out.stdout[:-2].decode('ascii'))
```

Maybe instead, you can use the option `text=True` in the call to `subprocess.run`?

4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?



---

archive/issue_comments_476316.json:
```json
{
    "body": "Thanks for your comments.\n\nReplying to [comment:10 slabbe]:\n> 1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.\n\n\nI understand why you may want to do that with the huge source files with functions using widely different tools that we often have in Sage. But what would be the benefit for this module where there is a single function, and other functions we might want to add are likely to need more or less the same imports?\n\n> 2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:\n\n\nIsn't that the standard way of cleaning up after an operation that may raise an error or be interrupted?\n\n> 3. You write `.decode('ascii')` here:\n> \n> \n> ```\n> data = sage_eval(msolve_out.stdout[:-2].decode('ascii'))\n> ```\n> \n> Maybe instead, you can use the option `text=True` in the call to `subprocess.run`?\n\n\nMaybe. As far as I understand msolve will always feed us pure ascii text with unix newlines, so `decode('ascii')` felt more natural to me, but I'm fine with changing it if there is a reason to do so.\n\n> 4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?\n\n\nI am not sure I understand the question. I suppose I could write\n\n```\n    with tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',\n                                     encoding='ascii') as msolve_in:\n        command = [\"msolve\", \"-f\", msolve_in.name]\n        if isinstance(ring, (RealIntervalField_class, RealBallField,\n                            RealField_class, RealDoubleField_class)):\n            parameterization = False\n            command += [\"-p\", str(ring.precision())]\n        else:\n            parameterization = True\n            command += [\"-P\", \"1\"]\n        print(\",\".join(drlpolring.variable_names()), file=msolve_in)\n        print(base.characteristic(), file=msolve_in)\n        print(*(pol._repr_().replace(\" \", \"\") for pol in polys),\n                sep=',\\n', file=msolve_in, flush=True)\n        msolve_out = subprocess.run(command, capture_output=True)\n```\nbut (1)\u00a0I find that closing the file is clearer than putting a `flush()` in the right place, and (2)\u00a0I need msolve to be able to open the file, which, according to the Python docs, is not allowed on all platforms if Sage keeps it open. So I create the tempfile with `delete=False`, and hence I am responsible for deleting it.",
    "created_at": "2022-04-20T13:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476316",
    "user": "https://github.com/mezzarobba"
}
```

Thanks for your comments.

Replying to [comment:10 slabbe]:
> 1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.


I understand why you may want to do that with the huge source files with functions using widely different tools that we often have in Sage. But what would be the benefit for this module where there is a single function, and other functions we might want to add are likely to need more or less the same imports?

> 2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:


Isn't that the standard way of cleaning up after an operation that may raise an error or be interrupted?

> 3. You write `.decode('ascii')` here:
> 
> 
> ```
> data = sage_eval(msolve_out.stdout[:-2].decode('ascii'))
> ```
> 
> Maybe instead, you can use the option `text=True` in the call to `subprocess.run`?


Maybe. As far as I understand msolve will always feed us pure ascii text with unix newlines, so `decode('ascii')` felt more natural to me, but I'm fine with changing it if there is a reason to do so.

> 4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?


I am not sure I understand the question. I suppose I could write

```
    with tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',
                                     encoding='ascii') as msolve_in:
        command = ["msolve", "-f", msolve_in.name]
        if isinstance(ring, (RealIntervalField_class, RealBallField,
                            RealField_class, RealDoubleField_class)):
            parameterization = False
            command += ["-p", str(ring.precision())]
        else:
            parameterization = True
            command += ["-P", "1"]
        print(",".join(drlpolring.variable_names()), file=msolve_in)
        print(base.characteristic(), file=msolve_in)
        print(*(pol._repr_().replace(" ", "") for pol in polys),
                sep=',\n', file=msolve_in, flush=True)
        msolve_out = subprocess.run(command, capture_output=True)
```
but (1) I find that closing the file is clearer than putting a `flush()` in the right place, and (2) I need msolve to be able to open the file, which, according to the Python docs, is not allowed on all platforms if Sage keeps it open. So I create the tempfile with `delete=False`, and hence I am responsible for deleting it.



---

archive/issue_comments_476317.json:
```json
{
    "body": "Thanks for your answers. I reply below.\n\nReplying to [comment:11 mmezzarobba]:\n> Thanks for your comments.\n> \n> Replying to [comment:10 slabbe]:\n> > 1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.\n  \n> \n> I understand why you may want to do that with the huge source files with functions using widely different tools that we often have in Sage. But what would be the benefit for this module where there is a single function, and other functions we might want to add are likely to need more or less the same imports?\n\n\nBy experience, sometimes the import in the module creates dependencies just for importing the module which breaks a package which would work (except some parts) if those imports were local imports. But this is when developping an external package. In Sage, this will be fixed anyway. But, I don't know, in my case, I try keep this habit. But, it is true it might not be a sage convention.\n\nAnother reason which might be less pointless is to avoid to cluter the tab completion with lots of technical stuff when we do `from sage.rings.polynomial.msolve import [TAB]`.\n\n> \n> > 2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:\n  \n> \n> Isn't that the standard way of cleaning up after an operation that may raise an error or be interrupted?\n\n\nOups, you are right. I am learning something here. The `print(2)` is executed here before the exception is raised:\n\n```\nsage: try:\n....:     raise Exception\n....: finally:\n....:     print(2)\n....:     \n2\nTraceback (most recent call last):\n...\nException: \n```\n\nWhereas below it is not:\n\n```\nsage: raise Exception; print(2)\nTraceback (most recent call last):\n...\nException: \n```\n\nSo, I now see the point of the `try` with no `except`.\n\n> \n> > 3. You write `.decode('ascii')` here:\n> > \n> > \n> > ```\n> > data = sage_eval(msolve_out.stdout[:-2].decode('ascii'))\n> > ```\n> > \n> > Maybe instead, you can use the option `text=True` in the call to `subprocess.run`?\n\n> \n> Maybe. As far as I understand msolve will always feed us pure ascii text with unix newlines, so `decode('ascii')` felt more natural to me, but I'm fine with changing it if there is a reason to do so.\n\n\nWell, I think you write `.decode('ascii')` because it returns the stdout as binary. I am just saying that if you write `text=True` in the `run` command, the stdout will already be translated into ascii. So you will not need to translate the binary stdout to to ascii.\n\n> \n> > 4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?\n  \n> \n> I am not sure I understand the question. I suppose I could write\n> \n> ```\n>     with tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',\n>                                      encoding='ascii') as msolve_in:\n>         command = [\"msolve\", \"-f\", msolve_in.name]\n>         if isinstance(ring, (RealIntervalField_class, RealBallField,\n>                             RealField_class, RealDoubleField_class)):\n>             parameterization = False\n>             command += [\"-p\", str(ring.precision())]\n>         else:\n>             parameterization = True\n>             command += [\"-P\", \"1\"]\n>         print(\",\".join(drlpolring.variable_names()), file=msolve_in)\n>         print(base.characteristic(), file=msolve_in)\n>         print(*(pol._repr_().replace(\" \", \"\") for pol in polys),\n>                 sep=',\\n', file=msolve_in, flush=True)\n>         msolve_out = subprocess.run(command, capture_output=True)\n> ```\n> but (1)\u00a0I find that closing the file is clearer than putting a `flush()` in the right place, and (2)\u00a0I need msolve to be able to open the file, which, according to the Python docs, is not allowed on all platforms if Sage keeps it open. So I create the tempfile with `delete=False`, and hence I am responsible for deleting it.\n\n\nOk I see.",
    "created_at": "2022-04-21T10:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476317",
    "user": "https://github.com/seblabbe"
}
```

Thanks for your answers. I reply below.

Replying to [comment:11 mmezzarobba]:
> Thanks for your comments.
> 
> Replying to [comment:10 slabbe]:
> > 1. Are you sure you need all the following imports in the header of the file? I try to keep in the header only the imports that are needed more than once in the file.
  
> 
> I understand why you may want to do that with the huge source files with functions using widely different tools that we often have in Sage. But what would be the benefit for this module where there is a single function, and other functions we might want to add are likely to need more or less the same imports?


By experience, sometimes the import in the module creates dependencies just for importing the module which breaks a package which would work (except some parts) if those imports were local imports. But this is when developping an external package. In Sage, this will be fixed anyway. But, I don't know, in my case, I try keep this habit. But, it is true it might not be a sage convention.

Another reason which might be less pointless is to avoid to cluter the tab completion with lots of technical stuff when we do `from sage.rings.polynomial.msolve import [TAB]`.

> 
> > 2. Now that the `except` clause is gone. It is weird to have a `try` with no `except`:
  
> 
> Isn't that the standard way of cleaning up after an operation that may raise an error or be interrupted?


Oups, you are right. I am learning something here. The `print(2)` is executed here before the exception is raised:

```
sage: try:
....:     raise Exception
....: finally:
....:     print(2)
....:     
2
Traceback (most recent call last):
...
Exception: 
```

Whereas below it is not:

```
sage: raise Exception; print(2)
Traceback (most recent call last):
...
Exception: 
```

So, I now see the point of the `try` with no `except`.

> 
> > 3. You write `.decode('ascii')` here:
> > 
> > 
> > ```
> > data = sage_eval(msolve_out.stdout[:-2].decode('ascii'))
> > ```
> > 
> > Maybe instead, you can use the option `text=True` in the call to `subprocess.run`?

> 
> Maybe. As far as I understand msolve will always feed us pure ascii text with unix newlines, so `decode('ascii')` felt more natural to me, but I'm fine with changing it if there is a reason to do so.


Well, I think you write `.decode('ascii')` because it returns the stdout as binary. I am just saying that if you write `text=True` in the `run` command, the stdout will already be translated into ascii. So you will not need to translate the binary stdout to to ascii.

> 
> > 4. Why is the line `os.unlink(msolve_in.name)` needed even after closing the file?
  
> 
> I am not sure I understand the question. I suppose I could write
> 
> ```
>     with tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',
>                                      encoding='ascii') as msolve_in:
>         command = ["msolve", "-f", msolve_in.name]
>         if isinstance(ring, (RealIntervalField_class, RealBallField,
>                             RealField_class, RealDoubleField_class)):
>             parameterization = False
>             command += ["-p", str(ring.precision())]
>         else:
>             parameterization = True
>             command += ["-P", "1"]
>         print(",".join(drlpolring.variable_names()), file=msolve_in)
>         print(base.characteristic(), file=msolve_in)
>         print(*(pol._repr_().replace(" ", "") for pol in polys),
>                 sep=',\n', file=msolve_in, flush=True)
>         msolve_out = subprocess.run(command, capture_output=True)
> ```
> but (1) I find that closing the file is clearer than putting a `flush()` in the right place, and (2) I need msolve to be able to open the file, which, according to the Python docs, is not allowed on all platforms if Sage keeps it open. So I create the tempfile with `delete=False`, and hence I am responsible for deleting it.


Ok I see.



---

archive/issue_comments_476318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-21T15:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_476319.json:
```json
{
    "body": "Replying to [comment:12 slabbe]:\n\n> By experience, sometimes the import in the module creates dependencies just for importing the module which breaks a package which would work (except some parts) if those imports were local imports.\n\n\nSure, but again, this does not apply here. I agree however that it makes sense not to `import msolve` at the top of `polynomial_ideal` but only when someone calls a function with `algorithm=\"msolve\"` (and that's what my code is doing).\n\n> Well, I think you write `.decode('ascii')` because it returns the stdout as binary. I am just saying that if you write `text=True` in the `run` command, the stdout will already be translated into ascii. So you will not need to translate the binary stdout to to ascii.\n\n\nI still don't see the point, but I don't think it can hurt either, so fine, let's use `text=True`.",
    "created_at": "2022-04-21T15:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476319",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:12 slabbe]:

> By experience, sometimes the import in the module creates dependencies just for importing the module which breaks a package which would work (except some parts) if those imports were local imports.


Sure, but again, this does not apply here. I agree however that it makes sense not to `import msolve` at the top of `polynomial_ideal` but only when someone calls a function with `algorithm="msolve"` (and that's what my code is doing).

> Well, I think you write `.decode('ascii')` because it returns the stdout as binary. I am just saying that if you write `text=True` in the `run` command, the stdout will already be translated into ascii. So you will not need to translate the binary stdout to to ascii.


I still don't see the point, but I don't think it can hurt either, so fine, let's use `text=True`.



---

archive/issue_comments_476320.json:
```json
{
    "body": "upsteam promises a docs update next week",
    "created_at": "2022-04-25T09:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476320",
    "user": "https://github.com/dimpase"
}
```

upsteam promises a docs update next week



---

archive/issue_comments_476321.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> upsteam promises a docs update next week \n\n\nI assume you are taking about the comment I left about the positive characteristic case? If yes, that's indeed what Mohab replied after I reported the issue, but it does not impact this ticket.\n\n(What does impact it a little is that, even in characteristic zero, the descriptions in the msolve tutorial and in `msolve --help` do not exactly match the output actually produced by the program, so I had to guess some details.)",
    "created_at": "2022-04-25T09:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476321",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:15 dimpase]:
> upsteam promises a docs update next week 


I assume you are taking about the comment I left about the positive characteristic case? If yes, that's indeed what Mohab replied after I reported the issue, but it does not impact this ticket.

(What does impact it a little is that, even in characteristic zero, the descriptions in the msolve tutorial and in `msolve --help` do not exactly match the output actually produced by the program, so I had to guess some details.)



---

archive/issue_comments_476322.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-25T10:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476322",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_476323.json:
```json
{
    "body": "lgtm\n\n(yes, I meant positive char msolve docs)",
    "created_at": "2022-04-25T10:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476323",
    "user": "https://github.com/dimpase"
}
```

lgtm

(yes, I meant positive char msolve docs)



---

archive/issue_comments_476324.json:
```json
{
    "body": "thanks!",
    "created_at": "2022-04-25T11:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476324",
    "user": "https://github.com/mezzarobba"
}
```

thanks!



---

archive/issue_comments_476325.json:
```json
{
    "body": "pyflakes plugin is not happy",
    "created_at": "2022-04-25T11:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476325",
    "user": "https://github.com/fchapoton"
}
```

pyflakes plugin is not happy



---

archive/issue_comments_476326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2022-04-25T12:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_476327.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-04-25T12:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_476328.json:
```json
{
    "body": "Replying to [comment:19 chapoton]:\n> pyflakes plugin is not happy\n\n\nfixed, thanks",
    "created_at": "2022-04-25T12:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476328",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:19 chapoton]:
> pyflakes plugin is not happy


fixed, thanks



---

archive/issue_comments_476329.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-25T20:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476329",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088657.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-07T18:42:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33497#event-88657"
}
```



---

archive/issue_events_088658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-22T16:32:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33497#event-88658"
}
```



---

archive/issue_comments_476330.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-22T16:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33497#issuecomment-476330",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
