# Issue 33789: sage-dist-helpers (sdh_pip_install): Change default to --build-isolation

archive/issues_033552.json:
```json
{
    "body": "... hence, provisioning the build environment for each package from the stored wheels. \n\nThis gets us another step closer to using modern Python packaging infrastructure. It will make the build process more robust because it avoids concurrent read and write access to `site-packages`.\n\nIf it fails, it falls back the old behavior (`--no-build-isolation`) and issues a warning.\n\n\n**CC:**  @jhpalmieri\n\n**Branch/Commit:** [378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)\n\n**Reviewer:** John Palmieri\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/33789\n\n",
    "closed_at": "2022-07-09T22:33:41Z",
    "created_at": "2022-05-03T02:14:42Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "sage-dist-helpers (sdh_pip_install): Change default to --build-isolation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33789",
    "user": "https://github.com/mkoeppe"
}
```
... hence, provisioning the build environment for each package from the stored wheels. 

This gets us another step closer to using modern Python packaging infrastructure. It will make the build process more robust because it avoids concurrent read and write access to `site-packages`.

If it fails, it falls back the old behavior (`--no-build-isolation`) and issues a warning.


**CC:**  @jhpalmieri

**Branch/Commit:** [378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)

**Reviewer:** John Palmieri

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/33789





---

archive/issue_comments_643832.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation)",
    "created_at": "2022-05-03T04:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643832",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation)



---

archive/issue_comments_643833.json:
```json
{
    "body": "**Commit:** [f6ba52680baa98f6829a971c07bd55a1a2b7b65f](https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f)",
    "created_at": "2022-06-29T01:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [f6ba52680baa98f6829a971c07bd55a1a2b7b65f](https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f)



---

archive/issue_comments_643834.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/738ab26f7dabb29f61f869e7e27ac7dc4f4531b1\">738ab26</a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Change default to --build-isolation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79c6002fddd63f8a238e416b650b80725b625017\">79c6002</a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Fall back to --no-build-isolation on error</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f\">f6ba526</a></td><td><code>build/pkgs/tomli/spkg-install.in: Build it with --no-build-isolation</code></td></tr></table>\n",
    "created_at": "2022-06-29T01:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/738ab26f7dabb29f61f869e7e27ac7dc4f4531b1">738ab26</a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Change default to --build-isolation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79c6002fddd63f8a238e416b650b80725b625017">79c6002</a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Fall back to --no-build-isolation on error</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f">f6ba526</a></td><td><code>build/pkgs/tomli/spkg-install.in: Build it with --no-build-isolation</code></td></tr></table>




---

archive/issue_comments_643835.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n ... hence, provisioning the build environment for each package from the stored wheels. \n \n-Fallback will be to `--no-build-isolation --no-deps`.\n+This gets us another step closer to using modern Python packaging infrastructure. It will make the build process more robust because it avoids concurrent read and write access to `site-packages`.\n \n+If it fails, it falls back the old behavior (`--no-build-isolation`) and issues a warning.\n+\n``````\n",
    "created_at": "2022-06-29T01:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643835",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 ... hence, provisioning the build environment for each package from the stored wheels. 
 
-Fallback will be to `--no-build-isolation --no-deps`.
+This gets us another step closer to using modern Python packaging infrastructure. It will make the build process more robust because it avoids concurrent read and write access to `site-packages`.
 
+If it fails, it falls back the old behavior (`--no-build-isolation`) and issues a warning.
+
``````




---

archive/issue_comments_643836.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-06-29T01:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643836",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_643837.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2022-06-29T01:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643837",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_643838.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhy does `tomli` require `no-build-isolation`? Also, a comment like \"Our new default\" is going to become dated. Maybe \"The default as of Sage 9.7\" instead?",
    "created_at": "2022-07-06T17:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643838",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Why does `tomli` require `no-build-isolation`? Also, a comment like "Our new default" is going to become dated. Maybe "The default as of Sage 9.7" instead?



---

archive/issue_comments_643839.json:
```json
{
    "body": "**Changing commit** from \"[f6ba52680baa98f6829a971c07bd55a1a2b7b65f](https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f)\" to \"[caaef55763f8537f82bf531057ea41561d12bcce](https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce)\".",
    "created_at": "2022-07-06T17:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f6ba52680baa98f6829a971c07bd55a1a2b7b65f](https://github.com/sagemath/sagetrac-mirror/commit/f6ba52680baa98f6829a971c07bd55a1a2b7b65f)" to "[caaef55763f8537f82bf531057ea41561d12bcce](https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce)".



---

archive/issue_comments_643840.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce\">caaef55</a></td><td><code>build/pkgs/tomli/spkg-install.in: Expand comments on build dependencies / isolation</code></td></tr></table>\n",
    "created_at": "2022-07-06T17:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce">caaef55</a></td><td><code>build/pkgs/tomli/spkg-install.in: Expand comments on build dependencies / isolation</code></td></tr></table>




---

archive/issue_comments_643841.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8\">378d704</a></td><td><code>build/bin/sage-dist-helpers: In a comment, be more specific about what 'new' is</code></td></tr></table>\n",
    "created_at": "2022-07-06T17:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8">378d704</a></td><td><code>build/bin/sage-dist-helpers: In a comment, be more specific about what 'new' is</code></td></tr></table>




---

archive/issue_comments_643842.json:
```json
{
    "body": "**Changing commit** from \"[caaef55763f8537f82bf531057ea41561d12bcce](https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce)\" to \"[378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)\".",
    "created_at": "2022-07-06T17:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[caaef55763f8537f82bf531057ea41561d12bcce](https://github.com/sagemath/sagetrac-mirror/commit/caaef55763f8537f82bf531057ea41561d12bcce)" to "[378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)".



---

archive/issue_comments_643843.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2022-07-08T04:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643843",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_643844.json:
```json
{
    "body": "<a id='comment:8'></a>\nTo clarify, build with isolation is the default in `pip`, right? So it makes sense for us to switch to this, except in cases where necessary. If that's correct, feel free to set to \"positive review\" on my behalf.\n\n(Sage builds, including lots of optional packages, with this branch.)",
    "created_at": "2022-07-08T04:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643844",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
To clarify, build with isolation is the default in `pip`, right? So it makes sense for us to switch to this, except in cases where necessary. If that's correct, feel free to set to "positive review" on my behalf.

(Sage builds, including lots of optional packages, with this branch.)



---

archive/issue_comments_643845.json:
```json
{
    "body": "<a id='comment:9'></a>\nYes, it's the default in pip.",
    "created_at": "2022-07-08T04:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643845",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Yes, it's the default in pip.



---

archive/issue_comments_643846.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks!",
    "created_at": "2022-07-08T04:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643846",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Thanks!



---

archive/issue_comments_643847.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2022-07-08T04:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643847",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_099597.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:33:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33789#event-99597"
}
```



---

archive/issue_comments_643848.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation)\" to \"[378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)\".",
    "created_at": "2022-07-09T22:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33789#issuecomment-643848",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_dist_helpers__sdh_pip_install___change_default_to___build_isolation)" to "[378d704ec64ba94161117e0f4a1437d3249080d8](https://github.com/sagemath/sagetrac-mirror/commit/378d704ec64ba94161117e0f4a1437d3249080d8)".
