# Issue 33627: Remove sage-gdb-commands from src/bin

archive/issues_033390.json:
```json
{
    "body": "(from #33625)\n\nCritical because this file is not compatible with editable installs (`setup.py develop`), see #31049\n\n\nCC:  @tornaria @jhpalmieri @kiwifb @dimpase\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nBranch: d24b928c9710baab95281d2a26bc071366a6b72b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33627\n\n",
    "closed_at": "2022-08-01T20:23:18Z",
    "created_at": "2022-04-02T05:51:50Z",
    "labels": [
        "component: scripts",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Remove sage-gdb-commands from src/bin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33627",
    "user": "https://github.com/mkoeppe"
}
```
(from #33625)

Critical because this file is not compatible with editable installs (`setup.py develop`), see #31049


CC:  @tornaria @jhpalmieri @kiwifb @dimpase

Reviewer: John Palmieri

Author: Matthias Koeppe

Branch: d24b928c9710baab95281d2a26bc071366a6b72b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33627





---

archive/issue_events_088452.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33627#event-88452"
}
```



---

archive/issue_comments_474818.json:
```json
{
    "body": "Changing priority from minor to critical.",
    "created_at": "2022-07-22T22:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474818",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from minor to critical.



---

archive/issue_comments_474819.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-22T23:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474819",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474820.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2022-07-22T23:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474820",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_474821.json:
```json
{
    "body": "<a id='comment:6'></a>Would `sage-gdb-commands` not be in a better location in `ext_data`? It is not a function that is specific to doctests. That's my only reaction so far to that change, but I wouldn't push for the move too strongly if you tell me that it is too hard.",
    "created_at": "2022-07-23T01:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474821",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Would `sage-gdb-commands` not be in a better location in `ext_data`? It is not a function that is specific to doctests. That's my only reaction so far to that change, but I wouldn't push for the move too strongly if you tell me that it is too hard.



---

archive/issue_comments_474822.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 fbissey]:\n> Would `sage-gdb-commands` not be in a better location in `ext_data`? It is not a function that is specific to doctests. \n\n\nThe purpose of this file is not documented, and it is only used there",
    "created_at": "2022-07-23T01:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474822",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Replying to [comment:6 fbissey]:
> Would `sage-gdb-commands` not be in a better location in `ext_data`? It is not a function that is specific to doctests. 


The purpose of this file is not documented, and it is only used there



---

archive/issue_comments_474823.json:
```json
{
    "body": "<a id='comment:8'></a>I just looked at the content of the file for the first time in some years. \n\n```\nr\n```\nmay be we can just get rid of it if it is the only place it is used. And that's what the gdb manual has to say about what it does https://sourceware.org/gdb/current/onlinedocs/gdb/Starting.html#Starting",
    "created_at": "2022-07-23T01:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474823",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>I just looked at the content of the file for the first time in some years. 

```
r
```
may be we can just get rid of it if it is the only place it is used. And that's what the gdb manual has to say about what it does https://sourceware.org/gdb/current/onlinedocs/gdb/Starting.html#Starting



---

archive/issue_comments_474824.json:
```json
{
    "body": "<a id='comment:9'></a>In any case, `ext_data` is an outdated design and I'd rather not add to it.",
    "created_at": "2022-07-23T01:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474824",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>In any case, `ext_data` is an outdated design and I'd rather not add to it.



---

archive/issue_comments_474825.json:
```json
{
    "body": "<a id='comment:10'></a>Fran\u00e7ois asks a good question about the purpose of this file. Could we instead just have a variable `SAGE_GDB_COMMANDS` defined as `'r'` in `doctest/control.py`? Having a file which contains a single character seems a little ridiculous.",
    "created_at": "2022-07-23T03:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474825",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>Fran√ßois asks a good question about the purpose of this file. Could we instead just have a variable `SAGE_GDB_COMMANDS` defined as `'r'` in `doctest/control.py`? Having a file which contains a single character seems a little ridiculous.



---

archive/issue_comments_474826.json:
```json
{
    "body": "<a id='comment:11'></a>The name of the file is passed to `gdb`, it's a list of commands to execute upon starting. Of course we could also generate this file as a temporary file, but I don't think that's a cleaner design",
    "created_at": "2022-07-23T03:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474826",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>The name of the file is passed to `gdb`, it's a list of commands to execute upon starting. Of course we could also generate this file as a temporary file, but I don't think that's a cleaner design



---

archive/issue_comments_474827.json:
```json
{
    "body": "<a id='comment:12'></a>Yes, it is all coming back to me now. I guess it is meant to be clever. In any case it is the design we have to deal with and if it is only used from the `dosctest` folder, then yes it should live there.",
    "created_at": "2022-07-23T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474827",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>Yes, it is all coming back to me now. I guess it is meant to be clever. In any case it is the design we have to deal with and if it is only used from the `dosctest` folder, then yes it should live there.



---

archive/issue_comments_474828.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-23T04:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474828",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_474829.json:
```json
{
    "body": "<a id='comment:13'></a>Actually the file is also used in `src/bin/sage`. I missed it because it's written as `\"${SELF}-gdb-commands\"`",
    "created_at": "2022-07-23T04:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474829",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Actually the file is also used in `src/bin/sage`. I missed it because it's written as `"${SELF}-gdb-commands"`



---

archive/issue_comments_474830.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T06:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474831.json:
```json
{
    "body": "<a id='comment:15'></a>With recent gdb versions we can just use this option instead and get rid of the command file altogether\n\n```\n  --eval-command=COMMAND, -ex\n\t\t     Execute a single GDB command.\n```",
    "created_at": "2022-07-23T07:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474831",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>With recent gdb versions we can just use this option instead and get rid of the command file altogether

```
  --eval-command=COMMAND, -ex
		     Execute a single GDB command.
```



---

archive/issue_comments_474832.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T07:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474833.json:
```json
{
    "body": "<a id='comment:18'></a>The code handling `./sage --gdb` in `src/bin/sage` has clearly not been tried in a long time. The `SAGE_DEBUG` logic is broken because this environment variable is only set in the build environment, not in `sage -sh`",
    "created_at": "2022-07-23T07:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474833",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>The code handling `./sage --gdb` in `src/bin/sage` has clearly not been tried in a long time. The `SAGE_DEBUG` logic is broken because this environment variable is only set in the build environment, not in `sage -sh`



---

archive/issue_comments_474834.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T07:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474835.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-23T07:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474835",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_474836.json:
```json
{
    "body": "<a id='comment:22'></a>What's the advantage to explicitly including `python` (a.k.a. `sys.executable`) in\n\n```\nexec gdb --eval-command=\"run\" --args ...python... sage-runtests --serial --timeout=0 hello_world.py\n```",
    "created_at": "2022-07-23T18:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474836",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>What's the advantage to explicitly including `python` (a.k.a. `sys.executable`) in

```
exec gdb --eval-command="run" --args ...python... sage-runtests --serial --timeout=0 hello_world.py
```



---

archive/issue_comments_474837.json:
```json
{
    "body": "<a id='comment:23'></a>Without this change it wasn't working for me at all (on macOS): I got\n\n```\n\"/Users/mkoeppe/s/sage/sage-rebasing/src/bin/sage-runtests\": not in executable format: file format not recognized\n```",
    "created_at": "2022-07-23T18:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Without this change it wasn't working for me at all (on macOS): I got

```
"/Users/mkoeppe/s/sage/sage-rebasing/src/bin/sage-runtests": not in executable format: file format not recognized
```



---

archive/issue_comments_474838.json:
```json
{
    "body": "<a id='comment:24'></a>I can't get it to work on OS X either way. The SPKG doesn't build for me (\"C compiler cannot create executables\" because \"ld: library not found for -ltinfo\"). If I run `brew install gdb`, then I get complaints about things not being codesigned. Anyway, with this branch things fail a bit better than with `develop`, and the changes make sense to me. Comments from anyone else?",
    "created_at": "2022-07-23T19:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474838",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>I can't get it to work on OS X either way. The SPKG doesn't build for me ("C compiler cannot create executables" because "ld: library not found for -ltinfo"). If I run `brew install gdb`, then I get complaints about things not being codesigned. Anyway, with this branch things fail a bit better than with `develop`, and the changes make sense to me. Comments from anyone else?



---

archive/issue_comments_474839.json:
```json
{
    "body": "<a id='comment:25'></a>Yes, the `gdb` SPKG is too old (see #30158). I have also not done the codesigning dance with the homebrew gdb this time to try out whether it really works on macOS",
    "created_at": "2022-07-23T20:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474839",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Yes, the `gdb` SPKG is too old (see #30158). I have also not done the codesigning dance with the homebrew gdb this time to try out whether it really works on macOS



---

archive/issue_comments_474840.json:
```json
{
    "body": "<a id='comment:26'></a>isn't gdb pretty much useless with macOS clang, and one should use lldb instead?",
    "created_at": "2022-07-24T10:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474840",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>isn't gdb pretty much useless with macOS clang, and one should use lldb instead?



---

archive/issue_comments_474841.json:
```json
{
    "body": "<a id='comment:27'></a>Hence #31568",
    "created_at": "2022-07-24T16:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474841",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Hence #31568



---

archive/issue_comments_474842.json:
```json
{
    "body": "<a id='comment:28'></a>Let's merge this.",
    "created_at": "2022-07-25T05:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474842",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>Let's merge this.



---

archive/issue_comments_474843.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-25T05:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474843",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474844.json:
```json
{
    "body": "<a id='comment:29'></a>Thanks!",
    "created_at": "2022-07-25T05:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474844",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Thanks!



---

archive/issue_comments_474845.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474845",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088453.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-01T20:23:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33627#event-88453"
}
```



---

archive/issue_comments_474846.json:
```json
{
    "body": "<a id='comment:31'></a>By the way, we missed an example in `developer/doctesting.rst` that mentions `sage-gdb-commands`. See #34295 for a follow-up.",
    "created_at": "2022-08-06T21:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33627#issuecomment-474846",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>By the way, we missed an example in `developer/doctesting.rst` that mentions `sage-gdb-commands`. See #34295 for a follow-up.
