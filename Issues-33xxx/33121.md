# Issue 33121: PARI/GP for elliptic curve discrete logarithms (elllog) and Weil pairings (ellweilpairing)

archive/issues_032884.json:
```json
{
    "assignees": [],
    "body": "PARI/GP implements discrete logarithm on elliptic curves\n\n```\nsage: F = GF(3^6,'a')\nsage: a = F.gen()\nsage: E = EllipticCurve([0,1,1,a,a])\nsage: A = E.abelian_group()\nsage: P = A.gen(0).element()\nsage: from sage.libs.pari import pari\nsage: pari.elllog(E, 400*P, P)\n400\n```\nThis should be benchmarked against the native sage implementation `P.discrete_log(400*P)`. If relevant, PARI/GP should be an alternative in the function `discrete_log`.\n\nThis might apply to other functions as well, see [PARI/GP elliptic curve reference card](http://pari.math.u-bordeaux.fr/pub/pari/manuals/2.13.3/refcard-ell.pdf).\n\nCC:  @yyyyx4\n\nComponent: **elliptic curves**\n\nAuthor: **Lorenz Panny**\n\nBranch/Commit: **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**\n\nReviewer: **Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33121_\n\n",
    "closed_at": "2022-02-13T10:17:27Z",
    "created_at": "2022-01-05T15:56:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "PARI/GP for elliptic curve discrete logarithms (elllog) and Weil pairings (ellweilpairing)",
    "type": "issue",
    "updated_at": "2022-02-13T10:17:27Z",
    "url": "https://github.com/sagemath/sage/issues/33121",
    "user": "https://github.com/videlec"
}
```
PARI/GP implements discrete logarithm on elliptic curves

```
sage: F = GF(3^6,'a')
sage: a = F.gen()
sage: E = EllipticCurve([0,1,1,a,a])
sage: A = E.abelian_group()
sage: P = A.gen(0).element()
sage: from sage.libs.pari import pari
sage: pari.elllog(E, 400*P, P)
400
```
This should be benchmarked against the native sage implementation `P.discrete_log(400*P)`. If relevant, PARI/GP should be an alternative in the function `discrete_log`.

This might apply to other functions as well, see [PARI/GP elliptic curve reference card](http://pari.math.u-bordeaux.fr/pub/pari/manuals/2.13.3/refcard-ell.pdf).

CC:  @yyyyx4

Component: **elliptic curves**

Author: **Lorenz Panny**

Branch/Commit: **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**

Reviewer: **Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/33121_





---

archive/issue_events_452427.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-05T15:56:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452427"
}
```



---

archive/issue_events_452428.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-05T15:56:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452428"
}
```



---

archive/issue_events_452429.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-05T15:56:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452429"
}
```



---

archive/issue_events_452430.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-05T15:56:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452430"
}
```



---

archive/issue_comments_535059.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nGood idea!\n\nAnother example from recent experience: PARI computes (some?) pairings about 10 times faster than Sage.",
    "created_at": "2022-01-06T07:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535059",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:1" align="right">comment:1</div>

Good idea!

Another example from recent experience: PARI computes (some?) pairings about 10 times faster than Sage.



---

archive/issue_comments_535060.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nDiscrete log also seems to be faster with PARI/GP (x3 on this example)\n\n```\nsage: Q = 400*P\nsage: %timeit -n 100 pari.elllog(E, Q, P)\n762 \u00b5s \u00b1 83.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit -n 100 P.discrete_log(Q)\n2.13 ms \u00b1 73.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```",
    "created_at": "2022-01-06T08:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535060",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2" align="right">comment:2</div>

Discrete log also seems to be faster with PARI/GP (x3 on this example)

```
sage: Q = 400*P
sage: %timeit -n 100 pari.elllog(E, Q, P)
762 µs ± 83.5 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit -n 100 P.discrete_log(Q)
2.13 ms ± 73.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```



---

archive/issue_comments_535061.json:
```json
{
    "body": "Commit: **[`208b2c0`](https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18)**",
    "created_at": "2022-01-10T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535061",
    "user": "https://github.com/yyyyx4"
}
```

Commit: **[`208b2c0`](https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18)**



---

archive/issue_comments_535062.json:
```json
{
    "body": "Author: **Lorenz Panny**",
    "created_at": "2022-01-10T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535062",
    "user": "https://github.com/yyyyx4"
}
```

Author: **Lorenz Panny**



---

archive/issue_comments_535063.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAlright, here's a branch. Its primary goal was to call `elllog` in `.discrete_log()`, but there's a little complication: PARI doesn't actually guarantee that `elllog` terminates when `Q` is not a multiple of `P`.\nHence, I added a Weil pairing check to ensure this before calling into PARI, and changed `.weil_pairing()` to use PARI as well. (The old implementation remains accessible via an optional `algorithm=` argument.)\n\nBenchmarks with pairings in fields up to 128 bits and ECDLPs up to 40 bits indicate that the new code is about 15 times faster on average for those sizes (in both cases). The biggest speedups observed in my tests were about 25\u00d7 for pairings and about 100\u00d7 for ECDLPs. Minor slowdowns were only observed for really tiny instances, presumably due to the added conversions between PARI and Sage. We could add a case distinction there, but frankly, I think it doesn't matter.\n\nExample:\n\n```\nsage: E = EllipticCurve(GF(986328349423), [49984317488,114040674816])\nsage: P = E.random_point(); Q = 123451234512345*P\nsage: %timeit P.discrete_log(Q)\n```\n9.5.rc0:\n\n```\n53.9 s \u00b1 1.26 s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\nThis branch:\n\n```\n2.14 s \u00b1 8.5 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nWhile benchmarking, I also noticed that scalar multiplications in Sage are significantly (5\u00d7?) slower than PARI's `ellmul`, but changing that is a little more intricate, hence left for future work. I also refrained from touching `.tate_pairing()` for now.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18\"><code>208b2c0</code></a></td><td><code>elliptic-curve points: use PARI for .discrete_log() and .weil_pairing()</code></td></tr></table>\n",
    "created_at": "2022-01-10T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535063",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:3" align="right">comment:3</div>

Alright, here's a branch. Its primary goal was to call `elllog` in `.discrete_log()`, but there's a little complication: PARI doesn't actually guarantee that `elllog` terminates when `Q` is not a multiple of `P`.
Hence, I added a Weil pairing check to ensure this before calling into PARI, and changed `.weil_pairing()` to use PARI as well. (The old implementation remains accessible via an optional `algorithm=` argument.)

Benchmarks with pairings in fields up to 128 bits and ECDLPs up to 40 bits indicate that the new code is about 15 times faster on average for those sizes (in both cases). The biggest speedups observed in my tests were about 25× for pairings and about 100× for ECDLPs. Minor slowdowns were only observed for really tiny instances, presumably due to the added conversions between PARI and Sage. We could add a case distinction there, but frankly, I think it doesn't matter.

Example:

```
sage: E = EllipticCurve(GF(986328349423), [49984317488,114040674816])
sage: P = E.random_point(); Q = 123451234512345*P
sage: %timeit P.discrete_log(Q)
```
9.5.rc0:

```
53.9 s ± 1.26 s per loop (mean ± std. dev. of 7 runs, 1 loop each)
```
This branch:

```
2.14 s ± 8.5 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

While benchmarking, I also noticed that scalar multiplications in Sage are significantly (5×?) slower than PARI's `ellmul`, but changing that is a little more intricate, hence left for future work. I also refrained from touching `.tate_pairing()` for now.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18"><code>208b2c0</code></a></td><td><code>elliptic-curve points: use PARI for .discrete_log() and .weil_pairing()</code></td></tr></table>




---

archive/issue_events_452431.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-10T11:22:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "title_is": "PARI/GP for elliptic curve discrete logarithms (elllog) and Weil pairings (ellweilpairing)",
    "title_was": "PARI/GP for elliptic curves discrete logarithm (elllog)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452431"
}
```



---

archive/issue_comments_535064.json:
```json
{
    "body": "Branch: **[public/use_pari_elllog_and_ellweilpairing](https://github.com/sagemath/sagetrac-mirror/tree/public/use_pari_elllog_and_ellweilpairing)**",
    "created_at": "2022-01-10T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535064",
    "user": "https://github.com/yyyyx4"
}
```

Branch: **[public/use_pari_elllog_and_ellweilpairing](https://github.com/sagemath/sagetrac-mirror/tree/public/use_pari_elllog_and_ellweilpairing)**



---

archive/issue_events_452432.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-10T11:22:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452432"
}
```



---

archive/issue_comments_535065.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNice.\n\nReplying to [@yyyyx4](#comment%3A3):\n> [...] but there's a little complication: PARI doesn't actually guarantee that\n> `elllog` terminates when `Q` is not a multiple of `P`. [...]\n\nWhere did you read that ? At [ellog documentation](https://pari.math.u-bordeaux.fr/dochtml/html/Elliptic_curves.html#se:elllog) they say to have a look at [znlog documentation](https://pari.math.u-bordeaux.fr/dochtml/html/Arithmetic_functions.html#se:znlog). And there it only says that the result is *undefined* (here I would translate as: *algorithm terminates but got garbage*) if `Q` is not a multiple of `P`. I thought it would be sufficient to check whether `Q = nP` at the end of the procedure.",
    "created_at": "2022-01-10T11:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535065",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

Nice.

Replying to [@yyyyx4](#comment%3A3):
> [...] but there's a little complication: PARI doesn't actually guarantee that
> `elllog` terminates when `Q` is not a multiple of `P`. [...]

Where did you read that ? At [ellog documentation](https://pari.math.u-bordeaux.fr/dochtml/html/Elliptic_curves.html#se:elllog) they say to have a look at [znlog documentation](https://pari.math.u-bordeaux.fr/dochtml/html/Arithmetic_functions.html#se:znlog). And there it only says that the result is *undefined* (here I would translate as: *algorithm terminates but got garbage*) if `Q` is not a multiple of `P`. I thought it would be sufficient to check whether `Q = nP` at the end of the procedure.



---

archive/issue_comments_535066.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn the `znlog()` documentation, near the bottom, it says:\n\n    In addition, Pollard rho is not able to handle the case where there are no solutions: it will enter an infinite loop.\n\nHowever, the documentation also says that rho is only used for \"large\" sizes, so it seems like we could skip the check for the smaller instances if it's a problem. Overall, the cost of the pairing is negligible anyway (Miller's algorithm is `O(log(n))` base field operations, ECDLP is worst-case `O(sqrt(n))`).",
    "created_at": "2022-01-10T11:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535066",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:5" align="right">comment:5</div>

In the `znlog()` documentation, near the bottom, it says:

    In addition, Pollard rho is not able to handle the case where there are no solutions: it will enter an infinite loop.

However, the documentation also says that rho is only used for "large" sizes, so it seems like we could skip the check for the smaller instances if it's a problem. Overall, the cost of the pairing is negligible anyway (Miller's algorithm is `O(log(n))` base field operations, ECDLP is worst-case `O(sqrt(n))`).



---

archive/issue_comments_535067.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDoes the Weil pairing guarantees colinearity or the fact that Q is a multiple of P ? (not very familiar with EC myself)",
    "created_at": "2022-01-10T12:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535067",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Does the Weil pairing guarantees colinearity or the fact that Q is a multiple of P ? (not very familiar with EC myself)



---

archive/issue_comments_535068.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nMore precisely, there could be a denominator issue. The two following questions are different : \n`Q` in `ZZ P` versus `Q` in `K P` (where `K` is the ground field).",
    "created_at": "2022-01-10T12:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535068",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

More precisely, there could be a denominator issue. The two following questions are different : 
`Q` in `ZZ P` versus `Q` in `K P` (where `K` is the ground field).



---

archive/issue_comments_535069.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYou are right that \"`Q in \u211a\u00b7P`\" can be an issue, but in this case it isn't.\n\nModulo a bunch of identifications, the Weil pairing is \"just\" the determinant pairing: Our points live in a group isomorphic to `G = (\u2124/n \u00d7 \u2124/n, +)`, and the pairing is given by\n  `G \u00d7 G \u2192 k;\u2003((a,b),(c,d)) \u21a6 z^(ad-bc)`\nwhere `z` is a fixed primitive `n`th root of unity in the base field `k` of the curve.\n\nThus, the pairing is `1` if and only if `ad-bc \u2261 0 (mod n)`. The input vector `(a,b) \u2208 \u2124/n \u00d7 \u2124/n` corresponding to the point `P \u2208 E` has full order `n` by construction (this is exactly how `n` was chosen), hence `gcd(a,b,n) = 1`. By B\u00e9zout we can find `u,v\u00a0\u2208\u00a0\u2124` such that `au + bv \u2261 1 (mod n)`. Letting `\u03bb = cu + dv` and using `ad \u2261 bc`, we then get `\u03bb\u00b7(a,b) \u2261 (c,d)` as desired.\n\nIf we drop the assumption that one of the inputs has full order, we can indeed easily construct counterexamples: `n=6`,\u00a0`(a,b)=(2,0)`,\u00a0`(c,d)=(0,3)`.",
    "created_at": "2022-01-11T03:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535069",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:8" align="right">comment:8</div>

You are right that "`Q in ℚ·P`" can be an issue, but in this case it isn't.

Modulo a bunch of identifications, the Weil pairing is "just" the determinant pairing: Our points live in a group isomorphic to `G = (ℤ/n × ℤ/n, +)`, and the pairing is given by
  `G × G → k; ((a,b),(c,d)) ↦ z^(ad-bc)`
where `z` is a fixed primitive `n`th root of unity in the base field `k` of the curve.

Thus, the pairing is `1` if and only if `ad-bc ≡ 0 (mod n)`. The input vector `(a,b) ∈ ℤ/n × ℤ/n` corresponding to the point `P ∈ E` has full order `n` by construction (this is exactly how `n` was chosen), hence `gcd(a,b,n) = 1`. By Bézout we can find `u,v ∈ ℤ` such that `au + bv ≡ 1 (mod n)`. Letting `λ = cu + dv` and using `ad ≡ bc`, we then get `λ·(a,b) ≡ (c,d)` as desired.

If we drop the assumption that one of the inputs has full order, we can indeed easily construct counterexamples: `n=6`, `(a,b)=(2,0)`, `(c,d)=(0,3)`.



---

archive/issue_comments_535070.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@yyyyx4](#comment%3A3):\n> While benchmarking, I also noticed that scalar multiplications in Sage are significantly (5\u00d7?) slower than PARI's `ellmul`, but changing that is a little more intricate, hence left for future work.\n\nThis is now #33147.",
    "created_at": "2022-01-11T05:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535070",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@yyyyx4](#comment%3A3):
> While benchmarking, I also noticed that scalar multiplications in Sage are significantly (5×?) slower than PARI's `ellmul`, but changing that is a little more intricate, hence left for future work.

This is now #33147.



---

archive/issue_events_452433.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-11T11:37:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452433"
}
```



---

archive/issue_events_452434.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-11T11:37:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452434"
}
```



---

archive/issue_comments_535071.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2022-01-11T11:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535071",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_events_452435.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-11T11:37:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452435"
}
```



---

archive/issue_events_452436.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-11T11:37:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452436"
}
```



---

archive/issue_comments_535072.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n\n```\nsage -t --long --warn-long 55.6 --random-seed=123 src/sage/schemes/elliptic_curves/ell_point.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/ell_point.py\", line 1577, in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing\nFailed example:\n    P.weil_pairing(Q,5)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing[20]>\", line 1, in <module>\n        P.weil_pairing(Q,Integer(5))  # long time\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_point.py\", line 1626, in weil_pairing\n        return E.base_field()(pari.ellweilpairing(E, P, Q, n))\n      File \"cypari2/auto_instance.pxi\", line 10515, in cypari2.pari_instance.Pari_auto.ellweilpairing\n      File \"cypari2/handle_error.pyx\", line 213, in cypari2.handle_error._pari_err_handle\n    cypari2.handle_error.PariError: incorrect type in checkell over Fq (t_VEC)\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/ell_point.py\", line 1579, in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing\nFailed example:\n    Q.weil_pairing(P,5)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing[21]>\", line 1, in <module>\n        Q.weil_pairing(P,Integer(5))  # long time\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_point.py\", line 1626, in weil_pairing\n        return E.base_field()(pari.ellweilpairing(E, P, Q, n))\n      File \"cypari2/auto_instance.pxi\", line 10515, in cypari2.pari_instance.Pari_auto.ellweilpairing\n      File \"cypari2/handle_error.pyx\", line 213, in cypari2.handle_error._pari_err_handle\n    cypari2.handle_error.PariError: incorrect type in checkell over Fq (t_VEC)\n**********************************************************************\n1 item had failures:\n   2 of  29 in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing\n    [809 tests, 2 failures, 5.56 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 55.6 --random-seed=123 src/sage/schemes/elliptic_curves/ell_point.py  # 2 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2022-01-30T10:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535072",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>


```
sage -t --long --warn-long 55.6 --random-seed=123 src/sage/schemes/elliptic_curves/ell_point.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/ell_point.py", line 1577, in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing
Failed example:
    P.weil_pairing(Q,5)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing[20]>", line 1, in <module>
        P.weil_pairing(Q,Integer(5))  # long time
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_point.py", line 1626, in weil_pairing
        return E.base_field()(pari.ellweilpairing(E, P, Q, n))
      File "cypari2/auto_instance.pxi", line 10515, in cypari2.pari_instance.Pari_auto.ellweilpairing
      File "cypari2/handle_error.pyx", line 213, in cypari2.handle_error._pari_err_handle
    cypari2.handle_error.PariError: incorrect type in checkell over Fq (t_VEC)
**********************************************************************
File "src/sage/schemes/elliptic_curves/ell_point.py", line 1579, in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing
Failed example:
    Q.weil_pairing(P,5)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing[21]>", line 1, in <module>
        Q.weil_pairing(P,Integer(5))  # long time
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_point.py", line 1626, in weil_pairing
        return E.base_field()(pari.ellweilpairing(E, P, Q, n))
      File "cypari2/auto_instance.pxi", line 10515, in cypari2.pari_instance.Pari_auto.ellweilpairing
      File "cypari2/handle_error.pyx", line 213, in cypari2.handle_error._pari_err_handle
    cypari2.handle_error.PariError: incorrect type in checkell over Fq (t_VEC)
**********************************************************************
1 item had failures:
   2 of  29 in sage.schemes.elliptic_curves.ell_point.EllipticCurvePoint_field.weil_pairing
    [809 tests, 2 failures, 5.56 s]
----------------------------------------------------------------------
sage -t --long --warn-long 55.6 --random-seed=123 src/sage/schemes/elliptic_curves/ell_point.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_events_452437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T10:02:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452437"
}
```



---

archive/issue_events_452438.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T10:02:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452438"
}
```



---

archive/issue_comments_535073.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/232983237e7788f9ec512b9634cff1c2538d8821\"><code>2329832</code></a></td><td><code>PARI's ellweilpairing() only works over finite fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2\"><code>c79b74a</code></a></td><td><code>test is not really \"long time\" anymore, finishes in < 500ms</code></td></tr></table>\n",
    "created_at": "2022-01-30T11:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535073",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/232983237e7788f9ec512b9634cff1c2538d8821"><code>2329832</code></a></td><td><code>PARI's ellweilpairing() only works over finite fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2"><code>c79b74a</code></a></td><td><code>test is not really "long time" anymore, finishes in < 500ms</code></td></tr></table>




---

archive/issue_comments_535074.json:
```json
{
    "body": "Changed commit from **[`208b2c0`](https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18)** to **[`c79b74a`](https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2)**",
    "created_at": "2022-01-30T11:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535074",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`208b2c0`](https://github.com/sagemath/sagetrac-mirror/commit/208b2c073beb5669478e94f2581e61560f145c18)** to **[`c79b74a`](https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2)**



---

archive/issue_comments_535075.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThanks, good catch. PARI doesn't seem to like pairings over infinite fields.",
    "created_at": "2022-01-30T11:54:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535075",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:13" align="right">comment:13</div>

Thanks, good catch. PARI doesn't seem to like pairings over infinite fields.



---

archive/issue_events_452439.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-30T11:54:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452439"
}
```



---

archive/issue_events_452440.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-30T11:54:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452440"
}
```



---

archive/issue_comments_535076.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAccording to the patchbot (and sage documentation) `Returns` should be `Return` in the docstring of `discrete_log`.",
    "created_at": "2022-01-31T08:06:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535076",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

According to the patchbot (and sage documentation) `Returns` should be `Return` in the docstring of `discrete_log`.



---

archive/issue_events_452441.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-31T08:06:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452441"
}
```



---

archive/issue_events_452442.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-31T08:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452442"
}
```



---

archive/issue_comments_535077.json:
```json
{
    "body": "Changed commit from **[`c79b74a`](https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2)** to **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**",
    "created_at": "2022-01-31T09:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535077",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c79b74a`](https://github.com/sagemath/sagetrac-mirror/commit/c79b74a34ef9b3c48431421efc5f1b872c3f44c2)** to **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**



---

archive/issue_comments_535078.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57737cb0781131d561a59ceb161fb1e9af9d1253\"><code>57737cb</code></a></td><td><code>Merge tag '9.5' into public/use_pari_elllog_and_ellweilpairing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c\"><code>c7626f6</code></a></td><td><code>Returns -> Return</code></td></tr></table>\n",
    "created_at": "2022-01-31T09:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535078",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57737cb0781131d561a59ceb161fb1e9af9d1253"><code>57737cb</code></a></td><td><code>Merge tag '9.5' into public/use_pari_elllog_and_ellweilpairing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c"><code>c7626f6</code></a></td><td><code>Returns -> Return</code></td></tr></table>




---

archive/issue_events_452443.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-31T09:51:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452443"
}
```



---

archive/issue_events_452444.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-31T09:51:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452444"
}
```



---

archive/issue_events_452445.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-31T15:57:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452445"
}
```



---

archive/issue_events_452446.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-01-31T15:57:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452446"
}
```



---

archive/issue_events_452447.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-13T10:17:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452447"
}
```



---

archive/issue_events_452448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e85707f043216c4b99731492f6b5152603b3b1a5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-02-13T10:17:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33121#event-452448"
}
```



---

archive/issue_comments_535079.json:
```json
{
    "body": "Changed branch from **[public/use_pari_elllog_and_ellweilpairing](https://github.com/sagemath/sagetrac-mirror/tree/public/use_pari_elllog_and_ellweilpairing)** to **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**",
    "created_at": "2022-02-13T10:17:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33121#issuecomment-535079",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/use_pari_elllog_and_ellweilpairing](https://github.com/sagemath/sagetrac-mirror/tree/public/use_pari_elllog_and_ellweilpairing)** to **[`c7626f6`](https://github.com/sagemath/sagetrac-mirror/commit/c7626f6d209c4161c2c0abb05364cf4d9ba68c6c)**
