# Issue 33833: Make furo sage standard doc theme

archive/issues_033596.json:
```json
{
    "body": "In #33601, the furo theme has been introduced for the documentation. The aim of this ticket is to make it the standard theme. Before it happens, the remaining issues need to be fixed:\n\n- Index page in double columns look awful -- fixed in #34265\n- sage logo in the side bar should link to the top of the Sage manuals - fixed in #34252\n- no link to the doc root - fixed in #34267\n- search page not working - fixed in #34252\n- \"ERROR: Adding a table of contents in Furo-based documentation is unnecessary\" - https://73e5aa3fbbec2d751a47064c14479fc0d55c3de9--sagemath-tobias.netlify.app/installation/source.html#installation-in-a-multiuser-environment - fixed in #34262\n\nTo support this ticket, the standard Furo package was accepted by the voting done in\n\n- https://groups.google.com/g/sage-devel/c/VTU_I-ecPlA\n\nalong with subsidiary votings in \n\n- https://groups.google.com/g/sage-devel/c/eRh16v5Mz0c\n- https://groups.google.com/g/sage-devel/c/rhPECxe128o\n\nOther possible improvements:\n\n- Install sphinx-hoverxref, sphinx-notfound-page (see setuptools documentation, which also uses furo - https://setuptools.pypa.io/en/latest/history.html#documentation-changes)\n\n\nCC:  @kwankyu @strogdon @haraldschilly @mkoeppe\n\nBranch/Commit: 1f03957f94720eb1e6649fe1f004f3a03f4068ef\n\nReviewer: Matthias Koeppe, Kwankyu Lee\n\nAuthor: Kwankyu Lee, Matthias Koeppe\n\nDependencies: #34252, #34262, #34265, #34267, #34450\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33833\n\n",
    "closed_at": "2022-09-07T23:10:35Z",
    "created_at": "2022-05-10T18:32:45Z",
    "labels": [
        "component: documentation",
        "blocker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Make furo sage standard doc theme",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33833",
    "user": "https://github.com/tobiasdiez"
}
```
In #33601, the furo theme has been introduced for the documentation. The aim of this ticket is to make it the standard theme. Before it happens, the remaining issues need to be fixed:

- Index page in double columns look awful -- fixed in #34265
- sage logo in the side bar should link to the top of the Sage manuals - fixed in #34252
- no link to the doc root - fixed in #34267
- search page not working - fixed in #34252
- "ERROR: Adding a table of contents in Furo-based documentation is unnecessary" - https://73e5aa3fbbec2d751a47064c14479fc0d55c3de9--sagemath-tobias.netlify.app/installation/source.html#installation-in-a-multiuser-environment - fixed in #34262

To support this ticket, the standard Furo package was accepted by the voting done in

- https://groups.google.com/g/sage-devel/c/VTU_I-ecPlA

along with subsidiary votings in 

- https://groups.google.com/g/sage-devel/c/eRh16v5Mz0c
- https://groups.google.com/g/sage-devel/c/rhPECxe128o

Other possible improvements:

- Install sphinx-hoverxref, sphinx-notfound-page (see setuptools documentation, which also uses furo - https://setuptools.pypa.io/en/latest/history.html#documentation-changes)


CC:  @kwankyu @strogdon @haraldschilly @mkoeppe

Branch/Commit: 1f03957f94720eb1e6649fe1f004f3a03f4068ef

Reviewer: Matthias Koeppe, Kwankyu Lee

Author: Kwankyu Lee, Matthias Koeppe

Dependencies: #34252, #34262, #34265, #34267, #34450

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33833





---

archive/issue_comments_477577.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T07:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477578.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-01T07:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477578",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477579.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-08-01T07:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477579",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_477580.json:
```json
{
    "body": "<a id='comment:13'></a>It looks like that after these refinements, the new theme may be ready to become standard. How about a sage-devel vote?",
    "created_at": "2022-08-03T16:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477580",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>It looks like that after these refinements, the new theme may be ready to become standard. How about a sage-devel vote?



---

archive/issue_comments_477581.json:
```json
{
    "body": "<a id='comment:16'></a>I don't see this a problem:\n\n- Reference manual index page and many sub-pagaes don't have a table of contents on the left \u200bhttps://516dfe85b21eafae4f042320e5dcf61ad14fe780--sagemath-tobias.netlify.app/reference/ \u200b\n\nand removed it.\n\n---\nLast 10 new commits:",
    "created_at": "2022-08-03T19:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477581",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:16'></a>I don't see this a problem:

- Reference manual index page and many sub-pagaes don't have a table of contents on the left ​https://516dfe85b21eafae4f042320e5dcf61ad14fe780--sagemath-tobias.netlify.app/reference/ ​

and removed it.

---
Last 10 new commits:



---

archive/issue_comments_477582.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 klee]:\n> I don't see this a problem:\n> \n> - Reference manual index page and many sub-pagaes don't have a table of contents on the left \u200bhttps://516dfe85b21eafae4f042320e5dcf61ad14fe780--sagemath-tobias.netlify.app/reference/ \u200b\n> \n> and removed it.\n\n\nI agree",
    "created_at": "2022-08-03T19:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477582",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Replying to [comment:16 klee]:
> I don't see this a problem:
> 
> - Reference manual index page and many sub-pagaes don't have a table of contents on the left ​https://516dfe85b21eafae4f042320e5dcf61ad14fe780--sagemath-tobias.netlify.app/reference/ ​
> 
> and removed it.


I agree



---

archive/issue_comments_477583.json:
```json
{
    "body": "<a id='comment:19'></a>Also `build/pkgs/furo/type` should be changed to `standard`",
    "created_at": "2022-08-03T19:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477583",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Also `build/pkgs/furo/type` should be changed to `standard`



---

archive/issue_comments_477584.json:
```json
{
    "body": "<a id='comment:20'></a>And added to configure.ac's handling of the `--disable-doc` option",
    "created_at": "2022-08-03T19:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477584",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>And added to configure.ac's handling of the `--disable-doc` option



---

archive/issue_comments_477585.json:
```json
{
    "body": "<a id='comment:21'></a>Why there is  `elliptic curves` in the dependencies?  \n\n```\n... sage_docbuild elliptic_curves furo\n```",
    "created_at": "2022-08-03T19:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477585",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:21'></a>Why there is  `elliptic curves` in the dependencies?  

```
... sage_docbuild elliptic_curves furo
```



---

archive/issue_comments_477586.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 mkoeppe]:\n> And added to configure.ac's handling of the `--disable-doc` option\n\n\nYou mean this?\n\n```diff\ndiff --git a/build/pkgs/furo/type b/build/pkgs/furo/type\nindex 134d9bc32d..a6a7b9cd72 100644\n--- a/build/pkgs/furo/type\n+++ b/build/pkgs/furo/type\n@@ -1 +1 @@\n-optional\n+standard\ndiff --git a/configure.ac b/configure.ac\nindex 4ab080c611..225ffe43d0 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -489,7 +489,7 @@ AC_ARG_ENABLE([doc],\n   AS_HELP_STRING([--disable-doc],\n                  [disable build of the Sage documentation and packages depending on it]), [\n     dnl Disable packages needed for docbuilding\n-    for pkg in sage_docbuild alabaster babel snowballstemmer imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport jupyter_sphinx; do\n+    for pkg in sage_docbuild alabaster babel snowballstemmer imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport jupyter_sphinx furo; do\n       AS_VAR_SET([SAGE_ENABLE_$pkg], [$enableval])\n     done\n     AS_VAR_IF([enableval], [no], [dnl Disable the docbuild by disabling the install tree for documentation\n```",
    "created_at": "2022-08-03T19:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477586",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:22'></a>Replying to [comment:20 mkoeppe]:
> And added to configure.ac's handling of the `--disable-doc` option


You mean this?

```diff
diff --git a/build/pkgs/furo/type b/build/pkgs/furo/type
index 134d9bc32d..a6a7b9cd72 100644
--- a/build/pkgs/furo/type
+++ b/build/pkgs/furo/type
@@ -1 +1 @@
-optional
+standard
diff --git a/configure.ac b/configure.ac
index 4ab080c611..225ffe43d0 100644
--- a/configure.ac
+++ b/configure.ac
@@ -489,7 +489,7 @@ AC_ARG_ENABLE([doc],
   AS_HELP_STRING([--disable-doc],
                  [disable build of the Sage documentation and packages depending on it]), [
     dnl Disable packages needed for docbuilding
-    for pkg in sage_docbuild alabaster babel snowballstemmer imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport jupyter_sphinx; do
+    for pkg in sage_docbuild alabaster babel snowballstemmer imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport jupyter_sphinx furo; do
       AS_VAR_SET([SAGE_ENABLE_$pkg], [$enableval])
     done
     AS_VAR_IF([enableval], [no], [dnl Disable the docbuild by disabling the install tree for documentation
```



---

archive/issue_comments_477587.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-03T19:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477588.json:
```json
{
    "body": "<a id='comment:25'></a>Yes, this",
    "created_at": "2022-08-03T19:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477588",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Yes, this



---

archive/issue_comments_477589.json:
```json
{
    "body": "<a id='comment:26'></a>Setting needs review for testing. May need more work.",
    "created_at": "2022-08-03T19:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477589",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:26'></a>Setting needs review for testing. May need more work.



---

archive/issue_comments_477590.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-08-03T19:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477590",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_477591.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:21 klee]:\n> Why there is  `elliptic curves` in the dependencies?  \n> \n> ```\n> ... sage_docbuild elliptic_curves furo\n> ```\n\nIt was added in #33421",
    "created_at": "2022-08-03T19:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477591",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:21 klee]:
> Why there is  `elliptic curves` in the dependencies?  
> 
> ```
> ... sage_docbuild elliptic_curves furo
> ```

It was added in #33421



---

archive/issue_comments_477592.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 mkoeppe]:\n> Replying to [comment:21 klee]:\n> > Why there is  `elliptic curves` in the dependencies?  \n> > \n> > ```\n> > ... sage_docbuild elliptic_curves furo\n> > ```\n\n> It was added in #33421\n\nI see. Thanks.",
    "created_at": "2022-08-03T19:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477592",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:28'></a>Replying to [comment:27 mkoeppe]:
> Replying to [comment:21 klee]:
> > Why there is  `elliptic curves` in the dependencies?  
> > 
> > ```
> > ... sage_docbuild elliptic_curves furo
> > ```

> It was added in #33421

I see. Thanks.



---

archive/issue_comments_477593.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:13 mkoeppe]:\n> It looks like that after these refinements, the new theme may be ready to become standard. How about a sage-devel vote?\n\n\nI agree. I will propose it after testing.",
    "created_at": "2022-08-03T19:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477593",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:29'></a>Replying to [comment:13 mkoeppe]:
> It looks like that after these refinements, the new theme may be ready to become standard. How about a sage-devel vote?


I agree. I will propose it after testing.



---

archive/issue_comments_477594.json:
```json
{
    "body": "<a id='comment:30'></a>https://2505ea042169d8a179d4b1f28a0c0baeabdd421a--sagemath-tobias.netlify.app/reference/plot3d/sage/plot/plot3d/plot3d.html seems to have lost its jupyter-sphinx magic (#33507)",
    "created_at": "2022-08-03T20:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477594",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>https://2505ea042169d8a179d4b1f28a0c0baeabdd421a--sagemath-tobias.netlify.app/reference/plot3d/sage/plot/plot3d/plot3d.html seems to have lost its jupyter-sphinx magic (#33507)



---

archive/issue_comments_477595.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 mkoeppe]:\n> https://2505ea042169d8a179d4b1f28a0c0baeabdd421a--sagemath-tobias.netlify.app/reference/plot3d/sage/plot/plot3d/plot3d.html seems to have lost its jupyter-sphinx magic (#33507)\n\n\nThis is not new. The same with the present doc. I don't know why.",
    "created_at": "2022-08-03T21:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477595",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:31'></a>Replying to [comment:30 mkoeppe]:
> https://2505ea042169d8a179d4b1f28a0c0baeabdd421a--sagemath-tobias.netlify.app/reference/plot3d/sage/plot/plot3d/plot3d.html seems to have lost its jupyter-sphinx magic (#33507)


This is not new. The same with the present doc. I don't know why.



---

archive/issue_comments_477596.json:
```json
{
    "body": "<a id='comment:32'></a>OK. Not important for this ticket.",
    "created_at": "2022-08-03T21:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477596",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>OK. Not important for this ticket.



---

archive/issue_comments_477597.json:
```json
{
    "body": "<a id='comment:35'></a>I think it looks great, thanks for making this.\n\nMinor detail: Some of the vertical spacing (e.g., between a method and its description, or around code blocks) doesn't seem quite right to me. I suggest adding the following CSS rules:\n\n```css\ndt { margin-top: 1.25ex; margin-bottom: 1.25ex; }\np, ol, ul { margin-top: .75ex; margin-bottom: .75ex; }\np + .highlight-ipycon {margin-top: .75ex; margin-bottom: 1ex; }\n```",
    "created_at": "2022-08-04T02:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477597",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:35'></a>I think it looks great, thanks for making this.

Minor detail: Some of the vertical spacing (e.g., between a method and its description, or around code blocks) doesn't seem quite right to me. I suggest adding the following CSS rules:

```css
dt { margin-top: 1.25ex; margin-bottom: 1.25ex; }
p, ol, ul { margin-top: .75ex; margin-bottom: .75ex; }
p + .highlight-ipycon {margin-top: .75ex; margin-bottom: 1ex; }
```



---

archive/issue_comments_477598.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 lorenz]:\n> I think it looks great, thanks for making this.\n> \n> Minor detail: Some of the vertical spacing (e.g., between a method and its description, or around code blocks) doesn't seem quite right to me. \n\n\nWould you pinpoint to a precise place from the documentation (following the Build Documentation badge)? I could not find one.\n\nI think we should tweak Furo's styles only if the styling is an obvious defect (meaning \"look bad to anyone\") and is specifically about Sage. If the defect is a general one, the change request should go to the furo project itself.",
    "created_at": "2022-08-04T03:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477598",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:36'></a>Replying to [comment:35 lorenz]:
> I think it looks great, thanks for making this.
> 
> Minor detail: Some of the vertical spacing (e.g., between a method and its description, or around code blocks) doesn't seem quite right to me. 


Would you pinpoint to a precise place from the documentation (following the Build Documentation badge)? I could not find one.

I think we should tweak Furo's styles only if the styling is an obvious defect (meaning "look bad to anyone") and is specifically about Sage. If the defect is a general one, the change request should go to the furo project itself.



---

archive/issue_comments_477599.json:
```json
{
    "body": "<a id='comment:37'></a>Any page, really: For example, here\n\n![](jJR0poB.png)\n\nthere's ample space around `EXAMPLES:` but the lines `rational_maps()` and `Return ...` are stuck together.\n\nThe official Furo examples look the same. I'm surprised noone else seems to find the spacing offensive.\n\nAnyway, it's nitpicking, and indeed not our problem.",
    "created_at": "2022-08-04T04:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477599",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:37'></a>Any page, really: For example, here

![](jJR0poB.png)

there's ample space around `EXAMPLES:` but the lines `rational_maps()` and `Return ...` are stuck together.

The official Furo examples look the same. I'm surprised noone else seems to find the spacing offensive.

Anyway, it's nitpicking, and indeed not our problem.



---

archive/issue_comments_477600.json:
```json
{
    "body": "<a id='comment:38'></a>Attachment [pic1.png](tarball://root/attachments/some-uuid/ticket33833/pic1.png) by @kwankyu created at 2022-08-04 05:45:54\n\nReplying to [comment:37 lorenz]:\n> there's ample space around `EXAMPLES:` but the lines `rational_maps()` and `Return ...` are stuck together.\n\n\nI see. The space between \"EXAMPLES:\" and \"sage: ...\" is the sum of the space around \"EXAMPLES\" and the space (margin + border) around \"sage: ...\". The reason that we see the added sum of the space seems that the background of \"sage: ...\" is hard to tell from the page background because of similarity of colors. It seems worse in dark mode than in light mode.\n\nIf I increase of the contrast between the backgrounds slightly, then it shows\n\n![](pic1.png)\n \nIs this better?\n\n> Anyway, it's nitpicking, and indeed not our problem.\n\n\nAs we have lots of example code, we may regard this as our problem.",
    "created_at": "2022-08-04T05:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477600",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:38'></a>Attachment [pic1.png](tarball://root/attachments/some-uuid/ticket33833/pic1.png) by @kwankyu created at 2022-08-04 05:45:54

Replying to [comment:37 lorenz]:
> there's ample space around `EXAMPLES:` but the lines `rational_maps()` and `Return ...` are stuck together.


I see. The space between "EXAMPLES:" and "sage: ..." is the sum of the space around "EXAMPLES" and the space (margin + border) around "sage: ...". The reason that we see the added sum of the space seems that the background of "sage: ..." is hard to tell from the page background because of similarity of colors. It seems worse in dark mode than in light mode.

If I increase of the contrast between the backgrounds slightly, then it shows

![](pic1.png)
 
Is this better?

> Anyway, it's nitpicking, and indeed not our problem.


As we have lots of example code, we may regard this as our problem.



---

archive/issue_comments_477601.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 lorenz]:\n> Any page, really: For example, here\n> \n> ![](https://i.imgur.com/jJR0poB.png)\n\n\nCould you please upload pictures as attachments to the ticket, rather than linking to imgur (which shows a lot of ugly spam if you click on the image)?\n\nOnce you attached `jJR0poB.png` (there is a tab for this near the top part of the ticket page), you can do `![](jJR0poB.png)`, to the same effect of displaying the image inline.",
    "created_at": "2022-08-04T08:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477601",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>Replying to [comment:37 lorenz]:
> Any page, really: For example, here
> 
> ![](https://i.imgur.com/jJR0poB.png)


Could you please upload pictures as attachments to the ticket, rather than linking to imgur (which shows a lot of ugly spam if you click on the image)?

Once you attached `jJR0poB.png` (there is a tab for this near the top part of the ticket page), you can do `![](jJR0poB.png)`, to the same effect of displaying the image inline.



---

archive/issue_comments_477602.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T23:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477603.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-05T01:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477604.json:
```json
{
    "body": "Attachment [jJR0poB.png](tarball://root/attachments/some-uuid/ticket33833/jJR0poB.png) by @yyyyx4 created at 2022-08-05 06:07:50",
    "created_at": "2022-08-05T06:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477604",
    "user": "https://github.com/yyyyx4"
}
```

Attachment [jJR0poB.png](tarball://root/attachments/some-uuid/ticket33833/jJR0poB.png) by @yyyyx4 created at 2022-08-05 06:07:50



---

archive/issue_comments_477605.json:
```json
{
    "body": "<a id='comment:42'></a>Be aware that there is going on a voting on the background style on sage-devel.",
    "created_at": "2022-08-05T06:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477605",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:42'></a>Be aware that there is going on a voting on the background style on sage-devel.



---

archive/issue_comments_477606.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-06T09:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477607.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-06T12:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477607",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477608.json:
```json
{
    "body": "<a id='comment:46'></a>Thank you!",
    "created_at": "2022-08-06T14:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477608",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'></a>Thank you!



---

archive/issue_comments_477609.json:
```json
{
    "body": "<a id='comment:47'></a>Thanks so much for working on this Kwankyu! Really nice to see that furo is now used as the standard doc theme.",
    "created_at": "2022-08-07T09:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477609",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'></a>Thanks so much for working on this Kwankyu! Really nice to see that furo is now used as the standard doc theme.



---

archive/issue_comments_477610.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 gh-tobiasdiez]:\n> Really nice to see that furo is now used as the standard doc theme.\n\n\nYes. I didn't know furo before you introduced it to sage. Thank you.",
    "created_at": "2022-08-07T09:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477610",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:48'></a>Replying to [comment:47 gh-tobiasdiez]:
> Really nice to see that furo is now used as the standard doc theme.


Yes. I didn't know furo before you introduced it to sage. Thank you.



---

archive/issue_comments_477611.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2022-08-07T23:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477611",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_477612.json:
```json
{
    "body": "<a id='comment:50'></a>Makes doctests depend on internet",
    "created_at": "2022-08-27T23:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477612",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>Makes doctests depend on internet



---

archive/issue_comments_477613.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-08-27T23:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477613",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_477614.json:
```json
{
    "body": "<a id='comment:51'></a>e.g.: http://build.sagemath.org/#/builders/5/builds/6/steps/38/logs/stdio",
    "created_at": "2022-08-27T23:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477614",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:51'></a>e.g.: http://build.sagemath.org/#/builders/5/builds/6/steps/38/logs/stdio



---

archive/issue_comments_477615.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 vbraun]:\n> e.g.: http://build.sagemath.org/#/builders/5/builds/6/steps/38/logs/stdio\n\n\nI can't see how this is related with this ticket...",
    "created_at": "2022-08-27T23:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477615",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:52'></a>Replying to [comment:51 vbraun]:
> e.g.: http://build.sagemath.org/#/builders/5/builds/6/steps/38/logs/stdio


I can't see how this is related with this ticket...



---

archive/issue_comments_477616.json:
```json
{
    "body": "<a id='comment:53'></a>All I know that it doesn't work with this ticket; Presumably `list_packages` ends up calling `pip_remote_version` on furo for some reason.\n\nYou can try for yourself by poisoning the proxy variables, e.g.\n\n```\nexport ftp_proxy=http://192.0.2.0:5187/\nexport http_proxy=http://192.0.2.0:5187/\nexport https_proxy=http://192.0.2.0:5187/\nexport rsync_proxy=http://192.0.2.0:5187/\n\n./sage -t --long --random-seed=123 src/sage/misc/package.py  # 6 doctests failed\n```",
    "created_at": "2022-08-28T11:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477616",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:53'></a>All I know that it doesn't work with this ticket; Presumably `list_packages` ends up calling `pip_remote_version` on furo for some reason.

You can try for yourself by poisoning the proxy variables, e.g.

```
export ftp_proxy=http://192.0.2.0:5187/
export http_proxy=http://192.0.2.0:5187/
export https_proxy=http://192.0.2.0:5187/
export rsync_proxy=http://192.0.2.0:5187/

./sage -t --long --random-seed=123 src/sage/misc/package.py  # 6 doctests failed
```



---

archive/issue_comments_477617.json:
```json
{
    "body": "<a id='comment:54'></a>After exporting the above\n\n```\n$ env | grep proxy\nftp_proxy=http://192.0.2.0:5187/\nhttps_proxy=http://192.0.2.0:5187/\nhttp_proxy=http://192.0.2.0:5187/\nrsync_proxy=http://192.0.2.0:5187/\n```\nthen with\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 849ee71f3f..137eb6013a 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -259,7 +259,7 @@ def list_packages(*pkg_types: str, pkg_sources: List[str] = ['normal', 'pip', 's\n     EXAMPLES::\n \n         sage: from sage.misc.package import list_packages\n-        sage: L = list_packages('standard')    # optional - sage_spkg\n+        sage: L = list_packages('standard', local=True)    # optional - sage_spkg\n         sage: sorted(L.keys())                 # optional - sage_spkg, random\n         ['alabaster',\n          'arb',\n```\nI get\n\n```\nsage -t --long --warn-long 93.6 --random-seed=123 src/sage/misc/package.py\n    [56 tests, 4.07 s]\n----------------------------------------------------------------------\nAll tests passed!\n```\nI'm not sure what's so special with `furo`? Is it the only pkg of type `pip`?",
    "created_at": "2022-08-29T01:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477617",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:54'></a>After exporting the above

```
$ env | grep proxy
ftp_proxy=http://192.0.2.0:5187/
https_proxy=http://192.0.2.0:5187/
http_proxy=http://192.0.2.0:5187/
rsync_proxy=http://192.0.2.0:5187/
```
then with

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 849ee71f3f..137eb6013a 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -259,7 +259,7 @@ def list_packages(*pkg_types: str, pkg_sources: List[str] = ['normal', 'pip', 's
     EXAMPLES::
 
         sage: from sage.misc.package import list_packages
-        sage: L = list_packages('standard')    # optional - sage_spkg
+        sage: L = list_packages('standard', local=True)    # optional - sage_spkg
         sage: sorted(L.keys())                 # optional - sage_spkg, random
         ['alabaster',
          'arb',
```
I get

```
sage -t --long --warn-long 93.6 --random-seed=123 src/sage/misc/package.py
    [56 tests, 4.07 s]
----------------------------------------------------------------------
All tests passed!
```
I'm not sure what's so special with `furo`? Is it the only pkg of type `pip`?



---

archive/issue_comments_477618.json:
```json
{
    "body": "<a id='comment:55'></a>I think it's the only standard pip package. We should change it to a normal package.",
    "created_at": "2022-08-29T01:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477618",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>I think it's the only standard pip package. We should change it to a normal package.



---

archive/issue_comments_477619.json:
```json
{
    "body": "<a id='comment:58'></a>This now needs `sphinx-theme-builder` as a build dependency\n\n---\nNew commits:",
    "created_at": "2022-08-29T01:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477619",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>This now needs `sphinx-theme-builder` as a build dependency

---
New commits:



---

archive/issue_comments_477620.json:
```json
{
    "body": "<a id='comment:59'></a>... and this pulls in a number of other dependencies.\n\nSo maybe we need to keep it optional after all, and just ask Harald to use it when he builds the documentation...",
    "created_at": "2022-08-29T01:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>... and this pulls in a number of other dependencies.

So maybe we need to keep it optional after all, and just ask Harald to use it when he builds the documentation...



---

archive/issue_comments_477621.json:
```json
{
    "body": "<a id='comment:60'></a>Replying to [comment:55 mkoeppe]:\n> I think it's the only standard pip package. We should change it to a normal package.\n\n\nWhy? The solution of :comment:54 does not suffice?",
    "created_at": "2022-08-29T03:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477621",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:60'></a>Replying to [comment:55 mkoeppe]:
> I think it's the only standard pip package. We should change it to a normal package.


Why? The solution of :comment:54 does not suffice?



---

archive/issue_comments_477622.json:
```json
{
    "body": "<a id='comment:61'></a>Ah, I just found\n\n```\nby policy, no standard package is allowed to be a pip package.\n```\nin the developer manual. Then why is that?",
    "created_at": "2022-08-29T03:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477622",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:61'></a>Ah, I just found

```
by policy, no standard package is allowed to be a pip package.
```
in the developer manual. Then why is that?



---

archive/issue_comments_477623.json:
```json
{
    "body": "<a id='comment:62'></a>Yes, exactly, the doctest failure is only a symptom of the real problem: We cannot have standard pip packages.",
    "created_at": "2022-08-29T03:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477623",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>Yes, exactly, the doctest failure is only a symptom of the real problem: We cannot have standard pip packages.



---

archive/issue_comments_477624.json:
```json
{
    "body": "<a id='comment:63'></a>We build a self-contained source tarball, which contains the tarballs of all standard packages in upstream/\n\nSo the source tarball can be installed without internet connectivity.",
    "created_at": "2022-08-29T03:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477624",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>We build a self-contained source tarball, which contains the tarballs of all standard packages in upstream/

So the source tarball can be installed without internet connectivity.



---

archive/issue_comments_477625.json:
```json
{
    "body": "<a id='comment:64'></a>Sorry that I forgot about that when I reviewed the ticket!",
    "created_at": "2022-08-29T03:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477625",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>Sorry that I forgot about that when I reviewed the ticket!



---

archive/issue_comments_477626.json:
```json
{
    "body": "<a id='comment:65'></a>Replying to [comment:64 mkoeppe]:\n> Sorry that I forgot about that when I reviewed the ticket!\n\n\nThe policy should be mentioned here:\n\nhttps://doc.sagemath.org/html/en/developer/packaging.html#prerequisites-for-new-standard-packages",
    "created_at": "2022-08-29T04:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477626",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:65'></a>Replying to [comment:64 mkoeppe]:
> Sorry that I forgot about that when I reviewed the ticket!


The policy should be mentioned here:

https://doc.sagemath.org/html/en/developer/packaging.html#prerequisites-for-new-standard-packages



---

archive/issue_comments_477627.json:
```json
{
    "body": "<a id='comment:66'></a>Then could it be that furo is still the default when we build sage from source?",
    "created_at": "2022-08-29T04:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477627",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:66'></a>Then could it be that furo is still the default when we build sage from source?



---

archive/issue_comments_477628.json:
```json
{
    "body": "<a id='comment:67'></a>We'd need to add the Python packages that are needed for building furo from source. But I'm not sure if that solves the problem completely because one of these dependencies is `nodeenv`, which suggests that the build process may also need to fetch Javascript packages.",
    "created_at": "2022-08-29T04:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477628",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'></a>We'd need to add the Python packages that are needed for building furo from source. But I'm not sure if that solves the problem completely because one of these dependencies is `nodeenv`, which suggests that the build process may also need to fetch Javascript packages.



---

archive/issue_comments_477629.json:
```json
{
    "body": "<a id='comment:68'></a>I'd suggest that we back out the change to \"standard\" from this ticket and pursue the path to make it a standard normal package on a separate ticket",
    "created_at": "2022-08-29T04:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>I'd suggest that we back out the change to "standard" from this ticket and pursue the path to make it a standard normal package on a separate ticket



---

archive/issue_comments_477630.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-08-29T04:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477630",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_477631.json:
```json
{
    "body": "<a id='comment:70'></a>Anyway here's the branch with all the dependencies - and it does have the problem that I thought:\n\n```\n[furo-2022.6.21] Building wheels for collected packages: furo\n[furo-2022.6.21]   Building wheel for furo (pyproject.toml): started\n[furo-2022.6.21]   Running command Building wheel for furo (pyproject.toml)\n[furo-2022.6.21]   [stb] # nodeenv does not exist.\n[furo-2022.6.21]   [stb] # Generating new nodeenv with NodeJS 16.15.1!\n[furo-2022.6.21]   [stb] $ python -m nodeenv --node=16.15.1 --prebuilt --clean-src\n[furo-2022.6.21]   /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-pyth\n[furo-2022.6.21]   on3.8/var/tmp/sage/build/furo-2022.6.21/src/.nodeenv\n[furo-2022.6.21]    * Install prebuilt node (16.15.1) .\n[...]\n[furo-2022.6.21]   TimeoutError: [Errno 60] Operation timed out\n[furo-2022.6.21] \n```\n\n(it's trying to download Node.js from the internet, which fails because our installation poisons the https proxy)",
    "created_at": "2022-08-29T04:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477631",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>Anyway here's the branch with all the dependencies - and it does have the problem that I thought:

```
[furo-2022.6.21] Building wheels for collected packages: furo
[furo-2022.6.21]   Building wheel for furo (pyproject.toml): started
[furo-2022.6.21]   Running command Building wheel for furo (pyproject.toml)
[furo-2022.6.21]   [stb] # nodeenv does not exist.
[furo-2022.6.21]   [stb] # Generating new nodeenv with NodeJS 16.15.1!
[furo-2022.6.21]   [stb] $ python -m nodeenv --node=16.15.1 --prebuilt --clean-src
[furo-2022.6.21]   /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-pyth
[furo-2022.6.21]   on3.8/var/tmp/sage/build/furo-2022.6.21/src/.nodeenv
[furo-2022.6.21]    * Install prebuilt node (16.15.1) .
[...]
[furo-2022.6.21]   TimeoutError: [Errno 60] Operation timed out
[furo-2022.6.21] 
```

(it's trying to download Node.js from the internet, which fails because our installation poisons the https proxy)



---

archive/issue_comments_477632.json:
```json
{
    "body": "<a id='comment:71'></a>An alternative direction would be to install furo from a wheel. We don't have a mechanism for that yet, but it would not be very hard to add.\n\nThis would avoid the complicated nodeenv business (which is only needed for from-source build of furo).\n\nI've opened #34450 for this",
    "created_at": "2022-08-29T04:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477632",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>An alternative direction would be to install furo from a wheel. We don't have a mechanism for that yet, but it would not be very hard to add.

This would avoid the complicated nodeenv business (which is only needed for from-source build of furo).

I've opened #34450 for this



---

archive/issue_comments_477633.json:
```json
{
    "body": "<a id='comment:72'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-29T05:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:72'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_477634.json:
```json
{
    "body": "<a id='comment:73'></a>Try this",
    "created_at": "2022-08-29T05:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477634",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>Try this



---

archive/issue_comments_477635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-29T05:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477635",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_477636.json:
```json
{
    "body": "<a id='comment:75'></a>Replying to [comment:65 klee]:\n> Replying to [comment:64 mkoeppe]:\n> > Sorry that I forgot about that when I reviewed the ticket!\n\n> \n> The policy should be mentioned here:\n> \n> https://doc.sagemath.org/html/en/developer/packaging.html#prerequisites-for-new-standard-packages\n\n\nI've added it to the documentation in #34450",
    "created_at": "2022-08-29T05:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477636",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>Replying to [comment:65 klee]:
> Replying to [comment:64 mkoeppe]:
> > Sorry that I forgot about that when I reviewed the ticket!

> 
> The policy should be mentioned here:
> 
> https://doc.sagemath.org/html/en/developer/packaging.html#prerequisites-for-new-standard-packages


I've added it to the documentation in #34450



---

archive/issue_comments_477637.json:
```json
{
    "body": "<a id='comment:76'></a>Replying to [comment:73 mkoeppe]:\n> Try this\n\n\nWith #34421, the branch successfully builds sage and doc in furo theme from scratch.",
    "created_at": "2022-08-29T13:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477637",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:76'></a>Replying to [comment:73 mkoeppe]:
> Try this


With #34421, the branch successfully builds sage and doc in furo theme from scratch.



---

archive/issue_comments_477638.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-29T15:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477638",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477639.json:
```json
{
    "body": "<a id='comment:78'></a>It works well. Thank Matthias!\n\n---\nNew commits:",
    "created_at": "2022-08-29T15:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477639",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:78'></a>It works well. Thank Matthias!

---
New commits:



---

archive/issue_comments_477640.json:
```json
{
    "body": "<a id='comment:79'></a>The branch also passes Volker's test.",
    "created_at": "2022-08-29T15:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477640",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:79'></a>The branch also passes Volker's test.



---

archive/issue_comments_477641.json:
```json
{
    "body": "<a id='comment:80'></a>Great, thanks for testing!",
    "created_at": "2022-08-29T15:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477641",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>Great, thanks for testing!



---

archive/issue_events_088821.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-07T23:10:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33833#event-88821"
}
```



---

archive/issue_comments_477642.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-07T23:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33833#issuecomment-477642",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
