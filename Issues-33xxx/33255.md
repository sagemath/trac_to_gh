# Issue 33255: Equal hashes for non-isomorphic bipartite graphs with edge labels

archive/issues_033018.json:
```json
{
    "assignees": [],
    "body": "The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) are claimed to be equal and have equal hashes, while they are NOT isomorphic, let alone equal, as labeled graphs. \n\nWhen labels are ignored, these graphs are isomorphic, and so the problem may be caused by equality testing / `hash()` function somehow ignoring edge labels.\n\n\n```\nB1 = BipartiteGraph( [(0, 11, 2), (0, 12, 1), (0, 14, 1), (0, 16, 1), (1, 10, 1), (1, 13, 1), (1, 14, 2), (1, 16, 1), (2, 10, 2), (2, 11, 1), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True )\n\nB2 = BipartiteGraph( [(0, 11, 1), (0, 12, 1), (0, 14, 2), (0, 16, 1), (1, 10, 2), (1, 13, 1), (1, 14, 1), (1, 16, 1), (2, 10, 1), (2, 11, 2), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True )\n\nprint('Same hashes:', hash(B1) == hash(B2) )\nprint('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )\nprint('Equal:', B1 == B2)\n```\n\n\nBranch/Commit: **[public/graphs/33255](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/33255) @ [`e993d2f`](https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f)**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33255_\n\n",
    "created_at": "2022-01-31T05:18:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Equal hashes for non-isomorphic bipartite graphs with edge labels",
    "type": "issue",
    "updated_at": "2023-01-14T11:49:03Z",
    "url": "https://github.com/sagemath/sage/issues/33255",
    "user": "https://github.com/maxale"
}
```
The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) are claimed to be equal and have equal hashes, while they are NOT isomorphic, let alone equal, as labeled graphs. 

When labels are ignored, these graphs are isomorphic, and so the problem may be caused by equality testing / `hash()` function somehow ignoring edge labels.


```
B1 = BipartiteGraph( [(0, 11, 2), (0, 12, 1), (0, 14, 1), (0, 16, 1), (1, 10, 1), (1, 13, 1), (1, 14, 2), (1, 16, 1), (2, 10, 2), (2, 11, 1), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True )

B2 = BipartiteGraph( [(0, 11, 1), (0, 12, 1), (0, 14, 2), (0, 16, 1), (1, 10, 2), (1, 13, 1), (1, 14, 1), (1, 16, 1), (2, 10, 1), (2, 11, 2), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True )

print('Same hashes:', hash(B1) == hash(B2) )
print('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )
print('Equal:', B1 == B2)
```


Branch/Commit: **[public/graphs/33255](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/33255) @ [`e993d2f`](https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f)**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/33255_





---

archive/issue_events_454144.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:18:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454144"
}
```



---

archive/issue_events_454145.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:18:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454145"
}
```



---

archive/issue_events_454146.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:18:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454146"
}
```



---

archive/issue_events_454147.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:19:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454147"
}
```



---

archive/issue_events_454148.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:19:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454148"
}
```



---

archive/issue_events_454149.json:
```json
{
    "actor": "https://github.com/maxale",
    "created_at": "2022-01-31T05:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454149"
}
```



---

archive/issue_comments_537476.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) have equal hashes, while they are not isomorphic, let alone equal, as labeled graphs. \n+The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) are claimed to be equal and have equal hashes, while they are NOT isomorphic, let alone equal, as labeled graphs. \n \n-When labels are ignored, these graphs are isomorphic, and so the problem may be caused by `hash()` function somehow ignoring edge labels.\n+When labels are ignored, these graphs are isomorphic, and so the problem may be caused by equality testing / `hash()` function somehow ignoring edge labels.\n \n \n ```\n@@ -10,6 +10,7 @@\n \n print('Same hashes:', hash(B1) == hash(B2) )\n print('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )\n+print('Equal:', B1 == B2)\n ```\n \n \n``````\n",
    "created_at": "2022-01-31T05:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537476",
    "user": "https://github.com/maxale"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) have equal hashes, while they are not isomorphic, let alone equal, as labeled graphs. 
+The following code illustrates the problem that two bipartite graph `B1` and `B2` (both canonically labeled) are claimed to be equal and have equal hashes, while they are NOT isomorphic, let alone equal, as labeled graphs. 
 
-When labels are ignored, these graphs are isomorphic, and so the problem may be caused by `hash()` function somehow ignoring edge labels.
+When labels are ignored, these graphs are isomorphic, and so the problem may be caused by equality testing / `hash()` function somehow ignoring edge labels.
 
 
 ```
@@ -10,6 +10,7 @@
 
 print('Same hashes:', hash(B1) == hash(B2) )
 print('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )
+print('Equal:', B1 == B2)
 ```
 
 
``````




---

archive/issue_comments_537477.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe docstring for `Graph.__eq__` says: \"... labels of arrows/edges are taken into account if **and only if** the graphs are considered weighted ...\".  This means that if you want equality testing to consider the edge labels (i.e., if you want the graphs to be considered as labelled graphs), then you need to make the graphs weighted.\n\n```\nsage: B1 = BipartiteGraph( [(0, 11, 2), (0, 12, 1), (0, 14, 1), (0, 16, 1), (1, 10, 1), (1, 13, 1), (1, 14, 2), (1, 16, 1), (2, 10, 2), (2, 11, 1), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True, weighted=True )\n\nsage: B2 = BipartiteGraph( [(0, 11, 1), (0, 12, 1), (0, 14, 2), (0, 16, 1), (1, 10, 2), (1, 13, 1), (1, 14, 1), (1, 16, 1), (2, 10, 1), (2, 11, 2), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True, weighted=True )\n\nsage: print('Same hashes:', hash(B1) == hash(B2) )\nsage: print('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )\nsage: print('Equal:', B1 == B2)\n\nSame hashes: False\nIsomorphic: False\nEqual: False\n```\nSo this is not a bug in the method, but I can see that this could be unexpected behavior.  \n\nPerhaps a warning should be given when edge labels are put on an unweighted graph, or perhaps the documentation should be clarified.",
    "created_at": "2022-01-31T06:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537477",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:4" align="right">comment:4</div>

The docstring for `Graph.__eq__` says: "... labels of arrows/edges are taken into account if **and only if** the graphs are considered weighted ...".  This means that if you want equality testing to consider the edge labels (i.e., if you want the graphs to be considered as labelled graphs), then you need to make the graphs weighted.

```
sage: B1 = BipartiteGraph( [(0, 11, 2), (0, 12, 1), (0, 14, 1), (0, 16, 1), (1, 10, 1), (1, 13, 1), (1, 14, 2), (1, 16, 1), (2, 10, 2), (2, 11, 1), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True, weighted=True )

sage: B2 = BipartiteGraph( [(0, 11, 1), (0, 12, 1), (0, 14, 2), (0, 16, 1), (1, 10, 2), (1, 13, 1), (1, 14, 1), (1, 16, 1), (2, 10, 1), (2, 11, 2), (2, 15, 1), (2, 16, 1), (3, 10, 1), (3, 12, 1), (3, 16, 2), (3, 17, 1), (4, 11, 1), (4, 13, 1), (4, 15, 2), (4, 17, 1), (5, 9, 2), (5, 14, 1), (5, 15, 1), (5, 17, 1), (6, 9, 1), (6, 13, 2), (6, 16, 1), (6, 17, 1), (7, 9, 1), (7, 10, 1), (7, 11, 1), (7, 12, 2), (7, 14, 1), (8, 9, 1), (8, 12, 1), (8, 13, 1), (8, 15, 1), (8, 17, 2)], immutable=True, weighted=True )

sage: print('Same hashes:', hash(B1) == hash(B2) )
sage: print('Isomorphic:', B1.is_isomorphic( B2, edge_labels=True ) )
sage: print('Equal:', B1 == B2)

Same hashes: False
Isomorphic: False
Equal: False
```
So this is not a bug in the method, but I can see that this could be unexpected behavior.  

Perhaps a warning should be given when edge labels are put on an unweighted graph, or perhaps the documentation should be clarified.



---

archive/issue_events_454150.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2022-01-31T06:03:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454150"
}
```



---

archive/issue_events_454151.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2022-01-31T06:03:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454151"
}
```



---

archive/issue_events_454152.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2022-01-31T06:03:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454152"
}
```



---

archive/issue_events_454153.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2022-01-31T06:03:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454153"
}
```



---

archive/issue_comments_537478.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSimpler examples:\n\n```\nsage: a = [(0, 2, 1), (0, 3, 2), (1, 3, 1)]\nsage: b = [(0, 2, 2), (0, 3, 1), (1, 3, 2)]\n\nsage: A = BipartiteGraph(a, immutable=True)\nsage: B = BipartiteGraph(b, immutable=True)\n\nsage: print(f'Same hashes: {hash(A) == hash(B)}\\n'\n....:       f'Isomorphic: {A.is_isomorphic(B, edge_labels=True)}\\n'\n....:       f'Equal: {A == B}')\nSame hashes: True\nIsomorphic: False\nEqual: True\n\nsage: C = BipartiteGraph(a, immutable=True, weighted=True)\nsage: D = BipartiteGraph(b, immutable=True, weighted=True)\n\nsage: print(f'Same hashes: {hash(C) == hash(D)}\\n'\n....:       f'Isomorphic: {C.is_isomorphic(D, edge_labels=True)}\\n'\n....:       f'Equal: {C == D}')\nSame hashes: False\nIsomorphic: False\nEqual: False\n```",
    "created_at": "2022-01-31T10:27:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537478",
    "user": "https://github.com/slel"
}
```

<div id="comment:5" align="right">comment:5</div>

Simpler examples:

```
sage: a = [(0, 2, 1), (0, 3, 2), (1, 3, 1)]
sage: b = [(0, 2, 2), (0, 3, 1), (1, 3, 2)]

sage: A = BipartiteGraph(a, immutable=True)
sage: B = BipartiteGraph(b, immutable=True)

sage: print(f'Same hashes: {hash(A) == hash(B)}\n'
....:       f'Isomorphic: {A.is_isomorphic(B, edge_labels=True)}\n'
....:       f'Equal: {A == B}')
Same hashes: True
Isomorphic: False
Equal: True

sage: C = BipartiteGraph(a, immutable=True, weighted=True)
sage: D = BipartiteGraph(b, immutable=True, weighted=True)

sage: print(f'Same hashes: {hash(C) == hash(D)}\n'
....:       f'Isomorphic: {C.is_isomorphic(D, edge_labels=True)}\n'
....:       f'Equal: {C == D}')
Same hashes: False
Isomorphic: False
Equal: False
```



---

archive/issue_comments_537479.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,3 @@\n print('Equal:', B1 == B2)\n ```\n \n-\n-\n``````\n",
    "created_at": "2022-01-31T10:27:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537479",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,3 @@
 print('Equal:', B1 == B2)
 ```
 
-
-
``````




---

archive/issue_comments_537480.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe manipulation of edge labels is not simple since labels might not be hashable. For instance, a label can be a `Graph` or a dictionary.\nIn general, I prefer when the decision to consider labels is explicit (an argument set to `True` or `False`). \nDo you have any proposal to improve the documentation ?",
    "created_at": "2022-01-31T10:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537480",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

The manipulation of edge labels is not simple since labels might not be hashable. For instance, a label can be a `Graph` or a dictionary.
In general, I prefer when the decision to consider labels is explicit (an argument set to `True` or `False`). 
Do you have any proposal to improve the documentation ?



---

archive/issue_comments_537481.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nA related issue is the name of this option. What is called `weighted=` in `BipartiteGraph()` in many other methods (like `.is_isomorphic()`, `.canonical_label()`, `.automorphism_group()` etc.) is called `edge_labels=`. \n\nShould there be consistency in the naming of this option?",
    "created_at": "2022-01-31T14:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537481",
    "user": "https://github.com/maxale"
}
```

<div id="comment:7" align="right">comment:7</div>

A related issue is the name of this option. What is called `weighted=` in `BipartiteGraph()` in many other methods (like `.is_isomorphic()`, `.canonical_label()`, `.automorphism_group()` etc.) is called `edge_labels=`. 

Should there be consistency in the naming of this option?



---

archive/issue_comments_537482.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nDocumentation says:\n\n    weighted \u2013 boolean (default: None); whether graph thinks of itself as weighted or not. See self.weighted()\n\nSo, the default value is not `True` or `False`, but `None`. I'd suggest that when `weighted=None` (ie., not specified), it should guessed from the input data. That is, if labels are present in the given data, `BipartiteGraph()` should assume `weighted=True`, otherwise it's `weighted=False`.",
    "created_at": "2022-01-31T19:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537482",
    "user": "https://github.com/maxale"
}
```

<div id="comment:8" align="right">comment:8</div>

Documentation says:

    weighted â€“ boolean (default: None); whether graph thinks of itself as weighted or not. See self.weighted()

So, the default value is not `True` or `False`, but `None`. I'd suggest that when `weighted=None` (ie., not specified), it should guessed from the input data. That is, if labels are present in the given data, `BipartiteGraph()` should assume `weighted=True`, otherwise it's `weighted=False`.



---

archive/issue_comments_537483.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI want to clarify what fix is expected for this ticket:\n- Either replace `edge_labels` with `weighted` or vice versa for consistency\n- When `weighted=None`, assign `True` or `False` to `weighted` after checking the input data for labels. For example, if the input is an edge list, just check if at least one edge is a triple (and the third item is not `None`). \nIs this right?",
    "created_at": "2022-04-12T17:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537483",
    "user": "https://github.com/enjeck"
}
```

<div id="comment:9" align="right">comment:9</div>

I want to clarify what fix is expected for this ticket:
- Either replace `edge_labels` with `weighted` or vice versa for consistency
- When `weighted=None`, assign `True` or `False` to `weighted` after checking the input data for labels. For example, if the input is an edge list, just check if at least one edge is a triple (and the third item is not `None`). 
Is this right?



---

archive/issue_comments_537484.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@enjeck](#comment:9):\n> I want to clarify what fix is expected for this ticket:\n> - Either replace `edge_labels` with `weighted` or vice versa for consistency\n> - When `weighted=None`, assign `True` or `False` to `weighted` after checking the input data for labels. For example, if the input is an edge list, just check if at least one edge is a triple (and the third item is not `None`). \n> Is this right? \n\nYes, this would be great!",
    "created_at": "2022-04-12T23:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537484",
    "user": "https://github.com/maxale"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@enjeck](#comment:9):
> I want to clarify what fix is expected for this ticket:
> - Either replace `edge_labels` with `weighted` or vice versa for consistency
> - When `weighted=None`, assign `True` or `False` to `weighted` after checking the input data for labels. For example, if the input is an edge list, just check if at least one edge is a triple (and the third item is not `None`). 
> Is this right? 

Yes, this would be great!



---

archive/issue_comments_537485.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI disagree with the proposed change of behavior of parameter `weighted`, and observe that it may affect the entire graph library and other modules using graphs.\n\nParameter `weighted` is an old parameter that is used in some algorithm to specify the default behavior. That is, do computations in a weighted graph instead of unweighted graph. This is for instance the case for `min_spanning_tree`.\nWe have a long term objective of unifying the use of weights #13112. I'm not sure that parameter `weighted` is well taken into account by all methods that can use edge weights. So, I usually prefer to explicitly set `by_weight=True` to avoid confusion.\n\nMay be others have a different opinion ?",
    "created_at": "2022-04-13T09:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537485",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:11" align="right">comment:11</div>

I disagree with the proposed change of behavior of parameter `weighted`, and observe that it may affect the entire graph library and other modules using graphs.

Parameter `weighted` is an old parameter that is used in some algorithm to specify the default behavior. That is, do computations in a weighted graph instead of unweighted graph. This is for instance the case for `min_spanning_tree`.
We have a long term objective of unifying the use of weights #13112. I'm not sure that parameter `weighted` is well taken into account by all methods that can use edge weights. So, I usually prefer to explicitly set `by_weight=True` to avoid confusion.

May be others have a different opinion ?



---

archive/issue_events_454154.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454154"
}
```



---

archive/issue_events_454155.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454155"
}
```



---

archive/issue_events_454156.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454156"
}
```



---

archive/issue_events_454157.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454157"
}
```



---

archive/issue_comments_537486.json:
```json
{
    "body": "Commit: **[`6d31aad`](https://github.com/sagemath/sagetrac-mirror/commit/6d31aad9f67f9ff414b4dbdce70444d9f0b69004)**",
    "created_at": "2022-10-31T17:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537486",
    "user": "https://github.com/Bruno-TT"
}
```

Commit: **[`6d31aad`](https://github.com/sagemath/sagetrac-mirror/commit/6d31aad9f67f9ff414b4dbdce70444d9f0b69004)**



---

archive/issue_comments_537487.json:
```json
{
    "body": "Branch: **[u/gh-Bruno-TT/bipartite-hashes](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-Bruno-TT/bipartite-hashes)**",
    "created_at": "2022-10-31T17:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537487",
    "user": "https://github.com/Bruno-TT"
}
```

Branch: **[u/gh-Bruno-TT/bipartite-hashes](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-Bruno-TT/bipartite-hashes)**



---

archive/issue_events_454158.json:
```json
{
    "actor": "https://github.com/Bruno-TT",
    "created_at": "2022-10-31T17:56:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454158"
}
```



---

archive/issue_comments_537488.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere was never a unanimous consensus on how to handle the weight/labelling logic, so I've implemented a suggestion.\n\nMy implementation adds an optional boolean parameter hash_labels to the class constructor, which if left empty will default to None and warn the user upon hash() invocation, and then include labels in the hash.\n\nLet me know what you guys think.\n\n(I'm new to the project so please feel free to give criticism, I'm assuming I've somehow misused trac).",
    "created_at": "2022-10-31T17:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537488",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:14" align="right">comment:14</div>

There was never a unanimous consensus on how to handle the weight/labelling logic, so I've implemented a suggestion.

My implementation adds an optional boolean parameter hash_labels to the class constructor, which if left empty will default to None and warn the user upon hash() invocation, and then include labels in the hash.

Let me know what you guys think.

(I'm new to the project so please feel free to give criticism, I'm assuming I've somehow misused trac).



---

archive/issue_comments_537489.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156\"><code>e49602d</code></a></td><td><code>forgot to actually put something in the commit lol</code></td></tr></table>\n",
    "created_at": "2022-10-31T17:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537489",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156"><code>e49602d</code></a></td><td><code>forgot to actually put something in the commit lol</code></td></tr></table>




---

archive/issue_comments_537490.json:
```json
{
    "body": "Changed commit from **[`6d31aad`](https://github.com/sagemath/sagetrac-mirror/commit/6d31aad9f67f9ff414b4dbdce70444d9f0b69004)** to **[`e49602d`](https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156)**",
    "created_at": "2022-10-31T17:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537490",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d31aad`](https://github.com/sagemath/sagetrac-mirror/commit/6d31aad9f67f9ff414b4dbdce70444d9f0b69004)** to **[`e49602d`](https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156)**



---

archive/issue_comments_537491.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWelcome to Sagemath.\n\nTo be consistent, you should add parameter `hash_labels` to all (bipartite) (di)graph classes and make sure the parameter is copied when making a copy of the graph.\n\nI disagree with the default `None` value. We usually don't print warnings.\nI think it should default to `False` (current behavior) and be set to `True` if either it's the input value or if the graph is weighted.\n\nFor the `__hash__` method, please check `Graph.__hash__??`. It's better to use frozenset to avoid sorting. So simply use `left = frozenset(self.left)`.\n\nFinally, please try to use the same coding style as other methods.",
    "created_at": "2022-11-01T08:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537491",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

Welcome to Sagemath.

To be consistent, you should add parameter `hash_labels` to all (bipartite) (di)graph classes and make sure the parameter is copied when making a copy of the graph.

I disagree with the default `None` value. We usually don't print warnings.
I think it should default to `False` (current behavior) and be set to `True` if either it's the input value or if the graph is weighted.

For the `__hash__` method, please check `Graph.__hash__??`. It's better to use frozenset to avoid sorting. So simply use `left = frozenset(self.left)`.

Finally, please try to use the same coding style as other methods.



---

archive/issue_comments_537492.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nand try to stick to informative commit messages. If this ticket is merged, the commit messages become a permanent part of the sagemath repository and people who need to investigate the code for later maintenance will bump into them. The way these messages are formulated reflects on you (the author) and on the project as a whole.",
    "created_at": "2022-11-01T15:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537492",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

and try to stick to informative commit messages. If this ticket is merged, the commit messages become a permanent part of the sagemath repository and people who need to investigate the code for later maintenance will bump into them. The way these messages are formulated reflects on you (the author) and on the project as a whole.



---

archive/issue_comments_537493.json:
```json
{
    "body": "Changed commit from **[`e49602d`](https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156)** to **[`33206af`](https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014)**",
    "created_at": "2022-11-01T16:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537493",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e49602d`](https://github.com/sagemath/sagetrac-mirror/commit/e49602d2a4cf2bf2eda0dbeff47ba787aeed8156)** to **[`33206af`](https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014)**



---

archive/issue_comments_537494.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f7f552f0e66cce119404781e23d0a872ae9c7f\"><code>13f7f55</code></a></td><td><code>tweaks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014\"><code>33206af</code></a></td><td><code>pep8 formatting</code></td></tr></table>\n",
    "created_at": "2022-11-01T16:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537494",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f7f552f0e66cce119404781e23d0a872ae9c7f"><code>13f7f55</code></a></td><td><code>tweaks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014"><code>33206af</code></a></td><td><code>pep8 formatting</code></td></tr></table>




---

archive/issue_comments_537495.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [David Coudert](#comment:16):\n> To be consistent, you should add parameter `hash_labels` to all (bipartite) (di)graph classes and make sure the parameter is copied when making a copy of the graph.\n\nPlease could you clarify what you mean by this?\n\n> I disagree with the default `None` value. We usually don't print warnings.\n> I think it should default to `False` (current behavior) and be set to `True` if either it's the input value or if the graph is weighted.\n\n\n```\ndef _use_hash_labels(self):\n    return self.weighted() or self.hash_labels\n```\nJust changed the logic - is this what you mean?\n\n> For the `__hash__` method, please check `Graph.__hash__??`. It's better to use frozenset to avoid sorting. So simply use `left = frozenset(self.left)`.\n\nCool, thanks for the tip - changed it.\n\n> Finally, please try to use the same coding style as other methods.\n\nI've run autopep8\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f7f552f0e66cce119404781e23d0a872ae9c7f\"><code>13f7f55</code></a></td><td><code>tweaks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014\"><code>33206af</code></a></td><td><code>pep8 formatting</code></td></tr></table>\n",
    "created_at": "2022-11-01T16:03:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537495",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [David Coudert](#comment:16):
> To be consistent, you should add parameter `hash_labels` to all (bipartite) (di)graph classes and make sure the parameter is copied when making a copy of the graph.

Please could you clarify what you mean by this?

> I disagree with the default `None` value. We usually don't print warnings.
> I think it should default to `False` (current behavior) and be set to `True` if either it's the input value or if the graph is weighted.


```
def _use_hash_labels(self):
    return self.weighted() or self.hash_labels
```
Just changed the logic - is this what you mean?

> For the `__hash__` method, please check `Graph.__hash__??`. It's better to use frozenset to avoid sorting. So simply use `left = frozenset(self.left)`.

Cool, thanks for the tip - changed it.

> Finally, please try to use the same coding style as other methods.

I've run autopep8

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f7f552f0e66cce119404781e23d0a872ae9c7f"><code>13f7f55</code></a></td><td><code>tweaks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014"><code>33206af</code></a></td><td><code>pep8 formatting</code></td></tr></table>




---

archive/issue_comments_537496.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPlease avoid modifying parts of the code that have nothing to do with the objective of this ticket. It makes the reviewing process very difficult. To improve the coding style of a file, we prefer to open dedicated tickets and to not do it blindly.\n\n\nSimilarly to the `Graph__hash__` method, the `__hash__` method should be something like this (examples and tests are missing).\n\n```\ndef __hash__(self):\n    r\"\"\"\n    Compute a hash for ``self``, if ``self`` is immutable.\n\n    \"\"\"\n    if self.is_immutable():\n        edge_items = self.edge_iterator(labels=self._weighted or self.hash_labels)\n        if self.allows_multiple_edges():\n            from collections import Counter\n            edge_items = Counter(edge_items).items()\n        return hash((frozenset(self.left),\n                     frozenset(self.right),\n                     frozenset(edge_items))\n    raise TypeError(\"This graph is mutable, and thus not hashable. \"\n                    \"Create an immutable copy by `g.copy(immutable=True)`\")\n```\n\nNow, if we add this parameter to `BipartiteGraph`, it might be better to add it to `Graph`, `DiGraph`, etc. as well. Also, you must ensure that the parameter is copied if you do a copy.",
    "created_at": "2022-11-01T16:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537496",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">comment:20</div>

Please avoid modifying parts of the code that have nothing to do with the objective of this ticket. It makes the reviewing process very difficult. To improve the coding style of a file, we prefer to open dedicated tickets and to not do it blindly.


Similarly to the `Graph__hash__` method, the `__hash__` method should be something like this (examples and tests are missing).

```
def __hash__(self):
    r"""
    Compute a hash for ``self``, if ``self`` is immutable.

    """
    if self.is_immutable():
        edge_items = self.edge_iterator(labels=self._weighted or self.hash_labels)
        if self.allows_multiple_edges():
            from collections import Counter
            edge_items = Counter(edge_items).items()
        return hash((frozenset(self.left),
                     frozenset(self.right),
                     frozenset(edge_items))
    raise TypeError("This graph is mutable, and thus not hashable. "
                    "Create an immutable copy by `g.copy(immutable=True)`")
```

Now, if we add this parameter to `BipartiteGraph`, it might be better to add it to `Graph`, `DiGraph`, etc. as well. Also, you must ensure that the parameter is copied if you do a copy.



---

archive/issue_comments_537497.json:
```json
{
    "body": "Changed commit from **[`33206af`](https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014)** to **[`aca2b63`](https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952)**",
    "created_at": "2022-11-01T17:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537497",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`33206af`](https://github.com/sagemath/sagetrac-mirror/commit/33206afda26e6e74bbf434eeaceef31be65ed014)** to **[`aca2b63`](https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952)**



---

archive/issue_comments_537498.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952\"><code>aca2b63</code></a></td><td><code>Revert \"pep8 formatting\"</code></td></tr></table>\n",
    "created_at": "2022-11-01T17:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537498",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952"><code>aca2b63</code></a></td><td><code>Revert "pep8 formatting"</code></td></tr></table>




---

archive/issue_comments_537499.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [David Coudert](#comment:20):\n> Please avoid modifying parts of the code that have nothing to do with the objective of this ticket. It makes the reviewing process very difficult. To improve the coding style of a file, we prefer to open dedicated tickets and to not do it blindly.\n\nApologies for being too eager with the pep8 formatting - I've reverted the commit.\n\n\n> Similarly to the `Graph__hash__` method, the `__hash__` method should be something like this (examples and tests are missing).\n> \n> ```\n> def __hash__(self):\n>     r\"\"\"\n>     Compute a hash for ``self``, if ``self`` is immutable.\n> \n>     \"\"\"\n>     if self.is_immutable():\n>         edge_items = self.edge_iterator(labels=self._weighted or self.hash_labels)\n>         if self.allows_multiple_edges():\n>             from collections import Counter\n>             edge_items = Counter(edge_items).items()\n>         return hash((frozenset(self.left),\n>                      frozenset(self.right),\n>                      frozenset(edge_items))\n>     raise TypeError(\"This graph is mutable, and thus not hashable. \"\n>                     \"Create an immutable copy by `g.copy(immutable=True)`\")\n> ```\n\nI've had a play around with your suggestion, but there is some slightly weird behaviour.\n\nI'm not exactly sure what's going on, but for some reason, hashing a tuple containing an edge_iterator() object gives unreliable results:\n\n\n```\nsage: B1 = BipartiteGraph([(1,2,3)], immutable=True)\nsage: hash((B1.edge_iterator(labels=False),))\n-4081111260156298028\nsage: hash((B1.edge_iterator(labels=False),)) # same line as above\n6054870339558346632\n```\n\nFor now, I'm going to keep using my initial list/tuple_depth implementation since it seems to produce more reliable results\n\n> Now, if we add this parameter to `BipartiteGraph`, it might be better to add it to `Graph`, `DiGraph`, etc. as well. \n\nApologies for repeatedly asking for clarification, but are you saying I should add a hash_labels argument to the constructors of every graph class, [and/or _use_hash_labels() logic]?\n\n> Also, you must ensure that the parameter is copied if you do a copy.\n\nHow should I go about making sure the parameter is copied?",
    "created_at": "2022-11-08T16:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537499",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [David Coudert](#comment:20):
> Please avoid modifying parts of the code that have nothing to do with the objective of this ticket. It makes the reviewing process very difficult. To improve the coding style of a file, we prefer to open dedicated tickets and to not do it blindly.

Apologies for being too eager with the pep8 formatting - I've reverted the commit.


> Similarly to the `Graph__hash__` method, the `__hash__` method should be something like this (examples and tests are missing).
> 
> ```
> def __hash__(self):
>     r"""
>     Compute a hash for ``self``, if ``self`` is immutable.
> 
>     """
>     if self.is_immutable():
>         edge_items = self.edge_iterator(labels=self._weighted or self.hash_labels)
>         if self.allows_multiple_edges():
>             from collections import Counter
>             edge_items = Counter(edge_items).items()
>         return hash((frozenset(self.left),
>                      frozenset(self.right),
>                      frozenset(edge_items))
>     raise TypeError("This graph is mutable, and thus not hashable. "
>                     "Create an immutable copy by `g.copy(immutable=True)`")
> ```

I've had a play around with your suggestion, but there is some slightly weird behaviour.

I'm not exactly sure what's going on, but for some reason, hashing a tuple containing an edge_iterator() object gives unreliable results:


```
sage: B1 = BipartiteGraph([(1,2,3)], immutable=True)
sage: hash((B1.edge_iterator(labels=False),))
-4081111260156298028
sage: hash((B1.edge_iterator(labels=False),)) # same line as above
6054870339558346632
```

For now, I'm going to keep using my initial list/tuple_depth implementation since it seems to produce more reliable results

> Now, if we add this parameter to `BipartiteGraph`, it might be better to add it to `Graph`, `DiGraph`, etc. as well. 

Apologies for repeatedly asking for clarification, but are you saying I should add a hash_labels argument to the constructors of every graph class, [and/or _use_hash_labels() logic]?

> Also, you must ensure that the parameter is copied if you do a copy.

How should I go about making sure the parameter is copied?



---

archive/issue_comments_537500.json:
```json
{
    "body": "Changed commit from **[`aca2b63`](https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952)** to **[`eafaf28`](https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c)**",
    "created_at": "2022-11-08T16:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537500",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aca2b63`](https://github.com/sagemath/sagetrac-mirror/commit/aca2b6366fdc174aa0f17d327731748dea9f1952)** to **[`eafaf28`](https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c)**



---

archive/issue_comments_537501.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c\"><code>eafaf28</code></a></td><td><code>prevent mutable graph hashing + label warnings</code></td></tr></table>\n",
    "created_at": "2022-11-08T16:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537501",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c"><code>eafaf28</code></a></td><td><code>prevent mutable graph hashing + label warnings</code></td></tr></table>




---

archive/issue_comments_537502.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nHave your tried the method I proposed to hash a `BipartiteGraph` ? it is very similar to the hash function for `Graph`. It makes a frozenset of the list of edges which prevents ordering issues.\n\nConcerning copy, you must ensure in method copy of `src/sage/graphs/generic_graph.py` that attribute `hash_labels` is copied (if it exists).\n\nIf you want to generalize the idea to `Graph`, `DiGraph`, `GenericGraph`, the parameter should be set in the constructor of each of these classes and that the hash method of  `src/sage/graphs/generic_graph.py` should be updated accordingly.",
    "created_at": "2022-11-08T17:34:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537502",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:24" align="right">comment:24</div>

Have your tried the method I proposed to hash a `BipartiteGraph` ? it is very similar to the hash function for `Graph`. It makes a frozenset of the list of edges which prevents ordering issues.

Concerning copy, you must ensure in method copy of `src/sage/graphs/generic_graph.py` that attribute `hash_labels` is copied (if it exists).

If you want to generalize the idea to `Graph`, `DiGraph`, `GenericGraph`, the parameter should be set in the constructor of each of these classes and that the hash method of  `src/sage/graphs/generic_graph.py` should be updated accordingly.



---

archive/issue_comments_537503.json:
```json
{
    "body": "Changed commit from **[`eafaf28`](https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c)** to **[`f801dbd`](https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd)**",
    "created_at": "2022-11-24T14:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537503",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eafaf28`](https://github.com/sagemath/sagetrac-mirror/commit/eafaf288bf0b6fc26a81f290aa93080f185d356c)** to **[`f801dbd`](https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd)**



---

archive/issue_comments_537504.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd\"><code>f801dbd</code></a></td><td><code>generic_graph supports hash_labels + tests</code></td></tr></table>\n",
    "created_at": "2022-11-24T14:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537504",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd"><code>f801dbd</code></a></td><td><code>generic_graph supports hash_labels + tests</code></td></tr></table>




---

archive/issue_comments_537505.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [David Coudert](#comment:24):\n> Have your tried the method I proposed to hash a `BipartiteGraph` ? it is very similar to the hash function for `Graph`. It makes a frozenset of the list of edges which prevents ordering issues.\n\nDone!\n\n> Concerning copy, you must ensure in method copy of `src/sage/graphs/generic_graph.py` that attribute `hash_labels` is copied (if it exists).\n\nDone. Also added a hash_labels parameter to the copy method, although my solution is quite hacky - see my code comment for more info. The feature is fully functional, and I've written some quite comprehensive tests for it, but I also won't take it personally if someone wants to change it or remove it.\n\n\n> If you want to generalize the idea to `Graph`, `DiGraph`, `GenericGraph`, the parameter should be set in the constructor of each of these classes and that the hash method of  `src/sage/graphs/generic_graph.py` should be updated accordingly.\n\nDone, passing all tests.",
    "created_at": "2022-11-24T14:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537505",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [David Coudert](#comment:24):
> Have your tried the method I proposed to hash a `BipartiteGraph` ? it is very similar to the hash function for `Graph`. It makes a frozenset of the list of edges which prevents ordering issues.

Done!

> Concerning copy, you must ensure in method copy of `src/sage/graphs/generic_graph.py` that attribute `hash_labels` is copied (if it exists).

Done. Also added a hash_labels parameter to the copy method, although my solution is quite hacky - see my code comment for more info. The feature is fully functional, and I've written some quite comprehensive tests for it, but I also won't take it personally if someone wants to change it or remove it.


> If you want to generalize the idea to `Graph`, `DiGraph`, `GenericGraph`, the parameter should be set in the constructor of each of these classes and that the hash method of  `src/sage/graphs/generic_graph.py` should be updated accordingly.

Done, passing all tests.



---

archive/issue_comments_537506.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThere is a merge conflict with the last beta version.",
    "created_at": "2022-11-24T15:47:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537506",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:27" align="right">comment:27</div>

There is a merge conflict with the last beta version.



---

archive/issue_comments_537507.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772\"><code>c379a13</code></a></td><td><code>Merge tag '9.8.beta4' into u/gh-Bruno-TT/bipartite-hashes</code></td></tr></table>\n",
    "created_at": "2022-11-24T18:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537507",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772"><code>c379a13</code></a></td><td><code>Merge tag '9.8.beta4' into u/gh-Bruno-TT/bipartite-hashes</code></td></tr></table>




---

archive/issue_comments_537508.json:
```json
{
    "body": "Changed commit from **[`f801dbd`](https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd)** to **[`c379a13`](https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772)**",
    "created_at": "2022-11-24T18:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537508",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f801dbd`](https://github.com/sagemath/sagetrac-mirror/commit/f801dbd83f20e88b27f2c428488b40978733ccfd)** to **[`c379a13`](https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772)**



---

archive/issue_comments_537509.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [David Coudert](#comment:27):\n> There is a merge conflict with the last beta version.\n\nthink I've resolved it",
    "created_at": "2022-11-24T18:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537509",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [David Coudert](#comment:27):
> There is a merge conflict with the last beta version.

think I've resolved it



---

archive/issue_comments_537510.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSome of the text in the commits should be in the ticket to ease the discussion. For instance I agree that returning `self` is not a good idea as one may for instance want to manipulate copies with different embedding.\n\nAlso, can you push the branch in public (e.g., `public/graphs/33255`) so that I can push review commits. It's faster for me that listing all the details that must be improved.\n\nThanks.",
    "created_at": "2022-11-26T16:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537510",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:30" align="right">comment:30</div>

Some of the text in the commits should be in the ticket to ease the discussion. For instance I agree that returning `self` is not a good idea as one may for instance want to manipulate copies with different embedding.

Also, can you push the branch in public (e.g., `public/graphs/33255`) so that I can push review commits. It's faster for me that listing all the details that must be improved.

Thanks.



---

archive/issue_comments_537511.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [David Coudert](#comment:30):\n> Some of the text in the commits should be in the ticket to ease the discussion. For instance I agree that returning `self` is not a good idea as one may for instance want to manipulate copies with different embedding.\n\nfor anyone interested, here is the text he's referring to:\n\n''This is an ugly hack but it works.\nThis function contains some fairly complex logic, and there is a comment further down that says \"Immutable copy of an immutable graph ? return self !\", the issue being that if we want to change the hash_labels behaviour, then\nreturning self is no longer a good option. I'd argue that a copy function\nreturning self is always bad behaviour, but that's out of the scope for this ticket.\nTrying to weaken the if statement to include something like\n        \n\n```\nand (hash_labels is None or (hash_labels==self._use_labels_for_hash()))\n```\n\n\n*doesn't work, since there is no fallback logic for making an immutable copy of an immutable graph, and my attempts at implementing one caused other tests to break in different bits of the code*\n\n*the hack I've used creates a mutable copy of the graph and then makes an immutable copy of that one. I think this is a fairly unobtrusive implementation, since the function still runs as normally, assuming that they pass nothing into hash_labels, and seems to behave correctly otherwise.*\n\n*However, this is obviously not optimal, and could definitely be improved upon by someone who understands the logic better.* \n\n\n> Also, can you push the branch in public (e.g., `public/graphs/33255`) so that I can push review commits. It's faster for me that listing all the details that must be improved.\n> \n> Thanks.\n\npushed to `public/graphs/33255`",
    "created_at": "2022-12-10T14:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537511",
    "user": "https://github.com/Bruno-TT"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [David Coudert](#comment:30):
> Some of the text in the commits should be in the ticket to ease the discussion. For instance I agree that returning `self` is not a good idea as one may for instance want to manipulate copies with different embedding.

for anyone interested, here is the text he's referring to:

''This is an ugly hack but it works.
This function contains some fairly complex logic, and there is a comment further down that says "Immutable copy of an immutable graph ? return self !", the issue being that if we want to change the hash_labels behaviour, then
returning self is no longer a good option. I'd argue that a copy function
returning self is always bad behaviour, but that's out of the scope for this ticket.
Trying to weaken the if statement to include something like
        

```
and (hash_labels is None or (hash_labels==self._use_labels_for_hash()))
```


*doesn't work, since there is no fallback logic for making an immutable copy of an immutable graph, and my attempts at implementing one caused other tests to break in different bits of the code*

*the hack I've used creates a mutable copy of the graph and then makes an immutable copy of that one. I think this is a fairly unobtrusive implementation, since the function still runs as normally, assuming that they pass nothing into hash_labels, and seems to behave correctly otherwise.*

*However, this is obviously not optimal, and could definitely be improved upon by someone who understands the logic better.* 


> Also, can you push the branch in public (e.g., `public/graphs/33255`) so that I can push review commits. It's faster for me that listing all the details that must be improved.
> 
> Thanks.

pushed to `public/graphs/33255`



---

archive/issue_comments_537512.json:
```json
{
    "body": "Changed commit from **[`c379a13`](https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772)** to **[`634ca63`](https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51)**",
    "created_at": "2023-01-08T13:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537512",
    "user": "https://github.com/dcoudert"
}
```

Changed commit from **[`c379a13`](https://github.com/sagemath/sagetrac-mirror/commit/c379a13508c98291c090764422839b381ea03772)** to **[`634ca63`](https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51)**



---

archive/issue_events_454159.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2023-01-08T13:40:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454159"
}
```



---

archive/issue_events_454160.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2023-01-08T13:40:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454160"
}
```



---

archive/issue_comments_537513.json:
```json
{
    "body": "Changed branch from **[u/gh-Bruno-TT/bipartite-hashes](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-Bruno-TT/bipartite-hashes)** to **[public/graphs/33255](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/33255)**",
    "created_at": "2023-01-08T13:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537513",
    "user": "https://github.com/dcoudert"
}
```

Changed branch from **[u/gh-Bruno-TT/bipartite-hashes](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-Bruno-TT/bipartite-hashes)** to **[public/graphs/33255](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/33255)**



---

archive/issue_comments_537514.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI did several corrections / improvements. It currently passes tests, but I may have missed some cases.\n\nI'll check the copy method asap. It's not obvious how to endup with a clean solution.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/569ec3caf59bf7c73532f2de6ab0f8a30ea156e2\"><code>569ec3c</code></a></td><td><code>trac #33255: merged with 9.8.beta6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/837a8c7ef856c0c080c894de0789e5d66f956b3c\"><code>837a8c7</code></a></td><td><code>trac #33255: review commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51\"><code>634ca63</code></a></td><td><code>trac #33255: corrections</code></td></tr></table>\n",
    "created_at": "2023-01-08T13:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537514",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:32" align="right">comment:32</div>

I did several corrections / improvements. It currently passes tests, but I may have missed some cases.

I'll check the copy method asap. It's not obvious how to endup with a clean solution.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/569ec3caf59bf7c73532f2de6ab0f8a30ea156e2"><code>569ec3c</code></a></td><td><code>trac #33255: merged with 9.8.beta6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/837a8c7ef856c0c080c894de0789e5d66f956b3c"><code>837a8c7</code></a></td><td><code>trac #33255: review commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51"><code>634ca63</code></a></td><td><code>trac #33255: corrections</code></td></tr></table>




---

archive/issue_comments_537515.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f\"><code>e993d2f</code></a></td><td><code>trac #33255: better copy</code></td></tr></table>\n",
    "created_at": "2023-01-14T11:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537515",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f"><code>e993d2f</code></a></td><td><code>trac #33255: better copy</code></td></tr></table>




---

archive/issue_comments_537516.json:
```json
{
    "body": "Changed commit from **[`634ca63`](https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51)** to **[`e993d2f`](https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f)**",
    "created_at": "2023-01-14T11:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537516",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`634ca63`](https://github.com/sagemath/sagetrac-mirror/commit/634ca632611af10278d5943fc6c6b275a4621d51)** to **[`e993d2f`](https://github.com/sagemath/sagetrac-mirror/commit/e993d2f9aab597abc43fd5cf1da381dd0a8e8e9f)**



---

archive/issue_events_454161.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2023-01-14T11:49:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454161"
}
```



---

archive/issue_events_454162.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2023-01-14T11:49:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33255#event-454162"
}
```



---

archive/issue_comments_537517.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThis should do the job.\n\nRoughly, if parameter `hash_labels` is `None`, we have the same behavior than for the `weighted` parameters. If the parameter is set, we create a (im)mutable copy of the graph depending on the value of parameter `immutable`.\n\nIn another ticket, we can change the default behavior of returning self when asking for a copy of an immutable graph without changing parameters.",
    "created_at": "2023-01-14T11:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33255#issuecomment-537517",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:34" align="right">comment:34</div>

This should do the job.

Roughly, if parameter `hash_labels` is `None`, we have the same behavior than for the `weighted` parameters. If the parameter is set, we create a (im)mutable copy of the graph depending on the value of parameter `immutable`.

In another ticket, we can change the default behavior of returning self when asking for a copy of an immutable graph without changing parameters.
