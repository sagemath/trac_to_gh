# Issue 33327: add one test in TestSuite of Coxeter groups

archive/issues_033327.json:
```json
{
    "body": "CC:  @tscrim\n\ncoming from affine permutations\n\nIssue created by migration from https://trac.sagemath.org/ticket/33564\n\n",
    "closed_at": "2022-04-02T10:53:01Z",
    "created_at": "2022-03-25T20:22:45Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "add one test in TestSuite of Coxeter groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33327",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim

coming from affine permutations

Issue created by migration from https://trac.sagemath.org/ticket/33564





---

archive/issue_comments_473880.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473880",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_473881.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473881",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_473882.json:
```json
{
    "body": "Hmm, fails for Weyl groups, it seems. Why ?\n\n* maybe one should test that simple reflections are involutions ?\n\n* and also commutation between reflection not linked in the Coxeter diagram ?",
    "created_at": "2022-03-26T06:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473882",
    "user": "https://github.com/fchapoton"
}
```

Hmm, fails for Weyl groups, it seems. Why ?

* maybe one should test that simple reflections are involutions ?

* and also commutation between reflection not linked in the Coxeter diagram ?



---

archive/issue_comments_473883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-26T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473884.json:
```json
{
    "body": "so we have a problem with Weyl groups created from matrices:\n\n```\nsage: cm = CartanMatrix([[2,-5,0],[-2,2,-1],[0,-1,2]])\nsage: W = WeylGroup(cm)\nsage: TestSuite(W).run()\nFailure in _test_coxeter_relations:\nTraceback (most recent call last):\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n    test_method(tester=tester)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/coxeter_groups.py\", line 1301, in _test_coxeter_relations\n    cox_mat = self.coxeter_matrix()\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/weyl_groups.py\", line 96, in coxeter_matrix\n    return self.cartan_type().coxeter_matrix()\n  File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13026)\n    self.cache = f(self._instance)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/cartan_type.py\", line 1177, in coxeter_matrix\n    return CoxeterMatrix(self)\n  File \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1848)\n    return cls.classcall(cls, *args, **kwds)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py\", line 194, in __classcall_private__\n    return cls._from_coxetertype(coxeter_type)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py\", line 390, in _from_coxetertype\n    for (i, j, l) in coxeter_type.coxeter_graph().edge_iterator():\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_type.py\", line 502, in coxeter_graph\n    return self._cartan_type.coxeter_diagram()\nTypeError: 'NotImplementedType' object is not callable\n------------------------------------------------------------\nThe following tests failed: _test_coxeter_relations\n```",
    "created_at": "2022-03-26T07:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473884",
    "user": "https://github.com/fchapoton"
}
```

so we have a problem with Weyl groups created from matrices:

```
sage: cm = CartanMatrix([[2,-5,0],[-2,2,-1],[0,-1,2]])
sage: W = WeylGroup(cm)
sage: TestSuite(W).run()
Failure in _test_coxeter_relations:
Traceback (most recent call last):
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
    test_method(tester=tester)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/coxeter_groups.py", line 1301, in _test_coxeter_relations
    cox_mat = self.coxeter_matrix()
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/weyl_groups.py", line 96, in coxeter_matrix
    return self.cartan_type().coxeter_matrix()
  File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13026)
    self.cache = f(self._instance)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/cartan_type.py", line 1177, in coxeter_matrix
    return CoxeterMatrix(self)
  File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1848)
    return cls.classcall(cls, *args, **kwds)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 194, in __classcall_private__
    return cls._from_coxetertype(coxeter_type)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 390, in _from_coxetertype
    for (i, j, l) in coxeter_type.coxeter_graph().edge_iterator():
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_type.py", line 502, in coxeter_graph
    return self._cartan_type.coxeter_diagram()
TypeError: 'NotImplementedType' object is not callable
------------------------------------------------------------
The following tests failed: _test_coxeter_relations
```



---

archive/issue_comments_473885.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-26T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473885",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_473886.json:
```json
{
    "body": "not clear to me if \"Weyl groups\" associated with arbitrary Cartan matrices are always Coxeter groups..",
    "created_at": "2022-03-26T17:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473886",
    "user": "https://github.com/fchapoton"
}
```

not clear to me if "Weyl groups" associated with arbitrary Cartan matrices are always Coxeter groups..



---

archive/issue_comments_473887.json:
```json
{
    "body": "Every Weyl group is a Coxeter group, but there are a number of restrictions. In particular, it must be crystallographic and when c<sub>ij</sub> c<sub>ji</sub> > 3, then the corresponding Weyl group has an infinite edge in the Coxeter diagram. Here, the issue seems to be just a lack of complete functionality: arbitrary Cartan matrices do not know how to construct the corresponding Coxeter matrix. The code is essentially already there, but just not at the place.\n\nI will try to fix this today.",
    "created_at": "2022-03-27T05:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473887",
    "user": "https://github.com/tscrim"
}
```

Every Weyl group is a Coxeter group, but there are a number of restrictions. In particular, it must be crystallographic and when c<sub>ij</sub> c<sub>ji</sub> > 3, then the corresponding Weyl group has an infinite edge in the Coxeter diagram. Here, the issue seems to be just a lack of complete functionality: arbitrary Cartan matrices do not know how to construct the corresponding Coxeter matrix. The code is essentially already there, but just not at the place.

I will try to fix this today.



---

archive/issue_comments_473888.json:
```json
{
    "body": "Here is a fix. I also fixed a bug with a mismatch between the Cartan matrix and Cartan type of a reducible type. This now passes the tests in categories, groups, and combinat for me.\n\n---\nNew commits:",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473888",
    "user": "https://github.com/tscrim"
}
```

Here is a fix. I also fixed a bug with a mismatch between the Cartan matrix and Cartan type of a reducible type. This now passes the tests in categories, groups, and combinat for me.

---
New commits:



---

archive/issue_comments_473889.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473889",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_473890.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-29T06:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473891.json:
```json
{
    "body": "Thanks. I fixed a pyflakes warning. Now, this should be good to go.\n\nIf you agree, you can set to positive.",
    "created_at": "2022-03-29T06:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473891",
    "user": "https://github.com/fchapoton"
}
```

Thanks. I fixed a pyflakes warning. Now, this should be good to go.

If you agree, you can set to positive.



---

archive/issue_comments_473892.json:
```json
{
    "body": "Thank you.",
    "created_at": "2022-03-29T06:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473892",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_comments_473893.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-29T06:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473893",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088342.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-02T10:53:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33327#event-88342"
}
```



---

archive/issue_comments_473894.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-02T10:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33327#issuecomment-473894",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
