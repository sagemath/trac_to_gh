# Issue 33564: add one test in TestSuite of Coxeter groups

archive/issues_033327.json:
```json
{
    "body": "coming from affine permutations\n\nCC:  @tscrim\n\nBranch/Commit: 400862927d64811630d5858b1df4bf34d7f04725\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33564\n\n",
    "closed_at": "2022-04-02T10:53:01Z",
    "created_at": "2022-03-25T20:22:45Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "add one test in TestSuite of Coxeter groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33564",
    "user": "https://github.com/fchapoton"
}
```
coming from affine permutations

CC:  @tscrim

Branch/Commit: 400862927d64811630d5858b1df4bf34d7f04725

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33564





---

archive/issue_comments_660805.json:
```json
{
    "body": "Changing commit from \"\" to \"150517f0ecf04a7cfe360f73debb9da59ddd13d6\"",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660805",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "150517f0ecf04a7cfe360f73debb9da59ddd13d6"



---

archive/issue_comments_660806.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/33564\"",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660806",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/33564"



---

archive/issue_comments_660807.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[150517f](https://github.com/sagemath/sagetrac-mirror/commit/150517f0ecf04a7cfe360f73debb9da59ddd13d6)|`move doctest in category of Coxeter groups`|",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660807",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[150517f](https://github.com/sagemath/sagetrac-mirror/commit/150517f0ecf04a7cfe360f73debb9da59ddd13d6)|`move doctest in category of Coxeter groups`|



---

archive/issue_comments_660808.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-25T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660808",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_660809.json:
```json
{
    "body": "<a id='comment:2'></a>\nHmm, fails for Weyl groups, it seems. Why ?\n\n* maybe one should test that simple reflections are involutions ?\n\n* and also commutation between reflection not linked in the Coxeter diagram ?",
    "created_at": "2022-03-26T06:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660809",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
Hmm, fails for Weyl groups, it seems. Why ?

* maybe one should test that simple reflections are involutions ?

* and also commutation between reflection not linked in the Coxeter diagram ?



---

archive/issue_comments_660810.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[8f11b4b](https://github.com/sagemath/sagetrac-mirror/commit/8f11b4bede58feffbd4578c0b2bf4e4f06e0de11)|`more full check for Coxeter relations`|",
    "created_at": "2022-03-26T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[8f11b4b](https://github.com/sagemath/sagetrac-mirror/commit/8f11b4bede58feffbd4578c0b2bf4e4f06e0de11)|`more full check for Coxeter relations`|



---

archive/issue_comments_660811.json:
```json
{
    "body": "Changing commit from \"150517f0ecf04a7cfe360f73debb9da59ddd13d6\" to \"8f11b4bede58feffbd4578c0b2bf4e4f06e0de11\"",
    "created_at": "2022-03-26T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "150517f0ecf04a7cfe360f73debb9da59ddd13d6" to "8f11b4bede58feffbd4578c0b2bf4e4f06e0de11"



---

archive/issue_comments_660812.json:
```json
{
    "body": "<a id='comment:4'></a>\nso we have a problem with Weyl groups created from matrices:\n\n```\nsage: cm = CartanMatrix([[2,-5,0],[-2,2,-1],[0,-1,2]])\nsage: W = WeylGroup(cm)\nsage: TestSuite(W).run()\nFailure in _test_coxeter_relations:\nTraceback (most recent call last):\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n    test_method(tester=tester)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/coxeter_groups.py\", line 1301, in _test_coxeter_relations\n    cox_mat = self.coxeter_matrix()\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/weyl_groups.py\", line 96, in coxeter_matrix\n    return self.cartan_type().coxeter_matrix()\n  File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13026)\n    self.cache = f(self._instance)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/cartan_type.py\", line 1177, in coxeter_matrix\n    return CoxeterMatrix(self)\n  File \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1848)\n    return cls.classcall(cls, *args, **kwds)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py\", line 194, in __classcall_private__\n    return cls._from_coxetertype(coxeter_type)\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py\", line 390, in _from_coxetertype\n    for (i, j, l) in coxeter_type.coxeter_graph().edge_iterator():\n  File \"/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_type.py\", line 502, in coxeter_graph\n    return self._cartan_type.coxeter_diagram()\nTypeError: 'NotImplementedType' object is not callable\n------------------------------------------------------------\nThe following tests failed: _test_coxeter_relations\n```",
    "created_at": "2022-03-26T07:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660812",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
so we have a problem with Weyl groups created from matrices:

```
sage: cm = CartanMatrix([[2,-5,0],[-2,2,-1],[0,-1,2]])
sage: W = WeylGroup(cm)
sage: TestSuite(W).run()
Failure in _test_coxeter_relations:
Traceback (most recent call last):
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
    test_method(tester=tester)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/coxeter_groups.py", line 1301, in _test_coxeter_relations
    cox_mat = self.coxeter_matrix()
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/weyl_groups.py", line 96, in coxeter_matrix
    return self.cartan_type().coxeter_matrix()
  File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13026)
    self.cache = f(self._instance)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/cartan_type.py", line 1177, in coxeter_matrix
    return CoxeterMatrix(self)
  File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1848)
    return cls.classcall(cls, *args, **kwds)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 194, in __classcall_private__
    return cls._from_coxetertype(coxeter_type)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 390, in _from_coxetertype
    for (i, j, l) in coxeter_type.coxeter_graph().edge_iterator():
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_type.py", line 502, in coxeter_graph
    return self._cartan_type.coxeter_diagram()
TypeError: 'NotImplementedType' object is not callable
------------------------------------------------------------
The following tests failed: _test_coxeter_relations
```



---

archive/issue_comments_660813.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-26T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660813",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_660814.json:
```json
{
    "body": "<a id='comment:6'></a>\nnot clear to me if \"Weyl groups\" associated with arbitrary Cartan matrices are always Coxeter groups..",
    "created_at": "2022-03-26T17:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660814",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
not clear to me if "Weyl groups" associated with arbitrary Cartan matrices are always Coxeter groups..



---

archive/issue_comments_660815.json:
```json
{
    "body": "<a id='comment:7'></a>\nEvery Weyl group is a Coxeter group, but there are a number of restrictions. In particular, it must be crystallographic and when c<sub>ij</sub> c<sub>ji</sub> > 3, then the corresponding Weyl group has an infinite edge in the Coxeter diagram. Here, the issue seems to be just a lack of complete functionality: arbitrary Cartan matrices do not know how to construct the corresponding Coxeter matrix. The code is essentially already there, but just not at the place.\n\nI will try to fix this today.",
    "created_at": "2022-03-27T05:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660815",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Every Weyl group is a Coxeter group, but there are a number of restrictions. In particular, it must be crystallographic and when c<sub>ij</sub> c<sub>ji</sub> > 3, then the corresponding Weyl group has an infinite edge in the Coxeter diagram. Here, the issue seems to be just a lack of complete functionality: arbitrary Cartan matrices do not know how to construct the corresponding Coxeter matrix. The code is essentially already there, but just not at the place.

I will try to fix this today.



---

archive/issue_comments_660816.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere is a fix. I also fixed a bug with a mismatch between the Cartan matrix and Cartan type of a reducible type. This now passes the tests in categories, groups, and combinat for me.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|\n|[952afeb](https://github.com/sagemath/sagetrac-mirror/commit/952afebe166340852985b2375f017f641e26c53f)|`Merge branch 'u/chapoton/33564' of https://github.com/sagemath/sagetrac-mirror into public/combinat/coxeter_group_test-33564`|\n|[fbc1e58](https://github.com/sagemath/sagetrac-mirror/commit/fbc1e5831c3cb435aa6d1dc0c57a3727fdd81b14)|`Fixing issues with definition of Coxeter matrices.`|\n|[0bac55b](https://github.com/sagemath/sagetrac-mirror/commit/0bac55b50fb61ee4eb1da93f097d890bd73b346f)|`Use the index set to get the entires in the Coxeter matrix.`|\n|[b9bee75](https://github.com/sagemath/sagetrac-mirror/commit/b9bee75eef7aa2860017f2456e514a2dbbce91b8)|`Fixing an immutability issue with relabelled Cartan types.`|",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660816",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Here is a fix. I also fixed a bug with a mismatch between the Cartan matrix and Cartan type of a reducible type. This now passes the tests in categories, groups, and combinat for me.

---
New commits:
|                                                                                                                                          |                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|
|[952afeb](https://github.com/sagemath/sagetrac-mirror/commit/952afebe166340852985b2375f017f641e26c53f)|`Merge branch 'u/chapoton/33564' of https://github.com/sagemath/sagetrac-mirror into public/combinat/coxeter_group_test-33564`|
|[fbc1e58](https://github.com/sagemath/sagetrac-mirror/commit/fbc1e5831c3cb435aa6d1dc0c57a3727fdd81b14)|`Fixing issues with definition of Coxeter matrices.`|
|[0bac55b](https://github.com/sagemath/sagetrac-mirror/commit/0bac55b50fb61ee4eb1da93f097d890bd73b346f)|`Use the index set to get the entires in the Coxeter matrix.`|
|[b9bee75](https://github.com/sagemath/sagetrac-mirror/commit/b9bee75eef7aa2860017f2456e514a2dbbce91b8)|`Fixing an immutability issue with relabelled Cartan types.`|



---

archive/issue_comments_660817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660817",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_660818.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660818",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_660819.json:
```json
{
    "body": "Changing commit from \"8f11b4bede58feffbd4578c0b2bf4e4f06e0de11\" to \"b9bee75eef7aa2860017f2456e514a2dbbce91b8\"",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660819",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "8f11b4bede58feffbd4578c0b2bf4e4f06e0de11" to "b9bee75eef7aa2860017f2456e514a2dbbce91b8"



---

archive/issue_comments_660820.json:
```json
{
    "body": "Changing branch from \"u/chapoton/33564\" to \"public/combinat/coxeter_group_test-33564\"",
    "created_at": "2022-03-29T05:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660820",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/chapoton/33564" to "public/combinat/coxeter_group_test-33564"



---

archive/issue_comments_660821.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[4008629](https://github.com/sagemath/sagetrac-mirror/commit/400862927d64811630d5858b1df4bf34d7f04725)|`fix pyflakes warning`|",
    "created_at": "2022-03-29T06:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[4008629](https://github.com/sagemath/sagetrac-mirror/commit/400862927d64811630d5858b1df4bf34d7f04725)|`fix pyflakes warning`|



---

archive/issue_comments_660822.json:
```json
{
    "body": "Changing commit from \"b9bee75eef7aa2860017f2456e514a2dbbce91b8\" to \"400862927d64811630d5858b1df4bf34d7f04725\"",
    "created_at": "2022-03-29T06:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b9bee75eef7aa2860017f2456e514a2dbbce91b8" to "400862927d64811630d5858b1df4bf34d7f04725"



---

archive/issue_comments_660823.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks. I fixed a pyflakes warning. Now, this should be good to go.\n\nIf you agree, you can set to positive.",
    "created_at": "2022-03-29T06:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660823",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
Thanks. I fixed a pyflakes warning. Now, this should be good to go.

If you agree, you can set to positive.



---

archive/issue_comments_660824.json:
```json
{
    "body": "<a id='comment:11'></a>\nThank you.",
    "created_at": "2022-03-29T06:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660824",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Thank you.



---

archive/issue_comments_660825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-29T06:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660825",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_107311.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-04-02T10:53:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33564#event-107311"
}
```



---

archive/issue_comments_660826.json:
```json
{
    "body": "Changing branch from \"public/combinat/coxeter_group_test-33564\" to \"400862927d64811630d5858b1df4bf34d7f04725\"",
    "created_at": "2022-04-02T10:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660826",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/combinat/coxeter_group_test-33564" to "400862927d64811630d5858b1df4bf34d7f04725"



---

archive/issue_comments_660827.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-02T10:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33564#issuecomment-660827",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
