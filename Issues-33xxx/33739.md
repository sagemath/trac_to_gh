# Issue 33739: Migrate gitpod to conda

archive/issues_033502.json:
```json
{
    "body": "The current solution to prebuild the gitpod docker image using github actions does not work nicely, since prebuilds triggered shortly after a new release still use the old gitpod image (and it may take up to a few days until the new image is available). This is especially notable for the `develop` branch, which is the default entry point if you want to start a new branch on gitpod.\n\nIn this ticket, we migrate the gitpod config to use the conda environment, which is now generally stable enough for serious development (e.g. almost all tests pass). As a positive side effect, the gitpod config simplifies and startup times are considerably reduced.\n\nCC:  @mkoeppe @dimpase @isuruf\n\nBranch/Commit: 5748c2157b28ef12311062743d2e830ec7f79a85\n\nReviewer: Matthias Koeppe\n\nAuthor: Tobias Diez\n\nDependencies: #33740, #33855\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33739\n\n",
    "closed_at": "2022-05-29T11:29:09Z",
    "created_at": "2022-04-21T11:13:05Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Migrate gitpod to conda",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33739",
    "user": "https://github.com/tobiasdiez"
}
```
The current solution to prebuild the gitpod docker image using github actions does not work nicely, since prebuilds triggered shortly after a new release still use the old gitpod image (and it may take up to a few days until the new image is available). This is especially notable for the `develop` branch, which is the default entry point if you want to start a new branch on gitpod.

In this ticket, we migrate the gitpod config to use the conda environment, which is now generally stable enough for serious development (e.g. almost all tests pass). As a positive side effect, the gitpod config simplifies and startup times are considerably reduced.

CC:  @mkoeppe @dimpase @isuruf

Branch/Commit: 5748c2157b28ef12311062743d2e830ec7f79a85

Reviewer: Matthias Koeppe

Author: Tobias Diez

Dependencies: #33740, #33855

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33739





---

archive/issue_comments_672920.json:
```json
{
    "body": "Changing commit from \"a1602c9b06c66281c9221a79d1e4857e48db8ed9\" to \"9361a337924203c14a4fdffc1194d50f12e2c15f\"",
    "created_at": "2022-04-21T11:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a1602c9b06c66281c9221a79d1e4857e48db8ed9" to "9361a337924203c14a4fdffc1194d50f12e2c15f"



---

archive/issue_comments_672921.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-21T11:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_672922.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-21T11:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_672923.json:
```json
{
    "body": "Changing commit from \"9361a337924203c14a4fdffc1194d50f12e2c15f\" to \"bd2f3d3bc7829f1ccc30f1aa274259d8ab138603\"",
    "created_at": "2022-04-21T11:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9361a337924203c14a4fdffc1194d50f12e2c15f" to "bd2f3d3bc7829f1ccc30f1aa274259d8ab138603"



---

archive/issue_comments_672924.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#33740\"",
    "created_at": "2022-04-21T12:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672924",
    "user": "https://github.com/tobiasdiez"
}
```

Changing dependencies from "" to "#33740"



---

archive/issue_comments_672925.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-21T12:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672925",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_events_088670.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33739#event-88670"
}
```



---

archive/issue_comments_672926.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-05-09T22:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_672927.json:
```json
{
    "body": "Changing commit from \"bd2f3d3bc7829f1ccc30f1aa274259d8ab138603\" to \"67c74f2bc1ed80e81ceb599e7d5cb64570157378\"",
    "created_at": "2022-05-09T22:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672927",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bd2f3d3bc7829f1ccc30f1aa274259d8ab138603" to "67c74f2bc1ed80e81ceb599e7d5cb64570157378"



---

archive/issue_comments_672928.json:
```json
{
    "body": "<a id='comment:7'></a>This is now using the latest version of #33740, so ready for review again.",
    "created_at": "2022-05-10T19:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672928",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'></a>This is now using the latest version of #33740, so ready for review again.



---

archive/issue_comments_672929.json:
```json
{
    "body": "<a id='comment:8'></a>I don't know if it's a good idea to make this change because it means that gitpod can no longer be used for trying out package updates in the Sage distribution.\n\nToo bad that Gitpod has decided that a project can only have one Gitpod configuration - an obvious design limitation",
    "created_at": "2022-05-10T19:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672929",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I don't know if it's a good idea to make this change because it means that gitpod can no longer be used for trying out package updates in the Sage distribution.

Too bad that Gitpod has decided that a project can only have one Gitpod configuration - an obvious design limitation



---

archive/issue_comments_672930.json:
```json
{
    "body": "<a id='comment:9'></a>Can you not install the updated package manually using `make xyz`? But yes, there are a few things that might be harder to test in a conda environment. On the other hand, you also got a few new tools at your hand. For example, you can easily install specific versions of dependencies using conda.\n\nI think its also not a good idea to optimize gitpod for package update tickets, they should only be a small subset of all tickets. And for those the conda-based gitpod works more reliable and has shorter startup times.",
    "created_at": "2022-05-11T09:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672930",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Can you not install the updated package manually using `make xyz`? But yes, there are a few things that might be harder to test in a conda environment. On the other hand, you also got a few new tools at your hand. For example, you can easily install specific versions of dependencies using conda.

I think its also not a good idea to optimize gitpod for package update tickets, they should only be a small subset of all tickets. And for those the conda-based gitpod works more reliable and has shorter startup times.



---

archive/issue_comments_672931.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 gh-tobiasdiez]:\n> Can you not install the updated package manually using `make xyz`? \n\n\nAs the documentation says - \n \"Note that ``make`` is not used at all. All dependencies\n (including all Python packages) are provided by conda. [...] this will invalidate the \n use of any Sage-the-distribution commands such as ``sage -i``. Do not use them.\"",
    "created_at": "2022-05-11T16:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672931",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:9 gh-tobiasdiez]:
> Can you not install the updated package manually using `make xyz`? 


As the documentation says - 
 "Note that ``make`` is not used at all. All dependencies
 (including all Python packages) are provided by conda. [...] this will invalidate the 
 use of any Sage-the-distribution commands such as ``sage -i``. Do not use them."



---

archive/issue_comments_672932.json:
```json
{
    "body": "<a id='comment:11'></a>I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.\n\nWhen done, I agree that switching gitpod to conda is a good idea. \n\nAlso consider that both the conda stuff and the gitpod stuff are new -- for onboarding current developers, right now I think it's better if gitpod shows them something that is more familiar.",
    "created_at": "2022-05-11T18:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672932",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.

When done, I agree that switching gitpod to conda is a good idea. 

Also consider that both the conda stuff and the gitpod stuff are new -- for onboarding current developers, right now I think it's better if gitpod shows them something that is more familiar.



---

archive/issue_comments_672933.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 mkoeppe]:\n> I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.\n\n\nHow would devcontainer help here? Gitpod doesn't support them yet and its not clear yet when they will and in which form; the linked github issue reads more like that the are considering this as a alternative syntax for their gitpod.yml file and not that they would offer prebuilds for all defined devcontainers.",
    "created_at": "2022-05-11T19:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672933",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'></a>Replying to [comment:11 mkoeppe]:
> I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.


How would devcontainer help here? Gitpod doesn't support them yet and its not clear yet when they will and in which form; the linked github issue reads more like that the are considering this as a alternative syntax for their gitpod.yml file and not that they would offer prebuilds for all defined devcontainers.



---

archive/issue_comments_672934.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:10 mkoeppe]:\n> Replying to [comment:9 gh-tobiasdiez]:\n> > Can you not install the updated package manually using `make xyz`? \n\n> \n> As the documentation says - \n>  \"Note that ``make`` is not used at all. All dependencies\n>  (including all Python packages) are provided by conda. [...] this will invalidate the \n>  use of any Sage-the-distribution commands such as ``sage -i``. Do not use them.\"\n>  \n\n\nI just run `make pari` in the conda-based gitpod and it worked just fine.",
    "created_at": "2022-05-11T19:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672934",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 gh-tobiasdiez]:
> > Can you not install the updated package manually using `make xyz`? 

> 
> As the documentation says - 
>  "Note that ``make`` is not used at all. All dependencies
>  (including all Python packages) are provided by conda. [...] this will invalidate the 
>  use of any Sage-the-distribution commands such as ``sage -i``. Do not use them."
>  


I just run `make pari` in the conda-based gitpod and it worked just fine.



---

archive/issue_comments_672935.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 gh-tobiasdiez]:\n> Replying to [comment:11 mkoeppe]:\n> > I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.\n\n> \n> How would devcontainer help here?\n\n\nIf done right, it would make working on package upgrades almost as convenient as using gitpod. Sure, using local compilation (unless we orchestrate devcontainer prebuild), but convenient",
    "created_at": "2022-05-11T19:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672935",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:12 gh-tobiasdiez]:
> Replying to [comment:11 mkoeppe]:
> > I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.

> 
> How would devcontainer help here?


If done right, it would make working on package upgrades almost as convenient as using gitpod. Sure, using local compilation (unless we orchestrate devcontainer prebuild), but convenient



---

archive/issue_comments_672936.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 mkoeppe]:\n> Replying to [comment:12 gh-tobiasdiez]:\n> > Replying to [comment:11 mkoeppe]:\n> > > I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.\n\n> > \n> > How would devcontainer help here?\n\n> \n> If done right, it would make working on package upgrades almost as convenient as using gitpod. Sure, using local compilation (unless we orchestrate devcontainer prebuild), but convenient\n> \n\n\nEven with a conda-based gitpod, you can simply deactivate the conda environment and run `configure && make`. This is pretty much a disposable devcontainer without prebuild.",
    "created_at": "2022-05-11T20:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672936",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>Replying to [comment:14 mkoeppe]:
> Replying to [comment:12 gh-tobiasdiez]:
> > Replying to [comment:11 mkoeppe]:
> > > I think the way forward could be to work on the devcontainer ticket (#33671). There can be multiple devcontainers (we could have them for all the platforms that we generate Docker images for). This would be a good replacement for what gitpod right now offers in terms of testing package upgrades.

> > 
> > How would devcontainer help here?

> 
> If done right, it would make working on package upgrades almost as convenient as using gitpod. Sure, using local compilation (unless we orchestrate devcontainer prebuild), but convenient
> 


Even with a conda-based gitpod, you can simply deactivate the conda environment and run `configure && make`. This is pretty much a disposable devcontainer without prebuild.



---

archive/issue_comments_672937.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 gh-tobiasdiez]:\n> Even with a conda-based gitpod, you can simply deactivate the conda environment and run `configure && make`. \n\n\nThat's true, of course\n\n> This is pretty much a disposable devcontainer without prebuild.\n\n\nWell no, because it wouldn't even have a SAGE_LOCAL. So it offers nothing over just building the whole thing locally",
    "created_at": "2022-05-11T20:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672937",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:15 gh-tobiasdiez]:
> Even with a conda-based gitpod, you can simply deactivate the conda environment and run `configure && make`. 


That's true, of course

> This is pretty much a disposable devcontainer without prebuild.


Well no, because it wouldn't even have a SAGE_LOCAL. So it offers nothing over just building the whole thing locally



---

archive/issue_comments_672938.json:
```json
{
    "body": "<a id='comment:17'></a>The advantage would be that you can run whatever commands you want without worrying how it affects the rest of your system / the main installation of sage.\n\nAnyway, I still think that package updates are only a small subset of all tickets and making them temporarily slightly less convenient to test with gitpod is a price worth paying if gitpod gets more useful for the rest of the tickets. Moreover, as you mention, gitpod support is new so developers can easily go back to whatever they were using before to test package updates until further improvements like #33671 are implemented.\n\nIt would be nice if this ticket could be merged before the sagedays so that I don't have to wait 5mins during my talk until the workspace started.",
    "created_at": "2022-05-12T10:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672938",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>The advantage would be that you can run whatever commands you want without worrying how it affects the rest of your system / the main installation of sage.

Anyway, I still think that package updates are only a small subset of all tickets and making them temporarily slightly less convenient to test with gitpod is a price worth paying if gitpod gets more useful for the rest of the tickets. Moreover, as you mention, gitpod support is new so developers can easily go back to whatever they were using before to test package updates until further improvements like #33671 are implemented.

It would be nice if this ticket could be merged before the sagedays so that I don't have to wait 5mins during my talk until the workspace started.



---

archive/issue_comments_672939.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-13T22:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_672940.json:
```json
{
    "body": "Changing commit from \"67c74f2bc1ed80e81ceb599e7d5cb64570157378\" to \"f56a535d712eb598b207c5d88d3c2f32fbbcafaa\"",
    "created_at": "2022-05-13T22:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "67c74f2bc1ed80e81ceb599e7d5cb64570157378" to "f56a535d712eb598b207c5d88d3c2f32fbbcafaa"



---

archive/issue_comments_672941.json:
```json
{
    "body": "<a id='comment:19'></a>Is it really starting up faster?",
    "created_at": "2022-05-15T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672941",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Is it really starting up faster?



---

archive/issue_comments_672942.json:
```json
{
    "body": "<a id='comment:20'></a>Regression: The SageMath jupyter kernel cannot be selected (Command Palette - Create: New Jupyter Notebook, then \"Select Kernel\" in the upper right corner)",
    "created_at": "2022-05-15T15:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672942",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Regression: The SageMath jupyter kernel cannot be selected (Command Palette - Create: New Jupyter Notebook, then "Select Kernel" in the upper right corner)



---

archive/issue_comments_672943.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-15T16:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672943",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_672944.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:19 mkoeppe]:\n> Is it really starting up faster?\n\n\nyes for me its <1 min until the workspace is started.",
    "created_at": "2022-05-15T18:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672944",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:22'></a>Replying to [comment:19 mkoeppe]:
> Is it really starting up faster?


yes for me its <1 min until the workspace is started.



---

archive/issue_comments_672945.json:
```json
{
    "body": "<a id='comment:23'></a>I haven't timed it but here it took much longer than that. I'll use the timer to get more data later.",
    "created_at": "2022-05-15T18:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672945",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>I haven't timed it but here it took much longer than that. I'll use the timer to get more data later.



---

archive/issue_comments_672946.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:20 mkoeppe]:\n> Regression: The SageMath jupyter kernel cannot be selected (Command Palette - Create: New Jupyter Notebook, then \"Select Kernel\" in the upper right corner)\n\n\nI can select the correct \"venv\" there, what are you missing?",
    "created_at": "2022-05-15T18:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672946",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>Replying to [comment:20 mkoeppe]:
> Regression: The SageMath jupyter kernel cannot be selected (Command Palette - Create: New Jupyter Notebook, then "Select Kernel" in the upper right corner)


I can select the correct "venv" there, what are you missing?



---

archive/issue_comments_672947.json:
```json
{
    "body": "<a id='comment:25'></a>Missing the \"SageMath\" kernel (not the IPython kernel).",
    "created_at": "2022-05-15T18:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672947",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Missing the "SageMath" kernel (not the IPython kernel).



---

archive/issue_comments_672948.json:
```json
{
    "body": "<a id='comment:26'></a>How is this supposed to work? I found `src/sage_setup/command/sage_install.py` which installs the jupyter kernel but is only referenced in the `install` hook in `setup.py` and thus not invoked for editable installs. So this doesn't seem specific to the conda or github setup. What do I miss?",
    "created_at": "2022-05-15T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672948",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>How is this supposed to work? I found `src/sage_setup/command/sage_install.py` which installs the jupyter kernel but is only referenced in the `install` hook in `setup.py` and thus not invoked for editable installs. So this doesn't seem specific to the conda or github setup. What do I miss?



---

archive/issue_comments_672949.json:
```json
{
    "body": "<a id='comment:27'></a>I think currently it is working because sagelib is first installed without `--enable-editable` in the image.",
    "created_at": "2022-05-15T19:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672949",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>I think currently it is working because sagelib is first installed without `--enable-editable` in the image.



---

archive/issue_comments_672950.json:
```json
{
    "body": "Changing dependencies from \"#33740\" to \"#33740, #33855\"",
    "created_at": "2022-05-15T19:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672950",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#33740" to "#33740, #33855"



---

archive/issue_comments_672951.json:
```json
{
    "body": "<a id='comment:29'></a>Let's add it in #33855.",
    "created_at": "2022-05-15T19:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672951",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Let's add it in #33855.



---

archive/issue_comments_672952.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-16T20:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_672953.json:
```json
{
    "body": "Changing commit from \"f56a535d712eb598b207c5d88d3c2f32fbbcafaa\" to \"88d769b8c396a61f6e5dff91434cf724766f06ad\"",
    "created_at": "2022-05-16T20:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f56a535d712eb598b207c5d88d3c2f32fbbcafaa" to "88d769b8c396a61f6e5dff91434cf724766f06ad"



---

archive/issue_comments_672954.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-16T20:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672954",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_672955.json:
```json
{
    "body": "<a id='comment:32'></a>Of course by itself #33855 doesn't fix it -- the same line in spkg-install needs to be run manually...",
    "created_at": "2022-05-16T23:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672955",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Of course by itself #33855 doesn't fix it -- the same line in spkg-install needs to be run manually...



---

archive/issue_comments_672956.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-16T23:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672956",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_672957.json:
```json
{
    "body": "Changing commit from \"88d769b8c396a61f6e5dff91434cf724766f06ad\" to \"2b9ef5aa985213832f07fe299fa1c2f608fd0d4e\"",
    "created_at": "2022-05-18T16:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "88d769b8c396a61f6e5dff91434cf724766f06ad" to "2b9ef5aa985213832f07fe299fa1c2f608fd0d4e"



---

archive/issue_comments_672958.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-18T16:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_672959.json:
```json
{
    "body": "<a id='comment:34'></a>Rolled back the merge and merged the new version of #33855.",
    "created_at": "2022-05-18T16:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672959",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>Rolled back the merge and merged the new version of #33855.



---

archive/issue_comments_672960.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-18T16:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672960",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_672961.json:
```json
{
    "body": "<a id='comment:35'></a>Now the kernel is available",
    "created_at": "2022-05-18T19:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672961",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Now the kernel is available



---

archive/issue_comments_672962.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-05-18T19:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672962",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_672963.json:
```json
{
    "body": "<a id='comment:37'></a>I haven't tested it thoroughly, but it looks like a nice improvement. It does start faster than the previous solution using our huge prebuilt Docker images.",
    "created_at": "2022-05-18T19:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672963",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>I haven't tested it thoroughly, but it looks like a nice improvement. It does start faster than the previous solution using our huge prebuilt Docker images.



---

archive/issue_comments_672964.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-18T19:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672964",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_672965.json:
```json
{
    "body": "<a id='comment:38'></a>Thanks!",
    "created_at": "2022-05-18T20:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672965",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'></a>Thanks!



---

archive/issue_comments_672966.json:
```json
{
    "body": "<a id='comment:39'></a>Merge failure on top of:\n\n054e8ed8d9 Trac #33316: Drop support for GCC < 6.3 in Sage 9.7\n\nfa3b529c41 Trac #25833: Upgrade to MathJax 3 and configure Sage\n\ne2ebf445d0 Trac #33825: Use pytest-xdist to run pytest in parallel\n\nb4009625f3 Trac #33824: make gens and orbits of PermutationGroup immutable\n\naf23627f18 Trac #33809: some pathlib in combinat and groups\n\n955b5d994c Trac #33803: Fixes for the distributions sagemath-objects, sagemath-categories\n\n3e6b41f7d6 Trac #33799: Replace SAGE_TMP in doctests of sage.misc.{persist,ostools}, sage.doctest, sage.repl\n\na3fd7185e3 Trac #33797: sage.misc.temporary_file: Remove use of SAGE_TMP\n\n2ca053010a Trac #33794: modules/fp_graded/morphism.py test failure\n\n7037fba482 Trac #33793: sage.misc.cython: Replace use of SPYX_TMP by a new cached function in sage.misc.temporary_file\n\nd1152701c4 Trac #33787: Installation manual: Update section \"system-wide install\"\n\n0ae55652cf Trac #33782: ci-cygwin: Update python version\n\n833f53d1cc Trac #33779: Remove use of SAGE_TMP in sage.interfaces.latte\n\nb376a8d71c Trac #33771: SSLContext needs an argument\n\ndf168c8112 Trac #33763: Refactor src/sage/docs\n\n9597eafded Trac #33748: make accessing coefficients of finite-field elements easier\n\nf02236f5b6 Trac #33744: Compute bases/circuits in MatroidUnion\n\n8943dc07fc Trac #33743: Faster random tree generator\n\n773ec37bec Trac #33740: Add conda dev environment\n\n5e65c16108 Trac #33734: variety() for polynomial systems over \u211a using msolve\n\n8e7dcca8d3 Trac #33733: allow to use flint for Stirling numbers\n\n6f4efb0bf3 Updated [SageMath](SageMath) version to 9.7.beta0\n\n\n\nmerge was not clean: conflicts in .github/workflows/tox.yml",
    "created_at": "2022-05-22T16:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672966",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>Merge failure on top of:

054e8ed8d9 Trac #33316: Drop support for GCC < 6.3 in Sage 9.7

fa3b529c41 Trac #25833: Upgrade to MathJax 3 and configure Sage

e2ebf445d0 Trac #33825: Use pytest-xdist to run pytest in parallel

b4009625f3 Trac #33824: make gens and orbits of PermutationGroup immutable

af23627f18 Trac #33809: some pathlib in combinat and groups

955b5d994c Trac #33803: Fixes for the distributions sagemath-objects, sagemath-categories

3e6b41f7d6 Trac #33799: Replace SAGE_TMP in doctests of sage.misc.{persist,ostools}, sage.doctest, sage.repl

a3fd7185e3 Trac #33797: sage.misc.temporary_file: Remove use of SAGE_TMP

2ca053010a Trac #33794: modules/fp_graded/morphism.py test failure

7037fba482 Trac #33793: sage.misc.cython: Replace use of SPYX_TMP by a new cached function in sage.misc.temporary_file

d1152701c4 Trac #33787: Installation manual: Update section "system-wide install"

0ae55652cf Trac #33782: ci-cygwin: Update python version

833f53d1cc Trac #33779: Remove use of SAGE_TMP in sage.interfaces.latte

b376a8d71c Trac #33771: SSLContext needs an argument

df168c8112 Trac #33763: Refactor src/sage/docs

9597eafded Trac #33748: make accessing coefficients of finite-field elements easier

f02236f5b6 Trac #33744: Compute bases/circuits in MatroidUnion

8943dc07fc Trac #33743: Faster random tree generator

773ec37bec Trac #33740: Add conda dev environment

5e65c16108 Trac #33734: variety() for polynomial systems over â„š using msolve

8e7dcca8d3 Trac #33733: allow to use flint for Stirling numbers

6f4efb0bf3 Updated [SageMath](SageMath) version to 9.7.beta0



merge was not clean: conflicts in .github/workflows/tox.yml



---

archive/issue_comments_672967.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-05-22T16:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672967",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_672968.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-27T19:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_672969.json:
```json
{
    "body": "Changing commit from \"2b9ef5aa985213832f07fe299fa1c2f608fd0d4e\" to \"5748c2157b28ef12311062743d2e830ec7f79a85\"",
    "created_at": "2022-05-27T19:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672969",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2b9ef5aa985213832f07fe299fa1c2f608fd0d4e" to "5748c2157b28ef12311062743d2e830ec7f79a85"



---

archive/issue_comments_672970.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-05-27T19:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672970",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_088671.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-29T11:29:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33739#event-88671"
}
```



---

archive/issue_comments_672971.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-29T11:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672971",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_672972.json:
```json
{
    "body": "Changing branch from \"public/build/conda_gitpod\" to \"5748c2157b28ef12311062743d2e830ec7f79a85\"",
    "created_at": "2022-05-29T11:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33739#issuecomment-672972",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/build/conda_gitpod" to "5748c2157b28ef12311062743d2e830ec7f79a85"
