# Issue 33639: Replace sage.graphs.graph_editor with a call to phitigra

archive/issues_033402.json:
```json
{
    "body": "phitigra was added as an optional package in #30540.\n\nTo launch the editor:\n\n```\nsage: e = graph_editor()\nsage: e.show()             # the editor widget appears\n```\n\nTo retrieve the graph:\n\n```\nsage: G = e.get_graph()   # G is a copy of the drawn graph, both can be modified independently\n```\n\n\nCC:  @kcrisman @fchapoton @dcoudert @dimpase @jfraymond @novoselt\n\nBranch/Commit: 0549fa931de58dea51edb56a4e2faea278b13e7a\n\nReviewer: Matthias Koeppe, Kwankyu Lee\n\nAuthor: Jean-Florent Raymond\n\nDependencies: #30540\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33639\n\n",
    "closed_at": "2022-05-12T21:42:23Z",
    "created_at": "2022-04-03T18:42:46Z",
    "labels": [
        "component: user interface",
        "blocker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Replace sage.graphs.graph_editor with a call to phitigra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33639",
    "user": "https://github.com/mkoeppe"
}
```
phitigra was added as an optional package in #30540.

To launch the editor:

```
sage: e = graph_editor()
sage: e.show()             # the editor widget appears
```

To retrieve the graph:

```
sage: G = e.get_graph()   # G is a copy of the drawn graph, both can be modified independently
```


CC:  @kcrisman @fchapoton @dcoudert @dimpase @jfraymond @novoselt

Branch/Commit: 0549fa931de58dea51edb56a4e2faea278b13e7a

Reviewer: Matthias Koeppe, Kwankyu Lee

Author: Jean-Florent Raymond

Dependencies: #30540

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33639





---

archive/issue_comments_670671.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#30540\"",
    "created_at": "2022-04-12T06:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670671",
    "user": "https://github.com/jfraymond"
}
```

Changing dependencies from "" to "#30540"



---

archive/issue_comments_670672.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-jfraymond/replace_graph_editor\"",
    "created_at": "2022-04-12T06:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670672",
    "user": "https://github.com/jfraymond"
}
```

Changing branch from "" to "u/gh-jfraymond/replace_graph_editor"



---

archive/issue_comments_670673.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2022-04-12T06:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670673",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_670674.json:
```json
{
    "body": "Changing commit from \"\" to \"94717ee20571f408f482d2008cab3cf1dd2f3129\"",
    "created_at": "2022-04-12T06:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670674",
    "user": "https://github.com/jfraymond"
}
```

Changing commit from "" to "94717ee20571f408f482d2008cab3cf1dd2f3129"



---

archive/issue_comments_670675.json:
```json
{
    "body": "<a id='comment:3'></a>Could you add in the ticket description what should be done to launch the editor.\nI tried in a Jupiter notebook and only got:\n\n```\ngraph_editor()\n<phitigra.graph_editor.GraphEditor object at 0x1755ab820>\n```",
    "created_at": "2022-04-12T09:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670675",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>Could you add in the ticket description what should be done to launch the editor.
I tried in a Jupiter notebook and only got:

```
graph_editor()
<phitigra.graph_editor.GraphEditor object at 0x1755ab820>
```



---

archive/issue_comments_670676.json:
```json
{
    "body": "<a id='comment:4'></a>Yes, I just added it in the description.\n\nIt is slightly different than the previous editor: here we define an editor object, that we have to display (with `.show()`) in order to draw the graph with the mouse. The drawn graph can then be retrieved with the `.get_graph()` method of the editor object.\n\nThe call to `graph_editor` could directly show the widget, but then I don't know how we would retrieve the drawn graph.\n\nBy the way, I am not done with the changes yet, I only pushed the commit so that  I can work on this from a different computer.",
    "created_at": "2022-04-12T11:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670676",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:4'></a>Yes, I just added it in the description.

It is slightly different than the previous editor: here we define an editor object, that we have to display (with `.show()`) in order to draw the graph with the mouse. The drawn graph can then be retrieved with the `.get_graph()` method of the editor object.

The call to `graph_editor` could directly show the widget, but then I don't know how we would retrieve the drawn graph.

By the way, I am not done with the changes yet, I only pushed the commit so that  I can work on this from a different computer.



---

archive/issue_comments_670677.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,9 @@\n phitigra was added as an optional package in #30540.\n \n+To launch the editor:\n+\n+```\n+sage: e = graph_editor()\n+sage: e.show()             # the editor widget appears\n+```\n+\n``````\n",
    "created_at": "2022-04-12T11:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670677",
    "user": "https://github.com/jfraymond"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,9 @@
 phitigra was added as an optional package in #30540.
 
+To launch the editor:
+
+```
+sage: e = graph_editor()
+sage: e.show()             # the editor widget appears
+```
+
``````




---

archive/issue_comments_670678.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,9 @@\n sage: e.show()             # the editor widget appears\n ```\n \n+To retrieve the graph:\n+\n+```\n+sage: G = e.get_graph()   # G is a copy of the drawn graph, both can be modified independently\n+```\n+\n``````\n",
    "created_at": "2022-04-12T11:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670678",
    "user": "https://github.com/jfraymond"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,9 @@
 sage: e.show()             # the editor widget appears
 ```
 
+To retrieve the graph:
+
+```
+sage: G = e.get_graph()   # G is a copy of the drawn graph, both can be modified independently
+```
+
``````




---

archive/issue_comments_670679.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks for working on this!  The old graph editor was really a fantastic resource we loved to show off, and a good replacement  would have been useful even last week for me to advertise.\n\nIf there is the possibility of demonstrating/documenting a few (even if not possible to be tested) examples in your coming updates, that would also be great.  It is likely that this would be used by people \n\nAlso, if we could see whether this works properly in the Sage cell server before it's released in a final version (beta is fine), that would be good, so I'm cc:ing Andrey N.",
    "created_at": "2022-04-12T12:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670679",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>Thanks for working on this!  The old graph editor was really a fantastic resource we loved to show off, and a good replacement  would have been useful even last week for me to advertise.

If there is the possibility of demonstrating/documenting a few (even if not possible to be tested) examples in your coming updates, that would also be great.  It is likely that this would be used by people 

Also, if we could see whether this works properly in the Sage cell server before it's released in a final version (beta is fine), that would be good, so I'm cc:ing Andrey N.



---

archive/issue_comments_670680.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [kcrisman](#comment%3A6):\n> Thanks for working on this!  The old graph editor was really a fantastic resource we loved to show off, and a good replacement  would have been useful even last week for me to advertise.\n> \n> If there is the possibility of demonstrating/documenting a few (even if not possible to be tested) examples in your coming updates, that would also be great.  It is likely that this would be used by people \n> \n> Also, if we could see whether this works properly in the Sage cell server before it's released in a final version (beta is fine), that would be good, so I'm cc:ing Andrey N.\n\n\nHi,\n\nThe repository of the editor widget ( https://github.com/jfraymond/phitigra ) has a demo notebook (`demo.ipynb`) where some of the examples of use are shown.\n\nCurrently it is already possible to try the demo notebook after installing the editor package with `sage -pip`.\n\nDuring a short period of time it was possible to run it on mybinder https://mybinder.org/v2/gh/jfraymond/phitigra/master?filepath=demo.ipynb but for some reason (on the mybinder side?) it stopped working.",
    "created_at": "2022-04-12T12:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670680",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:7'></a>Replying to [kcrisman](#comment%3A6):
> Thanks for working on this!  The old graph editor was really a fantastic resource we loved to show off, and a good replacement  would have been useful even last week for me to advertise.
> 
> If there is the possibility of demonstrating/documenting a few (even if not possible to be tested) examples in your coming updates, that would also be great.  It is likely that this would be used by people 
> 
> Also, if we could see whether this works properly in the Sage cell server before it's released in a final version (beta is fine), that would be good, so I'm cc:ing Andrey N.


Hi,

The repository of the editor widget ( https://github.com/jfraymond/phitigra ) has a demo notebook (`demo.ipynb`) where some of the examples of use are shown.

Currently it is already possible to try the demo notebook after installing the editor package with `sage -pip`.

During a short period of time it was possible to run it on mybinder https://mybinder.org/v2/gh/jfraymond/phitigra/master?filepath=demo.ipynb but for some reason (on the mybinder side?) it stopped working.



---

archive/issue_comments_670681.json:
```json
{
    "body": "<a id='comment:8'></a>I tried on macOS 12.2.1 and it works well. It just needs some documentation.",
    "created_at": "2022-04-12T14:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670681",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>I tried on macOS 12.2.1 and it works well. It just needs some documentation.



---

archive/issue_comments_670682.json:
```json
{
    "body": "<a id='comment:9'></a>\n```\n+    try:\n+        from phitigra import GraphEditor\n+    except ModuleNotFoundError:\n+        raise ModuleNotFoundError(\"The graph editor is provided by the optional package phitigra, which currently not installed.\")\n```\nIt's best to replace this with a \"lazy_import with feature\", similar to \nhttps://github.com/sagemath/sage/blob/develop/src/sage/sat/solvers/picosat.py#L23",
    "created_at": "2022-04-13T01:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670682",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
```
+    try:
+        from phitigra import GraphEditor
+    except ModuleNotFoundError:
+        raise ModuleNotFoundError("The graph editor is provided by the optional package phitigra, which currently not installed.")
```
It's best to replace this with a "lazy_import with feature", similar to 
https://github.com/sagemath/sage/blob/develop/src/sage/sat/solvers/picosat.py#L23



---

archive/issue_comments_670683.json:
```json
{
    "body": "Changing commit from \"94717ee20571f408f482d2008cab3cf1dd2f3129\" to \"6323a380d6c1952ef4a0d312002afe642097b968\"",
    "created_at": "2022-04-20T07:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "94717ee20571f408f482d2008cab3cf1dd2f3129" to "6323a380d6c1952ef4a0d312002afe642097b968"



---

archive/issue_comments_670684.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-20T07:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_670685.json:
```json
{
    "body": "Changing commit from \"6323a380d6c1952ef4a0d312002afe642097b968\" to \"f2adae67566313d5fe58e0a1b283d44eab642c03\"",
    "created_at": "2022-04-20T09:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6323a380d6c1952ef4a0d312002afe642097b968" to "f2adae67566313d5fe58e0a1b283d44eab642c03"



---

archive/issue_comments_670686.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-20T09:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_670687.json:
```json
{
    "body": "Changing author from \"\" to \"Jean-Florent Raymond\"",
    "created_at": "2022-04-20T10:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670687",
    "user": "https://github.com/jfraymond"
}
```

Changing author from "" to "Jean-Florent Raymond"



---

archive/issue_comments_670688.json:
```json
{
    "body": "<a id='comment:12'></a>There are now some live examples of the widget using the recently introduced \".. JUPYTER-EXECUTE::\" sphinx directive (this is the reason why I merged the develop branch). I was not able to completely test them, presumably because the version of sage running them (online?) does not include the current ticket yet. If this is a problem I can revert to a previous commit and add the examples in an other ticket.",
    "created_at": "2022-04-20T10:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670688",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:12'></a>There are now some live examples of the widget using the recently introduced ".. JUPYTER-EXECUTE::" sphinx directive (this is the reason why I merged the develop branch). I was not able to completely test them, presumably because the version of sage running them (online?) does not include the current ticket yet. If this is a problem I can revert to a previous commit and add the examples in an other ticket.



---

archive/issue_comments_670689.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-20T10:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670689",
    "user": "https://github.com/jfraymond"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_670690.json:
```json
{
    "body": "<a id='comment:13'></a>What's the expected behavior of the live examples if phitigra is not installed ?",
    "created_at": "2022-04-20T14:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670690",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:13'></a>What's the expected behavior of the live examples if phitigra is not installed ?



---

archive/issue_comments_670691.json:
```json
{
    "body": "<a id='comment:14'></a>That's a good question. I just tested and the documentation does not build in this case :(.\n\nIf I guessed correctly from what I experienced in this first encounter with sphinx-jupyter\n* there is a non-interactive \"preview\" of the jupyter part generated when building the doc (this clearly requires the package to exist on the computer building the doc)\n* then one can click on the \"Make live\" button and run the code of the cell on some server somewhere in the cloud (for this to work this server as well should have the package)\n\nAs it is an optional package I guess the correct choice here is to remove these live examples, right ?\nBy the way, how should I proceed with the doctests (that also require the package to be installed)? Is there a way to tell sage to skip the tests in a file if the package is not present, of is it better to mark all the examples and tests with `# not tested`? (Tests are being made in the package anyway).",
    "created_at": "2022-04-20T16:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670691",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:14'></a>That's a good question. I just tested and the documentation does not build in this case :(.

If I guessed correctly from what I experienced in this first encounter with sphinx-jupyter
* there is a non-interactive "preview" of the jupyter part generated when building the doc (this clearly requires the package to exist on the computer building the doc)
* then one can click on the "Make live" button and run the code of the cell on some server somewhere in the cloud (for this to work this server as well should have the package)

As it is an optional package I guess the correct choice here is to remove these live examples, right ?
By the way, how should I proceed with the doctests (that also require the package to be installed)? Is there a way to tell sage to skip the tests in a file if the package is not present, of is it better to mark all the examples and tests with `# not tested`? (Tests are being made in the package anyway).



---

archive/issue_comments_670692.json:
```json
{
    "body": "<a id='comment:15'></a>You can try `# optional - phitigra`, but since the introduction of `Feature` other solutions might be better.\n\nMatthias will certainly clarify this.",
    "created_at": "2022-04-20T16:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670692",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>You can try `# optional - phitigra`, but since the introduction of `Feature` other solutions might be better.

Matthias will certainly clarify this.



---

archive/issue_comments_670693.json:
```json
{
    "body": "<a id='comment:16'></a>`# optional - phitigra` is the correct solution, but to make it work, you will have to add a module `sage.features.phitigra`. You can adapt it from `sage.features.igraph`.",
    "created_at": "2022-04-20T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670693",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>`# optional - phitigra` is the correct solution, but to make it work, you will have to add a module `sage.features.phitigra`. You can adapt it from `sage.features.igraph`.



---

archive/issue_comments_670694.json:
```json
{
    "body": "<a id='comment:17'></a>... or adapt it from `sage.features.sphinx`, which is a tiny bit simpler.",
    "created_at": "2022-04-20T20:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670694",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>... or adapt it from `sage.features.sphinx`, which is a tiny bit simpler.



---

archive/issue_comments_670695.json:
```json
{
    "body": "<a id='comment:18'></a>This is a nice addition to sage. Thanks for working on this.\n\nA few comments:\n\n1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.\n\n2. Please respect the developer's guide: https://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files. The file `graph_editor.py` is old, and does not follow the guidelines.",
    "created_at": "2022-04-22T06:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670695",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:18'></a>This is a nice addition to sage. Thanks for working on this.

A few comments:

1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.

2. Please respect the developer's guide: https://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files. The file `graph_editor.py` is old, and does not follow the guidelines.



---

archive/issue_comments_670696.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [klee](#comment%3A18):\n> 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.\n\n\nTo be clear, there is no problem in your using `.. JUPYTER-EXECUTE::` in this ticket.",
    "created_at": "2022-04-22T06:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670696",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:19'></a>Replying to [klee](#comment%3A18):
> 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.


To be clear, there is no problem in your using `.. JUPYTER-EXECUTE::` in this ticket.



---

archive/issue_comments_670697.json:
```json
{
    "body": "<a id='comment:20'></a>Thank you all for the advice!\n\nReplying to [klee](#comment%3A18):\n> 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.\n\n\nIs there a way (maybe with #33320?) to tell sphinx that the **live** code blocks depend on an optional package and should be ignored if the package is not installed (like the `# optional - <package_name>` tag for doctests)?\nIt seems that currently, what is in a `.. JUPYTER-EXECUTE` block gets ran anyway (even with the `# optional - <package_name>` tag) which results in an error if the package is not installed. (I read about the `.. ifconfig::` directive in sphinx's doc to conditionally include some sections but it seems that it comes as an extention that is not in our sphinx install.)",
    "created_at": "2022-04-22T06:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670697",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:20'></a>Thank you all for the advice!

Replying to [klee](#comment%3A18):
> 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.


Is there a way (maybe with #33320?) to tell sphinx that the **live** code blocks depend on an optional package and should be ignored if the package is not installed (like the `# optional - <package_name>` tag for doctests)?
It seems that currently, what is in a `.. JUPYTER-EXECUTE` block gets ran anyway (even with the `# optional - <package_name>` tag) which results in an error if the package is not installed. (I read about the `.. ifconfig::` directive in sphinx's doc to conditionally include some sections but it seems that it comes as an extention that is not in our sphinx install.)



---

archive/issue_comments_670698.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-22T06:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670698",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_670699.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [gh-jfraymond](#comment%3A20):\n> Thank you all for the advice!\n> \n> Replying to [klee](#comment%3A18):\n> > 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.\n  \n> \n> Is there a way (maybe with #33320?) to tell sphinx that the **live** code blocks depend on an optional package and should be ignored if the package is not installed (like the `# optional - <package_name>` tag for doctests)?\n> It seems that currently, what is in a `.. JUPYTER-EXECUTE` block gets ran anyway (even with the `# optional - <package_name>` tag) which results in an error if the package is not installed. (I read about the `.. ifconfig::` directive in sphinx's doc to conditionally include some sections but it seems that it comes as an extension that is not in our sphinx install.)\n\n\nYou mean the error in building the reference manual. Right. Currently there is no way to avoid that. As you observed, the vanilla jupyter-sphinx run the code block in the build time, needlessly for us.\n\nWith #33320, the patched jupyter-sphinx do no run code blocks in the build time. So there should be no problem. But unfortunately as I just checked, because of a bug in #33320, this ticket merged with #33320 still fails. I would work on this.",
    "created_at": "2022-04-22T07:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670699",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:21'></a>Replying to [gh-jfraymond](#comment%3A20):
> Thank you all for the advice!
> 
> Replying to [klee](#comment%3A18):
> > 1. The ticket #33320 would make all code blocks in sage docoumentation runnable. This will in effect deprecate using `.. JUPYTER-EXECUTE::` directly. The ticket needs review too.
  
> 
> Is there a way (maybe with #33320?) to tell sphinx that the **live** code blocks depend on an optional package and should be ignored if the package is not installed (like the `# optional - <package_name>` tag for doctests)?
> It seems that currently, what is in a `.. JUPYTER-EXECUTE` block gets ran anyway (even with the `# optional - <package_name>` tag) which results in an error if the package is not installed. (I read about the `.. ifconfig::` directive in sphinx's doc to conditionally include some sections but it seems that it comes as an extension that is not in our sphinx install.)


You mean the error in building the reference manual. Right. Currently there is no way to avoid that. As you observed, the vanilla jupyter-sphinx run the code block in the build time, needlessly for us.

With #33320, the patched jupyter-sphinx do no run code blocks in the build time. So there should be no problem. But unfortunately as I just checked, because of a bug in #33320, this ticket merged with #33320 still fails. I would work on this.



---

archive/issue_comments_670700.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [klee](#comment%3A21):\n> With #33320, the patched jupyter-sphinx do no run code blocks in the build time. So there should be no problem. But unfortunately as I just checked, because of a bug in #33320, this ticket merged with #33320 still fails. I would work on this. \n\n\nIf you remove the `.. JUPYTER-EXECUTE::` block and build the live doc, there would be no problem.",
    "created_at": "2022-04-22T07:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670700",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:22'></a>Replying to [klee](#comment%3A21):
> With #33320, the patched jupyter-sphinx do no run code blocks in the build time. So there should be no problem. But unfortunately as I just checked, because of a bug in #33320, this ticket merged with #33320 still fails. I would work on this. 


If you remove the `.. JUPYTER-EXECUTE::` block and build the live doc, there would be no problem.



---

archive/issue_comments_670701.json:
```json
{
    "body": "Changing commit from \"f2adae67566313d5fe58e0a1b283d44eab642c03\" to \"961ec2f8cde876384eef8b8a3a2c0cfa65c17282\"",
    "created_at": "2022-04-22T11:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f2adae67566313d5fe58e0a1b283d44eab642c03" to "961ec2f8cde876384eef8b8a3a2c0cfa65c17282"



---

archive/issue_comments_670702.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-22T11:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_670703.json:
```json
{
    "body": "<a id='comment:24'></a>So in the end I removed all examples of live code (with `JUPYTER_EXECUTE`) because otherwise the doc would not build on systems without the package. If at some point (after #33320 is completed?) it becomes possible to have these live examples, I can add them back (in a different ticket).  \n\n\nOn my computer the tests succeed and the doc builds (for this file) regardless of whether phitigra is installed or not.",
    "created_at": "2022-04-22T11:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670703",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:24'></a>So in the end I removed all examples of live code (with `JUPYTER_EXECUTE`) because otherwise the doc would not build on systems without the package. If at some point (after #33320 is completed?) it becomes possible to have these live examples, I can add them back (in a different ticket).  


On my computer the tests succeed and the doc builds (for this file) regardless of whether phitigra is installed or not.



---

archive/issue_comments_670704.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-22T11:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670704",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_670705.json:
```json
{
    "body": "<a id='comment:25'></a>\n```\n+from sage.features import PythonModule\n+lazy_import('phitigra', 'GraphEditor',\n+            feature=PythonModule('phitigra', spkg='phitigra'))\n```\nNow that `sage.features.phitigra.Phitigra` exists, it is best to use it here",
    "created_at": "2022-04-22T19:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670705",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
```
+from sage.features import PythonModule
+lazy_import('phitigra', 'GraphEditor',
+            feature=PythonModule('phitigra', spkg='phitigra'))
```
Now that `sage.features.phitigra.Phitigra` exists, it is best to use it here



---

archive/issue_comments_670706.json:
```json
{
    "body": "Changing commit from \"961ec2f8cde876384eef8b8a3a2c0cfa65c17282\" to \"8b86a033ef7d6c69532ce397f2cb625aacb1a17f\"",
    "created_at": "2022-04-23T07:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "961ec2f8cde876384eef8b8a3a2c0cfa65c17282" to "8b86a033ef7d6c69532ce397f2cb625aacb1a17f"



---

archive/issue_comments_670707.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-23T07:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_670708.json:
```json
{
    "body": "<a id='comment:27'></a>I just replaced like that:\n\n```diff\n-from sage.features import PythonModule\n-lazy_import('phitigra', 'GraphEditor',\n-            feature=PythonModule('phitigra', spkg='phitigra'))\n+from sage.features.phitigra import Phitigra\n+lazy_import('phitigra', 'GraphEditor', feature=Phitigra())\n```",
    "created_at": "2022-04-23T07:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670708",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:27'></a>I just replaced like that:

```diff
-from sage.features import PythonModule
-lazy_import('phitigra', 'GraphEditor',
-            feature=PythonModule('phitigra', spkg='phitigra'))
+from sage.features.phitigra import Phitigra
+lazy_import('phitigra', 'GraphEditor', feature=Phitigra())
```



---

archive/issue_comments_670709.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe, ...\"",
    "created_at": "2022-04-23T17:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670709",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe, ..."



---

archive/issue_comments_670710.json:
```json
{
    "body": "<a id='comment:28'></a>Thanks, the use of `Feature`s looks good now.",
    "created_at": "2022-04-23T17:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670710",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Thanks, the use of `Feature`s looks good now.



---

archive/issue_comments_670711.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Kwankyu Lee\"",
    "created_at": "2022-04-24T09:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670711",
    "user": "https://github.com/kwankyu"
}
```

Changing reviewer from "Matthias Koeppe, ..." to "Matthias Koeppe, Kwankyu Lee"



---

archive/issue_comments_670712.json:
```json
{
    "body": "Changing commit from \"8b86a033ef7d6c69532ce397f2cb625aacb1a17f\" to \"967cd5d6023a90b1f8c4613756e68400bff866ca\"",
    "created_at": "2022-04-24T09:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670712",
    "user": "https://github.com/kwankyu"
}
```

Changing commit from "8b86a033ef7d6c69532ce397f2cb625aacb1a17f" to "967cd5d6023a90b1f8c4613756e68400bff866ca"



---

archive/issue_comments_670713.json:
```json
{
    "body": "Changing branch from \"u/gh-jfraymond/replace_graph_editor\" to \"public/33639\"",
    "created_at": "2022-04-24T09:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670713",
    "user": "https://github.com/kwankyu"
}
```

Changing branch from "u/gh-jfraymond/replace_graph_editor" to "public/33639"



---

archive/issue_comments_670714.json:
```json
{
    "body": "<a id='comment:29'></a>New commits:",
    "created_at": "2022-04-24T09:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670714",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:29'></a>New commits:



---

archive/issue_comments_670715.json:
```json
{
    "body": "<a id='comment:30'></a>I did some edits. If you are okay with those, then you can give positive review.",
    "created_at": "2022-04-24T09:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670715",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:30'></a>I did some edits. If you are okay with those, then you can give positive review.



---

archive/issue_comments_670716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-24T10:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670716",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_670717.json:
```json
{
    "body": "<a id='comment:31'></a>Thanks!",
    "created_at": "2022-04-24T10:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670717",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:31'></a>Thanks!



---

archive/issue_comments_670718.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2022-05-07T18:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670718",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_670719.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-05-08T07:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_670720.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-05-08T07:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_670721.json:
```json
{
    "body": "Changing commit from \"967cd5d6023a90b1f8c4613756e68400bff866ca\" to \"0549fa931de58dea51edb56a4e2faea278b13e7a\"",
    "created_at": "2022-05-08T07:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "967cd5d6023a90b1f8c4613756e68400bff866ca" to "0549fa931de58dea51edb56a4e2faea278b13e7a"



---

archive/issue_comments_670722.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-08T07:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670722",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_670723.json:
```json
{
    "body": "<a id='comment:34'></a>this was not necessary ; patchbot is dumb and only giving advice\n\nsuggestion : never ever do something on a positive reviewed ticket, unless it is critical",
    "created_at": "2022-05-08T07:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670723",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'></a>this was not necessary ; patchbot is dumb and only giving advice

suggestion : never ever do something on a positive reviewed ticket, unless it is critical



---

archive/issue_comments_670724.json:
```json
{
    "body": "<a id='comment:35'></a>OK, thanks for the advice and sorry for the useless commit then.\nI though this was what was preventing the ticket to be closed.\nAnd indeed the patchbot can be dumb, here I think it was the word \"sagenb\" **in a comment** that was causing the problem.",
    "created_at": "2022-05-08T07:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670724",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:35'></a>OK, thanks for the advice and sorry for the useless commit then.
I though this was what was preventing the ticket to be closed.
And indeed the patchbot can be dumb, here I think it was the word "sagenb" **in a comment** that was causing the problem.



---

archive/issue_comments_670725.json:
```json
{
    "body": "<a id='comment:36'></a>Bah, \u00e7a prend toujours une plombe pour qu'un ticket soit int\u00e9gr\u00e9 dans sage. Et encore plus longtemps quand on est dans une p\u00e9riode juste avant une nouvelle version. La 9.6 ne va pas tarder.",
    "created_at": "2022-05-08T07:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670725",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>Bah, ça prend toujours une plombe pour qu'un ticket soit intégré dans sage. Et encore plus longtemps quand on est dans une période juste avant une nouvelle version. La 9.6 ne va pas tarder.



---

archive/issue_events_088470.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-12T21:42:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33639#event-88470"
}
```



---

archive/issue_comments_670726.json:
```json
{
    "body": "Changing branch from \"public/33639\" to \"0549fa931de58dea51edb56a4e2faea278b13e7a\"",
    "created_at": "2022-05-12T21:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670726",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/33639" to "0549fa931de58dea51edb56a4e2faea278b13e7a"



---

archive/issue_comments_670727.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-12T21:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-670727",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
