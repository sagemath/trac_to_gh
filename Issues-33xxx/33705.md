# Issue 33705: "make doc-clean" should remove inventory, doctrees

archive/issues_033468.json:
```json
{
    "body": "Followup to #29310, #33104\n\nWe could consider to extend `make doc-clean` so that it also removes `inventory`, `doctrees`.\nThis should suffice to resolve incremental docbuild problems. \n\n\nCC:  @jhpalmieri @kwankyu\n\nBranch/Commit: 824412689ec642d17b04edbec893d53e510dfc21\n\nReviewer: Matthias Koeppe\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33705\n\n",
    "closed_at": "2022-07-28T19:10:18Z",
    "created_at": "2022-04-13T17:01:11Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "\"make doc-clean\" should remove inventory, doctrees",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33705",
    "user": "https://github.com/mkoeppe"
}
```
Followup to #29310, #33104

We could consider to extend `make doc-clean` so that it also removes `inventory`, `doctrees`.
This should suffice to resolve incremental docbuild problems. 


CC:  @jhpalmieri @kwankyu

Branch/Commit: 824412689ec642d17b04edbec893d53e510dfc21

Reviewer: Matthias Koeppe

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33705





---

archive/issue_comments_672117.json:
```json
{
    "body": "<a id='comment:1'></a>\nA related change that may be taken care of, if we follow the proposal on this ticket:\n\n```diff\ndiff --git a/build/make/Makefile.in b/build/make/Makefile.in\nindex d42b261b3d..75bfa250df 100644\n--- a/build/make/Makefile.in\n+++ b/build/make/Makefile.in\n@@ -340,9 +340,9 @@ doc-html: sagemath_doc_html\n \n # 'doc-html-no-plot': build docs without building the graphics coming\n # from the '.. plot' directive, in case you want to save a few\n-# megabytes of disk space. 'doc-clean' is a prerequisite because the\n+# megabytes of disk space. 'doc-uninstall' is a prerequisite because the\n # presence of graphics is cached in src/doc/output.\n-doc-html-no-plot: doc-clean\n+doc-html-no-plot: doc-uninstall\n        +$(MAKE_REC) SAGE_DOCBUILD_OPTS=\"$(SAGE_DOCBUILD_OPTS) --no-plot\" doc-html\n \n # Using mathjax is actually the only options, but we keep\n```",
    "created_at": "2022-04-14T22:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672117",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
A related change that may be taken care of, if we follow the proposal on this ticket:

```diff
diff --git a/build/make/Makefile.in b/build/make/Makefile.in
index d42b261b3d..75bfa250df 100644
--- a/build/make/Makefile.in
+++ b/build/make/Makefile.in
@@ -340,9 +340,9 @@ doc-html: sagemath_doc_html
 
 # 'doc-html-no-plot': build docs without building the graphics coming
 # from the '.. plot' directive, in case you want to save a few
-# megabytes of disk space. 'doc-clean' is a prerequisite because the
+# megabytes of disk space. 'doc-uninstall' is a prerequisite because the
 # presence of graphics is cached in src/doc/output.
-doc-html-no-plot: doc-clean
+doc-html-no-plot: doc-uninstall
        +$(MAKE_REC) SAGE_DOCBUILD_OPTS="$(SAGE_DOCBUILD_OPTS) --no-plot" doc-html
 
 # Using mathjax is actually the only options, but we keep
```



---

archive/issue_comments_672118.json:
```json
{
    "body": "<a id='comment:2'></a>\nFor typical Sage packages, what is the difference between `make PKG-clean` and `make PKG-uninstall`?",
    "created_at": "2022-04-14T22:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672118",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
For typical Sage packages, what is the difference between `make PKG-clean` and `make PKG-uninstall`?



---

archive/issue_comments_672119.json:
```json
{
    "body": "<a id='comment:3'></a>\nFor normal Sage packages, `make PKG-clean` really uninstalls and should be renamed (with deprecation) to `make PKG-uninstall` (as discussed in #29097).\n\nThere's not really much to clean because the build tree for a package is ephemeral - unless `sage -i -s` was used or a build error occurred. So I suppose at some point in the future we could have `make PKG-clean` remove the build directories for the package in `SAGE_LOCAL/var/tmp/sage/build/`.",
    "created_at": "2022-04-14T23:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
For normal Sage packages, `make PKG-clean` really uninstalls and should be renamed (with deprecation) to `make PKG-uninstall` (as discussed in #29097).

There's not really much to clean because the build tree for a package is ephemeral - unless `sage -i -s` was used or a build error occurred. So I suppose at some point in the future we could have `make PKG-clean` remove the build directories for the package in `SAGE_LOCAL/var/tmp/sage/build/`.



---

archive/issue_events_088596.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33705#event-88596"
}
```



---

archive/issue_comments_672120.json:
```json
{
    "body": "<a id='comment:5'></a>\nWe can do this:\n\n```diff\ndiff --git a/src/doc/Makefile b/src/doc/Makefile\nindex 62fb1cafd18..9bf9a1686dc 100644\n--- a/src/doc/Makefile\n+++ b/src/doc/Makefile\n@@ -16,6 +16,8 @@ clean:\n        rm -rf en/reference/*/sage\n        rm -rf en/reference/sage\n        rm -f common/*.pyc\n+       rm -rf ../../local/share/doc/sage/inventory\n+       rm -rf ../../local/share/doc/sage/doctrees\n \n # Sources generated at build time. (For sources generated at bootstrap time, see bootstrap.)\n doc-src:\n```\nI'm not sure how to do this more cleanly without moving the `doc-clean` target into `build/make/Makefile.in`, in which case `./configure` probably gets run when you run `make doc-clean`. The problem is that no helpful environment variables are defined in the top-level `Makefile`.",
    "created_at": "2022-06-16T22:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672120",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
We can do this:

```diff
diff --git a/src/doc/Makefile b/src/doc/Makefile
index 62fb1cafd18..9bf9a1686dc 100644
--- a/src/doc/Makefile
+++ b/src/doc/Makefile
@@ -16,6 +16,8 @@ clean:
        rm -rf en/reference/*/sage
        rm -rf en/reference/sage
        rm -f common/*.pyc
+       rm -rf ../../local/share/doc/sage/inventory
+       rm -rf ../../local/share/doc/sage/doctrees
 
 # Sources generated at build time. (For sources generated at bootstrap time, see bootstrap.)
 doc-src:
```
I'm not sure how to do this more cleanly without moving the `doc-clean` target into `build/make/Makefile.in`, in which case `./configure` probably gets run when you run `make doc-clean`. The problem is that no helpful environment variables are defined in the top-level `Makefile`.



---

archive/issue_comments_672121.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jhpalmieri/33705-make-doc-clean\"",
    "created_at": "2022-07-22T20:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672121",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "" to "u/jhpalmieri/33705-make-doc-clean"



---

archive/issue_comments_672122.json:
```json
{
    "body": "Changing author from \"\" to \"John Palmieri\"",
    "created_at": "2022-07-22T20:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672122",
    "user": "https://github.com/jhpalmieri"
}
```

Changing author from "" to "John Palmieri"



---

archive/issue_comments_672123.json:
```json
{
    "body": "Changing commit from \"\" to \"589d844120c2ef7abacb5f6bf357773972fd9a54\"",
    "created_at": "2022-07-22T20:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672123",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "589d844120c2ef7abacb5f6bf357773972fd9a54"



---

archive/issue_comments_672124.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-22T20:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672124",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_672125.json:
```json
{
    "body": "<a id='comment:7'></a>\nReady for review.\n\nI don't think we need the change from[comment:1](#comment%3A1), but it does raise a question: if I run `make doc-html-no-plot`, I get an error:\n\n```\nmake[1]: *** No rule to make target `doc-clean', needed by `doc-html-no-plot'.  Stop.\n```\nDo `make` targets (like `doc-clean`) from the top-level `Makefile` need to reproduced in `build/make/Makefile.in` if we want to refer to them?\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|\n|[2633cc9](https://git.sagemath.org/sage.git/commit?id=2633cc9b0e65e80c25a41eb0afb31aa2512a199a)|`build/sage_bootstrap/uninstall.py: Do not refuse to uninstall packages that do not exist in the source tree`|\n|[dbc61b3](https://git.sagemath.org/sage.git/commit?id=dbc61b3b29e36ac84031b8665486d7623ceaf5c5)|`build/sage_bootstrap/uninstall.py: Do not override the stamp file location from environment variable`|\n|[3a5ea93](https://git.sagemath.org/sage.git/commit?id=3a5ea93b14204008c3398eec1c24262a4e4a0277)|`build/make/Makefile.in: New implicit targets %-SAGE_LOCAL-uninstall, %-SAGE_VENV-uninstall`|\n|[65a5604](https://git.sagemath.org/sage.git/commit?id=65a56047d5933990cc3a65ef437b530a08aa3f7b)|`trac 29097: change \"make SPKG-clean\" to \"make SPKG-uninstall\".`|\n|[4609606](https://git.sagemath.org/sage.git/commit?id=46096069a2b56db02e600ccb542e3823d2d7c322)|`build/make/Makefile.in: Also add implicit rule %-uninstall`|\n|[e9b30bb](https://git.sagemath.org/sage.git/commit?id=e9b30bb31428885a6bebbf6a56f7491431046554)|`build/sage_bootstrap/uninstall.py: Update comment`|\n|[fef04d0](https://git.sagemath.org/sage.git/commit?id=fef04d0cf798c43d33f40a2f4aa5ad04395ed6e9)|`build/sage_bootstrap/uninstall.py: Clarify that the sage_local argument is SAGE_LOCAL or SAGE_VENV`|\n|[9693865](https://git.sagemath.org/sage.git/commit?id=9693865b1eabba0fd125679c1d25e13365d9211c)|`build/make/Makefile.in: Clarify SAGE_I_TARGETS`|\n|[72695aa](https://git.sagemath.org/sage.git/commit?id=72695aa2ee6c9c87e427933f11326d55f5ecc2c6)|`build/sage_bootstrap/uninstall.py: Fix typo in docstring`|\n|[589d844](https://git.sagemath.org/sage.git/commit?id=589d844120c2ef7abacb5f6bf357773972fd9a54)|`trac 33705: \"make doc-clean\" should delete doctrees and inventory`|",
    "created_at": "2022-07-22T20:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672125",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Ready for review.

I don't think we need the change from[comment:1](#comment%3A1), but it does raise a question: if I run `make doc-html-no-plot`, I get an error:

```
make[1]: *** No rule to make target `doc-clean', needed by `doc-html-no-plot'.  Stop.
```
Do `make` targets (like `doc-clean`) from the top-level `Makefile` need to reproduced in `build/make/Makefile.in` if we want to refer to them?

---
New commits:
|                                                                                                                                          |                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
|[2633cc9](https://git.sagemath.org/sage.git/commit?id=2633cc9b0e65e80c25a41eb0afb31aa2512a199a)|`build/sage_bootstrap/uninstall.py: Do not refuse to uninstall packages that do not exist in the source tree`|
|[dbc61b3](https://git.sagemath.org/sage.git/commit?id=dbc61b3b29e36ac84031b8665486d7623ceaf5c5)|`build/sage_bootstrap/uninstall.py: Do not override the stamp file location from environment variable`|
|[3a5ea93](https://git.sagemath.org/sage.git/commit?id=3a5ea93b14204008c3398eec1c24262a4e4a0277)|`build/make/Makefile.in: New implicit targets %-SAGE_LOCAL-uninstall, %-SAGE_VENV-uninstall`|
|[65a5604](https://git.sagemath.org/sage.git/commit?id=65a56047d5933990cc3a65ef437b530a08aa3f7b)|`trac 29097: change "make SPKG-clean" to "make SPKG-uninstall".`|
|[4609606](https://git.sagemath.org/sage.git/commit?id=46096069a2b56db02e600ccb542e3823d2d7c322)|`build/make/Makefile.in: Also add implicit rule %-uninstall`|
|[e9b30bb](https://git.sagemath.org/sage.git/commit?id=e9b30bb31428885a6bebbf6a56f7491431046554)|`build/sage_bootstrap/uninstall.py: Update comment`|
|[fef04d0](https://git.sagemath.org/sage.git/commit?id=fef04d0cf798c43d33f40a2f4aa5ad04395ed6e9)|`build/sage_bootstrap/uninstall.py: Clarify that the sage_local argument is SAGE_LOCAL or SAGE_VENV`|
|[9693865](https://git.sagemath.org/sage.git/commit?id=9693865b1eabba0fd125679c1d25e13365d9211c)|`build/make/Makefile.in: Clarify SAGE_I_TARGETS`|
|[72695aa](https://git.sagemath.org/sage.git/commit?id=72695aa2ee6c9c87e427933f11326d55f5ecc2c6)|`build/sage_bootstrap/uninstall.py: Fix typo in docstring`|
|[589d844](https://git.sagemath.org/sage.git/commit?id=589d844120c2ef7abacb5f6bf357773972fd9a54)|`trac 33705: "make doc-clean" should delete doctrees and inventory`|



---

archive/issue_comments_672126.json:
```json
{
    "body": "Changing commit from \"589d844120c2ef7abacb5f6bf357773972fd9a54\" to \"aa5ddb67735e14c13c028a8a152e5a44c02eda2f\"",
    "created_at": "2022-07-22T20:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "589d844120c2ef7abacb5f6bf357773972fd9a54" to "aa5ddb67735e14c13c028a8a152e5a44c02eda2f"



---

archive/issue_comments_672127.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[aa5ddb6](https://git.sagemath.org/sage.git/commit/?id=aa5ddb67735e14c13c028a8a152e5a44c02eda2f)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|",
    "created_at": "2022-07-22T20:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[aa5ddb6](https://git.sagemath.org/sage.git/commit/?id=aa5ddb67735e14c13c028a8a152e5a44c02eda2f)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|



---

archive/issue_comments_672128.json:
```json
{
    "body": "<a id='comment:9'></a>\n(Ignore the first bunch of commits. I think this should just be based on `develop`, so that's what I've now done.)",
    "created_at": "2022-07-22T20:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672128",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
(Ignore the first bunch of commits. I think this should just be based on `develop`, so that's what I've now done.)



---

archive/issue_comments_672129.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29097\"",
    "created_at": "2022-07-22T21:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672129",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29097"



---

archive/issue_comments_672130.json:
```json
{
    "body": "<a id='comment:11'></a>\nOh, OK",
    "created_at": "2022-07-22T21:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672130",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Oh, OK



---

archive/issue_comments_672131.json:
```json
{
    "body": "Changing dependencies from \"#29097\" to \"\"",
    "created_at": "2022-07-22T21:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672131",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29097" to ""



---

archive/issue_comments_672132.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jhpalmieri](#comment%3A7):\n> if I run `make doc-html-no-plot`, I get an error:\n> \n> ```\n> make[1]: *** No rule to make target `doc-clean', needed by `doc-html-no-plot'.  Stop.\n> ```\n> Do `make` targets (like `doc-clean`) from the top-level `Makefile` need to reproduced in `build/make/Makefile.in` if we want to refer to them?\n\n\nYou can use `(cd $(SAGE_ROOT) && $(MAKE) ....)`",
    "created_at": "2022-07-22T21:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [jhpalmieri](#comment%3A7):
> if I run `make doc-html-no-plot`, I get an error:
> 
> ```
> make[1]: *** No rule to make target `doc-clean', needed by `doc-html-no-plot'.  Stop.
> ```
> Do `make` targets (like `doc-clean`) from the top-level `Makefile` need to reproduced in `build/make/Makefile.in` if we want to refer to them?


You can use `(cd $(SAGE_ROOT) && $(MAKE) ....)`



---

archive/issue_comments_672133.json:
```json
{
    "body": "<a id='comment:13'></a>\nAlso, `SAGE_LOCAL` is not set in the top-level Makefile.",
    "created_at": "2022-07-22T21:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672133",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Also, `SAGE_LOCAL` is not set in the top-level Makefile.



---

archive/issue_comments_672134.json:
```json
{
    "body": "<a id='comment:14'></a>\nWhy is `$$SAGE_LOCAL` used in the `clean` target? Should we make this change?\n\n```diff\ndiff --git a/Makefile b/Makefile\nindex 88107dbb37..e4d36a0308 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -98,13 +98,14 @@ pypi-sdists: sage_setup\n \n SAGE_ROOT = $(CURDIR)\n SAGE_SRC = $(SAGE_ROOT)/src\n+SAGE_LOCAL = $(SAGE_ROOT)/local\n \n clean:\n        @echo \"Deleting package build directories...\"\n        if [ -f \"$(SAGE_SRC)\"/bin/sage-env-config ]; then \\\n            . \"$(SAGE_SRC)\"/bin/sage-env-config; \\\n-           if [ -n \"$$SAGE_LOCAL\" ]; then \\\n-               rm -rf \"$$SAGE_LOCAL/var/tmp/sage/build\"; \\\n+           if [ -n \"$(SAGE_LOCAL)\" ]; then \\\n+               rm -rf \"$(SAGE_LOCAL)/var/tmp/sage/build\"; \\\n            fi; \\\n        fi\n \n```",
    "created_at": "2022-07-22T21:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672134",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Why is `$$SAGE_LOCAL` used in the `clean` target? Should we make this change?

```diff
diff --git a/Makefile b/Makefile
index 88107dbb37..e4d36a0308 100644
--- a/Makefile
+++ b/Makefile
@@ -98,13 +98,14 @@ pypi-sdists: sage_setup
 
 SAGE_ROOT = $(CURDIR)
 SAGE_SRC = $(SAGE_ROOT)/src
+SAGE_LOCAL = $(SAGE_ROOT)/local
 
 clean:
        @echo "Deleting package build directories..."
        if [ -f "$(SAGE_SRC)"/bin/sage-env-config ]; then \
            . "$(SAGE_SRC)"/bin/sage-env-config; \
-           if [ -n "$$SAGE_LOCAL" ]; then \
-               rm -rf "$$SAGE_LOCAL/var/tmp/sage/build"; \
+           if [ -n "$(SAGE_LOCAL)" ]; then \
+               rm -rf "$(SAGE_LOCAL)/var/tmp/sage/build"; \
            fi; \
        fi
 
```



---

archive/issue_comments_672135.json:
```json
{
    "body": "<a id='comment:15'></a>\n`SAGE_LOCAL` is set by `sage-env-config` and is not known to `make`. \nSo one needs to do the substitution in the shell",
    "created_at": "2022-07-22T21:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672135",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
`SAGE_LOCAL` is set by `sage-env-config` and is not known to `make`. 
So one needs to do the substitution in the shell



---

archive/issue_comments_672136.json:
```json
{
    "body": "<a id='comment:16'></a>\nOkay, for the purposes of `make doc-clean`, would it be appropriate to set `SAGE_LOCAL` to be `$(SAGE_ROOT)/local`?",
    "created_at": "2022-07-22T21:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672136",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
Okay, for the purposes of `make doc-clean`, would it be appropriate to set `SAGE_LOCAL` to be `$(SAGE_ROOT)/local`?



---

archive/issue_comments_672137.json:
```json
{
    "body": "<a id='comment:17'></a>\nI think `doc-clean` should use the same method as `clean`: Obtain the correct SAGE_LOCAL via sage-env-config",
    "created_at": "2022-07-22T21:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672137",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
I think `doc-clean` should use the same method as `clean`: Obtain the correct SAGE_LOCAL via sage-env-config



---

archive/issue_comments_672138.json:
```json
{
    "body": "Changing commit from \"aa5ddb67735e14c13c028a8a152e5a44c02eda2f\" to \"fe61ce5cb2e6014ac62b0b9ebc71f14285287bed\"",
    "created_at": "2022-07-22T21:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "aa5ddb67735e14c13c028a8a152e5a44c02eda2f" to "fe61ce5cb2e6014ac62b0b9ebc71f14285287bed"



---

archive/issue_comments_672139.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[fe61ce5](https://git.sagemath.org/sage.git/commit/?id=fe61ce5cb2e6014ac62b0b9ebc71f14285287bed)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|",
    "created_at": "2022-07-22T21:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[fe61ce5](https://git.sagemath.org/sage.git/commit/?id=fe61ce5cb2e6014ac62b0b9ebc71f14285287bed)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|



---

archive/issue_comments_672140.json:
```json
{
    "body": "<a id='comment:19'></a>\nOkay, let's try this. This also fixes the bug with `make doc-html-no-plot`.",
    "created_at": "2022-07-22T21:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672140",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
Okay, let's try this. This also fixes the bug with `make doc-html-no-plot`.



---

archive/issue_comments_672141.json:
```json
{
    "body": "Changing commit from \"fe61ce5cb2e6014ac62b0b9ebc71f14285287bed\" to \"824412689ec642d17b04edbec893d53e510dfc21\"",
    "created_at": "2022-07-22T21:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fe61ce5cb2e6014ac62b0b9ebc71f14285287bed" to "824412689ec642d17b04edbec893d53e510dfc21"



---

archive/issue_comments_672142.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[8244126](https://git.sagemath.org/sage.git/commit/?id=824412689ec642d17b04edbec893d53e510dfc21)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|",
    "created_at": "2022-07-22T21:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[8244126](https://git.sagemath.org/sage.git/commit/?id=824412689ec642d17b04edbec893d53e510dfc21)|`trac 33705: 'make doc-clean' should remove inventory, doctrees`|



---

archive/issue_comments_672143.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-22T22:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672143",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_672144.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-07-22T22:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672144",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_672145.json:
```json
{
    "body": "<a id='comment:22'></a>\nThank you!",
    "created_at": "2022-07-23T03:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672145",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
Thank you!



---

archive/issue_comments_672146.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/33705-make-doc-clean\" to \"824412689ec642d17b04edbec893d53e510dfc21\"",
    "created_at": "2022-07-28T19:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672146",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/33705-make-doc-clean" to "824412689ec642d17b04edbec893d53e510dfc21"



---

archive/issue_events_088597.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-28T19:10:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33705#event-88597"
}
```



---

archive/issue_comments_672147.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-28T19:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33705#issuecomment-672147",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
