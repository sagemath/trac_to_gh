# Issue 33757: commutativity test

archive/issues_033520.json:
```json
{
    "body": "In several places the commutativity of a ring is tested via `isinstance(base_ring, sage.rings.ring.CommutativeRing)` rather than `base_ring in sage.categories.commutative_rings.CommutativeRings()`. This makes it impossible to have a nicely interacting ring that would just inherit from `Parent`.\n\nNote that the answers from `ring.is_commutative()` and `ring in CommutativeRings()` could be different : the former tests the category initialization whether the second could involve some (possibly costly) checks.\n\nThe same remark applies to\n- integral domains\n- fields\n- ...\n\nSee also #32810\n\nCC:  @mantepse @tscrim @xcaruso\n\nBranch/Commit: b9e410d28fbf2ca2c66194071d88073ab2f655b3\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33757\n\n",
    "closed_at": "2022-12-11T11:11:43Z",
    "created_at": "2022-04-25T10:15:16Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "commutativity test",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33757",
    "user": "https://github.com/videlec"
}
```
In several places the commutativity of a ring is tested via `isinstance(base_ring, sage.rings.ring.CommutativeRing)` rather than `base_ring in sage.categories.commutative_rings.CommutativeRings()`. This makes it impossible to have a nicely interacting ring that would just inherit from `Parent`.

Note that the answers from `ring.is_commutative()` and `ring in CommutativeRings()` could be different : the former tests the category initialization whether the second could involve some (possibly costly) checks.

The same remark applies to
- integral domains
- fields
- ...

See also #32810

CC:  @mantepse @tscrim @xcaruso

Branch/Commit: b9e410d28fbf2ca2c66194071d88073ab2f655b3

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33757





---

archive/issue_comments_509794.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n In several places the commutativity of a ring is tested via \\`isinstance(base_ring, sage.rings.ring.CommutativeRing)\\` rather than \\`base_ring in sage.categories.commutative_rings.CommutativeRings()\\`. This makes it impossible to have a nicely interacting ring that would just inherit from \\`Parent\\`.\n \n Note that the answers from \\`ring.is_commutative()\\` and \\`ring in CommutativeRings()\\` could be different : the former tests the category initialization whether the second could involve some (possibly costly) checks.\n+\n+The same remark applies to\n+- integral domains\n+- fields\n+- ...\n \n See also #32810\n \n```\n",
    "created_at": "2022-04-25T10:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509794",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,11 @@
 In several places the commutativity of a ring is tested via \`isinstance(base_ring, sage.rings.ring.CommutativeRing)\` rather than \`base_ring in sage.categories.commutative_rings.CommutativeRings()\`. This makes it impossible to have a nicely interacting ring that would just inherit from \`Parent\`.
 
 Note that the answers from \`ring.is_commutative()\` and \`ring in CommutativeRings()\` could be different : the former tests the category initialization whether the second could involve some (possibly costly) checks.
+
+The same remark applies to
+- integral domains
+- fields
+- ...
 
 See also #32810
 
```




---

archive/issue_events_088698.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33757#event-88698"
}
```



---

archive/issue_comments_509795.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2022-07-03T20:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509795",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_509796.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-03T20:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509796",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_509797.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T06:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509798.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T07:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509799.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T12:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509800.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T14:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509801.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T14:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509802.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-04T19:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509803.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-05T06:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509804.json:
```json
{
    "body": "<a id='comment:11'></a>remains only an issue with lazy rings..",
    "created_at": "2022-07-05T09:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509804",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>remains only an issue with lazy rings..



---

archive/issue_comments_509805.json:
```json
{
    "body": "<a id='comment:12'></a>any idea about the issue in lazy series ?",
    "created_at": "2022-07-05T09:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509805",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>any idea about the issue in lazy series ?



---

archive/issue_comments_509806.json:
```json
{
    "body": "<a id='comment:13'></a>maybe because in vanilla sage:\n\n```\nsage: A.<t> = LazyLaurentSeriesRing(QQ)\nsage: A in Rings()\nTrue\nsage: A in Rings().Commutative()\nTrue\nsage: A in CommutativeRings()\nTrue\nsage: isinstance(A, CommutativeRing)\nFalse\nsage: isinstance(A, Ring)\nFalse\n```\ncompare to\n\n```\nsage: A.<t> = LaurentSeriesRing(QQ)\nsage: A in CommutativeRings()\nTrue\nsage: A in Rings().Commutative()\nTrue\nsage: isinstance(A, Ring)\nTrue\nsage: isinstance(A, CommutativeRing)\nTrue\n```",
    "created_at": "2022-07-05T15:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509806",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>maybe because in vanilla sage:

```
sage: A.<t> = LazyLaurentSeriesRing(QQ)
sage: A in Rings()
True
sage: A in Rings().Commutative()
True
sage: A in CommutativeRings()
True
sage: isinstance(A, CommutativeRing)
False
sage: isinstance(A, Ring)
False
```
compare to

```
sage: A.<t> = LaurentSeriesRing(QQ)
sage: A in CommutativeRings()
True
sage: A in Rings().Commutative()
True
sage: isinstance(A, Ring)
True
sage: isinstance(A, CommutativeRing)
True
```



---

archive/issue_comments_509807.json:
```json
{
    "body": "<a id='comment:15'></a>As a first step:\n\n```\nsage: A.<t> = LazyLaurentSeriesRing(QQ)\nsage: PolynomialRing(A, \"x\")\n```\nfails, but I don't understand why.",
    "created_at": "2022-07-05T19:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509807",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>As a first step:

```
sage: A.<t> = LazyLaurentSeriesRing(QQ)
sage: PolynomialRing(A, "x")
```
fails, but I don't understand why.



---

archive/issue_comments_509808.json:
```json
{
    "body": "<a id='comment:16'></a>Indeed, it's the same problem, that seems to be an issue in constructing the coercion from the base ring. On the other hand, this works with polynomials in several variables\n\n```\nsage: PolynomialRing(A,'x,y')\nMultivariate Polynomial Ring in x, y over Lazy Laurent Series Ring in t over Rational Field\nsage: x,y=_.gens()\nsage: x*y\nx*y\n```",
    "created_at": "2022-07-06T07:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509808",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>Indeed, it's the same problem, that seems to be an issue in constructing the coercion from the base ring. On the other hand, this works with polynomials in several variables

```
sage: PolynomialRing(A,'x,y')
Multivariate Polynomial Ring in x, y over Lazy Laurent Series Ring in t over Rational Field
sage: x,y=_.gens()
sage: x*y
x*y
```



---

archive/issue_comments_509809.json:
```json
{
    "body": "<a id='comment:17'></a>A tiny step forward:\n\nwith (!) your patch, we are calling `Polynomial_generic_dense_inexact.__normalize` (which fails!), whereas without your patch, we are calling `Polynomial_generic_dense.__normalize` (which succeeds).",
    "created_at": "2022-07-06T08:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509809",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:17'></a>A tiny step forward:

with (!) your patch, we are calling `Polynomial_generic_dense_inexact.__normalize` (which fails!), whereas without your patch, we are calling `Polynomial_generic_dense.__normalize` (which succeeds).



---

archive/issue_comments_509810.json:
```json
{
    "body": "<a id='comment:18'></a>Yet another tiny step, probably already noticed by Frederic:\n\nWithout the patch, after the function `PolynomialRing` delegates to `_single_variate`, we check\n\n```\n        if not isinstance(base_ring, ring.CommutativeRing):\n            constructor = polynomial_ring.PolynomialRing_general\n```\nwhich succeeds, because `A.<t> = LazyLaurentSeriesRing(QQ)` does not inherit from `CommutativeRing`.\n\nWith the patch, however, we have instead\n\n```\n        if base_ring not in _CommutativeRings:\n            constructor = polynomial_ring.PolynomialRing_general\n        elif base_ring in _CompleteDiscreteValuationRings:\n            constructor = polynomial_ring.PolynomialRing_cdvr\n        elif base_ring in _CompleteDiscreteValuationFields:\n            constructor = polynomial_ring.PolynomialRing_cdvf\n```\nand, since `A in _CommutativeRings`, it is the last check here which succeeds.\n\nIt is only afterwards that things go wrong: the `element_class` of `PolynomialRing_cdvf` in the dense case is `Polynomial_generic_dense_cdvf`.  This class inherits from `Polynomial_generic_dense_inexact`, which looks wrong to me, because `LazyLaurentSeriesRing(QQ)` is an exact ring.\n\nI don't know whom to ask at this point.  More precisely:\n\n* why does `Polynomial_generic_dense_cdvf` inherit from `Polynomial_generic_dense_inexact` rather than `Polynomial_generic_dense`?  Note that this seems to be the only place where `Polynomial_generic_dense_inexact` is used.\n\n* even if this is wrong, I think that this is only masking a further bug - `LazyLaurentSeriesRing` should work just the same over inexact rings.",
    "created_at": "2022-07-07T12:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509810",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:18'></a>Yet another tiny step, probably already noticed by Frederic:

Without the patch, after the function `PolynomialRing` delegates to `_single_variate`, we check

```
        if not isinstance(base_ring, ring.CommutativeRing):
            constructor = polynomial_ring.PolynomialRing_general
```
which succeeds, because `A.<t> = LazyLaurentSeriesRing(QQ)` does not inherit from `CommutativeRing`.

With the patch, however, we have instead

```
        if base_ring not in _CommutativeRings:
            constructor = polynomial_ring.PolynomialRing_general
        elif base_ring in _CompleteDiscreteValuationRings:
            constructor = polynomial_ring.PolynomialRing_cdvr
        elif base_ring in _CompleteDiscreteValuationFields:
            constructor = polynomial_ring.PolynomialRing_cdvf
```
and, since `A in _CommutativeRings`, it is the last check here which succeeds.

It is only afterwards that things go wrong: the `element_class` of `PolynomialRing_cdvf` in the dense case is `Polynomial_generic_dense_cdvf`.  This class inherits from `Polynomial_generic_dense_inexact`, which looks wrong to me, because `LazyLaurentSeriesRing(QQ)` is an exact ring.

I don't know whom to ask at this point.  More precisely:

* why does `Polynomial_generic_dense_cdvf` inherit from `Polynomial_generic_dense_inexact` rather than `Polynomial_generic_dense`?  Note that this seems to be the only place where `Polynomial_generic_dense_inexact` is used.

* even if this is wrong, I think that this is only masking a further bug - `LazyLaurentSeriesRing` should work just the same over inexact rings.



---

archive/issue_comments_509811.json:
```json
{
    "body": "<a id='comment:19'></a>Maybe Xavier will have an opinion..",
    "created_at": "2022-07-07T13:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509811",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>Maybe Xavier will have an opinion..



---

archive/issue_comments_509812.json:
```json
{
    "body": "<a id='comment:20'></a>I tried to make `LazyCauchyProductSeries` inherit from `RingElement`, but this causes sage to crash:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(ZZ)\nsage: 2*z\nboom\n```",
    "created_at": "2022-07-07T13:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509812",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:20'></a>I tried to make `LazyCauchyProductSeries` inherit from `RingElement`, but this causes sage to crash:

```
sage: L.<z> = LazyLaurentSeriesRing(ZZ)
sage: 2*z
boom
```



---

archive/issue_comments_509813.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-11T19:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509813",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_509814.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-08T12:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509815.json:
```json
{
    "body": "<a id='comment:23'></a>In my opinion, all this says that there must be something rather wrong in Lazy Laurent ring.\n\nMaybe Travis would know better how to fix things ?",
    "created_at": "2022-08-15T06:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509815",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>In my opinion, all this says that there must be something rather wrong in Lazy Laurent ring.

Maybe Travis would know better how to fix things ?



---

archive/issue_comments_509816.json:
```json
{
    "body": "<a id='comment:24'></a>I know Martin showed me what he did, but I cannot reproduce comment:20. I am doing on top of this ticket:\n\n```diff\ndiff --git a/src/sage/rings/lazy_series.py b/src/sage/rings/lazy_series.py\nindex c5034928ab..19657c5559 100644\n--- a/src/sage/rings/lazy_series.py\n+++ b/src/sage/rings/lazy_series.py\n@@ -87,7 +87,7 @@ AUTHORS:\n #                  https://www.gnu.org/licenses/\n # ****************************************************************************\n \n-from sage.structure.element import Element, parent\n+from sage.structure.element import Element, parent, ModuleElement, RingElement\n from sage.structure.richcmp import op_EQ, op_NE\n from sage.functions.other import factorial\n from sage.arith.power import generic_power\n@@ -114,7 +114,7 @@ from sage.data_structures.stream import (\n     Stream_dirichlet_invert\n )\n \n-class LazyModuleElement(Element):\n+class LazyModuleElement(ModuleElement):\n     r\"\"\"\n     A lazy sequence with a module structure given by term-wise\n     addition and scalar multiplication.\n@@ -1974,7 +1974,7 @@ class LazyModuleElement(Element):\n         return self ** (1/ZZ(2))\n \n \n-class LazyCauchyProductSeries(LazyModuleElement):\n+class LazyCauchyProductSeries(RingElement, LazyModuleElement):\n     r\"\"\"\n     A class for series where multiplication is the Cauchy product.\n \n```",
    "created_at": "2022-08-15T06:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509816",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>I know Martin showed me what he did, but I cannot reproduce comment:20. I am doing on top of this ticket:

```diff
diff --git a/src/sage/rings/lazy_series.py b/src/sage/rings/lazy_series.py
index c5034928ab..19657c5559 100644
--- a/src/sage/rings/lazy_series.py
+++ b/src/sage/rings/lazy_series.py
@@ -87,7 +87,7 @@ AUTHORS:
 #                  https://www.gnu.org/licenses/
 # ****************************************************************************
 
-from sage.structure.element import Element, parent
+from sage.structure.element import Element, parent, ModuleElement, RingElement
 from sage.structure.richcmp import op_EQ, op_NE
 from sage.functions.other import factorial
 from sage.arith.power import generic_power
@@ -114,7 +114,7 @@ from sage.data_structures.stream import (
     Stream_dirichlet_invert
 )
 
-class LazyModuleElement(Element):
+class LazyModuleElement(ModuleElement):
     r"""
     A lazy sequence with a module structure given by term-wise
     addition and scalar multiplication.
@@ -1974,7 +1974,7 @@ class LazyModuleElement(Element):
         return self ** (1/ZZ(2))
 
 
-class LazyCauchyProductSeries(LazyModuleElement):
+class LazyCauchyProductSeries(RingElement, LazyModuleElement):
     r"""
     A class for series where multiplication is the Cauchy product.
 
```



---

archive/issue_comments_509817.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T07:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509818.json:
```json
{
    "body": "<a id='comment:26'></a>hhmm, one then meets something like this\n\n```\nFile \"src/sage/rings/lazy_series.py\", line 3375, in sage.rings.lazy_series.LazyDirichletSeries._format_series\nFailed example:\n    f = D([2, 0, 1/(1-z), 3]); f\nExpected:\n    (2)/1^s + ((1+z+z^2+z^3+z^4+z^5+z^6+O(z^7))/3^s) + (3)/4^s\nGot:\n    Traceback (most recent call last):\n      File \"sage/structure/element.pyx\", line 1112, in sage.structure.element.Element.__richcmp__\n      File \"sage/structure/coerce.pyx\", line 1981, in sage.structure.coerce.CoercionModel.richcmp\n      File \"sage/structure/element.pyx\", line 1110, in sage.structure.element.Element.__richcmp__\n      File \"sage/structure/element.pyx\", line 1114, in sage.structure.element.Element._richcmp_\n      File \"/home/chapoton/sage/src/sage/rings/lazy_series.py\", line 512, in _richcmp_\n        raise ValueError(\"undecidable\")\netc...\n```",
    "created_at": "2022-08-18T13:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509818",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>hhmm, one then meets something like this

```
File "src/sage/rings/lazy_series.py", line 3375, in sage.rings.lazy_series.LazyDirichletSeries._format_series
Failed example:
    f = D([2, 0, 1/(1-z), 3]); f
Expected:
    (2)/1^s + ((1+z+z^2+z^3+z^4+z^5+z^6+O(z^7))/3^s) + (3)/4^s
Got:
    Traceback (most recent call last):
      File "sage/structure/element.pyx", line 1112, in sage.structure.element.Element.__richcmp__
      File "sage/structure/coerce.pyx", line 1981, in sage.structure.coerce.CoercionModel.richcmp
      File "sage/structure/element.pyx", line 1110, in sage.structure.element.Element.__richcmp__
      File "sage/structure/element.pyx", line 1114, in sage.structure.element.Element._richcmp_
      File "/home/chapoton/sage/src/sage/rings/lazy_series.py", line 512, in _richcmp_
        raise ValueError("undecidable")
etc...
```



---

archive/issue_comments_509819.json:
```json
{
    "body": "<a id='comment:27'></a>My guess is that is coming from `_lmul_`/`_rmul_` versus `_acted_upon_` not playing nicely. There are some annoying subtle incompatibilities that come up when dealing with `ModuleElement` and some Cython behaviors IIRC.",
    "created_at": "2022-08-19T05:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509819",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>My guess is that is coming from `_lmul_`/`_rmul_` versus `_acted_upon_` not playing nicely. There are some annoying subtle incompatibilities that come up when dealing with `ModuleElement` and some Cython behaviors IIRC.



---

archive/issue_comments_509820.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T07:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_088699.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33757#event-88699"
}
```



---

archive/issue_events_088700.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33757#event-88700"
}
```



---

archive/issue_comments_509821.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-01T11:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509822.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-30T14:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-11-30T16:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509823",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_509824.json:
```json
{
    "body": "<a id='comment:32'></a>and the bot is green !! if the github badge is also green in a few hours, one may want to jump on the occasion",
    "created_at": "2022-11-30T16:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509824",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:32'></a>and the bot is green !! if the github badge is also green in a few hours, one may want to jump on the occasion



---

archive/issue_comments_509825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-01T00:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509825",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509826.json:
```json
{
    "body": "<a id='comment:33'></a>Let it be so.",
    "created_at": "2022-12-01T00:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509826",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>Let it be so.



---

archive/issue_comments_509827.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-11T11:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33757#issuecomment-509827",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088701.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-11T11:11:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33757",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33757#event-88701"
}
```
