# Issue 33141: Fix doctests in sage_setup and sage_docbuild for sage-on-distribution

archive/issues_032904.json:
```json
{
    "assignees": [],
    "body": "Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either\n\n* disabled them on distribution with `# optional - sage_spkg` when source need to be available\n* fix them when it make sense\n* make test of lists more robust by ordering the results when we encounter them\n\nAfter including #33064, #33085 and 32856, the failing doctests are\n\n```\nsage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_setup/find.py\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_setup/find.py\", line 243, in sage_setup.find._cythonized_dir\nFailed example:\n    _cythonized_dir(SAGE_SRC, editable_install=False)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find._cythonized_dir[2]>\", line 1, in <module>\n        _cythonized_dir(SAGE_SRC, editable_install=False)\n      File \"/usr/lib/python3.10/site-packages/sage_setup/find.py\", line 261, in _cythonized_dir\n        return Path(SAGE_ROOT) / \"build\" / \"pkgs\" / \"sagelib\" / \"src\" / \"build\" / \"cythonized\"\n      File \"/usr/lib/python3.10/pathlib.py\", line 958, in __new__\n        self = cls._from_parts(args)\n      File \"/usr/lib/python3.10/pathlib.py\", line 592, in _from_parts\n        drv, root, parts = self._parse_args(args)\n      File \"/usr/lib/python3.10/pathlib.py\", line 576, in _parse_args\n        a = os.fspath(a)\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_setup/find.py\", line 303, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_py.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_py.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.h',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.h',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.h',\n     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.h']\n**********************************************************************\n```\nand\n\n```\n$ sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2022-02-07-11-13-00-56bf74ee.\nUsing --optional=pip,sage\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\nDoctesting 1 file.\nsage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 108, in sage_docbuild.builder_helper\nFailed example:\n    try:  # optional - sagemath_doc_html\n        build_many(build_ref_doc, [(\"docname\", \"en\", \"html\", {})])\n    except Exception as E:\n        \"Non-exception during docbuild: abort pool operation\" in str(E)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 189, in sage_docbuild.DocBuilder._output_dir\nFailed example:\n    b._output_dir('html')         # optional - sagemath_doc_html\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.DocBuilder._output_dir[2]>\", line 1, in <module>\n        b._output_dir('html')         # optional - sagemath_doc_html\n      File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 193, in _output_dir\n        sage_makedirs(d)\n      File \"/usr/lib/python3.10/site-packages/sage/misc/misc.py\", line 90, in sage_makedirs\n        os.makedirs(dirname)\n      File \"/usr/lib/python3.10/os.py\", line 225, in makedirs\n        mkdir(name, mode)\n    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/html/en/tutorial'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 206, in sage_docbuild.DocBuilder._doctrees_dir\nFailed example:\n    b._doctrees_dir()             # optional - sagemath_doc_html\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.DocBuilder._doctrees_dir[2]>\", line 1, in <module>\n        b._doctrees_dir()             # optional - sagemath_doc_html\n      File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 210, in _doctrees_dir\n        sage_makedirs(d)\n      File \"/usr/lib/python3.10/site-packages/sage/misc/misc.py\", line 90, in sage_makedirs\n        os.makedirs(dirname)\n      File \"/usr/lib/python3.10/os.py\", line 215, in makedirs\n        makedirs(head, exist_ok=exist_ok)\n      File \"/usr/lib/python3.10/os.py\", line 215, in makedirs\n        makedirs(head, exist_ok=exist_ok)\n      File \"/usr/lib/python3.10/os.py\", line 225, in makedirs\n        mkdir(name, mode)\n    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/doctrees'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 377, in sage_docbuild.AllBuilder.get_all_documents\nFailed example:\n    'en/tutorial' in documents\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 559, in sage_docbuild.ReferenceBuilder.get_all_documents\nFailed example:\n    refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.ReferenceBuilder.get_all_documents[2]>\", line 1, in <module>\n        refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)\n      File \"/usr/lib/python3.10/os.py\", line 679, in __getitem__\n        raise KeyError(key) from None\n    KeyError: 'SAGE_DOC_SRC'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 560, in sage_docbuild.ReferenceBuilder.get_all_documents\nFailed example:\n    sorted(b.get_all_documents(refdir))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.ReferenceBuilder.get_all_documents[3]>\", line 1, in <module>\n        sorted(b.get_all_documents(refdir))\n    NameError: name 'refdir' is not defined\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 1050, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename\nFailed example:\n    ReferenceSubBuilder(\"reference\").auto_rest_filename(\"sage.combinat.partition\")\nExpected:\n    '.../doc/en/reference/sage/combinat/partition.rst'\nGot:\n    '/usr/share/doc/sage-doc-9999/en/reference/sage/combinat/partition.rst'\n**********************************************************************\n```\n\n\nDepends on #33064\nDepends on #33085\nDepends on #32856\n\nCC:  @antonio-rojas\n\nBranch/Commit: **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Fran\u00e7ois Bissey**\n\nComponent: **distribution**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33141_\n\n",
    "closed_at": "2022-03-21T23:34:41Z",
    "created_at": "2022-01-10T09:20:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix doctests in sage_setup and sage_docbuild for sage-on-distribution",
    "type": "issue",
    "updated_at": "2022-03-21T23:34:41Z",
    "url": "https://github.com/sagemath/sage/issues/33141",
    "user": "https://github.com/kiwifb"
}
```
Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either

* disabled them on distribution with `# optional - sage_spkg` when source need to be available
* fix them when it make sense
* make test of lists more robust by ordering the results when we encounter them

After including #33064, #33085 and 32856, the failing doctests are

```
sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_setup/find.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_setup/find.py", line 243, in sage_setup.find._cythonized_dir
Failed example:
    _cythonized_dir(SAGE_SRC, editable_install=False)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find._cythonized_dir[2]>", line 1, in <module>
        _cythonized_dir(SAGE_SRC, editable_install=False)
      File "/usr/lib/python3.10/site-packages/sage_setup/find.py", line 261, in _cythonized_dir
        return Path(SAGE_ROOT) / "build" / "pkgs" / "sagelib" / "src" / "build" / "cythonized"
      File "/usr/lib/python3.10/pathlib.py", line 958, in __new__
        self = cls._from_parts(args)
      File "/usr/lib/python3.10/pathlib.py", line 592, in _from_parts
        drv, root, parts = self._parse_args(args)
      File "/usr/lib/python3.10/pathlib.py", line 576, in _parse_args
        a = os.fspath(a)
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_setup/find.py", line 303, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_py.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rdf.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rdf.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_py.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.pyx',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.pxd',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_rr.h',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cc.h',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_cdf.h',
     '/usr/lib/python3.10/site-packages/sage/ext/interpreters/wrapper_el.h']
**********************************************************************
```
and

```
$ sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py
too many failed tests, not using stored timings
Running doctests with ID 2022-02-07-11-13-00-56bf74ee.
Using --optional=pip,sage
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Doctesting 1 file.
sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 108, in sage_docbuild.builder_helper
Failed example:
    try:  # optional - sagemath_doc_html
        build_many(build_ref_doc, [("docname", "en", "html", {})])
    except Exception as E:
        "Non-exception during docbuild: abort pool operation" in str(E)
Expected:
    True
Got:
    False
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 189, in sage_docbuild.DocBuilder._output_dir
Failed example:
    b._output_dir('html')         # optional - sagemath_doc_html
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.DocBuilder._output_dir[2]>", line 1, in <module>
        b._output_dir('html')         # optional - sagemath_doc_html
      File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 193, in _output_dir
        sage_makedirs(d)
      File "/usr/lib/python3.10/site-packages/sage/misc/misc.py", line 90, in sage_makedirs
        os.makedirs(dirname)
      File "/usr/lib/python3.10/os.py", line 225, in makedirs
        mkdir(name, mode)
    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/html/en/tutorial'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 206, in sage_docbuild.DocBuilder._doctrees_dir
Failed example:
    b._doctrees_dir()             # optional - sagemath_doc_html
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.DocBuilder._doctrees_dir[2]>", line 1, in <module>
        b._doctrees_dir()             # optional - sagemath_doc_html
      File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 210, in _doctrees_dir
        sage_makedirs(d)
      File "/usr/lib/python3.10/site-packages/sage/misc/misc.py", line 90, in sage_makedirs
        os.makedirs(dirname)
      File "/usr/lib/python3.10/os.py", line 215, in makedirs
        makedirs(head, exist_ok=exist_ok)
      File "/usr/lib/python3.10/os.py", line 215, in makedirs
        makedirs(head, exist_ok=exist_ok)
      File "/usr/lib/python3.10/os.py", line 225, in makedirs
        mkdir(name, mode)
    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/doctrees'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 377, in sage_docbuild.AllBuilder.get_all_documents
Failed example:
    'en/tutorial' in documents
Expected:
    True
Got:
    False
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 559, in sage_docbuild.ReferenceBuilder.get_all_documents
Failed example:
    refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.ReferenceBuilder.get_all_documents[2]>", line 1, in <module>
        refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)
      File "/usr/lib/python3.10/os.py", line 679, in __getitem__
        raise KeyError(key) from None
    KeyError: 'SAGE_DOC_SRC'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 560, in sage_docbuild.ReferenceBuilder.get_all_documents
Failed example:
    sorted(b.get_all_documents(refdir))
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.ReferenceBuilder.get_all_documents[3]>", line 1, in <module>
        sorted(b.get_all_documents(refdir))
    NameError: name 'refdir' is not defined
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 1050, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename
Failed example:
    ReferenceSubBuilder("reference").auto_rest_filename("sage.combinat.partition")
Expected:
    '.../doc/en/reference/sage/combinat/partition.rst'
Got:
    '/usr/share/doc/sage-doc-9999/en/reference/sage/combinat/partition.rst'
**********************************************************************
```


Depends on #33064
Depends on #33085
Depends on #32856

CC:  @antonio-rojas

Branch/Commit: **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**

Reviewer: **Matthias Koeppe**

Author: **François Bissey**

Component: **distribution**

_Issue created by migration from https://trac.sagemath.org/ticket/33141_





---

archive/issue_events_452719.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-01-10T09:20:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452719"
}
```



---

archive/issue_events_452720.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-01-10T09:20:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452720"
}
```



---

archive/issue_events_452721.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-01-10T09:20:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452721"
}
```



---

archive/issue_events_452722.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-01-10T09:20:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452722"
}
```



---

archive/issue_comments_535459.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe first failing doctest expose some funny things in testing `_cythonised_dir`. The test block is as follow\n\n```\n        sage: from sage_setup.find import _cythonized_dir\n        sage: from sage.env import SAGE_SRC\n        sage: _cythonized_dir(SAGE_SRC)  # optional - build\n        PosixPath('...')\n        sage: _cythonized_dir(SAGE_SRC, editable_install=False)\n        PosixPath('.../build/cythonized')\n```\nand the code\n\n```\n    from importlib import import_module\n    from pathlib import Path\n    from sage.env import SAGE_ROOT, SAGE_SRC\n    if editable_install is None:\n        if src_dir is None:\n            src_dir = SAGE_SRC\n        src_dir = Path(src_dir)\n        sage = import_module('sage')\n        d = Path(sage.__file__).resolve().parent.parent\n        editable_install = d == src_dir.resolve()\n    if editable_install:\n        # Editable install: Cython generates files in the source tree\n        return src_dir\n    else:\n        return Path(SAGE_ROOT) / \"build\" / \"pkgs\" / \"sagelib\" / \"src\" / \"build\" / \"cythonized\"\n```\nThe test currently marked as `# optional - build` would succeed on distro. Because `editable_install` is found to be `True` in that case and in the case of Gentoo `SAGE_SRC` is `/usr/lib/python3.10/site-packages` - which is not an editable location :).\n\nWhen `editable_install` is set to `False` the code will always fail on distros since `SAGE_ROOT` is normally `None`. \n\nFor the sake of consistency let's just make them both `# optional - build`.",
    "created_at": "2022-01-10T09:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535459",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">comment:1</div>

The first failing doctest expose some funny things in testing `_cythonised_dir`. The test block is as follow

```
        sage: from sage_setup.find import _cythonized_dir
        sage: from sage.env import SAGE_SRC
        sage: _cythonized_dir(SAGE_SRC)  # optional - build
        PosixPath('...')
        sage: _cythonized_dir(SAGE_SRC, editable_install=False)
        PosixPath('.../build/cythonized')
```
and the code

```
    from importlib import import_module
    from pathlib import Path
    from sage.env import SAGE_ROOT, SAGE_SRC
    if editable_install is None:
        if src_dir is None:
            src_dir = SAGE_SRC
        src_dir = Path(src_dir)
        sage = import_module('sage')
        d = Path(sage.__file__).resolve().parent.parent
        editable_install = d == src_dir.resolve()
    if editable_install:
        # Editable install: Cython generates files in the source tree
        return src_dir
    else:
        return Path(SAGE_ROOT) / "build" / "pkgs" / "sagelib" / "src" / "build" / "cythonized"
```
The test currently marked as `# optional - build` would succeed on distro. Because `editable_install` is found to be `True` in that case and in the case of Gentoo `SAGE_SRC` is `/usr/lib/python3.10/site-packages` - which is not an editable location :).

When `editable_install` is set to `False` the code will always fail on distros since `SAGE_ROOT` is normally `None`. 

For the sake of consistency let's just make them both `# optional - build`.



---

archive/issue_events_452723.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-01-10T21:42:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452723"
}
```



---

archive/issue_comments_535460.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nApart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` (not going to happen after install on a distro) or that `SAGE_DOC_SRC` contains actual doc sources which isn't the case on a distro after install since `SAGE_DOC_SRC` then points to `SAGE_DOC`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07545e9bf3eb33b7f3456d0cd588ead12be69703\"><code>07545e9</code></a></td><td><code>Fix sage_setup doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964\"><code>aa971bd</code></a></td><td><code>Fix doctest in sage_docbuild/__init__.py. Most of the test rely on location that are writable or the presence of documentation sources.</code></td></tr></table>\n",
    "created_at": "2022-01-10T21:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535460",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">comment:2</div>

Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` (not going to happen after install on a distro) or that `SAGE_DOC_SRC` contains actual doc sources which isn't the case on a distro after install since `SAGE_DOC_SRC` then points to `SAGE_DOC`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07545e9bf3eb33b7f3456d0cd588ead12be69703"><code>07545e9</code></a></td><td><code>Fix sage_setup doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964"><code>aa971bd</code></a></td><td><code>Fix doctest in sage_docbuild/__init__.py. Most of the test rely on location that are writable or the presence of documentation sources.</code></td></tr></table>




---

archive/issue_comments_535461.json:
```json
{
    "body": "Commit: **[`aa971bd`](https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964)**",
    "created_at": "2022-01-10T21:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535461",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[`aa971bd`](https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964)**



---

archive/issue_comments_535462.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2022-01-10T21:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535462",
    "user": "https://github.com/kiwifb"
}
```

Author: **François Bissey**



---

archive/issue_comments_535463.json:
```json
{
    "body": "Branch: **[u/fbissey/distro_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/distro_doctests)**",
    "created_at": "2022-01-10T21:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535463",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/distro_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/distro_doctests)**



---

archive/issue_events_452724.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T22:38:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452724"
}
```



---

archive/issue_events_452725.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T22:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452725"
}
```



---

archive/issue_comments_535464.json:
```json
{
    "body": "Dependencies: **#33064, #33085, #32856**",
    "created_at": "2022-01-10T22:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535464",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#33064, #33085, #32856**



---

archive/issue_comments_535465.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOK, I didn't know about those. That changes a lot of things.",
    "created_at": "2022-01-10T23:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535465",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

OK, I didn't know about those. That changes a lot of things.



---

archive/issue_comments_535466.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOK, changes from the three tickets now marked has dependencies need to be taken into account. Only one of the identified doctests is directly linked to the presence of `sage_spkg`. With a few exceptions the rest are more complicated and may require some sort of `sage_src` tag.",
    "created_at": "2022-01-12T03:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535466",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">comment:5</div>

OK, changes from the three tickets now marked has dependencies need to be taken into account. Only one of the identified doctests is directly linked to the presence of `sage_spkg`. With a few exceptions the rest are more complicated and may require some sort of `sage_src` tag.



---

archive/issue_comments_535467.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@kiwifb](#comment%3A2):\n> Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` \n\nAs I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory",
    "created_at": "2022-01-12T04:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535467",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@kiwifb](#comment%3A2):
> Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` 

As I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory



---

archive/issue_comments_535468.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mkoeppe](#comment%3A6):\n> Replying to [@kiwifb](#comment%3A2):\n> > Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` \n\n> \n> As I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory\n\nI do agree that it should be done and it will help some tests. It won't help with a few tests that rely on doc sources themselves to be present.\n\n```\nFile \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 377, in sage_docbuild.AllBuilder.get_all_documents\nFailed example:\n    'en/tutorial' in documents\nExpected:\n    True\nGot:\n    False\n```\nThat may be too much to chew for 9.5.",
    "created_at": "2022-01-12T04:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535468",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mkoeppe](#comment%3A6):
> Replying to [@kiwifb](#comment%3A2):
> > Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` 

> 
> As I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory

I do agree that it should be done and it will help some tests. It won't help with a few tests that rely on doc sources themselves to be present.

```
File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 377, in sage_docbuild.AllBuilder.get_all_documents
Failed example:
    'en/tutorial' in documents
Expected:
    True
Got:
    False
```
That may be too much to chew for 9.5.



---

archive/issue_events_452726.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452726"
}
```



---

archive/issue_events_452727.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452727"
}
```



---

archive/issue_comments_535469.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,9 @@\n Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either\n \n-* disabled them on distribution with `# optional - build`\n+* disabled them on distribution with `# optional - sage_spkg`\n * fix them when it make sense\n \n-The failing doctests are\n+After including #33064, #33085 and 32856, the failing doctests are\n \n ```\n sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_setup/find.py\n@@ -56,11 +56,17 @@\n and\n \n ```\n+$ sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\n+too many failed tests, not using stored timings\n+Running doctests with ID 2022-02-07-11-13-00-56bf74ee.\n+Using --optional=pip,sage\n+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\n+Doctesting 1 file.\n sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\n **********************************************************************\n File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 108, in sage_docbuild.builder_helper\n Failed example:\n-    try:\n+    try:  # optional - sagemath_doc_html\n         build_many(build_ref_doc, [(\"docname\", \"en\", \"html\", {})])\n     except Exception as E:\n         \"Non-exception during docbuild: abort pool operation\" in str(E)\n@@ -69,9 +75,28 @@\n Got:\n     False\n **********************************************************************\n+File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 189, in sage_docbuild.DocBuilder._output_dir\n+Failed example:\n+    b._output_dir('html')         # optional - sagemath_doc_html\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage_docbuild.DocBuilder._output_dir[2]>\", line 1, in <module>\n+        b._output_dir('html')         # optional - sagemath_doc_html\n+      File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 193, in _output_dir\n+        sage_makedirs(d)\n+      File \"/usr/lib/python3.10/site-packages/sage/misc/misc.py\", line 90, in sage_makedirs\n+        os.makedirs(dirname)\n+      File \"/usr/lib/python3.10/os.py\", line 225, in makedirs\n+        mkdir(name, mode)\n+    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/html/en/tutorial'\n+**********************************************************************\n File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 206, in sage_docbuild.DocBuilder._doctrees_dir\n Failed example:\n-    b._doctrees_dir()\n+    b._doctrees_dir()             # optional - sagemath_doc_html\n Exception raised:\n     Traceback (most recent call last):\n       File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n@@ -79,7 +104,7 @@\n       File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n         exec(compiled, globs)\n       File \"<doctest sage_docbuild.DocBuilder._doctrees_dir[2]>\", line 1, in <module>\n-        b._doctrees_dir()\n+        b._doctrees_dir()             # optional - sagemath_doc_html\n       File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 210, in _doctrees_dir\n         sage_makedirs(d)\n       File \"/usr/lib/python3.10/site-packages/sage/misc/misc.py\", line 90, in sage_makedirs\n@@ -100,7 +125,7 @@\n Got:\n     False\n **********************************************************************\n-File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 605, in sage_docbuild.ReferenceBuilder.get_all_documents\n+File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 559, in sage_docbuild.ReferenceBuilder.get_all_documents\n Failed example:\n     refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)\n Exception raised:\n@@ -115,7 +140,7 @@\n         raise KeyError(key) from None\n     KeyError: 'SAGE_DOC_SRC'\n **********************************************************************\n-File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 606, in sage_docbuild.ReferenceBuilder.get_all_documents\n+File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 560, in sage_docbuild.ReferenceBuilder.get_all_documents\n Failed example:\n     sorted(b.get_all_documents(refdir))\n Exception raised:\n@@ -128,7 +153,7 @@\n         sorted(b.get_all_documents(refdir))\n     NameError: name 'refdir' is not defined\n **********************************************************************\n-File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 1093, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename\n+File \"/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 1050, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename\n Failed example:\n     ReferenceSubBuilder(\"reference\").auto_rest_filename(\"sage.combinat.partition\")\n Expected:\n``````\n",
    "created_at": "2022-02-06T22:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535469",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,9 @@
 Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either
 
-* disabled them on distribution with `# optional - build`
+* disabled them on distribution with `# optional - sage_spkg`
 * fix them when it make sense
 
-The failing doctests are
+After including #33064, #33085 and 32856, the failing doctests are
 
 ```
 sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_setup/find.py
@@ -56,11 +56,17 @@
 and
 
 ```
+$ sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py
+too many failed tests, not using stored timings
+Running doctests with ID 2022-02-07-11-13-00-56bf74ee.
+Using --optional=pip,sage
+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
+Doctesting 1 file.
 sage -t --long --random-seed=204418260052577960635697341654995479733 /usr/lib/python3.10/site-packages/sage_docbuild/__init__.py
 **********************************************************************
 File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 108, in sage_docbuild.builder_helper
 Failed example:
-    try:
+    try:  # optional - sagemath_doc_html
         build_many(build_ref_doc, [("docname", "en", "html", {})])
     except Exception as E:
         "Non-exception during docbuild: abort pool operation" in str(E)
@@ -69,9 +75,28 @@
 Got:
     False
 **********************************************************************
+File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 189, in sage_docbuild.DocBuilder._output_dir
+Failed example:
+    b._output_dir('html')         # optional - sagemath_doc_html
+Exception raised:
+    Traceback (most recent call last):
+      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage_docbuild.DocBuilder._output_dir[2]>", line 1, in <module>
+        b._output_dir('html')         # optional - sagemath_doc_html
+      File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 193, in _output_dir
+        sage_makedirs(d)
+      File "/usr/lib/python3.10/site-packages/sage/misc/misc.py", line 90, in sage_makedirs
+        os.makedirs(dirname)
+      File "/usr/lib/python3.10/os.py", line 225, in makedirs
+        mkdir(name, mode)
+    PermissionError: [Errno 13] Permission denied: '/usr/share/doc/sage-doc-9999/html/en/tutorial'
+**********************************************************************
 File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 206, in sage_docbuild.DocBuilder._doctrees_dir
 Failed example:
-    b._doctrees_dir()
+    b._doctrees_dir()             # optional - sagemath_doc_html
 Exception raised:
     Traceback (most recent call last):
       File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
@@ -79,7 +104,7 @@
       File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
         exec(compiled, globs)
       File "<doctest sage_docbuild.DocBuilder._doctrees_dir[2]>", line 1, in <module>
-        b._doctrees_dir()
+        b._doctrees_dir()             # optional - sagemath_doc_html
       File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 210, in _doctrees_dir
         sage_makedirs(d)
       File "/usr/lib/python3.10/site-packages/sage/misc/misc.py", line 90, in sage_makedirs
@@ -100,7 +125,7 @@
 Got:
     False
 **********************************************************************
-File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 605, in sage_docbuild.ReferenceBuilder.get_all_documents
+File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 559, in sage_docbuild.ReferenceBuilder.get_all_documents
 Failed example:
     refdir = os.path.join(os.environ['SAGE_DOC_SRC'], 'en', b.name)
 Exception raised:
@@ -115,7 +140,7 @@
         raise KeyError(key) from None
     KeyError: 'SAGE_DOC_SRC'
 **********************************************************************
-File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 606, in sage_docbuild.ReferenceBuilder.get_all_documents
+File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 560, in sage_docbuild.ReferenceBuilder.get_all_documents
 Failed example:
     sorted(b.get_all_documents(refdir))
 Exception raised:
@@ -128,7 +153,7 @@
         sorted(b.get_all_documents(refdir))
     NameError: name 'refdir' is not defined
 **********************************************************************
-File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 1093, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename
+File "/usr/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 1050, in sage_docbuild.ReferenceSubBuilder.auto_rest_filename
 Failed example:
     ReferenceSubBuilder("reference").auto_rest_filename("sage.combinat.partition")
 Expected:
``````




---

archive/issue_comments_535470.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@mkoeppe](#comment%3A6):\n> Replying to [@kiwifb](#comment%3A2):\n> > Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` \n\n> \n> As I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory\n\nI tried a few approaches to that. None worked in practice. I have tried to change `SAGE_DOC` at the start of test sequence, and it works when I try it manually, but not when the doctest runs. I tried to set `SAGE_DOC` at the start of `sage-runtests` and it equally failed. I have a feeling `sage_conf.py` does override a lot things.",
    "created_at": "2022-02-07T10:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535470",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@mkoeppe](#comment%3A6):
> Replying to [@kiwifb](#comment%3A2):
> > Apart from one doctest, all the failing doctests in sage_docbuild require access to a writable `SAGE_DOC_SRC` 

> 
> As I said in [#33064 comment:4](https://github.com/sagemath/sage/issues/33064#comment:4), I think these doctests should be changed so that they temporarily set `SAGE_DOC` to a writable temporary directory

I tried a few approaches to that. None worked in practice. I have tried to change `SAGE_DOC` at the start of test sequence, and it works when I try it manually, but not when the doctest runs. I tried to set `SAGE_DOC` at the start of `sage-runtests` and it equally failed. I have a feeling `sage_conf.py` does override a lot things.



---

archive/issue_comments_535471.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nImport of `SAGE_DOC` early in `__init__.py` is why stuff doesn't work as expected. Removing it from the global list at the beginning and importing it only where necessary later helped. I'll see which implementation give the best results, I'd like setting stuff from `sage-runtests` once for all, and it would be more consistent. In the alternative, setting `SAGE_DOC` in the first test involving it is enough to set it for all other tests, so `sage-runtests` would feel a less random location.\n\nAfter that, why is `SAGE_DOC_SRC` seems to be ending up as `None` instead of the same value as `SAGE_DOC` like in normal operation.",
    "created_at": "2022-02-07T21:40:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535471",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Import of `SAGE_DOC` early in `__init__.py` is why stuff doesn't work as expected. Removing it from the global list at the beginning and importing it only where necessary later helped. I'll see which implementation give the best results, I'd like setting stuff from `sage-runtests` once for all, and it would be more consistent. In the alternative, setting `SAGE_DOC` in the first test involving it is enough to set it for all other tests, so `sage-runtests` would feel a less random location.

After that, why is `SAGE_DOC_SRC` seems to be ending up as `None` instead of the same value as `SAGE_DOC` like in normal operation.



---

archive/issue_comments_535472.json:
```json
{
    "body": "Changed commit from **[`aa971bd`](https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964)** to **[`1d0c87f`](https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd)**",
    "created_at": "2022-02-07T22:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535472",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aa971bd`](https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964)** to **[`1d0c87f`](https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd)**



---

archive/issue_comments_535473.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e89193f4f32246ad9ded6d37f1f2f12a589a81f4\"><code>e89193f</code></a></td><td><code>sage_docbuild: do not fail when cache cannot be saved</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18d0477153af6f453a0e84f78030535f6a36ce87\"><code>18d0477</code></a></td><td><code>doctests: remove dochtml label from some tests that don't need docs installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88dd9f3a1611fed0cc66fb838eb85739646dd34d\"><code>88dd9f3</code></a></td><td><code>doctests: add dochtml label to some tests that need docs installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04bcf48ca7ac90ef2d54bf717c7c6a0de7b6f91d\"><code>04bcf48</code></a></td><td><code>Merge branch 'develop' into track33141</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00a4d3de599763760011b28c493a78e92e246445\"><code>00a4d3d</code></a></td><td><code>fixing doctest and marking the one that don't work on distor with optional sage_spkg.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3541fbf6de7f77fe059bb9d55de04f6af404f0dd\"><code>3541fbf</code></a></td><td><code>fix optional syntax</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38af130198fad4d4ee3f9cc44f7f13b61b581468\"><code>38af130</code></a></td><td><code>Set a random SAGE_DOC to run doctests on from sage-runtests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd\"><code>1d0c87f</code></a></td><td><code>Mark doctest that require real source of sage documentation as optional sage_spkg (possibly an abuse of the tag, but there is a real overlap between lack of sage_spkg and sage documentation's sources</code></td></tr></table>\n",
    "created_at": "2022-02-07T22:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535473",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e89193f4f32246ad9ded6d37f1f2f12a589a81f4"><code>e89193f</code></a></td><td><code>sage_docbuild: do not fail when cache cannot be saved</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18d0477153af6f453a0e84f78030535f6a36ce87"><code>18d0477</code></a></td><td><code>doctests: remove dochtml label from some tests that don't need docs installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88dd9f3a1611fed0cc66fb838eb85739646dd34d"><code>88dd9f3</code></a></td><td><code>doctests: add dochtml label to some tests that need docs installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04bcf48ca7ac90ef2d54bf717c7c6a0de7b6f91d"><code>04bcf48</code></a></td><td><code>Merge branch 'develop' into track33141</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00a4d3de599763760011b28c493a78e92e246445"><code>00a4d3d</code></a></td><td><code>fixing doctest and marking the one that don't work on distor with optional sage_spkg.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3541fbf6de7f77fe059bb9d55de04f6af404f0dd"><code>3541fbf</code></a></td><td><code>fix optional syntax</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38af130198fad4d4ee3f9cc44f7f13b61b581468"><code>38af130</code></a></td><td><code>Set a random SAGE_DOC to run doctests on from sage-runtests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd"><code>1d0c87f</code></a></td><td><code>Mark doctest that require real source of sage documentation as optional sage_spkg (possibly an abuse of the tag, but there is a real overlap between lack of sage_spkg and sage documentation's sources</code></td></tr></table>




---

archive/issue_comments_535474.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReady for review. Using `sage_spkg` feels abusive but it is what it is.",
    "created_at": "2022-02-07T22:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535474",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

Ready for review. Using `sage_spkg` feels abusive but it is what it is.



---

archive/issue_comments_535475.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either\n \n-* disabled them on distribution with `# optional - sage_spkg`\n+* disabled them on distribution with `# optional - sage_spkg` when source need to be available\n * fix them when it make sense\n+* have `sage-runtests` set a random folder for `SAGE_DOC` which makes some test more robust and don't require dreal documentation to be installed writable for everyone.  \n \n After including #33064, #33085 and 32856, the failing doctests are\n \n``````\n",
    "created_at": "2022-02-07T22:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535475",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
 Some doctests in sage_setup and sage_docbuild fail in sage-on-distributions. We can either
 
-* disabled them on distribution with `# optional - sage_spkg`
+* disabled them on distribution with `# optional - sage_spkg` when source need to be available
 * fix them when it make sense
+* have `sage-runtests` set a random folder for `SAGE_DOC` which makes some test more robust and don't require dreal documentation to be installed writable for everyone.  
 
 After including #33064, #33085 and 32856, the failing doctests are
 
``````




---

archive/issue_events_452728.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-07T22:24:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452728"
}
```



---

archive/issue_events_452729.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-07T22:24:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452729"
}
```



---

archive/issue_comments_535476.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n@antonio-rojas, since you were interested in #33256 that stuff may be on your list too.",
    "created_at": "2022-02-07T22:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535476",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">comment:14</div>

@antonio-rojas, since you were interested in #33256 that stuff may be on your list too.



---

archive/issue_comments_535477.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kiwifb](#comment%3A14):\n> @antonio-rojas, since you were interested in #33256 that stuff may be on your list too.\n\nThanks. I have never actually run these tests, things building correctly is enough testing for me. I guess it's more important for a source based distro.",
    "created_at": "2022-02-08T08:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535477",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kiwifb](#comment%3A14):
> @antonio-rojas, since you were interested in #33256 that stuff may be on your list too.

Thanks. I have never actually run these tests, things building correctly is enough testing for me. I guess it's more important for a source based distro.



---

archive/issue_events_452730.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-08T20:05:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452730"
}
```



---

archive/issue_events_452731.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-08T20:05:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452731"
}
```



---

archive/issue_comments_535478.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI am having second thoughts about setting stuff in `sage-runtests`. Only stuff in `sage_docbuild` should need it. Other doctests in sage proper relies on its presence as a properly installed thing, not trying to create things in it.",
    "created_at": "2022-02-08T20:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535478",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">comment:16</div>

I am having second thoughts about setting stuff in `sage-runtests`. Only stuff in `sage_docbuild` should need it. Other doctests in sage proper relies on its presence as a properly installed thing, not trying to create things in it.



---

archive/issue_comments_535479.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7\"><code>99e2524</code></a></td><td><code>Make SAGE_DOC a random directory in doctest. It only need to be set for the first doctest and is used by all doctest thereafter. Mark doctests requiring the documentation sources as optional with the sage_skpg tag.</code></td></tr></table>\n",
    "created_at": "2022-02-08T21:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535479",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7"><code>99e2524</code></a></td><td><code>Make SAGE_DOC a random directory in doctest. It only need to be set for the first doctest and is used by all doctest thereafter. Mark doctests requiring the documentation sources as optional with the sage_skpg tag.</code></td></tr></table>




---

archive/issue_comments_535480.json:
```json
{
    "body": "Changed commit from **[`1d0c87f`](https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd)** to **[`99e2524`](https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7)**",
    "created_at": "2022-02-08T21:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535480",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1d0c87f`](https://github.com/sagemath/sagetrac-mirror/commit/1d0c87fe4907ae3e3d9174470de6d813fa1094fd)** to **[`99e2524`](https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7)**



---

archive/issue_events_452732.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-08T21:43:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452732"
}
```



---

archive/issue_events_452733.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-02-08T21:43:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452733"
}
```



---

archive/issue_comments_535481.json:
```json
{
    "body": "Changed commit from **[`99e2524`](https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7)** to **[`54bd2f5`](https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530)**",
    "created_at": "2022-03-01T06:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535481",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`99e2524`](https://github.com/sagemath/sagetrac-mirror/commit/99e2524a0169740cb4cf4f36c5bc9b9a5ee4ede7)** to **[`54bd2f5`](https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530)**



---

archive/issue_comments_535482.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07545e9bf3eb33b7f3456d0cd588ead12be69703\"><code>07545e9</code></a></td><td><code>Fix sage_setup doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964\"><code>aa971bd</code></a></td><td><code>Fix doctest in sage_docbuild/__init__.py. Most of the test rely on location that are writable or the presence of documentation sources.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530\"><code>54bd2f5</code></a></td><td><code>Merge branch 'develop' into distro_doctests</code></td></tr></table>\n",
    "created_at": "2022-03-01T06:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535482",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07545e9bf3eb33b7f3456d0cd588ead12be69703"><code>07545e9</code></a></td><td><code>Fix sage_setup doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa971bd929f7c95829710e00c5b6774304ffa964"><code>aa971bd</code></a></td><td><code>Fix doctest in sage_docbuild/__init__.py. Most of the test rely on location that are writable or the presence of documentation sources.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530"><code>54bd2f5</code></a></td><td><code>Merge branch 'develop' into distro_doctests</code></td></tr></table>




---

archive/issue_comments_535483.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nNot sure what happened when I merged develop into the branch. Looks like some commits disappeared. Will get the branch back into shape.",
    "created_at": "2022-03-01T06:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535483",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

Not sure what happened when I merged develop into the branch. Looks like some commits disappeared. Will get the branch back into shape.



---

archive/issue_events_452734.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-01T06:53:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452734"
}
```



---

archive/issue_events_452735.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-01T06:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452735"
}
```



---

archive/issue_comments_535484.json:
```json
{
    "body": "Changed commit from **[`54bd2f5`](https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530)** to **[`6c1dc29`](https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06)**",
    "created_at": "2022-03-01T07:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535484",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`54bd2f5`](https://github.com/sagemath/sagetrac-mirror/commit/54bd2f5cbb8b7f8c0771b503565246b7e7abd530)** to **[`6c1dc29`](https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06)**



---

archive/issue_comments_535485.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06\"><code>6c1dc29</code></a></td><td><code>replace optional build tag with sage_spkg</code></td></tr></table>\n",
    "created_at": "2022-03-01T07:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535485",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06"><code>6c1dc29</code></a></td><td><code>replace optional build tag with sage_spkg</code></td></tr></table>




---

archive/issue_events_452736.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-01T07:33:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452736"
}
```



---

archive/issue_events_452737.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-03-01T07:33:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452737"
}
```



---

archive/issue_comments_535486.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThere's an `# optional - build` in there, probably not intended",
    "created_at": "2022-03-01T07:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535486",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

There's an `# optional - build` in there, probably not intended



---

archive/issue_comments_535487.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c\"><code>18308fc</code></a></td><td><code>get rid of the last optional build tag</code></td></tr></table>\n",
    "created_at": "2022-03-01T07:48:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535487",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c"><code>18308fc</code></a></td><td><code>get rid of the last optional build tag</code></td></tr></table>




---

archive/issue_comments_535488.json:
```json
{
    "body": "Changed commit from **[`6c1dc29`](https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06)** to **[`18308fc`](https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c)**",
    "created_at": "2022-03-01T07:48:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535488",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6c1dc29`](https://github.com/sagemath/sagetrac-mirror/commit/6c1dc29874c195a4ee6a370ca73b86840f5f3b06)** to **[`18308fc`](https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c)**



---

archive/issue_comments_535489.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@mkoeppe](#comment%3A23):\n> There's an `# optional - build` in there, probably not intended\n\nIndeed there was. Must have escaped because I didn't notice it was on two lines in a row.",
    "created_at": "2022-03-01T07:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535489",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@mkoeppe](#comment%3A23):
> There's an `# optional - build` in there, probably not intended

Indeed there was. Must have escaped because I didn't notice it was on two lines in a row.



---

archive/issue_comments_535490.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI currently have a new interesting issue\n\n```\nFile \"sage_setup/find.py\", line 303, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_el.pxd',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cdf.pxd']\n**********************************************************************\n```\nthe order can be random :) I am not sure why, but with this new way of running the doctests I am trialling, a few tests like this one are off. But in this case there was never any reason for the order, it is just lucky it seemed to always follow that pattern.",
    "created_at": "2022-03-15T22:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535490",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:26" align="right">comment:26</div>

I currently have a new interesting issue

```
File "sage_setup/find.py", line 303, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_py.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_el.pxd',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_py.pxd',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_el.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/var/tmp/portage/sci-mathematics/sage-9999/work/sage-9999/src/sage/ext/interpreters/wrapper_cdf.pxd']
**********************************************************************
```
the order can be random :) I am not sure why, but with this new way of running the doctests I am trialling, a few tests like this one are off. But in this case there was never any reason for the order, it is just lucky it seemed to always follow that pattern.



---

archive/issue_comments_535491.json:
```json
{
    "body": "Changed commit from **[`18308fc`](https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c)** to **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**",
    "created_at": "2022-03-15T23:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535491",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`18308fc`](https://github.com/sagemath/sagetrac-mirror/commit/18308fc6efa732b7174b2e7368e95c73c6fd533c)** to **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**



---

archive/issue_comments_535492.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2c9eeace4712372fd8e41d06f96771af6109c3e\"><code>e2c9eea</code></a></td><td><code>Merge branch 'develop' into distro_doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25\"><code>5382264</code></a></td><td><code>make doctest in find_extra_files more robust by sorting the result so that the order is stable.</code></td></tr></table>\n",
    "created_at": "2022-03-15T23:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535492",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2c9eeace4712372fd8e41d06f96771af6109c3e"><code>e2c9eea</code></a></td><td><code>Merge branch 'develop' into distro_doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25"><code>5382264</code></a></td><td><code>make doctest in find_extra_files more robust by sorting the result so that the order is stable.</code></td></tr></table>




---

archive/issue_comments_535493.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI decided against sorting the test about `extras[\"sage/libs/mpfr\"]` run just before `extras[\"sage/ext/interpreters\"]` because the output is limited to two elements and the doctest, as written, would survive a change of order.",
    "created_at": "2022-03-15T23:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535493",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:28" align="right">comment:28</div>

I decided against sorting the test about `extras["sage/libs/mpfr"]` run just before `extras["sage/ext/interpreters"]` because the output is limited to two elements and the doctest, as written, would survive a change of order.



---

archive/issue_comments_535494.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n * disabled them on distribution with `# optional - sage_spkg` when source need to be available\n * fix them when it make sense\n-* have `sage-runtests` set a random folder for `SAGE_DOC` which makes some test more robust and don't require dreal documentation to be installed writable for everyone.  \n+* make test of lists more robust by ordering the results when we encounter them\n \n After including #33064, #33085 and 32856, the failing doctests are\n \n``````\n",
    "created_at": "2022-03-15T23:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535494",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 * disabled them on distribution with `# optional - sage_spkg` when source need to be available
 * fix them when it make sense
-* have `sage-runtests` set a random folder for `SAGE_DOC` which makes some test more robust and don't require dreal documentation to be installed writable for everyone.  
+* make test of lists more robust by ordering the results when we encounter them
 
 After including #33064, #33085 and 32856, the failing doctests are
 
``````




---

archive/issue_comments_535495.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nLGTM",
    "created_at": "2022-03-17T18:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535495",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

LGTM



---

archive/issue_comments_535496.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-03-17T18:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535496",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_452738.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-17T18:36:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452738"
}
```



---

archive/issue_events_452739.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-17T18:36:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452739"
}
```



---

archive/issue_comments_535497.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI'll need a follow up, one of my commits did not make it in the merge with the last beta and I did not notice. I suspect my tree may have been dirty. Annoying but not a show stopper for the content of this ticket.",
    "created_at": "2022-03-20T22:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535497",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

I'll need a follow up, one of my commits did not make it in the merge with the last beta and I did not notice. I suspect my tree may have been dirty. Annoying but not a show stopper for the content of this ticket.



---

archive/issue_comments_535498.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSome bits of my missing commit were in conflict with #32987 that's probably part of how it happened.",
    "created_at": "2022-03-21T00:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535498",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

Some bits of my missing commit were in conflict with #32987 that's probably part of how it happened.



---

archive/issue_comments_535499.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nFollow up at #33538. I am preferring a follow up because Volker is currently merging this ticket and I am expecting him to close it in the next few days.",
    "created_at": "2022-03-21T00:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535499",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">comment:33</div>

Follow up at #33538. I am preferring a follow up because Volker is currently merging this ticket and I am expecting him to close it in the next few days.



---

archive/issue_events_452740.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-21T23:34:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452740"
}
```



---

archive/issue_events_452741.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b8d91ace4f13f0f7d802da5ce404b28e922304eb",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-03-21T23:34:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33141#event-452741"
}
```



---

archive/issue_comments_535500.json:
```json
{
    "body": "Changed branch from **[u/fbissey/distro_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/distro_doctests)** to **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**",
    "created_at": "2022-03-21T23:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33141",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33141#issuecomment-535500",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/distro_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/distro_doctests)** to **[`5382264`](https://github.com/sagemath/sagetrac-mirror/commit/5382264eb319f8d650fb1ec8bb0bf36ca2d96f25)**
