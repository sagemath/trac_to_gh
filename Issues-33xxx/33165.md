# Issue 33165: faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)

archive/issues_032928.json:
```json
{
    "assignees": [],
    "body": "This seems to be part of what's going wrong in #33156:\n\n```\nsage: R.<x> = GF(31337)[]\nsage: f = R.random_element(degree=999)\nsage: g = R.random_element(degree=9999)\nsage: S.<y> = R.quotient(f)\nsage: %timeit g(y)\n188 ms \u00b1 1.74 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit (g%f)(y)\n16.4 ms \u00b1 31 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit S(g%f)\n2.97 ms \u00b1 185 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nThis patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.\n\nThe following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.\n\nWe also speed up evaluation at monomials in another polynomial ring in a similar way.\n\nBranch/Commit: **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**\n\nReviewer: **Marc Mezzarobba, Travis Scrimshaw**\n\nAuthor: **Lorenz Panny, Marc Mezzarobba, Travis Scrimshaw**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33165_\n\n",
    "closed_at": "2022-02-27T22:00:28Z",
    "created_at": "2022-01-14T04:42:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)",
    "type": "issue",
    "updated_at": "2022-02-27T22:00:28Z",
    "url": "https://github.com/sagemath/sage/issues/33165",
    "user": "https://github.com/yyyyx4"
}
```
This seems to be part of what's going wrong in #33156:

```
sage: R.<x> = GF(31337)[]
sage: f = R.random_element(degree=999)
sage: g = R.random_element(degree=9999)
sage: S.<y> = R.quotient(f)
sage: %timeit g(y)
188 ms ± 1.74 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit (g%f)(y)
16.4 ms ± 31 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit S(g%f)
2.97 ms ± 185 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.

The following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.

We also speed up evaluation at monomials in another polynomial ring in a similar way.

Branch/Commit: **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**

Reviewer: **Marc Mezzarobba, Travis Scrimshaw**

Author: **Lorenz Panny, Marc Mezzarobba, Travis Scrimshaw**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/33165_





---

archive/issue_events_458551.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T04:42:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458551"
}
```



---

archive/issue_events_458552.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T04:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458552"
}
```



---

archive/issue_events_458553.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T04:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458553"
}
```



---

archive/issue_events_458554.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T04:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458554"
}
```



---

archive/issue_comments_535998.json:
```json
{
    "body": "Branch: **[public/33165](https://github.com/sagemath/sagetrac-mirror/tree/public/33165)**",
    "created_at": "2022-01-14T05:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-535998",
    "user": "https://github.com/yyyyx4"
}
```

Branch: **[public/33165](https://github.com/sagemath/sagetrac-mirror/tree/public/33165)**



---

archive/issue_comments_535999.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n 2.97 ms \u00b1 185 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n ```\n \n-We should probably add an optimized code path for evaluation at quotient-ring elements.\n+This patch adds an optimized code path for evaluation at generators of a quotient of the polynomial's parent ring.\n``````\n",
    "created_at": "2022-01-14T05:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-535999",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 2.97 ms ± 185 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
 ```
 
-We should probably add an optimized code path for evaluation at quotient-ring elements.
+This patch adds an optimized code path for evaluation at generators of a quotient of the polynomial's parent ring.
``````




---

archive/issue_comments_536000.json:
```json
{
    "body": "Author: **Lorenz Panny**",
    "created_at": "2022-01-14T05:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536000",
    "user": "https://github.com/yyyyx4"
}
```

Author: **Lorenz Panny**



---

archive/issue_comments_536001.json:
```json
{
    "body": "Commit: **[`fa12ea4`](https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727)**",
    "created_at": "2022-01-14T05:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536001",
    "user": "https://github.com/yyyyx4"
}
```

Commit: **[`fa12ea4`](https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727)**



---

archive/issue_events_458555.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T05:44:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458555"
}
```



---

archive/issue_comments_536002.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWith the patch, `g(y)` is now just as fast as `S(g)`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727\"><code>fa12ea4</code></a></td><td><code>fast path for evaluating g in R[x] at x + R[x]/(f)</code></td></tr></table>\n",
    "created_at": "2022-01-14T05:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536002",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:1" align="right">comment:1</div>

With the patch, `g(y)` is now just as fast as `S(g)`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727"><code>fa12ea4</code></a></td><td><code>fast path for evaluating g in R[x] at x + R[x]/(f)</code></td></tr></table>




---

archive/issue_comments_536003.json:
```json
{
    "body": "Changed commit from **[`fa12ea4`](https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727)** to **[`ba70984`](https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5)**",
    "created_at": "2022-01-14T05:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536003",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fa12ea4`](https://github.com/sagemath/sagetrac-mirror/commit/fa12ea48c43b85d8bb4b634023028315d6333727)** to **[`ba70984`](https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5)**



---

archive/issue_comments_536004.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5\"><code>ba70984</code></a></td><td><code>fast path for evaluating g in R[x] at x + R[x]/(f)</code></td></tr></table>\n",
    "created_at": "2022-01-14T05:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536004",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5"><code>ba70984</code></a></td><td><code>fast path for evaluating g in R[x] at x + R[x]/(f)</code></td></tr></table>




---

archive/issue_comments_536005.json:
```json
{
    "body": "Changed commit from **[`ba70984`](https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5)** to **[`9cd6d4a`](https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6)**",
    "created_at": "2022-01-14T06:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ba70984`](https://github.com/sagemath/sagetrac-mirror/commit/ba70984be03a19408f075ce453ebb917ad46b5b5)** to **[`9cd6d4a`](https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6)**



---

archive/issue_comments_536006.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6\"><code>9cd6d4a</code></a></td><td><code>fast path for evaluating g in R[x] at x+(f) in R[x]/(f)</code></td></tr></table>\n",
    "created_at": "2022-01-14T06:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536006",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6"><code>9cd6d4a</code></a></td><td><code>fast path for evaluating g in R[x] at x+(f) in R[x]/(f)</code></td></tr></table>




---

archive/issue_events_458556.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T08:42:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458556"
}
```



---

archive/issue_events_458557.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T08:42:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458557"
}
```



---

archive/issue_comments_536007.json:
```json
{
    "body": "Changed commit from **[`9cd6d4a`](https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6)** to **[`45bd205`](https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f)**",
    "created_at": "2022-01-14T14:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536007",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9cd6d4a`](https://github.com/sagemath/sagetrac-mirror/commit/9cd6d4aeef0942b20ecdab9556d9c89bd2ee4bc6)** to **[`45bd205`](https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f)**



---

archive/issue_comments_536008.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f\"><code>45bd205</code></a></td><td><code>fast path for evaluating g in R[x] at y in R[y]</code></td></tr></table>\n",
    "created_at": "2022-01-14T14:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536008",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f"><code>45bd205</code></a></td><td><code>fast path for evaluating g in R[x] at y in R[y]</code></td></tr></table>




---

archive/issue_events_458558.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T14:51:15Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "title_is": "faster evaluation of polynomials in R[x] at generators of R[y] or R[x]/(f)",
    "title_was": "evaluating polynomials in R[x] at elements of R[x]/(f) is really slow",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458558"
}
```



---

archive/issue_comments_536009.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n 2.97 ms \u00b1 185 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n ```\n \n-This patch adds an optimized code path for evaluation at generators of a quotient of the polynomial's parent ring.\n+This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.\n``````\n",
    "created_at": "2022-01-14T14:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536009",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 2.97 ms ± 185 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
 ```
 
-This patch adds an optimized code path for evaluation at generators of a quotient of the polynomial's parent ring.
+This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.
``````




---

archive/issue_events_458559.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T14:51:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458559"
}
```



---

archive/issue_events_458560.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T14:51:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458560"
}
```



---

archive/issue_comments_536010.json:
```json
{
    "body": "Changed commit from **[`45bd205`](https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f)** to **[`5394858`](https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c)**",
    "created_at": "2022-01-14T16:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536010",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`45bd205`](https://github.com/sagemath/sagetrac-mirror/commit/45bd205b4c7c788eee3c3c51e2121a3f5213d52f)** to **[`5394858`](https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c)**



---

archive/issue_comments_536011.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c\"><code>5394858</code></a></td><td><code>fast path for evaluating g in R[x] at u or v in R[u,v]</code></td></tr></table>\n",
    "created_at": "2022-01-14T16:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536011",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c"><code>5394858</code></a></td><td><code>fast path for evaluating g in R[x] at u or v in R[u,v]</code></td></tr></table>




---

archive/issue_comments_536012.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,5 @@\n ```\n \n This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.\n+\n+The following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.\n``````\n",
    "created_at": "2022-01-14T16:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536012",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,5 @@
 ```
 
 This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.
+
+The following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.
``````




---

archive/issue_events_458561.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-01-14T16:37:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "title_is": "faster evaluation of polynomials in R[x] at generators of R[y] or R[u,v] or R[x]/(f)",
    "title_was": "faster evaluation of polynomials in R[x] at generators of R[y] or R[x]/(f)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458561"
}
```



---

archive/issue_comments_536013.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13\"><code>89327e5</code></a></td><td><code>#33165 limit slowdown for eval at elts of the base ring</code></td></tr></table>\n",
    "created_at": "2022-02-12T12:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536013",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13"><code>89327e5</code></a></td><td><code>#33165 limit slowdown for eval at elts of the base ring</code></td></tr></table>




---

archive/issue_comments_536014.json:
```json
{
    "body": "Changed commit from **[`5394858`](https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c)** to **[`89327e5`](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)**",
    "created_at": "2022-02-12T12:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536014",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5394858`](https://github.com/sagemath/sagetrac-mirror/commit/5394858bb285191bfd3669e36ddd20b792bc4c9c)** to **[`89327e5`](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)**



---

archive/issue_comments_536015.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhy not do it like this instead?\n\n|                                                                                                                                                 |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[89327e5](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)|`#33165 limit slowdown for eval at elts of the base ring`|\n\nThis avoids slowing down the case of evaluations at elements of the base ring as much, and extends your speed-up to evaluations using keyword syntax.",
    "created_at": "2022-02-12T12:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536015",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:10" align="right">comment:10</div>

Why not do it like this instead?

|                                                                                                                                                 |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[89327e5](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)|`#33165 limit slowdown for eval at elts of the base ring`|

This avoids slowing down the case of evaluations at elements of the base ring as much, and extends your speed-up to evaluations using keyword syntax.



---

archive/issue_comments_536016.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nA few comments since you want to optimize this:\n\n- Instead of `is_MPolynomialRing(parent(a))` why not test `isinstance(a, MPolynomial)`. This should be faster.\n- Use `(<Element> a)._parent` as it is faster. If you don't want to break encapsulation, use `parent(a)` since it is a Cython function instead of a Python method IIRC.\n- It might be good to tweak `change_variable_name` to take advantage of this codepath.",
    "created_at": "2022-02-14T03:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536016",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

A few comments since you want to optimize this:

- Instead of `is_MPolynomialRing(parent(a))` why not test `isinstance(a, MPolynomial)`. This should be faster.
- Use `(<Element> a)._parent` as it is faster. If you don't want to break encapsulation, use `parent(a)` since it is a Cython function instead of a Python method IIRC.
- It might be good to tweak `change_variable_name` to take advantage of this codepath.



---

archive/issue_comments_536017.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaf0ba3b9bf8f990334346ea57517bb94ea76b76\"><code>eaf0ba3</code></a></td><td><code>Merge tag '9.6.beta1' into public/33165</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a\"><code>fcd2dc9</code></a></td><td><code>some optimizations from reviewer</code></td></tr></table>\n",
    "created_at": "2022-02-14T12:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaf0ba3b9bf8f990334346ea57517bb94ea76b76"><code>eaf0ba3</code></a></td><td><code>Merge tag '9.6.beta1' into public/33165</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a"><code>fcd2dc9</code></a></td><td><code>some optimizations from reviewer</code></td></tr></table>




---

archive/issue_comments_536018.json:
```json
{
    "body": "Changed commit from **[`89327e5`](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)** to **[`fcd2dc9`](https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a)**",
    "created_at": "2022-02-14T12:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536018",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`89327e5`](https://github.com/sagemath/sagetrac-mirror/commit/89327e56e2f7773b704c7f4f2d582d4b4f40de13)** to **[`fcd2dc9`](https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a)**



---

archive/issue_comments_536019.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThanks for the suggestions! It's indeed a little bit faster with these changes.",
    "created_at": "2022-02-14T12:51:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536019",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:13" align="right">comment:13</div>

Thanks for the suggestions! It's indeed a little bit faster with these changes.



---

archive/issue_comments_536020.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nPerhaps it would also be good to handle the cases when the input is a monomial? You might be better off using the `ETuple` for the multi polynomial case. At least the monomial input for that would be essentially the same as what you currently have. The univariate  case would take a bit more work.",
    "created_at": "2022-02-14T14:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536020",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Perhaps it would also be good to handle the cases when the input is a monomial? You might be better off using the `ETuple` for the multi polynomial case. At least the monomial input for that would be essentially the same as what you currently have. The univariate  case would take a bit more work.



---

archive/issue_comments_536021.json:
```json
{
    "body": "Changed commit from **[`fcd2dc9`](https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a)** to **[`54fa9e2`](https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586)**",
    "created_at": "2022-02-15T04:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536021",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fcd2dc9`](https://github.com/sagemath/sagetrac-mirror/commit/fcd2dc931a60dd81c363bf678aa4ec4858be8d7a)** to **[`54fa9e2`](https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586)**



---

archive/issue_comments_536022.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586\"><code>54fa9e2</code></a></td><td><code>extend speedup to monomials (not just variables)</code></td></tr></table>\n",
    "created_at": "2022-02-15T04:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536022",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586"><code>54fa9e2</code></a></td><td><code>extend speedup to monomials (not just variables)</code></td></tr></table>




---

archive/issue_comments_536023.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tscrim](#comment:14):\n> Perhaps it would also be good to handle the cases when the input is a monomial?\n\nLike this?\n\n(I didn't adapt the code for monomials in quotient rings because it's not totally obvious when it is worth it to do so.)",
    "created_at": "2022-02-15T04:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536023",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tscrim](#comment:14):
> Perhaps it would also be good to handle the cases when the input is a monomial?

Like this?

(I didn't adapt the code for monomials in quotient rings because it's not totally obvious when it is worth it to do so.)



---

archive/issue_comments_536024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,3 +16,5 @@\n This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.\n \n The following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.\n+\n+We also speed up evaluation at monomials in another polynomial ring in a similar way.\n``````\n",
    "created_at": "2022-02-15T04:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536024",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,3 +16,5 @@
 This patch adds an optimized code path for evaluation at generators of (quotients of) polynomial rings isomorphic to the polynomial's parent. With the new code, `g(y)` is about as fast as `S(g)`.
 
 The following cases are handled: {univariate polynomial rings, multivariate polynomial rings, quotients of univariate polynomial rings} over the same base.
+
+We also speed up evaluation at monomials in another polynomial ring in a similar way.
``````




---

archive/issue_events_458562.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-02-15T04:50:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "title_is": "faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)",
    "title_was": "faster evaluation of polynomials in R[x] at generators of R[y] or R[u,v] or R[x]/(f)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458562"
}
```



---

archive/issue_comments_536025.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee\"><code>1645418</code></a></td><td><code>Some further micro-optimizations and sparse versions to polynomial call.</code></td></tr></table>\n",
    "created_at": "2022-02-15T08:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee"><code>1645418</code></a></td><td><code>Some further micro-optimizations and sparse versions to polynomial call.</code></td></tr></table>




---

archive/issue_comments_536026.json:
```json
{
    "body": "Changed commit from **[`54fa9e2`](https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586)** to **[`1645418`](https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee)**",
    "created_at": "2022-02-15T08:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536026",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`54fa9e2`](https://github.com/sagemath/sagetrac-mirror/commit/54fa9e2a5723ea612bce176fa2b5e1728dee2586)** to **[`1645418`](https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee)**



---

archive/issue_comments_536027.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nYes, thank you. I have also made some additional tweaks to try and get more speed out. Most notable:\n\n- I made sure the handle the dense and sparse cases separately.\n- `0` and constants are handled as further special cases.\n- Not everything that is `x` is true as `is_gen()`:\n\n  ```\n  sage: R.<x> = QQ[]\n  sage: R([0,1]).is_gen()\n  False\n  ```\n  So I now cover this case.\n\nWith my changes, I get just a little tiny bit more (at least it is no worse):\n\n```\nsage: R.<x> = GF(31337)[]\nsage: g = R(list(range(1,1001)))\nsage: U.<t,u,v> = GF(31337)[]\nsage: %timeit g(u)\n1.86 ms \u00b1 10.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)git\n```\nversus your branch\n\n```\nsage: %timeit g(u)\n1.88 ms \u00b1 35.7 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\nI didn't run timing tests extensively, but where I did test, I saw at least a little speedup.",
    "created_at": "2022-02-15T09:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536027",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

Yes, thank you. I have also made some additional tweaks to try and get more speed out. Most notable:

- I made sure the handle the dense and sparse cases separately.
- `0` and constants are handled as further special cases.
- Not everything that is `x` is true as `is_gen()`:

  ```
  sage: R.<x> = QQ[]
  sage: R([0,1]).is_gen()
  False
  ```
  So I now cover this case.

With my changes, I get just a little tiny bit more (at least it is no worse):

```
sage: R.<x> = GF(31337)[]
sage: g = R(list(range(1,1001)))
sage: U.<t,u,v> = GF(31337)[]
sage: %timeit g(u)
1.86 ms ± 10.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)git
```
versus your branch

```
sage: %timeit g(u)
1.88 ms ± 35.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```
I didn't run timing tests extensively, but where I did test, I saw at least a little speedup.



---

archive/issue_comments_536028.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982\"><code>3b9e83a</code></a></td><td><code>Better handling of constants/monomials.</code></td></tr></table>\n",
    "created_at": "2022-02-15T09:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536028",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982"><code>3b9e83a</code></a></td><td><code>Better handling of constants/monomials.</code></td></tr></table>




---

archive/issue_comments_536029.json:
```json
{
    "body": "Changed commit from **[`1645418`](https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee)** to **[`3b9e83a`](https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982)**",
    "created_at": "2022-02-15T09:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536029",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1645418`](https://github.com/sagemath/sagetrac-mirror/commit/1645418738975d45f80b26a4de41cb798c302dee)** to **[`3b9e83a`](https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982)**



---

archive/issue_comments_536030.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI am not sure about this change:\n\n```\n         R = parent(a)\n \n-        if parent(cst) is not R:\n-\n+        if R is not self._parent._base:\n```\nShouldn't it be `pol._parent._base` instead of `self._parent._base`?\n\nApart from that, lgtm! (But someone else should have a look since I contributed to the code.)",
    "created_at": "2022-02-17T10:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536030",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:20" align="right">comment:20</div>

I am not sure about this change:

```
         R = parent(a)
 
-        if parent(cst) is not R:
-
+        if R is not self._parent._base:
```
Shouldn't it be `pol._parent._base` instead of `self._parent._base`?

Apart from that, lgtm! (But someone else should have a look since I contributed to the code.)



---

archive/issue_comments_536031.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2022-02-17T10:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536031",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_536032.json:
```json
{
    "body": "Changed author from **Lorenz Panny** to **Lorenz Panny, Marc Mezzarobba, Travis Scrimshaw**",
    "created_at": "2022-02-17T10:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536032",
    "user": "https://github.com/mezzarobba"
}
```

Changed author from **Lorenz Panny** to **Lorenz Panny, Marc Mezzarobba, Travis Scrimshaw**



---

archive/issue_comments_536033.json:
```json
{
    "body": "Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**",
    "created_at": "2022-02-17T11:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536033",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**



---

archive/issue_comments_536034.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSince everything else in that code is working with `pol`, I think we should check that base ring. Although from what I understand of the code above, it should be the same base ring as `self`.\n\nI have also checked your code, so if you are okay with mine, then we can set a positive review.",
    "created_at": "2022-02-17T11:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536034",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

Since everything else in that code is working with `pol`, I think we should check that base ring. Although from what I understand of the code above, it should be the same base ring as `self`.

I have also checked your code, so if you are okay with mine, then we can set a positive review.



---

archive/issue_comments_536035.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nActually, you\u2019re right, it should check `pol._parent._base`. If you could make this change, then you can set a positive review on my behalf (assuming you have given a positive review to my changes).\n\nIt would be nice to add a test for this, but I think the code is sufficient robust with the coercion framework to make testing for this difficult. We would have do something with incompatible objects after mapping coefficients. If you can think of a simple test, please add it. Otherwise, we can just let it be since we have looked at the code\u2019s logic.",
    "created_at": "2022-02-17T11:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536035",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Actually, you’re right, it should check `pol._parent._base`. If you could make this change, then you can set a positive review on my behalf (assuming you have given a positive review to my changes).

It would be nice to add a test for this, but I think the code is sufficient robust with the coercion framework to make testing for this difficult. We would have do something with incompatible objects after mapping coefficients. If you can think of a simple test, please add it. Otherwise, we can just let it be since we have looked at the code’s logic.



---

archive/issue_comments_536036.json:
```json
{
    "body": "Changed commit from **[`3b9e83a`](https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982)** to **[`c0e462e`](https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56)**",
    "created_at": "2022-02-17T11:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536036",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3b9e83a`](https://github.com/sagemath/sagetrac-mirror/commit/3b9e83a0c61f50696c75e25e6555a7c4860f0982)** to **[`c0e462e`](https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56)**



---

archive/issue_comments_536037.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56\"><code>c0e462e</code></a></td><td><code>#33165 minor fix</code></td></tr></table>\n",
    "created_at": "2022-02-17T11:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536037",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56"><code>c0e462e</code></a></td><td><code>#33165 minor fix</code></td></tr></table>




---

archive/issue_events_458563.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2022-02-17T20:43:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458563"
}
```



---

archive/issue_events_458564.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2022-02-17T20:43:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458564"
}
```



---

archive/issue_events_458565.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-21T00:33:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458565"
}
```



---

archive/issue_events_458566.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-21T00:33:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458566"
}
```



---

archive/issue_comments_536038.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOn 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_element.pyx\", line 736, in sage.rings.polynomial.polynomial_element.Polynomial.__call__\nFailed example:\n    f(y^1000)\nExpected:\n    y^10000000000 + 1\nGot:\n    y^1410065408 + 1\n**********************************************************************\n```",
    "created_at": "2022-02-21T00:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536038",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

On 32-bit:

```
**********************************************************************
File "src/sage/rings/polynomial/polynomial_element.pyx", line 736, in sage.rings.polynomial.polynomial_element.Polynomial.__call__
Failed example:
    f(y^1000)
Expected:
    y^10000000000 + 1
Got:
    y^1410065408 + 1
**********************************************************************
```



---

archive/issue_comments_536039.json:
```json
{
    "body": "Changed commit from **[`c0e462e`](https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56)** to **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**",
    "created_at": "2022-02-21T04:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536039",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c0e462e`](https://github.com/sagemath/sagetrac-mirror/commit/c0e462eff5e84af394d79ac438f59121ed95be56)** to **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**



---

archive/issue_comments_536040.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f\"><code>9a6e4b2</code></a></td><td><code>Smaller degree on sparse test to prevent overflow.</code></td></tr></table>\n",
    "created_at": "2022-02-21T04:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536040",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f"><code>9a6e4b2</code></a></td><td><code>Smaller degree on sparse test to prevent overflow.</code></td></tr></table>




---

archive/issue_comments_536041.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nTrivial change of decreasing the degree so that there is no overflow on 32-bit.",
    "created_at": "2022-02-21T04:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536041",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Trivial change of decreasing the degree so that there is no overflow on 32-bit.



---

archive/issue_events_458567.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-02-21T04:15:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458567"
}
```



---

archive/issue_events_458568.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-02-21T04:15:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458568"
}
```



---

archive/issue_comments_536042.json:
```json
{
    "body": "Changed branch from **[public/33165](https://github.com/sagemath/sagetrac-mirror/tree/public/33165)** to **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**",
    "created_at": "2022-02-27T22:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33165#issuecomment-536042",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/33165](https://github.com/sagemath/sagetrac-mirror/tree/public/33165)** to **[`9a6e4b2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6e4b258cf9ef597dcf61d44da28b49ec8e8b9f)**



---

archive/issue_events_458569.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458569"
}
```



---

archive/issue_events_458570.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "714cf9fe3a6e14ef903692bcf9618c9acc28dd44",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-02-27T22:00:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33165",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33165#event-458570"
}
```
