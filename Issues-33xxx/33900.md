# Issue 33900: small enhancements to generic discrete logs

archive/issues_033663.json:
```json
{
    "assignees": [],
    "body": "Previously, the generic discrete log function wouldn't ever use Pollard's rho. From what I can tell, no generic Pohlig-Hellman implementation existed which used Pollard's rho.\n\nAdditionally, discrete log functions did not seem to properly use the custom operation arguments.\n\nAssignee: **@k3w1k0d3r**\n\nCC:  @yyyyx4\n\nKeywords: **discrete, logarithm, group theory, generic**\n\nBranch/Commit: **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**\n\nReviewer: **Lorenz Panny**\n\nAuthor: **Julien Grijalva**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33900_\n\n",
    "closed_at": "2022-08-30T19:04:59Z",
    "created_at": "2022-05-25T04:15:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20group%20theory",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "small enhancements to generic discrete logs",
    "type": "issue",
    "updated_at": "2022-08-30T19:04:59Z",
    "url": "https://github.com/sagemath/sage/issues/33900",
    "user": "https://github.com/k3w1k0d3r"
}
```
Previously, the generic discrete log function wouldn't ever use Pollard's rho. From what I can tell, no generic Pohlig-Hellman implementation existed which used Pollard's rho.

Additionally, discrete log functions did not seem to properly use the custom operation arguments.

Assignee: **@k3w1k0d3r**

CC:  @yyyyx4

Keywords: **discrete, logarithm, group theory, generic**

Branch/Commit: **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**

Reviewer: **Lorenz Panny**

Author: **Julien Grijalva**

_Issue created by migration from https://trac.sagemath.org/ticket/33900_





---

archive/issue_events_431912.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-05-25T04:15:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431912"
}
```



---

archive/issue_events_431913.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-05-25T04:15:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "component: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431913"
}
```



---

archive/issue_events_431914.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-05-25T04:15:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431914"
}
```



---

archive/issue_events_431915.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-05-25T04:15:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431915"
}
```



---

archive/issue_comments_551290.json:
```json
{
    "body": "Assignee: **@k3w1k0d3r**",
    "created_at": "2022-05-25T04:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551290",
    "user": "https://github.com/k3w1k0d3r"
}
```

Assignee: **@k3w1k0d3r**



---

archive/issue_comments_551291.json:
```json
{
    "body": "Branch: **[u/gh-k3w1k0d3r/better_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-k3w1k0d3r/better_discrete_log)**",
    "created_at": "2022-05-25T05:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551291",
    "user": "https://github.com/k3w1k0d3r"
}
```

Branch: **[u/gh-k3w1k0d3r/better_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-k3w1k0d3r/better_discrete_log)**



---

archive/issue_comments_551292.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e27d84e8bfec980d5185d750a8a04b07ae5377a7\">e27d84e</a></td><td><code>test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fa02751edfeb64552124e4c32b3a8bfa929d596\">2fa0275</a></td><td><code>Added Pollard's rho support to discrete_log</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5048adf14484a2375f07f169cb36201e4853ab4d\">5048adf</a></td><td><code>discrete log functions properly handle op argument</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0\">16c5f45</a></td><td><code>undid irrelevant change</code></td></tr></table>\n",
    "created_at": "2022-05-25T05:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551292",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e27d84e8bfec980d5185d750a8a04b07ae5377a7">e27d84e</a></td><td><code>test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fa02751edfeb64552124e4c32b3a8bfa929d596">2fa0275</a></td><td><code>Added Pollard's rho support to discrete_log</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5048adf14484a2375f07f169cb36201e4853ab4d">5048adf</a></td><td><code>discrete log functions properly handle op argument</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0">16c5f45</a></td><td><code>undid irrelevant change</code></td></tr></table>




---

archive/issue_comments_551293.json:
```json
{
    "body": "Commit: **[16c5f45](https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0)**",
    "created_at": "2022-05-25T05:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551293",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[16c5f45](https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0)**



---

archive/issue_events_431916.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-05-25T05:40:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431916"
}
```



---

archive/issue_comments_551294.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee\">abc6d2d</a></td><td><code>fixed docstring</code></td></tr></table>\n",
    "created_at": "2022-05-25T20:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551294",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee">abc6d2d</a></td><td><code>fixed docstring</code></td></tr></table>




---

archive/issue_comments_551295.json:
```json
{
    "body": "Changed commit from **[16c5f45](https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0)** to **[abc6d2d](https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee)**",
    "created_at": "2022-05-25T20:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551295",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[16c5f45](https://github.com/sagemath/sagetrac-mirror/commit/16c5f45adda6f901948cc8ac1b6f453e44a24ad0)** to **[abc6d2d](https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee)**



---

archive/issue_comments_551296.json:
```json
{
    "body": "Changed commit from **[abc6d2d](https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee)** to **[9684efd](https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77)**",
    "created_at": "2022-05-25T21:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551296",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[abc6d2d](https://github.com/sagemath/sagetrac-mirror/commit/abc6d2d67a0d6f6ebc8ee11b3b87654d28e521ee)** to **[9684efd](https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77)**



---

archive/issue_comments_551297.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77\">9684efd</a></td><td><code>fixed docstring again</code></td></tr></table>\n",
    "created_at": "2022-05-25T21:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551297",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77">9684efd</a></td><td><code>fixed docstring again</code></td></tr></table>




---

archive/issue_comments_551298.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks for the contribution!\n\nOne first comment: The `use_rho` keyword argument should be replaced by an `algorithm` argument (with options `\"bsgs\"`/`\"rho\"` and a reasonable default choice among these), as is standard practice throughout most of the Sage library. This makes sure the interface doesn't get awkward if someone wants to add another algorithm option later.",
    "created_at": "2022-05-26T02:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551298",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks for the contribution!

One first comment: The `use_rho` keyword argument should be replaced by an `algorithm` argument (with options `"bsgs"`/`"rho"` and a reasonable default choice among these), as is standard practice throughout most of the Sage library. This makes sure the interface doesn't get awkward if someone wants to add another algorithm option later.



---

archive/issue_comments_551299.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8\">1888426</a></td><td><code>changed use_rho keyword to algorithm</code></td></tr></table>\n",
    "created_at": "2022-05-26T03:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551299",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8">1888426</a></td><td><code>changed use_rho keyword to algorithm</code></td></tr></table>




---

archive/issue_comments_551300.json:
```json
{
    "body": "Changed commit from **[9684efd](https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77)** to **[1888426](https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8)**",
    "created_at": "2022-05-26T03:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551300",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9684efd](https://github.com/sagemath/sagetrac-mirror/commit/9684efd8eba91bb2e4eab8d7c0c0c9f890120f77)** to **[1888426](https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8)**



---

archive/issue_comments_551301.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72\">54bf499</a></td><td><code>fix discrete_log_generic</code></td></tr></table>\n",
    "created_at": "2022-05-27T05:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551301",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72">54bf499</a></td><td><code>fix discrete_log_generic</code></td></tr></table>




---

archive/issue_comments_551302.json:
```json
{
    "body": "Changed commit from **[1888426](https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8)** to **[54bf499](https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72)**",
    "created_at": "2022-05-27T05:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551302",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1888426](https://github.com/sagemath/sagetrac-mirror/commit/18884263a334dda1c3cedeb3b2ae150f6e5902d8)** to **[54bf499](https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72)**



---

archive/issue_comments_551303.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThanks. Some more comments:\n\n- There's a spurious whitespace change in `build/bin/sage-bootstrap-python`.\n- Your `ValueError(\"unkown algorithm\")` contains a typo (\"unkown\" -> \"unknown\").\n- That same `ValueError` is immediately caught by the function and results in an incorrect \"no discrete log\" error.\n- The logic here:\n\n```python\n    mult = op if op is not None else [add, mul][operation in multiplication_names]\n    power = [mul, pow][operation in multiplication_names]\n    if(op is not None):\n        power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)\n    if ord is None:\n        if operation in multiplication_names:\n            mult = mul\n            power = pow\n            try:\n                ord = base.multiplicative_order()\n            except Exception:\n                ord = base.order()\n        elif operation in addition_names:\n            mult = add\n            power = mul\n```\nis weird. First, it should probably throw an error if `operation` is neither in `addition_names` nor in `multiplication_names`. Second, if `operation` is given but `ord` is not, this sets both `mult` and `power` twice (to the same value). Third, coding style: `if(foo):` should be `if foo:` in Python. Fourth, you use an `if` to set `power`, but the ternary `x if y else z` to set `mult`; this can be streamlined into a single `if`.\n\n- This should probably say \"in *the* group\":\n\n```diff\n+    - ``op()`` - function of 2 arguments ``x``, ``y`` returning ``x*y`` in group\n```",
    "created_at": "2022-05-27T06:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551303",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:11'>Comment 11:</a>
Thanks. Some more comments:

- There's a spurious whitespace change in `build/bin/sage-bootstrap-python`.
- Your `ValueError("unkown algorithm")` contains a typo ("unkown" -> "unknown").
- That same `ValueError` is immediately caught by the function and results in an incorrect "no discrete log" error.
- The logic here:

```python
    mult = op if op is not None else [add, mul][operation in multiplication_names]
    power = [mul, pow][operation in multiplication_names]
    if(op is not None):
        power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)
    if ord is None:
        if operation in multiplication_names:
            mult = mul
            power = pow
            try:
                ord = base.multiplicative_order()
            except Exception:
                ord = base.order()
        elif operation in addition_names:
            mult = add
            power = mul
```
is weird. First, it should probably throw an error if `operation` is neither in `addition_names` nor in `multiplication_names`. Second, if `operation` is given but `ord` is not, this sets both `mult` and `power` twice (to the same value). Third, coding style: `if(foo):` should be `if foo:` in Python. Fourth, you use an `if` to set `power`, but the ternary `x if y else z` to set `mult`; this can be streamlined into a single `if`.

- This should probably say "in *the* group":

```diff
+    - ``op()`` - function of 2 arguments ``x``, ``y`` returning ``x*y`` in group
```



---

archive/issue_comments_551304.json:
```json
{
    "body": "Changed commit from **[54bf499](https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72)** to **[f2cc977](https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225)**",
    "created_at": "2022-05-27T06:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551304",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[54bf499](https://github.com/sagemath/sagetrac-mirror/commit/54bf499573c8165b3aeff4f63ecc5dbc98773c72)** to **[f2cc977](https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225)**



---

archive/issue_comments_551305.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225\">f2cc977</a></td><td><code>more specific bounds passed to bsgs by discrete_log</code></td></tr></table>\n",
    "created_at": "2022-05-27T06:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551305",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225">f2cc977</a></td><td><code>more specific bounds passed to bsgs by discrete_log</code></td></tr></table>




---

archive/issue_comments_551306.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@yyyyx4](#comment%3A11):\n> Thanks. Some more comments:\n> \n> - There's a spurious whitespace change in `build/bin/sage-bootstrap-python`.\n> - Your `ValueError(\"unkown algorithm\")` contains a typo (\"unkown\" -> \"unknown\").\n> - That same `ValueError` is immediately caught by the function and results in an incorrect \"no discrete log\" error.\n> - The logic here:\n> \n> ```python\n>     mult = op if op is not None else [add, mul][operation in multiplication_names]\n>     power = [mul, pow][operation in multiplication_names]\n>     if(op is not None):\n>         power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)\n>     if ord is None:\n>         if operation in multiplication_names:\n>             mult = mul\n>             power = pow\n>             try:\n>                 ord = base.multiplicative_order()\n>             except Exception:\n>                 ord = base.order()\n>         elif operation in addition_names:\n>             mult = add\n>             power = mul\n> ```\n> is weird. First, it should probably throw an error if `operation` is neither in `addition_names` nor in `multiplication_names`. Second, if `operation` is given but `ord` is not, this sets both `mult` and `power` twice (to the same value). Third, coding style: `if(foo):` should be `if foo:` in Python. Fourth, you use an `if` to set `power`, but the ternary `x if y else z` to set `mult`; this can be streamlined into a single `if`.\n> \n> - This should probably say \"in *the* group\":\n> \n> ```diff\n> +    - ``op()`` - function of 2 arguments ``x``, ``y`` returning ``x*y`` in group\n> ```\n\nthanks",
    "created_at": "2022-05-27T06:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551306",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@yyyyx4](#comment%3A11):
> Thanks. Some more comments:
> 
> - There's a spurious whitespace change in `build/bin/sage-bootstrap-python`.
> - Your `ValueError("unkown algorithm")` contains a typo ("unkown" -> "unknown").
> - That same `ValueError` is immediately caught by the function and results in an incorrect "no discrete log" error.
> - The logic here:
> 
> ```python
>     mult = op if op is not None else [add, mul][operation in multiplication_names]
>     power = [mul, pow][operation in multiplication_names]
>     if(op is not None):
>         power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)
>     if ord is None:
>         if operation in multiplication_names:
>             mult = mul
>             power = pow
>             try:
>                 ord = base.multiplicative_order()
>             except Exception:
>                 ord = base.order()
>         elif operation in addition_names:
>             mult = add
>             power = mul
> ```
> is weird. First, it should probably throw an error if `operation` is neither in `addition_names` nor in `multiplication_names`. Second, if `operation` is given but `ord` is not, this sets both `mult` and `power` twice (to the same value). Third, coding style: `if(foo):` should be `if foo:` in Python. Fourth, you use an `if` to set `power`, but the ternary `x if y else z` to set `mult`; this can be streamlined into a single `if`.
> 
> - This should probably say "in *the* group":
> 
> ```diff
> +    - ``op()`` - function of 2 arguments ``x``, ``y`` returning ``x*y`` in group
> ```

thanks



---

archive/issue_comments_551307.json:
```json
{
    "body": "Changed commit from **[f2cc977](https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225)** to **[56526fc](https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f)**",
    "created_at": "2022-05-27T07:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551307",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f2cc977](https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225)** to **[56526fc](https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f)**



---

archive/issue_comments_551308.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/461197a65fb275fa1c0d94578fc014cacf12f238\">461197a</a></td><td><code>a few adjustments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f\">56526fc</a></td><td><code>changes to discrete_log bounds handling</code></td></tr></table>\n",
    "created_at": "2022-05-27T07:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551308",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/461197a65fb275fa1c0d94578fc014cacf12f238">461197a</a></td><td><code>a few adjustments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f">56526fc</a></td><td><code>changes to discrete_log bounds handling</code></td></tr></table>




---

archive/issue_comments_551309.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI didn't think https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225 through very well and the tests didn't detect my mistake, I've now undone that change.",
    "created_at": "2022-05-27T07:01:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551309",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:15'>Comment 15:</a>
I didn't think https://github.com/sagemath/sagetrac-mirror/commit/f2cc9775d072728a444f0ab19a9349eef2668225 through very well and the tests didn't detect my mistake, I've now undone that change.



---

archive/issue_comments_551310.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nis it looking better now?",
    "created_at": "2022-06-08T00:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551310",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:16'>Comment 16:</a>
is it looking better now?



---

archive/issue_comments_551311.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nis there any update on this?",
    "created_at": "2022-08-02T19:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551311",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:17'>Comment 17:</a>
is there any update on this?



---

archive/issue_comments_551312.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nSorry for the long silence. What's still missing are tests for the new `algorithm` flag: I guess you can just copy some of the existing tests and show that they also work if you pass `algorithm='rho'`.\n\nOnce that's done, I think this can be merged \u2014 while there are still plenty of things I would change in that file, it's certainly better than before.",
    "created_at": "2022-08-03T01:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551312",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:18'>Comment 18:</a>
Sorry for the long silence. What's still missing are tests for the new `algorithm` flag: I guess you can just copy some of the existing tests and show that they also work if you pass `algorithm='rho'`.

Once that's done, I think this can be merged â€” while there are still plenty of things I would change in that file, it's certainly better than before.



---

archive/issue_comments_551313.json:
```json
{
    "body": "Reviewer: **Lorenz Panny**",
    "created_at": "2022-08-03T01:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551313",
    "user": "https://github.com/yyyyx4"
}
```

Reviewer: **Lorenz Panny**



---

archive/issue_comments_551314.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e\">7261907</a></td><td><code>added tests for algorithm='rho'</code></td></tr></table>\n",
    "created_at": "2022-08-03T08:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551314",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e">7261907</a></td><td><code>added tests for algorithm='rho'</code></td></tr></table>




---

archive/issue_comments_551315.json:
```json
{
    "body": "Changed commit from **[56526fc](https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f)** to **[7261907](https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e)**",
    "created_at": "2022-08-03T08:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[56526fc](https://github.com/sagemath/sagetrac-mirror/commit/56526fcdf13e2c8b07f9333d0da4fc75711d425f)** to **[7261907](https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e)**



---

archive/issue_comments_551316.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nThanks!",
    "created_at": "2022-08-04T08:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551316",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:20'>Comment 20:</a>
Thanks!



---

archive/issue_events_431917.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-04T08:01:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431917"
}
```



---

archive/issue_events_431918.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-04T08:01:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431918"
}
```



---

archive/issue_comments_551317.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nthank you! since it's positive review now, what would be the process for making further changes? should I open a new ticket?",
    "created_at": "2022-08-04T21:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551317",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:21'>Comment 21:</a>
thank you! since it's positive review now, what would be the process for making further changes? should I open a new ticket?



---

archive/issue_comments_551318.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nactually I'm pretty sure the current code has a bug so I should probably update this ticket. before I push, can you confirm that that's what I should do?",
    "created_at": "2022-08-05T04:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551318",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:22'>Comment 22:</a>
actually I'm pretty sure the current code has a bug so I should probably update this ticket. before I push, can you confirm that that's what I should do?



---

archive/issue_comments_551319.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI'm not sure either what's the preferred way of dealing with this, but I think setting it back to \"needs work\" for now won't hurt.\n(Adding changes to a ticket that is in \"positive review\" state is discouraged because it makes it difficult to tell which version of the branch gets merged in the end.)\n\nWhat's the bug you found? Does it break things that used to work previously?",
    "created_at": "2022-08-05T04:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551319",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:23'>Comment 23:</a>
I'm not sure either what's the preferred way of dealing with this, but I think setting it back to "needs work" for now won't hurt.
(Adding changes to a ticket that is in "positive review" state is discouraged because it makes it difficult to tell which version of the branch gets merged in the end.)

What's the bug you found? Does it break things that used to work previously?



---

archive/issue_events_431919.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-05T04:24:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431919"
}
```



---

archive/issue_events_431920.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-05T04:24:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431920"
}
```



---

archive/issue_comments_551320.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nit has to do with the stop early CRT optimization.\n\n`CRT_list(l, [pi**ri for pi, ri in f[:len(l)]])`\n\nSince we stop before computing the latter part of `l`, we need to cut off the moduli early as well. The problem is that `l` is initialized with its full length, so this list slicing doesn't do anything. If this part of code got hit then some of the CRT relations would be wrong (unless 0 was the correct result for all remaining factors). The solution is simple, just slice `l` at the number of factors that have been checked.\n\nSince this optimization wasn't in there before, this does break something that used to work.",
    "created_at": "2022-08-05T04:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551320",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:24'>Comment 24:</a>
it has to do with the stop early CRT optimization.

`CRT_list(l, [pi**ri for pi, ri in f[:len(l)]])`

Since we stop before computing the latter part of `l`, we need to cut off the moduli early as well. The problem is that `l` is initialized with its full length, so this list slicing doesn't do anything. If this part of code got hit then some of the CRT relations would be wrong (unless 0 was the correct result for all remaining factors). The solution is simple, just slice `l` at the number of factors that have been checked.

Since this optimization wasn't in there before, this does break something that used to work.



---

archive/issue_comments_551321.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI see, sorry for not catching that. In addition to fixing it, could you please add a test that currently fails because of the bug?\n\nIdeally, we should add more comprehensive (maybe randomized) testing to these functions too, but I suppose that can become part of the \"plenty of things I would change in that file\" I had alluded to earlier.",
    "created_at": "2022-08-05T08:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551321",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:25'>Comment 25:</a>
I see, sorry for not catching that. In addition to fixing it, could you please add a test that currently fails because of the bug?

Ideally, we should add more comprehensive (maybe randomized) testing to these functions too, but I suppose that can become part of the "plenty of things I would change in that file" I had alluded to earlier.



---

archive/issue_comments_551322.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6058fdfc5750fe3d9077016434f1aebdfe8d1e24\">6058fdf</a></td><td><code>use bounds better</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271\">07615d3</a></td><td><code>added test to detect previously fixed bug</code></td></tr></table>\n",
    "created_at": "2022-08-05T09:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551322",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6058fdfc5750fe3d9077016434f1aebdfe8d1e24">6058fdf</a></td><td><code>use bounds better</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271">07615d3</a></td><td><code>added test to detect previously fixed bug</code></td></tr></table>




---

archive/issue_comments_551323.json:
```json
{
    "body": "Changed commit from **[7261907](https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e)** to **[07615d3](https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271)**",
    "created_at": "2022-08-05T09:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551323",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7261907](https://github.com/sagemath/sagetrac-mirror/commit/7261907e2bf1d83bf659972d3a2296a97fca720e)** to **[07615d3](https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271)**



---

archive/issue_comments_551324.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nthe first commit does a bit more than fix the bug because I didn't notice the bug until after doing some other things. I thought it was all related enough to go in one commit.",
    "created_at": "2022-08-05T09:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551324",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:27'>Comment 27:</a>
the first commit does a bit more than fix the bug because I didn't notice the bug until after doing some other things. I thought it was all related enough to go in one commit.



---

archive/issue_events_431921.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-06T00:01:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431921"
}
```



---

archive/issue_events_431922.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-06T00:01:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431922"
}
```



---

archive/issue_comments_551325.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05\">85e6d09</a></td><td><code>fixed local variable referenced before assignment bug</code></td></tr></table>\n",
    "created_at": "2022-08-06T09:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551325",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05">85e6d09</a></td><td><code>fixed local variable referenced before assignment bug</code></td></tr></table>




---

archive/issue_comments_551326.json:
```json
{
    "body": "Changed commit from **[07615d3](https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271)** to **[85e6d09](https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05)**",
    "created_at": "2022-08-06T09:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551326",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[07615d3](https://github.com/sagemath/sagetrac-mirror/commit/07615d374d66583a140251f4700a02f27c29f271)** to **[85e6d09](https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05)**



---

archive/issue_comments_551327.json:
```json
{
    "body": "Changed commit from **[85e6d09](https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05)** to **[68679e0](https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322)**",
    "created_at": "2022-08-07T07:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551327",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[85e6d09](https://github.com/sagemath/sagetrac-mirror/commit/85e6d0939ccd599ff13cc8f4a8732bdf7b756c05)** to **[68679e0](https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322)**



---

archive/issue_comments_551328.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322\">68679e0</a></td><td><code>added lambda algorithm to discrete_log</code></td></tr></table>\n",
    "created_at": "2022-08-07T07:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551328",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322">68679e0</a></td><td><code>added lambda algorithm to discrete_log</code></td></tr></table>




---

archive/issue_comments_551329.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nHere's an example that still fails:\n\n```sage\ndiscrete_log(Mod(0,4), Mod(2,4), 4, operation='+', algorithm='lambda')\n```\n\nFrom a quick glance it looks like the upper bounds passed to `discrete_log_lambda` might be off by one.\n\nYou may want to add the following test to the function to catch things like this in the future:\n\n```diff\n--- a/src/sage/groups/generic.py\n+++ b/src/sage/groups/generic.py\n@@ -833,6 +833,28 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i\n         sage: discrete_log(u,g,algorithm='rho')\n         123456789\n\n+    TESTS:\n+\n+    Random testing::\n+\n+        sage: G = Zmod(randrange(1, 1000))\n+        sage: base = G.random_element()\n+        sage: order = base.additive_order()\n+        sage: assert order.divides(G.cardinality())\n+        sage: sol = randrange(order)\n+        sage: elem = sol * base\n+        sage: args = (elem, base, order)\n+        sage: kwargs = {'operation': '+'}\n+        sage: kwargs['algorithm'] = choice(['bsgs', 'rho', 'lambda'])\n+        sage: if randrange(2):\n+        ....:     lo = randrange(-order, sol+1)\n+        ....:     hi = randrange(sol+1, 2*order)\n+        ....:     assert lo <= sol < hi\n+        ....:     kwargs['bounds'] = (lo, hi)\n+        sage: res = discrete_log(*args, **kwargs)\n+        sage: res == sol\n+        True\n+\n     AUTHORS:\n\n     - William Stein and David Joyner (2005-01-05)\n@@ -845,7 +867,7 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i\n         mult = op\n         power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)\n     if bounds:\n-        lb, ub = bounds\n+        lb, ub = map(integer_ring.ZZ, bounds)\n     if (op is None or identity is None or inverse is None or ord is None) and operation not in addition_names+multiplication_names:\n         raise ValueError(\"ord, op, identity, and inverse must all be specified for this operation\")\n     if ord is None:\n```",
    "created_at": "2022-08-08T02:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551329",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:31'>Comment 31:</a>
Here's an example that still fails:

```sage
discrete_log(Mod(0,4), Mod(2,4), 4, operation='+', algorithm='lambda')
```

From a quick glance it looks like the upper bounds passed to `discrete_log_lambda` might be off by one.

You may want to add the following test to the function to catch things like this in the future:

```diff
--- a/src/sage/groups/generic.py
+++ b/src/sage/groups/generic.py
@@ -833,6 +833,28 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i
         sage: discrete_log(u,g,algorithm='rho')
         123456789

+    TESTS:
+
+    Random testing::
+
+        sage: G = Zmod(randrange(1, 1000))
+        sage: base = G.random_element()
+        sage: order = base.additive_order()
+        sage: assert order.divides(G.cardinality())
+        sage: sol = randrange(order)
+        sage: elem = sol * base
+        sage: args = (elem, base, order)
+        sage: kwargs = {'operation': '+'}
+        sage: kwargs['algorithm'] = choice(['bsgs', 'rho', 'lambda'])
+        sage: if randrange(2):
+        ....:     lo = randrange(-order, sol+1)
+        ....:     hi = randrange(sol+1, 2*order)
+        ....:     assert lo <= sol < hi
+        ....:     kwargs['bounds'] = (lo, hi)
+        sage: res = discrete_log(*args, **kwargs)
+        sage: res == sol
+        True
+
     AUTHORS:

     - William Stein and David Joyner (2005-01-05)
@@ -845,7 +867,7 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i
         mult = op
         power = lambda x, y: multiple(x, y, operation=operation, identity=identity, inverse=inverse, op=op)
     if bounds:
-        lb, ub = bounds
+        lb, ub = map(integer_ring.ZZ, bounds)
     if (op is None or identity is None or inverse is None or ord is None) and operation not in addition_names+multiplication_names:
         raise ValueError("ord, op, identity, and inverse must all be specified for this operation")
     if ord is None:
```



---

archive/issue_events_431923.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-08T02:25:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431923"
}
```



---

archive/issue_events_431924.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-08T02:25:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431924"
}
```



---

archive/issue_comments_551330.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nthere seems to be a bug in the lambda algorithm.\n\nnotice that the second pass through lambda is the one which fails to find a logarithm. the correct logarithm for that case is 0, and the bounds passed are (0, 2). the logarithm 0 should be found within this range, but it is not. this is incorrect behavior.\n\nthe reason for this (I think) is that the pollard lambda algorithm requires inclusive bounds to be sent, but the implementation checks that `c-d<ub` (note the strict comparison) before returning. when this comparison is changed to not be strict, 2 is returned. this is a correct logarithm, albeit not the smallest. I think this change probably should be made, because the prior behavior of failing is certainly incorrect.\n\nthe lambda implementation, however, isn't the only thing mistreating the bound inclusivity/exclusivity. with that change made, `discrete_log(Mod(0,4), Mod(2,4), 4, operation='+', algorithm='lambda')` returns 2. this is valid, but not the smallest. this doesn't happen with bsgs because bsgs is guaranteed to find the smallest log in the range. one solution is to mod by pi after getting a result from lambda, but the far cleaner solution is to subtract 1 from temp_bound so that a tighter but still correct bound is passed. these are the changes I'm pushing now.",
    "created_at": "2022-08-08T04:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551330",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:32'>Comment 32:</a>
there seems to be a bug in the lambda algorithm.

notice that the second pass through lambda is the one which fails to find a logarithm. the correct logarithm for that case is 0, and the bounds passed are (0, 2). the logarithm 0 should be found within this range, but it is not. this is incorrect behavior.

the reason for this (I think) is that the pollard lambda algorithm requires inclusive bounds to be sent, but the implementation checks that `c-d<ub` (note the strict comparison) before returning. when this comparison is changed to not be strict, 2 is returned. this is a correct logarithm, albeit not the smallest. I think this change probably should be made, because the prior behavior of failing is certainly incorrect.

the lambda implementation, however, isn't the only thing mistreating the bound inclusivity/exclusivity. with that change made, `discrete_log(Mod(0,4), Mod(2,4), 4, operation='+', algorithm='lambda')` returns 2. this is valid, but not the smallest. this doesn't happen with bsgs because bsgs is guaranteed to find the smallest log in the range. one solution is to mod by pi after getting a result from lambda, but the far cleaner solution is to subtract 1 from temp_bound so that a tighter but still correct bound is passed. these are the changes I'm pushing now.



---

archive/issue_comments_551331.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nthis actually still doesn't work. the reason is that now on the first pass of lambda, the log being calculated is 0 with base 0. any answer would be valid here, and with bounds (0, 2) lambda returns 0 but with bounds (0, 1) lambda returns 1. this leads to the next pass of lambda taking log(2) base 0, which doesn't exist. the reason is that 4 isn't the correct order of 2 (2+2=0), and pohlig-hellman relies on knowing the order of the point.\n\nI'll implement a workaround so we don't need to trust the user to provide a correct order.",
    "created_at": "2022-08-08T04:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551331",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:33'>Comment 33:</a>
this actually still doesn't work. the reason is that now on the first pass of lambda, the log being calculated is 0 with base 0. any answer would be valid here, and with bounds (0, 2) lambda returns 0 but with bounds (0, 1) lambda returns 1. this leads to the next pass of lambda taking log(2) base 0, which doesn't exist. the reason is that 4 isn't the correct order of 2 (2+2=0), and pohlig-hellman relies on knowing the order of the point.

I'll implement a workaround so we don't need to trust the user to provide a correct order.



---

archive/issue_comments_551332.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nOops, sorry, I didn't mean to give an example with incorrect inputs. Here's one with the correct order where it still fails:\n\n```sage\ndiscrete_log(Mod(1,5), Mod(4,5), 5, operation='+', algorithm='lambda')\n```\n\nI think trusting the user to provide the correct order is fine.",
    "created_at": "2022-08-08T05:01:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551332",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:34'>Comment 34:</a>
Oops, sorry, I didn't mean to give an example with incorrect inputs. Here's one with the correct order where it still fails:

```sage
discrete_log(Mod(1,5), Mod(4,5), 5, operation='+', algorithm='lambda')
```

I think trusting the user to provide the correct order is fine.



---

archive/issue_comments_551333.json:
```json
{
    "body": "Changed commit from **[68679e0](https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322)** to **[fe1b932](https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0)**",
    "created_at": "2022-08-08T05:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551333",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[68679e0](https://github.com/sagemath/sagetrac-mirror/commit/68679e0611ac30751e259a77392af5dc449b0322)** to **[fe1b932](https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0)**



---

archive/issue_comments_551334.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4cbb1faf3f7aa4f4530aed16bd59a1377464649\">c4cbb1f</a></td><td><code>fix all dlog bounds to be inclusive</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0eb4c5222ff5b9fd983e5de9db1842fc703b73ee\">0eb4c52</a></td><td><code>workaround in case user provides bad order</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0\">fe1b932</a></td><td><code>added random testing</code></td></tr></table>\n",
    "created_at": "2022-08-08T05:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551334",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:35'>Comment 35:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4cbb1faf3f7aa4f4530aed16bd59a1377464649">c4cbb1f</a></td><td><code>fix all dlog bounds to be inclusive</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0eb4c5222ff5b9fd983e5de9db1842fc703b73ee">0eb4c52</a></td><td><code>workaround in case user provides bad order</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0">fe1b932</a></td><td><code>added random testing</code></td></tr></table>




---

archive/issue_comments_551335.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nI haven't yet made the change to map bounds to ZZ, is there any reason for that?",
    "created_at": "2022-08-08T05:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551335",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:36'>Comment 36:</a>
I haven't yet made the change to map bounds to ZZ, is there any reason for that?



---

archive/issue_comments_551336.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nsorry I didn't see your comment to not add the workaround, should I undo that change?",
    "created_at": "2022-08-08T05:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551336",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:37'>Comment 37:</a>
sorry I didn't see your comment to not add the workaround, should I undo that change?



---

archive/issue_events_431925.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-08T05:13:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431925"
}
```



---

archive/issue_events_431926.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-08T05:13:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431926"
}
```



---

archive/issue_comments_551337.json:
```json
{
    "body": "Changed commit from **[fe1b932](https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0)** to **[20ae1d8](https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704)**",
    "created_at": "2022-08-08T05:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fe1b932](https://github.com/sagemath/sagetrac-mirror/commit/fe1b932988bdfa21384bc0286915e052e3a6eec0)** to **[20ae1d8](https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704)**



---

archive/issue_comments_551338.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704\">20ae1d8</a></td><td><code>fixed previous workaround when base == identity</code></td></tr></table>\n",
    "created_at": "2022-08-08T05:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551338",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704">20ae1d8</a></td><td><code>fixed previous workaround when base == identity</code></td></tr></table>




---

archive/issue_comments_551339.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nokay I just hit the test that shows why the map on bounds is important. it seems fitting if we have the function assume bounds might be python ints that we also assume ord could be a python int, which also messes things up, so I made that change as well.",
    "created_at": "2022-08-08T06:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551339",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:40'>Comment 40:</a>
okay I just hit the test that shows why the map on bounds is important. it seems fitting if we have the function assume bounds might be python ints that we also assume ord could be a python int, which also messes things up, so I made that change as well.



---

archive/issue_comments_551340.json:
```json
{
    "body": "Changed commit from **[20ae1d8](https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704)** to **[7f9cdb6](https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429)**",
    "created_at": "2022-08-08T06:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551340",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[20ae1d8](https://github.com/sagemath/sagetrac-mirror/commit/20ae1d81b04a1d455164c416e2e07d988181d704)** to **[7f9cdb6](https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429)**



---

archive/issue_comments_551341.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429\">7f9cdb6</a></td><td><code>map bounds and ord to ZZ in discrete_log</code></td></tr></table>\n",
    "created_at": "2022-08-08T06:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551341",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'>Comment 41:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429">7f9cdb6</a></td><td><code>map bounds and ord to ZZ in discrete_log</code></td></tr></table>




---

archive/issue_events_431927.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-09T14:57:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431927"
}
```



---

archive/issue_events_431928.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-09T14:57:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431928"
}
```



---

archive/issue_comments_551342.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nThe random doctest currently fails rather frequently when it uses the `lambda` algorithm.\n\nWe should also make up our minds whether `discrete_log()` requires the exact order or just a multiple: The documentation says it can be a multiple, but `discrete_log(Mod(20,25), Mod(5,25), 25, operation='+')` now returns `1` which is clearly wrong. (It also doesn't work in Sage 9.6, but there it fails with a `ValueError`...)",
    "created_at": "2022-08-09T14:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551342",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:42'>Comment 42:</a>
The random doctest currently fails rather frequently when it uses the `lambda` algorithm.

We should also make up our minds whether `discrete_log()` requires the exact order or just a multiple: The documentation says it can be a multiple, but `discrete_log(Mod(20,25), Mod(5,25), 25, operation='+')` now returns `1` which is clearly wrong. (It also doesn't work in Sage 9.6, but there it fails with a `ValueError`...)



---

archive/issue_comments_551343.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nthe wrong  answer happens because of this clearly incorrect line that I wrote `gamma = mult(gamma, power(base, -1))`. It's fixed now, I'll push soon. I haven't yet reproduced the lambda issue so I can't investigate too much but I think it might just be because lambda is probabilistic and has a chance of failing.",
    "created_at": "2022-08-09T17:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551343",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:43'>Comment 43:</a>
the wrong  answer happens because of this clearly incorrect line that I wrote `gamma = mult(gamma, power(base, -1))`. It's fixed now, I'll push soon. I haven't yet reproduced the lambda issue so I can't investigate too much but I think it might just be because lambda is probabilistic and has a chance of failing.



---

archive/issue_comments_551344.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\ncan you give the failing lambda parameters? I'm running the random test on loop with lambda algorithm only but I'm not seeing any issues.",
    "created_at": "2022-08-09T17:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551344",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:44'>Comment 44:</a>
can you give the failing lambda parameters? I'm running the random test on loop with lambda algorithm only but I'm not seeing any issues.



---

archive/issue_comments_551345.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nokay I'm pretty sure the failing lambda tests are because of the probabilistic nature of pollard lambda. they all seem to sometimes succeed and sometimes fail. as an example `discrete_log(Mod(656, 956), Mod(698, 956), operation='+', algorithm='lambda')`.",
    "created_at": "2022-08-09T17:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551345",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:45'>Comment 45:</a>
okay I'm pretty sure the failing lambda tests are because of the probabilistic nature of pollard lambda. they all seem to sometimes succeed and sometimes fail. as an example `discrete_log(Mod(656, 956), Mod(698, 956), operation='+', algorithm='lambda')`.



---

archive/issue_comments_551346.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8\">3d7f800</a></td><td><code>fixed order correction</code></td></tr></table>\n",
    "created_at": "2022-08-09T17:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551346",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:46'>Comment 46:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8">3d7f800</a></td><td><code>fixed order correction</code></td></tr></table>




---

archive/issue_comments_551347.json:
```json
{
    "body": "Changed commit from **[7f9cdb6](https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429)** to **[3d7f800](https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8)**",
    "created_at": "2022-08-09T17:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551347",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7f9cdb6](https://github.com/sagemath/sagetrac-mirror/commit/7f9cdb647a460aa7902f2a90097f40d9e249a429)** to **[3d7f800](https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8)**



---

archive/issue_comments_551348.json:
```json
{
    "body": "Changed commit from **[3d7f800](https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8)** to **[0a648f1](https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079)**",
    "created_at": "2022-08-09T17:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551348",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3d7f800](https://github.com/sagemath/sagetrac-mirror/commit/3d7f800ee1b8aa5a32f33ceb32d0722be8be4bf8)** to **[0a648f1](https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079)**



---

archive/issue_comments_551349.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079\">0a648f1</a></td><td><code>randomly test group order instead of just base order</code></td></tr></table>\n",
    "created_at": "2022-08-09T17:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551349",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'>Comment 47:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079">0a648f1</a></td><td><code>randomly test group order instead of just base order</code></td></tr></table>




---

archive/issue_comments_551350.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210\">eb28739</a></td><td><code>fix silent failure issue when base == identity</code></td></tr></table>\n",
    "created_at": "2022-08-09T18:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551350",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:48'>Comment 48:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210">eb28739</a></td><td><code>fix silent failure issue when base == identity</code></td></tr></table>




---

archive/issue_comments_551351.json:
```json
{
    "body": "Changed commit from **[0a648f1](https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079)** to **[eb28739](https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210)**",
    "created_at": "2022-08-09T18:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551351",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0a648f1](https://github.com/sagemath/sagetrac-mirror/commit/0a648f1ab588fb860421157a30e80d791a72c079)** to **[eb28739](https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210)**



---

archive/issue_comments_551352.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9\">d2a9e32</a></td><td><code>i, j initialized off by one</code></td></tr></table>\n",
    "created_at": "2022-08-09T19:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551352",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:49'>Comment 49:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9">d2a9e32</a></td><td><code>i, j initialized off by one</code></td></tr></table>




---

archive/issue_comments_551353.json:
```json
{
    "body": "Changed commit from **[eb28739](https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210)** to **[d2a9e32](https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9)**",
    "created_at": "2022-08-09T19:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551353",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eb28739](https://github.com/sagemath/sagetrac-mirror/commit/eb28739862dcf078bff976eeb071c41219c56210)** to **[d2a9e32](https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9)**



---

archive/issue_events_431929.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-09T19:13:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431929"
}
```



---

archive/issue_events_431930.json:
```json
{
    "actor": "https://github.com/k3w1k0d3r",
    "created_at": "2022-08-09T19:13:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431930"
}
```



---

archive/issue_comments_551354.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nfinally got the last bug I've noticed out.",
    "created_at": "2022-08-09T19:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551354",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:50'>Comment 50:</a>
finally got the last bug I've noticed out.



---

archive/issue_comments_551355.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nLooks good, thank you for all the work.\n\nNow we just need to avoid the doctest failures when `lambda` fails randomly. Maybe like this?\n\n```diff\n--- a/src/sage/groups/generic.py\n+++ b/src/sage/groups/generic.py\n@@ -851,9 +851,14 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i\n         ....:     hi = randrange(sol+1, 2*order)\n         ....:     assert lo <= sol <= hi\n         ....:     kwargs['bounds'] = (lo, hi)\n-        sage: res = discrete_log(*args, **kwargs)\n-        sage: res == sol\n-        True\n+        sage: try:\n+        ....:     res = discrete_log(*args, **kwargs)\n+        ....: except ValueError:\n+        ....:     # lambda can fail randomly\n+        ....:     if kwargs['algorithm'] != 'lambda':\n+        ....:         raise\n+        ....: else:\n+        ....:     assert res == sol\n\n     AUTHORS:\n\n```\n\nYou may also want to consider adding yourself to the list of authors for the `discrete_log` function.",
    "created_at": "2022-08-10T03:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551355",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:51'>Comment 51:</a>
Looks good, thank you for all the work.

Now we just need to avoid the doctest failures when `lambda` fails randomly. Maybe like this?

```diff
--- a/src/sage/groups/generic.py
+++ b/src/sage/groups/generic.py
@@ -851,9 +851,14 @@ def discrete_log(a, base, ord=None, bounds=None, operation='*', identity=None, i
         ....:     hi = randrange(sol+1, 2*order)
         ....:     assert lo <= sol <= hi
         ....:     kwargs['bounds'] = (lo, hi)
-        sage: res = discrete_log(*args, **kwargs)
-        sage: res == sol
-        True
+        sage: try:
+        ....:     res = discrete_log(*args, **kwargs)
+        ....: except ValueError:
+        ....:     # lambda can fail randomly
+        ....:     if kwargs['algorithm'] != 'lambda':
+        ....:         raise
+        ....: else:
+        ....:     assert res == sol

     AUTHORS:

```

You may also want to consider adding yourself to the list of authors for the `discrete_log` function.



---

archive/issue_comments_551356.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nthanks. is there any reason to leave lambda in the random tests if we don't actually check if it worked?",
    "created_at": "2022-08-10T03:27:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551356",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:52'>Comment 52:</a>
thanks. is there any reason to leave lambda in the random tests if we don't actually check if it worked?



---

archive/issue_comments_551357.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nWe still check `res == sol` in case there is no exception. Thus, the test is not vacuous: It guarantees that *if* the `lambda` implementation returns something, then it's correct.",
    "created_at": "2022-08-10T03:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551357",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:53'>Comment 53:</a>
We still check `res == sol` in case there is no exception. Thus, the test is not vacuous: It guarantees that *if* the `lambda` implementation returns something, then it's correct.



---

archive/issue_comments_551358.json:
```json
{
    "body": "Changed commit from **[d2a9e32](https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9)** to **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**",
    "created_at": "2022-08-10T04:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551358",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d2a9e32](https://github.com/sagemath/sagetrac-mirror/commit/d2a9e32565017f43d2476e784fa546d810423ee9)** to **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**



---

archive/issue_comments_551359.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07682a6c737d8d6b024bb646520901db1bab2c96\">07682a6</a></td><td><code>made lambda test not randomly fail</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303\">63684ec</a></td><td><code>added to authors list</code></td></tr></table>\n",
    "created_at": "2022-08-10T04:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551359",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:54'>Comment 54:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07682a6c737d8d6b024bb646520901db1bab2c96">07682a6</a></td><td><code>made lambda test not randomly fail</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303">63684ec</a></td><td><code>added to authors list</code></td></tr></table>




---

archive/issue_comments_551360.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nthank you!",
    "created_at": "2022-08-10T04:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551360",
    "user": "https://github.com/k3w1k0d3r"
}
```

<a id='comment:55'>Comment 55:</a>
thank you!



---

archive/issue_events_431931.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-10T05:06:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431931"
}
```



---

archive/issue_events_431932.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-08-10T05:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431932"
}
```



---

archive/issue_events_431933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-30T19:04:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431933"
}
```



---

archive/issue_events_431934.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f0d1549b285f4137727129229d4033d9e975418d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-08-30T19:04:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33900#event-431934"
}
```



---

archive/issue_comments_551361.json:
```json
{
    "body": "Changed branch from **[u/gh-k3w1k0d3r/better_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-k3w1k0d3r/better_discrete_log)** to **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**",
    "created_at": "2022-08-30T19:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33900#issuecomment-551361",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-k3w1k0d3r/better_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-k3w1k0d3r/better_discrete_log)** to **[63684ec](https://github.com/sagemath/sagetrac-mirror/commit/63684ec39f0ef606c18ec49c45c9242b8eb2b303)**
