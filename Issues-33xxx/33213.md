# Issue 33213: Replace SAGE_TMP by the system location in the sage library

archive/issues_032976.json:
```json
{
    "body": "Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n\nThese days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n\n1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n3. We remove `SAGE_TMP`.\n\nAfterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n\nMoreover when #8784 is done, we'll be able to remove sage-cleaner entirely.\n\n\n\nCC:  @slel @tscrim @kiwifb\n\nReviewer: Matthias Koeppe, Dima Pasechnik\n\nAuthor: Michael Orlitzky\n\nBranch: d94a1e62c1ce92ab65cd840b3f002101b00a36e5\n\nDependencies: #33829, #33790\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33213\n\n",
    "closed_at": "2022-06-21T23:22:55Z",
    "created_at": "2022-01-22T03:02:39Z",
    "labels": [
        "component: misc",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Replace SAGE_TMP by the system location in the sage library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33213",
    "user": "https://github.com/orlitzky"
}
```
Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc

These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,

1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
3. We remove `SAGE_TMP`.

Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.

Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.



CC:  @slel @tscrim @kiwifb

Reviewer: Matthias Koeppe, Dima Pasechnik

Author: Michael Orlitzky

Branch: d94a1e62c1ce92ab65cd840b3f002101b00a36e5

Dependencies: #33829, #33790

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33213





---

archive/issue_comments_502134.json:
```json
{
    "body": "<a id='comment:1'></a>I've posted a work-in-progress branch that raises a question. The python docs,\n\n  https://docs.python.org/3/library/tempfile.html\n\nstate that, in regards to a named temporary file,\n\n> Whether the name can be used to open the file a second time, while the named temporary\n> file is still open, varies across platforms (it can be so used on Unix; it cannot on\n> Windows NT or later)\n\n\nSo in many cases, where I would have liked to have done\n\n```\nsage: with tempfile.NamedTemporaryFile() as f:\n....:     q.save_image(f.name)\n```\n\nI have instead done something like\n\n```\nsage: f = tempfile.NamedTemporaryFile(delete=False); f.close()\nsage: q.save_image(f.name)\nsage: os.remove(f.name)\n```\n\nor\n\n```\nsage: with tempfile.TemporaryDirectory() as d:\n....:     filename = os.path.join(d, \"foo.png\") \n....:     q.save_image(filename)\n```\n\nto avoid the `save_image` call reopening the same name. However, the docs are unclear about what \"on Windows\" means. So the two examples above can be simplified if this is not a problem on cygwin.\n\n---\nLast 10 new commits:",
    "created_at": "2022-02-15T15:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502134",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>I've posted a work-in-progress branch that raises a question. The python docs,

  https://docs.python.org/3/library/tempfile.html

state that, in regards to a named temporary file,

> Whether the name can be used to open the file a second time, while the named temporary
> file is still open, varies across platforms (it can be so used on Unix; it cannot on
> Windows NT or later)


So in many cases, where I would have liked to have done

```
sage: with tempfile.NamedTemporaryFile() as f:
....:     q.save_image(f.name)
```

I have instead done something like

```
sage: f = tempfile.NamedTemporaryFile(delete=False); f.close()
sage: q.save_image(f.name)
sage: os.remove(f.name)
```

or

```
sage: with tempfile.TemporaryDirectory() as d:
....:     filename = os.path.join(d, "foo.png") 
....:     q.save_image(filename)
```

to avoid the `save_image` call reopening the same name. However, the docs are unclear about what "on Windows" means. So the two examples above can be simplified if this is not a problem on cygwin.

---
Last 10 new commits:



---

archive/issue_comments_502135.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,24 +1,15 @@\n-In many cases, we use `tmp_dir()`, `tmp_filename()` and `SAGE_TMP` where the standard python library functions would be more appropriate. Picking a doctest at random,\n+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n \n-```\n-sage: q = Tachyon()                                                                                                                                              \n-sage: q.light((1,1,11), 1,(1,1,1))                                                                                                                               \n-sage: q.texture('s')                                                                                                                                             \n-sage: q.sphere((0,-1,1),1,'s')                                                                                                                                   \n-sage: tempname = tmp_filename()                                                                                                                                  \n-sage: q.save_image(tempname)\n-```\n+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n \n-would be much better off with the last two lines,\n+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n+3. We remove `SAGE_TMP`.\n \n-```\n-sage: with tempfile.NamedTemporaryFile() as f:\n-....:     q.save_image(f.name)\n-```\n+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n \n-That's simpler, cleans up the file immediately, and uses the OS's temporary storage rather than the user's home directory. The last bit can make a big difference when (for example) `/tmp` is mounted in RAM to minimize accesses to a slow disk.\n+In concert with #8784, this will make sage-cleaner obsolete.\n \n-Not important, just something to kill time on a rainy day.\n \n Summary: Avoid SAGE_TMP for truly transient files and directories\n \n```\n",
    "created_at": "2022-02-15T15:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502135",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,24 +1,15 @@
-In many cases, we use `tmp_dir()`, `tmp_filename()` and `SAGE_TMP` where the standard python library functions would be more appropriate. Picking a doctest at random,
+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc
 
-```
-sage: q = Tachyon()                                                                                                                                              
-sage: q.light((1,1,11), 1,(1,1,1))                                                                                                                               
-sage: q.texture('s')                                                                                                                                             
-sage: q.sphere((0,-1,1),1,'s')                                                                                                                                   
-sage: tempname = tmp_filename()                                                                                                                                  
-sage: q.save_image(tempname)
-```
+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,
 
-would be much better off with the last two lines,
+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
+3. We remove `SAGE_TMP`.
 
-```
-sage: with tempfile.NamedTemporaryFile() as f:
-....:     q.save_image(f.name)
-```
+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
 
-That's simpler, cleans up the file immediately, and uses the OS's temporary storage rather than the user's home directory. The last bit can make a big difference when (for example) `/tmp` is mounted in RAM to minimize accesses to a slow disk.
+In concert with #8784, this will make sage-cleaner obsolete.
 
-Not important, just something to kill time on a rainy day.
 
 Summary: Avoid SAGE_TMP for truly transient files and directories
 
```




---

archive/issue_comments_502136.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T11:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502137.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-18T00:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502138.json:
```json
{
    "body": "<a id='comment:4'></a>Making #8784 a dependency because we can avoid many contortions on this branch if we don't have to keep sage-cleaner aware of where the `spawned_processes` file lives.",
    "created_at": "2022-02-18T00:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502138",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>Making #8784 a dependency because we can avoid many contortions on this branch if we don't have to keep sage-cleaner aware of where the `spawned_processes` file lives.



---

archive/issue_comments_502139.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n+\n+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n+\n+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n+3. We remove `SAGE_TMP`.\n+\n+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n+\n+With #8784 as a dependency, we are also able to,\n+\n+4. Remove sage-cleaner entirely.\n+\n \n \n Summary: Avoid SAGE_TMP for truly transient files and directories\n```\n",
    "created_at": "2022-02-18T00:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502139",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc
+
+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,
+
+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
+3. We remove `SAGE_TMP`.
+
+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
+
+With #8784 as a dependency, we are also able to,
+
+4. Remove sage-cleaner entirely.
+
 
 
 Summary: Avoid SAGE_TMP for truly transient files and directories
```




---

archive/issue_comments_502140.json:
```json
{
    "body": "<a id='comment:5'></a>How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:\n\n1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.\n2. Segfault the sage that you started, e.g., by doing something stupid with Cython.\n\nWhat happens?  Are all temp files and spawned processes properly cleaned up?\n\nIt's an unfortunate reality that we make Cython relatively easy to use, hence it's easy from the command line or notebook to segfault a running Sage process.\n\nJust curious.  I never liked or wanted to write sage-cleaner, but I couldn't think of any better approach to make end users happy.",
    "created_at": "2022-02-18T00:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502140",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:

1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.
2. Segfault the sage that you started, e.g., by doing something stupid with Cython.

What happens?  Are all temp files and spawned processes properly cleaned up?

It's an unfortunate reality that we make Cython relatively easy to use, hence it's easy from the command line or notebook to segfault a running Sage process.

Just curious.  I never liked or wanted to write sage-cleaner, but I couldn't think of any better approach to make end users happy.



---

archive/issue_comments_502141.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 was]:\n> How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:\n> \n> 1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.\n> 2. Segfault the sage that you started, e.g., by doing something stupid with Cython.\n> \n> What happens?  Are all temp files and spawned processes properly cleaned up?\n\n\n1. Now that all temporary files are created in `/tmp` or equivalent, they'll be cleaned up by the system eventually. In the event of a crash, I would say that this is preferable, because those temporary files can contain important debugging information.\n\n2. Sage doesn't segfault. More seriously, it depends on the process. In the simplest case, the subprocess will continue doing whatever it's doing until it completes, and will then terminate. Next would be subprocesses that communicate with the parent; eventually they'll be sent a SIGPIPE and commit suicide. If you go out of your way to launch something that is basically a daemon, though, it can indeed outlive the parent.\n\nFor (2) to be an issue, you have to launch a standalone process that never terminates, detach it from the parent, compile a C extension, load the extension into your current session, and then cause it to segfault. I don't think cleaning up after that situation should be the responsibility of *any* application; but especially not of a computer algebra system.\n\nIf you intend to do something like that frequently (or host a service for users who will...), there are better solutions these days -- cgroups on linux being the best example. Keeping in mind that sage-cleaner works by parsing a `spawned_processes` file that must be updated every time a process is launched, solving the problem at the OS level in particular has the advantage that it will catch sub-subprocesses. Sage-cleaner generally cannot (unless the subprocess is also sage), because the subprocess doesn't know that it's supposed to add a line item to `spawned_processes`.",
    "created_at": "2022-02-18T01:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502141",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'></a>Replying to [comment:5 was]:
> How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:
> 
> 1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.
> 2. Segfault the sage that you started, e.g., by doing something stupid with Cython.
> 
> What happens?  Are all temp files and spawned processes properly cleaned up?


1. Now that all temporary files are created in `/tmp` or equivalent, they'll be cleaned up by the system eventually. In the event of a crash, I would say that this is preferable, because those temporary files can contain important debugging information.

2. Sage doesn't segfault. More seriously, it depends on the process. In the simplest case, the subprocess will continue doing whatever it's doing until it completes, and will then terminate. Next would be subprocesses that communicate with the parent; eventually they'll be sent a SIGPIPE and commit suicide. If you go out of your way to launch something that is basically a daemon, though, it can indeed outlive the parent.

For (2) to be an issue, you have to launch a standalone process that never terminates, detach it from the parent, compile a C extension, load the extension into your current session, and then cause it to segfault. I don't think cleaning up after that situation should be the responsibility of *any* application; but especially not of a computer algebra system.

If you intend to do something like that frequently (or host a service for users who will...), there are better solutions these days -- cgroups on linux being the best example. Keeping in mind that sage-cleaner works by parsing a `spawned_processes` file that must be updated every time a process is launched, solving the problem at the OS level in particular has the advantage that it will catch sub-subprocesses. Sage-cleaner generally cannot (unless the subprocess is also sage), because the subprocess doesn't know that it's supposed to add a line item to `spawned_processes`.



---

archive/issue_comments_502142.json:
```json
{
    "body": "<a id='comment:7'></a>I should also point out that it's not critical that we remove sage-cleaner at this point. The main hurdle wrt the removal of `SAGE_TMP` is that sage-cleaner and the sage library (`register_spawned_process()`) need to agree on a location for the spawned processes file. The current branch uses a temporary file in the library that lives for the duration of the sage session, and that's of no use to sage-cleaner due to the random name. We could still store the spawned processes file with a fixed name in `DOT_SAGE`, though, probably with the current sage PID tacked onto the path somewhere.\n\nI saw this as a good time to remove it because its one *crucial* job -- to clean up `SAGE_TMP` under `$HOME` -- is now obsolete.",
    "created_at": "2022-02-18T01:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502142",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>I should also point out that it's not critical that we remove sage-cleaner at this point. The main hurdle wrt the removal of `SAGE_TMP` is that sage-cleaner and the sage library (`register_spawned_process()`) need to agree on a location for the spawned processes file. The current branch uses a temporary file in the library that lives for the duration of the sage session, and that's of no use to sage-cleaner due to the random name. We could still store the spawned processes file with a fixed name in `DOT_SAGE`, though, probably with the current sage PID tacked onto the path somewhere.

I saw this as a good time to remove it because its one *crucial* job -- to clean up `SAGE_TMP` under `$HOME` -- is now obsolete.



---

archive/issue_comments_502143.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-18T04:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502144.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-18T04:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502144",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_502145.json:
```json
{
    "body": "<a id='comment:9'></a>I believe I've fixed all of the test failures so I'm setting this to `needs_review` to see what the patchbots think.",
    "created_at": "2022-02-18T04:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502145",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>I believe I've fixed all of the test failures so I'm setting this to `needs_review` to see what the patchbots think.



---

archive/issue_comments_502146.json:
```json
{
    "body": "<a id='comment:10'></a>testing on https://github.com/sagemath/sagetrac-mirror/actions/runs/1864348438",
    "created_at": "2022-02-18T12:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502146",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>testing on https://github.com/sagemath/sagetrac-mirror/actions/runs/1864348438



---

archive/issue_comments_502147.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks `@`mjo for your explanation.   Your responses don't necessarily apply in the context of users that got me to write the sage-cleaner in the first place, and they will probably be pretty annoyed if they ever realize what happened.  Sage is different than some more less complicated computer algebra software like Magma, because Sage much more frequently spawns subprocesses.  Fortunately, over the years the number of subprocesses Sage spawns has been reduced due to writing and using C library interfaces instead of pexpect, etc.\n\nRegarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from \"temp files get cleaned up by Sage itself quickly\" to \"maybe someday the system will clean them up\".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.\n\nI agree that when users are using Linux, have sufficient privileges to use containers, and also actually know how to use them, then these same problems can be solved in a more robust way.   However, this is a small percentage of users of Sage.  Many users use other operating systems or don't have admin permissions.\n\nCoCalc is the main platform for running Sage that I care about these days, and every individual \"project\" is its own container, /tmp is extremely ephemeral, etc., so everything you say applies there.  That said, users of CoCalc can't use Docker or other container mechanisms themselves within projects, due to security constraints.  \n\nIn any case, I'm not personally worried about these changes having any adverse impact for me.    However, I'm leaving this comment here so people who are impacted can maybe know they may have to revert these patches for their own install of Sage.  Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why.   Hopefully they google and find this comment.",
    "created_at": "2022-02-18T14:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502147",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>Thanks `@`mjo for your explanation.   Your responses don't necessarily apply in the context of users that got me to write the sage-cleaner in the first place, and they will probably be pretty annoyed if they ever realize what happened.  Sage is different than some more less complicated computer algebra software like Magma, because Sage much more frequently spawns subprocesses.  Fortunately, over the years the number of subprocesses Sage spawns has been reduced due to writing and using C library interfaces instead of pexpect, etc.

Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from "temp files get cleaned up by Sage itself quickly" to "maybe someday the system will clean them up".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.

I agree that when users are using Linux, have sufficient privileges to use containers, and also actually know how to use them, then these same problems can be solved in a more robust way.   However, this is a small percentage of users of Sage.  Many users use other operating systems or don't have admin permissions.

CoCalc is the main platform for running Sage that I care about these days, and every individual "project" is its own container, /tmp is extremely ephemeral, etc., so everything you say applies there.  That said, users of CoCalc can't use Docker or other container mechanisms themselves within projects, due to security constraints.  

In any case, I'm not personally worried about these changes having any adverse impact for me.    However, I'm leaving this comment here so people who are impacted can maybe know they may have to revert these patches for their own install of Sage.  Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why.   Hopefully they google and find this comment.



---

archive/issue_comments_502148.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 was]:\n> \n> Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from \"temp files get cleaned up by Sage itself quickly\" to \"maybe someday the system will clean them up\".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.... Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why. Hopefully they google and find this comment. \n\n\nSystemd comes with a timer (like a cron job) to clean up `/tmp`, but I'm not familiar with its out-of-the-box configuration on mainstream distros. I still use OpenRC myself, where a reboot is what triggers it.\n\nOn systems like mine, \"leftover junk\" is a fair criticism, but keep in mind the bigger picture: the python `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()` functions *automatically remove the file/directory as soon as it's done being used.*  In this branch, I've changed a bunch of manual `SAGE_TMP` code to use those two functions, so a lot of what would have been leftover junk is now simply not created in the first place. Any remaining junk is due to sage's own `tmp_filename()` and `tmp_dir()`, which expect you to clean up the file yourself, or assume that sage-cleaner will do it eventually.\n\nIf this gets merged, we can deprecate `tmp_filename()` and `tmp_dir()` as obsolete in favor of the python functions. Over a hopefully-short amount of time, that should eliminate the leftover junk at the source.",
    "created_at": "2022-02-18T15:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502148",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>Replying to [comment:11 was]:
> 
> Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from "temp files get cleaned up by Sage itself quickly" to "maybe someday the system will clean them up".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.... Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why. Hopefully they google and find this comment. 


Systemd comes with a timer (like a cron job) to clean up `/tmp`, but I'm not familiar with its out-of-the-box configuration on mainstream distros. I still use OpenRC myself, where a reboot is what triggers it.

On systems like mine, "leftover junk" is a fair criticism, but keep in mind the bigger picture: the python `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()` functions *automatically remove the file/directory as soon as it's done being used.*  In this branch, I've changed a bunch of manual `SAGE_TMP` code to use those two functions, so a lot of what would have been leftover junk is now simply not created in the first place. Any remaining junk is due to sage's own `tmp_filename()` and `tmp_dir()`, which expect you to clean up the file yourself, or assume that sage-cleaner will do it eventually.

If this gets merged, we can deprecate `tmp_filename()` and `tmp_dir()` as obsolete in favor of the python functions. Over a hopefully-short amount of time, that should eliminate the leftover junk at the source.



---

archive/issue_comments_502149.json:
```json
{
    "body": "<a id='comment:13'></a>indeed, I am not at all worried about junk left at `/tmp`, as, at least as far as documentation of Python is correct, the facility of  [NamedTemporaryFile](https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile) cleans up after itself automatically (I guess it uses POSIX's `tmpfile(3)` behind the scene).\n\nI am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?",
    "created_at": "2022-02-18T15:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502149",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>indeed, I am not at all worried about junk left at `/tmp`, as, at least as far as documentation of Python is correct, the facility of  [NamedTemporaryFile](https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile) cleans up after itself automatically (I guess it uses POSIX's `tmpfile(3)` behind the scene).

I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?



---

archive/issue_comments_502150.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 dimpase]:\n> \n> I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?\n\n\nIf you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see comment:1). I would love to simplify it if someone with a cygwin installation says that the \"on Windows\" warning doesn't apply there.",
    "created_at": "2022-02-18T15:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502150",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'></a>Replying to [comment:13 dimpase]:
> 
> I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?


If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see comment:1). I would love to simplify it if someone with a cygwin installation says that the "on Windows" warning doesn't apply there.



---

archive/issue_comments_502151.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 mjo]:\n>\n> If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see comment:1). I would love to simplify it if someone with a cygwin installation says that the \"on Windows\" warning doesn't apply there.\n\n\n(If it DOES apply on cygwin, we could improve this in the future by updating the functions that now take a filename to also accept an open file handle; that will avoid re-`open()`ing it.)",
    "created_at": "2022-02-18T15:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502151",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>Replying to [comment:14 mjo]:
>
> If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see comment:1). I would love to simplify it if someone with a cygwin installation says that the "on Windows" warning doesn't apply there.


(If it DOES apply on cygwin, we could improve this in the future by updating the functions that now take a filename to also accept an open file handle; that will avoid re-`open()`ing it.)



---

archive/issue_comments_502152.json:
```json
{
    "body": "<a id='comment:16'></a>Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.",
    "created_at": "2022-02-18T15:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502152",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.



---

archive/issue_comments_502153.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 dimpase]:\n> Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.\n\n\nYou have two wishes remaining =)\n\nI'm \"happy\" to go back and change all of those doctests, but I'd like confirmation before I spend half a day doing it.",
    "created_at": "2022-02-18T15:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502153",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'></a>Replying to [comment:16 dimpase]:
> Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.


You have two wishes remaining =)

I'm "happy" to go back and change all of those doctests, but I'd like confirmation before I spend half a day doing it.



---

archive/issue_comments_502154.json:
```json
{
    "body": "<a id='comment:18'></a>Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.",
    "created_at": "2022-02-18T16:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502154",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.



---

archive/issue_comments_502155.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 dimpase]:\n> Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.\n\n\nWe just need to know if this works,\n\n```\nsage: import tempfile\nsage: p = plot(sin(x), x, (-pi, pi))\nsage: with tempfile.NamedTemporaryFile(suffix=\".png\") as f:\n....:     p.save(filename=f.name)\n....: \n```\n\nor if the fact that `save()` reopens the (already open) file causes problem.",
    "created_at": "2022-02-18T16:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502155",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'></a>Replying to [comment:18 dimpase]:
> Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.


We just need to know if this works,

```
sage: import tempfile
sage: p = plot(sin(x), x, (-pi, pi))
sage: with tempfile.NamedTemporaryFile(suffix=".png") as f:
....:     p.save(filename=f.name)
....: 
```

or if the fact that `save()` reopens the (already open) file causes problem.



---

archive/issue_comments_502156.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-18T16:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502157.json:
```json
{
    "body": "<a id='comment:21'></a>That last commit should avoid most leftover junk in the meantime, too. It's easy so why not.",
    "created_at": "2022-02-18T16:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502157",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>That last commit should avoid most leftover junk in the meantime, too. It's easy so why not.



---

archive/issue_comments_502158.json:
```json
{
    "body": "<a id='comment:22'></a>`@`was - this ticket, and its dependency #8784, are also to properly fix #33027",
    "created_at": "2022-02-18T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502158",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>`@`was - this ticket, and its dependency #8784, are also to properly fix #33027



---

archive/issue_comments_502159.json:
```json
{
    "body": "<a id='comment:23'></a>Hi everybody - thanks for the comments. **I just want to be clear that I am in no way suggesting blocking this ticket moving forward with a positive review.**  I just want to record my misgivings here, so they may be helpful for anybody that might hit problems as a result.  I'm not a fan of this stupid sage-cleaner hack that I wrote long ago, and I'm happy to see it get deleted.",
    "created_at": "2022-02-18T16:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502159",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:23'></a>Hi everybody - thanks for the comments. **I just want to be clear that I am in no way suggesting blocking this ticket moving forward with a positive review.**  I just want to record my misgivings here, so they may be helpful for anybody that might hit problems as a result.  I'm not a fan of this stupid sage-cleaner hack that I wrote long ago, and I'm happy to see it get deleted.



---

archive/issue_comments_502160.json:
```json
{
    "body": "<a id='comment:24'></a>The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n\nHowever, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.",
    "created_at": "2022-02-18T19:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.

However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.



---

archive/issue_comments_502161.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:\n> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n> \n> However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.\n\n\nTo my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.\n\nIf we want to raise a deprecation warning for it, I can do so in a way that doesn't affect the rest of this ticket by changing `SAGE_TMP` to return a `tempfile.TemporaryDirectory()` instead of the old `DOT_SAGE` value. Then its use won't create anything that would require sage-cleaner to remove.",
    "created_at": "2022-02-18T23:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502161",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:
> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.
> 
> However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.


To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.

If we want to raise a deprecation warning for it, I can do so in a way that doesn't affect the rest of this ticket by changing `SAGE_TMP` to return a `tempfile.TemporaryDirectory()` instead of the old `DOT_SAGE` value. Then its use won't create anything that would require sage-cleaner to remove.



---

archive/issue_comments_502162.json:
```json
{
    "body": "<a id='comment:26'></a>I'm still -1 on removing the `sage-cleaner` here on the same ticket. \n\nIn particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. Let's please not introduce big changes like this without a proper transition plan.",
    "created_at": "2022-02-18T23:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>I'm still -1 on removing the `sage-cleaner` here on the same ticket. 

In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. Let's please not introduce big changes like this without a proper transition plan.



---

archive/issue_comments_502163.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:\n> I'm still -1 on removing the `sage-cleaner` here on the same ticket. \n> \n> In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. \n\n\nThat's mainly because of #8784.",
    "created_at": "2022-02-19T00:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502163",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:
> I'm still -1 on removing the `sage-cleaner` here on the same ticket. 
> 
> In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. 


That's mainly because of #8784.



---

archive/issue_comments_502164.json:
```json
{
    "body": "<a id='comment:28'></a>Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.",
    "created_at": "2022-02-19T00:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502164",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.



---

archive/issue_comments_502165.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 mkoeppe]:\n> Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.\n\n\nIt doesn't really delete anything except the files created specifically for the benefit of sage-cleaner, and some legacy paths whose locations were changed in the `fix_old_mistakes()` funtion.\n\nI'm not strongly opposed to leaving sage-cleaner alone, but a deprecation warning on killed processes is going to produce false positives on every process that would have terminated nicely but was killed prematurely by sage-cleaner, i.e. most of them.",
    "created_at": "2022-02-19T00:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502165",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:29'></a>Replying to [comment:28 mkoeppe]:
> Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.


It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner, and some legacy paths whose locations were changed in the `fix_old_mistakes()` funtion.

I'm not strongly opposed to leaving sage-cleaner alone, but a deprecation warning on killed processes is going to produce false positives on every process that would have terminated nicely but was killed prematurely by sage-cleaner, i.e. most of them.



---

archive/issue_comments_502166.json:
```json
{
    "body": "<a id='comment:30'></a>Perhaps it would be interesting to know whether after the changes (but keeping the cleaner in) the cleaner would still have anything to kill.\n(my understanding it starts after Sage terminates, so most likely it won't have to do anything)",
    "created_at": "2022-02-19T01:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502166",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Perhaps it would be interesting to know whether after the changes (but keeping the cleaner in) the cleaner would still have anything to kill.
(my understanding it starts after Sage terminates, so most likely it won't have to do anything)



---

archive/issue_comments_502167.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:29 mjo]:\n> Replying to [comment:28 mkoeppe]:\n> > whenever the cleaner [...] deletes something.\n\n> \n> It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner\n\n\nYou are right, thanks.",
    "created_at": "2022-02-19T01:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502167",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Replying to [comment:29 mjo]:
> Replying to [comment:28 mkoeppe]:
> > whenever the cleaner [...] deletes something.

> 
> It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner


You are right, thanks.



---

archive/issue_comments_502168.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:18 dimpase]:\n> Perhaps slelievre can test this on Cygwin\n\n\nMy attempts to build 9.5 beta and rc\nreleases fail on `sagemath_doc_html`.\n\nMy attempts to build the 9.6 beta releases\nfail earlier, on `sagelib` I think.",
    "created_at": "2022-02-19T11:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502168",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'></a>Replying to [comment:18 dimpase]:
> Perhaps slelievre can test this on Cygwin


My attempts to build 9.5 beta and rc
releases fail on `sagemath_doc_html`.

My attempts to build the 9.6 beta releases
fail earlier, on `sagelib` I think.



---

archive/issue_comments_502169.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 slelievre]:\n> \n> My attempts to build the 9.6 beta releases\n> fail earlier, on `sagelib` I think.\n> \n\n\nFortunately this is only a python question... if you don't mind, does this work?\n\n```\n>>> import tempfile\n>>> with tempfile.NamedTemporaryFile(suffix=\".txt\") as f:\n...     with open(f.name, \"w\") as g:\n...         _ = g.write(\"Hello, world!\")\n...     with open(f.name) as h:\n...         contents = h.read()\n... \n>>> print(contents)\nHello, world!\n```",
    "created_at": "2022-02-19T11:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502169",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:33'></a>Replying to [comment:32 slelievre]:
> 
> My attempts to build the 9.6 beta releases
> fail earlier, on `sagelib` I think.
> 


Fortunately this is only a python question... if you don't mind, does this work?

```
>>> import tempfile
>>> with tempfile.NamedTemporaryFile(suffix=".txt") as f:
...     with open(f.name, "w") as g:
...         _ = g.write("Hello, world!")
...     with open(f.name) as h:
...         contents = h.read()
... 
>>> print(contents)
Hello, world!
```



---

archive/issue_comments_502170.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:24 mkoeppe]:\n> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n> \n> However, I would suggest to split this ticket\n\n\nI've opened #33383 for the easy to review changes in the doctests.",
    "created_at": "2022-02-19T20:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>Replying to [comment:24 mkoeppe]:
> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.
> 
> However, I would suggest to split this ticket


I've opened #33383 for the easy to review changes in the doctests.



---

archive/issue_comments_502171.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:33 mjo]:\n> does this work?\n> \n> \n> ```\n> >>> import tempfile\n> >>> with tempfile.NamedTemporaryFile(suffix=\".txt\") as f:\n> ...     with open(f.name, \"w\") as g:\n> ...         _ = g.write(\"Hello, world!\")\n> ...     with open(f.name) as h:\n> ...         contents = h.read()\n> ... \n> >>> print(contents)\n> Hello, world!\n> ```\n\n\nYes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.",
    "created_at": "2022-02-21T18:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502171",
    "user": "https://github.com/slel"
}
```

<a id='comment:35'></a>Replying to [comment:33 mjo]:
> does this work?
> 
> 
> ```
> >>> import tempfile
> >>> with tempfile.NamedTemporaryFile(suffix=".txt") as f:
> ...     with open(f.name, "w") as g:
> ...         _ = g.write("Hello, world!")
> ...     with open(f.name) as h:
> ...         contents = h.read()
> ... 
> >>> print(contents)
> Hello, world!
> ```


Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.



---

archive/issue_comments_502172.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 slelievre]:\n> \n> Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.\n\n\nThank you! That means I can go back and simplify a lot of stuff.",
    "created_at": "2022-02-21T19:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502172",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:36'></a>Replying to [comment:35 slelievre]:
> 
> Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.


Thank you! That means I can go back and simplify a lot of stuff.



---

archive/issue_comments_502173.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-22T01:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502174.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n+\n+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n+\n+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n+3. We remove `SAGE_TMP`.\n+\n+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n+\n+Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.\n+\n \n \n Summary: Avoid SAGE_TMP for truly transient files and directories\n```\n",
    "created_at": "2022-02-22T01:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502174",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc
+
+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,
+
+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
+3. We remove `SAGE_TMP`.
+
+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
+
+Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.
+
 
 
 Summary: Avoid SAGE_TMP for truly transient files and directories
```




---

archive/issue_comments_502175.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-22T01:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502175",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_502176.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-22T20:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502177.json:
```json
{
    "body": "<a id='comment:41'></a>Ok, back to patchbots.\n\nThis branch is based on #32987 which deprecates `sage_makedirs` (also now redundant), and *does not* remove sage-cleaner. We can do that in another ticket.",
    "created_at": "2022-02-23T10:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502177",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:41'></a>Ok, back to patchbots.

This branch is based on #32987 which deprecates `sage_makedirs` (also now redundant), and *does not* remove sage-cleaner. We can do that in another ticket.



---

archive/issue_comments_502178.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-23T10:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502178",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_502179.json:
```json
{
    "body": "<a id='comment:43'></a>This one needs to be reverted:\n\n```\ndiff --git a/src/doc/en/reference/interfaces/index.rst b/src/doc/en/reference/interfaces/index.rst\nindex d007f67..f09fc62 100644\n--- a/src/doc/en/reference/interfaces/index.rst\n+++ b/src/doc/en/reference/interfaces/index.rst\n@@ -108,7 +108,6 @@ and testing to make sure nothing funny is going on).\n    sage/interfaces/tachyon\n    sage/interfaces/tides\n \n-   sage/interfaces/cleaner\n    sage/interfaces/quit\n    sage/interfaces/read_data\n \n```",
    "created_at": "2022-02-23T17:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502179",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>This one needs to be reverted:

```
diff --git a/src/doc/en/reference/interfaces/index.rst b/src/doc/en/reference/interfaces/index.rst
index d007f67..f09fc62 100644
--- a/src/doc/en/reference/interfaces/index.rst
+++ b/src/doc/en/reference/interfaces/index.rst
@@ -108,7 +108,6 @@ and testing to make sure nothing funny is going on).
    sage/interfaces/tachyon
    sage/interfaces/tides
 
-   sage/interfaces/cleaner
    sage/interfaces/quit
    sage/interfaces/read_data
 
```



---

archive/issue_comments_502180.json:
```json
{
    "body": "<a id='comment:44'></a>Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?",
    "created_at": "2022-02-23T17:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?



---

archive/issue_comments_502181.json:
```json
{
    "body": "<a id='comment:45'></a>Also `src/sage/interfaces/expect.py` still has cleaner-related changes",
    "created_at": "2022-02-23T17:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Also `src/sage/interfaces/expect.py` still has cleaner-related changes



---

archive/issue_comments_502182.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-23T17:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_502183.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-23T18:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_502184.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:43 mkoeppe]:\n> This one needs to be reverted:\n\n\nThanks, done. I also removed the `cleaner()` function from `sage.interfaces.cleaner`, since it was replaced by `register_spawned_process()` in `sage.interfaces.quit`.",
    "created_at": "2022-02-23T18:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502184",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:48'></a>Replying to [comment:43 mkoeppe]:
> This one needs to be reverted:


Thanks, done. I also removed the `cleaner()` function from `sage.interfaces.cleaner`, since it was replaced by `register_spawned_process()` in `sage.interfaces.quit`.



---

archive/issue_comments_502185.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:44 mkoeppe]:\n> Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?\n\n\nI don't have a strong opinion either way. The main downside is that it would clutter the global namespace for something that is pretty much only used for doctests. On the other hand, if we import it automatically only during doctesting, then the examples can't be copy & pasted.",
    "created_at": "2022-02-23T18:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502185",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:49'></a>Replying to [comment:44 mkoeppe]:
> Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?


I don't have a strong opinion either way. The main downside is that it would clutter the global namespace for something that is pretty much only used for doctests. On the other hand, if we import it automatically only during doctesting, then the examples can't be copy & pasted.



---

archive/issue_comments_502186.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:45 mkoeppe]:\n> Also `src/sage/interfaces/expect.py` still has cleaner-related changes\n\n\nWhich one? The change from `cleaner()` to `register_spawned_process()` is intentional, and will make it easier to remove the cleaner in the future.",
    "created_at": "2022-02-23T18:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502186",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:50'></a>Replying to [comment:45 mkoeppe]:
> Also `src/sage/interfaces/expect.py` still has cleaner-related changes


Which one? The change from `cleaner()` to `register_spawned_process()` is intentional, and will make it easier to remove the cleaner in the future.



---

archive/issue_comments_502187.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:49 mjo]:\n> if we import it automatically only during doctesting\n\n\ndefinitely we shouldn't do that",
    "created_at": "2022-02-23T18:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502187",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Replying to [comment:49 mjo]:
> if we import it automatically only during doctesting


definitely we shouldn't do that



---

archive/issue_comments_502188.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-27T16:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502188",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_502189.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-29T01:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502190.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-29T01:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502190",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_502191.json:
```json
{
    "body": "<a id='comment:55'></a>\n```\nsage -t --long --random-seed=286814129660227055850621679081389420825 src/sage/misc/latex.py\n**********************************************************************\nFile \"src/sage/misc/latex.py\", line 1970, in sage.misc.latex.?\nFailed example:\n    with tempfile.NamedTemporaryFile(suffix=\".png\") as f:\n        png(ZZ[x], f.name) # random, optional - latex imagemagick\nException raised:\n```\nthe `# optional` is on the wrong line",
    "created_at": "2022-03-30T00:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502191",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
```
sage -t --long --random-seed=286814129660227055850621679081389420825 src/sage/misc/latex.py
**********************************************************************
File "src/sage/misc/latex.py", line 1970, in sage.misc.latex.?
Failed example:
    with tempfile.NamedTemporaryFile(suffix=".png") as f:
        png(ZZ[x], f.name) # random, optional - latex imagemagick
Exception raised:
```
the `# optional` is on the wrong line



---

archive/issue_comments_502192.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-30T00:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502192",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_502193.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-30T00:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502194.json:
```json
{
    "body": "<a id='comment:58'></a>Thanks, fixed.",
    "created_at": "2022-03-30T00:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502194",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:58'></a>Thanks, fixed.



---

archive/issue_comments_502195.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-30T00:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502195",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_502196.json:
```json
{
    "body": "<a id='comment:59'></a>\n```\n--- a/src/sage/repl/attach.py\n+++ b/src/sage/repl/attach.py\n@@ -170,12 +170,14 @@ def load_attach_path(path=None, replace=False):\n...\n+    We put a new, empty direcoty on the attach path for testing\n```\n\"directory\"",
    "created_at": "2022-03-30T01:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502196",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
```
--- a/src/sage/repl/attach.py
+++ b/src/sage/repl/attach.py
@@ -170,12 +170,14 @@ def load_attach_path(path=None, replace=False):
...
+    We put a new, empty direcoty on the attach path for testing
```
"directory"



---

archive/issue_comments_502197.json:
```json
{
    "body": "<a id='comment:60'></a>Overall, I'm a bit unsure about changes like this one to the doctests. \nWhat is lost for the user is being able to copy-paste the code and then inspect the\ngenerated file.\n\n```\ndiff --git a/src/sage/numerical/mip.pyx b/src/sage/numerical/mip.pyx\nindex d966be1..4bf61d1 100644\n--- a/src/sage/numerical/mip.pyx\n+++ b/src/sage/numerical/mip.pyx\n@@ -1336,7 +1336,9 @@ cdef class MixedIntegerLinearProgram(SageObject):\n             sage: x = p.new_variable(nonnegative=True)\n             sage: p.set_objective(x[1] + x[2])\n             sage: p.add_constraint(-3*x[1] + 2*x[2], max=2,name=\"OneConstraint\")\n-            sage: p.write_mps(os.path.join(SAGE_TMP, \"lp_problem.mps\"))\n+            sage: import tempfile\n+            sage: with tempfile.NamedTemporaryFile(suffix=\".mps\") as f:\n+            ....:     p.write_mps(f.name)\n             Writing problem data to ...\n             17 records were written\n```",
    "created_at": "2022-03-30T01:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502197",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Overall, I'm a bit unsure about changes like this one to the doctests. 
What is lost for the user is being able to copy-paste the code and then inspect the
generated file.

```
diff --git a/src/sage/numerical/mip.pyx b/src/sage/numerical/mip.pyx
index d966be1..4bf61d1 100644
--- a/src/sage/numerical/mip.pyx
+++ b/src/sage/numerical/mip.pyx
@@ -1336,7 +1336,9 @@ cdef class MixedIntegerLinearProgram(SageObject):
             sage: x = p.new_variable(nonnegative=True)
             sage: p.set_objective(x[1] + x[2])
             sage: p.add_constraint(-3*x[1] + 2*x[2], max=2,name="OneConstraint")
-            sage: p.write_mps(os.path.join(SAGE_TMP, "lp_problem.mps"))
+            sage: import tempfile
+            sage: with tempfile.NamedTemporaryFile(suffix=".mps") as f:
+            ....:     p.write_mps(f.name)
             Writing problem data to ...
             17 records were written
```



---

archive/issue_comments_502198.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-30T01:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502199.json:
```json
{
    "body": "<a id='comment:62'></a>Replying to [comment:59 mkoeppe]:\n> \"directory\"\n\n\nalso fixed",
    "created_at": "2022-03-30T01:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502199",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:62'></a>Replying to [comment:59 mkoeppe]:
> "directory"


also fixed



---

archive/issue_comments_502200.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:60 mkoeppe]:\n> Overall, I'm a bit unsure about changes like this one to the doctests. \n> What is lost for the user is being able to copy-paste the code and then inspect the\n> generated file.\n\n\nIn many cases, the point of the method is that it writes what would normally be shown to the user to a file instead. If you want to see this MILP, for example, then `p.show()` can be used instead. I'm dodging your point, but looking back, many of these tests are in the same spirit.\n\nIn general, I would say it's bad practice to give users code that will write to a temporary file and teach them to expect it to remain there. It's better to have these copy/paste examples fail immediately, so that the user will pick a non-temporary path for his own experiments. Otherwise he could lose some work when sage exits or when the machine reboots.",
    "created_at": "2022-03-30T01:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502200",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:63'></a>Replying to [comment:60 mkoeppe]:
> Overall, I'm a bit unsure about changes like this one to the doctests. 
> What is lost for the user is being able to copy-paste the code and then inspect the
> generated file.


In many cases, the point of the method is that it writes what would normally be shown to the user to a file instead. If you want to see this MILP, for example, then `p.show()` can be used instead. I'm dodging your point, but looking back, many of these tests are in the same spirit.

In general, I would say it's bad practice to give users code that will write to a temporary file and teach them to expect it to remain there. It's better to have these copy/paste examples fail immediately, so that the user will pick a non-temporary path for his own experiments. Otherwise he could lose some work when sage exits or when the machine reboots.



---

archive/issue_events_087736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33213#event-87736"
}
```



---

archive/issue_comments_502201.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-04-25T10:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502202.json:
```json
{
    "body": "<a id='comment:67'></a>I've split out #33779: Remove use of `SAGE_TMP` in `sage.interfaces.latte`",
    "created_at": "2022-05-01T01:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502202",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'></a>I've split out #33779: Remove use of `SAGE_TMP` in `sage.interfaces.latte`



---

archive/issue_comments_502203.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:25 mjo]:\n> Replying to [comment:24 mkoeppe]:\n> > user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. [...]\n\n> \n> To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.\n\n\nCurrent branch still removes `SAGE_TMP`. This needs to be backed out. Likewise the removal of `ECL_TMP`, `SPYX_TMP` - they are part of the public API.",
    "created_at": "2022-05-01T01:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502203",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>Replying to [comment:25 mjo]:
> Replying to [comment:24 mkoeppe]:
> > user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. [...]

> 
> To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.


Current branch still removes `SAGE_TMP`. This needs to be backed out. Likewise the removal of `ECL_TMP`, `SPYX_TMP` - they are part of the public API.



---

archive/issue_comments_502204.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-05-03T11:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502205.json:
```json
{
    "body": "<a id='comment:70'></a>I replaced the removal of `SAGE_TMP` by a deprecation, and likewise with the rename `SPYX_TMP` -> `spyx_tmp()`.\n\nI don't fully agree with doing the same for `ECL_TMP` since sage doesn't use it any more: anyone using it will have their code implicitly broken rather than explicitly. Nevertheless, I doubt anyone is using it, so I've put it back with a deprecation and relocated the path somewhere under the system's temporary location.",
    "created_at": "2022-05-03T11:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502205",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:70'></a>I replaced the removal of `SAGE_TMP` by a deprecation, and likewise with the rename `SPYX_TMP` -> `spyx_tmp()`.

I don't fully agree with doing the same for `ECL_TMP` since sage doesn't use it any more: anyone using it will have their code implicitly broken rather than explicitly. Nevertheless, I doubt anyone is using it, so I've put it back with a deprecation and relocated the path somewhere under the system's temporary location.



---

archive/issue_comments_502206.json:
```json
{
    "body": "<a id='comment:71'></a>Could you move the new functions `spyx_tmp` to `sage.misc.temporary_file`, like I tried in #32986? This would help with modularization",
    "created_at": "2022-05-03T14:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502206",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>Could you move the new functions `spyx_tmp` to `sage.misc.temporary_file`, like I tried in #32986? This would help with modularization



---

archive/issue_comments_502207.json:
```json
{
    "body": "<a id='comment:72'></a>I've opened #33790 for the ECL/Maxima stuff - I'd like to run this by the ECL/Maxima people",
    "created_at": "2022-05-03T14:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502207",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>I've opened #33790 for the ECL/Maxima stuff - I'd like to run this by the ECL/Maxima people



---

archive/issue_comments_502208.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-04T00:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502209.json:
```json
{
    "body": "<a id='comment:74'></a>Thanks. I've opened #33793 for this",
    "created_at": "2022-05-04T02:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502209",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>Thanks. I've opened #33793 for this



---

archive/issue_comments_502210.json:
```json
{
    "body": "<a id='comment:75'></a>I forgot to say I'll probably want to keep `sage.misc.temporary_file` without a dependence on Cython modules such as cachefunc",
    "created_at": "2022-05-04T03:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502210",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>I forgot to say I'll probably want to keep `sage.misc.temporary_file` without a dependence on Cython modules such as cachefunc



---

archive/issue_comments_502211.json:
```json
{
    "body": "<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-05-04T14:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502212.json:
```json
{
    "body": "<a id='comment:78'></a>Opened #33797, #33799",
    "created_at": "2022-05-04T19:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502212",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>Opened #33797, #33799



---

archive/issue_comments_502213.json:
```json
{
    "body": "<a id='comment:80'></a>Opened #33829, #33837",
    "created_at": "2022-05-09T23:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502213",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>Opened #33829, #33837



---

archive/issue_comments_502214.json:
```json
{
    "body": "<a id='comment:82'></a>need to get rid of SAGE_TMP in `msolve.py`\n\n```\nsrc/sage/rings/polynomial/msolve.py:from sage.misc.all import SAGE_TMP\nsrc/sage/rings/polynomial/msolve.py:    msolve_in = tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',\n...\n```\n\n---\nLast 10 new commits:",
    "created_at": "2022-06-10T10:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502214",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:82'></a>need to get rid of SAGE_TMP in `msolve.py`

```
src/sage/rings/polynomial/msolve.py:from sage.misc.all import SAGE_TMP
src/sage/rings/polynomial/msolve.py:    msolve_in = tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',
...
```

---
Last 10 new commits:



---

archive/issue_comments_502215.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-10T10:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502215",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_502216.json:
```json
{
    "body": "<a id='comment:83'></a>rebased over the latest 9.7.beta1",
    "created_at": "2022-06-10T10:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502216",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:83'></a>rebased over the latest 9.7.beta1



---

archive/issue_comments_502217.json:
```json
{
    "body": "<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-10T10:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502218.json:
```json
{
    "body": "<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-10T10:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_502219.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-06-10T10:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502219",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_502220.json:
```json
{
    "body": "<a id='comment:86'></a>Matthias, is it OK with you?",
    "created_at": "2022-06-10T10:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502220",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:86'></a>Matthias, is it OK with you?



---

archive/issue_comments_502221.json:
```json
{
    "body": "<a id='comment:87'></a>Is it still on top of #33829?",
    "created_at": "2022-06-10T19:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502221",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:87'></a>Is it still on top of #33829?



---

archive/issue_comments_502222.json:
```json
{
    "body": "<a id='comment:88'></a>Replying to [comment:87 mkoeppe]:\n> Is it still on top of #33829?\n\nit is. Is it wrong?",
    "created_at": "2022-06-10T22:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502222",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:88'></a>Replying to [comment:87 mkoeppe]:
> Is it still on top of #33829?

it is. Is it wrong?



---

archive/issue_comments_502223.json:
```json
{
    "body": "<a id='comment:89'></a>I haven't reviewed the changes on the ticket. The parts that I was able to review have been split out to separate tickets.",
    "created_at": "2022-06-11T18:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502223",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'></a>I haven't reviewed the changes on the ticket. The parts that I was able to review have been split out to separate tickets.



---

archive/issue_comments_502224.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-06-11T18:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502224",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_502225.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-11T18:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502225",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_502226.json:
```json
{
    "body": "<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-06-13T10:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_502227.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-13T10:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502227",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_502228.json:
```json
{
    "body": "<a id='comment:93'></a>rebased over #33829, #33790 (and 9.7.beta2), all good",
    "created_at": "2022-06-13T10:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502228",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:93'></a>rebased over #33829, #33790 (and 9.7.beta2), all good



---

archive/issue_comments_502229.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-13T10:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502229",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_502230.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-21T23:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502230",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087737.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-21T23:22:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33213#event-87737"
}
```



---

archive/issue_comments_502231.json:
```json
{
    "body": "<a id='comment:96'></a>The branch includes a rebased version of #32716",
    "created_at": "2022-06-25T20:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502231",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'></a>The branch includes a rebased version of #32716



---

archive/issue_comments_502232.json:
```json
{
    "body": "<a id='comment:97'></a>Follow-up discussion in https://groups.google.com/g/sage-devel/c/jpwUb8OCVVc",
    "created_at": "2022-09-27T17:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502232",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'></a>Follow-up discussion in https://groups.google.com/g/sage-devel/c/jpwUb8OCVVc



---

archive/issue_comments_502233.json:
```json
{
    "body": "<a id='comment:98'></a>Follow-up ticket: #34593",
    "created_at": "2022-10-12T18:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33213#issuecomment-502233",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:98'></a>Follow-up ticket: #34593
