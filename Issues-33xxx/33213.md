# Issue 33213: Replace SAGE_TMP by the system location in the sage library

archive/issues_032976.json:
```json
{
    "assignees": [],
    "body": "Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n\nThese days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n\n1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n3. We remove `SAGE_TMP`.\n\nAfterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n\nMoreover when #8784 is done, we'll be able to remove sage-cleaner entirely.\n\n\n\nDepends on #33829\nDepends on #33790\n\nCC:  @slel @tscrim @kiwifb\n\nBranch: **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**\n\nReviewer: **Matthias Koeppe, Dima Pasechnik**\n\nAuthor: **Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33213_\n\n",
    "closed_at": "2022-06-21T23:22:55Z",
    "created_at": "2022-01-22T03:02:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Replace SAGE_TMP by the system location in the sage library",
    "type": "issue",
    "updated_at": "2022-10-12T18:29:29Z",
    "url": "https://github.com/sagemath/sage/issues/33213",
    "user": "https://github.com/orlitzky"
}
```
Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc

These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,

1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
3. We remove `SAGE_TMP`.

Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.

Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.



Depends on #33829
Depends on #33790

CC:  @slel @tscrim @kiwifb

Branch: **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**

Reviewer: **Matthias Koeppe, Dima Pasechnik**

Author: **Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/33213_





---

archive/issue_events_424235.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-22T03:02:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424235"
}
```



---

archive/issue_events_424236.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-22T03:02:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424236"
}
```



---

archive/issue_events_424237.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-22T03:02:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424237"
}
```



---

archive/issue_events_424238.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-15T15:17:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "title_is": "Replace SAGE_TMP by the system location in the sage library",
    "title_was": "Avoid SAGE_TMP for truly transient files and directories",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424238"
}
```



---

archive/issue_comments_539701.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI've posted a work-in-progress branch that raises a question. The python docs,\n\n  https://docs.python.org/3/library/tempfile.html\n\nstate that, in regards to a named temporary file,\n\n> Whether the name can be used to open the file a second time, while the named temporary\n> file is still open, varies across platforms (it can be so used on Unix; it cannot on\n> Windows NT or later)\n\nSo in many cases, where I would have liked to have done\n\n```\nsage: with tempfile.NamedTemporaryFile() as f:\n....:     q.save_image(f.name)\n```\n\nI have instead done something like\n\n```\nsage: f = tempfile.NamedTemporaryFile(delete=False); f.close()\nsage: q.save_image(f.name)\nsage: os.remove(f.name)\n```\n\nor\n\n```\nsage: with tempfile.TemporaryDirectory() as d:\n....:     filename = os.path.join(d, \"foo.png\") \n....:     q.save_image(filename)\n```\n\nto avoid the `save_image` call reopening the same name. However, the docs are unclear about what \"on Windows\" means. So the two examples above can be simplified if this is not a problem on cygwin.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dabb1c79737aa7f0ebe2ff400c131987eac91e85\">dabb1c7</a></td><td><code>Trac #33213: replace SAGE_TMP in repl doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c292ea8609e962ebd1bdf8605d54d95b2293a804\">c292ea8</a></td><td><code>Trac #33213: replace SAGE_TMP in magma interface doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/172e9c442076d29b82e63b5b768ea3805a390ddc\">172e9c4</a></td><td><code>Trac #33213: replace SAGE_TMP in dist script doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24499f11354875c59a36e12f9fad8435f19b68ea\">24499f1</a></td><td><code>Trac #33213: remove mentions of SAGE_TMP from the lazy_string module.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c8c0e685a50166b1b325167538a9c101ceaa4d8\">3c8c0e6</a></td><td><code>Trac #33213: replace SAGE_TMP in session doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3db84444abe6723d2e22d2357d557ff53f4e8ebd\">3db8444</a></td><td><code>Trac #33213: remove SAGE_TMP from tmp_dir() and tmp_filename().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e7e080c2345039c9c2e841ae61a4478416ab024\">5e7e080</a></td><td><code>Trac #33213: don't clear SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea2fefd9f7f8143af47e0f7be5840a3291ef074b\">ea2fefd</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8805712fde210545e4a2327d1f06a52e1d29a94\">b880571</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e\">ffd9aa6</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr></table>\n",
    "created_at": "2022-02-15T15:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539701",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'>Comment 1:</a>
I've posted a work-in-progress branch that raises a question. The python docs,

  https://docs.python.org/3/library/tempfile.html

state that, in regards to a named temporary file,

> Whether the name can be used to open the file a second time, while the named temporary
> file is still open, varies across platforms (it can be so used on Unix; it cannot on
> Windows NT or later)

So in many cases, where I would have liked to have done

```
sage: with tempfile.NamedTemporaryFile() as f:
....:     q.save_image(f.name)
```

I have instead done something like

```
sage: f = tempfile.NamedTemporaryFile(delete=False); f.close()
sage: q.save_image(f.name)
sage: os.remove(f.name)
```

or

```
sage: with tempfile.TemporaryDirectory() as d:
....:     filename = os.path.join(d, "foo.png") 
....:     q.save_image(filename)
```

to avoid the `save_image` call reopening the same name. However, the docs are unclear about what "on Windows" means. So the two examples above can be simplified if this is not a problem on cygwin.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dabb1c79737aa7f0ebe2ff400c131987eac91e85">dabb1c7</a></td><td><code>Trac #33213: replace SAGE_TMP in repl doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c292ea8609e962ebd1bdf8605d54d95b2293a804">c292ea8</a></td><td><code>Trac #33213: replace SAGE_TMP in magma interface doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/172e9c442076d29b82e63b5b768ea3805a390ddc">172e9c4</a></td><td><code>Trac #33213: replace SAGE_TMP in dist script doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24499f11354875c59a36e12f9fad8435f19b68ea">24499f1</a></td><td><code>Trac #33213: remove mentions of SAGE_TMP from the lazy_string module.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c8c0e685a50166b1b325167538a9c101ceaa4d8">3c8c0e6</a></td><td><code>Trac #33213: replace SAGE_TMP in session doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3db84444abe6723d2e22d2357d557ff53f4e8ebd">3db8444</a></td><td><code>Trac #33213: remove SAGE_TMP from tmp_dir() and tmp_filename().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e7e080c2345039c9c2e841ae61a4478416ab024">5e7e080</a></td><td><code>Trac #33213: don't clear SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea2fefd9f7f8143af47e0f7be5840a3291ef074b">ea2fefd</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8805712fde210545e4a2327d1f06a52e1d29a94">b880571</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e">ffd9aa6</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr></table>




---

archive/issue_comments_539702.json:
```json
{
    "body": "Commit: **[ffd9aa6](https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e)**",
    "created_at": "2022-02-15T15:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539702",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[ffd9aa6](https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e)**



---

archive/issue_comments_539703.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,22 +1,12 @@\n-In many cases, we use `tmp_dir()`, `tmp_filename()` and `SAGE_TMP` where the standard python library functions would be more appropriate. Picking a doctest at random,\n+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc\n \n-```\n-sage: q = Tachyon()                                                                                                                                              \n-sage: q.light((1,1,11), 1,(1,1,1))                                                                                                                               \n-sage: q.texture('s')                                                                                                                                             \n-sage: q.sphere((0,-1,1),1,'s')                                                                                                                                   \n-sage: tempname = tmp_filename()                                                                                                                                  \n-sage: q.save_image(tempname)\n-```\n+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,\n \n-would be much better off with the last two lines,\n+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.\n+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.\n+3. We remove `SAGE_TMP`.\n \n-```\n-sage: with tempfile.NamedTemporaryFile() as f:\n-....:     q.save_image(f.name)\n-```\n+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n \n-That's simpler, cleans up the file immediately, and uses the OS's temporary storage rather than the user's home directory. The last bit can make a big difference when (for example) `/tmp` is mounted in RAM to minimize accesses to a slow disk.\n+In concert with #8784, this will make sage-cleaner obsolete.\n \n-Not important, just something to kill time on a rainy day.\n-\n``````\n",
    "created_at": "2022-02-15T15:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539703",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,22 +1,12 @@
-In many cases, we use `tmp_dir()`, `tmp_filename()` and `SAGE_TMP` where the standard python library functions would be more appropriate. Picking a doctest at random,
+Re: https://groups.google.com/g/sage-devel/c/zhjl_j6j_Qc
 
-```
-sage: q = Tachyon()                                                                                                                                              
-sage: q.light((1,1,11), 1,(1,1,1))                                                                                                                               
-sage: q.texture('s')                                                                                                                                             
-sage: q.sphere((0,-1,1),1,'s')                                                                                                                                   
-sage: tempname = tmp_filename()                                                                                                                                  
-sage: q.save_image(tempname)
-```
+These days, using a `SAGE_TMP` that by default lives under `$HOME` is overly complex and often inefficient. In this ticket we implement the first phase of its removal, to be replaced by python's `tempfile` module. Specifically,
 
-would be much better off with the last two lines,
+1. We replace all direct uses of `SAGE_TMP` within the sage library and doctests.
+2. We update `tmp_dir()` and `tmp_filename()` to use the `tempfile` defaults.
+3. We remove `SAGE_TMP`.
 
-```
-sage: with tempfile.NamedTemporaryFile() as f:
-....:     q.save_image(f.name)
-```
+Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
 
-That's simpler, cleans up the file immediately, and uses the OS's temporary storage rather than the user's home directory. The last bit can make a big difference when (for example) `/tmp` is mounted in RAM to minimize accesses to a slow disk.
+In concert with #8784, this will make sage-cleaner obsolete.
 
-Not important, just something to kill time on a rainy day.
-
``````




---

archive/issue_comments_539704.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33213)**",
    "created_at": "2022-02-15T15:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539704",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33213)**



---

archive/issue_comments_539705.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03941c137e5428644b737cfaf3279fc97bb2d0c8\">03941c1</a></td><td><code>Trac #33213: don't reset expect interfaces when starting them.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/339ac94388878d7a1796265ce7b44bc012191d6d\">339ac94</a></td><td><code>Trac #33213: simplify GAP workspace doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a\">f2b85e2</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr></table>\n",
    "created_at": "2022-02-17T11:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539705",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03941c137e5428644b737cfaf3279fc97bb2d0c8">03941c1</a></td><td><code>Trac #33213: don't reset expect interfaces when starting them.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/339ac94388878d7a1796265ce7b44bc012191d6d">339ac94</a></td><td><code>Trac #33213: simplify GAP workspace doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a">f2b85e2</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr></table>




---

archive/issue_comments_539706.json:
```json
{
    "body": "Changed commit from **[ffd9aa6](https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e)** to **[f2b85e2](https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a)**",
    "created_at": "2022-02-17T11:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539706",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ffd9aa6](https://github.com/sagemath/sagetrac-mirror/commit/ffd9aa6a082cc6195efc1977a1d9f23b8d73a91e)** to **[f2b85e2](https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a)**



---

archive/issue_comments_539707.json:
```json
{
    "body": "Changed commit from **[f2b85e2](https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a)** to **[0f90d98](https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468)**",
    "created_at": "2022-02-18T00:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f2b85e2](https://github.com/sagemath/sagetrac-mirror/commit/f2b85e2dd38fd78ff300ec31da462c946332568a)** to **[0f90d98](https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468)**



---

archive/issue_comments_539708.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/976d88b592261a4c643bae07ddaf486c389a04ae\">976d88b</a></td><td><code>Trac #33213: remove SAGE_TMP from tmp_dir() and tmp_filename().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e095020254ad33a611726c5b9d66cf1cb7ac5c1\">8e09502</a></td><td><code>Trac #33213: don't clear SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a22fa71304b889630b617017787571b3113254c0\">a22fa71</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/810c855c99a99e8577330cc11b0d09fc17013b0a\">810c855</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce5a76dc8aa062d8aa5aa00cd37131093eb8874e\">ce5a76d</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/955fdba1cad5303a0b8ed20584eb906c0818310f\">955fdba</a></td><td><code>Trac #33213: remove the sage-cleaner program.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9df953495ee9f20d4e8bfc7b27e5f63a964cd0b\">a9df953</a></td><td><code>Trac #33213: remove \"remote cleaner\" option from expect interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f504b56891f1d62c1325be91815142cec3450d2\">9f504b5</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92e84da6f5c40f24fb4e3a08fc98cc6c3536b44f\">92e84da</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468\">0f90d98</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr></table>\n",
    "created_at": "2022-02-18T00:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539708",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/976d88b592261a4c643bae07ddaf486c389a04ae">976d88b</a></td><td><code>Trac #33213: remove SAGE_TMP from tmp_dir() and tmp_filename().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e095020254ad33a611726c5b9d66cf1cb7ac5c1">8e09502</a></td><td><code>Trac #33213: don't clear SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a22fa71304b889630b617017787571b3113254c0">a22fa71</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/810c855c99a99e8577330cc11b0d09fc17013b0a">810c855</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce5a76dc8aa062d8aa5aa00cd37131093eb8874e">ce5a76d</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/955fdba1cad5303a0b8ed20584eb906c0818310f">955fdba</a></td><td><code>Trac #33213: remove the sage-cleaner program.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9df953495ee9f20d4e8bfc7b27e5f63a964cd0b">a9df953</a></td><td><code>Trac #33213: remove "remote cleaner" option from expect interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f504b56891f1d62c1325be91815142cec3450d2">9f504b5</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92e84da6f5c40f24fb4e3a08fc98cc6c3536b44f">92e84da</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468">0f90d98</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr></table>




---

archive/issue_comments_539709.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nMaking #8784 a dependency because we can avoid many contortions on this branch if we don't have to keep sage-cleaner aware of where the `spawned_processes` file lives.",
    "created_at": "2022-02-18T00:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539709",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'>Comment 4:</a>
Making #8784 a dependency because we can avoid many contortions on this branch if we don't have to keep sage-cleaner aware of where the `spawned_processes` file lives.



---

archive/issue_comments_539710.json:
```json
{
    "body": "Dependencies: **#8784**",
    "created_at": "2022-02-18T00:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539710",
    "user": "https://github.com/orlitzky"
}
```

Dependencies: **#8784**



---

archive/issue_comments_539711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,8 @@\n \n Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n \n-In concert with #8784, this will make sage-cleaner obsolete.\n+With #8784 as a dependency, we are also able to,\n \n+4. Remove sage-cleaner entirely.\n+\n+\n``````\n",
    "created_at": "2022-02-18T00:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539711",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,8 @@
 
 Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
 
-In concert with #8784, this will make sage-cleaner obsolete.
+With #8784 as a dependency, we are also able to,
 
+4. Remove sage-cleaner entirely.
+
+
``````




---

archive/issue_comments_539712.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nHow did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:\n\n1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.\n2. Segfault the sage that you started, e.g., by doing something stupid with Cython.\n\nWhat happens?  Are all temp files and spawned processes properly cleaned up?\n\nIt's an unfortunate reality that we make Cython relatively easy to use, hence it's easy from the command line or notebook to segfault a running Sage process.\n\nJust curious.  I never liked or wanted to write sage-cleaner, but I couldn't think of any better approach to make end users happy.",
    "created_at": "2022-02-18T00:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539712",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'>Comment 5:</a>
How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:

1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.
2. Segfault the sage that you started, e.g., by doing something stupid with Cython.

What happens?  Are all temp files and spawned processes properly cleaned up?

It's an unfortunate reality that we make Cython relatively easy to use, hence it's easy from the command line or notebook to segfault a running Sage process.

Just curious.  I never liked or wanted to write sage-cleaner, but I couldn't think of any better approach to make end users happy.



---

archive/issue_comments_539713.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@williamstein](#comment%3A5):\n> How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:\n> \n> 1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.\n> 2. Segfault the sage that you started, e.g., by doing something stupid with Cython.\n> \n> What happens?  Are all temp files and spawned processes properly cleaned up?\n\n1. Now that all temporary files are created in `/tmp` or equivalent, they'll be cleaned up by the system eventually. In the event of a crash, I would say that this is preferable, because those temporary files can contain important debugging information.\n\n2. Sage doesn't segfault. More seriously, it depends on the process. In the simplest case, the subprocess will continue doing whatever it's doing until it completes, and will then terminate. Next would be subprocesses that communicate with the parent; eventually they'll be sent a SIGPIPE and commit suicide. If you go out of your way to launch something that is basically a daemon, though, it can indeed outlive the parent.\n\nFor (2) to be an issue, you have to launch a standalone process that never terminates, detach it from the parent, compile a C extension, load the extension into your current session, and then cause it to segfault. I don't think cleaning up after that situation should be the responsibility of *any* application; but especially not of a computer algebra system.\n\nIf you intend to do something like that frequently (or host a service for users who will...), there are better solutions these days -- cgroups on linux being the best example. Keeping in mind that sage-cleaner works by parsing a `spawned_processes` file that must be updated every time a process is launched, solving the problem at the OS level in particular has the advantage that it will catch sub-subprocesses. Sage-cleaner generally cannot (unless the subprocess is also sage), because the subprocess doesn't know that it's supposed to add a line item to `spawned_processes`.",
    "created_at": "2022-02-18T01:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539713",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@williamstein](#comment%3A5):
> How did you solve the problems that sage-cleaner solves?  It's not like I wrote it for no reason.  There are many situations in practice that people hit where temp files and subprocess get left around.  Make sure that at least the following works:
> 
> 1. Start sage.  Do something that creates a temp file and also something that spawns a subprocess.
> 2. Segfault the sage that you started, e.g., by doing something stupid with Cython.
> 
> What happens?  Are all temp files and spawned processes properly cleaned up?

1. Now that all temporary files are created in `/tmp` or equivalent, they'll be cleaned up by the system eventually. In the event of a crash, I would say that this is preferable, because those temporary files can contain important debugging information.

2. Sage doesn't segfault. More seriously, it depends on the process. In the simplest case, the subprocess will continue doing whatever it's doing until it completes, and will then terminate. Next would be subprocesses that communicate with the parent; eventually they'll be sent a SIGPIPE and commit suicide. If you go out of your way to launch something that is basically a daemon, though, it can indeed outlive the parent.

For (2) to be an issue, you have to launch a standalone process that never terminates, detach it from the parent, compile a C extension, load the extension into your current session, and then cause it to segfault. I don't think cleaning up after that situation should be the responsibility of *any* application; but especially not of a computer algebra system.

If you intend to do something like that frequently (or host a service for users who will...), there are better solutions these days -- cgroups on linux being the best example. Keeping in mind that sage-cleaner works by parsing a `spawned_processes` file that must be updated every time a process is launched, solving the problem at the OS level in particular has the advantage that it will catch sub-subprocesses. Sage-cleaner generally cannot (unless the subprocess is also sage), because the subprocess doesn't know that it's supposed to add a line item to `spawned_processes`.



---

archive/issue_comments_539714.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI should also point out that it's not critical that we remove sage-cleaner at this point. The main hurdle wrt the removal of `SAGE_TMP` is that sage-cleaner and the sage library (`register_spawned_process()`) need to agree on a location for the spawned processes file. The current branch uses a temporary file in the library that lives for the duration of the sage session, and that's of no use to sage-cleaner due to the random name. We could still store the spawned processes file with a fixed name in `DOT_SAGE`, though, probably with the current sage PID tacked onto the path somewhere.\n\nI saw this as a good time to remove it because its one *crucial* job -- to clean up `SAGE_TMP` under `$HOME` -- is now obsolete.",
    "created_at": "2022-02-18T01:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539714",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'>Comment 7:</a>
I should also point out that it's not critical that we remove sage-cleaner at this point. The main hurdle wrt the removal of `SAGE_TMP` is that sage-cleaner and the sage library (`register_spawned_process()`) need to agree on a location for the spawned processes file. The current branch uses a temporary file in the library that lives for the duration of the sage session, and that's of no use to sage-cleaner due to the random name. We could still store the spawned processes file with a fixed name in `DOT_SAGE`, though, probably with the current sage PID tacked onto the path somewhere.

I saw this as a good time to remove it because its one *crucial* job -- to clean up `SAGE_TMP` under `$HOME` -- is now obsolete.



---

archive/issue_comments_539715.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f\">de4a00e</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr></table>\n",
    "created_at": "2022-02-18T04:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539715",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f">de4a00e</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr></table>




---

archive/issue_comments_539716.json:
```json
{
    "body": "Changed commit from **[0f90d98](https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468)** to **[de4a00e](https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f)**",
    "created_at": "2022-02-18T04:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539716",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0f90d98](https://github.com/sagemath/sagetrac-mirror/commit/0f90d98f5782a25d10b5ae1797953673cb7dc468)** to **[de4a00e](https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f)**



---

archive/issue_events_424239.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-18T04:11:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424239"
}
```



---

archive/issue_comments_539717.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI believe I've fixed all of the test failures so I'm setting this to `needs_review` to see what the patchbots think.",
    "created_at": "2022-02-18T04:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539717",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'>Comment 9:</a>
I believe I've fixed all of the test failures so I'm setting this to `needs_review` to see what the patchbots think.



---

archive/issue_comments_539718.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\ntesting on https://github.com/sagemath/sagetrac-mirror/actions/runs/1864348438",
    "created_at": "2022-02-18T12:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'>Comment 10:</a>
testing on https://github.com/sagemath/sagetrac-mirror/actions/runs/1864348438



---

archive/issue_comments_539719.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThanks @orlitzky for your explanation.   Your responses don't necessarily apply in the context of users that got me to write the sage-cleaner in the first place, and they will probably be pretty annoyed if they ever realize what happened.  Sage is different than some more less complicated computer algebra software like Magma, because Sage much more frequently spawns subprocesses.  Fortunately, over the years the number of subprocesses Sage spawns has been reduced due to writing and using C library interfaces instead of pexpect, etc.\n\nRegarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from \"temp files get cleaned up by Sage itself quickly\" to \"maybe someday the system will clean them up\".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.\n\nI agree that when users are using Linux, have sufficient privileges to use containers, and also actually know how to use them, then these same problems can be solved in a more robust way.   However, this is a small percentage of users of Sage.  Many users use other operating systems or don't have admin permissions.\n\nCoCalc is the main platform for running Sage that I care about these days, and every individual \"project\" is its own container, /tmp is extremely ephemeral, etc., so everything you say applies there.  That said, users of CoCalc can't use Docker or other container mechanisms themselves within projects, due to security constraints.  \n\nIn any case, I'm not personally worried about these changes having any adverse impact for me.    However, I'm leaving this comment here so people who are impacted can maybe know they may have to revert these patches for their own install of Sage.  Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why.   Hopefully they google and find this comment.",
    "created_at": "2022-02-18T14:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539719",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'>Comment 11:</a>
Thanks @orlitzky for your explanation.   Your responses don't necessarily apply in the context of users that got me to write the sage-cleaner in the first place, and they will probably be pretty annoyed if they ever realize what happened.  Sage is different than some more less complicated computer algebra software like Magma, because Sage much more frequently spawns subprocesses.  Fortunately, over the years the number of subprocesses Sage spawns has been reduced due to writing and using C library interfaces instead of pexpect, etc.

Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from "temp files get cleaned up by Sage itself quickly" to "maybe someday the system will clean them up".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.

I agree that when users are using Linux, have sufficient privileges to use containers, and also actually know how to use them, then these same problems can be solved in a more robust way.   However, this is a small percentage of users of Sage.  Many users use other operating systems or don't have admin permissions.

CoCalc is the main platform for running Sage that I care about these days, and every individual "project" is its own container, /tmp is extremely ephemeral, etc., so everything you say applies there.  That said, users of CoCalc can't use Docker or other container mechanisms themselves within projects, due to security constraints.  

In any case, I'm not personally worried about these changes having any adverse impact for me.    However, I'm leaving this comment here so people who are impacted can maybe know they may have to revert these patches for their own install of Sage.  Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why.   Hopefully they google and find this comment.



---

archive/issue_comments_539720.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@williamstein](#comment%3A11):\n> \n> Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from \"temp files get cleaned up by Sage itself quickly\" to \"maybe someday the system will clean them up\".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.... Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why. Hopefully they google and find this comment. \n\nSystemd comes with a timer (like a cron job) to clean up `/tmp`, but I'm not familiar with its out-of-the-box configuration on mainstream distros. I still use OpenRC myself, where a reboot is what triggers it.\n\nOn systems like mine, \"leftover junk\" is a fair criticism, but keep in mind the bigger picture: the python `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()` functions *automatically remove the file/directory as soon as it's done being used.*  In this branch, I've changed a bunch of manual `SAGE_TMP` code to use those two functions, so a lot of what would have been leftover junk is now simply not created in the first place. Any remaining junk is due to sage's own `tmp_filename()` and `tmp_dir()`, which expect you to clean up the file yourself, or assume that sage-cleaner will do it eventually.\n\nIf this gets merged, we can deprecate `tmp_filename()` and `tmp_dir()` as obsolete in favor of the python functions. Over a hopefully-short amount of time, that should eliminate the leftover junk at the source.",
    "created_at": "2022-02-18T15:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539720",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@williamstein](#comment%3A11):
> 
> Regarding /tmp, unless you specifically set something up to periodically clean up files, unless things have changed a lot, don't most Linux distros *not* automatically delete files from there, possibly until a reboot?  You're making a huge change from "temp files get cleaned up by Sage itself quickly" to "maybe someday the system will clean them up".  Maybe at this point that is the right change, but it's important to acknowledge that it is a significant change.... Probably the way things will go is that this gets merged, and a year later certain environments start finding that Sage is leaving around clutter in a way that Sage didn't for the last decade, but users don't know why. Hopefully they google and find this comment. 

Systemd comes with a timer (like a cron job) to clean up `/tmp`, but I'm not familiar with its out-of-the-box configuration on mainstream distros. I still use OpenRC myself, where a reboot is what triggers it.

On systems like mine, "leftover junk" is a fair criticism, but keep in mind the bigger picture: the python `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()` functions *automatically remove the file/directory as soon as it's done being used.*  In this branch, I've changed a bunch of manual `SAGE_TMP` code to use those two functions, so a lot of what would have been leftover junk is now simply not created in the first place. Any remaining junk is due to sage's own `tmp_filename()` and `tmp_dir()`, which expect you to clean up the file yourself, or assume that sage-cleaner will do it eventually.

If this gets merged, we can deprecate `tmp_filename()` and `tmp_dir()` as obsolete in favor of the python functions. Over a hopefully-short amount of time, that should eliminate the leftover junk at the source.



---

archive/issue_comments_539721.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nindeed, I am not at all worried about junk left at `/tmp`, as, at least as far as documentation of Python is correct, the facility of  [NamedTemporaryFile](https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile) cleans up after itself automatically (I guess it uses POSIX's `tmpfile(3)` behind the scene).\n\nI am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?",
    "created_at": "2022-02-18T15:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539721",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
indeed, I am not at all worried about junk left at `/tmp`, as, at least as far as documentation of Python is correct, the facility of  [NamedTemporaryFile](https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile) cleans up after itself automatically (I guess it uses POSIX's `tmpfile(3)` behind the scene).

I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?



---

archive/issue_comments_539722.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@dimpase](#comment%3A13):\n> \n> I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?\n\nIf you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see [comment:1](#comment%3A1)). I would love to simplify it if someone with a cygwin installation says that the \"on Windows\" warning doesn't apply there.",
    "created_at": "2022-02-18T15:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539722",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@dimpase](#comment%3A13):
> 
> I am a bit puzzled by the need to manually keep them open using `delete=False` the call to `NamedTemporaryFile`.  Is it because one wants to keep them for the duration of a Sage session?

If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see [comment:1](#comment%3A1)). I would love to simplify it if someone with a cygwin installation says that the "on Windows" warning doesn't apply there.



---

archive/issue_comments_539723.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@orlitzky](#comment%3A14):\n>\n> If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see [comment:1](#comment%3A1)). I would love to simplify it if someone with a cygwin installation says that the \"on Windows\" warning doesn't apply there.\n\n(If it DOES apply on cygwin, we could improve this in the future by updating the functions that now take a filename to also accept an open file handle; that will avoid re-`open()`ing it.)",
    "created_at": "2022-02-18T15:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539723",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@orlitzky](#comment%3A14):
>
> If you're referring to my new code (in many doctests), then this is simply a precaution for cygwin (see [comment:1](#comment%3A1)). I would love to simplify it if someone with a cygwin installation says that the "on Windows" warning doesn't apply there.

(If it DOES apply on cygwin, we could improve this in the future by updating the functions that now take a filename to also accept an open file handle; that will avoid re-`open()`ing it.)



---

archive/issue_comments_539724.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nCygwin is POSIX emulator, so `on Windows` doesn't really apply to it.",
    "created_at": "2022-02-18T15:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539724",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'>Comment 16:</a>
Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.



---

archive/issue_comments_539725.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@dimpase](#comment%3A16):\n> Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.\n\nYou have two wishes remaining =)\n\nI'm \"happy\" to go back and change all of those doctests, but I'd like confirmation before I spend half a day doing it.",
    "created_at": "2022-02-18T15:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539725",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@dimpase](#comment%3A16):
> Cygwin is POSIX emulator, so `on Windows` doesn't really apply to it.

You have two wishes remaining =)

I'm "happy" to go back and change all of those doctests, but I'd like confirmation before I spend half a day doing it.



---

archive/issue_comments_539726.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nPerhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.",
    "created_at": "2022-02-18T16:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539726",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'>Comment 18:</a>
Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.



---

archive/issue_comments_539727.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@dimpase](#comment%3A18):\n> Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.\n\nWe just need to know if this works,\n\n```\nsage: import tempfile\nsage: p = plot(sin(x), x, (-pi, pi))\nsage: with tempfile.NamedTemporaryFile(suffix=\".png\") as f:\n....:     p.save(filename=f.name)\n....: \n```\n\nor if the fact that `save()` reopens the (already open) file causes problem.",
    "created_at": "2022-02-18T16:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539727",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@dimpase](#comment%3A18):
> Perhaps slelievre can test this on Cygwin - if you specify in some detail what to look for.

We just need to know if this works,

```
sage: import tempfile
sage: p = plot(sin(x), x, (-pi, pi))
sage: with tempfile.NamedTemporaryFile(suffix=".png") as f:
....:     p.save(filename=f.name)
....: 
```

or if the fact that `save()` reopens the (already open) file causes problem.



---

archive/issue_comments_539728.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81\">989a4cb</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr></table>\n",
    "created_at": "2022-02-18T16:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539728",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81">989a4cb</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr></table>




---

archive/issue_comments_539729.json:
```json
{
    "body": "Changed commit from **[de4a00e](https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f)** to **[989a4cb](https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81)**",
    "created_at": "2022-02-18T16:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539729",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[de4a00e](https://github.com/sagemath/sagetrac-mirror/commit/de4a00ee85328833e7ce679a7c86be9aee3e489f)** to **[989a4cb](https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81)**



---

archive/issue_comments_539730.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThat last commit should avoid most leftover junk in the meantime, too. It's easy so why not.",
    "created_at": "2022-02-18T16:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539730",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'>Comment 21:</a>
That last commit should avoid most leftover junk in the meantime, too. It's easy so why not.



---

archive/issue_comments_539731.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n@williamstein - this ticket, and its dependency #8784, are also to properly fix #33027",
    "created_at": "2022-02-18T16:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539731",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'>Comment 22:</a>
@williamstein - this ticket, and its dependency #8784, are also to properly fix #33027



---

archive/issue_comments_539732.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nHi everybody - thanks for the comments. **I just want to be clear that I am in no way suggesting blocking this ticket moving forward with a positive review.**  I just want to record my misgivings here, so they may be helpful for anybody that might hit problems as a result.  I'm not a fan of this stupid sage-cleaner hack that I wrote long ago, and I'm happy to see it get deleted.",
    "created_at": "2022-02-18T16:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539732",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:23'>Comment 23:</a>
Hi everybody - thanks for the comments. **I just want to be clear that I am in no way suggesting blocking this ticket moving forward with a positive review.**  I just want to record my misgivings here, so they may be helpful for anybody that might hit problems as a result.  I'm not a fan of this stupid sage-cleaner hack that I wrote long ago, and I'm happy to see it get deleted.



---

archive/issue_comments_539733.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThe changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n\nHowever, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.",
    "created_at": "2022-02-18T19:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.

However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.



---

archive/issue_comments_539734.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@mkoeppe](#comment%3A24):\n> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n> \n> However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.\n\nTo my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.\n\nIf we want to raise a deprecation warning for it, I can do so in a way that doesn't affect the rest of this ticket by changing `SAGE_TMP` to return a `tempfile.TemporaryDirectory()` instead of the old `DOT_SAGE` value. Then its use won't create anything that would require sage-cleaner to remove.",
    "created_at": "2022-02-18T23:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539734",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@mkoeppe](#comment%3A24):
> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.
> 
> However, I would suggest to split this ticket, so that the wholesale removal of the cleaner is in its own ticket. In particular, user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. Perhaps a deprecation warning that the cleaner issues when it actually finds something to clean.

To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.

If we want to raise a deprecation warning for it, I can do so in a way that doesn't affect the rest of this ticket by changing `SAGE_TMP` to return a `tempfile.TemporaryDirectory()` instead of the old `DOT_SAGE` value. Then its use won't create anything that would require sage-cleaner to remove.



---

archive/issue_comments_539735.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nI'm still -1 on removing the `sage-cleaner` here on the same ticket. \n\nIn particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. Let's please not introduce big changes like this without a proper transition plan.",
    "created_at": "2022-02-18T23:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539735",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'>Comment 26:</a>
I'm still -1 on removing the `sage-cleaner` here on the same ticket. 

In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. Let's please not introduce big changes like this without a proper transition plan.



---

archive/issue_comments_539736.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@mkoeppe](#comment%3A26):\n> I'm still -1 on removing the `sage-cleaner` here on the same ticket. \n> \n> In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. \n\nThat's mainly because of #8784.",
    "created_at": "2022-02-19T00:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539736",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@mkoeppe](#comment%3A26):
> I'm still -1 on removing the `sage-cleaner` here on the same ticket. 
> 
> In particular I don't think the explanation why the process-killing part of it should suddenly no longer be necessary is very convincing. 

That's mainly because of #8784.



---

archive/issue_comments_539737.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nLet's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.",
    "created_at": "2022-02-19T00:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539737",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'>Comment 28:</a>
Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.



---

archive/issue_comments_539738.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@mkoeppe](#comment%3A28):\n> Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.\n\nIt doesn't really delete anything except the files created specifically for the benefit of sage-cleaner, and some legacy paths whose locations were changed in the `fix_old_mistakes()` funtion.\n\nI'm not strongly opposed to leaving sage-cleaner alone, but a deprecation warning on killed processes is going to produce false positives on every process that would have terminated nicely but was killed prematurely by sage-cleaner, i.e. most of them.",
    "created_at": "2022-02-19T00:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539738",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@mkoeppe](#comment%3A28):
> Let's confirm this in practice please by doing the deprecation warnings whenever the cleaner kills or deletes something.

It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner, and some legacy paths whose locations were changed in the `fix_old_mistakes()` funtion.

I'm not strongly opposed to leaving sage-cleaner alone, but a deprecation warning on killed processes is going to produce false positives on every process that would have terminated nicely but was killed prematurely by sage-cleaner, i.e. most of them.



---

archive/issue_comments_539739.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nPerhaps it would be interesting to know whether after the changes (but keeping the cleaner in) the cleaner would still have anything to kill.\n(my understanding it starts after Sage terminates, so most likely it won't have to do anything)",
    "created_at": "2022-02-19T01:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539739",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'>Comment 30:</a>
Perhaps it would be interesting to know whether after the changes (but keeping the cleaner in) the cleaner would still have anything to kill.
(my understanding it starts after Sage terminates, so most likely it won't have to do anything)



---

archive/issue_comments_539740.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@orlitzky](#comment%3A29):\n> Replying to [@mkoeppe](#comment%3A28):\n> > whenever the cleaner [...] deletes something.\n\n> \n> It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner\n\nYou are right, thanks.",
    "created_at": "2022-02-19T01:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539740",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@orlitzky](#comment%3A29):
> Replying to [@mkoeppe](#comment%3A28):
> > whenever the cleaner [...] deletes something.

> 
> It doesn't really delete anything except the files created specifically for the benefit of sage-cleaner

You are right, thanks.



---

archive/issue_comments_539741.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@dimpase](#comment%3A18):\n> Perhaps slelievre can test this on Cygwin\n\nMy attempts to build 9.5 beta and rc\nreleases fail on `sagemath_doc_html`.\n\nMy attempts to build the 9.6 beta releases\nfail earlier, on `sagelib` I think.",
    "created_at": "2022-02-19T11:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539741",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@dimpase](#comment%3A18):
> Perhaps slelievre can test this on Cygwin

My attempts to build 9.5 beta and rc
releases fail on `sagemath_doc_html`.

My attempts to build the 9.6 beta releases
fail earlier, on `sagelib` I think.



---

archive/issue_comments_539742.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@slel](#comment%3A32):\n> \n> My attempts to build the 9.6 beta releases\n> fail earlier, on `sagelib` I think.\n> \n\nFortunately this is only a python question... if you don't mind, does this work?\n\n```\n>>> import tempfile\n>>> with tempfile.NamedTemporaryFile(suffix=\".txt\") as f:\n...     with open(f.name, \"w\") as g:\n...         _ = g.write(\"Hello, world!\")\n...     with open(f.name) as h:\n...         contents = h.read()\n... \n>>> print(contents)\nHello, world!\n```",
    "created_at": "2022-02-19T11:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539742",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@slel](#comment%3A32):
> 
> My attempts to build the 9.6 beta releases
> fail earlier, on `sagelib` I think.
> 

Fortunately this is only a python question... if you don't mind, does this work?

```
>>> import tempfile
>>> with tempfile.NamedTemporaryFile(suffix=".txt") as f:
...     with open(f.name, "w") as g:
...         _ = g.write("Hello, world!")
...     with open(f.name) as h:
...         contents = h.read()
... 
>>> print(contents)
Hello, world!
```



---

archive/issue_comments_539743.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nReplying to [@mkoeppe](#comment%3A24):\n> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.\n> \n> However, I would suggest to split this ticket\n\nI've opened #33383 for the easy to review changes in the doctests.",
    "created_at": "2022-02-19T20:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'>Comment 34:</a>
Replying to [@mkoeppe](#comment%3A24):
> The changes to using `TemporaryDirectory` in doctests are easy to review and are definitely a great improvement that we should merge as soon as possible.
> 
> However, I would suggest to split this ticket

I've opened #33383 for the easy to review changes in the doctests.



---

archive/issue_comments_539744.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@orlitzky](#comment%3A33):\n> does this work?\n> \n> ```\n> >>> import tempfile\n> >>> with tempfile.NamedTemporaryFile(suffix=\".txt\") as f:\n> ...     with open(f.name, \"w\") as g:\n> ...         _ = g.write(\"Hello, world!\")\n> ...     with open(f.name) as h:\n> ...         contents = h.read()\n> ... \n> >>> print(contents)\n> Hello, world!\n> ```\n\nYes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.",
    "created_at": "2022-02-21T18:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539744",
    "user": "https://github.com/slel"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@orlitzky](#comment%3A33):
> does this work?
> 
> ```
> >>> import tempfile
> >>> with tempfile.NamedTemporaryFile(suffix=".txt") as f:
> ...     with open(f.name, "w") as g:
> ...         _ = g.write("Hello, world!")
> ...     with open(f.name) as h:
> ...         contents = h.read()
> ... 
> >>> print(contents)
> Hello, world!
> ```

Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.



---

archive/issue_comments_539745.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nReplying to [@slel](#comment%3A35):\n> \n> Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.\n\nThank you! That means I can go back and simplify a lot of stuff.",
    "created_at": "2022-02-21T19:17:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539745",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:36'>Comment 36:</a>
Replying to [@slel](#comment%3A35):
> 
> Yes, it works in Cygwin with Python 3.7.12, Python 3.8.12, Python 3.9.10.

Thank you! That means I can go back and simplify a lot of stuff.



---

archive/issue_comments_539746.json:
```json
{
    "body": "Changed commit from **[989a4cb](https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81)** to **[b9101fd](https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067)**",
    "created_at": "2022-02-22T01:48:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539746",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[989a4cb](https://github.com/sagemath/sagetrac-mirror/commit/989a4cb43fc711eef66b75844b375ed1a7decf81)** to **[b9101fd](https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067)**



---

archive/issue_comments_539747.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56ebd5715116fcd0996bee86cc7b761ddd6f7600\">56ebd57</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6b6fb8e3ac9f4ab1dfa28c2206a7c161d548faa\">c6b6fb8</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/888aeb36f4833e04623815c58c924b6765be37b1\">888aeb3</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f43965b72c482b254259be24b8653f2cc9d72c9a\">f43965b</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9d1746f81db3abbb5d8afb7e510c2be977284fd\">b9d1746</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e445eb8275ccd957b08d03efd8741f228dbb1156\">e445eb8</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/049ce98fa162296453db72fa2b1292efcdc1dafa\">049ce98</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e289f0b11e735bfed85d6b847c8222e12284186f\">e289f0b</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7dd9ff0b5e6cd551534f9a7b927f7cfad23a82e6\">7dd9ff0</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067\">b9101fd</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-02-22T01:48:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539747",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>Comment 37:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56ebd5715116fcd0996bee86cc7b761ddd6f7600">56ebd57</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6b6fb8e3ac9f4ab1dfa28c2206a7c161d548faa">c6b6fb8</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/888aeb36f4833e04623815c58c924b6765be37b1">888aeb3</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f43965b72c482b254259be24b8653f2cc9d72c9a">f43965b</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9d1746f81db3abbb5d8afb7e510c2be977284fd">b9d1746</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e445eb8275ccd957b08d03efd8741f228dbb1156">e445eb8</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/049ce98fa162296453db72fa2b1292efcdc1dafa">049ce98</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e289f0b11e735bfed85d6b847c8222e12284186f">e289f0b</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7dd9ff0b5e6cd551534f9a7b927f7cfad23a82e6">7dd9ff0</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067">b9101fd</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539748.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,8 +8,6 @@\n \n Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.\n \n-With #8784 as a dependency, we are also able to,\n-\n-4. Remove sage-cleaner entirely.\n+Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.\n \n \n``````\n",
    "created_at": "2022-02-22T01:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539748",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,8 +8,6 @@
 
 Afterward, the custom functions `tmp_dir()` and `tmp_filename()` can be deprecated in favor of `tempfile.TemporaryDirectory()` and `tempfile.NamedTemporaryFile()`.
 
-With #8784 as a dependency, we are also able to,
-
-4. Remove sage-cleaner entirely.
+Moreover when #8784 is done, we'll be able to remove sage-cleaner entirely.
 
 
``````




---

archive/issue_comments_539749.json:
```json
{
    "body": "Changed dependencies from **#8784** to **32987**",
    "created_at": "2022-02-22T01:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539749",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **#8784** to **32987**



---

archive/issue_events_424240.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-22T01:51:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424240"
}
```



---

archive/issue_events_424241.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-22T01:51:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424241"
}
```



---

archive/issue_comments_539750.json:
```json
{
    "body": "Changed dependencies from **32987** to **#32987**",
    "created_at": "2022-02-22T01:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539750",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **32987** to **#32987**



---

archive/issue_comments_539751.json:
```json
{
    "body": "Changed commit from **[b9101fd](https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067)** to **[86e654b](https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49)**",
    "created_at": "2022-02-22T20:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539751",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b9101fd](https://github.com/sagemath/sagetrac-mirror/commit/b9101fd945428f71ef3873df924496be0c211067)** to **[86e654b](https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49)**



---

archive/issue_comments_539752.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/518b8cca0ef7464c51adf862f2284752b4ff3f0b\">518b8cc</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/754be97aeec2dd547c7d1ca296b61159a089570c\">754be97</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c9928763f5f5b6ce52f54af322195d3f590e5c9\">8c99287</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2687dc16c83975bad54ca84639b6418731945e2\">e2687dc</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ef1cb89821213bd16181e80d85bfc8d8953488c\">2ef1cb8</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98722baded736b21df451a7f63e0c9b0cf533ec8\">98722ba</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69e0f92da16d7d998a4ff9193f4f4420d88d8e3a\">69e0f92</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6534cc112540d56e6dd9a00684827fbf978b00aa\">6534cc1</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4f0797e9dab3465bf243c54bbfb0cef6c9a61ff\">e4f0797</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49\">86e654b</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-02-22T20:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539752",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:40'>Comment 40:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/518b8cca0ef7464c51adf862f2284752b4ff3f0b">518b8cc</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/754be97aeec2dd547c7d1ca296b61159a089570c">754be97</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c9928763f5f5b6ce52f54af322195d3f590e5c9">8c99287</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2687dc16c83975bad54ca84639b6418731945e2">e2687dc</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ef1cb89821213bd16181e80d85bfc8d8953488c">2ef1cb8</a></td><td><code>Trac #33213: remove sage.interfaces.cleaner.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98722baded736b21df451a7f63e0c9b0cf533ec8">98722ba</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69e0f92da16d7d998a4ff9193f4f4420d88d8e3a">69e0f92</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6534cc112540d56e6dd9a00684827fbf978b00aa">6534cc1</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4f0797e9dab3465bf243c54bbfb0cef6c9a61ff">e4f0797</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49">86e654b</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539753.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nOk, back to patchbots.\n\nThis branch is based on #32987 which deprecates `sage_makedirs` (also now redundant), and *does not* remove sage-cleaner. We can do that in another ticket.",
    "created_at": "2022-02-23T10:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539753",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:41'>Comment 41:</a>
Ok, back to patchbots.

This branch is based on #32987 which deprecates `sage_makedirs` (also now redundant), and *does not* remove sage-cleaner. We can do that in another ticket.



---

archive/issue_events_424242.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-23T10:59:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424242"
}
```



---

archive/issue_events_424243.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-23T10:59:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424243"
}
```



---

archive/issue_comments_539754.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2022-02-23T17:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539754",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Michael Orlitzky**



---

archive/issue_comments_539755.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nThis one needs to be reverted:\n\n```\ndiff --git a/src/doc/en/reference/interfaces/index.rst b/src/doc/en/reference/interfaces/index.rst\nindex d007f67..f09fc62 100644\n--- a/src/doc/en/reference/interfaces/index.rst\n+++ b/src/doc/en/reference/interfaces/index.rst\n@@ -108,7 +108,6 @@ and testing to make sure nothing funny is going on).\n    sage/interfaces/tachyon\n    sage/interfaces/tides\n \n-   sage/interfaces/cleaner\n    sage/interfaces/quit\n    sage/interfaces/read_data\n \n```",
    "created_at": "2022-02-23T17:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539755",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'>Comment 43:</a>
This one needs to be reverted:

```
diff --git a/src/doc/en/reference/interfaces/index.rst b/src/doc/en/reference/interfaces/index.rst
index d007f67..f09fc62 100644
--- a/src/doc/en/reference/interfaces/index.rst
+++ b/src/doc/en/reference/interfaces/index.rst
@@ -108,7 +108,6 @@ and testing to make sure nothing funny is going on).
    sage/interfaces/tachyon
    sage/interfaces/tides
 
-   sage/interfaces/cleaner
    sage/interfaces/quit
    sage/interfaces/read_data
 
```



---

archive/issue_comments_539756.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nShould `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?",
    "created_at": "2022-02-23T17:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539756",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>Comment 44:</a>
Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?



---

archive/issue_comments_539757.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nAlso `src/sage/interfaces/expect.py` still has cleaner-related changes",
    "created_at": "2022-02-23T17:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539757",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'>Comment 45:</a>
Also `src/sage/interfaces/expect.py` still has cleaner-related changes



---

archive/issue_comments_539758.json:
```json
{
    "body": "Changed commit from **[86e654b](https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49)** to **[e612678](https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e)**",
    "created_at": "2022-02-23T17:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539758",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[86e654b](https://github.com/sagemath/sagetrac-mirror/commit/86e654bb37ea223e62976a268c2b66107fe30e49)** to **[e612678](https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e)**



---

archive/issue_comments_539759.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72ed28935fb153af13e34b121cf7c885b194a8d4\">72ed289</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a758318536cee61948936a9b2d1e5c022d387dd\">0a75831</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b7322b9d2a279f22b96b871b190d947af1826a1\">6b7322b</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c70d5f67bc51a38d81c87b9608f204274eb9b18f\">c70d5f6</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca764c6fe460ce406a9a8a93ecfab3cd55ee365e\">ca764c6</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e\">e612678</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-02-23T17:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539759",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:46'>Comment 46:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72ed28935fb153af13e34b121cf7c885b194a8d4">72ed289</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a758318536cee61948936a9b2d1e5c022d387dd">0a75831</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b7322b9d2a279f22b96b871b190d947af1826a1">6b7322b</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c70d5f67bc51a38d81c87b9608f204274eb9b18f">c70d5f6</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca764c6fe460ce406a9a8a93ecfab3cd55ee365e">ca764c6</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e">e612678</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539760.json:
```json
{
    "body": "Changed commit from **[e612678](https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e)** to **[ea321c9](https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c)**",
    "created_at": "2022-02-23T18:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539760",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e612678](https://github.com/sagemath/sagetrac-mirror/commit/e6126787dec8007c9af93262d0b9c976d71b6b0e)** to **[ea321c9](https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c)**



---

archive/issue_comments_539761.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0cdbcdd393b21a072feda7deda1083c3b9692aa\">a0cdbcd</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0961af6f8fee2561c5ac6eb8adcfd4ef74bd1a5\">e0961af</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2123287e661b41033ff84dace9221004f0baef14\">2123287</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50cf662af79bb331724ab7b987d574782674b0d8\">50cf662</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/465281a6573e5da7cfc76b4f6ee70d4507237433\">465281a</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c\">ea321c9</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-02-23T18:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539761",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'>Comment 47:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0cdbcdd393b21a072feda7deda1083c3b9692aa">a0cdbcd</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0961af6f8fee2561c5ac6eb8adcfd4ef74bd1a5">e0961af</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2123287e661b41033ff84dace9221004f0baef14">2123287</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50cf662af79bb331724ab7b987d574782674b0d8">50cf662</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/465281a6573e5da7cfc76b4f6ee70d4507237433">465281a</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c">ea321c9</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539762.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nReplying to [@mkoeppe](#comment%3A43):\n> This one needs to be reverted:\n\nThanks, done. I also removed the `cleaner()` function from `sage.interfaces.cleaner`, since it was replaced by `register_spawned_process()` in `sage.interfaces.quit`.",
    "created_at": "2022-02-23T18:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539762",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:48'>Comment 48:</a>
Replying to [@mkoeppe](#comment%3A43):
> This one needs to be reverted:

Thanks, done. I also removed the `cleaner()` function from `sage.interfaces.cleaner`, since it was replaced by `register_spawned_process()` in `sage.interfaces.quit`.



---

archive/issue_comments_539763.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nReplying to [@mkoeppe](#comment%3A44):\n> Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?\n\nI don't have a strong opinion either way. The main downside is that it would clutter the global namespace for something that is pretty much only used for doctests. On the other hand, if we import it automatically only during doctesting, then the examples can't be copy & pasted.",
    "created_at": "2022-02-23T18:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539763",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:49'>Comment 49:</a>
Replying to [@mkoeppe](#comment%3A44):
> Should `tempfile` become a global import (`sage.all`) to make the repeated imports in doctests unnecessary?

I don't have a strong opinion either way. The main downside is that it would clutter the global namespace for something that is pretty much only used for doctests. On the other hand, if we import it automatically only during doctesting, then the examples can't be copy & pasted.



---

archive/issue_comments_539764.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nReplying to [@mkoeppe](#comment%3A45):\n> Also `src/sage/interfaces/expect.py` still has cleaner-related changes\n\nWhich one? The change from `cleaner()` to `register_spawned_process()` is intentional, and will make it easier to remove the cleaner in the future.",
    "created_at": "2022-02-23T18:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539764",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:50'>Comment 50:</a>
Replying to [@mkoeppe](#comment%3A45):
> Also `src/sage/interfaces/expect.py` still has cleaner-related changes

Which one? The change from `cleaner()` to `register_spawned_process()` is intentional, and will make it easier to remove the cleaner in the future.



---

archive/issue_comments_539765.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@orlitzky](#comment%3A49):\n> if we import it automatically only during doctesting\n\ndefinitely we shouldn't do that",
    "created_at": "2022-02-23T18:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539765",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@orlitzky](#comment%3A49):
> if we import it automatically only during doctesting

definitely we shouldn't do that



---

archive/issue_events_424244.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-27T16:52:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424244"
}
```



---

archive/issue_events_424245.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-27T16:52:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424245"
}
```



---

archive/issue_comments_539766.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c1ea7dd1e80c47cc0af1199a00f81dacfba1a14\">8c1ea7d</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c83b811a4d61b94894ec3da1f0aab86b918abb6d\">c83b811</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c31d7d543aa3f02441381c197285e84cad59a86f\">c31d7d5</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d86a3e69a872c3b7bb24ef80a09007b19c39bb36\">d86a3e6</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac0dea733da927b05afc77382239dcebfbedb114\">ac0dea7</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b268fd92e58599cd2aa1a31881713d06fb829bde\">b268fd9</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ce05151aa54b7e4000f8996f72fca13a5e193fe\">8ce0515</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bfd7f9b33cb10d352e5528dc1d458045acf6587\">3bfd7f9</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f8a2f15c01683e650e70a015f8d833975b99cc0\">9f8a2f1</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c\">e8b8fa5</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-03-29T01:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539766",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:53'>Comment 53:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c1ea7dd1e80c47cc0af1199a00f81dacfba1a14">8c1ea7d</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c83b811a4d61b94894ec3da1f0aab86b918abb6d">c83b811</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c31d7d543aa3f02441381c197285e84cad59a86f">c31d7d5</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d86a3e69a872c3b7bb24ef80a09007b19c39bb36">d86a3e6</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac0dea733da927b05afc77382239dcebfbedb114">ac0dea7</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b268fd92e58599cd2aa1a31881713d06fb829bde">b268fd9</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ce05151aa54b7e4000f8996f72fca13a5e193fe">8ce0515</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bfd7f9b33cb10d352e5528dc1d458045acf6587">3bfd7f9</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f8a2f15c01683e650e70a015f8d833975b99cc0">9f8a2f1</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c">e8b8fa5</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539767.json:
```json
{
    "body": "Changed commit from **[ea321c9](https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c)** to **[e8b8fa5](https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c)**",
    "created_at": "2022-03-29T01:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539767",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ea321c9](https://github.com/sagemath/sagetrac-mirror/commit/ea321c961ffd41ca483c9b489b59d064cf203b1c)** to **[e8b8fa5](https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c)**



---

archive/issue_events_424246.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-29T01:17:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424246"
}
```



---

archive/issue_events_424247.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-29T01:17:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424247"
}
```



---

archive/issue_comments_539768.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\n\n```\nsage -t --long --random-seed=286814129660227055850621679081389420825 src/sage/misc/latex.py\n**********************************************************************\nFile \"src/sage/misc/latex.py\", line 1970, in sage.misc.latex.?\nFailed example:\n    with tempfile.NamedTemporaryFile(suffix=\".png\") as f:\n        png(ZZ[x], f.name) # random, optional - latex imagemagick\nException raised:\n```\nthe `# optional` is on the wrong line",
    "created_at": "2022-03-30T00:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539768",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'>Comment 55:</a>

```
sage -t --long --random-seed=286814129660227055850621679081389420825 src/sage/misc/latex.py
**********************************************************************
File "src/sage/misc/latex.py", line 1970, in sage.misc.latex.?
Failed example:
    with tempfile.NamedTemporaryFile(suffix=".png") as f:
        png(ZZ[x], f.name) # random, optional - latex imagemagick
Exception raised:
```
the `# optional` is on the wrong line



---

archive/issue_events_424248.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-30T00:09:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424248"
}
```



---

archive/issue_events_424249.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-30T00:09:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424249"
}
```



---

archive/issue_comments_539769.json:
```json
{
    "body": "Changed commit from **[e8b8fa5](https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c)** to **[a3b58ad](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa)**",
    "created_at": "2022-03-30T00:36:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539769",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e8b8fa5](https://github.com/sagemath/sagetrac-mirror/commit/e8b8fa568a2cbbca6001f8890dd726c0c2c4882c)** to **[a3b58ad](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa)**



---

archive/issue_comments_539770.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63ac9b830ef914c9e99b06de8ea9b81a08d42aa3\">63ac9b8</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e191da6a5ba4d4a49e99cb6b18d434a83454df5f\">e191da6</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0498a508af91f3a887980b5b6248befba27ee45c\">0498a50</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b90a7ebc7931345eb4b496cee224f21067767db0\">b90a7eb</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/279fe3351d151516f3fe9ce321bcdce65dfa13da\">279fe33</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9b00b82059bfeac3343016bf11304ed9246da0f\">c9b00b8</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4a82e77de2b9c72b3e37e17a8a77c4a7a1554d9\">e4a82e7</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/063b3feff6fbaebcf403adfa4f0a4218ed0ea4eb\">063b3fe</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/386b6a57f7c65379bdbe2bf03e519387757696b7\">386b6a5</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa\">a3b58ad</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-03-30T00:36:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539770",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:57'>Comment 57:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63ac9b830ef914c9e99b06de8ea9b81a08d42aa3">63ac9b8</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e191da6a5ba4d4a49e99cb6b18d434a83454df5f">e191da6</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0498a508af91f3a887980b5b6248befba27ee45c">0498a50</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b90a7ebc7931345eb4b496cee224f21067767db0">b90a7eb</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/279fe3351d151516f3fe9ce321bcdce65dfa13da">279fe33</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9b00b82059bfeac3343016bf11304ed9246da0f">c9b00b8</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4a82e77de2b9c72b3e37e17a8a77c4a7a1554d9">e4a82e7</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/063b3feff6fbaebcf403adfa4f0a4218ed0ea4eb">063b3fe</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/386b6a57f7c65379bdbe2bf03e519387757696b7">386b6a5</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa">a3b58ad</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539771.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nThanks, fixed.",
    "created_at": "2022-03-30T00:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539771",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:58'>Comment 58:</a>
Thanks, fixed.



---

archive/issue_events_424250.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-30T00:37:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424250"
}
```



---

archive/issue_events_424251.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-30T00:37:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424251"
}
```



---

archive/issue_comments_539772.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\n\n```\n--- a/src/sage/repl/attach.py\n+++ b/src/sage/repl/attach.py\n@@ -170,12 +170,14 @@ def load_attach_path(path=None, replace=False):\n...\n+    We put a new, empty direcoty on the attach path for testing\n```\n\"directory\"",
    "created_at": "2022-03-30T01:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539772",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'>Comment 59:</a>

```
--- a/src/sage/repl/attach.py
+++ b/src/sage/repl/attach.py
@@ -170,12 +170,14 @@ def load_attach_path(path=None, replace=False):
...
+    We put a new, empty direcoty on the attach path for testing
```
"directory"



---

archive/issue_comments_539773.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nOverall, I'm a bit unsure about changes like this one to the doctests. \nWhat is lost for the user is being able to copy-paste the code and then inspect the\ngenerated file.\n\n```\ndiff --git a/src/sage/numerical/mip.pyx b/src/sage/numerical/mip.pyx\nindex d966be1..4bf61d1 100644\n--- a/src/sage/numerical/mip.pyx\n+++ b/src/sage/numerical/mip.pyx\n@@ -1336,7 +1336,9 @@ cdef class MixedIntegerLinearProgram(SageObject):\n             sage: x = p.new_variable(nonnegative=True)\n             sage: p.set_objective(x[1] + x[2])\n             sage: p.add_constraint(-3*x[1] + 2*x[2], max=2,name=\"OneConstraint\")\n-            sage: p.write_mps(os.path.join(SAGE_TMP, \"lp_problem.mps\"))\n+            sage: import tempfile\n+            sage: with tempfile.NamedTemporaryFile(suffix=\".mps\") as f:\n+            ....:     p.write_mps(f.name)\n             Writing problem data to ...\n             17 records were written\n```",
    "created_at": "2022-03-30T01:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539773",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'>Comment 60:</a>
Overall, I'm a bit unsure about changes like this one to the doctests. 
What is lost for the user is being able to copy-paste the code and then inspect the
generated file.

```
diff --git a/src/sage/numerical/mip.pyx b/src/sage/numerical/mip.pyx
index d966be1..4bf61d1 100644
--- a/src/sage/numerical/mip.pyx
+++ b/src/sage/numerical/mip.pyx
@@ -1336,7 +1336,9 @@ cdef class MixedIntegerLinearProgram(SageObject):
             sage: x = p.new_variable(nonnegative=True)
             sage: p.set_objective(x[1] + x[2])
             sage: p.add_constraint(-3*x[1] + 2*x[2], max=2,name="OneConstraint")
-            sage: p.write_mps(os.path.join(SAGE_TMP, "lp_problem.mps"))
+            sage: import tempfile
+            sage: with tempfile.NamedTemporaryFile(suffix=".mps") as f:
+            ....:     p.write_mps(f.name)
             Writing problem data to ...
             17 records were written
```



---

archive/issue_comments_539774.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb1bd48670b4d5acf6493c7c9ade0bf126cdf01b\">eb1bd48</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87d50bec01bfa7122605e105b878ea78e9624669\">87d50be</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7434ae0e9d3b9d2845b05f48b22a2093ac4b0d95\">7434ae0</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/738a684a617550af18ba532e0fb13083149f189d\">738a684</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bf0a5dfde8bbe43aa754bcd5add6eb71c744cf0\">7bf0a5d</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74dfbd53a150d1a4de52aa1f5f77794dd14a68eb\">74dfbd5</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f27612f9e94907671dbee8bac42c6d6d36f395b5\">f27612f</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d097e2fd6f80acaab84260cb0bca80be5f7e5458\">d097e2f</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b16d2e5c3f2277809f54f5b42c2d7c50fd46929\">3b16d2e</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919\">0c59d5d</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-03-30T01:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539774",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:61'>Comment 61:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb1bd48670b4d5acf6493c7c9ade0bf126cdf01b">eb1bd48</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87d50bec01bfa7122605e105b878ea78e9624669">87d50be</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7434ae0e9d3b9d2845b05f48b22a2093ac4b0d95">7434ae0</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/738a684a617550af18ba532e0fb13083149f189d">738a684</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bf0a5dfde8bbe43aa754bcd5add6eb71c744cf0">7bf0a5d</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74dfbd53a150d1a4de52aa1f5f77794dd14a68eb">74dfbd5</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f27612f9e94907671dbee8bac42c6d6d36f395b5">f27612f</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d097e2fd6f80acaab84260cb0bca80be5f7e5458">d097e2f</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b16d2e5c3f2277809f54f5b42c2d7c50fd46929">3b16d2e</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919">0c59d5d</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539775.json:
```json
{
    "body": "Changed commit from **[a3b58ad](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa)** to **[0c59d5d](https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919)**",
    "created_at": "2022-03-30T01:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539775",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a3b58ad](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad4771287bfcc7f2952a56b67b3e075daaa)** to **[0c59d5d](https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919)**



---

archive/issue_comments_539776.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nReplying to [@mkoeppe](#comment%3A59):\n> \"directory\"\n\nalso fixed",
    "created_at": "2022-03-30T01:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539776",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:62'>Comment 62:</a>
Replying to [@mkoeppe](#comment%3A59):
> "directory"

also fixed



---

archive/issue_comments_539777.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nReplying to [@mkoeppe](#comment%3A60):\n> Overall, I'm a bit unsure about changes like this one to the doctests. \n> What is lost for the user is being able to copy-paste the code and then inspect the\n> generated file.\n\nIn many cases, the point of the method is that it writes what would normally be shown to the user to a file instead. If you want to see this MILP, for example, then `p.show()` can be used instead. I'm dodging your point, but looking back, many of these tests are in the same spirit.\n\nIn general, I would say it's bad practice to give users code that will write to a temporary file and teach them to expect it to remain there. It's better to have these copy/paste examples fail immediately, so that the user will pick a non-temporary path for his own experiments. Otherwise he could lose some work when sage exits or when the machine reboots.",
    "created_at": "2022-03-30T01:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539777",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:63'>Comment 63:</a>
Replying to [@mkoeppe](#comment%3A60):
> Overall, I'm a bit unsure about changes like this one to the doctests. 
> What is lost for the user is being able to copy-paste the code and then inspect the
> generated file.

In many cases, the point of the method is that it writes what would normally be shown to the user to a file instead. If you want to see this MILP, for example, then `p.show()` can be used instead. I'm dodging your point, but looking back, many of these tests are in the same spirit.

In general, I would say it's bad practice to give users code that will write to a temporary file and teach them to expect it to remain there. It's better to have these copy/paste examples fail immediately, so that the user will pick a non-temporary path for his own experiments. Otherwise he could lose some work when sage exits or when the machine reboots.



---

archive/issue_events_424252.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424252"
}
```



---

archive/issue_events_424253.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424253"
}
```



---

archive/issue_comments_539778.json:
```json
{
    "body": "Changed commit from **[0c59d5d](https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919)** to **[20bc0cf](https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770)**",
    "created_at": "2022-04-25T10:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539778",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0c59d5d](https://github.com/sagemath/sagetrac-mirror/commit/0c59d5d1e5ed73ec2332a130054e287a4c346919)** to **[20bc0cf](https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770)**



---

archive/issue_comments_539779.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08430e04715c5054a715191a9428b8f725e5608c\">08430e0</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/058907e812afa18314e3c6c7b28e86dd75befa90\">058907e</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad1dbd8c1392755acbee841130712e8be214faa5\">ad1dbd8</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f57fc070f4789ceb8420633299dec77663b0a702\">f57fc07</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aacc73c5e5a988cf728f211014b22bec674b0c4e\">aacc73c</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/615f6e5564f8f6380a9ef283a714b3a57dd4450d\">615f6e5</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f7d5819ed8fa6cff68553ebee7e18937ab954b8\">9f7d581</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9843b6487946ddadfbee5b46d57a13ab08fb301d\">9843b64</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47f929461257723bfd841b84e67e03e5658c0004\">47f9294</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770\">20bc0cf</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-04-25T10:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539779",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:65'>Comment 65:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08430e04715c5054a715191a9428b8f725e5608c">08430e0</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/058907e812afa18314e3c6c7b28e86dd75befa90">058907e</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad1dbd8c1392755acbee841130712e8be214faa5">ad1dbd8</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f57fc070f4789ceb8420633299dec77663b0a702">f57fc07</a></td><td><code>Trac #33213: drop SAGE_TMP from sage.misc.misc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aacc73c5e5a988cf728f211014b22bec674b0c4e">aacc73c</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/615f6e5564f8f6380a9ef283a714b3a57dd4450d">615f6e5</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f7d5819ed8fa6cff68553ebee7e18937ab954b8">9f7d581</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9843b6487946ddadfbee5b46d57a13ab08fb301d">9843b64</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47f929461257723bfd841b84e67e03e5658c0004">47f9294</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770">20bc0cf</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539780.json:
```json
{
    "body": "Changed dependencies from **#32987** to **#33779**",
    "created_at": "2022-05-01T01:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539780",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#32987** to **#33779**



---

archive/issue_comments_539781.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nI've split out #33779: Remove use of `SAGE_TMP` in `sage.interfaces.latte`",
    "created_at": "2022-05-01T01:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539781",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'>Comment 67:</a>
I've split out #33779: Remove use of `SAGE_TMP` in `sage.interfaces.latte`



---

archive/issue_comments_539782.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\nReplying to [@orlitzky](#comment%3A25):\n> Replying to [@mkoeppe](#comment%3A24):\n> > user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. [...]\n\n> \n> To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.\n\nCurrent branch still removes `SAGE_TMP`. This needs to be backed out. Likewise the removal of `ECL_TMP`, `SPYX_TMP` - they are part of the public API.",
    "created_at": "2022-05-01T01:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539782",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'>Comment 68:</a>
Replying to [@orlitzky](#comment%3A25):
> Replying to [@mkoeppe](#comment%3A24):
> > user code may continue to use `SAGE_TMP`, as this was the advertised interface since the beginning of time. So we need a transition period here. [...]

> 
> To my surprise, `SAGE_TMP` was actually undocumented. It's not in the reference manual or the developer guide, and it had no docstring. But you're probably right that a few sage developers managed to use it in their own code.

Current branch still removes `SAGE_TMP`. This needs to be backed out. Likewise the removal of `ECL_TMP`, `SPYX_TMP` - they are part of the public API.



---

archive/issue_comments_539783.json:
```json
{
    "body": "Changed commit from **[20bc0cf](https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770)** to **[5a9edd9](https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda)**",
    "created_at": "2022-05-03T11:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539783",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[20bc0cf](https://github.com/sagemath/sagetrac-mirror/commit/20bc0cfeb5a007022d010e5fb300ffcb304ee770)** to **[5a9edd9](https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda)**



---

archive/issue_comments_539784.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3ecdce022d6883b01ad3565a547f9adcaca11f7\">a3ecdce</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6cb517ad0c2011e68c849fab5d3d9ef8531c1f1\">f6cb517</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e0e3c0a45153965db60de86cb4f2b5040b74020\">7e0e3c0</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/218055bb32b896e120cb491516b233096a60d805\">218055b</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66268d6169382bc4bf4f12737ffb6cb7f6bc774f\">66268d6</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a373c8432348bd886b2e10905245b861c5e3f9d6\">a373c84</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccbe7662785f7e39995c9798870d49a7789a2da0\">ccbe766</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81a3bd8e0b083f4991495c21fe7d6378715187ce\">81a3bd8</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06202e315864fda4e544e4460937f111607970b1\">06202e3</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda\">5a9edd9</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-05-03T11:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539784",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:69'>Comment 69:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3ecdce022d6883b01ad3565a547f9adcaca11f7">a3ecdce</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6cb517ad0c2011e68c849fab5d3d9ef8531c1f1">f6cb517</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e0e3c0a45153965db60de86cb4f2b5040b74020">7e0e3c0</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/218055bb32b896e120cb491516b233096a60d805">218055b</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66268d6169382bc4bf4f12737ffb6cb7f6bc774f">66268d6</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a373c8432348bd886b2e10905245b861c5e3f9d6">a373c84</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccbe7662785f7e39995c9798870d49a7789a2da0">ccbe766</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81a3bd8e0b083f4991495c21fe7d6378715187ce">81a3bd8</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06202e315864fda4e544e4460937f111607970b1">06202e3</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda">5a9edd9</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539785.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\nI replaced the removal of `SAGE_TMP` by a deprecation, and likewise with the rename `SPYX_TMP` -> `spyx_tmp()`.\n\nI don't fully agree with doing the same for `ECL_TMP` since sage doesn't use it any more: anyone using it will have their code implicitly broken rather than explicitly. Nevertheless, I doubt anyone is using it, so I've put it back with a deprecation and relocated the path somewhere under the system's temporary location.",
    "created_at": "2022-05-03T11:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539785",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:70'>Comment 70:</a>
I replaced the removal of `SAGE_TMP` by a deprecation, and likewise with the rename `SPYX_TMP` -> `spyx_tmp()`.

I don't fully agree with doing the same for `ECL_TMP` since sage doesn't use it any more: anyone using it will have their code implicitly broken rather than explicitly. Nevertheless, I doubt anyone is using it, so I've put it back with a deprecation and relocated the path somewhere under the system's temporary location.



---

archive/issue_comments_539786.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nCould you move the new functions `spyx_tmp` to `sage.misc.temporary_file`, like I tried in #32986? This would help with modularization",
    "created_at": "2022-05-03T14:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539786",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'>Comment 71:</a>
Could you move the new functions `spyx_tmp` to `sage.misc.temporary_file`, like I tried in #32986? This would help with modularization



---

archive/issue_comments_539787.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nI've opened #33790 for the ECL/Maxima stuff - I'd like to run this by the ECL/Maxima people",
    "created_at": "2022-05-03T14:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539787",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'>Comment 72:</a>
I've opened #33790 for the ECL/Maxima stuff - I'd like to run this by the ECL/Maxima people



---

archive/issue_comments_539788.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae\">1a49685</a></td><td><code>Trac #33213: move spyx_tmp() to sage.misc.temporary_file.</code></td></tr></table>\n",
    "created_at": "2022-05-04T00:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539788",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:73'>Comment 73:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae">1a49685</a></td><td><code>Trac #33213: move spyx_tmp() to sage.misc.temporary_file.</code></td></tr></table>




---

archive/issue_comments_539789.json:
```json
{
    "body": "Changed commit from **[5a9edd9](https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda)** to **[1a49685](https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae)**",
    "created_at": "2022-05-04T00:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539789",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a9edd9](https://github.com/sagemath/sagetrac-mirror/commit/5a9edd957b014a3445aefd59313d3435bc5d4dda)** to **[1a49685](https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae)**



---

archive/issue_comments_539790.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nThanks. I've opened #33793 for this",
    "created_at": "2022-05-04T02:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539790",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'>Comment 74:</a>
Thanks. I've opened #33793 for this



---

archive/issue_comments_539791.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nI forgot to say I'll probably want to keep `sage.misc.temporary_file` without a dependence on Cython modules such as cachefunc",
    "created_at": "2022-05-04T03:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539791",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'>Comment 75:</a>
I forgot to say I'll probably want to keep `sage.misc.temporary_file` without a dependence on Cython modules such as cachefunc



---

archive/issue_comments_539792.json:
```json
{
    "body": "Changed dependencies from **#33779** to **#33779 #33793**",
    "created_at": "2022-05-04T14:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539792",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **#33779** to **#33779 #33793**



---

archive/issue_comments_539793.json:
```json
{
    "body": "Changed commit from **[1a49685](https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae)** to **[a980ff2](https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc)**",
    "created_at": "2022-05-04T14:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539793",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1a49685](https://github.com/sagemath/sagetrac-mirror/commit/1a4968523eb9c2ecd66e7148e78e66db909c86ae)** to **[a980ff2](https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc)**



---

archive/issue_comments_539794.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c3da84f3c71989d398fbf59ba207b835a7592ef\">8c3da84</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fa1aa6d82fc4428615524b629690866b33e7568\">8fa1aa6</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e12408abab44604632fe0cf9502a024736595e5f\">e12408a</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a899a3fa40a3f1c2e01ea3f6202874d3c3a72c31\">a899a3f</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c810bf0e24733cf437ffbb9d98a31b1f959104e3\">c810bf0</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f689fe3bb75df9d39f5b12933e0d4277dcffc856\">f689fe3</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a399994d31b10a48b4e1e243077ba92623b0887\">0a39999</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54a49c46dcbe8d8ce3711376e9bd7fd20d35d1a9\">54a49c4</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93d9b4c7579cf7189e6d03a86c03f4c3bc372972\">93d9b4c</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc\">a980ff2</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-05-04T14:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539794",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:77'>Comment 77:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c3da84f3c71989d398fbf59ba207b835a7592ef">8c3da84</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fa1aa6d82fc4428615524b629690866b33e7568">8fa1aa6</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e12408abab44604632fe0cf9502a024736595e5f">e12408a</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a899a3fa40a3f1c2e01ea3f6202874d3c3a72c31">a899a3f</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c810bf0e24733cf437ffbb9d98a31b1f959104e3">c810bf0</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f689fe3bb75df9d39f5b12933e0d4277dcffc856">f689fe3</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a399994d31b10a48b4e1e243077ba92623b0887">0a39999</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54a49c46dcbe8d8ce3711376e9bd7fd20d35d1a9">54a49c4</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93d9b4c7579cf7189e6d03a86c03f4c3bc372972">93d9b4c</a></td><td><code>Trac #33213: clean up after tmp_filename() and tmp_dir() for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc">a980ff2</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539795.json:
```json
{
    "body": "<a id='comment:78'>Comment 78:</a>\nOpened #33797, #33799",
    "created_at": "2022-05-04T19:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539795",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'>Comment 78:</a>
Opened #33797, #33799



---

archive/issue_comments_539796.json:
```json
{
    "body": "Changed dependencies from **#33779 #33793** to **#33779 #33793 #33797 #33799**",
    "created_at": "2022-05-04T21:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539796",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **#33779 #33793** to **#33779 #33793 #33797 #33799**



---

archive/issue_comments_539797.json:
```json
{
    "body": "<a id='comment:80'>Comment 80:</a>\nOpened #33829, #33837",
    "created_at": "2022-05-09T23:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539797",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'>Comment 80:</a>
Opened #33829, #33837



---

archive/issue_comments_539798.json:
```json
{
    "body": "Changed dependencies from **#33779 #33793 #33797 #33799** to **#33829**",
    "created_at": "2022-06-10T09:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539798",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#33779 #33793 #33797 #33799** to **#33829**



---

archive/issue_comments_539799.json:
```json
{
    "body": "<a id='comment:82'>Comment 82:</a>\nneed to get rid of SAGE_TMP in `msolve.py`\n\n```\nsrc/sage/rings/polynomial/msolve.py:from sage.misc.all import SAGE_TMP\nsrc/sage/rings/polynomial/msolve.py:    msolve_in = tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',\n...\n```\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ee2c0db0696171f132206bd28adc0b857ebeaa4\">9ee2c0d</a></td><td><code>Trac #33213: remove mentions of SAGE_TMP from the lazy_string module.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bab61df3c7bb995bcb3a73f6e3d362469bc9a3c7\">bab61df</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d56a0b9645d84d6c6463447d6df2bdee4ba75f8\">9d56a0b</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95abd2b56b4f6c99a7324f487c3b6ba7f59b3fdd\">95abd2b</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e875f1d2b1243cd1a2acda77ab345e06a8656b45\">e875f1d</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7dd2ee0d6c2aabfb2575a2de01788a71fe0a13b8\">7dd2ee0</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e386cee6242be44bd745cbada4c76b14d1327197\">e386cee</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/595c082094b716e14e6ff3bb7fb7400f1ced1222\">595c082</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ae7b23899cf4a13cac11d4ecc385f831859905\">46ae7b2</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5\">722f56c</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>\n",
    "created_at": "2022-06-10T10:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539799",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:82'>Comment 82:</a>
need to get rid of SAGE_TMP in `msolve.py`

```
src/sage/rings/polynomial/msolve.py:from sage.misc.all import SAGE_TMP
src/sage/rings/polynomial/msolve.py:    msolve_in = tempfile.NamedTemporaryFile(dir=SAGE_TMP, mode='w',
...
```

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ee2c0db0696171f132206bd28adc0b857ebeaa4">9ee2c0d</a></td><td><code>Trac #33213: remove mentions of SAGE_TMP from the lazy_string module.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bab61df3c7bb995bcb3a73f6e3d362469bc9a3c7">bab61df</a></td><td><code>Trac #33213: don't delete SAGE_TMP upon exiting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d56a0b9645d84d6c6463447d6df2bdee4ba75f8">9d56a0b</a></td><td><code>Trac #33213: remove SAGE_TMP from sage.misc.all.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95abd2b56b4f6c99a7324f487c3b6ba7f59b3fdd">95abd2b</a></td><td><code>Trac #33213: replace SAGE_TMP in cleaner/quit interfaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e875f1d2b1243cd1a2acda77ab345e06a8656b45">e875f1d</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7dd2ee0d6c2aabfb2575a2de01788a71fe0a13b8">7dd2ee0</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e386cee6242be44bd745cbada4c76b14d1327197">e386cee</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/595c082094b716e14e6ff3bb7fb7400f1ced1222">595c082</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ae7b23899cf4a13cac11d4ecc385f831859905">46ae7b2</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5">722f56c</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr></table>




---

archive/issue_comments_539800.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33213)** to **[u/dimpase/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/33213)**",
    "created_at": "2022-06-10T10:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539800",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/mjo/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/33213)** to **[u/dimpase/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/33213)**



---

archive/issue_events_424254.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-10T10:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424254"
}
```



---

archive/issue_events_424255.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-10T10:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424255"
}
```



---

archive/issue_comments_539801.json:
```json
{
    "body": "Changed commit from **[a980ff2](https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc)** to **[722f56c](https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5)**",
    "created_at": "2022-06-10T10:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539801",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[a980ff2](https://github.com/sagemath/sagetrac-mirror/commit/a980ff2bb7b3ab895f25f60e11024ea225899cfc)** to **[722f56c](https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5)**



---

archive/issue_comments_539802.json:
```json
{
    "body": "<a id='comment:83'>Comment 83:</a>\nrebased over the latest 9.7.beta1",
    "created_at": "2022-06-10T10:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539802",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:83'>Comment 83:</a>
rebased over the latest 9.7.beta1



---

archive/issue_comments_539803.json:
```json
{
    "body": "Changed commit from **[722f56c](https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5)** to **[beacc68](https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c)**",
    "created_at": "2022-06-10T10:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539803",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[722f56c](https://github.com/sagemath/sagetrac-mirror/commit/722f56c6c9c961c9c4dcb3e956c61c2b9b16def5)** to **[beacc68](https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c)**



---

archive/issue_comments_539804.json:
```json
{
    "body": "<a id='comment:84'>Comment 84:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c\">beacc68</a></td><td><code>do not use SAGE_TMP</code></td></tr></table>\n",
    "created_at": "2022-06-10T10:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539804",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:84'>Comment 84:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c">beacc68</a></td><td><code>do not use SAGE_TMP</code></td></tr></table>




---

archive/issue_comments_539805.json:
```json
{
    "body": "Changed commit from **[beacc68](https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c)** to **[9afa20b](https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056)**",
    "created_at": "2022-06-10T10:44:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539805",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[beacc68](https://github.com/sagemath/sagetrac-mirror/commit/beacc6853a162550cfd5cfd3ba9b004a181d5a6c)** to **[9afa20b](https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056)**



---

archive/issue_comments_539806.json:
```json
{
    "body": "<a id='comment:85'>Comment 85:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056\">9afa20b</a></td><td><code>add forgotten while rebasing deprecation in misc/dist.py</code></td></tr></table>\n",
    "created_at": "2022-06-10T10:44:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539806",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:85'>Comment 85:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056">9afa20b</a></td><td><code>add forgotten while rebasing deprecation in misc/dist.py</code></td></tr></table>




---

archive/issue_events_424256.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-10T10:45:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424256"
}
```



---

archive/issue_events_424257.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-10T10:45:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424257"
}
```



---

archive/issue_comments_539807.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, Dima Pasechnik**",
    "created_at": "2022-06-10T10:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539807",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Matthias Koeppe, Dima Pasechnik**



---

archive/issue_comments_539808.json:
```json
{
    "body": "<a id='comment:86'>Comment 86:</a>\nMatthias, is it OK with you?",
    "created_at": "2022-06-10T10:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539808",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:86'>Comment 86:</a>
Matthias, is it OK with you?



---

archive/issue_comments_539809.json:
```json
{
    "body": "<a id='comment:87'>Comment 87:</a>\nIs it still on top of #33829?",
    "created_at": "2022-06-10T19:42:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539809",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:87'>Comment 87:</a>
Is it still on top of #33829?



---

archive/issue_comments_539810.json:
```json
{
    "body": "<a id='comment:88'>Comment 88:</a>\nReplying to [@mkoeppe](#comment%3A87):\n> Is it still on top of #33829?\n\nit is. Is it wrong?",
    "created_at": "2022-06-10T22:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539810",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:88'>Comment 88:</a>
Replying to [@mkoeppe](#comment%3A87):
> Is it still on top of #33829?

it is. Is it wrong?



---

archive/issue_comments_539811.json:
```json
{
    "body": "<a id='comment:89'>Comment 89:</a>\nI haven't reviewed the changes on the ticket. The parts that I was able to review have been split out to separate tickets.",
    "created_at": "2022-06-11T18:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539811",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'>Comment 89:</a>
I haven't reviewed the changes on the ticket. The parts that I was able to review have been split out to separate tickets.



---

archive/issue_events_424258.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-11T18:33:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424258"
}
```



---

archive/issue_events_424259.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-11T18:33:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424259"
}
```



---

archive/issue_events_424260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-11T18:36:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424260"
}
```



---

archive/issue_events_424261.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-11T18:36:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424261"
}
```



---

archive/issue_comments_539812.json:
```json
{
    "body": "Work Issues: **Rebase on top of the dependencies**",
    "created_at": "2022-06-11T18:36:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539812",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **Rebase on top of the dependencies**



---

archive/issue_comments_539813.json:
```json
{
    "body": "Changed dependencies from **#33829** to **#33829, #33790**",
    "created_at": "2022-06-11T18:36:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539813",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#33829** to **#33829, #33790**



---

archive/issue_comments_539814.json:
```json
{
    "body": "Changed commit from **[9afa20b](https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056)** to **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**",
    "created_at": "2022-06-13T10:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539814",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9afa20b](https://github.com/sagemath/sagetrac-mirror/commit/9afa20b82c54b44740469f37d0b8668280933056)** to **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**



---

archive/issue_comments_539815.json:
```json
{
    "body": "<a id='comment:91'>Comment 91:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8c9d40a0c18d5a0cd5923bb52f7e37cececcc5d\">c8c9d40</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec1a3cf0f05b38e8de9fdd8fd906e1b950a7d0b2\">ec1a3cf</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78db2fd007eae2b88f2ed695d8726b5f664504c6\">78db2fd</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56e29640c20ff61a2a15b7cc1966a31c509dbab4\">56e2964</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31986c1bebc7cd40bd1d769d2343b063d8d4966c\">31986c1</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7ff254e405cea11695a2bbabbce361f3e6f74e3\">c7ff254</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78f029b78cfb304979a8e82b2b166b711d430ffb\">78f029b</a></td><td><code>do not use SAGE_TMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ae0e4144cfbe83c12e18890ec1ff6bfebff1ebe\">7ae0e41</a></td><td><code>add forgotten while rebasing deprecation in misc/dist.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d314d98e11f5823451b4be16eef51517702c40f\">5d314d9</a></td><td><code>pkgs/sage-setup, sagemath-{objects,categories,standard}: Add tox environment sagepython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5\">d94a1e6</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Use sagepython instead of hardcoded py39</code></td></tr></table>\n",
    "created_at": "2022-06-13T10:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539815",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:91'>Comment 91:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8c9d40a0c18d5a0cd5923bb52f7e37cececcc5d">c8c9d40</a></td><td><code>Trac #33213: deprecate SAGE_TMP.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec1a3cf0f05b38e8de9fdd8fd906e1b950a7d0b2">ec1a3cf</a></td><td><code>Trac #33213: move sage.interfaces.cleaner.cleaner() to quit interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78db2fd007eae2b88f2ed695d8726b5f664504c6">78db2fd</a></td><td><code>Trac #33213: close an open file a bit sooner in gap interface.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56e29640c20ff61a2a15b7cc1966a31c509dbab4">56e2964</a></td><td><code>Trac #33213: use @cached_function for the spawned processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31986c1bebc7cd40bd1d769d2343b063d8d4966c">31986c1</a></td><td><code>Trac #33213: ensure temporary gap workspace is created in a doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7ff254e405cea11695a2bbabbce361f3e6f74e3">c7ff254</a></td><td><code>Trac #33213: use old SAGE_TMP path for spawned_processes file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78f029b78cfb304979a8e82b2b166b711d430ffb">78f029b</a></td><td><code>do not use SAGE_TMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ae0e4144cfbe83c12e18890ec1ff6bfebff1ebe">7ae0e41</a></td><td><code>add forgotten while rebasing deprecation in misc/dist.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d314d98e11f5823451b4be16eef51517702c40f">5d314d9</a></td><td><code>pkgs/sage-setup, sagemath-{objects,categories,standard}: Add tox environment sagepython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5">d94a1e6</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Use sagepython instead of hardcoded py39</code></td></tr></table>




---

archive/issue_events_424262.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-13T10:16:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424262"
}
```



---

archive/issue_events_424263.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-13T10:16:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424263"
}
```



---

archive/issue_comments_539816.json:
```json
{
    "body": "<a id='comment:93'>Comment 93:</a>\nrebased over #33829, #33790 (and 9.7.beta2), all good",
    "created_at": "2022-06-13T10:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539816",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:93'>Comment 93:</a>
rebased over #33829, #33790 (and 9.7.beta2), all good



---

archive/issue_comments_539817.json:
```json
{
    "body": "Changed work issues from **Rebase on top of the dependencies** to none",
    "created_at": "2022-06-13T10:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539817",
    "user": "https://github.com/dimpase"
}
```

Changed work issues from **Rebase on top of the dependencies** to none



---

archive/issue_events_424264.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-13T10:59:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424264"
}
```



---

archive/issue_events_424265.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-13T10:59:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424265"
}
```



---

archive/issue_events_424266.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-21T23:22:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424266"
}
```



---

archive/issue_events_424267.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c0abe3f5ee35c14be752e80a34de28e30b6bdaa6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-06-21T23:22:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33213#event-424267"
}
```



---

archive/issue_comments_539818.json:
```json
{
    "body": "Changed branch from **[u/dimpase/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/33213)** to **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**",
    "created_at": "2022-06-21T23:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539818",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/ticket/33213](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/33213)** to **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)**



---

archive/issue_comments_539819.json:
```json
{
    "body": "<a id='comment:96'>Comment 96:</a>\nThe branch includes a rebased version of #32716",
    "created_at": "2022-06-25T20:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539819",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'>Comment 96:</a>
The branch includes a rebased version of #32716



---

archive/issue_comments_539820.json:
```json
{
    "body": "Changed commit from **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)** to none",
    "created_at": "2022-06-25T20:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539820",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[d94a1e6](https://github.com/sagemath/sagetrac-mirror/commit/d94a1e62c1ce92ab65cd840b3f002101b00a36e5)** to none



---

archive/issue_comments_539821.json:
```json
{
    "body": "<a id='comment:97'>Comment 97:</a>\nFollow-up discussion in https://groups.google.com/g/sage-devel/c/jpwUb8OCVVc",
    "created_at": "2022-09-27T17:51:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539821",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'>Comment 97:</a>
Follow-up discussion in https://groups.google.com/g/sage-devel/c/jpwUb8OCVVc



---

archive/issue_comments_539822.json:
```json
{
    "body": "<a id='comment:98'>Comment 98:</a>\nFollow-up ticket: #34593",
    "created_at": "2022-10-12T18:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33213#issuecomment-539822",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:98'>Comment 98:</a>
Follow-up ticket: #34593
