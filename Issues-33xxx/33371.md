# Issue 33371: Remove sage-location and NEW_SAGE_ROOT code

archive/issues_033134.json:
```json
{
    "body": "We remove the last bits of the old `sage-relocation` code, \nsee #33127#comment:39, #33127#comment:48\n\n\nCC:  @jhpalmieri\n\nBranch/Commit: 75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #33127, #30649\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33371\n\n",
    "closed_at": "2022-02-27T22:00:21Z",
    "created_at": "2022-02-17T19:51:21Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Remove sage-location and NEW_SAGE_ROOT code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33371",
    "user": "https://github.com/mkoeppe"
}
```
We remove the last bits of the old `sage-relocation` code, 
see #33127#comment:39, #33127#comment:48


CC:  @jhpalmieri

Branch/Commit: 75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487

Reviewer: John Palmieri

Author: Matthias Koeppe

Dependencies: #33127, #30649

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33371





---

archive/issue_comments_665488.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/remove_sage_location_and_new_sage_root_code\"",
    "created_at": "2022-02-17T19:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665488",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/remove_sage_location_and_new_sage_root_code"



---

archive/issue_comments_665489.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[0d27c8b](https://git.sagemath.org/sage.git/commit/?id=0d27c8b685a9b540dc44ae3e398a30a9f1535acb)|`src/bin/sage, build/bin/sage-site: Remove remaining uses of sage-location`|",
    "created_at": "2022-02-17T20:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[0d27c8b](https://git.sagemath.org/sage.git/commit/?id=0d27c8b685a9b540dc44ae3e398a30a9f1535acb)|`src/bin/sage, build/bin/sage-site: Remove remaining uses of sage-location`|



---

archive/issue_comments_665490.json:
```json
{
    "body": "Changing commit from \"\" to \"0d27c8b685a9b540dc44ae3e398a30a9f1535acb\"",
    "created_at": "2022-02-17T20:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "0d27c8b685a9b540dc44ae3e398a30a9f1535acb"



---

archive/issue_comments_665491.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+We remove the last bits of the old `sage-relocation` code, \n+see #33127#comment:39, #33127#comment:48\n \n``````\n",
    "created_at": "2022-02-17T20:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665491",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+We remove the last bits of the old `sage-relocation` code, 
+see #33127#comment:39, #33127#comment:48
 
``````




---

archive/issue_comments_665492.json:
```json
{
    "body": "<a id='comment:4'></a>\nAre there some corresponding changes that need to be made in the Sage binary distribution repo? On rare occasions when I've installed a binary, it has run a script to hardcode various library locations, and I wonder if it uses `sage-location`. (To be honest, I don't know the status of binary distributions of Sage anymore.)",
    "created_at": "2022-02-17T22:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665492",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Are there some corresponding changes that need to be made in the Sage binary distribution repo? On rare occasions when I've installed a binary, it has run a script to hardcode various library locations, and I wonder if it uses `sage-location`. (To be honest, I don't know the status of binary distributions of Sage anymore.)



---

archive/issue_comments_665493.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> Are there some corresponding changes that need to be made in the Sage binary distribution repo?\n\nNo, this mechanism is completely unrelated.",
    "created_at": "2022-02-17T23:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665493",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A4):
> Are there some corresponding changes that need to be made in the Sage binary distribution repo?

No, this mechanism is completely unrelated.



---

archive/issue_comments_665494.json:
```json
{
    "body": "Changing commit from \"0d27c8b685a9b540dc44ae3e398a30a9f1535acb\" to \"66af0a0dff85d86b71cc48f53c49e757fc9cf731\"",
    "created_at": "2022-02-19T22:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0d27c8b685a9b540dc44ae3e398a30a9f1535acb" to "66af0a0dff85d86b71cc48f53c49e757fc9cf731"



---

archive/issue_comments_665495.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[702b779](https://git.sagemath.org/sage.git/commit/?id=702b7795295d96f3601a129f0729f4006a55740a)|`src/bin/sage-env: Do not set SAGE_ROOT to empty; sage-location does not like it`|\n|[e3fa890](https://git.sagemath.org/sage.git/commit/?id=e3fa890fb37808cbf9d804fbd210af8e75b0b1c6)|`Merge #33127`|\n|[c9fe2ed](https://git.sagemath.org/sage.git/commit/?id=c9fe2ed264d0ced37a68a93b6fce47b6dc60cb7e)|`Merge #33127`|\n|[66af0a0](https://git.sagemath.org/sage.git/commit/?id=66af0a0dff85d86b71cc48f53c49e757fc9cf731)|`Merge #30649`|",
    "created_at": "2022-02-19T22:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[702b779](https://git.sagemath.org/sage.git/commit/?id=702b7795295d96f3601a129f0729f4006a55740a)|`src/bin/sage-env: Do not set SAGE_ROOT to empty; sage-location does not like it`|
|[e3fa890](https://git.sagemath.org/sage.git/commit/?id=e3fa890fb37808cbf9d804fbd210af8e75b0b1c6)|`Merge #33127`|
|[c9fe2ed](https://git.sagemath.org/sage.git/commit/?id=c9fe2ed264d0ced37a68a93b6fce47b6dc60cb7e)|`Merge #33127`|
|[66af0a0](https://git.sagemath.org/sage.git/commit/?id=66af0a0dff85d86b71cc48f53c49e757fc9cf731)|`Merge #30649`|



---

archive/issue_comments_665496.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-02-19T22:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665496",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_665497.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-19T22:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665497",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_665498.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhen you have a chance, could you please update with the latest branches from the dependency tickets?",
    "created_at": "2022-02-21T05:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665498",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
When you have a chance, could you please update with the latest branches from the dependency tickets?



---

archive/issue_comments_665499.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[16b705a](https://git.sagemath.org/sage.git/commit/?id=16b705a6f6e209caf3fa110484f16e3d52136e88)|`Merge #33127`|\n|[65989cc](https://git.sagemath.org/sage.git/commit/?id=65989cc2ed05f09c8a114a84d6c529bdc28a50dd)|`trac 30649: remove \"sage -p --info --info ...\" test`|\n|[9ed0d60](https://git.sagemath.org/sage.git/commit/?id=9ed0d606063186aac40ae434dda853948966edd4)|`build/bin/sage-site: Edits to comments, help text`|\n|[f8a0d1d](https://git.sagemath.org/sage.git/commit/?id=f8a0d1dbee421c12131236f84e8bdce0fb3e7105)|`Merge #30649`|\n|[75c5ac0](https://git.sagemath.org/sage.git/commit/?id=75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487)|`Merge tag '9.6.beta2' into t/33371/remove_sage_location_and_new_sage_root_code`|",
    "created_at": "2022-02-21T05:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[16b705a](https://git.sagemath.org/sage.git/commit/?id=16b705a6f6e209caf3fa110484f16e3d52136e88)|`Merge #33127`|
|[65989cc](https://git.sagemath.org/sage.git/commit/?id=65989cc2ed05f09c8a114a84d6c529bdc28a50dd)|`trac 30649: remove "sage -p --info --info ..." test`|
|[9ed0d60](https://git.sagemath.org/sage.git/commit/?id=9ed0d606063186aac40ae434dda853948966edd4)|`build/bin/sage-site: Edits to comments, help text`|
|[f8a0d1d](https://git.sagemath.org/sage.git/commit/?id=f8a0d1dbee421c12131236f84e8bdce0fb3e7105)|`Merge #30649`|
|[75c5ac0](https://git.sagemath.org/sage.git/commit/?id=75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487)|`Merge tag '9.6.beta2' into t/33371/remove_sage_location_and_new_sage_root_code`|



---

archive/issue_comments_665500.json:
```json
{
    "body": "Changing commit from \"66af0a0dff85d86b71cc48f53c49e757fc9cf731\" to \"75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487\"",
    "created_at": "2022-02-21T05:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665500",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "66af0a0dff85d86b71cc48f53c49e757fc9cf731" to "75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487"



---

archive/issue_comments_665501.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis isn't working for me as an incremental upgrade. After building Sage 9.6.beta2, I checked out this branch and ran `make`. It failed almost immediately, complaining that \n\n```\n[sagelib-9.6.beta2] error: file '.../sage-9.6.beta2/pkgs/sagemath-standard/bin/sage-location' does not exist\n```",
    "created_at": "2022-02-22T23:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665501",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
This isn't working for me as an incremental upgrade. After building Sage 9.6.beta2, I checked out this branch and ran `make`. It failed almost immediately, complaining that 

```
[sagelib-9.6.beta2] error: file '.../sage-9.6.beta2/pkgs/sagemath-standard/bin/sage-location' does not exist
```



---

archive/issue_comments_665502.json:
```json
{
    "body": "<a id='comment:11'></a>\nYou'll have to run `./bootstrap`",
    "created_at": "2022-02-22T23:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665502",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
You'll have to run `./bootstrap`



---

archive/issue_comments_665503.json:
```json
{
    "body": "<a id='comment:12'></a>\nIs there any way to take care of that for all of the people who want to try out new releases but will not know this?",
    "created_at": "2022-02-22T23:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665503",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Is there any way to take care of that for all of the people who want to try out new releases but will not know this?



---

archive/issue_comments_665504.json:
```json
{
    "body": "<a id='comment:13'></a>\nRunning `bootstrap` is only needed before a ticket is merged into the next beta",
    "created_at": "2022-02-22T23:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665504",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Running `bootstrap` is only needed before a ticket is merged into the next beta



---

archive/issue_comments_665505.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-23T19:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665505",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_665506.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2022-02-23T19:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665506",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_665507.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks. This looks good to me, and I don't see any changes in behavior: before this branch Sage failed ungracefully if you moved its location, and it still fails ungracefully.\n\n(Does anyone use the script `sage-update-src`? Maybe that should go next.)",
    "created_at": "2022-02-23T19:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665507",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Thanks. This looks good to me, and I don't see any changes in behavior: before this branch Sage failed ungracefully if you moved its location, and it still fails ungracefully.

(Does anyone use the script `sage-update-src`? Maybe that should go next.)



---

archive/issue_comments_665508.json:
```json
{
    "body": "<a id='comment:15'></a>\nThank you!",
    "created_at": "2022-02-23T20:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Thank you!



---

archive/issue_comments_665509.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jhpalmieri](#comment%3A14):\n> (Does anyone use the script `sage-update-src`? Maybe that should go next.)\n\n\n+1 on getting rid of it in another ticket",
    "created_at": "2022-02-23T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665509",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Replying to [jhpalmieri](#comment%3A14):
> (Does anyone use the script `sage-update-src`? Maybe that should go next.)


+1 on getting rid of it in another ticket



---

archive/issue_comments_665510.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mkoeppe](#comment%3A16):\n> Replying to [jhpalmieri](#comment%3A14):\n> > (Does anyone use the script `sage-update-src`? Maybe that should go next.)\n\n> \n> +1 on getting rid of it in another ticket\n\n\nI opened #33412.",
    "created_at": "2022-02-23T20:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665510",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Replying to [mkoeppe](#comment%3A16):
> Replying to [jhpalmieri](#comment%3A14):
> > (Does anyone use the script `sage-update-src`? Maybe that should go next.)

> 
> +1 on getting rid of it in another ticket


I opened #33412.



---

archive/issue_events_088033.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33371#event-88033"
}
```



---

archive/issue_comments_665511.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665511",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_665512.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/remove_sage_location_and_new_sage_root_code\" to \"75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487\"",
    "created_at": "2022-02-27T22:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33371#issuecomment-665512",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/remove_sage_location_and_new_sage_root_code" to "75c5ac0e5531ab37fde1e4ccdceb1fdbcaa4d487"
