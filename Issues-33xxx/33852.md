# Issue 33852: bootstrap, src/doc/Makefile: Remove use of the SAGE_ROOT/sage script

archive/issues_033615.json:
```json
{
    "body": "We change the `bootstrap` scripts so that they invoke `build/bin/sage-package` directly instead of going through the `SAGE_ROOT/sage` script.\n\nThis is faster and also more robust because it separates build phases better by eliminating the (unnecessary) use of `configure`-generated files such as `src/bin/sage-src-env-config`.\n\nWe also move the generation of `src/doc/en/reference/repl/options.txt` (by calling `sage -advanced`) from bootstrap time to `src/doc/Makefile`. The information displayed there depends on what packages are installed, so running it at bootstrap time was not correct.\n\n\nCC:  @jhpalmieri @tobiasdiez @orlitzky @dimpase @kiwifb\n\nBranch/Commit: 67c8238c067ffb62f17a7e338dab57bc7d24ce70\n\nReviewer: John Palmieri, Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe\n\nDependencies: #33740\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33852\n\n",
    "closed_at": "2022-06-06T21:24:19Z",
    "created_at": "2022-05-14T21:05:12Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "bootstrap, src/doc/Makefile: Remove use of the SAGE_ROOT/sage script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33852",
    "user": "https://github.com/mkoeppe"
}
```
We change the `bootstrap` scripts so that they invoke `build/bin/sage-package` directly instead of going through the `SAGE_ROOT/sage` script.

This is faster and also more robust because it separates build phases better by eliminating the (unnecessary) use of `configure`-generated files such as `src/bin/sage-src-env-config`.

We also move the generation of `src/doc/en/reference/repl/options.txt` (by calling `sage -advanced`) from bootstrap time to `src/doc/Makefile`. The information displayed there depends on what packages are installed, so running it at bootstrap time was not correct.


CC:  @jhpalmieri @tobiasdiez @orlitzky @dimpase @kiwifb

Branch/Commit: 67c8238c067ffb62f17a7e338dab57bc7d24ce70

Reviewer: John Palmieri, Fran√ßois Bissey

Author: Matthias Koeppe

Dependencies: #33740

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33852





---

archive/issue_comments_511200.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2022-05-14T21:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511200",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_511201.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-14T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511202.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-14T21:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511203.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n We change the `bootstrap` scripts so that they invoke `build/bin/sage-package` directly instead of going through the `SAGE_ROOT/sage` script.\n \n This is faster and also more robust because it separates build phases better by eliminating the (unnecessary) use of `configure`-generated files such as `src/bin/sage-src-env-config`.\n+\n+We also move the generation of `src/doc/en/reference/repl/options.txt` (by calling `sage -advanced`) from bootstrap time to `src/doc/Makefile`. The information displayed there depends on what packages are installed, so running it at bootstrap time was not correct.\n+\n \n Author: Matthias Koeppe\n \n``````\n",
    "created_at": "2022-05-14T21:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511203",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 We change the `bootstrap` scripts so that they invoke `build/bin/sage-package` directly instead of going through the `SAGE_ROOT/sage` script.
 
 This is faster and also more robust because it separates build phases better by eliminating the (unnecessary) use of `configure`-generated files such as `src/bin/sage-src-env-config`.
+
+We also move the generation of `src/doc/en/reference/repl/options.txt` (by calling `sage -advanced`) from bootstrap time to `src/doc/Makefile`. The information displayed there depends on what packages are installed, so running it at bootstrap time was not correct.
+
 
 Author: Matthias Koeppe
 
``````




---

archive/issue_comments_511204.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-14T21:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511204",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_511205.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T00:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511206.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T02:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511206",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511207.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T03:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511208.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-15T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_511209.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T03:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511210.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-15T03:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_511211.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-15T04:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_511212.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-15T04:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_511213.json:
```json
{
    "body": "<a id='comment:17'></a>I found it a bit hard to figure out what came from #33740 and what is this ticket :(\n\nOnce I get past that issue, I agree with the changes. It is much cleaner and simpler. May not go far enough from a sage-on-gentoo point of view (I will still patch but we had that discussion `sage --docbuild` vs `python -m sage_docbuild` somewhere else and that step is not ready yet). Just one remark, all the targets are phony in `src/doc/Makefile` by necessity but we could have had `en/reference/repl/options.txt` as a real target instead of a phony one, not that it matter much in that sea of stuff that rebuild every time you call make.",
    "created_at": "2022-05-26T20:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511213",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>I found it a bit hard to figure out what came from #33740 and what is this ticket :(

Once I get past that issue, I agree with the changes. It is much cleaner and simpler. May not go far enough from a sage-on-gentoo point of view (I will still patch but we had that discussion `sage --docbuild` vs `python -m sage_docbuild` somewhere else and that step is not ready yet). Just one remark, all the targets are phony in `src/doc/Makefile` by necessity but we could have had `en/reference/repl/options.txt` as a real target instead of a phony one, not that it matter much in that sea of stuff that rebuild every time you call make.



---

archive/issue_comments_511214.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 fbissey]:\n> we could have had `en/reference/repl/options.txt` as a real target instead of a phony one\n\n\nYes but what would be its dependencies?",
    "created_at": "2022-05-26T20:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511214",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:17 fbissey]:
> we could have had `en/reference/repl/options.txt` as a real target instead of a phony one


Yes but what would be its dependencies?



---

archive/issue_comments_511215.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:\n> Replying to [comment:17 fbissey]:\n> > we could have had `en/reference/repl/options.txt` as a real target instead of a phony one\n\n> \n> Yes but what would be its dependencies?\n\n\nI am not sure I follow. It doesn't need to have dependencies or have I forgotten something fundamental about makefiles.",
    "created_at": "2022-05-26T20:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511215",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:
> Replying to [comment:17 fbissey]:
> > we could have had `en/reference/repl/options.txt` as a real target instead of a phony one

> 
> Yes but what would be its dependencies?


I am not sure I follow. It doesn't need to have dependencies or have I forgotten something fundamental about makefiles.



---

archive/issue_comments_511216.json:
```json
{
    "body": "<a id='comment:20'></a>In that case it would never be updated, which can't be right",
    "created_at": "2022-05-26T20:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511216",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>In that case it would never be updated, which can't be right



---

archive/issue_comments_511217.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 mkoeppe]:\n> In that case it would never be updated, which can't be right\n\n\nThank you for reminding me of some essentials :) I'd like to brush it off as it being too early in the morning to make a proper comment but I think that's just part of a pattern where I am too deep on the packager side, and thinking of workflow in which ultimately, makefile such as this one are \"single use\", and when something doesn't work you just restart from the top because you need the flow to be right. I am not spending enough time on the pure dev side, that's what",
    "created_at": "2022-05-26T20:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511217",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>Replying to [comment:20 mkoeppe]:
> In that case it would never be updated, which can't be right


Thank you for reminding me of some essentials :) I'd like to brush it off as it being too early in the morning to make a proper comment but I think that's just part of a pattern where I am too deep on the packager side, and thinking of workflow in which ultimately, makefile such as this one are "single use", and when something doesn't work you just restart from the top because you need the flow to be right. I am not spending enough time on the pure dev side, that's what



---

archive/issue_comments_511218.json:
```json
{
    "body": "<a id='comment:22'></a>I think this looks okay, too. Fran\u00e7ois, do you agree with a positive review?",
    "created_at": "2022-05-27T18:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511218",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>I think this looks okay, too. Fran√ßois, do you agree with a positive review?



---

archive/issue_comments_511219.json:
```json
{
    "body": "<a id='comment:23'></a>Yes, let's get it in the next beta.",
    "created_at": "2022-05-27T20:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511219",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>Yes, let's get it in the next beta.



---

archive/issue_comments_511220.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-28T15:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511220",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_511221.json:
```json
{
    "body": "<a id='comment:25'></a>Thanks!",
    "created_at": "2022-05-28T17:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511221",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Thanks!



---

archive/issue_comments_511222.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-06T21:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33852#issuecomment-511222",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-06T21:24:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33852",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33852#event-88843"
}
```
