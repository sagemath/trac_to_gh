# Issue 33703: Parallelization of Boruvka's algorithm

archive/issues_033466.json:
```json
{
    "assignees": [],
    "body": "As per the discussion on https://groups.google.com/g/sage-devel/c/R3r3G_Qrllo, opening this ticket to parallelize Boruvka's algorithm.\n\nCC:  @kliem\n\nAuthor: **Adarsh Kishore**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/33703_\n\n",
    "created_at": "2022-04-13T06:17:50Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Parallelization of Boruvka's algorithm",
    "type": "issue",
    "updated_at": "2022-08-31T16:33:45Z",
    "url": "https://github.com/sagemath/sage/issues/33703",
    "user": "https://github.com/adarsh-kishore786"
}
```
As per the discussion on https://groups.google.com/g/sage-devel/c/R3r3G_Qrllo, opening this ticket to parallelize Boruvka's algorithm.

CC:  @kliem

Author: **Adarsh Kishore**

_Issue created by migration from https://trac.sagemath.org/ticket/33703_





---

archive/issue_events_429763.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:17:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429763"
}
```



---

archive/issue_events_429764.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:17:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429764"
}
```



---

archive/issue_events_429765.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:23:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429765"
}
```



---

archive/issue_events_429766.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:23:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429766"
}
```



---

archive/issue_events_429767.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:23:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429767"
}
```



---

archive/issue_events_429768.json:
```json
{
    "actor": "https://github.com/adarsh-kishore786",
    "created_at": "2022-04-13T06:23:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429768"
}
```



---

archive/issue_comments_547748.json:
```json
{
    "body": "Author: **Adarsh Kishore**",
    "created_at": "2022-04-13T06:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547748",
    "user": "https://github.com/adarsh-kishore786"
}
```

Author: **Adarsh Kishore**



---

archive/issue_comments_547749.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+As per the discussion on https://groups.google.com/g/sage-devel/c/R3r3G_Qrllo, opening this ticket to parallelize Boruvka's algorithm.\n``````\n",
    "created_at": "2022-04-13T06:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547749",
    "user": "https://github.com/adarsh-kishore786"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+As per the discussion on https://groups.google.com/g/sage-devel/c/R3r3G_Qrllo, opening this ticket to parallelize Boruvka's algorithm.
``````




---

archive/issue_comments_547750.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nSo what I was thinking is based on this excellent video I found - https://www.coursera.org/lecture/concurrent-programming-in-java/demonstration-parallelization-of-boruvkas-minimum-spanning-tree-algorithm-yaOEz?utm_source=link&utm_medium=page_share&utm_content=vlp&utm_campaign=top_button\n\nThis is done in Java, but the concepts are clear to me. I am planning to implement mutex locks in Cython and use them in a similar manner.\n\nDo you think this will work?",
    "created_at": "2022-04-13T06:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547750",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:2'>Comment 2:</a>
So what I was thinking is based on this excellent video I found - https://www.coursera.org/lecture/concurrent-programming-in-java/demonstration-parallelization-of-boruvkas-minimum-spanning-tree-algorithm-yaOEz?utm_source=link&utm_medium=page_share&utm_content=vlp&utm_campaign=top_button

This is done in Java, but the concepts are clear to me. I am planning to implement mutex locks in Cython and use them in a similar manner.

Do you think this will work?



---

archive/issue_comments_547751.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nFor reference:\n\nhttps://stackoverflow.com/questions/71851885/implementing-multiple-mutex-locks-in-cython",
    "created_at": "2022-04-13T13:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547751",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'>Comment 3:</a>
For reference:

https://stackoverflow.com/questions/71851885/implementing-multiple-mutex-locks-in-cython



---

archive/issue_comments_547752.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nActually, sage isn't just written in Python and Cython and also you can use many things from C++ in cython (one example of what does not work, is templates using integers, e.g. https://en.cppreference.com/w/cpp/utility/bitset/bitset) and there is even pure C or C++.\n\nOne advantage/disadvantage of using parallelism via cython is that one needs to release the GIL.\nSo first of all one needs to evaluate what data type is our input and what operations do we need to do. And is the conversion of the input worth the effort.\n\nHowever, the current algorithm also takes a complete copy of the graph and then proceeds, so for the input conversion, I believe we are good.\n\nI would recommend not to reinvent the wheel. So definitely go with `DavidW`s suggested and use https://en.cppreference.com/w/cpp/thread/mutex.\n\nThe lock part is pretty much clear to me. What is not clear to me is the following:\n- What data structure do we use, e.g. what is a vertex?\n- What happens at the merge.",
    "created_at": "2022-04-13T13:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547752",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'>Comment 4:</a>
Actually, sage isn't just written in Python and Cython and also you can use many things from C++ in cython (one example of what does not work, is templates using integers, e.g. https://en.cppreference.com/w/cpp/utility/bitset/bitset) and there is even pure C or C++.

One advantage/disadvantage of using parallelism via cython is that one needs to release the GIL.
So first of all one needs to evaluate what data type is our input and what operations do we need to do. And is the conversion of the input worth the effort.

However, the current algorithm also takes a complete copy of the graph and then proceeds, so for the input conversion, I believe we are good.

I would recommend not to reinvent the wheel. So definitely go with `DavidW`s suggested and use https://en.cppreference.com/w/cpp/thread/mutex.

The lock part is pretty much clear to me. What is not clear to me is the following:
- What data structure do we use, e.g. what is a vertex?
- What happens at the merge.



---

archive/issue_comments_547753.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@kliem](#comment%3A4):\n> Actually, sage isn't just written in Python and Cython and also you can use many things from C++ in cython (one example of what does not work, is templates using integers, e.g. https://en.cppreference.com/w/cpp/utility/bitset/bitset) and there is even pure C or C++.\n> \n> One advantage/disadvantage of using parallelism via cython is that one needs to release the GIL.\n> So first of all one needs to evaluate what data type is our input and what operations do we need to do. And is the conversion of the input worth the effort.\n> \n> However, the current algorithm also takes a complete copy of the graph and then proceeds, so for the input conversion, I believe we are good.\n> \n> I would recommend not to reinvent the wheel. So definitely go with `DavidW`s suggested and use https://en.cppreference.com/w/cpp/thread/mutex.\n> \n> The lock part is pretty much clear to me. What is not clear to me is the following:\n> - What data structure do we use, e.g. what is a vertex?\n> - What happens at the merge.\n\nThank you for these resources. I will go through them properly. As for the parts that are not clear, I was planning to modify the already present `boruvka` function in `SAGE_ROOT/src/graphs/spanning_tree.pyx` to use mutex locks and multithreading. Thus the vertex and merging will be as done in that algorithm, unless I feel there is need for changing that.",
    "created_at": "2022-04-13T13:47:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547753",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@kliem](#comment%3A4):
> Actually, sage isn't just written in Python and Cython and also you can use many things from C++ in cython (one example of what does not work, is templates using integers, e.g. https://en.cppreference.com/w/cpp/utility/bitset/bitset) and there is even pure C or C++.
> 
> One advantage/disadvantage of using parallelism via cython is that one needs to release the GIL.
> So first of all one needs to evaluate what data type is our input and what operations do we need to do. And is the conversion of the input worth the effort.
> 
> However, the current algorithm also takes a complete copy of the graph and then proceeds, so for the input conversion, I believe we are good.
> 
> I would recommend not to reinvent the wheel. So definitely go with `DavidW`s suggested and use https://en.cppreference.com/w/cpp/thread/mutex.
> 
> The lock part is pretty much clear to me. What is not clear to me is the following:
> - What data structure do we use, e.g. what is a vertex?
> - What happens at the merge.

Thank you for these resources. I will go through them properly. As for the parts that are not clear, I was planning to modify the already present `boruvka` function in `SAGE_ROOT/src/graphs/spanning_tree.pyx` to use mutex locks and multithreading. Thus the vertex and merging will be as done in that algorithm, unless I feel there is need for changing that.



---

archive/issue_comments_547754.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nIn cython parallel code, you cannot use anything that requires the `GIL`. So no `dict`, no `DisjointSet_of_hashables` etc. So there is a bit of work to be done with the data structures.",
    "created_at": "2022-04-13T14:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547754",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'>Comment 6:</a>
In cython parallel code, you cannot use anything that requires the `GIL`. So no `dict`, no `DisjointSet_of_hashables` etc. So there is a bit of work to be done with the data structures.



---

archive/issue_comments_547755.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nFor starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. \n\n`DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.\n\nWhat do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?",
    "created_at": "2022-04-13T15:27:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547755",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:7'>Comment 7:</a>
For starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. 

`DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.

What do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?



---

archive/issue_comments_547756.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAlso, one minor thing. How do you recompile Sage code after making a change in Sage source code?",
    "created_at": "2022-04-13T15:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547756",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:8'>Comment 8:</a>
Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?



---

archive/issue_comments_547757.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@adarsh-kishore786](#comment%3A8):\n> Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?\n\n`sage -b`.\n\nFor python changes with `--enable-editable`, even restarting will be fine.",
    "created_at": "2022-04-13T16:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547757",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@adarsh-kishore786](#comment%3A8):
> Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?

`sage -b`.

For python changes with `--enable-editable`, even restarting will be fine.



---

archive/issue_comments_547758.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@kliem](#comment%3A9):\n> Replying to [@adarsh-kishore786](#comment%3A8):\n> > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?\n\n> \n> `sage -b`.\n> \n> For python changes with `--enable-editable`, even restarting will be fine.\n\nu mean `./sage -b` in SAGE_ROOT?",
    "created_at": "2022-04-13T16:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547758",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@kliem](#comment%3A9):
> Replying to [@adarsh-kishore786](#comment%3A8):
> > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?

> 
> `sage -b`.
> 
> For python changes with `--enable-editable`, even restarting will be fine.

u mean `./sage -b` in SAGE_ROOT?



---

archive/issue_comments_547759.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nAnd if I only want to build a specific file, like `spanning_tree.pyx` and not the whole Sage?",
    "created_at": "2022-04-13T16:26:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547759",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:11'>Comment 11:</a>
And if I only want to build a specific file, like `spanning_tree.pyx` and not the whole Sage?



---

archive/issue_comments_547760.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@adarsh-kishore786](#comment%3A10):\n> Replying to [@kliem](#comment%3A9):\n> > Replying to [@adarsh-kishore786](#comment%3A8):\n> > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?\n\n> > \n> > `sage -b`.\n> > \n> > For python changes with `--enable-editable`, even restarting will be fine.\n\n> u mean `./sage -b` in SAGE_ROOT?\n\nYes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.\n\nThis will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.",
    "created_at": "2022-04-13T16:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547760",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@adarsh-kishore786](#comment%3A10):
> Replying to [@kliem](#comment%3A9):
> > Replying to [@adarsh-kishore786](#comment%3A8):
> > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?

> > 
> > `sage -b`.
> > 
> > For python changes with `--enable-editable`, even restarting will be fine.

> u mean `./sage -b` in SAGE_ROOT?

Yes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.

This will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.



---

archive/issue_comments_547761.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@kliem](#comment%3A12):\n> Replying to [@adarsh-kishore786](#comment%3A10):\n> > Replying to [@kliem](#comment%3A9):\n> > > Replying to [@adarsh-kishore786](#comment%3A8):\n> > > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?\n\n> > > \n> > > `sage -b`.\n> > > \n> > > For python changes with `--enable-editable`, even restarting will be fine.\n\n> > u mean `./sage -b` in SAGE_ROOT?\n\n> \n> Yes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.\n> \n> This will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.\n\nIn my case, it is building everything it seems.\n\n```\n[sagelib-9.6.beta4] Discovering Python/Cython source code....\n[sagelib-9.6.beta4] distributions = ['']\n[sagelib-9.6.beta4] Discovered Python/Cython sources, time: 14.45 seconds.\n[sagelib-9.6.beta4] running build\n[sagelib-9.6.beta4] Generating auto-generated sources\n[sagelib-9.6.beta4] Building interpreters for fast_callable\n[sagelib-9.6.beta4] running build_cython\n[sagelib-9.6.beta4] Enabling Cython debugging support\n[sagelib-9.6.beta4] Compiling sage/schemes/toric/divisor_class.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/mod_sym_num.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/descent_two_isogeny.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/period_lattice_region.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/schemes/hyperelliptic_curves/hypellfrob.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/permutation_cython.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/expnums.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/combinat_cython.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/degree_sequences.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/debruijn_sequence.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/root_system/reflection_group_c.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/posets/hasse_cython.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/matrices/dancing_links.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/base.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/invlex.pyx because it depends on ./sage/combinat/integer_lists/base.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/designs/evenly_distributed_sets.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/designs/designs_pyx.pyx because it depends on ./sage/data_structures/sparse_bitset.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/designs/orthogonal_arrays_find_recursive.pyx because it depends on ./sage/rings/integer.pxd.\n[sagelib-9.6.beta4] Compiling sage/combinat/designs/gen_quadrangles_with_spread.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/rigged_configurations/rigged_partition.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/crystals/letters.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/crystals/tensor_product_element.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/crystals/pbw_datum.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/words/word_datatypes.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/combinat/words/word_char.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/probability/probability_distribution.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/coerce_maps.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/category_object.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/parent_base.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/list_clone.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/parent_gens.pyx because it changed.\n[sagelib-9.6.beta4] Compiling sage/structure/element.pyx because it changed.\n...\n```\nI ran `./sage -b`",
    "created_at": "2022-04-13T16:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547761",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@kliem](#comment%3A12):
> Replying to [@adarsh-kishore786](#comment%3A10):
> > Replying to [@kliem](#comment%3A9):
> > > Replying to [@adarsh-kishore786](#comment%3A8):
> > > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?

> > > 
> > > `sage -b`.
> > > 
> > > For python changes with `--enable-editable`, even restarting will be fine.

> > u mean `./sage -b` in SAGE_ROOT?

> 
> Yes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.
> 
> This will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.

In my case, it is building everything it seems.

```
[sagelib-9.6.beta4] Discovering Python/Cython source code....
[sagelib-9.6.beta4] distributions = ['']
[sagelib-9.6.beta4] Discovered Python/Cython sources, time: 14.45 seconds.
[sagelib-9.6.beta4] running build
[sagelib-9.6.beta4] Generating auto-generated sources
[sagelib-9.6.beta4] Building interpreters for fast_callable
[sagelib-9.6.beta4] running build_cython
[sagelib-9.6.beta4] Enabling Cython debugging support
[sagelib-9.6.beta4] Compiling sage/schemes/toric/divisor_class.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/mod_sym_num.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/descent_two_isogeny.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/period_lattice_region.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/schemes/hyperelliptic_curves/hypellfrob.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/permutation_cython.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/expnums.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/combinat_cython.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/degree_sequences.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/debruijn_sequence.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/root_system/reflection_group_c.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/posets/hasse_cython.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/matrices/dancing_links.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/base.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/invlex.pyx because it depends on ./sage/combinat/integer_lists/base.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/designs/evenly_distributed_sets.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/designs/designs_pyx.pyx because it depends on ./sage/data_structures/sparse_bitset.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/designs/orthogonal_arrays_find_recursive.pyx because it depends on ./sage/rings/integer.pxd.
[sagelib-9.6.beta4] Compiling sage/combinat/designs/gen_quadrangles_with_spread.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/rigged_configurations/rigged_partition.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/crystals/letters.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/crystals/tensor_product_element.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/crystals/pbw_datum.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/words/word_datatypes.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/combinat/words/word_char.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/probability/probability_distribution.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/coerce_maps.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/category_object.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/parent_base.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/list_clone.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/parent_gens.pyx because it changed.
[sagelib-9.6.beta4] Compiling sage/structure/element.pyx because it changed.
...
```
I ran `./sage -b`



---

archive/issue_comments_547762.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@adarsh-kishore786](#comment%3A7):\n> For starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. \n> \n> `DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.\n> \n> What do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?\n\nIt might be best to think about some reasonable benchmarks first and then do changes.\nIf you are going to use random graphs, you can reproduce them with the help of `graph6_string`.\n\nA little starter for C++:\n\n```\nsage: cython('''\n....: # distutils: language=c++\n....: from libcpp.vector cimport vector\n....: cdef vector[int] foo\n....: ''')\n```\n\nIf we are going to do it parallel, I would really recommend rethinking the data structures. What is `merge` going to do.\nE.g. the whole business of caching seems to be to complicated during the algorithm.\nAll we need to have is a map between the vertices and `range(n)`.\nThen our vertices have index `size_t` and we could do something like:\n\n```\nsage: cython('''\n....: # distutils: language=c++\n....: from libcpp.vector cimport vector\n....: cdef struct edge:\n....:     size_t vertex1\n....:     size_t vertex2\n....:     size_t weight\n....: cdef vector[edge] edges = vector[edge]()\n....: ''')\n```",
    "created_at": "2022-04-13T16:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547762",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@adarsh-kishore786](#comment%3A7):
> For starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. 
> 
> `DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.
> 
> What do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?

It might be best to think about some reasonable benchmarks first and then do changes.
If you are going to use random graphs, you can reproduce them with the help of `graph6_string`.

A little starter for C++:

```
sage: cython('''
....: # distutils: language=c++
....: from libcpp.vector cimport vector
....: cdef vector[int] foo
....: ''')
```

If we are going to do it parallel, I would really recommend rethinking the data structures. What is `merge` going to do.
E.g. the whole business of caching seems to be to complicated during the algorithm.
All we need to have is a map between the vertices and `range(n)`.
Then our vertices have index `size_t` and we could do something like:

```
sage: cython('''
....: # distutils: language=c++
....: from libcpp.vector cimport vector
....: cdef struct edge:
....:     size_t vertex1
....:     size_t vertex2
....:     size_t weight
....: cdef vector[edge] edges = vector[edge]()
....: ''')
```



---

archive/issue_comments_547763.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@adarsh-kishore786](#comment%3A13):\n> Replying to [@kliem](#comment%3A12):\n> > Replying to [@adarsh-kishore786](#comment%3A10):\n> > > Replying to [@kliem](#comment%3A9):\n> > > > Replying to [@adarsh-kishore786](#comment%3A8):\n> > > > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?\n\n> > > > \n> > > > `sage -b`.\n> > > > \n> > > > For python changes with `--enable-editable`, even restarting will be fine.\n\n> > > u mean `./sage -b` in SAGE_ROOT?\n\n> > \n> > Yes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.\n> > \n> > This will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.\n\n> \n> In my case, it is building everything it seems.\n> \n> ```\n> [sagelib-9.6.beta4] Discovering Python/Cython source code....\n> [sagelib-9.6.beta4] distributions = ['']\n> [sagelib-9.6.beta4] Discovered Python/Cython sources, time: 14.45 seconds.\n> [sagelib-9.6.beta4] running build\n> [sagelib-9.6.beta4] Generating auto-generated sources\n> [sagelib-9.6.beta4] Building interpreters for fast_callable\n> [sagelib-9.6.beta4] running build_cython\n> [sagelib-9.6.beta4] Enabling Cython debugging support\n> [sagelib-9.6.beta4] Compiling sage/schemes/toric/divisor_class.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/mod_sym_num.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/descent_two_isogeny.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/period_lattice_region.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/schemes/hyperelliptic_curves/hypellfrob.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/permutation_cython.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/expnums.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/combinat_cython.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/degree_sequences.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/debruijn_sequence.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/root_system/reflection_group_c.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/posets/hasse_cython.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/matrices/dancing_links.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/base.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/invlex.pyx because it depends on ./sage/combinat/integer_lists/base.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/designs/evenly_distributed_sets.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/designs/designs_pyx.pyx because it depends on ./sage/data_structures/sparse_bitset.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/designs/orthogonal_arrays_find_recursive.pyx because it depends on ./sage/rings/integer.pxd.\n> [sagelib-9.6.beta4] Compiling sage/combinat/designs/gen_quadrangles_with_spread.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/rigged_configurations/rigged_partition.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/letters.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/tensor_product_element.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/pbw_datum.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/words/word_datatypes.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/combinat/words/word_char.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/probability/probability_distribution.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/coerce_maps.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/category_object.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/parent_base.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/list_clone.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/parent_gens.pyx because it changed.\n> [sagelib-9.6.beta4] Compiling sage/structure/element.pyx because it changed.\n> ...\n> ```\n> I ran `./sage -b`?replyto=7#comment\n\nThat all it takes, if you only change `sage/graphs/spanning_tree.pyx`:\n\n```\n[sagelib-9.6.rc0] [1/1] Cythonizing sage/graphs/spanning_tree.pyx\n[sagelib-9.6.rc0] Executing 1 command (using 1 thread)\n[sagelib-9.6.rc0] [1/1] build/cythonized/sage/graphs/spanning_tree.c:24647:20: warning: \u2018__pyx_mdef_4sage_9structure_7element_3have_same_parent\u2019 defined but not used [-Wunused-variable]\n[sagelib-9.6.rc0] 24647 | static PyMethodDef __pyx_mdef_4sage_9structure_7element_3have_same_parent = {\"have_same_parent\", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_9structure_7element_3have_same_parent, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_9structure_7element_2have_same_parent};\n[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:24301:20: warning: \u2018__pyx_mdef_4sage_9structure_7element_1parent\u2019 defined but not used [-Wunused-variable]\n[sagelib-9.6.rc0] 24301 | static PyMethodDef __pyx_mdef_4sage_9structure_7element_1parent = {\"parent\", (PyCFunction)__pyx_pw_4sage_9structure_7element_1parent, METH_O, __pyx_doc_4sage_9structure_7element_parent};\n[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:17125:20: warning: \u2018__pyx_mdef_4sage_7cpython_6string_3str_to_bytes\u2019 defined but not used [-Wunused-variable]\n[sagelib-9.6.rc0] 17125 | static PyMethodDef __pyx_mdef_4sage_7cpython_6string_3str_to_bytes = {\"str_to_bytes\", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_7cpython_6string_3str_to_bytes, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_7cpython_6string_2str_to_bytes};\n[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:16919:20: warning: \u2018__pyx_mdef_4sage_7cpython_6string_1bytes_to_str\u2019 defined but not used [-Wunused-variable]\n[sagelib-9.6.rc0] 16919 | static PyMethodDef __pyx_mdef_4sage_7cpython_6string_1bytes_to_str = {\"bytes_to_str\", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_7cpython_6string_1bytes_to_str, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_7cpython_6string_bytes_to_str};\n[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-9.6.rc0] In file included from build/cythonized/sage/graphs/spanning_tree.c:4374:\n[sagelib-9.6.rc0] sage/groups/perm_gps/partn_ref2/refinement_generic.h:19:12: warning: \u2018my_comp_func\u2019 defined but not used [-Wunused-function]\n[sagelib-9.6.rc0]    19 | static int my_comp_func(const void *a, const void *b)\n[sagelib-9.6.rc0]       |            ^~~~~~~~~~~~\n[sagelib-9.6.rc0] Time to execute 1 command: 11.96 seconds.\n[sagelib-9.6.rc0] Total time spent compiling C/C++ extensions: 12.01 seconds.\n[sagelib-9.6.rc0] warning: no files found matching '*.hh' anywhere in distribution\n[sagelib-9.6.rc0] warning: no files found matching '*.inc' anywhere in distribution\n[sagelib-9.6.rc0] no previously-included directories found matching '.tox'\n[sagelib-9.6.rc0] warning: no directories found matching 'sage/libs/gap/test'\n[sagelib-9.6.rc0] no previously-included directories found matching 'sage_setup'\n[sagelib-9.6.rc0] Cleaning up stale file: /home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/ext_data/nbconvert/__pycache__/postprocess.cpython-38.pyc\n[sagelib-9.6.rc0] \n[sagelib-9.6.rc0] real\t0m25,827s\n[sagelib-9.6.rc0] user\t0m22,311s\n[sagelib-9.6.rc0] sys\t0m2,156s\n\nreal\t0m25,919s\nuser\t0m22,400s\nsys\t0m2,161s\nSage build/upgrade complete!\n```\n\nHowever, if you change branches, then more files might be touched. An initial build always takes time, but once you only change that one file, it won't take that long.",
    "created_at": "2022-04-13T16:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547763",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@adarsh-kishore786](#comment%3A13):
> Replying to [@kliem](#comment%3A12):
> > Replying to [@adarsh-kishore786](#comment%3A10):
> > > Replying to [@kliem](#comment%3A9):
> > > > Replying to [@adarsh-kishore786](#comment%3A8):
> > > > > Also, one minor thing. How do you recompile Sage code after making a change in Sage source code?

> > > > 
> > > > `sage -b`.
> > > > 
> > > > For python changes with `--enable-editable`, even restarting will be fine.

> > > u mean `./sage -b` in SAGE_ROOT?

> > 
> > Yes, if you have different sage version, then this is how you have to do it. Of course, you can create an appropriate symlink to your sage to simplify things.
> > 
> > This will only build what changed during the last build. So if you only modify `spanning_tree.pyx`, it builds this and everything that depends on it.

> 
> In my case, it is building everything it seems.
> 
> ```
> [sagelib-9.6.beta4] Discovering Python/Cython source code....
> [sagelib-9.6.beta4] distributions = ['']
> [sagelib-9.6.beta4] Discovered Python/Cython sources, time: 14.45 seconds.
> [sagelib-9.6.beta4] running build
> [sagelib-9.6.beta4] Generating auto-generated sources
> [sagelib-9.6.beta4] Building interpreters for fast_callable
> [sagelib-9.6.beta4] running build_cython
> [sagelib-9.6.beta4] Enabling Cython debugging support
> [sagelib-9.6.beta4] Compiling sage/schemes/toric/divisor_class.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/mod_sym_num.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/descent_two_isogeny.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/schemes/elliptic_curves/period_lattice_region.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/schemes/hyperelliptic_curves/hypellfrob.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/permutation_cython.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/expnums.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/combinat_cython.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/degree_sequences.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/debruijn_sequence.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/root_system/reflection_group_c.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/posets/hasse_cython.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/matrices/dancing_links.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/base.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/integer_lists/invlex.pyx because it depends on ./sage/combinat/integer_lists/base.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/designs/evenly_distributed_sets.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/designs/designs_pyx.pyx because it depends on ./sage/data_structures/sparse_bitset.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/designs/orthogonal_arrays_find_recursive.pyx because it depends on ./sage/rings/integer.pxd.
> [sagelib-9.6.beta4] Compiling sage/combinat/designs/gen_quadrangles_with_spread.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/rigged_configurations/rigged_partition.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/letters.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/tensor_product_element.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/crystals/pbw_datum.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/words/word_datatypes.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/combinat/words/word_char.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/probability/probability_distribution.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/coerce_maps.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/category_object.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/parent_base.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/list_clone.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/parent_gens.pyx because it changed.
> [sagelib-9.6.beta4] Compiling sage/structure/element.pyx because it changed.
> ...
> ```
> I ran `./sage -b`?replyto=7#comment

That all it takes, if you only change `sage/graphs/spanning_tree.pyx`:

```
[sagelib-9.6.rc0] [1/1] Cythonizing sage/graphs/spanning_tree.pyx
[sagelib-9.6.rc0] Executing 1 command (using 1 thread)
[sagelib-9.6.rc0] [1/1] build/cythonized/sage/graphs/spanning_tree.c:24647:20: warning: ‘__pyx_mdef_4sage_9structure_7element_3have_same_parent’ defined but not used [-Wunused-variable]
[sagelib-9.6.rc0] 24647 | static PyMethodDef __pyx_mdef_4sage_9structure_7element_3have_same_parent = {"have_same_parent", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_9structure_7element_3have_same_parent, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_9structure_7element_2have_same_parent};
[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:24301:20: warning: ‘__pyx_mdef_4sage_9structure_7element_1parent’ defined but not used [-Wunused-variable]
[sagelib-9.6.rc0] 24301 | static PyMethodDef __pyx_mdef_4sage_9structure_7element_1parent = {"parent", (PyCFunction)__pyx_pw_4sage_9structure_7element_1parent, METH_O, __pyx_doc_4sage_9structure_7element_parent};
[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:17125:20: warning: ‘__pyx_mdef_4sage_7cpython_6string_3str_to_bytes’ defined but not used [-Wunused-variable]
[sagelib-9.6.rc0] 17125 | static PyMethodDef __pyx_mdef_4sage_7cpython_6string_3str_to_bytes = {"str_to_bytes", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_7cpython_6string_3str_to_bytes, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_7cpython_6string_2str_to_bytes};
[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-9.6.rc0] build/cythonized/sage/graphs/spanning_tree.c:16919:20: warning: ‘__pyx_mdef_4sage_7cpython_6string_1bytes_to_str’ defined but not used [-Wunused-variable]
[sagelib-9.6.rc0] 16919 | static PyMethodDef __pyx_mdef_4sage_7cpython_6string_1bytes_to_str = {"bytes_to_str", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4sage_7cpython_6string_1bytes_to_str, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4sage_7cpython_6string_bytes_to_str};
[sagelib-9.6.rc0]       |                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-9.6.rc0] In file included from build/cythonized/sage/graphs/spanning_tree.c:4374:
[sagelib-9.6.rc0] sage/groups/perm_gps/partn_ref2/refinement_generic.h:19:12: warning: ‘my_comp_func’ defined but not used [-Wunused-function]
[sagelib-9.6.rc0]    19 | static int my_comp_func(const void *a, const void *b)
[sagelib-9.6.rc0]       |            ^~~~~~~~~~~~
[sagelib-9.6.rc0] Time to execute 1 command: 11.96 seconds.
[sagelib-9.6.rc0] Total time spent compiling C/C++ extensions: 12.01 seconds.
[sagelib-9.6.rc0] warning: no files found matching '*.hh' anywhere in distribution
[sagelib-9.6.rc0] warning: no files found matching '*.inc' anywhere in distribution
[sagelib-9.6.rc0] no previously-included directories found matching '.tox'
[sagelib-9.6.rc0] warning: no directories found matching 'sage/libs/gap/test'
[sagelib-9.6.rc0] no previously-included directories found matching 'sage_setup'
[sagelib-9.6.rc0] Cleaning up stale file: /home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/ext_data/nbconvert/__pycache__/postprocess.cpython-38.pyc
[sagelib-9.6.rc0] 
[sagelib-9.6.rc0] real	0m25,827s
[sagelib-9.6.rc0] user	0m22,311s
[sagelib-9.6.rc0] sys	0m2,156s

real	0m25,919s
user	0m22,400s
sys	0m2,161s
Sage build/upgrade complete!
```

However, if you change branches, then more files might be touched. An initial build always takes time, but once you only change that one file, it won't take that long.



---

archive/issue_comments_547764.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@kliem](#comment%3A14):\n> Replying to [@adarsh-kishore786](#comment%3A7):\n> > For starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. \n> > \n> > `DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.\n> > \n> > What do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?\n\n> \n> It might be best to think about some reasonable benchmarks first and then do changes.\n> If you are going to use random graphs, you can reproduce them with the help of `graph6_string`.\n> \n> A little starter for C++:\n> \n> ```\n> sage: cython('''\n> ....: # distutils: language=c++\n> ....: from libcpp.vector cimport vector\n> ....: cdef vector[int] foo\n> ....: ''')\n> ```\n> \n> If we are going to do it parallel, I would really recommend rethinking the data structures. What is `merge` going to do.\n> E.g. the whole business of caching seems to be to complicated during the algorithm.\n> All we need to have is a map between the vertices and `range(n)`.\n> Then our vertices have index `size_t` and we could do something like:\n> \n> ```\n> sage: cython('''\n> ....: # distutils: language=c++\n> ....: from libcpp.vector cimport vector\n> ....: cdef struct edge:\n> ....:     size_t vertex1\n> ....:     size_t vertex2\n> ....:     size_t weight\n> ....: cdef vector[edge] edges = vector[edge]()\n> ....: ''')\n> ```\n\nThanks a lot, I'll follow this advice",
    "created_at": "2022-04-14T03:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547764",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@kliem](#comment%3A14):
> Replying to [@adarsh-kishore786](#comment%3A7):
> > For starters, I will try to remove all Python objects from the section that I want to Cythonize. For example, for `dict` I can use `map` from C++, for `list` I can use a `vector`, again from C++, or a `numpy` array. 
> > 
> > `DisjointSet_of_hashtables` might require more thought, but I think implementing an equivalent class in C++ should be helpful.
> > 
> > What do you say about this approach? Also, can you guide me to some resources on using C++ in Cython?

> 
> It might be best to think about some reasonable benchmarks first and then do changes.
> If you are going to use random graphs, you can reproduce them with the help of `graph6_string`.
> 
> A little starter for C++:
> 
> ```
> sage: cython('''
> ....: # distutils: language=c++
> ....: from libcpp.vector cimport vector
> ....: cdef vector[int] foo
> ....: ''')
> ```
> 
> If we are going to do it parallel, I would really recommend rethinking the data structures. What is `merge` going to do.
> E.g. the whole business of caching seems to be to complicated during the algorithm.
> All we need to have is a map between the vertices and `range(n)`.
> Then our vertices have index `size_t` and we could do something like:
> 
> ```
> sage: cython('''
> ....: # distutils: language=c++
> ....: from libcpp.vector cimport vector
> ....: cdef struct edge:
> ....:     size_t vertex1
> ....:     size_t vertex2
> ....:     size_t weight
> ....: cdef vector[edge] edges = vector[edge]()
> ....: ''')
> ```

Thanks a lot, I'll follow this advice



---

archive/issue_comments_547765.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nSo just as an example, I wrote the `DisjointSet` data structure in C++. https://github.com/adarsh-kishore786/Programming/tree/main/Cython/DisjointSets\n\nI plan to Cythonize it to see if it at least works, and then I can do an equivalent thing in Sage's codebase.\n\nWhat do you think of it?",
    "created_at": "2022-04-14T08:49:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547765",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:17'>Comment 17:</a>
So just as an example, I wrote the `DisjointSet` data structure in C++. https://github.com/adarsh-kishore786/Programming/tree/main/Cython/DisjointSets

I plan to Cythonize it to see if it at least works, and then I can do an equivalent thing in Sage's codebase.

What do you think of it?



---

archive/issue_comments_547766.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nCan we please use as many standard implementations as possible. There is already `std::set`. So unless there is a good reason for it, I would recommend using that.\n\nAlso, can you please provide some examples on what kind of timings you want to improve or some interesting problems. As David Coudert pointed out (https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ), we already have a large number of spanning tree algorithms. So I would be curious, if you can give me a graph in sage, for which obtaining a minimal spanning tree is a challenge. If there is no such thing, then I'm not sure why we are optimizing Boruvka's algorithm.",
    "created_at": "2022-04-14T09:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547766",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'>Comment 18:</a>
Can we please use as many standard implementations as possible. There is already `std::set`. So unless there is a good reason for it, I would recommend using that.

Also, can you please provide some examples on what kind of timings you want to improve or some interesting problems. As David Coudert pointed out (https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ), we already have a large number of spanning tree algorithms. So I would be curious, if you can give me a graph in sage, for which obtaining a minimal spanning tree is a challenge. If there is no such thing, then I'm not sure why we are optimizing Boruvka's algorithm.



---

archive/issue_comments_547767.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nAlso, before you start implementing a data structure, I would be curious on what we need:\n\n- How are vertices merged?\n- How are the edges from regions stored? (Not sure if regions is the correct word.)\n- How do we find a minimal edge.",
    "created_at": "2022-04-14T09:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547767",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'>Comment 19:</a>
Also, before you start implementing a data structure, I would be curious on what we need:

- How are vertices merged?
- How are the edges from regions stored? (Not sure if regions is the correct word.)
- How do we find a minimal edge.



---

archive/issue_comments_547768.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nI am planning to\n\n* Represent vertices as nodes in a `DisjointSet`. Then merging of vertices into a connected component will be equivalent to finding the union of their corresponding nodes.\n\n* Edges can be stored in the adjacency list corresponding to vertices. For this, we just need to add one more attribute in the nodes of the DS.\n\n* I am planning to keep the logic of the `boruvka` method already implemented in Sage, so the method of finding edges there will be the same\n\nI hope this makes sense, otherwise I would be happy to clarify.",
    "created_at": "2022-04-14T09:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547768",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:20'>Comment 20:</a>
I am planning to

* Represent vertices as nodes in a `DisjointSet`. Then merging of vertices into a connected component will be equivalent to finding the union of their corresponding nodes.

* Edges can be stored in the adjacency list corresponding to vertices. For this, we just need to add one more attribute in the nodes of the DS.

* I am planning to keep the logic of the `boruvka` method already implemented in Sage, so the method of finding edges there will be the same

I hope this makes sense, otherwise I would be happy to clarify.



---

archive/issue_comments_547769.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@kliem](#comment%3A18):\n> Can we please use as many standard implementations as possible. There is already `std::set`. So unless there is a good reason for it, I would recommend using that.\n> \n> Also, can you please provide some examples on what kind of timings you want to improve or some interesting problems. As David Coudert pointed out (https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ), we already have a large number of spanning tree algorithms. So I would be curious, if you can give me a graph in sage, for which obtaining a minimal spanning tree is a challenge. If there is no such thing, then I'm not sure why we are optimizing Boruvka's algorithm.\n\nI am not sure how `std::set` can be used as a `DisjointSet`. Can you explain?",
    "created_at": "2022-04-14T09:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547769",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@kliem](#comment%3A18):
> Can we please use as many standard implementations as possible. There is already `std::set`. So unless there is a good reason for it, I would recommend using that.
> 
> Also, can you please provide some examples on what kind of timings you want to improve or some interesting problems. As David Coudert pointed out (https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ), we already have a large number of spanning tree algorithms. So I would be curious, if you can give me a graph in sage, for which obtaining a minimal spanning tree is a challenge. If there is no such thing, then I'm not sure why we are optimizing Boruvka's algorithm.

I am not sure how `std::set` can be used as a `DisjointSet`. Can you explain?



---

archive/issue_comments_547770.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nWhat do you mean by `DisjointSet`. What is this? What does this class do.\n\nIs the purpose of `DisjointSet` to map each vertex to the current adjacency list?\n\nThere is no need to implement a `C++` class in cython. We can just import it using `cdef extern from \"myclass.cpp\":` Then it will just compile the corrsponding part.\n\nI think I almost got it. Before we proceed, I'm asking you to provide examples of graphs. Otherwise this whole thing is pointless. If the current algorithms work fine for all graphs, then we shouldn't worry about it.",
    "created_at": "2022-04-14T10:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547770",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'>Comment 22:</a>
What do you mean by `DisjointSet`. What is this? What does this class do.

Is the purpose of `DisjointSet` to map each vertex to the current adjacency list?

There is no need to implement a `C++` class in cython. We can just import it using `cdef extern from "myclass.cpp":` Then it will just compile the corrsponding part.

I think I almost got it. Before we proceed, I'm asking you to provide examples of graphs. Otherwise this whole thing is pointless. If the current algorithms work fine for all graphs, then we shouldn't worry about it.



---

archive/issue_comments_547771.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThere is no need to implement a parallel algorithm in sage for educational purpose, I believe. Everything in sage has to be maintained and without use cases, this would be a burden.",
    "created_at": "2022-04-14T10:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547771",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'>Comment 23:</a>
There is no need to implement a parallel algorithm in sage for educational purpose, I believe. Everything in sage has to be maintained and without use cases, this would be a burden.



---

archive/issue_comments_547772.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@kliem](#comment%3A22):\n> What do you mean by `DisjointSet`. What is this? What does this class do.\n> \n> Is the purpose of `DisjointSet` to map each vertex to the current adjacency list?\n> \n> There is no need to implement a `C++` class in cython. We can just import it using `cdef extern from \"myclass.cpp\":` Then it will just compile the corrsponding part.\n> \n> I think I almost got it. Before we proceed, I'm asking you to provide examples of graphs. Otherwise this whole thing is pointless. If the current algorithms work fine for all graphs, then we shouldn't worry about it.\n\n\nA `DisjointSet` is as described in https://en.wikipedia.org/wiki/Disjoint-set_data_structure. It will support operations\n* `makeset(i)`: It will make a new node with value `i`, parent as itself and rank 0\n* `findset(i)`: It will find the root of its tree\n* `union(i, j)`: It will merge two disjoint forests of which `i` and `j` are vertices of respectively, into a single tree.",
    "created_at": "2022-04-14T11:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547772",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@kliem](#comment%3A22):
> What do you mean by `DisjointSet`. What is this? What does this class do.
> 
> Is the purpose of `DisjointSet` to map each vertex to the current adjacency list?
> 
> There is no need to implement a `C++` class in cython. We can just import it using `cdef extern from "myclass.cpp":` Then it will just compile the corrsponding part.
> 
> I think I almost got it. Before we proceed, I'm asking you to provide examples of graphs. Otherwise this whole thing is pointless. If the current algorithms work fine for all graphs, then we shouldn't worry about it.


A `DisjointSet` is as described in https://en.wikipedia.org/wiki/Disjoint-set_data_structure. It will support operations
* `makeset(i)`: It will make a new node with value `i`, parent as itself and rank 0
* `findset(i)`: It will find the root of its tree
* `union(i, j)`: It will merge two disjoint forests of which `i` and `j` are vertices of respectively, into a single tree.



---

archive/issue_comments_547773.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@kliem](#comment%3A23):\n> There is no need to implement a parallel algorithm in sage for educational purpose, I believe. Everything in sage has to be maintained and without use cases, this would be a burden.\n\nI understand your point. I will try to come up with a convincing example graph to demonstrate that we indeed need this, or as discussed in https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ,we can remove this line from the `TODO` list in #33703",
    "created_at": "2022-04-14T11:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547773",
    "user": "https://github.com/adarsh-kishore786"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@kliem](#comment%3A23):
> There is no need to implement a parallel algorithm in sage for educational purpose, I believe. Everything in sage has to be maintained and without use cases, this would be a burden.

I understand your point. I will try to come up with a convincing example graph to demonstrate that we indeed need this, or as discussed in https://groups.google.com/g/sage-devel/c/flB1dxXDmnc/m/oOvJoPZ6BAAJ,we can remove this line from the `TODO` list in #33703



---

archive/issue_comments_547774.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nDon't understand me wrong. I'm a big fan of parallelization and very curious, whether this can make a difference here. But I also think parallelization should be a last resort.",
    "created_at": "2022-04-14T12:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/33703#issuecomment-547774",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'>Comment 26:</a>
Don't understand me wrong. I'm a big fan of parallelization and very curious, whether this can make a difference here. But I also think parallelization should be a last resort.



---

archive/issue_events_429769.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429769"
}
```



---

archive/issue_events_429770.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429770"
}
```



---

archive/issue_events_429771.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429771"
}
```



---

archive/issue_events_429772.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/33703",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/33703#event-429772"
}
```
