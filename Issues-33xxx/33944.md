# Issue 33944: saving a tikzpicture to a local folder is now broken

archive/issues_033707.json:
```json
{
    "body": "Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken in 9.7.beta1:\n\n```\nsage: from sage.misc.latex_standalone import Standalone\nsage: s = Standalone('Hello World')\nsage: s.pdf('a.pdf')\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n<ipython-input-3-61662d74848f> in <module>\n----> 1 s.pdf('a.pdf')\n\n~/GitBox/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/latex_standalone.py in pdf(self, filename, view, program)\n    729         if filename:\n    730             filename = os.path.abspath(filename)\n--> 731             os.rename(temp_filename_pdf, filename)\n    732             return filename\n    733 \n\nOSError: [Errno 18] Invalid cross-device link: '/tmp/tmpwfvogvku/tikz_15rndaqh.pdf' -> '/home/.../a.pdf'\n```\n\nThis went unnoticed because everywhere in the doctests the files are created in the temporary folder.\n\nBranch/Commit: c4e817835d1744af17b4348d15ed9dff1456784a\n\nReviewer: Michael Orlitzky\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/33944\n\n",
    "closed_at": "2022-06-12T12:16:52Z",
    "created_at": "2022-06-01T19:52:32Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "saving a tikzpicture to a local folder is now broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33944",
    "user": "https://github.com/seblabbe"
}
```
Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken in 9.7.beta1:

```
sage: from sage.misc.latex_standalone import Standalone
sage: s = Standalone('Hello World')
sage: s.pdf('a.pdf')
---------------------------------------------------------------------------
OSError                                   Traceback (most recent call last)
<ipython-input-3-61662d74848f> in <module>
----> 1 s.pdf('a.pdf')

~/GitBox/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/latex_standalone.py in pdf(self, filename, view, program)
    729         if filename:
    730             filename = os.path.abspath(filename)
--> 731             os.rename(temp_filename_pdf, filename)
    732             return filename
    733 

OSError: [Errno 18] Invalid cross-device link: '/tmp/tmpwfvogvku/tikz_15rndaqh.pdf' -> '/home/.../a.pdf'
```

This went unnoticed because everywhere in the doctests the files are created in the temporary folder.

Branch/Commit: c4e817835d1744af17b4348d15ed9dff1456784a

Reviewer: Michael Orlitzky

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/33944





---

archive/issue_comments_676902.json:
```json
{
    "body": "<a id='comment:1'></a>\nA [solution](https://stackoverflow.com/questions/42392600/oserror-errno-18-invalid-cross-device-link) seems to be to use `shutil.move` instead.",
    "created_at": "2022-06-01T19:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676902",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>
A [solution](https://stackoverflow.com/questions/42392600/oserror-errno-18-invalid-cross-device-link) seems to be to use `shutil.move` instead.



---

archive/issue_comments_676903.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[c4e8178](https://git.sagemath.org/sage.git/commit?id=c4e817835d1744af17b4348d15ed9dff1456784a)|`33944: using shutil.move instead of os.rename`|",
    "created_at": "2022-06-01T20:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676903",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[c4e8178](https://git.sagemath.org/sage.git/commit?id=c4e817835d1744af17b4348d15ed9dff1456784a)|`33944: using shutil.move instead of os.rename`|



---

archive/issue_comments_676904.json:
```json
{
    "body": "Changing branch from \"\" to \"u/slabbe/33944\"",
    "created_at": "2022-06-01T20:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676904",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "" to "u/slabbe/33944"



---

archive/issue_comments_676905.json:
```json
{
    "body": "Changing author from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2022-06-01T20:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676905",
    "user": "https://github.com/seblabbe"
}
```

Changing author from "" to "Sébastien Labbé"



---

archive/issue_comments_676906.json:
```json
{
    "body": "Changing commit from \"\" to \"c4e817835d1744af17b4348d15ed9dff1456784a\"",
    "created_at": "2022-06-01T20:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676906",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "c4e817835d1744af17b4348d15ed9dff1456784a"



---

archive/issue_comments_676907.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-01T20:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676907",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_676908.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken:\n+Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken in 9.7.beta1:\n \n ```\n sage: from sage.misc.latex_standalone import Standalone\n``````\n",
    "created_at": "2022-06-01T20:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676908",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken:
+Now that temporary files are created in the `/tmp` folder (after #33797), the following is now broken in 9.7.beta1:
 
 ```
 sage: from sage.misc.latex_standalone import Standalone
``````




---

archive/issue_comments_676909.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2022-06-01T20:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676909",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_676910.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-01T20:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676910",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_676911.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think this would have been broken already when saving to a filesystem other than the one that `SAGE_TMP` lives on. The fix looks correct, thanks.",
    "created_at": "2022-06-01T20:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676911",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>
I think this would have been broken already when saving to a filesystem other than the one that `SAGE_TMP` lives on. The fix looks correct, thanks.



---

archive/issue_events_088952.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-12T12:16:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33944#event-88952"
}
```



---

archive/issue_comments_676912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T12:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676912",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_676913.json:
```json
{
    "body": "Changing branch from \"u/slabbe/33944\" to \"c4e817835d1744af17b4348d15ed9dff1456784a\"",
    "created_at": "2022-06-12T12:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33944#issuecomment-676913",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slabbe/33944" to "c4e817835d1744af17b4348d15ed9dff1456784a"
