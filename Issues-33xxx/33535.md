# Issue 33535: Update ipykernel to 6.13.0 - reintroduces psutil

archive/issues_033535.json:
```json
{
    "body": "CC:  @orlitzky @williamstein @tornaria\n\nipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656\n\n\nPrevious update of ipykernel was done in #33020.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33772\n\n",
    "created_at": "2022-04-29T18:21:33Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Update ipykernel to 6.13.0 - reintroduces psutil",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33535",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @orlitzky @williamstein @tornaria

ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33 -  removed in #32656


Previous update of ipykernel was done in #33020.


Issue created by migration from https://trac.sagemath.org/ticket/33772





---

archive/issue_comments_476834.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-29T18:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476834",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_476835.json:
```json
{
    "body": "Well it depends on a python package named psutils because it mimics that functionality, but the python package in question do not require the C package psutil.\n\nhttps://github.com/giampaolo/psutil https://pypi.org/project/psutil/\n\nSo the plot twist is that we can really dump the old \"psutil\" package in favor of something designed to be more cross platform from the start.",
    "created_at": "2022-04-29T19:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476835",
    "user": "https://github.com/kiwifb"
}
```

Well it depends on a python package named psutils because it mimics that functionality, but the python package in question do not require the C package psutil.

https://github.com/giampaolo/psutil https://pypi.org/project/psutil/

So the plot twist is that we can really dump the old "psutil" package in favor of something designed to be more cross platform from the start.



---

archive/issue_comments_476836.json:
```json
{
    "body": "Hm? No, it's the same Python package that was dumped in #32656 but is now needed again for ipykernel.",
    "created_at": "2022-04-29T19:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476836",
    "user": "https://github.com/mkoeppe"
}
```

Hm? No, it's the same Python package that was dumped in #32656 but is now needed again for ipykernel.



---

archive/issue_comments_476837.json:
```json
{
    "body": "Upstream psutil still doesn't support Cygwin (as far as I can see)",
    "created_at": "2022-04-29T19:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476837",
    "user": "https://github.com/mkoeppe"
}
```

Upstream psutil still doesn't support Cygwin (as far as I can see)



---

archive/issue_comments_476838.json:
```json
{
    "body": "My mistake, I always thought it was another package that was being discussed. In fact I may have had a wrong dependency for a while :(",
    "created_at": "2022-04-29T19:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476838",
    "user": "https://github.com/kiwifb"
}
```

My mistake, I always thought it was another package that was being discussed. In fact I may have had a wrong dependency for a while :(



---

archive/issue_comments_476839.json:
```json
{
    "body": "Well, I know when I'm beaten. It looks like ipykernel is making the same mistakes that sage did; (a) reckless introduction of dependencies to obtain (b) meaningless memory metrics.\n\nI don't have the energy to fight it, I'm going outside.",
    "created_at": "2022-04-29T19:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476839",
    "user": "https://github.com/orlitzky"
}
```

Well, I know when I'm beaten. It looks like ipykernel is making the same mistakes that sage did; (a) reckless introduction of dependencies to obtain (b) meaningless memory metrics.

I don't have the energy to fight it, I'm going outside.



---

archive/issue_comments_476840.json:
```json
{
    "body": "After some fresh air, we can try to get a simple patch into `psutil` that minimally supports Cygwin by just returning a meaningless positive constant.\n\n(The last attempt to get Cygwin support into `psutil` was trying to get a highly intrusive megapatch in.)",
    "created_at": "2022-04-29T20:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476840",
    "user": "https://github.com/mkoeppe"
}
```

After some fresh air, we can try to get a simple patch into `psutil` that minimally supports Cygwin by just returning a meaningless positive constant.

(The last attempt to get Cygwin support into `psutil` was trying to get a highly intrusive megapatch in.)



---

archive/issue_comments_476841.json:
```json
{
    "body": "I doubt `psutil` will take any Cygwin patches (Erik's attempts to get the patch considered deteriorated into a huge fight).\n\nWe'd need a drop-in replacement on Cygwin :-(",
    "created_at": "2022-04-30T08:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476841",
    "user": "https://github.com/dimpase"
}
```

I doubt `psutil` will take any Cygwin patches (Erik's attempts to get the patch considered deteriorated into a huge fight).

We'd need a drop-in replacement on Cygwin :-(



---

archive/issue_comments_476842.json:
```json
{
    "body": "IMHO less and less projects are willing to mess with Cygwin, (rightly) considering it to be a dying, obsolete, semi-broken, and dodgy.",
    "created_at": "2022-04-30T08:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476842",
    "user": "https://github.com/dimpase"
}
```

IMHO less and less projects are willing to mess with Cygwin, (rightly) considering it to be a dying, obsolete, semi-broken, and dodgy.



---

archive/issue_comments_476843.json:
```json
{
    "body": "I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action\nAlso, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)",
    "created_at": "2022-06-26T18:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476843",
    "user": "https://github.com/mkoeppe"
}
```

I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)



---

archive/issue_comments_476844.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action\n> Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)\n> \n\n\nbut the upstream (Jupyter & Co) don't even try to support Cygwin.",
    "created_at": "2022-06-27T06:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476844",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:12 mkoeppe]:
> I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
> Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)
> 


but the upstream (Jupyter & Co) don't even try to support Cygwin.



---

archive/issue_comments_476845.json:
```json
{
    "body": "I think it's OK to make ipython and jupyter optional. After all, although I'm not 100% sure, it ought to be possible to use a native Windows Jupyter to connect to the cygwin Sage jupyter kernel.",
    "created_at": "2022-06-30T16:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476845",
    "user": "https://github.com/dimpase"
}
```

I think it's OK to make ipython and jupyter optional. After all, although I'm not 100% sure, it ought to be possible to use a native Windows Jupyter to connect to the cygwin Sage jupyter kernel.



---

archive/issue_comments_476846.json:
```json
{
    "body": "#30306 lists a number of tickets to try out and document such setups, but nobody has done the work",
    "created_at": "2022-06-30T17:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33535#issuecomment-476846",
    "user": "https://github.com/mkoeppe"
}
```

#30306 lists a number of tickets to try out and document such setups, but nobody has done the work



---

archive/issue_events_088734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-11T04:07:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33535",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33535#event-88734"
}
```
