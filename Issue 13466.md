# Issue 13466: Inversion in polynomial quotient rings should not say NotImplemented when element is non-invertible

Issue created by migration from https://trac.sagemath.org/ticket/13670

Original creator: Bouillaguet

Original creation time: 2012-10-30 13:34:22

Assignee: malb

CC:  malb mstreng

Keywords: polynomial rings


```
sage: R.<x1,x2> = QQ[]
sage: S = R.quotient_ring( R.ideal(x2**2 + x1 - 2, x1**2 - 1) )
sage: 
sage: 1 / S(x1 + x2)
...
NotImplementedError: 
```


In fact, the element is non-invertible. The test used to check for invertibility is correct and complete, so we should return a "ValueError: Non-invertible exception" instead.


---

Comment by Bouillaguet created at 2012-11-07 14:21:54

Changing status from new to needs_review.


---

Comment by mstreng created at 2012-11-07 18:49:19

Changing status from needs_review to needs_work.


---

Comment by mstreng created at 2012-11-07 18:49:19

Changing priority from major to minor.


---

Comment by mstreng created at 2012-11-07 18:49:19

There's a problem with the documentation in the patch: "that when the error message actually describes what happens when division is not possible"

You can also be more precise than "not possible" in the string of the Error. How about "Left hand side is not a multiple of right hand side in quotient ring element division". My problem is that "not possible" is vague and can mean many other things, such as non-uniqueness, a computability problem, or a practical problem.

And then there is the following problem (which was there already). For most rings, only unique division is allowed, and non-unique divisions give a `ZeroDivisionError`:

```
sage: 0/0 # every integer a satisfies 0*a=0, so we don't give an answer at all
ZeroDivisionError: Rational division by zero
sage: L = Zmod(8)(4); R = Zmod(8)(2)
sage: L/R # both a=(2 mod 8) a=(6 mod 8) satisfy a*R=L, so we don't give an answer at all
ZeroDivisionError: Inverse does not exist.
sage: R.<x,y> = QQ[]
sage: S = R.quotient_ring(R.ideal(x^2, y))
sage: 0/S(x) #any polynomial p with p(0)=0 satisfies p*S(x)=0 in S, but still we output one such element
0
```

Obviously you don't have to do anything with this non-uniqueness at this ticket, which is just about clarifying errors.


---

Comment by mstreng created at 2012-11-07 21:54:20

Replying to [comment:2 mstreng]:

ps. compare this:

> {{{
> sage: R.<x,y> = QQ[]
> sage: S = R.quotient_ring(R.ideal(x^2, y))
> sage: 0/S(x)
> 0
> }}}

to this:


```
sage: P.<x> = QQ[]
sage: S = P.quotient_ring(x^2)
sage: 0/S(x)
ZeroDivisionError: element xbar of quotient polynomial ring not invertible
```



---

Comment by Bouillaguet created at 2012-11-08 17:08:50

Replying to [comment:3 mstreng]:
>  compare this:
> 
> > {{{
> > sage: R.<x,y> = QQ[]
> > sage: S = R.quotient_ring(R.ideal(x^2, y))
> > sage: 0/S(x)
> > 0
> > }}}
> 
> to this:
> 
> {{{
> sage: P.<x> = QQ[]
> sage: S = P.quotient_ring(x^2)
> sage: 0/S(x)
> ZeroDivisionError: element xbar of quotient polynomial ring not invertible
> }}}

I would personally be more inclined to the second solution (at least because it does not conceal the fact that we are trying to divide by something which is non-invertible --- most likely a bug). Do we agree on this?

However, if I understand correctly, division by non-invertible elements is still allowed, e.g. the division of `p*q` by `q` should succeeds, even if `q ` has no inverse...


---

Comment by Bouillaguet created at 2012-11-08 17:38:37

Patch for the exception name. Should we fix the "zero divided by crap equals zero" problem, while we're at it?


---

Comment by Bouillaguet created at 2012-11-08 17:53:54

Changing status from needs_work to needs_review.


---

Comment by mstreng created at 2012-11-08 21:45:54

Replying to [comment:5 Bouillaguet]:
> Patch for the exception name. Should we fix the "zero divided by crap equals zero" problem, while we're at it?

It's not just a problem of dividing 0 by something. If you try to compute `S(2x)/S(x)`, then you have the same problem: the answer is non-unique, so the univariate case gives a ZeroDivisionError, while the multivariate case gives the answer `S(2)` where `S(2+x)` is equally correct.

I suppose consistency with Zmod and with the univariate case is very good, so sure, you can fix it. I don't have an opinion on whether this ticket is the place to do it, or whether the mailing lists need to be involved.

As for the current patch: could you remove " (and the denominator is non-invertible)"? It makes the error message very long and does not add any information: obviously if the denominator is invertible, then it divides everything, including the numerator.

And can you make sure that the lines don't go over 79-characters?


---

Attachment

Replying to [comment:7 mstreng]:
> It's not just a problem of dividing 0 by something. If you try to compute `S(2x)/S(x)`, then you have the same problem: the answer is non-unique, so the univariate case gives a ZeroDivisionError, while the multivariate case gives the answer `S(2)` where `S(2+x)` is equally correct.

So, if I understand correctly, division by `f` should only be allowed if `f` has an inverse in `R/I`. Is that correct? 

Thinking about this file more generally : most of the functions in this file are completely generic and do not depend on what `R` and `I` are. However there are a few exceptions to this : 

* `is_unit()`. Currently does almost nothing. Could possibly be improved while staying generic by trying the `inverse_mod` method of the parent ring `R`.

* `_div_`. Currently does something specific when `R` is a polynomial ring (computing a GrÃ¶bner basis, etc.), and something generic in other cases (multiplying the numerator by the inverse of the denominator, using the `inverse_mod` function of `R`). 

`__invert__` is somewhat generic: it tries to use the `inverse_mod` function of `R`, and if this is `NotImplemented`, then it tries `_div_`. This is bizarre, because in the end it will also fall back to `inverse_mod`, except when `R` is a polynomial ring, but these now have the `inverse_mod function` thanks to #13675.

So, maybe this ticket could become "Various Small Improvements to QuotientRingElement", and could implement:
* the improvement to the error message already discussed above
* small improvement to the `is_unit` function
* small improvement to the `_div_` function

I also wonder whether it is the Right Thing to have polynomial-specific code here...

Ch.


---

Comment by mstreng created at 2012-11-09 21:53:59

Replying to [comment:8 Bouillaguet]:
> So, maybe this ticket could become "Various Small Improvements to QuotientRingElement", and could implement:

Sounds like a big project that will stall this one simple clarification of an error message. I'd say don't change this ticket, but feel free to open a new ticket.

> I also wonder whether it is the Right Thing to have polynomial-specific code here...

I don't think it is. I'd say they belong to a (not yet existing) class !MPolynomialQuotientRingElement. Compare to `sage.rings.polynomial.polynomial_quotient_ring_element.PolynomialQuotientRingElement` Or maybe some (not yet existing) common parent of the univariate PolynomialQuo.... and the (not yet existing) multivariate MpolynomialQuo...


---

Comment by Bouillaguet created at 2012-11-09 21:59:59

Replying to [comment:9 mstreng]:
> Replying to [comment:8 Bouillaguet]:
> > So, maybe this ticket could become "Various Small Improvements to QuotientRingElement", and could implement:
> 
> Sounds like a big project that will stall this one simple clarification of an error message. I'd say don't change this ticket, but feel free to open a new ticket.

Will do.

In the meanwhile, I think that the current patch does what it is supposed to do.


---

Comment by mstreng created at 2012-11-10 06:40:56

(changing the ticket description so that patchbot follows the right path through the patches to apply)


---

Comment by mstreng created at 2012-11-10 06:43:44

See the patchbot output: the `__invert__` doctest that is changed in #13675 now gets yet another error message.


---

Comment by mstreng created at 2012-11-10 06:43:44

Changing status from needs_review to needs_work.


---

Comment by Bouillaguet created at 2012-11-10 08:58:54

Replying to [comment:12 mstreng]:
> See the patchbot output: the `__invert__` doctest that is changed in #13675 now gets yet another error message.

I don't understand, Patchbot is apparently happy... (and green)


---

Comment by mstreng created at 2012-11-10 11:52:51

Replying to [comment:13 Bouillaguet]:
> I don't understand, Patchbot is apparently happy... (and green)

It is. It wasn't this morning, probably because of the changed dependency chain.


---

Comment by mstreng created at 2012-11-10 11:52:51

Changing status from needs_work to needs_review.


---

Comment by mstreng created at 2012-11-12 11:33:49

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-11-16 21:25:46

Resolution: fixed
