# Issue 15977: Bug in is_hamiltonian: non-simple digraphs

Issue created by migration from https://trac.sagemath.org/ticket/16214

Original creator: ncohen

Original creation time: 2014-04-23 08:45:56

On top of #16210, there was a problem is `traveling_salesman_problem` for digraphs : the code reordered edges as it was meant for graphs only by applied to generic graphs.

With this fix, the `_scream_if_not_simple` can be removed as the function applies to all graphs.

Nathann


---

Comment by ncohen created at 2014-04-23 08:46:13

Changing status from new to needs_review.


---

Comment by git created at 2014-04-23 08:52:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-04-23 10:29:12

Hmmmmm

```
sage: G = DiGraph(loops=True, multiedges=True)
sage: G.add_vertex(0)
sage: G.add_edge(0,0,1)
sage: G.add_edge(0,0,2)
sage: G.traveling_salesman_problem(use_edge_labels=True)
Traceback (most recent call last):
...
TypeError: Density is not well-defined for multigraphs.
```

Please start from the public branch, I started some correction in the doc and added the doctest above (that you *have* to modify).
----
New commits:


---

Comment by vdelecroix created at 2014-04-23 10:29:32

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-04-23 13:39:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-04-23 13:40:39

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-04-23 13:40:39

Here it is !

Nathann
----
New commits:


---

Comment by vdelecroix created at 2014-04-23 13:50:52

hmmmmmmmmmmmmmmm

```
sage: G = DiGraph(loops=True)
sage: G.add_edges([(0,0),(0,1),(1,1),(1,0)])  # i.e. complete digraph with loops
sage: G.is_hamiltonian()
False
sage: G.remove_loops()
sage: G.is_hamiltonian()
True
```

Maybe I am wrong on the definition of hamiltonicity...


---

Comment by vdelecroix created at 2014-04-23 13:53:29

Even better

```
sage: G = DiGraph(loops=True)
sage: G.add_edges([(0,0),(0,1),(1,1),(1,0)])  # i.e. complete digraph with loops
sage: G.is_hamiltonian()
False
sage: G.remove_loops()
sage: G.is_hamiltonian()
True
sage: G.allow_loops(False)
sage: G.is_hamiltonian()
False
```



---

Comment by vdelecroix created at 2014-04-23 13:53:29

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-04-23 13:54:44

...........

No you are right, we are not allowed to remove parallel edges when the graph has exactly two vertices.

I cannot express how much I hate to make code messy just because of those #(*&%ô*&%&*(#(*&^ MULTIGRAPHS. Cannot stand that.

Nathann


---

Comment by vdelecroix created at 2014-04-23 13:56:38

Replying to [comment:9 ncohen]:
> ...........
> 
> No you are right, we are not allowed to remove parallel edges when the graph has exactly two vertices.
> 
> I cannot express how much I hate to make code messy just because of those #(*&%ô*&%&*(#(*&^ MULTIGRAPHS. Cannot stand that.

My last example is a digraph not a multigraph... isn't it?


---

Comment by ncohen created at 2014-04-23 13:59:24

No it isn't,my latest comment was a mistake. Because I was thinking of how the code is written, and it made me think that it would return False on the following instance :


```
sage: Graph([(0,1),(0,1)],multiedges=True).is_hamiltonian()
```


Unfortunately, not only does it NOT return "True" as it should, but it produces another bug. And I am sick and tired of fixing bugs for graphs I never ever use, i.e. f**** looped graphs with multiples edges.

Nathann


---

Comment by git created at 2014-04-23 14:28:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-04-23 14:29:56

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-04-23 14:29:56

It's ugly as hell and I do not know how I could write it better.

Some of the LP below assume that parallel edges will never be used. And this is true, except when the input has exactly two vertices.

Nathann


---

Comment by ncohen created at 2014-04-23 14:32:24

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-04-23 14:43:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-04-23 14:44:07

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-04-23 16:50:04

1) You forgot graphs on 1 vertex. As I was sure you would complain (and I am a smart guy) I did it.

2) You forgot the graph on 0 vertex. For this one, the hamiltonicity depends on the definition of cycle. For me an empty cycle is a vertex, but this is perhaps not common in the graph community. So please further edit my commit.

3) I am not convinced with

```
weight = lambda l : l if (l is not None and l) else 1
```

First of all as None evaluates to False, hence you can shorten it as

```
weight = lambda l: l if l else 1
```

which I definitely love ;-) On the other hand, it is not written anywhere that if I put a weight 0 and set `use_edge_labels=True` then my `0` will automatically become `1`.


---

Comment by vdelecroix created at 2014-04-23 16:50:04

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-04-23 16:50:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-04-23 18:38:58

Well... For me a graph with a single vertex and no edges is hamiltonian too. But really I could not care less, I am pretty sure that all softwares implement different conventions. For "order == 0", please return the graph itself. It is just not defined... Actually I would say that for `order < 2` the best is to raise an exception, saying that we have no idea what to do with those inputs ... If there is no clear definition, the best is to tell the user that he should settle the draw by himself.

Nathann


---

Comment by git created at 2014-04-23 19:20:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-23 19:29:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-23 19:31:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-04-23 19:33:11

I am waiting for the doctests... but what about

3) I am not convinced with

```
weight = lambda l : l if (l is not None and l) else 1
```

First of all as None evaluates to False, hence you can shorten it as

```
weight = lambda l: l if l else 1
```

which I definitely love ;-) On the other hand, it is not written anywhere that if I put a weight 0 and set use_edge_labels=True then my 0 will automatically become 1.


---

Comment by ncohen created at 2014-04-23 19:37:29

Oh. You are right there, a 0 should mean 0 and nothing else. There was also this problem of NetworkX graph whose default edge label is a `{}`, it caused us some trouble. I think we should write "l if l is not None else 1". But really, changing those None to 1 is already going too far to repair a badly formatted input `:-/`

Nathann


---

Comment by vdelecroix created at 2014-04-23 19:47:50

Replying to [comment:24 ncohen]:
> Oh. You are right there, a 0 should mean 0 and nothing else. There was also this problem of NetworkX graph whose default edge label is a `{}`, it caused us some trouble. I think we should write "l if l is not None else 1". But really, changing those None to 1 is already going too far to repair a badly formatted input `:-/`

Yes. Doing work in the back of the user is not good practice. So possibilities are
- 1) "1 if l is None else l" (we save one word with that version)
- 2) simply remove weight
I am in favor of 2). I did not check if the algorithm actually work if there are some `0`, do you know if it does?


---

Comment by ncohen created at 2014-04-23 19:53:14

The algorithm works with zeroes, with negative numbers, with anything. The Linear Program really do not care what the weights are, as long as they can be converted into floats.

I think that we could live well with 1) (especially since this problem occurs in several different functions). You can chose 2 if you prefer, but some doctests may break.

Nathann


---

Comment by vdelecroix created at 2014-04-23 20:01:29

Okay. Let's go for 1). If you do not do the change in the next hour I will do it (my sage is compiling again... grrr). And if you do, add some spec in the doc.

Vincent


---

Comment by git created at 2014-04-23 21:58:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-04-23 21:58:44

Ok, done... needs review.


---

Comment by vdelecroix created at 2014-04-23 21:58:44

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-04-23 22:08:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-04-23 22:09:27

All tests pass. If you agree with this last commit, you can set the patch to `positive_review`. Thank you for your help !

Nathann


---

Comment by vdelecroix created at 2014-04-23 22:16:57

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2014-04-23 22:16:57

Perfect! Your english is better than mine!

Vincent


---

Comment by vbraun created at 2014-04-25 14:20:42

Resolution: fixed
