# Issue 18852: freetype 2.6 fails to build on scientific linux 7.1

archive/issues_018852.json:
```json
{
    "body": "Building freetype fails with:\n\n```\n/autofit.lo /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c\nlibtool: compile:  gcc -pedantic -ansi -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs -I./builds/unix -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/include -c -Wall -g -O2 -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_SYSTEM_ZLIB -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_USE_BZIP2 -I/home/frb15/sagemath/sage-brial/local/include/libpng12 -DFT_CONFIG_OPTION_USE_PNG -I/usr/include/harfbuzz -DFT_CONFIG_OPTION_USE_HARFBUZZ \"-DFT_CONFIG_CONFIG_H=<ftconfig.h>\" -DFT2_BUILD_LIBRARY \"-DFT_CONFIG_MODULES_H=<ftmodule.h>\" /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c  -fPIC -DPIC -o /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs/.libs/autofit.o\nIn file included from /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c:37:0:\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c: In function 'af_get_coverage':\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: error: 'HB_SET_VALUE_INVALID' undeclared (first use in this function)\n     for ( idx = HB_SET_VALUE_INVALID; hb_set_next( gsub_lookups, &idx ); )\n                 ^\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: note: each undeclared identifier is reported only once for each function it appears in\n```\n\nIt appears `HB_SET_VALUE_INVALID` is defined in the `harfbuzz` library and the version shipped with scientific linux 7.1 (0.9.20) doesn't have it (0.9.38 in gentoo does). \n\nIssue created by migration from https://trac.sagemath.org/ticket/19089\n\n",
    "created_at": "2015-08-26T02:38:30Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "freetype 2.6 fails to build on scientific linux 7.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18852",
    "user": "@kiwifb"
}
```
Building freetype fails with:

```
/autofit.lo /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c
libtool: compile:  gcc -pedantic -ansi -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs -I./builds/unix -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/include -c -Wall -g -O2 -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_SYSTEM_ZLIB -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_USE_BZIP2 -I/home/frb15/sagemath/sage-brial/local/include/libpng12 -DFT_CONFIG_OPTION_USE_PNG -I/usr/include/harfbuzz -DFT_CONFIG_OPTION_USE_HARFBUZZ "-DFT_CONFIG_CONFIG_H=<ftconfig.h>" -DFT2_BUILD_LIBRARY "-DFT_CONFIG_MODULES_H=<ftmodule.h>" /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c  -fPIC -DPIC -o /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs/.libs/autofit.o
In file included from /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c:37:0:
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c: In function 'af_get_coverage':
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: error: 'HB_SET_VALUE_INVALID' undeclared (first use in this function)
     for ( idx = HB_SET_VALUE_INVALID; hb_set_next( gsub_lookups, &idx ); )
                 ^
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: note: each undeclared identifier is reported only once for each function it appears in
```

It appears `HB_SET_VALUE_INVALID` is defined in the `harfbuzz` library and the version shipped with scientific linux 7.1 (0.9.20) doesn't have it (0.9.38 in gentoo does). 

Issue created by migration from https://trac.sagemath.org/ticket/19089





---

archive/issue_comments_257972.json:
```json
{
    "body": "Setting `--with-harfbuzz=no` in `spkg-install` is somehow insufficient.",
    "created_at": "2015-08-26T02:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257972",
    "user": "@kiwifb"
}
```

Setting `--with-harfbuzz=no` in `spkg-install` is somehow insufficient.



---

archive/issue_comments_257973.json:
```json
{
    "body": "The option does work I had a stray `\"` in `spkg-install` branch to follow in a bit.",
    "created_at": "2015-08-26T02:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257973",
    "user": "@kiwifb"
}
```

The option does work I had a stray `"` in `spkg-install` branch to follow in a bit.



---

archive/issue_comments_257974.json:
```json
{
    "body": "Ready for review. Note that freetype checks to see if `harfbuzz` is higher than `0.9.19` but it is obviously too low.\n----\nLast 10 new commits:",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257974",
    "user": "@kiwifb"
}
```

Ready for review. Note that freetype checks to see if `harfbuzz` is higher than `0.9.19` but it is obviously too low.
----
Last 10 new commits:



---

archive/issue_comments_257975.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257975",
    "user": "@kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_257976.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-26T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257976",
    "user": "@kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_257977.json:
```json
{
    "body": "Didn't mean to pull #18437, I will have to redo the branch. Reported upstream:\nhttps://savannah.nongnu.org/bugs/index.php?45828",
    "created_at": "2015-08-26T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257977",
    "user": "@kiwifb"
}
```

Didn't mean to pull #18437, I will have to redo the branch. Reported upstream:
https://savannah.nongnu.org/bugs/index.php?45828



---

archive/issue_comments_257978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-26T03:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257978",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_257979.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-26T03:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257979",
    "user": "@kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_257980.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-08-28T01:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257980",
    "user": "@kiwifb"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_257981.json:
```json
{
    "body": "I can't test that it fixes the problem, but at least the fix makes sense.",
    "created_at": "2015-08-28T10:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257981",
    "user": "@jdemeyer"
}
```

I can't test that it fixes the problem, but at least the fix makes sense.



---

archive/issue_comments_257982.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-28T10:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257982",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_257983.json:
```json
{
    "body": "It is probably a rare condition as you need to have the development packages for harfbuzz in the first place. And you need to have just the \"right\" version from 0.9.19 to 0.9.21.",
    "created_at": "2015-08-28T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257983",
    "user": "@kiwifb"
}
```

It is probably a rare condition as you need to have the development packages for harfbuzz in the first place. And you need to have just the "right" version from 0.9.19 to 0.9.21.



---

archive/issue_comments_257984.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-29T23:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18852#issuecomment-257984",
    "user": "@vbraun"
}
```

Resolution: fixed
