# Issue 34447: Bug in constructor of quaternion orders from a basis

Issue created by migration from https://trac.sagemath.org/ticket/34684

Original creator: @Eloitor

Original creation time: 2022-10-21 12:44:20

CC:  lorenz

Keywords: quaternion orders, basis

When constructing a quaternion order over a number field I get an error:


```
from sage.algebras.quatalg.quaternion_algebra import QuaternionOrder
F.<w> = NumberField(x**2-x-1)
A.<i,j,k> = QuaternionAlgebra(F, -1, -1)

QuaternionOrder(A, [1, 3*i, 1/2*w + 1/2 + (3/2*w + 1)*i + 1/2*j, 1/2*w + (3/2*w - 1/2)*i + 1/2*k])
```


https://pastebin.com/rCi9TsbU

This happens because the code that checks the basis expects a rational matrix, but the matrix may have values in the number field.



---

Comment by chapoton created at 2022-10-22 05:58:54

the branch name should use `u/gh-Eloitor/QuaternionOrder_fix` with a dash


---

Comment by @Eloitor created at 2022-10-26 12:05:35

Replying to [ticket:34684 Eloi Torrents]:
> When constructing a quaternion order over a number field I get an error:
> 
> {{{
> from sage.algebras.quatalg.quaternion_algebra import QuaternionOrder
> F.<w> = NumberField(x**2-x-1)
> A.<i,j,k> = QuaternionAlgebra(F, -1, -1)
> 
> QuaternionOrder(A, [1, 3*i, 1/2*w + 1/2 + (3/2*w + 1)*i + 1/2*j, 1/2*w + (3/2*w - 1/2)*i + 1/2*k])
> }}}
> 
> https://pastebin.com/rCi9TsbU
> 
> This happens because the code that checks the basis expects a rational matrix, but the matrix may have values in the number field.
----
Last 10 new commits:


---

Comment by @DaveWitteMorris created at 2022-10-29 05:54:05

Changing status from new to needs_info.


---

Comment by @DaveWitteMorris created at 2022-10-29 05:54:05

Perhaps I don't understand what is going on, but I do not think we should make this change unless a lot of the other code is also fixed, because it looks to me like there will be a lot of bugs if we allow the initializer to create these algebras.  

For example, the last line in the `QuaternionOrder.__init__()` method (which I think is the same method that is modified by this commit) is

```
Parent.__init__(self, base=ZZ, facade=(A,),
    category=Algebras(ZZ).Facade().FiniteDimensional())
```

This seems to be constructing a `ZZ` algebra, but doesn't it need to be an algebra over the ring of integers of the number field?  

More generally, the docstring for the class `QuaternionOrder` warns that "Currently most methods silently assume that the `A.base_ring()` is `QQ`."

Until someone is willing to go through the whole file, perhaps we should just give a better error message (perhaps an `UnimplementedError`).
