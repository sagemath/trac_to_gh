# Issue 14650: Update pycrypto to 2.6.0

Issue created by migration from https://trac.sagemath.org/ticket/14854

Original creator: jpflori

Original creation time: 2013-07-04 20:51:24

Assignee: jdemeyer

We ship 2.1.0.


---

Comment by jpflori created at 2013-07-04 20:53:38

Changing keywords from "" to "spkg pycrypto".


---

Comment by jpflori created at 2013-07-04 20:53:38

This would be a good time to cleanup spkg scripts.


---

Comment by jpflori created at 2013-12-25 17:10:17

Trivial update on top of #12399.
----
New commits:


---

Comment by jpflori created at 2013-12-25 17:10:17

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-12-25 17:36:27

This was in #15531 but I'm pretty sure it applies here just as well:

```
sage -t --long src/sage/crypto/block_cipher/miniaes.py  # 1 doctest failed
sage -t --long src/sage/crypto/block_cipher/sdes.py  # 1 doctest failed
sage -t --long src/sage/crypto/classical_cipher.py  # 1 doctest failed
sage -t --long src/sage/crypto/stream_cipher.py  # 1 doctest failed
sage -t --long src/sage/crypto/util.py  # 1 doctest failed
sage -t --long src/sage/crypto/public_key/blum_goldwasser.py  # 1 doctest failed
sage -t --long src/sage/monoids/string_monoid.py  # 1 doctest failed
sage -t --long src/sage/monoids/string_monoid_element.py  # 1 doctest failed
```



---

Comment by jpflori created at 2013-12-25 17:38:36

Oops, I'll have a look at it.


---

Comment by jpflori created at 2013-12-25 18:54:47

The errors are because pycrpto wants a secure (hum, let's say more side channel attacks resistant) implem of modular exponentiation or issues a warning.
It's available as mpz_powm_sec from recent GMP releases, but MPIR does not supply that.
(Also note that wiith FLINT 2.4 we should be able to build all of Sage IIRC on top of gmp, time for a new spkg?)
So we should just ignore the warnings (or add them to the doctests but would fail with Sage on top of GMP).
Anyway, we don't really care within Sage, at least that's my point of view, nobody would or should use Sage to do real crypto.


---

Comment by git created at 2013-12-25 19:34:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2013-12-25 19:36:12

The solution I've implemented is to filter pycrypto warnings in the warnings module.
Feel free to say it is a bad solution and we should rather modify the tests, or move the piece of code I've added somewhere else (maybe it really slows down Sage startup, I don't know).


---

Comment by jpflori created at 2013-12-25 19:37:58

On a different topic, the only funciton actually used is in the monoids files, and that's only the byte_to_long function, so maybe we should implement this ourselves.
I don't suggest to remove the pycrypto pkg though.


---

Comment by vbraun created at 2013-12-25 19:53:28

I'd rather modify the tests and preserve the warning...


---

Comment by jpflori created at 2013-12-25 20:15:55

Should we explicitely match the warning or filter it with "..."?


---

Comment by vbraun created at 2013-12-25 20:41:03

Explicit is better than implicit (one of Python's credos), but then I don't care that much ;-)


---

Comment by jpflori created at 2013-12-25 20:45:58

Let's go for explicit. As I said, I think we should get rid of the pycrypto use in the monoid stuff anyway, so when that's the case it will force us to remove the explicit things rather than leaving ... evrywhere.


---

Comment by jpflori created at 2013-12-25 21:05:09

Unfortunately I'm not sure I can do anything else as what I did as the warning only comes up the first time the BinaryStrings().encoding("") is used so it depends on the order the tests within the file will be run.

Maybe better reimplement bytes_to_long and long_to_bytes directly.


---

Comment by vbraun created at 2013-12-25 21:06:04

The order of doctests is top to bottom, isn't it?


---

Comment by git created at 2013-12-25 21:19:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2013-12-25 21:21:03

I've replaced the pycrypto functions by plain python funcitons which seem to be adequate for our use.


---

Comment by vbraun created at 2013-12-26 03:05:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-26 03:05:27

lgtm


---

Comment by vbraun created at 2013-12-26 14:49:53

Resolution: fixed
