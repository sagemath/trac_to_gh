# Issue 14650: Update pycrypto to 2.6.0

archive/issues_014650.json:
```json
{
    "body": "Assignee: jdemeyer\n\nWe ship 2.1.0.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14854\n\n",
    "created_at": "2013-07-04T20:51:24Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Update pycrypto to 2.6.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14650",
    "user": "jpflori"
}
```
Assignee: jdemeyer

We ship 2.1.0.

Issue created by migration from https://trac.sagemath.org/ticket/14854





---

archive/issue_comments_186487.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg pycrypto\".",
    "created_at": "2013-07-04T20:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186487",
    "user": "jpflori"
}
```

Changing keywords from "" to "spkg pycrypto".



---

archive/issue_comments_186488.json:
```json
{
    "body": "This would be a good time to cleanup spkg scripts.",
    "created_at": "2013-07-04T20:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186488",
    "user": "jpflori"
}
```

This would be a good time to cleanup spkg scripts.



---

archive/issue_comments_186489.json:
```json
{
    "body": "Trivial update on top of #12399.\n----\nNew commits:",
    "created_at": "2013-12-25T17:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186489",
    "user": "jpflori"
}
```

Trivial update on top of #12399.
----
New commits:



---

archive/issue_comments_186490.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-25T17:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186490",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_186491.json:
```json
{
    "body": "This was in #15531 but I'm pretty sure it applies here just as well:\n\n```\nsage -t --long src/sage/crypto/block_cipher/miniaes.py  # 1 doctest failed\nsage -t --long src/sage/crypto/block_cipher/sdes.py  # 1 doctest failed\nsage -t --long src/sage/crypto/classical_cipher.py  # 1 doctest failed\nsage -t --long src/sage/crypto/stream_cipher.py  # 1 doctest failed\nsage -t --long src/sage/crypto/util.py  # 1 doctest failed\nsage -t --long src/sage/crypto/public_key/blum_goldwasser.py  # 1 doctest failed\nsage -t --long src/sage/monoids/string_monoid.py  # 1 doctest failed\nsage -t --long src/sage/monoids/string_monoid_element.py  # 1 doctest failed\n```\n",
    "created_at": "2013-12-25T17:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186491",
    "user": "vbraun"
}
```

This was in #15531 but I'm pretty sure it applies here just as well:

```
sage -t --long src/sage/crypto/block_cipher/miniaes.py  # 1 doctest failed
sage -t --long src/sage/crypto/block_cipher/sdes.py  # 1 doctest failed
sage -t --long src/sage/crypto/classical_cipher.py  # 1 doctest failed
sage -t --long src/sage/crypto/stream_cipher.py  # 1 doctest failed
sage -t --long src/sage/crypto/util.py  # 1 doctest failed
sage -t --long src/sage/crypto/public_key/blum_goldwasser.py  # 1 doctest failed
sage -t --long src/sage/monoids/string_monoid.py  # 1 doctest failed
sage -t --long src/sage/monoids/string_monoid_element.py  # 1 doctest failed
```




---

archive/issue_comments_186492.json:
```json
{
    "body": "Oops, I'll have a look at it.",
    "created_at": "2013-12-25T17:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186492",
    "user": "jpflori"
}
```

Oops, I'll have a look at it.



---

archive/issue_comments_186493.json:
```json
{
    "body": "The errors are because pycrpto wants a secure (hum, let's say more side channel attacks resistant) implem of modular exponentiation or issues a warning.\nIt's available as mpz_powm_sec from recent GMP releases, but MPIR does not supply that.\n(Also note that wiith FLINT 2.4 we should be able to build all of Sage IIRC on top of gmp, time for a new spkg?)\nSo we should just ignore the warnings (or add them to the doctests but would fail with Sage on top of GMP).\nAnyway, we don't really care within Sage, at least that's my point of view, nobody would or should use Sage to do real crypto.",
    "created_at": "2013-12-25T18:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186493",
    "user": "jpflori"
}
```

The errors are because pycrpto wants a secure (hum, let's say more side channel attacks resistant) implem of modular exponentiation or issues a warning.
It's available as mpz_powm_sec from recent GMP releases, but MPIR does not supply that.
(Also note that wiith FLINT 2.4 we should be able to build all of Sage IIRC on top of gmp, time for a new spkg?)
So we should just ignore the warnings (or add them to the doctests but would fail with Sage on top of GMP).
Anyway, we don't really care within Sage, at least that's my point of view, nobody would or should use Sage to do real crypto.



---

archive/issue_comments_186494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-25T19:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186494",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186495.json:
```json
{
    "body": "The solution I've implemented is to filter pycrypto warnings in the warnings module.\nFeel free to say it is a bad solution and we should rather modify the tests, or move the piece of code I've added somewhere else (maybe it really slows down Sage startup, I don't know).",
    "created_at": "2013-12-25T19:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186495",
    "user": "jpflori"
}
```

The solution I've implemented is to filter pycrypto warnings in the warnings module.
Feel free to say it is a bad solution and we should rather modify the tests, or move the piece of code I've added somewhere else (maybe it really slows down Sage startup, I don't know).



---

archive/issue_comments_186496.json:
```json
{
    "body": "On a different topic, the only funciton actually used is in the monoids files, and that's only the byte_to_long function, so maybe we should implement this ourselves.\nI don't suggest to remove the pycrypto pkg though.",
    "created_at": "2013-12-25T19:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186496",
    "user": "jpflori"
}
```

On a different topic, the only funciton actually used is in the monoids files, and that's only the byte_to_long function, so maybe we should implement this ourselves.
I don't suggest to remove the pycrypto pkg though.



---

archive/issue_comments_186497.json:
```json
{
    "body": "I'd rather modify the tests and preserve the warning...",
    "created_at": "2013-12-25T19:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186497",
    "user": "vbraun"
}
```

I'd rather modify the tests and preserve the warning...



---

archive/issue_comments_186498.json:
```json
{
    "body": "Should we explicitely match the warning or filter it with \"...\"?",
    "created_at": "2013-12-25T20:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186498",
    "user": "jpflori"
}
```

Should we explicitely match the warning or filter it with "..."?



---

archive/issue_comments_186499.json:
```json
{
    "body": "Explicit is better than implicit (one of Python's credos), but then I don't care that much ;-)",
    "created_at": "2013-12-25T20:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186499",
    "user": "vbraun"
}
```

Explicit is better than implicit (one of Python's credos), but then I don't care that much ;-)



---

archive/issue_comments_186500.json:
```json
{
    "body": "Let's go for explicit. As I said, I think we should get rid of the pycrypto use in the monoid stuff anyway, so when that's the case it will force us to remove the explicit things rather than leaving ... evrywhere.",
    "created_at": "2013-12-25T20:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186500",
    "user": "jpflori"
}
```

Let's go for explicit. As I said, I think we should get rid of the pycrypto use in the monoid stuff anyway, so when that's the case it will force us to remove the explicit things rather than leaving ... evrywhere.



---

archive/issue_comments_186501.json:
```json
{
    "body": "Unfortunately I'm not sure I can do anything else as what I did as the warning only comes up the first time the BinaryStrings().encoding(\"\") is used so it depends on the order the tests within the file will be run.\n\nMaybe better reimplement bytes_to_long and long_to_bytes directly.",
    "created_at": "2013-12-25T21:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186501",
    "user": "jpflori"
}
```

Unfortunately I'm not sure I can do anything else as what I did as the warning only comes up the first time the BinaryStrings().encoding("") is used so it depends on the order the tests within the file will be run.

Maybe better reimplement bytes_to_long and long_to_bytes directly.



---

archive/issue_comments_186502.json:
```json
{
    "body": "The order of doctests is top to bottom, isn't it?",
    "created_at": "2013-12-25T21:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186502",
    "user": "vbraun"
}
```

The order of doctests is top to bottom, isn't it?



---

archive/issue_comments_186503.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-25T21:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186503",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186504.json:
```json
{
    "body": "I've replaced the pycrypto functions by plain python funcitons which seem to be adequate for our use.",
    "created_at": "2013-12-25T21:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186504",
    "user": "jpflori"
}
```

I've replaced the pycrypto functions by plain python funcitons which seem to be adequate for our use.



---

archive/issue_comments_186505.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-26T03:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186505",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_186506.json:
```json
{
    "body": "lgtm",
    "created_at": "2013-12-26T03:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186506",
    "user": "vbraun"
}
```

lgtm



---

archive/issue_comments_186507.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-26T14:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14650#issuecomment-186507",
    "user": "vbraun"
}
```

Resolution: fixed
