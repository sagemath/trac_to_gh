# Issue 14129: singular-3-1-6 is out

Issue created by migration from Trac.

Original creator: Snark

Original creation time: 2013-03-22 07:54:49

Assignee: tbd

CC:  jpflori

Sage should probably upgrade to this version ; it won't be painless though, since my experiments show that what in the changelog is lightly documented as "interface to iiMake_proc changed" (in the "Internal changes" section) -- impacts sage.

To be more precise, in sage/libs/singular/function.pyx, there is the following code:


```
    cdef leftv* handle_call(self, Converter argument_list, ring *_ring=NULL):
        if _ring != currRing: rChangeCurrRing(_ring)
        return iiMake_proc(self.proc_idhdl, NULL, argument_list.args)
```


but the new api for iiMake_proc is:


```
BOOLEAN iiMake_proc(idhdl pn, package pack, sleftv* sl);
```



---

Comment by leif created at 2013-03-22 13:03:00

Changing keywords from "" to "spkg".


---

Comment by leif created at 2013-03-22 13:22:58

The patch from #14295 would have to get updated as well (as there's now one more instance of calling `floor()` with an `int`; they also added some _superfluous_ casts, so the patch probably wouldn't apply anyway).


---

Comment by Snark created at 2013-03-22 14:33:53

Wasn't that patch already updated before you submitted it on upstream's trac?


---

Comment by leif created at 2013-03-22 15:11:03

Replying to [comment:3 Snark]:
> Wasn't that patch already updated before you submitted it on upstream's trac?

Pardon?

(I haven't submitted _a patch_ upstream, but only a [bug report](http://www.singular.uni-kl.de:8002/trac/ticket/479).  The patch from #14295 is of course against 3-1-5, our current version, not 3-1-6.)


---

Comment by Snark created at 2013-03-22 15:23:54

Oh, sorry, indeed.


---

Comment by burcin created at 2013-05-29 10:59:34

Changing priority from minor to major.


---

Comment by burcin created at 2013-05-29 10:59:34

Changing type from enhancement to defect.


---

Comment by burcin created at 2013-05-29 10:59:34

I'm modifying the ticket priority since it fixes some problems with multivariate polynomial factorization (#14658).


---

Comment by leif created at 2013-05-30 17:10:17

Replying to [comment:7 burcin]:
> I'm modifying the ticket priority since it fixes some problems with multivariate polynomial factorization (#14658).

Upgrading Singular is still (hopefully) an enhancement, not a defect.  (Unless you change the ticket's subject...)


---

Comment by leif created at 2013-06-13 15:11:01

Just to make you aware of #14737.


---

Comment by jpflori created at 2013-07-11 11:32:40

It would also be nice to backport the fix needed by NTL 6.0.0: see #14876 and https://groups.google.com/d/msg/libsingular-devel/aiMvEnN8qyg/cIFUsOXxK_MJ


---

Comment by jdemeyer created at 2013-08-26 20:41:53

I'm looking into this...


---

Attachment


---

Comment by burcin created at 2013-09-28 17:30:54

I uploaded a patch to take care of the API change.

New (preliminary) spkg adds two commits from singular git ([1](https://github.com/Singular/Sources/commit/ddb348e97a991972e5dfee690a66663ba0418f40) and [2](https://github.com/Singular/Sources/commit/561842a06ad4b44f3b85b28ac35e7946eaba9a30)) to add compatibility with NTL 6 (#14867) and some template instantiation errors from gcc 4.7. I didn't check if the NTL stuff works.


---

Comment by burcin created at 2013-09-28 17:30:54

Changing keywords from "spkg" to "spkg, sd53".


---

Comment by jpflori created at 2013-10-01 12:06:37

It seems some doc in the patches section needs updating, e.g. the line about cygwin-makefile should be deleted.

We could also trigger FLINT support on as Sage now ships FLINT 2.3.


---

Comment by jmantysalo created at 2013-10-09 10:16:36

I was not able to compile this. After putting in http://www.singular.uni-kl.de:8002/trac/ticket/499 it compiled. However, then Sage crashes at boot and said ImportError: /home/jm58660/sage-5.12/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so: undefined symbol:         
_Z21nc_p_Minus_mm_Mult_qqP8spolyrecS0_S0_RiiS0_P9sip_sring


---

Comment by jmantysalo created at 2013-10-30 12:26:34

FYI: There is still bug in Singular 3.1.6. At least this one sometimes (say once for every five tries) fails to factorize:


```
(-4*c*d + 8*d^2 + 12*f^2 + 8*a)*(8*b*c - 12*c + 4*f)*(3*a*c + 3*b*c - 
3*a*d + 33*d^2 - 3*f)*(-4*a*b - 4*b*d + 140*d^2 - 4*d*f - 4*a)*(4*a*b - 
8*b*d - 12*d^2 - 12*c*f - 8)*(-21*b*c - 3*b*d - 222*d^2 - 6*d*f - 
39*f)*(16*a*d + 128*b*d - 2)*(8*b*c + 4*c^2 - 4*b*f + 12*f)*(4*a*b + 4*b*c 
- 2*a*f + 6*f^2 - 2*b)*(-48*b^2 + 8*c*d + 144*c)*(-3*b^2 + 4*c^2 - b*d + 
f^2 + 3*a)*(4*c^2 + 4*b*d - 4*d^2 + 12*a*f)
```


I have already reported this, and version 4.0 should contain correction.


---

Comment by burcin created at 2013-10-30 14:29:57

Replying to [comment:19 jmantysalo]:

> I have already reported this, and version 4.0 should contain correction.

Changing our libSingular interface to be compatible with version 4.0 is a major effort. We should backport the fix or find out the corresponding patch in the Singular master branch and add it to the spkg.

Jori, I haven't seen any responses to the email you sent to `singular`@`mathematik.uni-kl.de`. Do you have the commit id for the fix by any chance?


---

Comment by jmantysalo created at 2013-10-30 15:51:47

Replying to [comment:20 burcin]:

> Jori, I haven't seen any responses to the email you sent to `singular`@`mathematik.uni-kl.de`. Do you have the commit id for the fix by any chance?

I have received answers from Martin Lee. Three weeks ago he wrote "I hope that we will release a new version of Singular in the next weeks". Unfortunately I don't have id nor code; I don't know if fix for this is released at all, Martin just said that this is easy to fix.


---

Comment by Snark created at 2013-10-30 15:57:43

Changing the libSingular interface might be a major effort, but backporting fixes from upstream is probably not a minor effort either... the best spkg is a "./configure && make && make install"!


---

Comment by jpflori created at 2013-10-30 16:40:17

Is there any reason not to update to 3-1-6 (and this ticket is still in the "new" status)?
Unless 3-1-7 gets really released in the next few days?
Ok there are bugs in Singular but they were already here and should be dealt with other tickets.
Stucking with the current version we have prevent other packages to be updated (at least NTL).


---

Comment by jpflori created at 2013-10-30 16:41:57

Hum, http://trac.sagemath.org/ticket/14333#comment:18 might need some investigation/work...


---

Comment by burcin created at 2013-10-30 16:43:59

Replying to [comment:24 jpflori]:
> Hum, http://trac.sagemath.org/ticket/14333#comment:18 might need some investigation/work...

That is probably caused by running Sage without rebuilding the library. `sage -b` should fix it.


---

Comment by jpflori created at 2013-12-23 16:03:06

It seems 3-1-7 is not out yet, so any other reason not to put that to needs_review Burcin?


---

Comment by burcin created at 2013-12-23 19:14:46

Replying to [comment:26 jpflori]:
> It seems 3-1-7 is not out yet, so any other reason not to put that to needs_review Burcin?

I am switching to `needs_review`. Singular 4-0-0 was released on Friday. I don't know if they plan to make bug-fix releases on the 3-1 series any more.

As I wrote before, it would be a major effort to port the libsingular interface to 4-0-0. I don't have time to do that in the near future.


---

Comment by burcin created at 2013-12-23 19:14:46

Changing status from new to needs_review.


---

Comment by jpflori created at 2013-12-23 19:19:51

Replying to [comment:27 burcin]:
> Replying to [comment:26 jpflori]:
> > It seems 3-1-7 is not out yet, so any other reason not to put that to needs_review Burcin?
> 
> I am switching to `needs_review`. Singular 4-0-0 was released on Friday. I don't know if they plan to make bug-fix releases on the 3-1 series any more.
> 
Ok thanks for the details.
i may be dumb but once more I did not find anything on the singular website (or at least the first thing that Google pointed at) about 4-0-0.
Note that there is indeed something here:
* http://www.mathematik.uni-kl.de/ftp/pub/Math/Singular/SOURCES/
Is there another hidden channel where annoucements are made?
> As I wrote before, it would be a major effort to port the libsingular interface to 4-0-0. I don't have time to do that in the near future.
Ok, so let's go for the 3-1-x upgrade.
I'll port the latest spkg to the new layout.


---

Comment by jpflori created at 2013-12-23 23:53:38

I'm ok with Burcin changes: it's mostly patches cleanup, integration of a few backported patches and modification for the new API as documented in the ticket description.
I also removed the description of old patches which was still there.

If someone could check I did not screw up the new layout transition I guess it can go in.
(Note that the version should be 3-1-6 but the new scripts don't support it when extraction version number, so as was done for 3-1-5, I put 3.1.6 everywhere.)
----
New commits:


---

Comment by fbissey created at 2013-12-30 09:54:55

Looks OK to me, we should get it in.


---

Comment by fbissey created at 2013-12-30 09:54:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-01 15:16:57

Resolution: fixed
