# Issue 14390: Make dot2tex work with matplotlib 1.2.x (as well as older versions)

archive/issues_014390.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: dot2tex spkg pyparsing\n\nSince sage-5.10.beta2 there is a problem with the detection of dot2tex. Even with dot2tex installed  via\n\n```\n    sage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-2.spkg\n```\nit is not detected any longer:\n\n```\n    sage: import dot2tex\n    ...\n    ImportError: No module named pyparsing\n```\nThis is crucial though since in combinatorics we heavily rely on being able to draw pictures:\n\n```\n    sage: B = CrystalOfTableaux(['A',2],shape=[1])\n    sage: view(B)\n    dot2tex not available.  Install after running 'sage -sh'\n```\n\ndot2tex indeed needs pyparsing. And pyparsing used to ship with\nmatplotlib, but apparently the new version of matplotlib does not\ninclude it anymore. So one need to install it somehow.\n\nComment by Paul-Olivier: It should be pyparsing 1.5?.x and not 2.x as that's only in python 3.\n\n---\n\n**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg)\n\n**md5sum:** `d096c3eec2a2f3bdd74a3e31b5c6872d  dot2tex-2.8.7.p2.spkg`\n\n### dot2tex-2.8.7.p2 (Leif Leonhardy, May 20th 2013)\n* #14594: Make dot2tex work with matplotlib 1.2.x (as well as older versions)\n  Update `patches/use-matplotlib-pyparsing.patch` to either import\n  `matplotlib.pyparsing` or `matplotlib.pyparsing_py2`.\n* Clean up `spkg-install` and `spkg-check`.\n  Apply patches from within `src/` (still with `-p1`).\n  Let `spkg-check` exit with an error if *any* of the tests failed, not just\n  the last one.\n* Update / fix `SPKG.txt`, also adding some entries in standard format for\n  previous (now tagged) spkg versions.\n* Add patch to `tests/test_comparedotparsing.py` skipping comparisons to\n  non-existent (i.e., missing) reference files.\n* Add patch to `tests/test_buildexamples.py` fixing the build order, since\n  otherwise `graphofgraphs.tex`, which includes the output of other examples,\n  fails to build.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14594\n\n",
    "closed_at": "2013-05-28T08:25:10Z",
    "created_at": "2013-05-15T16:30:14Z",
    "labels": [
        "component: packages: optional",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Make dot2tex work with matplotlib 1.2.x (as well as older versions)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14390",
    "user": "https://github.com/anneschilling"
}
```
Assignee: sage-combinat

CC:  sage-combinat

Keywords: dot2tex spkg pyparsing

Since sage-5.10.beta2 there is a problem with the detection of dot2tex. Even with dot2tex installed  via

```
    sage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-2.spkg
```
it is not detected any longer:

```
    sage: import dot2tex
    ...
    ImportError: No module named pyparsing
```
This is crucial though since in combinatorics we heavily rely on being able to draw pictures:

```
    sage: B = CrystalOfTableaux(['A',2],shape=[1])
    sage: view(B)
    dot2tex not available.  Install after running 'sage -sh'
```

dot2tex indeed needs pyparsing. And pyparsing used to ship with
matplotlib, but apparently the new version of matplotlib does not
include it anymore. So one need to install it somehow.

Comment by Paul-Olivier: It should be pyparsing 1.5?.x and not 2.x as that's only in python 3.

---

**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg)

**md5sum:** `d096c3eec2a2f3bdd74a3e31b5c6872d  dot2tex-2.8.7.p2.spkg`

### dot2tex-2.8.7.p2 (Leif Leonhardy, May 20th 2013)
* #14594: Make dot2tex work with matplotlib 1.2.x (as well as older versions)
  Update `patches/use-matplotlib-pyparsing.patch` to either import
  `matplotlib.pyparsing` or `matplotlib.pyparsing_py2`.
* Clean up `spkg-install` and `spkg-check`.
  Apply patches from within `src/` (still with `-p1`).
  Let `spkg-check` exit with an error if *any* of the tests failed, not just
  the last one.
* Update / fix `SPKG.txt`, also adding some entries in standard format for
  previous (now tagged) spkg versions.
* Add patch to `tests/test_comparedotparsing.py` skipping comparisons to
  non-existent (i.e., missing) reference files.
* Add patch to `tests/test_buildexamples.py` fixing the build order, since
  otherwise `graphofgraphs.tex`, which includes the output of other examples,
  fails to build.


Issue created by migration from https://trac.sagemath.org/ticket/14594





---

archive/issue_comments_181560.json:
```json
{
    "body": "Some things I've tried:\n\n- installing pyparsing on my system directly (on ubuntu)\n- installing pyparsing 1.5.5 using `sage -sh` as:\n  {{{\n  easy_install http://cheeseshop.python.org/packages/source/p/pyparsing/pyparsing-1.5.5.tar.gz\n  }}}\n  I also tried `easy_install pyparsing` but that just returned an error (likely because of it being python 3).\n\nI'm guessing we will need to make it a spkg?\n\nBest,\n\nTravis\n\nPS - I haven't tried restarting my system after trying these, but I don't think anything will change. If it does work, I'll post, otherwise it didn't.",
    "created_at": "2013-05-17T07:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181560",
    "user": "https://github.com/tscrim"
}
```

Some things I've tried:

- installing pyparsing on my system directly (on ubuntu)
- installing pyparsing 1.5.5 using `sage -sh` as:
  {{{
  easy_install http://cheeseshop.python.org/packages/source/p/pyparsing/pyparsing-1.5.5.tar.gz
  }}}
  I also tried `easy_install pyparsing` but that just returned an error (likely because of it being python 3).

I'm guessing we will need to make it a spkg?

Best,

Travis

PS - I haven't tried restarting my system after trying these, but I don't think anything will change. If it does work, I'll post, otherwise it didn't.



---

archive/issue_comments_181561.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2013-05-17T19:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181561",
    "user": "https://github.com/tscrim"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_181562.json:
```json
{
    "body": "I think this should be a blocker since none of the crystal pictures/latex work anymore.",
    "created_at": "2013-05-17T19:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181562",
    "user": "https://github.com/tscrim"
}
```

I think this should be a blocker since none of the crystal pictures/latex work anymore.



---

archive/issue_comments_181563.json:
```json
{
    "body": "Replying to [ticket:14594 aschilling]:\n> {{{\n>     ImportError: No module named pyparsing\n> }}}\n> dot2tex indeed needs pyparsing. And pyparsing used to ship with\n> matplotlib, but apparently the new version of matplotlib does not\n> include it anymore.\n\n\nMPL now ships with `pyparsing_py2` and `pyparsing_py3`, so apparently simply `dot2tex`'s import statement has to be changed.\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: from matplotlib import pyparsing_py2\nsage: \n```",
    "created_at": "2013-05-17T23:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181563",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:14594 aschilling]:
> {{{
>     ImportError: No module named pyparsing
> }}}
> dot2tex indeed needs pyparsing. And pyparsing used to ship with
> matplotlib, but apparently the new version of matplotlib does not
> include it anymore.


MPL now ships with `pyparsing_py2` and `pyparsing_py3`, so apparently simply `dot2tex`'s import statement has to be changed.

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: from matplotlib import pyparsing_py2
sage: 
```



---

archive/issue_comments_181564.json:
```json
{
    "body": "FWIW, installing `dot2tex` with `SAGE_CHECK=yes` *does* fail, and without just succeeds because of\n\n```\n.../sage-5.10.beta3/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'install_requires'\n  warnings.warn(msg)\nrunning install\nrunning build\nrunning build_py\nrunning build_scripts\nrunning install_lib\n...\n```\ni.e.,\n\n```python\n      install_requires = ['matplotlib.pyparsing'],\n```\nin (the patched) `setup.py` simply doesn't work.",
    "created_at": "2013-05-18T00:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181564",
    "user": "https://github.com/nexttime"
}
```

FWIW, installing `dot2tex` with `SAGE_CHECK=yes` *does* fail, and without just succeeds because of

```
.../sage-5.10.beta3/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'install_requires'
  warnings.warn(msg)
running install
running build
running build_py
running build_scripts
running install_lib
...
```
i.e.,

```python
      install_requires = ['matplotlib.pyparsing'],
```
in (the patched) `setup.py` simply doesn't work.



---

archive/issue_comments_181565.json:
```json
{
    "body": "Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg\n\nWorks for me, modulo not all tests passing (`SAGE_CHECK=yes`, but I've also changed `spkg-check` to fail on *any* test suite error).\n\nSince the original spkg doesn't conform to the usual conventions (naming, style of `SPKG.txt`, `src/` not in `.hgignore` and hence all upstream files under revision control as well), I haven't updated `SPKG.txt`, nor committed any changes.  (Diff is attached.)",
    "created_at": "2013-05-18T02:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181565",
    "user": "https://github.com/nexttime"
}
```

Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg

Works for me, modulo not all tests passing (`SAGE_CHECK=yes`, but I've also changed `spkg-check` to fail on *any* test suite error).

Since the original spkg doesn't conform to the usual conventions (naming, style of `SPKG.txt`, `src/` not in `.hgignore` and hence all upstream files under revision control as well), I haven't updated `SPKG.txt`, nor committed any changes.  (Diff is attached.)



---

archive/issue_comments_181566.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-18T02:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181566",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_181567.json:
```json
{
    "body": "New version of `patches/use-matplotlib-pyparsing.patch`.  For reference / review only (as the spkg diff looks pretty ugly).",
    "created_at": "2013-05-18T03:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181567",
    "user": "https://github.com/nexttime"
}
```

New version of `patches/use-matplotlib-pyparsing.patch`.  For reference / review only (as the spkg diff looks pretty ugly).



---

archive/issue_comments_181568.json:
```json
{
    "body": "Attachment [use-matplotlib-pyparsing.patch](tarball://root/attachments/some-uuid/ticket14594/use-matplotlib-pyparsing.patch) by @tscrim created at 2013-05-19 02:19:01\n\nHey Leif,\n\nThank you for fixing this. That works for me as well and all the tests in the `combinat/crystals` folder. I'll run all tests later tonight.\n\nThanks,\n\nTravis",
    "created_at": "2013-05-19T02:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181568",
    "user": "https://github.com/tscrim"
}
```

Attachment [use-matplotlib-pyparsing.patch](tarball://root/attachments/some-uuid/ticket14594/use-matplotlib-pyparsing.patch) by @tscrim created at 2013-05-19 02:19:01

Hey Leif,

Thank you for fixing this. That works for me as well and all the tests in the `combinat/crystals` folder. I'll run all tests later tonight.

Thanks,

Travis



---

archive/issue_comments_181569.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2013-05-19T08:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181569",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_181570.json:
```json
{
    "body": "What exactly needs review? Please update the ticket description.",
    "created_at": "2013-05-19T08:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181570",
    "user": "https://github.com/jdemeyer"
}
```

What exactly needs review? Please update the ticket description.



---

archive/issue_comments_181571.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> What exactly needs review? Please update the ticket description.\n\n\nJust that the new (optional) dot2tex spkg works with both the old and the new matplotlib spkg (in Sage 5.10.beta0 and later), but see [comment:6 my note above], i.e., it's not yet ready to get \"merged\".",
    "created_at": "2013-05-19T09:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181571",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:10 jdemeyer]:
> What exactly needs review? Please update the ticket description.


Just that the new (optional) dot2tex spkg works with both the old and the new matplotlib spkg (in Sage 5.10.beta0 and later), but see [comment:6 my note above], i.e., it's not yet ready to get "merged".



---

archive/issue_comments_181572.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-19T10:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181572",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_181573.json:
```json
{
    "body": "Changing component from combinatorics to packages: optional.",
    "created_at": "2013-05-19T10:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181573",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from combinatorics to packages: optional.



---

archive/issue_comments_181574.json:
```json
{
    "body": "I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.\n\nHaven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.\n\nIt probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.\n\nP.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.\n\n\n\n\nFeel free to forward this to sage-combinat-devel ... :P",
    "created_at": "2013-05-19T18:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181574",
    "user": "https://github.com/nexttime"
}
```

I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.

Haven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.

It probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.

P.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.




Feel free to forward this to sage-combinat-devel ... :P



---

archive/issue_comments_181575.json:
```json
{
    "body": "Changing keywords from \"dot2tex\" to \"dot2tex spkg pyparsing\".",
    "created_at": "2013-05-19T18:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181575",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "dot2tex" to "dot2tex spkg pyparsing".



---

archive/issue_comments_181576.json:
```json
{
    "body": "Replying to [comment:4 leif]:\n> MPL now ships with `pyparsing_py2` and `pyparsing_py3`, so apparently simply `dot2tex`'s import statement has to be changed.\n\n\nI had actually made a search in the new matplotlib, but looking for\npyparsing.py so I missed it ... Well, that's very good news! Thanks\nso much for investigating and for working on the spkg!\n\nCheers,\n                           Nicolas",
    "created_at": "2013-05-19T21:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181576",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:4 leif]:
> MPL now ships with `pyparsing_py2` and `pyparsing_py3`, so apparently simply `dot2tex`'s import statement has to be changed.


I had actually made a search in the new matplotlib, but looking for
pyparsing.py so I missed it ... Well, that's very good news! Thanks
so much for investigating and for working on the spkg!

Cheers,
                           Nicolas



---

archive/issue_comments_181577.json:
```json
{
    "body": "Replying to [comment:6 leif]:\n> Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg\n\n\nJust checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?\nOtherwise we should merge the two spkgs.\n\nBy the way: what about using the occasion to make dot2tex a standard package? After all, it's very small, it's used quite extensively, and that would be a good step toward simplifying the installation instructions for graph drawing with graphviz.\n\nCheers,\n                                        Nicolas",
    "created_at": "2013-05-19T22:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181577",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:6 leif]:
> Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg


Just checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?
Otherwise we should merge the two spkgs.

By the way: what about using the occasion to make dot2tex a standard package? After all, it's very small, it's used quite extensively, and that would be a good step toward simplifying the installation instructions for graph drawing with graphviz.

Cheers,
                                        Nicolas



---

archive/issue_comments_181578.json:
```json
{
    "body": "Replying to [comment:14 leif]:\n> I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.\n\n\n+1\n\n> Haven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.\n\n\nI haven't looked at them recently; is there anything beyond graphviz and latex's preview package?\nMaybe the tkz-berge and friend style files?\n\nFor those, it would actually be good to ship them with the standard Sage installation, for they are tiny and required for tikz graph drawing without dot2tex, and yet a pain to install by hand. But that might be another ticket.\n\nWhat do you think?\n\n> It probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.\n> \n> P.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.\n\n\nBoth options are fine for me, with a small preference for the first\none which does not require touching the upstream sources.\n\nCheers,\n                                     Nicolas",
    "created_at": "2013-05-19T22:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181578",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:14 leif]:
> I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.


+1

> Haven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.


I haven't looked at them recently; is there anything beyond graphviz and latex's preview package?
Maybe the tkz-berge and friend style files?

For those, it would actually be good to ship them with the standard Sage installation, for they are tiny and required for tikz graph drawing without dot2tex, and yet a pain to install by hand. But that might be another ticket.

What do you think?

> It probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.
> 
> P.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.


Both options are fine for me, with a small preference for the first
one which does not require touching the upstream sources.

Cheers,
                                     Nicolas



---

archive/issue_comments_181579.json:
```json
{
    "body": "Replying to [comment:17 nthiery]:\n> Replying to [comment:6 leif]:\n> > Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg\n\n> \n> Just checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?\n\n\nNope, at least I'm not sure; #7004 mentions some 2.8.7-dev spkg (ticket \"merged\" long time ago), but I took the one from the optional spkgs repository:\n\n[http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)\n\n(I wasn't aware of other pending(?) changes.)\n\n\n\n\n> Otherwise we should merge the two spkgs.\n\n\nProbably...  I just created a new clean one (named `dot2tex-2.8.7.p1.spkg`) from the above, which doesn't include my changes [except for `.hgignore`], where I removed all traces of upstream from the Mercurial history, and added tags for a `2.8.7.p0` and the `.p1`.  `src/` is (still) **vanilla** upstream version 2.8.7 (released \"stable\", no svn version).\n\nI was going to add my changes (and some clean-up of `SPKG.txt`) into a `.p2` based on that `.p1`.\n\nI can of course add further changes later on top of that, probably into a `.p3`, if you just tell me what these changes are ...  (Portions from upstream's devel version, which we could also add as patches, or just Sage-specific patches, changes to `spkg-{install,check}`?)\n\n\n\n\n> By the way: what about using the occasion to make dot2tex a standard package? After all, it's very small, it's used quite extensively, and that would be a good step toward simplifying the installation instructions for graph drawing with graphviz.\n\n\nI thought it was (or had to be) optional because of its MIT license, but IANAL.\n\nOtherwise my new one with `src/` in `.hgignore` is only a fraction of the size of the previous one: :-D\n\n```\n3,1M\t        dot2tex-2.8.7-2.spkg\n944K        dot2tex-2.8.7.p1.spkg\n```",
    "created_at": "2013-05-19T22:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181579",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:17 nthiery]:
> Replying to [comment:6 leif]:
> > Tentative fixed spkg:  http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7-2.p1.spkg

> 
> Just checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?


Nope, at least I'm not sure; #7004 mentions some 2.8.7-dev spkg (ticket "merged" long time ago), but I took the one from the optional spkgs repository:

[http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)

(I wasn't aware of other pending(?) changes.)




> Otherwise we should merge the two spkgs.


Probably...  I just created a new clean one (named `dot2tex-2.8.7.p1.spkg`) from the above, which doesn't include my changes [except for `.hgignore`], where I removed all traces of upstream from the Mercurial history, and added tags for a `2.8.7.p0` and the `.p1`.  `src/` is (still) **vanilla** upstream version 2.8.7 (released "stable", no svn version).

I was going to add my changes (and some clean-up of `SPKG.txt`) into a `.p2` based on that `.p1`.

I can of course add further changes later on top of that, probably into a `.p3`, if you just tell me what these changes are ...  (Portions from upstream's devel version, which we could also add as patches, or just Sage-specific patches, changes to `spkg-{install,check}`?)




> By the way: what about using the occasion to make dot2tex a standard package? After all, it's very small, it's used quite extensively, and that would be a good step toward simplifying the installation instructions for graph drawing with graphviz.


I thought it was (or had to be) optional because of its MIT license, but IANAL.

Otherwise my new one with `src/` in `.hgignore` is only a fraction of the size of the previous one: :-D

```
3,1M	        dot2tex-2.8.7-2.spkg
944K        dot2tex-2.8.7.p1.spkg
```



---

archive/issue_comments_181580.json:
```json
{
    "body": "Replying to [comment:19 leif]:\n> Replying to [comment:17 nthiery]:\n> > Just checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?\n\n> \n> Nope, at least I'm not sure; #7004 mentions some 2.8.7-dev spkg (ticket \"merged\" long time ago), but I took the one from the optional spkgs repository:\n> \n> [http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)\n\n\nJust checked, I grabbed the former, if that matters...",
    "created_at": "2013-05-19T22:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181580",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:19 leif]:
> Replying to [comment:17 nthiery]:
> > Just checking: did you start from the latest spkg dot2tex-2.8.6.2 advertised on #7004 (see #13624)?

> 
> Nope, at least I'm not sure; #7004 mentions some 2.8.7-dev spkg (ticket "merged" long time ago), but I took the one from the optional spkgs repository:
> 
> [http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)


Just checked, I grabbed the former, if that matters...



---

archive/issue_comments_181581.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> > [http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)\n\n> \n> Just checked, I grabbed the former, if that matters...\n\n\nIt doesn't:\n\n```sh\n$ md5sum /home/nthiery/dot2tex-2.8.7-2.spkg /home/sagemath/www-files/packages/optional/dot2tex-2.8.7-2.spkg \n42bfb0deecb56386ef29e74235c947cf  /home/nthiery/dot2tex-2.8.7-2.spkg\n42bfb0deecb56386ef29e74235c947cf  /home/sagemath/www-files/packages/optional/dot2tex-2.8.7-2.spkg\n```\n\nBut now I see there's also the newer\n\n```\n-rw-r--r-- 1 nthiery nthiery 3783363 2013-04-02 07:16 /home/nthiery/dot2tex-2.8.7-dev.spkg\n```\n\nI'll take a look at that later ...",
    "created_at": "2013-05-19T22:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181581",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 leif]:
> > [http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg](http://sagemath.org/packages/optional/dot2tex-2.8.7-2.spkg) (or probably the one with the same name mentioned in the ticket's description, I don't recall.)

> 
> Just checked, I grabbed the former, if that matters...


It doesn't:

```sh
$ md5sum /home/nthiery/dot2tex-2.8.7-2.spkg /home/sagemath/www-files/packages/optional/dot2tex-2.8.7-2.spkg 
42bfb0deecb56386ef29e74235c947cf  /home/nthiery/dot2tex-2.8.7-2.spkg
42bfb0deecb56386ef29e74235c947cf  /home/sagemath/www-files/packages/optional/dot2tex-2.8.7-2.spkg
```

But now I see there's also the newer

```
-rw-r--r-- 1 nthiery nthiery 3783363 2013-04-02 07:16 /home/nthiery/dot2tex-2.8.7-dev.spkg
```

I'll take a look at that later ...



---

archive/issue_comments_181582.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> But now I see there's also the newer\n> \n> ```\n> -rw-r--r-- 1 nthiery nthiery 3783363 2013-04-02 07:16 /home/nthiery/dot2tex-2.8.7-dev.spkg\n> ```\n> \n> I'll take a look at that later ...\n\n\nI see:\n\n```\nchangeset:   9:829fa7be9e52\ntag:         tip\nuser:        Nicolas M. Thiery <nthiery@users.sf.net>\ndate:        Thu Apr 28 13:14:30 2011 -0400\nfiles:       SPKG.txt patches/fix-stdout-redirection.patch spkg-install\ndescription:\nRemoved now unneeded patches/fix-stdout-redirection.patch\n\n\nchangeset:   8:c3a62788e000\nuser:        Nicolas M. Thiery <nthiery@users.sf.net>\ndate:        Thu Apr 28 09:58:33 2011 -0400\nfiles:       SPKG.txt src/MANIFEST.in src/changelog.txt src/doc/img/dot2texiex1.png src/doc/img/dot2texiex2.png src/doc/pdf/balls.pdf src/doc/pdf/consistent.pdf src/doc/pdf/dot2texiex1.pdf src/doc/pdf/dot2texiex2.pdf src/doc/pdf/ex1comb.pdf src/doc/pdf/ex1gstyle.pdf src/doc/pdf/ex1huge.pdf src/doc/pdf/ex2.pdf src/doc/pdf/fsm1.pdf src/doc/pdf/lblstyle.pdf src/doc/pdf/nodewidth1.pdf src/doc/pdf/nodewidth2.pdf src/doc/pdf/pgfarrows.pdf src/doc/pdf/pgftikzsimple.pdf src/doc/pdf/preproc1a.pdf src/doc/pdf/preproc1b.pdf src/doc/pdf/pstarrows.pdf src/doc/pdf/texmode.pdf src/doc/pdf/texmodeb.pdf src/doc/pdf/tikzedgelabels.pdf src/doc/pdf/topaths1.pdf src/doc/pdf/valignmode0.pdf src/doc/pdf/valignmode1.pdf src/doc/pdf/valignmode2.pdf src/doc/pdf/valignmode3.pdf src/dot2tex/__init__.py src/dot2tex/dot2tex.py src/dot2tex/dotparsing.py src/readme.txt src/setup.py src/tests/test_dot2tex.py src/tests/test_dotparsing.py src/tests/test_graphparsing.py\ndescription:\nUpdated to dot2tex-2.8.7-dev\n\n\nchangeset:   7:dccc7b29ec0b\nuser:        Nicolas M. Thiery <nthiery@users.sf.net>\ndate:        Sat Apr 17 22:48:38 2010 +0200\nfiles:       SPKG.txt patches/fix-stdout-redirection.patch spkg-check spkg-install\ndescription:\nAdded patches/fix-stdout-redirection.patch and fixed partially spkg-check\n\n...\n```\n\nChangeset !#7 corresponds to the `dot2tex-2.8.7-2` spkg, so you mainly updated to some devel version, thereby removing a patch.",
    "created_at": "2013-05-19T23:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181582",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:21 leif]:
> But now I see there's also the newer
> 
> ```
> -rw-r--r-- 1 nthiery nthiery 3783363 2013-04-02 07:16 /home/nthiery/dot2tex-2.8.7-dev.spkg
> ```
> 
> I'll take a look at that later ...


I see:

```
changeset:   9:829fa7be9e52
tag:         tip
user:        Nicolas M. Thiery <nthiery@users.sf.net>
date:        Thu Apr 28 13:14:30 2011 -0400
files:       SPKG.txt patches/fix-stdout-redirection.patch spkg-install
description:
Removed now unneeded patches/fix-stdout-redirection.patch


changeset:   8:c3a62788e000
user:        Nicolas M. Thiery <nthiery@users.sf.net>
date:        Thu Apr 28 09:58:33 2011 -0400
files:       SPKG.txt src/MANIFEST.in src/changelog.txt src/doc/img/dot2texiex1.png src/doc/img/dot2texiex2.png src/doc/pdf/balls.pdf src/doc/pdf/consistent.pdf src/doc/pdf/dot2texiex1.pdf src/doc/pdf/dot2texiex2.pdf src/doc/pdf/ex1comb.pdf src/doc/pdf/ex1gstyle.pdf src/doc/pdf/ex1huge.pdf src/doc/pdf/ex2.pdf src/doc/pdf/fsm1.pdf src/doc/pdf/lblstyle.pdf src/doc/pdf/nodewidth1.pdf src/doc/pdf/nodewidth2.pdf src/doc/pdf/pgfarrows.pdf src/doc/pdf/pgftikzsimple.pdf src/doc/pdf/preproc1a.pdf src/doc/pdf/preproc1b.pdf src/doc/pdf/pstarrows.pdf src/doc/pdf/texmode.pdf src/doc/pdf/texmodeb.pdf src/doc/pdf/tikzedgelabels.pdf src/doc/pdf/topaths1.pdf src/doc/pdf/valignmode0.pdf src/doc/pdf/valignmode1.pdf src/doc/pdf/valignmode2.pdf src/doc/pdf/valignmode3.pdf src/dot2tex/__init__.py src/dot2tex/dot2tex.py src/dot2tex/dotparsing.py src/readme.txt src/setup.py src/tests/test_dot2tex.py src/tests/test_dotparsing.py src/tests/test_graphparsing.py
description:
Updated to dot2tex-2.8.7-dev


changeset:   7:dccc7b29ec0b
user:        Nicolas M. Thiery <nthiery@users.sf.net>
date:        Sat Apr 17 22:48:38 2010 +0200
files:       SPKG.txt patches/fix-stdout-redirection.patch spkg-check spkg-install
description:
Added patches/fix-stdout-redirection.patch and fixed partially spkg-check

...
```

Changeset !#7 corresponds to the `dot2tex-2.8.7-2` spkg, so you mainly updated to some devel version, thereby removing a patch.



---

archive/issue_comments_181583.json:
```json
{
    "body": "And now also found #14408 ... (for the `-dev` spkg)",
    "created_at": "2013-05-20T00:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181583",
    "user": "https://github.com/nexttime"
}
```

And now also found #14408 ... (for the `-dev` spkg)



---

archive/issue_comments_181584.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> Changeset !#7 corresponds to the `dot2tex-2.8.7-2` spkg, so you\n> mainly updated to some devel version, thereby removing a patch.\n\n\nYes indeed! The devel version also fixes the issue mentioned\nin #14408. You can grab the latest version from:\n\n\thttp://code.google.com/p/dot2tex/source/\n\nAgain, thanks so much for handling this! I'll be happy to review it.\n\nCheers,\n                                Nicolas",
    "created_at": "2013-05-20T01:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181584",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:22 leif]:
> Changeset !#7 corresponds to the `dot2tex-2.8.7-2` spkg, so you
> mainly updated to some devel version, thereby removing a patch.


Yes indeed! The devel version also fixes the issue mentioned
in #14408. You can grab the latest version from:

	http://code.google.com/p/dot2tex/source/

Again, thanks so much for handling this! I'll be happy to review it.

Cheers,
                                Nicolas



---

archive/issue_comments_181585.json:
```json
{
    "body": "Replying to [comment:18 nthiery]:\n> Replying to [comment:14 leif]:\n> > I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.\n\n> \n> +1\n> \n> > Haven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.\n\n> \n> I haven't looked at them recently; is there anything beyond graphviz and latex's preview package?\n> Maybe the tkz-berge and friend style files?\n\n\nAfter having installed `pdftk`, `spkg-check` still fails for me at least because of\n\n```\nIOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/current.dot'\nIOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/ports.dot'\nIOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/unicode1.dot'\n```\nwhich doesn't seem to be a regression ...  8-/\n\nThey're missing in the original 2.8.7-2 spkg as well as in upstream's 2.8.7 release tarball.  But perhaps *I'm* just missing something...\n\nDid anyone recently (or ever ;-) ) successfully install the spkg with `SAGE_CHECK=yes`?\n\n\n\n\n> > It probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.\n> > \n> > P.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.\n\n> \n> Both options are fine for me, with a small preference for the first\n> one which does not require touching the upstream sources.",
    "created_at": "2013-05-20T20:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181585",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:18 nthiery]:
> Replying to [comment:14 leif]:
> > I'd also like to get some feedback w.r.t. `spkg-check`;  it now (IMHO correctly) returns an error if *any* of the tests failed, while it previously only did if *the last* failed.

> 
> +1
> 
> > Haven't investigated, but it seems at least some of the tests (`src/tests/test_*`) have prerequisites not commonly installed, and presumably not necessary for (typical) use with Sage.

> 
> I haven't looked at them recently; is there anything beyond graphviz and latex's preview package?
> Maybe the tkz-berge and friend style files?


After having installed `pdftk`, `spkg-check` still fails for me at least because of

```
IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/current.dot'
IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/ports.dot'
IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/unicode1.dot'
```
which doesn't seem to be a regression ...  8-/

They're missing in the original 2.8.7-2 spkg as well as in upstream's 2.8.7 release tarball.  But perhaps *I'm* just missing something...

Did anyone recently (or ever ;-) ) successfully install the spkg with `SAGE_CHECK=yes`?




> > It probably makes sense to exclude these by simply changing the pattern, or explicitly listing only those reasonable for Sage's purposes.
> > 
> > P.S.:  Just noticed there are *only four* test files, so we may actually have to *modify* some of them instead of simply excluding them.

> 
> Both options are fine for me, with a small preference for the first
> one which does not require touching the upstream sources.



---

archive/issue_comments_181586.json:
```json
{
    "body": "Replying to [comment:25 leif]:\n> After having installed `pdftk`, `spkg-check` still fails for me at least because of\n> \n> ```\n> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/current.dot'\n> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/ports.dot'\n> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/unicode1.dot'\n> ```\n> which doesn't seem to be a regression ...  8-/\n> \n> They're missing in the original 2.8.7-2 spkg as well as in upstream's 2.8.7 release tarball.\n\n\nI didn't find any traces of those three files in the svn nor the Mercurial repo.\n\nSo we could patch out the last three tests in `tests/test_comparedotparsing.py`:\n\n```python\nclass DotparsingTest(unittest.TestCase):\n    def setUp(self):\n        if not os.path.exists(PNG_DIR):\n            os.mkdir(PNG_DIR)\n        if not os.path.exists(DOT_DIR):\n            os.mkdir(DOT_DIR)\n\n    def test_ids(self):\n        self.assertEqual(test_dotfile(\"ids.dot\"),1)\n    def test_multilines(self):\n        self.assertEqual(test_dotfile(\"multilines.dot\"),1)\n    def test_subgraphs(self):\n        self.assertEqual(test_dotfile(\"subgraphs.dot\"),1)\n    def test_quoting(self):\n        self.assertEqual(test_dotfile(\"quoting.dot\"),1)\n    def test_unicode1(self):\n        self.assertEqual(test_dotfile(\"unicode1.dot\"),1)\n    def test_current(self):\n        self.assertEqual(test_dotfile(\"current.dot\"),1)\n    def test_ports(self):\n        self.assertEqual(test_dotfile(\"ports.dot\"),1)\n```\n(Note that these tests are still present even in the latest versions; actually, the whole file hasn't changed at all since at least when the Mercurial repo was created.)\n\nOr *someone<sup>TM</sup>* would have to create the missing reference files...",
    "created_at": "2013-05-20T21:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181586",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:25 leif]:
> After having installed `pdftk`, `spkg-check` still fails for me at least because of
> 
> ```
> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/current.dot'
> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/ports.dot'
> IOError: [Errno 2] No such file or directory: 'testgraphs/parsetests/unicode1.dot'
> ```
> which doesn't seem to be a regression ...  8-/
> 
> They're missing in the original 2.8.7-2 spkg as well as in upstream's 2.8.7 release tarball.


I didn't find any traces of those three files in the svn nor the Mercurial repo.

So we could patch out the last three tests in `tests/test_comparedotparsing.py`:

```python
class DotparsingTest(unittest.TestCase):
    def setUp(self):
        if not os.path.exists(PNG_DIR):
            os.mkdir(PNG_DIR)
        if not os.path.exists(DOT_DIR):
            os.mkdir(DOT_DIR)

    def test_ids(self):
        self.assertEqual(test_dotfile("ids.dot"),1)
    def test_multilines(self):
        self.assertEqual(test_dotfile("multilines.dot"),1)
    def test_subgraphs(self):
        self.assertEqual(test_dotfile("subgraphs.dot"),1)
    def test_quoting(self):
        self.assertEqual(test_dotfile("quoting.dot"),1)
    def test_unicode1(self):
        self.assertEqual(test_dotfile("unicode1.dot"),1)
    def test_current(self):
        self.assertEqual(test_dotfile("current.dot"),1)
    def test_ports(self):
        self.assertEqual(test_dotfile("ports.dot"),1)
```
(Note that these tests are still present even in the latest versions; actually, the whole file hasn't changed at all since at least when the Mercurial repo was created.)

Or *someone<sup>TM</sup>* would have to create the missing reference files...



---

archive/issue_comments_181587.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2013-05-20T22:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181587",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_181588.json:
```json
{
    "body": "Another dumb thing:\n\n`tests/test_buildexamples.py` apparently fails just because the examples are built in the wrong order.\n\nThe generated `graphofgraphs.tex` includes a couple of PDFs built by other examples, but that fails in the first place.  (Rerunning it with the other temporary files in `tests/exrender/` still present works.) \n\nBesides that, `spkg-check` now succeeds for me (skipping the above-mentioned comparisons to non-existent reference files).",
    "created_at": "2013-05-21T01:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181588",
    "user": "https://github.com/nexttime"
}
```

Another dumb thing:

`tests/test_buildexamples.py` apparently fails just because the examples are built in the wrong order.

The generated `graphofgraphs.tex` includes a couple of PDFs built by other examples, but that fails in the first place.  (Rerunning it with the other temporary files in `tests/exrender/` still present works.) 

Besides that, `spkg-check` now succeeds for me (skipping the above-mentioned comparisons to non-existent reference files).



---

archive/issue_comments_181589.json:
```json
{
    "body": "It's kind of you to be investigating those failing tests, but we don't need them. So I would say: just report upstream and skip them.\n\nThanks!\n                               Nicolas",
    "created_at": "2013-05-21T01:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181589",
    "user": "https://github.com/nthiery"
}
```

It's kind of you to be investigating those failing tests, but we don't need them. So I would say: just report upstream and skip them.

Thanks!
                               Nicolas



---

archive/issue_comments_181590.json:
```json
{
    "body": "Doctesting the Sage library (5.10.beta3) with `sage -t --long --optional=dot2tex ...`, I get:\n\n```\n----------------------------------------------------------------------\nsage -t --long devel/sage/sage/combinat/rigged_configurations/kleber_tree.py  # 1 doctest failed\nsage -t --long devel/sage/sage/categories/crystals.py  # 2 doctests failed\nsage -t --long devel/sage/sage/graphs/digraph.py  # 1 doctest failed\nsage -t --long devel/sage/sage/graphs/generic_graph.py  # 43 doctests failed\nsage -t --long devel/sage/sage/graphs/graph.py  # 5 doctests failed\nsage -t --long devel/sage/sage/graphs/graph_latex.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\nMost of these presumably due to wrong tagging (`NameError: name 'foo' is not defined`).\n\nWith `--optional=dot2tex,sage` in contrast, only the following doctest error:\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/rigged_configurations/kleber_tree.py\", line 387, in sage.combinat.rigged_configurations.kleber_tree.KleberTree._latex_\nFailed example:\n    KT._latex_()   #optional - dot2tex\nExpected nothing\nGot:\n    '\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (Klebertreenodewithweight1+0+0andupwardsedgeroot0+1+0) at (13bp,82bp) [draw,draw=none] {$V_{\\\\omega_{1}}$};\\n  \\\\node (Klebertreenodewithweight0+2+0andupwardsedgeroot0+0+0) at (13bp,8bp) [draw,draw=none] {$V_{2\\\\omega_{2}}$};\\n  \\\\draw [black,->] (Klebertreenodewithweight1+0+0andupwardsedgeroot0+1+0) ..controls (13bp,63bp) and (13bp,42bp)  .. (Klebertreenodewithweight0+2+0andupwardsedgeroot0+0+0);\\n  \\\\pgfsetstrokecolor{black}\\n  \\\\draw (35bp,45bp) node {$\\\\left(0, 1, 0\\\\right)$};\\n%\\n\\\\end{tikzpicture}\\n'\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.combinat.rigged_configurations.kleber_tree.KleberTree._latex_\n```\n:-)\n\n\n\n\nIt seems there are no dot2tex-optional tests in the documentation (`*.rst`):\n\n```\nDoctesting 3 files.\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst\n    [0 tests, 0.00 s]\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst\n    [0 tests, 0.02 s]\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst\n    [0 tests, 0.03 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\nBut, ooops, just noticed they're tagged `# optional - dot2tex graphviz`...\n\nSame problem without adding `sage` to the `--optional` list:\n\n```\n----------------------------------------------------------------------\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst  # 2 doctests failed\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst  # 1 doctest failed\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst  # 2 doctests failed\n----------------------------------------------------------------------\n```\nAgain, with `--optional=dot2tex,graphviz,sage`:\n\n```\nDoctesting 3 files.\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst\n    [14 tests, 17.73 s]\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst\n    [97 tests, 22.79 s]\nsage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst\n    [116 tests, 45.62 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n... but I also get five pop-up windows showing `sage.pdf`! XD",
    "created_at": "2013-05-21T03:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181590",
    "user": "https://github.com/nexttime"
}
```

Doctesting the Sage library (5.10.beta3) with `sage -t --long --optional=dot2tex ...`, I get:

```
----------------------------------------------------------------------
sage -t --long devel/sage/sage/combinat/rigged_configurations/kleber_tree.py  # 1 doctest failed
sage -t --long devel/sage/sage/categories/crystals.py  # 2 doctests failed
sage -t --long devel/sage/sage/graphs/digraph.py  # 1 doctest failed
sage -t --long devel/sage/sage/graphs/generic_graph.py  # 43 doctests failed
sage -t --long devel/sage/sage/graphs/graph.py  # 5 doctests failed
sage -t --long devel/sage/sage/graphs/graph_latex.py  # 3 doctests failed
----------------------------------------------------------------------
```
Most of these presumably due to wrong tagging (`NameError: name 'foo' is not defined`).

With `--optional=dot2tex,sage` in contrast, only the following doctest error:

```
**********************************************************************
File "devel/sage/sage/combinat/rigged_configurations/kleber_tree.py", line 387, in sage.combinat.rigged_configurations.kleber_tree.KleberTree._latex_
Failed example:
    KT._latex_()   #optional - dot2tex
Expected nothing
Got:
    '\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (Klebertreenodewithweight1+0+0andupwardsedgeroot0+1+0) at (13bp,82bp) [draw,draw=none] {$V_{\\omega_{1}}$};\n  \\node (Klebertreenodewithweight0+2+0andupwardsedgeroot0+0+0) at (13bp,8bp) [draw,draw=none] {$V_{2\\omega_{2}}$};\n  \\draw [black,->] (Klebertreenodewithweight1+0+0andupwardsedgeroot0+1+0) ..controls (13bp,63bp) and (13bp,42bp)  .. (Klebertreenodewithweight0+2+0andupwardsedgeroot0+0+0);\n  \\pgfsetstrokecolor{black}\n  \\draw (35bp,45bp) node {$\\left(0, 1, 0\\right)$};\n%\n\\end{tikzpicture}\n'
**********************************************************************
1 item had failures:
   1 of   3 in sage.combinat.rigged_configurations.kleber_tree.KleberTree._latex_
```
:-)




It seems there are no dot2tex-optional tests in the documentation (`*.rst`):

```
Doctesting 3 files.
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst
    [0 tests, 0.00 s]
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst
    [0 tests, 0.02 s]
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst
    [0 tests, 0.03 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```
But, ooops, just noticed they're tagged `# optional - dot2tex graphviz`...

Same problem without adding `sage` to the `--optional` list:

```
----------------------------------------------------------------------
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst  # 2 doctests failed
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst  # 1 doctest failed
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst  # 2 doctests failed
----------------------------------------------------------------------
```
Again, with `--optional=dot2tex,graphviz,sage`:

```
Doctesting 3 files.
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst
    [14 tests, 17.73 s]
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst
    [97 tests, 22.79 s]
sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst
    [116 tests, 45.62 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```
... but I also get five pop-up windows showing `sage.pdf`! XD



---

archive/issue_comments_181591.json:
```json
{
    "body": "> It seems there are no dot2tex-optional tests in the documentation (`*.rst`):\n> \n> ```\n> Doctesting 3 files.\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst\n>     [0 tests, 0.00 s]\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst\n>     [0 tests, 0.02 s]\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst\n>     [0 tests, 0.03 s]\n> ----------------------------------------------------------------------\n> All tests passed!\n> ----------------------------------------------------------------------\n> ```\n> But, ooops, just noticed they're tagged `# optional - dot2tex graphviz`...\n\n\n> Same problem without adding `sage` to the `--optional` list:\n> \n> ```\n> ----------------------------------------------------------------------\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst  # 2 doctests failed\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst  # 1 doctest failed\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst  # 2 doctests failed\n> ----------------------------------------------------------------------\n> ```\n> Again, with `--optional=dot2tex,graphviz,sage`:\n> \n> ```\n> Doctesting 3 files.\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst\n>     [14 tests, 17.73 s]\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst\n>     [97 tests, 22.79 s]\n> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst\n>     [116 tests, 45.62 s]\n> ----------------------------------------------------------------------\n> All tests passed!\n> ----------------------------------------------------------------------\n> ```\n> ... but I also get five pop-up windows showing `sage.pdf`! XD\n> \n\n\nLeif, thanks for the report! Are you saying that the tags in the code are wrong? The view commands in the code make the pdf files, but they are supposed to show pictures (not just `sage.pdf`).\n\nBest,\n\nAnne",
    "created_at": "2013-05-21T03:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181591",
    "user": "https://github.com/anneschilling"
}
```

> It seems there are no dot2tex-optional tests in the documentation (`*.rst`):
> 
> ```
> Doctesting 3 files.
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst
>     [0 tests, 0.00 s]
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst
>     [0 tests, 0.02 s]
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst
>     [0 tests, 0.03 s]
> ----------------------------------------------------------------------
> All tests passed!
> ----------------------------------------------------------------------
> ```
> But, ooops, just noticed they're tagged `# optional - dot2tex graphviz`...


> Same problem without adding `sage` to the `--optional` list:
> 
> ```
> ----------------------------------------------------------------------
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst  # 2 doctests failed
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst  # 1 doctest failed
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst  # 2 doctests failed
> ----------------------------------------------------------------------
> ```
> Again, with `--optional=dot2tex,graphviz,sage`:
> 
> ```
> Doctesting 3 files.
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_hw_crystals.rst
>     [14 tests, 17.73 s]
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/affine_finite_crystals.rst
>     [97 tests, 22.79 s]
> sage -t --long devel/sage/doc/en/thematic_tutorials/lie/crystals.rst
>     [116 tests, 45.62 s]
> ----------------------------------------------------------------------
> All tests passed!
> ----------------------------------------------------------------------
> ```
> ... but I also get five pop-up windows showing `sage.pdf`! XD
> 


Leif, thanks for the report! Are you saying that the tags in the code are wrong? The view commands in the code make the pdf files, but they are supposed to show pictures (not just `sage.pdf`).

Best,

Anne



---

archive/issue_comments_181592.json:
```json
{
    "body": "Replying to [comment:31 aschilling]:\n> > ... but I also get five pop-up windows showing `sage.pdf`! XD\n\n\nRerunning the tests of the Sage library with `--optional=dot2tex,graphviz,sage` (i.e., this time also `graphviz`), I get *eleven* pop-up windows.\n\n\n\n\n> Leif, thanks for the report! Are you saying that the tags in the code are wrong?\n\n\nIMHO yes.  Some tests marked optional depend on data that's not defined unless one also specifies `sage`.  I'm not entirely sure whether the *behaviour* w.r.t. that changed with the new doctesting framework (in Sage 5.9 and later); the (syntax of the) options to `sage -t ...` did.\n\n\n\n\n> The view commands in the code make the pdf files, but they are supposed to show pictures (not just `sage.pdf`).\n\n\nYes, I of course meant I get the generated PDFs shown (entitled `sage.pdf`), but that shouldn't happen when doctesting.\n\n\n---\n\n\nFor completeness (Sage library with `[--long] --optional=dot2tex,graphviz,sage`):\n\n```\n**********************************************************************\nFile \"devel/sage/sage/graphs/graph_latex.py\", line 1325, in sage.graphs.graph_latex.GraphLatex.dot2tex_picture\nFailed example:\n    print g.latex_options().dot2tex_picture()  # optional - dot2tex graphviz\nExpected:\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n      \\node (0+1) at (...bp,...bp) [draw,draw=none] {$\\left(\\text{0}, 1\\right)$};\n      \\node (0+0) at (...bp,...bp) [draw,draw=none] {$\\left(\\text{0}, 0\\right)$};\n      \\node (1+0) at (...bp,...bp) [draw,draw=none] {$\\left(\\text{1}, 0\\right)$};\n      \\node (1+1) at (...bp,...bp) [draw,draw=none] {$\\left(\\text{1}, 1\\right)$};\n      \\draw [->] (1+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (0+1);\n      \\draw [->] (0+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (0+1);\n      \\draw [->] (0+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (1+1);\n      \\draw [->] (1+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (1+1);\n    %\n    \\end{tikzpicture}\nGot:\n    <BLANKLINE>\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n    \\node (0+0) at (14bp,63bp) [draw,draw=none] {$\\left(0, 0\\right)$};\n      \\node (0+1) at (60bp,9bp) [draw,draw=none] {$\\left(0, 1\\right)$};\n      \\node (1+0) at (60bp,63bp) [draw,draw=none] {$\\left(1, 0\\right)$};\n      \\node (1+1) at (14bp,9bp) [draw,draw=none] {$\\left(1, 1\\right)$};\n      \\draw [black,->] (0+0) ..controls (29bp,46bp) and (38bp,35bp)  .. (0+1);\n      \\draw [black,->] (1+0) ..controls (45bp,46bp) and (36bp,35bp)  .. (1+1);\n      \\draw [black,->] (0+0) ..controls (14bp,47bp) and (14bp,37bp)  .. (1+1);\n      \\draw [black,->] (1+0) ..controls (60bp,47bp) and (60bp,37bp)  .. (0+1);\n    %\n    \\end{tikzpicture}\n    <BLANKLINE>\n**********************************************************************\n```\n\n\n\n\nAnd this is the *only one* I get because of missing LaTeX packages:\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/posets/posets.py\", line 1087, in sage.combinat.posets.posets.FinitePoset._latex_\nFailed example:\n    print P._latex_() #optional - dot2tex graphviz\nExpected:\n    \\begin{tikzpicture}\n    %\n    \\useasboundingbox (0,0) rectangle (5.0cm,5.0cm);\n    %\n    \\definecolor{cv0}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cfv0}{rgb}{1.0,1.0,1.0}\n    \\definecolor{clv0}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cv1}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cfv1}{rgb}{1.0,1.0,1.0}\n    \\definecolor{clv1}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cv0v1}{rgb}{0.0,0.0,0.0}\n    %\n    \\Vertex[style={minimum size=1.0cm,draw=cv0,fill=cfv0,text=clv0,shape=circle},LabelOut=false,L=\\hbox{$1$},x=0.0cm,y=0.0cm]{v0}\n    \\Vertex[style={minimum size=1.0cm,draw=cv1,fill=cfv1,text=clv1,shape=circle},LabelOut=false,L=\\hbox{$2$},x=5.0cm,y=5.0cm]{v1}\n    %\n    \\Edge[lw=0.1cm,style={post, bend right,color=cv0v1,},](v0)(v1)\n    %\n    \\end{tikzpicture}\nGot:\n    <BLANKLINE>\n    Warning: `tkz-graph.sty` is not part of this computer's TeX installation.\n    This package is required to render graphs in LaTeX.\n    Visit 'http://altermundus.com/pages/graph.html'.\n    <BLANKLINE>\n    <BLANKLINE>\n    Warning: `tkz-berge.sty` is not part of this computer's TeX installation.\n    This package is required to render graphs in LaTeX.\n    Visit 'http://altermundus.com/pages/graph.html'.\n    <BLANKLINE>\n    \\begin{tikzpicture}\n    %\n    \\useasboundingbox (0,0) rectangle (5.0cm,5.0cm);\n    %\n    \\definecolor{cv0}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cfv0}{rgb}{1.0,1.0,1.0}\n    \\definecolor{clv0}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cv1}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cfv1}{rgb}{1.0,1.0,1.0}\n    \\definecolor{clv1}{rgb}{0.0,0.0,0.0}\n    \\definecolor{cv0v1}{rgb}{0.0,0.0,0.0}\n    %\n    \\Vertex[style={minimum size=1.0cm,draw=cv0,fill=cfv0,text=clv0,shape=circle},LabelOut=false,L=\\hbox{$1$},x=5.0cm,y=0.0cm]{v0}\n    \\Vertex[style={minimum size=1.0cm,draw=cv1,fill=cfv1,text=clv1,shape=circle},LabelOut=false,L=\\hbox{$2$},x=0.0cm,y=5.0cm]{v1}\n    %\n    \\Edge[lw=0.1cm,style={post, bend right,color=cv0v1,},](v0)(v1)\n    %\n    \\end{tikzpicture}\n**********************************************************************\n```",
    "created_at": "2013-05-21T04:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181592",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:31 aschilling]:
> > ... but I also get five pop-up windows showing `sage.pdf`! XD


Rerunning the tests of the Sage library with `--optional=dot2tex,graphviz,sage` (i.e., this time also `graphviz`), I get *eleven* pop-up windows.




> Leif, thanks for the report! Are you saying that the tags in the code are wrong?


IMHO yes.  Some tests marked optional depend on data that's not defined unless one also specifies `sage`.  I'm not entirely sure whether the *behaviour* w.r.t. that changed with the new doctesting framework (in Sage 5.9 and later); the (syntax of the) options to `sage -t ...` did.




> The view commands in the code make the pdf files, but they are supposed to show pictures (not just `sage.pdf`).


Yes, I of course meant I get the generated PDFs shown (entitled `sage.pdf`), but that shouldn't happen when doctesting.


---


For completeness (Sage library with `[--long] --optional=dot2tex,graphviz,sage`):

```
**********************************************************************
File "devel/sage/sage/graphs/graph_latex.py", line 1325, in sage.graphs.graph_latex.GraphLatex.dot2tex_picture
Failed example:
    print g.latex_options().dot2tex_picture()  # optional - dot2tex graphviz
Expected:
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
      \node (0+1) at (...bp,...bp) [draw,draw=none] {$\left(\text{0}, 1\right)$};
      \node (0+0) at (...bp,...bp) [draw,draw=none] {$\left(\text{0}, 0\right)$};
      \node (1+0) at (...bp,...bp) [draw,draw=none] {$\left(\text{1}, 0\right)$};
      \node (1+1) at (...bp,...bp) [draw,draw=none] {$\left(\text{1}, 1\right)$};
      \draw [->] (1+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (0+1);
      \draw [->] (0+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (0+1);
      \draw [->] (0+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (1+1);
      \draw [->] (1+0) ..controls (...bp,...bp) and (...bp,...bp)  .. (1+1);
    %
    \end{tikzpicture}
Got:
    <BLANKLINE>
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (0+0) at (14bp,63bp) [draw,draw=none] {$\left(0, 0\right)$};
      \node (0+1) at (60bp,9bp) [draw,draw=none] {$\left(0, 1\right)$};
      \node (1+0) at (60bp,63bp) [draw,draw=none] {$\left(1, 0\right)$};
      \node (1+1) at (14bp,9bp) [draw,draw=none] {$\left(1, 1\right)$};
      \draw [black,->] (0+0) ..controls (29bp,46bp) and (38bp,35bp)  .. (0+1);
      \draw [black,->] (1+0) ..controls (45bp,46bp) and (36bp,35bp)  .. (1+1);
      \draw [black,->] (0+0) ..controls (14bp,47bp) and (14bp,37bp)  .. (1+1);
      \draw [black,->] (1+0) ..controls (60bp,47bp) and (60bp,37bp)  .. (0+1);
    %
    \end{tikzpicture}
    <BLANKLINE>
**********************************************************************
```




And this is the *only one* I get because of missing LaTeX packages:

```
**********************************************************************
File "devel/sage/sage/combinat/posets/posets.py", line 1087, in sage.combinat.posets.posets.FinitePoset._latex_
Failed example:
    print P._latex_() #optional - dot2tex graphviz
Expected:
    \begin{tikzpicture}
    %
    \useasboundingbox (0,0) rectangle (5.0cm,5.0cm);
    %
    \definecolor{cv0}{rgb}{0.0,0.0,0.0}
    \definecolor{cfv0}{rgb}{1.0,1.0,1.0}
    \definecolor{clv0}{rgb}{0.0,0.0,0.0}
    \definecolor{cv1}{rgb}{0.0,0.0,0.0}
    \definecolor{cfv1}{rgb}{1.0,1.0,1.0}
    \definecolor{clv1}{rgb}{0.0,0.0,0.0}
    \definecolor{cv0v1}{rgb}{0.0,0.0,0.0}
    %
    \Vertex[style={minimum size=1.0cm,draw=cv0,fill=cfv0,text=clv0,shape=circle},LabelOut=false,L=\hbox{$1$},x=0.0cm,y=0.0cm]{v0}
    \Vertex[style={minimum size=1.0cm,draw=cv1,fill=cfv1,text=clv1,shape=circle},LabelOut=false,L=\hbox{$2$},x=5.0cm,y=5.0cm]{v1}
    %
    \Edge[lw=0.1cm,style={post, bend right,color=cv0v1,},](v0)(v1)
    %
    \end{tikzpicture}
Got:
    <BLANKLINE>
    Warning: `tkz-graph.sty` is not part of this computer's TeX installation.
    This package is required to render graphs in LaTeX.
    Visit 'http://altermundus.com/pages/graph.html'.
    <BLANKLINE>
    <BLANKLINE>
    Warning: `tkz-berge.sty` is not part of this computer's TeX installation.
    This package is required to render graphs in LaTeX.
    Visit 'http://altermundus.com/pages/graph.html'.
    <BLANKLINE>
    \begin{tikzpicture}
    %
    \useasboundingbox (0,0) rectangle (5.0cm,5.0cm);
    %
    \definecolor{cv0}{rgb}{0.0,0.0,0.0}
    \definecolor{cfv0}{rgb}{1.0,1.0,1.0}
    \definecolor{clv0}{rgb}{0.0,0.0,0.0}
    \definecolor{cv1}{rgb}{0.0,0.0,0.0}
    \definecolor{cfv1}{rgb}{1.0,1.0,1.0}
    \definecolor{clv1}{rgb}{0.0,0.0,0.0}
    \definecolor{cv0v1}{rgb}{0.0,0.0,0.0}
    %
    \Vertex[style={minimum size=1.0cm,draw=cv0,fill=cfv0,text=clv0,shape=circle},LabelOut=false,L=\hbox{$1$},x=5.0cm,y=0.0cm]{v0}
    \Vertex[style={minimum size=1.0cm,draw=cv1,fill=cfv1,text=clv1,shape=circle},LabelOut=false,L=\hbox{$2$},x=0.0cm,y=5.0cm]{v1}
    %
    \Edge[lw=0.1cm,style={post, bend right,color=cv0v1,},](v0)(v1)
    %
    \end{tikzpicture}
**********************************************************************
```



---

archive/issue_comments_181593.json:
```json
{
    "body": "Replying to [comment:29 nthiery]:\n> It's kind of you to be investigating those failing tests, but we don't need them. So I would say: just report upstream and skip them.\n\n\nI've added two patches, one skipping comparisons to the three non-existing reference files, the other fixing the build order of the examples.\n\nIn case they're still needed with #14408 (at least the former most probably will be), we can submit them upstream, but I'm not going to do this right now.",
    "created_at": "2013-05-21T04:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181593",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:29 nthiery]:
> It's kind of you to be investigating those failing tests, but we don't need them. So I would say: just report upstream and skip them.


I've added two patches, one skipping comparisons to the three non-existing reference files, the other fixing the build order of the examples.

In case they're still needed with #14408 (at least the former most probably will be), we can submit them upstream, but I'm not going to do this right now.



---

archive/issue_comments_181594.json:
```json
{
    "body": "Leif,\n\nI know a few of the popup windows come from `view(a_crystal)` type commands (there might also be some `a_crystal.plot()`), but I thought `view()` was not suppose to display anything during doctests (I believe there is a ticket about this, but I can't find it...)\n\nAs for the optional tests, I believe some of them have tests which are run on the object, which doesn't require !`dot2tex`, and then the same object is also run through a `view()`.\n\nTo recap, currently we should (I suspect they might have been broken beforehand) fix optional doctests in the following files:\n\n- `combinat/kleber_tree.py`\n- `graphs/graph_latex.py`\n- `combinat/posets/posets.py`\n\nAs well as (possibly) adding additional optional tags, and making sure the doctests don't show pdfs. Correct?\n\nThanks for your work on this,\n\nTravis",
    "created_at": "2013-05-21T04:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181594",
    "user": "https://github.com/tscrim"
}
```

Leif,

I know a few of the popup windows come from `view(a_crystal)` type commands (there might also be some `a_crystal.plot()`), but I thought `view()` was not suppose to display anything during doctests (I believe there is a ticket about this, but I can't find it...)

As for the optional tests, I believe some of them have tests which are run on the object, which doesn't require !`dot2tex`, and then the same object is also run through a `view()`.

To recap, currently we should (I suspect they might have been broken beforehand) fix optional doctests in the following files:

- `combinat/kleber_tree.py`
- `graphs/graph_latex.py`
- `combinat/posets/posets.py`

As well as (possibly) adding additional optional tags, and making sure the doctests don't show pdfs. Correct?

Thanks for your work on this,

Travis



---

archive/issue_comments_181595.json:
```json
{
    "body": "Diff between the `2.8.7.p1` (former `2.8.7-2`) and the `.p2` spkg.  For reference / review only.",
    "created_at": "2013-05-21T04:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181595",
    "user": "https://github.com/nexttime"
}
```

Diff between the `2.8.7.p1` (former `2.8.7-2`) and the `.p2` spkg.  For reference / review only.



---

archive/issue_comments_181596.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-21T05:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181596",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_181597.json:
```json
{
    "body": "Attachment [dot2tex-2.8.7.p1-p2.diff](tarball://root/attachments/some-uuid/ticket14594/dot2tex-2.8.7.p1-p2.diff) by @nexttime created at 2013-05-21 05:19:21\n\nJust for the record, the [.p1 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p1.spkg) is a remake of Nicolas' `dot2tex-2.8.7-2.spkg`, with all traces of upstream files removed from the Mercurial history (and `src/` now in `.hgignore`), and some tags added.\n\nFor the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)\n\n(Supposed to work with older Sage / matplotlib versions as well.)",
    "created_at": "2013-05-21T05:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181597",
    "user": "https://github.com/nexttime"
}
```

Attachment [dot2tex-2.8.7.p1-p2.diff](tarball://root/attachments/some-uuid/ticket14594/dot2tex-2.8.7.p1-p2.diff) by @nexttime created at 2013-05-21 05:19:21

Just for the record, the [.p1 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p1.spkg) is a remake of Nicolas' `dot2tex-2.8.7-2.spkg`, with all traces of upstream files removed from the Mercurial history (and `src/` now in `.hgignore`), and some tags added.

For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)

(Supposed to work with older Sage / matplotlib versions as well.)



---

archive/issue_comments_181598.json:
```json
{
    "body": "Replying to [comment:35 leif]:\n> For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)\n> \n> (Supposed to work with older Sage / matplotlib versions as well.)\n\n\nP.S.: matplotlib was upgraded in Sage 5.10.beta0.",
    "created_at": "2013-05-21T06:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181598",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:35 leif]:
> For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)
> 
> (Supposed to work with older Sage / matplotlib versions as well.)


P.S.: matplotlib was upgraded in Sage 5.10.beta0.



---

archive/issue_comments_181599.json:
```json
{
    "body": "> To recap, currently we should (I suspect they might have been broken beforehand) fix optional doctests in the following files:\n> \n> - `combinat/kleber_tree.py`\n> - `graphs/graph_latex.py`\n> - `combinat/posets/posets.py`\n\n\nNote that my review patch available at #13624 (trac_13624-review-sl.patch) is (1) adding one doctest and (2) fixing broken optional dot2tex doctests for the `graph_latex.py` and `generic_graph.py` files. Maybe the part (2) could be moved to this ticket?\n\nS\u00e9bastien",
    "created_at": "2013-05-21T11:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181599",
    "user": "https://github.com/seblabbe"
}
```

> To recap, currently we should (I suspect they might have been broken beforehand) fix optional doctests in the following files:
> 
> - `combinat/kleber_tree.py`
> - `graphs/graph_latex.py`
> - `combinat/posets/posets.py`


Note that my review patch available at #13624 (trac_13624-review-sl.patch) is (1) adding one doctest and (2) fixing broken optional dot2tex doctests for the `graph_latex.py` and `generic_graph.py` files. Maybe the part (2) could be moved to this ticket?

Sébastien



---

archive/issue_comments_181600.json:
```json
{
    "body": "Replying to [comment:37 slabbe]:\n> Note that my review patch available at #13624 (trac_13624-review-sl.patch) is (1) adding one doctest and (2) fixing broken optional dot2tex doctests for the `graph_latex.py` and `generic_graph.py` files. Maybe the part (2) could be moved to this ticket?\n\n\nI'd prefer to leave it there (or, more precisely, not to move it here), since it's unrelated to this ticket, which could get \"merged\" simply by putting the new spkg into the optional spkg repo.  (The fixed spkg doesn't change the output of `dot2tex` or any doctest; #14408 *might*.)",
    "created_at": "2013-05-21T15:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181600",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:37 slabbe]:
> Note that my review patch available at #13624 (trac_13624-review-sl.patch) is (1) adding one doctest and (2) fixing broken optional dot2tex doctests for the `graph_latex.py` and `generic_graph.py` files. Maybe the part (2) could be moved to this ticket?


I'd prefer to leave it there (or, more precisely, not to move it here), since it's unrelated to this ticket, which could get "merged" simply by putting the new spkg into the optional spkg repo.  (The fixed spkg doesn't change the output of `dot2tex` or any doctest; #14408 *might*.)



---

archive/issue_comments_181601.json:
```json
{
    "body": "Replying to [comment:36 leif]:\n> Replying to [comment:35 leif]:\n> > For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)\n\n\nI have been through the diff's and am happy with them. I have installed the spkg and ran its test succesfully on 5.10.beta2 as well as 5.10.beta4 git style. Assuming all sage tests pass, feel free to set a positive review on my behalf.",
    "created_at": "2013-05-22T01:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181601",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:36 leif]:
> Replying to [comment:35 leif]:
> > For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)


I have been through the diff's and am happy with them. I have installed the spkg and ran its test succesfully on 5.10.beta2 as well as 5.10.beta4 git style. Assuming all sage tests pass, feel free to set a positive review on my behalf.



---

archive/issue_comments_181602.json:
```json
{
    "body": "Remaining questions:\n\n- Do we want to use this ticket to upgrade dot2tex to its latest devel version?\n- Do we want to use this ticket to make dot2tex a non optional spkg?",
    "created_at": "2013-05-22T01:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181602",
    "user": "https://github.com/nthiery"
}
```

Remaining questions:

- Do we want to use this ticket to upgrade dot2tex to its latest devel version?
- Do we want to use this ticket to make dot2tex a non optional spkg?



---

archive/issue_comments_181603.json:
```json
{
    "body": "Replying to [comment:40 nthiery]:\n> Remaining questions:\n> \n> - Do we want to use this ticket to upgrade dot2tex to its latest devel version?\n\n\nI'd say no, that's for #14408.\n\n\n\n\n> - Do we want to use this ticket to make dot2tex a non optional spkg?\n\n\nAs mentioned before, I thought its MIT license would prevent us from doing so (but IANAL).  Besides that, I don't think anybody would object (since it's much smaller now ;-) ), but it also **requires** graphviz, doesn't it?",
    "created_at": "2013-05-22T01:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181603",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:40 nthiery]:
> Remaining questions:
> 
> - Do we want to use this ticket to upgrade dot2tex to its latest devel version?


I'd say no, that's for #14408.




> - Do we want to use this ticket to make dot2tex a non optional spkg?


As mentioned before, I thought its MIT license would prevent us from doing so (but IANAL).  Besides that, I don't think anybody would object (since it's much smaller now ;-) ), but it also **requires** graphviz, doesn't it?



---

archive/issue_comments_181604.json:
```json
{
    "body": "Replying to [comment:19 leif]:\n> I thought it was (or had to be) optional because of its MIT license, but IANAL.\n\n\nAccording to http://en.wikipedia.org/wiki/MIT_License, MIT is GPL\ncompatible, so that should not be an issue. I think it has not been\nstandard so far just because we never took the time to discuss and do\nit.\n\nGranted dot2tex is not so useful without graphviz (and graphviz is\nsupposed to have a GPL incompatible license; though we don't link to\nit, well, IANAL either). I still think it would simplify our user's\nlife to have dot2tex standard, and only have to worry about installing\ngraphviz if not already preinstalled in the distro.\n\nWhat do you think? Should I make a poll on sage-devel for making\ndot2tex a standard spkg, either in this ticket or a later ticket?\n\nCheers,\n                              Nicolas",
    "created_at": "2013-05-22T01:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181604",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:19 leif]:
> I thought it was (or had to be) optional because of its MIT license, but IANAL.


According to http://en.wikipedia.org/wiki/MIT_License, MIT is GPL
compatible, so that should not be an issue. I think it has not been
standard so far just because we never took the time to discuss and do
it.

Granted dot2tex is not so useful without graphviz (and graphviz is
supposed to have a GPL incompatible license; though we don't link to
it, well, IANAL either). I still think it would simplify our user's
life to have dot2tex standard, and only have to worry about installing
graphviz if not already preinstalled in the distro.

What do you think? Should I make a poll on sage-devel for making
dot2tex a standard spkg, either in this ticket or a later ticket?

Cheers,
                              Nicolas



---

archive/issue_comments_181605.json:
```json
{
    "body": "> Granted dot2tex is not so useful without graphviz (and graphviz is\n> supposed to have a GPL incompatible license; though we don't link to\n> it, well, IANAL either). I still think it would simplify our user's\n> life to have dot2tex standard, and only have to worry about installing\n> graphviz if not already preinstalled in the distro.\n> \n> What do you think? Should I make a poll on sage-devel for making\n> dot2tex a standard spkg, either in this ticket or a later ticket?\n\n\nYes, I think it would be a good idea to make it a standard package!\n\nAnne",
    "created_at": "2013-05-22T01:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181605",
    "user": "https://github.com/anneschilling"
}
```

> Granted dot2tex is not so useful without graphviz (and graphviz is
> supposed to have a GPL incompatible license; though we don't link to
> it, well, IANAL either). I still think it would simplify our user's
> life to have dot2tex standard, and only have to worry about installing
> graphviz if not already preinstalled in the distro.
> 
> What do you think? Should I make a poll on sage-devel for making
> dot2tex a standard spkg, either in this ticket or a later ticket?


Yes, I think it would be a good idea to make it a standard package!

Anne



---

archive/issue_comments_181606.json:
```json
{
    "body": "Replying to [comment:42 nthiery]:\n> Replying to [comment:19 leif]:\n> > I thought it was (or had to be) optional because of its MIT license, but IANAL.\n\n> \n> According to http://en.wikipedia.org/wiki/MIT_License, MIT is GPL\n> compatible, so that should not be an issue.\n\n\nYes, just read the same... :-)\n\n\n\n\n> Granted dot2tex is not so useful without graphviz (and graphviz is\n> supposed to have a GPL incompatible license; though we don't link to\n> it, well, IANAL either). I still think it would simplify our user's\n> life to have dot2tex standard, and only have to worry about installing\n> graphviz if not already preinstalled in the distro.\n\n\nWe could ship it as a standard spkg, and only build / install it if its prerequisites (e.g. graphviz) are present.\n\nOr install it regardless (although then certainly `spkg-check` would fail if not all necessary parts are available), but then IMHO Sage must not bail out in a bad way if the user tries to use it without having the other parts.  Don't know how much of an effort that would mean.\n\n\n\n\n> What do you think? Should I make a poll on sage-devel for making\n> dot2tex a standard spkg, either in this ticket or a later ticket?\n\n\nI personally don't care much...",
    "created_at": "2013-05-22T02:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181606",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:42 nthiery]:
> Replying to [comment:19 leif]:
> > I thought it was (or had to be) optional because of its MIT license, but IANAL.

> 
> According to http://en.wikipedia.org/wiki/MIT_License, MIT is GPL
> compatible, so that should not be an issue.


Yes, just read the same... :-)




> Granted dot2tex is not so useful without graphviz (and graphviz is
> supposed to have a GPL incompatible license; though we don't link to
> it, well, IANAL either). I still think it would simplify our user's
> life to have dot2tex standard, and only have to worry about installing
> graphviz if not already preinstalled in the distro.


We could ship it as a standard spkg, and only build / install it if its prerequisites (e.g. graphviz) are present.

Or install it regardless (although then certainly `spkg-check` would fail if not all necessary parts are available), but then IMHO Sage must not bail out in a bad way if the user tries to use it without having the other parts.  Don't know how much of an effort that would mean.




> What do you think? Should I make a poll on sage-devel for making
> dot2tex a standard spkg, either in this ticket or a later ticket?


I personally don't care much...



---

archive/issue_comments_181607.json:
```json
{
    "body": "I'd like this to also be a standard package.\n\nHowever just running `sage -i` on the spkg, I get the following:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: C = CrystalOfTableaux(['A',2], shape=[2,1])\nERROR    Could not locate Graphviz binaries\nERROR    Failed to create xdotdata. Is Graphviz installed?\nERROR    Failed to parse the input data. Is it a valid dot file?\nTry to input xdot data directly. Example:\n    dot -Txdot file.dot | dot2tex > file.tex\n| Sage Version 5.10.beta3, Release Date: 2013-05-15                  |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nIf this does not work, check that you have an updated version of PyParsing and\nGraphviz. Users have reported problems with old versions. You can also run\ndot2tex in debug mode using the --debug option:\n    dot2tex --debug file.dot\nA file dot2tex.log will be written to the current directory with detailed\ninformation useful for debugging.\nAn exception has occurred, use %tb to see the full traceback.\n\nSystemExit: 1\n\nTo exit: use 'exit', 'quit', or Ctrl-D.\n```\nwhich was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)\n\nBest,\n\nTravis",
    "created_at": "2013-05-22T02:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181607",
    "user": "https://github.com/tscrim"
}
```

I'd like this to also be a standard package.

However just running `sage -i` on the spkg, I get the following:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: C = CrystalOfTableaux(['A',2], shape=[2,1])
ERROR    Could not locate Graphviz binaries
ERROR    Failed to create xdotdata. Is Graphviz installed?
ERROR    Failed to parse the input data. Is it a valid dot file?
Try to input xdot data directly. Example:
    dot -Txdot file.dot | dot2tex > file.tex
| Sage Version 5.10.beta3, Release Date: 2013-05-15                  |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
If this does not work, check that you have an updated version of PyParsing and
Graphviz. Users have reported problems with old versions. You can also run
dot2tex in debug mode using the --debug option:
    dot2tex --debug file.dot
A file dot2tex.log will be written to the current directory with detailed
information useful for debugging.
An exception has occurred, use %tb to see the full traceback.

SystemExit: 1

To exit: use 'exit', 'quit', or Ctrl-D.
```
which was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)

Best,

Travis



---

archive/issue_comments_181608.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> I'd like this to also be a standard package.\n> \n> However just running `sage -i` on the spkg, I get the following:\n> \n> ```\n> ----------------------------------------------------------------------\n> | Sage Version 5.10.beta3, Release Date: 2013-05-15                  |\n> | Type \"notebook()\" for the browser-based notebook interface.        |\n> | Type \"help()\" for help.                                            |\n> ----------------------------------------------------------------------\n> **********************************************************************\n> *                                                                    *\n> * Warning: this is a prerelease version, and it may be unstable.     *\n> *                                                                    *\n> **********************************************************************\n> sage: C = CrystalOfTableaux(['A',2], shape=[2,1])\n> ERROR    Could not locate Graphviz binaries\n> ERROR    Failed to create xdotdata. Is Graphviz installed?\n> ERROR    Failed to parse the input data. Is it a valid dot file?\n> Try to input xdot data directly. Example:\n>     dot -Txdot file.dot | dot2tex > file.tex\n> \n> If this does not work, check that you have an updated version of PyParsing and\n> Graphviz. Users have reported problems with old versions. You can also run\n> dot2tex in debug mode using the --debug option:\n>     dot2tex --debug file.dot\n> A file dot2tex.log will be written to the current directory with detailed\n> information useful for debugging.\n> An exception has occurred, use %tb to see the full traceback.\n> \n> SystemExit: 1\n> \n> To exit: use 'exit', 'quit', or Ctrl-D.\n> ```\n> which was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)\n\n\nFor the record, I just tried the above command (adding a call to view)\nwith Sage 5.10.beta4, and it worked for me (Ubuntu, with graphviz\nprovided by the distribution).\n\nI assume graphviz is in Sage's path?",
    "created_at": "2013-05-22T03:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181608",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:45 tscrim]:
> I'd like this to also be a standard package.
> 
> However just running `sage -i` on the spkg, I get the following:
> 
> ```
> ----------------------------------------------------------------------
> | Sage Version 5.10.beta3, Release Date: 2013-05-15                  |
> | Type "notebook()" for the browser-based notebook interface.        |
> | Type "help()" for help.                                            |
> ----------------------------------------------------------------------
> **********************************************************************
> *                                                                    *
> * Warning: this is a prerelease version, and it may be unstable.     *
> *                                                                    *
> **********************************************************************
> sage: C = CrystalOfTableaux(['A',2], shape=[2,1])
> ERROR    Could not locate Graphviz binaries
> ERROR    Failed to create xdotdata. Is Graphviz installed?
> ERROR    Failed to parse the input data. Is it a valid dot file?
> Try to input xdot data directly. Example:
>     dot -Txdot file.dot | dot2tex > file.tex
> 
> If this does not work, check that you have an updated version of PyParsing and
> Graphviz. Users have reported problems with old versions. You can also run
> dot2tex in debug mode using the --debug option:
>     dot2tex --debug file.dot
> A file dot2tex.log will be written to the current directory with detailed
> information useful for debugging.
> An exception has occurred, use %tb to see the full traceback.
> 
> SystemExit: 1
> 
> To exit: use 'exit', 'quit', or Ctrl-D.
> ```
> which was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)


For the record, I just tried the above command (adding a call to view)
with Sage 5.10.beta4, and it worked for me (Ubuntu, with graphviz
provided by the distribution).

I assume graphviz is in Sage's path?



---

archive/issue_comments_181609.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> I'd like this to also be a standard package.\n> \n> However just running `sage -i` on the spkg, I get the following:\n> \n> ```\n> ...\n> An exception has occurred, use %tb to see the full traceback.\n> ```\n\n\nHint, hint!\n\n> {{{\n> ...\n> SystemExit: 1\n> \n> To exit: use 'exit', 'quit', or Ctrl-D.\n> }}}\n\n(I hope Sage did *not* really exit...)\n\n> which was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)\n\n\nI don't fully understand what you did or tried to do;  installing Sage and the dot2tex spkg on a \"virgin\" system without dot2tex's prerequisites (and without `SAGE_CHECK=yes`)?\n\nAlso, the `.p1` would not work with Sage 5.10.* (because of matplotlib 1.2.x).",
    "created_at": "2013-05-22T03:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181609",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:45 tscrim]:
> I'd like this to also be a standard package.
> 
> However just running `sage -i` on the spkg, I get the following:
> 
> ```
> ...
> An exception has occurred, use %tb to see the full traceback.
> ```


Hint, hint!

> {{{
> ...
> SystemExit: 1
> 
> To exit: use 'exit', 'quit', or Ctrl-D.
> }}}

(I hope Sage did *not* really exit...)

> which was working with the p1 spkg. I presume I shouldn't have to do anything else to get it to work, but what else should I try/do? (I don't think installing the (experimental) graphviz would work, nor does it seem like the right solution...)


I don't fully understand what you did or tried to do;  installing Sage and the dot2tex spkg on a "virgin" system without dot2tex's prerequisites (and without `SAGE_CHECK=yes`)?

Also, the `.p1` would not work with Sage 5.10.* (because of matplotlib 1.2.x).



---

archive/issue_comments_181610.json:
```json
{
    "body": "Seems like I somehow accidentally deleted my installation of graphviz. It works okay. Sorry for the white noise. (And no, sage did not actually exit.)",
    "created_at": "2013-05-22T07:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181610",
    "user": "https://github.com/tscrim"
}
```

Seems like I somehow accidentally deleted my installation of graphviz. It works okay. Sorry for the white noise. (And no, sage did not actually exit.)



---

archive/issue_comments_181611.json:
```json
{
    "body": "About making `dot2tex` standard: I see no point in this unless you also make `graphviz` standard, which cannot legally be done for license reasons. What would probably make more sense is combining `graphviz` and `dot2tex` in one optional package.",
    "created_at": "2013-05-22T09:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181611",
    "user": "https://github.com/jdemeyer"
}
```

About making `dot2tex` standard: I see no point in this unless you also make `graphviz` standard, which cannot legally be done for license reasons. What would probably make more sense is combining `graphviz` and `dot2tex` in one optional package.



---

archive/issue_comments_181612.json:
```json
{
    "body": "I started a poll on:\n\nhttps://groups.google.com/forum/?fromgroups#!topic/sage-devel/U0Ij_06H2mk",
    "created_at": "2013-05-22T14:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181612",
    "user": "https://github.com/nthiery"
}
```

I started a poll on:

https://groups.google.com/forum/?fromgroups#!topic/sage-devel/U0Ij_06H2mk



---

archive/issue_comments_181613.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> About making `dot2tex` standard: I see no point in this unless you also make `graphviz` standard, which cannot legally be done for license reasons. What would probably make more sense is combining `graphviz` and `dot2tex` in one optional package.\n\n\nSee my comments on sage-devel. History seems to tell that we do not really have the manpower to maintain a graphviz spkg, and anyway it probably does not really makes sense: it's as easy to install as an optional spkg or as an os package.",
    "created_at": "2013-05-22T14:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181613",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:49 jdemeyer]:
> About making `dot2tex` standard: I see no point in this unless you also make `graphviz` standard, which cannot legally be done for license reasons. What would probably make more sense is combining `graphviz` and `dot2tex` in one optional package.


See my comments on sage-devel. History seems to tell that we do not really have the manpower to maintain a graphviz spkg, and anyway it probably does not really makes sense: it's as easy to install as an optional spkg or as an os package.



---

archive/issue_comments_181614.json:
```json
{
    "body": "> For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)\n> \n> (Supposed to work with older Sage / matplotlib versions as well.)\n\n\nI just installed the p2 version on MacOS and it works great! Thank you.\n\nAnne",
    "created_at": "2013-05-23T22:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181614",
    "user": "https://github.com/anneschilling"
}
```

> For the [new .p2 spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg) with my fixes, based on the above-mentioned `.p1`, see the ticket's description; [attachment:dot2tex-2.8.7.p1-p2.diff diff for easier reviewing] also attached.  Please build, test, and report! ;-)
> 
> (Supposed to work with older Sage / matplotlib versions as well.)


I just installed the p2 version on MacOS and it works great! Thank you.

Anne



---

archive/issue_comments_181615.json:
```json
{
    "body": "There's a new preliminary spkg available for testing at #14408.  (dot2tex's test suite is more than likely to fail atm.)\n\nDoctesting the Sage library with that may still make sense.",
    "created_at": "2013-05-24T04:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181615",
    "user": "https://github.com/nexttime"
}
```

There's a new preliminary spkg available for testing at #14408.  (dot2tex's test suite is more than likely to fail atm.)

Doctesting the Sage library with that may still make sense.



---

archive/issue_comments_181616.json:
```json
{
    "body": "Since it seems like the question of making `dot2tex` a standard package is controversial and the changes currently fix the problem, what's left to do before setting this to positive review? Has anyone tried this on `5.9` or below? The spkg diff looks good to me and running:\n\n```\nsage -i -f -c http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg\n...\nGPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1\nready. %%BoundingBox: 148 556 612 667\nCreating output file nodenames_pst.eps ... ready.\nGPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1\nGPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1\nGPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1\nGPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1\n.sh: 1: pdftk: not found\nWARNING  Failed to run command:\npdftk autosize_cmp.pdf colors_cmp.pdf compassports_cmp.pdf concentrate_cmp.pdf escstr_cmp.pdf invis_cmp.pdf nodenames_cmp.pdf cat output testrenders.pdf dont_ask\nF\n======================================================================\nFAIL: test_zzzzzzzzzzzfinal (__main__.RenderTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test_multirender.py\", line 313, in test_zzzzzzzzzzzfinal\n    self.failIf(err)\nAssertionError: 32512 is not false\n\n----------------------------------------------------------------------\nRan 8 tests in 72.121s\n\nFAILED (failures=1)\nProcessing autosize.dot\nProcessing colors.dot\nProcessing compassports.dot\nProcessing concentrate.dot\nProcessing escstr.dot\nProcessing invis.dot\nProcessing nodenames.dot\n\nError(s) running dot2tex's test suite.\n\nreal\t2m42.307s\nuser\t1m11.820s\nsys\t0m49.403s\n************************************************************************\nError testing package dot2tex-2.8.7.p2\n************************************************************************\n```\nHowever I do **not** have `pdftk` installed on my system. From comment:25 I'm guessing this is okay? I'll also try it with `pdftk` installed.",
    "created_at": "2013-05-24T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181616",
    "user": "https://github.com/tscrim"
}
```

Since it seems like the question of making `dot2tex` a standard package is controversial and the changes currently fix the problem, what's left to do before setting this to positive review? Has anyone tried this on `5.9` or below? The spkg diff looks good to me and running:

```
sage -i -f -c http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg
...
GPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1
ready. %%BoundingBox: 148 556 612 667
Creating output file nodenames_pst.eps ... ready.
GPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1
GPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1
GPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1
GPL Ghostscript 9.05: Error: Font Renderer Plugin ( FreeType ) return code = -1
.sh: 1: pdftk: not found
WARNING  Failed to run command:
pdftk autosize_cmp.pdf colors_cmp.pdf compassports_cmp.pdf concentrate_cmp.pdf escstr_cmp.pdf invis_cmp.pdf nodenames_cmp.pdf cat output testrenders.pdf dont_ask
F
======================================================================
FAIL: test_zzzzzzzzzzzfinal (__main__.RenderTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "test_multirender.py", line 313, in test_zzzzzzzzzzzfinal
    self.failIf(err)
AssertionError: 32512 is not false

----------------------------------------------------------------------
Ran 8 tests in 72.121s

FAILED (failures=1)
Processing autosize.dot
Processing colors.dot
Processing compassports.dot
Processing concentrate.dot
Processing escstr.dot
Processing invis.dot
Processing nodenames.dot

Error(s) running dot2tex's test suite.

real	2m42.307s
user	1m11.820s
sys	0m49.403s
************************************************************************
Error testing package dot2tex-2.8.7.p2
************************************************************************
```
However I do **not** have `pdftk` installed on my system. From comment:25 I'm guessing this is okay? I'll also try it with `pdftk` installed.



---

archive/issue_comments_181617.json:
```json
{
    "body": "Replying to [comment:54 tscrim]:\n> Since it seems like the question of making `dot2tex` a standard package is controversial\n\n\nAnd anyway that would be for #14408.\n\n> Has anyone tried this on `5.9` or below?\n\n\nI think we should not worry about this. This package will be updated\nin the optional spkg for 5.10 and later; this has to be a different\nrepository from the optional spkg for earlier versions of Sage (or\nnot???).\n\nNo clue about the pdftk thing.\n\nCheers,\n                             Nicolas",
    "created_at": "2013-05-24T19:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181617",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:54 tscrim]:
> Since it seems like the question of making `dot2tex` a standard package is controversial


And anyway that would be for #14408.

> Has anyone tried this on `5.9` or below?


I think we should not worry about this. This package will be updated
in the optional spkg for 5.10 and later; this has to be a different
repository from the optional spkg for earlier versions of Sage (or
not???).

No clue about the pdftk thing.

Cheers,
                             Nicolas



---

archive/issue_comments_181618.json:
```json
{
    "body": "With `pdftk`, all tests pass:\n\n```\nsage -i -f -c http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg\n...\ndot2tex's test suite passed successfully.\n\nreal\t2m56.101s\nuser\t1m12.137s\nsys\t0m54.015s\n```\nLeif, is it okay for the tests not to pass without `pdftk`?\n\nReplying to [comment:55 nthiery]:\n> > Has anyone tried this on 5.9 or below?\n\n>I think we should not worry about this. This package will be updated in the optional spkg for 5.10 and later; this has to be a different repository from the optional spkg for earlier versions of Sage (or not???).\nOkay.",
    "created_at": "2013-05-24T19:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181618",
    "user": "https://github.com/tscrim"
}
```

With `pdftk`, all tests pass:

```
sage -i -f -c http://boxen.math.washington.edu/home/leif/Sage/spkgs/dot2tex-2.8.7.p2.spkg
...
dot2tex's test suite passed successfully.

real	2m56.101s
user	1m12.137s
sys	0m54.015s
```
Leif, is it okay for the tests not to pass without `pdftk`?

Replying to [comment:55 nthiery]:
> > Has anyone tried this on 5.9 or below?

>I think we should not worry about this. This package will be updated in the optional spkg for 5.10 and later; this has to be a different repository from the optional spkg for earlier versions of Sage (or not???).
Okay.



---

archive/issue_comments_181619.json:
```json
{
    "body": "Since this works (as before), with `pdftk` all the spkg tests pass, and it would be good to get this as the default `dot2tex` spkg before `5.10` is released, I'm setting this to positive review.",
    "created_at": "2013-05-27T16:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181619",
    "user": "https://github.com/tscrim"
}
```

Since this works (as before), with `pdftk` all the spkg tests pass, and it would be good to get this as the default `dot2tex` spkg before `5.10` is released, I'm setting this to positive review.



---

archive/issue_comments_181620.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-27T16:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181620",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_181621.json:
```json
{
    "body": "I just put the file on the server. I double checked it, 2.8.7.p2. in optional.",
    "created_at": "2013-05-27T20:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181621",
    "user": "https://github.com/haraldschilly"
}
```

I just put the file on the server. I double checked it, 2.8.7.p2. in optional.



---

archive/issue_comments_181622.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-28T08:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181622",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_041584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-28T08:25:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14390#event-41584"
}
```



---

archive/issue_comments_181623.json:
```json
{
    "body": "Thanks guys! That will be a lifesaver during the upcoming Sage days :-)",
    "created_at": "2013-05-28T14:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181623",
    "user": "https://github.com/nthiery"
}
```

Thanks guys! That will be a lifesaver during the upcoming Sage days :-)



---

archive/issue_comments_181624.json:
```json
{
    "body": "For fixing broken optional dot2tex doctests, see #14680.",
    "created_at": "2013-06-03T15:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181624",
    "user": "https://github.com/nexttime"
}
```

For fixing broken optional dot2tex doctests, see #14680.



---

archive/issue_comments_181625.json:
```json
{
    "body": "For matplotlib >= 1.3.x (#14993, merged into Sage 6.2.beta5), we apparently have to adapt the spkg again, as MPL no longer ships with pyparsing (but Sage now ships it as a *separate* package), so importing `matplotlib.pyparsing` fails.  (The installation of the optional dot2tex package still succeeds -- unless one also tries to run its test suite, but using dot2tex now more or less **silently** fails.  Quite odd.)",
    "created_at": "2014-03-29T20:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181625",
    "user": "https://github.com/nexttime"
}
```

For matplotlib >= 1.3.x (#14993, merged into Sage 6.2.beta5), we apparently have to adapt the spkg again, as MPL no longer ships with pyparsing (but Sage now ships it as a *separate* package), so importing `matplotlib.pyparsing` fails.  (The installation of the optional dot2tex package still succeeds -- unless one also tries to run its test suite, but using dot2tex now more or less **silently** fails.  Quite odd.)



---

archive/issue_comments_181626.json:
```json
{
    "body": "Replying to [comment:62 leif]:\n> For matplotlib >= 1.3.x (#14993, merged into Sage 6.2.beta5), we apparently have to adapt the spkg again, as MPL no longer ships with pyparsing (but Sage now ships it as a *separate* package), so importing `matplotlib.pyparsing` fails.  (The installation of the optional dot2tex package still succeeds -- unless one also tries to run its test suite, but using dot2tex now more or less **silently** fails.  Quite odd.)\n\n\nI just ran into that issue -- are there any solutions so far?\n\nThanks, Christian",
    "created_at": "2014-04-30T07:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181626",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:62 leif]:
> For matplotlib >= 1.3.x (#14993, merged into Sage 6.2.beta5), we apparently have to adapt the spkg again, as MPL no longer ships with pyparsing (but Sage now ships it as a *separate* package), so importing `matplotlib.pyparsing` fails.  (The installation of the optional dot2tex package still succeeds -- unless one also tries to run its test suite, but using dot2tex now more or less **silently** fails.  Quite odd.)


I just ran into that issue -- are there any solutions so far?

Thanks, Christian



---

archive/issue_comments_181627.json:
```json
{
    "body": "Replying to [comment:63 stumpc5]:\n> I just ran into that issue -- are there any solutions so far?\n\n\nI just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.\n\nThen, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:\n\n```diff\n26,27c26,30\n-     import matplotlib.pyparsing as pyparsing\n-     # just raise if that failed, too\n+     try:\n+         import matplotlib.pyparsing as pyparsing\n+     except ImportError:\n+         import pyparsing\n+         # just raise if that failed, too\n36c39\n-     ParseException, ParseResults, CharsNotIn, _noncomma, dblQuotedString, QuotedString, ParserElement,\n+     ParseException, ParseResults, CharsNotIn, dblQuotedString, QuotedString, ParserElement,\n```\n\nThen, I tested this example:\n\n```python\nsage: G = DiGraph()\nsage: G.add_edge(3333, 88, 'my_label')\nsage: G.set_latex_options(format='dot2tex')\nsage: view(G)\n```\n\nand it worked again.",
    "created_at": "2014-04-30T09:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181627",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:63 stumpc5]:
> I just ran into that issue -- are there any solutions so far?


I just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.

Then, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:

```diff
26,27c26,30
-     import matplotlib.pyparsing as pyparsing
-     # just raise if that failed, too
+     try:
+         import matplotlib.pyparsing as pyparsing
+     except ImportError:
+         import pyparsing
+         # just raise if that failed, too
36c39
-     ParseException, ParseResults, CharsNotIn, _noncomma, dblQuotedString, QuotedString, ParserElement,
+     ParseException, ParseResults, CharsNotIn, dblQuotedString, QuotedString, ParserElement,
```

Then, I tested this example:

```python
sage: G = DiGraph()
sage: G.add_edge(3333, 88, 'my_label')
sage: G.set_latex_options(format='dot2tex')
sage: view(G)
```

and it worked again.



---

archive/issue_comments_181628.json:
```json
{
    "body": "Replying to [comment:64 slabbe]:\n> I just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.\n> \n> Then, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:\n\n\nI did word by word the same some minutes ago :-) Thanks for checking anyway...",
    "created_at": "2014-04-30T09:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181628",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:64 slabbe]:
> I just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.
> 
> Then, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:


I did word by word the same some minutes ago :-) Thanks for checking anyway...



---

archive/issue_comments_181629.json:
```json
{
    "body": "Replying to [comment:65 stumpc5]:\n> Replying to [comment:64 slabbe]:\n> > I just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.\n> > \n> > Then, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:\n\n> \n> I did word by word the same some minutes ago :-) Thanks for checking anyway...\n\n\nHi Christian,\n\nAre you using the latest version of the package? See\n\nhttp://trac.sagemath.org/ticket/16026\n\nThis works for me!\n\nAnne",
    "created_at": "2014-04-30T15:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181629",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:65 stumpc5]:
> Replying to [comment:64 slabbe]:
> > I just tried an ugly monkey fix which worked. First I did `sage -i pyparsing` and in my case that package was already installed.
> > 
> > Then, I edited the file `/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/dot2tex/dotparsing.py` in the following way:

> 
> I did word by word the same some minutes ago :-) Thanks for checking anyway...


Hi Christian,

Are you using the latest version of the package? See

http://trac.sagemath.org/ticket/16026

This works for me!

Anne



---

archive/issue_comments_181630.json:
```json
{
    "body": "Replying to [comment:66 aschilling]:\n> Are you using the latest version of the package?\n\n\n\u200bI am using the latest development version 6.2.rc0\u200b and got the error there. But that patch is already merged there, isn't it?",
    "created_at": "2014-04-30T15:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181630",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:66 aschilling]:
> Are you using the latest version of the package?


​I am using the latest development version 6.2.rc0​ and got the error there. But that patch is already merged there, isn't it?



---

archive/issue_comments_181631.json:
```json
{
    "body": "Replying to [comment:67 stumpc5]:\n> Replying to [comment:66 aschilling]:\n> > Are you using the latest version of the package?\n\n> \n> \u200bI am using the latest development version 6.2.rc0\u200b and got the error there. But that patch is already merged there, isn't it?\n\n\nBut did you install\n\n \u200bhttp://boxen.math.washington.edu/home/vbraun/upstream/dot2tex-20120520.tar.bz2\n\nor the old version?",
    "created_at": "2014-04-30T15:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181631",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:67 stumpc5]:
> Replying to [comment:66 aschilling]:
> > Are you using the latest version of the package?

> 
> ​I am using the latest development version 6.2.rc0​ and got the error there. But that patch is already merged there, isn't it?


But did you install

 ​http://boxen.math.washington.edu/home/vbraun/upstream/dot2tex-20120520.tar.bz2

or the old version?



---

archive/issue_comments_181632.json:
```json
{
    "body": "Replying to [comment:68 aschilling]:\n> or the old version?\n\n\nI guess the old version -- I just used `sage -i dot2tex` as I am supposed to do to install an optional package...",
    "created_at": "2014-04-30T15:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181632",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:68 aschilling]:
> or the old version?


I guess the old version -- I just used `sage -i dot2tex` as I am supposed to do to install an optional package...



---

archive/issue_comments_181633.json:
```json
{
    "body": "Replying to [comment:68 aschilling]:\n> But did you install\n> \n>  \u200bhttp://boxen.math.washington.edu/home/vbraun/upstream/dot2tex-20120520.tar.bz2\n> \n> or the old version?\n\n\nAnne, can you tell me how to install the new git version of dot2tex spkg? I tried:\n\n```\n$ sage -f http://www.sagemath.org/packages/upstream/dot2tex/dot2tex-20120520.tar.bz2\n```\n\nand I got:\n\n```\nAttempting to download package dot2tex-20120520.tar.bz2\n>>> Trying to download http://www.sagemath.org/packages/upstream/dot2tex/dot2tex-20120520.tar.bz2\n[............................................................]\ndot2tex-20120520.tar.bz2\n====================================================\nExtracting package /Users/slabbe/Applications/sage-git/upstream/dot2tex-20120520.tar.bz2\n-rw-r--r--  1 slabbe  staff  1731531 Apr 30 23:51 /Users/slabbe/Applications/sage-git/upstream/dot2tex-20120520.tar.bz2\nFinished extraction\n/Users/slabbe/Applications/sage-git/src/bin/sage-spkg: line 594: cd: dot2tex-20120520.tar.bz2: No such file or directory\nError: after extracting, the directory dot2tex-20120520.tar.bz2 does not exist\n```",
    "created_at": "2014-04-30T21:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181633",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:68 aschilling]:
> But did you install
> 
>  ​http://boxen.math.washington.edu/home/vbraun/upstream/dot2tex-20120520.tar.bz2
> 
> or the old version?


Anne, can you tell me how to install the new git version of dot2tex spkg? I tried:

```
$ sage -f http://www.sagemath.org/packages/upstream/dot2tex/dot2tex-20120520.tar.bz2
```

and I got:

```
Attempting to download package dot2tex-20120520.tar.bz2
>>> Trying to download http://www.sagemath.org/packages/upstream/dot2tex/dot2tex-20120520.tar.bz2
[............................................................]
dot2tex-20120520.tar.bz2
====================================================
Extracting package /Users/slabbe/Applications/sage-git/upstream/dot2tex-20120520.tar.bz2
-rw-r--r--  1 slabbe  staff  1731531 Apr 30 23:51 /Users/slabbe/Applications/sage-git/upstream/dot2tex-20120520.tar.bz2
Finished extraction
/Users/slabbe/Applications/sage-git/src/bin/sage-spkg: line 594: cd: dot2tex-20120520.tar.bz2: No such file or directory
Error: after extracting, the directory dot2tex-20120520.tar.bz2 does not exist
```



---

archive/issue_comments_181634.json:
```json
{
    "body": "Download the tar.bz2 file and put it in `sage/upstream`. Verify that the file `sage/build/pkgs/dot2tex/package-version.txt` contains \"20120520\". Then do `sage -f dot2tex`.\n\n(I think that once Sage 6.2 becomes official, then the new tar.bz2 file will go to the mirrors and replace the old package.)",
    "created_at": "2014-04-30T22:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181634",
    "user": "https://github.com/jhpalmieri"
}
```

Download the tar.bz2 file and put it in `sage/upstream`. Verify that the file `sage/build/pkgs/dot2tex/package-version.txt` contains "20120520". Then do `sage -f dot2tex`.

(I think that once Sage 6.2 becomes official, then the new tar.bz2 file will go to the mirrors and replace the old package.)



---

archive/issue_comments_181635.json:
```json
{
    "body": "Replying to [comment:71 jhpalmieri]:\n> Download the tar.bz2 file and put it in `sage/upstream`. Verify that the file `sage/build/pkgs/dot2tex/package-version.txt` contains \"20120520\". Then do `sage -f dot2tex`.\n\n\nDid that. Here is my setup:\n\n```\n$ ls upstream/dot2tex*\nupstream/dot2tex-2.8.7.p2.spkg\nupstream/dot2tex-20120520.tar.bz2\n$ ls build/pkgs/dot2tex/\npackage-version.txt\n$ cat build/pkgs/dot2tex/package-version.txt \n20120520\n```\n\nBut I also need the content of the checksum (where can I find it?):\n\n```\n$ sage -f dot2tex\nsed: /Users/slabbe/Applications/sage-git/build/pkgs/dot2tex/checksums.ini: No such file or directory\nFound local metadata for dot2tex-20120520\nAttempting to download package dot2tex-20120520\n>>> Trying to download http://www.sagemath.org/packages/upstream/dot2tex/\n[.]\nNo checksum file: /Users/slabbe/Applications/sage-git/build/pkgs/dot2tex/checksums.ini\n```\n\nAlso, why does it try to download it since it is in `upstream` directory?",
    "created_at": "2014-05-02T08:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181635",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:71 jhpalmieri]:
> Download the tar.bz2 file and put it in `sage/upstream`. Verify that the file `sage/build/pkgs/dot2tex/package-version.txt` contains "20120520". Then do `sage -f dot2tex`.


Did that. Here is my setup:

```
$ ls upstream/dot2tex*
upstream/dot2tex-2.8.7.p2.spkg
upstream/dot2tex-20120520.tar.bz2
$ ls build/pkgs/dot2tex/
package-version.txt
$ cat build/pkgs/dot2tex/package-version.txt 
20120520
```

But I also need the content of the checksum (where can I find it?):

```
$ sage -f dot2tex
sed: /Users/slabbe/Applications/sage-git/build/pkgs/dot2tex/checksums.ini: No such file or directory
Found local metadata for dot2tex-20120520
Attempting to download package dot2tex-20120520
>>> Trying to download http://www.sagemath.org/packages/upstream/dot2tex/
[.]
No checksum file: /Users/slabbe/Applications/sage-git/build/pkgs/dot2tex/checksums.ini
```

Also, why does it try to download it since it is in `upstream` directory?



---

archive/issue_comments_181636.json:
```json
{
    "body": "Something is wrong with your branch. With the current develop branch, I see\n\n```\n$ ls build/pkgs/dot2tex/\nSPKG.txt             package-version.txt  spkg-check*\nchecksums.ini        patches/             spkg-install*\n$ cat build/pkgs/dot2tex/package-version.txt \n20120520\n```\nYou're missing most of the files in `build/pkgs/dot2tex`.\n\n(If you had a `checksums.ini` file which matched the file in `upstream`, it wouldn't download anything.)",
    "created_at": "2014-05-02T14:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181636",
    "user": "https://github.com/jhpalmieri"
}
```

Something is wrong with your branch. With the current develop branch, I see

```
$ ls build/pkgs/dot2tex/
SPKG.txt             package-version.txt  spkg-check*
checksums.ini        patches/             spkg-install*
$ cat build/pkgs/dot2tex/package-version.txt 
20120520
```
You're missing most of the files in `build/pkgs/dot2tex`.

(If you had a `checksums.ini` file which matched the file in `upstream`, it wouldn't download anything.)



---

archive/issue_comments_181637.json:
```json
{
    "body": "The way to install a spkg does not seem to be clear. I suggest to move the discussion concerning the installation of an optional spkg on sage-devel. I start a new thread now.\n\nS\u00e9bastien",
    "created_at": "2014-05-02T21:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14390#issuecomment-181637",
    "user": "https://github.com/seblabbe"
}
```

The way to install a spkg does not seem to be clear. I suggest to move the discussion concerning the installation of an optional spkg on sage-devel. I start a new thread now.

Sébastien
