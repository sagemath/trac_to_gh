# Issue 29385: cygwin: Fixes for CI

archive/issues_029385.json:
```json
{
    "body": "CC:  dimpase slelievre embray\n\nHopefully the last change for the CI for 9.1\n\nIssue created by migration from https://trac.sagemath.org/ticket/29622\n\n",
    "created_at": "2020-04-29T23:58:19Z",
    "labels": [
        "porting: Cygwin",
        "major",
        "bug"
    ],
    "title": "cygwin: Fixes for CI",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29385",
    "user": "mkoeppe"
}
```
CC:  dimpase slelievre embray

Hopefully the last change for the CI for 9.1

Issue created by migration from https://trac.sagemath.org/ticket/29622





---

archive/issue_comments_416774.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-04-30T00:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416774",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_416775.json:
```json
{
    "body": "This fixes some syntax errors in the cygwin build. Now it times out in stage 3. This would need to be rebalanced or split into several parallel stages",
    "created_at": "2020-05-01T00:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416775",
    "user": "mkoeppe"
}
```

This fixes some syntax errors in the cygwin build. Now it times out in stage 3. This would need to be rebalanced or split into several parallel stages



---

archive/issue_comments_416776.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-01T20:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416776",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416777.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-02T18:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416777",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416778.json:
```json
{
    "body": "getting closer - https://github.com/mkoeppe/sage/runs/639064085",
    "created_at": "2020-05-02T18:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416778",
    "user": "mkoeppe"
}
```

getting closer - https://github.com/mkoeppe/sage/runs/639064085



---

archive/issue_comments_416779.json:
```json
{
    "body": "`Fatal error: can't write 24 bytes to section .text of build/temp.cygwin-3.1.4-x86_64-3.7/build/cythonized/sage/rings/laurent_series_ring_element.o: 'No space left on device'`",
    "created_at": "2020-05-02T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416779",
    "user": "mkoeppe"
}
```

`Fatal error: can't write 24 bytes to section .text of build/temp.cygwin-3.1.4-x86_64-3.7/build/cythonized/sage/rings/laurent_series_ring_element.o: 'No space left on device'`



---

archive/issue_comments_416780.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-02T20:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416780",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-02T20:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416782.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-02T22:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416782",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-03T15:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416783",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416784.json:
```json
{
    "body": "This now manages to build Sage on Cygwin (see `cygwin-stage-iii` in https://github.com/mkoeppe/sage/runs/640373882)",
    "created_at": "2020-05-03T15:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416784",
    "user": "mkoeppe"
}
```

This now manages to build Sage on Cygwin (see `cygwin-stage-iii` in https://github.com/mkoeppe/sage/runs/640373882)



---

archive/issue_comments_416785.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-03T16:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416785",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416786.json:
```json
{
    "body": "Ready for review",
    "created_at": "2020-05-03T16:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416786",
    "user": "mkoeppe"
}
```

Ready for review



---

archive/issue_comments_416787.json:
```json
{
    "body": "`cygwin-minimal`, stage-ii-a and stage-ii-c still time out (https://github.com/mkoeppe/sage/runs/641053384); more rebalancing should be done in the next release cycle. I stop for this ticket and 9.1. \n\nUploading and downloading of our large sage-local artifacts is somewhat brittle, a game of chance: For example, in https://github.com/mkoeppe/sage/runs/641209977 (`cygwin-standard`), stage-iii :\n\n```\nExponential backoff for retry #5. Waiting for 33036.92082171844 milliseconds before continuing the upload at offset 1379926016\nTotal file count: 1 ---- Processed file #0 (0.0%)\nFinished backoff for retry #5, continuing with upload\nTotal file count: 1 ---- Processed file #0 (0.0%)\nAn error has been caught http-client index 0, retrying the upload\nError: read ECONNRESET\n    at TLSWrap.onStreamRead (internal/stream_base_commons.js:201:27) {\n  errno: 'ECONNRESET',\n  code: 'ECONNRESET',\n  syscall: 'read'\n}\nRetry limit has been reached for chunk at offset 1379926016 to https://pipelines.actions.githubusercontent.com/4D1poTSDSSApU42GXYeGgQX6WjHwGPK9ZzdaE2SeHdlUs0ZBhW/_apis/resources/Containers/3201477?itemPath=sage-local-commit-b2c012bfed0fb9414e0db531acc43a3abf1ae1ba-cygwin-standard%5Csage-local-iii.tar\n##[warning]Aborting upload for C:\\tools\\cygwin\\tmp\\sage-local-iii.tar due to failure\nTotal size of all the files uploaded is 1379926016 bytes\n```\n\n\nIn the same run, for https://github.com/mkoeppe/sage/runs/641394549 (`cygwin-standard-python2`), the upload of stage-iii succeeded,\nand stage-iv-a ... stage-iv-d downloaded it successfully. \n- stage-iv-a (`make ptest`, https://github.com/mkoeppe/sage/runs/641394549) terminates, with a number of doctest errors and timeouts:\n  {{{\nsage -t src/doc/en/constructions/plotting.rst  # Timed out\nsage -t src/doc/fr/tutorial/interfaces.rst  # 1 doctest failed\nsage -t src/doc/ja/tutorial/interfaces.rst  # 2 doctests failed\nsage -t src/doc/pt/tutorial/interfaces.rst  # Timed out\nsage -t src/doc/ru/tutorial/interfaces.rst  # 6 doctests failed\nsage -t src/sage/coding/binary_code.pyx  # Timed out\nsage -t src/sage/doctest/control.py  # 1 doctest failed\nsage -t src/sage/functions/log.py  # 1 doctest failed\nsage -t src/sage/functions/orthogonal_polys.py  # 1 doctest failed\nsage -t src/sage/functions/other.py  # 2 doctests failed\nsage -t src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out\nsage -t src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t src/sage/groups/class_function.py  # Timed out\nsage -t src/sage/interfaces/giac.py  # 41 doctests failed\nsage -t src/sage/libs/gap/element.pyx  # 1 doctest failed\nsage -t src/sage/libs/glpk/error.pyx  # 2 doctests failed\nsage -t src/sage/matrix/matrix1.pyx  # 1 doctest failed\nsage -t src/sage/numerical/backends/glpk_backend.pyx  # 2 doctests failed\nsage -t src/sage/parallel/map_reduce.py  # Timed out after testing finished\nsage -t src/sage/repl/interpreter.py  # 3 doctests failed\nsage -t src/sage/rings/number_field/number_field_element.pyx  # Timed out\nsage -t src/sage/sandpiles/sandpile.py  # Timed out\nsage -t src/sage/symbolic/constants.py  # 3 doctests failed\nsage -t src/sage/symbolic/expression_conversions.py  # 1 doctest failed\nsage -t src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t src/sage/tests/benchmark.py  # 2 doctests failed\nsage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py  # 1 doctest failed\nsage -t src/sage/tests/cmdline.py  # 3 doctests failed\n  }}}\n  Looks like the giac interface is broken. \n\n- stage-iv-b builds a few optional packages; I have noted build failures in some separate tickets.\n\n- stage-iv-c builds `cbc`, `sage_numerical_backends_coin` successfully.\n\n- stage-iv-d (https://github.com/mkoeppe/sage/runs/641394565) builds a long list of optional packages, times out;  I have noted build failures in some separate tickets.",
    "created_at": "2020-05-04T02:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416787",
    "user": "mkoeppe"
}
```

`cygwin-minimal`, stage-ii-a and stage-ii-c still time out (https://github.com/mkoeppe/sage/runs/641053384); more rebalancing should be done in the next release cycle. I stop for this ticket and 9.1. 

Uploading and downloading of our large sage-local artifacts is somewhat brittle, a game of chance: For example, in https://github.com/mkoeppe/sage/runs/641209977 (`cygwin-standard`), stage-iii :

```
Exponential backoff for retry #5. Waiting for 33036.92082171844 milliseconds before continuing the upload at offset 1379926016
Total file count: 1 ---- Processed file #0 (0.0%)
Finished backoff for retry #5, continuing with upload
Total file count: 1 ---- Processed file #0 (0.0%)
An error has been caught http-client index 0, retrying the upload
Error: read ECONNRESET
    at TLSWrap.onStreamRead (internal/stream_base_commons.js:201:27) {
  errno: 'ECONNRESET',
  code: 'ECONNRESET',
  syscall: 'read'
}
Retry limit has been reached for chunk at offset 1379926016 to https://pipelines.actions.githubusercontent.com/4D1poTSDSSApU42GXYeGgQX6WjHwGPK9ZzdaE2SeHdlUs0ZBhW/_apis/resources/Containers/3201477?itemPath=sage-local-commit-b2c012bfed0fb9414e0db531acc43a3abf1ae1ba-cygwin-standard%5Csage-local-iii.tar
##[warning]Aborting upload for C:\tools\cygwin\tmp\sage-local-iii.tar due to failure
Total size of all the files uploaded is 1379926016 bytes
```


In the same run, for https://github.com/mkoeppe/sage/runs/641394549 (`cygwin-standard-python2`), the upload of stage-iii succeeded,
and stage-iv-a ... stage-iv-d downloaded it successfully. 
- stage-iv-a (`make ptest`, https://github.com/mkoeppe/sage/runs/641394549) terminates, with a number of doctest errors and timeouts:
  {{{
sage -t src/doc/en/constructions/plotting.rst  # Timed out
sage -t src/doc/fr/tutorial/interfaces.rst  # 1 doctest failed
sage -t src/doc/ja/tutorial/interfaces.rst  # 2 doctests failed
sage -t src/doc/pt/tutorial/interfaces.rst  # Timed out
sage -t src/doc/ru/tutorial/interfaces.rst  # 6 doctests failed
sage -t src/sage/coding/binary_code.pyx  # Timed out
sage -t src/sage/doctest/control.py  # 1 doctest failed
sage -t src/sage/functions/log.py  # 1 doctest failed
sage -t src/sage/functions/orthogonal_polys.py  # 1 doctest failed
sage -t src/sage/functions/other.py  # 2 doctests failed
sage -t src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out
sage -t src/sage/interfaces/gap.py  # 1 doctest failed
sage -t src/sage/groups/class_function.py  # Timed out
sage -t src/sage/interfaces/giac.py  # 41 doctests failed
sage -t src/sage/libs/gap/element.pyx  # 1 doctest failed
sage -t src/sage/libs/glpk/error.pyx  # 2 doctests failed
sage -t src/sage/matrix/matrix1.pyx  # 1 doctest failed
sage -t src/sage/numerical/backends/glpk_backend.pyx  # 2 doctests failed
sage -t src/sage/parallel/map_reduce.py  # Timed out after testing finished
sage -t src/sage/repl/interpreter.py  # 3 doctests failed
sage -t src/sage/rings/number_field/number_field_element.pyx  # Timed out
sage -t src/sage/sandpiles/sandpile.py  # Timed out
sage -t src/sage/symbolic/constants.py  # 3 doctests failed
sage -t src/sage/symbolic/expression_conversions.py  # 1 doctest failed
sage -t src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t src/sage/tests/benchmark.py  # 2 doctests failed
sage -t src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphique_doctest.py  # 1 doctest failed
sage -t src/sage/tests/cmdline.py  # 3 doctests failed
  }}}
  Looks like the giac interface is broken. 

- stage-iv-b builds a few optional packages; I have noted build failures in some separate tickets.

- stage-iv-c builds `cbc`, `sage_numerical_backends_coin` successfully.

- stage-iv-d (https://github.com/mkoeppe/sage/runs/641394565) builds a long list of optional packages, times out;  I have noted build failures in some separate tickets.



---

archive/issue_comments_416788.json:
```json
{
    "body": "Needs review. Let's get this into 9.1 please",
    "created_at": "2020-05-04T17:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416788",
    "user": "mkoeppe"
}
```

Needs review. Let's get this into 9.1 please



---

archive/issue_comments_416789.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-05-04T17:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416789",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_416790.json:
```json
{
    "body": "this looks good; one minor question is how to get logs for particular failed spkg builds.\nIs the latter possible/documented, and I'm just not looking at the right place?",
    "created_at": "2020-05-04T18:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416790",
    "user": "dimpase"
}
```

this looks good; one minor question is how to get logs for particular failed spkg builds.
Is the latter possible/documented, and I'm just not looking at the right place?



---

archive/issue_comments_416791.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-04T18:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416791",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_416792.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> one minor question is how to get logs for particular failed spkg builds.\n> Is the latter possible/documented, and I'm just not looking at the right place?\n\nDo you see the artifact named \"logs-....\" in\nhttps://github.com/mkoeppe/sage/actions/runs/94565308?",
    "created_at": "2020-05-04T18:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416792",
    "user": "mkoeppe"
}
```

Replying to [comment:19 dimpase]:
> one minor question is how to get logs for particular failed spkg builds.
> Is the latter possible/documented, and I'm just not looking at the right place?

Do you see the artifact named "logs-...." in
https://github.com/mkoeppe/sage/actions/runs/94565308?



---

archive/issue_comments_416793.json:
```json
{
    "body": "It contains both the logs of all packages, \nand the contents of $SAGE_LOCAL/var/tmp/sage/build/ (all failed packages)",
    "created_at": "2020-05-04T18:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416793",
    "user": "mkoeppe"
}
```

It contains both the logs of all packages, 
and the contents of $SAGE_LOCAL/var/tmp/sage/build/ (all failed packages)



---

archive/issue_comments_416794.json:
```json
{
    "body": "Alternatively, if one does not want to download these huge log archives, one can open the section \"Print out logs for immediate inspection\" (for example in https://github.com/mkoeppe/sage/runs/641394520?check_suite_focus=true) to see logs of packages with errors. (This already works before artifacts are made available.)",
    "created_at": "2020-05-04T18:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416794",
    "user": "mkoeppe"
}
```

Alternatively, if one does not want to download these huge log archives, one can open the section "Print out logs for immediate inspection" (for example in https://github.com/mkoeppe/sage/runs/641394520?check_suite_focus=true) to see logs of packages with errors. (This already works before artifacts are made available.)



---

archive/issue_comments_416795.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> It contains both the logs of all packages, \n> and the contents of $SAGE_LOCAL/var/tmp/sage/build/ (all failed packages)\n> \nok - I only looked at \"view raw logs\" - and these are, despite the name, less complete than artefacts, right?",
    "created_at": "2020-05-04T19:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416795",
    "user": "dimpase"
}
```

Replying to [comment:21 mkoeppe]:
> It contains both the logs of all packages, 
> and the contents of $SAGE_LOCAL/var/tmp/sage/build/ (all failed packages)
> 
ok - I only looked at "view raw logs" - and these are, despite the name, less complete than artefacts, right?



---

archive/issue_comments_416796.json:
```json
{
    "body": "\"View raw logs\" just gives you what is displayed in the right pane. This is a [GitHub](GitHub) Actions feature.\nThe log artefacts have a lot more, from my scripts.",
    "created_at": "2020-05-04T19:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416796",
    "user": "mkoeppe"
}
```

"View raw logs" just gives you what is displayed in the right pane. This is a [GitHub](GitHub) Actions feature.
The log artefacts have a lot more, from my scripts.



---

archive/issue_comments_416797.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-05-06T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416797",
    "user": "mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_416798.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-07T22:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29385#issuecomment-416798",
    "user": "vbraun"
}
```

Resolution: fixed
