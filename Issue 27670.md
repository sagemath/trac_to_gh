# Issue 27670: Building gcc 7.2.0 fails on old systems because of crti.o

archive/issues_027670.json:
```json
{
    "body": "CC:  dimpase stumpc5 jdemeyer vbraun embray\n\nOn various Linux systems with old compilers, building gcc 7.2.0 fails because either crti.o is not found, or there is 32/64 bit ABI mismatch on the one that is found.\n\nReported for Red Hat 6.10 at https://groups.google.com/d/msg/sage-devel/ze5SzgXZAgk/tai9F4flBQAJ:\n\n```\n/lib/crti.o: could not read symbols: File in wrong format \n```\n\n\nOn a different system: CentOS Linux release 7.6.1810 (Core), there is only `/lib64/crti.o` and the gcc build does not find it and fails as well. \nFix for this system: \n\n```\nexport LIBRARY_PATH=\"/lib64\"\n```\n\nbefore building sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27907\n\n",
    "created_at": "2019-05-31T18:43:13Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Building gcc 7.2.0 fails on old systems because of crti.o",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27670",
    "user": "mkoeppe"
}
```
CC:  dimpase stumpc5 jdemeyer vbraun embray

On various Linux systems with old compilers, building gcc 7.2.0 fails because either crti.o is not found, or there is 32/64 bit ABI mismatch on the one that is found.

Reported for Red Hat 6.10 at https://groups.google.com/d/msg/sage-devel/ze5SzgXZAgk/tai9F4flBQAJ:

```
/lib/crti.o: could not read symbols: File in wrong format 
```


On a different system: CentOS Linux release 7.6.1810 (Core), there is only `/lib64/crti.o` and the gcc build does not find it and fails as well. 
Fix for this system: 

```
export LIBRARY_PATH="/lib64"
```

before building sage.

Issue created by migration from https://trac.sagemath.org/ticket/27907





---

archive/issue_comments_390617.json:
```json
{
    "body": "This is the same issue as I have -- I first also had the \"not found\" error, which turned into the one I reported after the sysadmin tried to provide that file (I don't know what he actually did).",
    "created_at": "2019-05-31T19:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390617",
    "user": "stumpc5"
}
```

This is the same issue as I have -- I first also had the "not found" error, which turned into the one I reported after the sysadmin tried to provide that file (I don't know what he actually did).



---

archive/issue_comments_390618.json:
```json
{
    "body": "Replying to [comment:1 stumpc5]:\n> This is the same issue as I have -- I first also had the \"not found\" error, which turned into the one I reported after the sysadmin tried to provide that file (I don't know what he actually did).\nThanks for the clarification.",
    "created_at": "2019-05-31T20:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390618",
    "user": "mkoeppe"
}
```

Replying to [comment:1 stumpc5]:
> This is the same issue as I have -- I first also had the "not found" error, which turned into the one I reported after the sysadmin tried to provide that file (I don't know what he actually did).
Thanks for the clarification.



---

archive/issue_comments_390619.json:
```json
{
    "body": "This appears to be a frequent problem. See for example https://stackoverflow.com/questions/91576/crti-o-file-missing and https://github.com/Homebrew/linuxbrew-core/issues/7172\n\nOn the CentOS system mentioned in the ticket's description, the system's gcc is actually configured correctly: `gcc -print-search-dirs` has a long list of paths that includes `/lib64` (= `/usr/lib64` on this system).\n\nThe folks at Linuxbrew do the following in https://github.com/Homebrew/linuxbrew-core/blob/master/Formula/gcc`@`7.rb:\n\n```\n        # Set the search path for glibc libraries and objects, using the system's glibc\n        # Fix the error: ld: cannot find crti.o: No such file or directory\n        ENV.prepend_path \"LIBRARY_PATH\", Pathname.new(Utils.popen_read(ENV.cc, \"-print-file-name=crti.o\")).parent\n```\n\nOn the CentOS system I can confirm that `gcc -print-file-name=crti.o` gives the correct file name. \nSo this may be a sound approach.",
    "created_at": "2019-05-31T21:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390619",
    "user": "mkoeppe"
}
```

This appears to be a frequent problem. See for example https://stackoverflow.com/questions/91576/crti-o-file-missing and https://github.com/Homebrew/linuxbrew-core/issues/7172

On the CentOS system mentioned in the ticket's description, the system's gcc is actually configured correctly: `gcc -print-search-dirs` has a long list of paths that includes `/lib64` (= `/usr/lib64` on this system).

The folks at Linuxbrew do the following in https://github.com/Homebrew/linuxbrew-core/blob/master/Formula/gcc`@`7.rb:

```
        # Set the search path for glibc libraries and objects, using the system's glibc
        # Fix the error: ld: cannot find crti.o: No such file or directory
        ENV.prepend_path "LIBRARY_PATH", Pathname.new(Utils.popen_read(ENV.cc, "-print-file-name=crti.o")).parent
```

On the CentOS system I can confirm that `gcc -print-file-name=crti.o` gives the correct file name. 
So this may be a sound approach.



---

archive/issue_comments_390620.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-01T17:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390620",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390621.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-01T17:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390621",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_390622.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-02T00:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390622",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-02T01:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390623",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390624.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-02T01:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390624",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390625.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-02T08:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390625",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390626.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-02T17:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390626",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390627.json:
```json
{
    "body": "Thank your for working on this!\nUnfortunately, your fix does not yet solve it for me:\n\n```\n[stumpcl2@dlp762 sage]$ CRTI=$(${CC:-gcc} -print-file-name=crti.o 2>/dev/null || true)\n[stumpcl2@dlp762 sage]$ echo $CRTI\n/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/crti.o\n[stumpcl2@dlp762 sage]$ if [ -n \"$CRTI\" ]; then\n>  CRTI_DIR=$(dirname -- \"$CRTI\")\n>  if [ -n \"$CRTI_DIR\" -a \"$CRTI_DIR\" != \".\" ]; then\n>  export LIBRARY_PATH=\"$LIBRARY_PATH:$CRTI_DIR\"\n>  fi\n> fi\n[stumpcl2@dlp762 sage]$ echo $CRTI_DIR\n/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64\n[stumpcl2@dlp762 sage]$ echo $LIBRARY_PATH\n/lib64:/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64\n```\n\nwhile building from scratch yields the error\n\n```\n[gcc-7.2.0] /usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/../lib/crti.o: could not read symbols: File in wrong format\n```\n\nSo it leaves `lib64` again and goes back to `lib` to look for `crti.o`.",
    "created_at": "2019-06-02T19:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390627",
    "user": "stumpc5"
}
```

Thank your for working on this!
Unfortunately, your fix does not yet solve it for me:

```
[stumpcl2@dlp762 sage]$ CRTI=$(${CC:-gcc} -print-file-name=crti.o 2>/dev/null || true)
[stumpcl2@dlp762 sage]$ echo $CRTI
/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/crti.o
[stumpcl2@dlp762 sage]$ if [ -n "$CRTI" ]; then
>  CRTI_DIR=$(dirname -- "$CRTI")
>  if [ -n "$CRTI_DIR" -a "$CRTI_DIR" != "." ]; then
>  export LIBRARY_PATH="$LIBRARY_PATH:$CRTI_DIR"
>  fi
> fi
[stumpcl2@dlp762 sage]$ echo $CRTI_DIR
/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64
[stumpcl2@dlp762 sage]$ echo $LIBRARY_PATH
/lib64:/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64
```

while building from scratch yields the error

```
[gcc-7.2.0] /usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/../lib/crti.o: could not read symbols: File in wrong format
```

So it leaves `lib64` again and goes back to `lib` to look for `crti.o`.



---

archive/issue_comments_390628.json:
```json
{
    "body": "I'd suggest to first check with your sysadmin what it is that he did to try to fix the original problem and to undo that.",
    "created_at": "2019-06-02T19:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390628",
    "user": "mkoeppe"
}
```

I'd suggest to first check with your sysadmin what it is that he did to try to fix the original problem and to undo that.



---

archive/issue_comments_390629.json:
```json
{
    "body": "> I'd suggest to first check with your sysadmin what it is that he did to try to fix the original problem and to undo that.\n\nWell, he installed `gcc-7.2.0` systemwide (and then also `gcc-7.3.0`). If I use either of these (making it available using `ini gcc`), I get the errors I originally reported on `sage-devel` (`gfan-0.6.2.p1`, `ppl-1.2.p1`). If I do not use that gcc, but the older `gcc-4.4.7`, the not-found-error turned into the given could-not-read-symbols-error.",
    "created_at": "2019-06-02T20:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390629",
    "user": "stumpc5"
}
```

> I'd suggest to first check with your sysadmin what it is that he did to try to fix the original problem and to undo that.

Well, he installed `gcc-7.2.0` systemwide (and then also `gcc-7.3.0`). If I use either of these (making it available using `ini gcc`), I get the errors I originally reported on `sage-devel` (`gfan-0.6.2.p1`, `ppl-1.2.p1`). If I do not use that gcc, but the older `gcc-4.4.7`, the not-found-error turned into the given could-not-read-symbols-error.



---

archive/issue_comments_390630.json:
```json
{
    "body": "OK, thanks for the clarification",
    "created_at": "2019-06-02T22:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390630",
    "user": "mkoeppe"
}
```

OK, thanks for the clarification



---

archive/issue_comments_390631.json:
```json
{
    "body": "Needs more work also for one of my systems, where it succeeds in building and installing gcc, but that gcc does not work without setting the LIBRARY_PATH variable during its runtime!",
    "created_at": "2019-06-02T23:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390631",
    "user": "mkoeppe"
}
```

Needs more work also for one of my systems, where it succeeds in building and installing gcc, but that gcc does not work without setting the LIBRARY_PATH variable during its runtime!



---

archive/issue_comments_390632.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> OK, thanks for the clarification\nCould you try the following: \n\n```\nfile /usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/crt*.o\n```\n",
    "created_at": "2019-06-02T23:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390632",
    "user": "mkoeppe"
}
```

Replying to [comment:17 mkoeppe]:
> OK, thanks for the clarification
Could you try the following: 

```
file /usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64/crt*.o
```




---

archive/issue_comments_390633.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> Needs more work also for one of my systems, where it succeeds in building and installing gcc, but that gcc does not work without setting the LIBRARY_PATH variable during its runtime!\n\nPossible solution, again from Linuxbrew:\n\n```\n      gcc = bin/\"gcc-7\"\n      libgcc = Pathname.new(Utils.popen_read(gcc, \"-print-libgcc-file-name\")).parent\n      raise \"command failed: #{gcc} -print-libgcc-file-name\" if $CHILD_STATUS.exitstatus.nonzero?\n\n      glibc = Formula[\"glibc\"]\n      glibc_installed = glibc.any_version_installed?\n\n      # Symlink crt1.o and friends where gcc can find it.\n      if glibc_installed\n        crtdir = glibc.opt_lib\n      else\n        crtdir = Pathname.new(Utils.popen_read(\"/usr/bin/cc\", \"-print-file-name=crti.o\")).parent\n      end\n      ln_sf Dir[crtdir/\"*crt?.o\"], libgcc\n\n```\n",
    "created_at": "2019-06-02T23:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390633",
    "user": "mkoeppe"
}
```

Replying to [comment:18 mkoeppe]:
> Needs more work also for one of my systems, where it succeeds in building and installing gcc, but that gcc does not work without setting the LIBRARY_PATH variable during its runtime!

Possible solution, again from Linuxbrew:

```
      gcc = bin/"gcc-7"
      libgcc = Pathname.new(Utils.popen_read(gcc, "-print-libgcc-file-name")).parent
      raise "command failed: #{gcc} -print-libgcc-file-name" if $CHILD_STATUS.exitstatus.nonzero?

      glibc = Formula["glibc"]
      glibc_installed = glibc.any_version_installed?

      # Symlink crt1.o and friends where gcc can find it.
      if glibc_installed
        crtdir = glibc.opt_lib
      else
        crtdir = Pathname.new(Utils.popen_read("/usr/bin/cc", "-print-file-name=crti.o")).parent
      end
      ln_sf Dir[crtdir/"*crt?.o"], libgcc

```




---

archive/issue_comments_390634.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-03T02:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390634",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390635.json:
```json
{
    "body": "Based on this `73be6cf`, the error becomes\n\n```\n[gcc-7.2.0] /usr/lib/../lib/crti.o: could not read symbols: File in wrong format\n```\n\nwith\n\n```\n[stumpcl2@dlp762 sage]$ file /usr/lib/../lib/crti.o\n/usr/lib/../lib/crti.o: ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped\n```\n",
    "created_at": "2019-06-03T07:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390635",
    "user": "stumpc5"
}
```

Based on this `73be6cf`, the error becomes

```
[gcc-7.2.0] /usr/lib/../lib/crti.o: could not read symbols: File in wrong format
```

with

```
[stumpcl2@dlp762 sage]$ file /usr/lib/../lib/crti.o
/usr/lib/../lib/crti.o: ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
```




---

archive/issue_comments_390636.json:
```json
{
    "body": "But what does `file /usr/lib64/crt*.o` give?",
    "created_at": "2019-06-03T07:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390636",
    "user": "mkoeppe"
}
```

But what does `file /usr/lib64/crt*.o` give?



---

archive/issue_comments_390637.json:
```json
{
    "body": "\n```\n[stumpcl2@dlp762 sage]$ file /usr/lib64/crt*.o\n/usr/lib64/crt1.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), for GNU/Linux 2.6.18, not stripped\n/usr/lib64/crti.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped\n/usr/lib64/crtn.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), stripped\n```\n",
    "created_at": "2019-06-03T07:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390637",
    "user": "stumpc5"
}
```


```
[stumpcl2@dlp762 sage]$ file /usr/lib64/crt*.o
/usr/lib64/crt1.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), for GNU/Linux 2.6.18, not stripped
/usr/lib64/crti.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped
/usr/lib64/crtn.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), stripped
```




---

archive/issue_comments_390638.json:
```json
{
    "body": "Could you attach the latest .log file?",
    "created_at": "2019-06-03T08:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390638",
    "user": "mkoeppe"
}
```

Could you attach the latest .log file?



---

archive/issue_comments_390639.json:
```json
{
    "body": "The current version works on the CentOS Linux system where I first encountered this problem.",
    "created_at": "2019-06-03T08:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390639",
    "user": "mkoeppe"
}
```

The current version works on the CentOS Linux system where I first encountered this problem.



---

archive/issue_comments_390640.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-03T08:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390640",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390641.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> Could you attach the latest .log file?\n\nposted on sage-devel",
    "created_at": "2019-06-03T08:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390641",
    "user": "stumpc5"
}
```

Replying to [comment:25 mkoeppe]:
> Could you attach the latest .log file?

posted on sage-devel



---

archive/issue_comments_390642.json:
```json
{
    "body": "Looks like configure was not regenerated. When you get a chance, please run ./bootstrap (this needs autotools installed...)\nIf it still fails, please post both config.log and the gcc-7.2.0.log",
    "created_at": "2019-06-04T00:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390642",
    "user": "mkoeppe"
}
```

Looks like configure was not regenerated. When you get a chance, please run ./bootstrap (this needs autotools installed...)
If it still fails, please post both config.log and the gcc-7.2.0.log



---

archive/issue_comments_390643.json:
```json
{
    "body": "This now also works for me compiling gcc-7.2.0, many thanks for fixing this! (Unfortunately, the next error occurred right after on Red Hat 6.10.",
    "created_at": "2019-06-04T14:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390643",
    "user": "stumpc5"
}
```

This now also works for me compiling gcc-7.2.0, many thanks for fixing this! (Unfortunately, the next error occurred right after on Red Hat 6.10.



---

archive/issue_comments_390644.json:
```json
{
    "body": "Let's please get this into the next beta so that this can be tested by people without having to regenerate the configure scripts.",
    "created_at": "2019-06-05T15:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390644",
    "user": "mkoeppe"
}
```

Let's please get this into the next beta so that this can be tested by people without having to regenerate the configure scripts.



---

archive/issue_comments_390645.json:
```json
{
    "body": "Yes, I agree. But do you see a way to auto-generate\n\n```\n# Location of system crti.o, in case we build our own gcc\nexport SAGE_CRTI_DIR=\"/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64\"\n```\n\nwhich I tweaked by hand?",
    "created_at": "2019-06-05T15:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390645",
    "user": "stumpc5"
}
```

Yes, I agree. But do you see a way to auto-generate

```
# Location of system crti.o, in case we build our own gcc
export SAGE_CRTI_DIR="/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64"
```

which I tweaked by hand?



---

archive/issue_comments_390646.json:
```json
{
    "body": "Replying to [comment:31 stumpc5]:\n> Yes, I agree. But do you see a way to auto-generate\n> {{{\n> # Location of system crti.o, in case we build our own gcc\n> export SAGE_CRTI_DIR=\"/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64\"\n> }}}\n> which I tweaked by hand?\nThe scripts already do all of that. Something is broken in your setup that stops your copy of sage from regenerating the autotools scripts correctly. For example, in the last set of logs you posted there is no trace of the crti test at configure time. After `make distclean` your copy of sage likely downloaded the configure scripts from the latest beta, instead of regenerating them.",
    "created_at": "2019-06-06T17:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390646",
    "user": "mkoeppe"
}
```

Replying to [comment:31 stumpc5]:
> Yes, I agree. But do you see a way to auto-generate
> {{{
> # Location of system crti.o, in case we build our own gcc
> export SAGE_CRTI_DIR="/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../lib64"
> }}}
> which I tweaked by hand?
The scripts already do all of that. Something is broken in your setup that stops your copy of sage from regenerating the autotools scripts correctly. For example, in the last set of logs you posted there is no trace of the crti test at configure time. After `make distclean` your copy of sage likely downloaded the configure scripts from the latest beta, instead of regenerating them.



---

archive/issue_comments_390647.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2019-06-06T17:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390647",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_390648.json:
```json
{
    "body": "could it be that the machine either has no autotools installed, or they are outdated/broken?",
    "created_at": "2019-06-06T17:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390648",
    "user": "dimpase"
}
```

could it be that the machine either has no autotools installed, or they are outdated/broken?



---

archive/issue_comments_390649.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> could it be that the machine either has no autotools installed, or they are outdated/broken?\nYes, that's my guess too.\n\nIn any case, I have tested this ticket on one of my machines that had the same problem.",
    "created_at": "2019-06-06T17:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390649",
    "user": "mkoeppe"
}
```

Replying to [comment:34 dimpase]:
> could it be that the machine either has no autotools installed, or they are outdated/broken?
Yes, that's my guess too.

In any case, I have tested this ticket on one of my machines that had the same problem.



---

archive/issue_comments_390650.json:
```json
{
    "body": "Regarding the `spkg-postinst`, could you please add a complementary `spkg-postrm` which removes the symlink, if it exists?",
    "created_at": "2019-06-07T18:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390650",
    "user": "embray"
}
```

Regarding the `spkg-postinst`, could you please add a complementary `spkg-postrm` which removes the symlink, if it exists?



---

archive/issue_comments_390651.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-19T22:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390651",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390652.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-19T23:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390652",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_390653.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-19T23:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390653",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-20T05:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390654",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-20T05:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390655",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-20T20:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390656",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T00:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390657",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T16:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390658",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390659.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T20:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390659",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390660.json:
```json
{
    "body": "Replying to [comment:36 embray]:\n> Regarding the `spkg-postinst`, could you please add a complementary `spkg-postrm` which removes the symlink, if it exists?\n\nTook me a while to find my way through this little maze of scripts.\nSeems to work now, the crt symlinks are now removed by the postrm script. Please take a look. \n\nI notice that after `make gcc-clean`, an empty chain of directories `gcc/x86_64-pc-linux-gnu/7.2.0/plugin/include/ada` remains under `$SAGE_LOCAL/lib`.\nI think it's unrelated to this ticket.",
    "created_at": "2019-06-22T00:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390660",
    "user": "mkoeppe"
}
```

Replying to [comment:36 embray]:
> Regarding the `spkg-postinst`, could you please add a complementary `spkg-postrm` which removes the symlink, if it exists?

Took me a while to find my way through this little maze of scripts.
Seems to work now, the crt symlinks are now removed by the postrm script. Please take a look. 

I notice that after `make gcc-clean`, an empty chain of directories `gcc/x86_64-pc-linux-gnu/7.2.0/plugin/include/ada` remains under `$SAGE_LOCAL/lib`.
I think it's unrelated to this ticket.



---

archive/issue_comments_390661.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-22T00:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390661",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390662.json:
```json
{
    "body": "Needs review.",
    "created_at": "2019-06-28T17:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390662",
    "user": "mkoeppe"
}
```

Needs review.



---

archive/issue_comments_390663.json:
```json
{
    "body": "I'm confused.  What you used to have as `spkg-postinst` you *renamed* to `spkg-postrm`, which is not what I intended.\n\nIt also now reads:\n\n\n```\n-spkg-postinst\n\\ No newline at end of file\n+# -*- mode: shell-script -*-\n+\n+# Force re-installation of gmp, mpir, mpfr and mpc with the GCC that we\n+# just built. This is needed in particular because gmp/mpir was first\n+# built without C++ support.\n```\n\n\nThis script is run *after* you *uninstall* a package, so the comment about \"the GCC that we just built\" can't be accurate (it was accurate for when this was a `postinst` script.\n\nI will have to take more time to actually understand what you're trying to do here.  As it is I believe we are spending too much technical debt on trying to maintain gcc builds for old platforms...",
    "created_at": "2019-07-01T12:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390663",
    "user": "embray"
}
```

I'm confused.  What you used to have as `spkg-postinst` you *renamed* to `spkg-postrm`, which is not what I intended.

It also now reads:


```
-spkg-postinst
\ No newline at end of file
+# -*- mode: shell-script -*-
+
+# Force re-installation of gmp, mpir, mpfr and mpc with the GCC that we
+# just built. This is needed in particular because gmp/mpir was first
+# built without C++ support.
```


This script is run *after* you *uninstall* a package, so the comment about "the GCC that we just built" can't be accurate (it was accurate for when this was a `postinst` script.

I will have to take more time to actually understand what you're trying to do here.  As it is I believe we are spending too much technical debt on trying to maintain gcc builds for old platforms...



---

archive/issue_comments_390664.json:
```json
{
    "body": "Also I wonder if we could base this on top of #21707?  (Not to add additional hurdles to this ticket, as I want to move forward on #21707 ASAP as the number of build-related variables in sage-env-config is starting to get out of hand :)",
    "created_at": "2019-07-01T12:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390664",
    "user": "embray"
}
```

Also I wonder if we could base this on top of #21707?  (Not to add additional hurdles to this ticket, as I want to move forward on #21707 ASAP as the number of build-related variables in sage-env-config is starting to get out of hand :)



---

archive/issue_comments_390665.json:
```json
{
    "body": "Went ahead and rebased on current develop so it could incorporate all the additional variables we've since added.\n\nI didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.\n----\nNew commits:",
    "created_at": "2019-07-01T12:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390665",
    "user": "embray"
}
```

Went ahead and rebased on current develop so it could incorporate all the additional variables we've since added.

I didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.
----
New commits:



---

archive/issue_comments_390666.json:
```json
{
    "body": "Ack! Wrong ticket, sorry.\n----\nLast 10 new commits:",
    "created_at": "2019-07-01T12:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390666",
    "user": "embray"
}
```

Ack! Wrong ticket, sorry.
----
Last 10 new commits:



---

archive/issue_comments_390667.json:
```json
{
    "body": "On fedora 30 (gcc 9) I'm also getting\n\n```\n[gcc-7.2.0] /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/bin/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/lib/ -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/include -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/sys-include    -O2  -g -O2 -DIN_GCC    -W -Wall -Wno-narrowing -Wwrite-strings -Wcast-qual -Wno-format -Wstrict-prototypes -Wmissing-prototypes -Wold-style-definition  -isystem ./include   -fpic -mlong-double-80 -DUSE_ELF_SYMVER -g -DIN_LIBGCC2 -fbuilding-libgcc -fno-stack-protector  -shared -nodefaultlibs -Wl,--soname=libgcc_s.so.1 -Wl,--version-script=libgcc.map -o ./libgcc_s.so.1.tmp -g -O2 -B./ _muldi3_s.o _negdi2_s.o _lshrdi3_s.o _ashldi3_s.o _ashrdi3_s.o _cmpdi2_s.o _ucmpdi2_s.o _clear_cache_s.o _trampoline_s.o __main_s.o _absvsi2_s.o _absvdi2_s.o _addvsi3_s.o _addvdi3_s.o _subvsi3_s.o _subvdi3_s.o _mulvsi3_s.o _mulvdi3_s.o _negvsi2_s.o _negvdi2_s.o _ctors_s.o _ffssi2_s.o _ffsdi2_s.o _clz_s.o _clzsi2_s.o _clzdi2_s.o _ctzsi2_s.o _ctzdi2_s.o _popcount_tab_s.o _popcountsi2_s.o _popcountdi2_s.o _paritysi2_s.o _paritydi2_s.o _powisf2_s.o _powidf2_s.o _powixf2_s.o _mulhc3_s.o _mulsc3_s.o _muldc3_s.o _mulxc3_s.o _divhc3_s.o _divsc3_s.o _divdc3_s.o _divxc3_s.o _bswapsi2_s.o _bswapdi2_s.o _clrsbsi2_s.o _clrsbdi2_s.o _fixunssfsi_s.o _fixunsdfsi_s.o _fixunsxfsi_s.o _fixsfdi_s.o _fixdfdi_s.o _fixxfdi_s.o _fixunssfdi_s.o _fixunsdfdi_s.o _fixunsxfdi_s.o _floatdisf_s.o _floatdidf_s.o _floatdixf_s.o _floatundisf_s.o _floatundidf_s.o _floatundixf_s.o _divdi3_s.o _moddi3_s.o _divmoddi4_s.o _udivdi3_s.o _umoddi3_s.o _udivmoddi4_s.o _udiv_w_sdiv_s.o cpuinfo_s.o sfp-exceptions_s.o addtf3_s.o divtf3_s.o multf3_s.o negtf2_s.o subtf3_s.o unordtf2_s.o fixtfsi_s.o fixunstfsi_s.o floatsitf_s.o floatunsitf_s.o fixtfdi_s.o fixunstfdi_s.o floatditf_s.o floatunditf_s.o fixtfti_s.o fixunstfti_s.o floattitf_s.o floatuntitf_s.o extendsftf2_s.o extenddftf2_s.o extendxftf2_s.o trunctfsf2_s.o trunctfdf2_s.o trunctfxf2_s.o getf2_s.o letf2_s.o eqtf2_s.o _divtc3_s.o _multc3_s.o _powitf2_s.o enable-execute-stack_s.o unwind-dw2_s.o unwind-dw2-fde-dip_s.o unwind-sjlj_s.o unwind-c_s.o emutls_s.o libgcc.a -lc && rm -f ./libgcc_s.so && if [ -f ./libgcc_s.so.1 ]; then mv -f ./libgcc_s.so.1 ./libgcc_s.so.1.backup; else true; fi && mv ./libgcc_s.so.1.tmp ./libgcc_s.so.1 && (echo \"/* GNU ld script\"; echo \"   Use the shared library, but some functions are only in\"; echo \"   the static library.  */\"; echo \"GROUP ( libgcc_s.so.1 -lgcc )\" ) > ./libgcc_s.so\n[gcc-7.2.0] /usr/bin/ld: cannot find crti.o: No such file or directory\n[gcc-7.2.0] collect2: error: ld returned 1 exit status\n[gcc-7.2.0] make[9]: *** [Makefile:982: libgcc_s.so] Error 1\n```\n\nFor the record, its `/lib64/crti.o`\n\n```\n[release@zen Sage]$ cc -print-file-name=crti.o\n/usr/lib/gcc/x86_64-redhat-linux/9/../../../../lib64/crti.o\n```\n",
    "created_at": "2019-07-01T18:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390667",
    "user": "vbraun"
}
```

On fedora 30 (gcc 9) I'm also getting

```
[gcc-7.2.0] /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/bin/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/lib/ -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/include -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/sys-include    -O2  -g -O2 -DIN_GCC    -W -Wall -Wno-narrowing -Wwrite-strings -Wcast-qual -Wno-format -Wstrict-prototypes -Wmissing-prototypes -Wold-style-definition  -isystem ./include   -fpic -mlong-double-80 -DUSE_ELF_SYMVER -g -DIN_LIBGCC2 -fbuilding-libgcc -fno-stack-protector  -shared -nodefaultlibs -Wl,--soname=libgcc_s.so.1 -Wl,--version-script=libgcc.map -o ./libgcc_s.so.1.tmp -g -O2 -B./ _muldi3_s.o _negdi2_s.o _lshrdi3_s.o _ashldi3_s.o _ashrdi3_s.o _cmpdi2_s.o _ucmpdi2_s.o _clear_cache_s.o _trampoline_s.o __main_s.o _absvsi2_s.o _absvdi2_s.o _addvsi3_s.o _addvdi3_s.o _subvsi3_s.o _subvdi3_s.o _mulvsi3_s.o _mulvdi3_s.o _negvsi2_s.o _negvdi2_s.o _ctors_s.o _ffssi2_s.o _ffsdi2_s.o _clz_s.o _clzsi2_s.o _clzdi2_s.o _ctzsi2_s.o _ctzdi2_s.o _popcount_tab_s.o _popcountsi2_s.o _popcountdi2_s.o _paritysi2_s.o _paritydi2_s.o _powisf2_s.o _powidf2_s.o _powixf2_s.o _mulhc3_s.o _mulsc3_s.o _muldc3_s.o _mulxc3_s.o _divhc3_s.o _divsc3_s.o _divdc3_s.o _divxc3_s.o _bswapsi2_s.o _bswapdi2_s.o _clrsbsi2_s.o _clrsbdi2_s.o _fixunssfsi_s.o _fixunsdfsi_s.o _fixunsxfsi_s.o _fixsfdi_s.o _fixdfdi_s.o _fixxfdi_s.o _fixunssfdi_s.o _fixunsdfdi_s.o _fixunsxfdi_s.o _floatdisf_s.o _floatdidf_s.o _floatdixf_s.o _floatundisf_s.o _floatundidf_s.o _floatundixf_s.o _divdi3_s.o _moddi3_s.o _divmoddi4_s.o _udivdi3_s.o _umoddi3_s.o _udivmoddi4_s.o _udiv_w_sdiv_s.o cpuinfo_s.o sfp-exceptions_s.o addtf3_s.o divtf3_s.o multf3_s.o negtf2_s.o subtf3_s.o unordtf2_s.o fixtfsi_s.o fixunstfsi_s.o floatsitf_s.o floatunsitf_s.o fixtfdi_s.o fixunstfdi_s.o floatditf_s.o floatunditf_s.o fixtfti_s.o fixunstfti_s.o floattitf_s.o floatuntitf_s.o extendsftf2_s.o extenddftf2_s.o extendxftf2_s.o trunctfsf2_s.o trunctfdf2_s.o trunctfxf2_s.o getf2_s.o letf2_s.o eqtf2_s.o _divtc3_s.o _multc3_s.o _powitf2_s.o enable-execute-stack_s.o unwind-dw2_s.o unwind-dw2-fde-dip_s.o unwind-sjlj_s.o unwind-c_s.o emutls_s.o libgcc.a -lc && rm -f ./libgcc_s.so && if [ -f ./libgcc_s.so.1 ]; then mv -f ./libgcc_s.so.1 ./libgcc_s.so.1.backup; else true; fi && mv ./libgcc_s.so.1.tmp ./libgcc_s.so.1 && (echo "/* GNU ld script"; echo "   Use the shared library, but some functions are only in"; echo "   the static library.  */"; echo "GROUP ( libgcc_s.so.1 -lgcc )" ) > ./libgcc_s.so
[gcc-7.2.0] /usr/bin/ld: cannot find crti.o: No such file or directory
[gcc-7.2.0] collect2: error: ld returned 1 exit status
[gcc-7.2.0] make[9]: *** [Makefile:982: libgcc_s.so] Error 1
```

For the record, its `/lib64/crti.o`

```
[release@zen Sage]$ cc -print-file-name=crti.o
/usr/lib/gcc/x86_64-redhat-linux/9/../../../../lib64/crti.o
```




---

archive/issue_comments_390668.json:
```json
{
    "body": "Replying to [comment:51 vbraun]:\n> On fedora 30 (gcc 9) I'm also getting\n> {{{\n> [gcc-7.2.0] /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/bin/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/lib/ -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/include -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/sys-include    -O2  -g -O2 -DIN_GCC    -W -Wall -Wno-narrowing -Wwrite-strings -Wcast-qual -Wno-format -Wstrict-prototypes -Wmissing-prototypes -Wold-style-definition  -isystem ./include   -fpic -mlong-double-80 -DUSE_ELF_SYMVER -g -DIN_LIBGCC2 -fbuilding-libgcc -fno-stack-protector  -shared -nodefaultlibs -Wl,--soname=libgcc_s.so.1 -Wl,--version-script=libgcc.map -o ./libgcc_s.so.1.tmp -g -O2 -B./ _muldi3_s.o _negdi2_s.o _lshrdi3_s.o _ashldi3_s.o _ashrdi3_s.o _cmpdi2_s.o _ucmpdi2_s.o _clear_cache_s.o _trampoline_s.o __main_s.o _absvsi2_s.o _absvdi2_s.o _addvsi3_s.o _addvdi3_s.o _subvsi3_s.o _subvdi3_s.o _mulvsi3_s.o _mulvdi3_s.o _negvsi2_s.o _negvdi2_s.o _ctors_s.o _ffssi2_s.o _ffsdi2_s.o _clz_s.o _clzsi2_s.o _clzdi2_s.o _ctzsi2_s.o _ctzdi2_s.o _popcount_tab_s.o _popcountsi2_s.o _popcountdi2_s.o _paritysi2_s.o _paritydi2_s.o _powisf2_s.o _powidf2_s.o _powixf2_s.o _mulhc3_s.o _mulsc3_s.o _muldc3_s.o _mulxc3_s.o _divhc3_s.o _divsc3_s.o _divdc3_s.o _divxc3_s.o _bswapsi2_s.o _bswapdi2_s.o _clrsbsi2_s.o _clrsbdi2_s.o _fixunssfsi_s.o _fixunsdfsi_s.o _fixunsxfsi_s.o _fixsfdi_s.o _fixdfdi_s.o _fixxfdi_s.o _fixunssfdi_s.o _fixunsdfdi_s.o _fixunsxfdi_s.o _floatdisf_s.o _floatdidf_s.o _floatdixf_s.o _floatundisf_s.o _floatundidf_s.o _floatundixf_s.o _divdi3_s.o _moddi3_s.o _divmoddi4_s.o _udivdi3_s.o _umoddi3_s.o _udivmoddi4_s.o _udiv_w_sdiv_s.o cpuinfo_s.o sfp-exceptions_s.o addtf3_s.o divtf3_s.o multf3_s.o negtf2_s.o subtf3_s.o unordtf2_s.o fixtfsi_s.o fixunstfsi_s.o floatsitf_s.o floatunsitf_s.o fixtfdi_s.o fixunstfdi_s.o floatditf_s.o floatunditf_s.o fixtfti_s.o fixunstfti_s.o floattitf_s.o floatuntitf_s.o extendsftf2_s.o extenddftf2_s.o extendxftf2_s.o trunctfsf2_s.o trunctfdf2_s.o trunctfxf2_s.o getf2_s.o letf2_s.o eqtf2_s.o _divtc3_s.o _multc3_s.o _powitf2_s.o enable-execute-stack_s.o unwind-dw2_s.o unwind-dw2-fde-dip_s.o unwind-sjlj_s.o unwind-c_s.o emutls_s.o libgcc.a -lc && rm -f ./libgcc_s.so && if [ -f ./libgcc_s.so.1 ]; then mv -f ./libgcc_s.so.1 ./libgcc_s.so.1.backup; else true; fi && mv ./libgcc_s.so.1.tmp ./libgcc_s.so.1 && (echo \"/* GNU ld script\"; echo \"   Use the shared library, but some functions are only in\"; echo \"   the static library.  */\"; echo \"GROUP ( libgcc_s.so.1 -lgcc )\" ) > ./libgcc_s.so\n> [gcc-7.2.0] /usr/bin/ld: cannot find crti.o: No such file or directory\n> [gcc-7.2.0] collect2: error: ld returned 1 exit status\n> [gcc-7.2.0] make[9]: *** [Makefile:982: libgcc_s.so] Error 1\n> }}}\n> For the record, its `/lib64/crti.o`\n> {{{\n> [release`@`zen Sage]$ cc -print-file-name=crti.o\n> /usr/lib/gcc/x86_64-redhat-linux/9/../../../../lib64/crti.o\n> }}}\nHas `CRTI_DIR` been set correctly in `src/bin/sage-env-config` on this system?",
    "created_at": "2019-07-01T18:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390668",
    "user": "mkoeppe"
}
```

Replying to [comment:51 vbraun]:
> On fedora 30 (gcc 9) I'm also getting
> {{{
> [gcc-7.2.0] /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/bin/ -B/home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/lib/ -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/include -isystem /home/buildbot-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas39/local/x86_64-pc-linux-gnu/sys-include    -O2  -g -O2 -DIN_GCC    -W -Wall -Wno-narrowing -Wwrite-strings -Wcast-qual -Wno-format -Wstrict-prototypes -Wmissing-prototypes -Wold-style-definition  -isystem ./include   -fpic -mlong-double-80 -DUSE_ELF_SYMVER -g -DIN_LIBGCC2 -fbuilding-libgcc -fno-stack-protector  -shared -nodefaultlibs -Wl,--soname=libgcc_s.so.1 -Wl,--version-script=libgcc.map -o ./libgcc_s.so.1.tmp -g -O2 -B./ _muldi3_s.o _negdi2_s.o _lshrdi3_s.o _ashldi3_s.o _ashrdi3_s.o _cmpdi2_s.o _ucmpdi2_s.o _clear_cache_s.o _trampoline_s.o __main_s.o _absvsi2_s.o _absvdi2_s.o _addvsi3_s.o _addvdi3_s.o _subvsi3_s.o _subvdi3_s.o _mulvsi3_s.o _mulvdi3_s.o _negvsi2_s.o _negvdi2_s.o _ctors_s.o _ffssi2_s.o _ffsdi2_s.o _clz_s.o _clzsi2_s.o _clzdi2_s.o _ctzsi2_s.o _ctzdi2_s.o _popcount_tab_s.o _popcountsi2_s.o _popcountdi2_s.o _paritysi2_s.o _paritydi2_s.o _powisf2_s.o _powidf2_s.o _powixf2_s.o _mulhc3_s.o _mulsc3_s.o _muldc3_s.o _mulxc3_s.o _divhc3_s.o _divsc3_s.o _divdc3_s.o _divxc3_s.o _bswapsi2_s.o _bswapdi2_s.o _clrsbsi2_s.o _clrsbdi2_s.o _fixunssfsi_s.o _fixunsdfsi_s.o _fixunsxfsi_s.o _fixsfdi_s.o _fixdfdi_s.o _fixxfdi_s.o _fixunssfdi_s.o _fixunsdfdi_s.o _fixunsxfdi_s.o _floatdisf_s.o _floatdidf_s.o _floatdixf_s.o _floatundisf_s.o _floatundidf_s.o _floatundixf_s.o _divdi3_s.o _moddi3_s.o _divmoddi4_s.o _udivdi3_s.o _umoddi3_s.o _udivmoddi4_s.o _udiv_w_sdiv_s.o cpuinfo_s.o sfp-exceptions_s.o addtf3_s.o divtf3_s.o multf3_s.o negtf2_s.o subtf3_s.o unordtf2_s.o fixtfsi_s.o fixunstfsi_s.o floatsitf_s.o floatunsitf_s.o fixtfdi_s.o fixunstfdi_s.o floatditf_s.o floatunditf_s.o fixtfti_s.o fixunstfti_s.o floattitf_s.o floatuntitf_s.o extendsftf2_s.o extenddftf2_s.o extendxftf2_s.o trunctfsf2_s.o trunctfdf2_s.o trunctfxf2_s.o getf2_s.o letf2_s.o eqtf2_s.o _divtc3_s.o _multc3_s.o _powitf2_s.o enable-execute-stack_s.o unwind-dw2_s.o unwind-dw2-fde-dip_s.o unwind-sjlj_s.o unwind-c_s.o emutls_s.o libgcc.a -lc && rm -f ./libgcc_s.so && if [ -f ./libgcc_s.so.1 ]; then mv -f ./libgcc_s.so.1 ./libgcc_s.so.1.backup; else true; fi && mv ./libgcc_s.so.1.tmp ./libgcc_s.so.1 && (echo "/* GNU ld script"; echo "   Use the shared library, but some functions are only in"; echo "   the static library.  */"; echo "GROUP ( libgcc_s.so.1 -lgcc )" ) > ./libgcc_s.so
> [gcc-7.2.0] /usr/bin/ld: cannot find crti.o: No such file or directory
> [gcc-7.2.0] collect2: error: ld returned 1 exit status
> [gcc-7.2.0] make[9]: *** [Makefile:982: libgcc_s.so] Error 1
> }}}
> For the record, its `/lib64/crti.o`
> {{{
> [release`@`zen Sage]$ cc -print-file-name=crti.o
> /usr/lib/gcc/x86_64-redhat-linux/9/../../../../lib64/crti.o
> }}}
Has `CRTI_DIR` been set correctly in `src/bin/sage-env-config` on this system?



---

archive/issue_comments_390669.json:
```json
{
    "body": "Replying to [comment:47 embray]:\n> I'm confused.  What you used to have as `spkg-postinst` you *renamed* to `spkg-postrm`, which is not what I intended.\n\nBefore this ticket, `spkg-postrm` was a symlink to `spkg-postinst`. \nIn both `spkg-postrm` and `spkg-postinst`, the same actions (trigger uninstalls, reconfigure) are taken.\n\nI added additional things to the front of `spkg-postinst`.\n\n(The diff does not show this very well.)",
    "created_at": "2019-07-01T18:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390669",
    "user": "mkoeppe"
}
```

Replying to [comment:47 embray]:
> I'm confused.  What you used to have as `spkg-postinst` you *renamed* to `spkg-postrm`, which is not what I intended.

Before this ticket, `spkg-postrm` was a symlink to `spkg-postinst`. 
In both `spkg-postrm` and `spkg-postinst`, the same actions (trigger uninstalls, reconfigure) are taken.

I added additional things to the front of `spkg-postinst`.

(The diff does not show this very well.)



---

archive/issue_comments_390670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-01T18:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390671.json:
```json
{
    "body": "Replying to [comment:47 embray]:\n> [...] `spkg-postrm`  [...] is run *after* you *uninstall* a package, so the comment about \"the GCC that we just built\" can't be accurate\n\nI have updated the explanation in `spkg-postrm`.\n(Actually, in the `spkg-postrm` situation, I don't know why `--keep-files` would be used; but it's beyond the scope of this ticket to change it.)",
    "created_at": "2019-07-01T18:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390671",
    "user": "mkoeppe"
}
```

Replying to [comment:47 embray]:
> [...] `spkg-postrm`  [...] is run *after* you *uninstall* a package, so the comment about "the GCC that we just built" can't be accurate

I have updated the explanation in `spkg-postrm`.
(Actually, in the `spkg-postrm` situation, I don't know why `--keep-files` would be used; but it's beyond the scope of this ticket to change it.)



---

archive/issue_comments_390672.json:
```json
{
    "body": "Got it--this is starting to make sense to me now.  The part where you actually *modify* the the postrm script on the fly is interesting: That was not an explicitly supported use case, so it makes me a little nervous (since it means now we *do* have to support that), but if it works it works.\n\nIf for some reason we need to change things such that it would not be easy to support this usage, I believe a different solution could be found.",
    "created_at": "2019-07-02T12:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390672",
    "user": "embray"
}
```

Got it--this is starting to make sense to me now.  The part where you actually *modify* the the postrm script on the fly is interesting: That was not an explicitly supported use case, so it makes me a little nervous (since it means now we *do* have to support that), but if it works it works.

If for some reason we need to change things such that it would not be easy to support this usage, I believe a different solution could be found.



---

archive/issue_comments_390673.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390673",
    "user": "embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_390674.json:
```json
{
    "body": "I would just unconditionally delete `*crt?.o` in the postrm script, more predictable and fewer moving parts. But either way is imho an acceptable solution, unless Eric objects I'm going to go ahead with this ticket....",
    "created_at": "2019-07-05T12:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390674",
    "user": "vbraun"
}
```

I would just unconditionally delete `*crt?.o` in the postrm script, more predictable and fewer moving parts. But either way is imho an acceptable solution, unless Eric objects I'm going to go ahead with this ticket....



---

archive/issue_comments_390675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-18T07:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390675",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-20T09:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390676",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_390677.json:
```json
{
    "body": "`@`stumpc5 Merged in 8.9.beta4, please test",
    "created_at": "2019-08-02T17:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-390677",
    "user": "mkoeppe"
}
```

`@`stumpc5 Merged in 8.9.beta4, please test
