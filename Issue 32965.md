# Issue 32965: tox -e relint: Do not complain about imports from sage.categories.all

archive/issues_032965.json:
```json
{
    "body": "CC:  klee chapoton tscrim @tobiasdiez\n\n`sage.categories` is a namespace package: The most basic categories needed for coercion are distributed in **sagemath-objects**; everything else in **sagemath-categories**.\n\nWe declare imports from `sage.categories.all` to be OK.\n\nCategories are supposed to be abstract - so there should not be compile-time or module-load-time dependencies.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33202\n\n",
    "created_at": "2022-01-17T20:32:19Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "tox -e relint: Do not complain about imports from sage.categories.all",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32965",
    "user": "mkoeppe"
}
```
CC:  klee chapoton tscrim @tobiasdiez

`sage.categories` is a namespace package: The most basic categories needed for coercion are distributed in **sagemath-objects**; everything else in **sagemath-categories**.

We declare imports from `sage.categories.all` to be OK.

Categories are supposed to be abstract - so there should not be compile-time or module-load-time dependencies.

Issue created by migration from https://trac.sagemath.org/ticket/33202





---

archive/issue_comments_470110.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-01-17T20:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470110",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_470111.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-17T20:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470111",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_470112.json:
```json
{
    "body": "I don't quite understand your \"rationale\". Can you please expand on what these all imports have to do with dependencies?\n\nOne of the problems with all imports is that this loads all modules referenced from the `all` module, potentially leading to cyclic imports and decreased performance. This also applies to the categories package, so I don't see why this should be an exception.",
    "created_at": "2022-01-18T12:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470112",
    "user": "@tobiasdiez"
}
```

I don't quite understand your "rationale". Can you please expand on what these all imports have to do with dependencies?

One of the problems with all imports is that this loads all modules referenced from the `all` module, potentially leading to cyclic imports and decreased performance. This also applies to the categories package, so I don't see why this should be an exception.



---

archive/issue_comments_470113.json:
```json
{
    "body": "Replying to [comment:4 gh-tobiasdiez]:\n> One of the problems with all imports is that this loads all modules referenced from the `all` module, potentially leading to cyclic imports and decreased performance. This also applies to the categories package, so I don't see why this should be an exception.\n\nAll of this is true both for namespace packages and ordinary packages.\n\nThe policy to avoid `.all` imports is specifically for namespace packages and is motivated not by these issues, but rather by the modularization effort. The documentation added in #32899 explains this - https://github.com/sagemath/sage/blob/develop/src/doc/en/developer/packaging_sage_library.rst#module-level-runtime-dependencies",
    "created_at": "2022-01-18T21:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470113",
    "user": "mkoeppe"
}
```

Replying to [comment:4 gh-tobiasdiez]:
> One of the problems with all imports is that this loads all modules referenced from the `all` module, potentially leading to cyclic imports and decreased performance. This also applies to the categories package, so I don't see why this should be an exception.

All of this is true both for namespace packages and ordinary packages.

The policy to avoid `.all` imports is specifically for namespace packages and is motivated not by these issues, but rather by the modularization effort. The documentation added in #32899 explains this - https://github.com/sagemath/sage/blob/develop/src/doc/en/developer/packaging_sage_library.rst#module-level-runtime-dependencies



---

archive/issue_comments_470114.json:
```json
{
    "body": "Thanks for the explanation but I still don't get why there is a distinction between namespace packages and ordinary packages when it comes to the `all` import.\nThe docs you referred to also only mention\n> The main purpose of the :mod:`*.all` modules is for populating the global interactive environment that is available to users at the sage: prompt. \n\nas the reason why `all` should be avoided, but this should also apply to ordinary packages, and to the categories in particular.\n\nBut since we seem to agree that `all` imports should be avoided in general, what about adding a second relint rule matching all such imports (for all sage modules) with `error: false` to mark it as a warning for now. Maybe also then reduce the existing rule to only those imports that are already no longer used (or for which there exists tickets), which has the positive side-effect that the linter is green again. This would be similar to the pycodestyle rules, for which we have a minimal and maximal config.",
    "created_at": "2022-01-19T10:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470114",
    "user": "@tobiasdiez"
}
```

Thanks for the explanation but I still don't get why there is a distinction between namespace packages and ordinary packages when it comes to the `all` import.
The docs you referred to also only mention
> The main purpose of the :mod:`*.all` modules is for populating the global interactive environment that is available to users at the sage: prompt. 

as the reason why `all` should be avoided, but this should also apply to ordinary packages, and to the categories in particular.

But since we seem to agree that `all` imports should be avoided in general, what about adding a second relint rule matching all such imports (for all sage modules) with `error: false` to mark it as a warning for now. Maybe also then reduce the existing rule to only those imports that are already no longer used (or for which there exists tickets), which has the positive side-effect that the linter is green again. This would be similar to the pycodestyle rules, for which we have a minimal and maximal config.



---

archive/issue_comments_470115.json:
```json
{
    "body": "Replying to [comment:6 gh-tobiasdiez]:\n> I still don't get why there is a distinction between namespace packages and ordinary packages when it comes to the `all` import.\n> The docs you referred to also only mention\n> > The main purpose of the :mod:`*.all` modules is for populating the global interactive environment that is available to users at the sage: prompt. \n\nThe whole section leading to this little paragraph explains why managing dependencies is necessary for the modularization. \n\nFor a namespace package, if not all distributions that fill it are installed, then the `.all` module cannot be successfully imported.\n\nAn ordinary package is provided by a single distribution; so if the `.all` module is present, it can also be imported. Yes, importing it may import more than what is needed. But it works and this is the status quo in Sage.\n\nThe purpose of the linting rule is to enforce what is necessary for the modularization. It is mildly inconvenient for developers, but because it is necessary for the modularization to work, it is sufficiently motivated.\n\n> since we seem to agree that `all` imports should be avoided in general\n\nNo, for example there's little point in replacing `from sage.plot.all import ....` by more specific imports. When you starting plotting stuff, it's likely that you need most of the modules in this package.",
    "created_at": "2022-01-19T16:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470115",
    "user": "mkoeppe"
}
```

Replying to [comment:6 gh-tobiasdiez]:
> I still don't get why there is a distinction between namespace packages and ordinary packages when it comes to the `all` import.
> The docs you referred to also only mention
> > The main purpose of the :mod:`*.all` modules is for populating the global interactive environment that is available to users at the sage: prompt. 

The whole section leading to this little paragraph explains why managing dependencies is necessary for the modularization. 

For a namespace package, if not all distributions that fill it are installed, then the `.all` module cannot be successfully imported.

An ordinary package is provided by a single distribution; so if the `.all` module is present, it can also be imported. Yes, importing it may import more than what is needed. But it works and this is the status quo in Sage.

The purpose of the linting rule is to enforce what is necessary for the modularization. It is mildly inconvenient for developers, but because it is necessary for the modularization to work, it is sufficiently motivated.

> since we seem to agree that `all` imports should be avoided in general

No, for example there's little point in replacing `from sage.plot.all import ....` by more specific imports. When you starting plotting stuff, it's likely that you need most of the modules in this package.



---

archive/issue_comments_470116.json:
```json
{
    "body": "Okay, thanks I think I start to understand now.\n\nBut how is `categories.all` now different? If I understand the ticket description correctly, you are saying that not everything in categories is distributed in sagemath-objects. So if another module imports things in sagemath-objects through `categories.all`, then it needs sagemath-categories as dependency.\n\n\n> No, for example there's little point in replacing from sage.plot.all import .... by more specific imports. \n\nExcept for that it would align with general Python conventions, would be more coherent (why should one care about ordinary packages vs namespace packages while importing?) and future-proof (who knows what will be added to plot in the future...). Also `plot.all` contains a few things like animated plots or special plot for matrices that one probably doesn't need if all one wants to do is plot a line.",
    "created_at": "2022-01-22T20:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32965#issuecomment-470116",
    "user": "@tobiasdiez"
}
```

Okay, thanks I think I start to understand now.

But how is `categories.all` now different? If I understand the ticket description correctly, you are saying that not everything in categories is distributed in sagemath-objects. So if another module imports things in sagemath-objects through `categories.all`, then it needs sagemath-categories as dependency.


> No, for example there's little point in replacing from sage.plot.all import .... by more specific imports. 

Except for that it would align with general Python conventions, would be more coherent (why should one care about ordinary packages vs namespace packages while importing?) and future-proof (who knows what will be added to plot in the future...). Also `plot.all` contains a few things like animated plots or special plot for matrices that one probably doesn't need if all one wants to do is plot a line.
