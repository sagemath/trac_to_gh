# Issue 32092: Needing to interrupt when computing integral for answer

Issue created by migration from https://trac.sagemath.org/ticket/32329

Original creator: tscrim

Original creation time: 2021-08-03 03:21:50

CC:  arojas @mwageringel edgarcosta

If I explicitly pass `algorthm='giac'`, I get the answer, but without it, it hangs until I interrupt it:

```
sage: E.<x,y> = EuclideanSpace(2) 
....: R.<t> = RealLine()                                                                  
sage: beta = E.curve(((2 - cos(3*t))*cos(t), (3 - 2*sin(2*t))*sin(t)), (t, 0, 2*pi))
sage: bp = beta.tangent_vector_field()
sage: bxp, byp = bp[:]
sage: th = arctan(byp / bxp).expr()
sage: k = th.diff(t).simplify_full()
sage: k
6*(32*sin(t)^7 + 24*cos(t)*sin(t)^4 - 44*sin(t)^5 + 8*(cos(t) + 2)*sin(t)^3 - 29*cos(t)*sin(t)^2 + 5*cos(t) - 1)/(256*sin(t)^8 - 720*sin(t)^6 - 4*(16*cos(t) - 153)*sin(t)^4 - 72*cos(t)*sin(t)^3 + (40*cos(t) - 159)*sin(t)^2 + 48*cos(t)*sin(t) - 9)
sage: integral(k, t, 0, 2*pi, algorithm='giac')
2*pi
sage: integral(k, t, 0, 2*pi)  # this is also running giac
^C2*pi
```



---

Comment by chapoton created at 2021-08-03 07:08:54

hmmm. Are you sure it hangs when calling giac ?

- fricas gives 0
- maxima takes a long time and then ?
- sympy takes a long times and then ?


---

Comment by tscrim created at 2021-08-03 07:13:44

It definitely makes a call to giac because if I just run without specifying the algorithm, when I quite sage it exists saying quiting giac. It isn't so much the call to giac but the no specified algorithm case that is hanging somewhere. I would feel better even if there was a trace back, but there is none.


---

Comment by chapoton created at 2021-08-03 09:19:09

indeed, this `^C2*pi` appears when one CTRL-C just after hitting enter..


---

Comment by chapoton created at 2021-08-03 11:27:33

I have added a print in the code and we see something.

Stuck in maxima integrator after 13 minutes. Control-c-ing stops maxima and immediatly launches giac, which answer immediatly.


```
sage: integral(k, t, 0, 2*pi)                                                   
<function maxima_integrator at 0x7f972b28b790>
^C<function giac_integrator at 0x7f972b28b9d0>
2*pi
```



---

Comment by tscrim created at 2021-08-04 00:27:41

I see. Thank you for looking into it. I think that is bad behavior as you would have to ctrl-c multiple times for each the integrator if it takes too long. We are probably catching too many types of errors. `:/`


---

Comment by chapoton created at 2021-08-04 08:54:01

Well, here is what we catch in src/sage/symbolic/integration/integral.py

```
            except (NotImplementedError, TypeError,
                    AttributeError, RuntimeError):
```

maybe catching `RuntimeError` is wrong ?


---

Comment by tscrim created at 2021-08-05 09:12:17

That shouldn't catch a `KeyboardInterrupt`: https://docs.python.org/3/library/exceptions.html

What is happening is when we do the keyboard interrupt, the maxima integrator is converting that into a `RuntimeError`, which is then caught:

```
sage: integral(k, t, 0, 2*pi, algorithm='maxima')
<ctrl-C>
RuntimeError: ECL says: Console interrupt.

sage: integral(k, t, 0, 2*pi, algorithm='sympy')
<ctrl-C>
KeyboardInterrupt:
```

So perhaps what we can do is check to see if the message contains `"Console interrupt"`? If so, then we just raise the error?

Although I guess I should be slightly happy we have this bug. Otherwise I wouldn't have thought to change the integrator and continue thinking it is just too complicated to do symbolically. So it allows me to write a great example for my class.


---

Comment by chapoton created at 2021-08-05 15:07:39

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-08-05 15:07:39

Here is a proposed fix, that raise `KeyboardInterrupt` instead of `RuntimeError` when ECL is interrupted by a CTRL-C.

----
New commits:


---

Comment by tscrim created at 2021-08-05 22:26:17

Thank you, LGTM.

I am bumping this to 9.5 in case we have another 9.4.rc round and this could be subtle enough of a change for someone's code (although I doubt it) that it should get some more proper beta testing.


---

Comment by tscrim created at 2021-08-05 22:26:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-09-05 21:38:32

Resolution: fixed
