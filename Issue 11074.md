# Issue 11074: flint-1.5.0.p5 defines ulong on a system with ulong a type (e.g. Cygwin)

archive/issues_011074.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  drkirkby @nexttime\n\nflint-1.5.0.p5 does not build on a recent Cygwin (1.7.9)\ndue to Cygwin having ulong defined as type in \n/usr/include/sys/types.h. This results in\n\n```\ngcc -std=c99 -I/home/dima/sage-4.7.alpha5/local/include/ -I/home/dima/sage-4.7.a\nlpha5/local/include  -fPIC -funroll-loops   -O2 -c ZmodF_mul.c -o ZmodF_mul.o\nZmodF_mul.c:1: warning: -fPIC ignored for target (all code is position independe\nnt)\nIn file included from /usr/include/stdio.h:46,\n                 from ZmodF_poly.h:40,\n                 from ZmodF_mul.c:34:\n/usr/include/sys/types.h:101: error: duplicate `unsigned'\nmake[2]: *** [ZmodF_mul.o] Error 1\n```\n\nnote that \n/usr/include/sys/types.h:101\nis \n\n```\ntypedef unsigned long   ulong;          /* System V compatibility */\n```\n\n\nulong is a macro in flint, defined in two places, for some reason:\nin flint.h and in profiler.h\n\nRemoving these defines makes the package building OK.\nA crude patch should be trivial.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11246\n\n",
    "created_at": "2011-04-24T11:14:54Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "flint-1.5.0.p5 defines ulong on a system with ulong a type (e.g. Cygwin)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11074",
    "user": "@dimpase"
}
```
Assignee: tbd

CC:  drkirkby @nexttime

flint-1.5.0.p5 does not build on a recent Cygwin (1.7.9)
due to Cygwin having ulong defined as type in 
/usr/include/sys/types.h. This results in

```
gcc -std=c99 -I/home/dima/sage-4.7.alpha5/local/include/ -I/home/dima/sage-4.7.a
lpha5/local/include  -fPIC -funroll-loops   -O2 -c ZmodF_mul.c -o ZmodF_mul.o
ZmodF_mul.c:1: warning: -fPIC ignored for target (all code is position independe
nt)
In file included from /usr/include/stdio.h:46,
                 from ZmodF_poly.h:40,
                 from ZmodF_mul.c:34:
/usr/include/sys/types.h:101: error: duplicate `unsigned'
make[2]: *** [ZmodF_mul.o] Error 1
```

note that 
/usr/include/sys/types.h:101
is 

```
typedef unsigned long   ulong;          /* System V compatibility */
```


ulong is a macro in flint, defined in two places, for some reason:
in flint.h and in profiler.h

Removing these defines makes the package building OK.
A crude patch should be trivial.

Issue created by migration from https://trac.sagemath.org/ticket/11246





---

archive/issue_comments_120895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-25T16:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120895",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120896.json:
```json
{
    "body": "FLINT_ASSERT is defined in flint.h and flint_heap_alloc is defined in memory-manager.h.\n\nI think the given fix compiles only because the headers are picked up via other inclusions. \n\nA fix that seems to work for me is to guard the inclusion of system headers as follows:\n\n#undef ulong\n#include <stdlib.h>\n#define ulong unsigned long\n\nNote that the flint-1.6 release notes say:\n\n* Better Cygwin support\n\nthough I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with.",
    "created_at": "2011-05-02T17:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120896",
    "user": "wbhart"
}
```

FLINT_ASSERT is defined in flint.h and flint_heap_alloc is defined in memory-manager.h.

I think the given fix compiles only because the headers are picked up via other inclusions. 

A fix that seems to work for me is to guard the inclusion of system headers as follows:

#undef ulong
#include <stdlib.h>
#define ulong unsigned long

Note that the flint-1.6 release notes say:

* Better Cygwin support

though I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with.



---

archive/issue_comments_120897.json:
```json
{
    "body": "Replying to [comment:2 wbhart]:\n> FLINT_ASSERT is defined in flint.h and flint_heap_alloc is defined in memory-manager.h.\n> \n> I think the given fix compiles only because the headers are picked up via other inclusions. \n> \n> A fix that seems to work for me is to guard the inclusion of system headers as follows:\n\n\n```\n#undef ulong\n#include <stdlib.h>\n#define ulong unsigned long\n```\n\n\nI tried this and it did not work.\n\nAnother option would be to add double inclusion guards.\n \n> Note that the flint-1.6 release notes say:\n> \n> * Better Cygwin support\n> \n> though I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with. \n\nIndeed, it's recent.",
    "created_at": "2011-05-02T23:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120897",
    "user": "@dimpase"
}
```

Replying to [comment:2 wbhart]:
> FLINT_ASSERT is defined in flint.h and flint_heap_alloc is defined in memory-manager.h.
> 
> I think the given fix compiles only because the headers are picked up via other inclusions. 
> 
> A fix that seems to work for me is to guard the inclusion of system headers as follows:


```
#undef ulong
#include <stdlib.h>
#define ulong unsigned long
```


I tried this and it did not work.

Another option would be to add double inclusion guards.
 
> Note that the flint-1.6 release notes say:
> 
> * Better Cygwin support
> 
> though I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with. 

Indeed, it's recent.



---

archive/issue_comments_120898.json:
```json
{
    "body": "It would really help if flint did not use \"ulong\" and switched to using \"unsigned long\". The use of \"ulong\" is likely to cause many problems - it is even a reserved word in C#. Just Google \"ulong\" and you will find other systems using this, so using \"ulong\" is likely to cause issues. \n\nDave",
    "created_at": "2011-05-03T06:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120898",
    "user": "drkirkby"
}
```

It would really help if flint did not use "ulong" and switched to using "unsigned long". The use of "ulong" is likely to cause many problems - it is even a reserved word in C#. Just Google "ulong" and you will find other systems using this, so using "ulong" is likely to cause issues. 

Dave



---

archive/issue_comments_120899.json:
```json
{
    "body": "Replying to [comment:3 dimpase]:\n\n> I tried this and it did not work.\n\nPS. I must have missed an #include somewhere when I tried this. Taking special precautions before doing an #include<std*.h> appears to be a last resort...\n\nAnyhow, the patch I have here works, and it removes unneeded\nduplicate inclusions from the code, rather than adds more lines. What are objections to it?",
    "created_at": "2011-05-04T11:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120899",
    "user": "@dimpase"
}
```

Replying to [comment:3 dimpase]:

> I tried this and it did not work.

PS. I must have missed an #include somewhere when I tried this. Taking special precautions before doing an #include<std*.h> appears to be a last resort...

Anyhow, the patch I have here works, and it removes unneeded
duplicate inclusions from the code, rather than adds more lines. What are objections to it?



---

archive/issue_comments_120900.json:
```json
{
    "body": "Replying to [comment:4 drkirkby]:\n> It would really help if flint did not use \"ulong\" and switched to using \"unsigned long\". The use of \"ulong\" is likely to cause many problems - it is even a reserved word in C#. Just Google \"ulong\" and you will find other systems using this, so using \"ulong\" is likely to cause issues. \n\nOne would rather rename ulong to Ulong. (or even to oolong :-))\n\nI'd rather ask why a preprocessor macro is used in place of a typedef, which ought to be preferred over #define whenever possible, IMHO.",
    "created_at": "2011-05-04T11:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120900",
    "user": "@dimpase"
}
```

Replying to [comment:4 drkirkby]:
> It would really help if flint did not use "ulong" and switched to using "unsigned long". The use of "ulong" is likely to cause many problems - it is even a reserved word in C#. Just Google "ulong" and you will find other systems using this, so using "ulong" is likely to cause issues. 

One would rather rename ulong to Ulong. (or even to oolong :-))

I'd rather ask why a preprocessor macro is used in place of a typedef, which ought to be preferred over #define whenever possible, IMHO.



---

archive/issue_comments_120901.json:
```json
{
    "body": "Replying to [comment:2 wbhart]:\n\n> \n> Note that the flint-1.6 release notes say:\n> \n> * Better Cygwin support\n> \n> though I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with.\n\n1.6 suffers from the same issue:\n \n\n```\n...\ncc -std=c99 -I -I   -g -O2 -c ZmodF_mul.c -o ZmodF_mul.o\nIn file included from /usr/include/stdio.h:46,\n                 from ZmodF_poly.h:40,\n                 from ZmodF_mul.c:34:\n/usr/include/sys/types.h:101: error: duplicate `unsigned'\nmake: *** [ZmodF_mul.o] Error 1\n\ndima@SPMS-DIMA-W7 /tmp/flint-1.6\n```\n\n\nto get that far when compiling, I needed to remove quite a bit of\n\"error: redeclaration of `i' with no linkage\" in QS/mp_linear_algebra.c and QS/mp_sieve.c\n\nE.g:\n\n```\nQS/mp_linear_algebra.c: In function `insert_lp_relation':\nQS/mp_linear_algebra.c:334: error: redeclaration of `i' with no linkage\nQS/mp_linear_algebra.c:329: error: previous declaration of `i' was here\n```\n\n\nthe reason for that is rather than writing \n\n```\n for (unsigned long i = 0; ...\n```\n\nwhich restricts the scope of i to the for loop, you write \n\n```\n unsigned long i;\n for (i = 0; ...\n```\n\nthere, in many places. Well, maybe some weird compiler can accept this, but gcc does not...",
    "created_at": "2011-05-04T12:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120901",
    "user": "@dimpase"
}
```

Replying to [comment:2 wbhart]:

> 
> Note that the flint-1.6 release notes say:
> 
> * Better Cygwin support
> 
> though I don't know if this particular issue is fixed or not. It may be only be an issue with more recent Cygwin than what I tested with.

1.6 suffers from the same issue:
 

```
...
cc -std=c99 -I -I   -g -O2 -c ZmodF_mul.c -o ZmodF_mul.o
In file included from /usr/include/stdio.h:46,
                 from ZmodF_poly.h:40,
                 from ZmodF_mul.c:34:
/usr/include/sys/types.h:101: error: duplicate `unsigned'
make: *** [ZmodF_mul.o] Error 1

dima@SPMS-DIMA-W7 /tmp/flint-1.6
```


to get that far when compiling, I needed to remove quite a bit of
"error: redeclaration of `i' with no linkage" in QS/mp_linear_algebra.c and QS/mp_sieve.c

E.g:

```
QS/mp_linear_algebra.c: In function `insert_lp_relation':
QS/mp_linear_algebra.c:334: error: redeclaration of `i' with no linkage
QS/mp_linear_algebra.c:329: error: previous declaration of `i' was here
```


the reason for that is rather than writing 

```
 for (unsigned long i = 0; ...
```

which restricts the scope of i to the for loop, you write 

```
 unsigned long i;
 for (i = 0; ...
```

there, in many places. Well, maybe some weird compiler can accept this, but gcc does not...



---

archive/issue_comments_120902.json:
```json
{
    "body": "Dima, is that a Windows 7 problem only?    I am trying on XP with Cygwin 1.7.3 and did not have any problems building flint.",
    "created_at": "2011-06-16T01:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120902",
    "user": "@kcrisman"
}
```

Dima, is that a Windows 7 problem only?    I am trying on XP with Cygwin 1.7.3 and did not have any problems building flint.



---

archive/issue_comments_120903.json:
```json
{
    "body": "Replying to [comment:8 kcrisman]:\n> Dima, is that a Windows 7 problem only?    I am trying on XP with Cygwin 1.7.3 and did not have any problems building flint.\n\nHi,\nyou need a more recent Cygwin!\nDima",
    "created_at": "2011-06-16T07:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120903",
    "user": "@dimpase"
}
```

Replying to [comment:8 kcrisman]:
> Dima, is that a Windows 7 problem only?    I am trying on XP with Cygwin 1.7.3 and did not have any problems building flint.

Hi,
you need a more recent Cygwin!
Dima



---

archive/issue_comments_120904.json:
```json
{
    "body": "I misunderstood - I thought you meant Cygwin 1.6, not flint 1.6.  Ok.",
    "created_at": "2011-06-16T07:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120904",
    "user": "@kcrisman"
}
```

I misunderstood - I thought you meant Cygwin 1.6, not flint 1.6.  Ok.



---

archive/issue_comments_120905.json:
```json
{
    "body": "Just a question about the changes - I think I understand getting rid of the files in patch and substituting the .patch files, but I don't see how makepatchfiles is ever used.  Was that just a utility you cooked up to make all the patches?  I don't know whether that belongs in the spkg or not - I guess it doesn't hurt, but maybe that should be more universal.\n\nAnyway, I'm trying this out soon on W7.",
    "created_at": "2011-06-22T16:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120905",
    "user": "@kcrisman"
}
```

Just a question about the changes - I think I understand getting rid of the files in patch and substituting the .patch files, but I don't see how makepatchfiles is ever used.  Was that just a utility you cooked up to make all the patches?  I don't know whether that belongs in the spkg or not - I guess it doesn't hurt, but maybe that should be more universal.

Anyway, I'm trying this out soon on W7.



---

archive/issue_comments_120906.json:
```json
{
    "body": "Replying to [comment:11 kcrisman]:\n> Just a question about the changes - I think I understand getting rid of the files in patch and substituting the .patch files, but I don't see how makepatchfiles is ever used.  Was that just a utility you cooked up to make all the patches?  I don't know whether that belongs in the spkg or not - I guess it doesn't hurt, but maybe that should be more universal.\n\nindeed, makepatchfiles is a  script to create these files, and I use it manually whenever I update the spkg. I have such a\nfile in at least one more package (cvxopt).",
    "created_at": "2011-06-22T16:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120906",
    "user": "@dimpase"
}
```

Replying to [comment:11 kcrisman]:
> Just a question about the changes - I think I understand getting rid of the files in patch and substituting the .patch files, but I don't see how makepatchfiles is ever used.  Was that just a utility you cooked up to make all the patches?  I don't know whether that belongs in the spkg or not - I guess it doesn't hurt, but maybe that should be more universal.

indeed, makepatchfiles is a  script to create these files, and I use it manually whenever I update the spkg. I have such a
file in at least one more package (cvxopt).



---

archive/issue_comments_120907.json:
```json
{
    "body": "This works on XP - Flint builds.  Since for now we are only focusing on building :) then this just needs testing on a few other platforms, though it seems you have already done this.  Still Solaris?",
    "created_at": "2011-06-28T15:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120907",
    "user": "@kcrisman"
}
```

This works on XP - Flint builds.  Since for now we are only focusing on building :) then this just needs testing on a few other platforms, though it seems you have already done this.  Still Solaris?



---

archive/issue_comments_120908.json:
```json
{
    "body": "Replying to [comment:13 kcrisman]:\n> This works on XP - Flint builds.  Since for now we are only focusing on building :) \nSorry, I meant this builds on **Windows 7** in addition to XP where this was not a problem.",
    "created_at": "2011-06-28T15:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120908",
    "user": "@kcrisman"
}
```

Replying to [comment:13 kcrisman]:
> This works on XP - Flint builds.  Since for now we are only focusing on building :) 
Sorry, I meant this builds on **Windows 7** in addition to XP where this was not a problem.



---

archive/issue_comments_120909.json:
```json
{
    "body": "Replying to [comment:14 kcrisman]:\n> Replying to [comment:13 kcrisman]:\n> > This works on XP - Flint builds.  Since for now we are only focusing on building :) \n> Sorry, I meant this builds on **Windows 7** in addition to XP where this was not a problem.\nBecause of an old Cygwin, presumably.",
    "created_at": "2011-06-28T18:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120909",
    "user": "@kcrisman"
}
```

Replying to [comment:14 kcrisman]:
> Replying to [comment:13 kcrisman]:
> > This works on XP - Flint builds.  Since for now we are only focusing on building :) 
> Sorry, I meant this builds on **Windows 7** in addition to XP where this was not a problem.
Because of an old Cygwin, presumably.



---

archive/issue_comments_120910.json:
```json
{
    "body": "I think this deserves positive review.   Relevant tests pass on Mac and sage.math after this upgrade.\n\nI am unable to test this on Solaris, so this is the only potential problem I see, but I don't see any reason it shouldn't work, if getting rid of a few ulong things is better.",
    "created_at": "2011-06-28T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120910",
    "user": "@kcrisman"
}
```

I think this deserves positive review.   Relevant tests pass on Mac and sage.math after this upgrade.

I am unable to test this on Solaris, so this is the only potential problem I see, but I don't see any reason it shouldn't work, if getting rid of a few ulong things is better.



---

archive/issue_comments_120911.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-28T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120911",
    "user": "@kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120912.json:
```json
{
    "body": "I know the FLINT spkg is currently a mess anyway, but\n\n* (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;\n\n* the patches are applied without any error checking.",
    "created_at": "2011-07-02T05:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120912",
    "user": "@nexttime"
}
```

I know the FLINT spkg is currently a mess anyway, but

* (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;

* the patches are applied without any error checking.



---

archive/issue_comments_120913.json:
```json
{
    "body": "Replying to [comment:18 leif]:\n> I know the FLINT spkg is currently a mess anyway, but\n> \n>  * (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;\n\nInterestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.  \n\n>  * the patches are applied without any error checking.\nYou mean \n\n```\n+for j in `ls patches/*.patch` ; do  \n+   patch -p0 < $j \n+done \n```\n\nDo we ever do error checking for these?  Most spkg-install files seem to have just \"cp\" or \"patch\".   What should be added?",
    "created_at": "2011-07-03T03:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120913",
    "user": "@kcrisman"
}
```

Replying to [comment:18 leif]:
> I know the FLINT spkg is currently a mess anyway, but
> 
>  * (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;

Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.  

>  * the patches are applied without any error checking.
You mean 

```
+for j in `ls patches/*.patch` ; do  
+   patch -p0 < $j 
+done 
```

Do we ever do error checking for these?  Most spkg-install files seem to have just "cp" or "patch".   What should be added?



---

archive/issue_comments_120914.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> Replying to [comment:18 leif]:\n> > I know the FLINT spkg is currently a mess anyway, but\n> > \n> >  * (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;\n> \n> Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.  \n> \n> >  * the patches are applied without any error checking.\n> You mean \n> {{{\n> +for j in `ls patches/*.patch` ; do  \n> +   patch -p0 < $j \n> +done \n> }}}\n> Do we ever do error checking for these?  Most spkg-install files seem to have just \"cp\" or \"patch\".   What should be added?\n\nIMHO there is no need to check in spkg-install  that patches apply correctly  --- going this way, one woud also could start asking for a check that tar worked correctly, etc...",
    "created_at": "2011-07-03T08:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120914",
    "user": "@dimpase"
}
```

Replying to [comment:19 kcrisman]:
> Replying to [comment:18 leif]:
> > I know the FLINT spkg is currently a mess anyway, but
> > 
> >  * (in general) please add the ticket number to commit messages, and limit `SPKG.txt` lines to 80 columns;
> 
> Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.  
> 
> >  * the patches are applied without any error checking.
> You mean 
> {{{
> +for j in `ls patches/*.patch` ; do  
> +   patch -p0 < $j 
> +done 
> }}}
> Do we ever do error checking for these?  Most spkg-install files seem to have just "cp" or "patch".   What should be added?

IMHO there is no need to check in spkg-install  that patches apply correctly  --- going this way, one woud also could start asking for a check that tar worked correctly, etc...



---

archive/issue_comments_120915.json:
```json
{
    "body": "Replying to [comment:20 dimpase]:\n> Replying to [comment:19 kcrisman]:\n> > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.\n\nOf course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)\n\nIf doing so would dominate other, more important changes in the diff, you can still provide a separate patch for that. (There is no patch or spkg-diff for review attached to this ticket anyway.)\n\nDave, me, and others have reformatted any `SPKG.txt` we came across in the past in case it was necessary. Once overlong lines are eliminated, it's much more likely people will intuitively adhere without ever looking at their editor's status bar.\n\n\n\n\n> > >  * the patches are applied without any error checking.\n> > You mean \n\n```\n+for j in `ls patches/*.patch` ; do  \n+   patch -p0 < $j \n+done \n```\n\n> > Do we ever do error checking for these?  Most spkg-install files seem to have just \"cp\" or \"patch\".   What should be added?\n> \n> IMHO there is no need to check in `spkg-install` that patches apply correctly  --- going this way, one woud also could start asking for a check that tar worked correctly, etc...\n\nWe do of course check exit codes (or indirectly the success) of `tar` and other commands that can spectacularly fail...\n\nFortunately, we now use `patch` rather than `cp`, which at least spits out warning or error messages in case upstream and `patches/*` get out of sync (or someone made another mistake), but these messages are easily missed - even by a reviewer, which can lead to all kinds of obscure errors or misbehavior *any time later*, so we should IMHO check `$?` there.\n\n`bash`'s not Python, where we would (hopefully) get a nice, instructive traceback.",
    "created_at": "2011-07-03T09:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120915",
    "user": "@nexttime"
}
```

Replying to [comment:20 dimpase]:
> Replying to [comment:19 kcrisman]:
> > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.

Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)

If doing so would dominate other, more important changes in the diff, you can still provide a separate patch for that. (There is no patch or spkg-diff for review attached to this ticket anyway.)

Dave, me, and others have reformatted any `SPKG.txt` we came across in the past in case it was necessary. Once overlong lines are eliminated, it's much more likely people will intuitively adhere without ever looking at their editor's status bar.




> > >  * the patches are applied without any error checking.
> > You mean 

```
+for j in `ls patches/*.patch` ; do  
+   patch -p0 < $j 
+done 
```

> > Do we ever do error checking for these?  Most spkg-install files seem to have just "cp" or "patch".   What should be added?
> 
> IMHO there is no need to check in `spkg-install` that patches apply correctly  --- going this way, one woud also could start asking for a check that tar worked correctly, etc...

We do of course check exit codes (or indirectly the success) of `tar` and other commands that can spectacularly fail...

Fortunately, we now use `patch` rather than `cp`, which at least spits out warning or error messages in case upstream and `patches/*` get out of sync (or someone made another mistake), but these messages are easily missed - even by a reviewer, which can lead to all kinds of obscure errors or misbehavior *any time later*, so we should IMHO check `$?` there.

`bash`'s not Python, where we would (hopefully) get a nice, instructive traceback.



---

archive/issue_comments_120916.json:
```json
{
    "body": "Changing keywords from \"\" to \"cygwin\".",
    "created_at": "2011-07-03T11:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120916",
    "user": "@jdemeyer"
}
```

Changing keywords from "" to "cygwin".



---

archive/issue_comments_120917.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> Do we ever do error checking for these?  Most spkg-install files seem to have just \"cp\" or \"patch\".   What should be added?\n\n(`cp` will almost always succeed, so that's more or less irrelevant, meaning a different situation.)\n\nFrom the \"proof-of-concept\" spkg (Sphinx):\n\n```sh\n# Apply patches\ncd \"$CUR/src\"\necho \"Patching Sphinx...\"\nfor p in ../patches/*.patch; do\n        patch -p1 <$p\n        success \"Error applying patch $p\"\ndone\n```\n\n\n(The `success` function exits `spkg-install` whenever `$? != 0`.)\n\nIt would IMHO also be valid to just accumulate errors and do one check after the loop, e.g.:\n\n```sh\npatched_ok=true\n\nfor p in patches/*.patch; do\n  patch -p0 < \"$p\" || patched_ok=false  # -p0 is also superfluous btw.\ndone\n\nif ! $patched_ok; then\n  echo >&2 \"Error applying the patches to upstream source\" # or whatever\n  exit 1\nfi\n```\n\n\n(Note that doing `ls patches/*.patch` is superfluous and not even robust.)\n\nYou can of course at your taste \"invert\" the logic, i.e. start with `patch_error=false` and set it to `true` in case `patch` returns a non-zero value, then test `if $patch_error; then ...`.",
    "created_at": "2011-07-03T12:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120917",
    "user": "@nexttime"
}
```

Replying to [comment:19 kcrisman]:
> Do we ever do error checking for these?  Most spkg-install files seem to have just "cp" or "patch".   What should be added?

(`cp` will almost always succeed, so that's more or less irrelevant, meaning a different situation.)

From the "proof-of-concept" spkg (Sphinx):

```sh
# Apply patches
cd "$CUR/src"
echo "Patching Sphinx..."
for p in ../patches/*.patch; do
        patch -p1 <$p
        success "Error applying patch $p"
done
```


(The `success` function exits `spkg-install` whenever `$? != 0`.)

It would IMHO also be valid to just accumulate errors and do one check after the loop, e.g.:

```sh
patched_ok=true

for p in patches/*.patch; do
  patch -p0 < "$p" || patched_ok=false  # -p0 is also superfluous btw.
done

if ! $patched_ok; then
  echo >&2 "Error applying the patches to upstream source" # or whatever
  exit 1
fi
```


(Note that doing `ls patches/*.patch` is superfluous and not even robust.)

You can of course at your taste "invert" the logic, i.e. start with `patch_error=false` and set it to `true` in case `patch` returns a non-zero value, then test `if $patch_error; then ...`.



---

archive/issue_comments_120918.json:
```json
{
    "body": "For the record:\n\n#9419 (\"*Update Developers Guide to state how patches should be made.*\") - intended to explain how to use `patch` *in spkgs* - is unfortunately still \"new\"...",
    "created_at": "2011-07-03T14:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120918",
    "user": "@nexttime"
}
```

For the record:

#9419 ("*Update Developers Guide to state how patches should be made.*") - intended to explain how to use `patch` *in spkgs* - is unfortunately still "new"...



---

archive/issue_comments_120919.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> Replying to [comment:20 dimpase]:\n> > Replying to [comment:19 kcrisman]:\n> > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.\n> \n> Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)\n\nThis is exactly what I did, and was rebuked.",
    "created_at": "2011-07-04T16:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120919",
    "user": "@kcrisman"
}
```

Replying to [comment:21 leif]:
> Replying to [comment:20 dimpase]:
> > Replying to [comment:19 kcrisman]:
> > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.
> 
> Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)

This is exactly what I did, and was rebuked.



---

archive/issue_comments_120920.json:
```json
{
    "body": "Replying to [comment:23 leif]:\n> Replying to [comment:19 kcrisman]:\n> > Do we ever do error checking for these?  Most spkg-install files seem to have just \"cp\" or \"patch\".   What should be added?\n> \n> (`cp` will almost always succeed, so that's more or less irrelevant, meaning a different situation.)\n> \n> From the \"proof-of-concept\" spkg (Sphinx):\n> {{{\n> #!sh\n> # Apply patches\n> cd \"$CUR/src\"\n> echo \"Patching Sphinx...\"\n> for p in ../patches/*.patch; do\n>         patch -p1 <$p\n>         success \"Error applying patch $p\"\n> done\n> }}}\n> \n> (The `success` function exits `spkg-install` whenever `$? != 0`.)\n> \n\nThis sounds like a great idea on a *different* ticket.  Getting the Cygwin things in is going to be hard enough!\n\nUnless you are volunteering to test the rest of them!   That would be very convenient :)",
    "created_at": "2011-07-04T16:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120920",
    "user": "@kcrisman"
}
```

Replying to [comment:23 leif]:
> Replying to [comment:19 kcrisman]:
> > Do we ever do error checking for these?  Most spkg-install files seem to have just "cp" or "patch".   What should be added?
> 
> (`cp` will almost always succeed, so that's more or less irrelevant, meaning a different situation.)
> 
> From the "proof-of-concept" spkg (Sphinx):
> {{{
> #!sh
> # Apply patches
> cd "$CUR/src"
> echo "Patching Sphinx..."
> for p in ../patches/*.patch; do
>         patch -p1 <$p
>         success "Error applying patch $p"
> done
> }}}
> 
> (The `success` function exits `spkg-install` whenever `$? != 0`.)
> 

This sounds like a great idea on a *different* ticket.  Getting the Cygwin things in is going to be hard enough!

Unless you are volunteering to test the rest of them!   That would be very convenient :)



---

archive/issue_comments_120921.json:
```json
{
    "body": "Replying to [comment:25 kcrisman]:\n> Replying to [comment:21 leif]:\n> > Replying to [comment:20 dimpase]:\n> > > Replying to [comment:19 kcrisman]:\n> > > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.\n> > \n> > Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)\n> \n> This is exactly what I did, and was rebuked.\n\nWhere? By whom? D-:<\n\nNo, honestly, if someone refused what others consider a common agreement this should IMHO be discussed on `sage-devel`.",
    "created_at": "2011-07-04T18:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120921",
    "user": "@nexttime"
}
```

Replying to [comment:25 kcrisman]:
> Replying to [comment:21 leif]:
> > Replying to [comment:20 dimpase]:
> > > Replying to [comment:19 kcrisman]:
> > > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.
> > 
> > Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)
> 
> This is exactly what I did, and was rebuked.

Where? By whom? D-:<

No, honestly, if someone refused what others consider a common agreement this should IMHO be discussed on `sage-devel`.



---

archive/issue_comments_120922.json:
```json
{
    "body": "Replying to [comment:27 leif]:\n> Replying to [comment:25 kcrisman]:\n> > Replying to [comment:21 leif]:\n> > > Replying to [comment:20 dimpase]:\n> > > > Replying to [comment:19 kcrisman]:\n> > > > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.\n> > > \n> > > Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)\n> > \n> > This is exactly what I did, and was rebuked.\n> \n> Where? By whom? D-:<\n> \n> No, honestly, if someone refused what others consider a common agreement this should IMHO be discussed on `sage-devel`.\n\nprobably Karl-Dieter means my comment somewhere, which was more in the spirit of \"please do not reformat the files unnecessarily, to decrease lengths of patches\"; I actually wasn't aware of the 80-characters rule...",
    "created_at": "2011-07-04T18:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120922",
    "user": "@dimpase"
}
```

Replying to [comment:27 leif]:
> Replying to [comment:25 kcrisman]:
> > Replying to [comment:21 leif]:
> > > Replying to [comment:20 dimpase]:
> > > > Replying to [comment:19 kcrisman]:
> > > > > Interestingly, I was just chewed out on another ticket for having cut some lines in that file down to size!   It's true that the new lines are just a little over that, apparently.
> > > 
> > > Of course you shouldn't cut them, but reformat the text such that none of the lines will exceed 80 characters (same for longer, i.e. all but the first line of commit messages). ;-)
> > 
> > This is exactly what I did, and was rebuked.
> 
> Where? By whom? D-:<
> 
> No, honestly, if someone refused what others consider a common agreement this should IMHO be discussed on `sage-devel`.

probably Karl-Dieter means my comment somewhere, which was more in the spirit of "please do not reformat the files unnecessarily, to decrease lengths of patches"; I actually wasn't aware of the 80-characters rule...



---

archive/issue_comments_120923.json:
```json
{
    "body": "To clear some things up:\n\n- It is **not** needed anymore to add ticket numbers to commit messages (this used to be the case but this was changed in sage-4.7.alpha5)\n\n- Lines in `SPKG.txt` and commit messages should not be too long.  There is no hard 80 characters limit but more of a subjective \"not too long\" limit.  In practice I would say <= 120 characters is safe.",
    "created_at": "2011-07-04T18:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120923",
    "user": "@jdemeyer"
}
```

To clear some things up:

- It is **not** needed anymore to add ticket numbers to commit messages (this used to be the case but this was changed in sage-4.7.alpha5)

- Lines in `SPKG.txt` and commit messages should not be too long.  There is no hard 80 characters limit but more of a subjective "not too long" limit.  In practice I would say <= 120 characters is safe.



---

archive/issue_comments_120924.json:
```json
{
    "body": "Replying to [comment:28 dimpase]:\n> probably Karl-Dieter means my comment somewhere, which was more in the spirit of \"please do not reformat the files unnecessarily, to decrease lengths of patches\"; I actually wasn't aware of the 80-characters rule...\n\nThe ugly thing with reformatting text is that the diffs usually get hard to read.\n\nI therefore prefer splitting off such changes from *code changes*, to be reviewed separately and independently, since the latter are much more important.\n\nNevertheless, both kinds of patches can (and IMHO should) live on the same ticket, because documentation tends to get neglected.\n\n\n\n\nReplying to [comment:29 jdemeyer]:\n> - Lines in `SPKG.txt` and commit messages should not be too long.  There is no hard 80 characters limit but more of a subjective \"not too long\" limit.  In practice I would say <= 120 characters is safe.\n\nI would agree in the case of source code (which you read with your favourite editor), but not documentation that's often just dumped to a terminal (`sage -info ...`, `hg log -v`, or simply `sage: function?`).\n\nOf course one can usually resize the terminal window (perhaps at the expense of redoing the command), but that's quite inconvenient, and there's a reason e.g. newspapers -- and even a lot of blogs -- are typeset as they are: in multiple, rather narrow columns.\n\nCode is somewhat different, also depending on the language and coding style. \n\n\n\n\n> - It is **not** needed anymore to add ticket numbers to commit messages (this used to be the case but this was changed in sage-4.7.alpha5)\n\nOoops, there's not just a *technical* reason for doing so. That's why I insist on having them in spkg commit messages as well (alternatively, or in addition, the full spkg version).",
    "created_at": "2011-07-04T21:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120924",
    "user": "@nexttime"
}
```

Replying to [comment:28 dimpase]:
> probably Karl-Dieter means my comment somewhere, which was more in the spirit of "please do not reformat the files unnecessarily, to decrease lengths of patches"; I actually wasn't aware of the 80-characters rule...

The ugly thing with reformatting text is that the diffs usually get hard to read.

I therefore prefer splitting off such changes from *code changes*, to be reviewed separately and independently, since the latter are much more important.

Nevertheless, both kinds of patches can (and IMHO should) live on the same ticket, because documentation tends to get neglected.




Replying to [comment:29 jdemeyer]:
> - Lines in `SPKG.txt` and commit messages should not be too long.  There is no hard 80 characters limit but more of a subjective "not too long" limit.  In practice I would say <= 120 characters is safe.

I would agree in the case of source code (which you read with your favourite editor), but not documentation that's often just dumped to a terminal (`sage -info ...`, `hg log -v`, or simply `sage: function?`).

Of course one can usually resize the terminal window (perhaps at the expense of redoing the command), but that's quite inconvenient, and there's a reason e.g. newspapers -- and even a lot of blogs -- are typeset as they are: in multiple, rather narrow columns.

Code is somewhat different, also depending on the language and coding style. 




> - It is **not** needed anymore to add ticket numbers to commit messages (this used to be the case but this was changed in sage-4.7.alpha5)

Ooops, there's not just a *technical* reason for doing so. That's why I insist on having them in spkg commit messages as well (alternatively, or in addition, the full spkg version).



---

archive/issue_comments_120925.json:
```json
{
    "body": "Finally: ;-)\n\nReplying to [comment:26 kcrisman]:\n> Replying to [comment:23 leif]:\n> From the \"proof-of-concept\" spkg (Sphinx):\n\n```sh\n# Apply patches\ncd \"$CUR/src\"\necho \"Patching Sphinx...\"\nfor p in ../patches/*.patch; do\n        patch -p1 <$p\n        success \"Error applying patch $p\"\ndone\n```\n\n> > (The `success` function exits `spkg-install` whenever `$? != 0`.)\n> This sounds like a great idea on a *different* ticket.\n> Getting the Cygwin things in is going to be hard enough!\n\n`<scnr><flame>`\n  Well, I didn't set the ticket to \"needs work\", though the more I think about it, the more I'm convinced we shouldn't start(?) accepting code that literally sets up traps the next ones touching the spkg can easily step into, with the potential to cause virtually any kind of obscure, hardly backtraceable error or malfunction.\n\n  And perhaps thereby encouraging others in both also omitting checks, and letting others do so.\n\n  Murphy's Law tells us it *will* happen, sooner or later... And all just because someone omitted -- knowingly -- a few simple error checks... :D\n  (The \"redundant\" `for j in `ls patches/*.patch`` btw has also a nice side-effect; try it with some patch with spaces in its filename... Ok, always a bad idea, wasn't it?)\n\n  Ok, we can always \"fix\" it later, on another ticket. Although this ticket has meanwhile already been postponed to another milestone. And the changes would be almost trivial.\n\n  Procrastination makes things never happen.\n`</flame></scnr>`\n\nSorry, had to let the words flow, get rid of some frustration.\n\n\n\n\n> Unless you are volunteering to test the rest of them!   That would be very convenient :)\n\nI would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)",
    "created_at": "2011-07-04T21:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120925",
    "user": "@nexttime"
}
```

Finally: ;-)

Replying to [comment:26 kcrisman]:
> Replying to [comment:23 leif]:
> From the "proof-of-concept" spkg (Sphinx):

```sh
# Apply patches
cd "$CUR/src"
echo "Patching Sphinx..."
for p in ../patches/*.patch; do
        patch -p1 <$p
        success "Error applying patch $p"
done
```

> > (The `success` function exits `spkg-install` whenever `$? != 0`.)
> This sounds like a great idea on a *different* ticket.
> Getting the Cygwin things in is going to be hard enough!

`<scnr><flame>`
  Well, I didn't set the ticket to "needs work", though the more I think about it, the more I'm convinced we shouldn't start(?) accepting code that literally sets up traps the next ones touching the spkg can easily step into, with the potential to cause virtually any kind of obscure, hardly backtraceable error or malfunction.

  And perhaps thereby encouraging others in both also omitting checks, and letting others do so.

  Murphy's Law tells us it *will* happen, sooner or later... And all just because someone omitted -- knowingly -- a few simple error checks... :D
  (The "redundant" `for j in `ls patches/*.patch`` btw has also a nice side-effect; try it with some patch with spaces in its filename... Ok, always a bad idea, wasn't it?)

  Ok, we can always "fix" it later, on another ticket. Although this ticket has meanwhile already been postponed to another milestone. And the changes would be almost trivial.

  Procrastination makes things never happen.
`</flame></scnr>`

Sorry, had to let the words flow, get rid of some frustration.




> Unless you are volunteering to test the rest of them!   That would be very convenient :)

I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)



---

archive/issue_comments_120926.json:
```json
{
    "body": ">   Well, I didn't set the ticket to \"needs work\", though the more I think about it, the more I'm convinced we shouldn't start(?) accepting code that literally sets up traps the next ones touching the spkg can easily step into, with the potential to cause virtually any kind of obscure, hardly backtraceable error or malfunction.\n\nYou may be right.  \n>   Murphy's Law tells us it *will* happen, sooner or later... And all just because someone omitted -- knowingly -- a few simple error checks... :D\nExcept for the fact that in this case the reviewer at least did it *un*knowingly.  Which is the fundamental difference between Sage and most other OS projects - the developers are mostly mathematicians first, programmers second (or third, or `n`th).  My apologies for not being a shell script ninja ;)\n\n>   Procrastination makes things never happen.\nPrecisely!  That is why I reviewed this ticket positively - if I'd waited for someone who knew enough about shell to check whether it did more than work correctly it would have never been reviewed :)\n\n> \n> I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)\n\nAh, another chicken-and-egg problem...",
    "created_at": "2011-07-05T00:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120926",
    "user": "@kcrisman"
}
```

>   Well, I didn't set the ticket to "needs work", though the more I think about it, the more I'm convinced we shouldn't start(?) accepting code that literally sets up traps the next ones touching the spkg can easily step into, with the potential to cause virtually any kind of obscure, hardly backtraceable error or malfunction.

You may be right.  
>   Murphy's Law tells us it *will* happen, sooner or later... And all just because someone omitted -- knowingly -- a few simple error checks... :D
Except for the fact that in this case the reviewer at least did it *un*knowingly.  Which is the fundamental difference between Sage and most other OS projects - the developers are mostly mathematicians first, programmers second (or third, or `n`th).  My apologies for not being a shell script ninja ;)

>   Procrastination makes things never happen.
Precisely!  That is why I reviewed this ticket positively - if I'd waited for someone who knew enough about shell to check whether it did more than work correctly it would have never been reviewed :)

> 
> I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)

Ah, another chicken-and-egg problem...



---

archive/issue_comments_120927.json:
```json
{
    "body": "Replying to [comment:32 kcrisman]:\n> Except for the fact that in this case the reviewer at least did it *un*knowingly.\n\nI primarily meant merging tickets with known *newly introduced* flaws or deficiencies, which of course requires some positive review.\n\n(Not fixing old flaws on a ticket is another issue, and heavily depends on the situation, especially the effort to do so, and the cost of delaying other changes already made. Also, spkgs are IMHO different to patches to the rest of Sage.)\n\n> Which is the fundamental difference between Sage and most other OS projects - the developers are mostly mathematicians first, programmers second (or third, or `n`th).  My apologies for not being a shell script ninja ;)\n\nNinjas operate silently.\n\n> If I'd waited for someone who knew enough about shell to check whether it did more than work correctly it would have never been reviewed :)\n\nHmmm, I saw Dave was cc'ed.\n\n\n\n\n> > I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)\n> \n> Ah, another chicken-and-egg problem...\n\nChicken and egg? So Sage on Cygwin will replace Windows, or is Microsoft going to rewrite it in Sage when the Cygwin port is ready?",
    "created_at": "2011-07-05T12:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120927",
    "user": "@nexttime"
}
```

Replying to [comment:32 kcrisman]:
> Except for the fact that in this case the reviewer at least did it *un*knowingly.

I primarily meant merging tickets with known *newly introduced* flaws or deficiencies, which of course requires some positive review.

(Not fixing old flaws on a ticket is another issue, and heavily depends on the situation, especially the effort to do so, and the cost of delaying other changes already made. Also, spkgs are IMHO different to patches to the rest of Sage.)

> Which is the fundamental difference between Sage and most other OS projects - the developers are mostly mathematicians first, programmers second (or third, or `n`th).  My apologies for not being a shell script ninja ;)

Ninjas operate silently.

> If I'd waited for someone who knew enough about shell to check whether it did more than work correctly it would have never been reviewed :)

Hmmm, I saw Dave was cc'ed.




> > I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)
> 
> Ah, another chicken-and-egg problem...

Chicken and egg? So Sage on Cygwin will replace Windows, or is Microsoft going to rewrite it in Sage when the Cygwin port is ready?



---

archive/issue_comments_120928.json:
```json
{
    "body": "> \n> > > I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)\n> > \n> > Ah, another chicken-and-egg problem...\n> \n> Chicken and egg? So Sage on Cygwin will replace Windows, or is Microsoft going to rewrite it in Sage when the Cygwin port is ready?\n\nNo, that Sage on Windows (Cygwin or otherwise) won't happen until we have enough Windows-adept users, but we are unlikely to have many of them until we have a good Sage on Windows that isn't a VM/VB solution, and so on.",
    "created_at": "2011-07-05T14:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120928",
    "user": "@kcrisman"
}
```

> 
> > > I would if I only could, but I fortunately<sup>TM</sup> lack suitable Windows versions to run a recent Cygwin on. ;-)
> > 
> > Ah, another chicken-and-egg problem...
> 
> Chicken and egg? So Sage on Cygwin will replace Windows, or is Microsoft going to rewrite it in Sage when the Cygwin port is ready?

No, that Sage on Windows (Cygwin or otherwise) won't happen until we have enough Windows-adept users, but we are unlikely to have many of them until we have a good Sage on Windows that isn't a VM/VB solution, and so on.



---

archive/issue_comments_120929.json:
```json
{
    "body": "I will have a look at `spkg-install` and clean up where needed...",
    "created_at": "2011-07-05T15:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120929",
    "user": "@jdemeyer"
}
```

I will have a look at `spkg-install` and clean up where needed...



---

archive/issue_comments_120930.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-07-05T15:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120930",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_120931.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-05T15:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120931",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120932.json:
```json
{
    "body": "If you quote `$p` and commit the changes ;-) I'll give it positive review...\n\nI wouldn't have removed the comment on linking in the NTL interface though (which is a very bad thing btw.).",
    "created_at": "2011-07-05T15:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120932",
    "user": "@nexttime"
}
```

If you quote `$p` and commit the changes ;-) I'll give it positive review...

I wouldn't have removed the comment on linking in the NTL interface though (which is a very bad thing btw.).



---

archive/issue_comments_120933.json:
```json
{
    "body": "Replying to [comment:38 leif]:\n> I wouldn't have removed the comment on linking in the NTL interface though (which is a very bad thing btw.).\n\nOtherwise we should add the \"Patches\" subsection to `SPKG.txt`.\n\nI'm going to provide a FLINT 1.5.2 spkg anyway soon (cf. #9858), already made some changes months ago.",
    "created_at": "2011-07-05T15:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120933",
    "user": "@nexttime"
}
```

Replying to [comment:38 leif]:
> I wouldn't have removed the comment on linking in the NTL interface though (which is a very bad thing btw.).

Otherwise we should add the "Patches" subsection to `SPKG.txt`.

I'm going to provide a FLINT 1.5.2 spkg anyway soon (cf. #9858), already made some changes months ago.



---

archive/issue_comments_120934.json:
```json
{
    "body": "Yeah, I couldn't find anything in the log.  \n\nLeif, he moved that comment to the SPKG.txt instructions, so it should be okay.",
    "created_at": "2011-07-05T15:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120934",
    "user": "@kcrisman"
}
```

Yeah, I couldn't find anything in the log.  

Leif, he moved that comment to the SPKG.txt instructions, so it should be okay.



---

archive/issue_comments_120935.json:
```json
{
    "body": "Here's another question:  where is this \"success\" function?   Is it defined elsewhere in the Sphinx spkg?",
    "created_at": "2011-07-05T16:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120935",
    "user": "@kcrisman"
}
```

Here's another question:  where is this "success" function?   Is it defined elsewhere in the Sphinx spkg?



---

archive/issue_comments_120936.json:
```json
{
    "body": "Replying to [comment:42 kcrisman]:\n> Here's another question:  where is this \"success\" function?   Is it defined elsewhere in the Sphinx spkg?\n\nAt the beginning of `spkg-install`:\n\n```sh\n# Helper functions\nsuccess() {\n    if [ $? -ne 0 ]; then\n        echo \"Error building Sphinx: '$1'\"\n        exit 1\n    fi\n}\n```\n",
    "created_at": "2011-07-05T17:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120936",
    "user": "@nexttime"
}
```

Replying to [comment:42 kcrisman]:
> Here's another question:  where is this "success" function?   Is it defined elsewhere in the Sphinx spkg?

At the beginning of `spkg-install`:

```sh
# Helper functions
success() {
    if [ $? -ne 0 ]; then
        echo "Error building Sphinx: '$1'"
        exit 1
    fi
}
```




---

archive/issue_comments_120937.json:
```json
{
    "body": "New version up at same location.  Also removes obsolete `dist/debian` directory.",
    "created_at": "2011-07-06T07:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120937",
    "user": "@jdemeyer"
}
```

New version up at same location.  Also removes obsolete `dist/debian` directory.



---

archive/issue_comments_120938.json:
```json
{
    "body": "Replying to [comment:40 kcrisman]:\n> Leif, he moved that comment to the SPKG.txt instructions, so it should be okay.\n\nIndeed, I think such comments belong in `SPKG.txt`, not in `spkg-install`.",
    "created_at": "2011-07-06T07:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120938",
    "user": "@jdemeyer"
}
```

Replying to [comment:40 kcrisman]:
> Leif, he moved that comment to the SPKG.txt instructions, so it should be okay.

Indeed, I think such comments belong in `SPKG.txt`, not in `spkg-install`.



---

archive/issue_comments_120939.json:
```json
{
    "body": "Replying to [comment:38 leif]:\n> If you quote `$p`\nDone\n\n> and commit the changes\nThis is no longer necessary, the changes will be committed when the spkg is merged.",
    "created_at": "2011-07-06T07:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120939",
    "user": "@jdemeyer"
}
```

Replying to [comment:38 leif]:
> If you quote `$p`
Done

> and commit the changes
This is no longer necessary, the changes will be committed when the spkg is merged.



---

archive/issue_comments_120940.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:40 kcrisman]:\n> > Leif, he moved that comment to the SPKG.txt instructions, so it should be okay.\n> \n> Indeed, I think such comments belong in `SPKG.txt`, not in `spkg-install`.\n\nThe *Patches* section...\n\nI think if you apply them \"manually\" (i.e. not in a loop, which would be necessary if order matters), there should also be a comment (in `spkg-install`) which issue a specific `patch` commands fixes.",
    "created_at": "2011-07-06T11:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120940",
    "user": "@nexttime"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:40 kcrisman]:
> > Leif, he moved that comment to the SPKG.txt instructions, so it should be okay.
> 
> Indeed, I think such comments belong in `SPKG.txt`, not in `spkg-install`.

The *Patches* section...

I think if you apply them "manually" (i.e. not in a loop, which would be necessary if order matters), there should also be a comment (in `spkg-install`) which issue a specific `patch` commands fixes.



---

archive/issue_comments_120941.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> Replying to [comment:38 leif]:\n> > and commit the changes\n> This is no longer necessary, the changes will be committed when the spkg is merged.\n\nWTF? In whose name, and what will be the commit message?\n\nI'm strongly against \"generic\" commit messages, even if the tags (with the spkg version / patch level, perhaps ticket number) were complete, i.e. referring to the Changelog. Each Changelog entry is somewhat cumulative, and usually more high-level, while commit messages may be more specific (especially if they consist of more than one line).\n\nSo I wouldn't encourage people to not commit their changes.\n\nAlso, having multiple commits in the same spkg version is useful (and not uncommon, even by a single developer) if the changes are (perhaps bigger and) rather unrelated.\n\nThen having the last change uncommitted would be a bit inconsistent.\n\nAlso, I think `sage -pkg ...` (does *anybody* use that? :-) ) would at least currently reject an spkg with uncommitted changes, which isn't all bad.",
    "created_at": "2011-07-06T12:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120941",
    "user": "@nexttime"
}
```

Replying to [comment:46 jdemeyer]:
> Replying to [comment:38 leif]:
> > and commit the changes
> This is no longer necessary, the changes will be committed when the spkg is merged.

WTF? In whose name, and what will be the commit message?

I'm strongly against "generic" commit messages, even if the tags (with the spkg version / patch level, perhaps ticket number) were complete, i.e. referring to the Changelog. Each Changelog entry is somewhat cumulative, and usually more high-level, while commit messages may be more specific (especially if they consist of more than one line).

So I wouldn't encourage people to not commit their changes.

Also, having multiple commits in the same spkg version is useful (and not uncommon, even by a single developer) if the changes are (perhaps bigger and) rather unrelated.

Then having the last change uncommitted would be a bit inconsistent.

Also, I think `sage -pkg ...` (does *anybody* use that? :-) ) would at least currently reject an spkg with uncommitted changes, which isn't all bad.



---

archive/issue_comments_120942.json:
```json
{
    "body": "Replying to [comment:48 leif]:\n> Replying to [comment:46 jdemeyer]:\n> > Replying to [comment:38 leif]:\n> > > and commit the changes\n> > This is no longer necessary, the changes will be committed when the spkg is merged.\n> \n> WTF? In whose name, and what will be the commit message?\n> \n> I'm strongly against \"generic\" commit messages, even if the tags (with the spkg version / patch level, perhaps ticket number) were complete, i.e. referring to the Changelog. Each Changelog entry is somewhat cumulative, and usually more high-level, while commit messages may be more specific (especially if they consist of more than one line).\n> \n> So I wouldn't encourage people to not commit their changes.\n\nIMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.\nIt would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,\nrather than handwritten scripts...\n\nThe need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.\n\n> \n> Also, having multiple commits in the same spkg version is useful (and not uncommon, even by a single developer) if the changes are (perhaps bigger and) rather unrelated.\n> \n> Then having the last change uncommitted would be a bit inconsistent.\n> \n> Also, I think `sage -pkg ...` (does *anybody* use that? :-) ) would at least currently reject an spkg with uncommitted changes, which isn't all bad.\n\nno, that's not true. And in fact sage -pkg should not reject such an spkg, as you want to debug your spkg before committing changes.\n\nDima",
    "created_at": "2011-07-06T12:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120942",
    "user": "@dimpase"
}
```

Replying to [comment:48 leif]:
> Replying to [comment:46 jdemeyer]:
> > Replying to [comment:38 leif]:
> > > and commit the changes
> > This is no longer necessary, the changes will be committed when the spkg is merged.
> 
> WTF? In whose name, and what will be the commit message?
> 
> I'm strongly against "generic" commit messages, even if the tags (with the spkg version / patch level, perhaps ticket number) were complete, i.e. referring to the Changelog. Each Changelog entry is somewhat cumulative, and usually more high-level, while commit messages may be more specific (especially if they consist of more than one line).
> 
> So I wouldn't encourage people to not commit their changes.

IMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.
It would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,
rather than handwritten scripts...

The need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.

> 
> Also, having multiple commits in the same spkg version is useful (and not uncommon, even by a single developer) if the changes are (perhaps bigger and) rather unrelated.
> 
> Then having the last change uncommitted would be a bit inconsistent.
> 
> Also, I think `sage -pkg ...` (does *anybody* use that? :-) ) would at least currently reject an spkg with uncommitted changes, which isn't all bad.

no, that's not true. And in fact sage -pkg should not reject such an spkg, as you want to debug your spkg before committing changes.

Dima



---

archive/issue_comments_120943.json:
```json
{
    "body": "Replying to [comment:48 leif]:\n> Replying to [comment:46 jdemeyer]:\n> > Replying to [comment:38 leif]:\n> > > and commit the changes\n> > This is no longer necessary, the changes will be committed when the spkg is merged.\n> \n> what will be the commit message?\nThe commit message will be the complete `SPKG.txt` entry, so in this case:\n\n```\n### flint-1.5.0.p7 (Jeroen Demeyer, 6 July 2011)\n * Trac #11246: remove check for gcc version since we require gcc >= 4.0.1\n   for Sage anyway.\n * Use `patch` instead of `cp` for patching the makefile\n * Remove test_gcc_version.sh and the horrible makepatchfiles\n * Check that `patch` succeeded in spkg-install, apply patches at -p1 level\n * Remove obsolete dist/debian directory\n```\n\n\n> Then having the last change uncommitted would be a bit inconsistent.\nWell, you can always commit all changes yourself, there is no harm.  I personally prefer not to commit any changes until the spkg is really ready to be shipped.\n\n> Also, I think `sage -pkg ...` would at least currently reject an spkg with uncommitted changes, which isn't all bad.\nIt does not reject it, it merely notifies the user that there are uncomitted changes.",
    "created_at": "2011-07-06T12:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120943",
    "user": "@jdemeyer"
}
```

Replying to [comment:48 leif]:
> Replying to [comment:46 jdemeyer]:
> > Replying to [comment:38 leif]:
> > > and commit the changes
> > This is no longer necessary, the changes will be committed when the spkg is merged.
> 
> what will be the commit message?
The commit message will be the complete `SPKG.txt` entry, so in this case:

```
### flint-1.5.0.p7 (Jeroen Demeyer, 6 July 2011)
 * Trac #11246: remove check for gcc version since we require gcc >= 4.0.1
   for Sage anyway.
 * Use `patch` instead of `cp` for patching the makefile
 * Remove test_gcc_version.sh and the horrible makepatchfiles
 * Check that `patch` succeeded in spkg-install, apply patches at -p1 level
 * Remove obsolete dist/debian directory
```


> Then having the last change uncommitted would be a bit inconsistent.
Well, you can always commit all changes yourself, there is no harm.  I personally prefer not to commit any changes until the spkg is really ready to be shipped.

> Also, I think `sage -pkg ...` would at least currently reject an spkg with uncommitted changes, which isn't all bad.
It does not reject it, it merely notifies the user that there are uncomitted changes.



---

archive/issue_comments_120944.json:
```json
{
    "body": "Except for not having committed the changes (1 rubber point deduction), **positive review** from me.\n\nAs I mentioned, I'll make further changes on a follow-up for FLINT 1.5.2.",
    "created_at": "2011-07-06T12:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120944",
    "user": "@nexttime"
}
```

Except for not having committed the changes (1 rubber point deduction), **positive review** from me.

As I mentioned, I'll make further changes on a follow-up for FLINT 1.5.2.



---

archive/issue_comments_120945.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-06T12:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120945",
    "user": "@nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120946.json:
```json
{
    "body": "There was a problem with Unix vs. DOS newlines in `patches/mpn_extras.h.patch`.  New version up for review, same location.",
    "created_at": "2011-07-06T13:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120946",
    "user": "@jdemeyer"
}
```

There was a problem with Unix vs. DOS newlines in `patches/mpn_extras.h.patch`.  New version up for review, same location.



---

archive/issue_comments_120947.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-07-06T13:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120947",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_120948.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-06T13:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120948",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120949.json:
```json
{
    "body": "Diff between the .p6 and .p7 versions, for review only",
    "created_at": "2011-07-06T13:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120949",
    "user": "@jdemeyer"
}
```

Diff between the .p6 and .p7 versions, for review only



---

archive/issue_comments_120950.json:
```json
{
    "body": "Attachment [flint-1.5.0.p6-p7.diff](tarball://root/attachments/some-uuid/ticket11246/flint-1.5.0.p6-p7.diff) by @nexttime created at 2011-07-06 13:02:04\n\nReplying to [comment:50 jdemeyer]:\n> Well, you can always commit all changes yourself, there is no harm.  I personally prefer not to commit any changes until the spkg is really ready to be shipped.\n\nWell, as I said, I just wouldn't encourage others to proceed like that.\n\n(I know it might sometimes be tedious to undo some changes, but any spkgs advertised on a ticket should IMHO have already all changes committed, at least if it's \"needs review\". And having multiple, independent patches to an spkg on the ticket for review can be advantageous.)",
    "created_at": "2011-07-06T13:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120950",
    "user": "@nexttime"
}
```

Attachment [flint-1.5.0.p6-p7.diff](tarball://root/attachments/some-uuid/ticket11246/flint-1.5.0.p6-p7.diff) by @nexttime created at 2011-07-06 13:02:04

Replying to [comment:50 jdemeyer]:
> Well, you can always commit all changes yourself, there is no harm.  I personally prefer not to commit any changes until the spkg is really ready to be shipped.

Well, as I said, I just wouldn't encourage others to proceed like that.

(I know it might sometimes be tedious to undo some changes, but any spkgs advertised on a ticket should IMHO have already all changes committed, at least if it's "needs review". And having multiple, independent patches to an spkg on the ticket for review can be advantageous.)



---

archive/issue_comments_120951.json:
```json
{
    "body": "Replying to [comment:52 jdemeyer]:\n> There was a problem with Unix vs. DOS newlines in `patches/mpn_extras.h.patch`.\n\nSorry, missed that... ;-)\n\n(Fortunately, we now check the exit code of `patch`. :-) )",
    "created_at": "2011-07-06T13:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120951",
    "user": "@nexttime"
}
```

Replying to [comment:52 jdemeyer]:
> There was a problem with Unix vs. DOS newlines in `patches/mpn_extras.h.patch`.

Sorry, missed that... ;-)

(Fortunately, we now check the exit code of `patch`. :-) )



---

archive/issue_comments_120952.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-06T13:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120952",
    "user": "@nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120953.json:
```json
{
    "body": "P.S.: Latest p7 spkg now also really tested with Sage 4.7.1.alpha4 on Ubuntu 9.04 x86_64.\n\nP.P.S.: The md5sum will (hopefully) change after the changes have been committed, so that's another argument...",
    "created_at": "2011-07-06T13:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120953",
    "user": "@nexttime"
}
```

P.S.: Latest p7 spkg now also really tested with Sage 4.7.1.alpha4 on Ubuntu 9.04 x86_64.

P.P.S.: The md5sum will (hopefully) change after the changes have been committed, so that's another argument...



---

archive/issue_comments_120954.json:
```json
{
    "body": "Replying to [comment:51 leif]:\n> Except for not having committed the changes (1 rubber point deduction), **positive review** from me.\n> \n> As I mentioned, I'll make further changes on a follow-up for FLINT 1.5.2.\nCan you take into account the (very minor) change for #11547 in that?   The only substantive change is \n\n```\nif [ $UNAME = \"CYGWIN\" ]; then \n    <snip>\n   CP -p libflint.so libflint.dll \n```\n\nAnd this is necessary for Sage to start on Cygwin.  I currently had that be p7, but that could be made p8 instead.  I guess the point is that we would want this in any further FLINT upgrade, so that we don't have to keep making new spkgs.",
    "created_at": "2011-07-06T13:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120954",
    "user": "@kcrisman"
}
```

Replying to [comment:51 leif]:
> Except for not having committed the changes (1 rubber point deduction), **positive review** from me.
> 
> As I mentioned, I'll make further changes on a follow-up for FLINT 1.5.2.
Can you take into account the (very minor) change for #11547 in that?   The only substantive change is 

```
if [ $UNAME = "CYGWIN" ]; then 
    <snip>
   CP -p libflint.so libflint.dll 
```

And this is necessary for Sage to start on Cygwin.  I currently had that be p7, but that could be made p8 instead.  I guess the point is that we would want this in any further FLINT upgrade, so that we don't have to keep making new spkgs.



---

archive/issue_comments_120955.json:
```json
{
    "body": "Replying to [comment:57 kcrisman]:\n> Can you take into account the (very minor) change for #11547 in that?   The only substantive change is \n\n```\nif [ $UNAME = \"CYGWIN\" ]; then \n    <snip>\n   CP -p libflint.so libflint.dll \n```\n\n\nThanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`); I'll have to rebase the changes I made so far anyway.\n\nDo you create a p8 that's based on the latest p7 here? If so, and if not on #11547, please cc me or let me know by other means.",
    "created_at": "2011-07-06T13:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120955",
    "user": "@nexttime"
}
```

Replying to [comment:57 kcrisman]:
> Can you take into account the (very minor) change for #11547 in that?   The only substantive change is 

```
if [ $UNAME = "CYGWIN" ]; then 
    <snip>
   CP -p libflint.so libflint.dll 
```


Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`); I'll have to rebase the changes I made so far anyway.

Do you create a p8 that's based on the latest p7 here? If so, and if not on #11547, please cc me or let me know by other means.



---

archive/issue_comments_120956.json:
```json
{
    "body": "> Do you create a p8 that's based on the latest p7 here? If so, and if not on #11547, please cc me or let me know by other means.\n\nNo, I haven't, but if I would, it would be on #11547, where you have added yourself.",
    "created_at": "2011-07-06T14:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120956",
    "user": "@kcrisman"
}
```

> Do you create a p8 that's based on the latest p7 here? If so, and if not on #11547, please cc me or let me know by other means.

No, I haven't, but if I would, it would be on #11547, where you have added yourself.



---

archive/issue_comments_120957.json:
```json
{
    "body": "> Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`); \nGood point, but luckily the patch has `$CP`; I just cut and pasted it inaccurately here.",
    "created_at": "2011-07-06T14:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120957",
    "user": "@kcrisman"
}
```

> Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`); 
Good point, but luckily the patch has `$CP`; I just cut and pasted it inaccurately here.



---

archive/issue_comments_120958.json:
```json
{
    "body": "Replying to [comment:58 leif]:\n> Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`);\n\nI prefer `cp`, I see no reason to use `$CP`.  There was a similar discussion about `$RM` before in which it was decided that `$RM` would not be used anymore.  Now `$RM` has been replaced by `rm` (or `rm -f`) everywhere.",
    "created_at": "2011-07-06T15:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120958",
    "user": "@jdemeyer"
}
```

Replying to [comment:58 leif]:
> Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`);

I prefer `cp`, I see no reason to use `$CP`.  There was a similar discussion about `$RM` before in which it was decided that `$RM` would not be used anymore.  Now `$RM` has been replaced by `rm` (or `rm -f`) everywhere.



---

archive/issue_comments_120959.json:
```json
{
    "body": "Replying to [comment:61 jdemeyer]:\n> Replying to [comment:58 leif]:\n> > Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`);\n> \n> I prefer `cp`, I see no reason to use `$CP`.\n\nMaybe some Cygwin -- more precisely Windoofs -- flavour... :D\n\n> There was a similar discussion about `$RM` before in which it was decided that `$RM` would not be used anymore.  Now `$RM` has been replaced by `rm` (or `rm -f`) everywhere.\n\nI know, a long lasting discussion. (And the main reason for unsetting it was just a change in autotools which caused some trivial trouble, otherwise using variables might not be necessary, but is always more flexible, since that way one doesn't have to set up special `PATH`s to build or use Sage. I'm btw. still in favour of supporting `~/.sagerc` and perhaps `SAGERC`, not to mention using `SAGE_CC`, `SAGE_CFLAGS` etc. instead of `CC`, `CFLAGS`, since one never knows where the latter come from, meaning if they've intentionally been set [for Sage], and -- more important -- whether they've been set by the user or by some Sage script...)",
    "created_at": "2011-07-06T15:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120959",
    "user": "@nexttime"
}
```

Replying to [comment:61 jdemeyer]:
> Replying to [comment:58 leif]:
> > Thanks for pointing me to that one. Of course I can include that (though either `$CP` or `cp`);
> 
> I prefer `cp`, I see no reason to use `$CP`.

Maybe some Cygwin -- more precisely Windoofs -- flavour... :D

> There was a similar discussion about `$RM` before in which it was decided that `$RM` would not be used anymore.  Now `$RM` has been replaced by `rm` (or `rm -f`) everywhere.

I know, a long lasting discussion. (And the main reason for unsetting it was just a change in autotools which caused some trivial trouble, otherwise using variables might not be necessary, but is always more flexible, since that way one doesn't have to set up special `PATH`s to build or use Sage. I'm btw. still in favour of supporting `~/.sagerc` and perhaps `SAGERC`, not to mention using `SAGE_CC`, `SAGE_CFLAGS` etc. instead of `CC`, `CFLAGS`, since one never knows where the latter come from, meaning if they've intentionally been set [for Sage], and -- more important -- whether they've been set by the user or by some Sage script...)



---

archive/issue_comments_120960.json:
```json
{
    "body": "Replying to [comment:49 dimpase]:\n> IMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.\n> It would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,\n> rather than handwritten scripts...\n> \n> The need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.\n\nIf I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.\n\nI'd rather vote for splitting off the whole vanilla source trees (`src/`) and ship them as separate tarballs (perhaps just repackaged with `tar` and `bzip2`), along with cut-down Sage-source only `.spkg` files (preferably with a new extension, say `.spi`).\n\n`sage-spkg` then could take care of the upstream packages, putting their appropriate, corresponding versions into place before calling `spkg-install`, i.e. extracting them into `src/`, such that we would not even have to change anything in the existing `spkg-install` and `spkg-check` files, the Sage part of spkgs.\n\nThat way, we could even have a single spkg (or \"spi\") repository, which would greatly ease working on spkgs and merging changes. Also, this would not only decrease the download size upon upgrades (assuming just Sage's patch level changed, which is often the case), but also the overall traffic when reviewing spkgs, and -- last but not least -- the \"new\" spkgs, which could then be ordinary Mercurial changesets to simply be applied to the spkg or \"spi\" repository, could be attached to the tickets and merged like any other changes to Sage, i.e. the library, scripts etc.).\n\nInstead of e.g. `foobar-x.y.z.pN.spkg`, we would have `foobar-x.y.z.tar.bz2` (vanilla upstream), perhaps in `$SAGE_ROOT/spkg/standard/upstream`, optionally but preferably a Mercurial repository in `$SAGE_ROOT/spkg/standard` (ignoring `upstream/`), and the stripped-down `foobar-x.y.z.pN.spi` files in `$SAGE_ROOT/spkg/standard`, or even just `foobar-x.y.z.spi` if they are under *central* revision control.",
    "created_at": "2011-07-06T16:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120960",
    "user": "@nexttime"
}
```

Replying to [comment:49 dimpase]:
> IMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.
> It would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,
> rather than handwritten scripts...
> 
> The need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.

If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.

I'd rather vote for splitting off the whole vanilla source trees (`src/`) and ship them as separate tarballs (perhaps just repackaged with `tar` and `bzip2`), along with cut-down Sage-source only `.spkg` files (preferably with a new extension, say `.spi`).

`sage-spkg` then could take care of the upstream packages, putting their appropriate, corresponding versions into place before calling `spkg-install`, i.e. extracting them into `src/`, such that we would not even have to change anything in the existing `spkg-install` and `spkg-check` files, the Sage part of spkgs.

That way, we could even have a single spkg (or "spi") repository, which would greatly ease working on spkgs and merging changes. Also, this would not only decrease the download size upon upgrades (assuming just Sage's patch level changed, which is often the case), but also the overall traffic when reviewing spkgs, and -- last but not least -- the "new" spkgs, which could then be ordinary Mercurial changesets to simply be applied to the spkg or "spi" repository, could be attached to the tickets and merged like any other changes to Sage, i.e. the library, scripts etc.).

Instead of e.g. `foobar-x.y.z.pN.spkg`, we would have `foobar-x.y.z.tar.bz2` (vanilla upstream), perhaps in `$SAGE_ROOT/spkg/standard/upstream`, optionally but preferably a Mercurial repository in `$SAGE_ROOT/spkg/standard` (ignoring `upstream/`), and the stripped-down `foobar-x.y.z.pN.spi` files in `$SAGE_ROOT/spkg/standard`, or even just `foobar-x.y.z.spi` if they are under *central* revision control.



---

archive/issue_comments_120961.json:
```json
{
    "body": "Replying to [comment:63 leif]:\n> Replying to [comment:49 dimpase]:\n> > IMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.\n> > It would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,\n> > rather than handwritten scripts...\n> > \n> > The need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.\n> \n> If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.\n> \n\nReally? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account. A typical spkg tree would be started from a clean history, and keep it for most of the files. So it would be a pretty small increase.",
    "created_at": "2011-07-06T16:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120961",
    "user": "@dimpase"
}
```

Replying to [comment:63 leif]:
> Replying to [comment:49 dimpase]:
> > IMHO, this discussion just highlights a need to revamp the whole spkg system, for 99% of the standard spkgs, at least.
> > It would be much better if the whole non-building part of the spkg install is done in a uniform way, by hg, say,
> > rather than handwritten scripts...
> > 
> > The need for the current spkg system is dictated by the need of some optional parts of Sage, that demand, say, a distribution in an unmodified form. Yet, putting the spkg source under hg is not a modification. Sage can distribute spkg source with the hg tree, and Sage-needed patches as patches to be applied by an spkg-install.
> 
> If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.
> 

Really? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account. A typical spkg tree would be started from a clean history, and keep it for most of the files. So it would be a pretty small increase.



---

archive/issue_comments_120962.json:
```json
{
    "body": "Replying to [comment:64 dimpase]:\n> Replying to [comment:63 leif]:\n> > If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.\n> > \n> \n> Really? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account.\n\nI don't know which files' sizes you've added up there, but, first of all, a [compressed] source tree with meta information will obviously always be larger than [a compressed] one without it (even when you check out the current versions before calling `spkg-install` rather than redundantly shipping them already checked out along with the repository), and second, presumably more important, you'd then in addition carry all the upstream history, which of course would grow the packages' sizes in comparison to what we have now.",
    "created_at": "2011-07-06T17:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120962",
    "user": "@nexttime"
}
```

Replying to [comment:64 dimpase]:
> Replying to [comment:63 leif]:
> > If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.
> > 
> 
> Really? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account.

I don't know which files' sizes you've added up there, but, first of all, a [compressed] source tree with meta information will obviously always be larger than [a compressed] one without it (even when you check out the current versions before calling `spkg-install` rather than redundantly shipping them already checked out along with the repository), and second, presumably more important, you'd then in addition carry all the upstream history, which of course would grow the packages' sizes in comparison to what we have now.



---

archive/issue_comments_120963.json:
```json
{
    "body": "Replying to [comment:65 leif]:\n> Replying to [comment:64 dimpase]:\n> > Replying to [comment:63 leif]:\n> > > If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.\n> > > \n> > \n> > Really? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account.\n> \n> I don't know which files' sizes you've added up there, \n\nI just ran 'du' command on '$SAGEROOT/devel/sage/', and on '$SAGEROOT/devel/sage/.hg'.\n \n> but, first of all, a [compressed] source tree with meta information will obviously always be larger than [a compressed] one without it (even when you check out the current versions before calling `spkg-install` rather than redundantly shipping them already checked out along with the repository), and second, presumably more important, you'd then in addition carry all the upstream history, which of course would grow the packages' sizes in comparison to what we have now.\n\n\nI am not talking about carrying around the whole upstream history, which may or may not be available. If upstream upgrades in a clean patch fashion, then it's easy to import their patches and carry them on. Otherwise we basically would throw the history away, just as we do presently, and start anew.",
    "created_at": "2011-07-06T17:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120963",
    "user": "@dimpase"
}
```

Replying to [comment:65 leif]:
> Replying to [comment:64 dimpase]:
> > Replying to [comment:63 leif]:
> > > If I understand you correctly (having the whole upstream tree under revision control), that would heavily increase their sizes.
> > > 
> > 
> > Really? Why? If I look at my current $SAGEROOT/devel/sage/, I have 878Mb, while its .hg is 51Mb. And here the fact that this tree has a long history must be taken into account.
> 
> I don't know which files' sizes you've added up there, 

I just ran 'du' command on '$SAGEROOT/devel/sage/', and on '$SAGEROOT/devel/sage/.hg'.
 
> but, first of all, a [compressed] source tree with meta information will obviously always be larger than [a compressed] one without it (even when you check out the current versions before calling `spkg-install` rather than redundantly shipping them already checked out along with the repository), and second, presumably more important, you'd then in addition carry all the upstream history, which of course would grow the packages' sizes in comparison to what we have now.


I am not talking about carrying around the whole upstream history, which may or may not be available. If upstream upgrades in a clean patch fashion, then it's easy to import their patches and carry them on. Otherwise we basically would throw the history away, just as we do presently, and start anew.



---

archive/issue_comments_120964.json:
```json
{
    "body": "Replying to [comment:66 dimpase]:\n> Replying to [comment:65 leif]:\n> > I don't know which files' sizes you've added up there, \n> \n> I just ran 'du' command on '$SAGEROOT/devel/sage/', and on '$SAGEROOT/devel/sage/.hg'.\n\nWell, then you've counted also all generated files (`*.{pyc,pyo,o,so,whatever}`, most of `*.{c,cpp}`), the complete `build/` tree, and all of Sphinx's generated files beneath `doc/`. (Just take a look at `.hgignore`.)\n\nAlso, since Mercurial stores its files compressed, for a fair comparison you should have compared a compressed version of `.hg/` to an equally compressed tarball or whatever of the plain / checked-out source files.",
    "created_at": "2011-07-06T18:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120964",
    "user": "@nexttime"
}
```

Replying to [comment:66 dimpase]:
> Replying to [comment:65 leif]:
> > I don't know which files' sizes you've added up there, 
> 
> I just ran 'du' command on '$SAGEROOT/devel/sage/', and on '$SAGEROOT/devel/sage/.hg'.

Well, then you've counted also all generated files (`*.{pyc,pyo,o,so,whatever}`, most of `*.{c,cpp}`), the complete `build/` tree, and all of Sphinx's generated files beneath `doc/`. (Just take a look at `.hgignore`.)

Also, since Mercurial stores its files compressed, for a fair comparison you should have compared a compressed version of `.hg/` to an equally compressed tarball or whatever of the plain / checked-out source files.



---

archive/issue_comments_120965.json:
```json
{
    "body": "Replying to [comment:66 dimpase]:\n> I am not talking about carrying around the whole upstream history, which may or may not be available. If upstream upgrades in a clean patch fashion, then it's easy to import their patches and carry them on. Otherwise we basically would throw the history away, just as we do presently, and start anew. \n\nEither you put `src/` under revision control, or you don't. If you do, then copying a fresh, upgraded upstream tree into `src/`, Mercurial will record the changes relative to the previous version in Sage, whichever that was. And you'd have the same problems with possibly rebasing patches that Sage made to the previous upstream release.\n\nOr did you mean putting `src/` into a *separate* Mercurial repository, to be thrown away upon every upstream upgrade?\n\nI cannot really see an advantage in either way.",
    "created_at": "2011-07-06T18:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120965",
    "user": "@nexttime"
}
```

Replying to [comment:66 dimpase]:
> I am not talking about carrying around the whole upstream history, which may or may not be available. If upstream upgrades in a clean patch fashion, then it's easy to import their patches and carry them on. Otherwise we basically would throw the history away, just as we do presently, and start anew. 

Either you put `src/` under revision control, or you don't. If you do, then copying a fresh, upgraded upstream tree into `src/`, Mercurial will record the changes relative to the previous version in Sage, whichever that was. And you'd have the same problems with possibly rebasing patches that Sage made to the previous upstream release.

Or did you mean putting `src/` into a *separate* Mercurial repository, to be thrown away upon every upstream upgrade?

I cannot really see an advantage in either way.



---

archive/issue_comments_120966.json:
```json
{
    "body": "I suggest this discussion belongs on sage-devel   :-)    as I'm sure others have opinions as well.",
    "created_at": "2011-07-06T18:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120966",
    "user": "@kcrisman"
}
```

I suggest this discussion belongs on sage-devel   :-)    as I'm sure others have opinions as well.



---

archive/issue_comments_120967.json:
```json
{
    "body": "Replying to [comment:69 kcrisman]:\n> I suggest this discussion belongs on sage-devel   :-)    as I'm sure others have opinions as well.  \n\nJust post a link to this ticket there. XD\n\n(A BBS would IMHO be better for such discussions. The only advantage of G**gle groups over trac is that the former supports concurrent posting.)",
    "created_at": "2011-07-06T19:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120967",
    "user": "@nexttime"
}
```

Replying to [comment:69 kcrisman]:
> I suggest this discussion belongs on sage-devel   :-)    as I'm sure others have opinions as well.  

Just post a link to this ticket there. XD

(A BBS would IMHO be better for such discussions. The only advantage of G**gle groups over trac is that the former supports concurrent posting.)



---

archive/issue_comments_120968.json:
```json
{
    "body": "Back on topic, for the record:\n\n```sh\nleif@portland:~/Sage/spkgs$ du -sch `find flint-1.5.0.p7/ -name .svn`\n140K\tflint-1.5.0.p7/src/zn_poly/test/.svn\n432K\tflint-1.5.0.p7/src/zn_poly/src/.svn\n148K\tflint-1.5.0.p7/src/zn_poly/include/.svn\n76K\tflint-1.5.0.p7/src/zn_poly/demo/bernoulli/.svn\n44K\tflint-1.5.0.p7/src/zn_poly/demo/.svn\n96K\tflint-1.5.0.p7/src/zn_poly/tune/.svn\n140K\tflint-1.5.0.p7/src/zn_poly/profile/.svn\n48K\tflint-1.5.0.p7/src/zn_poly/doc/.svn\n1.1M\ttotal\nleif@portland:~/Sage/spkgs$ \n```\n",
    "created_at": "2011-07-06T19:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120968",
    "user": "@nexttime"
}
```

Back on topic, for the record:

```sh
leif@portland:~/Sage/spkgs$ du -sch `find flint-1.5.0.p7/ -name .svn`
140K	flint-1.5.0.p7/src/zn_poly/test/.svn
432K	flint-1.5.0.p7/src/zn_poly/src/.svn
148K	flint-1.5.0.p7/src/zn_poly/include/.svn
76K	flint-1.5.0.p7/src/zn_poly/demo/bernoulli/.svn
44K	flint-1.5.0.p7/src/zn_poly/demo/.svn
96K	flint-1.5.0.p7/src/zn_poly/tune/.svn
140K	flint-1.5.0.p7/src/zn_poly/profile/.svn
48K	flint-1.5.0.p7/src/zn_poly/doc/.svn
1.1M	total
leif@portland:~/Sage/spkgs$ 
```




---

archive/issue_comments_120969.json:
```json
{
    "body": "Again slightly off-topic, just as an example:\n\n```sh\n~/flint-1.5.0.p7$ mv src/ src-plain\n~/flint-1.5.0.p7$ cp -pr src-plain/ src-hg\n~/flint-1.5.0.p7$ diff -r src-plain/ src-hg/\n~/flint-1.5.0.p7$ (cd src-hg/ && hg init && hg add >/dev/null && hg commit -m \"initial revision\")\n~/flint-1.5.0.p7$ (cd src-hg/ && rm -rf *)\n~/flint-1.5.0.p7$ for d in src-*; do echo -n \"$d: \"; tar cjf - $d | wc -c; done\nsrc-hg: 1015130\nsrc-plain: 754703\n```\n\n\n(With the `.svn` folders [still] included, which shouldn't matter here. FLINT is quite small compared to other spkgs anyway, so the absolute difference should be much? larger on average.)",
    "created_at": "2011-07-06T20:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120969",
    "user": "@nexttime"
}
```

Again slightly off-topic, just as an example:

```sh
~/flint-1.5.0.p7$ mv src/ src-plain
~/flint-1.5.0.p7$ cp -pr src-plain/ src-hg
~/flint-1.5.0.p7$ diff -r src-plain/ src-hg/
~/flint-1.5.0.p7$ (cd src-hg/ && hg init && hg add >/dev/null && hg commit -m "initial revision")
~/flint-1.5.0.p7$ (cd src-hg/ && rm -rf *)
~/flint-1.5.0.p7$ for d in src-*; do echo -n "$d: "; tar cjf - $d | wc -c; done
src-hg: 1015130
src-plain: 754703
```


(With the `.svn` folders [still] included, which shouldn't matter here. FLINT is quite small compared to other spkgs anyway, so the absolute difference should be much? larger on average.)



---

archive/issue_comments_120970.json:
```json
{
    "body": "P.S.: For all standard spkgs (327 MB), taking the ratio for FLINT (1.345), this would mean about +113 MB, which IMHO would be an unreasonable increase. (And that doesn't even take into account the history for changes made by Sage to upstream releases.)",
    "created_at": "2011-07-06T20:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120970",
    "user": "@nexttime"
}
```

P.S.: For all standard spkgs (327 MB), taking the ratio for FLINT (1.345), this would mean about +113 MB, which IMHO would be an unreasonable increase. (And that doesn't even take into account the history for changes made by Sage to upstream releases.)



---

archive/issue_comments_120971.json:
```json
{
    "body": "New version with fully committed changes, same location: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-1.5.0.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-1.5.0.p7.spkg)\n\nYou can use this to base a .p8 on.",
    "created_at": "2011-07-07T08:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120971",
    "user": "@jdemeyer"
}
```

New version with fully committed changes, same location: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-1.5.0.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-1.5.0.p7.spkg)

You can use this to base a .p8 on.



---

archive/issue_comments_120972.json:
```json
{
    "body": "Unfortunately, because of the sage.math cluster failure, this is not currently accessible.   Given that the actual relevant part of [http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff](http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff) is \n\n```\n### flint-1.5.0.p7 (Karl-Dieter Crisman, 28th June 2011)\n * Enable both libflint.dll and .so on Cygwin (see Trac 11547) \n```\n\nand \n\n```\n-     # also name flint library correctly for MS Windows (an so won't work). \n-     mv libflint.so libflint.dll \n+    # make both kinds of dynamic libraries available for Windows \n+    $CP -p libflint.so libflint.dll\n```\n\n(where the `$CP` could change to `cp`)\n\nthen perhaps someone could be kind when this comes back online and make the p8 there.  It would be very, very good to have all of the stuff at #6743 merged as soon as possible so we don't go backwards.  I'm unfortunately about to go largely offline for about two weeks, so I will not be around when p7 becomes available (at least, I don't think I'm going to have good access).",
    "created_at": "2011-07-12T14:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120972",
    "user": "@kcrisman"
}
```

Unfortunately, because of the sage.math cluster failure, this is not currently accessible.   Given that the actual relevant part of [http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff](http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff) is 

```
### flint-1.5.0.p7 (Karl-Dieter Crisman, 28th June 2011)
 * Enable both libflint.dll and .so on Cygwin (see Trac 11547) 
```

and 

```
-     # also name flint library correctly for MS Windows (an so won't work). 
-     mv libflint.so libflint.dll 
+    # make both kinds of dynamic libraries available for Windows 
+    $CP -p libflint.so libflint.dll
```

(where the `$CP` could change to `cp`)

then perhaps someone could be kind when this comes back online and make the p8 there.  It would be very, very good to have all of the stuff at #6743 merged as soon as possible so we don't go backwards.  I'm unfortunately about to go largely offline for about two weeks, so I will not be around when p7 becomes available (at least, I don't think I'm going to have good access).



---

archive/issue_comments_120973.json:
```json
{
    "body": "Replying to [comment:75 kcrisman]:\n> Unfortunately, because of the sage.math cluster failure, this is not currently accessible.   Given that the actual relevant part of [http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff](http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff) is \n\n```\n### flint-1.5.0.p7 (Karl-Dieter Crisman, 28th June 2011)\n * Enable both libflint.dll and .so on Cygwin (see Trac 11547) \n```\n\n> and \n\n```\n-     # also name flint library correctly for MS Windows (an so won't work). \n-     mv libflint.so libflint.dll \n+    # make both kinds of dynamic libraries available for Windows \n+    $CP -p libflint.so libflint.dll\n```\n\n> (where the `$CP` could change to `cp`)\n> \n> then perhaps someone could be kind when this comes back online and make the p8 there.\n\nI've made a p8 with (only) these changes based on the latest p7 from here and uploaded it onto G**gle code. See #11547 for details in a few minutes; I'll also update #6743 accordingly.\n\n\n\n\n> It would be very, very good to have all of the stuff at #6743 merged as soon as possible so we don't go backwards.  I'm unfortunately about to go largely offline for about two weeks, so I will not be around when p7 becomes available (at least, I don't think I'm going to have good access).\n\nWell, being offline isn't always unfortunate. ;-)\n\nHave a good time then.",
    "created_at": "2011-07-12T16:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120973",
    "user": "@nexttime"
}
```

Replying to [comment:75 kcrisman]:
> Unfortunately, because of the sage.math cluster failure, this is not currently accessible.   Given that the actual relevant part of [http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff](http://trac.sagemath.org/sage_trac/attachment/ticket/11547/trac_11547-flint.diff) is 

```
### flint-1.5.0.p7 (Karl-Dieter Crisman, 28th June 2011)
 * Enable both libflint.dll and .so on Cygwin (see Trac 11547) 
```

> and 

```
-     # also name flint library correctly for MS Windows (an so won't work). 
-     mv libflint.so libflint.dll 
+    # make both kinds of dynamic libraries available for Windows 
+    $CP -p libflint.so libflint.dll
```

> (where the `$CP` could change to `cp`)
> 
> then perhaps someone could be kind when this comes back online and make the p8 there.

I've made a p8 with (only) these changes based on the latest p7 from here and uploaded it onto G**gle code. See #11547 for details in a few minutes; I'll also update #6743 accordingly.




> It would be very, very good to have all of the stuff at #6743 merged as soon as possible so we don't go backwards.  I'm unfortunately about to go largely offline for about two weeks, so I will not be around when p7 becomes available (at least, I don't think I'm going to have good access).

Well, being offline isn't always unfortunate. ;-)

Have a good time then.



---

archive/issue_comments_120974.json:
```json
{
    "body": "> I've made a p8 with (only) these changes based on the latest p7 from here and uploaded it onto G**gle code. See #11547 for details in a few minutes; I'll also update #6743 accordingly.\n\nThanks, I appreciate that a lot.   I keep all my spkgs on sage.math only, because I don't want to clutter up my computer, but maybe that was a bad decision this time around :)  I also could use the spkg-upload code project more often, it's true... \n\nBy the way, what's up with the `G**gle`?  Does this confuse them - and to what end?  It's not like there aren't other references to said company on the Sage trac, and you are already quite good at covering your tracks - I can't find any references to you outside of Sage and a couple computer newsgroups and of course [this site](http://dtcs.de/)  ;-)\n\n> Well, being offline isn't always unfortunate. ;-)\n\nGood point.  Besonders wenn man in die Heimat fliegt.",
    "created_at": "2011-07-12T16:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120974",
    "user": "@kcrisman"
}
```

> I've made a p8 with (only) these changes based on the latest p7 from here and uploaded it onto G**gle code. See #11547 for details in a few minutes; I'll also update #6743 accordingly.

Thanks, I appreciate that a lot.   I keep all my spkgs on sage.math only, because I don't want to clutter up my computer, but maybe that was a bad decision this time around :)  I also could use the spkg-upload code project more often, it's true... 

By the way, what's up with the `G**gle`?  Does this confuse them - and to what end?  It's not like there aren't other references to said company on the Sage trac, and you are already quite good at covering your tracks - I can't find any references to you outside of Sage and a couple computer newsgroups and of course [this site](http://dtcs.de/)  ;-)

> Well, being offline isn't always unfortunate. ;-)

Good point.  Besonders wenn man in die Heimat fliegt.



---

archive/issue_comments_120975.json:
```json
{
    "body": "Replying to [comment:77 kcrisman]:\n> By the way, what's up with the `G**gle`?  Does this confuse them - and to what end?\n\nDon't know. I just can't spell it.\n\n\n\n\n> > Well, being offline isn't always unfortunate. ;-)\n> \n> Good point.  Besonders wenn man in die Heimat fliegt.\n\nNa denn guten Flug. Internet gibt's hier allerdings mancherorts. :-)",
    "created_at": "2011-07-12T18:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120975",
    "user": "@nexttime"
}
```

Replying to [comment:77 kcrisman]:
> By the way, what's up with the `G**gle`?  Does this confuse them - and to what end?

Don't know. I just can't spell it.




> > Well, being offline isn't always unfortunate. ;-)
> 
> Good point.  Besonders wenn man in die Heimat fliegt.

Na denn guten Flug. Internet gibt's hier allerdings mancherorts. :-)



---

archive/issue_comments_120976.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-24T11:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11074#issuecomment-120976",
    "user": "@jdemeyer"
}
```

Resolution: fixed
