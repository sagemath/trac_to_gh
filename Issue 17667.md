# Issue 17667: CremonaDatabase omits data for curves not first in their class

Issue created by migration from Trac.

Original creator: cremona

Original creation time: 2015-03-06 20:18:47

CC:  wuthrich

Chris Wuthrich reported that

```
sage: E = EllipticCurve('100467a2')
sage: E.database_attributes()
{'conductor': 100467,
 'cremona_label': '100467a2',
 'rank': 1,
 'torsion_order': 1}
```

although the database does contain the generators:

```
sage: CremonaDatabase().allgens(100467)['a2']
[This is the Trac macro *7465870518064287, 219103670535029299, 7758864174573* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#7465870518064287, 219103670535029299, 7758864174573-macro)
```


It seems that (in two palces) the code to extract the data from the database wrongly assumes that some data only exists for the first curve in each isogeny class, which is not true.

A simple fix to sage/databases/cremona.py is on its way.


---

Comment by cremona created at 2015-03-06 20:19:51

Changing keywords from "" to "Cremona database".


---

Comment by cremona created at 2015-03-06 20:19:51

Changing component from PLEASE CHANGE to elliptic curves.


---

Comment by cremona created at 2015-03-06 20:19:51

Changing type from PLEASE CHANGE to defect.


---

Comment by cremona created at 2015-03-06 20:24:01

Changing status from new to needs_review.


---

Comment by cremona created at 2015-03-06 20:24:01

New commits:


---

Comment by cremona created at 2015-03-06 20:24:40

I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.


---

Comment by wuthrich created at 2015-03-06 22:12:20

I agree with the fix and I checked that it solves the problem. I am running the obligatory tests now.

Thanks for fixing that so fast. Very helpful.


---

Comment by wuthrich created at 2015-03-07 00:47:36

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-03-07 09:45:02

Replying to [comment:3 cremona]:
> I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.

You should add a doctest and annotate it with

```
# optional - database_cremona_ellcurve
```

There are many such tests already in `src/sage/databases/cremona.py`.

(Note that I am not setting the ticket to needs_work for this)


---

Comment by cremona created at 2015-03-07 11:52:15

Replying to [comment:6 jdemeyer]:
> Replying to [comment:3 cremona]:
> > I did not add a doctest since it can only be tested with the optional database_cremona_ellcurve installed.
> 
> You should add a doctest and annotate it with
> {{{
> # optional - database_cremona_ellcurve
> }}}
> There are many such tests already in `src/sage/databases/cremona.py`.

OK, I will do that!

> 
> (Note that I am not setting the ticket to needs_work for this)


---

Comment by git created at 2015-03-07 12:42:03

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-03-07 12:42:03

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by cremona created at 2015-03-07 12:43:13

OK, so I added the doctest and the act of pushing the new commit automatically caused the needs_review flag to be set.  Sorry, Chris!


---

Comment by wuthrich created at 2015-03-07 13:57:03

Changing status from needs_review to positive_review.


---

Comment by wuthrich created at 2015-03-07 13:57:03

Ok. I fixed a tiny sphinx error on that page, too.

I did test cremona.py, but I have not run the complete test again after the last changes which only affect the docstring in that file. If anyone finds that inacceptable, then I will run them.
----
New commits:


---

Comment by cremona created at 2015-03-07 14:08:09

Thanks -- I think we can leave the rest to various bots.

For what it's worth I used the cremona_curves() iterator to grab every single curve and check that len(E.gens())==E.rank(), which it did fast enough to be confident that all the data was really coming from the database.


---

Comment by vbraun created at 2015-03-08 22:01:02

Resolution: fixed
