# Issue 33563: cibuildwheel workflow for sagemath-objects, sagemath-categories etc.

Issue created by migration from https://trac.sagemath.org/ticket/33800

Original creator: mkoeppe

Original creation time: 2022-05-04 21:22:16

CC:  dimpase @kliem @tobiasdiez saraedum




---

Comment by git created at 2022-05-05 03:17:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-05-05 04:27:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-05 04:32:53

The method of installing the required system packages (gmp, mpfr, mpc) with whatever is provided by the target distribution does not work because the manylinux distributions are deliberately ancient. 
Getting `error: #error "GMPY2 requires MPC 1.0.3 or later."` (https://github.com/mkoeppe/sage/runs/6300752059).

Also the macOS arm64 cross-build does not work: `fatal error: 'gmp.h' file not found` (https://github.com/mkoeppe/sage/runs/6300752117)


---

Comment by mkoeppe created at 2022-05-05 06:48:51

We could add a section `[tool.cibuildwheel]` to `pkg/*/pyproject.toml.m4` and add conda installation + conda package installation there as `before-all`.


---

Comment by git created at 2022-06-04 04:42:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-06-04 06:00:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-06-05 13:02:08

check out gmpy2 wheel builder

https://github.com/aleaxit/gmpy/tree/master/.github%2Fworkflows


---

Comment by mkoeppe created at 2022-06-05 17:37:21

They are using straightforward cibuildwheel


---

Comment by dimpase created at 2022-06-05 22:20:23

but they need to have gmp installed first.


---

Comment by mkoeppe created at 2022-06-05 22:25:31

Sure, they install the libraries from source with a custom script. 
In Sage, we can just use our spkg scripts for the same purpose.


---

Comment by git created at 2022-06-18 22:20:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-06-18 22:44:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-18 23:09:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-19 01:00:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-19 01:44:40

Changing status from new to needs_review.


---

Comment by git created at 2022-06-19 03:34:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-28 18:25:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-28 18:26:45

Merged latest #29549, ready for review


---

Comment by dimpase created at 2022-06-29 07:20:24

is this being tested on GH Actions?


---

Comment by mkoeppe created at 2022-06-29 15:53:12

Yes, see link in the ticket description


---

Comment by dimpase created at 2022-06-29 16:35:51

lgtm


---

Comment by dimpase created at 2022-06-29 16:35:51

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-06-29 20:48:30

Thanks!


---

Comment by vbraun created at 2022-07-09 22:33:36

Resolution: fixed
