# Issue 13710: Install zlib shared objects on Cygwin

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2013-01-05 15:42:00

Assignee: tbd

CC:  kcrisman dimpase

Keywords: cygwin zlib spkg

We need to modify the makefile so that SHARED_OBJECT is set to 1.

Use spkg at
http://boxen.math.washington.edu/home/jplfori/zlib-1.2.6.p0.spkg


---

Comment by jpflori created at 2013-01-05 16:03:08

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-01-07 16:50:53

Is this somehow related to #13354?


---

Comment by jpflori created at 2013-01-07 16:53:38

Replying to [comment:2 kcrisman]:
> Is this somehow related to #13354?
Not at all, it is just that we did not customize the win32 makefile correctly before.
Whence the need to install zlib and zlib-devel (or Cygwin equivalents, not sure of the name now) because our own zlib was lacking shared objects.


---

Comment by jpflori created at 2013-01-07 16:54:51

I mean it is unrelated because zlib does not use autotools at all.

If you really want it can be related in the sense that in the end the problem is that shared objects are not installed (even though in the autotools case they are not even built).


---

Comment by kcrisman created at 2013-01-07 17:45:02

> If you really want it can be related in the sense that in the end the problem is that shared objects are not installed (even though in the autotools case they are not even built).
That is what I meant, I guess.

So this would remove the zlib-devel dependency on Win 7, okay, I understand now.


---

Comment by jpflori created at 2013-01-14 17:05:38

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2013-01-14 17:05:38

Something wrong here, this does not install the shared files properly...


---

Comment by jpflori created at 2013-01-14 17:07:02

Groumpf that was SHARED_MOD, not SHARED_OBJECT...


---

Comment by jpflori created at 2013-01-14 19:53:39

Spkg diff, for review only.


---

Attachment

Spkg should be fine now and installed successfully on my system.


---

Comment by jpflori created at 2013-01-14 20:12:58

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-01-22 16:40:30

Well, at least it installs on mine as well, though of course I already had zlib.  I guess the diff looks ok too and only touches Cygwin, correct?  Is there any other spkg or something I should wait for building to give this positive review (i.e., one that depends on it), and how would I know if things were linked against this as opposed to the system one?  (I don't know what zlib does or how it is used, big surprise.)


---

Comment by jpflori created at 2013-01-23 09:49:35

You can run ldd on libs which should use zlib, I'd say it's the case of libgd and libfreetype (from inside a Sage shell).
Or you could just check that the zlib1.dll file is indeed installed.


---

Comment by kcrisman created at 2013-01-24 19:24:54

Sadly, after a required BLODA upgrade to allow my internet access with this machine, Sage won't build - nothing reliable, just the usual horrible stuff and rebasing just delays the pain.  Python package in particular is affected.  So I wonder whether we should just do this and assume it works on XP.  Sorry.


---

Comment by jpflori created at 2013-01-25 10:40:05

Maybe Dima can have a look?
The changes are quite simple so this should not be a hassle.


---

Comment by dimpase created at 2013-01-25 11:49:28

Replying to [comment:13 jpflori]:
> Maybe Dima can have a look?
> The changes are quite simple so this should not be a hassle.

I'll try to build sage 5.7.beta0 on Cygwin...


---

Comment by dimpase created at 2013-01-26 15:49:02

Replying to [comment:14 dimpase]:
> Replying to [comment:13 jpflori]:
> > Maybe Dima can have a look?
> > The changes are quite simple so this should not be a hassle.
> 
> I'll try to build sage 5.7.beta0 on Cygwin...

OK, it builds and works on 64-bit Windows 7 with the latest stable Cygwin, and native Cygwin gcc and gfortran.
Needed to rebase 2 times during the build. Running tests now.

This ticket looks good, positive review.


---

Comment by dimpase created at 2013-01-26 15:49:02

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-01-26 22:07:58

Replying to [comment:12 kcrisman]:
> rebasing just delays the pain.
Speaking of which, do you by chance use the script `$SAGE_LOCAL/bin/sage-rebase_sage.sh`?  Just wondering whether that's used at all.


---

Comment by jpflori created at 2013-01-27 00:34:28

I did not even know it existed...
But, on my side at least, it seems that somehow the situation has gotten better recently.
For my last attempt, I just had to rebase once after installing everything to be able to launch Sage (although after reinstalling some spkg I got stuck with a fork error).
Before that I sometimes had to do horrible stuff like rebasing in the middle of the build of the Maxim spkg, which was kind of painful.


---

Comment by dimpase created at 2013-01-27 01:04:21

Replying to [comment:16 jdemeyer]:
> Replying to [comment:12 kcrisman]:
> > rebasing just delays the pain.
> Speaking of which, do you by chance use the script `$SAGE_LOCAL/bin/sage-rebase_sage.sh`?  Just wondering whether that's used at all.

this script, which basically runs the same 2 shell commands as we use to rebase Sage, must be run in a non-cygwin shell (Cygwin includes a copy of dash for this purpose), not in bash. Perhaps we should convert it into a dash  script.


---

Comment by jdemeyer created at 2013-01-27 18:14:11

My question about `sage-rebase_sage.sh` was more: should be keep it or can it be removed?


---

Comment by dimpase created at 2013-01-28 01:22:27

Replying to [comment:19 jdemeyer]:
> My question about `sage-rebase_sage.sh` was more: should be keep it or can it be removed?
with some work, it can be made useful. I'll open a ticket for this.


---

Comment by kcrisman created at 2013-01-28 02:15:16

Huh, I didn't know this.  Note that on some systems "ash" is needed, not "dash".


---

Comment by dimpase created at 2013-01-28 02:17:38

Replying to [comment:21 kcrisman]:
> Huh, I didn't know this.  Note that on some systems "ash" is needed, not "dash".

Well, I suppose it's the matter of installing `dash`.


---

Comment by kcrisman created at 2013-01-28 03:02:06

> > Huh, I didn't know this.  Note that on some systems "ash" is needed, not "dash".
> Well, I suppose it's the matter of installing `dash`.
Then that would need to be an additional prerequisite for building Sage on Cygwin, which it currently is not.


---

Comment by dimpase created at 2013-01-28 03:33:19

Replying to [comment:23 kcrisman]:
> > > Huh, I didn't know this.  Note that on some systems "ash" is needed, not "dash".
> > Well, I suppose it's the matter of installing `dash`.
> Then that would need to be an additional prerequisite for building Sage on Cygwin, which it currently is not.
we should switch from ash to dash, at least that's what Cygwin people were saying [already in 2009](http://cygwin.com/ml/cygwin/2009-07/msg00367.html).


---

Comment by jpflori created at 2013-01-28 10:12:48

I'd say let's keep the file, I guess it is really samll and can be useful for people not used to rebasing.


---

Comment by dimpase created at 2013-01-29 05:52:55

Replying to [comment:20 dimpase]:
> Replying to [comment:19 jdemeyer]:
> > My question about `sage-rebase_sage.sh` was more: should be keep it or can it be removed?
> with some work, it can be made useful. I'll open a ticket for this.
> 
please see #14031


---

Comment by jdemeyer created at 2013-01-29 16:27:43

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-01-29 16:27:43

This fails to install on OS X 10.8: [http://build.sagemath.org/sage/builders/Dehaye%20%28OSX%2010.8%20x86_64%29/builds/56/steps/shell_6/logs/zlib](http://build.sagemath.org/sage/builders/Dehaye%20%28OSX%2010.8%20x86_64%29/builds/56/steps/shell_6/logs/zlib)


---

Comment by jpflori created at 2013-01-29 16:29:26

Does it work with gcc?


---

Comment by jpflori created at 2013-01-29 16:33:07

Anyway I don't really think this ticket is related.
Here we only touch code in Cygwin specific part (unless $UNAME = CYGWIN on Os X).
So I'm putting this back to positive review.


---

Comment by jpflori created at 2013-01-29 16:33:07

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-01-29 16:44:56

*PLEASE at least double-check before saying that it's not your fault*, especially when the failure is so obvious.

Your spkg is totally badly packaged, it even contains compiled `.o` files.


---

Comment by jdemeyer created at 2013-01-29 16:44:56

Changing status from positive_review to needs_work.


---

Comment by jpflori created at 2013-01-29 16:47:03

Oh, ok, my fault then.


---

Comment by jpflori created at 2013-01-29 16:53:20

Next time state the obvious problem at once instead of linking to a not so obvious for anyone log...
Especially when it seems that all objects are rebuilt there and the problematic libz.a is repackaged correctly.

And I don't usually look into the src folder, too bad this one comes from a test build and is not vanilla.


---

Comment by jpflori created at 2013-01-29 17:02:26

The newly uploaded spkg should be clean.
It stills builds on Cygwin and Linux correctly (note the previous one did as well).
No access to Os X, but checking the src dir is vanilla should be enough.


---

Comment by jpflori created at 2013-01-29 17:02:26

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-01-29 18:34:48

Replying to [comment:32 jpflori]:
> Next time state the obvious problem at once
"obvious" refered to the fact that a _zlib build failure_ might likely be caused by a _zlib package update_.  I hadn't checked the spkg at that point.


---

Comment by dimpase created at 2013-02-05 04:22:29

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2013-02-05 04:22:29

I've checked that the spkg src/ directory didn't change from the previous version. It also builds on OSX 10.6.8 and on Cygwin. Positive review.


---

Comment by jdemeyer created at 2013-02-09 12:14:39

Resolution: fixed
