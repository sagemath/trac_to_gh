# Issue 25676: Allow input as packed words for Hopf algebra WQSym

archive/issues_025676.json:
```json
{
    "body": "CC:  tscrim nthiery darij zabrocki alauve amypang hmlodecki saliola\n\nKeywords: sagedays@icerm, packed words, IMA coding sprint, CHAs\n\nThe Hopf algebra `WordQuasiSymmetricFunctions`, despite it's name, is indexed internally as ordered set partitions. This ticket aims to allow the user to also use packed words as input.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25913\n\n",
    "created_at": "2018-07-24T14:39:09Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "title": "Allow input as packed words for Hopf algebra WQSym",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25676",
    "user": "alauve"
}
```
CC:  tscrim nthiery darij zabrocki alauve amypang hmlodecki saliola

Keywords: sagedays@icerm, packed words, IMA coding sprint, CHAs

The Hopf algebra `WordQuasiSymmetricFunctions`, despite it's name, is indexed internally as ordered set partitions. This ticket aims to allow the user to also use packed words as input.

Issue created by migration from https://trac.sagemath.org/ticket/25913





---

archive/issue_comments_362232.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-24T14:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362232",
    "user": "alauve"
}
```

New commits:



---

archive/issue_comments_362233.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-24T22:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362233",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T15:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362234",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362235.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-25T16:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362235",
    "user": "alauve"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_362236.json:
```json
{
    "body": "Updated documentation to reflect the words realization of WQSym. Should be ready for a close inspection.",
    "created_at": "2018-07-25T16:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362236",
    "user": "alauve"
}
```

Updated documentation to reflect the words realization of WQSym. Should be ready for a close inspection.



---

archive/issue_comments_362237.json:
```json
{
    "body": "This does not actually look correct. The global options should not be a specific instance but instead constructed as class-level subclass (as it was before; it results in an instance due to some magic IIRC, but that is an implementation detail).\n\nAlso, as we discussed at lunch today, we do not want to have two different objects for WQSym (over the same base ring).",
    "created_at": "2018-07-26T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362237",
    "user": "tscrim"
}
```

This does not actually look correct. The global options should not be a specific instance but instead constructed as class-level subclass (as it was before; it results in an instance due to some magic IIRC, but that is an implementation detail).

Also, as we discussed at lunch today, we do not want to have two different objects for WQSym (over the same base ring).



---

archive/issue_comments_362238.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-26T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362238",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_362239.json:
```json
{
    "body": "I am not happy with the current (development branch) situation, but also not happy with this branch... worrying about end-user getting unexpected results from misuse of `.monomial`, `.sum_of_terms`, etc.\n\nFor instance, if users see packed words in their output (e.g., `M[1,1,2,1]`) and also are allowed to write `M[1,1,2,1]` as input, they will be inclined to write code like this:\n\n```\nout = M.zero()\nfor w in PackedWords(4):\n    M.sum_of_terms((v,1) for v in w. right_weak_order_greater())\n```\n\nThis may only cause confusion once per user, but I'm sure there are more exotic errors I'm not thinking of.\n\nWhat if we do this?: create a new class called `WQSymKeys` that has exactly one job: handle, without complaint, either packed words or ordered set partitions and converting as appropriate. Might there be a way to do this that would make the previous code-block **and** the next one run error-free?:\n\n```\nout = M.zero()\nfor w in OrderedSetPartitions(4):\n    M.sum_of_terms((v,1) for v in op.finer())\n```\n",
    "created_at": "2018-07-27T01:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362239",
    "user": "alauve"
}
```

I am not happy with the current (development branch) situation, but also not happy with this branch... worrying about end-user getting unexpected results from misuse of `.monomial`, `.sum_of_terms`, etc.

For instance, if users see packed words in their output (e.g., `M[1,1,2,1]`) and also are allowed to write `M[1,1,2,1]` as input, they will be inclined to write code like this:

```
out = M.zero()
for w in PackedWords(4):
    M.sum_of_terms((v,1) for v in w. right_weak_order_greater())
```

This may only cause confusion once per user, but I'm sure there are more exotic errors I'm not thinking of.

What if we do this?: create a new class called `WQSymKeys` that has exactly one job: handle, without complaint, either packed words or ordered set partitions and converting as appropriate. Might there be a way to do this that would make the previous code-block **and** the next one run error-free?:

```
out = M.zero()
for w in OrderedSetPartitions(4):
    M.sum_of_terms((v,1) for v in op.finer())
```




---

archive/issue_comments_362240.json:
```json
{
    "body": "The default is not packed words, so when you change the display options, *you* take responsibility for realizing that *out*put is not *in*put. We are trying to make both as possibilities, but there are ambiguities in the input. We can document that we try, but to avoid ambiguities, you will need to have users explicitly cast their objects as packed words, which we can then handle in `__getitem__`, but you must have read the documentation, where it is clearly spelled out that we are using ordered set partitions as the basis. As we discussed, we can change this, but we have to change everything.\n\nAlso, `sum_of_terms` and the like assumes you are passing in good indices. However, that is a completely separate issue.",
    "created_at": "2018-07-27T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362240",
    "user": "tscrim"
}
```

The default is not packed words, so when you change the display options, *you* take responsibility for realizing that *out*put is not *in*put. We are trying to make both as possibilities, but there are ambiguities in the input. We can document that we try, but to avoid ambiguities, you will need to have users explicitly cast their objects as packed words, which we can then handle in `__getitem__`, but you must have read the documentation, where it is clearly spelled out that we are using ordered set partitions as the basis. As we discussed, we can change this, but we have to change everything.

Also, `sum_of_terms` and the like assumes you are passing in good indices. However, that is a completely separate issue.



---

archive/issue_comments_362241.json:
```json
{
    "body": "Getting back to this ticket finally... \n\nAfter discussion at SageDays`@`ICERM, it seems I should scrap/revert most of the commits on this ticket. \n\nThe new plan (submitted here for your correction or comment, if I have remembered it incorrectly):\n\n* basis keys used internally are ordered set partitions\n* print output as ordered set partitions unless global option is set to words\n* adjust code so that, e.g., in `__getitem__`, \n  - first look for types `(Packed)Word` and `OrderedSetPartition`,\n  - next assume the user is passing a (packed) word (as a list), \n  - and if that makes no sense, then try to view that list as an ordered set partition.\n* be sure the documentation **clearly spells out** the above, and that the best way for user to have no surprises to write `M[w]` or `M[pi]`, where `w` has type (Packed)Word and `pi` has type `OrderedSetPartition`\n\nHere are the ambiguities for the user, so far as I can tell:\n\n* `M[1,2,3]`  -- will output `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`\n* `M[This is the Trac macro *1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,3-macro)` -- will output  `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`\n* `M[This is the Trac macro *[1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#[1,2,3-macro)]` -- will output `M[{1,2,3}]` and surely the user did not mean `M[{1},{2},{3}]`\n* `M[1,1,2]` -- will correctly output `M[{1,2},{3}]`, while at present it would output `M[{1,2}]`",
    "created_at": "2018-09-20T15:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362241",
    "user": "alauve"
}
```

Getting back to this ticket finally... 

After discussion at SageDays`@`ICERM, it seems I should scrap/revert most of the commits on this ticket. 

The new plan (submitted here for your correction or comment, if I have remembered it incorrectly):

* basis keys used internally are ordered set partitions
* print output as ordered set partitions unless global option is set to words
* adjust code so that, e.g., in `__getitem__`, 
  - first look for types `(Packed)Word` and `OrderedSetPartition`,
  - next assume the user is passing a (packed) word (as a list), 
  - and if that makes no sense, then try to view that list as an ordered set partition.
* be sure the documentation **clearly spells out** the above, and that the best way for user to have no surprises to write `M[w]` or `M[pi]`, where `w` has type (Packed)Word and `pi` has type `OrderedSetPartition`

Here are the ambiguities for the user, so far as I can tell:

* `M[1,2,3]`  -- will output `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`
* `M[This is the Trac macro *1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,3-macro)` -- will output  `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`
* `M[This is the Trac macro *[1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#[1,2,3-macro)]` -- will output `M[{1,2,3}]` and surely the user did not mean `M[{1},{2},{3}]`
* `M[1,1,2]` -- will correctly output `M[{1,2},{3}]`, while at present it would output `M[{1,2}]`



---

archive/issue_comments_362242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T21:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362242",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-21T14:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362243",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-24T05:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362244",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362245.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-25T04:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362245",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362246.json:
```json
{
    "body": "I expect this is ready for review (and certainly ready for others to take a closer peek at).",
    "created_at": "2018-09-25T04:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362246",
    "user": "alauve"
}
```

I expect this is ready for review (and certainly ready for others to take a closer peek at).



---

archive/issue_comments_362247.json:
```json
{
    "body": "Thank you for working more on this. Here are my comments.\n\nYou have to handle zeros better:\n\n```\nsage: WZ = WordQuasiSymmetricFunctions(ZZ)\nsage: M = WZ.M()\nsage: M(2)\n2*M[]\nsage: M(0/1)  # This is more common than you might expect\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot convert 0 into an element of Ordered set partitions\n```\n\nvs current:\n\n```\nsage: M(0/1)\n0\n```\n\nCoercion is too strong. Ideally, you should allow conversion of scalars. `CombinatorialFreeModule` dictates that any 0 that is also in the `base_ring()` will convert, but since this is known to be an algebra, we should be better and allow the conversion of any scalar.\n\nI don't like the punt-off of `__getitem__` to `_element_constructor_`. If you fix the above issue, than this will work:\n\n```\nsage: WQ = WordQuasiSymmetricFunctions(QQ)\nsage: M = WQ.M()\nsage: M[0/1]\n```\n\nand result in `0`. I think the assumptions you should make between the two will be different. The `__getitem__` should assume it is an OSP or packed word and let the error propagate up. I would be okay with the reverse `_element_constructor_` calling `__getitem__`.\n\nThese are the same:\n\n```\nsage: [[1,2],]\n[[1, 2]]\nsage: [[1,2]]\n[[1, 2]]\n```\n\nPlease remove the extraneous commas in the ``coproduct()` tests.",
    "created_at": "2018-09-25T22:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362247",
    "user": "tscrim"
}
```

Thank you for working more on this. Here are my comments.

You have to handle zeros better:

```
sage: WZ = WordQuasiSymmetricFunctions(ZZ)
sage: M = WZ.M()
sage: M(2)
2*M[]
sage: M(0/1)  # This is more common than you might expect
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot convert 0 into an element of Ordered set partitions
```

vs current:

```
sage: M(0/1)
0
```

Coercion is too strong. Ideally, you should allow conversion of scalars. `CombinatorialFreeModule` dictates that any 0 that is also in the `base_ring()` will convert, but since this is known to be an algebra, we should be better and allow the conversion of any scalar.

I don't like the punt-off of `__getitem__` to `_element_constructor_`. If you fix the above issue, than this will work:

```
sage: WQ = WordQuasiSymmetricFunctions(QQ)
sage: M = WQ.M()
sage: M[0/1]
```

and result in `0`. I think the assumptions you should make between the two will be different. The `__getitem__` should assume it is an OSP or packed word and let the error propagate up. I would be okay with the reverse `_element_constructor_` calling `__getitem__`.

These are the same:

```
sage: [[1,2],]
[[1, 2]]
sage: [[1,2]]
[[1, 2]]
```

Please remove the extraneous commas in the ``coproduct()` tests.



---

archive/issue_comments_362248.json:
```json
{
    "body": "Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?\n\nActually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?",
    "created_at": "2018-09-26T03:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362248",
    "user": "alauve"
}
```

Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?

Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?



---

archive/issue_comments_362249.json:
```json
{
    "body": "Replying to [comment:15 alauve]:\n> Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?\n\nNo, you are correct. However, `M[foo]` should not return anything that is not a basis element corresponding (under some map) to `foo`.\n\n> Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?\n\nBecause `0/1` is an element of `QQ`, which has no coercion into `ZZ`.\n\nEdit - Forgot to answer your first question.",
    "created_at": "2018-09-26T03:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362249",
    "user": "tscrim"
}
```

Replying to [comment:15 alauve]:
> Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?

No, you are correct. However, `M[foo]` should not return anything that is not a basis element corresponding (under some map) to `foo`.

> Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?

Because `0/1` is an element of `QQ`, which has no coercion into `ZZ`.

Edit - Forgot to answer your first question.



---

archive/issue_comments_362250.json:
```json
{
    "body": "Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\nOr maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n\nI have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.",
    "created_at": "2018-09-26T03:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362250",
    "user": "alauve"
}
```

Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?

I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.



---

archive/issue_comments_362251.json:
```json
{
    "body": "Replying to [comment:18 alauve]:\n> Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\n> Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n\nYes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.\n\n> I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.\n\nI agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.",
    "created_at": "2018-09-26T23:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362251",
    "user": "tscrim"
}
```

Replying to [comment:18 alauve]:
> Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
> Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?

Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.

> I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.

I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.



---

archive/issue_comments_362252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T03:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362252",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T03:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362253",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362254.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-27T03:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362254",
    "user": "alauve"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_362255.json:
```json
{
    "body": "Replying to [comment:19 tscrim]:\n> Replying to [comment:18 alauve]:\n> > Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\n> > Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n> \n> Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.\n> \n> > I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.\n> \n> I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.\n\n\nOkay. I think I misunderstood what you originally wrote... I thought you wanted `M[0/1]` to return `0`. \n\nI should mention that, since `M([[1,3],2]])` worked in the original code (by which I mean `M[{1,3},{2}]` was returned), I was trying to get `M[1,2,1]` to work as well. This was the origin of my messing with `_element_constructor`. But after chatting with others, it seems I shouldn't try to be so accommodating. The basis keys are OSPs, not words. END-OF-STORY.\n\nI removed that custom method, but I could do as you propose and instead let `_element_constructor_` pass off to `__getitem__`. \nOtherwise, I think this patch is ready for review.",
    "created_at": "2018-09-27T03:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362255",
    "user": "alauve"
}
```

Replying to [comment:19 tscrim]:
> Replying to [comment:18 alauve]:
> > Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
> > Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?
> 
> Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.
> 
> > I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.
> 
> I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.


Okay. I think I misunderstood what you originally wrote... I thought you wanted `M[0/1]` to return `0`. 

I should mention that, since `M([[1,3],2]])` worked in the original code (by which I mean `M[{1,3},{2}]` was returned), I was trying to get `M[1,2,1]` to work as well. This was the origin of my messing with `_element_constructor`. But after chatting with others, it seems I shouldn't try to be so accommodating. The basis keys are OSPs, not words. END-OF-STORY.

I removed that custom method, but I could do as you propose and instead let `_element_constructor_` pass off to `__getitem__`. 
Otherwise, I think this patch is ready for review.



---

archive/issue_comments_362256.json:
```json
{
    "body": "\n```\nsage: M = algebras.WQSym(QQ).M()\nsage: M[2/2]\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-2-e174bca538a0> in <module>()\n----> 1 M[Integer(2)/Integer(2)]\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__getitem__ (build/cythonized/sage/structure/parent.c:11402)()\n   1222             except AttributeError:\n   1223                 return self.list()[n]\n-> 1224         return meth(n)\n   1225 \n   1226     #################################################################################\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/combinat/chas/wqsym.pyc in __getitem__(self, p)\n   1967                 return self.monomial(self._indices(p))\n   1968             except TypeError:\n-> 1969                 raise ValueError(\"cannot convert %s into an element of %s\"%(p, self._indices))\n   1970 \n   1971         def is_field(self, proof=True):\n\nValueError: cannot convert 1 into an element of Ordered set partitions\nsage: M.indices().from_finite_word([2/2])\n[{1}]\nsage: M[M.indices().from_finite_word([2/2])]\nM[{1}]\nsage: M[M.indices().from_finite_word([2/2])] == M[1]\nTrue\n```\n\nDon't do `isinstance(x, (int, Integer))`. Use `x in ZZ`. Getting rational numbers instead of true integers is a very easy trap to fall into.\n\nI also think it would be good to document explicitly some of the ambiguities and says what it defaults to treating it as when it is ambiguous.",
    "created_at": "2018-09-27T04:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362256",
    "user": "tscrim"
}
```


```
sage: M = algebras.WQSym(QQ).M()
sage: M[2/2]
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-2-e174bca538a0> in <module>()
----> 1 M[Integer(2)/Integer(2)]

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__getitem__ (build/cythonized/sage/structure/parent.c:11402)()
   1222             except AttributeError:
   1223                 return self.list()[n]
-> 1224         return meth(n)
   1225 
   1226     #################################################################################

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/combinat/chas/wqsym.pyc in __getitem__(self, p)
   1967                 return self.monomial(self._indices(p))
   1968             except TypeError:
-> 1969                 raise ValueError("cannot convert %s into an element of %s"%(p, self._indices))
   1970 
   1971         def is_field(self, proof=True):

ValueError: cannot convert 1 into an element of Ordered set partitions
sage: M.indices().from_finite_word([2/2])
[{1}]
sage: M[M.indices().from_finite_word([2/2])]
M[{1}]
sage: M[M.indices().from_finite_word([2/2])] == M[1]
True
```

Don't do `isinstance(x, (int, Integer))`. Use `x in ZZ`. Getting rational numbers instead of true integers is a very easy trap to fall into.

I also think it would be good to document explicitly some of the ambiguities and says what it defaults to treating it as when it is ambiguous.



---

archive/issue_comments_362257.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-27T04:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362257",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_362258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T18:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362258",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362259.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2018-09-27T21:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362259",
    "user": "tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_362260.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-09-27T21:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362260",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_362261.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-29T11:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25676#issuecomment-362261",
    "user": "vbraun"
}
```

Resolution: fixed
