# Issue 24442: Fix factor() for non-Sage numbers

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-02-07 10:12:06

CC:  vdelecroix vklein

Part of #24677


---

Comment by jdemeyer created at 2018-02-07 10:12:17

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-02-07 10:19:58

I like the approach but I don't like this

```
# Not a Sage Element, convert to Integer
n = ZZ(n)
```

What if the input is a Python `float` or a 1x1 numpy matrix? Would better go through `ZZ.coerce`. That would currently fail for `gmpy2` but would succeed after #23052.


---

Comment by vdelecroix created at 2018-02-07 10:23:40

Even better than `ZZ.coerce` why not using `py_scalar_to_element`? (and making this function aware of `gmpy2`)


---

Comment by vdelecroix created at 2018-02-07 10:27:54

Why special casing `proof` here?

```
+    # Polynomial or other factorable object
+    try:
+        return m(proof=proof, **kwds)
+    except TypeError:
+        # Maybe the factor() method doesn't have a proof option
+        return m(**kwds)
```

We could just pass all options `**kwds` straight and make `proof` one of them when required.


---

Comment by jdemeyer created at 2018-02-07 10:29:13

Replying to [comment:4 vdelecroix]:
> Why special casing `proof` here?

That's what the old code does...


---

Comment by jdemeyer created at 2018-02-07 10:32:34

Replying to [comment:3 vdelecroix]:
> Even better than `ZZ.coerce` why not using `py_scalar_to_element`? (and making this function aware of `gmpy2`)

Maybe that would work.


---

Comment by jdemeyer created at 2018-02-07 10:33:38

And there is a precedent: several functions in `sage.arith.misc` already use `py_scalar_to_element`.


---

Comment by git created at 2018-02-07 10:41:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-02-07 10:46:48

Like it better. Though `factor(1.3r)` would end up with a strange error message (because of the second `m = n.factor` tested on a `RealNumber` this time). Do you think that another try except here is worth it?


---

Comment by jdemeyer created at 2018-02-07 10:55:03

Replying to [comment:9 vdelecroix]:
> `factor(1.3r)` would end up with a strange error message

Did you actually try that?


---

Comment by vdelecroix created at 2018-02-07 10:59:16

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 vdelecroix]:
> > `factor(1.3r)` would end up with a strange error message
> 
> Did you actually try that?

Ho I see, !RDF elements implements a `factor` method. Perhaps this will never happen...


---

Comment by vdelecroix created at 2018-02-08 07:54:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-11 13:04:06

Resolution: fixed
