# Issue 22872: Move richcmp_by_eq_and_lt to structure/richcmp.pyx

archive/issues_022872.json:
```json
{
    "body": "CC:  @fchapoton @dkrenn\n\nThe function `richcmp_by_eq_and_lt` from `src/sage/rings/asymptotic/misc.py` should be moved to `src/sage/structure/richcmp.pyx`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23109\n\n",
    "created_at": "2017-05-31T07:38:08Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Move richcmp_by_eq_and_lt to structure/richcmp.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22872",
    "user": "@jdemeyer"
}
```
CC:  @fchapoton @dkrenn

The function `richcmp_by_eq_and_lt` from `src/sage/rings/asymptotic/misc.py` should be moved to `src/sage/structure/richcmp.pyx`.

Issue created by migration from https://trac.sagemath.org/ticket/23109





---

archive/issue_comments_319847.json:
```json
{
    "body": "Replying to [ticket:23109 jdemeyer]:\n> The function `richcmp_by_eq_and_lt` from `src/sage/rings/asymptotic/misc.py` should be moved to `src/sage/structure/richcmp.pyx`.\n\n+1 :)",
    "created_at": "2017-05-31T07:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319847",
    "user": "@dkrenn"
}
```

Replying to [ticket:23109 jdemeyer]:
> The function `richcmp_by_eq_and_lt` from `src/sage/rings/asymptotic/misc.py` should be moved to `src/sage/structure/richcmp.pyx`.

+1 :)



---

archive/issue_comments_319848.json:
```json
{
    "body": "I think this function should never have been put in `src/sage/rings/asymptotic` in the first place. When you write general functions, they should be put in a general place, not hidden in `src/sage/rings/asymptotic`.",
    "created_at": "2017-05-31T08:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319848",
    "user": "@jdemeyer"
}
```

I think this function should never have been put in `src/sage/rings/asymptotic` in the first place. When you write general functions, they should be put in a general place, not hidden in `src/sage/rings/asymptotic`.



---

archive/issue_comments_319849.json:
```json
{
    "body": "For this reason, most of the contents of `src/sage/rings/asymptotic/misc.py` doesn't belong there. For example, why is `transform_category` not a method of `Category`? Hiding such general functions tends to encourage reinventing the wheel. Maybe people working on a completely different part of Sage need something like `transform_category`. Those people wouldn't know that it exists in `rings/asymptotic`, so they would need to reinvent it. Anyway, I'm not going to deal with that here, only with `richcmp_by_eq_and_lt`.",
    "created_at": "2017-05-31T08:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319849",
    "user": "@jdemeyer"
}
```

For this reason, most of the contents of `src/sage/rings/asymptotic/misc.py` doesn't belong there. For example, why is `transform_category` not a method of `Category`? Hiding such general functions tends to encourage reinventing the wheel. Maybe people working on a completely different part of Sage need something like `transform_category`. Those people wouldn't know that it exists in `rings/asymptotic`, so they would need to reinvent it. Anyway, I'm not going to deal with that here, only with `richcmp_by_eq_and_lt`.



---

archive/issue_comments_319850.json:
```json
{
    "body": "Question: do you assume a total order? I am asking because you currently implement `x <= y` as `x == y` or `x < y`. But you could also implement it as `not x > y`. This way, you only need one method call for every comparison.",
    "created_at": "2017-05-31T08:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319850",
    "user": "@jdemeyer"
}
```

Question: do you assume a total order? I am asking because you currently implement `x <= y` as `x == y` or `x < y`. But you could also implement it as `not x > y`. This way, you only need one method call for every comparison.



---

archive/issue_comments_319851.json:
```json
{
    "body": "Answering my own question... the example shows that the order is *partial*.",
    "created_at": "2017-05-31T09:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319851",
    "user": "@jdemeyer"
}
```

Answering my own question... the example shows that the order is *partial*.



---

archive/issue_comments_319852.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n\n```\n            if equal_types:\n                other_eq = getattr(other, eq_attr)\n            if other_eq(self):\n                return rich_to_bool(op, 0)\n```\n\nWhat is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?\n----\nNew commits:",
    "created_at": "2017-05-31T10:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319852",
    "user": "@dkrenn"
}
```

Replying to [comment:8 jdemeyer]:

```
            if equal_types:
                other_eq = getattr(other, eq_attr)
            if other_eq(self):
                return rich_to_bool(op, 0)
```

What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?
----
New commits:



---

archive/issue_comments_319853.json:
```json
{
    "body": "Replying to [comment:9 dkrenn]:\n> What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?\n\nIt's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.",
    "created_at": "2017-05-31T10:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319853",
    "user": "@jdemeyer"
}
```

Replying to [comment:9 dkrenn]:
> What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?

It's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.



---

archive/issue_comments_319854.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Replying to [comment:9 dkrenn]:\n> > What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?\n> \n> It's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.\n\nOk.",
    "created_at": "2017-05-31T10:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319854",
    "user": "@dkrenn"
}
```

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 dkrenn]:
> > What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?
> 
> It's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.

Ok.



---

archive/issue_comments_319855.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-31T11:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319855",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_319856.json:
```json
{
    "body": "1. I think the outer parentheses are not needed in\n\n```\n+        cdef bint equal_types = (type(self) is type(other))\n```\n\n\n2. Is there a reason for using `op_LT` and `Py_LT`?\n\n3. Docstring:\n\n```\n+    - ``other`` -- arbitrary object. If it does have ``eq_attr`` and\n+      ``lt_attr`` methods, those are used for the comparison. Otherwise,\n+      the comparison is undefined.\n```\n\n`those` vs. `these`. I am not native English speaking, but shoudn't it be the latter?\n\nApart from these comments; the code looks fine. Let's see what the patchbot says.",
    "created_at": "2017-05-31T16:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319856",
    "user": "@dkrenn"
}
```

1. I think the outer parentheses are not needed in

```
+        cdef bint equal_types = (type(self) is type(other))
```


2. Is there a reason for using `op_LT` and `Py_LT`?

3. Docstring:

```
+    - ``other`` -- arbitrary object. If it does have ``eq_attr`` and
+      ``lt_attr`` methods, those are used for the comparison. Otherwise,
+      the comparison is undefined.
```

`those` vs. `these`. I am not native English speaking, but shoudn't it be the latter?

Apart from these comments; the code looks fine. Let's see what the patchbot says.



---

archive/issue_comments_319857.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Replying to [comment:9 dkrenn]:\n> > What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?\n> \n> It's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.\n\nI somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...",
    "created_at": "2017-05-31T16:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319857",
    "user": "@dkrenn"
}
```

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 dkrenn]:
> > What is the reason for using `eq_attr` of `other` and never the `eq_attr` attribute of `self`?
> 
> It's only for efficiency. If we already know `other_eq`, it's more efficient to use it instead. Python's implementation of rich comparisons assumes that `a == b` is the same as `b == a`, so it shouldn't hurt.

I somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...



---

archive/issue_comments_319858.json:
```json
{
    "body": "Replying to [comment:13 dkrenn]:\n> 1. I think the outer parentheses are not needed in\n> {{{\n> +        cdef bint equal_types = (type(self) is type(other))\n> }}}\n\nThey are certainly not needed. It's just a style issue: when assigning the result of a comparison-like operator, I find it clearer with the parentheses.",
    "created_at": "2017-05-31T17:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319858",
    "user": "@jdemeyer"
}
```

Replying to [comment:13 dkrenn]:
> 1. I think the outer parentheses are not needed in
> {{{
> +        cdef bint equal_types = (type(self) is type(other))
> }}}

They are certainly not needed. It's just a style issue: when assigning the result of a comparison-like operator, I find it clearer with the parentheses.



---

archive/issue_comments_319859.json:
```json
{
    "body": "Replying to [comment:14 dkrenn]:\n> I somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...\n\nIt might be strange but it's not wrong. From [PEP 207](https://www.python.org/dev/peps/pep-0207/):\n\n```\n    4 The reflexivity rules *are* assumed by Python.  Thus, the\n      interpreter may swap y>x with x<y, y>=x with x<=y, and may swap\n      the arguments of x==y and x!=y.\n```\n",
    "created_at": "2017-05-31T17:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319859",
    "user": "@jdemeyer"
}
```

Replying to [comment:14 dkrenn]:
> I somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...

It might be strange but it's not wrong. From [PEP 207](https://www.python.org/dev/peps/pep-0207/):

```
    4 The reflexivity rules *are* assumed by Python.  Thus, the
      interpreter may swap y>x with x<y, y>=x with x<=y, and may swap
      the arguments of x==y and x!=y.
```




---

archive/issue_comments_319860.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-31T20:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319860",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319861.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Replying to [comment:13 dkrenn]:\n> > 1. I think the outer parentheses are not needed in\n> > {{{\n> > +        cdef bint equal_types = (type(self) is type(other))\n> > }}}\n> \n> They are certainly not needed. It's just a style issue: when assigning the result of a comparison-like operator, I find it clearer with the parentheses.\n\nOk, clearer is always better ;)",
    "created_at": "2017-06-01T09:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319861",
    "user": "@dkrenn"
}
```

Replying to [comment:15 jdemeyer]:
> Replying to [comment:13 dkrenn]:
> > 1. I think the outer parentheses are not needed in
> > {{{
> > +        cdef bint equal_types = (type(self) is type(other))
> > }}}
> 
> They are certainly not needed. It's just a style issue: when assigning the result of a comparison-like operator, I find it clearer with the parentheses.

Ok, clearer is always better ;)



---

archive/issue_comments_319862.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Replying to [comment:14 dkrenn]:\n> > I somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...\n> \n> It might be strange but it's not wrong. From [PEP 207](https://www.python.org/dev/peps/pep-0207/):\n> {{{\n>     4 The reflexivity rules *are* assumed by Python.  Thus, the\n>       interpreter may swap y>x with x<y, y>=x with x<=y, and may swap\n>       the arguments of x==y and x!=y.\n> }}}\n\nOk, so let's keep it.",
    "created_at": "2017-06-01T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319862",
    "user": "@dkrenn"
}
```

Replying to [comment:16 jdemeyer]:
> Replying to [comment:14 dkrenn]:
> > I somehow find it strange that the comparision `a == b` is performed by `b` and not `a`...
> 
> It might be strange but it's not wrong. From [PEP 207](https://www.python.org/dev/peps/pep-0207/):
> {{{
>     4 The reflexivity rules *are* assumed by Python.  Thus, the
>       interpreter may swap y>x with x<y, y>=x with x<=y, and may swap
>       the arguments of x==y and x!=y.
> }}}

Ok, so let's keep it.



---

archive/issue_comments_319863.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-01T09:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319863",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319864.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-01T09:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319864",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319865.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-18T09:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319865",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_319866.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-20T15:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319866",
    "user": "@dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319867.json:
```json
{
    "body": "Patchbot found failing tests in richcmp.pyx",
    "created_at": "2017-06-20T15:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319867",
    "user": "@dkrenn"
}
```

Patchbot found failing tests in richcmp.pyx



---

archive/issue_comments_319868.json:
```json
{
    "body": "Right, this got broken by the recent changes in #23102.",
    "created_at": "2017-06-20T20:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319868",
    "user": "@jdemeyer"
}
```

Right, this got broken by the recent changes in #23102.



---

archive/issue_comments_319869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-21T12:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319870.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-21T12:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319870",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319871.json:
```json
{
    "body": "Replying to [comment:25 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[aa85807](https://git.sagemath.org/sage.git/commit/?id=aa858075bb8dadd839ae5c744b8e81fb82e7f1c3)||`Fix richcmp_by_eq_and_lt example`||\n\nThank you for fixing this; LGTM. As soon as the patchbot confirms, this is a positive review from my side.",
    "created_at": "2017-06-21T12:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319871",
    "user": "@dkrenn"
}
```

Replying to [comment:25 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[aa85807](https://git.sagemath.org/sage.git/commit/?id=aa858075bb8dadd839ae5c744b8e81fb82e7f1c3)||`Fix richcmp_by_eq_and_lt example`||

Thank you for fixing this; LGTM. As soon as the patchbot confirms, this is a positive review from my side.



---

archive/issue_comments_319872.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-21T12:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319872",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_319873.json:
```json
{
    "body": "The previous patchbot report only showed failures in `richcmp.pyx`. I fixed those doctests and did not change any code, so it should be fine. Thanks for the review!",
    "created_at": "2017-06-21T12:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319873",
    "user": "@jdemeyer"
}
```

The previous patchbot report only showed failures in `richcmp.pyx`. I fixed those doctests and did not change any code, so it should be fine. Thanks for the review!



---

archive/issue_comments_319874.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-22T07:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22872#issuecomment-319874",
    "user": "@vbraun"
}
```

Resolution: fixed
