# Issue 23371: ?

Issue created by migration from Trac.

Original creator: nbruin

Original creation time: 2017-08-09 23:14:30




---

Comment by nbruin created at 2017-08-09 23:28:50

Changing type from PLEASE CHANGE to enhancement.


---

Comment by nbruin created at 2017-08-09 23:28:50

Changing component from PLEASE CHANGE to geometry.


---

Comment by nbruin created at 2017-08-09 23:28:50

New commits:


---

Comment by nbruin created at 2017-08-09 23:28:50

Changing status from new to needs_review.


---

Comment by sijsling created at 2017-08-16 19:24:22

Some loose comments, not all of them equally important:

The affine `riemann_surface` method gives the errors

```
ArithmeticError: factorization of 0 is not defined
```

and

```
ZeroDivisionError: integer division or modulo by zero
```

when applying them to curves defined by linear polynomials. The projective version has the same problem, and does worse when we consider the surface defined by `z`, in which case it gives a segmentation fault. This is probably because in that case the algorithm is already theoretically incorrect; the requested affine patch is empty.

I do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.

In the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`. Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?

The method integer_matrix_relations does not always return a result, even at high precision. This can be seen by running

```
from sage.schemes.riemann_surfaces.riemann_surface import integer_matrix_relations
CC = ComplexField(300)
M1 = Matrix(CC, [[123 + 0.1*CC.random_element(),3 + 0.1*CC.random_element()],[-7 + 0.1*CC.random_element(),6 + 0.1*CC.random_element()]])
M2 = (1 + M1*2)^(-1) * (3 + M1*4)
integer_matrix_relations(M1, M2)
```


In the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running

```
CC = ComplexField(300)
M1 = Matrix(CC, [[10*CC.random_element(),10*CC.random_element()],[10*CC.random_element(),10*CC.random_element()]])
B = Matrix([[5,6],[7,8]])
M2 = (1 + M1*B)^(-1) * (3 + M1*4)
integer_matrix_relations(M1, M2)
```



---

Comment by sijsling created at 2017-08-16 19:24:22

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-08-16 22:28:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2017-08-16 22:34:18

Changing status from needs_work to needs_review.


---

Comment by nbruin created at 2017-08-16 22:34:18

Replying to [comment:3 sijsling]:
> Some loose comments, not all of them equally important:

Thanks!

> The affine `riemann_surface` method gives the errors

Indeed. Added check that polynomial is at least degree 2.

(note that not absolutely irreducible curves are not handled appropriately by singular at the moment. This is something to be fixed more generally)

> I do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.

Removed (if prec=53, it would make sense to use CDF and RDF, which are faster. However, it makes doctesting a real pain, so I disabled (and removed) it)

> In the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`.

Hopefully better now

> Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?

Actually, it does the latter. Documentation amended.

> The method integer_matrix_relations does not always return a result, even at high precision.

Indeed, our default scaling should take coefficient size as well as precision into account.

> In the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running

Amended (in the stated equation)


---

Comment by sijsling created at 2017-08-17 09:58:26

This looks great, thanks for the quick reply! One final thing: the documentation of homomorphism_basis also needs to do a single switch of B and C, since a similar thing is going on there as in integer_matrix_relations. Doing the same change there will make things true. I was worried for a minute that T would not give rise to a sublattice (up to a change of basis) because of this issue, but it does and the issue is purely one of documentation  :-)


---

Comment by sijsling created at 2017-08-17 09:58:26

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-08-17 17:32:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2017-08-17 17:34:05

Changing status from needs_work to needs_review.


---

Comment by nbruin created at 2017-08-17 17:34:05

OK! correction made.

I've taken the liberty of filling in the "reviewer" with your name.


---

Comment by sijsling created at 2017-08-18 07:39:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-08-21 19:24:04

Resolution: fixed
