# Issue 27093: Try to use as many system packages as possible

Issue created by migration from https://trac.sagemath.org/ticket/27330

Original creator: embray

Original creation time: 2019-02-20 18:27:31

CC:  tmonteil mjo @timokau fbissey isuruf mmezzarobba thansen @tobiasdiez

Keywords: spkg-configure

#24919 implemented a mechanism for checking for checking for sagelib's direct and indirect dependencies at the time of running the main `./configure` script.  This was already done in an ad-hoc manner for a handful of packages (e.g. gcc, git, yasm, curl), but we wanted to be able to do the same for other packages, especially those that are common on Linux-like systems.

This has now been implemented for many other packages, or is in the process of being implemented.  Those packages are listed below.  However, there are many others yet to be done, and this ticket will attempt to list them in some rough order of priority.  Unfortunately there is still not good documentation for how to implement these configure-time dependency checks.  The documentation question is tracked at #26668.

### Already Done

The following packages already have `spkg-configure.m4` checks that are working on most or all supported platforms:

* bzip2 (#27182)
* curl (#24919)
* gcc (#24919)
* gfortran (#24919)
* git (#24919)
* libffi (#25900, #27114)
* patch (#24919)
* xz (#26286)
* yasm (#24919)
* zeromq (#26286)
* zlib (#26286)


### In Progress

The following packages have in-progress tickets to provide configure-time detection on the system:

* gf2x (#27238)
* gmp (#27212)
* mpir (#27212)


### Not Started

#### Have Tickets

The following packages have tickets for their conversions, but don't have working prototypes (i.e. branches) yet, although Dima has listed some sample config scripts for some of them:

* arb (#27270)
* ecm (#27271)
* flint (#27264)
* freetype (#27168)
* libpng (#27186)
* mpc (#27259)
* mpfr (#27258)
* ncurses (#27277)
* ntl (#27265)
* pcre (#27284)
* readline (#27277)

#### Don't Have Tickets

These packages are direct build dependencies of sagelib, and should thus take priority (since if these can be found on the system then one can presume that so too can their dependencies).  I have listed these roughly in order of the number of other _dependent_ SPKGs these have.  Packages with more dependents should generally take higher priority as well:

* python2/python3: this one is of course a very special case; while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-pacakges, including sagelib itself unless the system _happens_ to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
 * cysignals
 * cython
 * ipython
 * jinja2
 * jupyter_core
 * numpy
 * pip
 * setuptools
 * six
* BLAS (openblas / atlas / etc): resolving how to handle finding a usable BLAS should be one of the highest priorities; it faces many of the same issues we faced with MPIR/GMP in #27212, but perhaps with even more complexity)
* pari + cypari (these two are deeply intwined)
* singular
* gsl
* m4ri + m4rie
* glpk
* gap (using the system GAP is obviously desirable, but non-trivial, esp. now that we need a working libgap)
* zn_poly
* pkgconfig
* givaro
* ecl
* iml
* symmetrica
* rw
* ppl
* planarity
* lrcalc
* linbox
* libhomfly
* libbraiding
* lcalc
* ecm
* eclib
* brial

Other high priority packages:

* r (getting R from the system has been desirable for a long time and will require more than just an `spkg-configure.m4`; see #25503)
* iconv (common system package)
* boost_cropped / boost (many systems should already have boost headers available)
* maxima


---

Comment by embray created at 2019-02-20 18:28:13

Note: The list of packages in the description is not yet exhaustive; please add others that are missing as you see fit and/or reprioritize.  This is just a rough sketch.


---

Comment by embray created at 2019-02-21 13:33:47

#27271 is the ticket for ecm.


---

Comment by dimpase created at 2019-02-27 11:25:18

There is also #27373, which concerns packages that change build/run environment, e.g. mpir/gmp/mpfr, that should be resolved in some way.


---

Comment by embray created at 2019-03-25 10:44:36

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.


---

Comment by embray created at 2019-12-23 11:36:05

Nice to see so much progress on this. I'm sorry I haven't had more time to help, but I'm glad to see that the infrastructure I put in place has continued to be useful as support for more packages is added.


---

Comment by mkoeppe created at 2020-01-16 22:00:18

Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?

Something autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?

Related: #28745 (`environment.yml` for conda).


---

Comment by dimpase created at 2020-01-16 22:45:50

Replying to [comment:78 mkoeppe]:
> Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?
> 
> Something autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?

A good idea, I only don't know how exactly to implement this. E.g. on Debian one could
create a package with all dependencies (in fact, basically almost the same as their Sage package)



> 
> Related: #28745 (`environment.yml` for conda).


---

Comment by mkoeppe created at 2020-01-16 23:15:16

I would just have thought to generate a shell script with one line of `apt-get install`.


---

Comment by @thierry-FreeBSD created at 2020-03-31 09:28:22

rw is listed (#27814), but since it depends on igraph, it would be fine to add igraph too.


---

Comment by mkoeppe created at 2020-04-12 21:23:14

spkg-configure friends, I have drafted an update on the support for using system packages for the 9.1 release notes at https://wiki.sagemath.org/ReleaseTours/sage-9.1; let me know if anything needs changing or just make edits.


---

Comment by mkoeppe created at 2020-04-18 07:04:41

Should "BLAS" be moved to "done"?


---

Comment by dimpase created at 2020-04-18 11:07:27

There should be a way to use other blas implementations from the system, not only openblas


---

Comment by @thierry-FreeBSD created at 2020-04-21 16:55:04

Adding a reference for giac and pynac.


---

Comment by @thierry-FreeBSD created at 2020-05-01 17:54:06

Adding tickets for libhomfly and linbox.


---

Comment by @thierry-FreeBSD created at 2020-05-04 09:56:34

Adding #29644 for GAP.


---

Comment by @thierry-FreeBSD created at 2020-05-04 20:54:50

Adding #29649 for zn_poly.


---

Comment by @thierry-FreeBSD created at 2020-05-08 14:52:26

Adding cvxopt.


---

Comment by mkoeppe created at 2020-11-22 19:36:21

Changing keywords from "spkg-configure" to "spkg-configure, sd111".


---

Comment by mkoeppe created at 2021-03-27 02:13:38

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by dimpase created at 2021-07-19 14:25:34

Changing component from build to build: configure.
