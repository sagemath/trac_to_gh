# Issue 27093: Try to use as many system packages as possible

archive/issues_027093.json:
```json
{
    "body": "CC:  tmonteil mjo @timokau fbissey isuruf mmezzarobba thansen @tobiasdiez\n\nKeywords: spkg-configure\n\n#24919 implemented a mechanism for checking for checking for sagelib's direct and indirect dependencies at the time of running the main `./configure` script.  This was already done in an ad-hoc manner for a handful of packages (e.g. gcc, git, yasm, curl), but we wanted to be able to do the same for other packages, especially those that are common on Linux-like systems.\n\nThis has now been implemented for many other packages, or is in the process of being implemented.  Those packages are listed below.  However, there are many others yet to be done, and this ticket will attempt to list them in some rough order of priority.  Unfortunately there is still not good documentation for how to implement these configure-time dependency checks.  The documentation question is tracked at #26668.\n\n### Already Done\n\nThe following packages already have `spkg-configure.m4` checks that are working on most or all supported platforms:\n\n* bzip2 (#27182)\n* curl (#24919)\n* gcc (#24919)\n* gfortran (#24919)\n* git (#24919)\n* libffi (#25900, #27114)\n* patch (#24919)\n* xz (#26286)\n* yasm (#24919)\n* zeromq (#26286)\n* zlib (#26286)\n\n\n### In Progress\n\nThe following packages have in-progress tickets to provide configure-time detection on the system:\n\n* gf2x (#27238)\n* gmp (#27212)\n* mpir (#27212)\n\n\n### Not Started\n\n#### Have Tickets\n\nThe following packages have tickets for their conversions, but don't have working prototypes (i.e. branches) yet, although Dima has listed some sample config scripts for some of them:\n\n* arb (#27270)\n* ecm (#27271)\n* flint (#27264)\n* freetype (#27168)\n* libpng (#27186)\n* mpc (#27259)\n* mpfr (#27258)\n* ncurses (#27277)\n* ntl (#27265)\n* pcre (#27284)\n* readline (#27277)\n\n#### Don't Have Tickets\n\nThese packages are direct build dependencies of sagelib, and should thus take priority (since if these can be found on the system then one can presume that so too can their dependencies).  I have listed these roughly in order of the number of other *dependent* SPKGs these have.  Packages with more dependents should generally take higher priority as well:\n\n* python2/python3: this one is of course a very special case; while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-pacakges, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:\n  * cysignals\n  * cython\n  * ipython\n  * jinja2\n  * jupyter_core\n  * numpy\n  * pip\n  * setuptools\n  * six\n* BLAS (openblas / atlas / etc): resolving how to handle finding a usable BLAS should be one of the highest priorities; it faces many of the same issues we faced with MPIR/GMP in #27212, but perhaps with even more complexity)\n* pari + cypari (these two are deeply intwined)\n* singular\n* gsl\n* m4ri + m4rie\n* glpk\n* gap (using the system GAP is obviously desirable, but non-trivial, esp. now that we need a working libgap)\n* zn_poly\n* pkgconfig\n* givaro\n* ecl\n* iml\n* symmetrica\n* rw\n* ppl\n* planarity\n* lrcalc\n* linbox\n* libhomfly\n* libbraiding\n* lcalc\n* ecm\n* eclib\n* brial\n\nOther high priority packages:\n\n* r (getting R from the system has been desirable for a long time and will require more than just an `spkg-configure.m4`; see #25503)\n* iconv (common system package)\n* boost_cropped / boost (many systems should already have boost headers available)\n* maxima\n\nIssue created by migration from https://trac.sagemath.org/ticket/27330\n\n",
    "created_at": "2019-02-20T18:27:31Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "title": "Try to use as many system packages as possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27093",
    "user": "embray"
}
```
CC:  tmonteil mjo @timokau fbissey isuruf mmezzarobba thansen @tobiasdiez

Keywords: spkg-configure

#24919 implemented a mechanism for checking for checking for sagelib's direct and indirect dependencies at the time of running the main `./configure` script.  This was already done in an ad-hoc manner for a handful of packages (e.g. gcc, git, yasm, curl), but we wanted to be able to do the same for other packages, especially those that are common on Linux-like systems.

This has now been implemented for many other packages, or is in the process of being implemented.  Those packages are listed below.  However, there are many others yet to be done, and this ticket will attempt to list them in some rough order of priority.  Unfortunately there is still not good documentation for how to implement these configure-time dependency checks.  The documentation question is tracked at #26668.

### Already Done

The following packages already have `spkg-configure.m4` checks that are working on most or all supported platforms:

* bzip2 (#27182)
* curl (#24919)
* gcc (#24919)
* gfortran (#24919)
* git (#24919)
* libffi (#25900, #27114)
* patch (#24919)
* xz (#26286)
* yasm (#24919)
* zeromq (#26286)
* zlib (#26286)


### In Progress

The following packages have in-progress tickets to provide configure-time detection on the system:

* gf2x (#27238)
* gmp (#27212)
* mpir (#27212)


### Not Started

#### Have Tickets

The following packages have tickets for their conversions, but don't have working prototypes (i.e. branches) yet, although Dima has listed some sample config scripts for some of them:

* arb (#27270)
* ecm (#27271)
* flint (#27264)
* freetype (#27168)
* libpng (#27186)
* mpc (#27259)
* mpfr (#27258)
* ncurses (#27277)
* ntl (#27265)
* pcre (#27284)
* readline (#27277)

#### Don't Have Tickets

These packages are direct build dependencies of sagelib, and should thus take priority (since if these can be found on the system then one can presume that so too can their dependencies).  I have listed these roughly in order of the number of other *dependent* SPKGs these have.  Packages with more dependents should generally take higher priority as well:

* python2/python3: this one is of course a very special case; while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-pacakges, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
  * cysignals
  * cython
  * ipython
  * jinja2
  * jupyter_core
  * numpy
  * pip
  * setuptools
  * six
* BLAS (openblas / atlas / etc): resolving how to handle finding a usable BLAS should be one of the highest priorities; it faces many of the same issues we faced with MPIR/GMP in #27212, but perhaps with even more complexity)
* pari + cypari (these two are deeply intwined)
* singular
* gsl
* m4ri + m4rie
* glpk
* gap (using the system GAP is obviously desirable, but non-trivial, esp. now that we need a working libgap)
* zn_poly
* pkgconfig
* givaro
* ecl
* iml
* symmetrica
* rw
* ppl
* planarity
* lrcalc
* linbox
* libhomfly
* libbraiding
* lcalc
* ecm
* eclib
* brial

Other high priority packages:

* r (getting R from the system has been desirable for a long time and will require more than just an `spkg-configure.m4`; see #25503)
* iconv (common system package)
* boost_cropped / boost (many systems should already have boost headers available)
* maxima

Issue created by migration from https://trac.sagemath.org/ticket/27330





---

archive/issue_comments_381599.json:
```json
{
    "body": "Note: The list of packages in the description is not yet exhaustive; please add others that are missing as you see fit and/or reprioritize.  This is just a rough sketch.",
    "created_at": "2019-02-20T18:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381599",
    "user": "embray"
}
```

Note: The list of packages in the description is not yet exhaustive; please add others that are missing as you see fit and/or reprioritize.  This is just a rough sketch.



---

archive/issue_comments_381600.json:
```json
{
    "body": "#27271 is the ticket for ecm.",
    "created_at": "2019-02-21T13:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381600",
    "user": "embray"
}
```

#27271 is the ticket for ecm.



---

archive/issue_comments_381601.json:
```json
{
    "body": "There is also #27373, which concerns packages that change build/run environment, e.g. mpir/gmp/mpfr, that should be resolved in some way.",
    "created_at": "2019-02-27T11:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381601",
    "user": "dimpase"
}
```

There is also #27373, which concerns packages that change build/run environment, e.g. mpir/gmp/mpfr, that should be resolved in some way.



---

archive/issue_comments_381602.json:
```json
{
    "body": "Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381602",
    "user": "embray"
}
```

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.



---

archive/issue_comments_381603.json:
```json
{
    "body": "Nice to see so much progress on this. I'm sorry I haven't had more time to help, but I'm glad to see that the infrastructure I put in place has continued to be useful as support for more packages is added.",
    "created_at": "2019-12-23T11:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381603",
    "user": "embray"
}
```

Nice to see so much progress on this. I'm sorry I haven't had more time to help, but I'm glad to see that the infrastructure I put in place has continued to be useful as support for more packages is added.



---

archive/issue_comments_381604.json:
```json
{
    "body": "Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?\n\nSomething autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?\n\nRelated: #28745 (`environment.yml` for conda).",
    "created_at": "2020-01-16T22:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381604",
    "user": "mkoeppe"
}
```

Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?

Something autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?

Related: #28745 (`environment.yml` for conda).



---

archive/issue_comments_381605.json:
```json
{
    "body": "Replying to [comment:78 mkoeppe]:\n> Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?\n> \n> Something autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?\n\nA good idea, I only don't know how exactly to implement this. E.g. on Debian one could\ncreate a package with all dependencies (in fact, basically almost the same as their Sage package)\n\n\n\n> \n> Related: #28745 (`environment.yml` for conda).",
    "created_at": "2020-01-16T22:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381605",
    "user": "dimpase"
}
```

Replying to [comment:78 mkoeppe]:
> Should we find a better way to keep track of the distribution packages that provide what `spkg-configure` is looking for?
> 
> Something autogenerated from new per-package information `build/pkgs/*` that can keep the section in the installation manual current (`src/doc/en/installation/source.rst`) - last updated by Dima?

A good idea, I only don't know how exactly to implement this. E.g. on Debian one could
create a package with all dependencies (in fact, basically almost the same as their Sage package)



> 
> Related: #28745 (`environment.yml` for conda).



---

archive/issue_comments_381606.json:
```json
{
    "body": "I would just have thought to generate a shell script with one line of `apt-get install`.",
    "created_at": "2020-01-16T23:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381606",
    "user": "mkoeppe"
}
```

I would just have thought to generate a shell script with one line of `apt-get install`.



---

archive/issue_comments_381607.json:
```json
{
    "body": "rw is listed (#27814), but since it depends on igraph, it would be fine to add igraph too.",
    "created_at": "2020-03-31T09:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381607",
    "user": "@thierry-FreeBSD"
}
```

rw is listed (#27814), but since it depends on igraph, it would be fine to add igraph too.



---

archive/issue_comments_381608.json:
```json
{
    "body": "spkg-configure friends, I have drafted an update on the support for using system packages for the 9.1 release notes at https://wiki.sagemath.org/ReleaseTours/sage-9.1; let me know if anything needs changing or just make edits.",
    "created_at": "2020-04-12T21:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381608",
    "user": "mkoeppe"
}
```

spkg-configure friends, I have drafted an update on the support for using system packages for the 9.1 release notes at https://wiki.sagemath.org/ReleaseTours/sage-9.1; let me know if anything needs changing or just make edits.



---

archive/issue_comments_381609.json:
```json
{
    "body": "Should \"BLAS\" be moved to \"done\"?",
    "created_at": "2020-04-18T07:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381609",
    "user": "mkoeppe"
}
```

Should "BLAS" be moved to "done"?



---

archive/issue_comments_381610.json:
```json
{
    "body": "There should be a way to use other blas implementations from the system, not only openblas",
    "created_at": "2020-04-18T11:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381610",
    "user": "dimpase"
}
```

There should be a way to use other blas implementations from the system, not only openblas



---

archive/issue_comments_381611.json:
```json
{
    "body": "Adding a reference for giac and pynac.",
    "created_at": "2020-04-21T16:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381611",
    "user": "@thierry-FreeBSD"
}
```

Adding a reference for giac and pynac.



---

archive/issue_comments_381612.json:
```json
{
    "body": "Adding tickets for libhomfly and linbox.",
    "created_at": "2020-05-01T17:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381612",
    "user": "@thierry-FreeBSD"
}
```

Adding tickets for libhomfly and linbox.



---

archive/issue_comments_381613.json:
```json
{
    "body": "Adding #29644 for GAP.",
    "created_at": "2020-05-04T09:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381613",
    "user": "@thierry-FreeBSD"
}
```

Adding #29644 for GAP.



---

archive/issue_comments_381614.json:
```json
{
    "body": "Adding #29649 for zn_poly.",
    "created_at": "2020-05-04T20:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381614",
    "user": "@thierry-FreeBSD"
}
```

Adding #29649 for zn_poly.



---

archive/issue_comments_381615.json:
```json
{
    "body": "Adding cvxopt.",
    "created_at": "2020-05-08T14:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381615",
    "user": "@thierry-FreeBSD"
}
```

Adding cvxopt.



---

archive/issue_comments_381616.json:
```json
{
    "body": "Changing keywords from \"spkg-configure\" to \"spkg-configure, sd111\".",
    "created_at": "2020-11-22T19:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381616",
    "user": "mkoeppe"
}
```

Changing keywords from "spkg-configure" to "spkg-configure, sd111".



---

archive/issue_comments_381617.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-27T02:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381617",
    "user": "mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_381618.json:
```json
{
    "body": "Changing component from build to build: configure.",
    "created_at": "2021-07-19T14:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27093",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27093#issuecomment-381618",
    "user": "dimpase"
}
```

Changing component from build to build: configure.
