# Issue 28142: clean normaliz interface

Issue created by migration from https://trac.sagemath.org/ticket/28379

Original creator: vdelecroix

Original creation time: 2019-08-21 19:26:21

CC:  jipilab mkoeppe

We simplify the normaliz interface. A lot of code is not needed anymore on the last version of PyNormaliz.


---

Comment by vdelecroix created at 2019-08-21 19:26:48

New commits:


---

Comment by vdelecroix created at 2019-08-21 19:26:48

Changing status from new to needs_review.


---

Comment by jipilab created at 2019-08-22 10:37:03

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-08-22 10:37:03

2 of the new doctests are failing.

They are still python integers for some reason?


---

Comment by jipilab created at 2019-08-22 10:43:02

A question:

Removing the following line is ok?


```diff
- PythonModule("PyNormaliz", spkg="pynormaliz").require()
```


Wasn't it the way to should be? Or it would be caught earlier in the call/the creation of the object?


---

Comment by vdelecroix created at 2019-08-22 12:55:10

Replying to [comment:5 jipilab]:
> A question:
> 
> Removing the following line is ok?
> 
> {{{
> #!diff
> - PythonModule("PyNormaliz", spkg="pynormaliz").require()
> }}}
> 
> Wasn't it the way to should be? Or it would be caught earlier in the call/the creation of the object?

It is the way it should be done, but it is not the place it should be done. The function `_nmz_result` has as first argument `normaliz_cone`... which means that it is never called if `PyNormaliz` is not present. Checking for its presence inside the function is very weird.


---

Comment by git created at 2019-08-22 12:57:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-08-22 12:58:01

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-08-26 10:09:43

Replying to [comment:6 vdelecroix]:
> Replying to [comment:5 jipilab]:
> > A question:
> > 
> > Removing the following line is ok?
> > 
> > {{{
> > #!diff
> > - PythonModule("PyNormaliz", spkg="pynormaliz").require()
> > }}}
> > 
> > Wasn't it the way to should be? Or it would be caught earlier in the call/the creation of the object?
> 
> It is the way it should be done, but it is not the place it should be done. 

ok! good to know.

> The function `_nmz_result` has as first argument `normaliz_cone`... which means that it is never called if `PyNormaliz` is not present. Checking for its presence inside the function is very weird.

Yep, I see. I probably forgot that instance when I changed the import...

In the bot, there is one doctest warning in `platonic.py` that gives one doctest failure.


```
sage -t --long src/sage/plot/plot3d/platonic.py
**********************************************************************
File "src/sage/plot/plot3d/platonic.py", line 211, in sage.plot.plot3d.platonic.tetrahedron
Failed example:
    tetrahedron(aspect_ratio=[1,1,1]).scale((4,4,1))
Expected:
    Graphics3d Object
Got:
    doctest:warning
    [snip]
    RichReprWarning: Exception in _rich_repr_ while displaying object: Jmol failed to create file '/local/sage-patchbot/.sage/temp/rk02-math/14911/dir_e02POx/preview.png', see '/local/sage-patchbot/.sage/temp/rk02-math/14911/tmp_XfwJq0.txt' for details
    Graphics3d Object
**********************************************************************
1 item had failures:
   1 of  15 in sage.plot.plot3d.platonic.tetrahedron
    [52 tests, 1 failure, 6.60 s]
```


It does not seem to have anything to do with this ticket though... Hmm.


---

Comment by jipilab created at 2019-08-31 10:05:44

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2019-08-31 10:05:44

The error in `platonic.py` was not present in the last bot test... I would say it is ready to go.


---

Comment by vbraun created at 2019-09-05 21:33:07

Resolution: fixed
