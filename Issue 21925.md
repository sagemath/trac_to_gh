# Issue 21925: Return Unknown from ex.is_xyz() if Pynac returns false

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2017-01-10 06:52:36

CC:  pelegm

Expected:

```
sage: x.is_real()
Unknown
sage: if x.is_real(): True
sage: if not x.is_real(): False
sage: 
```


This ticket branch should change the behaviour of selected `is_xyz()` functions first, in order to see what's involved.


---

Comment by rws created at 2017-01-10 07:47:28

Changing status from new to needs_review.


---

Comment by rws created at 2017-01-10 07:47:28

New commits:


---

Comment by jdemeyer created at 2017-01-10 08:47:16

Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?


---

Comment by git created at 2017-01-10 08:54:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-10 09:52:09

Replying to [comment:5 jdemeyer]:
> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?

That would have to be changed to preserve previous usage. I don't think there is much of that in Sage (except `is_zero` which I don't want to deal with here).


---

Comment by rws created at 2017-01-10 13:56:40

Replying to [comment:5 jdemeyer]:
> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?

Actually, what I meant is that it is fine as it is, as it preserves previous usage.


---

Comment by jdemeyer created at 2017-01-10 14:24:38

Replying to [comment:8 rws]:
> Actually, what I meant is that it is fine as it is, as it preserves previous usage.

If the goal of this ticket is to preserve previous usage, why bother at all? Shouldn't the goal be to _fix_ the bad previous usage instead? That means that `Unknown` should be treated really as an unknown value and not as a small variation on `False`.


---

Comment by git created at 2017-01-10 14:38:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-10 14:41:04

As it was a no-brainer I changed the other `is_xyz()` function except for comparisons with zero, and I consider the ticket complete, apart from bug or doctest fixes.

Please review.


---

Comment by jdemeyer created at 2017-01-10 15:17:55

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2017-01-10 15:18:34

I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?


---

Comment by rws created at 2017-01-10 15:55:15

Well, quoting `unknown.py`, `..warning:: Unless PEP 335 is accepted, in the following cases, and, not and or return a somewhat wrong value::`. PEP 335 was rejected so I'm being pragmatic and accept the (admittedly) small value of serving the users that don't write Sage code.

Also, isn't that an independent issue?


---

Comment by jdemeyer created at 2017-01-10 16:00:59

Replying to [comment:14 rws]:
> Also, isn't that an independent issue?

No, I think it's not an independent issue because it's the motivation of this ticket. Which problem does this ticket solve if you don't fix `Unknown`?


---

Comment by jdemeyer created at 2017-01-10 16:20:54

There is also the purely practical point that it's easier to change the functionality of `Unknown` if it's only used very little.


---

Comment by rws created at 2017-01-10 16:27:44

Replying to [comment:15 jdemeyer]:
> Which problem does this ticket solve if you don't fix `Unknown`?

Semantic inconsistency: `Unknown` is meant but the output is `False`.


---

Comment by jdemeyer created at 2017-01-10 16:50:57

Replying to [comment:17 rws]:
> Semantic inconsistency: `Unknown` is meant but the output is `False`.

With this patch, you get an object 'Unknown' which _behaves_ a lot like `False`. So this doesn't fix much...


---

Comment by rws created at 2017-01-11 14:57:25

Replying to [comment:13 jdemeyer]:
> I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?

Disclaimer: Python is not my specialty.

Either you convert `Unknown` to `bool` (and you provide the means to do it via `__nonzero__`) or you don't (and deny any attempt). The former is this branch at the moment, the latter would force users to explicitly compare with `True/False/Unknown`, disallowing `if is_xyz():` conditionals. It would also disallow `not is_xyz()` and `is_xy() and/or is_yz()`. By disallow I mean an exception is raised. The patch to achieve this would simply be:

```
diff --git a/src/sage/misc/unknown.py b/src/sage/misc/unknown.py
index b05751e..4a6979a 100644
--- a/src/sage/misc/unknown.py
+++ b/src/sage/misc/unknown.py
`@``@` -66,7 +66,7 `@``@` class UnknownClass(UniqueRepresentation, SageObject):
             sage: not Unknown
             True
         """
-        return False
+        raise NotImplementedError('Python does not support tri-valued logic.')
 
     __nonzero__ = __bool__
```

 
`Unknown` is used in a few places. With the patch I get about 100 doctest fails in `combinat`. I have not looked further into this.


---

Comment by rws created at 2017-12-07 15:43:06

Are the conclusions of the above comments changed if we regard Python3 richcmp? Specifically can Py3 richcmp provide an `Unknown` object that is more useful than simply being `False`, e.g., can we change the behaviour of `if is_xyz():` and `not is_xyz()` such that the former compares with `True` and the latter with `False`?


---

Comment by rws created at 2017-12-07 16:17:33

Actually I find that the combinat doctest fails are fixable with a few natural changes, and so an `Unknown` that behaves differently from `False` seems possible.


---

Comment by rws created at 2017-12-08 15:35:35

See #24345.


---

Comment by rws created at 2017-12-12 08:04:10

Changing status from needs_info to needs_review.


---

Comment by rws created at 2017-12-12 08:04:10

New commits:


---

Comment by rws created at 2017-12-12 08:16:23

Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.


---

Comment by vdelecroix created at 2017-12-14 23:18:21

Replying to [comment:25 rws]:
> Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.

What would be the point of having `is_noninteger` if `is_integer` is already doing the job!?


---

Comment by rws created at 2017-12-15 04:16:14

Agree. Exposing the flag to the user is not really necessary.


---

Comment by pelegm created at 2018-04-07 16:45:01

New commits:


---

Comment by vdelecroix created at 2020-02-22 15:30:40

#24345 is merged in 9.1.beta5 but this one needs a rebase


---

Comment by vdelecroix created at 2020-02-22 15:30:40

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
