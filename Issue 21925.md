# Issue 21925: Return Unknown from ex.is_xyz() if Pynac returns false

archive/issues_021925.json:
```json
{
    "body": "CC:  @pelegm\n\nExpected:\n\n```\nsage: x.is_real()\nUnknown\nsage: if x.is_real(): True\nsage: if not x.is_real(): False\nsage: \n```\n\n\nThis ticket branch should change the behaviour of selected `is_xyz()` functions first, in order to see what's involved.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22162\n\n",
    "created_at": "2017-01-10T06:52:36Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Return Unknown from ex.is_xyz() if Pynac returns false",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21925",
    "user": "@rwst"
}
```
CC:  @pelegm

Expected:

```
sage: x.is_real()
Unknown
sage: if x.is_real(): True
sage: if not x.is_real(): False
sage: 
```


This ticket branch should change the behaviour of selected `is_xyz()` functions first, in order to see what's involved.

Issue created by migration from https://trac.sagemath.org/ticket/22162





---

archive/issue_comments_304487.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-10T07:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304487",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_304488.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-10T07:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304488",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_304489.json:
```json
{
    "body": "Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?",
    "created_at": "2017-01-10T08:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304489",
    "user": "@jdemeyer"
}
```

Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?



---

archive/issue_comments_304490.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T08:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304490",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_304491.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?\n\nThat would have to be changed to preserve previous usage. I don't think there is much of that in Sage (except `is_zero` which I don't want to deal with here).",
    "created_at": "2017-01-10T09:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304491",
    "user": "@rwst"
}
```

Replying to [comment:5 jdemeyer]:
> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?

That would have to be changed to preserve previous usage. I don't think there is much of that in Sage (except `is_zero` which I don't want to deal with here).



---

archive/issue_comments_304492.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?\n\nActually, what I meant is that it is fine as it is, as it preserves previous usage.",
    "created_at": "2017-01-10T13:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304492",
    "user": "@rwst"
}
```

Replying to [comment:5 jdemeyer]:
> Regarding `Unknown`, shouldn't we disallow conversion to `bool`? Currently, `bool(Unknown)` is `False` and `not Unknown` is `True`. What do you think about that?

Actually, what I meant is that it is fine as it is, as it preserves previous usage.



---

archive/issue_comments_304493.json:
```json
{
    "body": "Replying to [comment:8 rws]:\n> Actually, what I meant is that it is fine as it is, as it preserves previous usage.\n\nIf the goal of this ticket is to preserve previous usage, why bother at all? Shouldn't the goal be to *fix* the bad previous usage instead? That means that `Unknown` should be treated really as an unknown value and not as a small variation on `False`.",
    "created_at": "2017-01-10T14:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304493",
    "user": "@jdemeyer"
}
```

Replying to [comment:8 rws]:
> Actually, what I meant is that it is fine as it is, as it preserves previous usage.

If the goal of this ticket is to preserve previous usage, why bother at all? Shouldn't the goal be to *fix* the bad previous usage instead? That means that `Unknown` should be treated really as an unknown value and not as a small variation on `False`.



---

archive/issue_comments_304494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T14:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304494",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_304495.json:
```json
{
    "body": "As it was a no-brainer I changed the other `is_xyz()` function except for comparisons with zero, and I consider the ticket complete, apart from bug or doctest fixes.\n\nPlease review.",
    "created_at": "2017-01-10T14:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304495",
    "user": "@rwst"
}
```

As it was a no-brainer I changed the other `is_xyz()` function except for comparisons with zero, and I consider the ticket complete, apart from bug or doctest fixes.

Please review.



---

archive/issue_comments_304496.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-01-10T15:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304496",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_304497.json:
```json
{
    "body": "I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?",
    "created_at": "2017-01-10T15:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304497",
    "user": "@jdemeyer"
}
```

I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?



---

archive/issue_comments_304498.json:
```json
{
    "body": "Well, quoting `unknown.py`, `..warning:: Unless PEP 335 is accepted, in the following cases, and, not and or return a somewhat wrong value::`. PEP 335 was rejected so I'm being pragmatic and accept the (admittedly) small value of serving the users that don't write Sage code.\n\nAlso, isn't that an independent issue?",
    "created_at": "2017-01-10T15:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304498",
    "user": "@rwst"
}
```

Well, quoting `unknown.py`, `..warning:: Unless PEP 335 is accepted, in the following cases, and, not and or return a somewhat wrong value::`. PEP 335 was rejected so I'm being pragmatic and accept the (admittedly) small value of serving the users that don't write Sage code.

Also, isn't that an independent issue?



---

archive/issue_comments_304499.json:
```json
{
    "body": "Replying to [comment:14 rws]:\n> Also, isn't that an independent issue?\n\nNo, I think it's not an independent issue because it's the motivation of this ticket. Which problem does this ticket solve if you don't fix `Unknown`?",
    "created_at": "2017-01-10T16:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304499",
    "user": "@jdemeyer"
}
```

Replying to [comment:14 rws]:
> Also, isn't that an independent issue?

No, I think it's not an independent issue because it's the motivation of this ticket. Which problem does this ticket solve if you don't fix `Unknown`?



---

archive/issue_comments_304500.json:
```json
{
    "body": "There is also the purely practical point that it's easier to change the functionality of `Unknown` if it's only used very little.",
    "created_at": "2017-01-10T16:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304500",
    "user": "@jdemeyer"
}
```

There is also the purely practical point that it's easier to change the functionality of `Unknown` if it's only used very little.



---

archive/issue_comments_304501.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Which problem does this ticket solve if you don't fix `Unknown`?\n\nSemantic inconsistency: `Unknown` is meant but the output is `False`.",
    "created_at": "2017-01-10T16:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304501",
    "user": "@rwst"
}
```

Replying to [comment:15 jdemeyer]:
> Which problem does this ticket solve if you don't fix `Unknown`?

Semantic inconsistency: `Unknown` is meant but the output is `False`.



---

archive/issue_comments_304502.json:
```json
{
    "body": "Replying to [comment:17 rws]:\n> Semantic inconsistency: `Unknown` is meant but the output is `False`.\n\nWith this patch, you get an object 'Unknown' which *behaves* a lot like `False`. So this doesn't fix much...",
    "created_at": "2017-01-10T16:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304502",
    "user": "@jdemeyer"
}
```

Replying to [comment:17 rws]:
> Semantic inconsistency: `Unknown` is meant but the output is `False`.

With this patch, you get an object 'Unknown' which *behaves* a lot like `False`. So this doesn't fix much...



---

archive/issue_comments_304503.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?\n\nDisclaimer: Python is not my specialty.\n\nEither you convert `Unknown` to `bool` (and you provide the means to do it via `__nonzero__`) or you don't (and deny any attempt). The former is this branch at the moment, the latter would force users to explicitly compare with `True/False/Unknown`, disallowing `if is_xyz():` conditionals. It would also disallow `not is_xyz()` and `is_xy() and/or is_yz()`. By disallow I mean an exception is raised. The patch to achieve this would simply be:\n\n```\ndiff --git a/src/sage/misc/unknown.py b/src/sage/misc/unknown.py\nindex b05751e..4a6979a 100644\n--- a/src/sage/misc/unknown.py\n+++ b/src/sage/misc/unknown.py\n@@ -66,7 +66,7 @@ class UnknownClass(UniqueRepresentation, SageObject):\n             sage: not Unknown\n             True\n         \"\"\"\n-        return False\n+        raise NotImplementedError('Python does not support tri-valued logic.')\n \n     __nonzero__ = __bool__\n```\n\n \n`Unknown` is used in a few places. With the patch I get about 100 doctest fails in `combinat`. I have not looked further into this.",
    "created_at": "2017-01-11T14:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304503",
    "user": "@rwst"
}
```

Replying to [comment:13 jdemeyer]:
> I think we should think about [comment:9] before merging this. What good is `Unknown` if it behaves the same as `False` for practical purposes?

Disclaimer: Python is not my specialty.

Either you convert `Unknown` to `bool` (and you provide the means to do it via `__nonzero__`) or you don't (and deny any attempt). The former is this branch at the moment, the latter would force users to explicitly compare with `True/False/Unknown`, disallowing `if is_xyz():` conditionals. It would also disallow `not is_xyz()` and `is_xy() and/or is_yz()`. By disallow I mean an exception is raised. The patch to achieve this would simply be:

```
diff --git a/src/sage/misc/unknown.py b/src/sage/misc/unknown.py
index b05751e..4a6979a 100644
--- a/src/sage/misc/unknown.py
+++ b/src/sage/misc/unknown.py
@@ -66,7 +66,7 @@ class UnknownClass(UniqueRepresentation, SageObject):
             sage: not Unknown
             True
         """
-        return False
+        raise NotImplementedError('Python does not support tri-valued logic.')
 
     __nonzero__ = __bool__
```

 
`Unknown` is used in a few places. With the patch I get about 100 doctest fails in `combinat`. I have not looked further into this.



---

archive/issue_comments_304504.json:
```json
{
    "body": "Are the conclusions of the above comments changed if we regard Python3 richcmp? Specifically can Py3 richcmp provide an `Unknown` object that is more useful than simply being `False`, e.g., can we change the behaviour of `if is_xyz():` and `not is_xyz()` such that the former compares with `True` and the latter with `False`?",
    "created_at": "2017-12-07T15:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304504",
    "user": "@rwst"
}
```

Are the conclusions of the above comments changed if we regard Python3 richcmp? Specifically can Py3 richcmp provide an `Unknown` object that is more useful than simply being `False`, e.g., can we change the behaviour of `if is_xyz():` and `not is_xyz()` such that the former compares with `True` and the latter with `False`?



---

archive/issue_comments_304505.json:
```json
{
    "body": "Actually I find that the combinat doctest fails are fixable with a few natural changes, and so an `Unknown` that behaves differently from `False` seems possible.",
    "created_at": "2017-12-07T16:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304505",
    "user": "@rwst"
}
```

Actually I find that the combinat doctest fails are fixable with a few natural changes, and so an `Unknown` that behaves differently from `False` seems possible.



---

archive/issue_comments_304506.json:
```json
{
    "body": "See #24345.",
    "created_at": "2017-12-08T15:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304506",
    "user": "@rwst"
}
```

See #24345.



---

archive/issue_comments_304507.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-12-12T08:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304507",
    "user": "@rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_304508.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-12T08:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304508",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_304509.json:
```json
{
    "body": "Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.",
    "created_at": "2017-12-12T08:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304509",
    "user": "@rwst"
}
```

Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.



---

archive/issue_comments_304510.json:
```json
{
    "body": "Replying to [comment:25 rws]:\n> Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.\n\nWhat would be the point of having `is_noninteger` if `is_integer` is already doing the job!?",
    "created_at": "2017-12-14T23:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304510",
    "user": "@videlec"
}
```

Replying to [comment:25 rws]:
> Later, when the complementary flags (irreal, noninteger, nonpositive) are implemented in Pynac these function can return `True/Unknown/False`, e.g. `is_integer` will return False if `is_noninteger` returns True, so both behave complementary.

What would be the point of having `is_noninteger` if `is_integer` is already doing the job!?



---

archive/issue_comments_304511.json:
```json
{
    "body": "Agree. Exposing the flag to the user is not really necessary.",
    "created_at": "2017-12-15T04:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304511",
    "user": "@rwst"
}
```

Agree. Exposing the flag to the user is not really necessary.



---

archive/issue_comments_304512.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-07T16:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304512",
    "user": "@pelegm"
}
```

New commits:



---

archive/issue_comments_304513.json:
```json
{
    "body": "#24345 is merged in 9.1.beta5 but this one needs a rebase",
    "created_at": "2020-02-22T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304513",
    "user": "@videlec"
}
```

#24345 is merged in 9.1.beta5 but this one needs a rebase



---

archive/issue_comments_304514.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-22T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304514",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_304515.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304515",
    "user": "@mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_304516.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304516",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_304517.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21925#issuecomment-304517",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
