# Issue 15451: matrix*vector coercion

Issue created by migration from Trac.

Original creator: barbules

Original creation time: 2014-01-16 17:57:35

CC:  nbruin jakobkroeker

In sage 5.8 the multiplication matrix*vector does not give the correct answer when the vector has to be coerced. 

Example:

F=GF(3571)
m=matrix(F,[1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1])
w=vector(QQ,[89843/2, 555841/2, 754633/2, 211553, 152186, 286953, 70867, 109089, 156622, 341523, 319195, 109233, 277852, 232951, 244697, 325034, 295611])
print m*w,m*w.change_ring(F)


---

Comment by nbruin created at 2014-01-16 21:35:23

Changing type from PLEASE CHANGE to defect.


---

Comment by nbruin created at 2014-01-16 21:35:23

Changing component from PLEASE CHANGE to coercion.


---

Comment by nbruin created at 2014-01-16 21:35:23

The problem is this:

```
sage: parent(m*w)
Ambient free module of rank 1 over Ring of integers modulo 1
```

which is just the action that gets discovered by sage: 

```
c=get_coercion_model()
sage: l=c.discover_action(parent(m),parent(w),operator.mul)
sage: l.codomain()
Ambient free module of rank 1 over Ring of integers modulo 1
```

(sage uses the term action rather liberally. I think normally a left action would have right domain equal to its codomain)

The problem is of course that if you want to find a ring to which both QQ and GF(p) have a homomorphism, then the trivial ring is the only option. There is a _conversion_ from QQ to GF(p), which is used by `w.change_ring`, but no _coercion_. It would be nice if we could raise an error in this case rather than return a useless answer.

Note that

```
sage: c.discover_action(GF(3),QQ,operator.mul) == None
True
```

so somewhere the matrix action discovery tries too hard.


---

Comment by jakobkroeker created at 2017-03-03 22:56:32

Now the computation fails. Is that the expected behaviour?


---

Comment by sbrandhorst created at 2017-10-06 07:17:06

The reason is that there is no sensible common parent of QQ to GF(q). Simply because 1/q is not invertible in GF(q). So there is no sensible coercion. Just conversion.

I get. 
TypeError: unsupported operand parent(s) for *: 'Full MatrixSpace of 1 by 17 dense matrices over Finite Field of size 3571' and 'Vector space of dimension 17 over Rational Field'

Certainly, this seems ok. Lets close this.


---

Comment by sbrandhorst created at 2017-10-06 07:17:06

Changing status from new to needs_review.


---

Comment by roed created at 2017-10-25 17:18:31

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-12-12 08:23:33

Resolution: wontfix
