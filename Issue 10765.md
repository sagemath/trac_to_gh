# Issue 10765: Make python support SAGE_SPKG_INSTALL_DOCS

archive/issues_010765.json:
```json
{
    "body": "Assignee: tbd\n\nThis is a bit tricky since we need sphinx and other things installed before we can build the docs, but sphinx and the other things depend on python.  To resolve this circular dependency, we try to import sphinx.  If we can't import sphinx, then we exit without error with a message that you should install sphinx and related tools first and then try building the docs again.  This means that in order to use the environment variable, you have to install the python spkg twice, since we don't have an option to just build docs without building python.  But maybe that's worth it for someone that just wants the python docs.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10831\n\n",
    "created_at": "2011-02-23T02:43:33Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make python support SAGE_SPKG_INSTALL_DOCS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10765",
    "user": "@jasongrout"
}
```
Assignee: tbd

This is a bit tricky since we need sphinx and other things installed before we can build the docs, but sphinx and the other things depend on python.  To resolve this circular dependency, we try to import sphinx.  If we can't import sphinx, then we exit without error with a message that you should install sphinx and related tools first and then try building the docs again.  This means that in order to use the environment variable, you have to install the python spkg twice, since we don't have an option to just build docs without building python.  But maybe that's worth it for someone that just wants the python docs.

Issue created by migration from https://trac.sagemath.org/ticket/10831





---

archive/issue_comments_113876.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-23T03:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113876",
    "user": "@jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113877.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-03-01T15:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113877",
    "user": "drkirkby"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_113878.json:
```json
{
    "body": "See comments on #10828\n\nI wonder if it might be sensible to create a new package called - python-documentation-1.0.spkg in order to resolve this circular dependency problem.\n\nThat new python-documentation-1.0.spkg gets built after both python and sphinx are built. This package then copies the contents of the python package from the python.spkg, extracts it, then builds only the documentation - not all of Python if at all possible. \n\nOtherwise, the build will fail for sure for everyone, which is off-putting to newcomers, even if old hands know how to get around the problem. The ability to type 'make' then go away and leave it will be lost if the build fails on this each time. \n\ndave",
    "created_at": "2011-03-01T15:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113878",
    "user": "drkirkby"
}
```

See comments on #10828

I wonder if it might be sensible to create a new package called - python-documentation-1.0.spkg in order to resolve this circular dependency problem.

That new python-documentation-1.0.spkg gets built after both python and sphinx are built. This package then copies the contents of the python package from the python.spkg, extracts it, then builds only the documentation - not all of Python if at all possible. 

Otherwise, the build will fail for sure for everyone, which is off-putting to newcomers, even if old hands know how to get around the problem. The ability to type 'make' then go away and leave it will be lost if the build fails on this each time. 

dave



---

archive/issue_comments_113879.json:
```json
{
    "body": "I see your note that's its impossible to build just the docs for Python. \n\nAnother option, which would be quicker is to \n* If  `SAGE_SPKG_INSTALL_DOCS=yes`, build and install Python, but tar up the build and stick that in a temporary directory somewhere. \n* After sphinx and whatever else are built, extract that tar file, and just build the documentation. \n\nSomehow I think we should automate this, so Python's documentation gets built without manual intervention. It can't be rocket science to do this. If the worst comes to the worst, just build Python twice if `SAGE_SPKG_INSTALL_DOCS=yes`\n\n\nDave",
    "created_at": "2011-03-01T15:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113879",
    "user": "drkirkby"
}
```

I see your note that's its impossible to build just the docs for Python. 

Another option, which would be quicker is to 
* If  `SAGE_SPKG_INSTALL_DOCS=yes`, build and install Python, but tar up the build and stick that in a temporary directory somewhere. 
* After sphinx and whatever else are built, extract that tar file, and just build the documentation. 

Somehow I think we should automate this, so Python's documentation gets built without manual intervention. It can't be rocket science to do this. If the worst comes to the worst, just build Python twice if `SAGE_SPKG_INSTALL_DOCS=yes`


Dave



---

archive/issue_comments_113880.json:
```json
{
    "body": "Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed.  A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.",
    "created_at": "2011-03-01T16:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113880",
    "user": "@jasongrout"
}
```

Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed.  A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.



---

archive/issue_comments_113881.json:
```json
{
    "body": "Replying to [comment:4 jason]:\n> Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed. \n\nThat's quite easy to do. \n\n> A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.\n\nIdeally though we don't want the user to have to mess with that environment variable. I think this can be automated. \n\nAs long as there's not an issue with hard-coded paths (which may make the documentation useless if Sage is moved), then I think a temporary tar file is the best solution, as it will save a lot of time. Python is a big package to build twice if it is unnecessary. \n\nThis needs a bit of thought, and its late here, so I'm going to bed. \n\nDave",
    "created_at": "2011-03-02T02:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113881",
    "user": "drkirkby"
}
```

Replying to [comment:4 jason]:
> Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed. 

That's quite easy to do. 

> A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.

Ideally though we don't want the user to have to mess with that environment variable. I think this can be automated. 

As long as there's not an issue with hard-coded paths (which may make the documentation useless if Sage is moved), then I think a temporary tar file is the best solution, as it will save a lot of time. Python is a big package to build twice if it is unnecessary. 

This needs a bit of thought, and its late here, so I'm going to bed. 

Dave



---

archive/issue_comments_113882.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2011-03-02T14:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113882",
    "user": "@jasongrout"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_113883.json:
```json
{
    "body": "Replying to [comment:5 drkirkby]:\n> Replying to [comment:4 jason]:\n> > Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed. \n> \n> That's quite easy to do. \n> \n> > A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.\n> \n> Ideally though we don't want the user to have to mess with that environment variable. I think this can be automated. \n\nYep.  I'm thinking that the python-docs target will \n\n   * Check to see if SAGE_SPKG_INSTALL_DOCS=yes, and if so:\n   * set the SAGE_SPKG_PYTHON_BUILD=no variable and then reinstall the python spkg (which will then just build the docs, but not python).\n\nThe user won't ever have to deal with that environment variable---it's all behind the scenes.",
    "created_at": "2011-03-02T14:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113883",
    "user": "@jasongrout"
}
```

Replying to [comment:5 drkirkby]:
> Replying to [comment:4 jason]:
> > Yes, I suppose worst-case is just adding a python-docs target to the deps file that builds python again after sphinx is installed. 
> 
> That's quite easy to do. 
> 
> > A slightly better case is adding a python-docs target that defines an environment variable SAGE_PYTHON_BUILD=no or something and then re-installs the python spkg.  Then modify the python spkg to check for that variable and not actually build python if that variable is no.
> 
> Ideally though we don't want the user to have to mess with that environment variable. I think this can be automated. 

Yep.  I'm thinking that the python-docs target will 

   * Check to see if SAGE_SPKG_INSTALL_DOCS=yes, and if so:
   * set the SAGE_SPKG_PYTHON_BUILD=no variable and then reinstall the python spkg (which will then just build the docs, but not python).

The user won't ever have to deal with that environment variable---it's all behind the scenes.



---

archive/issue_comments_113884.json:
```json
{
    "body": "(note that the makefile wouldn't export SAGE_SPKG_PYTHON_BUILD, but would do the equivalent of ``SAGE_SPKG_PYTHON_BUILD=no sage -i python``",
    "created_at": "2011-03-02T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113884",
    "user": "@jasongrout"
}
```

(note that the makefile wouldn't export SAGE_SPKG_PYTHON_BUILD, but would do the equivalent of ``SAGE_SPKG_PYTHON_BUILD=no sage -i python``



---

archive/issue_comments_113885.json:
```json
{
    "body": "I'm a little lost in the deps file.  I've attached a patch which I think does what we want (add a new target that reinstalls the python spkg, but with a local variable set so that python isn't actually rebuilt).  Comments, David?",
    "created_at": "2011-03-03T18:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113885",
    "user": "@jasongrout"
}
```

I'm a little lost in the deps file.  I've attached a patch which I think does what we want (add a new target that reinstalls the python spkg, but with a local variable set so that python isn't actually rebuilt).  Comments, David?



---

archive/issue_comments_113886.json:
```json
{
    "body": "Attachment [10831-deps.patch](tarball://root/attachments/some-uuid/ticket10831/10831-deps.patch) by @jasongrout created at 2011-03-03 18:27:58\n\nApply to deps (probably needs to be redone after #9433)",
    "created_at": "2011-03-03T18:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113886",
    "user": "@jasongrout"
}
```

Attachment [10831-deps.patch](tarball://root/attachments/some-uuid/ticket10831/10831-deps.patch) by @jasongrout created at 2011-03-03 18:27:58

Apply to deps (probably needs to be redone after #9433)



---

archive/issue_comments_113887.json:
```json
{
    "body": "apply to the spkg/install file",
    "created_at": "2011-03-03T18:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113887",
    "user": "@jasongrout"
}
```

apply to the spkg/install file



---

archive/issue_comments_113888.json:
```json
{
    "body": "Attachment [10831-install.patch](tarball://root/attachments/some-uuid/ticket10831/10831-install.patch) by @jasongrout created at 2011-03-03 18:29:33\n\nOkay, I think I made the necessary changes to the deps and install file.  The assumption is that the file `docs_python....spkg` is a symbolic link to the python spkg.  Is this solution a good way to do things?",
    "created_at": "2011-03-03T18:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113888",
    "user": "@jasongrout"
}
```

Attachment [10831-install.patch](tarball://root/attachments/some-uuid/ticket10831/10831-install.patch) by @jasongrout created at 2011-03-03 18:29:33

Okay, I think I made the necessary changes to the deps and install file.  The assumption is that the file `docs_python....spkg` is a symbolic link to the python spkg.  Is this solution a good way to do things?



---

archive/issue_comments_113889.json:
```json
{
    "body": "See #11197 for building docs after Sage is built.",
    "created_at": "2011-04-14T13:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113889",
    "user": "@jasongrout"
}
```

See #11197 for building docs after Sage is built.



---

archive/issue_comments_113890.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-02T01:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113890",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113891.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2021-12-02T01:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113891",
    "user": "@mkoeppe"
}
```

outdated, should close



---

archive/issue_comments_113892.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-02T23:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113892",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113893.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-12-03T18:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10765#issuecomment-113893",
    "user": "@mkoeppe"
}
```

Resolution: invalid
