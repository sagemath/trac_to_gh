# Issue 34242: Polyhedron(backend='number_field')

Issue created by migration from https://trac.sagemath.org/ticket/34479

Original creator: mkoeppe

Original creation time: 2022-09-02 02:29:55

CC:  yzh @kliem jipilab vdelecroix tscrim

(from #33752)

We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from Normaliz and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.


---

Comment by git created at 2022-09-02 02:57:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-02 03:34:41

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-09-02 03:42:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-02 03:55:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @sheerluck created at 2022-09-02 12:11:10

`assert polymake_base_field  # to muffle pyflakes` breaks polymake tests

My workaround is

```diff
     elif backend == 'polymake':
         base_field = base_ring.fraction_field()
         try:
-            from sage.interfaces.polymake import polymake
+            from sage.interfaces.polymake import polymake, PolymakeElement
             polymake_base_field = polymake(base_field)
+            assert isinstance(polymake_base_field, PolymakeElement)  # to muffle pyflakes
         except TypeError:
```



---

Comment by mkoeppe created at 2022-09-02 15:04:46

Thanks for catching this. This is actually from #34195


---

Comment by git created at 2022-09-09 07:51:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-09-09 07:53:49

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-09-09 14:25:34

Probably `_compute_nmz_data_lists_and_field` should be renamed


---

Comment by mkoeppe created at 2022-09-09 15:52:28


```
     def _init_from_Vrepresentation(self, vertices, rays, lines,
-                                   minimize=True, verbose=False):
+                                   minimize=True, verbose=False, number_field=None):
```

Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 

That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)


---

Comment by mkoeppe created at 2022-09-09 17:19:48

New commits:


---

Comment by yzh created at 2022-09-09 21:02:01

How about renaming it to `_compute_data_lists_and_internal_base_ring`?
Replying to [comment:15 Matthias Köppe]:
> Probably `_compute_nmz_data_lists_and_field` should be renamed


---

Comment by yzh created at 2022-09-09 21:03:47

Sounds good. I notice that `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?

Replying to [comment:16 Matthias Köppe]:
> {{{
>      def _init_from_Vrepresentation(self, vertices, rays, lines,
> -                                   minimize=True, verbose=False):
> +                                   minimize=True, verbose=False, number_field=None):
> }}}
> Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 
> 
> That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)


---

Comment by mkoeppe created at 2022-09-09 21:04:38

Replying to [comment:19 Yuan Zhou]:
> How about renaming it to `_compute_data_lists_and_internal_base_ring`?

Sounds good


---

Comment by mkoeppe created at 2022-09-09 21:05:24

Replying to [comment:20 Yuan Zhou]:
>  `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?

Probably a good idea to rename it too


---

Comment by yzh created at 2022-09-09 22:02:58

Renamed.
----
New commits:


---

Comment by git created at 2022-09-09 22:22:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-09 23:48:40

This works well
----
New commits:


---

Comment by git created at 2022-09-09 23:52:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-10 00:12:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-09-10 05:10:29

I would be happy to mark it as a positive review once the patchbot comes back green. If anyone has any objections before that, please do so.


---

Comment by mkoeppe created at 2022-09-26 00:09:37

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-09-26 00:09:37

All green, Lint failures unrelated.


---

Comment by vbraun created at 2022-09-28 23:04:13

Resolution: fixed
