# Issue 34242: Polyhedron(backend='number_field')

archive/issues_034242.json:
```json
{
    "body": "CC:  @yuan-zhou @kliem @jplab @videlec @tscrim\n\n(from #33752)\n\nWe lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from Normaliz and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34479\n\n",
    "created_at": "2022-09-02T02:29:55Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Polyhedron(backend='number_field')",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34242",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @yuan-zhou @kliem @jplab @videlec @tscrim

(from #33752)

We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from Normaliz and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.

Issue created by migration from https://trac.sagemath.org/ticket/34479





---

archive/issue_comments_485108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T02:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-09-02T03:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_485110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T03:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485111.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T03:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485112.json:
```json
{
    "body": "`assert polymake_base_field  # to muffle pyflakes` breaks polymake tests\n\nMy workaround is\n\n```diff\n     elif backend == 'polymake':\n         base_field = base_ring.fraction_field()\n         try:\n-            from sage.interfaces.polymake import polymake\n+            from sage.interfaces.polymake import polymake, PolymakeElement\n             polymake_base_field = polymake(base_field)\n+            assert isinstance(polymake_base_field, PolymakeElement)  # to muffle pyflakes\n         except TypeError:\n```\n",
    "created_at": "2022-09-02T12:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485112",
    "user": "https://github.com/sheerluck"
}
```

`assert polymake_base_field  # to muffle pyflakes` breaks polymake tests

My workaround is

```diff
     elif backend == 'polymake':
         base_field = base_ring.fraction_field()
         try:
-            from sage.interfaces.polymake import polymake
+            from sage.interfaces.polymake import polymake, PolymakeElement
             polymake_base_field = polymake(base_field)
+            assert isinstance(polymake_base_field, PolymakeElement)  # to muffle pyflakes
         except TypeError:
```




---

archive/issue_comments_485113.json:
```json
{
    "body": "Thanks for catching this. This is actually from #34195",
    "created_at": "2022-09-02T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485113",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for catching this. This is actually from #34195



---

archive/issue_comments_485114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T07:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485115.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-09T07:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485115",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_485116.json:
```json
{
    "body": "Probably `_compute_nmz_data_lists_and_field` should be renamed",
    "created_at": "2022-09-09T14:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485116",
    "user": "https://github.com/mkoeppe"
}
```

Probably `_compute_nmz_data_lists_and_field` should be renamed



---

archive/issue_comments_485117.json:
```json
{
    "body": "\n```\n     def _init_from_Vrepresentation(self, vertices, rays, lines,\n-                                   minimize=True, verbose=False):\n+                                   minimize=True, verbose=False, number_field=None):\n```\n\nAlso this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. \n\nThat we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)",
    "created_at": "2022-09-09T15:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485117",
    "user": "https://github.com/mkoeppe"
}
```


```
     def _init_from_Vrepresentation(self, vertices, rays, lines,
-                                   minimize=True, verbose=False):
+                                   minimize=True, verbose=False, number_field=None):
```

Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 

That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)



---

archive/issue_comments_485118.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-09-09T17:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485118",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_485119.json:
```json
{
    "body": "How about renaming it to `_compute_data_lists_and_internal_base_ring`?\nReplying to [comment:15 Matthias K\u00f6ppe]:\n> Probably `_compute_nmz_data_lists_and_field` should be renamed",
    "created_at": "2022-09-09T21:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485119",
    "user": "https://github.com/yuan-zhou"
}
```

How about renaming it to `_compute_data_lists_and_internal_base_ring`?
Replying to [comment:15 Matthias Köppe]:
> Probably `_compute_nmz_data_lists_and_field` should be renamed



---

archive/issue_comments_485120.json:
```json
{
    "body": "Sounds good. I notice that `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?\n\nReplying to [comment:16 Matthias K\u00f6ppe]:\n> {{{\n>      def _init_from_Vrepresentation(self, vertices, rays, lines,\n> -                                   minimize=True, verbose=False):\n> +                                   minimize=True, verbose=False, number_field=None):\n> }}}\n> Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. \n> \n> That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)",
    "created_at": "2022-09-09T21:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485120",
    "user": "https://github.com/yuan-zhou"
}
```

Sounds good. I notice that `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?

Replying to [comment:16 Matthias Köppe]:
> {{{
>      def _init_from_Vrepresentation(self, vertices, rays, lines,
> -                                   minimize=True, verbose=False):
> +                                   minimize=True, verbose=False, number_field=None):
> }}}
> Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 
> 
> That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)



---

archive/issue_comments_485121.json:
```json
{
    "body": "Replying to [comment:19 Yuan Zhou]:\n> How about renaming it to `_compute_data_lists_and_internal_base_ring`?\n\nSounds good",
    "created_at": "2022-09-09T21:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485121",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:19 Yuan Zhou]:
> How about renaming it to `_compute_data_lists_and_internal_base_ring`?

Sounds good



---

archive/issue_comments_485122.json:
```json
{
    "body": "Replying to [comment:20 Yuan Zhou]:\n>  `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?\n\nProbably a good idea to rename it too",
    "created_at": "2022-09-09T21:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485122",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:20 Yuan Zhou]:
>  `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?

Probably a good idea to rename it too



---

archive/issue_comments_485123.json:
```json
{
    "body": "Renamed.\n----\nNew commits:",
    "created_at": "2022-09-09T22:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485123",
    "user": "https://github.com/yuan-zhou"
}
```

Renamed.
----
New commits:



---

archive/issue_comments_485124.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T22:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485125.json:
```json
{
    "body": "This works well\n----\nNew commits:",
    "created_at": "2022-09-09T23:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485125",
    "user": "https://github.com/mkoeppe"
}
```

This works well
----
New commits:



---

archive/issue_comments_485126.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T23:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485127.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-10T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485128.json:
```json
{
    "body": "I would be happy to mark it as a positive review once the patchbot comes back green. If anyone has any objections before that, please do so.",
    "created_at": "2022-09-10T05:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485128",
    "user": "https://github.com/tscrim"
}
```

I would be happy to mark it as a positive review once the patchbot comes back green. If anyone has any objections before that, please do so.



---

archive/issue_comments_485129.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-26T00:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485129",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485130.json:
```json
{
    "body": "All green, Lint failures unrelated.",
    "created_at": "2022-09-26T00:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485130",
    "user": "https://github.com/mkoeppe"
}
```

All green, Lint failures unrelated.



---

archive/issue_events_030779.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-09-28T23:04:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34242#event-30779"
}
```



---

archive/issue_comments_485131.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-28T23:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34242#issuecomment-485131",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
