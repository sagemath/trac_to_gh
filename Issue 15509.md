# Issue 15509: Polynomials over finite fields gives overflow error with large numbers

archive/issues_015509.json:
```json
{
    "body": "Assignee: @tscrim\n\nCC:  fwclarke @pjbruin jpfori\n\nKeywords: polynomials, finite fields\n\n\n```\nsage: R.<x,y> = GF(7)[]\nsage: R(2^31)\n---------------------------------------------------------------------------\nOverflowError                             Traceback (most recent call last)\n<ipython-input-46-6fd7adc32b9b> in <module>()\n----> 1 R(Integer(2)**Integer(31))\n\n/home/travis/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__call__ (sage/rings/polynomial/multi_polynomial_libsingular.cpp:6134)()\n\n/home/travis/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular._coerce_c_impl (sage/rings/polynomial/multi_polynomial_libsingular.cpp:5633)()\n\nOverflowError: Python int too large to convert to C long\n```\n\n\nCompare with:\n\n```\nsage: GF(7)(2^31)\n2\n```\n\nThis might be related to other problems posted in #8857 or fixed by #11239.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15746\n\n",
    "created_at": "2014-01-27T15:57:45Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Polynomials over finite fields gives overflow error with large numbers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15509",
    "user": "@tscrim"
}
```
Assignee: @tscrim

CC:  fwclarke @pjbruin jpfori

Keywords: polynomials, finite fields


```
sage: R.<x,y> = GF(7)[]
sage: R(2^31)
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)
<ipython-input-46-6fd7adc32b9b> in <module>()
----> 1 R(Integer(2)**Integer(31))

/home/travis/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__call__ (sage/rings/polynomial/multi_polynomial_libsingular.cpp:6134)()

/home/travis/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular._coerce_c_impl (sage/rings/polynomial/multi_polynomial_libsingular.cpp:5633)()

OverflowError: Python int too large to convert to C long
```


Compare with:

```
sage: GF(7)(2^31)
2
```

This might be related to other problems posted in #8857 or fixed by #11239.

Issue created by migration from https://trac.sagemath.org/ticket/15746





---

archive/issue_comments_200380.json:
```json
{
    "body": "Part of what is going on here is that Singular works with 32-bit integers; compare\n\n```\n$ ./sage -singular\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 3-1-5\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Jul 2012\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> 2^31;\n// ** int overflow(^), result may be wrong\n-2147483648\n```\n\nThe particular error in the ticket description would be fixed by letting the coercion (of the integer into the polynomial ring) go via the base field.  Actually, the coercion map itself suggests that this should already happen:\n\n```\nsage: f = R.coerce_map_from(ZZ); f\nComposite map:\n  From: Integer Ring\n  To:   Multivariate Polynomial Ring in x, y over Finite Field of size 7\n  Defn:   Natural morphism:\n          From: Integer Ring\n          To:   Finite Field of size 7\n        then\n          Polynomial base injection morphism:\n          From: Finite Field of size 7\n          To:   Multivariate Polynomial Ring in x, y over Finite Field of size 7\nsage: f(2^31)\n2\n```\n\nSo the real problem here is that `R(2^31)` does not call `f` as it ought to (I think).",
    "created_at": "2014-01-27T16:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200380",
    "user": "@pjbruin"
}
```

Part of what is going on here is that Singular works with 32-bit integers; compare

```
$ ./sage -singular
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 3-1-5
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Jul 2012
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> 2^31;
// ** int overflow(^), result may be wrong
-2147483648
```

The particular error in the ticket description would be fixed by letting the coercion (of the integer into the polynomial ring) go via the base field.  Actually, the coercion map itself suggests that this should already happen:

```
sage: f = R.coerce_map_from(ZZ); f
Composite map:
  From: Integer Ring
  To:   Multivariate Polynomial Ring in x, y over Finite Field of size 7
  Defn:   Natural morphism:
          From: Integer Ring
          To:   Finite Field of size 7
        then
          Polynomial base injection morphism:
          From: Finite Field of size 7
          To:   Multivariate Polynomial Ring in x, y over Finite Field of size 7
sage: f(2^31)
2
```

So the real problem here is that `R(2^31)` does not call `f` as it ought to (I think).



---

archive/issue_comments_200381.json:
```json
{
    "body": "Changing component from basic arithmetic to coercion.",
    "created_at": "2014-01-27T16:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200381",
    "user": "@pjbruin"
}
```

Changing component from basic arithmetic to coercion.



---

archive/issue_comments_200382.json:
```json
{
    "body": "The bug appears to be fixed by making `MPolynomialRing_libsingular` a better-behaved parent: add an attribute `Element = MPolynomial_libsingular` and rename `__call__()` to `_element_constructor_()`.  Some more things need to be done (implementing `_coerce_map_from_()`, probably), because running doctests after this change leads to Sage complaining that this class uses the old coercion framework.",
    "created_at": "2014-01-27T17:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200382",
    "user": "@pjbruin"
}
```

The bug appears to be fixed by making `MPolynomialRing_libsingular` a better-behaved parent: add an attribute `Element = MPolynomial_libsingular` and rename `__call__()` to `_element_constructor_()`.  Some more things need to be done (implementing `_coerce_map_from_()`, probably), because running doctests after this change leads to Sage complaining that this class uses the old coercion framework.



---

archive/issue_comments_200383.json:
```json
{
    "body": "Converted `MPolynomialRing_libsingular` to the not-so-new-anymore coercion system; no substantial changes.",
    "created_at": "2014-01-29T19:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200383",
    "user": "@pjbruin"
}
```

Converted `MPolynomialRing_libsingular` to the not-so-new-anymore coercion system; no substantial changes.



---

archive/issue_comments_200384.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-29T19:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200384",
    "user": "@pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200385.json:
```json
{
    "body": "LGTM, thanks Peter.",
    "created_at": "2014-01-30T15:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200385",
    "user": "@tscrim"
}
```

LGTM, thanks Peter.



---

archive/issue_comments_200386.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-30T15:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200386",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200387.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-07T00:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15509#issuecomment-200387",
    "user": "@vbraun"
}
```

Resolution: fixed
