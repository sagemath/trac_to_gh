# Issue 12712: Fix problems introduced by remove_constraint functionality in MIP

archive/issues_012712.json:
```json
{
    "body": "Assignee: @nathanncohen\n\nKeywords: glpk, mixed integer programming, mip, linear programming\n\n* if the `check_redundant` option in MIP is true, then `remove_constraint()` should remove the constraint from `self._constraints`\n\n  * apparently, GLPK wants you to re-initialize the basis after removing constraints, by calling `glp_std_basis()`\n\nI'm going to upload a patch in a little bit.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12884\n\n",
    "created_at": "2012-04-26T18:58:04Z",
    "labels": [
        "component: linear programming",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Fix problems introduced by remove_constraint functionality in MIP",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12712",
    "user": "https://github.com/johnperry-math"
}
```
Assignee: @nathanncohen

Keywords: glpk, mixed integer programming, mip, linear programming

* if the `check_redundant` option in MIP is true, then `remove_constraint()` should remove the constraint from `self._constraints`

  * apparently, GLPK wants you to re-initialize the basis after removing constraints, by calling `glp_std_basis()`

I'm going to upload a patch in a little bit.

Issue created by migration from https://trac.sagemath.org/ticket/12884





---

archive/issue_comments_152009.json:
```json
{
    "body": "Okay, a patch is ready. I don't see any way of removing the constraints efficiently, shy of trying to changing the constraints to a list. I'm not sure we lose that much in terms of efficiency in searching for a new constraint, but removing the ith constraint is quick and easy. Maybe you have a better way of removing the constraints?",
    "created_at": "2012-04-26T19:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152009",
    "user": "https://github.com/johnperry-math"
}
```

Okay, a patch is ready. I don't see any way of removing the constraints efficiently, shy of trying to changing the constraints to a list. I'm not sure we lose that much in terms of efficiency in searching for a new constraint, but removing the ith constraint is quick and easy. Maybe you have a better way of removing the constraints?



---

archive/issue_comments_152010.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-26T19:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152010",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152011.json:
```json
{
    "body": "Hellooooooooo !!!\n\n> Okay, a patch is ready. I don't see any way of removing the constraints efficiently, shy of trying to changing the constraints to a list. I'm not sure we lose that much in terms of efficiency in searching for a new constraint, but removing the ith constraint is quick and easy. Maybe you have a better way of removing the constraints?\n\nWell, what about taking the ith constraint, then normalize it (as you do before adding it to the set), then pop the normalized constraint out of the set ? We could have a _normalize_constraint method in the main class, which would be called before adding or removing a constraint, couldn't we ?\n\nAnd could you please add a doctest ? Otherwise I am pretty sure we could forget again this duplication mechanism next time we work on constraints `:-)`\n\nNathann",
    "created_at": "2012-04-27T08:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152011",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooooo !!!

> Okay, a patch is ready. I don't see any way of removing the constraints efficiently, shy of trying to changing the constraints to a list. I'm not sure we lose that much in terms of efficiency in searching for a new constraint, but removing the ith constraint is quick and easy. Maybe you have a better way of removing the constraints?

Well, what about taking the ith constraint, then normalize it (as you do before adding it to the set), then pop the normalized constraint out of the set ? We could have a _normalize_constraint method in the main class, which would be called before adding or removing a constraint, couldn't we ?

And could you please add a doctest ? Otherwise I am pretty sure we could forget again this duplication mechanism next time we work on constraints `:-)`

Nathann



---

archive/issue_comments_152012.json:
```json
{
    "body": "> Well, what about taking the ith constraint, then normalize it (as you do before adding it to the set), then pop the normalized constraint out of the set ? We could have a _normalize_constraint method in the main class, which would be called before adding or removing a constraint, couldn't we ?\n\nI thought about that, but would floating-point comparisons be a problem?\n\n> And could you please add a doctest ? Otherwise I am pretty sure we could forget again this duplication mechanism next time we work on constraints `:-)`\n\nWe already have a doctest for the duplication mechanism. But, sure, I can add a doctest for this.",
    "created_at": "2012-04-27T13:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152012",
    "user": "https://github.com/johnperry-math"
}
```

> Well, what about taking the ith constraint, then normalize it (as you do before adding it to the set), then pop the normalized constraint out of the set ? We could have a _normalize_constraint method in the main class, which would be called before adding or removing a constraint, couldn't we ?

I thought about that, but would floating-point comparisons be a problem?

> And could you please add a doctest ? Otherwise I am pretty sure we could forget again this duplication mechanism next time we work on constraints `:-)`

We already have a doctest for the duplication mechanism. But, sure, I can add a doctest for this.



---

archive/issue_comments_152013.json:
```json
{
    "body": "BTW, I will either work on this at home (where I have beta13 on two different machines!) or wait until 5.0 comes out. I don't want to download & build yet another beta at the office.",
    "created_at": "2012-04-27T13:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152013",
    "user": "https://github.com/johnperry-math"
}
```

BTW, I will either work on this at home (where I have beta13 on two different machines!) or wait until 5.0 comes out. I don't want to download & build yet another beta at the office.



---

archive/issue_comments_152014.json:
```json
{
    "body": "Helloooooooo !!!\n\n> I thought about that, but would floating-point comparisons be a problem?\n\nWhich floating point comparisons do you have in mind ? \nI thought that if normalization works to test for duplicate constraints it would also work for removing them `:-)`\n\nNathann",
    "created_at": "2012-05-02T12:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152014",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooo !!!

> I thought about that, but would floating-point comparisons be a problem?

Which floating point comparisons do you have in mind ? 
I thought that if normalization works to test for duplicate constraints it would also work for removing them `:-)`

Nathann



---

archive/issue_comments_152015.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> Which floating point comparisons do you have in mind ? \n> I thought that if normalization works to test for duplicate constraints it would also work for removing them `:-)`\n\nPossibly. My caution on this, however, is due to errors that I encountered when testing w*a > w*b (here w, a, and b are tuples of floats) and sometimes getting true when I would have gotten false had I used ints. If an error like this prevented me from removing constraints, that would be catastrophic when later I tried to add it again.",
    "created_at": "2012-05-02T13:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152015",
    "user": "https://github.com/johnperry-math"
}
```

Replying to [comment:5 ncohen]:
> Which floating point comparisons do you have in mind ? 
> I thought that if normalization works to test for duplicate constraints it would also work for removing them `:-)`

Possibly. My caution on this, however, is due to errors that I encountered when testing w*a > w*b (here w, a, and b are tuples of floats) and sometimes getting true when I would have gotten false had I used ints. If an error like this prevented me from removing constraints, that would be catastrophic when later I tried to add it again.



---

archive/issue_comments_152016.json:
```json
{
    "body": "+1 to experience against hasty thinking. Let them be lists `:-)`\n\nNathann",
    "created_at": "2012-05-02T14:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152016",
    "user": "https://github.com/nathanncohen"
}
```

+1 to experience against hasty thinking. Let them be lists `:-)`

Nathann



---

archive/issue_comments_152017.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> +1 to experience against hasty thinking. Let them be lists `:-)`\n\nAh, too bad. I had been hoping you had some insight on floating point that would convert me. :-)\n\nBut, yes, failing to detect some redundant constraints isn't as catastrophic as failing to remove even one constraint that must be removed. Maybe one day we can figure some way to make the check for redundancy more efficient by sorting the list somehow, but it works pretty well for me right now in practice.\n\nIt would be nicer if the backends did that for us, but they don't. :-(\n\nAlright: I'll submit a revision of this patch at some point, with the added doctest. Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? That shouldn't be an issue, except that I can't quite test all the packages. (Though I can now test Gurobi & Cbc as well as GLPK).",
    "created_at": "2012-05-02T14:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152017",
    "user": "https://github.com/johnperry-math"
}
```

Replying to [comment:7 ncohen]:
> +1 to experience against hasty thinking. Let them be lists `:-)`

Ah, too bad. I had been hoping you had some insight on floating point that would convert me. :-)

But, yes, failing to detect some redundant constraints isn't as catastrophic as failing to remove even one constraint that must be removed. Maybe one day we can figure some way to make the check for redundancy more efficient by sorting the list somehow, but it works pretty well for me right now in practice.

It would be nicer if the backends did that for us, but they don't. :-(

Alright: I'll submit a revision of this patch at some point, with the added doctest. Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? That shouldn't be an issue, except that I can't quite test all the packages. (Though I can now test Gurobi & Cbc as well as GLPK).



---

archive/issue_comments_152018.json:
```json
{
    "body": "Hello !!!!\n\n> but it works pretty well for me right now in practice.\n\nGood to know ! `:-)`\n\n> Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? \n\nOh.. Are we missing much there ? I thought I was careful when writing the MILP classes `O_o`\n\nI can not check right now as sage 5.0-rc0 is being compiled, but I hope there is not much work to do. I would also like to see a proud 100% on these files. If you feel like adding some documentation while working on this patch please do, but leave some of the work, it would not be fair otherwise `:-)`\n\nNathann",
    "created_at": "2012-05-02T14:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152018",
    "user": "https://github.com/nathanncohen"
}
```

Hello !!!!

> but it works pretty well for me right now in practice.

Good to know ! `:-)`

> Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? 

Oh.. Are we missing much there ? I thought I was careful when writing the MILP classes `O_o`

I can not check right now as sage 5.0-rc0 is being compiled, but I hope there is not much work to do. I would also like to see a proud 100% on these files. If you feel like adding some documentation while working on this patch please do, but leave some of the work, it would not be fair otherwise `:-)`

Nathann



---

archive/issue_comments_152019.json:
```json
{
    "body": "Replying to [comment:9 ncohen]:\n> > Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? \n> \n> Oh.. Are we missing much there ? I thought I was careful when writing the MILP classes `O_o`\n\nYou were, actually. We're not missing much; here's the result of what I get when I run `../../sage -coverage sage/numerical` (slightly edited for readability)\n\n```\nNo functions in sage/numerical//__init__.py\n\nNo functions in sage/numerical//all.py\n\n----------------------------------------------------------------------\nsage/numerical//optimize.py\nSCORE sage/numerical//optimize.py: 100% (8 of 8)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//mip.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//mip.pyx: 98% (59 of 60)\n----------------------------------------------------------------------\n\nNo functions in sage/numerical//test.py\n\nNo functions in sage/numerical//backends/__init__.py\n\n----------------------------------------------------------------------\nsage/numerical//backends/gurobi_backend.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//backends/gurobi_backend.pyx: 89% (26 of 29)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//backends/generic_backend.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//backends/generic_backend.pyx: 87% (29 of 33)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//backends/cplex_backend.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//backends/cplex_backend.pyx: 90% (29 of 32)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//backends/coin_backend.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//backends/coin_backend.pyx: 93% (29 of 31)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//backends/glpk_backend.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/numerical//backends/glpk_backend.pyx: 93% (31 of 33)\n----------------------------------------------------------------------\n\n----------------------------------------------------------------------\nsage/numerical//knapsack.py\nSCORE sage/numerical//knapsack.py: 100% (8 of 8)\n----------------------------------------------------------------------\n```\n\n\n> I can not check right now as sage 5.0-rc0 is being compiled, but I hope there is not much work to do. I would also like to see a proud 100% on these files. If you feel like adding some documentation while working on this patch please do, but leave some of the work, it would not be fair otherwise `:-)`\n\nI'll try to take care of it. It's on my schedule for tomorrow, then. :-)\n\njohn",
    "created_at": "2012-05-02T14:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152019",
    "user": "https://github.com/johnperry-math"
}
```

Replying to [comment:9 ncohen]:
> > Speaking of which, I noticed that the doctest coverage in sage/numerical isn't quite at 100%, and some people have been talking about that. Shall I try to complete that, and add it to this patch? 
> 
> Oh.. Are we missing much there ? I thought I was careful when writing the MILP classes `O_o`

You were, actually. We're not missing much; here's the result of what I get when I run `../../sage -coverage sage/numerical` (slightly edited for readability)

```
No functions in sage/numerical//__init__.py

No functions in sage/numerical//all.py

----------------------------------------------------------------------
sage/numerical//optimize.py
SCORE sage/numerical//optimize.py: 100% (8 of 8)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//mip.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//mip.pyx: 98% (59 of 60)
----------------------------------------------------------------------

No functions in sage/numerical//test.py

No functions in sage/numerical//backends/__init__.py

----------------------------------------------------------------------
sage/numerical//backends/gurobi_backend.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//backends/gurobi_backend.pyx: 89% (26 of 29)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//backends/generic_backend.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//backends/generic_backend.pyx: 87% (29 of 33)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//backends/cplex_backend.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//backends/cplex_backend.pyx: 90% (29 of 32)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//backends/coin_backend.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//backends/coin_backend.pyx: 93% (29 of 31)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//backends/glpk_backend.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/numerical//backends/glpk_backend.pyx: 93% (31 of 33)
----------------------------------------------------------------------

----------------------------------------------------------------------
sage/numerical//knapsack.py
SCORE sage/numerical//knapsack.py: 100% (8 of 8)
----------------------------------------------------------------------
```


> I can not check right now as sage 5.0-rc0 is being compiled, but I hope there is not much work to do. I would also like to see a proud 100% on these files. If you feel like adding some documentation while working on this patch please do, but leave some of the work, it would not be fair otherwise `:-)`

I'll try to take care of it. It's on my schedule for tomorrow, then. :-)

john



---

archive/issue_comments_152020.json:
```json
{
    "body": "Changing keywords from \"glpk, mixed integer programming, mip, linear programming\" to \"glpk, mixed integer programming, mip, linear programming, sd40.5\".",
    "created_at": "2012-05-25T22:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152020",
    "user": "https://github.com/johnperry-math"
}
```

Changing keywords from "glpk, mixed integer programming, mip, linear programming" to "glpk, mixed integer programming, mip, linear programming, sd40.5".



---

archive/issue_comments_152021.json:
```json
{
    "body": "Attachment [trac_12884.patch](tarball://root/attachments/some-uuid/ticket12884/trac_12884.patch) by @johnperry-math created at 2012-05-25 22:12:07\n\nI updated the patch, adding a few doctests, including the one Nathann requested. Sage will still complain that doctest coverage isn't complete, but that's due to an old bug that still hasn't been resolve (see #1795).\n\nPlease review!",
    "created_at": "2012-05-25T22:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152021",
    "user": "https://github.com/johnperry-math"
}
```

Attachment [trac_12884.patch](tarball://root/attachments/some-uuid/ticket12884/trac_12884.patch) by @johnperry-math created at 2012-05-25 22:12:07

I updated the patch, adding a few doctests, including the one Nathann requested. Sage will still complain that doctest coverage isn't complete, but that's due to an old bug that still hasn't been resolve (see #1795).

Please review!



---

archive/issue_comments_152022.json:
```json
{
    "body": "\n```\nsage -t  \"devel/sage-2/sage/numerical/mip.pyx\"              \n\t [1.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.6 seconds\n```\n\n\nGooooooooooood to go ! `:-)`\n\nThank you for this patch !!\n\nNathann",
    "created_at": "2012-05-28T14:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152022",
    "user": "https://github.com/nathanncohen"
}
```


```
sage -t  "devel/sage-2/sage/numerical/mip.pyx"              
	 [1.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.6 seconds
```


Gooooooooooood to go ! `:-)`

Thank you for this patch !!

Nathann



---

archive/issue_comments_152023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T14:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152023",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152024.json:
```json
{
    "body": "Please fill in your real name in the Author / Reviewer fields.",
    "created_at": "2012-06-09T19:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152024",
    "user": "https://github.com/jdemeyer"
}
```

Please fill in your real name in the Author / Reviewer fields.



---

archive/issue_comments_152025.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12712#issuecomment-152025",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
