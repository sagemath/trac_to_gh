# Issue 25515: @cached_method for cdef classes without a __dict__ are not cached

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2018-07-02 21:41:23

CC:  jdemeyer simonking saraedum

Keywords: days94


```sage
sage: cython("""
....: from sage.misc.cachefunc import cached_method
....: cdef class Foo(object):
....:     `@`cached_method
....:     def test(self, x):
....:         print("cache")
....:         return 5
....: """)
sage: F = Foo()
sage: F.test(2)
cache
5
sage: F.test(2)
cache
5
```


This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.


---

Comment by SimonKing created at 2018-07-02 23:09:02

Replying to [ticket:25752 tscrim]:
> This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.

I think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef). For everything else it should just work as a usual method (albeit slower).


---

Comment by tscrim created at 2018-07-03 07:51:03

Replying to [comment:1 SimonKing]:
> Replying to [ticket:25752 tscrim]:
> > This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.
> 
> I think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef).

That is curious:

```
sage: cython("""
....: from sage.misc.cachefunc import cached_method
....: from sage.structure.parent cimport Parent
....: cdef class Foo(Parent):
....:     `@`cached_method
....:     def test(self, x):
....:         print("cache")
....:         return 5
....: """)
sage: F = Foo()
sage: F.test(2)
cache
5
sage: F.test(2)
5
```

Why does it work special for `Parent` subclasses? Is this behavior doc(tested)?

> For everything else it should just work as a usual method (albeit slower).

Is this documented somewhere? If the result is not cached, why is the decorator just not doing anything to method (and instead slowing it down)?
