# Issue 10331: isPositiveSemiDefinite not accessible

archive/issues_010331.json:
```json
{
    "body": "Assignee: @ClementPernet\n\nCC:  @orlitzky @kliem @mwageringel @dimpase @rbeezer\n\nKeywords: psd, semidefinite positive\n\nI would like to test rational matrices for semidefinite positiveness. There is such a function in linbox, apparently (isPositiveSemiDefinite, from is-positive-semidefinite.h), but it is not accessible from Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10332\n\n",
    "created_at": "2010-11-25T22:10:03Z",
    "labels": [
        "component: linbox"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "isPositiveSemiDefinite not accessible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10331",
    "user": "https://trac.sagemath.org/admin/accounts/users/monniaux"
}
```
Assignee: @ClementPernet

CC:  @orlitzky @kliem @mwageringel @dimpase @rbeezer

Keywords: psd, semidefinite positive

I would like to test rational matrices for semidefinite positiveness. There is such a function in linbox, apparently (isPositiveSemiDefinite, from is-positive-semidefinite.h), but it is not accessible from Sage.

Issue created by migration from https://trac.sagemath.org/ticket/10332





---

archive/issue_comments_105629.json:
```json
{
    "body": "Changing component from linbox to linear algebra.",
    "created_at": "2013-03-28T22:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105629",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from linbox to linear algebra.



---

archive/issue_comments_105630.json:
```json
{
    "body": "Changing assignee from @ClementPernet to jason, was.",
    "created_at": "2013-03-28T22:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105630",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @ClementPernet to jason, was.



---

archive/issue_comments_105631.json:
```json
{
    "body": "I went down a rabbit hole with the cholesky inverse and wound up here. The inverse of a positive-definite matrix can actually be computed a tiiiiny bit faster through the `indefinite_factorization` method, which returns a naive (suitable only in exact arithmetic) LDLT factorization.\n\nIf we modify the `indefinite_factorization` to pivot (put the zeros at the bottom of `D`), we could also perform an LDLT factorization for positive-SEMIdefinite matrices, making the goal of this ticket attainable.\n\nNote also that some people have asked for square roots of PSD matrices in #23424 and #25464. Right now that's only implemented for positive-definite matrices, due to the aforementioned limitation of the LDLT factorization, so we could potentially improve that too.",
    "created_at": "2020-09-26T02:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105631",
    "user": "https://github.com/orlitzky"
}
```

I went down a rabbit hole with the cholesky inverse and wound up here. The inverse of a positive-definite matrix can actually be computed a tiiiiny bit faster through the `indefinite_factorization` method, which returns a naive (suitable only in exact arithmetic) LDLT factorization.

If we modify the `indefinite_factorization` to pivot (put the zeros at the bottom of `D`), we could also perform an LDLT factorization for positive-SEMIdefinite matrices, making the goal of this ticket attainable.

Note also that some people have asked for square roots of PSD matrices in #23424 and #25464. Right now that's only implemented for positive-definite matrices, due to the aforementioned limitation of the LDLT factorization, so we could potentially improve that too.



---

archive/issue_comments_105632.json:
```json
{
    "body": "I'm slowly working on a pivoted LDLT factorization at\n\n  http://gitweb.michael.orlitzky.com/?p=sage.d.git;a=blob;f=mjo/ldlt.py\n\nAt some point I will have to carefully check (unless someone has a reference) how it can be used to determine positive-semidefiniteness, especially with complex matrices.",
    "created_at": "2020-09-29T15:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105632",
    "user": "https://github.com/orlitzky"
}
```

I'm slowly working on a pivoted LDLT factorization at

  http://gitweb.michael.orlitzky.com/?p=sage.d.git;a=blob;f=mjo/ldlt.py

At some point I will have to carefully check (unless someone has a reference) how it can be used to determine positive-semidefiniteness, especially with complex matrices.



---

archive/issue_comments_105633.json:
```json
{
    "body": "This is nearing presentability.\n\nMy branch has a numerically stable block-LDLT factorization that works for indefinite matrices and in inexact arithmetic. The cited paper shows why we can use it to determine positive-semidefiniteness: each 2x2 diagonal block corresponds to one positive and one negative eigenvalue, and Sylvester's inertia theorem handles the rest.. I've added an `is_positive_semidefinite()` method for matrices based on that.\n\nCompared to `is_positive_definite()`, the new method...\n\n1. Doesn't distinguish between real/complex algorithms. We simply insist that the matrix be Hermitian (which is true of real symmetric matrices, of course), and always use `conjugate_transpose()`. This is not hugely expensive and cleans up the user interface a lot.\n2. Doesn't do any checks on the input matrix. So long as the matrix is Hermitian, you should be okay -- but you're in charge of checking that. Running `if not A.is_hermitian()...` on your own is a lot simpler than asking the method to check it for you, and then waiting to catch an exception. And when you want it to be fast, there's no need to disable the checks; it's already fast.\n\nThis could conceivably also be used to speed up `solve_left` and `solve_right` for Hermitian matrices.",
    "created_at": "2020-10-07T21:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105633",
    "user": "https://github.com/orlitzky"
}
```

This is nearing presentability.

My branch has a numerically stable block-LDLT factorization that works for indefinite matrices and in inexact arithmetic. The cited paper shows why we can use it to determine positive-semidefiniteness: each 2x2 diagonal block corresponds to one positive and one negative eigenvalue, and Sylvester's inertia theorem handles the rest.. I've added an `is_positive_semidefinite()` method for matrices based on that.

Compared to `is_positive_definite()`, the new method...

1. Doesn't distinguish between real/complex algorithms. We simply insist that the matrix be Hermitian (which is true of real symmetric matrices, of course), and always use `conjugate_transpose()`. This is not hugely expensive and cleans up the user interface a lot.
2. Doesn't do any checks on the input matrix. So long as the matrix is Hermitian, you should be okay -- but you're in charge of checking that. Running `if not A.is_hermitian()...` on your own is a lot simpler than asking the method to check it for you, and then waiting to catch an exception. And when you want it to be fast, there's no need to disable the checks; it's already fast.

This could conceivably also be used to speed up `solve_left` and `solve_right` for Hermitian matrices.



---

archive/issue_comments_105634.json:
```json
{
    "body": "Since I haven't changed anything in four months I guess this is ready for review.",
    "created_at": "2021-01-26T13:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105634",
    "user": "https://github.com/orlitzky"
}
```

Since I haven't changed anything in four months I guess this is ready for review.



---

archive/issue_comments_105635.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-26T13:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105635",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_105636.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-01-26T16:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105636",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_105637.json:
```json
{
    "body": "Rebased onto develop.",
    "created_at": "2021-01-26T16:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105637",
    "user": "https://github.com/orlitzky"
}
```

Rebased onto develop.



---

archive/issue_comments_105638.json:
```json
{
    "body": "matrix2.pyx  is long overdue for splitting, it's 670K !!! (unless we aim for Guinness Book of Records, of course).",
    "created_at": "2021-01-27T10:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105638",
    "user": "https://github.com/dimpase"
}
```

matrix2.pyx  is long overdue for splitting, it's 670K !!! (unless we aim for Guinness Book of Records, of course).



---

archive/issue_comments_105639.json:
```json
{
    "body": "otherwise, OK.",
    "created_at": "2021-01-27T11:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105639",
    "user": "https://github.com/dimpase"
}
```

otherwise, OK.



---

archive/issue_comments_105640.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-27T11:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105640",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_105641.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-01-27T13:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105641",
    "user": "https://github.com/orlitzky"
}
```

Thanks!



---

archive/issue_comments_105642.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-02-20T10:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10331#issuecomment-105642",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
