# Issue 25975: py3: make all tests pass

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-09-07 14:09:17

CC:  vklein embray jmantysalo @timokau

This ticket is used to keep track of the progress towards python3.

Situation in 8.4.b4

Folders where all tests pass:

* lfunctions
* knots

Folders with work in progress:

* quivers
* finance
* plot


---

Comment by embray created at 2018-10-09 10:35:25

Hadn't even seen this ticket; very nice.


---

Comment by chapoton created at 2018-10-21 10:08:20

good progress on 8.5.b0


---

Comment by chapoton created at 2018-10-21 11:06:17

The six remaining files with many failures are

```
['sage -t --long src/sage/combinat/finite_state_machine.py  # 189 doctests failed',
 'sage -t --long src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 105 doctests failed',
 'sage -t --long src/sage/graphs/generic_graph.py  # 110 doctests failed',
 'sage -t --long src/sage/groups/lie_gps/nilpotent_lie_group.py  # 143 doctests failed',
 'sage -t --long src/sage/rings/padics/padic_lattice_element.py  # 167 doctests failed',
 'sage -t --long src/sage/rings/valuation/limit_valuation.py  # 106 doctests failed']
```



---

Comment by jhpalmieri created at 2018-10-22 02:17:52

For whoever wants to work on it, regarding

```
sage -t --long src/sage/combinat/finite_state_machine.py  # 189 doctests failed
```

about 150 of the failures can be cured by replacing 'iteritems' by 'items' in lines like

```
        elif hasattr(data, 'iteritems'):
            # data is a dict (or something similar),
```

I don't know if 'items' is the right attribute to check, or if it would actually be better to change to `isinstance(data, dict)`. What other data structures are mean to be acceptable? What is "something similar" to a dict?


---

Comment by vklein created at 2018-10-22 07:40:06

Replying to [comment:80 jhpalmieri]:
> For whoever wants to work on it, regarding
> ...
> I don't know if 'items' is the right attribute to check, or if it would actually be better to change to `isinstance(data, dict)`. What other data structures are mean to be acceptable? What is "something similar" to a dict?

There is some custom "Mapping types" in sage like `FreeModuleElement_generic_sparse`, which implements `items` and `iteritems` but doesn't inherit from `dict`.


---

Attachment

tool to extract the data from patchbot log


---

Comment by chapoton created at 2018-10-27 16:25:43

There was a regression in the manifolds folder (sigh)..

The 3 remaining files with more than 100 failing doctests are

```
['sage -t --long src/sage/combinat/finite_state_machine.py  # 182 doctests failed',
 'sage -t --long src/sage/graphs/generic_graph.py  # 109 doctests failed',
 'sage -t --long src/sage/rings/padics/padic_lattice_element.py  # 167 doctests failed']
```

The first one is already tackled in #26147 at least partially.


---

Comment by jhpalmieri created at 2018-10-27 21:17:22

Regarding

```
'sage -t --long src/sage/rings/padics/padic_lattice_element.py  # 167 doctests failed'
```

I can reproduce those failures when I run `./sage -t ...`, but (at least for the first few) not when I run Sage interactively. Odd.


---

Comment by chapoton created at 2018-11-02 10:07:02

Top ten bad files in 8.5.b2 are

```
['sage -t --long src/sage/numerical/backends/cvxopt_sdp_backend.pyx  # 39 doctests failed',
 'sage -t --long src/sage/algebras/iwahori_hecke_algebra.py  # 40 doctests failed',
 'sage -t --long src/sage/numerical/mip.pyx  # 47 doctests failed',
 'sage -t --long src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'sage -t --long src/sage/rings/function_field/ideal.py  # 56 doctests failed',
 'sage -t --long src/sage/graphs/graph.py  # 59 doctests failed',
 'sage -t --long src/sage/graphs/connectivity.pyx  # 60 doctests failed',
 'sage -t --long src/sage/misc/explain_pickle.py  # 70 doctests failed',
 'sage -t --long src/sage/numerical/sdp.pyx  # 75 doctests failed',
 'sage -t --long src/sage/graphs/generic_graph.py  # 109 doctests failed']
```



---

Comment by chapoton created at 2018-11-12 20:05:58

The top ten worse files in 8.5.b3 are

```
['sage -t --long src/sage/combinat/finite_state_machine.py  # 31 doctests failed',
 'sage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 'sage -t --long src/sage/numerical/mip.pyx  # 47 doctests failed',
 'sage -t --long src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'sage -t --long src/sage/rings/function_field/ideal.py  # 56 doctests failed',
 'sage -t --long src/sage/graphs/graph.py  # 58 doctests failed',
 'sage -t --long src/sage/graphs/connectivity.pyx  # 59 doctests failed',
 'sage -t --long src/sage/rings/tate_algebra_element.pyx  # 63 doctests failed',
 'sage -t --long src/sage/misc/explain_pickle.py  # 70 doctests failed',
 'sage -t --long src/sage/graphs/generic_graph.py  # 115 doctests failed']
```



---

Comment by chapoton created at 2018-11-19 08:31:21

Top ten worst files in 8.5.b4 are:

```
src/sage/graphs/graph.py  # 30 doctests failed
src/sage/numerical/linear_functions.pyx  # 30 doctests failed
src/sage/combinat/finite_state_machine.py  # 31 doctests failed
src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed
src/sage/numerical/mip.pyx  # 47 doctests failed
src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed
src/sage/graphs/connectivity.pyx  # 50 doctests failed
src/sage/rings/function_field/ideal.py  # 56 doctests failed
src/sage/misc/explain_pickle.py  # 70 doctests failed
src/sage/graphs/generic_graph.py  # 77 doctests failed
```



---

Comment by chapoton created at 2018-11-22 15:26:49

Number of failing doctests in 8.5.beta4 by components

```
'en': 56, 'coding': 28, 'data_structures': 5, 'symbolic': 24, 'libs': 34,
 'schemes': 102, 'combinat': 292, 'dynamics': 39, 'interacts': 6, 'homology': 29,
 'plot': 5, 'functions': 5, 'matrix': 16, 'rings': 209, 'categories': 34,
 'docbuild': 2, 'algebras': 21, 'common': 1, 'calculus': 5, 'tests': 40,
 'matroids': 75, 'misc': 172, 'interfaces': 1, 'numerical': 206, 'modular': 82,
 'repl': 13, 'groups': 14, 'sandpiles': 22, 'game_theory': 11, 'structure': 6,
 'cpython': 7, 'sets': 6, 'geometry': 32, 'modules': 3, 'crypto': 13,
 'graphs': 292, 'ext': 8, 'doctest': 8, 'databases': 16
```



---

Comment by chapoton created at 2018-11-26 12:51:35

Worst 15 files in 8.5.b5:

```
[' src/sage/homology/simplicial_complex.py  # 23 doctests failed',
 ' src/sage/numerical/linear_tensor_element.pyx  # 23 doctests failed',
 ' src/sage/matroids/matroid.pyx  # 24 doctests failed',
 ' src/sage/rings/integer.pyx  # 24 doctests failed',
 ' src/sage/misc/decorators.py  # 28 doctests failed',
 ' src/sage/numerical/linear_tensor_constraints.py  # 28 doctests failed',
 ' src/sage/combinat/rigged_configurations/kr_tableaux.py  # 30 doctests failed',
 ' src/sage/graphs/graph.py  # 30 doctests failed',
 ' src/sage/numerical/linear_functions.pyx  # 30 doctests failed',
 ' src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 ' src/sage/numerical/mip.pyx  # 47 doctests failed',
 ' src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 ' src/sage/graphs/connectivity.pyx  # 49 doctests failed',
 ' src/sage/misc/explain_pickle.py  # 70 doctests failed',
 ' src/sage/graphs/generic_graph.py  # 79 doctests failed']
```



---

Comment by chapoton created at 2018-11-26 12:56:29

and by components:

```
[('common', 1), ('interfaces', 1), ('docbuild', 2), ('coding', 2), ('modules', 4), 
('functions', 5), ('calculus', 5), ('plot', 5), ('data_structures', 5), ('structure',
 6), ('interacts', 6), ('sets', 6), ('cpython', 7), ('doctest', 8), ('ext', 8), 
('crypto', 13), ('geometry', 13), ('repl', 13), ('groups', 15), ('algebras', 16),
 ('matrix', 17), ('sandpiles', 22), ('symbolic', 26), ('homology', 30), ('libs', 34),
 ('categories', 35), ('tests', 40), ('dynamics', 40), ('en', 56), ('matroids', 73),
 ('schemes', 80), ('modular', 82), ('rings', 141), ('misc', 171), ('numerical', 206), 
('combinat', 240), ('graphs', 300)]
```



---

Comment by chapoton created at 2018-12-02 19:29:56

worst 20 files in 8.5.b6:

```
['/sage/matroids/matroid.pyx  # 18 doctests failed',
 '/sage/combinat/finite_state_machine.py  # 20 doctests failed',
 '/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 '/sage/numerical/linear_tensor.py  # 20 doctests failed',
 '/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 '/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 '/sage/homology/simplicial_complex.py  # 22 doctests failed',
 '/sage/sandpiles/sandpile.py  # 22 doctests failed',
 '/sage/numerical/linear_tensor_element.pyx  # 23 doctests failed',
 '/sage/rings/integer.pyx  # 24 doctests failed',
 '/sage/misc/decorators.py  # 28 doctests failed',
 '/sage/numerical/linear_tensor_constraints.py  # 28 doctests failed',
 '/sage/graphs/graph.py  # 30 doctests failed',
 '/sage/numerical/linear_functions.pyx  # 30 doctests failed',
 '/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 '/sage/numerical/mip.pyx  # 47 doctests failed',
 '/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 '/sage/graphs/connectivity.pyx  # 49 doctests failed',
 '/sage/misc/explain_pickle.py  # 70 doctests failed',
 '/sage/graphs/generic_graph.py  # 78 doctests failed']
```



---

Comment by chapoton created at 2018-12-10 19:20:02

15 worst offenders in 8.5.rc0:

```
['src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'src/sage/homology/simplicial_complex.py  # 22 doctests failed',
 'src/sage/sandpiles/sandpile.py  # 22 doctests failed',
 'src/sage/numerical/linear_tensor_element.pyx  # 23 doctests failed',
 'src/sage/misc/decorators.py  # 28 doctests failed',
 'src/sage/numerical/linear_tensor_constraints.py  # 28 doctests failed',
 'src/sage/graphs/graph.py  # 30 doctests failed',
 'src/sage/numerical/linear_functions.pyx  # 30 doctests failed',
 'src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 'src/sage/numerical/mip.pyx  # 47 doctests failed',
 'src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed',
 'src/sage/graphs/generic_graph.py  # 74 doctests failed']
```



---

Comment by chapoton created at 2018-12-28 20:43:50

15 worst offenders in 8.6.b0:

```
['src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/combinat/matrices/hadamard_matrix.py  # 15 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'src/sage/sandpiles/sandpile.py  # 22 doctests failed',
 'src/sage/matroids/matroid.pyx  # 23 doctests failed',
 'src/sage/homology/simplicial_complex.py  # 24 doctests failed',
 'src/sage/graphs/graph.py  # 28 doctests failed',
 'src/sage/misc/decorators.py  # 28 doctests failed',
 'src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 'src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'src/sage/graphs/generic_graph.py  # 68 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed']
```



---

Comment by chapoton created at 2018-12-28 20:56:27

maybe due to the upgrade of gap, there is a regression:

```
sage -t --long src/sage/groups/matrix_gps/finitely_generated.py
  # 3 doctests failed
```



---

Comment by chapoton created at 2019-01-01 17:18:08

worst 15 files in 8.6.b1:

```
['src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/combinat/matrices/hadamard_matrix.py  # 15 doctests failed',
 'src/sage/matroids/matroid.pyx  # 17 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'src/sage/sandpiles/sandpile.py  # 22 doctests failed',
 'src/sage/homology/simplicial_complex.py  # 23 doctests failed',
 'src/sage/graphs/graph.py  # 28 doctests failed',
 'src/sage/misc/decorators.py  # 28 doctests failed',
 'src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 'src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'src/sage/graphs/generic_graph.py  # 63 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed']
```



---

Comment by chapoton created at 2019-01-04 08:03:01

files where failing doctests have re-appeared (regressions):

```
['src/sage/categories/crystals.py',
 'src/sage/matroids/circuit_closures_matroid.pyx',
 'src/sage/matroids/dual_matroid.py']
```

file where failing doctests have disappeared (progress):

```
['src/sage/misc/decorators.py',
 'src/sage/rings/polynomial/laurent_polynomial.pyx']
```

so this is a net loss of 1 file


---

Comment by chapoton created at 2019-01-13 08:02:05

Getting worse again! Damn!


---

Comment by chapoton created at 2019-01-13 08:10:11

regressions in 

```
 'sage -t --long src/sage/combinat/multiset_partition_into_sets_ordered.py',
 'sage -t --long src/sage/combinat/set_partition.py',
 'sage -t --long src/sage/dynamics/arithmetic_dynamics/endPN_automorphism_group.py',
 'sage -t --long src/sage/graphs/spanning_tree.pyx',
 'sage -t --long src/sage/modules/multi_filtered_vector_space.py',
 'sage -t --long src/sage/rings/invariants/invariant_theory.py'
```

and progress in

```
 'sage -t --long src/sage/matrix/compute_J_ideal.py',
 'sage -t --long src/sage/matroids/circuit_closures_matroid.pyx'}
```

so this a net loss of 4 files


---

Comment by dcoudert created at 2019-01-14 16:37:03

I don't have any doctest error with py3 for `sage -t --long src/sage/graphs/spanning_tree.pyx`. Can you share what you get. Thanks.


---

Comment by chapoton created at 2019-01-14 19:21:58

This and other failures can be seen in the unique patchbot report running python3 on ticket 0:

https://patchbot.sagemath.org/ticket/0/


```
sage -t --long src/sage/graphs/spanning_tree.pyx
**********************************************************************
File "src/sage/graphs/spanning_tree.pyx", line 188, in sage.graphs.spanning_tree.kruskal
Failed example:
    sorted(kruskal(G, check=True))
Expected:
    [('a', 'b', 4), ('a', 'h', 8), ('c', 'd', 7), ('c', 'f', 4), ('c', 'i', 2), ('d', 'e', 9), ('f', 'g', 2), ('g', 'h', 1)]
Got:
    [('a', 'b', 4),
     ('b', 'c', 8),
     ('c', 'd', 7),
     ('c', 'f', 4),
     ('c', 'i', 2),
     ('d', 'e', 9),
     ('f', 'g', 2),
     ('g', 'h', 1)]
**********************************************************************
1 item had failures:
   1 of  45 in sage.graphs.spanning_tree.kruskal
    [83 tests, 1 failure, 0.60 s]
```



---

Comment by dcoudert created at 2019-01-15 12:16:50

See #27059 for of fix of the issue of â€‹#comment:184


---

Comment by chapoton created at 2019-01-24 10:47:34

massive regression in 8.7.beta0, in particular here:

```
sage -t --long src/sage/schemes/elliptic_curves/BSD.py # 17 doctests failed
sage -t --long src/sage/schemes/elliptic_curves/gal_reps.py  # 20 doctests failed
sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # 72 doctests failed
sage -t --long src/sage/schemes/elliptic_curves/ell_curve_isogeny.py  # 204 doctests failed
```



---

Comment by chapoton created at 2019-01-24 12:53:20

Worst 15 files in 8.7.beta0 (once the large regression in isogenies is fixed):

```
 'sage -t --long src/sage/rings/polynomial/multi_polynomial_sequence.py  # 12 doctests failed',
 'sage -t --long src/sage/symbolic/constants.py  # 12 doctests failed',
 'sage -t --long src/sage/tests/french_book/mpoly.py  # 13 doctests failed',
 'sage -t --long src/sage/graphs/digraph.py  # 14 doctests failed',
 'sage -t --long src/sage/categories/finite_posets.py  # 15 doctests failed',
 'sage -t --long src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'sage -t --long src/sage/matroids/matroid.pyx  # 19 doctests failed',
 'sage -t --long src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'sage -t --long src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'sage -t --long src/sage/sandpiles/sandpile.py  # 22 doctests failed',
 'sage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 36 doctests failed',
 'sage -t --long src/doc/en/thematic_tutorials/sandpile.rst  # 49 doctests failed',
 'sage -t --long src/sage/graphs/generic_graph.py  # 51 doctests failed',
 'sage -t --long src/sage/misc/explain_pickle.py  # 70 doctests failed'
```



---

Comment by chapoton created at 2019-01-27 10:51:43

good progress, no ? :-)


---

Comment by chapoton created at 2019-01-27 10:59:17

worst 15 files in 8.7.b1:

```
 'src/sage/matroids/graphic_matroid.py  # 11 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/symbolic/expression.pyx  # 11 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_sequence.py  # 12 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/modular/modform/element.py  # 13 doctests failed',
 'src/sage/tests/french_book/mpoly.py  # 13 doctests failed',
 'src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 20 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed',
 'src/sage/graphs/generic_graph.py  # 50 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed'
```



---

Comment by @timokau created at 2019-01-27 12:15:48

That is some impressive progress! Good work.


---

Comment by chapoton created at 2019-02-09 12:37:17

some progress again


---

Comment by chapoton created at 2019-02-09 12:50:52

Worst 15 files in 8.7.b3:

```
['src/sage/tests/french_book/programmation_doctest.py  # 10 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 11 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_sequence.py  # 12 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/tests/french_book/mpoly.py  # 13 doctests failed',
 'src/sage/graphs/digraph.py  # 14 doctests failed',
 'src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'src/sage/graphs/generic_graph.py  # 30 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed']
```



---

Comment by chapoton created at 2019-02-15 20:12:26

Worst 15 files in 8.7.b4:

```
'src/sage/symbolic/expression.pyx  # 10 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 11 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_sequence.py  # 12 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/matrix/matrix_polynomial_dense.pyx  # 14 doctests failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/mpoly_doctest.py  # 14 doctests failed',
 'src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/graphs/generic_graph.py  # 18 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/wehlerK3.py  # 21 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 21 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed'
```



---

Comment by jhpalmieri created at 2019-02-15 21:38:56

Re

```
 'src/sage/symbolic/constants.py  # 12 doctests failed',
```

I only see 6 failed doctests (this is on OS X; is it platform dependent?).


---

Comment by dcoudert created at 2019-02-16 09:55:32

There are certainly some differences between plateforms and other factors. For instance, I see this, which is not in the reported worst 15:

```
sage -t --long src/sage/graphs/digraph.py  # 14 doctests failed
```

I had 14 with 8.7.beta1, only 7 with beta2 and beta3, and now 14 again. All these failed doctests are related to the order of items in the output. See #27170.


---

Comment by chapoton created at 2019-02-24 12:02:09

worst 15 in 8.7.b5:

```
['src/sage/numerical/backends/cvxopt_backend.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 9 doctests failed',
 'src/sage/crypto/lwe.py  # 10 doctests failed',
 'src/sage/misc/test_class_pickling.py  # 10 doctests failed',
 'src/sage/numerical/sdp.pyx  # 10 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 11 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/categories/finite_posets.py  # 15 doctests failed',
 'src/sage/graphs/generic_graph.py  # 18 doctests failed',
 'src/sage/matroids/matroid.pyx  # 18 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/misc/explain_pickle.py  # 70 doctests failed']
```



---

Comment by jdemeyer created at 2019-02-28 10:54:05

Is there an easy place where we can find a full log of all Python 3 test failures?


---

Comment by vklein created at 2019-02-28 10:54:57

Yes https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-141-generic/atlas/2019-02-24%2011:31:45.


---

Comment by chapoton created at 2019-03-03 10:43:03

in 8.7.b6:

```
less than 1 : 55
less than 2 : 78
less than 4 : 106
less than 8 : 124
less than 16 : 134
```

and the worst 15 are:

```
['src/sage/libs/eclib/interface.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/libs/ppl.pyx  # 9 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/numerical/backends/cvxopt_backend.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 9 doctests failed',
 'src/sage/crypto/lwe.py  # 10 doctests failed',
 'src/sage/misc/test_class_pickling.py  # 10 doctests failed',
 'src/sage/numerical/sdp.pyx  # 10 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/matroids/matroid.pyx  # 22 doctests failed']
```



---

Comment by jhpalmieri created at 2019-03-10 00:22:06

When the next beta comes out, I think it will merge all of the algebra branches, and then we can move that out of the "in progress" list.


---

Comment by chapoton created at 2019-03-10 09:16:55

on 8.7.b7:

```
less than 1 : 44
less than 2 : 64
less than 4 : 93
less than 8 : 111
less than 16 : 118
```

and the 15 worse are

```
['src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/numerical/backends/cvxopt_backend.pyx  # 8 doctests failed',
 'src/sage/numerical/sdp.pyx  # 8 doctests failed',
 'src/sage/symbolic/expression.pyx  # 8 doctests failed',
 'src/sage/libs/ppl.pyx  # 9 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/crypto/lwe.py  # 10 doctests failed',
 'src/sage/schemes/product_projective/point.py  # 11 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 13 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 18 doctests failed',
 'src/sage/matroids/matroid.pyx  # 18 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed']
```



---

Comment by chapoton created at 2019-03-20 14:51:57

in 8.7.rc0: worst 15 are

```
['src/sage/groups/perm_gps/permgroup.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/numerical/backends/cvxopt_backend.pyx  # 8 doctests failed',
 'src/sage/numerical/sdp.pyx  # 8 doctests failed',
 'src/sage/libs/ppl.pyx  # 9 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 10 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 14 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 18 doctests failed',
 'src/sage/matroids/matroid.pyx  # 18 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed']
```

and there remains

```
less than 1 : 35
less than 2 : 56
less than 4 : 83
less than 8 : 95
less than 16 : 101
less than 64 : 105
less than 128 : 105
less than 256 : 105
```



---

Comment by jhpalmieri created at 2019-03-20 20:28:03

Is there a followup ticket to modify `src/ext/doctest/python3-known-passing.txt`? Should that happen for every beta, or just every actual release? Anyway, we should add `algebras`, `data_structures`, `homology`, `modular`, `modules`, `schemes/curves`, `schemes/product_projective`. What am I missing?


---

Comment by chapoton created at 2019-03-20 20:43:35

yes, this should be done from time to time. If you want to do that, please do! Now would be a good time. Here is my most recent list of good modules:

```
good = ["algebras", "algebras/steenrod", "arith", "coding",
        "calculus", "combinat/designs", "combinat/posets",
        "combinat/species", "combinat/rigged_configurations",
        "combinat/sf", "combinat/words", "databases",
        "data_structures", "docs", "features", "finance", "games",
        "game_theory", "groups/lie_gps", "groups/matrix_gps",
        "homology", "interacts", "knots", "libs/gsl", "lfunctions",
        "logic", "manifolds", "media", "modular/modsym", "modular",
        "modules", "monoids", "parallel", "plot", "probability",
        "quadratic_forms", "quivers", "rings/asymptotic",
        "rings/function_field", "rings/number_field", "sandpiles",
        "sat", "schemes/toric", "schemes/curves",
        "schemes/product_projective", "server", "stats", "structure",
        "tensor", "typeset", 'sage_setup']
```



---

Comment by jhpalmieri created at 2019-03-20 20:52:35

See #27519. I'll post a branch there once I've finished testing.


---

Comment by chapoton created at 2019-03-31 10:18:44

In 8.8.b0:

```
less than 1 : 33
less than 2 : 54
less than 4 : 80
less than 8 : 92
less than 16 : 99
less than 64 : 102
```

and the worst 15 are

```
['src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/groups/perm_gps/permgroup.py  # 7 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/numerical/backends/cvxopt_backend.pyx  # 8 doctests failed',
 'src/sage/numerical/sdp.pyx  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 9 doctests failed',
 'src/sage/graphs/generic_graph.py  # 10 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 13 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 13 doctests failed',
 'src/sage/matroids/matroid.pyx  # 18 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed']
```



---

Comment by chapoton created at 2019-04-08 06:53:54

Little regression after passing to python 3.7.3:

```
less than 1 : 36
less than 2 : 56
less than 4 : 84
less than 8 : 94
less than 16 : 102
less than 64 : 105
```

In the 15 worst files, 178 broken doctests:

```
['src/sage/groups/perm_gps/permgroup.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/numerical/backends/cvxopt_backend.pyx  # 8 doctests failed',
 'src/sage/doctest/sources.py  # 9 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/numerical/sdp.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 9 doctests failed',
 'src/sage/symbolic/constants.py  # 12 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 13 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 14 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 22 doctests failed']
```



---

Comment by chapoton created at 2019-04-15 09:03:47

Some progress in 8.8.b2:

```
less than 1 : 34
less than 2 : 54
less than 4 : 77
less than 8 : 86
less than 16 : 91
less than 64 : 94
```

In the 15 worst files, 163 broken doctests:

```
['src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py  # 5 doctests failed',
 'src/sage/ext/fast_callable.pyx  # 6 doctests failed',
 'src/sage/groups/perm_gps/permgroup.py  # 6 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial.pyx  # 6 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 12 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 13 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 13 doctests failed',
 'src/sage/matroids/matroid.pyx  # 19 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 22 doctests failed']
```



---

Comment by chapoton created at 2019-04-24 06:01:08

on 8.8.b3:

```
less than 1 : 32
less than 2 : 48
less than 4 : 67
less than 8 : 74
less than 16 : 80
less than 64 : 82
```

In the 15 worst files, 153 broken doctests:

```
['src/sage/rings/polynomial/binary_form_reduce.py  # 5 doctests failed',
 'src/sage/ext/fast_callable.pyx  # 6 doctests failed',
 'src/sage/groups/perm_gps/permgroup.py  # 6 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial.pyx  # 6 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 10 doctests failed',
 'src/sage/combinat/finite_state_machine.py  # 11 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 13 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/quiver.py  # 14 doctests failed',
 'src/sage/misc/classcall_metaclass.pyx  # 20 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed']
```



---

Comment by chapoton created at 2019-05-04 17:49:18

In the 15 worst files, 125 broken doctests:

```
['src/sage/combinat/set_partition.py  # 5 doctests failed',
 'src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 5 doctests failed',
 'src/sage/rings/polynomial/binary_form_reduce.py  # 5 doctests failed',
 'src/sage/ext/fast_callable.pyx  # 6 doctests failed',
 'src/sage/groups/perm_gps/permgroup.py  # 6 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial.pyx  # 6 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 7 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/libs/ntl/ntl_ZZ_pX.pyx  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/rings/qqbar.py  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 12 doctests failed',
 'src/sage/matroids/matroid.pyx  # 23 doctests failed']
```

One can note a large regression in qqbar, and that matroids still get worse too.


---

Comment by jhpalmieri created at 2019-05-05 03:14:04

Regarding `matroids`: there is some piece of underlying data which is intrinsically unordered, and it is causing all sorts of failures. I don't know if it's best to mark them all `# py3 random` or to sort the data so this doesn't happen. Is there an active Sage developer who knows enough about matroids to help make this decision?


---

Comment by chapoton created at 2019-05-11 16:59:38

With 8.8.b5:

```
less than 1 : 22
less than 2 : 30
less than 4 : 48
less than 8 : 52
less than 16 : 55
less than 64 : 56
```

In the 15 worst files, 102 broken doctests:

```
['src/sage/combinat/root_system/integrable_representations.py  # 4 doctests failed',
 'src/sage/combinat/set_partition.py  # 4 doctests failed',
 'src/sage/doctest/test.py  # 4 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 4 doctests failed',
 'src/sage/misc/functional.py  # 4 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/rings/polynomial/toy_buchberger.py  # 4 doctests failed',
 'src/sage/groups/perm_gps/permgroup.py  # 6 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 7 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/symbolic/expression.pyx  # 10 doctests failed',
 'src/sage/matroids/matroid.pyx  # 18 doctests failed']
```



---

Comment by dcoudert created at 2019-05-11 17:18:38

#27773 and #27774 fix various issues in Python 3 with `src/sage/numerical/backends/cplex_backend.pyx` and 1 in `gurobi_backend.pyx`.  Cplex <= 12.8 is needed to test these tickets. Cplex >= 12.9 cannot be used yet (see #27790).


---

Comment by etn40ff created at 2019-05-21 00:00:48

#27854 deals with the rest of `cluster_algebra_seed` apart from one doctest that fails intermittently.


---

Comment by chapoton created at 2019-05-24 13:48:37

In sage 8.8.b6, some progress:

```
less than 1 : 20
less than 2 : 27
less than 4 : 42
less than 8 : 46
less than 16 : 48
less than 64 : 49
```

In the 15 worst files, 96 broken doctests:

```
['src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 3 doctests failed',
 'src/sage/misc/sageinspect.py  # 3 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 3 doctests failed',
 'src/sage/rings/valuation/inductive_valuation.py  # 3 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 4 doctests failed',
 'src/sage/misc/functional.py  # 4 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/rings/polynomial/toy_buchberger.py  # 4 doctests failed',
 'src/sage/combinat/cluster_algebra_quiver/cluster_seed.py  # 7 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/symbolic/expression.pyx  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed']
```



---

Comment by chapoton created at 2019-05-29 05:36:50

moved matroids to the "work in progress section"


---

Comment by @mwageringel created at 2019-05-29 08:16:06

If no one is working on it yet, I will look into `multi_polynomial_ideal` and `toy_buchberger`.


---

Comment by jhpalmieri created at 2019-05-29 17:08:28

Replying to [comment:323 chapoton]:
> moved matroids to the "work in progress section"

Oops. Thank you for fixing that.


---

Comment by jhpalmieri created at 2019-05-29 21:12:13

Replying to [comment:324 gh-mwageringel]:
> If no one is working on it yet, I will look into `multi_polynomial_ideal` and `toy_buchberger`.

Sure, but make sure to check #27791: closed but not yet merged into a beta release.

Edit: oh, sorry, that deals with multi_polynomial, and you were talking about multi_polynomial_ideal. I don't see any relevant tickets, so please go ahead.


---

Comment by chapoton created at 2019-05-31 09:28:28

in 8.8.b7:

```
less than 1 : 18
less than 2 : 25
less than 4 : 38
less than 8 : 41
less than 16 : 43
less than 64 : 44
```

In the 15 worst files, 92 broken doctests:

```
['src/sage/combinat/root_system/weyl_characters.py  # 3 doctests failed',
 'src/sage/combinat/set_partition_ordered.py  # 3 doctests failed',
 'src/sage/doctest/test.py  # 3 doctests failed',
 'src/sage/misc/sageinspect.py  # 3 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 3 doctests failed',
 'src/sage/rings/polynomial/toy_buchberger.py  # 3 doctests failed',
 'src/sage/matroids/graphic_matroid.py  # 4 doctests failed',
 'src/sage/misc/functional.py  # 4 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/symbolic/expression.pyx  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed',
 'src/sage/matroids/matroid.pyx  # 21 doctests failed']
```



---

Comment by chapoton created at 2019-06-09 17:01:48

in 8.8.rc0:

```
less than 1 : 12
less than 2 : 16
less than 4 : 28
less than 8 : 30
less than 16 : 32
```

In the 15 worst files, 69 broken doctests:

```
['src/sage/combinat/crystals/kirillov_reshetikhin.py  # 3 doctests failed',
 'src/sage/combinat/perfect_matching.py  # 3 doctests failed',
 'src/sage/combinat/root_system/root_lattice_realizations.py  # 3 doctests failed',
 'src/sage/combinat/root_system/weyl_characters.py  # 3 doctests failed',
 'src/sage/doctest/test.py  # 3 doctests failed',
 'src/sage/misc/sageinspect.py  # 3 doctests failed',
 'src/sage/rings/polynomial/multi_polynomial_ideal.py  # 3 doctests failed',
 'src/sage/symbolic/expression.pyx  # 3 doctests failed',
 'src/sage/misc/functional.py  # 4 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/rings/polynomial/toy_buchberger.py  # 4 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed']
```



---

Comment by chapoton created at 2019-06-12 07:52:16

**EDIT** wrong ticket


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by chapoton created at 2019-07-03 09:57:05

In 8.9.beta0:

```
less than 1 : 9
less than 2 : 12
less than 4 : 17
less than 8 : 20
less than 16 : 22
```

In the 15 worst files, 64 broken doctests:

```
['src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/combinat/finite_state_machine.py  # 2 doctests failed',
 'src/sage/doctest/test.py  # 2 doctests failed',
 'src/sage/numerical/backends/generic_backend.pyx  # 2 doctests failed',
 'src/sage/combinat/perfect_matching.py  # 3 doctests failed',
 'src/sage/combinat/root_system/root_lattice_realizations.py  # 3 doctests failed',
 'src/sage/combinat/root_system/weyl_characters.py  # 3 doctests failed',
 'src/sage/misc/functional.py  # 4 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/symbolic/expression.pyx  # 6 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed']
```


There is an unexpected failure in 8.9.beta0 in the schemes folder :

```
sage -t --long src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py  # 1 doctest failed on line 780
```



---

Comment by chapoton created at 2019-07-10 09:25:50

For 8.9.b2: In the 15 worst files, 55 broken doctests:

```
['src/sage/libs/singular/function.pyx  # 1 doctest failed',
 'src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py  # 1 doctest failed',
 'src/sage/symbolic/expression.pyx  # 1 doctest failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/doctest/test.py  # 2 doctests failed',
 'src/sage/numerical/backends/generic_backend.pyx  # 2 doctests failed',
 'src/sage/combinat/perfect_matching.py  # 3 doctests failed',
 'src/sage/combinat/root_system/root_lattice_realizations.py  # 3 doctests failed',
 'src/sage/combinat/root_system/weyl_characters.py  # 3 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/graphs/generic_graph.py  # 8 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed',
 'src/sage/rings/integer.pyx  # 9 doctests failed']
```



---

Comment by chapoton created at 2019-07-10 09:36:50

apparently, new regression here:

```
sage -t --long src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx  # 1 doctest failed
```



---

Comment by jhpalmieri created at 2019-07-20 23:57:00

Can anyone provide any more information on the "fragile" doctests? In repeated runs, I get no failures (on OS X) with

```
./sage -tp --long src/sage/repl src/sage/numerical/ src/sage/libs
```

For the doctest failures in `french_book`, it is not clear to me what sort of changes are allowed, since the book is now in press. Should the failing tests just be marked as `# py2` until the authors present a better solution?


---

Comment by @mwageringel created at 2019-07-21 05:30:40

The failures can be seen in the logs of the Python 3 patchbot: https://patchbot.sagemath.org/ticket/0/. Without being able to reproduce these, they still seem pretty difficult to solve though.


---

Comment by chapoton created at 2019-07-29 09:10:56

status on 8.9.beta4: remains 12 files with a total of 33 failing doctests:

```
'src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py  # 1 doctest failed',
 'src/sage/libs/singular/function.pyx  # 1 doctest failed',
 'src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py  # 1 doctest failed',
 'src/sage/symbolic/expression.pyx  # 1 doctest failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/tests/books/computational-mathematics-with-sagemath/sol/graphtheory_doctest.py  # 1 doctest failed',
 'src/sage/doctest/test.py  # 2 doctests failed',
 'src/sage/numerical/backends/generic_backend.pyx  # 2 doctests failed',
 'src/sage/combinat/root_system/weyl_characters.py  # 3 doctests failed',
 'src/sage/repl/attach.py  # 4 doctests failed',
 'src/sage/combinat/root_system/weyl_group.py  # 7 doctests failed',
 'src/sage/misc/nested_class.pyx  # 9 doctests failed'
```



---

Comment by dcoudert created at 2019-07-29 11:10:32

Yes, the 8 last failing doctests in `generic_graph.py` have been fixed with #27232. So, all doctests in the standard graphs module are now fixed !!!

We still have some failing doctests in optional packages like `plantri` #28108. I have now yet checked all other optional packages. Do we have a meta-ticket to record them ?


---

Comment by jhpalmieri created at 2019-07-29 17:37:33

Is this a new one? All tests in `schemes` are supposed to pass.

```
'src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py  # 1 doctest failed'
```



---

Comment by chapoton created at 2019-07-29 19:03:27

I think I have seen that already in previous betas, maybe since 8.9.beta3 or before.

EDIT: it was already there in 8.9.b0 (see above)


---

Comment by jhpalmieri created at 2019-07-29 22:38:08

Is there a ticket for it? What's the error? (I don't see it on my OS X machines.)


---

Comment by vklein created at 2019-07-30 07:27:29

I don't have it either on ubuntu 16.04.


---

Comment by chapoton created at 2019-07-30 07:54:42

There is no ticket for this error in schemes. The exact error can be seen in the patchbot log:

```
https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-148-generic/atlas/2019-07-29%2008:49:23?short
```


This patchtbot is running on an ubuntu 16.04, using gcc 8.3.0.

Maybe we should start a new ticket for the final polishing ? This one is very long already.


---

Comment by jhpalmieri created at 2019-07-30 15:59:27

Replying to [comment:399 chapoton]:
> Maybe we should start a new ticket for the final polishing ? This one is very long already.

Good idea. It's great seeing the progress!


---

Comment by chapoton created at 2019-07-31 07:59:20

I have created #28298 for the few remaining final steps.


---

Comment by chapoton created at 2019-08-04 09:50:27

**LARGE SCALE REGRESSION** in 8.9.b5, with 241 failing doctests !!!!

EDIT: This could have been caused by a wrong version of gcc being used. Will retry.


---

Comment by jhpalmieri created at 2019-08-04 15:51:45

Replying to [comment:402 chapoton]:
> **LARGE SCALE REGRESSION** in 8.9.b5, with 241 failing doctests !!!!
> 
> EDIT: This could have been caused by a wrong version of gcc being used. Will retry.
> 

For what it's worth, on OS X I only see one new failure, due to #28225, a proposed fix at #28320.


---

Comment by chapoton created at 2019-08-04 17:53:02

Replying to [comment:402 chapoton]:
> **LARGE SCALE REGRESSION** in 8.9.b5, with 241 failing doctests !!!!
> 
> EDIT: This could have been caused by a wrong version of gcc being used. Will retry.


This was a false alert, due to a wrong gcc. There are 18 failing doctests.


---

Comment by chapoton created at 2020-01-01 11:14:50

Resolution: worksforme
