# Issue 17789: Parent breakage because not every SageObject is idempotent

archive/issues_017789.json:
```json
{
    "body": "CC:  jdemeyer nthiery vdelecroix\n\nEvery SageObject has a parent by #10962, possibly its own type. But that doesn't mean that `P(P(x))` returns `P(x)`, or even succeeds:\n\n```\nsage: Sequence([plot(sin)])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-b6d3f68cd8b4> in <module>()\n----> 1 Sequence([plot(sin)])\n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/sequence.pyc in Sequence(x, universe, check, immutable, cr, cr_str, use_sage_types)\n    293         return PolynomialSequence(x, universe, immutable=immutable, cr=cr, cr_str=cr_str)\n    294     else:\n--> 295         return Sequence_generic(x, universe, check, immutable, cr, cr_str, use_sage_types)\n    296 \n    297 \n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/sequence.pyc in __init__(self, x, universe, check, immutable, cr, cr_str, use_sage_types)\n    498         self.__universe = universe\n    499         if check:\n--> 500             x = [universe(t) for t in x]\n    501         list.__init__(self, x)\n    502         self._is_immutable = immutable\n\nTypeError: __init__() takes exactly 1 argument (2 given)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18026\n\n",
    "created_at": "2015-03-21T11:14:31Z",
    "labels": [
        "pickling",
        "major",
        "bug"
    ],
    "title": "Parent breakage because not every SageObject is idempotent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17789",
    "user": "vbraun"
}
```
CC:  jdemeyer nthiery vdelecroix

Every SageObject has a parent by #10962, possibly its own type. But that doesn't mean that `P(P(x))` returns `P(x)`, or even succeeds:

```
sage: Sequence([plot(sin)])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-b6d3f68cd8b4> in <module>()
----> 1 Sequence([plot(sin)])

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/sequence.pyc in Sequence(x, universe, check, immutable, cr, cr_str, use_sage_types)
    293         return PolynomialSequence(x, universe, immutable=immutable, cr=cr, cr_str=cr_str)
    294     else:
--> 295         return Sequence_generic(x, universe, check, immutable, cr, cr_str, use_sage_types)
    296 
    297 

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/sequence.pyc in __init__(self, x, universe, check, immutable, cr, cr_str, use_sage_types)
    498         self.__universe = universe
    499         if check:
--> 500             x = [universe(t) for t in x]
    501         list.__init__(self, x)
    502         self._is_immutable = immutable

TypeError: __init__() takes exactly 1 argument (2 given)
```


Issue created by migration from https://trac.sagemath.org/ticket/18026





---

archive/issue_comments_238357.json:
```json
{
    "body": "And what is the exact issue? Should we force `P(P(x))` to work as soon as `P(x)` does? Could be part of the `TestSuite`...",
    "created_at": "2015-03-21T11:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238357",
    "user": "vdelecroix"
}
```

And what is the exact issue? Should we force `P(P(x))` to work as soon as `P(x)` does? Could be part of the `TestSuite`...



---

archive/issue_comments_238358.json:
```json
{
    "body": "I'm leaning towards not making `parent` a method of `SageObject`. Move it to `Element`. Not everything fits into the parent/element scheme. Parents probably don't need a parent class either:\n\n```\nsage: ZZ.parent()\n<type 'sage.rings.integer_ring.IntegerRing_class'>\n```\n",
    "created_at": "2015-03-21T12:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238358",
    "user": "vbraun"
}
```

I'm leaning towards not making `parent` a method of `SageObject`. Move it to `Element`. Not everything fits into the parent/element scheme. Parents probably don't need a parent class either:

```
sage: ZZ.parent()
<type 'sage.rings.integer_ring.IntegerRing_class'>
```




---

archive/issue_comments_238359.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> I'm leaning towards not making `parent` a method of `SageObject`. Move it to `Element`. Not everything fits into the parent/element scheme. Parents probably don't need a parent class either:\n> {{{\n> sage: ZZ.parent()\n> <type 'sage.rings.integer_ring.IntegerRing_class'>\n> }}}\n\nThe main reason for the introduction of the `.parent()` method was because of `MaximaWrapper` which does not inherit from `Element`. But whatever we do with this method, it is what the function `parent` is doing\n\n```\nsage: parent(4r)\n<type 'int'>\nsage: parent(int)\n<type 'type'>\n```\n\n\nAnd I would not call it a \"parent class\" since it is the class of the object itself that is considered as a parent. Which makes sense.\n\nBy the way, the example you wrote in the description of the ticket used to work in previous versions of Sage?",
    "created_at": "2015-03-21T12:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238359",
    "user": "vdelecroix"
}
```

Replying to [comment:2 vbraun]:
> I'm leaning towards not making `parent` a method of `SageObject`. Move it to `Element`. Not everything fits into the parent/element scheme. Parents probably don't need a parent class either:
> {{{
> sage: ZZ.parent()
> <type 'sage.rings.integer_ring.IntegerRing_class'>
> }}}

The main reason for the introduction of the `.parent()` method was because of `MaximaWrapper` which does not inherit from `Element`. But whatever we do with this method, it is what the function `parent` is doing

```
sage: parent(4r)
<type 'int'>
sage: parent(int)
<type 'type'>
```


And I would not call it a "parent class" since it is the class of the object itself that is considered as a parent. Which makes sense.

By the way, the example you wrote in the description of the ticket used to work in previous versions of Sage?



---

archive/issue_comments_238360.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> And I would not call it a \"parent class\" since it is the class of the object itself that is considered as a parent. Which makes sense.\n\nNo. Parent calls are idempontent, type calls are not.",
    "created_at": "2015-03-21T12:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238360",
    "user": "vbraun"
}
```

Replying to [comment:3 vdelecroix]:
> And I would not call it a "parent class" since it is the class of the object itself that is considered as a parent. Which makes sense.

No. Parent calls are idempontent, type calls are not.



---

archive/issue_comments_238361.json:
```json
{
    "body": "Honestly, I also don't understand the issue. So what if `P(P(x))` doesn't work?",
    "created_at": "2015-03-21T13:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238361",
    "user": "jdemeyer"
}
```

Honestly, I also don't understand the issue. So what if `P(P(x))` doesn't work?



---

archive/issue_comments_238362.json:
```json
{
    "body": "IMHO that is one of the implicit promises of the parent/element pattern: Cast to the current parent gives you the same element `e.parent()(e) == e`. E.g. the definition of `e in e.parent()` is along those lines. If you violate that then you'll run into places where that assumption was implicitly made, for example `Sequence()`.",
    "created_at": "2015-03-21T13:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238362",
    "user": "vbraun"
}
```

IMHO that is one of the implicit promises of the parent/element pattern: Cast to the current parent gives you the same element `e.parent()(e) == e`. E.g. the definition of `e in e.parent()` is along those lines. If you violate that then you'll run into places where that assumption was implicitly made, for example `Sequence()`.



---

archive/issue_comments_238363.json:
```json
{
    "body": "However not every `SageObject` is a parent. For sequences, we have #15852 (which is on my todo list to finish reviewing!), but do we have other `SageObject`'s that should be elements of some parent?",
    "created_at": "2015-03-21T15:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238363",
    "user": "tscrim"
}
```

However not every `SageObject` is a parent. For sequences, we have #15852 (which is on my todo list to finish reviewing!), but do we have other `SageObject`'s that should be elements of some parent?



---

archive/issue_comments_238364.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> IMHO that is one of the implicit promises of the parent/element pattern\nIf you care about `Element`s, then `isinstance(foo, Element)` is your friend...\n\nYou are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.",
    "created_at": "2015-03-21T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238364",
    "user": "jdemeyer"
}
```

Replying to [comment:6 vbraun]:
> IMHO that is one of the implicit promises of the parent/element pattern
If you care about `Element`s, then `isinstance(foo, Element)` is your friend...

You are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.



---

archive/issue_comments_238365.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> You are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.\n\nIf it walks like a duck and talks like a duck then it must be a duck.",
    "created_at": "2015-03-21T15:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238365",
    "user": "vbraun"
}
```

Replying to [comment:8 jdemeyer]:
> You are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.

If it walks like a duck and talks like a duck then it must be a duck.



---

archive/issue_comments_238366.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> Replying to [comment:8 jdemeyer]:\n> > You are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.\n> \n> If it walks like a duck and talks like a duck then it must be a duck.\n\nThe issue to me is that `SageObject` walks and talks pretty close to a duck, but it is just a hunter with a toy duck trying to lure you in. I agree with Volker in comment:2 that we should strip `parent` out of `SageObject`. Also the `TestSuite` checks currently for idempotent-ness (but IDK if that needs to be a subclass of `Parent`).\n\nWhile we are at it, could we also do some of the others like `base_ring` and `n`?",
    "created_at": "2015-03-21T15:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17789#issuecomment-238366",
    "user": "tscrim"
}
```

Replying to [comment:9 vbraun]:
> Replying to [comment:8 jdemeyer]:
> > You are making the mistake that everything which has a `parent()` method is an `Element` of some `Parent`.
> 
> If it walks like a duck and talks like a duck then it must be a duck.

The issue to me is that `SageObject` walks and talks pretty close to a duck, but it is just a hunter with a toy duck trying to lure you in. I agree with Volker in comment:2 that we should strip `parent` out of `SageObject`. Also the `TestSuite` checks currently for idempotent-ness (but IDK if that needs to be a subclass of `Parent`).

While we are at it, could we also do some of the others like `base_ring` and `n`?
