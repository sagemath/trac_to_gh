# Issue 30588: Parallel docbuild failure from ecl/maxima

Issue created by migration from https://trac.sagemath.org/ticket/30825

Original creator: vbraun

Original creation time: 2020-10-25 13:23:13

Maxima can die with an EEXISTS when creating $DOT_SAGE/maxima:

```
[dochtml] [manifolds] /var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/chart.py:docstring of sage.manifolds.chart.RealChart.plot:104: WARNING: Exception occurred in plotting chart-1
[dochtml] [manifolds]  from /var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/src/doc/en/reference/manifolds/sage/manifolds/chart.rst:
[dochtml] [manifolds] Traceback (most recent call last):
[dochtml] [manifolds]   File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5975)
[dochtml] [manifolds]     return self.cache[k]
[dochtml] [manifolds]   File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3737)
[dochtml] [manifolds]     raise KeyError(k)
[dochtml] [manifolds] KeyError: ((<class 'sage.manifolds.chart.RealChart'>, 2-dimensional topological manifold R^2), (('calc_method', 'SR'), ('coordinates', 'x y'), ('names', None)))
[dochtml] [manifolds] During handling of the above exception, another exception occurred:
[dochtml] [manifolds] Traceback (most recent call last):
[dochtml] [manifolds]   File "sage/symbolic/ring.pyx", line 1149, in sage.symbolic.ring.send_sage_domain_to_maxima (build/cythonized/sage/symbolic/ring.cpp:12070)
[dochtml] [manifolds]     assume(v, 'real')
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/symbolic/assumptions.py", line 663, in assume
[dochtml] [manifolds]     x.assume()
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/symbolic/assumptions.py", line 236, in assume
[dochtml] [manifolds]     self._validate_feature()
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/symbolic/assumptions.py", line 206, in _validate_feature
[dochtml] [manifolds]     _valid_feature_strings.update(repr(x).strip() for x in list(maxima("features")))
[dochtml] [manifolds]   File "sage/misc/lazy_import.pyx", line 361, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4025)
[dochtml] [manifolds]     return self.get_object()(*args, **kwds)
[dochtml] [manifolds]   File "sage/misc/lazy_import.pyx", line 191, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2436)
[dochtml] [manifolds]     return self._get_object()
[dochtml] [manifolds]   File "sage/misc/lazy_import.pyx", line 224, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2705)
[dochtml] [manifolds]     self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/interfaces/maxima_lib.py", line 112, in <module>
[dochtml] [manifolds]     ecl_eval("(set-pathnames)")
[dochtml] [manifolds]   File "sage/libs/ecl.pyx", line 1372, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:11009)
[dochtml] [manifolds]     cpdef EclObject ecl_eval(str s):
[dochtml] [manifolds]   File "sage/libs/ecl.pyx", line 1395, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:10942)
[dochtml] [manifolds]     o=ecl_safe_eval(python_to_ecl(s, True))
[dochtml] [manifolds]   File "sage/libs/ecl.pyx", line 339, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:5574)
[dochtml] [manifolds]     raise RuntimeError("ECL says: {}".format(
[dochtml] [manifolds] RuntimeError: ECL says: Could not create directory "/var/lib/buildbot/slave/binary_pkg/dot_sage/maxima"
[dochtml] [manifolds] C library error: "File exists"
[dochtml] [manifolds] The above exception was the direct cause of the following exception:
[dochtml] [manifolds] Traceback (most recent call last):
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/matplotlib/sphinxext/plot_directive.py", line 472, in run_code
[dochtml] [manifolds]     exec(code, ns)
[dochtml] [manifolds]   File "<string>", line 2, in <module>
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/manifold.py", line 1540, in chart
[dochtml] [manifolds]     return self._structure.chart(self, coordinates=coordinates,
[dochtml] [manifolds]   File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1762)
[dochtml] [manifolds]     return cls.classcall(cls, *args, **kwds)
[dochtml] [manifolds]   File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6101)
[dochtml] [manifolds]     w = self.f(*args, **kwds)
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/structure/unique_representation.py", line 1008, in __classcall__
[dochtml] [manifolds]     instance = typecall(cls, *args, **options)
[dochtml] [manifolds]   File "sage/misc/classcall_metaclass.pyx", line 486, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2224)
[dochtml] [manifolds]     return (<PyTypeObject*>type).tp_call(cls, args, kwds)
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/chart.py", line 1606, in __init__
[dochtml] [manifolds]     Chart.__init__(self, domain, coordinates=coordinates, names=names,
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/chart.py", line 310, in __init__
[dochtml] [manifolds]     self._init_coordinates(coord_list)
[dochtml] [manifolds]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/chart.py", line 1684, in _init_coordinates
[dochtml] [manifolds]     coord_var = SR.var(coord_symb, domain='real',
[dochtml] [manifolds] SystemError: <built-in method var of sage.symbolic.ring.SymbolicRing object at 0xcc9baf28> returned a result with an error set
[dochtml] [manifolds] The inventory files are in local/share/doc/sage/inventory/en/reference/manifolds.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/runpy.py", line 194, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/runpy.py", line 87, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 1729, in main
[dochtml]     builder()
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 344, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 570, in _wrapper
[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 556, in _build_everything_except_bibliography
[dochtml]     build_many(build_ref_doc, non_references)
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 296, in build_many
[dochtml]     _build_many(target, args, processes=NUM_THREADS)
[dochtml]   File "/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage_setup/docbuild/utils.py", line 289, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml] OSError: /var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/local/lib/python3.8/site-packages/sage/manifolds/chart.py:docstring of sage.manifolds.chart.RealChart.plot:104: WARNING: Exception occurred in plotting chart-1
make[6]: *** [Makefile:1876: doc-html] Error 1
make[6]: Target 'doc' not remade because of errors.
make[5]: *** [Makefile:1766: all-start] Error 2
make[5]: Leaving directory '/var/lib/buildbot/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391y/build/make'
```



---

Comment by mkoeppe created at 2021-04-07 19:29:15

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.
