# Issue 24682: prototype generic mechanism for system package checks at configure time

archive/issues_024682.json:
```json
{
    "body": "CC:  @mezzarobba @dimpase\n\nHere's a look at the work I've been doing on top of (albeit not completely dependent on) #21524 in order to better support use of system packages for any of Sage's SPKGs.\n\nThis takes the workarounds that are already hard-coded in Sage's `configure.ac` for detecting certain packages--notably gcc/gfortran, yasm, git, and and curl--and converts those to a more generic mechanism.\n\nIn the new mechanism each SPKG may have a file in its SPKG directory named `spkg-configure.m4`.  The `./bootstrap` script gathers these all up and includes them into `configure`.\n\nEach `spkg-configure.m4` should call a macro called `SAGE_SPKG_CONFIGURE` which is passed the package name, and some configure-time checks it should perform for that package.  See the documentation in `spkg-configure.m4` for more details on that macro.  Inside these checks, they should set either `sage_spkg_install_<pkgname>=yes|no` in order to track whether or not Sage should install that package, or if we can just the version from the system (or we don't require the package at all for the current platform).\n\nWe then move the hard-coded bits for yasm, gcc, etc. out of `configure.ac` and into their individual `spkg-configure.m4` files.  The end result is the same in terms of the checks that are performed.\n\nAs proof of concept we also add a configure-time check for the system's `patch`, demonstrating how this might be used to enable support for more system packages.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24919\n\n",
    "created_at": "2018-03-06T15:46:35Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "prototype generic mechanism for system package checks at configure time",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24682",
    "user": "@embray"
}
```
CC:  @mezzarobba @dimpase

Here's a look at the work I've been doing on top of (albeit not completely dependent on) #21524 in order to better support use of system packages for any of Sage's SPKGs.

This takes the workarounds that are already hard-coded in Sage's `configure.ac` for detecting certain packages--notably gcc/gfortran, yasm, git, and and curl--and converts those to a more generic mechanism.

In the new mechanism each SPKG may have a file in its SPKG directory named `spkg-configure.m4`.  The `./bootstrap` script gathers these all up and includes them into `configure`.

Each `spkg-configure.m4` should call a macro called `SAGE_SPKG_CONFIGURE` which is passed the package name, and some configure-time checks it should perform for that package.  See the documentation in `spkg-configure.m4` for more details on that macro.  Inside these checks, they should set either `sage_spkg_install_<pkgname>=yes|no` in order to track whether or not Sage should install that package, or if we can just the version from the system (or we don't require the package at all for the current platform).

We then move the hard-coded bits for yasm, gcc, etc. out of `configure.ac` and into their individual `spkg-configure.m4` files.  The end result is the same in terms of the checks that are performed.

As proof of concept we also add a configure-time check for the system's `patch`, demonstrating how this might be used to enable support for more system packages.

Issue created by migration from https://trac.sagemath.org/ticket/24919





---

archive/issue_comments_346255.json:
```json
{
    "body": "It should be noted that, of course, each time a package's `spkg-configure.m4` is added or modified we must re-run `./bootstrap`, same as if we were just modifying `configure.ac` directly.",
    "created_at": "2018-03-06T15:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346255",
    "user": "@embray"
}
```

It should be noted that, of course, each time a package's `spkg-configure.m4` is added or modified we must re-run `./bootstrap`, same as if we were just modifying `configure.ac` directly.



---

archive/issue_comments_346256.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-06T15:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346256",
    "user": "@embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346257.json:
```json
{
    "body": "One other aspect of this that probably needs work before it's ready, is to add flags for explicitly selecting whether or not to use the system's version of some package.\n\nI would definitely prefer to *not* install SPKGs by default we don't have to.  But we could also add a global flag like \"always use SPKGs regardless of configure checks\" or something.",
    "created_at": "2018-03-06T15:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346257",
    "user": "@embray"
}
```

One other aspect of this that probably needs work before it's ready, is to add flags for explicitly selecting whether or not to use the system's version of some package.

I would definitely prefer to *not* install SPKGs by default we don't have to.  But we could also add a global flag like "always use SPKGs regardless of configure checks" or something.



---

archive/issue_comments_346258.json:
```json
{
    "body": "Replying to [comment:3 embray]:\n> I would definitely prefer to *not* install SPKGs by default we don't have to.\n\nI agree. That's also the current behaviour for gcc, git, ...",
    "created_at": "2018-03-19T11:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346258",
    "user": "@jdemeyer"
}
```

Replying to [comment:3 embray]:
> I would definitely prefer to *not* install SPKGs by default we don't have to.

I agree. That's also the current behaviour for gcc, git, ...



---

archive/issue_comments_346259.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Replying to [comment:3 embray]:\n> > I would definitely prefer to *not* install SPKGs by default we don't have to.\n> \n> I agree. That's also the current behaviour for gcc, git, ...\n\nIndeed.  I don't know if anyone would have a problem with this or not.  I think most people would consider it an enhancement if Sage installed fewer dependencies by default :)  I guess it mostly comes down to how reliable the system versions of those dependencies are and how well they integrate with Sage.\n\nI'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.",
    "created_at": "2018-03-19T11:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346259",
    "user": "@embray"
}
```

Replying to [comment:4 jdemeyer]:
> Replying to [comment:3 embray]:
> > I would definitely prefer to *not* install SPKGs by default we don't have to.
> 
> I agree. That's also the current behaviour for gcc, git, ...

Indeed.  I don't know if anyone would have a problem with this or not.  I think most people would consider it an enhancement if Sage installed fewer dependencies by default :)  I guess it mostly comes down to how reliable the system versions of those dependencies are and how well they integrate with Sage.

I'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.



---

archive/issue_comments_346260.json:
```json
{
    "body": "Replying to [comment:5 embray]:\n> I'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.\n\nSage can use both MPIR and GMP. Of course, you'll need to check whether the MPIR/GMP version is sufficiently recent.",
    "created_at": "2018-03-19T12:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346260",
    "user": "@jdemeyer"
}
```

Replying to [comment:5 embray]:
> I'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.

Sage can use both MPIR and GMP. Of course, you'll need to check whether the MPIR/GMP version is sufficiently recent.



---

archive/issue_comments_346261.json:
```json
{
    "body": "The branch doesn't merge.",
    "created_at": "2018-03-19T18:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346261",
    "user": "@jdemeyer"
}
```

The branch doesn't merge.



---

archive/issue_comments_346262.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-19T18:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346262",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346263.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:5 embray]:\n> > I'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.\n> \n> Sage can use both MPIR and GMP. Of course, you'll need to check whether the MPIR/GMP version is sufficiently recent.\n\nI know. I think my concern here was just that Sage builds MPIR with its `--enable-gmpcompat` flag.  So if some system has both GMP and MPIR installed side-by-side, Sage can only use the GMP on that system.  And if some system has only MPIR and not GMP somehow, then it won't work because we use `<include gmp.h>`, etc.  I'm not sure if that's really a problem though so maybe it's premature to worry about.",
    "created_at": "2018-03-20T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346263",
    "user": "@embray"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:5 embray]:
> > I'm concerned about using GMP/MPIR from the system--not because it wouldn't work, but because of how Sage currently installs MPIR as a synonym for GMP.  Many platforms don't have an MPIR package in the first place, so I guess they would just use GMP.  I'm not sure how best to handle that one.
> 
> Sage can use both MPIR and GMP. Of course, you'll need to check whether the MPIR/GMP version is sufficiently recent.

I know. I think my concern here was just that Sage builds MPIR with its `--enable-gmpcompat` flag.  So if some system has both GMP and MPIR installed side-by-side, Sage can only use the GMP on that system.  And if some system has only MPIR and not GMP somehow, then it won't work because we use `<include gmp.h>`, etc.  I'm not sure if that's really a problem though so maybe it's premature to worry about.



---

archive/issue_comments_346264.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> The branch doesn't merge.\n\nI know--at the very least #24907 conflicted with this, which is why I'd like to come up with a different solution to that issue that is more compatible.",
    "created_at": "2018-03-20T11:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346264",
    "user": "@embray"
}
```

Replying to [comment:7 jdemeyer]:
> The branch doesn't merge.

I know--at the very least #24907 conflicted with this, which is why I'd like to come up with a different solution to that issue that is more compatible.



---

archive/issue_comments_346265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-04-18T10:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346266.json:
```json
{
    "body": "Rebased, but I think some other cleanup of configure.ac is now needed as a prerequisite (e.g. #25011).",
    "created_at": "2018-04-18T10:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346266",
    "user": "@embray"
}
```

Rebased, but I think some other cleanup of configure.ac is now needed as a prerequisite (e.g. #25011).



---

archive/issue_comments_346267.json:
```json
{
    "body": "By the way, I have `curl` headers installed in `/usr/local/include/curl/curl.h`, and \ntheir recognition is broken, even if I set CFLAGS to have `-I/usr/local/include` and try to pass them to `./configure`.",
    "created_at": "2018-04-18T11:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346267",
    "user": "@dimpase"
}
```

By the way, I have `curl` headers installed in `/usr/local/include/curl/curl.h`, and 
their recognition is broken, even if I set CFLAGS to have `-I/usr/local/include` and try to pass them to `./configure`.



---

archive/issue_comments_346268.json:
```json
{
    "body": "Replying to [comment:14 dimpase]:\n> By the way, I have `curl` headers installed in `/usr/local/include/curl/curl.h`, and \n> their recognition is broken, even if I set CFLAGS to have `-I/usr/local/include` and try to pass them to `./configure`.\n\nDima, does that work without this ticket, or did this break it somehow?\n\nThe way this ticket does the feature test for curl is not substantively different from how it was done previously--it's just been moved to a different file.  But if it did work before then I'm sure there is a real bug.  Note, the correct `curl-config` also needs to be on the PATH, and needs to support `curl-config --checkfor 7.22`.",
    "created_at": "2018-04-18T14:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346268",
    "user": "@embray"
}
```

Replying to [comment:14 dimpase]:
> By the way, I have `curl` headers installed in `/usr/local/include/curl/curl.h`, and 
> their recognition is broken, even if I set CFLAGS to have `-I/usr/local/include` and try to pass them to `./configure`.

Dima, does that work without this ticket, or did this break it somehow?

The way this ticket does the feature test for curl is not substantively different from how it was done previously--it's just been moved to a different file.  But if it did work before then I'm sure there is a real bug.  Note, the correct `curl-config` also needs to be on the PATH, and needs to support `curl-config --checkfor 7.22`.



---

archive/issue_comments_346269.json:
```json
{
    "body": "It didn't work before either, I think, but in fact `curl-config` is on the PATH,\nand even tells you about the compiler flags:\n\n```\n$ curl-config --cflags\n-I/usr/local/include\n```\n\nand the version seems good too:\n\n```\n$ curl-config --checkfor 7.22\n$ curl-config --checkfor 999\nrequested version 999 is newer than existing 7.59.0\n$ curl-config --version      \nlibcurl 7.59.0\n```\n",
    "created_at": "2018-04-18T15:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346269",
    "user": "@dimpase"
}
```

It didn't work before either, I think, but in fact `curl-config` is on the PATH,
and even tells you about the compiler flags:

```
$ curl-config --cflags
-I/usr/local/include
```

and the version seems good too:

```
$ curl-config --checkfor 7.22
$ curl-config --checkfor 999
requested version 999 is newer than existing 7.59.0
$ curl-config --version      
libcurl 7.59.0
```




---

archive/issue_comments_346270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-04-18T15:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346270",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346271.json:
```json
{
    "body": "Replying to [comment:16 dimpase]:\n> It didn't work before either, I think, but in fact `curl-config` is on the PATH,\n> and even tells you about the compiler flags:\n> {{{\n> $ curl-config --cflags\n> -I/usr/local/include\n> }}}\n> and the version seems good too:\n> {{{\n> $ curl-config --checkfor 7.22\n> $ curl-config --checkfor 999\n> requested version 999 is newer than existing 7.59.0\n> $ curl-config --version      \n> libcurl 7.59.0\n> }}}\n\n\nThanks.  If it wasn't working before this ticket either then I wouldn't be inclined to address it here, since this is just moving around the existing code.  I would open a separate issue for that.  Though it seems like it should work if you run it like `./configure CFLAGS=\"-I/usr/local/include\"`.\n\nI'll see if I can set up a way to test that myself.  Also if there are problems with the C compiler itself many other configure-time checks won't succeed at first.",
    "created_at": "2018-04-18T16:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346271",
    "user": "@embray"
}
```

Replying to [comment:16 dimpase]:
> It didn't work before either, I think, but in fact `curl-config` is on the PATH,
> and even tells you about the compiler flags:
> {{{
> $ curl-config --cflags
> -I/usr/local/include
> }}}
> and the version seems good too:
> {{{
> $ curl-config --checkfor 7.22
> $ curl-config --checkfor 999
> requested version 999 is newer than existing 7.59.0
> $ curl-config --version      
> libcurl 7.59.0
> }}}


Thanks.  If it wasn't working before this ticket either then I wouldn't be inclined to address it here, since this is just moving around the existing code.  I would open a separate issue for that.  Though it seems like it should work if you run it like `./configure CFLAGS="-I/usr/local/include"`.

I'll see if I can set up a way to test that myself.  Also if there are problems with the C compiler itself many other configure-time checks won't succeed at first.



---

archive/issue_comments_346272.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-18T16:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346272",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346273.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-19T08:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346273",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346274.json:
```json
{
    "body": "Seems to have a bug since the last rebase...",
    "created_at": "2018-04-19T08:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346274",
    "user": "@embray"
}
```

Seems to have a bug since the last rebase...



---

archive/issue_comments_346275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-19T08:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346275",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346276.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-19T08:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346276",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346277.json:
```json
{
    "body": "that's better, at least `make distclean` succeeds after `./bootstrap`...",
    "created_at": "2018-04-19T09:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346277",
    "user": "@dimpase"
}
```

that's better, at least `make distclean` succeeds after `./bootstrap`...



---

archive/issue_comments_346278.json:
```json
{
    "body": "Replying to [comment:19 embray]:\n> Replying to [comment:16 dimpase]:\n> > It didn't work before either, I think, but in fact `curl-config` is on the PATH,\n> > and even tells you about the compiler flags:\n> > {{{\n> > $ curl-config --cflags\n> > -I/usr/local/include\n> > }}}\n> > and the version seems good too:\n> > {{{\n> > $ curl-config --checkfor 7.22\n> > $ curl-config --checkfor 999\n> > requested version 999 is newer than existing 7.59.0\n> > $ curl-config --version      \n> > libcurl 7.59.0\n> > }}}\n> \n> \n> Thanks.  If it wasn't working before this ticket either then I wouldn't be inclined to address it here, since this is just moving around the existing code.  I would open a separate issue for that.  Though it seems like it should work if you run it like `./configure CFLAGS=\"-I/usr/local/include\"`.\n\nno, it doesn't work this way, at least not with clang on FreeBSD. I've opened    \n#25214 \n(I guess it differs from one compiler to the other whether /usr/local/include is searched by default or not)",
    "created_at": "2018-04-19T09:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346278",
    "user": "@dimpase"
}
```

Replying to [comment:19 embray]:
> Replying to [comment:16 dimpase]:
> > It didn't work before either, I think, but in fact `curl-config` is on the PATH,
> > and even tells you about the compiler flags:
> > {{{
> > $ curl-config --cflags
> > -I/usr/local/include
> > }}}
> > and the version seems good too:
> > {{{
> > $ curl-config --checkfor 7.22
> > $ curl-config --checkfor 999
> > requested version 999 is newer than existing 7.59.0
> > $ curl-config --version      
> > libcurl 7.59.0
> > }}}
> 
> 
> Thanks.  If it wasn't working before this ticket either then I wouldn't be inclined to address it here, since this is just moving around the existing code.  I would open a separate issue for that.  Though it seems like it should work if you run it like `./configure CFLAGS="-I/usr/local/include"`.

no, it doesn't work this way, at least not with clang on FreeBSD. I've opened    
#25214 
(I guess it differs from one compiler to the other whether /usr/local/include is searched by default or not)



---

archive/issue_comments_346279.json:
```json
{
    "body": "By the way, on FreeBSD `patch` is BSD's patch, with a different versioning scheme, whereas GNU patch is gpatch. I wonder whether there is a way to deal with this easily.",
    "created_at": "2018-04-19T09:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346279",
    "user": "@dimpase"
}
```

By the way, on FreeBSD `patch` is BSD's patch, with a different versioning scheme, whereas GNU patch is gpatch. I wonder whether there is a way to deal with this easily.



---

archive/issue_comments_346280.json:
```json
{
    "body": "Replying to [comment:26 dimpase]:\n> By the way, on FreeBSD `patch` is BSD's patch, with a different versioning scheme, whereas GNU patch is gpatch. I wonder whether there is a way to deal with this easily.\n\nRight now it *strictly* requires GNU patch.  In the past there was some reason for that in terms of some features that were needed, or possibly bugs, but I'd be surprised if that still really matters, especially since patching of spkgs was refactored...",
    "created_at": "2018-04-19T09:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346280",
    "user": "@embray"
}
```

Replying to [comment:26 dimpase]:
> By the way, on FreeBSD `patch` is BSD's patch, with a different versioning scheme, whereas GNU patch is gpatch. I wonder whether there is a way to deal with this easily.

Right now it *strictly* requires GNU patch.  In the past there was some reason for that in terms of some features that were needed, or possibly bugs, but I'd be surprised if that still really matters, especially since patching of spkgs was refactored...



---

archive/issue_comments_346281.json:
```json
{
    "body": "Replying to [comment:24 dimpase]:\n> that's better, at least `make distclean` succeeds after `./bootstrap`...\n\nDoes it get any further than that? :)\n\nThanks for testing this out btw.",
    "created_at": "2018-04-19T09:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346281",
    "user": "@embray"
}
```

Replying to [comment:24 dimpase]:
> that's better, at least `make distclean` succeeds after `./bootstrap`...

Does it get any further than that? :)

Thanks for testing this out btw.



---

archive/issue_comments_346282.json:
```json
{
    "body": "Replying to [comment:28 embray]:\n> Replying to [comment:24 dimpase]:\n> > that's better, at least `make distclean` succeeds after `./bootstrap`...\n> \n> Does it get any further than that? :)\n> \n> Thanks for testing this out btw.\n\nI was working on #23353 and messed things up while manually merging your branch.\nNamely, now \n\n```\ngit pull trac public/gfan/spkg_check\n```\n\ndoes not bring me the branch from #23353 back, and I wonder whether there is a painless way to force this... Do I need to locally rebase this branch somehow?",
    "created_at": "2018-04-19T10:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346282",
    "user": "@dimpase"
}
```

Replying to [comment:28 embray]:
> Replying to [comment:24 dimpase]:
> > that's better, at least `make distclean` succeeds after `./bootstrap`...
> 
> Does it get any further than that? :)
> 
> Thanks for testing this out btw.

I was working on #23353 and messed things up while manually merging your branch.
Namely, now 

```
git pull trac public/gfan/spkg_check
```

does not bring me the branch from #23353 back, and I wonder whether there is a painless way to force this... Do I need to locally rebase this branch somehow?



---

archive/issue_comments_346283.json:
```json
{
    "body": "never mind, it builds, and skips `patch`, so this looks good so far.\n\n(I have a soft link `patch` in PATH, pointing to `gpatch`, so this is a dirty way to avoid bumping into BSD patch on FreeBSD)",
    "created_at": "2018-04-19T11:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346283",
    "user": "@dimpase"
}
```

never mind, it builds, and skips `patch`, so this looks good so far.

(I have a soft link `patch` in PATH, pointing to `gpatch`, so this is a dirty way to avoid bumping into BSD patch on FreeBSD)



---

archive/issue_comments_346284.json:
```json
{
    "body": "Would be wonderful if it can handle #25158 (cmake which is an optional package).",
    "created_at": "2018-05-01T12:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346284",
    "user": "@videlec"
}
```

Would be wonderful if it can handle #25158 (cmake which is an optional package).



---

archive/issue_comments_346285.json:
```json
{
    "body": "as well as\n\n* autotools\n* boost\n* bzip2\n* freetype \n* gc\n* gmp\n* gsl\n* iconv\n* pcre\n* r\n* readline\n* scons\n* xz\n* zlib\n\n(this is still avoiding more python-related and maths-related packages...)",
    "created_at": "2018-05-01T13:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346285",
    "user": "@dimpase"
}
```

as well as

* autotools
* boost
* bzip2
* freetype 
* gc
* gmp
* gsl
* iconv
* pcre
* r
* readline
* scons
* xz
* zlib

(this is still avoiding more python-related and maths-related packages...)



---

archive/issue_comments_346286.json:
```json
{
    "body": "Replying to [comment:32 dimpase]:\n> as well as\n> \n>  * autotools\n>  * boost\n>  * bzip2\n>  * freetype \n>  * gc\n>  * gmp\n>  * gsl\n>  * iconv\n>  * pcre\n>  * r\n>  * readline\n>  * scons\n>  * xz\n>  * zlib\n> \n> (this is still avoiding more python-related and maths-related packages...)\n\nMaybe not autotools, since it's an optional package, and the main point of sage's autotools package was installing lots of different autoconf/automake versions for building patches to different package's configure scripts.\n\nThe rest though yeah--all of these kind of low level system libraries are the highest priority to add support for (add ncurses to that list--ncurses takes *forever* and we have to build it twice).\n\nBut first I want to get the general mechanism in place before adding support for a bunch more packages.",
    "created_at": "2018-05-01T21:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346286",
    "user": "@embray"
}
```

Replying to [comment:32 dimpase]:
> as well as
> 
>  * autotools
>  * boost
>  * bzip2
>  * freetype 
>  * gc
>  * gmp
>  * gsl
>  * iconv
>  * pcre
>  * r
>  * readline
>  * scons
>  * xz
>  * zlib
> 
> (this is still avoiding more python-related and maths-related packages...)

Maybe not autotools, since it's an optional package, and the main point of sage's autotools package was installing lots of different autoconf/automake versions for building patches to different package's configure scripts.

The rest though yeah--all of these kind of low level system libraries are the highest priority to add support for (add ncurses to that list--ncurses takes *forever* and we have to build it twice).

But first I want to get the general mechanism in place before adding support for a bunch more packages.



---

archive/issue_comments_346287.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-17T15:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346287",
    "user": "@saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346288.json:
```json
{
    "body": "I could have sworn I rebased this recently.  Maybe it was just on my todo list.",
    "created_at": "2018-07-17T17:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346288",
    "user": "@embray"
}
```

I could have sworn I rebased this recently.  Maybe it was just on my todo list.



---

archive/issue_comments_346289.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-07-17T17:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346289",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346290.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-17T17:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346290",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346291.json:
```json
{
    "body": "Just noticed a typo in how this builds on top of #25011.",
    "created_at": "2018-07-17T18:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346291",
    "user": "@embray"
}
```

Just noticed a typo in how this builds on top of #25011.



---

archive/issue_comments_346292.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-17T18:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346292",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346293.json:
```json
{
    "body": "I believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346293",
    "user": "@embray"
}
```

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_comments_346294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-30T10:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346294",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346295.json:
```json
{
    "body": "This is still ready go to.  Most of the dependencies are listed as dependencies just because they would conflict with this.  Or rather, because this moves around code from `configure.ac`, it also needs to incorporate other fixes I've made that also make changes to `configure.ac`.\n\nBut if any of those tickets remain controversial or whatever I can remove them from this ticket and deal with them later.\n\nThe substance of this ticket ticket is in providing support for `build/<pkg>/spkg-configure.m4` files, providing `configure`-time checks for individual packages.",
    "created_at": "2018-07-30T10:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346295",
    "user": "@embray"
}
```

This is still ready go to.  Most of the dependencies are listed as dependencies just because they would conflict with this.  Or rather, because this moves around code from `configure.ac`, it also needs to incorporate other fixes I've made that also make changes to `configure.ac`.

But if any of those tickets remain controversial or whatever I can remove them from this ticket and deal with them later.

The substance of this ticket ticket is in providing support for `build/<pkg>/spkg-configure.m4` files, providing `configure`-time checks for individual packages.



---

archive/issue_comments_346296.json:
```json
{
    "body": "Why is it in \"needs work\" status?",
    "created_at": "2018-07-30T14:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346296",
    "user": "@dimpase"
}
```

Why is it in "needs work" status?



---

archive/issue_comments_346297.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-30T15:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346297",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346298.json:
```json
{
    "body": "Good work! What happens if the system package is updated to an incompatible version or even removed?",
    "created_at": "2018-08-06T15:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346298",
    "user": "@timokau"
}
```

Good work! What happens if the system package is updated to an incompatible version or even removed?



---

archive/issue_comments_346299.json:
```json
{
    "body": "Replying to [comment:47 gh-timokau]:\n> Good work! What happens if the system package is updated to an incompatible version or even removed?\n\nCertainly there's nothing one can do about that; that's a problem that exists for any software.  The best you can do is that if you notice something breaks to try re-running `./configure`.  Depending on the exact nature of the checks for a given package, that still might not tell you anything, but the eventual result of debugging such a problem would be either a workaround for said incompatible version or changing the range of package versions that are considered compatible.\n\nIt is also still possible to force installation of the spkg.  Though one thing I think this might need, either in this ticket or in a followup, is a way to automatically add `--with-` flags for selecting the spkg over the system package or vice-versa.\n\nMy thinking was something like `--with-curl`, where the option can take an optional argument such as `--with-curl=<something>`, where `<something>` could technically be anything depending on the package, and it would be up to the package's `spkg-configure.ac` to determine what to do based on the argument.  Without the argument I think the default should be a special value like \"spkg\" meaning `--with-curl=spkg` or install cURL from the SPKG.\n\nIn other words, `--with-curl` would mean, \"configure Sage to include Sage's curl\".  \n\nThat's just one idea...there are other ways one could do this that might be better.  That's just my current line of thinking.",
    "created_at": "2018-08-06T15:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346299",
    "user": "@embray"
}
```

Replying to [comment:47 gh-timokau]:
> Good work! What happens if the system package is updated to an incompatible version or even removed?

Certainly there's nothing one can do about that; that's a problem that exists for any software.  The best you can do is that if you notice something breaks to try re-running `./configure`.  Depending on the exact nature of the checks for a given package, that still might not tell you anything, but the eventual result of debugging such a problem would be either a workaround for said incompatible version or changing the range of package versions that are considered compatible.

It is also still possible to force installation of the spkg.  Though one thing I think this might need, either in this ticket or in a followup, is a way to automatically add `--with-` flags for selecting the spkg over the system package or vice-versa.

My thinking was something like `--with-curl`, where the option can take an optional argument such as `--with-curl=<something>`, where `<something>` could technically be anything depending on the package, and it would be up to the package's `spkg-configure.ac` to determine what to do based on the argument.  Without the argument I think the default should be a special value like "spkg" meaning `--with-curl=spkg` or install cURL from the SPKG.

In other words, `--with-curl` would mean, "configure Sage to include Sage's curl".  

That's just one idea...there are other ways one could do this that might be better.  That's just my current line of thinking.



---

archive/issue_comments_346300.json:
```json
{
    "body": "after pulling and running bootstrap I get \n\n```\nchecking for GNU patch >= 2.7.0... /usr/bin/patch\nchecking for curl 7.22... no\nchecking for git... /usr/bin/git\n./configure: line 7948: syntax error near unexpected token `elif'\n./configure: line 7948: `    elif test x$SAGE_INSTALL_GCC = xno; then'\n```\n",
    "created_at": "2018-08-15T07:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346300",
    "user": "@dimpase"
}
```

after pulling and running bootstrap I get 

```
checking for GNU patch >= 2.7.0... /usr/bin/patch
checking for curl 7.22... no
checking for git... /usr/bin/git
./configure: line 7948: syntax error near unexpected token `elif'
./configure: line 7948: `    elif test x$SAGE_INSTALL_GCC = xno; then'
```




---

archive/issue_comments_346301.json:
```json
{
    "body": "This must be one of autoconf/m4 SNAFUs: these errors come from fragments such as\n\n```\nif ...\n   # ...\n   # true\nelif...\n```\n\nwhereas `true` is not commented out in original m4 files...",
    "created_at": "2018-08-15T07:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346301",
    "user": "@dimpase"
}
```

This must be one of autoconf/m4 SNAFUs: these errors come from fragments such as

```
if ...
   # ...
   # true
elif...
```

whereas `true` is not commented out in original m4 files...



---

archive/issue_comments_346302.json:
```json
{
    "body": "in fact, the following fixes configure:\n\n```\n--- a/build/pkgs/gcc/spkg-configure.m4\n+++ b/build/pkgs/gcc/spkg-configure.m4\n@@ -6,7 +6,7 @@ dnl In the latter case, a warning is given.\n AC_DEFUN([SAGE_SHOULD_INSTALL_GCC], [\n     if test x$SAGE_INSTALL_GCC = xexists; then\n         # Already installed in Sage, but it should remain selected\n-        # true\n+        true\n     elif test x$SAGE_INSTALL_GCC = xno; then\n         AC_MSG_WARN([$1])\n     else\n```\n\n\n-----\n\nI also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.\nSo `bc` should be added to build pre-reqs.",
    "created_at": "2018-08-15T08:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346302",
    "user": "@dimpase"
}
```

in fact, the following fixes configure:

```
--- a/build/pkgs/gcc/spkg-configure.m4
+++ b/build/pkgs/gcc/spkg-configure.m4
@@ -6,7 +6,7 @@ dnl In the latter case, a warning is given.
 AC_DEFUN([SAGE_SHOULD_INSTALL_GCC], [
     if test x$SAGE_INSTALL_GCC = xexists; then
         # Already installed in Sage, but it should remain selected
-        # true
+        true
     elif test x$SAGE_INSTALL_GCC = xno; then
         AC_MSG_WARN([$1])
     else
```


-----

I also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.
So `bc` should be added to build pre-reqs.



---

archive/issue_comments_346303.json:
```json
{
    "body": "I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.",
    "created_at": "2018-08-15T09:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346303",
    "user": "@dimpase"
}
```

I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.



---

archive/issue_comments_346304.json:
```json
{
    "body": "Attachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket24919/spkg-configure.m4) by @dimpase created at 2018-08-15 09:42:18\n\nxz spkg-configure.m4",
    "created_at": "2018-08-15T09:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346304",
    "user": "@dimpase"
}
```

Attachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket24919/spkg-configure.m4) by @dimpase created at 2018-08-15 09:42:18

xz spkg-configure.m4



---

archive/issue_comments_346305.json:
```json
{
    "body": "I am not sure how to deal with libraries; for some there are autoconf macros, e.g.\n[AX_CHECK_ZLIB](http://git.savannah.gnu.org/gitweb/?p=autoconf-archive.git;a=blob_plain;f=m4/ax_check_zlib.m4).\n \nStill, extra work for zlib would be needed to extract the version. How much can one rely\non `pkgconf/pkg-config` ?",
    "created_at": "2018-08-15T10:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346305",
    "user": "@dimpase"
}
```

I am not sure how to deal with libraries; for some there are autoconf macros, e.g.
[AX_CHECK_ZLIB](http://git.savannah.gnu.org/gitweb/?p=autoconf-archive.git;a=blob_plain;f=m4/ax_check_zlib.m4).
 
Still, extra work for zlib would be needed to extract the version. How much can one rely
on `pkgconf/pkg-config` ?



---

archive/issue_comments_346306.json:
```json
{
    "body": "Replying to [comment:52 dimpase]:\n> I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.\n\nThis m4 file will also need proper check for `liblzma` being installed with headers and all.",
    "created_at": "2018-08-16T08:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346306",
    "user": "@dimpase"
}
```

Replying to [comment:52 dimpase]:
> I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.

This m4 file will also need proper check for `liblzma` being installed with headers and all.



---

archive/issue_comments_346307.json:
```json
{
    "body": "Replying to [comment:49 dimpase]:\n> after pulling and running bootstrap I get \n> {{{\n> checking for GNU patch >= 2.7.0... /usr/bin/patch\n> checking for curl 7.22... no\n> checking for git... /usr/bin/git\n> ./configure: line 7948: syntax error near unexpected token `elif'\n> ./configure: line 7948: `    elif test x$SAGE_INSTALL_GCC = xno; then'\n> }}}\n\nHuh, I'll have to give that a try.  I definitely didn't get anything like that when I last worked on this ticket, but maybe the bug was in a code path that `configure` didn't go down on my system (are you using Sage's GCC or no?)\n\nThank you for debugging and finding the problem.",
    "created_at": "2018-08-16T11:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346307",
    "user": "@embray"
}
```

Replying to [comment:49 dimpase]:
> after pulling and running bootstrap I get 
> {{{
> checking for GNU patch >= 2.7.0... /usr/bin/patch
> checking for curl 7.22... no
> checking for git... /usr/bin/git
> ./configure: line 7948: syntax error near unexpected token `elif'
> ./configure: line 7948: `    elif test x$SAGE_INSTALL_GCC = xno; then'
> }}}

Huh, I'll have to give that a try.  I definitely didn't get anything like that when I last worked on this ticket, but maybe the bug was in a code path that `configure` didn't go down on my system (are you using Sage's GCC or no?)

Thank you for debugging and finding the problem.



---

archive/issue_comments_346308.json:
```json
{
    "body": "Replying to [comment:51 dimpase]:\n> I also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.\n> So `bc` should be added to build pre-reqs. \n\nWhoa, really??  Are you sure you don't have that problem without this patch?  The test for curl existed in the original `configure.ac`, and I just moved the existing test to `build/pkgs/curl/spkg-configure.m4` pretty much unmodified. It's not clear to me where it's looking for `bc` either.  I thought `bc` was one of those things that's pretty much always there, like grep (albeit more obscure).\n\nCould you be more specific about ho that came up?  Was there something in `config.log`?",
    "created_at": "2018-08-16T11:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346308",
    "user": "@embray"
}
```

Replying to [comment:51 dimpase]:
> I also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.
> So `bc` should be added to build pre-reqs. 

Whoa, really??  Are you sure you don't have that problem without this patch?  The test for curl existed in the original `configure.ac`, and I just moved the existing test to `build/pkgs/curl/spkg-configure.m4` pretty much unmodified. It's not clear to me where it's looking for `bc` either.  I thought `bc` was one of those things that's pretty much always there, like grep (albeit more obscure).

Could you be more specific about ho that came up?  Was there something in `config.log`?



---

archive/issue_comments_346309.json:
```json
{
    "body": "Replying to [comment:52 dimpase]:\n> I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.\n\nI can't imagine it wouldn't be OK to use `cut`.  Again, it's a POSIX standard program, and the flags you're using are standard as well.  Are you working on OSX?  I feel like if it works on OSX it should work on any other platform we're supporting.  If you're worried about it we could also put in an `AC_PROG_CHECK` for `cut`.\n\nIf nothing else, I believe that if errors occur in dependency checks, then we should just fail on detecting the dependency and build it.",
    "created_at": "2018-08-16T11:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346309",
    "user": "@embray"
}
```

Replying to [comment:52 dimpase]:
> I've tried creating more `spkg-configure.m4`. I'm attaching one for `xz`. Not sure it's OK to use `cut`, but here it goes.

I can't imagine it wouldn't be OK to use `cut`.  Again, it's a POSIX standard program, and the flags you're using are standard as well.  Are you working on OSX?  I feel like if it works on OSX it should work on any other platform we're supporting.  If you're worried about it we could also put in an `AC_PROG_CHECK` for `cut`.

If nothing else, I believe that if errors occur in dependency checks, then we should just fail on detecting the dependency and build it.



---

archive/issue_comments_346310.json:
```json
{
    "body": "Out of curiosity\n\n\n```\n6\t            changequote(<,>)\n7\t            xz_version=`$ac_path_XZ --version 2>&1 \\\n8\t                | cut -d' ' -f4 | $SED -n 1p`\n9\t            changequote([,])\n```\n\n\nwhy the `changequote(<,>)` here?  It's not immediately obvious that anything in that command would be interpreted as quoting.  But I must be missing a subtlety--please enlighten me.\n\nLGTM otherwise.",
    "created_at": "2018-08-16T11:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346310",
    "user": "@embray"
}
```

Out of curiosity


```
6	            changequote(<,>)
7	            xz_version=`$ac_path_XZ --version 2>&1 \
8	                | cut -d' ' -f4 | $SED -n 1p`
9	            changequote([,])
```


why the `changequote(<,>)` here?  It's not immediately obvious that anything in that command would be interpreted as quoting.  But I must be missing a subtlety--please enlighten me.

LGTM otherwise.



---

archive/issue_comments_346311.json:
```json
{
    "body": "Replying to [comment:56 embray]:\n> Replying to [comment:51 dimpase]:\n> > I also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.\n> > So `bc` should be added to build pre-reqs. \n> \n> Whoa, really??  Are you sure you don't have that problem without this patch?  \n\nI built Sage on that system, a Debian 8(?) xlc container on CromeOS laptop, before, just fine. I suppose that test for curl just failed, and as a result Sage's curl was built.\n\nSomehow bc was not installed.\n\n\nThe test for curl existed in the original `configure.ac`, and I just moved the existing test to `build/pkgs/curl/spkg-configure.m4` pretty much unmodified. It's not clear to me where it's looking for `bc` either.  I thought `bc` was one of those things that's pretty much always there, like grep (albeit more obscure).\n> \n> Could you be more specific about ho that came up?  Was there something in `config.log`?\n\nYes, I saw \"bc not found\" in config.log, in a curl-related chunk.\n\nI'm away from the box till evening but you can try uninstalling bc yourself and observing the result.",
    "created_at": "2018-08-16T11:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346311",
    "user": "@dimpase"
}
```

Replying to [comment:56 embray]:
> Replying to [comment:51 dimpase]:
> > I also saw `build/pkgs/curl/spkg-configure.m4` not working due to `bc` not installed.
> > So `bc` should be added to build pre-reqs. 
> 
> Whoa, really??  Are you sure you don't have that problem without this patch?  

I built Sage on that system, a Debian 8(?) xlc container on CromeOS laptop, before, just fine. I suppose that test for curl just failed, and as a result Sage's curl was built.

Somehow bc was not installed.


The test for curl existed in the original `configure.ac`, and I just moved the existing test to `build/pkgs/curl/spkg-configure.m4` pretty much unmodified. It's not clear to me where it's looking for `bc` either.  I thought `bc` was one of those things that's pretty much always there, like grep (albeit more obscure).
> 
> Could you be more specific about ho that came up?  Was there something in `config.log`?

Yes, I saw "bc not found" in config.log, in a curl-related chunk.

I'm away from the box till evening but you can try uninstalling bc yourself and observing the result.



---

archive/issue_comments_346312.json:
```json
{
    "body": "I'll have to figure out what exactly was trying to use `bc` and not finding it.  That could be a bug in on of the standard autoconf macros, because in general they won't try to use a program that autoconf hasn't found first.\n\nIn any case, as long as the resulting behavior is to report curl as not found and move on, I'm mostly OK with that.  The goal here is not necessarily to make all packages detectable 100% of the time* (though if there are cases where they should have been detected and weren't we certainly want to look into that).\n\n\n\n\\\\* I should clarify: That *is* a goal long-term, theoretically, but for the purposes of this ticket I'm just concerned with the general mechanism.",
    "created_at": "2018-08-16T11:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346312",
    "user": "@embray"
}
```

I'll have to figure out what exactly was trying to use `bc` and not finding it.  That could be a bug in on of the standard autoconf macros, because in general they won't try to use a program that autoconf hasn't found first.

In any case, as long as the resulting behavior is to report curl as not found and move on, I'm mostly OK with that.  The goal here is not necessarily to make all packages detectable 100% of the time* (though if there are cases where they should have been detected and weren't we certainly want to look into that).



\\* I should clarify: That *is* a goal long-term, theoretically, but for the purposes of this ticket I'm just concerned with the general mechanism.



---

archive/issue_comments_346313.json:
```json
{
    "body": "Replying to [comment:60 embray]:\n> I'll have to figure out what exactly was trying to use `bc` and not finding it. \n\nwithout `bc`, one has\n\n```\n$ curl-config --checkfor 7.22\n/usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found\n/usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found\n/usr/bin/curl-config: 112: test: Illegal number: \nrequested version 7.22 is newer than existing 7.52.1\n```\n\nAs `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error\nif no `bc` is installed. So this is a bug in `curl`, if you like. `bc` is used to\ncompute the \"raw\" version.\nYou see there\n\n```\n        cpatch=`echo $checkfor | cut -d. -f3 | cut -d- -f1`\n        checknum=`echo \"$cmajor*256*256 + $cminor*256 + ${cpatch:-0}\" | bc`\n        numuppercase=`echo 073401 | tr 'a-f' 'A-F'`\n        nownum=`echo \"obase=10; ibase=16; $numuppercase\" | bc`\n```\n",
    "created_at": "2018-08-16T19:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346313",
    "user": "@dimpase"
}
```

Replying to [comment:60 embray]:
> I'll have to figure out what exactly was trying to use `bc` and not finding it. 

without `bc`, one has

```
$ curl-config --checkfor 7.22
/usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found
/usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found
/usr/bin/curl-config: 112: test: Illegal number: 
requested version 7.22 is newer than existing 7.52.1
```

As `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error
if no `bc` is installed. So this is a bug in `curl`, if you like. `bc` is used to
compute the "raw" version.
You see there

```
        cpatch=`echo $checkfor | cut -d. -f3 | cut -d- -f1`
        checknum=`echo "$cmajor*256*256 + $cminor*256 + ${cpatch:-0}" | bc`
        numuppercase=`echo 073401 | tr 'a-f' 'A-F'`
        nownum=`echo "obase=10; ibase=16; $numuppercase" | bc`
```




---

archive/issue_comments_346314.json:
```json
{
    "body": "Replying to [comment:58 embray]:\n> Out of curiosity\n> \n> {{{\n> 6\t            changequote(<,>)\n> 7\t            xz_version=`$ac_path_XZ --version 2>&1 \\\n> 8\t                | cut -d' ' -f4 | $SED -n 1p`\n> 9\t            changequote([,])\n> }}}\n> \n> why the `changequote(<,>)` here?  \nIt's just copy/paste from `build/pkgs/patch/spkg-configure.m4`\n\n> It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.\n\nPuzzling to me as well.",
    "created_at": "2018-08-16T19:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346314",
    "user": "@dimpase"
}
```

Replying to [comment:58 embray]:
> Out of curiosity
> 
> {{{
> 6	            changequote(<,>)
> 7	            xz_version=`$ac_path_XZ --version 2>&1 \
> 8	                | cut -d' ' -f4 | $SED -n 1p`
> 9	            changequote([,])
> }}}
> 
> why the `changequote(<,>)` here?  
It's just copy/paste from `build/pkgs/patch/spkg-configure.m4`

> It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.

Puzzling to me as well.



---

archive/issue_comments_346315.json:
```json
{
    "body": "Replying to [comment:61 dimpase]:\n\n> As `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error\n> if no `bc` is installed. \n\nLet us add the corresponding check in `configure.ac` and bail out if it's not there:\n\n```\nAC_CHECK_PROG(found_bc, bc, yes, no)\nif test x$found_bc != xyes\nthen\n    AC_MSG_NOTICE([Sorry, the 'bc' command must be in the path to build AC_PACKAGE_NAME])\n    AC_MSG_NOTICE([On some systems it can be found in /usr/ccs/bin])\n    AC_MSG_NOTICE([See also https://www.gnu.org/software/bc/])\n    AC_MSG_ERROR([Exiting, as the calculator 'bc' can not be found.])\nfi\n```\n\n\nHow about doing something like this for `cut`, as well, just as an extra sanity check?",
    "created_at": "2018-08-16T20:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346315",
    "user": "@dimpase"
}
```

Replying to [comment:61 dimpase]:

> As `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error
> if no `bc` is installed. 

Let us add the corresponding check in `configure.ac` and bail out if it's not there:

```
AC_CHECK_PROG(found_bc, bc, yes, no)
if test x$found_bc != xyes
then
    AC_MSG_NOTICE([Sorry, the 'bc' command must be in the path to build AC_PACKAGE_NAME])
    AC_MSG_NOTICE([On some systems it can be found in /usr/ccs/bin])
    AC_MSG_NOTICE([See also https://www.gnu.org/software/bc/])
    AC_MSG_ERROR([Exiting, as the calculator 'bc' can not be found.])
fi
```


How about doing something like this for `cut`, as well, just as an extra sanity check?



---

archive/issue_comments_346316.json:
```json
{
    "body": "Replying to [comment:61 dimpase]:\n> Replying to [comment:60 embray]:\n> > I'll have to figure out what exactly was trying to use `bc` and not finding it. \n> \n> without `bc`, one has\n> {{{\n> $ curl-config --checkfor 7.22\n> /usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found\n> /usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found\n> /usr/bin/curl-config: 112: test: Illegal number: \n> requested version 7.22 is newer than existing 7.52.1\n> }}}\n> As `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error\n> if no `bc` is installed. So this is a bug in `curl`, if you like. `bc` is used to\n> compute the \"raw\" version.\n> You see there\n> {{{\n>         cpatch=`echo $checkfor | cut -d. -f3 | cut -d- -f1`\n>         checknum=`echo \"$cmajor*256*256 + $cminor*256 + ${cpatch:-0}\" | bc`\n>         numuppercase=`echo 073401 | tr 'a-f' 'A-F'`\n>         nownum=`echo \"obase=10; ibase=16; $numuppercase\" | bc`\n> }}}\n\nI see now. I didn't realize `curl-config` was just a shell script.  Then, technically, in order to run it we need to have all of its dependencies as well, hahah.\n\nWell, that has nothing directly to do with this ticket so I'm not worried about it right now.  But I will create a ticket for it.",
    "created_at": "2018-08-17T13:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346316",
    "user": "@embray"
}
```

Replying to [comment:61 dimpase]:
> Replying to [comment:60 embray]:
> > I'll have to figure out what exactly was trying to use `bc` and not finding it. 
> 
> without `bc`, one has
> {{{
> $ curl-config --checkfor 7.22
> /usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found
> /usr/bin/curl-config: 1: /usr/bin/curl-config: bc: not found
> /usr/bin/curl-config: 112: test: Illegal number: 
> requested version 7.22 is newer than existing 7.52.1
> }}}
> As `spkg-configure.m4` invokes `curl-config --checkfor`, you get this error
> if no `bc` is installed. So this is a bug in `curl`, if you like. `bc` is used to
> compute the "raw" version.
> You see there
> {{{
>         cpatch=`echo $checkfor | cut -d. -f3 | cut -d- -f1`
>         checknum=`echo "$cmajor*256*256 + $cminor*256 + ${cpatch:-0}" | bc`
>         numuppercase=`echo 073401 | tr 'a-f' 'A-F'`
>         nownum=`echo "obase=10; ibase=16; $numuppercase" | bc`
> }}}

I see now. I didn't realize `curl-config` was just a shell script.  Then, technically, in order to run it we need to have all of its dependencies as well, hahah.

Well, that has nothing directly to do with this ticket so I'm not worried about it right now.  But I will create a ticket for it.



---

archive/issue_comments_346317.json:
```json
{
    "body": "Replying to [comment:62 dimpase]:\n> Replying to [comment:58 embray]:\n> > Out of curiosity\n> > \n> > {{{\n> > 6\t            changequote(<,>)\n> > 7\t            xz_version=`$ac_path_XZ --version 2>&1 \\\n> > 8\t                | cut -d' ' -f4 | $SED -n 1p`\n> > 9\t            changequote([,])\n> > }}}\n> > \n> > why the `changequote(<,>)` here?  \n> It's just copy/paste from `build/pkgs/patch/spkg-configure.m4`\n\nOh, well in the case of patch I can tell you exactly why it's needed: the regular expression I use in the `sed` call uses square brackets, such as `[0-9]`.  These are the default quote characters used in autoconf, so you need to `changequote` here (or use hideous m4 escape sequences).\n\n> > It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.\n> \n> Puzzling to me as well.\n\nDid you find it didn't work *without* it, or is it just cargo cult?",
    "created_at": "2018-08-17T13:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346317",
    "user": "@embray"
}
```

Replying to [comment:62 dimpase]:
> Replying to [comment:58 embray]:
> > Out of curiosity
> > 
> > {{{
> > 6	            changequote(<,>)
> > 7	            xz_version=`$ac_path_XZ --version 2>&1 \
> > 8	                | cut -d' ' -f4 | $SED -n 1p`
> > 9	            changequote([,])
> > }}}
> > 
> > why the `changequote(<,>)` here?  
> It's just copy/paste from `build/pkgs/patch/spkg-configure.m4`

Oh, well in the case of patch I can tell you exactly why it's needed: the regular expression I use in the `sed` call uses square brackets, such as `[0-9]`.  These are the default quote characters used in autoconf, so you need to `changequote` here (or use hideous m4 escape sequences).

> > It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.
> 
> Puzzling to me as well.

Did you find it didn't work *without* it, or is it just cargo cult?



---

archive/issue_comments_346318.json:
```json
{
    "body": "Replying to [comment:65 embray]:\n> > > why the `changequote(<,>)` here?  \n> > It's just copy/paste from `build/pkgs/patch/spkg-configure.m4`\n> \n> Oh, well in the case of patch I can tell you exactly why it's needed: the regular expression I use in the `sed` call uses square brackets, such as `[0-9]`.  These are the default quote characters used in autoconf, so you need to `changequote` here (or use hideous m4 escape sequences).\n> \n> > > It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.\n> > \n> > Puzzling to me as well.\n> \n> Did you find it didn't work *without* it, or is it just cargo cult?\n\nIt escaped me that [] might need a special treatment, I thought it's something to do with potentially rougue numering using `,` i.p.of `.`\n\n\nConsider this a request for comments in that code :-)",
    "created_at": "2018-08-17T15:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346318",
    "user": "@dimpase"
}
```

Replying to [comment:65 embray]:
> > > why the `changequote(<,>)` here?  
> > It's just copy/paste from `build/pkgs/patch/spkg-configure.m4`
> 
> Oh, well in the case of patch I can tell you exactly why it's needed: the regular expression I use in the `sed` call uses square brackets, such as `[0-9]`.  These are the default quote characters used in autoconf, so you need to `changequote` here (or use hideous m4 escape sequences).
> 
> > > It's not immediately obvious that anything in that command would be interpreted as > quoting.  But I must be missing a subtlety--please enlighten me.
> > 
> > Puzzling to me as well.
> 
> Did you find it didn't work *without* it, or is it just cargo cult?

It escaped me that [] might need a special treatment, I thought it's something to do with potentially rougue numering using `,` i.p.of `.`


Consider this a request for comments in that code :-)



---

archive/issue_comments_346319.json:
```json
{
    "body": "Yes, in m4 the default left and right quotes are ``'`, but autoconf immediately sets the quotes to `[]`, because autoconf is basically a big pile of m4 macros for generating *shell* code where ``` and `'` are meaningful and common.\n\nOf course, so are `[]` in the context of tests, but there the `[` is just a well-known synonym for `test`, which is why in autoconf you have to write `if test` instead of `if [` in most places.\n\nHowever, there are other rare cases where you might want to use `[]` as literals, such as in regular expressions, so there it's best to temporarily `changequotes()`.  But the only reason you ever need to do that is if you really want to output some square brackets somewhere in your macro.",
    "created_at": "2018-08-17T16:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346319",
    "user": "@embray"
}
```

Yes, in m4 the default left and right quotes are ``'`, but autoconf immediately sets the quotes to `[]`, because autoconf is basically a big pile of m4 macros for generating *shell* code where ``` and `'` are meaningful and common.

Of course, so are `[]` in the context of tests, but there the `[` is just a well-known synonym for `test`, which is why in autoconf you have to write `if test` instead of `if [` in most places.

However, there are other rare cases where you might want to use `[]` as literals, such as in regular expressions, so there it's best to temporarily `changequotes()`.  But the only reason you ever need to do that is if you really want to output some square brackets somewhere in your macro.



---

archive/issue_comments_346320.json:
```json
{
    "body": "In addition to an obvious rebase, I also needed\n\n```\n--- a/configure.ac\n+++ b/configure.ac\n@@@ -754,21 -507,6 +507,9 @@@ AC_CONFIG_COMMANDS(mkdirs\n          SAGE_INST=\"$SAGE_SPKG_INST\"\n      ])\n  \n +dnl A stamp file indicating that an existing, broken GCC install should be\n +dnl cleaned up by make.\n- if test x$SAGE_BROKEN_GCC = xyes; then\n- AC_CONFIG_COMMANDS([broken-gcc], [\n-     # Re-run the check just in case, such as when re-running config.status\n-     SAGE_CHECK_BROKEN_GCC()\n-     if test x$SAGE_BROKEN_GCC = xyes; then\n-         touch build/make/.clean-broken-gcc\n-     fi\n- ], [\n-     SAGE_LOCAL=\"$SAGE_LOCAL\"\n-     SAGE_SRC=\"$SAGE_SRC\"\n- ])\n- fi\n +\n  AC_OUTPUT()\n  \n  dnl vim:syntax=m4\n```\n\nto avoid `./bootstrap` complaining about `broken-gcc` already set in `gcc/spkg-configure.m4`",
    "created_at": "2018-09-09T10:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346320",
    "user": "@dimpase"
}
```

In addition to an obvious rebase, I also needed

```
--- a/configure.ac
+++ b/configure.ac
@@@ -754,21 -507,6 +507,9 @@@ AC_CONFIG_COMMANDS(mkdirs
          SAGE_INST="$SAGE_SPKG_INST"
      ])
  
 +dnl A stamp file indicating that an existing, broken GCC install should be
 +dnl cleaned up by make.
- if test x$SAGE_BROKEN_GCC = xyes; then
- AC_CONFIG_COMMANDS([broken-gcc], [
-     # Re-run the check just in case, such as when re-running config.status
-     SAGE_CHECK_BROKEN_GCC()
-     if test x$SAGE_BROKEN_GCC = xyes; then
-         touch build/make/.clean-broken-gcc
-     fi
- ], [
-     SAGE_LOCAL="$SAGE_LOCAL"
-     SAGE_SRC="$SAGE_SRC"
- ])
- fi
 +
  AC_OUTPUT()
  
  dnl vim:syntax=m4
```

to avoid `./bootstrap` complaining about `broken-gcc` already set in `gcc/spkg-configure.m4`



---

archive/issue_comments_346321.json:
```json
{
    "body": "That stuff is supposed to already be in `build/pkgs/gcc/spkg-configure.m4` so any rebase (which would include #25011 now) would indeed have to remove that block from `configure.ac` (and ensure that the relevant code in `build/pkgs/gcc/spkg-configure.m4` also matches).",
    "created_at": "2018-09-10T15:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346321",
    "user": "@embray"
}
```

That stuff is supposed to already be in `build/pkgs/gcc/spkg-configure.m4` so any rebase (which would include #25011 now) would indeed have to remove that block from `configure.ac` (and ensure that the relevant code in `build/pkgs/gcc/spkg-configure.m4` also matches).



---

archive/issue_comments_346322.json:
```json
{
    "body": "just ran into a yasm recognition bug:\n\n```\nconfigure:3791: checking for yasm\nconfigure:3828: result: not needed for amd64\n```\n\nbut MPIR duly needs yasm on amd64\n\nAnd here \n\n```\n$ uname -m\namd64\n```\n",
    "created_at": "2018-09-14T00:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346322",
    "user": "@dimpase"
}
```

just ran into a yasm recognition bug:

```
configure:3791: checking for yasm
configure:3828: result: not needed for amd64
```

but MPIR duly needs yasm on amd64

And here 

```
$ uname -m
amd64
```




---

archive/issue_comments_346323.json:
```json
{
    "body": "This isn't detecting packages properly on OS X. Without this branch, installations of curl (already there), git (already there), gcc (because it should use clang), and gfortran (already there) are skipped (`config.log` says \"not installed: configure check\"). With this branch, they are all built. Nothing is skipped, it seems.\n\n(I tested by running `make distclean; autoreconf; make`. Did I miss a step?)",
    "created_at": "2018-09-14T04:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346323",
    "user": "@jhpalmieri"
}
```

This isn't detecting packages properly on OS X. Without this branch, installations of curl (already there), git (already there), gcc (because it should use clang), and gfortran (already there) are skipped (`config.log` says "not installed: configure check"). With this branch, they are all built. Nothing is skipped, it seems.

(I tested by running `make distclean; autoreconf; make`. Did I miss a step?)



---

archive/issue_comments_346324.json:
```json
{
    "body": "if configure.ac is changed, one should run ./bootstrap, then ./configure, and look at the list of detected/undetected packages it prints.",
    "created_at": "2018-09-14T07:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346324",
    "user": "@dimpase"
}
```

if configure.ac is changed, one should run ./bootstrap, then ./configure, and look at the list of detected/undetected packages it prints.



---

archive/issue_comments_346325.json:
```json
{
    "body": "Dima, John, for both of these issues, do you have the same issue without this patch?  Because otherwise it's not relevant to the mechanism being implemented here, as for both yasm and curl this ticket is already using the exact same configuration already in place and has just refactored things a little.\n\nIf it works *without* this ticket then that is a problem with the refactoring.  If you have the same problem with or without this ticket then that means it's working more or less as intended.",
    "created_at": "2018-09-14T10:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346325",
    "user": "@embray"
}
```

Dima, John, for both of these issues, do you have the same issue without this patch?  Because otherwise it's not relevant to the mechanism being implemented here, as for both yasm and curl this ticket is already using the exact same configuration already in place and has just refactored things a little.

If it works *without* this ticket then that is a problem with the refactoring.  If you have the same problem with or without this ticket then that means it's working more or less as intended.



---

archive/issue_comments_346326.json:
```json
{
    "body": "Replying to [comment:71 jhpalmieri]:\n> (I tested by running `make distclean; autoreconf; make`. Did I miss a step?)\n\nYou should run `./bootstrap`, not `autoreconf`.",
    "created_at": "2018-09-14T10:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346326",
    "user": "@embray"
}
```

Replying to [comment:71 jhpalmieri]:
> (I tested by running `make distclean; autoreconf; make`. Did I miss a step?)

You should run `./bootstrap`, not `autoreconf`.



---

archive/issue_comments_346327.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-09-14T10:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346327",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346328.json:
```json
{
    "body": "Still have a syntax error that crept in somewhere....",
    "created_at": "2018-09-14T10:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346328",
    "user": "@embray"
}
```

Still have a syntax error that crept in somewhere....



---

archive/issue_comments_346329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-14T10:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346329",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346330.json:
```json
{
    "body": "Rebased again.  Should be good.  If this can get positive review along with #25188 and #25198, then I might close those tickets in favor of this one, since it incorporates both of them.  If either #25188 or #25198 are too problematic but this ticket is otherwise good, I can separate it from those issues for now and deal with them later.  I'm fine with any order of operations.",
    "created_at": "2018-09-14T10:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346330",
    "user": "@embray"
}
```

Rebased again.  Should be good.  If this can get positive review along with #25188 and #25198, then I might close those tickets in favor of this one, since it incorporates both of them.  If either #25188 or #25198 are too problematic but this ticket is otherwise good, I can separate it from those issues for now and deal with them later.  I'm fine with any order of operations.



---

archive/issue_comments_346331.json:
```json
{
    "body": "I made #26281 for the `bc` issue with configuring `curl`.  Unless that issue really only impacts this ticket I propose we table it for now.   IMO it's more of an upstream bug since the curl package should have whatever package includes `bc` as a dependency, if it's used by `curl-config`.",
    "created_at": "2018-09-14T11:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346331",
    "user": "@embray"
}
```

I made #26281 for the `bc` issue with configuring `curl`.  Unless that issue really only impacts this ticket I propose we table it for now.   IMO it's more of an upstream bug since the curl package should have whatever package includes `bc` as a dependency, if it's used by `curl-config`.



---

archive/issue_comments_346332.json:
```json
{
    "body": "OK, I'm testing this now. Would you open a ticket for yasm recognition (cf comment 70)?\nOr perhaps just a followup ticket to add more recognition stuff and fix existing?",
    "created_at": "2018-09-14T11:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346332",
    "user": "@dimpase"
}
```

OK, I'm testing this now. Would you open a ticket for yasm recognition (cf comment 70)?
Or perhaps just a followup ticket to add more recognition stuff and fix existing?



---

archive/issue_comments_346333.json:
```json
{
    "body": "There is something wrong with `yasm/spkg-configure.m4`. Namely, `./configure` does not report whether the result is yes or no. In `config.log` I see\n\n```\n...\nconfigure:8328: === checking whether to install the xz SPKG ===\nconfigure:8343: checking for xz >= 5.2.2\nconfigure:8422: result: /usr/bin/xz\nconfigure:8438: === checking whether to install the yasm SPKG ===\nconfigure:8553: checking SPKGs to install\nconfigure:8555: result: \nconfigure:8644: result:     4ti2-1.6.7\n...\n```\n\nso it looks like something is not right with it.",
    "created_at": "2018-09-14T12:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346333",
    "user": "@dimpase"
}
```

There is something wrong with `yasm/spkg-configure.m4`. Namely, `./configure` does not report whether the result is yes or no. In `config.log` I see

```
...
configure:8328: === checking whether to install the xz SPKG ===
configure:8343: checking for xz >= 5.2.2
configure:8422: result: /usr/bin/xz
configure:8438: === checking whether to install the yasm SPKG ===
configure:8553: checking SPKGs to install
configure:8555: result: 
configure:8644: result:     4ti2-1.6.7
...
```

so it looks like something is not right with it.



---

archive/issue_comments_346334.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-14T12:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346334",
    "user": "@dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346335.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-14T14:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346335",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346336.json:
```json
{
    "body": "I noticed that, but I don't think it's a problem.  The check is skipped for yasm entirely in most cases because yasm isn't even installed on all platforms.\n\nThat new notice I added just gets printed before each package that's checked for, but the final results are summarized later.  Maybe there should be an additional message clarifying what's going on following each of those \"checking whether to install...\" messages?",
    "created_at": "2018-09-14T14:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346336",
    "user": "@embray"
}
```

I noticed that, but I don't think it's a problem.  The check is skipped for yasm entirely in most cases because yasm isn't even installed on all platforms.

That new notice I added just gets printed before each package that's checked for, but the final results are summarized later.  Maybe there should be an additional message clarifying what's going on following each of those "checking whether to install..." messages?



---

archive/issue_comments_346337.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-14T14:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346337",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346338.json:
```json
{
    "body": "On second thought, it looks like the `AC_PATH_PROGS_FEATURE_CHECK` doesn't automatically output a 'checking...' message in the first place, so maybe I'll add that there.",
    "created_at": "2018-09-14T14:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346338",
    "user": "@embray"
}
```

On second thought, it looks like the `AC_PATH_PROGS_FEATURE_CHECK` doesn't automatically output a 'checking...' message in the first place, so maybe I'll add that there.



---

archive/issue_comments_346339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-14T14:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346339",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346340.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-14T14:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346340",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346341.json:
```json
{
    "body": "Ok, now it shows\n\n\n```\nconfigure: === checking whether to install the git SPKG ===\nchecking for git... /usr/bin/git\nconfigure: === checking whether to install the yasm SPKG ===\nchecking for yasm supporting the adox instruction... no\nchecking for Fortran flag needed to accept free-form source... -ffree-form\nconfigure: === checking whether to install the gfortran SPKG ===\nconfigure: === checking whether to install the curl SPKG ===\nchecking for curl 7.22... /usr/bin/curl\nchecking curl/curl.h usability... yes\nchecking curl/curl.h presence... yes\nchecking for curl/curl.h... yes\nchecking for a sed that does not truncate output... /bin/sed\nconfigure: === checking whether to install the patch SPKG ===\nchecking for GNU patch >= 2.7.0... /usr/bin/patch\n```\n\n\nthe message about the Fortran flag really belongs with the gfortran checks, but for some reason (and I noticed this long before) that check gets inserted into the configure script early, possibly something to do with diversions but I'm not sure.  I'm not going to worry about it right now.\n----\nNew commits:",
    "created_at": "2018-09-14T14:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346341",
    "user": "@embray"
}
```

Ok, now it shows


```
configure: === checking whether to install the git SPKG ===
checking for git... /usr/bin/git
configure: === checking whether to install the yasm SPKG ===
checking for yasm supporting the adox instruction... no
checking for Fortran flag needed to accept free-form source... -ffree-form
configure: === checking whether to install the gfortran SPKG ===
configure: === checking whether to install the curl SPKG ===
checking for curl 7.22... /usr/bin/curl
checking curl/curl.h usability... yes
checking curl/curl.h presence... yes
checking for curl/curl.h... yes
checking for a sed that does not truncate output... /bin/sed
configure: === checking whether to install the patch SPKG ===
checking for GNU patch >= 2.7.0... /usr/bin/patch
```


the message about the Fortran flag really belongs with the gfortran checks, but for some reason (and I noticed this long before) that check gets inserted into the configure script early, possibly something to do with diversions but I'm not sure.  I'm not going to worry about it right now.
----
New commits:



---

archive/issue_comments_346342.json:
```json
{
    "body": "Okay, if I do `make distclean; ./bootstrap; ./configure`, then I see\n\n```\nYou are using OS X Lion (or later).\nYou are strongly advised to install Apple's latest Xcode\nunless you already have it. You can install this using\nthe App Store. Also, make sure you install Xcode's\nCommand Line Tools -- see Sage's README.txt.\nchecking Python version to install... 2\nchecking multiprecision library... MPIR\nchecking BLAS library... openblas\n./configure: line 6910: SAGE_SPKG_CONFIGURE_: command not found\n./configure: line 6911: SAGE_SPKG_CONFIGURE_: command not found\n./configure: line 6912: SAGE_SPKG_CONFIGURE_: command not found\n./configure: line 6913: SAGE_SPKG_CONFIGURE_: command not found\n./configure: line 6914: SAGE_SPKG_CONFIGURE_: command not found\n./configure: line 6915: SAGE_SPKG_CONFIGURE_: command not found\nchecking SPKGs to install... \n    4ti2-1.6.7\n    alabaster-0.7.10\n    appnope-0.1.0.p0\n    arb-2.14.0\n ...\n```\n\nand all packages are going to be installed. As I said before, with a vanilla Sage, curl, git, gcc, and gfortran are not installed by Sage on this computer, because `./configure` correctly detects them.\n\nThe `configure` script looks strange: after the line `# Configure all spkgs with configure-time checks`, there are about 30 blank lines, followed by\n\n```\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\n```\n\nThe file `m4/sage_spkg_configures.m4` contains this:\n\n```\nm4_sinclude([build/pkgs//curl/spkg-configure.m4])\nm4_sinclude([build/pkgs//gcc/spkg-configure.m4])\nm4_sinclude([build/pkgs//gfortran/spkg-configure.m4])\nm4_sinclude([build/pkgs//git/spkg-configure.m4])\nm4_sinclude([build/pkgs//patch/spkg-configure.m4])\nm4_sinclude([build/pkgs//yasm/spkg-configure.m4])\n\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\nSAGE_SPKG_CONFIGURE_\n```\n\nMaybe you are using GNUisms in the bash script `bootstrap`.",
    "created_at": "2018-09-14T15:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346342",
    "user": "@jhpalmieri"
}
```

Okay, if I do `make distclean; ./bootstrap; ./configure`, then I see

```
You are using OS X Lion (or later).
You are strongly advised to install Apple's latest Xcode
unless you already have it. You can install this using
the App Store. Also, make sure you install Xcode's
Command Line Tools -- see Sage's README.txt.
checking Python version to install... 2
checking multiprecision library... MPIR
checking BLAS library... openblas
./configure: line 6910: SAGE_SPKG_CONFIGURE_: command not found
./configure: line 6911: SAGE_SPKG_CONFIGURE_: command not found
./configure: line 6912: SAGE_SPKG_CONFIGURE_: command not found
./configure: line 6913: SAGE_SPKG_CONFIGURE_: command not found
./configure: line 6914: SAGE_SPKG_CONFIGURE_: command not found
./configure: line 6915: SAGE_SPKG_CONFIGURE_: command not found
checking SPKGs to install... 
    4ti2-1.6.7
    alabaster-0.7.10
    appnope-0.1.0.p0
    arb-2.14.0
 ...
```

and all packages are going to be installed. As I said before, with a vanilla Sage, curl, git, gcc, and gfortran are not installed by Sage on this computer, because `./configure` correctly detects them.

The `configure` script looks strange: after the line `# Configure all spkgs with configure-time checks`, there are about 30 blank lines, followed by

```
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
```

The file `m4/sage_spkg_configures.m4` contains this:

```
m4_sinclude([build/pkgs//curl/spkg-configure.m4])
m4_sinclude([build/pkgs//gcc/spkg-configure.m4])
m4_sinclude([build/pkgs//gfortran/spkg-configure.m4])
m4_sinclude([build/pkgs//git/spkg-configure.m4])
m4_sinclude([build/pkgs//patch/spkg-configure.m4])
m4_sinclude([build/pkgs//yasm/spkg-configure.m4])

SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
SAGE_SPKG_CONFIGURE_
```

Maybe you are using GNUisms in the bash script `bootstrap`.



---

archive/issue_comments_346343.json:
```json
{
    "body": "Replying to [comment:86 embray]:\n> the message about the Fortran flag really belongs with the gfortran checks, but for some reason (and I noticed this long before) that check gets inserted into the configure script early, possibly something to do with diversions but I'm not sure.  I'm not going to worry about it right now.\n\nOk, I couldn't help but to worry about it a little bit; I wanted to know what was going on here.  It's because each `SAGE_SPKG_CONFIGURE_` macro (e.g. `SAGE_SPKG_CONFIGURE_GFORTRAN`) is defined with `AC_DEFUN_ONCE`--these are \"one shot\" macros that are expanded only once.  However, if you call an `AC_DEFUN_ONCE` macro inside an `AC_DEFUN_ONCE` macro, it orders things so that nested one-shot macros are expanded first (I think this may be to help prevent recursion).\n\nI'm not sure if there's a good way to circumvent that for the sake of the \"checking\" messages.  Perhaps I can move them to outside the `SAGE_SPKG_CONFIGURE_` macros themselves.  Like I said, it's not terribly important though, and the end result is still consistent.",
    "created_at": "2018-09-14T16:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346343",
    "user": "@embray"
}
```

Replying to [comment:86 embray]:
> the message about the Fortran flag really belongs with the gfortran checks, but for some reason (and I noticed this long before) that check gets inserted into the configure script early, possibly something to do with diversions but I'm not sure.  I'm not going to worry about it right now.

Ok, I couldn't help but to worry about it a little bit; I wanted to know what was going on here.  It's because each `SAGE_SPKG_CONFIGURE_` macro (e.g. `SAGE_SPKG_CONFIGURE_GFORTRAN`) is defined with `AC_DEFUN_ONCE`--these are "one shot" macros that are expanded only once.  However, if you call an `AC_DEFUN_ONCE` macro inside an `AC_DEFUN_ONCE` macro, it orders things so that nested one-shot macros are expanded first (I think this may be to help prevent recursion).

I'm not sure if there's a good way to circumvent that for the sake of the "checking" messages.  Perhaps I can move them to outside the `SAGE_SPKG_CONFIGURE_` macros themselves.  Like I said, it's not terribly important though, and the end result is still consistent.



---

archive/issue_comments_346344.json:
```json
{
    "body": "Replying to [comment:87 jhpalmieri]:\n> Maybe you are using GNUisms in the bash script `bootstrap`.\n\nThank you.  This looks similar to the same silly issue that came up in #26013 with the BSD `find` not stripping trailing slashes from its argument.",
    "created_at": "2018-09-14T16:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346344",
    "user": "@embray"
}
```

Replying to [comment:87 jhpalmieri]:
> Maybe you are using GNUisms in the bash script `bootstrap`.

Thank you.  This looks similar to the same silly issue that came up in #26013 with the BSD `find` not stripping trailing slashes from its argument.



---

archive/issue_comments_346345.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-14T16:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346345",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346346.json:
```json
{
    "body": "I still do not see a meaningful output on FreeBSD (perhaps due to a GNUism somewhere?):\n\n```\nconfigure: === checking whether to install the yasm SPKG ===\nchecking SPKGs to install...\n```\n\n\n--- this is in part due to absent `amd64` case. If I add `|amd64` to the corresponding list of acrs I get\n\n\n```\nconfigure: === checking whether to install the yasm SPKG ===\nchecking for yasm supporting the adox instruction... /usr/local/bin/yasm\n```\n",
    "created_at": "2018-09-14T16:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346346",
    "user": "@dimpase"
}
```

I still do not see a meaningful output on FreeBSD (perhaps due to a GNUism somewhere?):

```
configure: === checking whether to install the yasm SPKG ===
checking SPKGs to install...
```


--- this is in part due to absent `amd64` case. If I add `|amd64` to the corresponding list of acrs I get


```
configure: === checking whether to install the yasm SPKG ===
checking for yasm supporting the adox instruction... /usr/local/bin/yasm
```




---

archive/issue_comments_346347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-14T16:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346347",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346348.json:
```json
{
    "body": "How about now?",
    "created_at": "2018-09-14T16:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346348",
    "user": "@embray"
}
```

How about now?



---

archive/issue_comments_346349.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-14T16:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346349",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346350.json:
```json
{
    "body": "Replying to [comment:92 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[8c8e09a](https://git.sagemath.org/sage.git/commit/?id=8c8e09a2dee22dc01cecdb4f987e882c8f8555c1)||`BSD find puts in extra slashes if you leave a trailing slash in the argument`||\n\nthis does not change anything in respect to comment 91",
    "created_at": "2018-09-14T16:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346350",
    "user": "@dimpase"
}
```

Replying to [comment:92 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[8c8e09a](https://git.sagemath.org/sage.git/commit/?id=8c8e09a2dee22dc01cecdb4f987e882c8f8555c1)||`BSD find puts in extra slashes if you leave a trailing slash in the argument`||

this does not change anything in respect to comment 91



---

archive/issue_comments_346351.json:
```json
{
    "body": "Replying to [comment:93 embray]:\n> How about now?\n\nThat helps. Now the pre-existing packages are not installed, so it behaves as it did with the `devel` branch.\n\nBy the way, `config.log` used to be in `logs/pkgs` with a symlink to `SAGE_ROOT`, and now it's just in `SAGE_ROOT`. I prefer it the old way, or I suppose we could switch it around so that `SAGE_ROOT/config.log` is a file and there is a symlink in `logs/pkgs`. In any case, it's nice being able to access all of the logs, together with their modification times, in one place.",
    "created_at": "2018-09-14T17:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346351",
    "user": "@jhpalmieri"
}
```

Replying to [comment:93 embray]:
> How about now?

That helps. Now the pre-existing packages are not installed, so it behaves as it did with the `devel` branch.

By the way, `config.log` used to be in `logs/pkgs` with a symlink to `SAGE_ROOT`, and now it's just in `SAGE_ROOT`. I prefer it the old way, or I suppose we could switch it around so that `SAGE_ROOT/config.log` is a file and there is a symlink in `logs/pkgs`. In any case, it's nice being able to access all of the logs, together with their modification times, in one place.



---

archive/issue_comments_346352.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-15T03:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346352",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346353.json:
```json
{
    "body": "Looks good to me. I've opened a follow-up ticket #26286.\n\nPlease do not forget to add a new configure tarball etc.",
    "created_at": "2018-09-15T03:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346353",
    "user": "@dimpase"
}
```

Looks good to me. I've opened a follow-up ticket #26286.

Please do not forget to add a new configure tarball etc.



---

archive/issue_comments_346354.json:
```json
{
    "body": "Replying to [comment:91 dimpase]:\n> I still do not see a meaningful output on FreeBSD (perhaps due to a GNUism somewhere?):\n> {{{\n> configure: === checking whether to install the yasm SPKG ===\n> checking SPKGs to install...\n> }}}\n> \n> --- this is in part due to absent `amd64` case. If I add `|amd64` to the corresponding list of acrs I get\n> \n> {{{\n> configure: === checking whether to install the yasm SPKG ===\n> checking for yasm supporting the adox instruction... /usr/local/bin/yasm\n> }}}\n\nPlease just open a separate ticket for that.",
    "created_at": "2018-09-17T12:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346354",
    "user": "@embray"
}
```

Replying to [comment:91 dimpase]:
> I still do not see a meaningful output on FreeBSD (perhaps due to a GNUism somewhere?):
> {{{
> configure: === checking whether to install the yasm SPKG ===
> checking SPKGs to install...
> }}}
> 
> --- this is in part due to absent `amd64` case. If I add `|amd64` to the corresponding list of acrs I get
> 
> {{{
> configure: === checking whether to install the yasm SPKG ===
> checking for yasm supporting the adox instruction... /usr/local/bin/yasm
> }}}

Please just open a separate ticket for that.



---

archive/issue_comments_346355.json:
```json
{
    "body": "Thanks.",
    "created_at": "2018-09-17T12:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346355",
    "user": "@embray"
}
```

Thanks.



---

archive/issue_comments_346356.json:
```json
{
    "body": "This is *probably* going to blow up at least one of the buildbots without a new configure package, but I'd rather wait and see before going through that song and dance again.",
    "created_at": "2018-09-17T12:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346356",
    "user": "@embray"
}
```

This is *probably* going to blow up at least one of the buildbots without a new configure package, but I'd rather wait and see before going through that song and dance again.



---

archive/issue_comments_346357.json:
```json
{
    "body": "This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have\n`patch` recognised by `configure` as not needed to be installed, \n`sage -i patch` goes and installs it from source...",
    "created_at": "2018-10-29T16:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346357",
    "user": "@dimpase"
}
```

This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have
`patch` recognised by `configure` as not needed to be installed, 
`sage -i patch` goes and installs it from source...



---

archive/issue_comments_346358.json:
```json
{
    "body": "Replying to [comment:101 dimpase]:\n> This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have\n> `patch` recognised by `configure` as not needed to be installed, \n> `sage -i patch` goes and installs it from source...\n\nI think that's a feature. Even if a package is installed by the system, it should still be possible to manually install the Sage package.",
    "created_at": "2018-10-29T16:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346358",
    "user": "@jdemeyer"
}
```

Replying to [comment:101 dimpase]:
> This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have
> `patch` recognised by `configure` as not needed to be installed, 
> `sage -i patch` goes and installs it from source...

I think that's a feature. Even if a package is installed by the system, it should still be possible to manually install the Sage package.



---

archive/issue_comments_346359.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2018-10-29T22:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346359",
    "user": "@vbraun"
}
```

Merge conflict



---

archive/issue_comments_346360.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-29T22:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346360",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346361.json:
```json
{
    "body": "Replying to [comment:102 jdemeyer]:\n> Replying to [comment:101 dimpase]:\n> > This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have\n> > `patch` recognised by `configure` as not needed to be installed, \n> > `sage -i patch` goes and installs it from source...\n> \n> I think that's a feature. Even if a package is installed by the system, it should still be possible to manually install the Sage package.\n\nYep. I said the same to Dima on the bus the other day. I can see his point and I did debate this myself, but ultimately I see `sage -i` as meaning \"install the Sage SPKG\".  It can still be uninstalled too with sage-spkg-uninstall.  This could/should be made easier of course.",
    "created_at": "2018-10-31T11:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346361",
    "user": "@embray"
}
```

Replying to [comment:102 jdemeyer]:
> Replying to [comment:101 dimpase]:
> > This patch does seem not to work for `sage -i` and `sage -f` - e.g. even if I have
> > `patch` recognised by `configure` as not needed to be installed, 
> > `sage -i patch` goes and installs it from source...
> 
> I think that's a feature. Even if a package is installed by the system, it should still be possible to manually install the Sage package.

Yep. I said the same to Dima on the bus the other day. I can see his point and I did debate this myself, but ultimately I see `sage -i` as meaning "install the Sage SPKG".  It can still be uninstalled too with sage-spkg-uninstall.  This could/should be made easier of course.



---

archive/issue_comments_346362.json:
```json
{
    "body": "It's actually a very nice feature.  For example, once I clean up the BLAS detection stuff a bit, it will become easier to use Sage with whatever the system's BLAS is (if indeed we do detect a usable one).  But then, if need be, one can easily (in theory) use `sage -i openblas` to build and install their own tuned openblas for their Sage, for example.",
    "created_at": "2018-10-31T11:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346362",
    "user": "@embray"
}
```

It's actually a very nice feature.  For example, once I clean up the BLAS detection stuff a bit, it will become easier to use Sage with whatever the system's BLAS is (if indeed we do detect a usable one).  But then, if need be, one can easily (in theory) use `sage -i openblas` to build and install their own tuned openblas for their Sage, for example.



---

archive/issue_comments_346363.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-10-31T11:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346363",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346364.json:
```json
{
    "body": "I rebased on current develop and there was no merge conflict.  So I guess it's another mystery conflict...",
    "created_at": "2018-10-31T11:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346364",
    "user": "@embray"
}
```

I rebased on current develop and there was no merge conflict.  So I guess it's another mystery conflict...



---

archive/issue_comments_346365.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-10-31T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346365",
    "user": "@dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_346366.json:
```json
{
    "body": "tried to merge the vbraun's branch, it works now.",
    "created_at": "2018-10-31T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346366",
    "user": "@dimpase"
}
```

tried to merge the vbraun's branch, it works now.



---

archive/issue_comments_346367.json:
```json
{
    "body": "Merge conflict\n\nAlso if you are merging my private branch then prepare for a world of pain as I'm going to rewrite it before publishing...",
    "created_at": "2018-10-31T21:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346367",
    "user": "@vbraun"
}
```

Merge conflict

Also if you are merging my private branch then prepare for a world of pain as I'm going to rewrite it before publishing...



---

archive/issue_comments_346368.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-31T21:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346368",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346369.json:
```json
{
    "body": "Replying to [comment:109 vbraun]:\n> Merge conflict\n> \n> Also if you are merging my private branch then prepare for a world of pain as I'm going to rewrite it before publishing...\n\nNo, this was not done, certainly.\nNow we have the beta branch to rebase this against, could you please put in into the next beta?",
    "created_at": "2018-11-01T21:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346369",
    "user": "@dimpase"
}
```

Replying to [comment:109 vbraun]:
> Merge conflict
> 
> Also if you are merging my private branch then prepare for a world of pain as I'm going to rewrite it before publishing...

No, this was not done, certainly.
Now we have the beta branch to rebase this against, could you please put in into the next beta?



---

archive/issue_comments_346370.json:
```json
{
    "body": "rebased",
    "created_at": "2018-11-02T10:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346370",
    "user": "@dimpase"
}
```

rebased



---

archive/issue_comments_346371.json:
```json
{
    "body": "hmm, something went wrong during rebase...",
    "created_at": "2018-11-02T10:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346371",
    "user": "@dimpase"
}
```

hmm, something went wrong during rebase...



---

archive/issue_comments_346372.json:
```json
{
    "body": "cutting/pasting from `git blame build/make/deps`:\n\nin the current develop branch (notice `xz`):\n\n```\n15c7b88bd76 build/make/deps     (Erik M. Bray    2018-07-17 15:59:31 +0000  81) TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc\n```\n\nin this ticket's branch (notice there is no `xz`):\n\n```\n9c1b4f6c243 build/make/deps     (Erik M. Bray    2018-07-17 15:59:31 +0000  80) TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc\n```\n\n\nand we have two very similar commits, but not quite:\n\n```\n$ git show 15c7b88bd76 | cat\ncommit 15c7b88bd76c58b769a06c2d4c8dede4ef33d850\nAuthor: Erik M. Bray <erik.bray@lri.fr>\nDate:   Tue Jul 17 15:59:31 2018 +0000\n\n    move this list into a TOOLCHAIN_DEPS variable we can use to inspect this list elsewhere\n\ndiff --git a/build/make/deps b/build/make/deps\nindex 822b91b175..632ffa7c0e 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -78,12 +78,11 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))\n # Note: This list is determined from the dependencies of the TOOLCHAIN\n # packages which include gcc, and optionally ccache; in principle this\n # list is redundant.\n+TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc\n toolchain-deps:\n-\t$(MAKE) $(inst_zlib)\n-\t$(MAKE) $(inst_xz)\n-\t$(MAKE) $(MP_LIBRARY)\n-\t$(MAKE) $(inst_mpfr)\n-\t$(MAKE) $(inst_mpc)\n+\tfor pkg in $(TOOLCHAIN_DEPS); do \\\n+\t    $(MAKE) $$pkg; \\\n+\tdone\n \n all-toolchain: base-toolchain\n \t$(MAKE) toolchain-deps\ndima@hilbert /mnt/opt/Sage/sage-clang $ git show 9c1b4f6c243 | cat\ncommit 9c1b4f6c24391f952c73783503a33eea0469fdc2\nAuthor: Erik M. Bray <erik.bray@lri.fr>\nDate:   Tue Jul 17 15:59:31 2018 +0000\n\n    move this list into a TOOLCHAIN_DEPS variable we can use to inspect this list elsewhere\n\ndiff --git a/build/make/deps b/build/make/deps\nindex 24508b82a4..4f3dc4588c 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -75,11 +75,14 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))\n # unconditionally. We still use the dependency checking from $(MAKE),\n # so this will not trigger useless rebuilds.\n # See #14168 and #14232.\n+# Note: This list is determined from the dependencies of the TOOLCHAIN\n+# packages which include gcc, and optionally ccache; in principle this\n+# list is redundant.\n+TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc\n toolchain-deps:\n-\t$(MAKE) $(inst_zlib)\n-\t$(MAKE) $(MP_LIBRARY)\n-\t$(MAKE) $(inst_mpfr)\n-\t$(MAKE) $(inst_mpc)\n+\tfor pkg in $(TOOLCHAIN_DEPS); do \\\n+\t    $(MAKE) $$pkg; \\\n+\tdone\n \n all-toolchain: base-toolchain\n \t$(MAKE) toolchain-deps\n```\n\n\nThis looks very fishy, as the dates/times are the same, only hashes are different.\nAnd merging this ticket branch into develop does not quite work, as e.g. `build/make/deps` does not get updated!\n\nErik, Volker, any ideas what's up there?\n \n----\nNew commits:",
    "created_at": "2018-11-02T13:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346372",
    "user": "@dimpase"
}
```

cutting/pasting from `git blame build/make/deps`:

in the current develop branch (notice `xz`):

```
15c7b88bd76 build/make/deps     (Erik M. Bray    2018-07-17 15:59:31 +0000  81) TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc
```

in this ticket's branch (notice there is no `xz`):

```
9c1b4f6c243 build/make/deps     (Erik M. Bray    2018-07-17 15:59:31 +0000  80) TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc
```


and we have two very similar commits, but not quite:

```
$ git show 15c7b88bd76 | cat
commit 15c7b88bd76c58b769a06c2d4c8dede4ef33d850
Author: Erik M. Bray <erik.bray@lri.fr>
Date:   Tue Jul 17 15:59:31 2018 +0000

    move this list into a TOOLCHAIN_DEPS variable we can use to inspect this list elsewhere

diff --git a/build/make/deps b/build/make/deps
index 822b91b175..632ffa7c0e 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -78,12 +78,11 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))
 # Note: This list is determined from the dependencies of the TOOLCHAIN
 # packages which include gcc, and optionally ccache; in principle this
 # list is redundant.
+TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc
 toolchain-deps:
-	$(MAKE) $(inst_zlib)
-	$(MAKE) $(inst_xz)
-	$(MAKE) $(MP_LIBRARY)
-	$(MAKE) $(inst_mpfr)
-	$(MAKE) $(inst_mpc)
+	for pkg in $(TOOLCHAIN_DEPS); do \
+	    $(MAKE) $$pkg; \
+	done
 
 all-toolchain: base-toolchain
 	$(MAKE) toolchain-deps
dima@hilbert /mnt/opt/Sage/sage-clang $ git show 9c1b4f6c243 | cat
commit 9c1b4f6c24391f952c73783503a33eea0469fdc2
Author: Erik M. Bray <erik.bray@lri.fr>
Date:   Tue Jul 17 15:59:31 2018 +0000

    move this list into a TOOLCHAIN_DEPS variable we can use to inspect this list elsewhere

diff --git a/build/make/deps b/build/make/deps
index 24508b82a4..4f3dc4588c 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -75,11 +75,14 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))
 # unconditionally. We still use the dependency checking from $(MAKE),
 # so this will not trigger useless rebuilds.
 # See #14168 and #14232.
+# Note: This list is determined from the dependencies of the TOOLCHAIN
+# packages which include gcc, and optionally ccache; in principle this
+# list is redundant.
+TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc
 toolchain-deps:
-	$(MAKE) $(inst_zlib)
-	$(MAKE) $(MP_LIBRARY)
-	$(MAKE) $(inst_mpfr)
-	$(MAKE) $(inst_mpc)
+	for pkg in $(TOOLCHAIN_DEPS); do \
+	    $(MAKE) $$pkg; \
+	done
 
 all-toolchain: base-toolchain
 	$(MAKE) toolchain-deps
```


This looks very fishy, as the dates/times are the same, only hashes are different.
And merging this ticket branch into develop does not quite work, as e.g. `build/make/deps` does not get updated!

Erik, Volker, any ideas what's up there?
 
----
New commits:



---

archive/issue_comments_346373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-11-02T23:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346373",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_346374.json:
```json
{
    "body": "and if instead I rebase this ticket's branch over 8.4.beta2, I get a branch with a merge conflict.\n\nAt seems that at this point something needs to be done manually, for a reason I cannot comprehend...",
    "created_at": "2018-11-02T23:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346374",
    "user": "@dimpase"
}
```

and if instead I rebase this ticket's branch over 8.4.beta2, I get a branch with a merge conflict.

At seems that at this point something needs to be done manually, for a reason I cannot comprehend...



---

archive/issue_comments_346375.json:
```json
{
    "body": "Please just let me....",
    "created_at": "2018-11-06T11:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346375",
    "user": "@embray"
}
```

Please just let me....



---

archive/issue_comments_346376.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-11-06T11:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346376",
    "user": "@embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_346377.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-06T12:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346377",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346378.json:
```json
{
    "body": "This is rebased on latest develop and cleaned up now.  I think everything is good, but I want to re-check some of the gcc-related stuff just in case.\n----\nLast 10 new commits:",
    "created_at": "2018-11-06T12:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346378",
    "user": "@embray"
}
```

This is rebased on latest develop and cleaned up now.  I think everything is good, but I want to re-check some of the gcc-related stuff just in case.
----
Last 10 new commits:



---

archive/issue_comments_346379.json:
```json
{
    "body": "I think you ended up with the same slightly broken branch as I did in my rebase attempts - check that your `TOOLCHAIN_DEPS` variable in `build/make/deps` does not include `xz` --- cf comment 114.",
    "created_at": "2018-11-06T12:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346379",
    "user": "@dimpase"
}
```

I think you ended up with the same slightly broken branch as I did in my rebase attempts - check that your `TOOLCHAIN_DEPS` variable in `build/make/deps` does not include `xz` --- cf comment 114.



---

archive/issue_comments_346380.json:
```json
{
    "body": "I see what you're saying now.  That has nothing directly to do with this ticket actually.  I think that what happened was that I merged an old version of the branch from #25857 into the branch for #25188.  But then #25188 got merged into develop later, and brought in an old version of that commit ([15c7b88b](https://git.sagemath.org/sage.git/diff?id=15c7b88bd76c58b769a06c2d4c8dede4ef33d850)) into develop, superseding the correct version ([9c1b4f6c](https://git.sagemath.org/sage.git/diff?id=9c1b4f6c24391f952c73783503a33eea0469fdc2)) that was merged in when #25857 was merged.\n\nThat whole mess is my fault, and I apologize for the confusion it's caused for you.  I'll open a separate ticket to fix it.  But ultimately it doesn't impact this ticket.",
    "created_at": "2018-11-06T12:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346380",
    "user": "@embray"
}
```

I see what you're saying now.  That has nothing directly to do with this ticket actually.  I think that what happened was that I merged an old version of the branch from #25857 into the branch for #25188.  But then #25188 got merged into develop later, and brought in an old version of that commit ([15c7b88b](https://git.sagemath.org/sage.git/diff?id=15c7b88bd76c58b769a06c2d4c8dede4ef33d850)) into develop, superseding the correct version ([9c1b4f6c](https://git.sagemath.org/sage.git/diff?id=9c1b4f6c24391f952c73783503a33eea0469fdc2)) that was merged in when #25857 was merged.

That whole mess is my fault, and I apologize for the confusion it's caused for you.  I'll open a separate ticket to fix it.  But ultimately it doesn't impact this ticket.



---

archive/issue_comments_346381.json:
```json
{
    "body": "E.g. you can see:\n\n\n```\n$ git diff 8.5.beta1..8.5.beta2 -- build/make/deps\n```\n\n\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex a3abca3..bbe3277 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -75,15 +75,13 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))\n # unconditionally. We still use the dependency checking from $(MAKE),\n # so this will not trigger useless rebuilds.\n # See #14168 and #14232.\n-#\n-# Note: This list consists of only the *runtime* dependencies of the toolchain.\n-TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc\n-TOOLCHAIN_DEP_INSTS = \\\n-       $(foreach pkgname,$(TOOLCHAIN_DEPS),$(inst_$(pkgname)))\n-\n+# Note: This list is determined from the dependencies of the TOOLCHAIN\n+# packages which include gcc, and optionally ccache; in principle this\n+# list is redundant.\n+TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc\n toolchain-deps:\n-       for target in $(TOOLCHAIN_DEP_INSTS); do \\\n-           $(MAKE) $$target; \\\n+       for pkg in $(TOOLCHAIN_DEPS); do \\\n+           $(MAKE) $$pkg; \\\n        done\n\n all-toolchain: base-toolchain\n@@ -129,7 +127,6 @@ sagelib: \\\n                $(inst_arb) \\\n                $(BLAS) \\\n                $(inst_brial) \\\n-               $(inst_cephes) \\\n                $(inst_cliquer) \\\n                $(inst_cypari) \\\n                $(inst_cysignals) \\\n```\n\n\nso that just started in 8.5.beta2 since #25188 was merged in that build.  It was never intended that xz should be added to `TOOLCHAIN_DEPS` as part of that ticket. I just screwed up  :(",
    "created_at": "2018-11-06T12:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346381",
    "user": "@embray"
}
```

E.g. you can see:


```
$ git diff 8.5.beta1..8.5.beta2 -- build/make/deps
```



```diff
diff --git a/build/make/deps b/build/make/deps
index a3abca3..bbe3277 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -75,15 +75,13 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))
 # unconditionally. We still use the dependency checking from $(MAKE),
 # so this will not trigger useless rebuilds.
 # See #14168 and #14232.
-#
-# Note: This list consists of only the *runtime* dependencies of the toolchain.
-TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc
-TOOLCHAIN_DEP_INSTS = \
-       $(foreach pkgname,$(TOOLCHAIN_DEPS),$(inst_$(pkgname)))
-
+# Note: This list is determined from the dependencies of the TOOLCHAIN
+# packages which include gcc, and optionally ccache; in principle this
+# list is redundant.
+TOOLCHAIN_DEPS = zlib xz $(MP_LIBRARY) mpfr mpc
 toolchain-deps:
-       for target in $(TOOLCHAIN_DEP_INSTS); do \
-           $(MAKE) $$target; \
+       for pkg in $(TOOLCHAIN_DEPS); do \
+           $(MAKE) $$pkg; \
        done

 all-toolchain: base-toolchain
@@ -129,7 +127,6 @@ sagelib: \
                $(inst_arb) \
                $(BLAS) \
                $(inst_brial) \
-               $(inst_cephes) \
                $(inst_cliquer) \
                $(inst_cypari) \
                $(inst_cysignals) \
```


so that just started in 8.5.beta2 since #25188 was merged in that build.  It was never intended that xz should be added to `TOOLCHAIN_DEPS` as part of that ticket. I just screwed up  :(



---

archive/issue_comments_346382.json:
```json
{
    "body": "Replying to [comment:121 embray]:\n> I see what you're saying now.  That has nothing directly to do with this ticket actually. \n\nI think in Luxembourg I showed you a puzzling error that we traced to my using a branch with wrong `TOOLCHAIN_DEPS` - could you fix it here, instead of delaying to another ticket?",
    "created_at": "2018-11-06T12:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346382",
    "user": "@dimpase"
}
```

Replying to [comment:121 embray]:
> I see what you're saying now.  That has nothing directly to do with this ticket actually. 

I think in Luxembourg I showed you a puzzling error that we traced to my using a branch with wrong `TOOLCHAIN_DEPS` - could you fix it here, instead of delaying to another ticket?



---

archive/issue_comments_346383.json:
```json
{
    "body": "Replying to [comment:123 dimpase]:\n> Replying to [comment:121 embray]:\n> > I see what you're saying now.  That has nothing directly to do with this ticket actually. \n> \n> I think in Luxembourg I showed you a puzzling error that we traced to my using a branch with wrong `TOOLCHAIN_DEPS` - could you fix it here, instead of delaying to another ticket?\n\nPlease see above.  It really has nothing to do with this ticket and doesn't impact it one way or the other.  It can be fixed in a separate ticket totally independent from this one.  The only impact of this mistake is that the `xz` package was added to the toolchain dependencies, but Jeroen (I think) had pointed out to me that it's not actually needed there so it's sort of a superfluous dependency that gets built earlier than necessary.\n\nThis was only messing you up in Luxembourg since you were experimenting with adding a configure-time check for xz (thank you!) but since that hasn't actually been added yet there's no issue.  Also IIRC the bug with that was not actually because xz was included in TOOLCHAIN_DEPS, but due to a bug that I fixed in a later version of #25188.  I got confused because I was certain `xz` shouldn't be there and yet it was, due to the mistake I described above (which I was unaware of until now).",
    "created_at": "2018-11-06T12:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346383",
    "user": "@embray"
}
```

Replying to [comment:123 dimpase]:
> Replying to [comment:121 embray]:
> > I see what you're saying now.  That has nothing directly to do with this ticket actually. 
> 
> I think in Luxembourg I showed you a puzzling error that we traced to my using a branch with wrong `TOOLCHAIN_DEPS` - could you fix it here, instead of delaying to another ticket?

Please see above.  It really has nothing to do with this ticket and doesn't impact it one way or the other.  It can be fixed in a separate ticket totally independent from this one.  The only impact of this mistake is that the `xz` package was added to the toolchain dependencies, but Jeroen (I think) had pointed out to me that it's not actually needed there so it's sort of a superfluous dependency that gets built earlier than necessary.

This was only messing you up in Luxembourg since you were experimenting with adding a configure-time check for xz (thank you!) but since that hasn't actually been added yet there's no issue.  Also IIRC the bug with that was not actually because xz was included in TOOLCHAIN_DEPS, but due to a bug that I fixed in a later version of #25188.  I got confused because I was certain `xz` shouldn't be there and yet it was, due to the mistake I described above (which I was unaware of until now).



---

archive/issue_comments_346384.json:
```json
{
    "body": "If I add a `build/pkgs/xz/spkg-configure.m4`, e.g. from #26286, it won't work.\nThis is a problem to fix on this ticket, no?",
    "created_at": "2018-11-06T12:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346384",
    "user": "@dimpase"
}
```

If I add a `build/pkgs/xz/spkg-configure.m4`, e.g. from #26286, it won't work.
This is a problem to fix on this ticket, no?



---

archive/issue_comments_346385.json:
```json
{
    "body": "I believe there was also a discrepancy in another file in `build/make`, not only `deps`.",
    "created_at": "2018-11-06T12:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346385",
    "user": "@dimpase"
}
```

I believe there was also a discrepancy in another file in `build/make`, not only `deps`.



---

archive/issue_comments_346386.json:
```json
{
    "body": "Replying to [comment:125 dimpase]:\n> If I add a `build/pkgs/xz/spkg-configure.m4`, e.g. from #26286, it won't work.\n\nBut for reasons that have nothing to do with this ticket.  What I mean is, even if you added a configure-time check directly to `configure.ac` (e.g. ignoring the mechanisms implemented by this ticket) the same problem you were having (the SPKG being forcibly built when it wasn't needed) would occur.\n\nIf you want the specifics, there was an older version of #25857 that had this bug, which Jeroen pointed out: #25857#comment:26  I fixed the bug, and #25857 was merged without any (known) bugs.  I then accidentally reintroduced that bug in #25188 when I merged an old version of my branch for #25857 into that branch.  I simply need to add a new ticket to re-revert that bug.",
    "created_at": "2018-11-06T12:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346386",
    "user": "@embray"
}
```

Replying to [comment:125 dimpase]:
> If I add a `build/pkgs/xz/spkg-configure.m4`, e.g. from #26286, it won't work.

But for reasons that have nothing to do with this ticket.  What I mean is, even if you added a configure-time check directly to `configure.ac` (e.g. ignoring the mechanisms implemented by this ticket) the same problem you were having (the SPKG being forcibly built when it wasn't needed) would occur.

If you want the specifics, there was an older version of #25857 that had this bug, which Jeroen pointed out: #25857#comment:26  I fixed the bug, and #25857 was merged without any (known) bugs.  I then accidentally reintroduced that bug in #25188 when I merged an old version of my branch for #25857 into that branch.  I simply need to add a new ticket to re-revert that bug.



---

archive/issue_comments_346387.json:
```json
{
    "body": "Replying to [comment:126 dimpase]:\n> I believe there was also a discrepancy in another file in `build/make`, not only `deps`.\n\nYes, it looks like a change to build/make/Makefile.in was also accidentally reverted as part of the same bogus merge, though that one is merely cosmetic.",
    "created_at": "2018-11-06T12:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346387",
    "user": "@embray"
}
```

Replying to [comment:126 dimpase]:
> I believe there was also a discrepancy in another file in `build/make`, not only `deps`.

Yes, it looks like a change to build/make/Makefile.in was also accidentally reverted as part of the same bogus merge, though that one is merely cosmetic.



---

archive/issue_comments_346388.json:
```json
{
    "body": "How about fixing it on #26286 ?",
    "created_at": "2018-11-06T13:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346388",
    "user": "@dimpase"
}
```

How about fixing it on #26286 ?



---

archive/issue_comments_346389.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-06T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346389",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346390.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-11-07T14:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346390",
    "user": "@embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346391.json:
```json
{
    "body": "I still have some doubts about whether the gcc-related checks are working as intended.  I need to re-review my original fixes for those and ensure that this isn't causing a regression (I think it might be).\n\nPreviously I had incorporated all those fixes into this ticket but everything's been through so many revisions/rebases it's not clear that it's working as I expect.",
    "created_at": "2018-11-07T14:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346391",
    "user": "@embray"
}
```

I still have some doubts about whether the gcc-related checks are working as intended.  I need to re-review my original fixes for those and ensure that this isn't causing a regression (I think it might be).

Previously I had incorporated all those fixes into this ticket but everything's been through so many revisions/rebases it's not clear that it's working as I expect.



---

archive/issue_comments_346392.json:
```json
{
    "body": "In particular I think #25188 may have totally regressed; specifically the question of whether or not `./configure` lists the sage gcc package as installed.",
    "created_at": "2018-11-07T15:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346392",
    "user": "@embray"
}
```

In particular I think #25188 may have totally regressed; specifically the question of whether or not `./configure` lists the sage gcc package as installed.



---

archive/issue_comments_346393.json:
```json
{
    "body": "Yeah, I made at least one mistake while rebasing.  [This](https://git.sagemath.org/sage.git/tree/build/pkgs/gcc/spkg-configure.m4?id=5de0eb56f3dc990ac08b56a71b112a597d6efb4f#n66) should be spelled `sage_spkg_install_gcc=yes` now.",
    "created_at": "2018-11-07T15:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346393",
    "user": "@embray"
}
```

Yeah, I made at least one mistake while rebasing.  [This](https://git.sagemath.org/sage.git/tree/build/pkgs/gcc/spkg-configure.m4?id=5de0eb56f3dc990ac08b56a71b112a597d6efb4f#n66) should be spelled `sage_spkg_install_gcc=yes` now.



---

archive/issue_comments_346394.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-11-07T15:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346394",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346395.json:
```json
{
    "body": "Okay, now it should be good to go.",
    "created_at": "2018-11-07T15:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346395",
    "user": "@embray"
}
```

Okay, now it should be good to go.



---

archive/issue_comments_346396.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-11-07T15:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346396",
    "user": "@embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_346397.json:
```json
{
    "body": "Specifically, the commit at https://git.sagemath.org/sage.git/commit/?id=8fd4decd9e2d2f33ec9d3fa6a488c0df23b88764 is updated with the corrected spelling of that line.",
    "created_at": "2018-11-07T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346397",
    "user": "@embray"
}
```

Specifically, the commit at https://git.sagemath.org/sage.git/commit/?id=8fd4decd9e2d2f33ec9d3fa6a488c0df23b88764 is updated with the corrected spelling of that line.



---

archive/issue_comments_346398.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-09T17:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346398",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_346399.json:
```json
{
    "body": "see #26715 for a gfortran-related collateral damage caused here.",
    "created_at": "2018-11-18T10:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346399",
    "user": "@dimpase"
}
```

see #26715 for a gfortran-related collateral damage caused here.



---

archive/issue_comments_346400.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure\".",
    "created_at": "2019-02-12T09:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24682#issuecomment-346400",
    "user": "@dimpase"
}
```

Changing keywords from "" to "spkg-configure".
