# Issue 17691: opposite of cones and fans

archive/issues_017691.json:
```json
{
    "body": "CC:  @vbraun @novoselt jkeitel\n\nKeywords: cone, fan, negative\n\nit would be useful to be able to write -C and -F\nfor the cone obtained by negating the rays of a cone, and same for a fan.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17928\n\n",
    "created_at": "2015-03-11T13:34:13Z",
    "labels": [
        "component: geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "opposite of cones and fans",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17691",
    "user": "https://github.com/fchapoton"
}
```
CC:  @vbraun @novoselt jkeitel

Keywords: cone, fan, negative

it would be useful to be able to write -C and -F
for the cone obtained by negating the rays of a cone, and same for a fan.


Issue created by migration from https://trac.sagemath.org/ticket/17928





---

archive/issue_comments_236213.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236213",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_236214.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-03-11T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236214",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_236215.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-11T18:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236215",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_236216.json:
```json
{
    "body": "That would be nice, but:\n1. The cone negation method is in a wrong class and constructs a wrong object.\n2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)",
    "created_at": "2015-03-11T18:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236216",
    "user": "https://github.com/novoselt"
}
```

That would be nice, but:
1. The cone negation method is in a wrong class and constructs a wrong object.
2. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)



---

archive/issue_comments_236217.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-11T19:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236218.json:
```json
{
    "body": "Thanks for your quick reaction.\n\nI think I have taken care of point 1.\n\nConcerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?\n\nBy the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?",
    "created_at": "2015-03-11T19:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236218",
    "user": "https://github.com/fchapoton"
}
```

Thanks for your quick reaction.

I think I have taken care of point 1.

Concerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?

By the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?



---

archive/issue_comments_236219.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-11T20:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236220.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-11T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236220",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_236221.json:
```json
{
    "body": "ok, this should be correct now, maybe ?",
    "created_at": "2015-03-11T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236221",
    "user": "https://github.com/fchapoton"
}
```

ok, this should be correct now, maybe ?



---

archive/issue_comments_236222.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236222",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_236223.json:
```json
{
    "body": "Looks good now.\n\nFor fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).",
    "created_at": "2015-03-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236223",
    "user": "https://github.com/novoselt"
}
```

Looks good now.

For fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).



---

archive/issue_comments_236224.json:
```json
{
    "body": "common refinement is now #17938",
    "created_at": "2015-03-12T10:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236224",
    "user": "https://github.com/fchapoton"
}
```

common refinement is now #17938



---

archive/issue_comments_236225.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-12T20:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17691#issuecomment-236225",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051038.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-12T20:21:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17691",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17691#event-51038"
}
```
