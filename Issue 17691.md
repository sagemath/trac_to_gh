# Issue 17691: opposite of cones and fans

Issue created by migration from https://trac.sagemath.org/ticket/17928

Original creator: chapoton

Original creation time: 2015-03-11 13:34:13

CC:  vbraun novoselt jkeitel

Keywords: cone, fan, negative

it would be useful to be able to write -C and -F
for the cone obtained by negating the rays of a cone, and same for a fan.



---

Comment by chapoton created at 2015-03-11 13:40:21

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-03-11 13:40:21

New commits:


---

Comment by novoselt created at 2015-03-11 18:14:14

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2015-03-11 18:14:14

That would be nice, but:
1. The cone negation method is in a wrong class and constructs a wrong object.
1. The cone and fan actual classes are very picky about the input - rays have to be immutable, as described in the documentation. Either run a loop to make them immutable or use `Cone` and `Fan` constructors that take care of it, `check=False` would make sense, of course. (It may also make sense to always set immutability in point collections instead of trying to be super efficient, but that's for another ticket and would require some manual work to eliminate current cycles.)


---

Comment by git created at 2015-03-11 19:43:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-03-11 19:46:34

Thanks for your quick reaction.

I think I have taken care of point 1.

Concerning point 2, I am not sure to see the point. It seems that the current code does work. Could you give me a case where the opposite fan or cone (as build now) misbehaves ?

By the way, I would love to have a method to obtain the common refinment of two fans. Do you see an easy way to do that using existing code ?


---

Comment by git created at 2015-03-11 20:06:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-03-11 20:07:05

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-03-11 20:07:05

ok, this should be correct now, maybe ?


---

Comment by novoselt created at 2015-03-11 20:24:31

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2015-03-11 20:24:31

Looks good now.

For fan refinement: assuming they have the same support, you can map `fan1` to `fan2` by the identity map and allow domain subdivision. Then the domain `fan3` of the resulting `FanMorphism` will be the minimal subdivision. It may be nice to implement a method `fan1.common_refinement(fan2)` returning such a fan after constructing an opposite morphism as well (this will ensure common support, I am not sure how to check it otherwise except for the case of complete fans which should be handled separately for efficiency).


---

Comment by chapoton created at 2015-03-12 10:06:55

common refinement is now #17938


---

Comment by vbraun created at 2015-03-12 20:21:50

Resolution: fixed
