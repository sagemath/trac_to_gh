# Issue 11179: make flintqs-20070817 spkg build with -m64 rather than -march=opteron

archive/issues_011179.json:
```json
{
    "body": "Assignee: Mariah Lenox\n\nsage-4.7.rc2 built on an opteron system [skynet:flavius (x86_64-Linux-k8-fc)] with SAGE_FAT_BINARY=\"yes\", and then moved to another\nx86_64-Linux system will fail with a segmentation fault on the\nfollowing code:\n\n\n```\nset_random_seed(0)\np = next_prime(randrange(2^96))\nq = next_prime(randrange(2^97))\nn = p * q\nqsieve(n) \n```\n\n\n'qsieve' is from the flintqs-20070817 spkg, which by default builds\nwith -march=opteron on *all* x86_64 systems (*and* in 32-bit mode).\n\nIssue created by migration from https://trac.sagemath.org/ticket/11351\n\n",
    "created_at": "2011-05-19T13:42:36Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "make flintqs-20070817 spkg build with -m64 rather than -march=opteron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11179",
    "user": "mariah"
}
```
Assignee: Mariah Lenox

sage-4.7.rc2 built on an opteron system [skynet:flavius (x86_64-Linux-k8-fc)] with SAGE_FAT_BINARY="yes", and then moved to another
x86_64-Linux system will fail with a segmentation fault on the
following code:


```
set_random_seed(0)
p = next_prime(randrange(2^96))
q = next_prime(randrange(2^97))
n = p * q
qsieve(n) 
```


'qsieve' is from the flintqs-20070817 spkg, which by default builds
with -march=opteron on *all* x86_64 systems (*and* in 32-bit mode).

Issue created by migration from https://trac.sagemath.org/ticket/11351





---

archive/issue_comments_122849.json:
```json
{
    "body": "Attachment [flintqs-20070817.p6.spkg](tarball://root/attachments/some-uuid/ticket11351/flintqs-20070817.p6.spkg) by mariah created at 2011-05-19 13:52:36",
    "created_at": "2011-05-19T13:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122849",
    "user": "mariah"
}
```

Attachment [flintqs-20070817.p6.spkg](tarball://root/attachments/some-uuid/ticket11351/flintqs-20070817.p6.spkg) by mariah created at 2011-05-19 13:52:36



---

archive/issue_comments_122850.json:
```json
{
    "body": "diff for review purposes only",
    "created_at": "2011-05-19T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122850",
    "user": "mariah"
}
```

diff for review purposes only



---

archive/issue_comments_122851.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-19T13:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122851",
    "user": "mariah"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_122852.json:
```json
{
    "body": "Attachment [flintqs-20070817.p5-p6.diff](tarball://root/attachments/some-uuid/ticket11351/flintqs-20070817.p5-p6.diff) by mariah created at 2011-05-19 13:55:43",
    "created_at": "2011-05-19T13:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122852",
    "user": "mariah"
}
```

Attachment [flintqs-20070817.p5-p6.diff](tarball://root/attachments/some-uuid/ticket11351/flintqs-20070817.p5-p6.diff) by mariah created at 2011-05-19 13:55:43



---

archive/issue_comments_122853.json:
```json
{
    "body": "Quite messy.\n\nWe should just apply a single patch to the Makefile, and set / pass the appropriate variables (`CXXFLAGS`, `CXXINCS` -- usually `CPPFLAGS`, `LIBS`, perhaps `CXXFLAG64`, which we can put into `CXXFLAGS`).\n\nAlso, `$(CPP)` should be `$(CXX)`; the FLINT (1.5.x) Makefile is btw. equally bad.\n\n`-m64` or an analogue (if `SAGE64=yes`) is only necessary on 64-bit platforms that default to 32-bit builds, i.e. SunOS / Solaris and MacOS X 10.5.\n\n\nUsing `stdint.h`, `uint32_t` and `uint64_t` would be more portable, too.",
    "created_at": "2011-08-05T15:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122853",
    "user": "@nexttime"
}
```

Quite messy.

We should just apply a single patch to the Makefile, and set / pass the appropriate variables (`CXXFLAGS`, `CXXINCS` -- usually `CPPFLAGS`, `LIBS`, perhaps `CXXFLAG64`, which we can put into `CXXFLAGS`).

Also, `$(CPP)` should be `$(CXX)`; the FLINT (1.5.x) Makefile is btw. equally bad.

`-m64` or an analogue (if `SAGE64=yes`) is only necessary on 64-bit platforms that default to 32-bit builds, i.e. SunOS / Solaris and MacOS X 10.5.


Using `stdint.h`, `uint32_t` and `uint64_t` would be more portable, too.



---

archive/issue_comments_122854.json:
```json
{
    "body": "dear leif,\n\nYour comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to \"needs_work\" or do you want to give it a positive review and open a new ticket for your comment?",
    "created_at": "2011-08-23T04:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122854",
    "user": "@koffie"
}
```

dear leif,

Your comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to "needs_work" or do you want to give it a positive review and open a new ticket for your comment?



---

archive/issue_comments_122855.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-23T21:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122855",
    "user": "@malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_122856.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2011-08-23T21:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122856",
    "user": "@malb"
}
```

Looks good to me.



---

archive/issue_comments_122857.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122857",
    "user": "@williamstein"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_comments_122858.json:
```json
{
    "body": "Replying to [comment:3 mderickx]:\n> dear leif,\n> \n> Your comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to \"needs_work\" or do you want to give it a positive review and open a new ticket for your comment?\n\nI would have been happy if some of that had been fixed *here*. The new spkg \"works\", so I didn't set the ticket to \"needs work\", but having a couple of scary Makefiles is still odd...\n\n(I'm well aware some others really like postponing things... ;-) And I'm personally not going to open up a follow-up for that atm.)",
    "created_at": "2011-08-25T04:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122858",
    "user": "@nexttime"
}
```

Replying to [comment:3 mderickx]:
> dear leif,
> 
> Your comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to "needs_work" or do you want to give it a positive review and open a new ticket for your comment?

I would have been happy if some of that had been fixed *here*. The new spkg "works", so I didn't set the ticket to "needs work", but having a couple of scary Makefiles is still odd...

(I'm well aware some others really like postponing things... ;-) And I'm personally not going to open up a follow-up for that atm.)



---

archive/issue_comments_122859.json:
```json
{
    "body": "Apologies, for some reason (I blame the jetlag!) I didn't even read the comments. Sorry!",
    "created_at": "2011-08-25T04:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122859",
    "user": "@malb"
}
```

Apologies, for some reason (I blame the jetlag!) I didn't even read the comments. Sorry!



---

archive/issue_comments_122860.json:
```json
{
    "body": "Changing keywords from \"sd32\" to \"sd32 quadratic sieve\".",
    "created_at": "2011-09-08T21:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122860",
    "user": "@nexttime"
}
```

Changing keywords from "sd32" to "sd32 quadratic sieve".



---

archive/issue_comments_122861.json:
```json
{
    "body": "I wonder why we have this separate spkg at all, as Bill's quadratic sieve, presumably even a newer version, is included in FLINT (1.x) anyway.",
    "created_at": "2011-09-08T21:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122861",
    "user": "@nexttime"
}
```

I wonder why we have this separate spkg at all, as Bill's quadratic sieve, presumably even a newer version, is included in FLINT (1.x) anyway.



---

archive/issue_comments_122862.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-12T18:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122862",
    "user": "@nexttime"
}
```

Resolution: fixed



---

archive/issue_comments_122863.json:
```json
{
    "body": "Had to fix invalid changelog entry headings and file permissions.\n\nCorrected spkg at new location.",
    "created_at": "2011-09-23T05:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11179#issuecomment-122863",
    "user": "@nexttime"
}
```

Had to fix invalid changelog entry headings and file permissions.

Corrected spkg at new location.
