# Issue 11179: make flintqs-20070817 spkg build with -m64 rather than -march=opteron

Issue created by migration from Trac.

Original creator: mariah

Original creation time: 2011-05-19 13:42:36

Assignee: Mariah Lenox

sage-4.7.rc2 built on an opteron system [skynet:flavius (x86_64-Linux-k8-fc)] with SAGE_FAT_BINARY="yes", and then moved to another
x86_64-Linux system will fail with a segmentation fault on the
following code:


```
set_random_seed(0)
p = next_prime(randrange(2^96))
q = next_prime(randrange(2^97))
n = p * q
qsieve(n) 
```


'qsieve' is from the flintqs-20070817 spkg, which by default builds
with -march=opteron on _all_ x86_64 systems (_and_ in 32-bit mode).


---

Attachment


---

Comment by mariah created at 2011-05-19 13:52:58

diff for review purposes only


---

Comment by mariah created at 2011-05-19 13:55:43

Changing status from new to needs_review.


---

Attachment


---

Comment by leif created at 2011-08-05 15:12:34

Quite messy.

We should just apply a single patch to the Makefile, and set / pass the appropriate variables (`CXXFLAGS`, `CXXINCS` -- usually `CPPFLAGS`, `LIBS`, perhaps `CXXFLAG64`, which we can put into `CXXFLAGS`).

Also, `$(CPP)` should be `$(CXX)`; the FLINT (1.5.x) Makefile is btw. equally bad.

`-m64` or an analogue (if `SAGE64=yes`) is only necessary on 64-bit platforms that default to 32-bit builds, i.e. SunOS / Solaris and MacOS X 10.5.


Using `stdint.h`, `uint32_t` and `uint64_t` would be more portable, too.


---

Comment by mderickx created at 2011-08-23 04:29:34

dear leif,

Your comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to "needs_work" or do you want to give it a positive review and open a new ticket for your comment?


---

Comment by malb created at 2011-08-23 21:24:57

Changing status from needs_review to positive_review.


---

Comment by malb created at 2011-08-23 21:24:57

Looks good to me.


---

Comment by was created at 2011-08-24 23:36:27

Changing keywords from "" to "sd32".


---

Comment by leif created at 2011-08-25 04:48:21

Replying to [comment:3 mderickx]:
> dear leif,
> 
> Your comment sounds like there is a lot still to be done. Do you think this tickets needs to change it's status to "needs_work" or do you want to give it a positive review and open a new ticket for your comment?

I would have been happy if some of that had been fixed _here_. The new spkg "works", so I didn't set the ticket to "needs work", but having a couple of scary Makefiles is still odd...

(I'm well aware some others really like postponing things... ;-) And I'm personally not going to open up a follow-up for that atm.)


---

Comment by malb created at 2011-08-25 04:54:47

Apologies, for some reason (I blame the jetlag!) I didn't even read the comments. Sorry!


---

Comment by leif created at 2011-09-08 21:31:53

Changing keywords from "sd32" to "sd32 quadratic sieve".


---

Comment by leif created at 2011-09-08 21:31:53

I wonder why we have this separate spkg at all, as Bill's quadratic sieve, presumably even a newer version, is included in FLINT (1.x) anyway.


---

Comment by leif created at 2011-09-12 18:41:09

Resolution: fixed


---

Comment by leif created at 2011-09-23 05:28:25

Had to fix invalid changelog entry headings and file permissions.

Corrected spkg at new location.
