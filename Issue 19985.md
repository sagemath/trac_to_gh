# Issue 19985: One-off doctest failures in a fresh install

archive/issues_019985.json:
```json
{
    "body": "CC:  @jdemeyer @embray @nthiery\n\nI'm getting some irrelevant doctests failures (on branch develop), due to some Matplotlib first time artifacts.\n\n\n```\nsage -t --long src/sage/geometry/fan.py\n**********************************************************************\nFile \"src/sage/geometry/fan.py\", line 2887, in sage.geometry.fan.?.plot\nFailed example:\n    fan.plot()\nExpected:\n    Graphics object consisting of 31 graphics primitives\nGot:\n    doctest:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.\n    Graphics object consisting of 31 graphics primitives\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.geometry.fan.?.plot\n    [492 tests, 1 failure, 9.60 s]\nsage -t --long src/sage/categories/coxeter_groups.py\n**********************************************************************\nFile \"src/sage/categories/coxeter_groups.py\", line 1681, in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.bruhat_lower_cov\ners\nFailed example:\n    P.show()\nExpected nothing\nGot:\n    doctest:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.\n**********************************************************************\n1 item had failures:\n   1 of  15 in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.bruhat_lower_covers\n    [461 tests, 1 failure, 18.31 s]\n```\n\n\nOf course, the failures go away when the tests are rerun. Any way we can avoid these failures?\n\nIssue created by migration from https://trac.sagemath.org/ticket/20222\n\n",
    "created_at": "2016-03-16T13:43:45Z",
    "labels": [
        "doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "One-off doctest failures in a fresh install",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19985",
    "user": "@defeo"
}
```
CC:  @jdemeyer @embray @nthiery

I'm getting some irrelevant doctests failures (on branch develop), due to some Matplotlib first time artifacts.


```
sage -t --long src/sage/geometry/fan.py
**********************************************************************
File "src/sage/geometry/fan.py", line 2887, in sage.geometry.fan.?.plot
Failed example:
    fan.plot()
Expected:
    Graphics object consisting of 31 graphics primitives
Got:
    doctest:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.
    Graphics object consisting of 31 graphics primitives
**********************************************************************
1 item had failures:
   1 of   3 in sage.geometry.fan.?.plot
    [492 tests, 1 failure, 9.60 s]
sage -t --long src/sage/categories/coxeter_groups.py
**********************************************************************
File "src/sage/categories/coxeter_groups.py", line 1681, in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.bruhat_lower_cov
ers
Failed example:
    P.show()
Expected nothing
Got:
    doctest:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.
**********************************************************************
1 item had failures:
   1 of  15 in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.bruhat_lower_covers
    [461 tests, 1 failure, 18.31 s]
```


Of course, the failures go away when the tests are rerun. Any way we can avoid these failures?

Issue created by migration from https://trac.sagemath.org/ticket/20222





---

archive/issue_comments_275245.json:
```json
{
    "body": "Running tests inside a fresh docker container could be a good way to check for problems like this.",
    "created_at": "2016-03-16T13:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275245",
    "user": "@jdemeyer"
}
```

Running tests inside a fresh docker container could be a good way to check for problems like this.



---

archive/issue_comments_275246.json:
```json
{
    "body": "Still don't have automated builds of the sagemath-develop container running yet, but hope to have that sooner or later.",
    "created_at": "2016-03-16T14:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275246",
    "user": "@embray"
}
```

Still don't have automated builds of the sagemath-develop container running yet, but hope to have that sooner or later.



---

archive/issue_comments_275247.json:
```json
{
    "body": "Changing component from doctest framework to build.",
    "created_at": "2016-10-25T07:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275247",
    "user": "@jdemeyer"
}
```

Changing component from doctest framework to build.



---

archive/issue_comments_275248.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2016-10-25T07:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275248",
    "user": "@jdemeyer"
}
```

Changing priority from minor to major.



---

archive/issue_comments_275249.json:
```json
{
    "body": "Can't we simply ignore these warnings?",
    "created_at": "2016-10-25T07:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275249",
    "user": "@jdemeyer"
}
```

Can't we simply ignore these warnings?



---

archive/issue_comments_275250.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Can't we simply ignore these warnings?\n\nWhat's the standard way to ignore warnings in doctests, again?",
    "created_at": "2016-10-25T09:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275250",
    "user": "@defeo"
}
```

Replying to [comment:4 jdemeyer]:
> Can't we simply ignore these warnings?

What's the standard way to ignore warnings in doctests, again?



---

archive/issue_comments_275251.json:
```json
{
    "body": "I wonder if the initial sage startup shouldn't also take care of this.",
    "created_at": "2016-11-07T13:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275251",
    "user": "@embray"
}
```

I wonder if the initial sage startup shouldn't also take care of this.



---

archive/issue_comments_275252.json:
```json
{
    "body": "Replying to [comment:6 embray]:\n> I wonder if the initial sage startup shouldn't also take care of this.\n\nThat's not really possible because the relevant matplotlib files are *user* files (inside `$DOT_SAGE`, which is typically in `$HOME`), not *system* files.",
    "created_at": "2016-11-07T13:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275252",
    "user": "@jdemeyer"
}
```

Replying to [comment:6 embray]:
> I wonder if the initial sage startup shouldn't also take care of this.

That's not really possible because the relevant matplotlib files are *user* files (inside `$DOT_SAGE`, which is typically in `$HOME`), not *system* files.



---

archive/issue_comments_275253.json:
```json
{
    "body": "I think I see what you're saying--I'm so used at this point to running my own copy of sage that it's warped my viewpoint in ugly ways :)\n\nBut isn't there some initial creation of user files in `$DOT_SAGE` the first time a user runs Sage?  That's what I meant.",
    "created_at": "2016-11-07T14:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275253",
    "user": "@embray"
}
```

I think I see what you're saying--I'm so used at this point to running my own copy of sage that it's warped my viewpoint in ugly ways :)

But isn't there some initial creation of user files in `$DOT_SAGE` the first time a user runs Sage?  That's what I meant.



---

archive/issue_comments_275254.json:
```json
{
    "body": "Upstream issue: https://github.com/matplotlib/matplotlib/issues/5836",
    "created_at": "2017-01-01T03:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275254",
    "user": "@mkoeppe"
}
```

Upstream issue: https://github.com/matplotlib/matplotlib/issues/5836



---

archive/issue_comments_275255.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-14T09:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275255",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_275256.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-14T09:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275256",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_275257.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-14T09:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275257",
    "user": "@embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_275258.json:
```json
{
    "body": "Huh, I thought this was already fixed.  I haven't run into it in a while.",
    "created_at": "2017-06-14T09:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275258",
    "user": "@embray"
}
```

Huh, I thought this was already fixed.  I haven't run into it in a while.



---

archive/issue_comments_275259.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-14T22:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275259",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_275260.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 81.6 src/sage/tests/startup.py\n**********************************************************************\nFile \"src/sage/tests/startup.py\", line 6, in sage.tests.startup\nFailed example:\n    'numpy' in sys.modules\nExpected:\n    False\nGot:\n    True\n**********************************************************************\nFile \"src/sage/tests/startup.py\", line 8, in sage.tests.startup\nFailed example:\n    'pyparsing' in sys.modules\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n1 item had failures:\n   2 of   7 in sage.tests.startup\n    [6 tests, 2 failures, 1.47 s]\n```\n",
    "created_at": "2017-06-14T22:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275260",
    "user": "@vbraun"
}
```


```
sage -t --long --warn-long 81.6 src/sage/tests/startup.py
**********************************************************************
File "src/sage/tests/startup.py", line 6, in sage.tests.startup
Failed example:
    'numpy' in sys.modules
Expected:
    False
Got:
    True
**********************************************************************
File "src/sage/tests/startup.py", line 8, in sage.tests.startup
Failed example:
    'pyparsing' in sys.modules
Expected:
    False
Got:
    True
**********************************************************************
1 item had failures:
   2 of   7 in sage.tests.startup
    [6 tests, 2 failures, 1.47 s]
```




---

archive/issue_comments_275261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-19T09:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-19T09:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275263.json:
```json
{
    "body": "New version which imports matplotlib in a forked child process.",
    "created_at": "2017-06-19T09:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275263",
    "user": "@jdemeyer"
}
```

New version which imports matplotlib in a forked child process.



---

archive/issue_comments_275264.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-19T09:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275264",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-25T09:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275266.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-14T01:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275266",
    "user": "@saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_275267.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-15T22:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275267",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_275268.json:
```json
{
    "body": "I'm seeing these failures again in 8.3.beta1.",
    "created_at": "2018-05-16T18:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275268",
    "user": "@jhpalmieri"
}
```

I'm seeing these failures again in 8.3.beta1.



---

archive/issue_comments_275269.json:
```json
{
    "body": "See #25375 for a followup ticket.",
    "created_at": "2018-05-16T18:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19985#issuecomment-275269",
    "user": "@jhpalmieri"
}
```

See #25375 for a followup ticket.
