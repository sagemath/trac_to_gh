# Issue 19220: Adding a generator for full binary trees.

Issue created by migration from https://trac.sagemath.org/ticket/19457

Original creator: patxiku

Original creation time: 2015-10-22 13:28:04

Assignee: patxiku

CC:  kdilks

Keywords: binary trees, full

We add a generator for full binary trees.


---

Comment by tscrim created at 2015-10-26 18:57:58

I would very much like this as I want to implement free magmatic algebras generated by a set `X` (which are indexed by complete binary trees and a word in the alphabet `X`). However the `to_full` will also add a leaf to internal nodes which do not have 2 children, and the other method will remove all leaves, correct?


---

Comment by patxiku created at 2015-10-26 19:14:52

Yes.

I use the terminology given by the definition used in the implementation of binary trees : (see the documentation of the class BinaryTree from sage.combinat.binary_tree)

    Binary trees here mean ordered (a.k.a. plane) finite binary
    trees, where "ordered" means that the children of each node are
    ordered.

    Binary trees contain nodes and leaves, where each node has two
    children while each leaf has no children. The number of leaves
    of a binary tree always equals the number of nodes plus `1`.

Replying to [comment:3 tscrim]:
> I would very much like this as I want to implement free magmatic algebras generated by a set `X` (which are indexed by complete binary trees and a word in the alphabet `X`). However the `to_full` will also add a leaf to internal nodes which do not have 2 children, and the other method will remove all leaves, correct?


---

Comment by tscrim created at 2015-10-26 22:04:20

The definition in `BinaryTree` is not correct as it does not allow for the "nodes" with one element. IMO, a leaf is a node too.

From a quick lookover, the reason why binary trees don't compare to full binary trees is that they have different parents. There is an abuse that `BinaryTrees_size` does not know it is a facade parent for `BinaryTrees_all`, but it is why the equality works. To make the equality work by continuing this abuse, you should make `FullBinaryTrees_all` act as a facade for `BinaryTrees_all`.

Let me know when you're ready for me to do a formal review.

----
New commits:


---

Comment by git created at 2016-02-04 10:52:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by patxiku created at 2016-02-04 13:15:28

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-02-04 22:27:29

This is not an appropriate docstring

```
TODO : A name for nodes with two child leaves should be defined.
```


As mentioned in [comment:7 comment:7], why aren't you using facade parents in both `FullBinaryTrees_all` and `FullBinaryTrees_size`? This is designed for parents for which elements have other parents. Like non negative integers

```
sage: NN.an_element().parent()
Integer Ring
```

Moreover, you should not provide yourself `element_class`. This is intended to be done by the constructor of `Parent` from the nested class `Element`. In the case of a facade it makes no sense to have either a nested class `Element` or an `element_class`. Namely, the `_element_constructor_` should be something like

```
def _element_constructor_(self, data):
    return BinaryTree(data)
```


You should put definitions of `FullBinaryTrees`.

Avoid such call if possible

```
for lft in self.__class__(2*i+1):
```



---

Comment by vdelecroix created at 2016-02-04 22:27:29

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2016-03-08 02:49:51

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-03-08 02:49:51

Okay, I have addressed my issues. I also fixed the facade parent issue for all binary trees (not just full). I also renamed the `remove_two`-something-a-rather into the more intuitive (and correct) `prune()` as it removes _all_ leaves from a given (not necessarily full) tree. Vincent, if you agree with my changes, then please go ahead and set a positive review.
----
New commits:


---

Comment by vdelecroix created at 2016-04-07 20:10:30

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-04-07 20:10:30

I don't think the definition of `to_full` you give is correct: `Return the minimal full binary tree that is strictly larger than ``self``.` With this definition, I would expect

```
  o                        o
 /                        / \
o       -------->        o   o
 \                      / \
  o                    o   o
```

And moreover it is easy to see that, in general, there is no unique binary tree strictly larger than a given one! Am I wrong? The only thing which makes sense the explicit definition you gave after. But in that case I would not use the name `to_full` for the method name (which should be reservered for the minimal binary tree larger or equal to self).

You should not use ```self``` (with the quote) in the documentation. In that form it explicitely refers to an argument of a function. And `self` should not be considered as an argument since this is a method. You are free to use `self` (in its standard english sense) or something more explicit like `this tree`.

What is the point of defining locally a function `to_full_rec` which is used only once in the code?


---

Comment by git created at 2016-06-30 00:38:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by patxiku created at 2016-06-30 01:15:24

Thank you Travis for taking care of the fa√ßade issues, I did not know how to do it.

I did not find a nice name to replace `to_full`.

What about making a function `to_full` with an optional argument completion that can be equal to `minimal` or `bijective` :
 *`minimal` would give access to the operation you mentioned

 *`bijective` to the operation I wanted to implement initially


---

Comment by git created at 2016-06-30 23:21:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-01 07:03:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-07-01 07:09:05

I don't think `to_full` should have such an argument and instead have it be the bijection to full binary trees. If we wanted this extra functionality, it would be better served as another method `to_minimal_full`.

Perhaps as another option, we rename `to_full` to the more verbose `to_full_binary_tree`. Although I do appreciate the more concise name.

Lastly, Vincent and I disagree with the inclusion of ```self``` in the docstrings in general. I do agree that it should not appear in the INPUT: block (unless special restrictions are needed), and I should have not included it as such. However, the rest of the file uses ```self```, so I think that is a good case to continue using it in this file.


---

Comment by tscrim created at 2016-07-01 07:09:20

Changing keywords from "binary trees, full" to "binary trees, full, days78".


---

Comment by tscrim created at 2016-07-01 07:09:33

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-07-14 07:01:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2016-08-25 17:48:15

I'm not entirely sure what Patchbot is complaining about with coverage, but pending that being something that can be ignored, feel free to set a positive review on my behalf.


---

Comment by darij created at 2016-09-03 04:28:43

Patchbot is complaining about this (I believe):

```
+            k = (self._size - 1) / 2 # number of internal nodes
+            for i in range(k):
```

It says:

```
    TypeError: range() integer end argument expected, got float.
```

I assume you want `//`, not `/`, particularly with py3 in mind.


---

Comment by kdilks created at 2016-10-02 19:34:22

Patchbot seems happy now.


---

Comment by kdilks created at 2016-10-02 19:34:22

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-10-02 20:56:50

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2016-10-02 20:56:50

comment:17


---

Comment by tscrim created at 2016-10-03 04:14:58

I seem to be misremembering that I was justifying in comment:17. Thanks for finishing the review Kevin.


---

Comment by tscrim created at 2016-10-03 04:14:58

Changing status from needs_work to positive_review.


---

Comment by git created at 2016-10-03 04:34:52

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2016-10-03 04:34:52

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2016-10-03 04:36:01

From Darij's comment:23, I found and fixed a bug with the iteration of full binary trees. Kevin and/or Darij, can you verify?


---

Comment by darij created at 2016-10-03 04:45:57

That one bug is fixed; that said, I haven't looked at the rest of the code properly.


---

Comment by tscrim created at 2016-10-03 04:47:34

All that needs to be checked in my last change (other reviewers, e.g., Kevin have handled the others).


---

Comment by chapoton created at 2017-01-05 21:05:04

one typo: "emptry"


---

Comment by chapoton created at 2017-01-27 15:42:08

does not apply


---

Comment by chapoton created at 2017-01-27 15:42:08

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-04-16 22:24:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2017-04-16 22:24:38

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-04-16 22:24:38

Rebased and squashed.


---

Comment by chapoton created at 2017-04-17 14:24:22


```
+        Pruning the emptry tree is again the empty tree::
```



---

Comment by git created at 2017-04-17 15:44:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-17 15:44:48

Fixed (and patchbot came back green before the 1 character change).


---

Comment by chapoton created at 2017-06-02 14:30:21

green bot, if somebody cares


---

Comment by kdilks created at 2017-06-06 19:51:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-12 18:01:34

Resolution: fixed
