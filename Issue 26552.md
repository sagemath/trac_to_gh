# Issue 26552: Drop support for old-style division in coercion model

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-11-29 14:55:45

CC:  embray chapoton

Currently, the coercion model still support old-style Python 2 division in some places. In some places, old division is mapped to true division but not everywhere.

Instead, this ticket proposes to simplify the situation by immediately treating `Element.__div__` as `Element.__truediv__` and then removing all special-cases for old-style division from the coercion model.


---

Comment by jdemeyer created at 2018-11-29 15:20:56

This wasn't motivated by Python 3 but by allowing simplifications to the coercion model. Still, it's good for Python 3 porting too.
----
New commits:


---

Comment by jdemeyer created at 2018-11-29 15:20:56

Changing status from new to needs_review.


---

Comment by embray created at 2018-11-29 15:39:49

I guess the assumption here is that users would never be touching this stuff anyways, so explicitly removing support for `operator.div` is fine?  There would never be any third-party code that is impacted by this?

Fine by me otherwise, besides not being able to fully appreciate the impact.


---

Comment by jdemeyer created at 2018-11-29 15:55:26

Replying to [comment:5 embray]:
> I guess the assumption here is that users would never be touching this stuff anyways, so explicitly removing support for `operator.div` is fine?

Yes, that's the assumption. Users are expected to write

```
a / b
```

instead of

```
coercion_model.bin_op(a, b, operator.div)
```


As you can see from the patch, there were a few places in Sage explicitly calling `coercion_model.bin_op(a, b, operator.div)`, so those had to be fixed.

Even then, `coercion_model.bin_op(a, b, operator.div)` won't break completely: it will still coerce to a common parent and perform the division there. It will just break special cases for division (such as division of a polynomial by a constant).


---

Comment by jdemeyer created at 2018-11-29 16:05:47

Replying to [comment:5 embray]:
> There would never be any third-party code that is impacted by this?

Any third-party code impacted by this would also break in Python 3 if it implements `__div__` differently from `__truediv__`.


---

Comment by chapoton created at 2018-11-29 19:14:41

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-11-29 19:14:41

Looks good to me. I think I tried to do something like that a long time ago..


---

Comment by vbraun created at 2018-12-01 13:43:27

Resolution: fixed
