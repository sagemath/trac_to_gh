# Issue 26254: Maximum recursion depth exceeded when dumping a large Finite State Machines

Issue created by migration from https://trac.sagemath.org/ticket/26491

Original creator: cheuberg

Original creation time: 2018-10-15 12:36:00

CC:  dkrenn

When calling `dumps(fsm)` for some large finite state machine, maximum recursion depth might be exceeded:

```
  File "sage/misc/persist.pyx", line 285, in sage.misc.persist.dumps (build/cythonized/sage/misc/persist.c:4397)
  File "sage/misc/persist.pyx", line 256, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:3989)
  File "sage/misc/persist.pyx", line 835, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6593)
  File "sage/misc/persist.pyx", line 592, in sage.misc.persist._BasePickler.dump (build/cythonized/sage/misc/persist.c:5664)
RuntimeError: maximum recursion depth exceeded while calling a Python object
```



---

Comment by cheuberg created at 2018-10-15 12:36:41

I guess that the problem is that states save their outgoing transitions. So a dump will be recursive, because one state dumps its transitions which in turn dump their states and so on.


---

Comment by cheuberg created at 2018-10-21 19:34:30

Changing keywords from "" to "Pickle".


---

Comment by cheuberg created at 2018-10-21 19:34:30

Changing status from new to needs_review.


---

Comment by cheuberg created at 2018-10-21 19:34:30

New commits:


---

Comment by dkrenn created at 2018-10-21 19:52:20

LGTM (positive review) modulo patchbot (which has not finished yet).


---

Comment by dkrenn created at 2018-10-22 08:20:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-23 22:28:01

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
