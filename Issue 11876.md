# Issue 11876: FiniteEnumeratedSet creates elements that don't inherit from Element

archive/issues_011876.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  @hivert @kini @videlec\n\n\n```\n    sage: S = FiniteEnumeratedSet(['a','b','c'])\n    sage: S('a')\n    ...\n    TypeError: Cannot convert str to sage.structure.element.Element\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12048\n\n",
    "created_at": "2011-11-17T14:04:58Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "FiniteEnumeratedSet creates elements that don't inherit from Element",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11876",
    "user": "@roed314"
}
```
Assignee: sage-combinat

CC:  @hivert @kini @videlec


```
    sage: S = FiniteEnumeratedSet(['a','b','c'])
    sage: S('a')
    ...
    TypeError: Cannot convert str to sage.structure.element.Element
```


Issue created by migration from https://trac.sagemath.org/ticket/12048





---

archive/issue_comments_135957.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-17T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135957",
    "user": "@roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135958.json:
```json
{
    "body": "Attachment [12048.patch](tarball://root/attachments/some-uuid/ticket12048/12048.patch) by @roed314 created at 2011-11-17 14:15:13",
    "created_at": "2011-11-17T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135958",
    "user": "@roed314"
}
```

Attachment [12048.patch](tarball://root/attachments/some-uuid/ticket12048/12048.patch) by @roed314 created at 2011-11-17 14:15:13



---

archive/issue_comments_135959.json:
```json
{
    "body": "Hi David,\n\nI agree that `S('a')` in the example above should not fail. On the other hand, I am not keen on having a facade parent touching its elements. Florent: we should discuss about that.",
    "created_at": "2011-11-17T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135959",
    "user": "@nthiery"
}
```

Hi David,

I agree that `S('a')` in the example above should not fail. On the other hand, I am not keen on having a facade parent touching its elements. Florent: we should discuss about that.



---

archive/issue_comments_135960.json:
```json
{
    "body": "Yeah, I wasn't completely happy with this solution either.  But I think that even though the elements of a facade parent don't have to have the right parent, they really should be Elements.\n\nI'd be happy to entertain other solutions.",
    "created_at": "2011-11-17T17:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135960",
    "user": "@roed314"
}
```

Yeah, I wasn't completely happy with this solution either.  But I think that even though the elements of a facade parent don't have to have the right parent, they really should be Elements.

I'd be happy to entertain other solutions.



---

archive/issue_comments_135961.json:
```json
{
    "body": "I'm not going to debug this now since you guys may want to change the approach, but this patch produces doctest errors in sage.combinat.free_module that seem to be related to sorting.",
    "created_at": "2011-11-19T01:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135961",
    "user": "@roed314"
}
```

I'm not going to debug this now since you guys may want to change the approach, but this patch produces doctest errors in sage.combinat.free_module that seem to be related to sorting.



---

archive/issue_comments_135962.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T11:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135962",
    "user": "@loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135963.json:
```json
{
    "body": "Any movement here? This has ended up being a prerequisite for a couple of other patches (#12039, #12260) and hence a lot of good code is piling up behind this.\n\nI had a look at the error this causes in combinat.free_module, but I have no idea what's going on there.",
    "created_at": "2012-03-12T19:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135963",
    "user": "@loefflerd"
}
```

Any movement here? This has ended up being a prerequisite for a couple of other patches (#12039, #12260) and hence a lot of good code is piling up behind this.

I had a look at the error this causes in combinat.free_module, but I have no idea what's going on there.



---

archive/issue_comments_135964.json:
```json
{
    "body": "Replying to [comment:6 davidloeffler]:\n> Any movement here? This has ended up being a prerequisite for a couple of other patches (#12039, #12260) and hence a lot of good code is piling up behind this.\n> \n> I had a look at the error this causes in combinat.free_module, but I have no idea what's going on there.\n\nSorry that we forgot this one. I'll try to discuss it with Nicolas shortly. \n\nFlorent",
    "created_at": "2012-03-17T10:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135964",
    "user": "@hivert"
}
```

Replying to [comment:6 davidloeffler]:
> Any movement here? This has ended up being a prerequisite for a couple of other patches (#12039, #12260) and hence a lot of good code is piling up behind this.
> 
> I had a look at the error this causes in combinat.free_module, but I have no idea what's going on there.

Sorry that we forgot this one. I'll try to discuss it with Nicolas shortly. 

Florent



---

archive/issue_comments_135965.json:
```json
{
    "body": "Dear David,\n\nSorry for lagging so much behind on this ticket. I have finally been\ndiscussing with Florent, and we agreed on the following:\n\n- We definitely want to have facade parents in Sage whose elements\n  are plain Python objects. In fact we already have some: you can\n  e.g. define facade posets on strings or\n  sage.structure.parent.Set_PythonType(int).\n\n  Under many circumstances, wrapping objects sure has its advantages\n  (the element can make use of the parent information for certain\n  operations), but there are also many use cases where constantly\n  wrapping/unwrapping is a pain. \n\n  The worst is when a user gives a list of objects as input to\n  construct some parent A (e.g. a CombinatorialFreeModule), and then\n  (s)he accesses those objects from A he gets something that looks\n  and smell like the original objects but differ in behavior in a\n  subtle way\n\n- Coercion should work for those parents. It does not currently due\n  to this test whether the end result of __call__ is an Element. This\n  should be easy to fix. We already got hurt by that with Posets, and\n  had to resort to a hand made __call__ (yuck).\n\n- By default, we prefer FiniteEnumeratedSets to be facades by default\n  to not break backward compatibility, and also because this seems to\n  be what we need most of the time (because there are barely no\n  operations on the elements).\n\n\n. Now if there is a clear need for it, we could add a facade\n  option to have non facade FiniteEnumeratedSets.\n\nWhat do you think? Do you feel like fixing coercion as above?\n\nCheers,\n                                   Nicolas",
    "created_at": "2012-06-27T15:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135965",
    "user": "@nthiery"
}
```

Dear David,

Sorry for lagging so much behind on this ticket. I have finally been
discussing with Florent, and we agreed on the following:

- We definitely want to have facade parents in Sage whose elements
  are plain Python objects. In fact we already have some: you can
  e.g. define facade posets on strings or
  sage.structure.parent.Set_PythonType(int).

  Under many circumstances, wrapping objects sure has its advantages
  (the element can make use of the parent information for certain
  operations), but there are also many use cases where constantly
  wrapping/unwrapping is a pain. 

  The worst is when a user gives a list of objects as input to
  construct some parent A (e.g. a CombinatorialFreeModule), and then
  (s)he accesses those objects from A he gets something that looks
  and smell like the original objects but differ in behavior in a
  subtle way

- Coercion should work for those parents. It does not currently due
  to this test whether the end result of __call__ is an Element. This
  should be easy to fix. We already got hurt by that with Posets, and
  had to resort to a hand made __call__ (yuck).

- By default, we prefer FiniteEnumeratedSets to be facades by default
  to not break backward compatibility, and also because this seems to
  be what we need most of the time (because there are barely no
  operations on the elements).


. Now if there is a clear need for it, we could add a facade
  option to have non facade FiniteEnumeratedSets.

What do you think? Do you feel like fixing coercion as above?

Cheers,
                                   Nicolas



---

archive/issue_comments_135966.json:
```json
{
    "body": "Is this ticket still relevant? The example in the description now seems to work.",
    "created_at": "2018-03-23T08:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135966",
    "user": "@mezzarobba"
}
```

Is this ticket still relevant? The example in the description now seems to work.



---

archive/issue_comments_135967.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-23T14:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135967",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135968.json:
```json
{
    "body": "Indeed a custom `__call__` was introduced to support this #16280.",
    "created_at": "2018-03-23T14:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135968",
    "user": "@videlec"
}
```

Indeed a custom `__call__` was introduced to support this #16280.



---

archive/issue_comments_135969.json:
```json
{
    "body": "I confirm that this is a dup of #16280.",
    "created_at": "2018-03-24T08:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135969",
    "user": "@hivert"
}
```

I confirm that this is a dup of #16280.



---

archive/issue_comments_135970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-24T08:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135970",
    "user": "@hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135971.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135971",
    "user": "@videlec"
}
```

Resolution: wontfix



---

archive/issue_comments_135972.json:
```json
{
    "body": "closing positively reviewed duplicates",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11876#issuecomment-135972",
    "user": "@videlec"
}
```

closing positively reviewed duplicates
