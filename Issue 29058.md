# Issue 29058: Add GitHub CI workflow for cygwin

Issue created by migration from https://trac.sagemath.org/ticket/29295

Original creator: mkoeppe

Original creation time: 2020-03-07 21:55:47

CC:  embray




---

Comment by mkoeppe created at 2020-03-08 02:55:48

Last 10 new commits:


---

Comment by mkoeppe created at 2020-03-08 03:03:31

This works pretty well already (https://github.com/mkoeppe/sage/runs/492908952?check_suite_focus=true)

Issues:
- `configure` is run a second time at the beginning of `make`
- a non-Cygwin `python` is in `PATH` and is picked up by `sage-system-python`. This should really be fixed by #29090 ("configure forgets to check whether ANY Python is available on the system").


---

Comment by git created at 2020-03-08 05:13:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-03-09 01:14:46

Tests at https://github.com/mkoeppe/sage/actions/runs/51902280


---

Comment by git created at 2020-03-09 01:17:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-03-12 22:13:07

I see here in the log some probably known to Erik issue, crypt module does not build for py3

```
building '_crypt' extension
gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -std=c99 -Wextra -Wno-unused-result -Wno-unused-parameter -Wno-missing-field-initializers -Wno-cast-function-type -Werror=implicit-function-declaration -I./Include -I/cygdrive/d/a/sage/sage/local/include -I. -I/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Include -I/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src -c /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.c -o build/temp.cygwin-3.1.4-x86_64-3.7/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.o
gcc -shared -Wl,--enable-auto-image-base -L/cygdrive/d/a/sage/sage/local/lib -Wl,-rpath,/cygdrive/d/a/sage/sage/local/lib -L. -L/cygdrive/d/a/sage/sage/local/lib -Wl,-rpath,/cygdrive/d/a/sage/sage/local/lib -L. -L/cygdrive/d/a/sage/sage/local/lib -Wl,-rpath,/cygdrive/d/a/sage/sage/local/lib build/temp.cygwin-3.1.4-x86_64-3.7/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.o -L. -L/cygdrive/d/a/sage/sage/local/lib -L/usr/local/lib -L. -lpython3.7m -o build/lib.cygwin-3.1.4-x86_64-3.7/_crypt.dll
/usr/lib/gcc/x86_64-pc-cygwin/9.2.0/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.1.4-x86_64-3.7/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.o: in function `crypt_crypt_impl':
/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.c:43: undefined reference to `crypt'
/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/python3-3.7.3.p1/src/Modules/_cryptmodule.c:43:(.text+0x3a): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `crypt'
collect2: error: ld returned 1 exit status
```

maybe it's just a forgotten Cygwin package:
https://cygwin.com/packages/summary/libcrypt0.html ?


---

Comment by mkoeppe created at 2020-03-12 22:17:02

See also #29012


---

Comment by git created at 2020-03-12 22:37:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-03-12 23:12:05

Changing status from new to needs_review.


---

Comment by git created at 2020-03-13 00:59:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-13 01:00:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-03-13 08:30:34

oh, right, it should have been https://cygwin.com/packages/summary/libcrypt-devel.html


---

Comment by mkoeppe created at 2020-03-13 20:12:10

Changing component from porting to porting: Cygwin.


---

Comment by mkoeppe created at 2020-03-13 20:12:10

New commits:


---

Comment by git created at 2020-03-19 20:16:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2020-03-19 20:17:09

Rebased on 9.1.beta8


---

Comment by git created at 2020-03-22 18:34:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-22 18:39:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-03-24 16:46:13

what is the point of having `minimal` here, as it takes too long?


---

Comment by mkoeppe created at 2020-03-24 16:47:37

Even if it times out, it provides valuable testing of the build process for the early packages.


---

Comment by mkoeppe created at 2020-03-24 16:48:55

But I'm working on the refinement of this workflow using several stages


---

Comment by dimpase created at 2020-03-24 16:53:15

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-03-24 16:53:15

ok


---

Comment by vbraun created at 2020-03-29 00:24:04

Resolution: fixed
