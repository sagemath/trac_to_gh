# Issue 24223: py3: fixes to sage.libs.gap

Issue created by migration from https://trac.sagemath.org/ticket/24460

Original creator: embray

Original creation time: 2018-01-02 13:12:05

These are the minimal fixes I needed to get all the tests passing for `sage.libs.gap` (to be clear, this required fixes in other modules as well--these are just the fixes in `sage.libs.gap` itself).

Mostly just minor string conversion fixes, and one or two other little things.


---

Comment by git created at 2018-01-02 13:12:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-02-23 14:16:06

Changing status from new to needs_review.


---

Comment by embray created at 2018-02-23 14:16:06

This was just waiting on #24313 which is now closed.


---

Comment by embray created at 2018-02-23 14:19:41

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-02-23 14:19:41

Upon giving this another look over, some of the test fixes in this branch won't be necessary with #24559.


---

Comment by git created at 2018-02-23 16:01:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2018-02-23 16:02:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-02-23 16:03:25

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-02-23 16:03:25

Slightly reworked the test changes--by incorporating #24559 this doesn't require any `# py2` or `# py3` flags.


---

Comment by git created at 2018-03-16 13:29:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-03-16 13:33:14

This still has a soft dependency on #24559 in order for some of the tests to pass on Python 3, but I didn't include it explicitly in this branch (since it might still evolve).


---

Comment by @dimpase created at 2018-03-16 13:50:22

I'm not getting it all clear

```
sage -t src/sage/libs/gap/element.pyx  # 21 doctests failed
sage -t src/sage/libs/gap/libgap.pyx  # 4 doctests failed
```



---

Comment by embray created at 2018-03-16 13:55:25

Changing keywords from "" to "libs gap libgap".


---

Comment by @dimpase created at 2018-03-16 13:55:47

I see things like

```
File "src/sage/libs/gap/element.pyx", line 1562, in sage.libs.gap.element.GapElement_FiniteField.sage
Failed example:
    n.sage()
Expected:
    a + 3
Got:
    1.6*a + 3
```

which make no sense whatsoever (fields are finite here, `1.6` does not belong there.
Could it be #24559 ?


---

Comment by @dimpase created at 2018-03-16 13:55:47

Changing keywords from "libs gap libgap" to "".


---

Comment by embray created at 2018-03-16 13:57:05

Replying to [comment:9 gh-dimpase]:
> I'm not getting it all clear
> {{{
> sage -t src/sage/libs/gap/element.pyx  # 21 doctests failed
> sage -t src/sage/libs/gap/libgap.pyx  # 4 doctests failed
> }}}

If you're applying this just on top of the develop branch (or even develop + a few other branches) you won't get all tests passing.  

On my Python 3 branch where I have _lots_ of other fixes merged in, all the tests pass, but if you just test this ticket on its own it won't fix everything, because there are other errors that come from outside `sage.libs.gap`.  This just applies the fixes specifically in that package needed for that package to pass.


---

Comment by embray created at 2018-03-16 13:57:05

Changing keywords from "" to "libs gap libgap".


---

Comment by @dimpase created at 2018-03-16 14:00:43

Well, I do merge all the dependencies you provide...
I cannot review something unpublished, you know :-)


---

Comment by embray created at 2018-03-16 16:27:28

It would be more than just the dependencies listed on this ticket.  There are still _lots_ of bugs on python 3 and most of them are unrelated to each other in terms of the fixes.  But if you run the test suite for some large package then of course you'll get test failures due to other bugs in other packages.


---

Comment by @dimpase created at 2018-03-16 17:16:56

well, sure, I also took #24559 and its dependencies. Anything else?


---

Comment by embray created at 2018-03-19 11:08:32

~~Although, I also don't much see the downside to wrapping _most_ `mpz_` functions with `sig_block/unblock()`--any that modify the internal datastructures of one or more of its arguments--and that aren't expected to take long to run.  Of course, this would be tedious, so we'd have to generate the wrappers automatically.~~

Oops, wrong ticket.


---

Comment by chapoton created at 2018-05-11 17:36:34

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-05-11 17:36:34

ok, let it be


---

Comment by vbraun created at 2018-05-14 17:36:09

Resolution: fixed
