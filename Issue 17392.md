# Issue 17392: crash with SR(fraction).polynomial(QQ)

archive/issues_017392.json:
```json
{
    "body": "Keywords: conversion\n\nSage crashes with \n\n```\nsage: ((x^2222222222+1)/(x+1))\n(x^2222222222 + 1)/(x + 1)\nsage: _.polynomial(QQ)\n...\n#2  0x00007f46536d606d in sigdie()\n#3  0x00007f46536d575a in sage_signal_handler()\n#4  0x00007f46596f03e0 in __restore_rt()\n#5  0x00007f46590e70a0 in raise()\n#6  0x00007f465865c3a0 in abort()\n#7  0x00007f4645da4b40 in flint_memory_error()\n#8  0x00007f4645daa400 in flint_calloc()\n#9  0x00007f4645e00150 in fmpq_poly_realloc()\n#10 0x00007f4645e058a0 in fmpq_poly_fit_length()\n#11 0x00007f4645dff850 in fmpq_poly_set_coeff_si()\n#12 0x00007f463c1b6f30 in __pyx_pf_4sage_5rings_10polynomial_25polynomial_rational_flint_25Polynomial_rational_flint_58__pow__() at /home/ralf/sage/src/build/cythonized/sage/rings/polynomial/polynomial_rational_flint.cpp:10287\n  10282     *             if self._is_gen:\n  10283     *                 fmpq_poly_set_coeff_si(res.__poly, n, 1)             # <<<<<<<<<<<<<<\n  10284     *             else:\n  10285     *                 sig_on()\n  10286     */\n> 10287          fmpq_poly_set_coeff_si(__pyx_v_res->__pyx___poly, __pyx_v_n, 1);\n  10288          goto __pyx_L16;\n  10289        }\n  10290        /*else*/ {\n  10291    \n#13 0x00007f465933e270 in ternary_op()\n#14 0x00007f4659340520 in PyNumber_Power()\n#15 0x00007f46593e62b0 in arithmetic() at /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py:1110\n  1105            if not any(repr(v) in self.varnames for v in ex.variables()):\n  1106                return self.base_ring(ex)\n  1107            elif operator == _operator.pow:\n  1108                from sage.rings.all import Integer\n  1109                base, exp = ex.operands()\n> 1110                return self(base)**Integer(exp)\n  1111            else:\n  }}}\nRather, it should throw `TypeError: denominator must be a unit` like it does with `polynomial(ZZ)`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17629\n\n",
    "created_at": "2015-01-13T14:38:35Z",
    "labels": [
        "component: commutative algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "crash with SR(fraction).polynomial(QQ)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17392",
    "user": "https://github.com/rwst"
}
```
Keywords: conversion

Sage crashes with 

```
sage: ((x^2222222222+1)/(x+1))
(x^2222222222 + 1)/(x + 1)
sage: _.polynomial(QQ)
...
#2  0x00007f46536d606d in sigdie()
#3  0x00007f46536d575a in sage_signal_handler()
#4  0x00007f46596f03e0 in __restore_rt()
#5  0x00007f46590e70a0 in raise()
#6  0x00007f465865c3a0 in abort()
#7  0x00007f4645da4b40 in flint_memory_error()
#8  0x00007f4645daa400 in flint_calloc()
#9  0x00007f4645e00150 in fmpq_poly_realloc()
#10 0x00007f4645e058a0 in fmpq_poly_fit_length()
#11 0x00007f4645dff850 in fmpq_poly_set_coeff_si()
#12 0x00007f463c1b6f30 in __pyx_pf_4sage_5rings_10polynomial_25polynomial_rational_flint_25Polynomial_rational_flint_58__pow__() at /home/ralf/sage/src/build/cythonized/sage/rings/polynomial/polynomial_rational_flint.cpp:10287
  10282     *             if self._is_gen:
  10283     *                 fmpq_poly_set_coeff_si(res.__poly, n, 1)             # <<<<<<<<<<<<<<
  10284     *             else:
  10285     *                 sig_on()
  10286     */
> 10287          fmpq_poly_set_coeff_si(__pyx_v_res->__pyx___poly, __pyx_v_n, 1);
  10288          goto __pyx_L16;
  10289        }
  10290        /*else*/ {
  10291    
#13 0x00007f465933e270 in ternary_op()
#14 0x00007f4659340520 in PyNumber_Power()
#15 0x00007f46593e62b0 in arithmetic() at /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py:1110
  1105            if not any(repr(v) in self.varnames for v in ex.variables()):
  1106                return self.base_ring(ex)
  1107            elif operator == _operator.pow:
  1108                from sage.rings.all import Integer
  1109                base, exp = ex.operands()
> 1110                return self(base)**Integer(exp)
  1111            else:
  }}}
Rather, it should throw `TypeError: denominator must be a unit` like it does with `polynomial(ZZ)`.

Issue created by migration from https://trac.sagemath.org/ticket/17629





---

archive/issue_comments_231505.json:
```json
{
    "body": "Attachment [sage_crash_mG0GBp.log](tarball://root/attachments/some-uuid/ticket17629/sage_crash_mG0GBp.log) by @rwst created at 2015-01-13 14:40:14\n\ncrash report",
    "created_at": "2015-01-13T14:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231505",
    "user": "https://github.com/rwst"
}
```

Attachment [sage_crash_mG0GBp.log](tarball://root/attachments/some-uuid/ticket17629/sage_crash_mG0GBp.log) by @rwst created at 2015-01-13 14:40:14

crash report



---

archive/issue_comments_231506.json:
```json
{
    "body": "Has nothing to do with fraction, crashes with only `x^2222222222+1` too. If this is memory, can we work around with sparse polynomials, at least give the user the option?",
    "created_at": "2015-01-25T17:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231506",
    "user": "https://github.com/rwst"
}
```

Has nothing to do with fraction, crashes with only `x^2222222222+1` too. If this is memory, can we work around with sparse polynomials, at least give the user the option?



---

archive/issue_comments_231507.json:
```json
{
    "body": "Changing keywords from \"conversion\" to \"conversion, sparse, dense\".",
    "created_at": "2015-01-25T17:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231507",
    "user": "https://github.com/rwst"
}
```

Changing keywords from "conversion" to "conversion, sparse, dense".



---

archive/issue_comments_231508.json:
```json
{
    "body": "Sparse polynomials should be a different ticket.",
    "created_at": "2015-02-13T20:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231508",
    "user": "https://github.com/jdemeyer"
}
```

Sparse polynomials should be a different ticket.



---

archive/issue_comments_231509.json:
```json
{
    "body": "Changing component from commutative algebra to c_lib.",
    "created_at": "2015-02-13T20:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231509",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from commutative algebra to c_lib.



---

archive/issue_comments_231510.json:
```json
{
    "body": "Changing keywords from \"conversion, sparse, dense\" to \"flint_memory_error\".",
    "created_at": "2015-02-13T20:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231510",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "conversion, sparse, dense" to "flint_memory_error".



---

archive/issue_comments_231511.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Sparse polynomials should be a different ticket.\nSee #17782 (EDIT)",
    "created_at": "2015-02-14T07:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231511",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:4 jdemeyer]:
> Sparse polynomials should be a different ticket.
See #17782 (EDIT)



---

archive/issue_comments_231512.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-14T13:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231512",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_231513.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-14T13:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231513",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_231514.json:
```json
{
    "body": "Except for cosmetics this practically replaces `sig_on` with `sig_str(...)` in FLINT code and adds an exception for 0<sup>(-1)</sup>. It also passes `make ptestlong`.  So, depending on the review for #17668 this is fine.",
    "created_at": "2015-02-17T15:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231514",
    "user": "https://github.com/rwst"
}
```

Except for cosmetics this practically replaces `sig_on` with `sig_str(...)` in FLINT code and adds an exception for 0<sup>(-1)</sup>. It also passes `make ptestlong`.  So, depending on the review for #17668 this is fine.



---

archive/issue_comments_231515.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-17T15:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231515",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_016769.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-02-17T20:50:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17392#event-16769"
}
```



---

archive/issue_comments_231516.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-17T20:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17392#issuecomment-231516",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
