# Issue 19035: upgrade networkx to version 1.10

archive/issues_019035.json:
```json
{
    "body": "CC:  strogdon\n\nNetworkx 1.10 is out.\n\nSome changes introduced in 1.9 change the results of two doctests (to equally valid results). Since Gentoo doesn't carry networkx-1.8.x any more, sage-on-gentoo has a couple of broken doctests for no good reasons.\n\ntarball\n[https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz](https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz)\n\nIssue created by migration from https://trac.sagemath.org/ticket/19272\n\n",
    "created_at": "2015-09-23T11:15:11Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "upgrade networkx to version 1.10",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19035",
    "user": "fbissey"
}
```
CC:  strogdon

Networkx 1.10 is out.

Some changes introduced in 1.9 change the results of two doctests (to equally valid results). Since Gentoo doesn't carry networkx-1.8.x any more, sage-on-gentoo has a couple of broken doctests for no good reasons.

tarball
[https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz](https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz)

Issue created by migration from https://trac.sagemath.org/ticket/19272





---

archive/issue_comments_261138.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-23T11:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261138",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_261139.json:
```json
{
    "body": "Steve would you mind reviewing this ticket so we can get rid of annoying failing doctests in sage-on-gentoo.",
    "created_at": "2015-09-23T11:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261139",
    "user": "fbissey"
}
```

Steve would you mind reviewing this ticket so we can get rid of annoying failing doctests in sage-on-gentoo.



---

archive/issue_comments_261140.json:
```json
{
    "body": "OK, doing this here I get\n\n```\ncreating dist\ncreating 'dist/networkx-1.10-py2.7.egg' and adding 'build/bdist.linux-x86_64/egg' to it\nremoving 'build/bdist.linux-x86_64/egg' (and everything under it)\nerror: /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site.py is not a setuptools-generated site.py; please remove it.\n```\n\nand `networkx-1.10` isn't installed. I've never seen this before. I believe `site.py` is installed by `python` and removing it may not be wise.",
    "created_at": "2015-09-23T17:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261140",
    "user": "strogdon"
}
```

OK, doing this here I get

```
creating dist
creating 'dist/networkx-1.10-py2.7.egg' and adding 'build/bdist.linux-x86_64/egg' to it
removing 'build/bdist.linux-x86_64/egg' (and everything under it)
error: /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site.py is not a setuptools-generated site.py; please remove it.
```

and `networkx-1.10` isn't installed. I've never seen this before. I believe `site.py` is installed by `python` and removing it may not be wise.



---

archive/issue_comments_261141.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-09-23T17:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261141",
    "user": "strogdon"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_261142.json:
```json
{
    "body": "Perhaps this is the problem in `setup.py`\n\n```\nfrom setuptools import setup\n```\n\nPrevious versions had\n\n```\nfrom distutils.core import setup\n```\n",
    "created_at": "2015-09-23T18:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261142",
    "user": "strogdon"
}
```

Perhaps this is the problem in `setup.py`

```
from setuptools import setup
```

Previous versions had

```
from distutils.core import setup
```




---

archive/issue_comments_261143.json:
```json
{
    "body": "I'll check all that. My bad for not doing assuming it would just work.",
    "created_at": "2015-09-23T19:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261143",
    "user": "fbissey"
}
```

I'll check all that. My bad for not doing assuming it would just work.



---

archive/issue_comments_261144.json:
```json
{
    "body": "Changing the above does work here, but I'm not sure it's the correct thing to do.",
    "created_at": "2015-09-23T19:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261144",
    "user": "strogdon"
}
```

Changing the above does work here, but I'm not sure it's the correct thing to do.



---

archive/issue_comments_261145.json:
```json
{
    "body": "It'll be a few hours before I can deal with this.",
    "created_at": "2015-09-23T20:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261145",
    "user": "fbissey"
}
```

It'll be a few hours before I can deal with this.



---

archive/issue_comments_261146.json:
```json
{
    "body": "OK, `spkg-install` had a small work around for older version of `networkx` and it is counterproductive here. pushing.",
    "created_at": "2015-09-24T01:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261146",
    "user": "fbissey"
}
```

OK, `spkg-install` had a small work around for older version of `networkx` and it is counterproductive here. pushing.



---

archive/issue_comments_261147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-24T01:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261147",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261148.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-09-24T01:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261148",
    "user": "fbissey"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_261149.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-24T02:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261149",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261150.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-24T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261150",
    "user": "strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261151.json:
```json
{
    "body": "Yes, I had wondered about the\n\n```\npython setup.py install --home=\"$SAGE_LOCAL\" --force\n```\n\nAnd good catch on the decorator dependency. I would have missed that. Looks good here.",
    "created_at": "2015-09-24T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261151",
    "user": "strogdon"
}
```

Yes, I had wondered about the

```
python setup.py install --home="$SAGE_LOCAL" --force
```

And good catch on the decorator dependency. I would have missed that. Looks good here.



---

archive/issue_comments_261152.json:
```json
{
    "body": "I still get the old result sometimes, probably random. Just replace the doctest with something that is not fragile:\n\n```\nsage -t --long src/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 14569, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    D.shortest_path(4, 9, algorithm='Dijkstra_NetworkX')\nExpected:\n    [4, 17, 16, 12, 13, 9]\nGot:\n    [4, 3, 2, 1, 8, 9]\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 14571, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    D.shortest_path(4, 9, algorithm='Dijkstra_Bid_NetworkX')\nExpected:\n    [4, 17, 16, 12, 13, 9]\nGot:\n    [4, 3, 2, 1, 8, 9]\n**********************************************************************\n1 item had failures:\n   2 of 724 in sage.graphs.generic_graph.GenericGraph.?\n    [2904 tests, 2 failures, 103.83 s]\n```\n",
    "created_at": "2015-09-24T23:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261152",
    "user": "vbraun"
}
```

I still get the old result sometimes, probably random. Just replace the doctest with something that is not fragile:

```
sage -t --long src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 14569, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    D.shortest_path(4, 9, algorithm='Dijkstra_NetworkX')
Expected:
    [4, 17, 16, 12, 13, 9]
Got:
    [4, 3, 2, 1, 8, 9]
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 14571, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    D.shortest_path(4, 9, algorithm='Dijkstra_Bid_NetworkX')
Expected:
    [4, 17, 16, 12, 13, 9]
Got:
    [4, 3, 2, 1, 8, 9]
**********************************************************************
1 item had failures:
   2 of 724 in sage.graphs.generic_graph.GenericGraph.?
    [2904 tests, 2 failures, 103.83 s]
```




---

archive/issue_comments_261153.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-09-24T23:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261153",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_261154.json:
```json
{
    "body": "I am a bit surprised as I haven't seen this result since `sage-on-gentoo` has been pushed to `networkx-1.9+` but I guess it is possible. I will look what can be done.",
    "created_at": "2015-09-25T00:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261154",
    "user": "fbissey"
}
```

I am a bit surprised as I haven't seen this result since `sage-on-gentoo` has been pushed to `networkx-1.9+` but I guess it is possible. I will look what can be done.



---

archive/issue_comments_261155.json:
```json
{
    "body": "Same here. I ran the test many times and I never saw the old result with the newer networkx.",
    "created_at": "2015-09-25T00:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261155",
    "user": "strogdon"
}
```

Same here. I ran the test many times and I never saw the old result with the newer networkx.



---

archive/issue_comments_261156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-25T00:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261156",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261157.json:
```json
{
    "body": "I am hopping this is more robust as all algorithms give the same answer for that case. This may be more simplistic however.",
    "created_at": "2015-09-25T00:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261157",
    "user": "fbissey"
}
```

I am hopping this is more robust as all algorithms give the same answer for that case. This may be more simplistic however.



---

archive/issue_comments_261158.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-25T00:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261158",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_261159.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-25T01:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261159",
    "user": "strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261160.json:
```json
{
    "body": "Sort of defeats the purpose in upgrading. But upgrading was necessary. I didn't run the entire testsuite but I did create a `test file` with the `EXAMPLES::` bracketing the failures. The `test file` was tested 100 times without a failure. But then again this approach failed to produce failures with the `less robust` examples. Perhaps parallel testing is the cause. So, we'll see.",
    "created_at": "2015-09-25T01:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261160",
    "user": "strogdon"
}
```

Sort of defeats the purpose in upgrading. But upgrading was necessary. I didn't run the entire testsuite but I did create a `test file` with the `EXAMPLES::` bracketing the failures. The `test file` was tested 100 times without a failure. But then again this approach failed to produce failures with the `less robust` examples. Perhaps parallel testing is the cause. So, we'll see.



---

archive/issue_comments_261161.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T07:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19035#issuecomment-261161",
    "user": "vbraun"
}
```

Resolution: fixed
