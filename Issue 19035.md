# Issue 19035: upgrade networkx to version 1.10

Issue created by migration from Trac.

Original creator: fbissey

Original creation time: 2015-09-23 11:15:11

CC:  strogdon

Networkx 1.10 is out.

Some changes introduced in 1.9 change the results of two doctests (to equally valid results). Since Gentoo doesn't carry networkx-1.8.x any more, sage-on-gentoo has a couple of broken doctests for no good reasons.

tarball
[https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz](https://pypi.python.org/packages/source/n/networkx/networkx-1.10.tar.gz)


---

Comment by fbissey created at 2015-09-23 11:16:41

Changing status from new to needs_review.


---

Comment by fbissey created at 2015-09-23 11:16:41

Steve would you mind reviewing this ticket so we can get rid of annoying failing doctests in sage-on-gentoo.


---

Comment by strogdon created at 2015-09-23 17:16:57

OK, doing this here I get

```
creating dist
creating 'dist/networkx-1.10-py2.7.egg' and adding 'build/bdist.linux-x86_64/egg' to it
removing 'build/bdist.linux-x86_64/egg' (and everything under it)
error: /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site.py is not a setuptools-generated site.py; please remove it.
```

and `networkx-1.10` isn't installed. I've never seen this before. I believe `site.py` is installed by `python` and removing it may not be wise.


---

Comment by strogdon created at 2015-09-23 17:16:57

Changing status from needs_review to needs_info.


---

Comment by strogdon created at 2015-09-23 18:20:12

Perhaps this is the problem in `setup.py`

```
from setuptools import setup
```

Previous versions had

```
from distutils.core import setup
```



---

Comment by fbissey created at 2015-09-23 19:13:25

I'll check all that. My bad for not doing assuming it would just work.


---

Comment by strogdon created at 2015-09-23 19:13:55

Changing the above does work here, but I'm not sure it's the correct thing to do.


---

Comment by fbissey created at 2015-09-23 20:07:31

It'll be a few hours before I can deal with this.


---

Comment by fbissey created at 2015-09-24 01:28:31

OK, `spkg-install` had a small work around for older version of `networkx` and it is counterproductive here. pushing.


---

Comment by git created at 2015-09-24 01:31:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-09-24 01:31:47

Changing status from needs_info to needs_review.


---

Comment by git created at 2015-09-24 02:04:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2015-09-24 14:46:30

Changing status from needs_review to positive_review.


---

Comment by strogdon created at 2015-09-24 14:46:30

Yes, I had wondered about the

```
python setup.py install --home="$SAGE_LOCAL" --force
```

And good catch on the decorator dependency. I would have missed that. Looks good here.


---

Comment by vbraun created at 2015-09-24 23:51:53

I still get the old result sometimes, probably random. Just replace the doctest with something that is not fragile:

```
sage -t --long src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 14569, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    D.shortest_path(4, 9, algorithm='Dijkstra_NetworkX')
Expected:
    [4, 17, 16, 12, 13, 9]
Got:
    [4, 3, 2, 1, 8, 9]
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 14571, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    D.shortest_path(4, 9, algorithm='Dijkstra_Bid_NetworkX')
Expected:
    [4, 17, 16, 12, 13, 9]
Got:
    [4, 3, 2, 1, 8, 9]
**********************************************************************
1 item had failures:
   2 of 724 in sage.graphs.generic_graph.GenericGraph.?
    [2904 tests, 2 failures, 103.83 s]
```



---

Comment by vbraun created at 2015-09-24 23:51:53

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2015-09-25 00:00:17

I am a bit surprised as I haven't seen this result since `sage-on-gentoo` has been pushed to `networkx-1.9+` but I guess it is possible. I will look what can be done.


---

Comment by strogdon created at 2015-09-25 00:04:34

Same here. I ran the test many times and I never saw the old result with the newer networkx.


---

Comment by git created at 2015-09-25 00:28:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-09-25 00:30:08

I am hopping this is more robust as all algorithms give the same answer for that case. This may be more simplistic however.


---

Comment by fbissey created at 2015-09-25 00:30:08

Changing status from needs_work to needs_review.


---

Comment by strogdon created at 2015-09-25 01:34:54

Changing status from needs_review to positive_review.


---

Comment by strogdon created at 2015-09-25 01:34:54

Sort of defeats the purpose in upgrading. But upgrading was necessary. I didn't run the entire testsuite but I did create a `test file` with the `EXAMPLES::` bracketing the failures. The `test file` was tested 100 times without a failure. But then again this approach failed to produce failures with the `less robust` examples. Perhaps parallel testing is the cause. So, we'll see.


---

Comment by vbraun created at 2015-10-12 07:15:56

Resolution: fixed
