# Issue 23001: Change syntax of GlobalOptions

archive/issues_023001.json:
```json
{
    "body": "CC:  @darijgr @dkrenn @AndrewAtLarge @tscrim\n\nRethink the syntax of `GlobalOptions`. This is mainly meant to address the problem that the `doc` and `end_doc` attributes of a `GlobalOptions` object are not doctested (see #16693 and #18051 which were closed as duplicate of #14272 but which would better be fixed independently).\n\nIssue created by migration from https://trac.sagemath.org/ticket/23238\n\n",
    "created_at": "2017-06-14T12:03:11Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Change syntax of GlobalOptions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23001",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @darijgr @dkrenn @AndrewAtLarge @tscrim

Rethink the syntax of `GlobalOptions`. This is mainly meant to address the problem that the `doc` and `end_doc` attributes of a `GlobalOptions` object are not doctested (see #16693 and #18051 which were closed as duplicate of #14272 but which would better be fixed independently).

Issue created by migration from https://trac.sagemath.org/ticket/23238





---

archive/issue_comments_321513.json:
```json
{
    "body": "Not having the global options doc-tested seems to be causing problems, and all documentation should be doc-tested, so I think that this is a good idea. This said, I am surprised that there is testable code hidden in the global options that is not doc-tested elsewhere: tests for all methods should be given in the methods.\n\nFor what it's worth, my initial plan was to write the options as a class but one of the people I discussed this with thought that creating a class for each set of options was a little OTT.",
    "created_at": "2017-06-15T01:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321513",
    "user": "https://github.com/AndrewAtLarge"
}
```

Not having the global options doc-tested seems to be causing problems, and all documentation should be doc-tested, so I think that this is a good idea. This said, I am surprised that there is testable code hidden in the global options that is not doc-tested elsewhere: tests for all methods should be given in the methods.

For what it's worth, my initial plan was to write the options as a class but one of the people I discussed this with thought that creating a class for each set of options was a little OTT.



---

archive/issue_comments_321514.json:
```json
{
    "body": "This is an early prototype. Pickling is not yet supported and it needs a lot more tests and docs.\n----\nNew commits:",
    "created_at": "2017-06-16T13:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321514",
    "user": "https://github.com/jdemeyer"
}
```

This is an early prototype. Pickling is not yet supported and it needs a lot more tests and docs.
----
New commits:



---

archive/issue_comments_321515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-19T15:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321516.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-20T13:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321517.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-20T14:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321517",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321518.json:
```json
{
    "body": "Overall I like the improved way to create global options as classes. However, I do not like how `name` is treated as a special input; it looks too much like an option and someone could want an option called `name`. While this was not previously supported, it was clear from the class signature that this could not be an option. However, with the new format, it looks more like (black) magic that `name` is and should be treated differently. Perhaps just call it `_name` instead as that is the ultimate attribute it is suppose to be called. Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.\n\nI would prefer `\"\"\"` instead of `'''`, but I guess we cannot change that because of it being inside of a `\"\"\"` string and the doctesting framework (so we can't add an escape `\\`).\n\nI'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.",
    "created_at": "2017-07-01T14:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321518",
    "user": "https://github.com/tscrim"
}
```

Overall I like the improved way to create global options as classes. However, I do not like how `name` is treated as a special input; it looks too much like an option and someone could want an option called `name`. While this was not previously supported, it was clear from the class signature that this could not be an option. However, with the new format, it looks more like (black) magic that `name` is and should be treated differently. Perhaps just call it `_name` instead as that is the ultimate attribute it is suppose to be called. Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.

I would prefer `"""` instead of `'''`, but I guess we cannot change that because of it being inside of a `"""` string and the doctesting framework (so we can't add an escape `\`).

I'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.



---

archive/issue_comments_321519.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-01T14:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321519",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321520.json:
```json
{
    "body": "Replying to [comment:14 tscrim]:\n> Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.\n\nI don't get what you mean with this.\n\n> I would prefer `\"\"\"` instead of `'''`, but I guess we cannot change that because of it being inside of a `\"\"\"` string and the doctesting framework (so we can't add an escape `\\`).\nWe could escape `\\\"\\\"\\\"` I guess but that looks even uglier than `'''`.\n\n> I'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.\n\nRight. So maybe keep the doc as before but add tests too.",
    "created_at": "2017-07-02T08:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321520",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 tscrim]:
> Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.

I don't get what you mean with this.

> I would prefer `"""` instead of `'''`, but I guess we cannot change that because of it being inside of a `"""` string and the doctesting framework (so we can't add an escape `\`).
We could escape `\"\"\"` I guess but that looks even uglier than `'''`.

> I'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.

Right. So maybe keep the doc as before but add tests too.



---

archive/issue_comments_321521.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Replying to [comment:14 tscrim]:\n> > Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.\n> \n> I don't get what you mean with this.\n\nClass attributes and instance attributes behave in exactly the same way:\n\n```sage\nsage: class Foo(object):\n....:     bar = 5\n....:     def __init__(self):\n....:         self.var = -1\nsage: f = Foo()\nsage: f.bar\n5\nsage: f.var\n-1\nsage: f.bar = 2\nsage: f2 = Foo()\nsage: f2.bar\n5\nsage: f.bar\n2\n```\n\nSo having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned). So it feels much more natural to me to be setting the name by using `_name`.\n\n> > I would prefer `\"\"\"` instead of `'''`, but I guess we cannot change that because of it being inside of a `\"\"\"` string and the doctesting framework (so we can't add an escape `\\`).\n> We could escape `\\\"\\\"\\\"` I guess but that looks even uglier than `'''`.\n\nExactly my conclusion. This comment ended up being more of a conversion with myself. Sorry, I should've added that I don't think we should change anything.\n\n> > I'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.\n> \n> Right. So maybe keep the doc as before but add tests too.\n\nI think this is the best way forward.",
    "created_at": "2017-07-02T10:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321521",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:15 jdemeyer]:
> Replying to [comment:14 tscrim]:
> > Moreover, Python does not distinguish between classes and instances (and global options are suppose to be unique class level attributes). At least, this feels a little more natural to me, even if it breaks encapsulation in a way.
> 
> I don't get what you mean with this.

Class attributes and instance attributes behave in exactly the same way:

```sage
sage: class Foo(object):
....:     bar = 5
....:     def __init__(self):
....:         self.var = -1
sage: f = Foo()
sage: f.bar
5
sage: f.var
-1
sage: f.bar = 2
sage: f2 = Foo()
sage: f2.bar
5
sage: f.bar
2
```

So having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned). So it feels much more natural to me to be setting the name by using `_name`.

> > I would prefer `"""` instead of `'''`, but I guess we cannot change that because of it being inside of a `"""` string and the doctesting framework (so we can't add an escape `\`).
> We could escape `\"\"\"` I guess but that looks even uglier than `'''`.

Exactly my conclusion. This comment ended up being more of a conversion with myself. Sorry, I should've added that I don't think we should change anything.

> > I'm also not sure about the change to actually print the `__doc__` as tests. I agree that it should be tested, but having to add all of those `<BLANKLINE>` takes away from the instructional value of the documentation.
> 
> Right. So maybe keep the doc as before but add tests too.

I think this is the best way forward.



---

archive/issue_comments_321522.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> So having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned).\n\nI see what you mean but I don't see the relevance to this ticket.\n\n> So it feels much more natural to me to be setting the name by using `_name`.\n\nTo me, the `_name` attribute on the instance is an implementation detail which is unrelated to the construction of the object. So I don't see it as an argument in favour of `_name` (but also not against it, it's just not relevant in my opinion).\n\nI have also been considering `NAME` in all capitals. What do you think?",
    "created_at": "2017-07-03T09:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321522",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 tscrim]:
> So having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned).

I see what you mean but I don't see the relevance to this ticket.

> So it feels much more natural to me to be setting the name by using `_name`.

To me, the `_name` attribute on the instance is an implementation detail which is unrelated to the construction of the object. So I don't see it as an argument in favour of `_name` (but also not against it, it's just not relevant in my opinion).

I have also been considering `NAME` in all capitals. What do you think?



---

archive/issue_comments_321523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-03T14:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321524.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Replying to [comment:16 tscrim]:\n> > So having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned).\n> \n> I see what you mean but I don't see the relevance to this ticket.\n\nSince this ticket is about setting the API for `GlobalOptions` and this will be used as part of the API, so I feel it is relevant.\n\n> > So it feels much more natural to me to be setting the name by using `_name`.\n> \n> To me, the `_name` attribute on the instance is an implementation detail which is unrelated to the construction of the object. So I don't see it as an argument in favour of `_name` (but also not against it, it's just not relevant in my opinion).\n\nWell, this goes to the statement I made about breaking encapsulation, but I want to make it part of the API in a way. At least since we don't have an `__init__` with a set signature (well, as much as Python can give).\n\n> I have also been considering `NAME` in all capitals. What do you think?\n\nThis also is good for me as it is clear it is special. I have a very mild preference for `_name` over `NAME`, but my opinion is not very strong (other than it not being `name`).",
    "created_at": "2017-07-03T14:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321524",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:17 jdemeyer]:
> Replying to [comment:16 tscrim]:
> > So having the class level attribute of `_name` is the same as setting `_name` in the `__init__` (as far as the object is concerned).
> 
> I see what you mean but I don't see the relevance to this ticket.

Since this ticket is about setting the API for `GlobalOptions` and this will be used as part of the API, so I feel it is relevant.

> > So it feels much more natural to me to be setting the name by using `_name`.
> 
> To me, the `_name` attribute on the instance is an implementation detail which is unrelated to the construction of the object. So I don't see it as an argument in favour of `_name` (but also not against it, it's just not relevant in my opinion).

Well, this goes to the statement I made about breaking encapsulation, but I want to make it part of the API in a way. At least since we don't have an `__init__` with a set signature (well, as much as Python can give).

> I have also been considering `NAME` in all capitals. What do you think?

This also is good for me as it is clear it is special. I have a very mild preference for `_name` over `NAME`, but my opinion is not very strong (other than it not being `name`).



---

archive/issue_comments_321525.json:
```json
{
    "body": "Replying to [comment:19 tscrim]:\n> Well, this goes to the statement I made about breaking encapsulation, but I want to make it part of the API in a way.\n\nThe `_name` attribute on the instance is a private implementation detail and explicitly *not* part of the API. This is compatible with the Python philosophy that names starting with underscores are private. Actually, thinking more about it, this is an argument *against* `_name`: the `name`/`_name`/`NAME` attribute when creating the class should be part of the API, so it should not start with an underscore.\n\nEven if you consider the `_name` attribute on the instance as part of the API, most users won't care. So I don't see this as a reason to use the same name `_name` for constructing the class.\n\n> This also is good for me as it is clear it is special. I have a very mild preference for `_name` over `NAME`, but my opinion is not very strong (other than it not being `name`).\n\nIn that case I will use `NAME`.",
    "created_at": "2017-07-03T15:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321525",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 tscrim]:
> Well, this goes to the statement I made about breaking encapsulation, but I want to make it part of the API in a way.

The `_name` attribute on the instance is a private implementation detail and explicitly *not* part of the API. This is compatible with the Python philosophy that names starting with underscores are private. Actually, thinking more about it, this is an argument *against* `_name`: the `name`/`_name`/`NAME` attribute when creating the class should be part of the API, so it should not start with an underscore.

Even if you consider the `_name` attribute on the instance as part of the API, most users won't care. So I don't see this as a reason to use the same name `_name` for constructing the class.

> This also is good for me as it is clear it is special. I have a very mild preference for `_name` over `NAME`, but my opinion is not very strong (other than it not being `name`).

In that case I will use `NAME`.



---

archive/issue_comments_321526.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-03T15:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321527.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-03T15:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321527",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321528.json:
```json
{
    "body": "LGTM. Thank you.",
    "created_at": "2017-07-04T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321528",
    "user": "https://github.com/tscrim"
}
```

LGTM. Thank you.



---

archive/issue_comments_321529.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-04T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321529",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_021609.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-07-26T22:13:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23001#event-21609"
}
```



---

archive/issue_comments_321530.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-26T22:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23001#issuecomment-321530",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
