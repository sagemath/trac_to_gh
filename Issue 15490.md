# Issue 15490: Check for doc build errors in "make [p]test[long]"

archive/issues_015490.json:
```json
{
    "body": "CC:  ncohen\n\nErrors in the documentation should cause the test makefile targets to fail, but they do not.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15727\n\n",
    "created_at": "2014-01-24T17:25:45Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "title": "Check for doc build errors in \"make [p]test[long]\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15490",
    "user": "vbraun"
}
```
CC:  ncohen

Errors in the documentation should cause the test makefile targets to fail, but they do not.

Issue created by migration from https://trac.sagemath.org/ticket/15727





---

archive/issue_comments_200145.json:
```json
{
    "body": "Ideally we would check in \"make doc\", but incremental builds often lead to sphinx failures. To reliably check for errors we must delete the previous output. So if you do that in \"make doc\" then there is no makefile target for incremental builds.",
    "created_at": "2014-01-24T17:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200145",
    "user": "vbraun"
}
```

Ideally we would check in "make doc", but incremental builds often lead to sphinx failures. To reliably check for errors we must delete the previous output. So if you do that in "make doc" then there is no makefile target for incremental builds.



---

archive/issue_comments_200146.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> To reliably check for errors we must delete the previous output. So if you do that in \"make doc\" then there is no makefile target for incremental builds.\nI hope you're not proposing that `make [p]test[long]` would delete all doc output and rebuild all docs from scratch. That would add a significant amount of time to doctesting.",
    "created_at": "2014-01-24T18:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200146",
    "user": "jdemeyer"
}
```

Replying to [comment:2 vbraun]:
> To reliably check for errors we must delete the previous output. So if you do that in "make doc" then there is no makefile target for incremental builds.
I hope you're not proposing that `make [p]test[long]` would delete all doc output and rebuild all docs from scratch. That would add a significant amount of time to doctesting.



---

archive/issue_comments_200147.json:
```json
{
    "body": "It doesn't add that much. If you have an alternative to reliably test documentation build then please explain...",
    "created_at": "2014-01-24T18:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200147",
    "user": "vbraun"
}
```

It doesn't add that much. If you have an alternative to reliably test documentation build then please explain...



---

archive/issue_comments_200148.json:
```json
{
    "body": "We could just error out in \"make doc\" without rebuilding from scratch, but add a big fat hint at the end\n\n```\nIncremental documentation builds sometimes cause spurious \nerror messages. To be certain that these are real errors, \nrun \"make doc-clean\" first if you had not done so already.\n```\n",
    "created_at": "2014-01-24T19:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200148",
    "user": "vbraun"
}
```

We could just error out in "make doc" without rebuilding from scratch, but add a big fat hint at the end

```
Incremental documentation builds sometimes cause spurious 
error messages. To be certain that these are real errors, 
run "make doc-clean" first if you had not done so already.
```




---

archive/issue_comments_200149.json:
```json
{
    "body": "An additional problem is that when doing `make doc` twice, the errors are only shown the first time.",
    "created_at": "2014-01-24T19:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200149",
    "user": "jdemeyer"
}
```

An additional problem is that when doing `make doc` twice, the errors are only shown the first time.



---

archive/issue_comments_200150.json:
```json
{
    "body": "Certainly having `make doc` quit after an error would encourage people to fix documentation errors before putting things up for review. At least they would be more likely to notice the errors. We would need a helpful error message at the end, not just that the \"reference manual failed to build\", but that \"reference/plotting failed to build because of errors in the file animate.py\". Can we tell ahead of time if it was an incremental build? Otherwise, Volker's suggested error message might be misleading.\n\nNext, we should also make \"sage -t FILE\" build the docs for that file ;)",
    "created_at": "2014-01-24T19:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200150",
    "user": "jhpalmieri"
}
```

Certainly having `make doc` quit after an error would encourage people to fix documentation errors before putting things up for review. At least they would be more likely to notice the errors. We would need a helpful error message at the end, not just that the "reference manual failed to build", but that "reference/plotting failed to build because of errors in the file animate.py". Can we tell ahead of time if it was an incremental build? Otherwise, Volker's suggested error message might be misleading.

Next, we should also make "sage -t FILE" build the docs for that file ;)



---

archive/issue_comments_200151.json:
```json
{
    "body": "Getting a summary of the errors is relatively easy, just grep through the log.\n\nI'd say incremental build <=> src/doc/output exists",
    "created_at": "2014-01-24T19:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200151",
    "user": "vbraun"
}
```

Getting a summary of the errors is relatively easy, just grep through the log.

I'd say incremental build <=> src/doc/output exists



---

archive/issue_comments_200152.json:
```json
{
    "body": "Using the `--warn-links` option might be a good idea, too.",
    "created_at": "2014-01-30T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200152",
    "user": "vbraun"
}
```

Using the `--warn-links` option might be a good idea, too.



---

archive/issue_comments_200153.json:
```json
{
    "body": "I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.",
    "created_at": "2014-01-30T17:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200153",
    "user": "jhpalmieri"
}
```

I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.



---

archive/issue_comments_200154.json:
```json
{
    "body": "Here's an attempt.\n----\nNew commits:",
    "created_at": "2014-01-30T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200154",
    "user": "jhpalmieri"
}
```

Here's an attempt.
----
New commits:



---

archive/issue_comments_200155.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-30T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200155",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200156.json:
```json
{
    "body": "In a parallel doc build you are exiting only one of the workers. The whole build then waits forever for that worker process because of the old problem with pickling exceptions.",
    "created_at": "2014-01-30T21:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200156",
    "user": "vbraun"
}
```

In a parallel doc build you are exiting only one of the workers. The whole build then waits forever for that worker process because of the old problem with pickling exceptions.



---

archive/issue_comments_200157.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-30T22:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200157",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-30T22:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200158",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200159.json:
```json
{
    "body": "I think this fixes it.",
    "created_at": "2014-01-30T22:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200159",
    "user": "jhpalmieri"
}
```

I think this fixes it.



---

archive/issue_comments_200160.json:
```json
{
    "body": "> I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.\n\nOh. Well, I did not even know that `--warn-links` checked the internet links. My only use for it is that it detects broken internal links (:class:,:func:, ...), and there is a *LOT* of it.\n\nExcept in the graph/, numerical/ and combinat/designs/ folders of course `:-P`\n\nNathann",
    "created_at": "2014-01-31T09:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200160",
    "user": "ncohen"
}
```

> I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.

Oh. Well, I did not even know that `--warn-links` checked the internet links. My only use for it is that it detects broken internal links (:class:,:func:, ...), and there is a *LOT* of it.

Except in the graph/, numerical/ and combinat/designs/ folders of course `:-P`

Nathann



---

archive/issue_comments_200161.json:
```json
{
    "body": "looks good to me!\n\nThe `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)",
    "created_at": "2014-01-31T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200161",
    "user": "vbraun"
}
```

looks good to me!

The `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)



---

archive/issue_comments_200162.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-31T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200162",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200163.json:
```json
{
    "body": "> The `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)\n\nWell. That really is a lot of work if it is to be done by somebody who does not know the code. A couple of times I tried to clean the links of the combinat/ folder, and it is REALLY painful when you have no idea what link was intended. Unless we have a way to make sure that all new links are correct I am afraid this will never be done. Unless people clean their respective code of course.\n\nNathann",
    "created_at": "2014-01-31T23:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200163",
    "user": "ncohen"
}
```

> The `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)

Well. That really is a lot of work if it is to be done by somebody who does not know the code. A couple of times I tried to clean the links of the combinat/ folder, and it is REALLY painful when you have no idea what link was intended. Unless we have a way to make sure that all new links are correct I am afraid this will never be done. Unless people clean their respective code of course.

Nathann



---

archive/issue_comments_200164.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-01T15:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15490#issuecomment-200164",
    "user": "vbraun"
}
```

Resolution: fixed
