# Issue 15490: Check for doc build errors in "make [p]test[long]"

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-01-24 17:25:45

CC:  ncohen

Errors in the documentation should cause the test makefile targets to fail, but they do not.


---

Comment by vbraun created at 2014-01-24 17:41:12

Ideally we would check in "make doc", but incremental builds often lead to sphinx failures. To reliably check for errors we must delete the previous output. So if you do that in "make doc" then there is no makefile target for incremental builds.


---

Comment by jdemeyer created at 2014-01-24 18:00:54

Replying to [comment:2 vbraun]:
> To reliably check for errors we must delete the previous output. So if you do that in "make doc" then there is no makefile target for incremental builds.
I hope you're not proposing that `make [p]test[long]` would delete all doc output and rebuild all docs from scratch. That would add a significant amount of time to doctesting.


---

Comment by vbraun created at 2014-01-24 18:20:12

It doesn't add that much. If you have an alternative to reliably test documentation build then please explain...


---

Comment by vbraun created at 2014-01-24 19:36:54

We could just error out in "make doc" without rebuilding from scratch, but add a big fat hint at the end

```
Incremental documentation builds sometimes cause spurious 
error messages. To be certain that these are real errors, 
run "make doc-clean" first if you had not done so already.
```



---

Comment by jdemeyer created at 2014-01-24 19:53:16

An additional problem is that when doing `make doc` twice, the errors are only shown the first time.


---

Comment by jhpalmieri created at 2014-01-24 19:54:29

Certainly having `make doc` quit after an error would encourage people to fix documentation errors before putting things up for review. At least they would be more likely to notice the errors. We would need a helpful error message at the end, not just that the "reference manual failed to build", but that "reference/plotting failed to build because of errors in the file animate.py". Can we tell ahead of time if it was an incremental build? Otherwise, Volker's suggested error message might be misleading.

Next, we should also make "sage -t FILE" build the docs for that file ;)


---

Comment by vbraun created at 2014-01-24 19:59:20

Getting a summary of the errors is relatively easy, just grep through the log.

I'd say incremental build <=> src/doc/output exists


---

Comment by vbraun created at 2014-01-30 11:47:56

Using the `--warn-links` option might be a good idea, too.


---

Comment by jhpalmieri created at 2014-01-30 17:57:37

I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.


---

Comment by jhpalmieri created at 2014-01-30 20:00:09

Here's an attempt.
----
New commits:


---

Comment by jhpalmieri created at 2014-01-30 20:00:09

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-01-30 21:38:02

In a parallel doc build you are exiting only one of the workers. The whole build then waits forever for that worker process because of the old problem with pickling exceptions.


---

Comment by git created at 2014-01-30 22:57:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-30 22:59:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2014-01-30 22:59:40

I think this fixes it.


---

Comment by ncohen created at 2014-01-31 09:47:57

> I don't think so. First, we don't usually require internet access for building or doctesting Sage, and second, I've had random false positives with `--warn-links`: maybe the website was down or maybe there was some other problem. Maybe the patchbot should run with that option, but it should not be the default for docbuilding.

Oh. Well, I did not even know that `--warn-links` checked the internet links. My only use for it is that it detects broken internal links (:class:,:func:, ...), and there is a *LOT* of it.

Except in the graph/, numerical/ and combinat/designs/ folders of course `:-P`

Nathann


---

Comment by vbraun created at 2014-01-31 22:36:24

looks good to me!

The `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)


---

Comment by vbraun created at 2014-01-31 22:36:24

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-01-31 23:35:00

> The `--warn-links` mode (Sphinx's `nitpicky` mode) could be customized by monkey patching `_warn_missing_reference`. But that is only really useful unless somebody also would clean up broken links in the docs. So that is for another ticket, if anybody volunteers ;-)

Well. That really is a lot of work if it is to be done by somebody who does not know the code. A couple of times I tried to clean the links of the combinat/ folder, and it is REALLY painful when you have no idea what link was intended. Unless we have a way to make sure that all new links are correct I am afraid this will never be done. Unless people clean their respective code of course.

Nathann


---

Comment by vbraun created at 2014-02-01 15:17:04

Resolution: fixed
