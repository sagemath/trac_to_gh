# Issue 27302: py3: add _reduce__ to eclib modular symbol

Issue created by migration from https://trac.sagemath.org/ticket/27539

Original creator: chapoton

Original creation time: 2019-03-23 12:08:29

CC:  embray jdemeyer tscrim

to fix the last doctest in schemes/elliptic_curves/


---

Comment by chapoton created at 2019-03-23 12:08:41

New commits:


---

Comment by chapoton created at 2019-03-23 12:08:41

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-03-23 17:22:03

green bot, please review


---

Comment by tscrim created at 2019-03-23 22:23:13

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-03-23 22:23:13

LGTM.


---

Comment by embray created at 2019-03-25 11:03:41

It might be good if any test for a `__reduce__` method actually demonstrated pickling/unpickling, since that's what this is for.

A more general question though: Although I'm sure there's a good reason, it's not entirely clear from this ticket, or your commit message, why adding this was necessary for Python 3 support?  What exactly is this fixing, and why did this need a special `__reduce__` method when it didn't before?


---

Comment by embray created at 2019-03-25 11:03:41

Changing status from positive_review to needs_info.


---

Comment by vbraun created at 2019-03-25 19:43:10

Resolution: fixed


---

Comment by vbraun created at 2019-03-25 19:49:52

just noticed that there is more positive review necromancy on this ticket, but the question is imho better suited for sage-devel so how about you take it there?


---

Comment by embray created at 2019-03-26 11:56:25

Not really--I think Frederic could easily answer my question here.  I don't mind that it was merged but I still think this should be answered better...


---

Comment by embray created at 2019-03-26 11:56:52

Set assignee to chapoton.


---

Comment by tscrim created at 2019-03-26 13:36:52

So I can somewhat answer why I believe there was the necessity. The class is only a subclass of `object`, so it has no pickling support by default, which I think the python behavior changed in regard to how it handles this. My guess is some test was there is a test that uses this as part of its pickle.


---

Comment by vbraun created at 2019-03-27 08:46:39

I still think that information about general py2/3 differences in Sage code should be publicized more widely


---

Comment by embray created at 2019-03-27 19:06:41

I ran the tests for this sub-package on an older Python 3 build and had two test failures, one of which was obviously the one that this ticket was intended to fix, so I have updated the description with that additional info.

The question you have to ask is _why_ does this fail on Python 3 but not on Python 2? I've spent a bit of time looking into it and this is still not entirely clear to me.  This may well be the simplest and most obvious solution, and I have no problem with it on its face.  I'm just a little unsettled by not knowing why this worked before and now doesn't (even with the same pickle protocol it fails).
