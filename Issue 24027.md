# Issue 24027: Allow "generic" PolynomialRing implementation

archive/issues_024027.json:
```json
{
    "body": "CC:  @embray @tscrim\n\nIt is possible to specify a specific backend like `PolynomialRing(QQ, 'x', implementation=\"singular\")` but the opposite (asking for a generic Sage implementation) is not. Fix this by allowing `implementation=\"generic\"`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24264\n\n",
    "created_at": "2017-11-22T12:59:12Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Allow \"generic\" PolynomialRing implementation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24027",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @embray @tscrim

It is possible to specify a specific backend like `PolynomialRing(QQ, 'x', implementation="singular")` but the opposite (asking for a generic Sage implementation) is not. Fix this by allowing `implementation="generic"`.

Issue created by migration from https://trac.sagemath.org/ticket/24264





---

archive/issue_comments_336404.json:
```json
{
    "body": "+1",
    "created_at": "2017-11-22T13:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336404",
    "user": "https://github.com/embray"
}
```

+1



---

archive/issue_comments_336405.json:
```json
{
    "body": "This is harder than expected due to caching. Currently, the caching does not take into account the `implementation` keyword. That is an existing bug, but it makes it pointless to add more support for the `implementation` keyword.",
    "created_at": "2017-11-23T09:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336405",
    "user": "https://github.com/jdemeyer"
}
```

This is harder than expected due to caching. Currently, the caching does not take into account the `implementation` keyword. That is an existing bug, but it makes it pointless to add more support for the `implementation` keyword.



---

archive/issue_comments_336406.json:
```json
{
    "body": "Wouldn't it make sense to fix that?  It doesn't need to use the \"implementation\" keyword per se, but it would make sense if the type a method was called on was also cached?\n\nI'm likely missing something though since I don't know exactly what you mean in this case by \"caching\".",
    "created_at": "2017-11-23T10:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336406",
    "user": "https://github.com/embray"
}
```

Wouldn't it make sense to fix that?  It doesn't need to use the "implementation" keyword per se, but it would make sense if the type a method was called on was also cached?

I'm likely missing something though since I don't know exactly what you mean in this case by "caching".



---

archive/issue_comments_336407.json:
```json
{
    "body": "Replying to [comment:6 embray]:\n> Wouldn't it make sense to fix that?\n\n\nOf course. I'm just saying that this makes it harder than I initially expected.",
    "created_at": "2017-11-23T11:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336407",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 embray]:
> Wouldn't it make sense to fix that?


Of course. I'm just saying that this makes it harder than I initially expected.



---

archive/issue_comments_336408.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-23T11:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336408",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_336409.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-23T11:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336409",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_336410.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-23T12:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336410",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-23T14:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336412.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-23T14:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336412",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336413.json:
```json
{
    "body": "This change:\n\n```diff\ndiff --git a/src/sage/algebras/free_algebra.py b/src/sage/algebras/free_algebra.py\nindex e6c66e9..09db35d 100644\n--- a/src/sage/algebras/free_algebra.py\n+++ b/src/sage/algebras/free_algebra.py\n@@ -269,7 +269,7 @@ class FreeAlgebraFactory(UniqueFactory):\n         # test if we can use libSingular/letterplace\n         if implementation == \"letterplace\":\n             args = [arg for arg in (arg1, arg2) if arg is not None]\n-            kwds = dict(sparse=sparse, order=order, implementation=\"singular\")\n+            kwds = dict(order=order, implementation=\"singular\")\n             if name is not None:\n                 kwds[\"name\"] = name\n             if names is not None:\n```\nseems to cause multiple failures with the free algebra:\n\n```\nsage -t --long src/sage/algebras/free_algebra.py  # 12 doctests failed\nsage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Bad exit: 14\nsage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 19 doctests failed\nsage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 31 doctests failed\n```\nSee patchbots.\n\nAlso, we (and singular?) only have sparse implementations for multivariate polynomials, right?",
    "created_at": "2017-11-23T22:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336413",
    "user": "https://github.com/tscrim"
}
```

This change:

```diff
diff --git a/src/sage/algebras/free_algebra.py b/src/sage/algebras/free_algebra.py
index e6c66e9..09db35d 100644
--- a/src/sage/algebras/free_algebra.py
+++ b/src/sage/algebras/free_algebra.py
@@ -269,7 +269,7 @@ class FreeAlgebraFactory(UniqueFactory):
         # test if we can use libSingular/letterplace
         if implementation == "letterplace":
             args = [arg for arg in (arg1, arg2) if arg is not None]
-            kwds = dict(sparse=sparse, order=order, implementation="singular")
+            kwds = dict(order=order, implementation="singular")
             if name is not None:
                 kwds["name"] = name
             if names is not None:
```
seems to cause multiple failures with the free algebra:

```
sage -t --long src/sage/algebras/free_algebra.py  # 12 doctests failed
sage -t --long src/sage/algebras/letterplace/letterplace_ideal.pyx  # Bad exit: 14
sage -t --long src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # 19 doctests failed
sage -t --long src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # 31 doctests failed
```
See patchbots.

Also, we (and singular?) only have sparse implementations for multivariate polynomials, right?



---

archive/issue_comments_336414.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-24T09:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336414",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-24T10:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-24T10:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_336417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-24T10:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336417",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336418.json:
```json
{
    "body": "Replying to [comment:15 tscrim]:\n> seems to cause multiple failures with the free algebra:\n\n\nFixed by allowing `sparse=None` to mean `sparse=True` in the multi-variate case.",
    "created_at": "2017-11-24T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336418",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 tscrim]:
> seems to cause multiple failures with the free algebra:


Fixed by allowing `sparse=None` to mean `sparse=True` in the multi-variate case.



---

archive/issue_comments_336419.json:
```json
{
    "body": "Patchbot is green now.",
    "created_at": "2017-11-27T08:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336419",
    "user": "https://github.com/jdemeyer"
}
```

Patchbot is green now.



---

archive/issue_comments_336420.json:
```json
{
    "body": "What are your thoughts about changing `_implementation_names` to `_implementation`, which only takes a string? It is only used to differentiate between FLINT and NTL implementations in coercion. I think it could simplify the code overall.\n\nFurthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation. I know it is a little more brittle, but I think it will make the code more clean and would work well with the above suggestion. I haven't yet fully attempted this, but I will be happy to do this if you do not object.\n\nOne thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:\n\n```\nsage: RF.<x> = PolynomialRing(ZZ, implementation='FLINT')\nsage: RG.<x> = PolynomialRing(ZZ, implementation='generic')\nsage: RF.coerce_map_from(RG)\nsage: RF.has_coerce_map_from(RG)\nTrue\nsage: RG.has_coerce_map_from(RF)\nTrue\n```\nI've been told that this circular coercion gives a memory leak because the co(?)domain is cached by the coercion model. Although I cannot reproduce it:\n\n```\nsage: import gc\nsage: for i in range(10000):\n....:     if i % 100 == 0:\n....:         get_memory_usage()\n....:     R = PolynomialRing(ZZ, 'x%s'%i, implementation='FLINT')\n....:     S = PolynomialRing(ZZ, 'x%s'%i, implementation='generic')\n....:     assert R is not S\n....:     assert R.coerce_map_from(S) is not None\n....:     assert S.coerce_map_from(R) is not None\n....:     del R\n....:     del S\n....:     _ = gc.collect()\n5872.29296875\n5872.29296875\n5872.29296875\n5872.29296875\n...\n```\nHowever, it does introduce a *very* subtle reason why code could suddenly become slow by multiplying things in the opposite order. We will have to update things accordingly in that spot in `PolynomialRing._coerce_map_from_`.",
    "created_at": "2017-11-27T08:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336420",
    "user": "https://github.com/tscrim"
}
```

What are your thoughts about changing `_implementation_names` to `_implementation`, which only takes a string? It is only used to differentiate between FLINT and NTL implementations in coercion. I think it could simplify the code overall.

Furthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation. I know it is a little more brittle, but I think it will make the code more clean and would work well with the above suggestion. I haven't yet fully attempted this, but I will be happy to do this if you do not object.

One thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:

```
sage: RF.<x> = PolynomialRing(ZZ, implementation='FLINT')
sage: RG.<x> = PolynomialRing(ZZ, implementation='generic')
sage: RF.coerce_map_from(RG)
sage: RF.has_coerce_map_from(RG)
True
sage: RG.has_coerce_map_from(RF)
True
```
I've been told that this circular coercion gives a memory leak because the co(?)domain is cached by the coercion model. Although I cannot reproduce it:

```
sage: import gc
sage: for i in range(10000):
....:     if i % 100 == 0:
....:         get_memory_usage()
....:     R = PolynomialRing(ZZ, 'x%s'%i, implementation='FLINT')
....:     S = PolynomialRing(ZZ, 'x%s'%i, implementation='generic')
....:     assert R is not S
....:     assert R.coerce_map_from(S) is not None
....:     assert S.coerce_map_from(R) is not None
....:     del R
....:     del S
....:     _ = gc.collect()
5872.29296875
5872.29296875
5872.29296875
5872.29296875
...
```
However, it does introduce a *very* subtle reason why code could suddenly become slow by multiplying things in the opposite order. We will have to update things accordingly in that spot in `PolynomialRing._coerce_map_from_`.



---

archive/issue_comments_336421.json:
```json
{
    "body": "Replying to [comment:22 tscrim]:\n> Furthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation.\n\n\nWell, this will slow down creating polynomial rings. Every time that you create a polynomial ring with `implementation=None` (which is the default, so the most common case), you will need to run some code to figure out the implementation.\n\nLet me give a counter-proposal: instead of making `_implementation_names` an attribute, we create a static method on the polynomial ring class:\n\n```python\n# Assuming that the implementation for a given polynomial ring class\n# depends only on the base_ring, which is currently the case.\n@staticmethod\ndef _implementation_names(base_ring, implementation):\n    # Default implementation for generic polynomial rings\n    if implementation is None or implementation == \"generic\":\n        return [\"generic\", None]\n    raise ValueError(\"unknown implementation {!r}\".format(implementation))\n```\n\nI think that this will lead to cleaner code without the performance loss of normalizing the `implementation` every time.",
    "created_at": "2017-11-27T09:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336421",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 tscrim]:
> Furthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation.


Well, this will slow down creating polynomial rings. Every time that you create a polynomial ring with `implementation=None` (which is the default, so the most common case), you will need to run some code to figure out the implementation.

Let me give a counter-proposal: instead of making `_implementation_names` an attribute, we create a static method on the polynomial ring class:

```python
# Assuming that the implementation for a given polynomial ring class
# depends only on the base_ring, which is currently the case.
@staticmethod
def _implementation_names(base_ring, implementation):
    # Default implementation for generic polynomial rings
    if implementation is None or implementation == "generic":
        return ["generic", None]
    raise ValueError("unknown implementation {!r}".format(implementation))
```

I think that this will lead to cleaner code without the performance loss of normalizing the `implementation` every time.



---

archive/issue_comments_336422.json:
```json
{
    "body": "Replying to [comment:23 jdemeyer]:\n> Replying to [comment:22 tscrim]:\n> > Furthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation.\n\n> \n> Well, this will slow down creating polynomial rings. Every time that you create a polynomial ring with `implementation=None` (which is the default, so the most common case), you will need to run some code to figure out the implementation.\n\n\nAh, that is a good point about having to process the input.\n\n> Let me give a counter-proposal: instead of making `_implementation_names` an attribute, we create a static method on the polynomial ring class:\n> \n> ```\n> #!python\n> # Assuming that the implementation for a given polynomial ring class\n> # depends only on the base_ring, which is currently the case.\n> @staticmethod\n> def _implementation_names(base_ring, implementation):\n>     # Default implementation for generic polynomial rings\n>     if implementation is None or implementation == \"generic\":\n>         return [\"generic\", None]\n>     raise ValueError(\"unknown implementation {!r}\".format(implementation))\n> ```\n> \n> I think that this will lead to cleaner code without the performance loss of normalizing the `implementation` every time.\n\n\n+1 Do you want me to do this or will you?",
    "created_at": "2017-11-27T22:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336422",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:23 jdemeyer]:
> Replying to [comment:22 tscrim]:
> > Furthermore, how do you feel about instead of storing a key for all implementation keywords possible, we instead standardize the implementation keyword to always give the actual implementation.

> 
> Well, this will slow down creating polynomial rings. Every time that you create a polynomial ring with `implementation=None` (which is the default, so the most common case), you will need to run some code to figure out the implementation.


Ah, that is a good point about having to process the input.

> Let me give a counter-proposal: instead of making `_implementation_names` an attribute, we create a static method on the polynomial ring class:
> 
> ```
> #!python
> # Assuming that the implementation for a given polynomial ring class
> # depends only on the base_ring, which is currently the case.
> @staticmethod
> def _implementation_names(base_ring, implementation):
>     # Default implementation for generic polynomial rings
>     if implementation is None or implementation == "generic":
>         return ["generic", None]
>     raise ValueError("unknown implementation {!r}".format(implementation))
> ```
> 
> I think that this will lead to cleaner code without the performance loss of normalizing the `implementation` every time.


+1 Do you want me to do this or will you?



---

archive/issue_comments_336423.json:
```json
{
    "body": "Let me give this a try.",
    "created_at": "2017-11-30T10:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336423",
    "user": "https://github.com/jdemeyer"
}
```

Let me give this a try.



---

archive/issue_comments_336424.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-30T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336424",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-30T15:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336426.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> Let me give this a try.\n\n\nDone. This was more work than I initially thought, but I am happy with the result. The code looks cleaner than before.",
    "created_at": "2017-11-30T15:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336426",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 jdemeyer]:
> Let me give this a try.


Done. This was more work than I initially thought, but I am happy with the result. The code looks cleaner than before.



---

archive/issue_comments_336427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-30T15:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336427",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-30T21:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336429.json:
```json
{
    "body": "It definitely is cleaner to me as well. Some comments:\n\n- This seems fragile:\n  {{{#!python\n        implementation = self._implementation_names(implementation, base_ring)[0]\n        if implementation == \"NTL\":\n  }}}\n  I would instead do\n  {{{#!python\n        implementation = self._implementation_names(implementation, base_ring)[0]\n        if \"NTL\" in implementation:\n  }}}\n- The cyclic coercion (comment:22) should get a doctest for only the generic to FLINT (if I am reading the code correctly).\n- This feels a bit fragile to me\n  {{{#!python\n  if self.element_class.__name__ != 'Polynomial_integer_dense_flint':\n  }}}\n  I'm guessing you are doing this to avoid a circular import? What about doing something similar to what is currently there and checking the implementation name?\n- Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).\n\nCan you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.",
    "created_at": "2017-11-30T22:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336429",
    "user": "https://github.com/tscrim"
}
```

It definitely is cleaner to me as well. Some comments:

- This seems fragile:
  {{{#!python
        implementation = self._implementation_names(implementation, base_ring)[0]
        if implementation == "NTL":
  }}}
  I would instead do
  {{{#!python
        implementation = self._implementation_names(implementation, base_ring)[0]
        if "NTL" in implementation:
  }}}
- The cyclic coercion (comment:22) should get a doctest for only the generic to FLINT (if I am reading the code correctly).
- This feels a bit fragile to me
  {{{#!python
  if self.element_class.__name__ != 'Polynomial_integer_dense_flint':
  }}}
  I'm guessing you are doing this to avoid a circular import? What about doing something similar to what is currently there and checking the implementation name?
- Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).

Can you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.



---

archive/issue_comments_336430.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> - This seems fragile:\n>   {{{#!python\n>         implementation = self._implementation_names(implementation, base_ring)[0]\n>         if implementation == \"NTL\":\n>   }}}\n>   I would instead do\n>   {{{#!python\n>         implementation = self._implementation_names(implementation, base_ring)[0]\n>         if \"NTL\" in implementation:\n>   }}}\n\n\nWhy? I don't understand your objection.\n\n> - Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).\n\n\nWell, all of them are tested somewhere. Some are tested explicitly by calling `_implementation_names_impl`; some are tested indirectly by constructing an instance of a polynomial ring class; still others are testing using the polynomial ring constructor.\n\n> Can you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.\n\n\nIt was just simpler that way. First of all, the actual implementations can just `return NotImplemented` instead of raising an exception. This also simplifies one check in the polynomial constructor where I'm using list comprehension to check for `NotImplemented`. You cannot use list comprehension with a condition \"raises `ValueError`\".\n\nSecond, the wrapper method `_implementation_names()` does a sanity check of the output of `_implementation_names_impl()`: it checks that the given `implementation` is in the output list.",
    "created_at": "2017-12-01T09:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336430",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:30 tscrim]:
> - This seems fragile:
>   {{{#!python
>         implementation = self._implementation_names(implementation, base_ring)[0]
>         if implementation == "NTL":
>   }}}
>   I would instead do
>   {{{#!python
>         implementation = self._implementation_names(implementation, base_ring)[0]
>         if "NTL" in implementation:
>   }}}


Why? I don't understand your objection.

> - Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).


Well, all of them are tested somewhere. Some are tested explicitly by calling `_implementation_names_impl`; some are tested indirectly by constructing an instance of a polynomial ring class; still others are testing using the polynomial ring constructor.

> Can you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.


It was just simpler that way. First of all, the actual implementations can just `return NotImplemented` instead of raising an exception. This also simplifies one check in the polynomial constructor where I'm using list comprehension to check for `NotImplemented`. You cannot use list comprehension with a condition "raises `ValueError`".

Second, the wrapper method `_implementation_names()` does a sanity check of the output of `_implementation_names_impl()`: it checks that the given `implementation` is in the output list.



---

archive/issue_comments_336431.json:
```json
{
    "body": "Replying to [comment:22 tscrim]:\n> One thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:\n\n\nThat is a very deep rabbit hole.\n\nFirst of all, note that cyclic coercion is already possible in other cases:\n\n```\nsage: R = PolynomialRing(GF(3), 't', implementation='FLINT')\nsage: S = PolynomialRing(GF(3), 't', implementation='NTL')\nsage: R\nUnivariate Polynomial Ring in t over Finite Field of size 3\nsage: S\nUnivariate Polynomial Ring in t over Finite Field of size 3 (using NTL)\nsage: R.has_coerce_map_from(S)\nTrue\nsage: S.has_coerce_map_from(R)\nTrue\n```\n\nThere are two related issues when trying to fix this:\n\n(A) The polynomial ring itself does not store its implementation or any other information which could help to determine in which way a coercion should go.\n\n(B) Pickling doesn't work correctly for non-default implementations:\n\n```\n# Continuing the example above\nsage: loads(dumps(S)) is S\nFalse\nsage: loads(dumps(S)) is R\nTrue\n```\n\nCurrently, one could fix (A) by not allowing coercions between different implementations. But then (B) gives trouble because then there isn't even a coercion between `loads(dumps(S))` and `S`.\n\nSuggestions??",
    "created_at": "2017-12-01T11:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336431",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 tscrim]:
> One thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:


That is a very deep rabbit hole.

First of all, note that cyclic coercion is already possible in other cases:

```
sage: R = PolynomialRing(GF(3), 't', implementation='FLINT')
sage: S = PolynomialRing(GF(3), 't', implementation='NTL')
sage: R
Univariate Polynomial Ring in t over Finite Field of size 3
sage: S
Univariate Polynomial Ring in t over Finite Field of size 3 (using NTL)
sage: R.has_coerce_map_from(S)
True
sage: S.has_coerce_map_from(R)
True
```

There are two related issues when trying to fix this:

(A) The polynomial ring itself does not store its implementation or any other information which could help to determine in which way a coercion should go.

(B) Pickling doesn't work correctly for non-default implementations:

```
# Continuing the example above
sage: loads(dumps(S)) is S
False
sage: loads(dumps(S)) is R
True
```

Currently, one could fix (A) by not allowing coercions between different implementations. But then (B) gives trouble because then there isn't even a coercion between `loads(dumps(S))` and `S`.

Suggestions??



---

archive/issue_comments_336432.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> Replying to [comment:30 tscrim]:\n> > - This seems fragile:\n> >   {{{#!python\n> >         implementation = self._implementation_names(implementation, base_ring)[0]\n> >         if implementation == \"NTL\":\n> >   }}}\n> >   I would instead do\n> >   {{{#!python\n> >         implementation = self._implementation_names(implementation, base_ring)[0]\n> >         if \"NTL\" in implementation:\n> >   }}}\n \n> \n> Why? I don't understand your objection.\n\n\nI either missed, didn't remember, or didn't quite understand the implication of the \"The first element in the list is the canonical name.\" part of the `OUTPUT`. So I thought you were using an undocumented specification.\n\n> > - Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).\n \n> \n> Well, all of them are tested somewhere. Some are tested explicitly by calling `_implementation_names_impl`; some are tested indirectly by constructing an instance of a polynomial ring class; still others are testing using the polynomial ring constructor.\n\n\nWould it be possible to have at least one of those tests local to each of these functions? It would make it easier to debug if something broke later on.\n\n> > Can you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.\n\n> \n> It was just simpler that way. First of all, the actual implementations can just `return NotImplemented` instead of raising an exception. This also simplifies one check in the polynomial constructor where I'm using list comprehension to check for `NotImplemented`. You cannot use list comprehension with a condition \"raises `ValueError`\".\n\n>\n> Second, the wrapper method `_implementation_names()` does a sanity check of the output of `_implementation_names_impl()`: it checks that the given `implementation` is in the output list.\n\n\nThank you for the explanations. Makes sense to me, and it made it easy to see where these features are being used.",
    "created_at": "2017-12-01T11:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336432",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:31 jdemeyer]:
> Replying to [comment:30 tscrim]:
> > - This seems fragile:
> >   {{{#!python
> >         implementation = self._implementation_names(implementation, base_ring)[0]
> >         if implementation == "NTL":
> >   }}}
> >   I would instead do
> >   {{{#!python
> >         implementation = self._implementation_names(implementation, base_ring)[0]
> >         if "NTL" in implementation:
> >   }}}
 
> 
> Why? I don't understand your objection.


I either missed, didn't remember, or didn't quite understand the implication of the "The first element in the list is the canonical name." part of the `OUTPUT`. So I thought you were using an undocumented specification.

> > - Some `_implementation_names_impl` have doctests and others do not (including some with mildly non-trivial behavior).
 
> 
> Well, all of them are tested somewhere. Some are tested explicitly by calling `_implementation_names_impl`; some are tested indirectly by constructing an instance of a polynomial ring class; still others are testing using the polynomial ring constructor.


Would it be possible to have at least one of those tests local to each of these functions? It would make it easier to debug if something broke later on.

> > Can you also explain why you have the ``@`classmethod` and the ``@`staticmethod`? I'm not quite sure I understand why we need the redirection.

> 
> It was just simpler that way. First of all, the actual implementations can just `return NotImplemented` instead of raising an exception. This also simplifies one check in the polynomial constructor where I'm using list comprehension to check for `NotImplemented`. You cannot use list comprehension with a condition "raises `ValueError`".

>
> Second, the wrapper method `_implementation_names()` does a sanity check of the output of `_implementation_names_impl()`: it checks that the given `implementation` is in the output list.


Thank you for the explanations. Makes sense to me, and it made it easy to see where these features are being used.



---

archive/issue_comments_336433.json:
```json
{
    "body": "Replying to [comment:32 jdemeyer]:\n> Replying to [comment:22 tscrim]:\n> > One thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:\n\n> \n> That is a very deep rabbit hole.\n> \n> First of all, note that cyclic coercion is already possible in other cases:\n> \n> ```\n> sage: R = PolynomialRing(GF(3), 't', implementation='FLINT')\n> sage: S = PolynomialRing(GF(3), 't', implementation='NTL')\n> sage: R\n> Univariate Polynomial Ring in t over Finite Field of size 3\n> sage: S\n> Univariate Polynomial Ring in t over Finite Field of size 3 (using NTL)\n> sage: R.has_coerce_map_from(S)\n> True\n> sage: S.has_coerce_map_from(R)\n> True\n> ```\n\n\nI know some people would consider that a bug, and even if is not, it could create strange behavior and slowdowns because of moving between implementations.\n\n> There are two related issues when trying to fix this:\n> \n> (A) The polynomial ring itself does not store its implementation or any other information which could help to determine in which way a coercion should go.\n\n\nIt has to store something in order to get the different string representations. As for determining which way to make the coercion is a bit more arbitrary, but something we can do in the `_coerce_map_from_`.\n\n> (B) Pickling doesn't work correctly for non-default implementations:\n> \n> ```\n> # Continuing the example above\n> sage: loads(dumps(S)) is S\n> False\n> sage: loads(dumps(S)) is R\n> True\n> ```\n> \n> Currently, one could fix (A) by not allowing coercions between different implementations. But then (B) gives trouble because then there isn't even a coercion between `loads(dumps(S))` and `S`.\n\n\nThat's a bug (and somewhat horrifying).\n\n> Suggestions??\n\n\n(B) deserves a ticket all on its own. Although (A) is currently addressed for `ZZ` rings:\n\n```\nsage: R = PolynomialRing(ZZ, 't', implementation=\"FLINT\")\nsage: S = PolynomialRing(ZZ, 't', implementation=\"NTL\")\nsage: R.has_coerce_map_from(S)\nTrue\nsage: S.has_coerce_map_from(R)\nFalse\n```\nI can't think of a simple way with the current framework that we can have an ordering on the implementations that would correspond to the coercion order. I feel like we would need to add another ``@`staticmethod` specifying this (with a default of `[None]` when there is only 1 implementation, the default).\n\nI am also happy addressing (A) more thoroughly on a followup if we just add a test for\n\n```\nsage: T = PolynomialRing(ZZ, 't', implementation=\"generic\")\n```\nand the non-cyclic coercion with R and S above.",
    "created_at": "2017-12-01T12:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336433",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:32 jdemeyer]:
> Replying to [comment:22 tscrim]:
> > One thing that definitely needs fixing: By allowing generic coercions, we are introducing a memory leak via cyclic coercion between the generic and FLINT implementations:

> 
> That is a very deep rabbit hole.
> 
> First of all, note that cyclic coercion is already possible in other cases:
> 
> ```
> sage: R = PolynomialRing(GF(3), 't', implementation='FLINT')
> sage: S = PolynomialRing(GF(3), 't', implementation='NTL')
> sage: R
> Univariate Polynomial Ring in t over Finite Field of size 3
> sage: S
> Univariate Polynomial Ring in t over Finite Field of size 3 (using NTL)
> sage: R.has_coerce_map_from(S)
> True
> sage: S.has_coerce_map_from(R)
> True
> ```


I know some people would consider that a bug, and even if is not, it could create strange behavior and slowdowns because of moving between implementations.

> There are two related issues when trying to fix this:
> 
> (A) The polynomial ring itself does not store its implementation or any other information which could help to determine in which way a coercion should go.


It has to store something in order to get the different string representations. As for determining which way to make the coercion is a bit more arbitrary, but something we can do in the `_coerce_map_from_`.

> (B) Pickling doesn't work correctly for non-default implementations:
> 
> ```
> # Continuing the example above
> sage: loads(dumps(S)) is S
> False
> sage: loads(dumps(S)) is R
> True
> ```
> 
> Currently, one could fix (A) by not allowing coercions between different implementations. But then (B) gives trouble because then there isn't even a coercion between `loads(dumps(S))` and `S`.


That's a bug (and somewhat horrifying).

> Suggestions??


(B) deserves a ticket all on its own. Although (A) is currently addressed for `ZZ` rings:

```
sage: R = PolynomialRing(ZZ, 't', implementation="FLINT")
sage: S = PolynomialRing(ZZ, 't', implementation="NTL")
sage: R.has_coerce_map_from(S)
True
sage: S.has_coerce_map_from(R)
False
```
I can't think of a simple way with the current framework that we can have an ordering on the implementations that would correspond to the coercion order. I feel like we would need to add another ``@`staticmethod` specifying this (with a default of `[None]` when there is only 1 implementation, the default).

I am also happy addressing (A) more thoroughly on a followup if we just add a test for

```
sage: T = PolynomialRing(ZZ, 't', implementation="generic")
```
and the non-cyclic coercion with R and S above.



---

archive/issue_comments_336434.json:
```json
{
    "body": "Replying to [comment:34 tscrim]:\n> I am also happy addressing (A) more thoroughly on a followup if we just add a test for\n> \n> ```\n> sage: T = PolynomialRing(ZZ, 't', implementation=\"generic\")\n> ```\n> and the non-cyclic coercion with R and S above.\n\n\nYes, I would rather do that. This ticket is already getting quite big...",
    "created_at": "2017-12-04T09:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336434",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:34 tscrim]:
> I am also happy addressing (A) more thoroughly on a followup if we just add a test for
> 
> ```
> sage: T = PolynomialRing(ZZ, 't', implementation="generic")
> ```
> and the non-cyclic coercion with R and S above.


Yes, I would rather do that. This ticket is already getting quite big...



---

archive/issue_comments_336435.json:
```json
{
    "body": "Follow-up tickets: #24319, #24320 (Note that I do not plan to work on these)",
    "created_at": "2017-12-04T09:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336435",
    "user": "https://github.com/jdemeyer"
}
```

Follow-up tickets: #24319, #24320 (Note that I do not plan to work on these)



---

archive/issue_comments_336436.json:
```json
{
    "body": "Part of the mess in polynomial rings is that the logic for constructing them is separated in different places:\n\n1. The constructor `PolynomialRing`\n\n2. The `_implementation_names_impl()` method of the polynomial ring.\n\n3. The `__init__` method of the polynomial ring.\n\nThere are also two non-equivalent ways to pass an implementation: using the `implementation` keyword or using the `element_class` keyword.",
    "created_at": "2017-12-04T10:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336436",
    "user": "https://github.com/jdemeyer"
}
```

Part of the mess in polynomial rings is that the logic for constructing them is separated in different places:

1. The constructor `PolynomialRing`

2. The `_implementation_names_impl()` method of the polynomial ring.

3. The `__init__` method of the polynomial ring.

There are also two non-equivalent ways to pass an implementation: using the `implementation` keyword or using the `element_class` keyword.



---

archive/issue_comments_336437.json:
```json
{
    "body": "I feel like only `PolynomialRing` should take an `implementation` and not `__init__`. Instead, the `implementation` should be translated somewhere to an `element_class` which is passed to `__init__`.\n\nBut that will be for a follow-up.",
    "created_at": "2017-12-04T10:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336437",
    "user": "https://github.com/jdemeyer"
}
```

I feel like only `PolynomialRing` should take an `implementation` and not `__init__`. Instead, the `implementation` should be translated somewhere to an `element_class` which is passed to `__init__`.

But that will be for a follow-up.



---

archive/issue_comments_336438.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-04T10:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336438",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336439.json:
```json
{
    "body": "I hope that this addresses all your concerns.",
    "created_at": "2017-12-04T10:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336439",
    "user": "https://github.com/jdemeyer"
}
```

I hope that this addresses all your concerns.



---

archive/issue_comments_336440.json:
```json
{
    "body": "Yes, it does. Thank you.",
    "created_at": "2017-12-06T13:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336440",
    "user": "https://github.com/tscrim"
}
```

Yes, it does. Thank you.



---

archive/issue_comments_336441.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-06T13:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336441",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336442.json:
```json
{
    "body": "Finally... I initially started with this ticket thinking \"this should only take 1 hour\" :-)",
    "created_at": "2017-12-06T14:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336442",
    "user": "https://github.com/jdemeyer"
}
```

Finally... I initially started with this ticket thinking "this should only take 1 hour" :-)



---

archive/issue_comments_336443.json:
```json
{
    "body": "Ah, I know that feeling. Although in my case, that has always been a sign I am in for a whole day of programming. :P",
    "created_at": "2017-12-06T14:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336443",
    "user": "https://github.com/tscrim"
}
```

Ah, I know that feeling. Although in my case, that has always been a sign I am in for a whole day of programming. :P



---

archive/issue_comments_336444.json:
```json
{
    "body": "Replying to [comment:42 jdemeyer]:\n> Finally... I initially started with this ticket thinking \"this should only take 1 hour\" :-)\n\n\nI \"love\" when that happens.  I haven't really followed this closely since it quickly went beyond any understanding I have of the coercion system, but I'm glad it will be fixed.\n\nThe next thing to do might be to fix cases like the one I pointed out in #24263 to ensure that the polynomial implementation that's supposed to be being tested is actually the one being tested.",
    "created_at": "2017-12-06T15:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336444",
    "user": "https://github.com/embray"
}
```

Replying to [comment:42 jdemeyer]:
> Finally... I initially started with this ticket thinking "this should only take 1 hour" :-)


I "love" when that happens.  I haven't really followed this closely since it quickly went beyond any understanding I have of the coercion system, but I'm glad it will be fixed.

The next thing to do might be to fix cases like the one I pointed out in #24263 to ensure that the polynomial implementation that's supposed to be being tested is actually the one being tested.



---

archive/issue_comments_336445.json:
```json
{
    "body": "See patchbot",
    "created_at": "2017-12-11T15:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336445",
    "user": "https://github.com/vbraun"
}
```

See patchbot



---

archive/issue_comments_336446.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-12-11T15:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336446",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_336447.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-12T17:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336447",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_336448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-12T17:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336448",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336449.json:
```json
{
    "body": "Trivial thing, but can we break this output line since it is so long:\n\n```\n            ValueError: domain (Full MatrixSpace of 2 by 2 dense matrices over Univariate Polynomial Ring in x over Integer Ring)\n             and codomain (Univariate Polynomial Ring in t over Univariate Polynomial Ring in x over Integer Ring)\n             must have the same functorial construction over their base rings\n```\nOtherwise LGTM and you can set a positive review on my behalf.",
    "created_at": "2017-12-12T23:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336449",
    "user": "https://github.com/tscrim"
}
```

Trivial thing, but can we break this output line since it is so long:

```
            ValueError: domain (Full MatrixSpace of 2 by 2 dense matrices over Univariate Polynomial Ring in x over Integer Ring)
             and codomain (Univariate Polynomial Ring in t over Univariate Polynomial Ring in x over Integer Ring)
             must have the same functorial construction over their base rings
```
Otherwise LGTM and you can set a positive review on my behalf.



---

archive/issue_comments_336450.json:
```json
{
    "body": "Replying to [comment:48 tscrim]:\n> Trivial thing, but can we break this output line since it is so long\n\n\nShouldn't the output in doctests match the **actual** output from the terminal? If the actual output is one long line, shouldn't the doctest reflect that?\n\nIf you insist, I will change it though.",
    "created_at": "2017-12-13T13:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336450",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:48 tscrim]:
> Trivial thing, but can we break this output line since it is so long


Shouldn't the output in doctests match the **actual** output from the terminal? If the actual output is one long line, shouldn't the doctest reflect that?

If you insist, I will change it though.



---

archive/issue_comments_336451.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> Replying to [comment:48 tscrim]:\n> > Trivial thing, but can we break this output line since it is so long\n\n> \n> Shouldn't the output in doctests match the **actual** output from the terminal? If the actual output is one long line, shouldn't the doctest reflect that?\n> \n> If you insist, I will change it though.\n\n\nMy usually 90 char wide terminal splits it (essentially randomly) and we have the guideline of 80 char/line in documentation. So with that in mind, I was suggesting the most logical places to split that and keep the lines short. If you would rather leave it as one really (really) long line, then I won't insist, but it makes it much more manageable for me and is in the spirit of the rest of Sage's doc. (I would also not oppose a strict 80 char/line cuts as well.)",
    "created_at": "2017-12-13T13:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336451",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:49 jdemeyer]:
> Replying to [comment:48 tscrim]:
> > Trivial thing, but can we break this output line since it is so long

> 
> Shouldn't the output in doctests match the **actual** output from the terminal? If the actual output is one long line, shouldn't the doctest reflect that?
> 
> If you insist, I will change it though.


My usually 90 char wide terminal splits it (essentially randomly) and we have the guideline of 80 char/line in documentation. So with that in mind, I was suggesting the most logical places to split that and keep the lines short. If you would rather leave it as one really (really) long line, then I won't insist, but it makes it much more manageable for me and is in the spirit of the rest of Sage's doc. (I would also not oppose a strict 80 char/line cuts as well.)



---

archive/issue_comments_336452.json:
```json
{
    "body": "Replying to [comment:50 tscrim]:\n> and we have the guideline of 80 char/line in documentation.\n\n\nIn my mind, there is a difference between the different parts of the documentation:\n\n1. **textual documentation**: word wrap as usual\n\n2. **code in EXAMPLES**: follow PEP 8, which means trying to limit the line lengths\n\n3. **output in EXAMPLES**: I think it is best to keep the exact formatting of the output and not randomly wrap lines.",
    "created_at": "2017-12-13T15:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336452",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:50 tscrim]:
> and we have the guideline of 80 char/line in documentation.


In my mind, there is a difference between the different parts of the documentation:

1. **textual documentation**: word wrap as usual

2. **code in EXAMPLES**: follow PEP 8, which means trying to limit the line lengths

3. **output in EXAMPLES**: I think it is best to keep the exact formatting of the output and not randomly wrap lines.



---

archive/issue_comments_336453.json:
```json
{
    "body": "The problem is it is so ugly on my screen that I cannot read it at once with my default settings. IMO, there is no benefit in keeping it \"exactly\" (where I would say that is not completely accurate with how terminals can wrap) in the doc without some breaks (in this case, I think they are logical). Although this is effectively bikeshedding, and I don't care enough to die on this hill.",
    "created_at": "2017-12-14T04:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336453",
    "user": "https://github.com/tscrim"
}
```

The problem is it is so ugly on my screen that I cannot read it at once with my default settings. IMO, there is no benefit in keeping it "exactly" (where I would say that is not completely accurate with how terminals can wrap) in the doc without some breaks (in this case, I think they are logical). Although this is effectively bikeshedding, and I don't care enough to die on this hill.



---

archive/issue_events_061429.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-14T04:23:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24027#event-61429"
}
```



---

archive/issue_comments_336454.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-14T04:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336454",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336455.json:
```json
{
    "body": "```\nsage -t --long --warn-long 65.5 src/sage/rings/morphism.pyx\n**********************************************************************\nFile \"src/sage/rings/morphism.pyx\", line 361, in sage.rings.morphism\nFailed example:\n    phi3 = RingHomomorphism_from_base(H, R.hom([x])); phi3\nExpected:\n    Ring endomorphism of Univariate Quotient Polynomial Ring in a over Finite Field of size 2 with modulus x^2 + x + 1\n      Defn: Induced from base ring by\n            Ring endomorphism of Univariate Polynomial Ring in x over Finite Field of size 2 (using NTL)\n              Defn: x |--> x\nGot:\n    Ring endomorphism of Univariate Quotient Polynomial Ring in a over Finite Field of size 2 with modulus x^2 + x + 1\n      Defn: Induced from base ring by\n            Ring endomorphism of Univariate Polynomial Ring in x over Finite Field of size 2 (using GF2X)\n              Defn: x |--> x\n**********************************************************************\n```",
    "created_at": "2017-12-14T23:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336455",
    "user": "https://github.com/vbraun"
}
```

```
sage -t --long --warn-long 65.5 src/sage/rings/morphism.pyx
**********************************************************************
File "src/sage/rings/morphism.pyx", line 361, in sage.rings.morphism
Failed example:
    phi3 = RingHomomorphism_from_base(H, R.hom([x])); phi3
Expected:
    Ring endomorphism of Univariate Quotient Polynomial Ring in a over Finite Field of size 2 with modulus x^2 + x + 1
      Defn: Induced from base ring by
            Ring endomorphism of Univariate Polynomial Ring in x over Finite Field of size 2 (using NTL)
              Defn: x |--> x
Got:
    Ring endomorphism of Univariate Quotient Polynomial Ring in a over Finite Field of size 2 with modulus x^2 + x + 1
      Defn: Induced from base ring by
            Ring endomorphism of Univariate Polynomial Ring in x over Finite Field of size 2 (using GF2X)
              Defn: x |--> x
**********************************************************************
```



---

archive/issue_comments_336456.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-12-14T23:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336456",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_336457.json:
```json
{
    "body": "Jeroen, will you update the output here, or should I do it?",
    "created_at": "2017-12-22T05:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336457",
    "user": "https://github.com/tscrim"
}
```

Jeroen, will you update the output here, or should I do it?



---

archive/issue_comments_336458.json:
```json
{
    "body": "I forgot about this ticket. If you can update it, please do.",
    "created_at": "2017-12-22T10:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336458",
    "user": "https://github.com/jdemeyer"
}
```

I forgot about this ticket. If you can update it, please do.



---

archive/issue_comments_336459.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-12-23T07:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336459",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_336460.json:
```json
{
    "body": "Updated.\n\n---\nNew commits:",
    "created_at": "2017-12-23T07:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336460",
    "user": "https://github.com/tscrim"
}
```

Updated.

---
New commits:



---

archive/issue_comments_336461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-12-23T07:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_336462.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-12-23T07:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_336463.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-23T07:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336463",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336464.json:
```json
{
    "body": "Commit, then push. `:p`",
    "created_at": "2017-12-23T07:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336464",
    "user": "https://github.com/tscrim"
}
```

Commit, then push. `:p`



---

archive/issue_comments_336465.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-25T18:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24027#issuecomment-336465",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061430.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-25T18:20:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24027#event-61430"
}
```
