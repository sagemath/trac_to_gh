# Issue 29214: PARI/GP segfault on local-homebrew-macos-standard-nokegonly-python3_xcode

Issue created by migration from https://trac.sagemath.org/ticket/29451

Original creator: mkoeppe

Original creation time: 2020-04-02 21:30:49

CC:  jhpalmieri

First reported in https://groups.google.com/d/msg/sage-release/kU5M1QVuQQY/Zu10Q-CKAwAJ

Many doctest failures of this kind:

```
File "src/sage/arith/misc.py", line 5801, in sage.arith.misc.dedekind_sum
Failed example:
    dedekind_sum(3^54 - 1, 2^93 + 1, algorithm='pari')
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.arith.misc.dedekind_sum[6]>", line 1, in <module>
        dedekind_sum(Integer(3)**Integer(54) - Integer(1), Integer(2)**Integer(93) + Integer(1), algorithm='pari')
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/arith/misc.py", line 5839, in dedekind_sum
        x = sage.interfaces.gp.gp('sumdedekind(%s,%s)' % (p, q))
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 297, in __call__
        return cls(self, x, name=name)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 1471, in __init__
        self._name = parent._create(value, name=name)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 502, in _create
        self.set(name, value)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard-nokegonly-python3_xcode/local/lib/python3.7/site-packages/sage/interfaces/gp.py", line 561, in set
        raise TypeError("Error executing code in GP:\nCODE:\n\t%s\nPARI/GP ERROR:\n%s"%(cmd, out))
    TypeError: Error executing code in GP:
    CODE:
    	sage[2]=sumdedekind(58149737003040059690390168,9903520314283042199192993793);
    PARI/GP ERROR:
      ***   bug in PARI/GP (Segmentation Fault), please report.
**********************************************************************
```


To reproduce (with #29417): `tox -e local-homebrew-macos-standard-nokegonly-python3_xcode -- ptest`


---

Comment by jhpalmieri created at 2020-04-02 23:52:59

This appears to be specific to Xcode 11.4. I just installed 9.1.beta9 on a machine with Xcode 11.3.1 and (for example) the file `schemes/elliptic_curves/ell_rational_field.py` passed tests. I upgraded that machine to use Xcode 11.4, rebuilt Sage, and then I hit these segfaults.

The new Xcode also leads to this in the top-level `config.log`:

```
clang: error: unable to execute command: Broken pipe: 13
clang: error: clang frontend command failed due to signal (use -v to see invocation)
Apple clang version 11.0.3 (clang-1103.0.32.29)
Target: x86_64-apple-darwin19.3.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
clang: note: diagnostic msg: PLEASE submit a bug report to http://developer.apple.com/bugreporter/ and include the crash backtrace, preprocessed source, and associated run script.
clang: note: diagnostic msg: 
********************

PLEASE ATTACH THE FOLLOWING FILES TO THE BUG REPORT:
Preprocessed source(s) and associated run script(s) are located at:
clang: note: diagnostic msg: /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/conftest-d428b4.cpp
clang: note: diagnostic msg: /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/conftest-d428b4.sh
clang: note: diagnostic msg: Crash backtrace is located in
clang: note: diagnostic msg: /Users/palmieri/Library/Logs/DiagnosticReports/clang_<YYYY-MM-DD-HHMMSS>_<hostname>.crash
clang: note: diagnostic msg: (choose the .crash file that corresponds to your crash)
clang: note: diagnostic msg: 

```

This message did not appear in 11.3.1. Is there a connection?


---

Comment by mkoeppe created at 2020-04-03 00:23:32

I also started to see the segfaults only after updating XCode.


---

Comment by mkoeppe created at 2020-04-03 09:53:23

Changing priority from major to blocker.


---

Comment by jhpalmieri created at 2020-04-03 16:19:03

I also don't see this if I use "--with-system-python3=no". Does that make any sense?


---

Comment by mkoeppe created at 2020-04-03 20:43:28

Replying to [comment:6 jhpalmieri]:
> I also don't see this if I use "--with-system-python3=no". 

Yes, I can confirm this. This configuration is now `local-homebrew-macos-standard-python3_spkg` in #29417.


---

Comment by mkoeppe created at 2020-04-03 20:52:43

`MACOSX_DEPLOYMENT_TARGET` is the problem. This is set in `sage-env` depending on whether we use system python3 or not. I'll investigate more.


---

Comment by mkoeppe created at 2020-04-03 21:38:32

Related previous ticket:
- #17204: OSX Yosemite libtool version detection
----
New commits:


---

Comment by git created at 2020-04-03 21:41:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-04-03 22:01:30

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-04-03 23:56:58

See also #18272.


---

Comment by jhpalmieri created at 2020-04-04 00:12:03

This fixes Pari for me — its test suite passes — but I still see lots of doctest failures:

```
sage -t --long --warn-long 75.1 src/sage/misc/sagedoc.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/tests/cmdline.py  # 4 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/sageinspect.py  # 35 doctests failed
sage -t --long --warn-long 75.1 src/sage/repl/ipython_extension.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/structure/element.pyx  # 44 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/cachefunc.pyx  # 54 doctests failed
sage -t --long --warn-long 75.1 src/sage/geometry/polyhedron/combinatorial_polyhedron/conversions.pyx  # 24 doctests failed
sage -t --long --warn-long 75.1 src/sage/graphs/connectivity.pyx  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/cython.py  # 19 doctests failed
sage -t --long --warn-long 75.1 src/sage/parallel/decorate.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/features/__init__.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/ext/memory_allocator.pxd  # 3 doctests failed
sage -t --long --warn-long 75.1 src/sage/ext/memory_allocator.pyx  # 6 doctests failed
sage -t --long --warn-long 75.1 src/sage/libs/pynac/pynac.pxd  # 1 doctest failed
sage -t --long --warn-long 75.1 src/sage/cpython/cython_metaclass.pyx  # 4 doctests failed
sage -t --long --warn-long 75.1 src/sage/arith/long.pxd  # 14 doctests failed
sage -t --long --warn-long 75.1 src/sage/structure/factory.pyx  # 8 doctests failed
sage -t --long --warn-long 75.1 src/sage/cpython/getattr.pyx  # 4 doctests failed
sage -t --long --warn-long 75.1 src/sage/geometry/polyhedron/combinatorial_polyhedron/polyhedron_face_lattice.pyx  # 9 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/superseded.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/lazy_attribute.pyx  # 3 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/inherit_comparison.pyx  # 5 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/session.pyx  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/rings/integer_fake.pxd  # 1 doctest failed
sage -t --long --warn-long 75.1 src/sage/geometry/polyhedron/combinatorial_polyhedron/list_of_faces.pyx  # 1 doctest failed
sage -t --long --warn-long 75.1 src/sage/docs/instancedoc.pyx  # 4 doctests failed
sage -t --long --warn-long 75.1 src/sage/libs/glpk/error.pyx  # 1 doctest failed
sage -t --long --warn-long 75.1 src/sage/repl/load.py  # 2 doctests failed
sage -t --long --warn-long 75.1 src/sage/cpython/wrapperdescr.pxd  # 6 doctests failed
sage -t --long --warn-long 75.1 src/sage/misc/nested_class.pyx  # 6 doctests failed
sage -t --long --warn-long 75.1 src/sage/cpython/string.pyx  # 1 doctest failed
```

One such failure:

```
File "src/sage/misc/sagedoc.py", line 647, in sage.misc.sagedoc.format
Failed example:
    cython('\n'.join(cython_code))
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/unixccompiler.py", line 204, in link
        self.spawn(linker + ld_args)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/ccompiler.py", line 910, in spawn
        spawn(cmd, dry_run=self.dry_run)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/spawn.py", line 36, in spawn
        _spawn_posix(cmd, search_path, dry_run=dry_run)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/spawn.py", line 159, in _spawn_posix
        % (cmd, exit_status))
    distutils.errors.DistutilsExecError: command 'gcc' failed with exit status 1

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/cython.py", line 372, in cython
        dist.run_command("build")
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/dist.py", line 985, in run_command
        cmd_obj.run()
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/command/build.py", line 135, in run
        self.run_command(cmd_name)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/cmd.py", line 313, in run_command
        self.distribution.run_command(command)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/dist.py", line 985, in run_command
        cmd_obj.run()
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/command/build_ext.py", line 340, in run
        self.build_extensions()
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/command/build_ext.py", line 449, in build_extensions
        self._build_extensions_serial()
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/command/build_ext.py", line 474, in _build_extensions_serial
        self.build_extension(ext)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/command/build_ext.py", line 559, in build_extension
        target_lang=language)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/ccompiler.py", line 717, in link_shared_object
        extra_preargs, extra_postargs, build_temp, target_lang)
      File "/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/distutils/unixccompiler.py", line 206, in link
        raise LinkError(msg)
    distutils.errors.LinkError: command 'gcc' failed with exit status 1

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.sagedoc.format[9]>", line 1, in <module>
        cython('\n'.join(cython_code))
      File "sage/misc/lazy_import.pyx", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3686)
        return self.get_object()(*args, **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/cython.py", line 634, in cython_compile
        return cython_import_all(tmpfile, get_globals(), **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/cython.py", line 524, in cython_import_all
        m = cython_import(filename, **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/cython.py", line 499, in cython_import
        name, build_dir = cython(filename, **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/default/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/cython.py", line 378, in cython
        raise RuntimeError(msg.strip())
    RuntimeError: command 'gcc' failed with exit status 1
    ld: library not found for -lmpfr
    clang: error: linker command failed with exit code 1 (use -v to see invocation)
```

This is with Homebrew's Python. I'm also trying with the system Python; I've already verified that Pari's test suite passes with that setup, but the rest of the build hasn't finished yet.


---

Comment by jhpalmieri created at 2020-04-04 05:23:59

On another machine, only a few failures:

```
sage -t --long --warn-long 149.7 src/sage/repl/ipython_extension.py  # 4 doctests failed
sage -t --long --warn-long 149.7 src/sage/misc/persist.pyx  # 2 doctests failed
sage -t --long --warn-long 149.7 src/sage/misc/inline_fortran.py  # 3 doctests failed
```

These all seem to be Fortran-related. For example:

```
File "src/sage/repl/ipython_extension.py", line 385, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
    shell.run_cell('''
    %%fortran
    C FILE: FIB1.F
          SUBROUTINE FIB(A,N)
    C
    C     CALCULATE FIRST N FIBONACCI NUMBERS
    C
          INTEGER N
          REAL*8 A(N)
          DO I=1,N
             IF (I.EQ.1) THEN
                A(I) = 0.0D0
             ELSEIF (I.EQ.2) THEN
                A(I) = 1.0D0
             ELSE
                A(I) = A(I-1) + A(I-2)
             ENDIF
          ENDDO
          END
    C END FILE FIB1.F
    ''')
Expected nothing
Got:
    ---------------------------------------------------------------------------
    CalledProcessError                        Traceback (most recent call last)
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/inline_fortran.py in eval(self, x, globals, locals)
        190             try:
    --> 191                 out = subprocess.check_output(cmd, stderr=subprocess.STDOUT)
        192             except subprocess.CalledProcessError as exc:
    <BLANKLINE>
    /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/subprocess.py in check_output(timeout, *popenargs, **kwargs)
        394     return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
    --> 395                **kwargs).stdout
        396 
    <BLANKLINE>
    /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/subprocess.py in run(input, capture_output, timeout, check, *popenargs, **kwargs)
        486             raise CalledProcessError(retcode, process.args,
    --> 487                                      output=stdout, stderr=stderr)
        488     return CompletedProcess(process.args, retcode, stdout, stderr)
    <BLANKLINE>
    CalledProcessError: Command '['/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/bin/python3', '-c', 'import numpy.f2py; numpy.f2py.main()', '-c', '-m', 'fortran_module', 'fortran_module.f', '--quiet', '--f77exec=sage-inline-fortran', '--f90exec=sage-inline-fortran']' returned non-zero exit status 1.
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    RuntimeError                              Traceback (most recent call last)
    <ipython-input-1-eff726e82e94> in <module>()
          1 
    ----> 2 get_ipython().run_cell_magic('fortran', '', 'C FILE: FIB1.F\n      SUBROUTINE FIB(A,N)\nC\nC     CALCULATE FIRST N FIBONACCI NUMBERS\nC\n      INTEGER N\n      REAL*8 A(N)\n      DO I=1,N\n         IF (I.EQ.1) THEN\n            A(I) = 0.0D0\n         ELSEIF (I.EQ.2) THEN\n            A(I) = 1.0D0\n         ELSE\n            A(I) = A(I-1) + A(I-2)\n         ENDIF\n      ENDDO\n      END\nC END FILE FIB1.F')
    <BLANKLINE>
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/IPython/core/interactiveshell.py in run_cell_magic(self, magic_name, line, cell)
       2115             magic_arg_s = self.var_expand(line, stack_depth)
       2116             with self.builtin_trap:
    -> 2117                 result = fn(magic_arg_s, cell)
       2118             return result
       2119 
    <BLANKLINE>
    </Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/decorator.py:decorator-gen-119> in fortran(self, line, cell)
    <BLANKLINE>
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/IPython/core/magic.py in <lambda>(f, *a, **k)
        186     # but it's overkill for just that one bit of state.
        187     def magic_deco(arg):
    --> 188         call = lambda f, *a, **k: f(*a, **k)
        189 
        190         if callable(arg):
    <BLANKLINE>
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in fortran(self, line, cell)
        413         """
        414         from sage.misc.inline_fortran import fortran
    --> 415         return fortran(cell)
        416 
        417 
    <BLANKLINE>
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/inline_fortran.py in __call__(self, *args, **kwds)
         95 
         96     def __call__(self, *args, **kwds):
    ---> 97         return self.eval(*args, **kwds)
         98 
         99     def eval(self, x, globals=None, locals=None):
    <BLANKLINE>
    /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/sage/misc/inline_fortran.py in eval(self, x, globals, locals)
        192             except subprocess.CalledProcessError as exc:
        193                 raise RuntimeError(
    --> 194                     "failed to compile Fortran code:\n{}".format(exc.output))
        195 
        196             # Note that f2py() doesn't raise an exception if it fails.
    <BLANKLINE>
    RuntimeError: failed to compile Fortran code:
    b'Could not locate executable g++ -std=gnu++11 -pthread -bundle -undefined dynamic_lookup\nIn file included from /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortran_modulemodule.c:16:\nIn file included from /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortranobject.h:13:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/arrayobject.h:4:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/ndarraytypes.h:1822:\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: warning: "Using deprecated NumPy API, disable it with "          "#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-W#warnings]\n#warning "Using deprecated NumPy API, disable it with " \\\n ^\nIn file included from /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortranobject.c:2:\nIn file included from /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortranobject.h:13:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/arrayobject.h:4:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:\nIn file included from /Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/ndarraytypes.h:1822:\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: warning: "Using deprecated NumPy API, disable it with "          "#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-W#warnings]\n#warning "Using deprecated NumPy API, disable it with " \\\n ^\n/var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortran_modulemodule.c:109:12: warning: unused function \'f2py_size\' [-Wunused-function]\nstatic int f2py_size(PyArrayObject* var, ...)\n           ^\n/var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortranobject.c:138:18: warning: comparison of integers of different signs: \'Py_ssize_t\' (aka \'long\') and \'unsigned long\' [-Wsign-compare]\n        if (size < sizeof(notalloc)) {\n            ~~~~ ^ ~~~~~~~~~~~~~~~~\n2 warnings generated.\n2 warnings generated.\nUndefined symbols for architecture x86_64:\n  "_PyArg_ParseTupleAndKeywords", referenced from:\n      _f2py_rout_fortran_module_fib in fortran_modulemodule.o\n  "_PyBytes_FromString", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyCapsule_GetPointer", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _F2PyCapsule_AsVoidPtr in fortranobject.o\n  "_PyCapsule_New", referenced from:\n      _fortran_getattr in fortranobject.o\n      _F2PyCapsule_FromVoidPtr in fortranobject.o\n  "_PyCapsule_Type", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _F2PyCapsule_Check in fortranobject.o\n  "_PyComplex_Type", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n  "_PyDict_DelItemString", referenced from:\n      _fortran_setattr in fortranobject.o\n  "_PyDict_GetItemString", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyDict_New", referenced from:\n      _PyFortranObject_New in fortranobject.o\n      _PyFortranObject_NewAsAttr in fortranobject.o\n      _fortran_setattr in fortranobject.o\n  "_PyDict_SetItemString", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _F2PyDict_SetItemString in fortranobject.o\n      _PyFortranObject_New in fortranobject.o\n      _fortran_getattr in fortranobject.o\n      _fortran_setattr in fortranobject.o\n  "_PyErr_Clear", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n      _F2PyDict_SetItemString in fortranobject.o\n      _fortran_getattr in fortranobject.o\n      _fortran_repr in fortranobject.o\n      _F2PyCapsule_FromVoidPtr in fortranobject.o\n      _F2PyCapsule_AsVoidPtr in fortranobject.o\n  "_PyErr_Format", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _fortran_call in fortranobject.o\n      _check_and_fix_dimensions in fortranobject.o\n  "_PyErr_NewException", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyErr_NoMemory", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyErr_Occurred", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _f2py_rout_fortran_module_fib in fortran_modulemodule.o\n      _int_from_pyobj in fortran_modulemodule.o\n      _F2PyDict_SetItemString in fortranobject.o\n  "_PyErr_Print", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _F2PyDict_SetItemString in fortranobject.o\n  "_PyErr_SetString", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _f2py_rout_fortran_module_fib in fortran_modulemodule.o\n      _int_from_pyobj in fortran_modulemodule.o\n      _fortran_setattr in fortranobject.o\n      _array_from_pyobj in fortranobject.o\n      _check_and_fix_dimensions in fortranobject.o\n  "_PyExc_AttributeError", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _fortran_setattr in fortranobject.o\n  "_PyExc_ImportError", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyExc_RuntimeError", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _fortran_call in fortranobject.o\n  "_PyExc_TypeError", referenced from:\n      _fortran_call in fortranobject.o\n      _array_from_pyobj in fortranobject.o\n  "_PyExc_ValueError", referenced from:\n      _array_from_pyobj in fortranobject.o\n      _check_and_fix_dimensions in fortranobject.o\n  "_PyImport_ImportModule", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyLong_AsLong", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n  "_PyMem_Free", referenced from:\n      _fortran_dealloc in fortranobject.o\n      _fortran_getattr in fortranobject.o\n  "_PyMem_Malloc", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyModule_Create2", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyModule_GetDict", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyNumber_Long", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n  "_PyOS_snprintf", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyObject_GenericGetAttr", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyObject_GetAttrString", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _int_from_pyobj in fortran_modulemodule.o\n      _fortran_repr in fortranobject.o\n  "_PySequence_Check", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n  "_PySequence_GetItem", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n  "_PyType_IsSubtype", referenced from:\n      _int_from_pyobj in fortran_modulemodule.o\n      _array_from_pyobj in fortranobject.o\n  "_PyType_Type", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n  "_PyUnicode_Concat", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_PyUnicode_FromFormat", referenced from:\n      _fortran_repr in fortranobject.o\n  "_PyUnicode_FromString", referenced from:\n      _PyInit_fortran_module in fortran_modulemodule.o\n      _fortran_getattr in fortranobject.o\n      _fortran_repr in fortranobject.o\n  "_PyUnicode_FromStringAndSize", referenced from:\n      _fortran_getattr in fortranobject.o\n  "_Py_BuildValue", referenced from:\n      _f2py_rout_fortran_module_fib in fortran_modulemodule.o\n  "__PyObject_New", referenced from:\n      _PyFortranObject_New in fortranobject.o\n      _PyFortranObject_NewAsAttr in fortranobject.o\n  "__Py_NoneStruct", referenced from:\n      _f2py_rout_fortran_module_fib in fortran_modulemodule.o\n      _fortran_getattr in fortranobject.o\n      _fortran_setattr in fortranobject.o\n      _array_from_pyobj in fortranobject.o\n  "_main", referenced from:\n     implicit entry/start for main executable\nld: symbol(s) not found for architecture x86_64\ncollect2: error: ld returned 1 exit status\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/distutils/fcompiler/__init__.py:530: UserWarning: LDFLAGS is used as is, not appended to flags already defined by numpy.distutils! Use NPY_DISTUTILS_APPEND_FLAGS=1 to obtain appending behavior instead (this behavior will become default in a future release).\n  linker_so_flags = self.flag_vars.linker_so\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/distutils/fcompiler/__init__.py:540: UserWarning: LDFLAGS is used as is, not appended to flags already defined by numpy.distutils! Use NPY_DISTUTILS_APPEND_FLAGS=1 to obtain appending behavior instead (this behavior will become default in a future release).\n  linker_exe_flags = self.flag_vars.linker_exe\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/distutils/fcompiler/__init__.py:530: UserWarning: LDFLAGS is used as is, not appended to flags already defined by numpy.distutils! Use NPY_DISTUTILS_APPEND_FLAGS=1 to obtain appending behavior instead (this behavior will become default in a future release).\n  linker_so_flags = self.flag_vars.linker_so\n/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib/python3.7/site-packages/numpy/distutils/fcompiler/__init__.py:540: UserWarning: LDFLAGS is used as is, not appended to flags already defined by numpy.distutils! Use NPY_DISTUTILS_APPEND_FLAGS=1 to obtain appending behavior instead (this behavior will become default in a future release).\n  linker_exe_flags = self.flag_vars.linker_exe\nerror: Command "/usr/local/bin/gfortran -Wall -g -L/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib -Wl,-rpath,/Users/palmieri/Sage/new-xcode/sage-9.1.beta9/local/lib /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortran_modulemodule.o /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/src.macosx-10.14-x86_64-3.7/fortranobject.o /var/folders/zm/sbm1ly294l7f9cvdtcr74k0h0000gn/T/tmpdpx6g93e/fortran_module.o -L/usr/local/Cellar/gcc/9.2.0_3/lib/gcc/9/gcc/x86_64-apple-darwin19/9.2.0 -L/usr/local/Cellar/gcc/9.2.0_3/lib/gcc/9/gcc/x86_64-apple-darwin19/9.2.0/../../.. -L/usr/local/Cellar/gcc/9.2.0_3/lib/gcc/9/gcc/x86_64-apple-darwin19/9.2.0/../../.. -lgfortran -o ./fortran_module.cpython-37m-darwin.so" failed with exit status 1\n'
```



---

Comment by mkoeppe created at 2020-04-04 13:28:07

Let's do these on separate tickets.

I have created #29463 for the Fortran-related things.


---

Comment by jhpalmieri created at 2020-04-04 16:01:08

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-04-04 16:01:08

Okay, looks good. Let me know if you manage to reproduce the failures in comment:14.


---

Comment by mkoeppe created at 2020-04-04 16:05:06

Thanks! I'll first look into the Fortran-related failures.


---

Comment by jhpalmieri created at 2020-04-05 02:59:33

Replying to [comment:18 jhpalmieri]:
> Okay, looks good. Let me know if you manage to reproduce the failures in comment:14.

I am having problems reproducing them, in fact. Maybe there was something off in my environment? I'll keep an eye out, in any case.


---

Comment by vbraun created at 2020-04-09 22:45:17

Resolution: fixed
