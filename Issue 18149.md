# Issue 18149: polylog quirks

archive/issues_018149.json:
```json
{
    "body": "CC:  @kiwifb\n\nKeywords: pynac special\n\nThe `polylog` function (from Pynac) treats `1.0` like `1` and does not immediately `evalf` with some numeric arguments. \n\n```\nsage: polylog(2,1)\n1/6*pi^2\nsage: polylog(2.,1)\n1.64493406684823\nsage: polylog(2,1.0)\n1/6*pi^2\nsage: polylog(2,0.9)\npolylog(2, 0.900000000000000)\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18386\n\n",
    "created_at": "2015-05-09T08:51:04Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "polylog quirks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18149",
    "user": "https://github.com/rwst"
}
```
CC:  @kiwifb

Keywords: pynac special

The `polylog` function (from Pynac) treats `1.0` like `1` and does not immediately `evalf` with some numeric arguments. 

```
sage: polylog(2,1)
1/6*pi^2
sage: polylog(2.,1)
1.64493406684823
sage: polylog(2,1.0)
1/6*pi^2
sage: polylog(2,0.9)
polylog(2, 0.900000000000000)

```


Issue created by migration from https://trac.sagemath.org/ticket/18386





---

archive/issue_comments_244438.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-23T20:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244438",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_244439.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-28T01:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244439",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_244440.json:
```json
{
    "body": "Ralf, there was a typo in the description of #21034 pointing to #18368 rather than this ticket.\n\nI'm finding this behavior odd:\n\n\n```\nsage: polylog(2,.9999999999999999)\n1.64493406684822\nsage: polylog(2,1.)\nNaN - NaN*I\n```\n\n\nThis doesn't look fixed upstream to me: `evalf` needs to return a numeric value.\n\nThe doctest in `functions/log.py` captures the current behavior, but needs to be updated before this ticket can be closed.",
    "created_at": "2016-07-28T01:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244440",
    "user": "https://github.com/paulmasson"
}
```

Ralf, there was a typo in the description of #21034 pointing to #18368 rather than this ticket.

I'm finding this behavior odd:


```
sage: polylog(2,.9999999999999999)
1.64493406684822
sage: polylog(2,1.)
NaN - NaN*I
```


This doesn't look fixed upstream to me: `evalf` needs to return a numeric value.

The doctest in `functions/log.py` captures the current behavior, but needs to be updated before this ticket can be closed.



---

archive/issue_comments_244441.json:
```json
{
    "body": "Polylog has a branch point/discontinuity at arguments (2,1). Anyway, we're just taking what arb is giving us:\n\n```\nsage: RBF=ComplexBallField(53)\nsage: RBF(1.5).polylog(RBF(2.5))\n[2.27833425640 +/- 2.25e-12] + [-0.61016023975 +/- 3.09e-12]*I\nsage: RBF(.99999999).polylog(RBF(2.))\n[1.6449338726414 +/- 9.23e-14] + [+/- 2.46e-13]*I\nsage: RBF(1.).polylog(RBF(2.))\nnan + nan*I\nsage: RBF(1.00000001).polylog(RBF(2.))\n[1.644934261055 +/- 1.08e-13] + [-3.1416e-8 +/- 3.19e-13]*I\nsage: polylog(2,1)\n1/6*pi^2\n```\n\nThis is very sensible because if you need the exact value say so, and if you need an inexact value to 53 (or any) digits the result cannot be given in that precision so it's NaN. I'll concede that, similar to #19439 it may be desired to return the symbolic NaN.",
    "created_at": "2016-07-28T13:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244441",
    "user": "https://github.com/rwst"
}
```

Polylog has a branch point/discontinuity at arguments (2,1). Anyway, we're just taking what arb is giving us:

```
sage: RBF=ComplexBallField(53)
sage: RBF(1.5).polylog(RBF(2.5))
[2.27833425640 +/- 2.25e-12] + [-0.61016023975 +/- 3.09e-12]*I
sage: RBF(.99999999).polylog(RBF(2.))
[1.6449338726414 +/- 9.23e-14] + [+/- 2.46e-13]*I
sage: RBF(1.).polylog(RBF(2.))
nan + nan*I
sage: RBF(1.00000001).polylog(RBF(2.))
[1.644934261055 +/- 1.08e-13] + [-3.1416e-8 +/- 3.19e-13]*I
sage: polylog(2,1)
1/6*pi^2
```

This is very sensible because if you need the exact value say so, and if you need an inexact value to 53 (or any) digits the result cannot be given in that precision so it's NaN. I'll concede that, similar to #19439 it may be desired to return the symbolic NaN.



---

archive/issue_comments_244442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-06T15:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244442",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_244443.json:
```json
{
    "body": "Replying to [comment:6 paulmasson]:\n> I'm finding this behavior odd:\n> \n> {{{\n> sage: polylog(2,1.)\n> NaN - NaN*I\n> }}}\n> \n> This doesn't look fixed upstream to me: `evalf` needs to return a numeric value.\n\nEvalf does return a numeric value, too:\n\n```\nsage: polylog(2,1.0).n()\nNaN - NaN*I\nsage: type(_)\n<type 'sage.rings.complex_number.ComplexNumber'>\n```\n\nso, together with my previous answer I think this ticket can be closed.",
    "created_at": "2016-11-06T15:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244443",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:6 paulmasson]:
> I'm finding this behavior odd:
> 
> {{{
> sage: polylog(2,1.)
> NaN - NaN*I
> }}}
> 
> This doesn't look fixed upstream to me: `evalf` needs to return a numeric value.

Evalf does return a numeric value, too:

```
sage: polylog(2,1.0).n()
NaN - NaN*I
sage: type(_)
<type 'sage.rings.complex_number.ComplexNumber'>
```

so, together with my previous answer I think this ticket can be closed.



---

archive/issue_comments_244444.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-18T07:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244444",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_244445.json:
```json
{
    "body": "That was badly mistyped and misinterpreted by me, so back to the issue.",
    "created_at": "2017-04-18T07:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244445",
    "user": "https://github.com/rwst"
}
```

That was badly mistyped and misinterpreted by me, so back to the issue.



---

archive/issue_comments_244446.json:
```json
{
    "body": "Note also\n\n```\nsage: polylog(3,RBF(1.1))      # there is a polylog RBF member!\n1.37625299668538 - 0.0142691615444952*I\nsage: dilog(RBF(1.1))\n1.96199910130557 - 0.299425760685590*I\n```\n",
    "created_at": "2017-04-26T07:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244446",
    "user": "https://github.com/rwst"
}
```

Note also

```
sage: polylog(3,RBF(1.1))      # there is a polylog RBF member!
1.37625299668538 - 0.0142691615444952*I
sage: dilog(RBF(1.1))
1.96199910130557 - 0.299425760685590*I
```




---

archive/issue_comments_244447.json:
```json
{
    "body": "I believe this is fixed in Pynac master. The tests now also include ball field elements and all open issues from #19906.\n----\nNew commits:",
    "created_at": "2017-05-04T07:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244447",
    "user": "https://github.com/rwst"
}
```

I believe this is fixed in Pynac master. The tests now also include ball field elements and all open issues from #19906.
----
New commits:



---

archive/issue_comments_244448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-10T07:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244448",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_244449.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-10T07:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244449",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_244450.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-25T06:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244450",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_244451.json:
```json
{
    "body": "Fails tests with reduced precision.",
    "created_at": "2017-05-25T06:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244451",
    "user": "https://github.com/rwst"
}
```

Fails tests with reduced precision.



---

archive/issue_comments_244452.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-25T06:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_244453.json:
```json
{
    "body": "We depend on #23077 and pynac-0.7.8 for improved handling of complex floats.",
    "created_at": "2017-05-25T15:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244453",
    "user": "https://github.com/rwst"
}
```

We depend on #23077 and pynac-0.7.8 for improved handling of complex floats.



---

archive/issue_comments_244454.json:
```json
{
    "body": "Now that all dependencies are merged, let the patchbots test it and please review.",
    "created_at": "2017-06-23T05:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244454",
    "user": "https://github.com/rwst"
}
```

Now that all dependencies are merged, let the patchbots test it and please review.



---

archive/issue_comments_244455.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-23T05:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244455",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_244456.json:
```json
{
    "body": "See #23565 for some changes to the behavior of polylog. Are those changes improvements?",
    "created_at": "2017-08-01T23:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244456",
    "user": "https://github.com/jhpalmieri"
}
```

See #23565 for some changes to the behavior of polylog. Are those changes improvements?



---

archive/issue_comments_244457.json:
```json
{
    "body": "The biggest mystery here to me is how pynac is being able to use arb...",
    "created_at": "2017-08-02T12:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244457",
    "user": "https://github.com/dimpase"
}
```

The biggest mystery here to me is how pynac is being able to use arb...



---

archive/issue_comments_244458.json:
```json
{
    "body": "the doctests added here, with correct (no `NaN`s!) outputs, are being added to #23565",
    "created_at": "2017-08-02T13:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244458",
    "user": "https://github.com/dimpase"
}
```

the doctests added here, with correct (no `NaN`s!) outputs, are being added to #23565



---

archive/issue_comments_244459.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-02T13:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244459",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_244460.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> The biggest mystery here to me is how pynac is being able to use arb...\n\nPynac calls Sage's arb interface via the Python C API.",
    "created_at": "2017-08-02T15:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244460",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:23 dimpase]:
> The biggest mystery here to me is how pynac is being able to use arb...

Pynac calls Sage's arb interface via the Python C API.



---

archive/issue_comments_244461.json:
```json
{
    "body": "Replying to [comment:25 rws]:\n> Replying to [comment:23 dimpase]:\n> > The biggest mystery here to me is how pynac is being able to use arb...\n> \n> Pynac calls Sage's arb interface via the Python C API.\n\nI see, thanks, this explains why libpynac is not linked to libarb, contrary to what one would expect.",
    "created_at": "2017-08-02T15:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244461",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:25 rws]:
> Replying to [comment:23 dimpase]:
> > The biggest mystery here to me is how pynac is being able to use arb...
> 
> Pynac calls Sage's arb interface via the Python C API.

I see, thanks, this explains why libpynac is not linked to libarb, contrary to what one would expect.



---

archive/issue_comments_244462.json:
```json
{
    "body": "Just rebasing. Nothing changed.\n----\nNew commits:",
    "created_at": "2017-08-23T02:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244462",
    "user": "https://github.com/kiwifb"
}
```

Just rebasing. Nothing changed.
----
New commits:



---

archive/issue_events_017400.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:55:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18149#event-17400"
}
```



---

archive/issue_comments_244463.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-05T06:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18149#issuecomment-244463",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
