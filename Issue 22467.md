# Issue 22467: Create a variant of the polymake pexpect interface using polymake's simulate_shell_input

archive/issues_022467.json:
```json
{
    "body": "CC:  simonking jipilab @sophiasage @laisrast @kliem @sebasguts vdelecroix tscrim\n\nKeywords: days84\n\nAs suggested by Gawrilow in https://forum.polymake.org/viewtopic.php?f=8&t=544, we could create a variant of the polymake pexpect interface that does not go through pty's but rather replaces the relevant send/receive methods of pexpect by calls to `simulate_shell_input` (linking to libpolymake).\n\nWe do want to keep the current pty-based pexpect interface, though, because it may be handy for running polymake on a remote server; or for guarding against a crashing polymake (sigh).\n\nIssue created by migration from https://trac.sagemath.org/ticket/22704\n\n",
    "created_at": "2017-03-28T23:10:45Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Create a variant of the polymake pexpect interface using polymake's simulate_shell_input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22467",
    "user": "mkoeppe"
}
```
CC:  simonking jipilab @sophiasage @laisrast @kliem @sebasguts vdelecroix tscrim

Keywords: days84

As suggested by Gawrilow in https://forum.polymake.org/viewtopic.php?f=8&t=544, we could create a variant of the polymake pexpect interface that does not go through pty's but rather replaces the relevant send/receive methods of pexpect by calls to `simulate_shell_input` (linking to libpolymake).

We do want to keep the current pty-based pexpect interface, though, because it may be handy for running polymake on a remote server; or for guarding against a crashing polymake (sigh).

Issue created by migration from https://trac.sagemath.org/ticket/22704





---

archive/issue_comments_313014.json:
```json
{
    "body": "Here's a first version. \n----\nLast 10 new commits:",
    "created_at": "2019-04-27T09:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313014",
    "user": "mkoeppe"
}
```

Here's a first version. 
----
Last 10 new commits:



---

archive/issue_comments_313015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T11:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313015",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313016.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T13:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313016",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313017.json:
```json
{
    "body": "Some polymake errors are not properly signalled by Polymake: Only the stderr slot [2] is filled but the error slot [3] is empty\n\n```\nsage: from JuPyMake import ExecuteCommand\nsage: ExecuteCommand('help(\"Triangulation\");')\n(True, '', \"polymake:  ERROR: unknown help topic 'Triangulation'\\n\", '')\n```\n",
    "created_at": "2019-04-27T13:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313017",
    "user": "mkoeppe"
}
```

Some polymake errors are not properly signalled by Polymake: Only the stderr slot [2] is filled but the error slot [3] is empty

```
sage: from JuPyMake import ExecuteCommand
sage: ExecuteCommand('help("Triangulation");')
(True, '', "polymake:  ERROR: unknown help topic 'Triangulation'\n", '')
```




---

archive/issue_comments_313018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T14:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313018",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T15:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313020.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T16:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313020",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-27T17:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313021",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313022.json:
```json
{
    "body": "Signal handling issues are solved in new version of JuPyMake - waiting for a new release",
    "created_at": "2019-04-30T15:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313022",
    "user": "mkoeppe"
}
```

Signal handling issues are solved in new version of JuPyMake - waiting for a new release



---

archive/issue_comments_313023.json:
```json
{
    "body": "This is coming from #24905, which is already set as positive review.\n\nCould you correct the following pyflakes warnings:\n\n\n```\n+src/sage/geometry/polyhedron/backend_polymake.py:29: 'sage.rings.all.QQ' imported but unused\n+src/sage/geometry/polyhedron/backend_polymake.py:29: 'sage.rings.all.ZZ' imported but unused\n```\n",
    "created_at": "2019-05-01T08:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313023",
    "user": "jipilab"
}
```

This is coming from #24905, which is already set as positive review.

Could you correct the following pyflakes warnings:


```
+src/sage/geometry/polyhedron/backend_polymake.py:29: 'sage.rings.all.QQ' imported but unused
+src/sage/geometry/polyhedron/backend_polymake.py:29: 'sage.rings.all.ZZ' imported but unused
```




---

archive/issue_comments_313024.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T11:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313024",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313025.json:
```json
{
    "body": "Crashes are fixed.",
    "created_at": "2019-05-02T11:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313025",
    "user": "mkoeppe"
}
```

Crashes are fixed.



---

archive/issue_comments_313026.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T12:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313026",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313027.json:
```json
{
    "body": "Signal handling fixed by jupymake update",
    "created_at": "2019-05-02T12:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313027",
    "user": "mkoeppe"
}
```

Signal handling fixed by jupymake update



---

archive/issue_comments_313028.json:
```json
{
    "body": "polymake's error handling bug is reported upstream.",
    "created_at": "2019-05-02T13:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313028",
    "user": "mkoeppe"
}
```

polymake's error handling bug is reported upstream.



---

archive/issue_comments_313029.json:
```json
{
    "body": "Apart from 1 remaining doctest regarding the form of some error messages, this is ready for review!",
    "created_at": "2019-05-02T13:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313029",
    "user": "mkoeppe"
}
```

Apart from 1 remaining doctest regarding the form of some error messages, this is ready for review!



---

archive/issue_comments_313030.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-02T13:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313030",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-08T13:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313031",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313032.json:
```json
{
    "body": "does this need #24905 ?",
    "created_at": "2019-05-08T17:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313032",
    "user": "dimpase"
}
```

does this need #24905 ?



---

archive/issue_comments_313033.json:
```json
{
    "body": "I did this work on top of the #24905 branch because otherwise there would be big merge conflicts.",
    "created_at": "2019-05-08T19:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313033",
    "user": "mkoeppe"
}
```

I did this work on top of the #24905 branch because otherwise there would be big merge conflicts.



---

archive/issue_comments_313034.json:
```json
{
    "body": "that's what I get after trying this on Linux:\n\n```\n$ ./sage -tp --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,python2,polymake,sage src/sage/interfaces/polymake.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2019-05-08-22-08-17-11941b32.\nGit branch: testwip\nUsing --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,polymake,python2,sage\nDoctesting 1 file using 4 threads.\nsage -t src/sage/interfaces/polymake.py\n**********************************************************************\nFile \"src/sage/interfaces/polymake.py\", line 765, in sage.interfaces.polymake.PolymakeAbstract.application\nFailed example:\n    polymake.eval('application \"killerapp\";')         # optional - polymake\nExpected:\n    Traceback (most recent call last):\n    ...\n    PolymakeError: Unknown application killerapp\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.polymake.PolymakeAbstract.application[15]>\", line 1, in <module>\n        polymake.eval('application \"killerapp\";')         # optional - polymake\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/interfaces/polymake.py\", line 2520, in eval\n        raise PolymakeError(error)\n    PolymakeError: Can't locate object method \"compile_scope\" via package \"Polymake::Core::Shell::Mock\" at /mnt/opt/Sage/sage-dev/local/share/polymake/perllib/Polymake/utils.pl line 247.\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of  17 in sage.interfaces.polymake.PolymakeAbstract.application\n    [317 tests, 1 failure, 9.54 s]\n----------------------------------------------------------------------\nsage -t src/sage/interfaces/polymake.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2019-05-08T21:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313034",
    "user": "dimpase"
}
```

that's what I get after trying this on Linux:

```
$ ./sage -tp --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,python2,polymake,sage src/sage/interfaces/polymake.py 
too many failed tests, not using stored timings
Running doctests with ID 2019-05-08-22-08-17-11941b32.
Git branch: testwip
Using --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,polymake,python2,sage
Doctesting 1 file using 4 threads.
sage -t src/sage/interfaces/polymake.py
**********************************************************************
File "src/sage/interfaces/polymake.py", line 765, in sage.interfaces.polymake.PolymakeAbstract.application
Failed example:
    polymake.eval('application "killerapp";')         # optional - polymake
Expected:
    Traceback (most recent call last):
    ...
    PolymakeError: Unknown application killerapp
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.polymake.PolymakeAbstract.application[15]>", line 1, in <module>
        polymake.eval('application "killerapp";')         # optional - polymake
      File "/mnt/opt/Sage/sage-dev/local/lib/python2.7/site-packages/sage/interfaces/polymake.py", line 2520, in eval
        raise PolymakeError(error)
    PolymakeError: Can't locate object method "compile_scope" via package "Polymake::Core::Shell::Mock" at /mnt/opt/Sage/sage-dev/local/share/polymake/perllib/Polymake/utils.pl line 247.
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of  17 in sage.interfaces.polymake.PolymakeAbstract.application
    [317 tests, 1 failure, 9.54 s]
----------------------------------------------------------------------
sage -t src/sage/interfaces/polymake.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_313035.json:
```json
{
    "body": "and also\n\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_\nFailed example:\n    P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake') # optional - polymake\nExpected nothing\nGot:\n     gmp v.6.1\n...\nFile \"src/sage/geometry/polyhedron/backend_polymake.py\", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake\nFailed example:\n    p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake\n                   lines=[], backend='polymake')\nExpected nothing\nGot:\n     gmp v.6.1\n```\n",
    "created_at": "2019-05-08T21:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313035",
    "user": "dimpase"
}
```

and also

```
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_
Failed example:
    P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake') # optional - polymake
Expected nothing
Got:
     gmp v.6.1
...
File "src/sage/geometry/polyhedron/backend_polymake.py", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake
Failed example:
    p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake
                   lines=[], backend='polymake')
Expected nothing
Got:
     gmp v.6.1
```




---

archive/issue_comments_313036.json:
```json
{
    "body": "Replying to [comment:30 dimpase]:\n> that's what I get after trying this on Linux:\n> {{{\n> $ ./sage -tp --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,python2,polymake,sage src/sage/interfaces/polymake.py \n> ....\n>        raise PolymakeError(error)\n>     PolymakeError: Can't locate object method \"compile_scope\" via package \"Polymake::Core::Shell::Mock\" at /mnt/opt/Sage/sage-dev/local/share/polymake/perllib/Polymake/utils.pl line 247.\n> }}}\n\nYes, I know this one - see ticket description. I have reported it upstream.",
    "created_at": "2019-05-09T09:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313036",
    "user": "mkoeppe"
}
```

Replying to [comment:30 dimpase]:
> that's what I get after trying this on Linux:
> {{{
> $ ./sage -tp --optional=bliss,build,dochtml,e_antic,gap_packages,jupymake,lidia,lrslib,memlimit,ninja_build,normaliz,python2,polymake,sage src/sage/interfaces/polymake.py 
> ....
>        raise PolymakeError(error)
>     PolymakeError: Can't locate object method "compile_scope" via package "Polymake::Core::Shell::Mock" at /mnt/opt/Sage/sage-dev/local/share/polymake/perllib/Polymake/utils.pl line 247.
> }}}

Yes, I know this one - see ticket description. I have reported it upstream.



---

archive/issue_comments_313037.json:
```json
{
    "body": "Replying to [comment:31 dimpase]:\n> and also\n> {{{\n> **********************************************************************\n> File \"src/sage/geometry/polyhedron/base.py\", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_\n> Failed example:\n>     P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro), backend='polymake') # optional - polymake\n> Expected nothing\n> Got:\n>      gmp v.6.1\n> ...\n> File \"src/sage/geometry/polyhedron/backend_polymake.py\", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake\n> Failed example:\n>     p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake\n>                    lines=[], backend='polymake')\n> Expected nothing\n> Got:\n>      gmp v.6.1\n> }}}\nLooks like this message comes from lrslib, I'll investigate",
    "created_at": "2019-05-09T09:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313037",
    "user": "mkoeppe"
}
```

Replying to [comment:31 dimpase]:
> and also
> {{{
> **********************************************************************
> File "src/sage/geometry/polyhedron/base.py", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_
> Failed example:
>     P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro), backend='polymake') # optional - polymake
> Expected nothing
> Got:
>      gmp v.6.1
> ...
> File "src/sage/geometry/polyhedron/backend_polymake.py", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake
> Failed example:
>     p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake
>                    lines=[], backend='polymake')
> Expected nothing
> Got:
>      gmp v.6.1
> }}}
Looks like this message comes from lrslib, I'll investigate



---

archive/issue_comments_313038.json:
```json
{
    "body": "Actually on my machine polymake does not find the installed lrslib (it's looking for liblrs but we only have liblrsgmp.)",
    "created_at": "2019-05-09T09:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313038",
    "user": "mkoeppe"
}
```

Actually on my machine polymake does not find the installed lrslib (it's looking for liblrs but we only have liblrsgmp.)



---

archive/issue_comments_313039.json:
```json
{
    "body": "I also only have `liblrsgmp`. Not sure if the following helps, but still:\n\n\n```\n$ ldd local/lib/libpolymake.so\n\tlinux-vdso.so.1 (0x00007fff97bbb000)\n\tlibperl.so.5.28 => /usr/lib64/libperl.so.5.28 (0x00007fcae6d94000)\n\tlibxml2.so.2 => /usr/lib64/libxml2.so.2 (0x00007fcae6bef000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007fcae6be9000)\n\tlibmpfr.so.6 => /mnt/opt/Sage/sage-dev/local/lib/libmpfr.so.6 (0x00007fcae6b6a000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fcae68df000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fcae68bc000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libstdc++.so.6 (0x00007fcae6642000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fcae6505000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libgcc_s.so.1 (0x00007fcae64eb000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fcae631b000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fcae62e2000)\n\tlibicuuc.so.64 => /usr/lib64/libicuuc.so.64 (0x00007fcae60f1000)\n\tlibz.so.1 => /lib64/libz.so.1 (0x00007fcae5ecf000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fcae71bd000)\n\tlibicudata.so.64 => /usr/lib64/libicudata.so.64 (0x00007fcae4489000)\n```\n\nthe rest of polymake libs are statically linked, so it's not as easy to gather whether lrs has anything to do with it.",
    "created_at": "2019-05-09T09:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313039",
    "user": "dimpase"
}
```

I also only have `liblrsgmp`. Not sure if the following helps, but still:


```
$ ldd local/lib/libpolymake.so
	linux-vdso.so.1 (0x00007fff97bbb000)
	libperl.so.5.28 => /usr/lib64/libperl.so.5.28 (0x00007fcae6d94000)
	libxml2.so.2 => /usr/lib64/libxml2.so.2 (0x00007fcae6bef000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007fcae6be9000)
	libmpfr.so.6 => /mnt/opt/Sage/sage-dev/local/lib/libmpfr.so.6 (0x00007fcae6b6a000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fcae68df000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fcae68bc000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libstdc++.so.6 (0x00007fcae6642000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fcae6505000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libgcc_s.so.1 (0x00007fcae64eb000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fcae631b000)
	libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fcae62e2000)
	libicuuc.so.64 => /usr/lib64/libicuuc.so.64 (0x00007fcae60f1000)
	libz.so.1 => /lib64/libz.so.1 (0x00007fcae5ecf000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fcae71bd000)
	libicudata.so.64 => /usr/lib64/libicudata.so.64 (0x00007fcae4489000)
```

the rest of polymake libs are statically linked, so it's not as easy to gather whether lrs has anything to do with it.



---

archive/issue_comments_313040.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> Actually on my machine polymake does not find the installed lrslib (it's looking for liblrs but we only have liblrsgmp.)\n\nThis belongs to the polymake 3.4 upgrade ticket (#24905).",
    "created_at": "2019-05-09T09:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313040",
    "user": "mkoeppe"
}
```

Replying to [comment:34 mkoeppe]:
> Actually on my machine polymake does not find the installed lrslib (it's looking for liblrs but we only have liblrsgmp.)

This belongs to the polymake 3.4 upgrade ticket (#24905).



---

archive/issue_comments_313041.json:
```json
{
    "body": "Replying to [comment:33 mkoeppe]:\n> Replying to [comment:31 dimpase]:\n> > and also\n> > {{{\n> > **********************************************************************\n> > File \"src/sage/geometry/polyhedron/base.py\", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_\n> > Failed example:\n> >     P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro), backend='polymake') # optional - polymake\n> > Expected nothing\n> > Got:\n> >      gmp v.6.1\n> > ...\n> > File \"src/sage/geometry/polyhedron/backend_polymake.py\", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake\n> > Failed example:\n> >     p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake\n> >                    lines=[], backend='polymake')\n> > Expected nothing\n> > Got:\n> >      gmp v.6.1\n> > }}}\n> Looks like this message comes from lrslib, I'll investigate\n\nAfter the lrs fix on #27803, one of these 2 errors is still present:\n\n\n```\nFile \"src/sage/geometry/polyhedron/base.py\", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_\nFailed example:\n    P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake') # optional - polymake\nExpected nothing\nGot:\n     gmp v.6.1\n```\n",
    "created_at": "2019-05-09T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313041",
    "user": "dimpase"
}
```

Replying to [comment:33 mkoeppe]:
> Replying to [comment:31 dimpase]:
> > and also
> > {{{
> > **********************************************************************
> > File "src/sage/geometry/polyhedron/base.py", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_
> > Failed example:
> >     P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro), backend='polymake') # optional - polymake
> > Expected nothing
> > Got:
> >      gmp v.6.1
> > ...
> > File "src/sage/geometry/polyhedron/backend_polymake.py", line 59, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake
> > Failed example:
> >     p = Polyhedron(vertices=[(0,0),(1,0),(0,1)], rays=[(1,1)],   # optional - polymake
> >                    lines=[], backend='polymake')
> > Expected nothing
> > Got:
> >      gmp v.6.1
> > }}}
> Looks like this message comes from lrslib, I'll investigate

After the lrs fix on #27803, one of these 2 errors is still present:


```
File "src/sage/geometry/polyhedron/base.py", line 175, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_
Failed example:
    P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake') # optional - polymake
Expected nothing
Got:
     gmp v.6.1
```




---

archive/issue_comments_313042.json:
```json
{
    "body": "Yes, and with #27803 I can reproduce it. I think these errors appear non-deterministicaly.",
    "created_at": "2019-05-09T11:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313042",
    "user": "mkoeppe"
}
```

Yes, and with #27803 I can reproduce it. I think these errors appear non-deterministicaly.



---

archive/issue_comments_313043.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> Yes, and with #27803 I can reproduce it. I think these errors appear non-deterministicaly. \n\nI think it is deterministic, and occurs on the 1st invocation of the polymake interface.\nTry starting Sage and running\n\n```\nP = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake')\n```\n\nrepeatedly.",
    "created_at": "2019-05-09T11:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313043",
    "user": "dimpase"
}
```

Replying to [comment:38 mkoeppe]:
> Yes, and with #27803 I can reproduce it. I think these errors appear non-deterministicaly. 

I think it is deterministic, and occurs on the 1st invocation of the polymake interface.
Try starting Sage and running

```
P = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='polymake')
```

repeatedly.



---

archive/issue_comments_313044.json:
```json
{
    "body": "Replying to [comment:39 dimpase]:\n> I think it is deterministic, and occurs on the 1st invocation of the polymake interface.\nYou are right.",
    "created_at": "2019-05-09T12:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313044",
    "user": "mkoeppe"
}
```

Replying to [comment:39 dimpase]:
> I think it is deterministic, and occurs on the 1st invocation of the polymake interface.
You are right.



---

archive/issue_comments_313045.json:
```json
{
    "body": "The new behavior from this ticket comes from the fact that with the new in-process polymake, lrslib prints directly to stdout, so this output is not captured.\nPerhaps lrslib should be configured with `LRS_QUIET`.",
    "created_at": "2019-05-09T12:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313045",
    "user": "mkoeppe"
}
```

The new behavior from this ticket comes from the fact that with the new in-process polymake, lrslib prints directly to stdout, so this output is not captured.
Perhaps lrslib should be configured with `LRS_QUIET`.



---

archive/issue_comments_313046.json:
```json
{
    "body": "Replying to [comment:42 mkoeppe]:\n> Perhaps lrslib should be configured with `LRS_QUIET`.\nlrslib 070 removes this output unconditionally.",
    "created_at": "2019-05-09T12:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313046",
    "user": "mkoeppe"
}
```

Replying to [comment:42 mkoeppe]:
> Perhaps lrslib should be configured with `LRS_QUIET`.
lrslib 070 removes this output unconditionally.



---

archive/issue_comments_313047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-09T13:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313048.json:
```json
{
    "body": "The lrslib 070 update (#27745) is too much work for today. Instead I configure lrslib with LRS_QUIET (#27805).",
    "created_at": "2019-05-09T13:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313048",
    "user": "mkoeppe"
}
```

The lrslib 070 update (#27745) is too much work for today. Instead I configure lrslib with LRS_QUIET (#27805).



---

archive/issue_comments_313049.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-09T15:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313049",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313050.json:
```json
{
    "body": "OK, this is fixed by #27805 indeed.\n----\nNew commits:",
    "created_at": "2019-05-09T15:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313050",
    "user": "dimpase"
}
```

OK, this is fixed by #27805 indeed.
----
New commits:



---

archive/issue_comments_313051.json:
```json
{
    "body": "I've put the remaining minor issue to a follow-up ticket, #27807 (Polymake-jupymake interface: Fix polymake's error handling in Shell::Mock)",
    "created_at": "2019-05-09T16:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313051",
    "user": "mkoeppe"
}
```

I've put the remaining minor issue to a follow-up ticket, #27807 (Polymake-jupymake interface: Fix polymake's error handling in Shell::Mock)



---

archive/issue_comments_313052.json:
```json
{
    "body": "Should I make that last failing doctest less specific regarding the error message for this ticket? (Before it's fixed fully in #27807)",
    "created_at": "2019-05-09T16:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313052",
    "user": "mkoeppe"
}
```

Should I make that last failing doctest less specific regarding the error message for this ticket? (Before it's fixed fully in #27807)



---

archive/issue_comments_313053.json:
```json
{
    "body": "If you like, you can tag it \"known error\".",
    "created_at": "2019-05-09T16:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313053",
    "user": "dimpase"
}
```

If you like, you can tag it "known error".



---

archive/issue_comments_313054.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-05-09T16:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313054",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_313055.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-05-09T16:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313055",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_313056.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-10T10:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313056",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313057.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2019-05-11T13:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313057",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_313058.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-05-11T13:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313058",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_313059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-11T15:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313059",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313060.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-05-11T15:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313060",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_313061.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-14T12:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313061",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_313062.json:
```json
{
    "body": "The upstream package jupymake seems to be missing on the sage mirrors",
    "created_at": "2019-07-21T20:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313062",
    "user": "mkoeppe"
}
```

The upstream package jupymake seems to be missing on the sage mirrors



---

archive/issue_comments_313063.json:
```json
{
    "body": "Do I understand correctly that in the current version jupymake is necessary for polymake to function properly? Shouldn't jupymake become a dependancy of polymake?",
    "created_at": "2019-07-28T11:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313063",
    "user": "jipilab"
}
```

Do I understand correctly that in the current version jupymake is necessary for polymake to function properly? Shouldn't jupymake become a dependancy of polymake?



---

archive/issue_comments_313064.json:
```json
{
    "body": "Replying to [comment:58 jipilab]:\n> Do I understand correctly that in the current version jupymake is necessary for polymake to function properly? Shouldn't jupymake become a dependancy of polymake?\nNo, there are two interface classes, which both work. `PolymakeExpect` (aliases to `Polymake`) and `PolymakeJupyMake`.\nDepending on whether you have jupymake, `polymake` is set to an instance of one or the other.",
    "created_at": "2019-07-29T23:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22467#issuecomment-313064",
    "user": "mkoeppe"
}
```

Replying to [comment:58 jipilab]:
> Do I understand correctly that in the current version jupymake is necessary for polymake to function properly? Shouldn't jupymake become a dependancy of polymake?
No, there are two interface classes, which both work. `PolymakeExpect` (aliases to `Polymake`) and `PolymakeJupyMake`.
Depending on whether you have jupymake, `polymake` is set to an instance of one or the other.
