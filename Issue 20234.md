# Issue 20234: changing some classic division to exact division in combinat folder

Issue created by migration from https://trac.sagemath.org/ticket/20471

Original creator: chapoton

Original creation time: 2016-04-19 20:33:06

Keywords: python3, combinat

after #20468, let us take care of the rest of the combinat folder
so that all test pass when running

```
export PYTHONIOENCODING="utf-8"
python -Qwarnall $(which sage-runtests) src/sage/combinat/*.py 
```

in a sage shell.


---

Comment by chapoton created at 2016-04-19 20:33:41

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-04-19 20:33:41

New commits:


---

Comment by jdemeyer created at 2016-04-20 05:44:53

General suggestion: add `from __future__ import division` on top of modules which have been fully converted. That way we know for sure that there are no old-style divisions left in that module.


---

Comment by chapoton created at 2016-04-20 07:28:35

well, I understand, but I only took care of the failing doctests, not of the warnings (that often come from another part of sage, in fact)


---

Comment by jdemeyer created at 2016-04-20 08:21:52

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2016-04-20 08:25:29

Replying to [comment:3 chapoton]:
> I only took care of the failing doctests, not of the warnings (that often come from another part of sage, in fact)

I really do not understand what you mean. In fact, it makes me doubt that you understood what I meant:

if you have removed all classic divisions from the `combinat` folder, I recommend to put `from __future__ import division` in the source code of the `sage/combinat/*.py(x)` files. Doing that will ensure that no old-style division can sneak in with future changes. It also makes it very explicit that no further work needs to be done with division in those modules.


---

Comment by chapoton created at 2016-04-20 08:33:40

What I mean is the following.

With my branch, running `python -Qnew $(which sage-runtests) src/sage/combinat/*.py`
gives no failing doctests.

Bur running `python -Qwarnall $(which sage-runtests) src/sage/combinat/*.py`
still gives many warnings. Most of these warnings are related to classic division
happening in other parts of sage, but there could be some still happening in /combinat
without affecting the doctests.

I could try to add the `from future import` everywhere in all \combinat files and
see if no problem occurs. Would this be a good idea ?


---

Comment by jdemeyer created at 2016-04-20 08:36:49

Replying to [comment:7 chapoton]:
> Bur running `python -Qwarnall $(which sage-runtests) src/sage/combinat/*.py`
> still gives many warnings. Most of these warnings are related to classic division
> happening in other parts of sage
That does not matter.

> but there could be some still happening in /combinat
> without affecting the doctests.
That could only happen if there are divisions which are not executed by any doctest. Let's hope this is not the case... in any case, it is hard to check otherwise.

> I could try to add the `from future import` everywhere in all \combinat files and
> see if no problem occurs. Would this be a good idea ?
Yes, that is what I meant.


---

Comment by chapoton created at 2016-04-20 08:42:09

Question: should I add the `from future` import in *all* of the combinat files, or only in the ones changed here or in #20468 ?


---

Comment by jdemeyer created at 2016-04-20 08:57:24

I thought you checked all of them... in that case: all of them obviously.


---

Comment by git created at 2016-04-20 09:01:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-04-20 09:06:31

But many of them do not use division at all !

Wouldn't it be enough to just mark those where I did change something in the divisions ?

Or are we planning to have `from future import division` in *every* single python file in sage ?


---

Comment by jdemeyer created at 2016-04-20 09:13:46

Replying to [comment:12 chapoton]:
> Or are we planning to have `from future import division` in *every* single python file in sage ?

This hasn't really been formally discussed. I would be in favour of having it in every module.


---

Comment by chapoton created at 2016-04-20 15:45:05

I would prefer not to make a patchbomb right here. 

We maybe can discuss on sage-devel the general question of adding `from future import division` everywhere.

Would you still agree to give a positive review for this ticket in its current state ?


---

Comment by jdemeyer created at 2016-04-21 08:10:18

In `alternating_sign_matrix`, replace `int(2)` by `2`.


---

Comment by jdemeyer created at 2016-04-21 08:28:26

You changed this to really weird spacing: `range(1,len(tst) // 2+1)`

Usually, I don't mind spacing but I just noticed because you actually _changed_ it.


---

Comment by jdemeyer created at 2016-04-21 08:31:54

All fine except for the two comments above and the change in `src/sage/combinat/perfect_matching.py` (not because it is wrong, but because it is a non-obvious change that I still need to check).


---

Comment by jdemeyer created at 2016-04-21 08:32:50

Changing status from needs_info to needs_work.


---

Comment by git created at 2016-04-21 08:58:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-04-21 14:45:52

The change in `perfect_matching.py` looks okay to me.

Is this ready for review again Frédéric?


---

Comment by chapoton created at 2016-04-21 14:47:46

yes, please


---

Comment by chapoton created at 2016-04-21 14:47:46

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-04-21 14:53:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-04-22 07:13:01

Resolution: fixed
