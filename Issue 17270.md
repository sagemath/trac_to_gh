# Issue 17270: wrong output from definite_integral()

archive/issues_017270.json:
```json
{
    "body": "CC:  kcrisman\n\nThere appear to be two problems:\n\n```\nsage: from sage.symbolic.integration.integral import definite_integral, indefinite_integral\nsage: definite_integral(x*y,x,0,1,hold=True)\nintegrate(x*y, x, 0, 1)\nsage: _.n()\nValueError: Integrand has wrong number of parameters\n\nsage: integrate(x*y,(x,0,1))\n1/2*y\nsage: definite_integral(x*y,(x,0,1),hold=True)\nTypeError: Symbolic function integrate takes exactly 4 arguments (2 given)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17507\n\n",
    "created_at": "2014-12-15T10:27:22Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "wrong output from definite_integral()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17270",
    "user": "rws"
}
```
CC:  kcrisman

There appear to be two problems:

```
sage: from sage.symbolic.integration.integral import definite_integral, indefinite_integral
sage: definite_integral(x*y,x,0,1,hold=True)
integrate(x*y, x, 0, 1)
sage: _.n()
ValueError: Integrand has wrong number of parameters

sage: integrate(x*y,(x,0,1))
1/2*y
sage: definite_integral(x*y,(x,0,1),hold=True)
TypeError: Symbolic function integrate takes exactly 4 arguments (2 given)
```


Issue created by migration from https://trac.sagemath.org/ticket/17507





---

archive/issue_comments_229941.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-15T14:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229941",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_229942.json:
```json
{
    "body": "This should be fixed with #2787 so this is a duplicate.",
    "created_at": "2014-12-15T14:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229942",
    "user": "rws"
}
```

This should be fixed with #2787 so this is a duplicate.



---

archive/issue_comments_229943.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-15T14:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229943",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_229944.json:
```json
{
    "body": "To be more exact, this ticket is just about the `n()`",
    "created_at": "2014-12-15T15:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229944",
    "user": "rws"
}
```

To be more exact, this ticket is just about the `n()`



---

archive/issue_comments_229945.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-12-15T15:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229945",
    "user": "rws"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_229946.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-12-15T15:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229946",
    "user": "rws"
}
```

Changing priority from major to minor.



---

archive/issue_comments_229947.json:
```json
{
    "body": "What kind of error would you suggest?  `InputError`, `ValueError` ... ?",
    "created_at": "2014-12-15T15:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229947",
    "user": "kcrisman"
}
```

What kind of error would you suggest?  `InputError`, `ValueError` ... ?



---

archive/issue_comments_229948.json:
```json
{
    "body": "I cannot find documentation about `InputError`, so `ValueError` is fine. Looking at the trigger condition however\n\n```\n                if len(params) + 1 != len(vars):\n                    raise ValueError, \"Integrand has wrong number of parameters\"\n```\n\nsuggests this is meant to catch problems with the `params` argument to `numerical_integral`. This is not given by the calling `_evalf_` so maybe that should be checked upstream too to honor untold preconditions of `numerical_integral`.\n----\nNew commits:",
    "created_at": "2014-12-31T16:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229948",
    "user": "rws"
}
```

I cannot find documentation about `InputError`, so `ValueError` is fine. Looking at the trigger condition however

```
                if len(params) + 1 != len(vars):
                    raise ValueError, "Integrand has wrong number of parameters"
```

suggests this is meant to catch problems with the `params` argument to `numerical_integral`. This is not given by the calling `_evalf_` so maybe that should be checked upstream too to honor untold preconditions of `numerical_integral`.
----
New commits:



---

archive/issue_comments_229949.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-31T16:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229949",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_229950.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-15T11:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229950",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_229951.json:
```json
{
    "body": "Hello !\n\nI think that this branch is ready to go, but I have a couple of questions to ask (I am new to this code):\n\n- What would you think of an alternative error message: \"The function to be integrated depends on 2 variables (x,y), and so cannot be integrated in one dimension. Please fix additional variables with the 'params' argument\".\n\n  It took me some time to understand what exactly the problem was with the current error message, because I did not understand what 'parameters' meant.\n\n- It seems dangerous to me that `params` is a list but not a dictionary. It seems difficult for the user to know for sure which variable will receive which value. Isn't that a problem ? Sorry, I really do not know the code.\n\nIf you agree to change the error message to the one I proposed, tell me and I will write a commit.\n\nNathann",
    "created_at": "2015-01-15T11:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229951",
    "user": "ncohen"
}
```

Hello !

I think that this branch is ready to go, but I have a couple of questions to ask (I am new to this code):

- What would you think of an alternative error message: "The function to be integrated depends on 2 variables (x,y), and so cannot be integrated in one dimension. Please fix additional variables with the 'params' argument".

  It took me some time to understand what exactly the problem was with the current error message, because I did not understand what 'parameters' meant.

- It seems dangerous to me that `params` is a list but not a dictionary. It seems difficult for the user to know for sure which variable will receive which value. Isn't that a problem ? Sorry, I really do not know the code.

If you agree to change the error message to the one I proposed, tell me and I will write a commit.

Nathann



---

archive/issue_comments_229952.json:
```json
{
    "body": "As to the message, please go ahead. The `expression.variables()` returns a lexically sorted list but the `function.arguments()` returns the arguments as they are given. This can get really confusing:\n\n```\nsage: f(x,a) = 1/(a+x^2)\nsage: f.variables()\n(a, x)\nsage: f.arguments()\n(x, a)\nsage: numerical_integral(f, 1, 2, max_points=100, params=[10])\n(0.08148091340506758, 9.046198612979459e-16)\nsage: numerical_integral(1/(a+x^2), 1, 2, max_points=100, params=[10])\n(0.00985229644301163, 1.0938246356464044e-16)\n```\n\nOTOH, giving a dictionary always involves the user more than a list. So maybe we should at least put a warning in the documentation about this. If you feel up to it, cvould you please?",
    "created_at": "2015-01-15T17:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229952",
    "user": "rws"
}
```

As to the message, please go ahead. The `expression.variables()` returns a lexically sorted list but the `function.arguments()` returns the arguments as they are given. This can get really confusing:

```
sage: f(x,a) = 1/(a+x^2)
sage: f.variables()
(a, x)
sage: f.arguments()
(x, a)
sage: numerical_integral(f, 1, 2, max_points=100, params=[10])
(0.08148091340506758, 9.046198612979459e-16)
sage: numerical_integral(1/(a+x^2), 1, 2, max_points=100, params=[10])
(0.00985229644301163, 1.0938246356464044e-16)
```

OTOH, giving a dictionary always involves the user more than a list. So maybe we should at least put a warning in the documentation about this. If you feel up to it, cvould you please?



---

archive/issue_comments_229953.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-01-16T04:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229953",
    "user": "ncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_229954.json:
```json
{
    "body": "Hello,\n\n> As to the message, please go ahead.\n\nIt is in the new commit.\n\n> The `expression.variables()` returns a lexically sorted list but the `function.arguments()` returns the arguments as they are given. This can get really confusing:\n>\n> OTOH, giving a dictionary always involves the user more than a list.\n\nWhat would you think of that: `numerical_integral(x*y,0,1,y=3)` ?\n\nThe 'dictionary' can also be built from `**args`.\n\nThis being said, perhaps the \"most simple and clean\" prototype would be to refuse input with more than one variables, and ask the user to input:\n\n\n```\nsage: numerical_integral((x*y).subs(y=4),0,1)\n(2.0, 2.220446049250313e-14)\n```\n\n\nThis would not be very welcoming for beginners, though `:-/`\n\n> So maybe we should at least put a warning in the documentation about this. If you feel up to it, cvould you please?\n\nI would like to fix it, but I do not know if this 'param' argument is not used in other places of the symbolic functions, in which case it would call for a global change. I will write to sage-devel about that in a second.\n\nI set the ticket in its current state as `needs_review`: if we change the way to fix variables in this functions we will do so in another ticket.\n\nThanks,\n\nNathann\n----\nNew commits:",
    "created_at": "2015-01-16T04:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229954",
    "user": "ncohen"
}
```

Hello,

> As to the message, please go ahead.

It is in the new commit.

> The `expression.variables()` returns a lexically sorted list but the `function.arguments()` returns the arguments as they are given. This can get really confusing:
>
> OTOH, giving a dictionary always involves the user more than a list.

What would you think of that: `numerical_integral(x*y,0,1,y=3)` ?

The 'dictionary' can also be built from `**args`.

This being said, perhaps the "most simple and clean" prototype would be to refuse input with more than one variables, and ask the user to input:


```
sage: numerical_integral((x*y).subs(y=4),0,1)
(2.0, 2.220446049250313e-14)
```


This would not be very welcoming for beginners, though `:-/`

> So maybe we should at least put a warning in the documentation about this. If you feel up to it, cvould you please?

I would like to fix it, but I do not know if this 'param' argument is not used in other places of the symbolic functions, in which case it would call for a global change. I will write to sage-devel about that in a second.

I set the ticket in its current state as `needs_review`: if we change the way to fix variables in this functions we will do so in another ticket.

Thanks,

Nathann
----
New commits:



---

archive/issue_comments_229955.json:
```json
{
    "body": "https://groups.google.com/d/topic/sage-devel/WusgmcihVbg/discussion",
    "created_at": "2015-01-16T05:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229955",
    "user": "ncohen"
}
```

https://groups.google.com/d/topic/sage-devel/WusgmcihVbg/discussion



---

archive/issue_comments_229956.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> This being said, perhaps the \"most simple and clean\" prototype would be to refuse input with more than one variables, and ask the user to input:\n> \n> {{{\n> sage: numerical_integral((x*y).subs(y=4),0,1)\n> (2.0, 2.220446049250313e-14)\n> }}}\n> \n> This would not be very welcoming for beginners, though `:-/`\nOh I don't think so at all. I like this very much.\n\nTicket looks good, tests ok. I take the liberty to fill in the fields.",
    "created_at": "2015-01-16T09:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229956",
    "user": "rws"
}
```

Replying to [comment:10 ncohen]:
> This being said, perhaps the "most simple and clean" prototype would be to refuse input with more than one variables, and ask the user to input:
> 
> {{{
> sage: numerical_integral((x*y).subs(y=4),0,1)
> (2.0, 2.220446049250313e-14)
> }}}
> 
> This would not be very welcoming for beginners, though `:-/`
Oh I don't think so at all. I like this very much.

Ticket looks good, tests ok. I take the liberty to fill in the fields.



---

archive/issue_comments_229957.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-16T09:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229957",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_229958.json:
```json
{
    "body": "Thanks `:-)`",
    "created_at": "2015-01-16T09:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229958",
    "user": "ncohen"
}
```

Thanks `:-)`



---

archive/issue_comments_229959.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-24T23:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17270#issuecomment-229959",
    "user": "vbraun"
}
```

Resolution: fixed
