# Issue 29114: Implement directed version of 2sweep algorithm for diameter computation

Issue created by migration from https://trac.sagemath.org/ticket/29351

Original creator: @vipul79321

Original creation time: 2020-03-17 14:22:32

CC:  dcoudert

Keywords: Diameter

This ticket aims at implementing a directed version of 2sweep for diameter computation, which will also be helpful in implementing DiFUB as given in [https://courses.cs.ut.ee/MTAT.03.238/2014_fall/uploads/Main/diameter.pdf](https://courses.cs.ut.ee/MTAT.03.238/2014_fall/uploads/Main/diameter.pdf)


---

Comment by @vipul79321 created at 2020-03-17 14:24:40

Changing status from new to needs_review.


---

Comment by git created at 2020-03-17 14:26:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-17 14:29:10

I have added method `diameter_lower_bound_2Dsweep`, which is a directed version of 2sweep method. I have updated documentation and test cases respectively.
only One issue-
Documentation doesn't build due to citation not found. Any suggestion will be helpful


---

Comment by dcoudert created at 2020-03-17 19:41:57

Sometimes, in particular when adding references, you have to run `make doc-clean` first.


---

Comment by @vipul79321 created at 2020-03-18 13:21:39

Replying to [comment:4 dcoudert]:
> Sometimes, in particular when adding references, you have to run `make doc-clean` first.
After running `make doc-clean` and then running `./sage --docbuild reference html`, following error occured

```
vipul@vipul-Predator-G3-572:~/sage$ ./sage --docbuild reference html
[reference] building [html]: targets for 1 source files that are out of date
[reference] updating environment: 1 added, 0 changed, 0 removed
[reference] loading cross citations... looking for now-outdated files... none found
[reference] The HTML pages are in local/share/doc/sage/html/en/reference/references.
[reference] Exception occurred:
[reference]   File "/home/vipul/sage/local/lib/python3.7/os.py", line 221, in makedirs
[reference]     mkdir(name, mode)
[reference] FileExistsError: [Errno 17] File exists: '/home/vipul/sage/local/share/doc/sage/html/en/reference/references/_static'
[reference] The full traceback has been saved in /tmp/sphinx-err-_50f0hlq.log, if you want to report the issue to the developers.
[reference] Please also report this if it was a user error, so that a better error message can be provided next time.
[reference] A bug report can be filed in the tracker at <https://github.com/sphinx-doc/sphinx/issues>. Thanks!
Error building the documentation.
Traceback (most recent call last):
  File "/home/vipul/sage/local/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/vipul/sage/local/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
    main()
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 1720, in main
    builder()
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 550, in _wrapper
    self._build_bibliography(lang, format, *args, **kwds)
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 527, in _build_bibliography
    build_many(build_ref_doc, references)
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 280, in build_many
    _build_many(target, args, processes=NUM_THREADS)
  File "/home/vipul/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/utils.py", line 283, in build_many
    raise worker_exc.original_exception
OSError: Exception occurred:

```



---

Comment by dcoudert created at 2020-03-18 13:27:59

try to simply to `make` after `make doc-clean`.


---

Comment by @vipul79321 created at 2020-03-18 17:06:29

Replying to [comment:6 dcoudert]:
> try to simply to `make` after `make doc-clean`.
Thanks for that.. Doc builds and displays well.


---

Comment by dcoudert created at 2020-03-19 18:04:35

In other methods, we use `MemoryAllocator`. It will not be faster than what you did, but it eases the release of memory (the object do it for you). In particular, it will fix a problem of your code: you forgot to release memory before returning the result.

For bitsets however, you have to take care of the release of the memory.

`If the forward eccentricity of the source1 is infinite` -> `If the forward eccentricity of source_1 is infinite`

After each BFS, you must check if the diameter is infinite or not to stop as soon as possible.

why `2-Dsweep` and not `2Dsweep` ?


---

Comment by dcoudert created at 2020-03-19 18:04:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-03-20 06:37:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-20 06:40:08

Replying to [comment:8 dcoudert]:
> After each BFS, you must check if the diameter is infinite or not to stop as soon as possible.
>
Yeah, I agree to that. But is there any way to avoid checking the same `if-condition` multiple times, it just makes the code looks messy.


---

Comment by @vipul79321 created at 2020-03-20 06:40:08

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2020-03-24 10:06:00

Well, if the forward and backward eccentricities from `source_1` are finite, you know that the digraph is strongly connected, right?
So there is no need to check that again for `source_2`.


---

Comment by git created at 2020-03-24 17:11:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-24 17:21:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-24 17:23:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-24 17:25:05

Replying to [comment:11 dcoudert]:
> Well, if the forward and backward eccentricities from `source_1` are finite, you know that the digraph is strongly connected, right?
> So there is no need to check that again for `source_2`.
I have updated the method, to check `infinite condition` only for forward and backward eccentricity of `source` and fixed some silly typos in comments


---

Comment by dcoudert created at 2020-03-25 08:56:41

- You should use latex mode for all variables in this part as well.

```diff
+    eccentricity of `vb` and s as respective vertex.
+    This method returns (LB, s, m, d), where LB is best found lower bound on
+    diameter, s is vertex whose forward/backward eccentricity is LB, d is vertex
+    at a distance LB from/to s, m is vertex at distance LB/2 from/to both s and
+    d.
```


- Please add a test block with a small example.

- you have not defined `s` and `d`. Also, instead of `LB1` and `LB2` (that are not defined), you could define a unique variable `LBm`  for both cases.

- may be `rev_g` should be an input parameter of the method to avoid building multiple times this graph in case the method is used as a sub-routine of another one.


---

Comment by git created at 2020-03-25 14:52:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-25 15:03:14

Replying to [comment:16 dcoudert]:
> - You should use latex mode for all variables in this part as well.
> {{{#!diff
> +    eccentricity of `vb` and s as respective vertex.
> +    This method returns (LB, s, m, d), where LB is best found lower bound on
> +    diameter, s is vertex whose forward/backward eccentricity is LB, d is vertex
> +    at a distance LB from/to s, m is vertex at distance LB/2 from/to both s and
> +    d.
> }}}
> 
> - Please add a test block with a small example.
> 
> - you have not defined `s` and `d`. Also, instead of `LB1` and `LB2` (that are not defined), you could define a unique variable `LBm`  for both cases.
> 
> - may be `rev_g` should be an input parameter of the method to avoid building multiple times this graph in case the method is used as a sub-routine of another one.
- Done\\
Also, I have done the following.\\

- In case of weakly connected digraph, it was throwing an overflow error. In line 1413 of method `diameter`

```diff
- cdef int LB
+ cdef uint32_t LB
```


- To avoid warning of signed and unsigned variables comparing, in line 1378 of method `diameter` 

```diff
- cdef int n = G.order()
+ cdef uint32_t n = G.order()
```


- and some minor doc fixing


---

Comment by dcoudert created at 2020-03-25 18:49:05

* unless I'm mistaken, the `\` in the bibliographie file is not needed

```diff
-.. [Broder2000] \Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
+.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
```


* add a small doctest (in a test block) in method `diameter_lower_bound_2Dsweep`. It is mostly for the doctest coverage statistics.
The test you added in `diameter` is perfect for that.
Note that you can write `digraphs.Circuit(6)`.

that should be all


---

Comment by git created at 2020-03-26 05:04:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-26 05:13:39

Replying to [comment:19 dcoudert]:
> * add a small doctest (in a test block) in method `diameter_lower_bound_2Dsweep`. It is mostly for the doctest coverage statistics.
> The test you added in `diameter` is perfect for that.
Actually, in other methods such as `2sweep` , `multi-sweep`etc there were no test blocks. That's why, I added that test in `diameter`.\\
Now, I have moved that test block from `diameter` to `diameter_lower_bound_2Dsweep`.


---

Comment by git created at 2020-03-26 11:31:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-26 11:32:25

Replying to [comment:19 dcoudert]:
> * unless I'm mistaken, the `\` in the bibliographie file is not needed
> {{{#!diff
> -.. [Broder2000] \Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
> +.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
> }}}
Fixed this.


---

Comment by dcoudert created at 2020-03-26 12:55:32

* in documentation, we write ```None``` and not `None`. Same for True and False.

```diff
-    - ``algorithm`` -- (default: None) specifies the algorithm to use among:
+    - ``algorithm`` -- (default: ``None``) specifies the algorithm to use among:
```


* is it possible to put the `,` at the end of the line and not at the beginning of the next line

```diff
-.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
-                , S., Stata, R., Tomkins, A., Wiener, J.L.: Graph structure in
+.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan,
+                S., Stata, R., Tomkins, A., Wiener, J.L.: Graph structure in
```



---

Comment by git created at 2020-03-26 13:36:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-26 13:38:11

Replying to [comment:24 dcoudert]:
> 
> * in documentation, we write ```None``` and not `None`. Same for True and False.
> {{{#!diff
> -    - ``algorithm`` -- (default: None) specifies the algorithm to use among:
> +    - ``algorithm`` -- (default: ``None``) specifies the algorithm to use among:
> }}}
> 
Done that, for source too.
> * is it possible to put the `,` at the end of the line and not at the beginning of the next line
> {{{#!diff
> -.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan
> -                , S., Stata, R., Tomkins, A., Wiener, J.L.: Graph structure in
> +.. [Broder2000] Broder, A.Z., Kumar, R., Maghoul, F., Raghavan, P., Rajagopalan,
> +                S., Stata, R., Tomkins, A., Wiener, J.L.: Graph structure in
> }}}
Fixed


---

Comment by dcoudert created at 2020-03-26 13:44:17

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-03-26 13:44:17

LGTM.


---

Comment by vbraun created at 2020-04-05 08:30:39

Resolution: fixed
