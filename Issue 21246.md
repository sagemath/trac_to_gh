# Issue 21246: Speed up imag() for quadratic number field elements

Issue created by migration from https://trac.sagemath.org/ticket/21483

Original creator: mmezzarobba

Original creation time: 2016-09-13 14:44:03

Before:

```
sage: QQi.<i> = QuadraticField(-1)
sage: a = i/3 + 1/5
sage: timeit('a.imag()', number=10^4, repeat=20)
10000 loops, best of 20: 56.2 µs per loop
```


After:

```
sage: QQi.<i> = QuadraticField(-1)
sage: a = i/3 + 1/5
sage: timeit('a.imag()', number=10^4, repeat=20)
10000 loops, best of 20: 658 ns per loop
```



---

Comment by mmezzarobba created at 2016-09-13 14:44:19

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-09-13 15:20:19

Guessing the biggest gain was from

```diff
-            q = K(0)
+            q = K.zero()
```

LGTM.


---

Comment by tscrim created at 2016-09-13 15:20:27

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2016-09-13 15:27:26

Replying to [comment:2 tscrim]:
> Guessing the biggest gain was from
> {{{#!diff
> -            q = K(0)
> +            q = K.zero()
> }}}

In the case of ℚ[i], I don't think so (this line is not executed): if I remember right the most costly part was `embedding =  self._parent.coerce_embedding()`.

Thanks for the review!


---

Comment by vbraun created at 2016-09-17 20:09:47

Resolution: fixed
