# Issue 31700: Update markupsafe to 2.0.1

Issue created by migration from https://trac.sagemath.org/ticket/31937

Original creator: isuruf

Original creation time: 2021-06-08 23:36:05

CC:  slelievre arojas fbissey egourgoulhon

Getting this warning with 2.0.1


```
DeprecationWarning: 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
```



---

Comment by mkoeppe created at 2021-06-11 20:11:20

`markupsafe` is only used by `jinja2`. We should update that as well, from 2.11.2 to 2.11.3 or 3.0.1


---

Comment by mkoeppe created at 2021-06-11 20:18:14

Changing type from task to enhancement.


---

Comment by mkoeppe created at 2021-06-11 20:18:14

New commits:


---

Comment by mkoeppe created at 2021-06-11 20:38:05

Changing status from new to needs_review.


---

Comment by isuruf created at 2021-06-11 20:52:12

Changing status from needs_review to positive_review.


---

Comment by isuruf created at 2021-06-11 20:52:12

LGTM. Thanks


---

Comment by mkoeppe created at 2021-06-11 21:50:52

Thanks!


---

Comment by vbraun created at 2021-06-23 22:53:01

I'm getting lots of 

```
**********************************************************************
File "src/sage_docbuild/__init__.py", line 93, in sage_docbuild.builder_helper
Failed example:
    from sage_docbuild import DocBuilder, setup_parser
Expected nothing
Got:
    doctest:warning
      File "/home/release/Sage/src/bin/sage-runtests", line 144, in <module>
        err = DC.run()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py", line 1207, in run
        self.run_doctests()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py", line 909, in run_doctests
        self.dispatcher.dispatch()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2040, in dispatch
        self.parallel_dispatch()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1935, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2207, in start
        super(DocTestWorker, self).start()
      File "/usr/lib64/python3.9/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib64/python3.9/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib64/python3.9/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2179, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2508, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2555, in _run
        result = runner.run(test)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 906, in run
        return self._run(test, compileflags, out)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.builder_helper[0]>", line 1, in <module>
        from sage_docbuild import DocBuilder, setup_parser
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_docbuild/__init__.py", line 55, in <module>
        import sphinx.ext.intersphinx
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sphinx/ext/intersphinx.py", line 40, in <module>
        from sphinx.application import Sphinx
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sphinx/application.py", line 42, in <module>
        from sphinx.registry import SphinxComponentRegistry
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sphinx/registry.py", line 24, in <module>
        from sphinx.builders import Builder
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sphinx/builders/__init__.py", line 26, in <module>
        from sphinx.util import import_object, logging, rst, progress_message, status_iterator
      File "<frozen importlib._bootstrap>", line 1058, in _handle_fromlist
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
      File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 855, in exec_module
      File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sphinx/util/rst.py", line 58, in <module>
        def heading(env: Environment, text: str, level: int = 1) -> str:
      File "/home/release/Sage/local/lib64/python3.9/site-packages/jinja2/filters.py", line 90, in environmentfilter
        warnings.warn(
      File "/usr/lib64/python3.9/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: 'environmentfilter' is renamed to 'pass_environment', the old name will be removed in Jinja 3.1.
**********************************************************************
1 item had failures:
   1 of  10 in sage_docbuild.builder_helper
    [39 tests, 1 failure, 0.31 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage_docbuild/__init__.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2021-06-23 22:53:01

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2021-06-23 22:55:44

Looks like this needs to wait for the sphinx update in #31696


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2022-04-21 04:49:03

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-04-21 05:03:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-05-26 16:48:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-05-27 02:21:02

LGTM


---

Comment by fbissey created at 2022-05-27 02:21:02

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-05-27 02:36:32

Thanks!


---

Comment by vbraun created at 2022-05-29 11:29:18

Resolution: fixed
