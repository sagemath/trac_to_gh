# Issue 22708: py3: test ticket for unicode

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-05-04 09:58:49

CC:  tscrim

Keywords: unicode

trying to move forward using unicode_literals and see what happens


---

Comment by chapoton created at 2017-05-04 09:59:14

New commits:


---

Comment by chapoton created at 2017-05-04 18:03:24

this branch is probably not a very good idea..


---

Comment by aapitzsch created at 2017-05-15 22:58:31

Frédéric, you probably have read http://python-future.org/unicode_literals.html

Have you thought about changing the cython language_level (see ticket:22214#comment:4) when using cython for python3, so using `unicode_literals` might be unnecessary.

_When compiling Cython code with language level 3, the str type is identified with exactly the Unicode string type at Cython compile time, i.e. it does not identify with bytes when running in Python 2._ (https://cython.readthedocs.io/en/latest/src/tutorial/strings.html)


---

Comment by chapoton created at 2017-06-19 17:16:21

first preparation step is #22946


---

Comment by chapoton created at 2017-06-23 15:02:27

This triggers an amusing infinite loop in `CartanType`:

```
File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py", line 708, in __call__
        return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
```

again and again..


---

Comment by chapoton created at 2017-06-23 15:05:04

and one also need to fix this:

```
PolynomialRing(QQ, u'x')
```



---

Comment by tscrim created at 2017-06-23 15:25:34

Replying to [comment:5 chapoton]:
> This triggers an amusing infinite loop in `CartanType`:
> {{{
> File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py", line 708, in __call__
>         return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
> }}}
> again and again..

I am pretty sure it is because of the check

```
        if isinstance(t, str):
```

in `CartanTypeFactory.__call__` and not recognizing it as unicode, so it continues on, then tries to split it up as a reducible type, which then repeats the process because it is a unicode string (which is iterable). So this will recurse indefinitely for any input when you iterate over it, you get the same type of object.


---

Comment by chapoton created at 2017-06-23 16:52:33

I made #23323 for the Cartan problem


---

Comment by jdemeyer created at 2017-07-07 13:27:10

Replying to [ticket:22945 chapoton]:
> trying to move forward using unicode_literals and see what happens

Looking at #23372, I don't think that it makes sense to support `unicode_literals` everywhere. In functions which do non-trivial text handling, unicode should be supported. But for simple things like `QQ[u'x']`, I don't see the point.


---

Comment by chapoton created at 2017-07-07 13:29:23

indeed. We should rather fix #14153 and #18370.


---

Comment by chapoton created at 2017-10-22 19:01:06

I propose to close this one as invalid. It does not make much sense to force unicode literals everywhere.


---

Comment by chapoton created at 2017-10-22 19:01:06

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-10-22 19:22:13

Resolution: wontfix
