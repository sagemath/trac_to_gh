# Issue 30463: enhanced maple parser

archive/issues_030463.json:
```json
{
    "body": "CC:  @slel @mkoeppe\n\nKeywords: maple\n\nHere is a small enhancement to our maple parser, that uses the own types of maple to make more precise conversions back from maple.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30700\n\n",
    "created_at": "2020-10-02T13:25:05Z",
    "labels": [
        "component: interfaces: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "enhanced maple parser",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30463",
    "user": "https://github.com/fchapoton"
}
```
CC:  @slel @mkoeppe

Keywords: maple

Here is a small enhancement to our maple parser, that uses the own types of maple to make more precise conversions back from maple.

Issue created by migration from https://trac.sagemath.org/ticket/30700





---

archive/issue_comments_434309.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-02T13:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434309",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434310.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-02T17:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434311.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-02T17:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434311",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434312.json:
```json
{
    "body": "only a good first step. I would prefer to keep further enhancement for other tickets. please review",
    "created_at": "2020-10-03T07:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434312",
    "user": "https://github.com/fchapoton"
}
```

only a good first step. I would prefer to keep further enhancement for other tickets. please review



---

archive/issue_comments_434313.json:
```json
{
    "body": "- According to the Maple docs, `fraction` as a type means \u201c`rational` but not `integer`\u201d, so I think this case is useless;\n- numbers of type `float` can have arbitrary precision in Maple, they shouldn't blindly be converted to `RR`;\n- as for `complex(extended_numeric)`, it not only recognizes arbitrary-precision complex floating-point numbers, but also exact expressions like `I/3`;\n- I don't understand why you convert equations (equalities) to pairs--they are indeeed used as such in Maple, but only occasionally.\n\nMore generally, if we want a more powerful and robust Maple interface, I suspect we should use the OpenMaple C API instead of talking to the Maple shell.",
    "created_at": "2020-10-03T15:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434313",
    "user": "https://github.com/mezzarobba"
}
```

- According to the Maple docs, `fraction` as a type means “`rational` but not `integer`”, so I think this case is useless;
- numbers of type `float` can have arbitrary precision in Maple, they shouldn't blindly be converted to `RR`;
- as for `complex(extended_numeric)`, it not only recognizes arbitrary-precision complex floating-point numbers, but also exact expressions like `I/3`;
- I don't understand why you convert equations (equalities) to pairs--they are indeeed used as such in Maple, but only occasionally.

More generally, if we want a more powerful and robust Maple interface, I suspect we should use the OpenMaple C API instead of talking to the Maple shell.



---

archive/issue_comments_434314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-03T16:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434315.json:
```json
{
    "body": "Merci pour les suggestions. Le but ici n'est pas une interface parfaite, mais juste un peu mieux que celle qui existe. Il y a de la marge.\n\nQue faire pour \"float\" et pour \"complex\" ?",
    "created_at": "2020-10-03T16:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434315",
    "user": "https://github.com/fchapoton"
}
```

Merci pour les suggestions. Le but ici n'est pas une interface parfaite, mais juste un peu mieux que celle qui existe. Il y a de la marge.

Que faire pour "float" et pour "complex" ?



---

archive/issue_comments_434316.json:
```json
{
    "body": "If you want to recognize complex floating-point numbers, use `complex(float)` instead of `complex(extended_numeric)`. You could also keep `complex(extended_numeric)` and do recursive calls on the real and imaginary parts.\n\nRegarding the precision issue, I'm not sure what to do. Maybe decompose the number with `SFloatMantissa()` and `SFloatExponent()`, convert to integers, and look at the length of the mantissa to set the precision of the parent...\n\n(I agree that the goal is not to have a perfect interface. The issue I have with things that \u201calmost work\u201d but are incorrect in general is that people start using them, and that leads to backward compatibility issues when someone tries to do them right!)",
    "created_at": "2020-10-03T17:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434316",
    "user": "https://github.com/mezzarobba"
}
```

If you want to recognize complex floating-point numbers, use `complex(float)` instead of `complex(extended_numeric)`. You could also keep `complex(extended_numeric)` and do recursive calls on the real and imaginary parts.

Regarding the precision issue, I'm not sure what to do. Maybe decompose the number with `SFloatMantissa()` and `SFloatExponent()`, convert to integers, and look at the length of the mantissa to set the precision of the parent...

(I agree that the goal is not to have a perfect interface. The issue I have with things that “almost work” but are incorrect in general is that people start using them, and that leads to backward compatibility issues when someone tries to do them right!)



---

archive/issue_comments_434317.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-03T17:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-03T19:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434319.json:
```json
{
    "body": "I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..",
    "created_at": "2020-10-03T19:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434319",
    "user": "https://github.com/fchapoton"
}
```

I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..



---

archive/issue_comments_434320.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-03T19:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434321.json:
```json
{
    "body": "Replying to [comment:12 chapoton]:\n> I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..\nI have installed the following script as `maple` on my development box\n{{{#! /bin/bash\n# from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305\nif [ \"$#\" -lt 1 ]; then\n quoted_args=\"\"\nelse\n quoted_args=\"$(printf \" %q\" \"${@}\")\"\nfi\nssh -t $HOST_WITH_MAPLE maple \"$quoted_args\"\n```\n",
    "created_at": "2020-10-03T23:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434321",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 chapoton]:
> I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..
I have installed the following script as `maple` on my development box
{{{#! /bin/bash
# from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305
if [ "$#" -lt 1 ]; then
 quoted_args=""
else
 quoted_args="$(printf " %q" "${@}")"
fi
ssh -t $HOST_WITH_MAPLE maple "$quoted_args"
```




---

archive/issue_comments_434322.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-04T06:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434323.json:
```json
{
    "body": "Replying to [comment:14 mkoeppe]:\n> Replying to [comment:12 chapoton]:\n> > I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..\n> I have installed the following script as `maple` on my development box\n> {{{\n> #! /bin/bash\n> # from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305\n> if [ \"$#\" -lt 1 ]; then\n>  quoted_args=\"\"\n> else\n>  quoted_args=\"$(printf \" %q\" \"${`@`}\")\"\n> fi\n> ssh -t $HOST_WITH_MAPLE maple \"$quoted_args\"\n> }}}\n> \n> \nSorry, but what is your point ?",
    "created_at": "2020-10-04T08:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434323",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:14 mkoeppe]:
> Replying to [comment:12 chapoton]:
> > I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..
> I have installed the following script as `maple` on my development box
> {{{
> #! /bin/bash
> # from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305
> if [ "$#" -lt 1 ]; then
>  quoted_args=""
> else
>  quoted_args="$(printf " %q" "${`@`}")"
> fi
> ssh -t $HOST_WITH_MAPLE maple "$quoted_args"
> }}}
> 
> 
Sorry, but what is your point ?



---

archive/issue_comments_434324.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-04T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434324",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434325.json:
```json
{
    "body": "Lgtm, thank you!\n\n(I still see many failed tests with Maple 2019, but afaict they all were failing already before your changes.)",
    "created_at": "2020-10-04T12:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434325",
    "user": "https://github.com/mezzarobba"
}
```

Lgtm, thank you!

(I still see many failed tests with Maple 2019, but afaict they all were failing already before your changes.)



---

archive/issue_comments_434326.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-04T12:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434326",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_079957.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:06:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30463#event-79957"
}
```



---

archive/issue_comments_434327.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-31T18:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30463#issuecomment-434327",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
