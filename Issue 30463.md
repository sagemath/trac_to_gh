# Issue 30463: enhanced maple parser

Issue created by migration from https://trac.sagemath.org/ticket/30700

Original creator: chapoton

Original creation time: 2020-10-02 13:25:05

CC:  slelievre mkoeppe

Keywords: maple

Here is a small enhancement to our maple parser, that uses the own types of maple to make more precise conversions back from maple.


---

Comment by chapoton created at 2020-10-02 13:25:22

Changing status from new to needs_review.


---

Comment by git created at 2020-10-02 17:12:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-02 17:14:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-03 07:49:06

only a good first step. I would prefer to keep further enhancement for other tickets. please review


---

Comment by mmezzarobba created at 2020-10-03 15:41:24

- According to the Maple docs, `fraction` as a type means “`rational` but not `integer`”, so I think this case is useless;
- numbers of type `float` can have arbitrary precision in Maple, they shouldn't blindly be converted to `RR`;
- as for `complex(extended_numeric)`, it not only recognizes arbitrary-precision complex floating-point numbers, but also exact expressions like `I/3`;
- I don't understand why you convert equations (equalities) to pairs--they are indeeed used as such in Maple, but only occasionally.

More generally, if we want a more powerful and robust Maple interface, I suspect we should use the OpenMaple C API instead of talking to the Maple shell.


---

Comment by git created at 2020-10-03 16:25:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-03 16:26:30

Merci pour les suggestions. Le but ici n'est pas une interface parfaite, mais juste un peu mieux que celle qui existe. Il y a de la marge.

Que faire pour "float" et pour "complex" ?


---

Comment by mmezzarobba created at 2020-10-03 17:40:42

If you want to recognize complex floating-point numbers, use `complex(float)` instead of `complex(extended_numeric)`. You could also keep `complex(extended_numeric)` and do recursive calls on the real and imaginary parts.

Regarding the precision issue, I'm not sure what to do. Maybe decompose the number with `SFloatMantissa()` and `SFloatExponent()`, convert to integers, and look at the length of the mantissa to set the precision of the parent...

(I agree that the goal is not to have a perfect interface. The issue I have with things that “almost work” but are incorrect in general is that people start using them, and that leads to backward compatibility issues when someone tries to do them right!)


---

Comment by git created at 2020-10-03 17:58:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-03 19:20:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-03 19:21:19

I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..


---

Comment by git created at 2020-10-03 19:39:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-03 23:21:10

Replying to [comment:12 chapoton]:
> I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..
I have installed the following script as `maple` on my development box
{{{#! /bin/bash
# from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305
if [ "$#" -lt 1 ]; then
 quoted_args=""
else
 quoted_args="$(printf " %q" "${@}")"
fi
ssh -t $HOST_WITH_MAPLE maple "$quoted_args"
```



---

Comment by git created at 2020-10-04 06:56:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-04 08:58:27

Replying to [comment:14 mkoeppe]:
> Replying to [comment:12 chapoton]:
> > I have some awful git troubles on my only machine with maple, so I will not be able to move this forward..
> I have installed the following script as `maple` on my development box
> {{{
> #! /bin/bash
> # from https://stackoverflow.com/questions/1668649/how-to-keep-quotes-in-bash-arguments/8723305
> if [ "$#" -lt 1 ]; then
>  quoted_args=""
> else
>  quoted_args="$(printf " %q" "${`@`}")"
> fi
> ssh -t $HOST_WITH_MAPLE maple "$quoted_args"
> }}}
> 
> 
Sorry, but what is your point ?


---

Comment by git created at 2020-10-04 09:40:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-10-04 12:20:26

Lgtm, thank you!

(I still see many failed tests with Maple 2019, but afaict they all were failing already before your changes.)


---

Comment by mmezzarobba created at 2020-10-04 12:20:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-10-31 18:06:58

Resolution: fixed
