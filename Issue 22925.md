# Issue 22925: Give a warning when using citation.get_systems() without Cython profiling

archive/issues_022925.json:
```json
{
    "body": "CC:  slabbe\n\n`sage.misc.citation.get_systems()` is implemented by using `cProfile` to look at which modules implement the functions called when executing the code.\n\nThe problem is that this is totally unreliable when Cython is compiled without profiling support (which is the default). This doctest\n\n```\nsage: from sage.misc.citation import get_systems\nsage: get_systems('((x+1)^2).expand()')\n['ginac']\n```\n\nonly works because `Expression.expand()` is called by Python instead of Cython. If that call would be inside some other Cython code, then Python's profiler would not detect it:\n\n```\nsage: cython('def callexpand(x): return x.expand()')\nsage: from sage.misc.citation import get_systems\nsage: get_systems('callexpand(((x+1)^2))')\n[]\n```\n\n\nThere is a problem because #22747 will \"break\" profiling even further as even the top-level call of `Expression.expand()` would not be detected as something to be entered in the profiler.\n\nSo here I propose simply to give a warning whenever `get_systems()` is used when profiling was not enabled.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23162\n\n",
    "created_at": "2017-06-07T15:11:37Z",
    "labels": [
        "cython",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Give a warning when using citation.get_systems() without Cython profiling",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22925",
    "user": "jdemeyer"
}
```
CC:  slabbe

`sage.misc.citation.get_systems()` is implemented by using `cProfile` to look at which modules implement the functions called when executing the code.

The problem is that this is totally unreliable when Cython is compiled without profiling support (which is the default). This doctest

```
sage: from sage.misc.citation import get_systems
sage: get_systems('((x+1)^2).expand()')
['ginac']
```

only works because `Expression.expand()` is called by Python instead of Cython. If that call would be inside some other Cython code, then Python's profiler would not detect it:

```
sage: cython('def callexpand(x): return x.expand()')
sage: from sage.misc.citation import get_systems
sage: get_systems('callexpand(((x+1)^2))')
[]
```


There is a problem because #22747 will "break" profiling even further as even the top-level call of `Expression.expand()` would not be detected as something to be entered in the profiler.

So here I propose simply to give a warning whenever `get_systems()` is used when profiling was not enabled.

Issue created by migration from https://trac.sagemath.org/ticket/23162





---

archive/issue_comments_320748.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-07T20:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320748",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_320749.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-07T20:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320749",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_320750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-15T12:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320750",
    "user": "slabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_320751.json:
```json
{
    "body": "Works for me on OSX 10.10. `sage -t --long` works. Code looks good. Documentation builds and looks fine.",
    "created_at": "2017-06-15T12:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320751",
    "user": "slabbe"
}
```

Works for me on OSX 10.10. `sage -t --long` works. Code looks good. Documentation builds and looks fine.



---

archive/issue_comments_320752.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2017-06-15T12:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320752",
    "user": "slabbe"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_320753.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-15T23:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22925#issuecomment-320753",
    "user": "vbraun"
}
```

Resolution: fixed
