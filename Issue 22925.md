# Issue 22925: Give a warning when using citation.get_systems() without Cython profiling

Issue created by migration from https://trac.sagemath.org/ticket/23162

Original creator: jdemeyer

Original creation time: 2017-06-07 15:11:37

CC:  slabbe

`sage.misc.citation.get_systems()` is implemented by using `cProfile` to look at which modules implement the functions called when executing the code.

The problem is that this is totally unreliable when Cython is compiled without profiling support (which is the default). This doctest

```
sage: from sage.misc.citation import get_systems
sage: get_systems('((x+1)^2).expand()')
['ginac']
```

only works because `Expression.expand()` is called by Python instead of Cython. If that call would be inside some other Cython code, then Python's profiler would not detect it:

```
sage: cython('def callexpand(x): return x.expand()')
sage: from sage.misc.citation import get_systems
sage: get_systems('callexpand(((x+1)^2))')
[]
```


There is a problem because #22747 will "break" profiling even further as even the top-level call of `Expression.expand()` would not be detected as something to be entered in the profiler.

So here I propose simply to give a warning whenever `get_systems()` is used when profiling was not enabled.


---

Comment by jdemeyer created at 2017-06-07 20:33:25

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-06-07 20:33:25

New commits:


---

Comment by slabbe created at 2017-06-15 12:25:33

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2017-06-15 12:25:33

Works for me on OSX 10.10. `sage -t --long` works. Code looks good. Documentation builds and looks fine.


---

Comment by slabbe created at 2017-06-15 12:26:44

Changing keywords from "" to "thursdaysbdx".


---

Comment by vbraun created at 2017-06-15 23:10:04

Resolution: fixed
