# Issue 11106: Add -finline-functions to singular CFLAGS

archive/issues_011106.json:
```json
{
    "body": "Assignee: tbd\n\nOn my Mac OS X 10.4 PPC 32-bit system, singular (#11084) fails to compile with -O2 while it *does* work with -O3.  I have narrowed it down to the option `-finline-functions` which must be enabled for the build to work on this system.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11278\n\n",
    "created_at": "2011-04-30T20:35:18Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "title": "Add -finline-functions to singular CFLAGS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11106",
    "user": "jdemeyer"
}
```
Assignee: tbd

On my Mac OS X 10.4 PPC 32-bit system, singular (#11084) fails to compile with -O2 while it *does* work with -O3.  I have narrowed it down to the option `-finline-functions` which must be enabled for the build to work on this system.

Issue created by migration from https://trac.sagemath.org/ticket/11278





---

archive/issue_comments_121454.json:
```json
{
    "body": "What version of gcc is this failing with? I assume it is not 4.6.0, but can you confirm that? \n\nThis error message reminds me of ones that existed with R and ECL on Solaris. The ECL bug has been fixed, but not the R bug (#9040), so R will not build 64-bit on Solaris x86 with gcc. The R bug is caused by a shared library being built with position dependent code. There are some conditions that can cause non-PIC code to be generated even when the flag -fPIC is given. \n\nI would check if -fPIC is being passed first. I had a long battle with the Singular developers to get them to accept that -fPIC should be used on Solaris. I think I'd convinced them on Linux too, but never tried on OS X. It could be that there's no -fPIC flag and it just happens this is ok with -O3 but not with -O2. \n\nTake a look at \n\nhttp://blogs.sun.com/rie/entry/my_relocations_don_t_fit\n\nwhich discusses this issue. It is a Sun blog aimed at Solaris, but the error message seems remarkably similar. Which makes me think this might be a PIC/non-PIC issue.\n\nTime for bed here - it is 0300 local time!!\n\ndave",
    "created_at": "2011-05-01T02:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121454",
    "user": "drkirkby"
}
```

What version of gcc is this failing with? I assume it is not 4.6.0, but can you confirm that? 

This error message reminds me of ones that existed with R and ECL on Solaris. The ECL bug has been fixed, but not the R bug (#9040), so R will not build 64-bit on Solaris x86 with gcc. The R bug is caused by a shared library being built with position dependent code. There are some conditions that can cause non-PIC code to be generated even when the flag -fPIC is given. 

I would check if -fPIC is being passed first. I had a long battle with the Singular developers to get them to accept that -fPIC should be used on Solaris. I think I'd convinced them on Linux too, but never tried on OS X. It could be that there's no -fPIC flag and it just happens this is ok with -O3 but not with -O2. 

Take a look at 

http://blogs.sun.com/rie/entry/my_relocations_don_t_fit

which discusses this issue. It is a Sun blog aimed at Solaris, but the error message seems remarkably similar. Which makes me think this might be a PIC/non-PIC issue.

Time for bed here - it is 0300 local time!!

dave



---

archive/issue_comments_121455.json:
```json
{
    "body": "Dave, it's clear from reading various posts about this problem that it is an Apple-specific issue, so I doubt the Solaris stuff you linked to is relevant.\n\nI'm using these compilers:\n\n\n```\n$ gcc --version\npowerpc-apple-darwin8-gcc-4.0.1 (GCC) 4.0.1 (Apple Computer, Inc. build 5367)\nCopyright (C) 2005 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n```\n\n\n\n```\n$ g++ --version\npowerpc-apple-darwin8-g++-4.0.1 (GCC) 4.0.1 (Apple Computer, Inc. build 5367)\nCopyright (C) 2005 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n```\n",
    "created_at": "2011-05-01T09:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121455",
    "user": "jdemeyer"
}
```

Dave, it's clear from reading various posts about this problem that it is an Apple-specific issue, so I doubt the Solaris stuff you linked to is relevant.

I'm using these compilers:


```
$ gcc --version
powerpc-apple-darwin8-gcc-4.0.1 (GCC) 4.0.1 (Apple Computer, Inc. build 5367)
Copyright (C) 2005 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```



```
$ g++ --version
powerpc-apple-darwin8-g++-4.0.1 (GCC) 4.0.1 (Apple Computer, Inc. build 5367)
Copyright (C) 2005 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```




---

archive/issue_comments_121456.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2011-05-01T11:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121456",
    "user": "vbraun"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_121457.json:
```json
{
    "body": "Google suggests that this is xcode-2.4.1. Can you try with a later xcode release? I think anything up to the latest xcode-3 supports PPC OSX 10.4.",
    "created_at": "2011-05-01T11:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121457",
    "user": "vbraun"
}
```

Google suggests that this is xcode-2.4.1. Can you try with a later xcode release? I think anything up to the latest xcode-3 supports PPC OSX 10.4.



---

archive/issue_comments_121458.json:
```json
{
    "body": "Hi,\n\nfor Mac OS X 10.4 (Tiger), one should update to the latest OS version (10.4.11), and use the latest XCode version which is supported by OS X 10.4, this is XCode v2.5 (already some years old). It comes with a \"build 5370\" Apple version of GCC 4.0.1. (Any later XCode versions are not supported for OS X 10.4, AFAIR.)\n\nI'll give Sage-4.7.rc1 a try on both my OS X 10.4 MacIntel and MacPPC boxes, but the latter will literally need days to give results (it's got a 7440 G4 `@` 550MHz CPU).",
    "created_at": "2011-05-01T18:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121458",
    "user": "GeorgSWeber"
}
```

Hi,

for Mac OS X 10.4 (Tiger), one should update to the latest OS version (10.4.11), and use the latest XCode version which is supported by OS X 10.4, this is XCode v2.5 (already some years old). It comes with a "build 5370" Apple version of GCC 4.0.1. (Any later XCode versions are not supported for OS X 10.4, AFAIR.)

I'll give Sage-4.7.rc1 a try on both my OS X 10.4 MacIntel and MacPPC boxes, but the latter will literally need days to give results (it's got a 7440 G4 `@` 550MHz CPU).



---

archive/issue_comments_121459.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Dave, it's clear from reading various posts about this problem that it is an Apple-specific issue, so I doubt the Solaris stuff you linked to is relevant.\n\nI would still not dismiss the possibility that there might be non-PIC code being generated. \n\nDave",
    "created_at": "2011-05-01T18:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121459",
    "user": "drkirkby"
}
```

Replying to [comment:6 jdemeyer]:
> Dave, it's clear from reading various posts about this problem that it is an Apple-specific issue, so I doubt the Solaris stuff you linked to is relevant.

I would still not dismiss the possibility that there might be non-PIC code being generated. 

Dave



---

archive/issue_comments_121460.json:
```json
{
    "body": "Replying to [comment:8 GeorgSWeber]:\n> I'll give Sage-4.7.rc1 a try on both my OS X 10.4 MacIntel and MacPPC boxes, but the latter will literally need days to give results (it's got a 7440 G4 `@` 550MHz CPU).\n\nThanks!  Those will be useful data points.",
    "created_at": "2011-05-02T10:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121460",
    "user": "jdemeyer"
}
```

Replying to [comment:8 GeorgSWeber]:
> I'll give Sage-4.7.rc1 a try on both my OS X 10.4 MacIntel and MacPPC boxes, but the latter will literally need days to give results (it's got a 7440 G4 `@` 550MHz CPU).

Thanks!  Those will be useful data points.



---

archive/issue_comments_121461.json:
```json
{
    "body": "Just got in to work, I am now downloading and it will probably get to Singular sooner rather than later, we'll see.\n\nGeorg is correct that no version >2.5 is supported on 10.4.  I also only have build 5367/Xcode 2.4.1, but will see if I can track down Xcode 2.5 later - that might not mean immediately.",
    "created_at": "2011-05-02T12:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121461",
    "user": "kcrisman"
}
```

Just got in to work, I am now downloading and it will probably get to Singular sooner rather than later, we'll see.

Georg is correct that no version >2.5 is supported on 10.4.  I also only have build 5367/Xcode 2.4.1, but will see if I can track down Xcode 2.5 later - that might not mean immediately.



---

archive/issue_comments_121462.json:
```json
{
    "body": "On the system where the problem was discovered: -O0 also does work.\n\nSo here is a proposal: on \"old\" (4.0.x) versions of gcc: use -O3, otherwise -O2.  That would fix the problem on this ticket.",
    "created_at": "2011-05-02T15:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121462",
    "user": "jdemeyer"
}
```

On the system where the problem was discovered: -O0 also does work.

So here is a proposal: on "old" (4.0.x) versions of gcc: use -O3, otherwise -O2.  That would fix the problem on this ticket.



---

archive/issue_comments_121463.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-05-03T08:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121463",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_121464.json:
```json
{
    "body": "Diff for the singular spkg, for reviewing only",
    "created_at": "2011-05-03T08:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121464",
    "user": "jdemeyer"
}
```

Diff for the singular spkg, for reviewing only



---

archive/issue_comments_121465.json:
```json
{
    "body": "Attachment [singular-3-1-1-4.p8-p9.diff](tarball://root/attachments/some-uuid/ticket11278/singular-3-1-1-4.p8-p9.diff) by kcrisman created at 2011-05-05 13:08:33\n\nJust a comment (hopefully I'll be able to review at all - even with the Xcode update, I still can't get past PolyBoRi) - any reason for checking this, rather than uname=Darwin and then the Xcode version/gcc version? Have we had any complaints on other platforms for gcc 4.0.x?",
    "created_at": "2011-05-05T13:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121465",
    "user": "kcrisman"
}
```

Attachment [singular-3-1-1-4.p8-p9.diff](tarball://root/attachments/some-uuid/ticket11278/singular-3-1-1-4.p8-p9.diff) by kcrisman created at 2011-05-05 13:08:33

Just a comment (hopefully I'll be able to review at all - even with the Xcode update, I still can't get past PolyBoRi) - any reason for checking this, rather than uname=Darwin and then the Xcode version/gcc version? Have we had any complaints on other platforms for gcc 4.0.x?



---

archive/issue_comments_121466.json:
```json
{
    "body": "Replying to [comment:14 kcrisman]:\n> Have we had any complaints on other platforms for gcc 4.0.x?\n\nThere were no complaints on other platforms as far as I know.  However, you can consider the situation with gcc 4.0.x a status-quo: it used to be -O3 before rc0, and it is now again -O3.  Since there were no problems with gcc 4.0.x before rc0, I don't think it is a problem to use -O3 with gcc 4.0.x on all platforms.",
    "created_at": "2011-05-05T13:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121466",
    "user": "jdemeyer"
}
```

Replying to [comment:14 kcrisman]:
> Have we had any complaints on other platforms for gcc 4.0.x?

There were no complaints on other platforms as far as I know.  However, you can consider the situation with gcc 4.0.x a status-quo: it used to be -O3 before rc0, and it is now again -O3.  Since there were no problems with gcc 4.0.x before rc0, I don't think it is a problem to use -O3 with gcc 4.0.x on all platforms.



---

archive/issue_comments_121467.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Replying to [comment:14 kcrisman]:\n> > Have we had any complaints on other platforms for gcc 4.0.x?\n> \n> There were no complaints on other platforms as far as I know.  However, you can consider the situation with gcc 4.0.x a status-quo: it used to be -O3 before rc0, and it is now again -O3.  Since there were no problems with gcc 4.0.x before rc0, I don't think it is a problem to use -O3 with gcc 4.0.x on all platforms.\n\nOkay, that makes sense.  Positive review on the diff, and presumably this would fix it if it worked before; however, it will still take a while until I can test it because of the unrelated build issue mentioned above, so if someone else beats me to it, by all means. \n\nI am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review.",
    "created_at": "2011-05-05T20:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121467",
    "user": "kcrisman"
}
```

Replying to [comment:15 jdemeyer]:
> Replying to [comment:14 kcrisman]:
> > Have we had any complaints on other platforms for gcc 4.0.x?
> 
> There were no complaints on other platforms as far as I know.  However, you can consider the situation with gcc 4.0.x a status-quo: it used to be -O3 before rc0, and it is now again -O3.  Since there were no problems with gcc 4.0.x before rc0, I don't think it is a problem to use -O3 with gcc 4.0.x on all platforms.

Okay, that makes sense.  Positive review on the diff, and presumably this would fix it if it worked before; however, it will still take a while until I can test it because of the unrelated build issue mentioned above, so if someone else beats me to it, by all means. 

I am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review.



---

archive/issue_comments_121468.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> I am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review. \n\nHow is it working out?",
    "created_at": "2011-05-08T10:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121468",
    "user": "jdemeyer"
}
```

Replying to [comment:16 kcrisman]:
> I am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review. 

How is it working out?



---

archive/issue_comments_121469.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Replying to [comment:16 kcrisman]:\n> > I am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review. \n> \n> How is it working out?\n\nI think I said somewhere on the rc1 sage-release list that rc0 failed at the same place in PolyBoRi.  I will try to look into that more (the sed thing) when I'm done with classes today, but until then there isn't much I can do with this, except to ./sage -f it into an alpha5 and check that it builds.   \n\nMaybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.",
    "created_at": "2011-05-09T12:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121469",
    "user": "kcrisman"
}
```

Replying to [comment:17 jdemeyer]:
> Replying to [comment:16 kcrisman]:
> > I am going to try to build rc0, not rc1; if I can get *that* to build up to Singular, then replace with this, I think that would be enough for positive review. 
> 
> How is it working out?

I think I said somewhere on the rc1 sage-release list that rc0 failed at the same place in PolyBoRi.  I will try to look into that more (the sed thing) when I'm done with classes today, but until then there isn't much I can do with this, except to ./sage -f it into an alpha5 and check that it builds.   

Maybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.



---

archive/issue_comments_121470.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> Maybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.\n\nLet's try that then.",
    "created_at": "2011-05-09T21:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121470",
    "user": "jdemeyer"
}
```

Replying to [comment:18 kcrisman]:
> Maybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.

Let's try that then.



---

archive/issue_comments_121471.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-05-11T14:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121471",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121472.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Replying to [comment:18 kcrisman]:\n> > Maybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.\n> \n> Let's try that then.\n\nSuccess!  Failed with p8, worked with p9.  I'm now waiting on ./sage -b, but don't anticipate any problems if you didn't have any.  I'll revert the positive review if I do come up with any problems, otherwise it's good to go.",
    "created_at": "2011-05-11T14:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121472",
    "user": "kcrisman"
}
```

Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 kcrisman]:
> > Maybe I could try to ./sage -f the 'bad' one into my alpha5, check it fails, and then ./sage -f this one into my alpha5, check that it builds.  Would that be sufficient?  I think I *do* have the ability to try that.
> 
> Let's try that then.

Success!  Failed with p8, worked with p9.  I'm now waiting on ./sage -b, but don't anticipate any problems if you didn't have any.  I'll revert the positive review if I do come up with any problems, otherwise it's good to go.



---

archive/issue_comments_121473.json:
```json
{
    "body": "Yeah, relevant tests are all passing.  Good sleuthing.",
    "created_at": "2011-05-11T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121473",
    "user": "kcrisman"
}
```

Yeah, relevant tests are all passing.  Good sleuthing.



---

archive/issue_comments_121474.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-11T19:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121474",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_121475.json:
```json
{
    "body": "Sorry for the delay, just to let you know:\n\nOn my MacPPC system, OS X 10.4.11 with XCode 2.5, with an older G4 CPU with 550 MHz and 768 MB RAM, Sage-4.7.rc2 (with singular 3-1-1-4.p9) builds fine! For some (more or less unrelated) details about polybori, see my comments trac #11331.",
    "created_at": "2011-05-14T20:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11106#issuecomment-121475",
    "user": "GeorgSWeber"
}
```

Sorry for the delay, just to let you know:

On my MacPPC system, OS X 10.4.11 with XCode 2.5, with an older G4 CPU with 550 MHz and 768 MB RAM, Sage-4.7.rc2 (with singular 3-1-1-4.p9) builds fine! For some (more or less unrelated) details about polybori, see my comments trac #11331.
