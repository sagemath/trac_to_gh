# Issue 25839: Free nilpotent Lie algebras

archive/issues_025839.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: Lie algebras, nilpotent\n\nImplement the construction of free nilpotent Lie algebras, i.e. Lie algebras where the only additional relations among the brackets are that iterated brackets longer than the nilpotency step must vanish.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26076\n\n",
    "created_at": "2018-08-17T07:00:08Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Free nilpotent Lie algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25839",
    "user": "https://github.com/ehaka"
}
```
CC:  @tscrim

Keywords: Lie algebras, nilpotent

Implement the construction of free nilpotent Lie algebras, i.e. Lie algebras where the only additional relations among the brackets are that iterated brackets longer than the nilpotency step must vanish.

Issue created by migration from https://trac.sagemath.org/ticket/26076





---

archive/issue_comments_364274.json:
```json
{
    "body": "Some implementation already exists in an external private codebase that I need to clean up and import into Sage.",
    "created_at": "2018-08-17T07:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364274",
    "user": "https://github.com/ehaka"
}
```

Some implementation already exists in an external private codebase that I need to clean up and import into Sage.



---

archive/issue_comments_364275.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364275",
    "user": "https://github.com/ehaka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364276.json:
```json
{
    "body": "The adapted version of the free nilpotent Lie algebra construction is in the commits. I removed the parameter `free` from the method `sage.algebras.lie_algebras.nilpotent_lie_algebra.NilpotentLieAlgebra` of #26074, as the parameter seemed to be redundant.\n----\nNew commits:",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364276",
    "user": "https://github.com/ehaka"
}
```

The adapted version of the free nilpotent Lie algebra construction is in the commits. I removed the parameter `free` from the method `sage.algebras.lie_algebras.nilpotent_lie_algebra.NilpotentLieAlgebra` of #26074, as the parameter seemed to be redundant.
----
New commits:



---

archive/issue_comments_364277.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-08-21T17:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_364278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364279.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364281.json:
```json
{
    "body": "I have made some documentation tweaks and a little better normalization and testing of the input. I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory):\n\n```\n%sage: %time L = LieAlgebra(QQ, 3, step=3)\nCPU times: user 48 ms, sys: 4 ms, total: 52 ms\nWall time: 50.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=3)\nCPU times: user 16 ms, sys: 0 ns, total: 16 ms\nWall time: 12.7 ms\nsage: %time L = LieAlgebra(QQ, 5, step=4)\nCPU times: user 92 ms, sys: 0 ns, total: 92 ms\nWall time: 88.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=5)\nCPU times: user 1.45 s, sys: 28 ms, total: 1.48 s\nWall time: 1.47 s\nsage: %time L = LieAlgebra(QQ, 6, step=3)\nCPU times: user 16 ms, sys: 8 ms, total: 24 ms\nWall time: 21 ms\nsage: %time L = LieAlgebra(QQ, 6, step=4)\nCPU times: user 368 ms, sys: 36 ms, total: 404 ms\nWall time: 356 ms\nsage: %time L = LieAlgebra(QQ, 6, step=5)\nCPU times: user 8.83 s, sys: 148 ms, total: 8.98 s\nWall time: 8.97 s\n```\n\nvs prev\n\n```\nsage: %time L = LieAlgebra(QQ, 3, step=3)\nCPU times: user 44 ms, sys: 8 ms, total: 52 ms\nWall time: 49.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=3)\nCPU times: user 12 ms, sys: 4 ms, total: 16 ms\nWall time: 15.5 ms\nsage: %time L = LieAlgebra(QQ, 5, step=4)\nCPU times: user 144 ms, sys: 12 ms, total: 156 ms\nWall time: 142 ms\nsage: %time L = LieAlgebra(QQ, 5, step=5)\nCPU times: user 2.29 s, sys: 24 ms, total: 2.32 s\nWall time: 2.31 s\nsage: %time L = LieAlgebra(QQ, 6, step=3)\nCPU times: user 24 ms, sys: 0 ns, total: 24 ms\nWall time: 25.2 ms\nsage: %time L = LieAlgebra(QQ, 6, step=4)\nCPU times: user 536 ms, sys: 28 ms, total: 564 ms\nWall time: 533 ms\nsage: %time L = LieAlgebra(QQ, 6, step=5)\nCPU times: user 13.7 s, sys: 204 ms, total: 13.9 s\nWall time: 13.9 s\n```\n\n\nIf my changes are good, then positive review.\n----\nNew commits:",
    "created_at": "2018-08-23T01:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364281",
    "user": "https://github.com/tscrim"
}
```

I have made some documentation tweaks and a little better normalization and testing of the input. I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory):

```
%sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 48 ms, sys: 4 ms, total: 52 ms
Wall time: 50.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 16 ms, sys: 0 ns, total: 16 ms
Wall time: 12.7 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 92 ms, sys: 0 ns, total: 92 ms
Wall time: 88.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 1.45 s, sys: 28 ms, total: 1.48 s
Wall time: 1.47 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 16 ms, sys: 8 ms, total: 24 ms
Wall time: 21 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 368 ms, sys: 36 ms, total: 404 ms
Wall time: 356 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 8.83 s, sys: 148 ms, total: 8.98 s
Wall time: 8.97 s
```

vs prev

```
sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 44 ms, sys: 8 ms, total: 52 ms
Wall time: 49.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 12 ms, sys: 4 ms, total: 16 ms
Wall time: 15.5 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 144 ms, sys: 12 ms, total: 156 ms
Wall time: 142 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 2.29 s, sys: 24 ms, total: 2.32 s
Wall time: 2.31 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 24 ms, sys: 0 ns, total: 24 ms
Wall time: 25.2 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 536 ms, sys: 28 ms, total: 564 ms
Wall time: 533 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 13.7 s, sys: 204 ms, total: 13.9 s
Wall time: 13.9 s
```


If my changes are good, then positive review.
----
New commits:



---

archive/issue_comments_364282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-23T01:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364283.json:
```json
{
    "body": "I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.",
    "created_at": "2018-08-23T01:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364283",
    "user": "https://github.com/tscrim"
}
```

I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.



---

archive/issue_comments_364284.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> I have made some documentation tweaks and a little better normalization and testing of the input.\n\nAll good changes.\n\n> I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory)\n\nA ~30% speedup in the expensive cases, very impressive!\n\n\nReplying to [comment:10 tscrim]:\n> I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.\n\nI left the cutoff at 11 because I figured technically a zero does not cause ambiguity since it must always be attached to a 10. For aesthetic and convenience the cutoff at 10 is much better though.\n\nThe changes all look very good to me, thanks for the improvements!",
    "created_at": "2018-08-23T06:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364284",
    "user": "https://github.com/ehaka"
}
```

Replying to [comment:7 tscrim]:
> I have made some documentation tweaks and a little better normalization and testing of the input.

All good changes.

> I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory)

A ~30% speedup in the expensive cases, very impressive!


Replying to [comment:10 tscrim]:
> I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.

I left the cutoff at 11 because I figured technically a zero does not cause ambiguity since it must always be attached to a 10. For aesthetic and convenience the cutoff at 10 is much better though.

The changes all look very good to me, thanks for the improvements!



---

archive/issue_comments_364285.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-23T06:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364285",
    "user": "https://github.com/ehaka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_024029.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2018-08-26T09:37:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25839#event-24029"
}
```



---

archive/issue_comments_364286.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-26T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25839#issuecomment-364286",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
