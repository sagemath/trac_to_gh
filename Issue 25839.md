# Issue 25839: Free nilpotent Lie algebras

Issue created by migration from https://trac.sagemath.org/ticket/26076

Original creator: @ehaka

Original creation time: 2018-08-17 07:00:08

CC:  tscrim

Keywords: Lie algebras, nilpotent

Implement the construction of free nilpotent Lie algebras, i.e. Lie algebras where the only additional relations among the brackets are that iterated brackets longer than the nilpotency step must vanish.


---

Comment by @ehaka created at 2018-08-17 07:02:24

Some implementation already exists in an external private codebase that I need to clean up and import into Sage.


---

Comment by @ehaka created at 2018-08-17 11:59:48

Changing status from new to needs_review.


---

Comment by @ehaka created at 2018-08-17 11:59:48

The adapted version of the free nilpotent Lie algebra construction is in the commits. I removed the parameter `free` from the method `sage.algebras.lie_algebras.nilpotent_lie_algebra.NilpotentLieAlgebra` of #26074, as the parameter seemed to be redundant.
----
New commits:


---

Comment by git created at 2018-08-21 17:24:45

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2018-08-22 05:35:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-22 05:51:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-22 05:54:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-23 01:04:29

I have made some documentation tweaks and a little better normalization and testing of the input. I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory):

```
%sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 48 ms, sys: 4 ms, total: 52 ms
Wall time: 50.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 16 ms, sys: 0 ns, total: 16 ms
Wall time: 12.7 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 92 ms, sys: 0 ns, total: 92 ms
Wall time: 88.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 1.45 s, sys: 28 ms, total: 1.48 s
Wall time: 1.47 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 16 ms, sys: 8 ms, total: 24 ms
Wall time: 21 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 368 ms, sys: 36 ms, total: 404 ms
Wall time: 356 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 8.83 s, sys: 148 ms, total: 8.98 s
Wall time: 8.97 s
```

vs prev

```
sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 44 ms, sys: 8 ms, total: 52 ms
Wall time: 49.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 12 ms, sys: 4 ms, total: 16 ms
Wall time: 15.5 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 144 ms, sys: 12 ms, total: 156 ms
Wall time: 142 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 2.29 s, sys: 24 ms, total: 2.32 s
Wall time: 2.31 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 24 ms, sys: 0 ns, total: 24 ms
Wall time: 25.2 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 536 ms, sys: 28 ms, total: 564 ms
Wall time: 533 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 13.7 s, sys: 204 ms, total: 13.9 s
Wall time: 13.9 s
```


If my changes are good, then positive review.
----
New commits:


---

Comment by git created at 2018-08-23 01:07:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-23 01:08:59

I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.


---

Comment by @ehaka created at 2018-08-23 06:31:46

Replying to [comment:7 tscrim]:
> I have made some documentation tweaks and a little better normalization and testing of the input.

All good changes.

> I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory)

A ~30% speedup in the expensive cases, very impressive!


Replying to [comment:10 tscrim]:
> I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.

I left the cutoff at 11 because I figured technically a zero does not cause ambiguity since it must always be attached to a 10. For aesthetic and convenience the cutoff at 10 is much better though.

The changes all look very good to me, thanks for the improvements!


---

Comment by @ehaka created at 2018-08-23 06:31:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-26 09:37:40

Resolution: fixed
