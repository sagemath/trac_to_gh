# Issue 29358: Improve iteration of multivariate polynomials

archive/issues_029358.json:
```json
{
    "body": "CC:  @mwageringel chapoton\n\nKeywords: multivariate polynomial iteration\n\nWe should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29595\n\n",
    "created_at": "2020-04-27T03:15:29Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Improve iteration of multivariate polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29358",
    "user": "tscrim"
}
```
CC:  @mwageringel chapoton

Keywords: multivariate polynomial iteration

We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).

Issue created by migration from https://trac.sagemath.org/ticket/29595





---

archive/issue_comments_416330.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-16T05:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416330",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416331.json:
```json
{
    "body": "Changing component from algebra to performance.",
    "created_at": "2020-05-16T05:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416331",
    "user": "tscrim"
}
```

Changing component from algebra to performance.



---

archive/issue_comments_416332.json:
```json
{
    "body": "Okay, I might have gone a bit overboard at the end. However, some of these little methods get some major speedups. There might be some other places to optimize. Definitely converting the generic multivariate polynomials to Cython will help and/or pushing more stuff to the polydict backend.\n\nI was actually expecting a bit more of a speedup from the libsingular iterator, but I guess that just goes to show the speed of the builtin Python iterators. However, it still gets about a ~10% speedup, which is nice, beyond the memory savings.\n----\nNew commits:",
    "created_at": "2020-05-16T05:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416332",
    "user": "tscrim"
}
```

Okay, I might have gone a bit overboard at the end. However, some of these little methods get some major speedups. There might be some other places to optimize. Definitely converting the generic multivariate polynomials to Cython will help and/or pushing more stuff to the polydict backend.

I was actually expecting a bit more of a speedup from the libsingular iterator, but I guess that just goes to show the speed of the builtin Python iterators. However, it still gets about a ~10% speedup, which is nice, beyond the memory savings.
----
New commits:



---

archive/issue_comments_416333.json:
```json
{
    "body": "one failing doctest\n\n```\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 3186, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__iter__\nFailed example:\n    list(R.zero())\nExpected nothing\nGot:\n    []\n```\n",
    "created_at": "2020-05-16T07:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416333",
    "user": "chapoton"
}
```

one failing doctest

```
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 3186, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__iter__
Failed example:
    list(R.zero())
Expected nothing
Got:
    []
```




---

archive/issue_comments_416334.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-16T07:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416334",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416335.json:
```json
{
    "body": "Whoops; fixed.",
    "created_at": "2020-05-16T07:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416335",
    "user": "tscrim"
}
```

Whoops; fixed.



---

archive/issue_comments_416336.json:
```json
{
    "body": "Looks good. There remains \n\n```\n+        one = ring.base_ring()(1)\n```\n\nthat maybe could use `.one()` ?",
    "created_at": "2020-05-17T06:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416336",
    "user": "chapoton"
}
```

Looks good. There remains 

```
+        one = ring.base_ring()(1)
```

that maybe could use `.one()` ?



---

archive/issue_comments_416337.json:
```json
{
    "body": "Replying to [comment:5 chapoton]:\n> Looks good. There remains \n> {{{\n> +        one = ring.base_ring()(1)\n> }}}\n> that maybe could use `.one()` ?\n\nI saw that and I was a little hesitant about changing it as I couldn't remember if we could create polynomials with coefficients in Python types, such as `int`. However, from looking at it a bit more, it seems like this cannot happen, so I will change it.",
    "created_at": "2020-05-17T06:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416337",
    "user": "tscrim"
}
```

Replying to [comment:5 chapoton]:
> Looks good. There remains 
> {{{
> +        one = ring.base_ring()(1)
> }}}
> that maybe could use `.one()` ?

I saw that and I was a little hesitant about changing it as I couldn't remember if we could create polynomials with coefficients in Python types, such as `int`. However, from looking at it a bit more, it seems like this cannot happen, so I will change it.



---

archive/issue_comments_416338.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-18T01:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416338",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-18T01:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416339",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416340.json:
```json
{
    "body": "Done with some little bit of other cleanup/micro-optimizations.",
    "created_at": "2020-05-18T01:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416340",
    "user": "tscrim"
}
```

Done with some little bit of other cleanup/micro-optimizations.



---

archive/issue_comments_416341.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-18T07:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416341",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_416342.json:
```json
{
    "body": "ok, looks good. Nice improvement",
    "created_at": "2020-05-18T07:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416342",
    "user": "chapoton"
}
```

ok, looks good. Nice improvement



---

archive/issue_comments_416343.json:
```json
{
    "body": "Replying to [comment:11 chapoton]:\n> ok, looks good. Nice improvement\n\nThank you.",
    "created_at": "2020-05-19T00:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416343",
    "user": "tscrim"
}
```

Replying to [comment:11 chapoton]:
> ok, looks good. Nice improvement

Thank you.



---

archive/issue_comments_416344.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-05-21T17:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416344",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_416345.json:
```json
{
    "body": "merge conflict",
    "created_at": "2020-05-21T17:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416345",
    "user": "vbraun"
}
```

merge conflict



---

archive/issue_comments_416346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-29T01:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416346",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416347.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-05-29T01:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416347",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_416348.json:
```json
{
    "body": "Trivial rebase.",
    "created_at": "2020-05-29T01:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416348",
    "user": "tscrim"
}
```

Trivial rebase.



---

archive/issue_comments_416349.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-31T08:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29358#issuecomment-416349",
    "user": "vbraun"
}
```

Resolution: fixed
