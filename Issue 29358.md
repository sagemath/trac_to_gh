# Issue 29358: Improve iteration of multivariate polynomials

Issue created by migration from https://trac.sagemath.org/ticket/29595

Original creator: tscrim

Original creation time: 2020-04-27 03:15:29

CC:  @mwageringel chapoton

Keywords: multivariate polynomial iteration

We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).


---

Comment by tscrim created at 2020-05-16 05:40:09

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-05-16 05:40:09

Changing component from algebra to performance.


---

Comment by tscrim created at 2020-05-16 05:40:09

Okay, I might have gone a bit overboard at the end. However, some of these little methods get some major speedups. There might be some other places to optimize. Definitely converting the generic multivariate polynomials to Cython will help and/or pushing more stuff to the polydict backend.

I was actually expecting a bit more of a speedup from the libsingular iterator, but I guess that just goes to show the speed of the builtin Python iterators. However, it still gets about a ~10% speedup, which is nice, beyond the memory savings.
----
New commits:


---

Comment by chapoton created at 2020-05-16 07:02:23

one failing doctest

```
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 3186, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__iter__
Failed example:
    list(R.zero())
Expected nothing
Got:
    []
```



---

Comment by git created at 2020-05-16 07:31:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-05-16 07:31:22

Whoops; fixed.


---

Comment by chapoton created at 2020-05-17 06:09:25

Looks good. There remains 

```
+        one = ring.base_ring()(1)
```

that maybe could use `.one()` ?


---

Comment by tscrim created at 2020-05-17 06:30:10

Replying to [comment:5 chapoton]:
> Looks good. There remains 
> {{{
> +        one = ring.base_ring()(1)
> }}}
> that maybe could use `.one()` ?

I saw that and I was a little hesitant about changing it as I couldn't remember if we could create polynomials with coefficients in Python types, such as `int`. However, from looking at it a bit more, it seems like this cannot happen, so I will change it.


---

Comment by git created at 2020-05-18 01:23:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-18 01:26:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-05-18 01:26:52

Done with some little bit of other cleanup/micro-optimizations.


---

Comment by chapoton created at 2020-05-18 07:50:11

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-05-18 07:50:11

ok, looks good. Nice improvement


---

Comment by tscrim created at 2020-05-19 00:44:44

Replying to [comment:11 chapoton]:
> ok, looks good. Nice improvement

Thank you.


---

Comment by vbraun created at 2020-05-21 17:55:41

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-05-21 17:55:41

merge conflict


---

Comment by git created at 2020-05-29 01:08:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-05-29 01:08:54

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2020-05-29 01:08:54

Trivial rebase.


---

Comment by vbraun created at 2020-05-31 08:49:07

Resolution: fixed
