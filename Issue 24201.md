# Issue 24201: Finite Family: sort dictionary keys in repr

Issue created by migration from https://trac.sagemath.org/ticket/24438

Original creator: embray

Original creation time: 2017-12-28 09:42:21

Although the order of indices is not necessarily meaningful, it often makes for nicer, more human-meaningful output to sort them.  For example:


```
sage: A = Algebras(QQ).WithBasis().Filtered().example()
sage: grA = A.graded_algebra()
sage: grA.algebra_generators()
Finite family {'x': bar(U['x']), 'y': bar(U['y']), 'z': bar(U['z'])
```


instead of the more seemingly arbitrary


```
Finite family {'y': bar(U['y']), 'x': bar(U['x']), 'z': bar(U['z'])
```


which of course is itself a result that is not in any way guaranteed.

In addition to being more user-friendly, this change will also help a lot with tests that otherwise fail on Python 3 due to arbitrary differences in dict key ordering.


---

Comment by git created at 2017-12-28 09:44:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-12-28 09:45:37

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-04-26 23:53:23

I had meant to respond to this earlier, but it fell off my radar.

I think that `FiniteFamily` should print out following `self._keys` if that is not `None` (which also dictates iteration order) and then fallback to the sorted output (see the `values` method).


---

Comment by embray created at 2018-04-28 17:02:38

I see, that makes sense.


---

Comment by embray created at 2018-04-28 17:02:38

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-05-15 14:30:29

Ah, I _knew_ I already did this, and forgot it still needed work :)
I was just about to do it again...


---

Comment by git created at 2018-05-15 16:41:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-05-15 16:41:47

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-05-15 16:42:51

Hold on, just realized this is actually wrong


---

Comment by embray created at 2018-05-15 16:42:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-05-15 17:06:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-05-15 17:06:37

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-05-15 23:00:07

What if the keys are not sortable, say `'a'` and `1` (in Python3)? I think the sorting order needs to be in a try-except block and just default to some ordering if `sorted` fails.


---

Comment by tscrim created at 2018-05-16 01:06:30

I think this will fail with your branch:

```
sage: sorted([complex(1), complex(2)])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-7-6dddb83c526f> in <module>()
----> 1 sorted([complex(Integer(1)), complex(Integer(2))])

TypeError: no ordering relation is defined for complex numbers
sage: L = [complex(1), complex(2)]
sage: Family(L, lambda x: x)
Finite family {(1+0j): (1+0j), (2+0j): (2+0j)}
```

(I am at the airport waiting for a flight and my laptop only have 8.3.beta0, so I cannot test it right now.)


---

Comment by embray created at 2018-05-16 09:28:06

True--I didn't see any cases in the tests where that was a problem but that could certainly happen I guess. On Python 3 `pprint` uses a "safe key" wrapper for the keys which falls back to Python 2-style ordering for unorderable types.  

I mentioned in my commit message that we might want to add something like this to Sage--I've definitely been finding other places in Sage where one would like to at least order things as best possible.  Maybe I'll go ahead and do that first...


---

Comment by embray created at 2018-05-16 09:28:06

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-06-27 17:21:22

Still planning to work on fixing this up.  I'm running into issues with these again :)


---

Comment by embray created at 2018-07-18 11:47:03

I believe this issue can reasonably be addressed for Sage 8.4.


---

Comment by tscrim created at 2018-08-23 02:46:29

Any progress?


---

Comment by chapoton created at 2018-09-11 08:26:02

ticket was duplicated in #26225...


---

Comment by chapoton created at 2018-09-11 14:23:40

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-09-11 14:23:40

let us close this one as duplicate


---

Comment by embray created at 2018-09-11 14:24:58

Ok.


---

Comment by embray created at 2018-09-11 14:24:58

Resolution: duplicate
