# Issue 28867: Add to tox.ini a homebrew toxenv (with a fresh install not in /usr/local)

archive/issues_028867.json:
```json
{
    "body": "CC:  dimpase jhpalmieri @mwageringel vbraun tscrim\n\n#29053 adds `tox.ini` to support testing the sage distribution in isolated environments via docker.\n\nThis ticket adds a toxenv for testing with an isolated installation of homebrew on macOS (not using docker).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29104\n\n",
    "created_at": "2020-01-29T15:48:19Z",
    "labels": [
        "porting",
        "major",
        "enhancement"
    ],
    "title": "Add to tox.ini a homebrew toxenv (with a fresh install not in /usr/local)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28867",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri @mwageringel vbraun tscrim

#29053 adds `tox.ini` to support testing the sage distribution in isolated environments via docker.

This ticket adds a toxenv for testing with an isolated installation of homebrew on macOS (not using docker).

Issue created by migration from https://trac.sagemath.org/ticket/29104





---

archive/issue_comments_408335.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-01-29T19:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408335",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_408336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-29T20:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408336",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408337.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-29T20:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408337",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408338.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-29T21:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408338",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-30T04:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408339",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408340.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-30T04:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408340",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408341.json:
```json
{
    "body": "Is this ticket MacOS-specific?",
    "created_at": "2020-02-05T17:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408341",
    "user": "dimpase"
}
```

Is this ticket MacOS-specific?



---

archive/issue_comments_408342.json:
```json
{
    "body": "Hmm, I haven\u2019t tried linuxbrew. Might be worth checking",
    "created_at": "2020-02-05T18:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408342",
    "user": "mkoeppe"
}
```

Hmm, I haven’t tried linuxbrew. Might be worth checking



---

archive/issue_comments_408343.json:
```json
{
    "body": "I'll fire up my vintage OSX 10.13 macbookair...",
    "created_at": "2020-02-05T18:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408343",
    "user": "dimpase"
}
```

I'll fire up my vintage OSX 10.13 macbookair...



---

archive/issue_comments_408344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-06T14:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408344",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408345.json:
```json
{
    "body": "I tried this:\n\n```\ntox -p auto -e local-homebrew-macos-standard\n```\n\nand got\n\n```\n...\n[sagelib-9.1.beta2] user\t0m10.244s\n[sagelib-9.1.beta2] sys\t0m3.812s\n\nreal\t0m16.288s\nuser\t0m10.956s\nsys\t0m4.047s\nSage build/upgrade complete!\n\u2714 OK local-homebrew-macos-standard in 1 minute, 14.362 seconds\n_________________________________________________________________________________________________ summary __________________________________________________________________________________________________\n  local-homebrew-macos-standard: commands succeeded\n  congratulations :)\n```\n\n\nnot tests were run, it seems, is this normal?",
    "created_at": "2020-02-07T21:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408345",
    "user": "dimpase"
}
```

I tried this:

```
tox -p auto -e local-homebrew-macos-standard
```

and got

```
...
[sagelib-9.1.beta2] user	0m10.244s
[sagelib-9.1.beta2] sys	0m3.812s

real	0m16.288s
user	0m10.956s
sys	0m4.047s
Sage build/upgrade complete!
✔ OK local-homebrew-macos-standard in 1 minute, 14.362 seconds
_________________________________________________________________________________________________ summary __________________________________________________________________________________________________
  local-homebrew-macos-standard: commands succeeded
  congratulations :)
```


not tests were run, it seems, is this normal?



---

archive/issue_comments_408346.json:
```json
{
    "body": "The default packages set in `tox.ini` are only `fflas_ffpack scipy r`, and those (and their dependencies) are checked.\nI don't know why it's actually building sagelib, but I hope to fix bizarre build behavior like this in #29113.",
    "created_at": "2020-02-08T22:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408346",
    "user": "mkoeppe"
}
```

The default packages set in `tox.ini` are only `fflas_ffpack scipy r`, and those (and their dependencies) are checked.
I don't know why it's actually building sagelib, but I hope to fix bizarre build behavior like this in #29113.



---

archive/issue_comments_408347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-16T20:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408347",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408348.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-04T00:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408348",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_408349.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-08T20:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408349",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408350.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-08T20:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408350",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_408351.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-08T21:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408351",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408352.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-03-11T19:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408352",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_408353.json:
```json
{
    "body": "- mpc should be `libmpc`\n- `tachyon` does not seem to be the package we use\n- `pari` cannot currently be used by Sage because the pari packages are not in Homebrew\n- `glpk` 4.65 should not be used by Sage as long as it is not patched by Homebrew, see #24824\n\nI also have these Homebrew packages installed:\n\n```\ncmake freetype gcc git libpng pcre pkg-config openssl xz zeromq\n```\n\nSome of these might already be installed automatically as dependencies of others.\n\nAdditionally there are:\n\n```\nsagemath/science/flint sagemath/science/arb\n```\n\nThough, I am not sure about how `flint` in homebrew-core is different from this one.",
    "created_at": "2020-03-11T20:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408353",
    "user": "@mwageringel"
}
```

- mpc should be `libmpc`
- `tachyon` does not seem to be the package we use
- `pari` cannot currently be used by Sage because the pari packages are not in Homebrew
- `glpk` 4.65 should not be used by Sage as long as it is not patched by Homebrew, see #24824

I also have these Homebrew packages installed:

```
cmake freetype gcc git libpng pcre pkg-config openssl xz zeromq
```

Some of these might already be installed automatically as dependencies of others.

Additionally there are:

```
sagemath/science/flint sagemath/science/arb
```

Though, I am not sure about how `flint` in homebrew-core is different from this one.



---

archive/issue_comments_408354.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T20:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408354",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T20:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408355",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408356.json:
```json
{
    "body": "https://github.com/sagemath/homebrew-science/commits/master\n\nadds NTL support for flint, and also ensbles TLS.\n\nwe can cook up more of these formulae, theain obstacle for me there was that they ate in Ruby.\n----\nNew commits:",
    "created_at": "2020-03-11T20:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408356",
    "user": "dimpase"
}
```

https://github.com/sagemath/homebrew-science/commits/master

adds NTL support for flint, and also ensbles TLS.

we can cook up more of these formulae, theain obstacle for me there was that they ate in Ruby.
----
New commits:



---

archive/issue_comments_408357.json:
```json
{
    "body": "\n```\n==> Installing sagemath/science/arb\n==> Downloading https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz\n##O=#  #                                                                      \ncurl: (22) The requested URL returned error: 404 Not Found\nError: Failed to download resource \"arb\"\nDownload failed: https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz\nWarning: Bottle installation failed: building from source.\n==> Downloading https://github.com/fredrik-johansson/arb/archive/2.16.0.tar.gz\n==> Downloading from https://codeload.github.com/fredrik-johansson/arb/tar.gz/2.16.0\n######################################################################## 100.0%\n```\n",
    "created_at": "2020-03-11T21:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408357",
    "user": "mkoeppe"
}
```


```
==> Installing sagemath/science/arb
==> Downloading https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz
##O=#  #                                                                      
curl: (22) The requested URL returned error: 404 Not Found
Error: Failed to download resource "arb"
Download failed: https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz
Warning: Bottle installation failed: building from source.
==> Downloading https://github.com/fredrik-johansson/arb/archive/2.16.0.tar.gz
==> Downloading from https://codeload.github.com/fredrik-johansson/arb/tar.gz/2.16.0
######################################################################## 100.0%
```




---

archive/issue_comments_408358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T21:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408358",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408359.json:
```json
{
    "body": "Replying to [comment:30 mkoeppe]:\n> {{{\n> ==> Installing sagemath/science/arb\n> ==> Downloading https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz\n> ##O=#  #                                                                      \n> curl: (22) The requested URL returned error: 404 Not Found\n> Error: Failed to download resource \"arb\"\n> Download failed: https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz\n> Warning: Bottle installation failed: building from source.\n> ==> Downloading https://github.com/fredrik-johansson/arb/archive/2.16.0.tar.gz\n> ==> Downloading from https://codeload.github.com/fredrik-johansson/arb/tar.gz/2.16.0\n> ######################################################################## 100.0%\n> }}}\nyes, this is expected. No binaries.",
    "created_at": "2020-03-11T21:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408359",
    "user": "dimpase"
}
```

Replying to [comment:30 mkoeppe]:
> {{{
> ==> Installing sagemath/science/arb
> ==> Downloading https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz
> ##O=#  #                                                                      
> curl: (22) The requested URL returned error: 404 Not Found
> Error: Failed to download resource "arb"
> Download failed: https://homebrew.bintray.com/bottles-science/arb-2.16.0.sierra.bottle.tar.gz
> Warning: Bottle installation failed: building from source.
> ==> Downloading https://github.com/fredrik-johansson/arb/archive/2.16.0.tar.gz
> ==> Downloading from https://codeload.github.com/fredrik-johansson/arb/tar.gz/2.16.0
> ######################################################################## 100.0%
> }}}
yes, this is expected. No binaries.



---

archive/issue_comments_408360.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T21:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408360",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T21:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408361",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408362.json:
```json
{
    "body": "\n```\nChecking whether SageMath should install SPKG openblas...\nchecking BLAS library... openblas\nchecking whether any of gfortran is installed or will be installed as SPKG... no\nchecking for openblas >= 0.2.20... yes\nchecking for library containing cblas_dgemm... no\nchecking for cblas... no\nchecking for library containing ... no\nchecking for lapack... no\nconfigure: no suitable system package found for SPKG openblas\n```\n\nThe tests for `cblas_dgemm` etc. do not seem to use `OPENBLAS_LIBS` at all!",
    "created_at": "2020-03-11T22:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408362",
    "user": "mkoeppe"
}
```


```
Checking whether SageMath should install SPKG openblas...
checking BLAS library... openblas
checking whether any of gfortran is installed or will be installed as SPKG... no
checking for openblas >= 0.2.20... yes
checking for library containing cblas_dgemm... no
checking for cblas... no
checking for library containing ... no
checking for lapack... no
configure: no suitable system package found for SPKG openblas
```

The tests for `cblas_dgemm` etc. do not seem to use `OPENBLAS_LIBS` at all!



---

archive/issue_comments_408363.json:
```json
{
    "body": "Replying to [comment:29 dimpase]:\n> https://github.com/sagemath/homebrew-science/commits/master\n> \n> adds NTL support for flint, and also ensbles TLS.\n> \n> we can cook up more of these formulae, theain obstacle for me there was that they ate in Ruby.\n\nThere seems to be a conflict between `flint` and `sagemath/science/flint`, as `sagemath/science/arb` installs `flint` from homebrew-core as a dependency (which has been added to Homebrew very recently). I am using\n\n```\nbrew install sagemath/science/flint\nbrew install --ignore-dependencies sagemath/science/arb\n```\n\nas a workaround now, but the arb formula probably needs to be updated.",
    "created_at": "2020-03-11T22:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408363",
    "user": "@mwageringel"
}
```

Replying to [comment:29 dimpase]:
> https://github.com/sagemath/homebrew-science/commits/master
> 
> adds NTL support for flint, and also ensbles TLS.
> 
> we can cook up more of these formulae, theain obstacle for me there was that they ate in Ruby.

There seems to be a conflict between `flint` and `sagemath/science/flint`, as `sagemath/science/arb` installs `flint` from homebrew-core as a dependency (which has been added to Homebrew very recently). I am using

```
brew install sagemath/science/flint
brew install --ignore-dependencies sagemath/science/arb
```

as a workaround now, but the arb formula probably needs to be updated.



---

archive/issue_comments_408364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T23:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408364",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408365.json:
```json
{
    "body": "This line (introduced in #29071):\n\n```\n        AC_FC_FREEFORM([AC_FC_FUNC([dgeqrf])])\n```\n\nis not executed at all because `AC_FC_FREEFORM` is `AC_DEFUN_ONCE` and is called already in `gfortran/spkg-configure.m4`\n\nAs a result:\n\n```\nChecking whether SageMath should install SPKG openblas...\nchecking BLAS library... openblas\nchecking whether any of gfortran is installed or will be installed as SPKG... no\nchecking for openblas >= 0.2.20... yes\nchecking for cblas_dgemm... yes\nchecking for ... no\nchecking for lapack... no\nconfigure: no suitable system package found for SPKG openblas\n```\n",
    "created_at": "2020-03-11T23:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408365",
    "user": "mkoeppe"
}
```

This line (introduced in #29071):

```
        AC_FC_FREEFORM([AC_FC_FUNC([dgeqrf])])
```

is not executed at all because `AC_FC_FREEFORM` is `AC_DEFUN_ONCE` and is called already in `gfortran/spkg-configure.m4`

As a result:

```
Checking whether SageMath should install SPKG openblas...
checking BLAS library... openblas
checking whether any of gfortran is installed or will be installed as SPKG... no
checking for openblas >= 0.2.20... yes
checking for cblas_dgemm... yes
checking for ... no
checking for lapack... no
configure: no suitable system package found for SPKG openblas
```




---

archive/issue_comments_408366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-11T23:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408366",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408367.json:
```json
{
    "body": "Not accepted by configure yet: `glpk`, `r`",
    "created_at": "2020-03-11T23:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408367",
    "user": "mkoeppe"
}
```

Not accepted by configure yet: `glpk`, `r`



---

archive/issue_comments_408368.json:
```json
{
    "body": "(resolved)",
    "created_at": "2020-03-11T23:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408368",
    "user": "mkoeppe"
}
```

(resolved)



---

archive/issue_comments_408369.json:
```json
{
    "body": "Replying to [comment:39 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[52ef59e](https://git.sagemath.org/sage.git/commit/?id=52ef59ed13d878e1a0de0bec999a9d23a442ca6f)||`build/pkgs/openblas/spkg-configure.m4: Do not use AC_FC_FUNC.`||\n\nwhy? If `AC_FC_FREEFORM` can only be called once, we can move\nthe call to `AC_FC_FUNC` to the very place it's called.\nHow about\n\n```diff\n--- a/build/pkgs/gfortran/spkg-configure.m4\n+++ b/build/pkgs/gfortran/spkg-configure.m4\n@@ -6,7 +6,10 @@ SAGE_SPKG_CONFIGURE([gfortran], [\n     # This helps verify the compiler works too, so if some idiot sets FC to\n     # /usr/bin/ls, we will at least know it's not a working Fortran\n     # compiler.\n-    AC_FC_FREEFORM([SAGE_HAVE_FC_FREEFORM=yes], [\n+    AC_FC_FREEFORM([\n+        SAGE_HAVE_FC_FREEFORM=yes\n+        AC_FC_FUNC([dgeqrf])\n+       ], [\n        AC_MSG_NOTICE([Your Fortran compiler does not accept free-format source code])\n         AC_MSG_NOTICE([which means the compiler is either seriously broken, or])\n         AC_MSG_NOTICE([is too old to build Sage.])\ndiff --git a/build/pkgs/openblas/spkg-configure.m4 b/build/pkgs/openblas/spkg-configure.m4\nindex c37db649be..ecc7540ee9 100644\n--- a/build/pkgs/openblas/spkg-configure.m4\n+++ b/build/pkgs/openblas/spkg-configure.m4\n@@ -9,7 +9,6 @@ SAGE_SPKG_CONFIGURE([openblas], [\n              dnl openblas does not work as cblas; try to use system's cblas as is\n              PKG_CHECK_MODULES([CBLAS], [cblas], [], [sage_spkg_install_openblas=yes])\n           ])\n-       AC_FC_FREEFORM([AC_FC_FUNC([dgeqrf])])\n        AC_SEARCH_LIBS([$dgeqrf], [openblas], [dnl openblas works as lapack\n              sage_install_lapack_pc=yes\n              ], [\n```\n",
    "created_at": "2020-03-11T23:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408369",
    "user": "dimpase"
}
```

Replying to [comment:39 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[52ef59e](https://git.sagemath.org/sage.git/commit/?id=52ef59ed13d878e1a0de0bec999a9d23a442ca6f)||`build/pkgs/openblas/spkg-configure.m4: Do not use AC_FC_FUNC.`||

why? If `AC_FC_FREEFORM` can only be called once, we can move
the call to `AC_FC_FUNC` to the very place it's called.
How about

```diff
--- a/build/pkgs/gfortran/spkg-configure.m4
+++ b/build/pkgs/gfortran/spkg-configure.m4
@@ -6,7 +6,10 @@ SAGE_SPKG_CONFIGURE([gfortran], [
     # This helps verify the compiler works too, so if some idiot sets FC to
     # /usr/bin/ls, we will at least know it's not a working Fortran
     # compiler.
-    AC_FC_FREEFORM([SAGE_HAVE_FC_FREEFORM=yes], [
+    AC_FC_FREEFORM([
+        SAGE_HAVE_FC_FREEFORM=yes
+        AC_FC_FUNC([dgeqrf])
+       ], [
        AC_MSG_NOTICE([Your Fortran compiler does not accept free-format source code])
         AC_MSG_NOTICE([which means the compiler is either seriously broken, or])
         AC_MSG_NOTICE([is too old to build Sage.])
diff --git a/build/pkgs/openblas/spkg-configure.m4 b/build/pkgs/openblas/spkg-configure.m4
index c37db649be..ecc7540ee9 100644
--- a/build/pkgs/openblas/spkg-configure.m4
+++ b/build/pkgs/openblas/spkg-configure.m4
@@ -9,7 +9,6 @@ SAGE_SPKG_CONFIGURE([openblas], [
              dnl openblas does not work as cblas; try to use system's cblas as is
              PKG_CHECK_MODULES([CBLAS], [cblas], [], [sage_spkg_install_openblas=yes])
           ])
-       AC_FC_FREEFORM([AC_FC_FUNC([dgeqrf])])
        AC_SEARCH_LIBS([$dgeqrf], [openblas], [dnl openblas works as lapack
              sage_install_lapack_pc=yes
              ], [
```




---

archive/issue_comments_408370.json:
```json
{
    "body": "OK... let me try",
    "created_at": "2020-03-12T00:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408370",
    "user": "mkoeppe"
}
```

OK... let me try



---

archive/issue_comments_408371.json:
```json
{
    "body": "Replying to [comment:43 mkoeppe]:\n> OK... let me try\n\nit appears to work with gfortan etc installed:\n\n```\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG openblas...\nchecking BLAS library... openblas\nchecking whether any of gfortran is installed or will be installed as SPKG... no\nchecking for OPENBLAS... yes\nchecking for library containing cblas_dgemm... -lopenblas\nchecking for library containing dgeqrf_... none required\nconfigure: will use system package and not install SPKG openblas\n```\n\n\nbut perhaps it would be throwing up a surprise if there wasn't any.",
    "created_at": "2020-03-12T00:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408371",
    "user": "dimpase"
}
```

Replying to [comment:43 mkoeppe]:
> OK... let me try

it appears to work with gfortan etc installed:

```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG openblas...
checking BLAS library... openblas
checking whether any of gfortran is installed or will be installed as SPKG... no
checking for OPENBLAS... yes
checking for library containing cblas_dgemm... -lopenblas
checking for library containing dgeqrf_... none required
configure: will use system package and not install SPKG openblas
```


but perhaps it would be throwing up a surprise if there wasn't any.



---

archive/issue_comments_408372.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T00:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408372",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T00:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408373",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408374.json:
```json
{
    "body": "matplotlib install fails:\n\n```\n    REQUIRED DEPENDENCIES AND EXTENSIONS\n                     numpy: yes [not found. pip may install it below.]\n          install_requires: yes [handled by setuptools]\n                    libagg: yes [pkg-config information for 'libagg' could not\n                            be found. Using local copy.]\n                  freetype: yes [version 2.10.1]\n                       png: no  [The C/C++ header for libpng (png.h) could not\n                            be found.  You may need to install the development\n                            package.]\n                     qhull: yes [pkg-config information for 'libqhull' could not\n                            be found. Using local copy.]\n...\n                            * The following required packages can not be built:\n                            * png\n                            * Try installing png with `brew install libpng` and\n                            * pkg-config with `brew install pkg-config`\nCleaning up...\n\n  }}}",
    "created_at": "2020-03-12T00:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408374",
    "user": "mkoeppe"
}
```

matplotlib install fails:

```
    REQUIRED DEPENDENCIES AND EXTENSIONS
                     numpy: yes [not found. pip may install it below.]
          install_requires: yes [handled by setuptools]
                    libagg: yes [pkg-config information for 'libagg' could not
                            be found. Using local copy.]
                  freetype: yes [version 2.10.1]
                       png: no  [The C/C++ header for libpng (png.h) could not
                            be found.  You may need to install the development
                            package.]
                     qhull: yes [pkg-config information for 'libqhull' could not
                            be found. Using local copy.]
...
                            * The following required packages can not be built:
                            * png
                            * Try installing png with `brew install libpng` and
                            * pkg-config with `brew install pkg-config`
Cleaning up...

  }}}



---

archive/issue_comments_408375.json:
```json
{
    "body": "cysignals testsuite fails:\n\n```\n  [cysignals-1.10.2]   ulimit 2>/dev/null -s 1024; sage-python23 -B rundoctests.py src/cysignals/*.pyx\n  [cysignals-1.10.2]   Doctesting 5 files.\n  [cysignals-1.10.2]   Traceback (most recent call last):\n  [cysignals-1.10.2]     File \"rundoctests.py\", line 74, in <module>\n  [cysignals-1.10.2]       resource.setrlimit(resource.RLIMIT_STACK, (stacksize, stacksize))\n  [cysignals-1.10.2]   ValueError: current limit exceeds maximum limit\n  [cysignals-1.10.2]   make[4]: *** [check-doctest] Error 1\n  [cysignals-1.10.2]   cd example && sage-python23 setup.py clean build\n }}}",
    "created_at": "2020-03-12T00:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408375",
    "user": "mkoeppe"
}
```

cysignals testsuite fails:

```
  [cysignals-1.10.2]   ulimit 2>/dev/null -s 1024; sage-python23 -B rundoctests.py src/cysignals/*.pyx
  [cysignals-1.10.2]   Doctesting 5 files.
  [cysignals-1.10.2]   Traceback (most recent call last):
  [cysignals-1.10.2]     File "rundoctests.py", line 74, in <module>
  [cysignals-1.10.2]       resource.setrlimit(resource.RLIMIT_STACK, (stacksize, stacksize))
  [cysignals-1.10.2]   ValueError: current limit exceeds maximum limit
  [cysignals-1.10.2]   make[4]: *** [check-doctest] Error 1
  [cysignals-1.10.2]   cd example && sage-python23 setup.py clean build
 }}}



---

archive/issue_comments_408376.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T02:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408376",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408377.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T02:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408377",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408378.json:
```json
{
    "body": "Ready for review.",
    "created_at": "2020-03-12T02:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408378",
    "user": "mkoeppe"
}
```

Ready for review.



---

archive/issue_comments_408379.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-12T03:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408379",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_408380.json:
```json
{
    "body": "The AC_FC_FUNC business broke all `-minimal` targets\n(https://github.com/mkoeppe/sage/actions/runs/54084841)",
    "created_at": "2020-03-12T03:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408380",
    "user": "mkoeppe"
}
```

The AC_FC_FUNC business broke all `-minimal` targets
(https://github.com/mkoeppe/sage/actions/runs/54084841)



---

archive/issue_comments_408381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-12T03:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408381",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408382.json:
```json
{
    "body": "New tests at https://github.com/mkoeppe/sage/actions/runs/54093138",
    "created_at": "2020-03-12T03:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408382",
    "user": "mkoeppe"
}
```

New tests at https://github.com/mkoeppe/sage/actions/runs/54093138



---

archive/issue_comments_408383.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-12T03:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408383",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_408384.json:
```json
{
    "body": "Needs review",
    "created_at": "2020-03-12T16:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408384",
    "user": "mkoeppe"
}
```

Needs review



---

archive/issue_comments_408385.json:
```json
{
    "body": "Both `homebrew-macos-minimal` (logs: https://github.com/mkoeppe/sage/suites/515691370/artifacts/2830410) and `homebrew-macos-standard` (logs: https://github.com/mkoeppe/sage/suites/515691370/artifacts/2830411)  now build correctly all the way to `sagelib`.",
    "created_at": "2020-03-13T21:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408385",
    "user": "mkoeppe"
}
```

Both `homebrew-macos-minimal` (logs: https://github.com/mkoeppe/sage/suites/515691370/artifacts/2830410) and `homebrew-macos-standard` (logs: https://github.com/mkoeppe/sage/suites/515691370/artifacts/2830411)  now build correctly all the way to `sagelib`.



---

archive/issue_comments_408386.json:
```json
{
    "body": "Some doctest failures similar to this:\n\n```\nFile \"src/sage/structure/element.pyx\", line 3945, in sage.structure.element.EuclideanDomainElement._mod_\nFailed example:\n    cython('''\n    from sage.structure.element cimport EuclideanDomainElement\n    cdef class MyElt(EuclideanDomainElement):\n        def quo_rem(self, other):\n            return self._parent.var('quo,rem')\n    ''')\nExpected nothing\nGot:\n    ld: warning: directory not found for option '-L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-minimal/homebrew/opt/readline/lib'\n```\n",
    "created_at": "2020-03-13T23:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408386",
    "user": "mkoeppe"
}
```

Some doctest failures similar to this:

```
File "src/sage/structure/element.pyx", line 3945, in sage.structure.element.EuclideanDomainElement._mod_
Failed example:
    cython('''
    from sage.structure.element cimport EuclideanDomainElement
    cdef class MyElt(EuclideanDomainElement):
        def quo_rem(self, other):
            return self._parent.var('quo,rem')
    ''')
Expected nothing
Got:
    ld: warning: directory not found for option '-L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-minimal/homebrew/opt/readline/lib'
```




---

archive/issue_comments_408387.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-14T20:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408387",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408388.json:
```json
{
    "body": "Replying to [comment:59 mkoeppe]:\n> Some doctest failures similar to this: [...readline...]\nThese are now fixed. Very few remaining doctest failures and timeouts for `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/508217498):\n\n```\nsage -t src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out\nsage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out\nsage -t src/sage/plot/plot3d/base.pyx  # Timed out\nsage -t src/sage/plot/plot3d/implicit_plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/parametric_plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/shapes.pyx  # Timed out\nsage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed\nsage -t src/sage/plot/plot3d/shapes2.py  # Timed out\nsage -t src/sage/rings/function_field/function_field.py  # Timed out\nsage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\n```\n\n\n`homebrew-macos-standard` (https://github.com/mkoeppe/sage/runs/508217500) has many more doctest failures.\nLooks like there is some problem with singular.\nSome messages from singular:   `univariate factorization depends on NTL(missing)`\n\nIn that build, Sage is using the homebrew NTL:\n\n```\nChecking whether SageMath should install SPKG ntl...\nchecking installing gmp/mpir? ... no\nchecking NTL/ZZ.h usability... yes\nchecking NTL/ZZ.h presence... yes\nchecking for NTL/ZZ.h... yes\nchecking whether we can link a program using NTL... yes\nchecking NTL version >= 10.3... 11.4.3\nconfigure: will use system package and not install SPKG ntl\nusing ntl library from the system\n```\n\n... but Singular does not find it ....\n\n```\nchecking for NTL >= 5.0... not found\nconfigure: WARNING: Unable to find NTL (which is strongly recommended) on your machine: please use --with-ntl=PATH_TO_DIR_CONTAINING_LIB_AND_INCLUDE (see also ./configure --help if you do not understand what we are talking about)\n```\n",
    "created_at": "2020-03-15T03:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408388",
    "user": "mkoeppe"
}
```

Replying to [comment:59 mkoeppe]:
> Some doctest failures similar to this: [...readline...]
These are now fixed. Very few remaining doctest failures and timeouts for `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/508217498):

```
sage -t src/sage/interfaces/gap.py  # 1 doctest failed
sage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out
sage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out
sage -t src/sage/plot/plot3d/base.pyx  # Timed out
sage -t src/sage/plot/plot3d/implicit_plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/parametric_plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/shapes.pyx  # Timed out
sage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
sage -t src/sage/plot/plot3d/shapes2.py  # Timed out
sage -t src/sage/rings/function_field/function_field.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
```


`homebrew-macos-standard` (https://github.com/mkoeppe/sage/runs/508217500) has many more doctest failures.
Looks like there is some problem with singular.
Some messages from singular:   `univariate factorization depends on NTL(missing)`

In that build, Sage is using the homebrew NTL:

```
Checking whether SageMath should install SPKG ntl...
checking installing gmp/mpir? ... no
checking NTL/ZZ.h usability... yes
checking NTL/ZZ.h presence... yes
checking for NTL/ZZ.h... yes
checking whether we can link a program using NTL... yes
checking NTL version >= 10.3... 11.4.3
configure: will use system package and not install SPKG ntl
using ntl library from the system
```

... but Singular does not find it ....

```
checking for NTL >= 5.0... not found
configure: WARNING: Unable to find NTL (which is strongly recommended) on your machine: please use --with-ntl=PATH_TO_DIR_CONTAINING_LIB_AND_INCLUDE (see also ./configure --help if you do not understand what we are talking about)
```




---

archive/issue_comments_408389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T04:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408390.json:
```json
{
    "body": "New tests at https://github.com/mkoeppe/sage/actions/runs/55944733",
    "created_at": "2020-03-15T05:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408390",
    "user": "mkoeppe"
}
```

New tests at https://github.com/mkoeppe/sage/actions/runs/55944733



---

archive/issue_comments_408391.json:
```json
{
    "body": "With #29335 merged, Singular finds homebrew's NTL but then I get the following linker error (https://github.com/mkoeppe/sage/runs/508693083):\n\n```\n  [singular-4.1.1p2.p0]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64\n  [singular-4.1.1p2.p0]   clang: error: linker command failed with exit code 1 (use -v to see invocation)\n  [singular-4.1.1p2.p0]   make[8]: *** [libSingular.la] Error 1\n```\n",
    "created_at": "2020-03-15T15:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408391",
    "user": "mkoeppe"
}
```

With #29335 merged, Singular finds homebrew's NTL but then I get the following linker error (https://github.com/mkoeppe/sage/runs/508693083):

```
  [singular-4.1.1p2.p0]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64
  [singular-4.1.1p2.p0]   clang: error: linker command failed with exit code 1 (use -v to see invocation)
  [singular-4.1.1p2.p0]   make[8]: *** [libSingular.la] Error 1
```




---

archive/issue_comments_408392.json:
```json
{
    "body": "this is about absence of coherence on TLS between Singular and Flint.",
    "created_at": "2020-03-15T15:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408392",
    "user": "dimpase"
}
```

this is about absence of coherence on TLS between Singular and Flint.



---

archive/issue_comments_408393.json:
```json
{
    "body": "Replying to [comment:66 dimpase]:\n> this is about absence of coherence on TLS between Singular and Flint.\nOK, is there a way to enable use of TLS with Singular?",
    "created_at": "2020-03-15T18:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408393",
    "user": "mkoeppe"
}
```

Replying to [comment:66 dimpase]:
> this is about absence of coherence on TLS between Singular and Flint.
OK, is there a way to enable use of TLS with Singular?



---

archive/issue_comments_408394.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T18:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408394",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408395.json:
```json
{
    "body": "Build logs for `homebrew-macos-standard` at https://github.com/mkoeppe/sage/runs/511533264",
    "created_at": "2020-03-16T19:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408395",
    "user": "mkoeppe"
}
```

Build logs for `homebrew-macos-standard` at https://github.com/mkoeppe/sage/runs/511533264



---

archive/issue_comments_408396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-16T19:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408396",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408397.json:
```json
{
    "body": "Replying to [comment:70 mkoeppe]:\n> Build logs for `homebrew-macos-standard` at https://github.com/mkoeppe/sage/runs/511533264\n\n```\n  [sagelib-9.1.beta7]   ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64\n  [sagelib-9.1.beta7]   clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n",
    "created_at": "2020-03-16T20:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408397",
    "user": "mkoeppe"
}
```

Replying to [comment:70 mkoeppe]:
> Build logs for `homebrew-macos-standard` at https://github.com/mkoeppe/sage/runs/511533264

```
  [sagelib-9.1.beta7]   ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64
  [sagelib-9.1.beta7]   clang: error: linker command failed with exit code 1 (use -v to see invocation)
```




---

archive/issue_comments_408398.json:
```json
{
    "body": "I guess this means that another library is picking up the system installation of NTL...",
    "created_at": "2020-03-16T20:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408398",
    "user": "mkoeppe"
}
```

I guess this means that another library is picking up the system installation of NTL...



---

archive/issue_comments_408399.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-16T20:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408399",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408400.json:
```json
{
    "body": "New test: https://github.com/mkoeppe/sage/runs/512132585",
    "created_at": "2020-03-16T20:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408400",
    "user": "mkoeppe"
}
```

New test: https://github.com/mkoeppe/sage/runs/512132585



---

archive/issue_comments_408401.json:
```json
{
    "body": "Replying to [comment:36 gh-mwageringel]:\n> There seems to be a conflict between `flint` and `sagemath/science/flint`, as `sagemath/science/arb` installs `flint` from homebrew-core as a dependency (which has been added to Homebrew very recently). I am using\n> {{{\n> brew install sagemath/science/flint\n> brew install --ignore-dependencies sagemath/science/arb\n> }}}\n> as a workaround now, but the arb formula probably needs to be updated.\n\nAs can be seen in the build logs above, `sagemath/science/arb` installs `flint` from homebrew-core as a dependency. Later, `sagemath/science/flint` is installed only because of `brew upgrade`. This only seems to work because of the coincidence that `sagemath/science/flint` has a higher version number than `flint`, currently. However, `sagemath/science/arb` is only compiled with `flint` (without ntl support) \u2013 it is not recompiled after installing `sagemath/science/flint`.\n\nI have opened a [pull request](https://github.com/sagemath/homebrew-science/pull/1) to resolve this.",
    "created_at": "2020-03-16T20:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408401",
    "user": "@mwageringel"
}
```

Replying to [comment:36 gh-mwageringel]:
> There seems to be a conflict between `flint` and `sagemath/science/flint`, as `sagemath/science/arb` installs `flint` from homebrew-core as a dependency (which has been added to Homebrew very recently). I am using
> {{{
> brew install sagemath/science/flint
> brew install --ignore-dependencies sagemath/science/arb
> }}}
> as a workaround now, but the arb formula probably needs to be updated.

As can be seen in the build logs above, `sagemath/science/arb` installs `flint` from homebrew-core as a dependency. Later, `sagemath/science/flint` is installed only because of `brew upgrade`. This only seems to work because of the coincidence that `sagemath/science/flint` has a higher version number than `flint`, currently. However, `sagemath/science/arb` is only compiled with `flint` (without ntl support) – it is not recompiled after installing `sagemath/science/flint`.

I have opened a [pull request](https://github.com/sagemath/homebrew-science/pull/1) to resolve this.



---

archive/issue_comments_408402.json:
```json
{
    "body": "Replying to [comment:75 mkoeppe]:\n> New test: https://github.com/mkoeppe/sage/runs/512132585\n\nIf you remove ntl, you probably also need to remove flint and arb, as they depend on it.",
    "created_at": "2020-03-16T20:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408402",
    "user": "@mwageringel"
}
```

Replying to [comment:75 mkoeppe]:
> New test: https://github.com/mkoeppe/sage/runs/512132585

If you remove ntl, you probably also need to remove flint and arb, as they depend on it.



---

archive/issue_comments_408403.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-16T21:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408403",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408404.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-03-16T21:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408404",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_408405.json:
```json
{
    "body": "New tests at https://github.com/mkoeppe/sage/runs/512243289",
    "created_at": "2020-03-16T21:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408405",
    "user": "mkoeppe"
}
```

New tests at https://github.com/mkoeppe/sage/runs/512243289



---

archive/issue_comments_408406.json:
```json
{
    "body": "I had no idea that a ticket about homebrew would be touching fedora-related stuff, and in this I essentially created a duplicate of that work on #29352\n\nIt's much better to create separate tickets for unrelated problems - not the least as it gives them a chance of being discovered.",
    "created_at": "2020-03-18T02:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408406",
    "user": "dimpase"
}
```

I had no idea that a ticket about homebrew would be touching fedora-related stuff, and in this I essentially created a duplicate of that work on #29352

It's much better to create separate tickets for unrelated problems - not the least as it gives them a chance of being discovered.



---

archive/issue_comments_408407.json:
```json
{
    "body": "OK. What can I do to facilitate review?",
    "created_at": "2020-03-18T02:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408407",
    "user": "mkoeppe"
}
```

OK. What can I do to facilitate review?



---

archive/issue_comments_408408.json:
```json
{
    "body": "I cannot review MacOS-related things - I don't have access to the needed OS.\nBut I would be happy to look at the other things that got silently bundled here.",
    "created_at": "2020-03-18T02:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408408",
    "user": "dimpase"
}
```

I cannot review MacOS-related things - I don't have access to the needed OS.
But I would be happy to look at the other things that got silently bundled here.



---

archive/issue_comments_408409.json:
```json
{
    "body": "OK, then let me move the fedora.txt files to #29352\nand the other linux .txt files to a new ticket.",
    "created_at": "2020-03-18T02:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408409",
    "user": "mkoeppe"
}
```

OK, then let me move the fedora.txt files to #29352
and the other linux .txt files to a new ticket.



---

archive/issue_comments_408410.json:
```json
{
    "body": "Replying to [comment:84 mkoeppe]:\n> OK, then let me move the fedora.txt files to #29352\n> and the other linux .txt files to a new ticket.\nActually, as noted on #29352, most of the files were added in #29273.",
    "created_at": "2020-03-18T16:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408410",
    "user": "mkoeppe"
}
```

Replying to [comment:84 mkoeppe]:
> OK, then let me move the fedora.txt files to #29352
> and the other linux .txt files to a new ticket.
Actually, as noted on #29352, most of the files were added in #29273.



---

archive/issue_comments_408411.json:
```json
{
    "body": "`@`gh-mwageringel Would you be able to review this ticket?",
    "created_at": "2020-03-18T16:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408411",
    "user": "mkoeppe"
}
```

`@`gh-mwageringel Would you be able to review this ticket?



---

archive/issue_comments_408412.json:
```json
{
    "body": "Replying to [comment:86 mkoeppe]:\n> `@`gh-mwageringel Would you be able to review this ticket?\nYes, I will look into that. Though, I only have access to macOS 10.13.6.",
    "created_at": "2020-03-18T17:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408412",
    "user": "@mwageringel"
}
```

Replying to [comment:86 mkoeppe]:
> `@`gh-mwageringel Would you be able to review this ticket?
Yes, I will look into that. Though, I only have access to macOS 10.13.6.



---

archive/issue_comments_408413.json:
```json
{
    "body": "Tests ran at https://github.com/mkoeppe/sage/actions/runs/57924835\n\n`local-homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/515508463) and `local-homebrew-macos-standard` (https://github.com/mkoeppe/sage/runs/515508474): \n\nAll packages (except for experimental package `polymake`) build, doctests:\n\n```\n----------------------------------------------------------------------\nsage -t src/sage/game_theory/normal_form_game.py  # 5 doctests failed\nsage -t src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out\nsage -t src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t src/sage/knots/link.py  # 1 doctest failed\nsage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out\nsage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out\nsage -t src/sage/plot/plot3d/base.pyx  # Timed out\nsage -t src/sage/plot/plot3d/implicit_plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/parametric_plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/plot3d.py  # Timed out\nsage -t src/sage/plot/plot3d/shapes.pyx  # Timed out\nsage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed\nsage -t src/sage/plot/plot3d/shapes2.py  # Timed out\nsage -t src/sage/rings/function_field/function_field.py  # Timed out\nsage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\n----------------------------------------------------------------------\n```\n",
    "created_at": "2020-03-18T17:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408413",
    "user": "mkoeppe"
}
```

Tests ran at https://github.com/mkoeppe/sage/actions/runs/57924835

`local-homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/515508463) and `local-homebrew-macos-standard` (https://github.com/mkoeppe/sage/runs/515508474): 

All packages (except for experimental package `polymake`) build, doctests:

```
----------------------------------------------------------------------
sage -t src/sage/game_theory/normal_form_game.py  # 5 doctests failed
sage -t src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out
sage -t src/sage/interfaces/gap.py  # 1 doctest failed
sage -t src/sage/knots/link.py  # 1 doctest failed
sage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out
sage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out
sage -t src/sage/plot/plot3d/base.pyx  # Timed out
sage -t src/sage/plot/plot3d/implicit_plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/parametric_plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/plot3d.py  # Timed out
sage -t src/sage/plot/plot3d/shapes.pyx  # Timed out
sage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
sage -t src/sage/plot/plot3d/shapes2.py  # Timed out
sage -t src/sage/rings/function_field/function_field.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
----------------------------------------------------------------------
```




---

archive/issue_comments_408414.json:
```json
{
    "body": "Replying to [comment:88 gh-mwageringel]:\n> Replying to [comment:86 mkoeppe]:\n> > `@`gh-mwageringel Would you be able to review this ticket?\n> Yes, I will look into that. \nThanks!\n\n> Though, I only have access to macOS 10.13.6.\nThat's actually great, for some broader coverage. I'm testing on 10.15.3, and also the [GitHub](GitHub) runners are on Catalina.",
    "created_at": "2020-03-18T17:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408414",
    "user": "mkoeppe"
}
```

Replying to [comment:88 gh-mwageringel]:
> Replying to [comment:86 mkoeppe]:
> > `@`gh-mwageringel Would you be able to review this ticket?
> Yes, I will look into that. 
Thanks!

> Though, I only have access to macOS 10.13.6.
That's actually great, for some broader coverage. I'm testing on 10.15.3, and also the [GitHub](GitHub) runners are on Catalina.



---

archive/issue_comments_408415.json:
```json
{
    "body": "lots of timeouts in tests, probably an overloaded host, or too aggressive parallelisation.",
    "created_at": "2020-03-18T18:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408415",
    "user": "dimpase"
}
```

lots of timeouts in tests, probably an overloaded host, or too aggressive parallelisation.



---

archive/issue_comments_408416.json:
```json
{
    "body": "Yes, this is using 12 threads",
    "created_at": "2020-03-18T18:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408416",
    "user": "mkoeppe"
}
```

Yes, this is using 12 threads



---

archive/issue_comments_408417.json:
```json
{
    "body": "I'm in the middle of trying this. A few comments:\n\n- patch: this should use homebrew's patch\n- pcre: same\n- boost: is there a way to convince Sage to use homebrew's boost as a replacement for boost-cropped? (See #29100?)\n- ntl: being discussed on another ticket, but my Sage builds on OS X regularly use homebrew's ntl without problems.",
    "created_at": "2020-03-18T18:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408417",
    "user": "jhpalmieri"
}
```

I'm in the middle of trying this. A few comments:

- patch: this should use homebrew's patch
- pcre: same
- boost: is there a way to convince Sage to use homebrew's boost as a replacement for boost-cropped? (See #29100?)
- ntl: being discussed on another ticket, but my Sage builds on OS X regularly use homebrew's ntl without problems.



---

archive/issue_comments_408418.json:
```json
{
    "body": "Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?",
    "created_at": "2020-03-18T18:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408418",
    "user": "jhpalmieri"
}
```

Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?



---

archive/issue_comments_408419.json:
```json
{
    "body": "I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.",
    "created_at": "2020-03-18T18:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408419",
    "user": "dimpase"
}
```

I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.



---

archive/issue_comments_408420.json:
```json
{
    "body": "ntl failed to build. This is on OS X 10.15.3.\n\n```\nmake setup3\ng++ -std=gnu++11 -I../include -I.  -O2 -g  -fno-common -march=native -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/homebrew/lib  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/include  -o gen_gmp_aux gen_gmp_aux.cpp -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib  -lgmp  -lm\n./gen_gmp_aux > ../include/NTL/gmp_aux.h \nNTL_GMP_LIP flag set\nGMP version check (6.1.2/6.2.0)\n*** version number mismatch: inconsistency between gmp.h and libgmp\n/bin/sh: line 1: 18441 Abort trap: 6           ./gen_gmp_aux > ../include/NTL/gmp_aux.h\nmake[5]: *** [setup3] Error 134\nmake[4]: *** [setup-phase] Error 2\nmake[4]: Target `all' not remade because of errors.\n```\n",
    "created_at": "2020-03-18T18:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408420",
    "user": "jhpalmieri"
}
```

ntl failed to build. This is on OS X 10.15.3.

```
make setup3
g++ -std=gnu++11 -I../include -I.  -O2 -g  -fno-common -march=native -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/homebrew/lib  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/include  -o gen_gmp_aux gen_gmp_aux.cpp -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/lib  -lgmp  -lm
./gen_gmp_aux > ../include/NTL/gmp_aux.h 
NTL_GMP_LIP flag set
GMP version check (6.1.2/6.2.0)
*** version number mismatch: inconsistency between gmp.h and libgmp
/bin/sh: line 1: 18441 Abort trap: 6           ./gen_gmp_aux > ../include/NTL/gmp_aux.h
make[5]: *** [setup3] Error 134
make[4]: *** [setup-phase] Error 2
make[4]: Target `all' not remade because of errors.
```




---

archive/issue_comments_408421.json:
```json
{
    "body": "Replying to [comment:96 jhpalmieri]:\n> ntl failed to build. This is on OS X 10.15.3.\n\nThis happens when you have a different (older) version of gmp in your /usr/local homebrew.\nThe isolation is unfortunately not perfect. Badly written configure scripts of packages pick up stuff from /usr/local",
    "created_at": "2020-03-18T18:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408421",
    "user": "mkoeppe"
}
```

Replying to [comment:96 jhpalmieri]:
> ntl failed to build. This is on OS X 10.15.3.

This happens when you have a different (older) version of gmp in your /usr/local homebrew.
The isolation is unfortunately not perfect. Badly written configure scripts of packages pick up stuff from /usr/local



---

archive/issue_comments_408422.json:
```json
{
    "body": "Replying to [comment:94 jhpalmieri]:\n> Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?\nGood idea. WIll do",
    "created_at": "2020-03-18T18:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408422",
    "user": "mkoeppe"
}
```

Replying to [comment:94 jhpalmieri]:
> Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?
Good idea. WIll do



---

archive/issue_comments_408423.json:
```json
{
    "body": "Replying to [comment:95 dimpase]:\n> I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.\nWell, for the build I'm using high parallelization on purpose in order to catch possible parallelization bugs in the scripts.",
    "created_at": "2020-03-18T18:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408423",
    "user": "mkoeppe"
}
```

Replying to [comment:95 dimpase]:
> I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.
Well, for the build I'm using high parallelization on purpose in order to catch possible parallelization bugs in the scripts.



---

archive/issue_comments_408424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-18T19:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408424",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408425.json:
```json
{
    "body": "Replying to [comment:93 jhpalmieri]:\n> I'm in the middle of trying this. A few comments:\n> \n> - pcre: same\n\nThis one actually works for me (both locally and on the [GitHub](GitHub) runner). Please post the logs if it doesn't work for you",
    "created_at": "2020-03-18T19:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408425",
    "user": "mkoeppe"
}
```

Replying to [comment:93 jhpalmieri]:
> I'm in the middle of trying this. A few comments:
> 
> - pcre: same

This one actually works for me (both locally and on the [GitHub](GitHub) runner). Please post the logs if it doesn't work for you



---

archive/issue_comments_408426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-18T19:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408427.json:
```json
{
    "body": "Replying to [comment:102 mkoeppe]:\n> Replying to [comment:93 jhpalmieri]:\n> > I'm in the middle of trying this. A few comments:\n> > \n> > - pcre: same\n> \n> This one actually works for me (both locally and on the [GitHub](GitHub) runner). Please post the logs if it doesn't work for you\n\nSorry, it looks okay to me. I must have misread config.log.",
    "created_at": "2020-03-18T19:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408427",
    "user": "jhpalmieri"
}
```

Replying to [comment:102 mkoeppe]:
> Replying to [comment:93 jhpalmieri]:
> > I'm in the middle of trying this. A few comments:
> > 
> > - pcre: same
> 
> This one actually works for me (both locally and on the [GitHub](GitHub) runner). Please post the logs if it doesn't work for you

Sorry, it looks okay to me. I must have misread config.log.



---

archive/issue_comments_408428.json:
```json
{
    "body": "Flint fails to build for me. I ran `brew upgrade`, cleaned everything out, and tried again, and it still fails.\n\n```\ng++ -std=gnu++11 -fPIC -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/var/tmp/sage/build/flint-2.5.2.p5/src -I/usr/local/include -I/usr/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo\nld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake[6]: *** [libflint-13.5.2.dylib] Error 1\nmake[6]: Target `shared' not remade because of errors.\nmake[5]: *** [library] Error 2\nmake[5]: Target `all' not remade because of errors.\nmake[4]: *** [verbose] Error 2\n```\n",
    "created_at": "2020-03-18T22:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408428",
    "user": "jhpalmieri"
}
```

Flint fails to build for me. I ran `brew upgrade`, cleaned everything out, and tried again, and it still fails.

```
g++ -std=gnu++11 -fPIC -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/var/tmp/sage/build/flint-2.5.2.p5/src -I/usr/local/include -I/usr/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.1.beta7/.tox/local-homebrew-macos-standard/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo
ld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[6]: *** [libflint-13.5.2.dylib] Error 1
make[6]: Target `shared' not remade because of errors.
make[5]: *** [library] Error 2
make[5]: Target `all' not remade because of errors.
make[4]: *** [verbose] Error 2
```




---

archive/issue_comments_408429.json:
```json
{
    "body": "Is homebrew ntl installed on this system?",
    "created_at": "2020-03-18T22:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408429",
    "user": "mkoeppe"
}
```

Is homebrew ntl installed on this system?



---

archive/issue_comments_408430.json:
```json
{
    "body": "(in /usr/local)",
    "created_at": "2020-03-18T22:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408430",
    "user": "mkoeppe"
}
```

(in /usr/local)



---

archive/issue_comments_408431.json:
```json
{
    "body": "Replying to [comment:106 mkoeppe]:\n> Is homebrew ntl installed on this system?\n\nYes. Do I need to delete it?\n\nBy the way, should `prefix` be added to `.gitignore`?",
    "created_at": "2020-03-18T22:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408431",
    "user": "jhpalmieri"
}
```

Replying to [comment:106 mkoeppe]:
> Is homebrew ntl installed on this system?

Yes. Do I need to delete it?

By the way, should `prefix` be added to `.gitignore`?



---

archive/issue_comments_408432.json:
```json
{
    "body": "Replying to [comment:108 jhpalmieri]:\n> Replying to [comment:106 mkoeppe]:\n> > Is homebrew ntl installed on this system?\n> \n> Yes. Do I need to delete it?\n\nPlease try if this helps.\nIf it does, we should fix something in the FLINT build scripts\n\n> By the way, should `prefix` be added to `.gitignore`?\n\nYes, will do.",
    "created_at": "2020-03-18T22:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408432",
    "user": "mkoeppe"
}
```

Replying to [comment:108 jhpalmieri]:
> Replying to [comment:106 mkoeppe]:
> > Is homebrew ntl installed on this system?
> 
> Yes. Do I need to delete it?

Please try if this helps.
If it does, we should fix something in the FLINT build scripts

> By the way, should `prefix` be added to `.gitignore`?

Yes, will do.



---

archive/issue_comments_408433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-18T22:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408433",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408434.json:
```json
{
    "body": "Is there a command like `make distclean` that will get rid of the stuff that Sage has built but keep the homebrew stuff? I don't really want to wait for gcc to build again. (`make distclean` doesn't touch `prefix`.)",
    "created_at": "2020-03-18T22:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408434",
    "user": "jhpalmieri"
}
```

Is there a command like `make distclean` that will get rid of the stuff that Sage has built but keep the homebrew stuff? I don't really want to wait for gcc to build again. (`make distclean` doesn't touch `prefix`.)



---

archive/issue_comments_408435.json:
```json
{
    "body": "At the moment, nothing better than `rm -rf prefix/*`",
    "created_at": "2020-03-18T22:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408435",
    "user": "mkoeppe"
}
```

At the moment, nothing better than `rm -rf prefix/*`



---

archive/issue_comments_408436.json:
```json
{
    "body": "Replying to [comment:109 mkoeppe]:\n> Replying to [comment:108 jhpalmieri]:\n> > Replying to [comment:106 mkoeppe]:\n> > > Is homebrew ntl installed on this system?\n> > \n> > Yes. Do I need to delete it?\n> \n> Please try if this helps.\n> If it does, we should fix something in the FLINT build scripts\n\nAfter doing `brew uninstall ntl`, flint now builds.",
    "created_at": "2020-03-19T00:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408436",
    "user": "jhpalmieri"
}
```

Replying to [comment:109 mkoeppe]:
> Replying to [comment:108 jhpalmieri]:
> > Replying to [comment:106 mkoeppe]:
> > > Is homebrew ntl installed on this system?
> > 
> > Yes. Do I need to delete it?
> 
> Please try if this helps.
> If it does, we should fix something in the FLINT build scripts

After doing `brew uninstall ntl`, flint now builds.



---

archive/issue_comments_408437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-03-19T19:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408437",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_408438.json:
```json
{
    "body": "Rebased - no longer on top of #29339.",
    "created_at": "2020-03-19T19:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408438",
    "user": "mkoeppe"
}
```

Rebased - no longer on top of #29339.



---

archive/issue_comments_408439.json:
```json
{
    "body": "Except for the issue with FLINT not building with a pre-existing NTL, it works for me.",
    "created_at": "2020-03-19T22:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408439",
    "user": "jhpalmieri"
}
```

Except for the issue with FLINT not building with a pre-existing NTL, it works for me.



---

archive/issue_comments_408440.json:
```json
{
    "body": "Let's fix the FLINT issue on a follow-up ticket.",
    "created_at": "2020-03-19T23:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408440",
    "user": "mkoeppe"
}
```

Let's fix the FLINT issue on a follow-up ticket.



---

archive/issue_comments_408441.json:
```json
{
    "body": "Replying to [comment:98 mkoeppe]:\n> Replying to [comment:94 jhpalmieri]:\n> > Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?\n> Good idea. WIll do\nI'll do this in #29146",
    "created_at": "2020-03-20T02:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408441",
    "user": "mkoeppe"
}
```

Replying to [comment:98 mkoeppe]:
> Replying to [comment:94 jhpalmieri]:
> > Defaulting to 12 threads seems like a bad idea. Shouldn't the user be able to configure this?
> Good idea. WIll do
I'll do this in #29146



---

archive/issue_comments_408442.json:
```json
{
    "body": "Replying to [comment:117 mkoeppe]:\n> Let's fix the FLINT issue on a follow-up ticket.\nThis issue is probably the same as #27708/#28409.",
    "created_at": "2020-03-20T03:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408442",
    "user": "mkoeppe"
}
```

Replying to [comment:117 mkoeppe]:
> Let's fix the FLINT issue on a follow-up ticket.
This issue is probably the same as #27708/#28409.



---

archive/issue_comments_408443.json:
```json
{
    "body": "Ready for review",
    "created_at": "2020-03-20T03:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408443",
    "user": "mkoeppe"
}
```

Ready for review



---

archive/issue_comments_408444.json:
```json
{
    "body": "Replying to [comment:99 mkoeppe]:\n> Replying to [comment:95 dimpase]:\n> > I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.\n> Well, for the build I'm using high parallelization on purpose in order to catch possible parallelization bugs in the scripts.\n\nOne can split building into `make built` and `make ptest`, with the latter, much more memory hungry, run with lower value of `-j`.",
    "created_at": "2020-03-20T04:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408444",
    "user": "dimpase"
}
```

Replying to [comment:99 mkoeppe]:
> Replying to [comment:95 dimpase]:
> > I presume Github Actions run on a real Mac hardware, and 12 threads is probably only meaningful on a rather high end host, used exclusively.
> Well, for the build I'm using high parallelization on purpose in order to catch possible parallelization bugs in the scripts.

One can split building into `make built` and `make ptest`, with the latter, much more memory hungry, run with lower value of `-j`.



---

archive/issue_comments_408445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-20T16:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408445",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408446.json:
```json
{
    "body": "OK I've made it more configurable already on this ticket.\nAnd I have added documentation",
    "created_at": "2020-03-20T16:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408446",
    "user": "mkoeppe"
}
```

OK I've made it more configurable already on this ticket.
And I have added documentation



---

archive/issue_comments_408447.json:
```json
{
    "body": "`@`gh-mwageringel, `@`dimpase: do you think more needs to be done here, or can we proceed with a positive review? I'm happy with it.",
    "created_at": "2020-03-20T18:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408447",
    "user": "jhpalmieri"
}
```

`@`gh-mwageringel, `@`dimpase: do you think more needs to be done here, or can we proceed with a positive review? I'm happy with it.



---

archive/issue_comments_408448.json:
```json
{
    "body": "I'm 8 timezones away from my MacOS machine. \n\nI'd like more details/pointers on how the Github Actions testing is done - for  [this](https://github.com/mkoeppe/sage/runs/416298393?check_suite_focus=true) looks to me like \"all sufficiently advanced technology is indistinguishable from magic\" kind of thing :-)",
    "created_at": "2020-03-20T18:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408448",
    "user": "dimpase"
}
```

I'm 8 timezones away from my MacOS machine. 

I'd like more details/pointers on how the Github Actions testing is done - for  [this](https://github.com/mkoeppe/sage/runs/416298393?check_suite_focus=true) looks to me like "all sufficiently advanced technology is indistinguishable from magic" kind of thing :-)



---

archive/issue_comments_408449.json:
```json
{
    "body": "This ticket does no [GitHub](GitHub) Actions testing. This is all introduced in #29087.",
    "created_at": "2020-03-20T19:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408449",
    "user": "mkoeppe"
}
```

This ticket does no [GitHub](GitHub) Actions testing. This is all introduced in #29087.



---

archive/issue_comments_408450.json:
```json
{
    "body": "how does one get the data I linked in comment:126 then?",
    "created_at": "2020-03-20T19:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408450",
    "user": "dimpase"
}
```

how does one get the data I linked in comment:126 then?



---

archive/issue_comments_408451.json:
```json
{
    "body": "By merging #29087 and pushing the branch to a [GitHub](GitHub) repository.",
    "created_at": "2020-03-20T19:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408451",
    "user": "mkoeppe"
}
```

By merging #29087 and pushing the branch to a [GitHub](GitHub) repository.



---

archive/issue_comments_408452.json:
```json
{
    "body": "If the [GitHub](GitHub) Actions interface is overwhelming, just download the \"Artifacts\". They are tar.gz files of build logs.",
    "created_at": "2020-03-20T19:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408452",
    "user": "mkoeppe"
}
```

If the [GitHub](GitHub) Actions interface is overwhelming, just download the "Artifacts". They are tar.gz files of build logs.



---

archive/issue_comments_408453.json:
```json
{
    "body": "Replying to [comment:129 mkoeppe]:\n> By merging #29087 and pushing the branch to a [GitHub](GitHub) repository.\n\nyes,but that's  how one triggers this - I'm asking rather about how stuff works, inside. Locally and then somehow pushing the logs to [GitHub](GitHub)?",
    "created_at": "2020-03-20T19:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408453",
    "user": "dimpase"
}
```

Replying to [comment:129 mkoeppe]:
> By merging #29087 and pushing the branch to a [GitHub](GitHub) repository.

yes,but that's  how one triggers this - I'm asking rather about how stuff works, inside. Locally and then somehow pushing the logs to [GitHub](GitHub)?



---

archive/issue_comments_408454.json:
```json
{
    "body": "I don't push logs to [GitHub](GitHub). \n\n#29087 adds `.github/workflows/tox.yml` (https://git.sagemath.org/sage.git/diff/.github/workflows/tox.yml?id=576a18834a16ff05cd6894172a55e86bcc95d407&id2=be1e22c441d9332fd0bf4a3066e1964deddaf8c7) which gets run on every commit pushed to [GitHub](GitHub) and on every pull request. \n\nThe job `tox-local-homebrew-macos` defined in that file provisions a macOS host, checks out the branch and runs `tox -e local-homebrew-macos-standard` there. Then it packages up logs and makes them available as an artifact.",
    "created_at": "2020-03-20T19:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408454",
    "user": "mkoeppe"
}
```

I don't push logs to [GitHub](GitHub). 

#29087 adds `.github/workflows/tox.yml` (https://git.sagemath.org/sage.git/diff/.github/workflows/tox.yml?id=576a18834a16ff05cd6894172a55e86bcc95d407&id2=be1e22c441d9332fd0bf4a3066e1964deddaf8c7) which gets run on every commit pushed to [GitHub](GitHub) and on every pull request. 

The job `tox-local-homebrew-macos` defined in that file provisions a macOS host, checks out the branch and runs `tox -e local-homebrew-macos-standard` there. Then it packages up logs and makes them available as an artifact.



---

archive/issue_comments_408455.json:
```json
{
    "body": "and where is that MacOS host getting provisioned?",
    "created_at": "2020-03-20T19:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408455",
    "user": "dimpase"
}
```

and where is that MacOS host getting provisioned?



---

archive/issue_comments_408456.json:
```json
{
    "body": "GitHub takes care of that, I think it's using Azure.",
    "created_at": "2020-03-20T19:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408456",
    "user": "mkoeppe"
}
```

GitHub takes care of that, I think it's using Azure.



---

archive/issue_comments_408457.json:
```json
{
    "body": "Replying to [comment:125 jhpalmieri]:\n> `@`gh-mwageringel, `@`dimpase: do you think more needs to be done here, or can we proceed with a positive review? I'm happy with it.\n\nI have not tested this locally, but as you have done that, I am happy with this too.\n\nOne last question though: As far as I can see, readline is not installed into /usr/local. Why do you not run into conflicts with macOS's system \"readline\"/libedit, as in #29000?",
    "created_at": "2020-03-20T22:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408457",
    "user": "@mwageringel"
}
```

Replying to [comment:125 jhpalmieri]:
> `@`gh-mwageringel, `@`dimpase: do you think more needs to be done here, or can we proceed with a positive review? I'm happy with it.

I have not tested this locally, but as you have done that, I am happy with this too.

One last question though: As far as I can see, readline is not installed into /usr/local. Why do you not run into conflicts with macOS's system "readline"/libedit, as in #29000?



---

archive/issue_comments_408458.json:
```json
{
    "body": "These tests use their own homebrew installation in a prefix `.tox/local-homebrew-macos-standard/homebrew/`, and sets up environment variables using the new script `.homebrew-build-env`. This sets LDFLAGS and CPPFLAGS for the readline installed into `opt` under the homebrew prefix.",
    "created_at": "2020-03-20T22:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408458",
    "user": "mkoeppe"
}
```

These tests use their own homebrew installation in a prefix `.tox/local-homebrew-macos-standard/homebrew/`, and sets up environment variables using the new script `.homebrew-build-env`. This sets LDFLAGS and CPPFLAGS for the readline installed into `opt` under the homebrew prefix.



---

archive/issue_comments_408459.json:
```json
{
    "body": "The problem in #29000 occured despite passing LDFLAGS and CPPFLAGS to `configure`, so I guess setting these also during `make` would avoid that problem, as a workaround.",
    "created_at": "2020-03-20T22:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408459",
    "user": "@mwageringel"
}
```

The problem in #29000 occured despite passing LDFLAGS and CPPFLAGS to `configure`, so I guess setting these also during `make` would avoid that problem, as a workaround.



---

archive/issue_comments_408460.json:
```json
{
    "body": "I think the problem description of #29000 needs some more precision.",
    "created_at": "2020-03-20T22:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408460",
    "user": "mkoeppe"
}
```

I think the problem description of #29000 needs some more precision.



---

archive/issue_comments_408461.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-21T02:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408461",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_408462.json:
```json
{
    "body": "OK, looks good to me.",
    "created_at": "2020-03-21T02:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408462",
    "user": "dimpase"
}
```

OK, looks good to me.



---

archive/issue_comments_408463.json:
```json
{
    "body": "Thanks everyone!",
    "created_at": "2020-03-21T02:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408463",
    "user": "mkoeppe"
}
```

Thanks everyone!



---

archive/issue_comments_408464.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-29T00:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28867#issuecomment-408464",
    "user": "vbraun"
}
```

Resolution: fixed
