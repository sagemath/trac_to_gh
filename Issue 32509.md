# Issue 32509: fedora-{26,27,...,34}-minimal: scipy build fails - openblas not found

Issue created by migration from https://trac.sagemath.org/ticket/32746

Original creator: mkoeppe

Original creation time: 2021-10-23 15:47:13

CC:  dimpase jhpalmieri

for example, `fedora-34-minimal` https://github.com/mkoeppe/sage/runs/3968544625?check_suite_focus=true


```
Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,
      so their current settings are ignored.
Installing scipy-1.6.3
Processing /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/scipy-1.6.3/src
    Preparing wheel metadata: started
    Running command /sage/local/var/lib/sage/venv-python3.9.7/bin/python3 /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpatw3swb6
    setup.py:462: UserWarning: Unrecognized setuptools command ('dist_info --egg-base /tmp/pip-modern-metadata-assu7gnc'), proceeding with generating Cython sources and expanding templates
      warnings.warn("Unrecognized setuptools command ('{}'), proceeding with "
    Running from SciPy source directory.
    lapack_opt_info:
    lapack_mkl_info:
    Disabled lapack_mkl_info: (MKLROOT is None)
    Disabled lapack_mkl_info: (MKLROOT is None)
    customize UnixCCompiler
      libraries mkl_rt not found in []
      NOT AVAILABLE

    openblas_lapack_info:
    Disabled openblas_lapack_info: (OPENBLAS is None)
      libraries openblas not found in []
      NOT AVAILABLE

    openblas_clapack_info:
    Disabled openblas_clapack_info: (OPENBLAS is None)
      libraries openblas,lapack not found in []
      NOT AVAILABLE

    flame_info:
      libraries flame not found in ['/sage/local/var/lib/sage/venv-python3.9.7/lib', '/usr/local/lib64', '/usr/local/lib', '/usr/lib64', '/usr/lib', '/usr/lib/']
      NOT AVAILABLE

    accelerate_info:
      NOT AVAILABLE

    atlas_3_10_threads_info:
    Disabled atlas_3_10_threads_info: (PTATLAS is None)
    <class 'numpy.distutils.system_info.atlas_3_10_threads_info'>
      NOT AVAILABLE

    atlas_3_10_info:
    Disabled atlas_3_10_info: (ATLAS is None)
    <class 'numpy.distutils.system_info.atlas_3_10_info'>
      NOT AVAILABLE

    atlas_threads_info:
    Disabled atlas_threads_info: (PTATLAS is None)
    <class 'numpy.distutils.system_info.atlas_threads_info'>
      NOT AVAILABLE

    atlas_info:
    Disabled atlas_info: (ATLAS is None)
    <class 'numpy.distutils.system_info.atlas_info'>
      NOT AVAILABLE

    lapack_info:
      libraries openblas not found in ['/sage/local/var/lib/sage/venv-python3.9.7/lib', '/usr/local/lib64', '/usr/local/lib', '/usr/lib64', '/usr/lib', '/usr/lib/']
      NOT AVAILABLE

    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:
        Lapack (http://www.netlib.org/lapack/) libraries not found.
        Directories to search for the libraries can be specified in the
        numpy/distutils/site.cfg file (section [lapack]) or by setting
        the LAPACK environment variable.
      return getattr(self, '_calc_info_{}'.format(name))()
    lapack_src_info:
      NOT AVAILABLE

    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:
        Lapack (http://www.netlib.org/lapack/) sources not found.
        Directories to search for the sources can be specified in the
        numpy/distutils/site.cfg file (section [lapack_src]) or by setting
        the LAPACK_SRC environment variable.
      return getattr(self, '_calc_info_{}'.format(name))()
      NOT AVAILABLE

    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 349, in <module>
        main()
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 331, in main
        json_out['return_val'] = hook(**hook_input['kwargs'])
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 151, in prepare_metadata_for_build_wheel
        return hook(metadata_directory, config_settings)
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 166, in prepare_metadata_for_build_wheel
        self.run_setup()
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 258, in run_setup
        super(_BuildMetaLegacyBackend,
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 150, in run_setup
        exec(compile(code, __file__, 'exec'), locals())
      File "setup.py", line 598, in <module>
        setup_package()
      File "setup.py", line 594, in setup_package
        setup(**metadata)
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/core.py", line 135, in setup
        config = configuration()
      File "setup.py", line 500, in configuration
        raise NotFoundError(msg)
    numpy.distutils.system_info.NotFoundError: No BLAS/LAPACK libraries found.
    To build Scipy from sources, BLAS & LAPACK libraries need to be installed.
    See site.cfg.example in the Scipy source directory and
    https://docs.scipy.org/doc/scipy/reference/building/index.html for details.
    Preparing wheel metadata: finished with status 'error'
```



---

Comment by mkoeppe created at 2021-10-23 15:47:21

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2021-10-23 20:03:54

To test the fix: `tox -e docker-fedora-34-minimal -- scipy`


---

Comment by mkoeppe created at 2021-10-23 20:07:55

New commits:


---

Comment by mkoeppe created at 2021-10-23 20:07:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-10-23 20:44:24

Replying to [comment:3 mkoeppe]:
> To test the fix: `tox -e docker-fedora-34-minimal -- scipy`
... tested successfully.


---

Comment by mkoeppe created at 2021-10-26 20:51:48

Let's get this in please


---

Comment by jhpalmieri created at 2021-10-26 23:09:14

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-10-26 23:09:14

It works for me. Looks good.


---

Comment by mkoeppe created at 2021-10-26 23:47:14

Thank you!


---

Comment by vbraun created at 2021-10-31 22:21:21

Resolution: fixed
