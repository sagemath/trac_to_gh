# Issue 16507: Random failure in elliptic_curves/constructor.py

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-07-30 13:50:12

CC:  pbruin cremona

Keywords: random_fail

The code is from #11474:

```
sage -t --long src/sage/schemes/elliptic_curves/constructor.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/constructor.py", line 365, in sage.schemes.elliptic_curves.constructor.EllipticCurveFactory.create_key_and_extra_args
Failed example:
    E.gens()
Expected:
    [(-2 : 3 : 1), (1 : -1 : 1), (4 : -7 : 1)]
Got:
    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]
**********************************************************************
File "src/sage/schemes/elliptic_curves/constructor.py", line 368, in sage.schemes.elliptic_curves.constructor.EllipticCurveFactory.create_key_and_extra_args
Failed example:
    E.gens()
Expected:
    [(-2 : 3 : 1), (1 : -1 : 1), (4 : -7 : 1)]
Got:
    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]
**********************************************************************
1 item had failures:
   2 of  19 in sage.schemes.elliptic_curves.constructor.EllipticCurveFactory.create_key_and_extra_args
    [182 tests, 2 failures, 67.70 s]
```



---

Comment by cremona created at 2014-07-30 13:57:17

It seems that this doctest is intended to illustrate that specifying "gens=" when cponstructing a curve from its label might be ignored when the curve is in the database.  But there is a danger:  the default database contains curves of conductors up to 10000 but does *not* contain their generators.  So this is a test whose output will depend on whether or not the optional extended database is installed, something which we have been trying to avoid.

I hope the authors of #11474 (not me!) will be able to say whether I have got this diagnosis right.


---

Comment by pbruin created at 2014-07-30 19:34:12

I'm responsible for that doctest.  The unexpected `[(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]` are the generators found by mwrank, not the ones in the database.  The fact that the same curve is used in an earlier doctest in that file might be the cause; I'll look into it.


---

Comment by pbruin created at 2014-07-30 21:05:32

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-07-30 21:05:32

Changing priority from major to minor.


---

Comment by pbruin created at 2014-07-30 21:05:32

The problem was that curve 5077a1 could still be in the cache from an earlier doctest.  In this case the `gens` parameter (in the first failing doctest) would be ignored and the generators would be computed using mwrank.  This commit replaces the curve 5077a1 by 433a1, which is not used in any other doctest.


---

Comment by jdemeyer created at 2014-08-05 09:46:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-06 12:07:25

Resolution: fixed
