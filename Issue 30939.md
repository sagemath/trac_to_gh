# Issue 30939: Add packages from 3-manifolds / computop

Issue created by migration from https://trac.sagemath.org/ticket/31176

Original creator: mkoeppe

Original creation time: 2021-01-03 22:34:54

CC:  dunfield culler dimpase slelievre

https://github.com/3-manifolds/sagedocker/tree/master/sage/scripts


---

Comment by dunfield created at 2021-01-04 17:54:47

It should be noted that `SnapPy`, nor any of the other software at â€‹[https://github.com/3-manifolds](https://github.com/3-manifolds), actually depends on, or even uses, `(py)graphviz` or `ipympl`.  A certain amount of the stuff in that Docker image is just there because I used it in some project or other ;-).

All outside dependencies of `SnapPy` itself are already included in `sage`. That is, 

```
sage -pip install --no-deps snappy spherogram plink FXrays snappy_manifolds
```

would be a completely functional "optional spkg" for `SnapPy`.


---

Comment by dunfield created at 2021-01-04 18:04:24

The `--no-deps` flag is just there to prevent it from pulling in `cypari (!= cypari2)`.  In fact, just `sage -pip install snappy` does the trick but installs the (unused even by `SnapPy` in this context) `cypari` module. Unfortunately, `pip` does not seem to permit you to require one of a list of modules e.g. `cypari|cypari2`, cf [https://github.com/sagemath/cypari2/issues/19#issuecomment-699071738](https://github.com/sagemath/cypari2/issues/19#issuecomment-699071738).


---

Comment by mkoeppe created at 2021-01-04 18:32:48

Replying to [comment:4 dunfield]:
> ... unused even by `SnapPy` in this context ...
Sounds like `cypari` should be an `extras_require`?


---

Comment by dunfield created at 2021-01-05 01:45:15

Replying to [comment:6 mkoeppe]:
> > ... unused even by `SnapPy` in this context ...
> Sounds like `cypari` should be an `extras_require`?

Unfortunately, outside of Sage, SnapPy does use `cypari` very heavily; it is just that inside of Sage, it uses `cypari2` instead.  The two modules provide identical functionality, but `cypari` is statically linked (and includes an embedded copy of `cysignals`) whereas `cypari2` relies on the external dynamic library `libpari`.

(In case you're curious, the reason `cypari` is statically linked is so we can build self-contained binary wheels to post on PyPI, including for Windows (native, not cygwin), and ship stand-alone SnapPy apps for macOS and Windows.)


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.
