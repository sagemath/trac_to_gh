# Issue 10766: bug in simon_two_descent()

archive/issues_010766.json:
```json
{
    "body": "Assignee: @JohnCremona\n\nCC:  @rlmill weigandt gagansekhon\n\nThis is similar to, but different to, #10745.\n\n```\nsage: E = EllipticCurve([1,0,0,-6664,86543])\nsage: E.simon_two_descent()\n(2, 3, [(173 : 1943 : 1), (-73 : -394 : 1), (323/4 : 1891/8 : 1)])\nsage: E.rank()\n3\nsage: E.gens()\n[(-73 : -394 : 1), (323/4 : 1891/8 : 1), (173 : 1943 : 1)]\n```\n\nThis is _wrong_.  The rank is 2;  the first point in the output has order 4.  The mistake is that in discarding torsion points from the generators of E/2E, only points of exact order 2 are omitted!\n\nIssue created by migration from https://trac.sagemath.org/ticket/10832\n\n",
    "created_at": "2011-02-23T03:33:28Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "bug in simon_two_descent()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10766",
    "user": "@JohnCremona"
}
```
Assignee: @JohnCremona

CC:  @rlmill weigandt gagansekhon

This is similar to, but different to, #10745.

```
sage: E = EllipticCurve([1,0,0,-6664,86543])
sage: E.simon_two_descent()
(2, 3, [(173 : 1943 : 1), (-73 : -394 : 1), (323/4 : 1891/8 : 1)])
sage: E.rank()
3
sage: E.gens()
[(-73 : -394 : 1), (323/4 : 1891/8 : 1), (173 : 1943 : 1)]
```

This is _wrong_.  The rank is 2;  the first point in the output has order 4.  The mistake is that in discarding torsion points from the generators of E/2E, only points of exact order 2 are omitted!

Issue created by migration from https://trac.sagemath.org/ticket/10832





---

archive/issue_comments_113894.json:
```json
{
    "body": "Applies to 4.6.2.rc0",
    "created_at": "2011-02-23T03:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113894",
    "user": "@JohnCremona"
}
```

Applies to 4.6.2.rc0



---

archive/issue_comments_113895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-23T03:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113895",
    "user": "@JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113896.json:
```json
{
    "body": "Attachment [trac_10832-descent.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10832-descent.patch) by @JohnCremona created at 2011-02-23 03:35:41",
    "created_at": "2011-02-23T03:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113896",
    "user": "@JohnCremona"
}
```

Attachment [trac_10832-descent.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10832-descent.patch) by @JohnCremona created at 2011-02-23 03:35:41



---

archive/issue_comments_113897.json:
```json
{
    "body": "After the patch:\n\n```\nsage: E = EllipticCurve([1,0,0,-6664,86543])\nsage: E.simon_two_descent()\n(2, 3, [(173 : 1943 : 1), (-73 : -394 : 1), (323/4 : 1891/8 : 1)])\nsage: E.rank()\n2\nsage: E.gens()\n[(-73 : -394 : 1), (323/4 : 1891/8 : 1)]\n```\n",
    "created_at": "2011-02-23T03:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113897",
    "user": "@JohnCremona"
}
```

After the patch:

```
sage: E = EllipticCurve([1,0,0,-6664,86543])
sage: E.simon_two_descent()
(2, 3, [(173 : 1943 : 1), (-73 : -394 : 1), (323/4 : 1891/8 : 1)])
sage: E.rank()
2
sage: E.gens()
[(-73 : -394 : 1), (323/4 : 1891/8 : 1)]
```




---

archive/issue_comments_113898.json:
```json
{
    "body": "(* first comment ever)\n\nWorks fine on snow leopard 10.6.6.\n\nBut I'm not sure I understand. Sure, the \"rank\" should be returned as 2, but if I ask for the generators - shouldn't we get the generators of the torsion as well?\nI'm simply thinking of consistency with other groups such as unit groups.\nThe rank of the unit group of the cyclotomic field QQ(\\zeta_5) is 1, but there are two generators (and sage does return 2).",
    "created_at": "2011-03-05T09:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113898",
    "user": "shin"
}
```

(* first comment ever)

Works fine on snow leopard 10.6.6.

But I'm not sure I understand. Sure, the "rank" should be returned as 2, but if I ask for the generators - shouldn't we get the generators of the torsion as well?
I'm simply thinking of consistency with other groups such as unit groups.
The rank of the unit group of the cyclotomic field QQ(\zeta_5) is 1, but there are two generators (and sage does return 2).



---

archive/issue_comments_113899.json:
```json
{
    "body": "Replying to [comment:4 shin]:\n> (* first comment ever)\n> \n> Works fine on snow leopard 10.6.6.\n> \n> But I'm not sure I understand. Sure, the \"rank\" should be returned as 2, but if I ask for the generators - shouldn't we get the generators of the torsion as well?\n> I'm simply thinking of consistency with other groups such as unit groups.\n> The rank of the unit group of the cyclotomic field QQ(\\zeta_5) is 1, but there are two generators (and sage does return 2).\n\nWelcome! \n\nYou are absolutely right from the mathematical point of view, the generators should really include 0, 1 or 2 torsion generators.  But there is a tradition with elliptic curves of using \"generators\" to mean \"generators modulo torsion\", and I think that to change the behaviour to what you suggest would break a lot of code, hence a Bad Thing.\n\nOn the other hand it would be very reasonable to expect the docstring to be more precise, and in fact it is:  for curves over Q the docstring for gens clearly states that it returns generaotors modulo torsion;  while for curves over other number fields it just says \n\n```\nReturns some generators of this elliptic curve. Check ``rank()`` or\n       ``rank_bounds()`` to verify the number of generators.\n```\n\nso the user is not being misled.",
    "created_at": "2011-03-05T17:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113899",
    "user": "@JohnCremona"
}
```

Replying to [comment:4 shin]:
> (* first comment ever)
> 
> Works fine on snow leopard 10.6.6.
> 
> But I'm not sure I understand. Sure, the "rank" should be returned as 2, but if I ask for the generators - shouldn't we get the generators of the torsion as well?
> I'm simply thinking of consistency with other groups such as unit groups.
> The rank of the unit group of the cyclotomic field QQ(\zeta_5) is 1, but there are two generators (and sage does return 2).

Welcome! 

You are absolutely right from the mathematical point of view, the generators should really include 0, 1 or 2 torsion generators.  But there is a tradition with elliptic curves of using "generators" to mean "generators modulo torsion", and I think that to change the behaviour to what you suggest would break a lot of code, hence a Bad Thing.

On the other hand it would be very reasonable to expect the docstring to be more precise, and in fact it is:  for curves over Q the docstring for gens clearly states that it returns generaotors modulo torsion;  while for curves over other number fields it just says 

```
Returns some generators of this elliptic curve. Check ``rank()`` or
       ``rank_bounds()`` to verify the number of generators.
```

so the user is not being misled.



---

archive/issue_comments_113900.json:
```json
{
    "body": "Looks good to me. All tests passed.\n\nThere is no new doctest in it, but I checked carefully on examples that it now computes the rank correctly.",
    "created_at": "2011-03-18T14:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113900",
    "user": "@categorie"
}
```

Looks good to me. All tests passed.

There is no new doctest in it, but I checked carefully on examples that it now computes the rank correctly.



---

archive/issue_comments_113901.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-18T14:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113901",
    "user": "@categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113902.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-18T19:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113902",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_113903.json:
```json
{
    "body": "Replying to [comment:6 wuthrich]:\n> Looks good to me. All tests passed.\n> \n> There is no new doctest in it, but I checked carefully on examples that it now computes the rank correctly.\n\nWell, I think at the very least the \"wrong\" output from the ticket description should be doctested.",
    "created_at": "2011-03-18T19:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113903",
    "user": "@jdemeyer"
}
```

Replying to [comment:6 wuthrich]:
> Looks good to me. All tests passed.
> 
> There is no new doctest in it, but I checked carefully on examples that it now computes the rank correctly.

Well, I think at the very least the "wrong" output from the ticket description should be doctested.



---

archive/issue_comments_113904.json:
```json
{
    "body": "Added the doctest for the wrong output.",
    "created_at": "2011-03-22T18:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113904",
    "user": "gagansekhon"
}
```

Added the doctest for the wrong output.



---

archive/issue_comments_113905.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-22T18:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113905",
    "user": "gagansekhon"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113906.json:
```json
{
    "body": "Attachment [trac_10872.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10872.patch) by gagansekhon created at 2011-03-22 18:08:00\n\nPlease use trac_10872.patch, it is the latest version of the patch.",
    "created_at": "2011-03-22T18:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113906",
    "user": "gagansekhon"
}
```

Attachment [trac_10872.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10872.patch) by gagansekhon created at 2011-03-22 18:08:00

Please use trac_10872.patch, it is the latest version of the patch.



---

archive/issue_comments_113907.json:
```json
{
    "body": "Tests pass, documentation of the offending example has been added.",
    "created_at": "2011-03-22T21:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113907",
    "user": "weigandt"
}
```

Tests pass, documentation of the offending example has been added.



---

archive/issue_comments_113908.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-22T21:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113908",
    "user": "weigandt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113909.json:
```json
{
    "body": "spacing fix",
    "created_at": "2011-03-23T01:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113909",
    "user": "@kini"
}
```

spacing fix



---

archive/issue_comments_113910.json:
```json
{
    "body": "Attachment [trac_10872-descent.v3.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10872-descent.v3.patch) by @kini created at 2011-03-23 01:39:09\n\nAdded a trivial spacing fix.\nAdded a comment for the patchbot to read.",
    "created_at": "2011-03-23T01:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113910",
    "user": "@kini"
}
```

Attachment [trac_10872-descent.v3.patch](tarball://root/attachments/some-uuid/ticket10832/trac_10872-descent.v3.patch) by @kini created at 2011-03-23 01:39:09

Added a trivial spacing fix.
Added a comment for the patchbot to read.



---

archive/issue_comments_113911.json:
```json
{
    "body": "Whoops, comment for the patchbot fixed",
    "created_at": "2011-03-23T01:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113911",
    "user": "@kini"
}
```

Whoops, comment for the patchbot fixed



---

archive/issue_comments_113912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-12T08:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10766#issuecomment-113912",
    "user": "@jdemeyer"
}
```

Resolution: fixed
