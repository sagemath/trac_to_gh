# Issue 34140: Improvements to ImageSet

Issue created by migration from https://trac.sagemath.org/ticket/34377

Original creator: mkoeppe

Original creation time: 2022-08-16 21:30:07

CC:  tscrim

(split out from #34340)


---

Comment by git created at 2022-08-16 21:37:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-16 21:41:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-08-17 01:38:46

I think you should `try`-`except` the call to `self._inverse(x)` as that could fail in many different ways (with the actual error getting lost in the noise). Subsequently, I am not sure of the utility of verifying that it is an inverse versus trusting the user did give an honest inverse.

There is also an infinite recursion that seems to be happening:

```
src/sage/categories/sets_cat.py  # 1 doctest failed
```


Also, calling `len(list(self))` might run for forever if `self` is infinite. I think `list(self)` also does a `__len__` check too. This is also probably related to the infinite recursion above.


---

Comment by mkoeppe created at 2022-08-17 01:44:47

Replying to [comment:4 tscrim]:
> I think you should `try`-`except` the call to `self._inverse(x)` as that could fail in many different ways (with the actual error getting lost in the noise).

Yes, I think that's a good idea

> Subsequently, I am not sure of the utility of verifying that it is an inverse versus trusting the user did give an honest inverse.

Mapping back is necessary to get an element that is in the correct parent.
The comparison is just a safety check there.


---

Comment by tscrim created at 2022-08-17 01:46:57

Replying to [comment:5 mkoeppe]:
> Replying to [comment:4 tscrim]:
> > Subsequently, I am not sure of the utility of verifying that it is an inverse versus trusting the user did give an honest inverse.
> 
> Mapping back is necessary to get an element that is in the correct parent.
> The comparison is just a safety check there.

Couldn't we just do `self.codomain()(x)` for this?


---

Comment by mkoeppe created at 2022-08-17 01:48:05

If it's an honest `Map`, yes, but this is supposed to work also for `PoorManMap`


---

Comment by tscrim created at 2022-08-17 01:48:37

Ah, right. Thanks.


---

Comment by git created at 2022-08-17 02:44:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-17 15:11:17

Bots are green now


---

Comment by git created at 2022-08-17 15:42:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-20 05:38:58

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-08-20 05:38:58

LGTM.


---

Comment by mkoeppe created at 2022-08-20 05:42:17

Thanks.


---

Comment by vbraun created at 2022-08-30 19:05:12

Resolution: fixed
