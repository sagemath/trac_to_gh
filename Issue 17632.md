# Issue 17632: prove_BSD for elliptic curve uses a incorrect lemma

archive/issues_017632.json:
```json
{
    "body": "CC:  wstein @rlmill @pjbruin\n\nKeywords: BSD\n\nLet E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H^1 vanish is computed wrong in their Lemma 5.4. \n\nAs a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.\n\nThe patch here replaces the condition with a new condition, based on a paper I am writing with Taylor Lawson. We explicitly find when the cohomology groups in questions do not vanish. I will point to the paper when it is ready.\n\nI wait with asking for review until then.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17869\n\n",
    "created_at": "2015-02-27T15:49:20Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "prove_BSD for elliptic curve uses a incorrect lemma",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17632",
    "user": "https://github.com/categorie"
}
```
CC:  wstein @rlmill @pjbruin

Keywords: BSD

Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H^1 vanish is computed wrong in their Lemma 5.4. 

As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.

The patch here replaces the condition with a new condition, based on a paper I am writing with Taylor Lawson. We explicitly find when the cohomology groups in questions do not vanish. I will point to the paper when it is ready.

I wait with asking for review until then.

Issue created by migration from https://trac.sagemath.org/ticket/17869





---

archive/issue_comments_235358.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-27T15:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235358",
    "user": "https://github.com/categorie"
}
```

New commits:



---

archive/issue_comments_235359.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235360.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-13T10:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235360",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235361.json:
```json
{
    "body": "A few questions/comments:\n- Could you add a reference to your preprint to the documentation?\n- It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.\n- It seems to me that the code\n  {{{\n  phis = [phi for phi in flatten(BSD.curve.isogeny_class().isogenies())\n             if phi != 0 and\n             phi.degree() == p and\n             phi.domain().is_isomorphic(BSD.curve) ]\n  }}}\n  can be simplified to\n  {{{\n  phis = BSD.curve.isogenies_prime_degree(p) \n  }}}\n  Would this be OK?\n- A typographical question: are the spaces around the dash in \"Lawson - Wuthrich\" intentional?  It is fine with me either way, but there is already \"Stein-Wuthrich\" without the spaces.",
    "created_at": "2015-06-01T05:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235361",
    "user": "https://github.com/pjbruin"
}
```

A few questions/comments:
- Could you add a reference to your preprint to the documentation?
- It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.
- It seems to me that the code
  {{{
  phis = [phi for phi in flatten(BSD.curve.isogeny_class().isogenies())
             if phi != 0 and
             phi.degree() == p and
             phi.domain().is_isomorphic(BSD.curve) ]
  }}}
  can be simplified to
  {{{
  phis = BSD.curve.isogenies_prime_degree(p) 
  }}}
  Would this be OK?
- A typographical question: are the spaces around the dash in "Lawson - Wuthrich" intentional?  It is fine with me either way, but there is already "Stein-Wuthrich" without the spaces.



---

archive/issue_comments_235362.json:
```json
{
    "body": "Replying to [comment:7 pbruin]:\n> - It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.\n \nActually, I am now wondering whether the check for irreducible representations is necessary at all; the other tests seem to suffice to set `crit_lw = True` whenever the representation is irreducible.",
    "created_at": "2015-06-01T06:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235362",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:7 pbruin]:
> - It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.
 
Actually, I am now wondering whether the check for irreducible representations is necessary at all; the other tests seem to suffice to set `crit_lw = True` whenever the representation is irreducible.



---

archive/issue_comments_235363.json:
```json
{
    "body": "Looking at Theorem 1 in the preprint, it seems that the checks in the cases *p* = 3 and *p* = 5 are stricter than necessary.  For example, let *E* be the (\u0393<sub>0</sub>(*N*)-optimal) elliptic curve with Cremona label 198b1 (LMFDB label 198.e3).  Then *E* admits a 3-isogeny with kernel *\u03bc*<sub>3</sub> and no other 3-isogenies.  Theorem 1 implies that the H<sup>1</sup> is trivial, but the code as implemented in this ticket does not detect this since it keeps `crit_lw = False` unless the 3-isogenous curve does not have any points of order 3 either.  Does this mean that the criterion in the code can be relaxed?",
    "created_at": "2015-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235363",
    "user": "https://github.com/pjbruin"
}
```

Looking at Theorem 1 in the preprint, it seems that the checks in the cases *p* = 3 and *p* = 5 are stricter than necessary.  For example, let *E* be the (Γ<sub>0</sub>(*N*)-optimal) elliptic curve with Cremona label 198b1 (LMFDB label 198.e3).  Then *E* admits a 3-isogeny with kernel *μ*<sub>3</sub> and no other 3-isogenies.  Theorem 1 implies that the H<sup>1</sup> is trivial, but the code as implemented in this ticket does not detect this since it keeps `crit_lw = False` unless the 3-isogenous curve does not have any points of order 3 either.  Does this mean that the criterion in the code can be relaxed?



---

archive/issue_comments_235364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235365.json:
```json
{
    "body": "Thanks.\n\nYour suggestion about adding the reference and reordering the conditions are very good and I did so. Also the one-line replacement of my 4 line constuction is very welcome :)\n\nAs to the precise condition. Theorem 1 in the paper is used, but one needs more. The best reference would be to theorem 14 in the linked preprint. The thing is that for curves like 198b1 the second cohomology does not vanish and that is needed in the argument as well.",
    "created_at": "2015-06-02T14:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235365",
    "user": "https://github.com/categorie"
}
```

Thanks.

Your suggestion about adding the reference and reordering the conditions are very good and I did so. Also the one-line replacement of my 4 line constuction is very welcome :)

As to the precise condition. Theorem 1 in the paper is used, but one needs more. The best reference would be to theorem 14 in the linked preprint. The thing is that for curves like 198b1 the second cohomology does not vanish and that is needed in the argument as well.



---

archive/issue_comments_235366.json:
```json
{
    "body": "OK, thanks for the explanation!  I created a small reviewer patch, mostly to polish the formatting a bit.",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235366",
    "user": "https://github.com/pjbruin"
}
```

OK, thanks for the explanation!  I created a small reviewer patch, mostly to polish the formatting a bit.



---

archive/issue_comments_235367.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235367",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235368.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-02T22:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17632#issuecomment-235368",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050935.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-02T22:09:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17632",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17632#event-50935"
}
```
