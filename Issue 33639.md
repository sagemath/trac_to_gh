# Issue 33639: Make ModularFormsRing.gen_forms returns GradedModularFormElement object

Issue created by migration from https://trac.sagemath.org/ticket/33876

Original creator: @DavidAyotte

Original creation time: 2022-05-20 20:57:46

Keywords: modular forms gen_forms

In #31559, the Parent-Element framework was implemented for the class `ModularFormsRing`. However, there are still some inconsistencies in the code. For example:

```
sage: M = ModularFormsRing(Gamma0(11), Zmod(5))
sage: A = M.gen_forms(); A
[1 + 12*q^2 + 12*q^3 + 12*q^4 + 12*q^5 + O(q^6),
q - 2*q^2 - q^3 + 2*q^4 + q^5 + O(q^6),
q - 9*q^4 - 10*q^5 + O(q^6)]
sage: A[0].parent()
Modular Forms space of dimension 2 for Congruence Subgroup Gamma0(11) of weight 2 over Rational Field
```

(Notice that the parent of the list element is not a modular form *ring* object)

Instead, it would be preferable if the returned forms were instances of `GradedModularFormElement` (the element class of `ModularFormsRing`).

The goal of this ticket is to implement this behavior:

```
sage: A = ModularFormsRing(Gamma0(11), Zmod(5)).gen_forms(); A
[1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
q + q^4 + O(q^6)]
sage: A[0].parent()
Ring of Modular Forms for Congruence Subgroup Gamma0(11) over Ring of integers modulo 5
```



---

Comment by @DavidAyotte created at 2022-05-21 18:07:15

Changing status from new to needs_review.


---

Comment by @DavidAyotte created at 2022-05-21 18:07:15

New commits:


---

Comment by @DavidAyotte created at 2022-05-23 13:23:08

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-06-03 02:45:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2022-06-03 02:49:08

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-06-16 01:15:24

Two little quibbles:

- `Returns` -> `Return`
- Add spaces here as (IMO) it looks better
  {{{#!diff
             [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
-            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
-            q + q^4 + O(q^6)]
+             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
+             q + q^4 + O(q^6)]
  }}}

I am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.


---

Comment by @DavidAyotte created at 2022-06-16 14:37:12

Replying to [comment:7 tscrim]:
> Two little quibbles:
> 
> - `Returns` -> `Return`
> - Add spaces here as (IMO) it looks better
>   {{{#!diff
>              [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
> -            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
> -            q + q^4 + O(q^6)]
> +             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
> +             q + q^4 + O(q^6)]
>   }}}

Thanks I will fix this grammar mistake and it indeed looks better.


> I am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.

I think it would be possible to implement the method `F.change_ring()` for a graded modular form `F`. In fact, a graded modular form `F` is basically only a dictionnary `{f1 : k1, ..., fn : kn}` where `fi` is a modular form of weight `ki` (for some fixed congruence subgroup and fixed base ring). In other words, we are only varying the weights. So I guess it should be possible to implement a change ring method. I will try something.


---

Comment by git created at 2022-06-16 15:39:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-06-16 23:33:45

Thank you.

Are you also planning on adding a `change_ring()` method to the elements?

Also, little doc tweak:

```diff
-        - ``base_ring`` - a base ring, which should be `\QQ`, `\ZZ`, or the
-        integers mod `p` for some prime `p`.
+        - ``base_ring`` -- a base ring, which should be `\QQ`, `\ZZ`, or the
+          integers mod `p` for some prime `p`
```



---

Comment by @DavidAyotte created at 2022-06-16 23:51:13

Replying to [comment:10 tscrim]:
> Are you also planning on adding a `change_ring()` method to the elements?

Finally, no I'm not going to implement it in this ticket. I just noticed that it isn't yet implemented for modular forms spaces elements. I think that this should be done first in an other ticket. I will open one shortly.


---

Comment by git created at 2022-06-17 01:09:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-06-17 01:49:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-06-17 01:49:49

Thanks. This will be good enough (although the doc `INPUT` shouldn't end will a period/full-stop except in more exceptional circumstances, I won't nitpick any further for now).


---

Comment by @DavidAyotte created at 2022-06-17 01:54:38

Thank you very much Travis. Thanks for letting me know about the period for the INPUT block, I'll be careful in the future.


---

Comment by vbraun created at 2022-06-19 15:24:29

Resolution: fixed


---

Comment by @GMS103 created at 2022-06-19 21:24:13

Following a suggestion by Vincent Delecroix:  On [SageMath](SageMath) 9.7.beta3 built for Apple Silicon,
this

```
sage: hecke_series(5, 7, 10000, 5, modformsring=True) # long time (3.4s)
```

(a test taken from ```src/sage/modular/overconvergent/hecke_series.py```)
never returns.

I attach the results of interrupting on macOS 11.6.7 and macOS 12.4.

This did not happen on [SageMath](SageMath) 9.7.beta2.


---

Attachment

Thank you for notifying me, the problem is my fault and was indeed caused by this ticket, sorry! I will fix it.


---

Comment by vbraun created at 2022-06-19 22:44:24

I now got the same failure on Linux x86_64, though its clearly random. Follow-up ticket please.


---

Comment by @GMS103 created at 2022-06-20 07:33:54

Follow-up at #34025.
