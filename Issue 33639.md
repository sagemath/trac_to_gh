# Issue 33639: Make ModularFormsRing.gen_forms returns GradedModularFormElement object

archive/issues_033639.json:
```json
{
    "body": "Keywords: modular forms gen_forms\n\nIn #31559, the Parent-Element framework was implemented for the class `ModularFormsRing`. However, there are still some inconsistencies in the code. For example:\n\n```\nsage: M = ModularFormsRing(Gamma0(11), Zmod(5))\nsage: A = M.gen_forms(); A\n[1 + 12*q^2 + 12*q^3 + 12*q^4 + 12*q^5 + O(q^6),\nq - 2*q^2 - q^3 + 2*q^4 + q^5 + O(q^6),\nq - 9*q^4 - 10*q^5 + O(q^6)]\nsage: A[0].parent()\nModular Forms space of dimension 2 for Congruence Subgroup Gamma0(11) of weight 2 over Rational Field\n```\n(Notice that the parent of the list element is not a modular form **ring** object)\n\nInstead, it would be preferable if the returned forms were instances of `GradedModularFormElement` (the element class of `ModularFormsRing`).\n\nThe goal of this ticket is to implement this behavior:\n\n```\nsage: A = ModularFormsRing(Gamma0(11), Zmod(5)).gen_forms(); A\n[1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),\nq + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),\nq + q^4 + O(q^6)]\nsage: A[0].parent()\nRing of Modular Forms for Congruence Subgroup Gamma0(11) over Ring of integers modulo 5\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/33876\n\n",
    "created_at": "2022-05-20T20:57:46Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Make ModularFormsRing.gen_forms returns GradedModularFormElement object",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33639",
    "user": "https://github.com/DavidAyotte"
}
```
Keywords: modular forms gen_forms

In #31559, the Parent-Element framework was implemented for the class `ModularFormsRing`. However, there are still some inconsistencies in the code. For example:

```
sage: M = ModularFormsRing(Gamma0(11), Zmod(5))
sage: A = M.gen_forms(); A
[1 + 12*q^2 + 12*q^3 + 12*q^4 + 12*q^5 + O(q^6),
q - 2*q^2 - q^3 + 2*q^4 + q^5 + O(q^6),
q - 9*q^4 - 10*q^5 + O(q^6)]
sage: A[0].parent()
Modular Forms space of dimension 2 for Congruence Subgroup Gamma0(11) of weight 2 over Rational Field
```
(Notice that the parent of the list element is not a modular form **ring** object)

Instead, it would be preferable if the returned forms were instances of `GradedModularFormElement` (the element class of `ModularFormsRing`).

The goal of this ticket is to implement this behavior:

```
sage: A = ModularFormsRing(Gamma0(11), Zmod(5)).gen_forms(); A
[1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
q + q^4 + O(q^6)]
sage: A[0].parent()
Ring of Modular Forms for Congruence Subgroup Gamma0(11) over Ring of integers modulo 5
```

Issue created by migration from https://trac.sagemath.org/ticket/33876





---

archive/issue_comments_478333.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-21T18:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478333",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478334.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-21T18:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478334",
    "user": "https://github.com/DavidAyotte"
}
```

New commits:



---

archive/issue_comments_478335.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-23T13:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478335",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-03T02:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478337.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-03T02:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478337",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478338.json:
```json
{
    "body": "Two little quibbles:\n\n- `Returns` -> `Return`\n- Add spaces here as (IMO) it looks better\n  {{{#!diff\n             [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),\n-            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),\n-            q + q^4 + O(q^6)]\n+             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),\n+             q + q^4 + O(q^6)]\n  }}}\n\nI am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.",
    "created_at": "2022-06-16T01:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478338",
    "user": "https://github.com/tscrim"
}
```

Two little quibbles:

- `Returns` -> `Return`
- Add spaces here as (IMO) it looks better
  {{{#!diff
             [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
-            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
-            q + q^4 + O(q^6)]
+             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
+             q + q^4 + O(q^6)]
  }}}

I am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.



---

archive/issue_comments_478339.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> Two little quibbles:\n> \n> - `Returns` -> `Return`\n> - Add spaces here as (IMO) it looks better\n>   {{{#!diff\n>              [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),\n> -            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),\n> -            q + q^4 + O(q^6)]\n> +             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),\n> +             q + q^4 + O(q^6)]\n>   }}}\n\n\nThanks I will fix this grammar mistake and it indeed looks better.\n\n\n> I am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.\n\n\nI think it would be possible to implement the method `F.change_ring()` for a graded modular form `F`. In fact, a graded modular form `F` is basically only a dictionnary `{f1 : k1, ..., fn : kn}` where `fi` is a modular form of weight `ki` (for some fixed congruence subgroup and fixed base ring). In other words, we are only varying the weights. So I guess it should be possible to implement a change ring method. I will try something.",
    "created_at": "2022-06-16T14:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478339",
    "user": "https://github.com/DavidAyotte"
}
```

Replying to [comment:7 tscrim]:
> Two little quibbles:
> 
> - `Returns` -> `Return`
> - Add spaces here as (IMO) it looks better
>   {{{#!diff
>              [1 + 2*q^2 + 2*q^3 + 2*q^4 + 2*q^5 + O(q^6),
> -            q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
> -            q + q^4 + O(q^6)]
> +             q + 3*q^2 + 4*q^3 + 2*q^4 + q^5 + O(q^6),
> +             q + q^4 + O(q^6)]
>   }}}


Thanks I will fix this grammar mistake and it indeed looks better.


> I am guessing you cannot assume anything about the different parents of `F` as that ranges over all of the inputs. It might make the code cleaner (and potentially a bit faster because you can use some internal data) to have an `F.change_ring()` method. Although this is not necessary to do here unless you want to do it.


I think it would be possible to implement the method `F.change_ring()` for a graded modular form `F`. In fact, a graded modular form `F` is basically only a dictionnary `{f1 : k1, ..., fn : kn}` where `fi` is a modular form of weight `ki` (for some fixed congruence subgroup and fixed base ring). In other words, we are only varying the weights. So I guess it should be possible to implement a change ring method. I will try something.



---

archive/issue_comments_478340.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-16T15:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478341.json:
```json
{
    "body": "Thank you.\n\nAre you also planning on adding a `change_ring()` method to the elements?\n\nAlso, little doc tweak:\n\n```diff\n-        - ``base_ring`` - a base ring, which should be `\\QQ`, `\\ZZ`, or the\n-        integers mod `p` for some prime `p`.\n+        - ``base_ring`` -- a base ring, which should be `\\QQ`, `\\ZZ`, or the\n+          integers mod `p` for some prime `p`\n```",
    "created_at": "2022-06-16T23:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478341",
    "user": "https://github.com/tscrim"
}
```

Thank you.

Are you also planning on adding a `change_ring()` method to the elements?

Also, little doc tweak:

```diff
-        - ``base_ring`` - a base ring, which should be `\QQ`, `\ZZ`, or the
-        integers mod `p` for some prime `p`.
+        - ``base_ring`` -- a base ring, which should be `\QQ`, `\ZZ`, or the
+          integers mod `p` for some prime `p`
```



---

archive/issue_comments_478342.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> Are you also planning on adding a `change_ring()` method to the elements?\n\n\nFinally, no I'm not going to implement it in this ticket. I just noticed that it isn't yet implemented for modular forms spaces elements. I think that this should be done first in an other ticket. I will open one shortly.",
    "created_at": "2022-06-16T23:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478342",
    "user": "https://github.com/DavidAyotte"
}
```

Replying to [comment:10 tscrim]:
> Are you also planning on adding a `change_ring()` method to the elements?


Finally, no I'm not going to implement it in this ticket. I just noticed that it isn't yet implemented for modular forms spaces elements. I think that this should be done first in an other ticket. I will open one shortly.



---

archive/issue_comments_478343.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-17T01:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478344.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-17T01:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478344",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478345.json:
```json
{
    "body": "Thanks. This will be good enough (although the doc `INPUT` shouldn't end will a period/full-stop except in more exceptional circumstances, I won't nitpick any further for now).",
    "created_at": "2022-06-17T01:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478345",
    "user": "https://github.com/tscrim"
}
```

Thanks. This will be good enough (although the doc `INPUT` shouldn't end will a period/full-stop except in more exceptional circumstances, I won't nitpick any further for now).



---

archive/issue_comments_478346.json:
```json
{
    "body": "Thank you very much Travis. Thanks for letting me know about the period for the INPUT block, I'll be careful in the future.",
    "created_at": "2022-06-17T01:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478346",
    "user": "https://github.com/DavidAyotte"
}
```

Thank you very much Travis. Thanks for letting me know about the period for the INPUT block, I'll be careful in the future.



---

archive/issue_comments_478347.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-19T15:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478347",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088871.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-19T15:24:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33639#event-88871"
}
```



---

archive/issue_comments_478348.json:
```json
{
    "body": "Following a suggestion by Vincent Delecroix:  On [SageMath](SageMath) 9.7.beta3 built for Apple Silicon,\nthis\n\n```\nsage: hecke_series(5, 7, 10000, 5, modformsring=True) # long time (3.4s)\n```\n(a test taken from ```src/sage/modular/overconvergent/hecke_series.py```)\nnever returns.\n\nI attach the results of interrupting on macOS 11.6.7 and macOS 12.4.\n\nThis did not happen on [SageMath](SageMath) 9.7.beta2.",
    "created_at": "2022-06-19T21:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478348",
    "user": "https://github.com/GMS103"
}
```

Following a suggestion by Vincent Delecroix:  On [SageMath](SageMath) 9.7.beta3 built for Apple Silicon,
this

```
sage: hecke_series(5, 7, 10000, 5, modformsring=True) # long time (3.4s)
```
(a test taken from ```src/sage/modular/overconvergent/hecke_series.py```)
never returns.

I attach the results of interrupting on macOS 11.6.7 and macOS 12.4.

This did not happen on [SageMath](SageMath) 9.7.beta2.



---

archive/issue_comments_478349.json:
```json
{
    "body": "Attachment [hecke_series stuck.txt](tarball://root/attachments/some-uuid/ticket33876/hecke_series stuck.txt) by @DavidAyotte created at 2022-06-19 21:33:30\n\nThank you for notifying me, the problem is my fault and was indeed caused by this ticket, sorry! I will fix it.",
    "created_at": "2022-06-19T21:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478349",
    "user": "https://github.com/DavidAyotte"
}
```

Attachment [hecke_series stuck.txt](tarball://root/attachments/some-uuid/ticket33876/hecke_series stuck.txt) by @DavidAyotte created at 2022-06-19 21:33:30

Thank you for notifying me, the problem is my fault and was indeed caused by this ticket, sorry! I will fix it.



---

archive/issue_comments_478350.json:
```json
{
    "body": "I now got the same failure on Linux x86_64, though its clearly random. Follow-up ticket please.",
    "created_at": "2022-06-19T22:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478350",
    "user": "https://github.com/vbraun"
}
```

I now got the same failure on Linux x86_64, though its clearly random. Follow-up ticket please.



---

archive/issue_comments_478351.json:
```json
{
    "body": "Follow-up at #34025.",
    "created_at": "2022-06-20T07:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33639#issuecomment-478351",
    "user": "https://github.com/GMS103"
}
```

Follow-up at #34025.
