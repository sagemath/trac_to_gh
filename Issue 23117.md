# Issue 23117: numerical noise in libs/lcalc/lcalc_Lfuntion.pyx with clang-4 and icc

Issue created by migration from https://trac.sagemath.org/ticket/23354

Original creator: fbissey

Original creation time: 2017-07-03 02:14:36

CC:  dimpase

One doctest in `libs/lcalc/lcalc_Lfuntion.pyx` fails because of excessive numerical noise when sage is compiled with clang >= 4.0 or icc (17.04).

clang-4.0.1

```
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 188, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(0)
Expected:
    0.7939675904771...
Got:
    0.793967590477206 - 4.03312243040125e-17*I
```

icc:

```
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 188, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(0)
Expected:
    0.7939675904771...
Got:
    0.793967590477208 - 4.03312243040124e-17*I
```




---

Comment by fbissey created at 2017-07-03 02:17:10

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-07-03 05:41:29

No commit on the branch.


---

Comment by jdemeyer created at 2017-07-03 05:41:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-07-03 06:28:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2017-07-03 06:28:30

Ooops. There is now.


---

Comment by dimpase created at 2017-07-03 10:05:03

The question is whether we should rather remove `-ffast-math` from the flags---which probably will fix this noise by itself. I haven't tried this yet.


---

Comment by fbissey created at 2017-07-03 10:09:20

If we have the flag for gcc as well, it is not obvious which way things will go. All three may converge to something slightly different again.


---

Comment by dimpase created at 2017-07-03 10:17:14

OK.


---

Comment by dimpase created at 2017-07-03 10:17:14

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-07-26 22:12:48

Resolution: fixed
