# Issue 32278: linuxmint-17, ubuntu-trusty: scipy build error with pybind11

Issue created by migration from https://trac.sagemath.org/ticket/32515

Original creator: mkoeppe

Original creation time: 2021-09-14 20:32:46

CC:  dimpase mjo jhpalmieri @kliem

On `linuxmint-17-minimal` (https://github.com/sagemath/sage/runs/3593003595)

```
  gcc -pthread -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -L. -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib build/temp.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.o -L/sage/local/lib -Lbuild/temp.linux-x86_64-3.9 -o build/lib.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.cpython-39-x86_64-linux-gnu.so -Wl,--version-script=build/temp.linux-x86_64-3.9/link-version-scipy.cluster._optimal_leaf_ordering.map
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpif5aglmi/tmp
  creating /tmp/tmpif5aglmi/tmp/tmpif5aglmi
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-std=c++14'
  g++: /tmp/tmpif5aglmi/main.cpp
  g++: error: unrecognized command line option '-std=c++14'
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpjrgp9vmy/tmp
  creating /tmp/tmpjrgp9vmy/tmp/tmpjrgp9vmy
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-std=c++11'
  g++: /tmp/tmpjrgp9vmy/main.cpp
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpik_q_vbd/tmp
  creating /tmp/tmpik_q_vbd/tmp/tmpik_q_vbd
  compile options: '-I/sage/local/include/python3.9 -c'
  g++: /tmp/tmpik_q_vbd/main.c
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpv4ojh26z/tmp
  creating /tmp/tmpv4ojh26z/tmp/tmpv4ojh26z
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-pthread'
  g++: /tmp/tmpv4ojh26z/main.c
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

   creating build/temp.linux-x86_64-3.9/scipy/fft
  creating build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft
  compile options: '-DPOCKETFFT_PTHREADS -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/src.linux-x86_64-3.9/numpy/distutils/include -I/sage/local/include/python3.9 -c'
  extra options: '-std=c++11 -pthread -fvisibility=hidden -msse -msse2 -msse3'
  g++: scipy/fft/_pocketfft/pypocketfft.cxx
  In file included from scipy/fft/_pocketfft/pypocketfft.cxx:16:0:
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'
       std::is_trivially_copyable<T>,
       ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:33: error: template argument 2 is invalid
       std::is_trivially_copyable<T>,
                                   ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                   ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:72: error: template argument 1 is invalid
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                                          ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:75: error: template argument 2 is invalid
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                                             ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:80: error: expected unqualified-id before '>' token
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
```


Likely caused by the `pybind11` update done as part of the Jupyter upgrade in #31280.


---

Comment by mkoeppe created at 2021-09-15 02:56:44

I don't see anything in the `pybind11` changelog nor in https://pybind11.readthedocs.io/en/stable/upgrade.html that indicates that C++14 would now be needed


---

Comment by mkoeppe created at 2021-09-15 03:15:06

OK, C++14 is irrelevant. Looks like the failing compilers do not implement C++11 completely. 
https://stackoverflow.com/questions/25123458/is-trivially-copyable-is-not-a-member-of-std


---

Comment by mkoeppe created at 2021-09-15 04:15:16

Relevant: https://github.com/pybind/pybind11/pull/2956 (https://github.com/pybind/pybind11/commit/e08a58111dbea38d667b209f7543864d51a3b185#diff-32496cc1f174bae1792ee91e0228cb198995509d66c039d64a3739f9c777cf10)


---

Comment by mkoeppe created at 2021-09-15 05:11:16

New commits:


---

Comment by git created at 2021-09-15 05:40:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-09-15 06:05:36

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-09-15 06:05:36

Tested successfully using `tox -e docker-ubuntu-trusty-standard -- scipy`


---

Comment by mkoeppe created at 2021-09-15 06:05:36

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-23 13:30:54

Let's get this in please


---

Comment by @kliem created at 2021-09-23 13:59:25

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2021-09-23 13:59:25

LGTM.


---

Comment by mkoeppe created at 2021-09-23 14:51:59

Thank you!


---

Comment by vbraun created at 2021-10-09 11:10:43

Resolution: fixed
