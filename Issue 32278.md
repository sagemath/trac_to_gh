# Issue 32278: linuxmint-17, ubuntu-trusty: scipy build error with pybind11

archive/issues_032278.json:
```json
{
    "body": "CC:  @dimpase @orlitzky @jhpalmieri @kliem\n\nOn `linuxmint-17-minimal` (https://github.com/sagemath/sage/runs/3593003595)\n\n```\n  gcc -pthread -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -L. -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib build/temp.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.o -L/sage/local/lib -Lbuild/temp.linux-x86_64-3.9 -o build/lib.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.cpython-39-x86_64-linux-gnu.so -Wl,--version-script=build/temp.linux-x86_64-3.9/link-version-scipy.cluster._optimal_leaf_ordering.map\n  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC\n\n  creating /tmp/tmpif5aglmi/tmp\n  creating /tmp/tmpif5aglmi/tmp/tmpif5aglmi\n  compile options: '-I/sage/local/include/python3.9 -c'\n  extra options: '-std=c++14'\n  g++: /tmp/tmpif5aglmi/main.cpp\n  g++: error: unrecognized command line option '-std=c++14'\n  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC\n\n  creating /tmp/tmpjrgp9vmy/tmp\n  creating /tmp/tmpjrgp9vmy/tmp/tmpjrgp9vmy\n  compile options: '-I/sage/local/include/python3.9 -c'\n  extra options: '-std=c++11'\n  g++: /tmp/tmpjrgp9vmy/main.cpp\n  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC\n\n  creating /tmp/tmpik_q_vbd/tmp\n  creating /tmp/tmpik_q_vbd/tmp/tmpik_q_vbd\n  compile options: '-I/sage/local/include/python3.9 -c'\n  g++: /tmp/tmpik_q_vbd/main.c\n  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC\n\n  creating /tmp/tmpv4ojh26z/tmp\n  creating /tmp/tmpv4ojh26z/tmp/tmpv4ojh26z\n  compile options: '-I/sage/local/include/python3.9 -c'\n  extra options: '-pthread'\n  g++: /tmp/tmpv4ojh26z/main.c\n  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC\n\n   creating build/temp.linux-x86_64-3.9/scipy/fft\n  creating build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft\n  compile options: '-DPOCKETFFT_PTHREADS -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/src.linux-x86_64-3.9/numpy/distutils/include -I/sage/local/include/python3.9 -c'\n  extra options: '-std=c++11 -pthread -fvisibility=hidden -msse -msse2 -msse3'\n  g++: scipy/fft/_pocketfft/pypocketfft.cxx\n  In file included from scipy/fft/_pocketfft/pypocketfft.cxx:16:0:\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'\n       std::is_trivially_copyable<T>,\n       ^\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:33: error: template argument 2 is invalid\n       std::is_trivially_copyable<T>,\n                                   ^\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'\n   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {\n                                                   ^\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:72: error: template argument 1 is invalid\n   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {\n                                                                          ^\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:75: error: template argument 2 is invalid\n   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {\n                                                                             ^\n  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:80: error: expected unqualified-id before '>' token\n   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {\n\n\nerror: Command \"g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC -DPOCKETFFT_PTHREADS -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/src.linux-x86_64-3.9/numpy/distutils/include -I/sage/local/include/python3.9 -c scipy/fft/_pocketfft/pypocketfft.cxx -o build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft/pypocketfft.o -MMD -MF build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft/pypocketfft.o.d -std=c++11 -pthread -fvisibility=hidden -msse -msse2 -msse3\" failed with exit status 1\n```\n\nLikely caused by the `pybind11` update (from 2.6.0 to 2.7.1; https://pybind11.readthedocs.io/en/stable/changelog.html) done as part of the Jupyter upgrade in #31280.\n\nBroken:\n- `linuxmint-17` (gcc 4.8.4-2ubuntu1~14.04.3, `__GLIBCXX__ = 20150426`), \n- `ubuntu-trusty` (4.8.4-2ubuntu1~14.04.4, `__GLIBCXX__ = 20150426`)\n\nOK:\n- `centos-7` 4.8.5 20150623 (Red Hat 4.8.5-44, `__GLIBCXX__ = 20150623`)\n- `debian-jessie` (gcc 4.9.2-10+deb8u2), \n- `linuxmint-18` (gcc 5.4.0-6ubuntu1~16.04.6), \n- `fedora-26` (7.3.1 20180130 (Red Hat 7.3.1-2))\n\nOpened `pybind11` upstream issue: https://github.com/pybind/pybind11/issues/3269, PR https://github.com/pybind/pybind11/pull/3270 (merged in the 2.7 maintenance branch)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32515\n\n",
    "closed_at": "2021-10-09T11:10:43Z",
    "created_at": "2021-09-14T20:32:46Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "linuxmint-17, ubuntu-trusty: scipy build error with pybind11",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32278",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @orlitzky @jhpalmieri @kliem

On `linuxmint-17-minimal` (https://github.com/sagemath/sage/runs/3593003595)

```
  gcc -pthread -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -L. -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib build/temp.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.o -L/sage/local/lib -Lbuild/temp.linux-x86_64-3.9 -o build/lib.linux-x86_64-3.9/scipy/cluster/_optimal_leaf_ordering.cpython-39-x86_64-linux-gnu.so -Wl,--version-script=build/temp.linux-x86_64-3.9/link-version-scipy.cluster._optimal_leaf_ordering.map
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpif5aglmi/tmp
  creating /tmp/tmpif5aglmi/tmp/tmpif5aglmi
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-std=c++14'
  g++: /tmp/tmpif5aglmi/main.cpp
  g++: error: unrecognized command line option '-std=c++14'
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpjrgp9vmy/tmp
  creating /tmp/tmpjrgp9vmy/tmp/tmpjrgp9vmy
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-std=c++11'
  g++: /tmp/tmpjrgp9vmy/main.cpp
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpik_q_vbd/tmp
  creating /tmp/tmpik_q_vbd/tmp/tmpik_q_vbd
  compile options: '-I/sage/local/include/python3.9 -c'
  g++: /tmp/tmpik_q_vbd/main.c
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

  creating /tmp/tmpv4ojh26z/tmp
  creating /tmp/tmpv4ojh26z/tmp/tmpv4ojh26z
  compile options: '-I/sage/local/include/python3.9 -c'
  extra options: '-pthread'
  g++: /tmp/tmpv4ojh26z/main.c
  C compiler: g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC

   creating build/temp.linux-x86_64-3.9/scipy/fft
  creating build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft
  compile options: '-DPOCKETFFT_PTHREADS -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/src.linux-x86_64-3.9/numpy/distutils/include -I/sage/local/include/python3.9 -c'
  extra options: '-std=c++11 -pthread -fvisibility=hidden -msse -msse2 -msse3'
  g++: scipy/fft/_pocketfft/pypocketfft.cxx
  In file included from scipy/fft/_pocketfft/pypocketfft.cxx:16:0:
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'
       std::is_trivially_copyable<T>,
       ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:5: error: 'is_trivially_copyable' is not a member of 'std'
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:328:33: error: template argument 2 is invalid
       std::is_trivially_copyable<T>,
                                   ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                   ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:49: error: 'is_pod_struct' is not a member of 'pybind11::detail'
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:72: error: template argument 1 is invalid
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                                          ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:75: error: template argument 2 is invalid
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {
                                                                             ^
  /sage/local/lib/python3.9/site-packages/pybind11/include/pybind11/numpy.h:968:80: error: expected unqualified-id before '>' token
   struct format_descriptor<T, detail::enable_if_t<detail::is_pod_struct<T>::value>> {


error: Command "g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -fPIC -DPOCKETFFT_PTHREADS -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/pybind11/include -I/sage/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/src.linux-x86_64-3.9/numpy/distutils/include -I/sage/local/include/python3.9 -c scipy/fft/_pocketfft/pypocketfft.cxx -o build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft/pypocketfft.o -MMD -MF build/temp.linux-x86_64-3.9/scipy/fft/_pocketfft/pypocketfft.o.d -std=c++11 -pthread -fvisibility=hidden -msse -msse2 -msse3" failed with exit status 1
```

Likely caused by the `pybind11` update (from 2.6.0 to 2.7.1; https://pybind11.readthedocs.io/en/stable/changelog.html) done as part of the Jupyter upgrade in #31280.

Broken:
- `linuxmint-17` (gcc 4.8.4-2ubuntu1~14.04.3, `__GLIBCXX__ = 20150426`), 
- `ubuntu-trusty` (4.8.4-2ubuntu1~14.04.4, `__GLIBCXX__ = 20150426`)

OK:
- `centos-7` 4.8.5 20150623 (Red Hat 4.8.5-44, `__GLIBCXX__ = 20150623`)
- `debian-jessie` (gcc 4.9.2-10+deb8u2), 
- `linuxmint-18` (gcc 5.4.0-6ubuntu1~16.04.6), 
- `fedora-26` (7.3.1 20180130 (Red Hat 7.3.1-2))

Opened `pybind11` upstream issue: https://github.com/pybind/pybind11/issues/3269, PR https://github.com/pybind/pybind11/pull/3270 (merged in the 2.7 maintenance branch)


Issue created by migration from https://trac.sagemath.org/ticket/32515





---

archive/issue_comments_460378.json:
```json
{
    "body": "I don't see anything in the `pybind11` changelog nor in https://pybind11.readthedocs.io/en/stable/upgrade.html that indicates that C++14 would now be needed",
    "created_at": "2021-09-15T02:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460378",
    "user": "https://github.com/mkoeppe"
}
```

I don't see anything in the `pybind11` changelog nor in https://pybind11.readthedocs.io/en/stable/upgrade.html that indicates that C++14 would now be needed



---

archive/issue_comments_460379.json:
```json
{
    "body": "OK, C++14 is irrelevant. Looks like the failing compilers do not implement C++11 completely. \nhttps://stackoverflow.com/questions/25123458/is-trivially-copyable-is-not-a-member-of-std",
    "created_at": "2021-09-15T03:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460379",
    "user": "https://github.com/mkoeppe"
}
```

OK, C++14 is irrelevant. Looks like the failing compilers do not implement C++11 completely. 
https://stackoverflow.com/questions/25123458/is-trivially-copyable-is-not-a-member-of-std



---

archive/issue_comments_460380.json:
```json
{
    "body": "Relevant: https://github.com/pybind/pybind11/pull/2956 (https://github.com/pybind/pybind11/commit/e08a58111dbea38d667b209f7543864d51a3b185#diff-32496cc1f174bae1792ee91e0228cb198995509d66c039d64a3739f9c777cf10)",
    "created_at": "2021-09-15T04:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460380",
    "user": "https://github.com/mkoeppe"
}
```

Relevant: https://github.com/pybind/pybind11/pull/2956 (https://github.com/pybind/pybind11/commit/e08a58111dbea38d667b209f7543864d51a3b185#diff-32496cc1f174bae1792ee91e0228cb198995509d66c039d64a3739f9c777cf10)



---

archive/issue_comments_460381.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-15T05:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460381",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_460382.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-15T05:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_460383.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-09-15T06:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460383",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_460384.json:
```json
{
    "body": "Tested successfully using `tox -e docker-ubuntu-trusty-standard -- scipy`",
    "created_at": "2021-09-15T06:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460384",
    "user": "https://github.com/mkoeppe"
}
```

Tested successfully using `tox -e docker-ubuntu-trusty-standard -- scipy`



---

archive/issue_comments_460385.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-15T06:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460385",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_460386.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2021-09-23T13:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460386",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_460387.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-23T13:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460387",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_460388.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-09-23T13:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460388",
    "user": "https://github.com/kliem"
}
```

LGTM.



---

archive/issue_comments_460389.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-09-23T14:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460389",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_events_086223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-09T11:10:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32278#event-86223"
}
```



---

archive/issue_comments_460390.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-09T11:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32278#issuecomment-460390",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
