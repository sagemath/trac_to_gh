# Issue 22260: generic latte_int interface to count

Issue created by migration from https://trac.sagemath.org/ticket/22497

Original creator: vdelecroix

Original creation time: 2017-03-02 17:18:18

CC:  mkoeppe tmonteil

We provide a file `sage/geometry/polyhedron/latte.py` that provides a uniform function `latte_count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.

Prerequisite for #18232.


---

Comment by vdelecroix created at 2017-03-02 17:19:49

Changing keywords from "" to "days84".


---

Comment by tmonteil created at 2017-03-02 17:32:11

Why not putting this in the `interfaces` section ?


---

Comment by vdelecroix created at 2017-03-02 23:02:07

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-03-02 23:02:22

New commits:


---

Comment by git created at 2017-03-02 23:02:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-03-02 23:04:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2017-03-03 16:38:15

Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.


---

Comment by vdelecroix created at 2017-03-04 09:05:27

Replying to [comment:7 mkoeppe]:
> Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.

This would be nice to have but not implemented. Did you have something in mind? The implementation I have in mind is a kind of challenge since you have to play with the bytecode of the function...


---

Comment by mkoeppe created at 2017-03-04 09:13:01

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2017-03-04 09:13:01

OK, separate ticket then


---

Comment by fbissey created at 2017-03-04 20:09:24

I have one failure when `latte_int` is not installed

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/latte.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 51, in sage.interfaces.latte.count
Failed example:
    count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 501, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 864, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.latte.count[2]>", line 1, in <module>
        count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 149, in count
        raise RuntimeError("LattE integrale program failed (exit code {})".format(ret_code) + err.strip())
    RuntimeError: LattE integrale program failed (exit code 2):
    usage: count <expected line count>
**********************************************************************
1 item had failures:
```

I see this test is not marked `optional`, is it normal?


---

Comment by vdelecroix created at 2017-03-04 21:30:39

Changing status from positive_review to needs_work.


---

Comment by vdelecroix created at 2017-03-04 21:30:39

it is not. Thanks for testing.


---

Comment by git created at 2017-03-04 21:48:07

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2017-03-04 21:53:14

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-03-05 15:13:32

Resolution: fixed


---

Comment by slabbe created at 2017-03-17 09:00:57

When looking at this branch, I could not understand how the problem solved in #21491 was not reappearing. I tested 7.6.rc0 and everything was fine so I could not understand. I just realized the existence of #22577 which is a follow up of this ticket. So now I understand everything, and everything is great, thank you!
