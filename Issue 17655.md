# Issue 17655: Sage cannot work with Maxima's symbolic limit

Issue created by migration from https://trac.sagemath.org/ticket/17892

Original creator: rws

Original creation time: 2015-03-04 15:36:19

Maxima gives back limit expressions in some integral computation but Sage has no idea what that is. Consequently, working with the expression leads to failure:

```
sage: u(t) = exp(-(t-a)^2/(2*s^2)) + exp(-(t-b)^2/(2*s^2)) ; u(t);
sage: integral(u(t)*exp(-I*k*t), t, -infinity, +infinity, hold=False)
-limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus) + limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, +Infinity, minus)
sage: _.simplify_full()
...
TypeError: ECL says: Error executing code in Maxima: 
```

Presumably a symbolic limit function would be necessary, and to connect it with what Maxima gives back.

Is there a smaller example?


---

Comment by nbruin created at 2015-03-05 00:07:23

Funnily enough it's not the limit placeholder that seems to be the primary issue. For the most part, the generic stuff just works for that. It's the "plus" or "minus" keyword that confuses things.

```
sage: L=I.operands()[0].operands()[0]
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)
sage: Ls=L.operator()(*L.operands()[:-1]); Ls
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity)
sage: Ls.simplify_full()
1/2*sqrt(pi)*e^(-1/2*k^2*s^2 - I*a*k - I*b*k)*limit(sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(I*a*k) + sqrt(2)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(I*b*k), t, -Infinity)
```

i.e., the direct problem is that the keyword "plus" does not get translated appropriately. In fact:

```
sage: L.operands()[-1].is_symbol()
True
sage: L.operands()[-1]._maxima_()
_SAGE_VAR_plus
```

as you can see, the maxima symbol "plus" got translated to a symbolic variable, which doesn't round-trip properly. It would have been nice to recognize "plus" on the maxima side not into a variable.

For the rest:

```
sage: limit(L.operands()[0],t=-oo,dir='+')
limit(1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*a + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*a*k) + 1/2*sqrt(2)*sqrt(pi)*s*erf(1/2*(I*sqrt(2)*k*s^2 - sqrt(2)*b + sqrt(2)*t)/s)*e^(-1/2*k^2*s^2 - I*b*k), t, -Infinity, plus)
```

which gives a bit of a pointer to the sage user interface (we shouldn't use that as "placeholder", though: it punts to maxima by default, so it shouldn't be called for interpreting the result that comes back).


---

Comment by kcrisman created at 2015-09-14 01:29:06

Conceivably related: #19203


---

Comment by rws created at 2017-06-08 16:21:59

The limit part appears to work now, i.e. the limit is evaluated and gives `sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*a*k) + sqrt(2)*sqrt(pi)*s*e<sup>(-1/2*k</sup>2*s^2 - I*b*k)`. This means the simplify part is no longer in a code path. I propose to close the original issue. Is there something left?


---

Comment by rws created at 2017-06-08 16:21:59

Changing status from new to needs_review.


---

Comment by rws created at 2017-12-26 14:35:42

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-12-26 14:35:42

No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.


---

Comment by rws created at 2018-01-10 14:43:23

Replying to [comment:5 rws]:
> No, rather this ticket should add an example calling Maxima's integral that is guaranteed to return a one-sided limit.

Also, the interface to Maxima wrt plus/minus is broken with the placeholder function as well:

```
sage: from sage.functions.other import symbolic_limit as slimit
sage: _ = var('plus')
sage: slimit(1/x, x, 0, plus)
limit(1/x, x, 0, plus)
sage: maxima(_)
...
TypeError: Error executing code in Maxima
CODE:
	sage4 : limit((_SAGE_VAR_x)^(-1),_SAGE_VAR_x,0,_SAGE_VAR_plus)$
Maxima ERROR:
	
limit: direction must be either 'plus' or 'minus'; found: _SAGE_VAR_plus
 -- an error. To debug this try: debugmode(true);
```

