# Issue 26823: Fix various invalid uses of sig_on()

archive/issues_026823.json:
```json
{
    "body": "In order to debug crashes with cypari2 (#26442), I added some checks to cypari2. But these checks are now failing because `sig_on()` is regularly used badly inside Sage.\n\nIn particular, this branch removes code inside `sig_on()` which can potentially cause Python garbage collection.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27060\n\n",
    "created_at": "2019-01-15T12:23:52Z",
    "labels": [
        "component: cython",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Fix various invalid uses of sig_on()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26823",
    "user": "https://github.com/jdemeyer"
}
```
In order to debug crashes with cypari2 (#26442), I added some checks to cypari2. But these checks are now failing because `sig_on()` is regularly used badly inside Sage.

In particular, this branch removes code inside `sig_on()` which can potentially cause Python garbage collection.

Issue created by migration from https://trac.sagemath.org/ticket/27060





---

archive/issue_comments_376898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-15T13:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-15T15:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376900.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-15T15:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376900",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_events_067215.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26823#event-67215"
}
```



---

archive/issue_comments_376901.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376901",
    "user": "https://github.com/embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_376902.json:
```json
{
    "body": "On the macro-scale this LGTM. On the details, the person I'd choose to review this is you. But since you already made the commit...",
    "created_at": "2019-01-17T19:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376902",
    "user": "https://github.com/timokau"
}
```

On the macro-scale this LGTM. On the details, the person I'd choose to review this is you. But since you already made the commit...



---

archive/issue_comments_376903.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-17T19:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376903",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376904.json:
```json
{
    "body": "Could you say a little bit more about why these `sig_on()` are not correct?  Is it because they're releasing the GIL inappropriately?",
    "created_at": "2019-01-18T12:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376904",
    "user": "https://github.com/embray"
}
```

Could you say a little bit more about why these `sig_on()` are not correct?  Is it because they're releasing the GIL inappropriately?



---

archive/issue_comments_376905.json:
```json
{
    "body": "Replying to [comment:8 embray]:\n> Could you say a little bit more about why these `sig_on()` are not correct?  Is it because they're releasing the GIL inappropriately?\n\nI updated the ticket description, I hope it is clearer now. It has nothing to do with the GIL.",
    "created_at": "2019-01-18T13:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376905",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 embray]:
> Could you say a little bit more about why these `sig_on()` are not correct?  Is it because they're releasing the GIL inappropriately?

I updated the ticket description, I hope it is clearer now. It has nothing to do with the GIL.



---

archive/issue_comments_376906.json:
```json
{
    "body": "I see what you're saying now--thank you.",
    "created_at": "2019-01-18T13:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376906",
    "user": "https://github.com/embray"
}
```

I see what you're saying now--thank you.



---

archive/issue_comments_376907.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-26T15:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26823#issuecomment-376907",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-26T15:55:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26823",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26823#event-67216"
}
```
