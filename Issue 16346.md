# Issue 16346: clean up fmpz_t and fmpz_poly_t declarations

archive/issues_016346.json:
```json
{
    "body": "Keywords: sd59\n\nUpdate fmpz.pxi and fmpz_poly.pxi so that Cython doesn't complain about referenced before assigment any more.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16583\n\n",
    "created_at": "2014-06-28T17:14:18Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "clean up fmpz_t and fmpz_poly_t declarations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16346",
    "user": "https://github.com/malb"
}
```
Keywords: sd59

Update fmpz.pxi and fmpz_poly.pxi so that Cython doesn't complain about referenced before assigment any more.

Issue created by migration from https://trac.sagemath.org/ticket/16583





---

archive/issue_comments_214140.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-06-28T17:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214140",
    "user": "https://github.com/malb"
}
```

New commits:



---

archive/issue_comments_214141.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-28T17:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214141",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_214142.json:
```json
{
    "body": "This needs to be rebased, there is a conflict..",
    "created_at": "2014-07-21T18:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214142",
    "user": "https://github.com/fchapoton"
}
```

This needs to be rebased, there is a conflict..



---

archive/issue_comments_214143.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-07-21T18:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214143",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_214144.json:
```json
{
    "body": "and a typo in the second commit, by the way.",
    "created_at": "2014-07-21T18:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214144",
    "user": "https://github.com/fchapoton"
}
```

and a typo in the second commit, by the way.



---

archive/issue_comments_214145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-22T14:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214146.json:
```json
{
    "body": "rebased & fixed typo",
    "created_at": "2014-07-22T14:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214146",
    "user": "https://github.com/malb"
}
```

rebased & fixed typo



---

archive/issue_comments_214147.json:
```json
{
    "body": "Is this related to #13532 ?",
    "created_at": "2014-07-25T11:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214147",
    "user": "https://github.com/fchapoton"
}
```

Is this related to #13532 ?



---

archive/issue_comments_214148.json:
```json
{
    "body": "Yep, it removes some of those warnings. The big TODO is to fix mpz_t, though, which is a lot of work.",
    "created_at": "2014-07-25T15:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214148",
    "user": "https://github.com/malb"
}
```

Yep, it removes some of those warnings. The big TODO is to fix mpz_t, though, which is a lot of work.



---

archive/issue_comments_214149.json:
```json
{
    "body": "I rebased on 6.4.beta1, hopefully in a correct way\n----\nNew commits:",
    "created_at": "2014-08-26T17:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214149",
    "user": "https://github.com/fchapoton"
}
```

I rebased on 6.4.beta1, hopefully in a correct way
----
New commits:



---

archive/issue_comments_214150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-26T17:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214151.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-27T08:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214151",
    "user": "https://github.com/malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_214152.json:
```json
{
    "body": "I guess this should be 'needs review'. Your rebasing looks good.",
    "created_at": "2014-08-27T08:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214152",
    "user": "https://github.com/malb"
}
```

I guess this should be 'needs review'. Your rebasing looks good.



---

archive/issue_comments_214153.json:
```json
{
    "body": "In `src/sage/libs/flint/fmpz_poly.pxd`, what's the reason you remove the declaration for `fmpz_poly_reverse` but not `fmpz_poly_revert_series`? I think both can be removed.",
    "created_at": "2014-08-27T20:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214153",
    "user": "https://github.com/jdemeyer"
}
```

In `src/sage/libs/flint/fmpz_poly.pxd`, what's the reason you remove the declaration for `fmpz_poly_reverse` but not `fmpz_poly_revert_series`? I think both can be removed.



---

archive/issue_comments_214154.json:
```json
{
    "body": "Looks good. If you agree with my reviewer patch, then it's positive_review for me.\n----\nNew commits:",
    "created_at": "2014-08-27T21:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214154",
    "user": "https://github.com/jdemeyer"
}
```

Looks good. If you agree with my reviewer patch, then it's positive_review for me.
----
New commits:



---

archive/issue_comments_214155.json:
```json
{
    "body": "looks good.",
    "created_at": "2014-08-27T21:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214155",
    "user": "https://github.com/malb"
}
```

looks good.



---

archive/issue_comments_214156.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-27T21:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214156",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_214157.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-08-27T21:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214157",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_214158.json:
```json
{
    "body": "Sorry, just found an issue. In `fmpq_poly.pxd`, there still is\n\n```\n    ctypedef void * fmpz_t\n    ctypedef void * fmpq_poly_t\n```\n\nI'll create a patch.",
    "created_at": "2014-08-27T21:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214158",
    "user": "https://github.com/jdemeyer"
}
```

Sorry, just found an issue. In `fmpq_poly.pxd`, there still is

```
    ctypedef void * fmpz_t
    ctypedef void * fmpq_poly_t
```

I'll create a patch.



---

archive/issue_comments_214159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-27T21:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214160.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-27T21:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214160",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_214161.json:
```json
{
    "body": "Looks good.",
    "created_at": "2014-08-28T08:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214161",
    "user": "https://github.com/malb"
}
```

Looks good.



---

archive/issue_comments_214162.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-28T08:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214162",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_214163.json:
```json
{
    "body": "Some doctests still import `fmpq_poly.pxd`:\n\n```\nsage -t --long src/sage/misc/cython.py\n**********************************************************************\nFile \"src/sage/misc/cython.py\", line 254, in sage.misc.cython.pyx_preparse\nFailed example:\n    module = sage.misc.cython.import_test(\"trac11680\")  # long time (7s on sage.math, 2012)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 480, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 843, in compile_and_execute\n        exec compiled in globs\n      File \"<doctest sage.misc.cython.pyx_preparse[9]>\", line 1, in <module>\n        module = sage.misc.cython.import_test(\"trac11680\")  # long time (7s on sage.math, 2012)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 805, in import_test\n        return compile_and_load(TESTS[name])\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 757, in compile_and_load\n        return cython_import(file, create_local_c_file=False)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/server/support.py\", line 447, in cython_import\n        **kwds)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 493, in cython\n        raise RuntimeError(\"Error converting {} to C:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error converting /home/buildslave-sage/slave/sage_git/dot_sage/temp/desktop/29631/tmp_i0rQYs.pyx to C:\n\n\n    Error compiling Cython file:\n    ------------------------------------------------------------\n    ...\n    #cinclude $SAGE_SRC/sage/libs/flint $SAGE_LOCAL/include/FLINT\n    #clib flint\n\n    from sage.rings.rational cimport Rational\n    from sage.rings.polynomial.polynomial_rational_flint cimport Polynomial_rational_flint\n    from sage.libs.flint.fmpq_poly cimport (fmpq_poly_get_coeff_mpq, fmpq_poly_set_coeff_mpq,\n    ^\n    ------------------------------------------------------------\n\n    _home_buildslave_sage_slave_sage_git_dot_sage_temp_desktop_29631_tmp_i0rQYs_pyx_0.pyx:13:0: 'sage.libs.flint.fmpq_poly.pxd' not found\n```\n",
    "created_at": "2014-08-28T15:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214163",
    "user": "https://github.com/vbraun"
}
```

Some doctests still import `fmpq_poly.pxd`:

```
sage -t --long src/sage/misc/cython.py
**********************************************************************
File "src/sage/misc/cython.py", line 254, in sage.misc.cython.pyx_preparse
Failed example:
    module = sage.misc.cython.import_test("trac11680")  # long time (7s on sage.math, 2012)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 843, in compile_and_execute
        exec compiled in globs
      File "<doctest sage.misc.cython.pyx_preparse[9]>", line 1, in <module>
        module = sage.misc.cython.import_test("trac11680")  # long time (7s on sage.math, 2012)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 805, in import_test
        return compile_and_load(TESTS[name])
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 757, in compile_and_load
        return cython_import(file, create_local_c_file=False)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/server/support.py", line 447, in cython_import
        **kwds)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 493, in cython
        raise RuntimeError("Error converting {} to C:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error converting /home/buildslave-sage/slave/sage_git/dot_sage/temp/desktop/29631/tmp_i0rQYs.pyx to C:


    Error compiling Cython file:
    ------------------------------------------------------------
    ...
    #cinclude $SAGE_SRC/sage/libs/flint $SAGE_LOCAL/include/FLINT
    #clib flint

    from sage.rings.rational cimport Rational
    from sage.rings.polynomial.polynomial_rational_flint cimport Polynomial_rational_flint
    from sage.libs.flint.fmpq_poly cimport (fmpq_poly_get_coeff_mpq, fmpq_poly_set_coeff_mpq,
    ^
    ------------------------------------------------------------

    _home_buildslave_sage_slave_sage_git_dot_sage_temp_desktop_29631_tmp_i0rQYs_pyx_0.pyx:13:0: 'sage.libs.flint.fmpq_poly.pxd' not found
```




---

archive/issue_comments_214164.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-08-28T15:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214164",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_214165.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-28T19:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214165",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_214166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-28T19:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-28T20:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214167",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_214168.json:
```json
{
    "body": "I have also done the same fixes for `mpz_t` at #16910 + #15946, it would be good if somebody could review these.",
    "created_at": "2014-09-03T08:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214168",
    "user": "https://github.com/jdemeyer"
}
```

I have also done the same fixes for `mpz_t` at #16910 + #15946, it would be good if somebody could review these.



---

archive/issue_events_015859.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:02:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16346#event-15859"
}
```



---

archive/issue_comments_214169.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-06T11:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214169",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_214170.json:
```json
{
    "body": "Sorry to dig into \"old\" stuff, but I was suggested to use pxd files rather than pxi files and see the changes here went the other way around...\nAny strong reason to have done that?",
    "created_at": "2014-10-13T16:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214170",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Sorry to dig into "old" stuff, but I was suggested to use pxd files rather than pxi files and see the changes here went the other way around...
Any strong reason to have done that?



---

archive/issue_comments_214171.json:
```json
{
    "body": "Generally speaking, Cython got better at what can be cimported over time (pxd). So there is less reason to rely on textual inclusion (pxi). If in doubt (and if it works ;-) then use pxd.",
    "created_at": "2014-10-13T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214171",
    "user": "https://github.com/vbraun"
}
```

Generally speaking, Cython got better at what can be cimported over time (pxd). So there is less reason to rely on textual inclusion (pxi). If in doubt (and if it works ;-) then use pxd.



---

archive/issue_comments_214172.json:
```json
{
    "body": "Ok, then I'll take the chance to open a ticket to migrate all of flint stuff to pxd files.",
    "created_at": "2014-10-13T17:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214172",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok, then I'll take the chance to open a ticket to migrate all of flint stuff to pxd files.



---

archive/issue_comments_214173.json:
```json
{
    "body": "See #16428.",
    "created_at": "2014-10-13T18:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16346#issuecomment-214173",
    "user": "https://github.com/jdemeyer"
}
```

See #16428.
