# Issue 26205: Upgrade to cypari2-2.0.0

archive/issues_026205.json:
```json
{
    "body": "CC:  @videlec @defeo @kiwifb\n\nThis is not yet officially released, but work in progress.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26442\n\n",
    "created_at": "2018-10-09T14:28:00Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Upgrade to cypari2-2.0.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26205",
    "user": "@jdemeyer"
}
```
CC:  @videlec @defeo @kiwifb

This is not yet officially released, but work in progress.

Issue created by migration from https://trac.sagemath.org/ticket/26442





---

archive/issue_comments_369253.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-10-21T08:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369253",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_369254.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-21T09:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369254",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-28T22:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369255",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-29T16:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369256",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369257.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-29T16:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369257",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369258.json:
```json
{
    "body": "Testing `integer.pyx` shows a \"bad\" behavior\n\n```\nFile \"rings/integer.pyx\", line 6767, in sage.rings.integer.Integer.binomial\nFailed example:\n    for i in [1..10]:  # long time (5s)\n        try:\n            alarm(i/11)\n            (2^100).binomial(2^22, algorithm='pari')\n        except AlarmInterrupt:\n            pass\nExpected nothing\nGot:\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16b53f3c40\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16aae64038\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a1af7f88\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a1af7f88\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a1af7f88\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a8ef7f88\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a4612528\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a4b0c988\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a22f7f88\n    ERROR: inconsistent avma when removing Gen from PARI stack\n    Expected: 0x7f16bcaf7fc8\n    Actual:   0x7f16a37a5008\n**********************************************************************\n1 item had failures:\n   1 of  16 in sage.rings.integer.Integer.binomial\n    [1121 tests, 1 failure, 18.28 s]\n```\n",
    "created_at": "2018-10-30T14:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369258",
    "user": "@videlec"
}
```

Testing `integer.pyx` shows a "bad" behavior

```
File "rings/integer.pyx", line 6767, in sage.rings.integer.Integer.binomial
Failed example:
    for i in [1..10]:  # long time (5s)
        try:
            alarm(i/11)
            (2^100).binomial(2^22, algorithm='pari')
        except AlarmInterrupt:
            pass
Expected nothing
Got:
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16b53f3c40
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16aae64038
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a1af7f88
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a1af7f88
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a1af7f88
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a8ef7f88
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a4612528
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a4b0c988
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a22f7f88
    ERROR: inconsistent avma when removing Gen from PARI stack
    Expected: 0x7f16bcaf7fc8
    Actual:   0x7f16a37a5008
**********************************************************************
1 item had failures:
   1 of  16 in sage.rings.integer.Integer.binomial
    [1121 tests, 1 failure, 18.28 s]
```




---

archive/issue_comments_369259.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-31T12:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369259",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_369260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-11-08T09:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369260",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-11-08T12:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369262.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-08T12:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369262",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369263.json:
```json
{
    "body": "ping?",
    "created_at": "2018-11-13T09:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369263",
    "user": "@jdemeyer"
}
```

ping?



---

archive/issue_comments_369264.json:
```json
{
    "body": "Good for me. Thanks for this new release of cypari2!",
    "created_at": "2018-11-13T13:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369264",
    "user": "@videlec"
}
```

Good for me. Thanks for this new release of cypari2!



---

archive/issue_comments_369265.json:
```json
{
    "body": "So positive review then?",
    "created_at": "2018-11-13T13:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369265",
    "user": "@jdemeyer"
}
```

So positive review then?



---

archive/issue_comments_369266.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-13T13:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369266",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369267.json:
```json
{
    "body": "Indeed.",
    "created_at": "2018-11-13T13:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369267",
    "user": "@videlec"
}
```

Indeed.



---

archive/issue_comments_369268.json:
```json
{
    "body": "Thanks!",
    "created_at": "2018-11-13T13:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369268",
    "user": "@jdemeyer"
}
```

Thanks!



---

archive/issue_comments_369269.json:
```json
{
    "body": "Is the testsuite supposed to work? (SAGE_DEBUG=yes)\n\n```\n[cypari-2.0.1] Testing cypari2.gen\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] \n[cypari-2.0.1] *** SIG 6 *** inside sig_on\n[cypari-2.0.1] do_raise_exception(sig=6)\n[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0\n[cypari-2.0.1] Raising Python exception 0 ms after signal...\n[cypari-2.0.1] ------------------------------------------------------------------------\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5226)[0x7f47616ee226]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5406)[0x7f47616ee406]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x48ae)[0x7f47616ed8ae]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4a7f)[0x7f47616eda7f]\n[cypari-2.0.1] /lib64/libpthread.so.0(+0x11fb0)[0x7f4765c6dfb0]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d557)[0x7f47627fe557]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d562)[0x7f47627fe562]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d5c6)[0x7f47627fe5c6]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(gclone+0x28)[0x7f47627fe7cd]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/stack.so(+0x669c)[0x7f476190e69c]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21974d)[0x7f47630f774d]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21a203)[0x7f47630f8203]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21a0dc)[0x7f47630f80dc]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xe2aca)[0x7f4765f5daca]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f4765ecd58a]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x164f67)[0x7f4765fdff67]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1642a7)[0x7f4765fdf2a7]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f4765fce113]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x166ca8)[0x7f4765fe1ca8]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6145)[0x7f4765fd427d]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f4765fce113]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1965a6)[0x7f47660115a6]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xb7)[0x7f476601152c]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x2e5)[0x7f476600fba1]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f476600f1db]\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2d)[0x7f476602b675]\n[cypari-2.0.1] python(main+0x20)[0x400756]\n[cypari-2.0.1] /lib64/libc.so.6(__libc_start_main+0xeb)[0x7f476512511b]\n[cypari-2.0.1] python(_start+0x2a)[0x40067a]\n[cypari-2.0.1] ------------------------------------------------------------------------\n[cypari-2.0.1] Unhandled SIGSEGV: A segmentation fault occurred.\n[cypari-2.0.1] This probably occurred because a *compiled* module has a bug\n[cypari-2.0.1] in it and is not properly wrapped with sig_on(), sig_off().\n[cypari-2.0.1] Python will now terminate.\n[cypari-2.0.1] ------------------------------------------------------------------------\n[cypari-2.0.1] make[4]: *** [Makefile:16: check] Segmentation fault (core dumped)\n[cypari-2.0.1] make[4]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1/src'\n[cypari-2.0.1] \n[cypari-2.0.1] real\t0m2.838s\n[cypari-2.0.1] user\t0m2.261s\n[cypari-2.0.1] sys\t0m0.093s\n[cypari-2.0.1] ************************************************************************\n[cypari-2.0.1] Error testing package cypari-2.0.1\n[cypari-2.0.1] ************************************************************************\n[cypari-2.0.1] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[cypari-2.0.1] explaining the problem and including the log file\n[cypari-2.0.1]   /mnt/disk/home/buildslave-sage/slave/sage_git/build/logs/pkgs/cypari-2.0.1.log\n[cypari-2.0.1] Describe your computer, operating system, etc.\n[cypari-2.0.1] If you want to try to fix the problem yourself, *don't* just cd to\n[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1 and type 'make check' or whatever is appropriate.\n[cypari-2.0.1] Instead, the following commands setup all environment variables\n[cypari-2.0.1] correctly and load a subshell for you to debug the error:\n[cypari-2.0.1]   (cd '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1' && '/mnt/disk/home/buildslave-sage/slave/sage_git/build/sage' --sh)\n[cypari-2.0.1] When you are done debugging, you can type \"exit\" to leave the subshell.\n[cypari-2.0.1] ************************************************************************\nmake[3]: *** [Makefile:2124: /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/lib/sage/installed/cypari-2.0.1] Error 1\nmake[3]: Target 'all-sage' not remade because of errors.\nmake[3]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/build/make'\nmake[2]: *** [Makefile:1806: all-build] Error 2\nmake[2]: Target 'build-start' not remade because of errors.\nmake[2]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/build/make'\n```\n",
    "created_at": "2018-11-14T20:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369269",
    "user": "@vbraun"
}
```

Is the testsuite supposed to work? (SAGE_DEBUG=yes)

```
[cypari-2.0.1] Testing cypari2.gen
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] 
[cypari-2.0.1] *** SIG 6 *** inside sig_on
[cypari-2.0.1] do_raise_exception(sig=6)
[cypari-2.0.1] PyErr_Occurred() = 0x11f4fb0
[cypari-2.0.1] Raising Python exception 0 ms after signal...
[cypari-2.0.1] ------------------------------------------------------------------------
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5226)[0x7f47616ee226]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5406)[0x7f47616ee406]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x48ae)[0x7f47616ed8ae]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4a7f)[0x7f47616eda7f]
[cypari-2.0.1] /lib64/libpthread.so.0(+0x11fb0)[0x7f4765c6dfb0]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d557)[0x7f47627fe557]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d562)[0x7f47627fe562]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(+0x55d5c6)[0x7f47627fe5c6]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.6(gclone+0x28)[0x7f47627fe7cd]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/stack.so(+0x669c)[0x7f476190e69c]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21974d)[0x7f47630f774d]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21a203)[0x7f47630f8203]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cypari2/pari_instance.so(+0x21a0dc)[0x7f47630f80dc]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xe2aca)[0x7f4765f5daca]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f4765ecd58a]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x164f67)[0x7f4765fdff67]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1642a7)[0x7f4765fdf2a7]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f4765fce113]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x166ca8)[0x7f4765fe1ca8]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6145)[0x7f4765fd427d]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1646c0)[0x7f4765fdf6c0]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x16428b)[0x7f4765fdf28b]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xb52b)[0x7f4765fd9663]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x1148)[0x7f4765fdc58f]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f4765fce113]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1965a6)[0x7f47660115a6]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xb7)[0x7f476601152c]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x2e5)[0x7f476600fba1]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f476600f1db]
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2d)[0x7f476602b675]
[cypari-2.0.1] python(main+0x20)[0x400756]
[cypari-2.0.1] /lib64/libc.so.6(__libc_start_main+0xeb)[0x7f476512511b]
[cypari-2.0.1] python(_start+0x2a)[0x40067a]
[cypari-2.0.1] ------------------------------------------------------------------------
[cypari-2.0.1] Unhandled SIGSEGV: A segmentation fault occurred.
[cypari-2.0.1] This probably occurred because a *compiled* module has a bug
[cypari-2.0.1] in it and is not properly wrapped with sig_on(), sig_off().
[cypari-2.0.1] Python will now terminate.
[cypari-2.0.1] ------------------------------------------------------------------------
[cypari-2.0.1] make[4]: *** [Makefile:16: check] Segmentation fault (core dumped)
[cypari-2.0.1] make[4]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1/src'
[cypari-2.0.1] 
[cypari-2.0.1] real	0m2.838s
[cypari-2.0.1] user	0m2.261s
[cypari-2.0.1] sys	0m0.093s
[cypari-2.0.1] ************************************************************************
[cypari-2.0.1] Error testing package cypari-2.0.1
[cypari-2.0.1] ************************************************************************
[cypari-2.0.1] Please email sage-devel (http://groups.google.com/group/sage-devel)
[cypari-2.0.1] explaining the problem and including the log file
[cypari-2.0.1]   /mnt/disk/home/buildslave-sage/slave/sage_git/build/logs/pkgs/cypari-2.0.1.log
[cypari-2.0.1] Describe your computer, operating system, etc.
[cypari-2.0.1] If you want to try to fix the problem yourself, *don't* just cd to
[cypari-2.0.1] /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1 and type 'make check' or whatever is appropriate.
[cypari-2.0.1] Instead, the following commands setup all environment variables
[cypari-2.0.1] correctly and load a subshell for you to debug the error:
[cypari-2.0.1]   (cd '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cypari-2.0.1' && '/mnt/disk/home/buildslave-sage/slave/sage_git/build/sage' --sh)
[cypari-2.0.1] When you are done debugging, you can type "exit" to leave the subshell.
[cypari-2.0.1] ************************************************************************
make[3]: *** [Makefile:2124: /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/lib/sage/installed/cypari-2.0.1] Error 1
make[3]: Target 'all-sage' not remade because of errors.
make[3]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/build/make'
make[2]: *** [Makefile:1806: all-build] Error 2
make[2]: Target 'build-start' not remade because of errors.
make[2]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/build/make'
```




---

archive/issue_comments_369270.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2018-11-14T20:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369270",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_369271.json:
```json
{
    "body": "It's supposed to work. The upstream repo is tested with travis and the test suite runs here on Gentoo. Is it a one off machine or a variety of machines?",
    "created_at": "2018-11-14T20:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369271",
    "user": "@kiwifb"
}
```

It's supposed to work. The upstream repo is tested with travis and the test suite runs here on Gentoo. Is it a one off machine or a variety of machines?



---

archive/issue_comments_369272.json:
```json
{
    "body": "For what it's worth, it passes on OS X Mojave, although with some warnings:\n\n```\nRunning the test suite for cypari-2.0.1...\npython -u tests/rundoctest.py\n================================================================================\nTesting cypari2.closure\n================================================================================\nTesting cypari2.convert\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 72 bytes on the PARI stack\n  compileflags, 1) in test.globs\n================================================================================\nTesting cypari2.gen\n================================================================================\nTesting cypari2.handle_error\n  ***   user warning: test\n================================================================================\nTesting cypari2.pari_instance\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 158187944 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 390197216 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 275990048 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 375226304 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 288216680 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 416977632 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 444596288 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 343465920 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 379927792 bytes on the PARI stack\n  compileflags, 1) in test.globs\n/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 398485936 bytes on the PARI stack\n  compileflags, 1) in test.globs\n================================================================================\nTesting cypari2.stack\n================================================================================\nTesting cypari2.string_utils\n================================================================================\nTesting autogen.doc\n================================================================================\nTesting autogen.generator\n================================================================================\nTesting autogen.parser\n================================================================================\nTesting autogen.paths\n================================================================================\nSummary result for cypari2:\n   attempted = 1291\n   failed = 0\n```\n",
    "created_at": "2018-11-14T23:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369272",
    "user": "@jhpalmieri"
}
```

For what it's worth, it passes on OS X Mojave, although with some warnings:

```
Running the test suite for cypari-2.0.1...
python -u tests/rundoctest.py
================================================================================
Testing cypari2.closure
================================================================================
Testing cypari2.convert
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 72 bytes on the PARI stack
  compileflags, 1) in test.globs
================================================================================
Testing cypari2.gen
================================================================================
Testing cypari2.handle_error
  ***   user warning: test
================================================================================
Testing cypari2.pari_instance
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 158187944 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 390197216 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 275990048 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 375226304 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 288216680 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 416977632 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 444596288 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 343465920 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 379927792 bytes on the PARI stack
  compileflags, 1) in test.globs
/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/doctest.py:1315: RuntimeWarning: cypari2 leaked 398485936 bytes on the PARI stack
  compileflags, 1) in test.globs
================================================================================
Testing cypari2.stack
================================================================================
Testing cypari2.string_utils
================================================================================
Testing autogen.doc
================================================================================
Testing autogen.generator
================================================================================
Testing autogen.parser
================================================================================
Testing autogen.paths
================================================================================
Summary result for cypari2:
   attempted = 1291
   failed = 0
```




---

archive/issue_comments_369273.json:
```json
{
    "body": "I have the warnings on linux too. Different numbers but same warnings. However nothing is fatal unlike Volker's log.",
    "created_at": "2018-11-14T23:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369273",
    "user": "@kiwifb"
}
```

I have the warnings on linux too. Different numbers but same warnings. However nothing is fatal unlike Volker's log.



---

archive/issue_comments_369274.json:
```json
{
    "body": "Replying to [comment:23 vbraun]:\n> Is the testsuite supposed to work? (SAGE_DEBUG=yes)\n\nIs that error reproducible? I cannot immediately reproduce it. If it's not reproducible, it might be a random race condition, unrelated to `SAGE_DEBUG`.",
    "created_at": "2018-11-20T19:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369274",
    "user": "@jdemeyer"
}
```

Replying to [comment:23 vbraun]:
> Is the testsuite supposed to work? (SAGE_DEBUG=yes)

Is that error reproducible? I cannot immediately reproduce it. If it's not reproducible, it might be a random race condition, unrelated to `SAGE_DEBUG`.



---

archive/issue_comments_369275.json:
```json
{
    "body": "lets give it another try...",
    "created_at": "2018-11-20T23:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369275",
    "user": "@vbraun"
}
```

lets give it another try...



---

archive/issue_comments_369276.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-11-20T23:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369276",
    "user": "@vbraun"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_369277.json:
```json
{
    "body": "If you do reproduce the problem, please let me login to that machine to debug.",
    "created_at": "2018-11-21T08:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369277",
    "user": "@jdemeyer"
}
```

If you do reproduce the problem, please let me login to that machine to debug.



---

archive/issue_comments_369278.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-11-21T08:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369278",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_369279.json:
```json
{
    "body": "Never mind, I managed to reproduce it after building *all* of Sage with `SAGE_DEBUG=yes`.",
    "created_at": "2018-11-21T08:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369279",
    "user": "@jdemeyer"
}
```

Never mind, I managed to reproduce it after building *all* of Sage with `SAGE_DEBUG=yes`.



---

archive/issue_comments_369280.json:
```json
{
    "body": "Somehow the test suite runs out of memory with `SAGE_DEBUG=yes`. This out-of-memory condition is not processed properly, leading to a crash.",
    "created_at": "2018-11-21T15:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369280",
    "user": "@jdemeyer"
}
```

Somehow the test suite runs out of memory with `SAGE_DEBUG=yes`. This out-of-memory condition is not processed properly, leading to a crash.



---

archive/issue_comments_369281.json:
```json
{
    "body": "This fails whenever Python is compiled with `SAGE_DEBUG=yes`.",
    "created_at": "2018-11-26T10:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369281",
    "user": "@jdemeyer"
}
```

This fails whenever Python is compiled with `SAGE_DEBUG=yes`.



---

archive/issue_comments_369282.json:
```json
{
    "body": "I assumed this was only an issue with `SAGE_DEBUG`, so I updated cypari2 on nix. It tested fine locally, but I see a segfault when doctesting sage on our buildserver: https://nix-cache.s3.amazonaws.com/log/f72zl576819vraijymr4dpx9kp4jim4q-sage-tests-8.4.drv",
    "created_at": "2018-12-02T12:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369282",
    "user": "@timokau"
}
```

I assumed this was only an issue with `SAGE_DEBUG`, so I updated cypari2 on nix. It tested fine locally, but I see a segfault when doctesting sage on our buildserver: https://nix-cache.s3.amazonaws.com/log/f72zl576819vraijymr4dpx9kp4jim4q-sage-tests-8.4.drv



---

archive/issue_comments_369283.json:
```json
{
    "body": "That does indeed look like the same problem. I have not spent much time on fixing it, but I will.",
    "created_at": "2018-12-03T07:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369283",
    "user": "@jdemeyer"
}
```

That does indeed look like the same problem. I have not spent much time on fixing it, but I will.



---

archive/issue_comments_369284.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-09T10:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369284",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369285.json:
```json
{
    "body": "I don't know what happened, but I can no longer reproduce the problem mentioned at [comment:23]\n\nIf somebody else can, please be so kind to give me access to that machine to debug the problem.",
    "created_at": "2019-01-09T14:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369285",
    "user": "@jdemeyer"
}
```

I don't know what happened, but I can no longer reproduce the problem mentioned at [comment:23]

If somebody else can, please be so kind to give me access to that machine to debug the problem.



---

archive/issue_comments_369286.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-01-09T14:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369286",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_369287.json:
```json
{
    "body": "It was a semi-random error and I was able to reproduce it once ([comment:33]). I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.",
    "created_at": "2019-01-09T14:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369287",
    "user": "@timokau"
}
```

It was a semi-random error and I was able to reproduce it once ([comment:33]). I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.



---

archive/issue_comments_369288.json:
```json
{
    "body": "Maybe the upgrade to PARI-2.11.1 (#26725) fixed something?",
    "created_at": "2019-01-09T15:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369288",
    "user": "@jdemeyer"
}
```

Maybe the upgrade to PARI-2.11.1 (#26725) fixed something?



---

archive/issue_comments_369289.json:
```json
{
    "body": "Replying to [comment:37 gh-timokau]:\n> It was a semi-random error\n\nI believe that the error with `SAGE_DEBUG=yes` was a reproducible non-random error. It may or may not be the same bug as the one you encountered on nix.",
    "created_at": "2019-01-09T15:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369289",
    "user": "@jdemeyer"
}
```

Replying to [comment:37 gh-timokau]:
> It was a semi-random error

I believe that the error with `SAGE_DEBUG=yes` was a reproducible non-random error. It may or may not be the same bug as the one you encountered on nix.



---

archive/issue_comments_369290.json:
```json
{
    "body": "Replying to [comment:37 gh-timokau]:\n> I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.\n\nSo what do you suggest instead?",
    "created_at": "2019-01-09T16:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369290",
    "user": "@jdemeyer"
}
```

Replying to [comment:37 gh-timokau]:
> I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.

So what do you suggest instead?



---

archive/issue_comments_369291.json:
```json
{
    "body": "Replying to [comment:38 jdemeyer]:\n> Maybe the upgrade to PARI-2.11.1 (#26725) fixed something?\n\nMaybe.\n\nReplying to [comment:39 jdemeyer]:\n> Replying to [comment:37 gh-timokau]:\n> > It was a semi-random error\n> \n> I believe that the error with `SAGE_DEBUG=yes` was a reproducible non-random error. It may or may not be the same bug as the one you encountered on nix.\n\nIt showed up immediately after the update though and never again after I reverted it. `SAGE_DEBUG` wasn't involved, but it probably had something to do with load, core count or something else thats different on a dedicated buildserver.\n\nReplying to [comment:40 jdemeyer]:\n> Replying to [comment:37 gh-timokau]:\n> > I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.\n> \n> So what do you suggest instead?\n\nI'll try to see if I can reproduce the error. Not sure when I'll get to it though. There is no hurry for this upgrade right?",
    "created_at": "2019-01-09T17:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369291",
    "user": "@timokau"
}
```

Replying to [comment:38 jdemeyer]:
> Maybe the upgrade to PARI-2.11.1 (#26725) fixed something?

Maybe.

Replying to [comment:39 jdemeyer]:
> Replying to [comment:37 gh-timokau]:
> > It was a semi-random error
> 
> I believe that the error with `SAGE_DEBUG=yes` was a reproducible non-random error. It may or may not be the same bug as the one you encountered on nix.

It showed up immediately after the update though and never again after I reverted it. `SAGE_DEBUG` wasn't involved, but it probably had something to do with load, core count or something else thats different on a dedicated buildserver.

Replying to [comment:40 jdemeyer]:
> Replying to [comment:37 gh-timokau]:
> > I think immediately going positive_review just because it doesn't reproduce right now is a bad idea.
> 
> So what do you suggest instead?

I'll try to see if I can reproduce the error. Not sure when I'll get to it though. There is no hurry for this upgrade right?



---

archive/issue_comments_369292.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-01-09T17:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369292",
    "user": "@timokau"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_369293.json:
```json
{
    "body": "build works fine but `sage -f -c cypari` fails\n\n```\n[cypari-2.0.1] Running the test suite for cypari-2.0.1...\n[cypari-2.0.1] make[2]: Entering directory '/opt/sage-py3-clang/local/var/tmp/sage/build/cypari-2.0.1/src'\n[cypari-2.0.1] python -u tests/rundoctest.py\n[cypari-2.0.1] Traceback (most recent call last):\n[cypari-2.0.1]   File \"tests/rundoctest.py\", line 11, in <module>\n[cypari-2.0.1]     import cypari2\n[cypari-2.0.1]   File \"/opt/sage-py3-clang/local/var/tmp/sage/build/cypari-2.0.1/src/cypari2/__init__.py\", line 1, in <module>\n[cypari-2.0.1]     from .pari_instance import Pari\n[cypari-2.0.1] ImportError: No module named pari_instance\n[cypari-2.0.1] make[2]: *** [Makefile:16: check] Error 1\n```\n",
    "created_at": "2019-01-09T17:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369293",
    "user": "@videlec"
}
```

build works fine but `sage -f -c cypari` fails

```
[cypari-2.0.1] Running the test suite for cypari-2.0.1...
[cypari-2.0.1] make[2]: Entering directory '/opt/sage-py3-clang/local/var/tmp/sage/build/cypari-2.0.1/src'
[cypari-2.0.1] python -u tests/rundoctest.py
[cypari-2.0.1] Traceback (most recent call last):
[cypari-2.0.1]   File "tests/rundoctest.py", line 11, in <module>
[cypari-2.0.1]     import cypari2
[cypari-2.0.1]   File "/opt/sage-py3-clang/local/var/tmp/sage/build/cypari-2.0.1/src/cypari2/__init__.py", line 1, in <module>
[cypari-2.0.1]     from .pari_instance import Pari
[cypari-2.0.1] ImportError: No module named pari_instance
[cypari-2.0.1] make[2]: *** [Makefile:16: check] Error 1
```




---

archive/issue_comments_369294.json:
```json
{
    "body": "Replying to [comment:42 vdelecroix]:\n> build works fine but `sage -f -c cypari` fails\n\nHow did that happen? Is that Sage installation broken somehow? Can you provide the full install log for cypari?",
    "created_at": "2019-01-10T08:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369294",
    "user": "@jdemeyer"
}
```

Replying to [comment:42 vdelecroix]:
> build works fine but `sage -f -c cypari` fails

How did that happen? Is that Sage installation broken somehow? Can you provide the full install log for cypari?



---

archive/issue_comments_369295.json:
```json
{
    "body": "I tried again to reproduce the problem and I did manage but only after `make distclean`. Maybe I did something wrong yesterday...\n\nAnyway, it seems that the problem is 100% reproducible now so I can work on it.",
    "created_at": "2019-01-10T09:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369295",
    "user": "@jdemeyer"
}
```

I tried again to reproduce the problem and I did manage but only after `make distclean`. Maybe I did something wrong yesterday...

Anyway, it seems that the problem is 100% reproducible now so I can work on it.



---

archive/issue_comments_369296.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-10T09:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369296",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_369297.json:
```json
{
    "body": "Great! Thanks for re-checking. Hopefully the solution will also apply to the (probably related) problem I was seeing.",
    "created_at": "2019-01-10T10:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369297",
    "user": "@timokau"
}
```

Great! Thanks for re-checking. Hopefully the solution will also apply to the (probably related) problem I was seeing.



---

archive/issue_comments_369298.json:
```json
{
    "body": "Attachment [vincent-cypari-2.0.1.log](tarball://root/attachments/some-uuid/ticket26442/vincent-cypari-2.0.1.log) by @videlec created at 2019-01-10 12:17:39",
    "created_at": "2019-01-10T12:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369298",
    "user": "@videlec"
}
```

Attachment [vincent-cypari-2.0.1.log](tarball://root/attachments/some-uuid/ticket26442/vincent-cypari-2.0.1.log) by @videlec created at 2019-01-10 12:17:39



---

archive/issue_comments_369299.json:
```json
{
    "body": "For the full log of the failures mentioned in [comment:42] and [comment:43] is [attachment:vincent-cypari-2.0.1.log]. Let me mention that it is a Python 3 build of Sage.",
    "created_at": "2019-01-10T12:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369299",
    "user": "@videlec"
}
```

For the full log of the failures mentioned in [comment:42] and [comment:43] is [attachment:vincent-cypari-2.0.1.log]. Let me mention that it is a Python 3 build of Sage.



---

archive/issue_comments_369300.json:
```json
{
    "body": "I solved the segmentation fault with `SAGE_DEBUG=yes`.\n\nThe underlying problem was exceptions containing pointers to PARI objects, where the exception was being kept alive after the PARI object was deallocated. This invalid exception objects then crashed Python. I solved the problem in cypari2 upstream by always making copies of PARI objects in exceptions (assuming that exceptions are exceptional, this should not affect performance). I don't know why the problem occurs only (or at least with much higher probability) with `SAGE_DEBUG=yes`.\n\nI will do some more testing and then release cypari2-2.0.2",
    "created_at": "2019-01-10T13:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369300",
    "user": "@jdemeyer"
}
```

I solved the segmentation fault with `SAGE_DEBUG=yes`.

The underlying problem was exceptions containing pointers to PARI objects, where the exception was being kept alive after the PARI object was deallocated. This invalid exception objects then crashed Python. I solved the problem in cypari2 upstream by always making copies of PARI objects in exceptions (assuming that exceptions are exceptional, this should not affect performance). I don't know why the problem occurs only (or at least with much higher probability) with `SAGE_DEBUG=yes`.

I will do some more testing and then release cypari2-2.0.2



---

archive/issue_comments_369301.json:
```json
{
    "body": "Replying to [comment:46 vdelecroix]:\n> Let me mention that it is a Python 3 build of Sage.\n\nIndeed. Confirmed with Python 3 but only inside Sage.",
    "created_at": "2019-01-10T15:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369301",
    "user": "@jdemeyer"
}
```

Replying to [comment:46 vdelecroix]:
> Let me mention that it is a Python 3 build of Sage.

Indeed. Confirmed with Python 3 but only inside Sage.



---

archive/issue_comments_369302.json:
```json
{
    "body": "OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.",
    "created_at": "2019-01-10T15:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369302",
    "user": "@jdemeyer"
}
```

OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.



---

archive/issue_comments_369303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-10T15:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369303",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369304.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.\n\nWhy on earth `python` defaults to `python2` on py3 build!?",
    "created_at": "2019-01-10T15:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369304",
    "user": "@videlec"
}
```

Replying to [comment:49 jdemeyer]:
> OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.

Why on earth `python` defaults to `python2` on py3 build!?



---

archive/issue_comments_369305.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-10T15:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369305",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369306.json:
```json
{
    "body": "`sage-python23` is indeed a solution. I confirm that tests now pass with py3 build.",
    "created_at": "2019-01-10T15:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369306",
    "user": "@videlec"
}
```

`sage-python23` is indeed a solution. I confirm that tests now pass with py3 build.



---

archive/issue_comments_369307.json:
```json
{
    "body": "The following line in the installation log looks suspicious\n\n```\n[cypari-2.0.2] No record that 'cypari' was ever installed; skipping uninstall\n```\n\nAny idea where it comes from? Is it not detected because of the discrepency `cypari` vs `cypari2`?",
    "created_at": "2019-01-10T15:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369307",
    "user": "@videlec"
}
```

The following line in the installation log looks suspicious

```
[cypari-2.0.2] No record that 'cypari' was ever installed; skipping uninstall
```

Any idea where it comes from? Is it not detected because of the discrepency `cypari` vs `cypari2`?



---

archive/issue_comments_369308.json:
```json
{
    "body": "Replying to [comment:52 vdelecroix]:\n> Replying to [comment:49 jdemeyer]:\n> > OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.\n> \n> Why on earth `python` defaults to `python2` on py3 build!?\n\n`python` is always supposed to default to `python2`: that's a Python convention.",
    "created_at": "2019-01-10T16:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369308",
    "user": "@jhpalmieri"
}
```

Replying to [comment:52 vdelecroix]:
> Replying to [comment:49 jdemeyer]:
> > OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.
> 
> Why on earth `python` defaults to `python2` on py3 build!?

`python` is always supposed to default to `python2`: that's a Python convention.



---

archive/issue_comments_369309.json:
```json
{
    "body": "Replying to [comment:56 jhpalmieri]:\n> Replying to [comment:52 vdelecroix]:\n> > Replying to [comment:49 jdemeyer]:\n> > > OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.\n> > \n> > Why on earth `python` defaults to `python2` on py3 build!?\n> \n> `python` is always supposed to default to `python2`: that's a Python convention.\n\nReally? At least on archlinux `python` points to Python 3\n\n```\n$ ls -l /usr/bin/python\nlrwxrwxrwx 1 root root 7 22 oct.  12:41 /usr/bin/python -> python3\n```\n",
    "created_at": "2019-01-10T16:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369309",
    "user": "@videlec"
}
```

Replying to [comment:56 jhpalmieri]:
> Replying to [comment:52 vdelecroix]:
> > Replying to [comment:49 jdemeyer]:
> > > OK, the problem with Python 3 is simple: the test suite is always being run with Python 2 which obviously doesn't have `cypari2` installed.
> > 
> > Why on earth `python` defaults to `python2` on py3 build!?
> 
> `python` is always supposed to default to `python2`: that's a Python convention.

Really? At least on archlinux `python` points to Python 3

```
$ ls -l /usr/bin/python
lrwxrwxrwx 1 root root 7 22 oct.  12:41 /usr/bin/python -> python3
```




---

archive/issue_comments_369310.json:
```json
{
    "body": "See https://www.python.org/dev/peps/pep-0394/ (which mentions Arch Linux specifically).",
    "created_at": "2019-01-10T16:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369310",
    "user": "@jhpalmieri"
}
```

See https://www.python.org/dev/peps/pep-0394/ (which mentions Arch Linux specifically).



---

archive/issue_comments_369311.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-10T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369311",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369312.json:
```json
{
    "body": "Let's give it another try.",
    "created_at": "2019-01-10T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369312",
    "user": "@videlec"
}
```

Let's give it another try.



---

archive/issue_comments_369313.json:
```json
{
    "body": "Replying to [comment:55 vdelecroix]:\n> The following line in the installation log looks suspicious\n> {{{\n> [cypari-2.0.2] No record that 'cypari' was ever installed; skipping uninstall\n> }}}\n> Any idea where it comes from?\n\nWhen you run `./sage -f cypari`, it first uninstalls the package. So by the time you are installing again, there is \"No record that 'cypari' was ever installed\". I agree that the message is confusing, but it's completely normal.",
    "created_at": "2019-01-10T20:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369313",
    "user": "@jdemeyer"
}
```

Replying to [comment:55 vdelecroix]:
> The following line in the installation log looks suspicious
> {{{
> [cypari-2.0.2] No record that 'cypari' was ever installed; skipping uninstall
> }}}
> Any idea where it comes from?

When you run `./sage -f cypari`, it first uninstalls the package. So by the time you are installing again, there is "No record that 'cypari' was ever installed". I agree that the message is confusing, but it's completely normal.



---

archive/issue_comments_369314.json:
```json
{
    "body": "I tried to update the nix package to 2.0.2 and got a segfault during ptestlong (not reproducible in isolation):\n\n\n```\nsage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/all.py\n    [0 tests, 0.00 s]\ndoctest:warning\n  [...]\n  File \"/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/multiprocessing/queues.py\", line 268, in _feed\n    send(obj)\n:\nRuntimeWarning: cypari2 leaked 140736969821680 bytes on the PARI stack\n------------------------------------------------------------------------\n/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]\n[...]\n/nix/store/p8fyjvz3djclmndwxjfcj7zkmx89wniw-glibc-2.27/lib/libc.so.6(clone+0x3f)[0x7ffff6b231ff]\n------------------------------------------------------------------------\nAttaching gdb to process id 10236.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nsage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/additive_abelian_wrapper.py\n    Killed due to segmentation fault\n**********************************************************************\nTests run before process (pid=10236) failed:\nsage: E = EllipticCurve('30a2') ## line 14 ##\n[...]\nsage: G([1,1]) ## line 270 ##\ndoctest:warning\n  [...]\n  File \"/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/sage/misc/superseded.py\", line 148, in warning\n    warn(message, warning_class, stacklevel)\n:\nDeprecationWarning: The default behaviour changed! If you *really* want a linear combination of smith generators, use .linear_combination_of_smith_form_gens.\nSee http://trac.sagemath.org/16261 for details.\n(6, 2)\nsage: G(G([1,1])) ## line 276 ##\n(6, 2)\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 278 ##\n0\n```\n\n\nFull log: https://gist.github.com/timokau/62edfecf23ed96b3a5284c5d913a1643\n\nThat was with sage 8.5 with this ticket applied and pari 2.11.1.\n\nHaven't had any time to investigate much further yet. Although I don't really know what to do besides checking how reliable this reproduces.",
    "created_at": "2019-01-11T22:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369314",
    "user": "@timokau"
}
```

I tried to update the nix package to 2.0.2 and got a segfault during ptestlong (not reproducible in isolation):


```
sage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/all.py
    [0 tests, 0.00 s]
doctest:warning
  [...]
  File "/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/multiprocessing/queues.py", line 268, in _feed
    send(obj)
:
RuntimeWarning: cypari2 leaked 140736969821680 bytes on the PARI stack
------------------------------------------------------------------------
/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]
[...]
/nix/store/p8fyjvz3djclmndwxjfcj7zkmx89wniw-glibc-2.27/lib/libc.so.6(clone+0x3f)[0x7ffff6b231ff]
------------------------------------------------------------------------
Attaching gdb to process id 10236.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
sage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/additive_abelian_wrapper.py
    Killed due to segmentation fault
**********************************************************************
Tests run before process (pid=10236) failed:
sage: E = EllipticCurve('30a2') ## line 14 ##
[...]
sage: G([1,1]) ## line 270 ##
doctest:warning
  [...]
  File "/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/sage/misc/superseded.py", line 148, in warning
    warn(message, warning_class, stacklevel)
:
DeprecationWarning: The default behaviour changed! If you *really* want a linear combination of smith generators, use .linear_combination_of_smith_form_gens.
See http://trac.sagemath.org/16261 for details.
(6, 2)
sage: G(G([1,1])) ## line 276 ##
(6, 2)
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 278 ##
0
```


Full log: https://gist.github.com/timokau/62edfecf23ed96b3a5284c5d913a1643

That was with sage 8.5 with this ticket applied and pari 2.11.1.

Haven't had any time to investigate much further yet. Although I don't really know what to do besides checking how reliable this reproduces.



---

archive/issue_comments_369315.json:
```json
{
    "body": "Replying to [comment:61 gh-timokau]:\n> Although I don't really know what to do besides checking how reliable this reproduces.\n\nRunning the tests with gdb installed might help.",
    "created_at": "2019-01-12T07:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369315",
    "user": "@jdemeyer"
}
```

Replying to [comment:61 gh-timokau]:
> Although I don't really know what to do besides checking how reliable this reproduces.

Running the tests with gdb installed might help.



---

archive/issue_comments_369316.json:
```json
{
    "body": "Replying to [comment:61 gh-timokau]:\n> not reproducible in isolation\n\nIs it reproducible when running `make ptestlong`?",
    "created_at": "2019-01-12T07:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369316",
    "user": "@jdemeyer"
}
```

Replying to [comment:61 gh-timokau]:
> not reproducible in isolation

Is it reproducible when running `make ptestlong`?



---

archive/issue_comments_369317.json:
```json
{
    "body": "Replying to [comment:63 jdemeyer]:\n> Replying to [comment:61 gh-timokau]:\n> > not reproducible in isolation\n> \n> Is it reproducible when running `make ptestlong`?\n\nOn the second try I got a different failure:\n\n\n```\nsage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py\n**********************************************************************\nFile \"/nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py\", line 220, in sage.doctest.test\nFailed example:\n    subprocess.call([\"sage\", \"-tp\", \"1000000\", \"--timeout=120\",  # long time\n         \"--warn-long\", \"0\", \"99seconds.rst\", \"interrupt_diehard.rst\"], **kwds2)\nExpected:\n    Running doctests...\n    Doctesting 2 files using 1000000 threads.\n    Killing test 99seconds.rst\n    Killing test interrupt_diehard.rst\n    ----------------------------------------------------------------------\n    Doctests interrupted: 0/2 files tested\n    ----------------------------------------------------------------------\n    ...\n    128\nGot:\n    Running doctests with ID 2019-01-12-08-52-31-cbdf1975.\n    Using --optional=dochtml,gmp,memlimit,nose,sage\n    Doctesting 2 files using 1000000 threads.\n    Killing test 99seconds.rst\n    Killing test interrupt_diehard.rst\n    ------------------------------------------------------------------------\n    /nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]\n    [...]\n    /nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/lib/libpython2.7.so.1.0(Py_Main+0xb4a)[0x7ffff78f4aaa]\n    /nix/store/p8fyjvz3djclmndwxjfcj7zkmx89wniw-glibc-2.27/lib/libc.so.6(__libc_start_main+0xee)[0x7ffff6a52b5e]\n    /nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/bin/python(_start+0x2a)[0x4007ba]\n    ------------------------------------------------------------------------\n    ----------------------------------------------------------------------\n    Doctests interrupted: 0/2 files tested\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.1 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    Attaching gdb to process id 6906.\n    Cannot find gdb installed\n    GDB is not installed.\n    Install gdb for enhanced tracebacks.\n    ------------------------------------------------------------------------\n    128\n**********************************************************************\n1 item had failures:\n   1 of  24 in sage.doctest.test\n    [54 tests, 1 failure, 50.91 s]\nKilling test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/sources.py\nKilling test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/dynamics/arithmetic_dynamics/projective_ds.py\nKilling test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/dynamics/flat_surfaces/all.py\n------------------------------------------------------------------------\n/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]\n[...]\n/nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/bin/python(_start+0x2a)[0x4007ba]\n------------------------------------------------------------------------\n----------------------------------------------------------------------\nsage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py  # 1 doctest failed\nDoctests interrupted: 1384/3738 files tested\n```\n\n\nOnly difference to the first run was that I passed `--exitfirst`. Full log: https://gist.github.com/timokau/84fa6a991119087661e3491181612727\nsta\nTo make sure this is really caused by the cypari2 update, I then reverted the update and re-ran the testsuite again. This time it succeeded.",
    "created_at": "2019-01-12T11:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369317",
    "user": "@timokau"
}
```

Replying to [comment:63 jdemeyer]:
> Replying to [comment:61 gh-timokau]:
> > not reproducible in isolation
> 
> Is it reproducible when running `make ptestlong`?

On the second try I got a different failure:


```
sage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py
**********************************************************************
File "/nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py", line 220, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-tp", "1000000", "--timeout=120",  # long time
         "--warn-long", "0", "99seconds.rst", "interrupt_diehard.rst"], **kwds2)
Expected:
    Running doctests...
    Doctesting 2 files using 1000000 threads.
    Killing test 99seconds.rst
    Killing test interrupt_diehard.rst
    ----------------------------------------------------------------------
    Doctests interrupted: 0/2 files tested
    ----------------------------------------------------------------------
    ...
    128
Got:
    Running doctests with ID 2019-01-12-08-52-31-cbdf1975.
    Using --optional=dochtml,gmp,memlimit,nose,sage
    Doctesting 2 files using 1000000 threads.
    Killing test 99seconds.rst
    Killing test interrupt_diehard.rst
    ------------------------------------------------------------------------
    /nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]
    [...]
    /nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/lib/libpython2.7.so.1.0(Py_Main+0xb4a)[0x7ffff78f4aaa]
    /nix/store/p8fyjvz3djclmndwxjfcj7zkmx89wniw-glibc-2.27/lib/libc.so.6(__libc_start_main+0xee)[0x7ffff6a52b5e]
    /nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/bin/python(_start+0x2a)[0x4007ba]
    ------------------------------------------------------------------------
    ----------------------------------------------------------------------
    Doctests interrupted: 0/2 files tested
    ----------------------------------------------------------------------
    Total time for all tests: 0.1 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    Attaching gdb to process id 6906.
    Cannot find gdb installed
    GDB is not installed.
    Install gdb for enhanced tracebacks.
    ------------------------------------------------------------------------
    128
**********************************************************************
1 item had failures:
   1 of  24 in sage.doctest.test
    [54 tests, 1 failure, 50.91 s]
Killing test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/sources.py
Killing test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/dynamics/arithmetic_dynamics/projective_ds.py
Killing test /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/dynamics/flat_surfaces/all.py
------------------------------------------------------------------------
/nix/store/351z9795scybnc45vxydpcsp3x9bc88g-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2dbfb]
[...]
/nix/store/46kfixv5s95klr3wmnydcp8pc6cfgr08-python-2.7.15/bin/python(_start+0x2a)[0x4007ba]
------------------------------------------------------------------------
----------------------------------------------------------------------
sage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/doctest/test.py  # 1 doctest failed
Doctests interrupted: 1384/3738 files tested
```


Only difference to the first run was that I passed `--exitfirst`. Full log: https://gist.github.com/timokau/84fa6a991119087661e3491181612727
sta
To make sure this is really caused by the cypari2 update, I then reverted the update and re-ran the testsuite again. This time it succeeded.



---

archive/issue_comments_369318.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2019-01-12T11:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369318",
    "user": "@timokau"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_369319.json:
```json
{
    "body": "I'll try to reproduce with sage-the-distro on 8.6.rc0, but that will take a while.",
    "created_at": "2019-01-12T11:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369319",
    "user": "@timokau"
}
```

I'll try to reproduce with sage-the-distro on 8.6.rc0, but that will take a while.



---

archive/issue_comments_369320.json:
```json
{
    "body": "Replying to [comment:64 gh-timokau]:\n> On the second try I got a different failure:\n\nYou already reported that as #26912. This is certainly unrelated to cypari2.",
    "created_at": "2019-01-12T12:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369320",
    "user": "@jdemeyer"
}
```

Replying to [comment:64 gh-timokau]:
> On the second try I got a different failure:

You already reported that as #26912. This is certainly unrelated to cypari2.



---

archive/issue_comments_369321.json:
```json
{
    "body": "Right, I forgot.",
    "created_at": "2019-01-12T12:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369321",
    "user": "@timokau"
}
```

Right, I forgot.



---

archive/issue_comments_369322.json:
```json
{
    "body": "So, how should we proceed? If I have no way to reproduce the problem, I cannot fix it.",
    "created_at": "2019-01-12T22:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369322",
    "user": "@jdemeyer"
}
```

So, how should we proceed? If I have no way to reproduce the problem, I cannot fix it.



---

archive/issue_comments_369323.json:
```json
{
    "body": "I'll try to narrow it down a bit. If all else fails, bisect cypari2 and find the commit that causes this.\n\nThat takes time, especially considering that each test requires a ptestlong. Again, is there any hurry for this? Presumably this will only make it into 8.7 either way right?",
    "created_at": "2019-01-12T22:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369323",
    "user": "@timokau"
}
```

I'll try to narrow it down a bit. If all else fails, bisect cypari2 and find the commit that causes this.

That takes time, especially considering that each test requires a ptestlong. Again, is there any hurry for this? Presumably this will only make it into 8.7 either way right?



---

archive/issue_comments_369324.json:
```json
{
    "body": "Replying to [comment:69 gh-timokau]:\n> If all else fails, bisect cypari2 and find the commit that causes this.\n\nIt's almost certainly https://github.com/defeo/cypari2/commit/551a5277456a3170dd690773e22f319cc1ad795a",
    "created_at": "2019-01-13T07:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369324",
    "user": "@jdemeyer"
}
```

Replying to [comment:69 gh-timokau]:
> If all else fails, bisect cypari2 and find the commit that causes this.

It's almost certainly https://github.com/defeo/cypari2/commit/551a5277456a3170dd690773e22f319cc1ad795a



---

archive/issue_comments_369325.json:
```json
{
    "body": "(in the unlikely case that it's **not** caused by that commit, that would be very useful information)",
    "created_at": "2019-01-13T12:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369325",
    "user": "@jdemeyer"
}
```

(in the unlikely case that it's **not** caused by that commit, that would be very useful information)



---

archive/issue_comments_369326.json:
```json
{
    "body": "I'm currently trying to get vanilla sage to bulid+test to try to reproduce it there (unrelated issues with linking and python).\n\nFor the nix package it definitely reproduces very reliably (3 times in a row) so after that I'll check if the commit is responsible.",
    "created_at": "2019-01-13T16:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369326",
    "user": "@timokau"
}
```

I'm currently trying to get vanilla sage to bulid+test to try to reproduce it there (unrelated issues with linking and python).

For the nix package it definitely reproduces very reliably (3 times in a row) so after that I'll check if the commit is responsible.



---

archive/issue_comments_369327.json:
```json
{
    "body": "> For the nix package it definitely reproduces very reliably (3 times in a row)\n\nIf possible, please keep all logs of all `make ptestlong` runs. For example, I want to know if the failures are literally identical or whether there is some random variation.",
    "created_at": "2019-01-13T18:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369327",
    "user": "@jdemeyer"
}
```

> For the nix package it definitely reproduces very reliably (3 times in a row)

If possible, please keep all logs of all `make ptestlong` runs. For example, I want to know if the failures are literally identical or whether there is some random variation.



---

archive/issue_comments_369328.json:
```json
{
    "body": "Alright, I'll keep them. Kept the first 3 already. Currently running with the cypari checkout you pointed out.\n\nUnrelated but do you have any idea why the python patched could fail to apply? I'm getting errors from the safe-directory test and the regex group index issue when testing vanilla sage. It does use sages python (the system python even has the regex thing patched). The build log does say that the patches were applied. The log also says \"checking for sys/types.h... yes\" which seems relevant for the sys_path_security patch.",
    "created_at": "2019-01-13T20:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369328",
    "user": "@timokau"
}
```

Alright, I'll keep them. Kept the first 3 already. Currently running with the cypari checkout you pointed out.

Unrelated but do you have any idea why the python patched could fail to apply? I'm getting errors from the safe-directory test and the regex group index issue when testing vanilla sage. It does use sages python (the system python even has the regex thing patched). The build log does say that the patches were applied. The log also says "checking for sys/types.h... yes" which seems relevant for the sys_path_security patch.



---

archive/issue_comments_369329.json:
```json
{
    "body": "Replying to [comment:74 gh-timokau]:\n> It does use sages python\n\nAre you sure about that? Is there by chance more than 1 Python installed?",
    "created_at": "2019-01-13T20:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369329",
    "user": "@jdemeyer"
}
```

Replying to [comment:74 gh-timokau]:
> It does use sages python

Are you sure about that? Is there by chance more than 1 Python installed?



---

archive/issue_comments_369330.json:
```json
{
    "body": "Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).",
    "created_at": "2019-01-13T21:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369330",
    "user": "@timokau"
}
```

Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).



---

archive/issue_comments_369331.json:
```json
{
    "body": "I pushed two more relevant commits to https://github.com/defeo/cypari2/commits/master\n\nThey clean up some of the code and might by chance fix your problem.",
    "created_at": "2019-01-13T22:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369331",
    "user": "@jdemeyer"
}
```

I pushed two more relevant commits to https://github.com/defeo/cypari2/commits/master

They clean up some of the code and might by chance fix your problem.



---

archive/issue_comments_369332.json:
```json
{
    "body": "Replying to [comment:76 gh-timokau]:\n> Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).\n\nCould it be a Python 2 versus Python 3 problem? Just guessing...",
    "created_at": "2019-01-13T22:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369332",
    "user": "@jdemeyer"
}
```

Replying to [comment:76 gh-timokau]:
> Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).

Could it be a Python 2 versus Python 3 problem? Just guessing...



---

archive/issue_comments_369333.json:
```json
{
    "body": "Thanks, I'll do a test with latest master too.",
    "created_at": "2019-01-13T22:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369333",
    "user": "@timokau"
}
```

Thanks, I'll do a test with latest master too.



---

archive/issue_comments_369334.json:
```json
{
    "body": "Replying to [comment:78 jdemeyer]:\n> Replying to [comment:76 gh-timokau]:\n> > Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).\n> \n> Could it be a Python 2 versus Python 3 problem? Just guessing...\n\nI don't think so:\n\n\n```\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ which python\n/home/timo/repos/sage/local/bin/python\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ python --version\nPython 2.7.14\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ mkdir /tmp/dir\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ chmod 777 /tmp/dir\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ touch /tmp/dir/file\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ python /tmp/dir/file\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ grep Applying logs/pkgs/python2-2.7.15.p0.log \nApplying patches from ../patches...\nApplying ../patches/2.6.5-FD_SETSIZE.patch\nApplying ../patches/cygwin64.patch\nApplying ../patches/descr_ref-issue_25750.patch\nApplying ../patches/getcallargs-issue_20108.patch\nApplying ../patches/hashlibfallbacks-issue_18000.patch\nApplying ../patches/linux_linking_issue_25229.patch\nApplying ../patches/ncurses-issue_14438.patch\nApplying ../patches/ncurses-issue_9665.patch\nApplying ../patches/no_strict_proto-issue_5755.patch\nApplying ../patches/permissions.patch\nApplying ../patches/re_match_index-issue_27177.patch\nApplying ../patches/socket.patch\nApplying ../patches/sys_path_security-issue_16202.patch\nApplying ../patches/tinfo.patch\nApplying ../patches/uuid-issue_11063.patch\nsage-build-env-chrootenv:timo@pad:~/repos/sage$ \n```\n\n\nVery weird...",
    "created_at": "2019-01-13T22:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369334",
    "user": "@timokau"
}
```

Replying to [comment:78 jdemeyer]:
> Replying to [comment:76 gh-timokau]:
> > Yes a system python is installed. But I did `export PATH=$PWD/local/bin:$PATH`, verified with `which python` and also tried the safe directory example manually (`./local/bin/python` did not complain).
> 
> Could it be a Python 2 versus Python 3 problem? Just guessing...

I don't think so:


```
sage-build-env-chrootenv:timo@pad:~/repos/sage$ which python
/home/timo/repos/sage/local/bin/python
sage-build-env-chrootenv:timo@pad:~/repos/sage$ python --version
Python 2.7.14
sage-build-env-chrootenv:timo@pad:~/repos/sage$ mkdir /tmp/dir
sage-build-env-chrootenv:timo@pad:~/repos/sage$ chmod 777 /tmp/dir
sage-build-env-chrootenv:timo@pad:~/repos/sage$ touch /tmp/dir/file
sage-build-env-chrootenv:timo@pad:~/repos/sage$ python /tmp/dir/file
sage-build-env-chrootenv:timo@pad:~/repos/sage$ grep Applying logs/pkgs/python2-2.7.15.p0.log 
Applying patches from ../patches...
Applying ../patches/2.6.5-FD_SETSIZE.patch
Applying ../patches/cygwin64.patch
Applying ../patches/descr_ref-issue_25750.patch
Applying ../patches/getcallargs-issue_20108.patch
Applying ../patches/hashlibfallbacks-issue_18000.patch
Applying ../patches/linux_linking_issue_25229.patch
Applying ../patches/ncurses-issue_14438.patch
Applying ../patches/ncurses-issue_9665.patch
Applying ../patches/no_strict_proto-issue_5755.patch
Applying ../patches/permissions.patch
Applying ../patches/re_match_index-issue_27177.patch
Applying ../patches/socket.patch
Applying ../patches/sys_path_security-issue_16202.patch
Applying ../patches/tinfo.patch
Applying ../patches/uuid-issue_11063.patch
sage-build-env-chrootenv:timo@pad:~/repos/sage$ 
```


Very weird...



---

archive/issue_comments_369335.json:
```json
{
    "body": "A library problem? Note that the `python` executable is really just a wrapper around a library `libpython2.7.so`",
    "created_at": "2019-01-13T23:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369335",
    "user": "@jdemeyer"
}
```

A library problem? Note that the `python` executable is really just a wrapper around a library `libpython2.7.so`



---

archive/issue_comments_369336.json:
```json
{
    "body": "551a5277456a3170dd690773e22f319cc1ad795a actually doesn't show this problem:\n\n\n```\nsage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/additive_abelian_group.py\n    [76 tests, 1.50 s]\n```\n\n\nAlthough I didn't adjust the sage patch, so there are some other failures like this:\n\n\n```\nFailed example:\n    ModularSymbols(11, 4, base_ring=QuadraticField(-7,'b'),sign=1).cuspidal_submodule()._q_expansion_module(prec=5, algorithm=\"eigen\") # indirect doctest\nExpected:\n    Vector space of degree 5 and dimension 2 over Number Field in b with defining polynomial x^2 + 7\n    Basis matrix:\n    [ 0  1  0  3 -6]\n    [ 0  0  1 -4  2]\nGot:\n    Vector space of degree 5 and dimension 2 over Number Field in b with defining polynomial x^2 + 7\n    Basis matrix:\n    [ 0  1  1  0 -6]\n    [ 0  0  0  1 -2]\n```\n\n\nPossible that there is some interaction.\n\nDidn't test master yet.",
    "created_at": "2019-01-13T23:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369336",
    "user": "@timokau"
}
```

551a5277456a3170dd690773e22f319cc1ad795a actually doesn't show this problem:


```
sage -t --long /nix/store/rppc0jilfm84ydj405mafd8kjzqr97rp-sage-src-8.5/src/sage/groups/additive_abelian/additive_abelian_group.py
    [76 tests, 1.50 s]
```


Although I didn't adjust the sage patch, so there are some other failures like this:


```
Failed example:
    ModularSymbols(11, 4, base_ring=QuadraticField(-7,'b'),sign=1).cuspidal_submodule()._q_expansion_module(prec=5, algorithm="eigen") # indirect doctest
Expected:
    Vector space of degree 5 and dimension 2 over Number Field in b with defining polynomial x^2 + 7
    Basis matrix:
    [ 0  1  0  3 -6]
    [ 0  0  1 -4  2]
Got:
    Vector space of degree 5 and dimension 2 over Number Field in b with defining polynomial x^2 + 7
    Basis matrix:
    [ 0  1  1  0 -6]
    [ 0  0  0  1 -2]
```


Possible that there is some interaction.

Didn't test master yet.



---

archive/issue_comments_369337.json:
```json
{
    "body": "Replying to [comment:81 jdemeyer]:\n> A library problem? Note that the `python` executable is really just a wrapper around a library `libpython2.7.so`\n\nI think that is it, at least `LD_DEBUG=libs python` shows \n\n\n```\ncalling init: /usr/lib/libpython2.7.so.1.0\n```\n",
    "created_at": "2019-01-13T23:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369337",
    "user": "@timokau"
}
```

Replying to [comment:81 jdemeyer]:
> A library problem? Note that the `python` executable is really just a wrapper around a library `libpython2.7.so`

I think that is it, at least `LD_DEBUG=libs python` shows 


```
calling init: /usr/lib/libpython2.7.so.1.0
```




---

archive/issue_comments_369338.json:
```json
{
    "body": "In the mean time, I found an unrelated serious bug in cypari2-2.0.2 so I'll need to make a new version anyway.",
    "created_at": "2019-01-14T08:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369338",
    "user": "@jdemeyer"
}
```

In the mean time, I found an unrelated serious bug in cypari2-2.0.2 so I'll need to make a new version anyway.



---

archive/issue_comments_369339.json:
```json
{
    "body": "After a few `make ptestlong` runs with this ticket, I got\n\n```\nsage -t --long src/sage/modular/abvar/torsion_subgroup.py\n**********************************************************************\nFile \"src/sage/modular/abvar/torsion_subgroup.py\", line 46, in sage.modular.abvar.torsion_subgroup\nFailed example:\n    for N in range(1,38):\n       for A in J0(N).new_subvariety().decomposition():\n           T = A.rational_torsion_subgroup()\n           print('%-5s%-5s%-5s%-5s'%(N, A.dimension(), T.divisor_of_order(), T.multiple_of_order()))\nExpected:\n    11   1    5    5\n    14   1    6    6\n    15   1    8    8\n    17   1    4    4\n    19   1    3    3\n    20   1    6    6\n    21   1    8    8\n    23   2    11   11\n    24   1    8    8\n    26   1    3    3\n    26   1    7    7\n    27   1    3    3\n    29   2    7    7\n    30   1    6    6\n    31   2    5    5\n    32   1    4    4\n    33   1    4    4\n    34   1    6    6\n    35   1    3    3\n    35   2    16   16\n    36   1    6    6\n    37   1    1    1\n    37   1    3    3\nGot:\n    11   1    5    5    \n    14   1    6    6    \n    15   1    8    8    \n    17   1    4    4    \n    19   1    3    3    \n    20   1    6    6    \n    21   1    8    8    \n    23   2    11   11   \n    24   1    8    8    \n    26   1    3    3    \n    26   1    7    7    \n    27   1    3    3    \n    doctest:warning\n      File \"/home/jdemeyer/sage-test/src/bin/sage-runtests\", line 163, in <module>\n        err = DC.run()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1225, in run\n        self.run_doctests()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 929, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1991, in dispatch\n        self.parallel_dispatch()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1888, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2174, in start\n        super(DocTestWorker, self).start()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/process.py\", line 130, in start\n        self._popen = Popen(self)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/forking.py\", line 126, in __init__\n        code = process_obj._bootstrap()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/process.py\", line 267, in _bootstrap\n        self.run()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2130, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2468, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2515, in _run\n        result = runner.run(test)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 860, in run\n        return self._run(test, compileflags, out)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.abvar.torsion_subgroup[9]>\", line 2, in <module>\n        for A in J0(N).new_subvariety().decomposition():\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py\", line 4521, in decomposition\n        S = ModularAbelianVariety_abstract.decomposition(self, simple=simple, bound=bound)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py\", line 3398, in decomposition\n        I_F, I_E, X = self._classify_ambient_factors(simple=simple, bound=bound)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py\", line 3531, in _classify_ambient_factors\n        S   = self.vector_space()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py\", line 288, in vector_space\n        self.__vector_space = self.lattice().change_ring(QQ)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py\", line 4122, in lattice\n        K0 = M.integral_structure()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/modsym/space.py\", line 1584, in integral_structure\n        I = A.integral_structure()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/modsym/ambient.py\", line 2313, in integral_structure\n        B = B.echelon_form(algorithm='pari', include_zero_rows=False)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 817, in __call__\n        return self.element_class(self, entries, copy, coerce)\n    :\n    RuntimeWarning: cypari2 leaked 11040 bytes on the PARI stack\n    29   2    7    7    \n    30   1    6    6    \n    31   2    5    5    \n    32   1    4    4    \n    33   1    4    4    \n    34   1    6    6    \n    35   1    3    3    \n    35   2    16   16   \n    36   1    6    6    \n    37   1    1    1    \n    37   1    3    3    \n**********************************************************************\n```\n",
    "created_at": "2019-01-14T09:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369339",
    "user": "@jdemeyer"
}
```

After a few `make ptestlong` runs with this ticket, I got

```
sage -t --long src/sage/modular/abvar/torsion_subgroup.py
**********************************************************************
File "src/sage/modular/abvar/torsion_subgroup.py", line 46, in sage.modular.abvar.torsion_subgroup
Failed example:
    for N in range(1,38):
       for A in J0(N).new_subvariety().decomposition():
           T = A.rational_torsion_subgroup()
           print('%-5s%-5s%-5s%-5s'%(N, A.dimension(), T.divisor_of_order(), T.multiple_of_order()))
Expected:
    11   1    5    5
    14   1    6    6
    15   1    8    8
    17   1    4    4
    19   1    3    3
    20   1    6    6
    21   1    8    8
    23   2    11   11
    24   1    8    8
    26   1    3    3
    26   1    7    7
    27   1    3    3
    29   2    7    7
    30   1    6    6
    31   2    5    5
    32   1    4    4
    33   1    4    4
    34   1    6    6
    35   1    3    3
    35   2    16   16
    36   1    6    6
    37   1    1    1
    37   1    3    3
Got:
    11   1    5    5    
    14   1    6    6    
    15   1    8    8    
    17   1    4    4    
    19   1    3    3    
    20   1    6    6    
    21   1    8    8    
    23   2    11   11   
    24   1    8    8    
    26   1    3    3    
    26   1    7    7    
    27   1    3    3    
    doctest:warning
      File "/home/jdemeyer/sage-test/src/bin/sage-runtests", line 163, in <module>
        err = DC.run()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1225, in run
        self.run_doctests()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/control.py", line 929, in run_doctests
        self.dispatcher.dispatch()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1991, in dispatch
        self.parallel_dispatch()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1888, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2174, in start
        super(DocTestWorker, self).start()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/multiprocessing/process.py", line 267, in _bootstrap
        self.run()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2130, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2468, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2515, in _run
        result = runner.run(test)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 860, in run
        return self._run(test, compileflags, out)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.abvar.torsion_subgroup[9]>", line 2, in <module>
        for A in J0(N).new_subvariety().decomposition():
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py", line 4521, in decomposition
        S = ModularAbelianVariety_abstract.decomposition(self, simple=simple, bound=bound)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py", line 3398, in decomposition
        I_F, I_E, X = self._classify_ambient_factors(simple=simple, bound=bound)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py", line 3531, in _classify_ambient_factors
        S   = self.vector_space()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py", line 288, in vector_space
        self.__vector_space = self.lattice().change_ring(QQ)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/abvar/abvar.py", line 4122, in lattice
        K0 = M.integral_structure()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/modsym/space.py", line 1584, in integral_structure
        I = A.integral_structure()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/modular/modsym/ambient.py", line 2313, in integral_structure
        B = B.echelon_form(algorithm='pari', include_zero_rows=False)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 817, in __call__
        return self.element_class(self, entries, copy, coerce)
    :
    RuntimeWarning: cypari2 leaked 11040 bytes on the PARI stack
    29   2    7    7    
    30   1    6    6    
    31   2    5    5    
    32   1    4    4    
    33   1    4    4    
    34   1    6    6    
    35   1    3    3    
    35   2    16   16   
    36   1    6    6    
    37   1    1    1    
    37   1    3    3    
**********************************************************************
```




---

archive/issue_comments_369340.json:
```json
{
    "body": "I haven't seen that particular failure yet.",
    "created_at": "2019-01-14T09:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369340",
    "user": "@timokau"
}
```

I haven't seen that particular failure yet.



---

archive/issue_comments_369341.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2019-01-15T15:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369341",
    "user": "@jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_369342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-15T15:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369342",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369343.json:
```json
{
    "body": "git bisect actually points me to this commit: https://github.com/defeo/cypari2/commit/b980e648648\n\nAnd with that reverted on 2.0.2, the tests pass.",
    "created_at": "2019-01-15T17:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369343",
    "user": "@timokau"
}
```

git bisect actually points me to this commit: https://github.com/defeo/cypari2/commit/b980e648648

And with that reverted on 2.0.2, the tests pass.



---

archive/issue_comments_369344.json:
```json
{
    "body": "Replying to [comment:89 gh-timokau]:\n> git bisect actually points me to this commit: https://github.com/defeo/cypari2/commit/b980e648648\n\nMaybe, but that's surely not the real reason for the failing tests.",
    "created_at": "2019-01-15T17:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369344",
    "user": "@jdemeyer"
}
```

Replying to [comment:89 gh-timokau]:
> git bisect actually points me to this commit: https://github.com/defeo/cypari2/commit/b980e648648

Maybe, but that's surely not the real reason for the failing tests.



---

archive/issue_comments_369345.json:
```json
{
    "body": "Why not? What does that do?",
    "created_at": "2019-01-15T17:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369345",
    "user": "@timokau"
}
```

Why not? What does that do?



---

archive/issue_comments_369346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-15T17:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369346",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369347.json:
```json
{
    "body": "After 2 days(!) of debugging, I finally found out that the problem that I was seeing in [comment:85] was caused by a broken implementation of HNF computation. I added a new commit to fix that.",
    "created_at": "2019-01-15T17:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369347",
    "user": "@jdemeyer"
}
```

After 2 days(!) of debugging, I finally found out that the problem that I was seeing in [comment:85] was caused by a broken implementation of HNF computation. I added a new commit to fix that.



---

archive/issue_comments_369348.json:
```json
{
    "body": "I added some code to `cypari2` to better check for potential problems like this (and this is how I determined the problem). But then I found other issues in Sage, which are fixed by the dependency #27060.\n\nSo it remains to make a new `cypari2` release and then update this ticket.",
    "created_at": "2019-01-15T18:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369348",
    "user": "@jdemeyer"
}
```

I added some code to `cypari2` to better check for potential problems like this (and this is how I determined the problem). But then I found other issues in Sage, which are fixed by the dependency #27060.

So it remains to make a new `cypari2` release and then update this ticket.



---

archive/issue_comments_369349.json:
```json
{
    "body": "Replying to [comment:93 jdemeyer]:\n> After 2 days(!) of debugging, I finally found out that the problem that I was seeing in [comment:85] was caused by a broken implementation of HNF computation. I added a new commit to fix that.\n\nThank you for your work!\n\nNot sure if the new version will need additional sage changes, but when I run current master (cc1d51071358d9deeeff65ba83a04da9735d4abd) with the patch from this branch I get\n\n\n```\nFailed example:\n    complex_plot(zeta, (-30,30), (-30,30))\nExpected:\n    Graphics object consisting of 1 graphics primitive\nGot:\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n    ERROR: sig_on_count = 1 during remove_from_pari_stack()\n[about a million more repetitions of this]\n```\n\n\nFor a lot of tests.\n\n\nCould you elaborate why the commit I pointed out cannot possibly be responsible for the issue I'm seeing?",
    "created_at": "2019-01-15T21:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369349",
    "user": "@timokau"
}
```

Replying to [comment:93 jdemeyer]:
> After 2 days(!) of debugging, I finally found out that the problem that I was seeing in [comment:85] was caused by a broken implementation of HNF computation. I added a new commit to fix that.

Thank you for your work!

Not sure if the new version will need additional sage changes, but when I run current master (cc1d51071358d9deeeff65ba83a04da9735d4abd) with the patch from this branch I get


```
Failed example:
    complex_plot(zeta, (-30,30), (-30,30))
Expected:
    Graphics object consisting of 1 graphics primitive
Got:
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
    ERROR: sig_on_count = 1 during remove_from_pari_stack()
[about a million more repetitions of this]
```


For a lot of tests.


Could you elaborate why the commit I pointed out cannot possibly be responsible for the issue I'm seeing?



---

archive/issue_comments_369350.json:
```json
{
    "body": "Replying to [comment:95 gh-timokau]:\n> with the patch from this branch\n\nAre you very sure about that? Please double check that you're using the right branch from this ticket (note that it has 3 commits on top of 8.6.rc1, you need to apply them all).",
    "created_at": "2019-01-15T21:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369350",
    "user": "@jdemeyer"
}
```

Replying to [comment:95 gh-timokau]:
> with the patch from this branch

Are you very sure about that? Please double check that you're using the right branch from this ticket (note that it has 3 commits on top of 8.6.rc1, you need to apply them all).



---

archive/issue_comments_369351.json:
```json
{
    "body": "Here are a bunch of logs of the failure:\n\nhttp://sprunge.us/BBxE3I\nhttp://sprunge.us/o0dKgP\nhttp://sprunge.us/TemVir\nhttp://sprunge.us/LzAYUz",
    "created_at": "2019-01-15T21:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369351",
    "user": "@timokau"
}
```

Here are a bunch of logs of the failure:

http://sprunge.us/BBxE3I
http://sprunge.us/o0dKgP
http://sprunge.us/TemVir
http://sprunge.us/LzAYUz



---

archive/issue_comments_369352.json:
```json
{
    "body": "Replying to [comment:96 jdemeyer]:\n> Replying to [comment:95 gh-timokau]:\n> > with the patch from this branch\n> \n> Are you very sure about that? Please double check that you're using the right branch from this ticket.\n\nNot the latest version you pushed 4hrs ago. Sorry about that.",
    "created_at": "2019-01-15T21:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369352",
    "user": "@timokau"
}
```

Replying to [comment:96 jdemeyer]:
> Replying to [comment:95 gh-timokau]:
> > with the patch from this branch
> 
> Are you very sure about that? Please double check that you're using the right branch from this ticket.

Not the latest version you pushed 4hrs ago. Sorry about that.



---

archive/issue_comments_369353.json:
```json
{
    "body": "Just now I updated cypari2 master. So please test with that and with the Sage patches (3 commits) from the branch here.\n\nI won't push any additional changes until you report back.",
    "created_at": "2019-01-15T21:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369353",
    "user": "@jdemeyer"
}
```

Just now I updated cypari2 master. So please test with that and with the Sage patches (3 commits) from the branch here.

I won't push any additional changes until you report back.



---

archive/issue_comments_369354.json:
```json
{
    "body": "Alright, testing the current version of this ticket (https://git.sagemath.org/sage.git/diff?id2=62fe3948ea8ca4c91e877290ed23529b6e6f79fe&id=a185f05263d4a0a58bf8a95fd49ba9d31df195c3) with the current cypari2 master (35e66b5ad58839b771c8acfd1fe7d7e03678cc88).\n\n> I won't push any additional changes until you report back.\n\nThat will be tomorrow though. Getting too late for another full ptestlong.",
    "created_at": "2019-01-15T21:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369354",
    "user": "@timokau"
}
```

Alright, testing the current version of this ticket (https://git.sagemath.org/sage.git/diff?id2=62fe3948ea8ca4c91e877290ed23529b6e6f79fe&id=a185f05263d4a0a58bf8a95fd49ba9d31df195c3) with the current cypari2 master (35e66b5ad58839b771c8acfd1fe7d7e03678cc88).

> I won't push any additional changes until you report back.

That will be tomorrow though. Getting too late for another full ptestlong.



---

archive/issue_comments_369355.json:
```json
{
    "body": "While updating cypari2 to latest master I also noticed that it was set to plain 2.0.2. I'm pretty sure the last ptestlong was with master, but I must've reset it at some time. So maybe the last ptestlong wasn't with master after all.\n\nAnyways, we'll know more when the next test finishes.",
    "created_at": "2019-01-15T21:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369355",
    "user": "@timokau"
}
```

While updating cypari2 to latest master I also noticed that it was set to plain 2.0.2. I'm pretty sure the last ptestlong was with master, but I must've reset it at some time. So maybe the last ptestlong wasn't with master after all.

Anyways, we'll know more when the next test finishes.



---

archive/issue_comments_369356.json:
```json
{
    "body": "\n```\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 5378.1 seconds\n    cpu time: 18224.2 seconds\n    cumulative wall time: 20930.0 seconds\n```\n\n\n\ud83c\udf89",
    "created_at": "2019-01-16T11:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369356",
    "user": "@timokau"
}
```


```
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5378.1 seconds
    cpu time: 18224.2 seconds
    cumulative wall time: 20930.0 seconds
```


🎉



---

archive/issue_comments_369357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-16T13:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369357",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369358.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-16T14:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369358",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369359.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-16T18:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369359",
    "user": "@timokau"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369360.json:
```json
{
    "body": "The latest changes are only documentation and I've run `ptestlong` with yesterday's version 4 times now to be sure. Lets go ahead with this.",
    "created_at": "2019-01-16T18:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369360",
    "user": "@timokau"
}
```

The latest changes are only documentation and I've run `ptestlong` with yesterday's version 4 times now to be sure. Lets go ahead with this.



---

archive/issue_comments_369361.json:
```json
{
    "body": "Note that the dependency #27060 still needs review.",
    "created_at": "2019-01-16T22:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369361",
    "user": "@jdemeyer"
}
```

Note that the dependency #27060 still needs review.



---

archive/issue_comments_369362.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-27T10:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26205#issuecomment-369362",
    "user": "@vbraun"
}
```

Resolution: fixed
