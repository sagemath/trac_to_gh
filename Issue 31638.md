# Issue 31638: Exponentation of p-adics fails when exponent is inexact zero

Issue created by migration from https://trac.sagemath.org/ticket/31875

Original creator: pbruin

Original creation time: 2021-05-29 06:51:49

CC:  slelievre

In SageMath 9.3:

```
sage: R = Zp(2)
sage: R(1)^R(0)
Traceback (most recent call last):
...
MemoryError: failed to allocate 576460752303423520 bytes

sage: R.<a> = Zq(4)
sage: R(1)^R(0)
sig_error() without sig_on()
(crash)
```




---

Comment by slelievre created at 2021-05-29 11:35:23

Exponentiation with a zero exponent should return
the ambient ring's "one" element.


---

Comment by slelievre created at 2021-05-29 11:35:23

Changing keywords from "" to "pow, zero".


---

Comment by pbruin created at 2021-05-29 20:19:10

Replying to [comment:2 slelievre]:
> Exponentiation with a zero exponent should return
> the ambient ring's "one" element.
Indeed.  This 1 could either have the default precision of the ring or the precision of `x` in the `x^(exact 0)` being computed.  The first option seems the most logical to me since `x^(exact 0)` is 1 independently of (the precision of) `x`.


---

Comment by pbruin created at 2021-05-31 14:54:23

Changing status from new to needs_review.


---

Comment by pbruin created at 2021-05-31 14:54:23

Note: `FM_template.pxi` has a completely different implementation of `__pow__()` (only for integer exponents) than the three files modified by this branch.  We leave this file unchanged.


---

Comment by tscrim created at 2021-06-01 00:02:31

I think the first option is the most sensible. Now there is another issue of `0^0`:

```
sage: R = ZpCA(19, 5, print_mode='series')
sage: R(0)^R(0)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-4-4a773a9fb9d4> in <module>
----> 1 R(Integer(0))**R(Integer(0))

~/sage-build/local/lib/python3.9/site-packages/sage/rings/padics/CA_template.pxi in ...
    503             else:
    504                 if not exact_exp and self.absprec > 0:
--> 505                     raise ValueError("in order to raise to a p-adic exponent, base must be a unit")
    506                 raise PrecisionError("Need more precision")
    507         else:

ValueError: in order to raise to a p-adic exponent, base must be a unit
```

To match !Sage/Python, this should also return `1`. I also think `0` should be special-cased in the exponentiation as `R(0)^R(1)` also fails.

I am okay with letting this ticket go as-in, but I think it would be better to fix this other issue here.


---

Comment by pbruin created at 2021-06-01 07:54:21

I think `0^a` should only be 0 if `a` is an exact zero, not if `a` is an inexact zero.  For example, `0<sup>(p</sup>100)` should be 0 for compatibility with the integers.

This already works (with the current patch) in capped relative precision:

```
sage: R = Zp(2)
sage: R(0)^R(0)
1 + O(2^20)
sage: R(0)^(O(2^20))
Traceback (most recent call last):
...
ValueError: in order to raise to a p-adic exponent, base must be a unit
```

The reason `R(0)^R(0)` fails in your example (and should fail, in my opinion) is that exact zero does not exist when working in capped absolute precision.


---

Comment by pbruin created at 2021-06-01 15:34:48

Replying to [comment:5 tscrim]:
> I also think `0` should be special-cased in the exponentiation as `R(0)^R(1)` also fails.
Things like `R(0)^(inexact element)` are not well defined; for example, there is no way of knowing whether `x^(1 + O(p^n))` should mean `x^1` (i.e. `x`) or something else like `x^(1 - p^n)`, which is in general completely different (or even undefined if `x = 0`).  I prefer to just fix the bug and not change anything else.


---

Comment by tscrim created at 2021-06-02 01:18:06

Okay, thank you for the explanations. Positive review.


---

Comment by tscrim created at 2021-06-02 01:18:06

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-06-02 16:40:27

Another powering ticket needs review at #11323.


---

Comment by vbraun created at 2021-06-21 21:16:43

Resolution: fixed
