# Issue 14374: SimplicialComplex chain complex composition not zero

archive/issues_014374.json:
```json
{
    "body": "Assignee: jhpalmieri\n\nCC:  jhpalmieri tscrim\n\nTestcase extracted from http://ask.sagemath.org/question/2572/error-computing-homology-of-a-simplicial-complex\n\n```\nsage: t0 = SimplicialComplex()\nsage: t0.add_face(('a', 'b'))\nsage: t0.add_face(('c', 'd', 'e'))\nsage: t0.add_face(('e', 'f', 'c'))\nsage: t0.homology()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-374-8061bc7260ca> in <module>()\n----> 1 t0.homology()\n\n/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/cell_complex.pyc in homology(self, dim, **kwds)\n    547         # _homology_ method.  See SimplicialComplex for one example.\n    548         if hasattr(self, '_homology_'):\n--> 549             return self._homology_(dim, **kwds)\n    550 \n    551         C = self.chain_complex(cochain=cohomology, augmented=True,\n\n/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in _homology_(self, dim, **kwds)\n   1923         kwds['subcomplex']=L\n   1924         C = self.chain_complex(dimensions=dims, augmented=True,\n-> 1925                                cochain=cohomology, **kwds)\n   1926         if verbose:\n   1927             print \" Done computing the chain complex. \"\n\n/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in chain_complex(self, **kwds)\n   1786             return ChainComplex(data=differentials, degree=1, **kwds)\n   1787         else:\n-> 1788             return ChainComplex(data=differentials, degree=-1, **kwds)\n   1789 \n   1790     def _homology_(self, dim=None, **kwds):\n\n/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/chain_complex.pyc in __init__(self, data, **kwds)\n    460                             raise TypeError, \"The differentials d_{%s} and d_{%s} are not compatible: their product is not defined.\" % (n, n+degree)\n    461                         if not prod.is_zero():\n--> 462                             raise ValueError, \"The differentials d_{%s} and d_{%s} are not compatible: their composition is not zero.\" % (n, n+degree)\n    463                 else:\n    464                     if not mat.nrows() == 0:\n\nValueError: The differentials d_{2} and d_{1} are not compatible: their composition is not zero.\n```\n\non sage-5.10.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/14578\n\n",
    "created_at": "2013-05-14T09:34:01Z",
    "labels": [
        "algebraic topology",
        "major",
        "bug"
    ],
    "title": "SimplicialComplex chain complex composition not zero",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14374",
    "user": "vbraun"
}
```
Assignee: jhpalmieri

CC:  jhpalmieri tscrim

Testcase extracted from http://ask.sagemath.org/question/2572/error-computing-homology-of-a-simplicial-complex

```
sage: t0 = SimplicialComplex()
sage: t0.add_face(('a', 'b'))
sage: t0.add_face(('c', 'd', 'e'))
sage: t0.add_face(('e', 'f', 'c'))
sage: t0.homology()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-374-8061bc7260ca> in <module>()
----> 1 t0.homology()

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/cell_complex.pyc in homology(self, dim, **kwds)
    547         # _homology_ method.  See SimplicialComplex for one example.
    548         if hasattr(self, '_homology_'):
--> 549             return self._homology_(dim, **kwds)
    550 
    551         C = self.chain_complex(cochain=cohomology, augmented=True,

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in _homology_(self, dim, **kwds)
   1923         kwds['subcomplex']=L
   1924         C = self.chain_complex(dimensions=dims, augmented=True,
-> 1925                                cochain=cohomology, **kwds)
   1926         if verbose:
   1927             print " Done computing the chain complex. "

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in chain_complex(self, **kwds)
   1786             return ChainComplex(data=differentials, degree=1, **kwds)
   1787         else:
-> 1788             return ChainComplex(data=differentials, degree=-1, **kwds)
   1789 
   1790     def _homology_(self, dim=None, **kwds):

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/chain_complex.pyc in __init__(self, data, **kwds)
    460                             raise TypeError, "The differentials d_{%s} and d_{%s} are not compatible: their product is not defined." % (n, n+degree)
    461                         if not prod.is_zero():
--> 462                             raise ValueError, "The differentials d_{%s} and d_{%s} are not compatible: their composition is not zero." % (n, n+degree)
    463                 else:
    464                     if not mat.nrows() == 0:

ValueError: The differentials d_{2} and d_{1} are not compatible: their composition is not zero.
```

on sage-5.10.beta2

Issue created by migration from https://trac.sagemath.org/ticket/14578





---

archive/issue_comments_181620.json:
```json
{
    "body": "The problem is the `add_face` method: it should sort the new vertex set, just like the `__init__` method does. Actually, we should cache the setting of `sort_facets`, and if True, then `add_face` should sort the vertex set.",
    "created_at": "2013-05-14T15:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181620",
    "user": "jhpalmieri"
}
```

The problem is the `add_face` method: it should sort the new vertex set, just like the `__init__` method does. Actually, we should cache the setting of `sort_facets`, and if True, then `add_face` should sort the vertex set.



---

archive/issue_comments_181621.json:
```json
{
    "body": "First attempt at a patch.",
    "created_at": "2013-05-14T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181621",
    "user": "jhpalmieri"
}
```

First attempt at a patch.



---

archive/issue_comments_181622.json:
```json
{
    "body": "Attachment [trac_14578-add-face.patch](tarball://root/attachments/some-uuid/ticket14578/trac_14578-add-face.patch) by jhpalmieri created at 2013-05-14 15:34:26",
    "created_at": "2013-05-14T15:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181622",
    "user": "jhpalmieri"
}
```

Attachment [trac_14578-add-face.patch](tarball://root/attachments/some-uuid/ticket14578/trac_14578-add-face.patch) by jhpalmieri created at 2013-05-14 15:34:26



---

archive/issue_comments_181623.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-14T15:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181623",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_181624.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-14T19:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181624",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_181625.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2013-05-14T19:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181625",
    "user": "vbraun"
}
```

Looks good to me!



---

archive/issue_comments_181626.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-17T06:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14374#issuecomment-181626",
    "user": "jdemeyer"
}
```

Resolution: fixed
