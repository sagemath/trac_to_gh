# Issue 14374: SimplicialComplex chain complex composition not zero

Issue created by migration from https://trac.sagemath.org/ticket/14578

Original creator: vbraun

Original creation time: 2013-05-14 09:34:01

Assignee: jhpalmieri

CC:  jhpalmieri tscrim

Testcase extracted from http://ask.sagemath.org/question/2572/error-computing-homology-of-a-simplicial-complex

```
sage: t0 = SimplicialComplex()
sage: t0.add_face(('a', 'b'))
sage: t0.add_face(('c', 'd', 'e'))
sage: t0.add_face(('e', 'f', 'c'))
sage: t0.homology()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-374-8061bc7260ca> in <module>()
----> 1 t0.homology()

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/cell_complex.pyc in homology(self, dim, **kwds)
    547         # _homology_ method.  See SimplicialComplex for one example.
    548         if hasattr(self, '_homology_'):
--> 549             return self._homology_(dim, **kwds)
    550 
    551         C = self.chain_complex(cochain=cohomology, augmented=True,

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in _homology_(self, dim, **kwds)
   1923         kwds['subcomplex']=L
   1924         C = self.chain_complex(dimensions=dims, augmented=True,
-> 1925                                cochain=cohomology, **kwds)
   1926         if verbose:
   1927             print " Done computing the chain complex. "

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.pyc in chain_complex(self, **kwds)
   1786             return ChainComplex(data=differentials, degree=1, **kwds)
   1787         else:
-> 1788             return ChainComplex(data=differentials, degree=-1, **kwds)
   1789 
   1790     def _homology_(self, dim=None, **kwds):

/home/vbraun/opt/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/homology/chain_complex.pyc in __init__(self, data, **kwds)
    460                             raise TypeError, "The differentials d_{%s} and d_{%s} are not compatible: their product is not defined." % (n, n+degree)
    461                         if not prod.is_zero():
--> 462                             raise ValueError, "The differentials d_{%s} and d_{%s} are not compatible: their composition is not zero." % (n, n+degree)
    463                 else:
    464                     if not mat.nrows() == 0:

ValueError: The differentials d_{2} and d_{1} are not compatible: their composition is not zero.
```

on sage-5.10.beta2


---

Comment by jhpalmieri created at 2013-05-14 15:24:49

The problem is the `add_face` method: it should sort the new vertex set, just like the `__init__` method does. Actually, we should cache the setting of `sort_facets`, and if True, then `add_face` should sort the vertex set.


---

Comment by jhpalmieri created at 2013-05-14 15:34:12

First attempt at a patch.


---

Attachment


---

Comment by jhpalmieri created at 2013-05-14 15:36:21

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-05-14 19:49:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-05-14 19:49:02

Looks good to me!


---

Comment by jdemeyer created at 2013-05-17 06:33:06

Resolution: fixed
