# Issue 12179: AttributeError when ploting a poset

Issue created by migration from Trac.

Original creator: slabbe

Original creation time: 2012-01-25 00:03:21

Assignee: sage-combinat

CC:  sage-combinat

Keywords: poset

Using sage-4.7.2

```
sage: m = WordMorphism('a->abb,b->ba')
sage: w = m.fixed_point('a')
sage: prefix = Word(list(w[:100]))
sage: pals = prefix.palindromes()
sage: poset = Poset((pals, lambda x,y: x.is_factor(y)))
sage: H = poset.hasse_diagram()
sage: H.plot()
Traceback (most recent call last):
...
AttributeError: 'int' object has no attribute 'parent'
```



---

Comment by SimonKing created at 2012-01-26 07:49:50

The problem was in the comparison of poset elements. Comparing a poset element with any object that has no parent (for example, comparison with a Python int) resulted in an error.

I thought the straight forward way to fix it is: Use `sage.structure.element.parent(bla)` instead of `bla.parent()`.

With the patch, plotting the Hasse diagram  works, and the bug fix is doctested. Needs review, then!


---

Comment by SimonKing created at 2012-01-26 07:49:50

Changing status from new to needs_review.


---

Comment by slabbe created at 2012-01-26 18:31:02

Great!

I tested it (on sage-4.7.2) and it solves the problem. All tests pass on `sage/combinat` repository. Documentation builds fine. Positive review.

But now, I get another problem. When the package `sage -i dot2tex` is installed the method `layout_graphviz` gets called by `plot` and it seems broken for another reason. But this should be another ticket :


```
sage: H.plot()
Traceback (most recent call last):
...
AttributeError: 'str' object has no attribute 'iteritems'
```


which is also obtained by doing


```
sage: H.layout_graphviz()    # require dot2tex
Traceback (most recent call last):
...
AttributeError: 'str' object has no attribute 'iteritems'
```



---

Comment by slabbe created at 2012-01-26 18:31:02

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2012-01-26 18:41:13

> But now, I get another problem. 

This is now #12364.


---

Comment by slabbe created at 2012-01-26 22:09:09

Same lines are edited by #11559. One will have to adapt to the other one.


---

Comment by slabbe created at 2012-01-26 22:16:57

Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.


---

Comment by slabbe created at 2012-01-26 22:16:57

Changing assignee from sage-combinat to slabbe.


---

Comment by nthiery created at 2012-01-26 23:15:32

Changing status from positive_review to needs_work.


---

Comment by nthiery created at 2012-01-26 23:15:32

Replying to [comment:5 slabbe]:
> Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.

I removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.


---

Comment by SimonKing created at 2012-01-26 23:22:56

Replying to [comment:6 nthiery]:
> Replying to [comment:5 slabbe]:
> > Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.
> 
> I removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.

Since #10998 does not touch the `__eq__` method, I suggest that one first checks whether the bug triggered by comparing a poset element with a Python int is really fixed by #10998.


---

Comment by SimonKing created at 2012-01-27 09:41:34

Sorry, I can't test whether #10998 fixes the bug in comparison: It is in conflict with #11900, which is merged into sage-5.0.beta0


---

Comment by SimonKing created at 2012-03-10 07:53:02

Changing status from needs_work to needs_review.


---

Comment by SimonKing created at 2012-03-10 07:53:02

I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.

On the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.

I leave the decision to you.


---

Comment by nthiery created at 2012-03-11 21:08:15

Replying to [comment:9 SimonKing]:
> I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.
> 
> On the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.
> 
> I leave the decision to you.

I don't mind. In case we go for it, we might as well use "sage.structure.sage_object.have_same_parent".


---

Comment by davidloeffler created at 2012-03-12 21:27:40

Apply only this patch.


---

Attachment

The new code from #10998 already uses `have_same_parent`. So all that's left to do here is to add a doctest to prevent the error happening again. I've uploaded a patch for that.


---

Comment by nthiery created at 2012-03-12 23:08:50

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-03-21 22:07:47

Resolution: fixed
