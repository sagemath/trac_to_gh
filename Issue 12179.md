# Issue 12179: AttributeError when ploting a poset

archive/issues_012179.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: poset\n\nUsing sage-4.7.2\n\n```\nsage: m = WordMorphism('a->abb,b->ba')\nsage: w = m.fixed_point('a')\nsage: prefix = Word(list(w[:100]))\nsage: pals = prefix.palindromes()\nsage: poset = Poset((pals, lambda x,y: x.is_factor(y)))\nsage: H = poset.hasse_diagram()\nsage: H.plot()\nTraceback (most recent call last):\n...\nAttributeError: 'int' object has no attribute 'parent'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12351\n\n",
    "created_at": "2012-01-25T00:03:21Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "AttributeError when ploting a poset",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12179",
    "user": "slabbe"
}
```
Assignee: sage-combinat

CC:  sage-combinat

Keywords: poset

Using sage-4.7.2

```
sage: m = WordMorphism('a->abb,b->ba')
sage: w = m.fixed_point('a')
sage: prefix = Word(list(w[:100]))
sage: pals = prefix.palindromes()
sage: poset = Poset((pals, lambda x,y: x.is_factor(y)))
sage: H = poset.hasse_diagram()
sage: H.plot()
Traceback (most recent call last):
...
AttributeError: 'int' object has no attribute 'parent'
```


Issue created by migration from https://trac.sagemath.org/ticket/12351





---

archive/issue_comments_141832.json:
```json
{
    "body": "The problem was in the comparison of poset elements. Comparing a poset element with any object that has no parent (for example, comparison with a Python int) resulted in an error.\n\nI thought the straight forward way to fix it is: Use `sage.structure.element.parent(bla)` instead of `bla.parent()`.\n\nWith the patch, plotting the Hasse diagram  works, and the bug fix is doctested. Needs review, then!",
    "created_at": "2012-01-26T07:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141832",
    "user": "SimonKing"
}
```

The problem was in the comparison of poset elements. Comparing a poset element with any object that has no parent (for example, comparison with a Python int) resulted in an error.

I thought the straight forward way to fix it is: Use `sage.structure.element.parent(bla)` instead of `bla.parent()`.

With the patch, plotting the Hasse diagram  works, and the bug fix is doctested. Needs review, then!



---

archive/issue_comments_141833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-26T07:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141833",
    "user": "SimonKing"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_141834.json:
```json
{
    "body": "Great!\n\nI tested it (on sage-4.7.2) and it solves the problem. All tests pass on `sage/combinat` repository. Documentation builds fine. Positive review.\n\nBut now, I get another problem. When the package `sage -i dot2tex` is installed the method `layout_graphviz` gets called by `plot` and it seems broken for another reason. But this should be another ticket :\n\n\n```\nsage: H.plot()\nTraceback (most recent call last):\n...\nAttributeError: 'str' object has no attribute 'iteritems'\n```\n\n\nwhich is also obtained by doing\n\n\n```\nsage: H.layout_graphviz()    # require dot2tex\nTraceback (most recent call last):\n...\nAttributeError: 'str' object has no attribute 'iteritems'\n```\n",
    "created_at": "2012-01-26T18:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141834",
    "user": "slabbe"
}
```

Great!

I tested it (on sage-4.7.2) and it solves the problem. All tests pass on `sage/combinat` repository. Documentation builds fine. Positive review.

But now, I get another problem. When the package `sage -i dot2tex` is installed the method `layout_graphviz` gets called by `plot` and it seems broken for another reason. But this should be another ticket :


```
sage: H.plot()
Traceback (most recent call last):
...
AttributeError: 'str' object has no attribute 'iteritems'
```


which is also obtained by doing


```
sage: H.layout_graphviz()    # require dot2tex
Traceback (most recent call last):
...
AttributeError: 'str' object has no attribute 'iteritems'
```




---

archive/issue_comments_141835.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-26T18:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141835",
    "user": "slabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141836.json:
```json
{
    "body": "> But now, I get another problem. \n\nThis is now #12364.",
    "created_at": "2012-01-26T18:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141836",
    "user": "slabbe"
}
```

> But now, I get another problem. 

This is now #12364.



---

archive/issue_comments_141837.json:
```json
{
    "body": "Same lines are edited by #11559. One will have to adapt to the other one.",
    "created_at": "2012-01-26T22:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141837",
    "user": "slabbe"
}
```

Same lines are edited by #11559. One will have to adapt to the other one.



---

archive/issue_comments_141838.json:
```json
{
    "body": "Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.",
    "created_at": "2012-01-26T22:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141838",
    "user": "slabbe"
}
```

Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.



---

archive/issue_comments_141839.json:
```json
{
    "body": "Changing assignee from sage-combinat to slabbe.",
    "created_at": "2012-01-26T22:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141839",
    "user": "slabbe"
}
```

Changing assignee from sage-combinat to slabbe.



---

archive/issue_comments_141840.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-01-26T23:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141840",
    "user": "nthiery"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_141841.json:
```json
{
    "body": "Replying to [comment:5 slabbe]:\n> Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.\n\nI removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.",
    "created_at": "2012-01-26T23:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141841",
    "user": "nthiery"
}
```

Replying to [comment:5 slabbe]:
> Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.

I removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.



---

archive/issue_comments_141842.json:
```json
{
    "body": "Replying to [comment:6 nthiery]:\n> Replying to [comment:5 slabbe]:\n> > Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.\n> \n> I removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.\n\nSince #10998 does not touch the `__eq__` method, I suggest that one first checks whether the bug triggered by comparing a poset element with a Python int is really fixed by #10998.",
    "created_at": "2012-01-26T23:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141842",
    "user": "SimonKing"
}
```

Replying to [comment:6 nthiery]:
> Replying to [comment:5 slabbe]:
> > Changed the ticket title and its description since the original problem (hasse diagram ploting) might be (is?) solved indirectly by #10998.
> 
> I removed the positive review, just in case we decide that this should be resolved as a duplicate of #10998.

Since #10998 does not touch the `__eq__` method, I suggest that one first checks whether the bug triggered by comparing a poset element with a Python int is really fixed by #10998.



---

archive/issue_comments_141843.json:
```json
{
    "body": "Sorry, I can't test whether #10998 fixes the bug in comparison: It is in conflict with #11900, which is merged into sage-5.0.beta0",
    "created_at": "2012-01-27T09:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141843",
    "user": "SimonKing"
}
```

Sorry, I can't test whether #10998 fixes the bug in comparison: It is in conflict with #11900, which is merged into sage-5.0.beta0



---

archive/issue_comments_141844.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-10T07:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141844",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141845.json:
```json
{
    "body": "I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.\n\nOn the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.\n\nI leave the decision to you.",
    "created_at": "2012-03-10T07:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141845",
    "user": "SimonKing"
}
```

I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.

On the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.

I leave the decision to you.



---

archive/issue_comments_141846.json:
```json
{
    "body": "Replying to [comment:9 SimonKing]:\n> I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.\n> \n> On the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.\n> \n> I leave the decision to you.\n\nI don't mind. In case we go for it, we might as well use \"sage.structure.sage_object.have_same_parent\".",
    "created_at": "2012-03-11T21:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141846",
    "user": "nthiery"
}
```

Replying to [comment:9 SimonKing]:
> I just tested that the error vanishes with #10998. From that point of view, one could suggest that the ticket be resolved as duplicate.
> 
> On the other hand, having `parent(bla)` instead of `bla.parent()` is another layer of security and won't hurt.
> 
> I leave the decision to you.

I don't mind. In case we go for it, we might as well use "sage.structure.sage_object.have_same_parent".



---

archive/issue_comments_141847.json:
```json
{
    "body": "Apply only this patch.",
    "created_at": "2012-03-12T21:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141847",
    "user": "davidloeffler"
}
```

Apply only this patch.



---

archive/issue_comments_141848.json:
```json
{
    "body": "Attachment [trac_12351-doctest.patch](tarball://root/attachments/some-uuid/ticket12351/trac_12351-doctest.patch) by davidloeffler created at 2012-03-12 21:28:51\n\nThe new code from #10998 already uses `have_same_parent`. So all that's left to do here is to add a doctest to prevent the error happening again. I've uploaded a patch for that.",
    "created_at": "2012-03-12T21:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141848",
    "user": "davidloeffler"
}
```

Attachment [trac_12351-doctest.patch](tarball://root/attachments/some-uuid/ticket12351/trac_12351-doctest.patch) by davidloeffler created at 2012-03-12 21:28:51

The new code from #10998 already uses `have_same_parent`. So all that's left to do here is to add a doctest to prevent the error happening again. I've uploaded a patch for that.



---

archive/issue_comments_141849.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-12T23:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141849",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141850.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12179#issuecomment-141850",
    "user": "jdemeyer"
}
```

Resolution: fixed
