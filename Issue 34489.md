# Issue 34489: Optional package papilo (dependency of scip)

Issue created by migration from https://trac.sagemath.org/ticket/34726

Original creator: mkoeppe

Original creation time: 2022-11-05 22:00:13

CC:  dimpase

https://github.com/scipopt/papilo/

Not packaged anywhere - https://repology.org/projects/?search=papilo


---

Comment by git created at 2022-11-05 23:43:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-11-06 00:03:56

`tox -e docker-ubuntu-jammy-standard -- papilo` gives

```
  [papilo-2.1.1]   CMake Error at /usr/lib/x86_64-linux-gnu/cmake/Boost-1.74.0/BoostConfig.cmake:141 (find_package):
  [papilo-2.1.1]     Could not find a package configuration file provided by
  [papilo-2.1.1]     "boost_program_options" (requested version 1.74.0) with any of the
  [papilo-2.1.1]     following names:
  [papilo-2.1.1]   
  [papilo-2.1.1]       boost_program_optionsConfig.cmake
  [papilo-2.1.1]       boost_program_options-config.cmake
  [papilo-2.1.1]   
  [papilo-2.1.1]     Add the installation prefix of "boost_program_options" to CMAKE_PREFIX_PATH
  [papilo-2.1.1]     or set "boost_program_options_DIR" to a directory containing one of the
  [papilo-2.1.1]     above files.  If "boost_program_options" provides a separate development
  [papilo-2.1.1]     package or SDK, be sure it has been installed.
  [papilo-2.1.1]   Call Stack (most recent call first):
  [papilo-2.1.1]     /usr/lib/x86_64-linux-gnu/cmake/Boost-1.74.0/BoostConfig.cmake:258 (boost_find_component)
  [papilo-2.1.1]     /usr/share/cmake-3.22/Modules/FindBoost.cmake:594 (find_package)
  [papilo-2.1.1]     CMakeLists.txt:50 (find_package)
```


https://stackoverflow.com/questions/20502194/cmake-cannot-find-boost-program-options-on-debian


---

Comment by git created at 2022-11-06 00:36:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-06 00:37:13


```
[papilo-2.1.1] -- Could NOT find TBB (missing: TBB_DIR)
[papilo-2.1.1] -- Could NOT find TBB (missing: TBB_IMPORTED_TARGETS tbb tbbmalloc) (Required is at least version "2018")
[papilo-2.1.1] -- Downloading TBB
```


so we'll need to add tbb as a package


---

Comment by git created at 2022-11-10 01:19:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-10 01:30:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-10 02:14:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-11-13 19:31:20

Changing status from new to needs_review.


---

Comment by git created at 2022-11-14 06:30:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-14 07:51:38

Our boost_cropped package does not provide program_options. 
ubuntu-bionic-minimal: https://github.com/mkoeppe/PySCIPOpt/actions/runs/3457453303/jobs/5774142273

```
[papilo-2.1.1]   CMake Error at /sage/local/share/cmake-3.24/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
  [papilo-2.1.1]     Could NOT find Boost (missing: program_options) (found suitable version
  [papilo-2.1.1]     "1.66.0", minimum required is "1.65")
```



---

Comment by dimpase created at 2022-11-14 11:01:56

could it be due to out boost being over 5 years old? I'll check if we can update to 1.80 easily


---

Comment by dimpase created at 2022-11-14 11:10:24

see #34748 for boost update


---

Comment by dimpase created at 2022-11-14 11:54:44

use updated boost_cropped


---

Comment by dimpase created at 2022-11-14 14:08:29

lgtm  - with #34748, or with a systemwide (newer that 1.66, i.e. 1.74) boost)


---

Comment by dimpase created at 2022-11-14 14:08:29

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-11-14 17:40:22

Did you test on a system that does not have boost? 

libboost_program_options is an actual library, it's not header-only.


---

Comment by dimpase created at 2022-11-14 18:19:04

oops, OK. Let me see. Indeed, I have boost system-wide, so probably it was called, instead of using locally installed headers-only. I'll check if it can be built from our boost_cropped.


---

Comment by dimpase created at 2022-11-14 18:19:04

Changing status from positive_review to needs_info.


---

Comment by dimpase created at 2022-11-14 18:28:46

here is the linking of papilo binary built by Sage, and indeed, it links to system-wide boost :-(

```
$ ldd local/bin/papilo 
	linux-vdso.so.1 (0x00007fff5577e000)
	libboost_iostreams.so.1.80.0 => /usr/lib64/libboost_iostreams.so.1.80.0 (0x00007feb4b17c000)
	libboost_serialization.so.1.80.0 => /usr/lib64/libboost_serialization.so.1.80.0 (0x00007feb4b136000)
	libboost_program_options.so.1.80.0 => /usr/lib64/libboost_program_options.so.1.80.0 (0x00007feb4b0c9000)
	libtbb.so.12 => /mnt/opt/Sage/sage-dev/local/lib/libtbb.so.12 (0x00007feb4b07b000)
	[... the rest is OK]
```


-----

For some reason, `papilo` also builds and installs two static libraries:

```
        "lib/libclusol.a",
        "lib/libpapilo-core.a"
```

Is this right?
`libtbb` does not link to `boost`.


---

Comment by mkoeppe created at 2022-11-14 18:37:23

boost is needed only for the papilo executables. We don't actually need them; scip only needs the papilo library. https://github.com/scipopt/papilo/issues/21


---

Comment by mkoeppe created at 2022-11-14 18:38:54

Short of what I propose in https://github.com/scipopt/papilo/issues/21, we can just patch out building the papilo executables to get rid of this dependency.


---

Comment by dimpase created at 2022-11-14 18:41:51

In case we'd like to build papilo executable, on macOS it needs boost 1.72 or newer.


---

Comment by dimpase created at 2022-11-14 18:55:36

We can also build a needed subset (or all)  of boost libraries from the boost_cropped tarball, in that sense we are good, too.


---

Comment by mkoeppe created at 2022-11-18 22:43:34

Marc Pfetsch from the scip team advises that SCIP only needs the papilo headers.

I'll reduce this package to an do an ad-hoc installation of the headers.
This removes the need for work on boost.


---

Comment by mkoeppe created at 2022-11-18 22:43:34

Changing status from needs_info to needs_work.


---

Comment by git created at 2022-11-18 22:57:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-18 22:58:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-11-20 03:15:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-11-20 09:25:31

build failure on fedora-37 - https://github.com/scipopt/papilo/issues/23


---

Comment by mkoeppe created at 2022-11-23 22:08:33

build failure of `onetbb` on `ubuntu-trusty-toolchain-gcc_9` https://github.com/mkoeppe/PySCIPOpt/actions/runs/3535481134/jobs/5933596249

```
2021.7.0/src/src/tbb/../../include/tbb/../oneapi/tbb/detail/_concurrent_skip_list.h:25,
                 from /sage/local/var/tmp/sage/build/onetbb-2021.7.0/src/src/tbb/../../include/tbb/../oneapi/tbb/concurrent_map.h:21,
                 from /sage/local/var/tmp/sage/build/onetbb-2021.7.0/src/src/tbb/../../include/tbb/concurrent_map.h:17,
                 from /sage/local/var/tmp/sage/build/onetbb-2021.7.0/src/test/tbb/test_concurrent_map.cpp:19:
/usr/include/c++/9/bits/basic_string.h: In instantiation of 'class std::basic_string<char, std::char_traits<char>, tbb::detail::d1::tbb_allocator<char> >':
/sage/local/var/tmp/sage/build/onetbb-2021.7.0/src/test/common/concurrent_associative_common.h:964:29:   required from 'void test_map_specific_types() [with Checker = OrderedMapTypesTester]'
/sage/local/var/tmp/sage/build/onetbb-2021.7.0/src/test/tbb/test_concurrent_map.cpp:90:52:   required from here
/usr/include/c++/9/bits/basic_string.h:3146:63: error: no class template named 'rebind' in 'class tbb::detail::d1::tbb_allocator<char>'
 3146 |       typedef typename _Alloc::template rebind<_CharT>::other _CharT_alloc_type;
      |                                                               ^~~~~~~~~~~~~~~~~
compilation terminated due to -Wfatal-errors.
make[5]: *** [test/CMakeFiles/test_concurrent_map.dir/tbb/test_concurrent_map.cpp.o] Error 1
make[5]: Target `test/CMakeFiles/test_concurrent_map.dir/build' not remade because of errors.
make[4]: *** [test/CMakeFiles/test_concurrent_map.dir/all] Error 2
```



---

Comment by mkoeppe created at 2022-11-23 22:10:55

That's https://github.com/oneapi-src/oneTBB/issues/383


---

Comment by git created at 2022-11-27 00:19:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-27 00:22:51

build failures on `ubuntu-trusty-toolchain-gcc_9` (comment:31) and `fedora-37` (comment:30) remain, but that should not stop us from merging these optional packages. Both need help from upstream


---

Comment by mkoeppe created at 2022-11-27 00:22:51

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-11-27 23:12:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-12-09 02:32:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-12-09 02:37:31

This fixed the build failure on fedora-37.


---

Comment by mkoeppe created at 2022-12-09 17:55:16

Ready for review


---

Comment by git created at 2022-12-09 21:33:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-12-11 19:42:18

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-12-11 20:51:35

Thanks!
