# Issue 21853: Gosper algorithm

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2016-12-22 15:39:28

Pynac-0.7.3 will have Gosper's hypergeometric summation algorithm. The ticket will implement the interface and add an extensive test file. Later tickets may call it before delegating unsolved sums to Maxima.


---

Comment by git created at 2017-01-04 15:05:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-04 15:14:37

Changing status from new to needs_review.


---

Comment by rws created at 2017-01-05 07:13:32

I concede that we don't need really need #19461.


---

Comment by git created at 2017-01-06 07:31:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-06 14:12:47

Still missing is better documentation. As to performance 75% of complicated summations are spent in computation of one symbolic matrix determinant, of which 2/3 is expansions. It is astonishing that the 12x12 matrix determinant from the summation of `(((n<sup>4-14*n</sup>2-24*n-9) * 2^n / n^2 / (n+1)^2 / (n+2)^2 / (n+3)^2))` needs 4,316 first level expansions, even with the supposedly optimized "enhanced Laplace-expansion" determinant algorithm used. Resultants should be later computed in Pynac via Singular which apparently uses a subresultant algorithm.


---

Comment by git created at 2017-01-06 15:07:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-01-12 15:48:29

How does one "delegate to Maxima"? Does it do these "known bugs" cases?


---

Comment by rws created at 2017-01-12 16:43:24

Gosper summation is a subset of summation, i.e., it can handle only hypergeometric expressions (or sums of such). If one wants to use it in `sum` then if `gosper_sum` can't solve it, we would call Maxima's sum. The known bugs using Maxima's sum:

```
sage: (1 / (n^2 + sqrt(5)*n - 1)).sum(n,0,m)
-1/3*(m^3*(3*sqrt(5) - 7) - 3*m^2*(sqrt(5) - 1) - 2*m*(3*sqrt(5) - 2) - 6)/(m^3*(sqrt(5) - 3) - 3*m^2*(sqrt(5) - 1) - m*(sqrt(5) + 3) - 2)
sage: ((n*(n+a+b)*a^n*b^n)/factorial(n+a)/factorial(n+b)).sum(n,1,m)
-(a^(m + 1)*b^(m + 1)*factorial(a + 1)*factorial(b + 1) - ((a^2 + a)*b^2 + (a^2 + a)*b)*factorial(a + m)*factorial(b + m))/(factorial(a + m)*factorial(a + 1)*factorial(b + m)*factorial(b + 1))
sage: F(n, k) = binomial(n,k) * factorial(n) / factorial(k) / factorial(a-k) / f
....: actorial(a+n)
sage: (F(n+1, k) - F(n, k)).sum(k,0,m)
-sum(-(binomial(n + 1, k)*factorial(a + n)*factorial(n + 1) - binomial(n, k)*factorial(a + n + 1)*factorial(n))/(factorial(a - k)*factorial(k)), k, 0, m)/(factorial(a + n + 1)*factorial(a + n))
```

The last is clearly not solved. The first two seem correct.

I do not claim to add new functionality with this, just the starting point for speed optimizations and for Wilf-Zeilberger, which WOULD be new functionality.


---

Comment by git created at 2017-01-23 08:05:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-24 08:07:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-28 07:09:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-02-11 09:35:13

Is pynac-0.7.5 a dependence? Is there a ticket for it that should be referred to? Otherwise it's not clear how this can be reviewed.


---

Comment by git created at 2017-02-11 10:11:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-02-11 10:13:31

Pynac-0.7.5 is a dependence to make all doctests work. What you could already review is the Python interface code and the correctness of the doctests.


---

Comment by dimpase created at 2017-02-11 21:02:13

Do you mean to say that 0.7.5 isn't even on trac yet?


---

Comment by rws created at 2017-02-12 07:19:19

I'm still introducing new code and fleshing out bugs in Pynac master. Trying to implement a complex algorithm has been a big benefit for Pynac already.


---

Comment by rws created at 2017-02-12 16:10:41

Anyway, current Pynac git passes all doctests in 7 seconds, so I'll prepare a release.


---

Comment by git created at 2017-02-12 16:30:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-03-01 19:32:38

there is a wrong INPUT:: (should be INPUT: with no indentation on the next lines)


---

Comment by git created at 2017-03-02 09:59:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-03-24 08:38:45

doc (still) does not build

```
+[dochtml] OSError: [calculus ] docstring of sage.symbolic.expression.Expression.gosper_sum:7: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

Comment by git created at 2017-03-24 14:32:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-03-24 21:10:00

* you should de-indent the paragraphs after `INPUT:`

* `{n \choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\binom{n}{k}`


---

Comment by git created at 2017-03-25 09:15:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-03-25 09:19:26

Replying to [comment:29 chapoton]:
> * `{n \choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\binom{n}{k}`

Done. Does that plugin also check the output of Sage itself?

```
sage: latex(binomial(n,k))
{n \choose k}
```



---

Comment by rws created at 2017-04-13 08:07:29

Squashed, rebased, and fixed doctest continuation.
----
New commits:


---

Comment by chapoton created at 2017-04-17 19:11:10

* there is a .. MATH block start that is missing a blank line just after it

otherwise, looks good to me. You can set a positive review once the minor change above is done.


---

Comment by git created at 2017-04-18 06:23:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-04-18 06:24:35

Thanks for the review!


---

Comment by rws created at 2017-04-18 06:24:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-23 12:58:13

Resolution: fixed
