# Issue 21853: Gosper algorithm and Wilf-Zeilberger certificate

archive/issues_021853.json:
```json
{
    "body": "Pynac-0.7.3 introduces Gosper's hypergeometric summation algorithm. The ticket will implement the interface and add an extensive test file. Later tickets may call the function before delegating unsolved sums to Maxima.\n\nAlso, the WZ certificate can be computed to prove hypergeometric identities.\n\nThe test file has one test marked as known bug. Its resolution depends on handling of expressions with algebraic coefficients (i.e. manipulations of polynomials over algebraic fields).\n\nPynac-0.7.5 adds a crucial improvement and a faster implementation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22090\n\n",
    "closed_at": "2017-04-23T12:58:13Z",
    "created_at": "2016-12-22T15:39:28Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Gosper algorithm and Wilf-Zeilberger certificate",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21853",
    "user": "https://github.com/rwst"
}
```
Pynac-0.7.3 introduces Gosper's hypergeometric summation algorithm. The ticket will implement the interface and add an extensive test file. Later tickets may call the function before delegating unsolved sums to Maxima.

Also, the WZ certificate can be computed to prove hypergeometric identities.

The test file has one test marked as known bug. Its resolution depends on handling of expressions with algebraic coefficients (i.e. manipulations of polynomials over algebraic fields).

Pynac-0.7.5 adds a crucial improvement and a faster implementation.

Issue created by migration from https://trac.sagemath.org/ticket/22090





---

archive/issue_comments_303075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-04T15:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303076.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-04T15:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303076",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_303077.json:
```json
{
    "body": "I concede that we don't need really need #19461.",
    "created_at": "2017-01-05T07:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303077",
    "user": "https://github.com/rwst"
}
```

I concede that we don't need really need #19461.



---

archive/issue_comments_303078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-06T07:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303079.json:
```json
{
    "body": "Still missing is better documentation. As to performance 75% of complicated summations are spent in computation of one symbolic matrix determinant, of which 2/3 is expansions. It is astonishing that the 12x12 matrix determinant from the summation of `(((n<sup>4-14*n</sup>2-24*n-9) * 2^n / n^2 / (n+1)^2 / (n+2)^2 / (n+3)^2))` needs 4,316 first level expansions, even with the supposedly optimized \"enhanced Laplace-expansion\" determinant algorithm used. Resultants should be later computed in Pynac via Singular which apparently uses a subresultant algorithm.",
    "created_at": "2017-01-06T14:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303079",
    "user": "https://github.com/rwst"
}
```

Still missing is better documentation. As to performance 75% of complicated summations are spent in computation of one symbolic matrix determinant, of which 2/3 is expansions. It is astonishing that the 12x12 matrix determinant from the summation of `(((n<sup>4-14*n</sup>2-24*n-9) * 2^n / n^2 / (n+1)^2 / (n+2)^2 / (n+3)^2))` needs 4,316 first level expansions, even with the supposedly optimized "enhanced Laplace-expansion" determinant algorithm used. Resultants should be later computed in Pynac via Singular which apparently uses a subresultant algorithm.



---

archive/issue_events_058110.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-06T14:12:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21853#event-58110"
}
```



---

archive/issue_comments_303080.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-06T15:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303081.json:
```json
{
    "body": "How does one \"delegate to Maxima\"? Does it do these \"known bugs\" cases?",
    "created_at": "2017-01-12T15:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303081",
    "user": "https://github.com/dimpase"
}
```

How does one "delegate to Maxima"? Does it do these "known bugs" cases?



---

archive/issue_comments_303082.json:
```json
{
    "body": "Gosper summation is a subset of summation, i.e., it can handle only hypergeometric expressions (or sums of such). If one wants to use it in `sum` then if `gosper_sum` can't solve it, we would call Maxima's sum. The known bugs using Maxima's sum:\n\n```\nsage: (1 / (n^2 + sqrt(5)*n - 1)).sum(n,0,m)\n-1/3*(m^3*(3*sqrt(5) - 7) - 3*m^2*(sqrt(5) - 1) - 2*m*(3*sqrt(5) - 2) - 6)/(m^3*(sqrt(5) - 3) - 3*m^2*(sqrt(5) - 1) - m*(sqrt(5) + 3) - 2)\nsage: ((n*(n+a+b)*a^n*b^n)/factorial(n+a)/factorial(n+b)).sum(n,1,m)\n-(a^(m + 1)*b^(m + 1)*factorial(a + 1)*factorial(b + 1) - ((a^2 + a)*b^2 + (a^2 + a)*b)*factorial(a + m)*factorial(b + m))/(factorial(a + m)*factorial(a + 1)*factorial(b + m)*factorial(b + 1))\nsage: F(n, k) = binomial(n,k) * factorial(n) / factorial(k) / factorial(a-k) / f\n....: actorial(a+n)\nsage: (F(n+1, k) - F(n, k)).sum(k,0,m)\n-sum(-(binomial(n + 1, k)*factorial(a + n)*factorial(n + 1) - binomial(n, k)*factorial(a + n + 1)*factorial(n))/(factorial(a - k)*factorial(k)), k, 0, m)/(factorial(a + n + 1)*factorial(a + n))\n```\nThe last is clearly not solved. The first two seem correct.\n\nI do not claim to add new functionality with this, just the starting point for speed optimizations and for Wilf-Zeilberger, which WOULD be new functionality.",
    "created_at": "2017-01-12T16:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303082",
    "user": "https://github.com/rwst"
}
```

Gosper summation is a subset of summation, i.e., it can handle only hypergeometric expressions (or sums of such). If one wants to use it in `sum` then if `gosper_sum` can't solve it, we would call Maxima's sum. The known bugs using Maxima's sum:

```
sage: (1 / (n^2 + sqrt(5)*n - 1)).sum(n,0,m)
-1/3*(m^3*(3*sqrt(5) - 7) - 3*m^2*(sqrt(5) - 1) - 2*m*(3*sqrt(5) - 2) - 6)/(m^3*(sqrt(5) - 3) - 3*m^2*(sqrt(5) - 1) - m*(sqrt(5) + 3) - 2)
sage: ((n*(n+a+b)*a^n*b^n)/factorial(n+a)/factorial(n+b)).sum(n,1,m)
-(a^(m + 1)*b^(m + 1)*factorial(a + 1)*factorial(b + 1) - ((a^2 + a)*b^2 + (a^2 + a)*b)*factorial(a + m)*factorial(b + m))/(factorial(a + m)*factorial(a + 1)*factorial(b + m)*factorial(b + 1))
sage: F(n, k) = binomial(n,k) * factorial(n) / factorial(k) / factorial(a-k) / f
....: actorial(a+n)
sage: (F(n+1, k) - F(n, k)).sum(k,0,m)
-sum(-(binomial(n + 1, k)*factorial(a + n)*factorial(n + 1) - binomial(n, k)*factorial(a + n + 1)*factorial(n))/(factorial(a - k)*factorial(k)), k, 0, m)/(factorial(a + n + 1)*factorial(a + n))
```
The last is clearly not solved. The first two seem correct.

I do not claim to add new functionality with this, just the starting point for speed optimizations and for Wilf-Zeilberger, which WOULD be new functionality.



---

archive/issue_comments_303083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-23T08:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-24T08:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-28T07:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303086.json:
```json
{
    "body": "Is pynac-0.7.5 a dependence? Is there a ticket for it that should be referred to? Otherwise it's not clear how this can be reviewed.",
    "created_at": "2017-02-11T09:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303086",
    "user": "https://github.com/dimpase"
}
```

Is pynac-0.7.5 a dependence? Is there a ticket for it that should be referred to? Otherwise it's not clear how this can be reviewed.



---

archive/issue_comments_303087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-11T10:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303088.json:
```json
{
    "body": "Pynac-0.7.5 is a dependence to make all doctests work. What you could already review is the Python interface code and the correctness of the doctests.",
    "created_at": "2017-02-11T10:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303088",
    "user": "https://github.com/rwst"
}
```

Pynac-0.7.5 is a dependence to make all doctests work. What you could already review is the Python interface code and the correctness of the doctests.



---

archive/issue_comments_303089.json:
```json
{
    "body": "Do you mean to say that 0.7.5 isn't even on trac yet?",
    "created_at": "2017-02-11T21:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303089",
    "user": "https://github.com/dimpase"
}
```

Do you mean to say that 0.7.5 isn't even on trac yet?



---

archive/issue_comments_303090.json:
```json
{
    "body": "I'm still introducing new code and fleshing out bugs in Pynac master. Trying to implement a complex algorithm has been a big benefit for Pynac already.",
    "created_at": "2017-02-12T07:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303090",
    "user": "https://github.com/rwst"
}
```

I'm still introducing new code and fleshing out bugs in Pynac master. Trying to implement a complex algorithm has been a big benefit for Pynac already.



---

archive/issue_comments_303091.json:
```json
{
    "body": "Anyway, current Pynac git passes all doctests in 7 seconds, so I'll prepare a release.",
    "created_at": "2017-02-12T16:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303091",
    "user": "https://github.com/rwst"
}
```

Anyway, current Pynac git passes all doctests in 7 seconds, so I'll prepare a release.



---

archive/issue_comments_303092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-12T16:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303093.json:
```json
{
    "body": "there is a wrong INPUT:: (should be INPUT: with no indentation on the next lines)",
    "created_at": "2017-03-01T19:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303093",
    "user": "https://github.com/fchapoton"
}
```

there is a wrong INPUT:: (should be INPUT: with no indentation on the next lines)



---

archive/issue_comments_303094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-02T09:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303095.json:
```json
{
    "body": "doc (still) does not build\n\n```\n+[dochtml] OSError: [calculus ] docstring of sage.symbolic.expression.Expression.gosper_sum:7: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```",
    "created_at": "2017-03-24T08:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303095",
    "user": "https://github.com/fchapoton"
}
```

doc (still) does not build

```
+[dochtml] OSError: [calculus ] docstring of sage.symbolic.expression.Expression.gosper_sum:7: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

archive/issue_comments_303096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-24T14:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303097.json:
```json
{
    "body": "* you should de-indent the paragraphs after `INPUT:`\n\n* `{n \\choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\\binom{n}{k}`",
    "created_at": "2017-03-24T21:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303097",
    "user": "https://github.com/fchapoton"
}
```

* you should de-indent the paragraphs after `INPUT:`

* `{n \choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\binom{n}{k}`



---

archive/issue_comments_303098.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-25T09:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303099.json:
```json
{
    "body": "Replying to [comment:29 chapoton]:\n> * `{n \\choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\\binom{n}{k}`\n\n\nDone. Does that plugin also check the output of Sage itself?\n\n```\nsage: latex(binomial(n,k))\n{n \\choose k}\n```",
    "created_at": "2017-03-25T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303099",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:29 chapoton]:
> * `{n \choose k}` is deprecated latex code, and is going to trigger a patchbot plugin if a patchbot runs on this ticket ; use instead `\binom{n}{k}`


Done. Does that plugin also check the output of Sage itself?

```
sage: latex(binomial(n,k))
{n \choose k}
```



---

archive/issue_comments_303100.json:
```json
{
    "body": "Squashed, rebased, and fixed doctest continuation.\n\n---\nNew commits:",
    "created_at": "2017-04-13T08:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303100",
    "user": "https://github.com/rwst"
}
```

Squashed, rebased, and fixed doctest continuation.

---
New commits:



---

archive/issue_events_058111.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-13T08:07:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21853#event-58111"
}
```



---

archive/issue_events_058112.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-13T08:07:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21853#event-58112"
}
```



---

archive/issue_comments_303101.json:
```json
{
    "body": "* there is a .. MATH block start that is missing a blank line just after it\n\notherwise, looks good to me. You can set a positive review once the minor change above is done.",
    "created_at": "2017-04-17T19:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303101",
    "user": "https://github.com/fchapoton"
}
```

* there is a .. MATH block start that is missing a blank line just after it

otherwise, looks good to me. You can set a positive review once the minor change above is done.



---

archive/issue_comments_303102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-18T06:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303103.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2017-04-18T06:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303103",
    "user": "https://github.com/rwst"
}
```

Thanks for the review!



---

archive/issue_comments_303104.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-18T06:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303104",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_058113.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:58:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21853#event-58113"
}
```



---

archive/issue_comments_303105.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21853#issuecomment-303105",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
