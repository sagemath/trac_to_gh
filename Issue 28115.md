# Issue 28115: Fix dependencies on png.h and m4ri.h

archive/issues_028115.json:
```json
{
    "body": "CC:  dimpase embray\n\nI noticed in a recent build of Sage on a Debian buster VM, using many system packages, a problem:\n\nEvery time I try to re-build, whether I run `make build`, `sage -b`, etc. two Python modules get recompiled (from their Cython-generated C sources, though Cython itself is not being re-run). Specifically,\n\n\n```\nsrc/build/cythonized/sage/modules/vector_mod2_dense.c\nsrc/build/cythonized/sage/matrix/matrix_mod2_dense.c\n```\n\n\nOne of the things that these two modules have in common, and unique from other modules (as listed in src/module_list.py) is their dependency on `SAGE_INC + '/png.h'`.  But since I'm using the system libpng, this file does not exist, so those modules constantly get rebuilt.\n\nI'm not really sure the best thing to do about this right now.  Maybe we should only add those headers to the `depends` list if they actually exist (and just assume that system headers won't be updated often...)\n\nIssue created by migration from https://trac.sagemath.org/ticket/28352\n\n",
    "created_at": "2019-08-14T08:51:36Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "Fix dependencies on png.h and m4ri.h",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28115",
    "user": "jdemeyer"
}
```
CC:  dimpase embray

I noticed in a recent build of Sage on a Debian buster VM, using many system packages, a problem:

Every time I try to re-build, whether I run `make build`, `sage -b`, etc. two Python modules get recompiled (from their Cython-generated C sources, though Cython itself is not being re-run). Specifically,


```
src/build/cythonized/sage/modules/vector_mod2_dense.c
src/build/cythonized/sage/matrix/matrix_mod2_dense.c
```


One of the things that these two modules have in common, and unique from other modules (as listed in src/module_list.py) is their dependency on `SAGE_INC + '/png.h'`.  But since I'm using the system libpng, this file does not exist, so those modules constantly get rebuilt.

I'm not really sure the best thing to do about this right now.  Maybe we should only add those headers to the `depends` list if they actually exist (and just assume that system headers won't be updated often...)

Issue created by migration from https://trac.sagemath.org/ticket/28352





---

archive/issue_comments_397203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-14T08:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397203",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_397204.json:
```json
{
    "body": "If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?",
    "created_at": "2019-08-14T08:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397204",
    "user": "embray"
}
```

If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?



---

archive/issue_comments_397205.json:
```json
{
    "body": "Replying to [comment:3 embray]:\n> If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?\n\nCython picks up dependencies automatically if they appear in a `cdef extern from \"header.h\"`\n\nBut in this case, the dependency is through `pb_wrap.h`.",
    "created_at": "2019-08-14T09:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397205",
    "user": "jdemeyer"
}
```

Replying to [comment:3 embray]:
> If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?

Cython picks up dependencies automatically if they appear in a `cdef extern from "header.h"`

But in this case, the dependency is through `pb_wrap.h`.



---

archive/issue_comments_397206.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-14T09:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397206",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397207.json:
```json
{
    "body": "I see.  I suppose in principle one could put an empty `cdef extern from \"polybori/polybori.h\"` in the Cython file then.  I would still like to see the use of `SAGE_INC` there go away, but that can be handled in #28349 or a different ticket.",
    "created_at": "2019-08-14T09:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397207",
    "user": "embray"
}
```

I see.  I suppose in principle one could put an empty `cdef extern from "polybori/polybori.h"` in the Cython file then.  I would still like to see the use of `SAGE_INC` there go away, but that can be handled in #28349 or a different ticket.



---

archive/issue_comments_397208.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-14T09:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397208",
    "user": "embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397209.json:
```json
{
    "body": "Replying to [comment:5 embray]:\n> I suppose in principle one could put an empty `cdef extern from \"polybori/polybori.h\"` in the Cython file then.\n\nIndeed, I was thinking the same thing.",
    "created_at": "2019-08-14T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397209",
    "user": "jdemeyer"
}
```

Replying to [comment:5 embray]:
> I suppose in principle one could put an empty `cdef extern from "polybori/polybori.h"` in the Cython file then.

Indeed, I was thinking the same thing.



---

archive/issue_comments_397210.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-15T20:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28115#issuecomment-397210",
    "user": "vbraun"
}
```

Resolution: fixed
