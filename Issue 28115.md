# Issue 28115: Fix dependencies on png.h and m4ri.h

Issue created by migration from https://trac.sagemath.org/ticket/28352

Original creator: jdemeyer

Original creation time: 2019-08-14 08:51:36

CC:  dimpase embray

I noticed in a recent build of Sage on a Debian buster VM, using many system packages, a problem:

Every time I try to re-build, whether I run `make build`, `sage -b`, etc. two Python modules get recompiled (from their Cython-generated C sources, though Cython itself is not being re-run). Specifically,


```
src/build/cythonized/sage/modules/vector_mod2_dense.c
src/build/cythonized/sage/matrix/matrix_mod2_dense.c
```


One of the things that these two modules have in common, and unique from other modules (as listed in src/module_list.py) is their dependency on `SAGE_INC + '/png.h'`.  But since I'm using the system libpng, this file does not exist, so those modules constantly get rebuilt.

I'm not really sure the best thing to do about this right now.  Maybe we should only add those headers to the `depends` list if they actually exist (and just assume that system headers won't be updated often...)


---

Comment by git created at 2019-08-14 08:56:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2019-08-14 08:58:00

If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?


---

Comment by jdemeyer created at 2019-08-14 09:00:12

Replying to [comment:3 embray]:
> If Cython can pick up such header dependencies automatically, why do we still also need the `depends` for `sage.rings.polynomial.pbori`?

Cython picks up dependencies automatically if they appear in a `cdef extern from "header.h"`

But in this case, the dependency is through `pb_wrap.h`.


---

Comment by embray created at 2019-08-14 09:02:15

Changing status from new to needs_review.


---

Comment by embray created at 2019-08-14 09:02:15

I see.  I suppose in principle one could put an empty `cdef extern from "polybori/polybori.h"` in the Cython file then.  I would still like to see the use of `SAGE_INC` there go away, but that can be handled in #28349 or a different ticket.


---

Comment by embray created at 2019-08-14 09:02:21

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-08-14 09:35:09

Replying to [comment:5 embray]:
> I suppose in principle one could put an empty `cdef extern from "polybori/polybori.h"` in the Cython file then.

Indeed, I was thinking the same thing.


---

Comment by vbraun created at 2019-08-15 20:30:22

Resolution: fixed
