# Issue 14472: testcc.sh identifies clang as GCC

archive/issues_014472.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @jdemeyer\n\nKeywords: compiler detection testcxx CC CXX\n\nThe problem is that `clang` defines `__GNUC__` as well (as may Intel's `icc`).\n\nSo we should use\n\n```c\n#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)\nGCC\n...\n```\n\nor rather something like\n\n```c\n#ifdef __GNUC__\n#  ifdef __clang__\nCLANG\n#  elif defined(__INTEL_COMPILER)\nICC\n#  else\nGCC\n#  endif\n#define KNOWN_CC\n#endif\n```\n\ninstead.\n\nSimilar applies to `testcxx.sh`.  (`clang++`, i.e., `clang` in C++ mode defines both `__GNUC__` and `__GNUG__` as well.)\n\n----\n\nBut another problem is that a couple of scripts (e.g. `spkg-install`s) testing for GCC might be just happy with `clang` as well (because it is to some extent \"GCC-compatible\"), so these would have to get changed accordingly (to accept both `\"GCC\"` and `\"CLANG\"`), while others may indeed not work with `clang`.\n\nOther scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).\n\nIssue created by migration from https://trac.sagemath.org/ticket/14676\n\n",
    "created_at": "2013-06-03T08:57:45Z",
    "labels": [
        "component: build",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "testcc.sh identifies clang as GCC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14472",
    "user": "https://github.com/nexttime"
}
```
Assignee: GeorgSWeber

CC:  @jdemeyer

Keywords: compiler detection testcxx CC CXX

The problem is that `clang` defines `__GNUC__` as well (as may Intel's `icc`).

So we should use

```c
#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)
GCC
...
```

or rather something like

```c
#ifdef __GNUC__
#  ifdef __clang__
CLANG
#  elif defined(__INTEL_COMPILER)
ICC
#  else
GCC
#  endif
#define KNOWN_CC
#endif
```

instead.

Similar applies to `testcxx.sh`.  (`clang++`, i.e., `clang` in C++ mode defines both `__GNUC__` and `__GNUG__` as well.)

----

But another problem is that a couple of scripts (e.g. `spkg-install`s) testing for GCC might be just happy with `clang` as well (because it is to some extent "GCC-compatible"), so these would have to get changed accordingly (to accept both `"GCC"` and `"CLANG"`), while others may indeed not work with `clang`.

Other scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).

Issue created by migration from https://trac.sagemath.org/ticket/14676





---

archive/issue_comments_182890.json:
```json
{
    "body": "Replying to [ticket:14676 leif]:\n> The problem is that `clang` defines `__GNUC__` as well\n\nI don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.",
    "created_at": "2013-06-03T09:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182890",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:14676 leif]:
> The problem is that `clang` defines `__GNUC__` as well

I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.



---

archive/issue_comments_182891.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> Replying to [ticket:14676 leif]:\n> > The problem is that `clang` defines `__GNUC__` as well\n> \n> I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.\n\nAs I said, \"GCC-compatible\" *to some extent*, certainly not 100% compatible, especially (but not limited to) when it gets to C++.\n\n(If it was, Sage would just build with `clang` \"out of the box\", and #13948 is not the only problem.)",
    "created_at": "2013-06-03T10:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182891",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:1 jdemeyer]:
> Replying to [ticket:14676 leif]:
> > The problem is that `clang` defines `__GNUC__` as well
> 
> I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.

As I said, "GCC-compatible" *to some extent*, certainly not 100% compatible, especially (but not limited to) when it gets to C++.

(If it was, Sage would just build with `clang` "out of the box", and #13948 is not the only problem.)



---

archive/issue_comments_182892.json:
```json
{
    "body": "P.S.:  I mainly opened this ticket to at least *record* the issue.",
    "created_at": "2013-06-03T10:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182892",
    "user": "https://github.com/nexttime"
}
```

P.S.:  I mainly opened this ticket to at least *record* the issue.



---

archive/issue_comments_182893.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-17T07:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182893",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182894.json:
```json
{
    "body": "I think this is obsolete.",
    "created_at": "2016-09-17T07:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182894",
    "user": "https://github.com/kiwifb"
}
```

I think this is obsolete.



---

archive/issue_comments_182895.json:
```json
{
    "body": "Maybe not obsolete but at least pointless.",
    "created_at": "2016-09-17T07:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182895",
    "user": "https://github.com/jdemeyer"
}
```

Maybe not obsolete but at least pointless.



---

archive/issue_comments_182896.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-17T07:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182896",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_014235.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14472#event-14235"
}
```



---

archive/issue_comments_182897.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-21T18:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14472",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14472#issuecomment-182897",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid
