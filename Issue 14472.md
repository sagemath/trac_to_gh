# Issue 14472: testcc.sh identifies clang as GCC

Issue created by migration from https://trac.sagemath.org/ticket/14676

Original creator: leif

Original creation time: 2013-06-03 08:57:45

Assignee: GeorgSWeber

CC:  jdemeyer

Keywords: compiler detection testcxx CC CXX

The problem is that `clang` defines `__GNUC__` as well (as may Intel's `icc`).

So we should use

```c
#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)
GCC
...
```

or rather something like

```c
#ifdef __GNUC__
#  ifdef __clang__
CLANG
#  elif defined(__INTEL_COMPILER)
ICC
#  else
GCC
#  endif
#define KNOWN_CC
#endif
```

instead.

Similar applies to `testcxx.sh`.  (`clang++`, i.e., `clang` in C++ mode defines both `__GNUC__` and `__GNUG__` as well.)

----

But another problem is that a couple of scripts (e.g. `spkg-install`s) testing for GCC might be just happy with `clang` as well (because it is to some extent "GCC-compatible"), so these would have to get changed accordingly (to accept both `"GCC"` and `"CLANG"`), while others may indeed not work with `clang`.

Other scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).


---

Comment by jdemeyer created at 2013-06-03 09:56:53

Replying to [ticket:14676 leif]:
> The problem is that `clang` defines `__GNUC__` as well

I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.


---

Comment by leif created at 2013-06-03 10:06:14

Replying to [comment:1 jdemeyer]:
> Replying to [ticket:14676 leif]:
> > The problem is that `clang` defines `__GNUC__` as well
> 
> I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.

As I said, "GCC-compatible" _to some extent_, certainly not 100% compatible, especially (but not limited to) when it gets to C++.

(If it was, Sage would just build with `clang` "out of the box", and #13948 is not the only problem.)


---

Comment by leif created at 2013-06-03 10:10:23

P.S.:  I mainly opened this ticket to at least _record_ the issue.


---

Comment by fbissey created at 2016-09-17 07:24:13

Changing status from new to needs_review.


---

Comment by fbissey created at 2016-09-17 07:24:13

I think this is obsolete.


---

Comment by jdemeyer created at 2016-09-17 07:35:00

Maybe not obsolete but at least pointless.


---

Comment by jdemeyer created at 2016-09-17 07:35:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 18:03:11

Resolution: invalid
