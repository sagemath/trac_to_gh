# Issue 15085: Testing for antichains and chains in arbitrary posets

archive/issues_015085.json:
```json
{
    "body": "CC:  nbruin tscrim ncohen sage-combinat nthiery\n\nKeywords: posets, combinat, categories\n\n`sage/combinat/posets.py` currently has an `is_chain` method testing whether a poset is a chain, but there is no method to test if a subset of a poset is a chain; moreover, no comparable functionality for antichains exists. The present patch implements this functionality. Chain testing is implemented twice, once for finite and once for arbitrary posets.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15322\n\n",
    "created_at": "2013-10-25T01:30:41Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Testing for antichains and chains in arbitrary posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15085",
    "user": "darij"
}
```
CC:  nbruin tscrim ncohen sage-combinat nthiery

Keywords: posets, combinat, categories

`sage/combinat/posets.py` currently has an `is_chain` method testing whether a poset is a chain, but there is no method to test if a subset of a poset is a chain; moreover, no comparable functionality for antichains exists. The present patch implements this functionality. Chain testing is implemented twice, once for finite and once for arbitrary posets.

Issue created by migration from https://trac.sagemath.org/ticket/15322





---

archive/issue_comments_193367.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-25T01:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193367",
    "user": "darij"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_193368.json:
```json
{
    "body": "Attachment [trac_15322-chains-and-antichains-dg.patch](tarball://root/attachments/some-uuid/ticket15322/trac_15322-chains-and-antichains-dg.patch) by darij created at 2013-10-25 01:32:40",
    "created_at": "2013-10-25T01:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193368",
    "user": "darij"
}
```

Attachment [trac_15322-chains-and-antichains-dg.patch](tarball://root/attachments/some-uuid/ticket15322/trac_15322-chains-and-antichains-dg.patch) by darij created at 2013-10-25 01:32:40



---

archive/issue_comments_193369.json:
```json
{
    "body": "Hellooooooo !\n\nIs there any reason why `_element_to_vertex` should represent a linear extension of `P` ?\n\nNathann",
    "created_at": "2013-10-25T09:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193369",
    "user": "ncohen"
}
```

Hellooooooo !

Is there any reason why `_element_to_vertex` should represent a linear extension of `P` ?

Nathann



---

archive/issue_comments_193370.json:
```json
{
    "body": "Hi Nathannnnnn,\n\nI remember asking myself the same question, but this is explicitly claimed in some docstring (either `sage/combinat/posets/posets.py` or `sage/combinat/posets/hasse_diagram.py`).\n\nDarij",
    "created_at": "2013-10-25T13:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193370",
    "user": "darij"
}
```

Hi Nathannnnnn,

I remember asking myself the same question, but this is explicitly claimed in some docstring (either `sage/combinat/posets/posets.py` or `sage/combinat/posets/hasse_diagram.py`).

Darij



---

archive/issue_comments_193371.json:
```json
{
    "body": "Well, then if you insist on this `is_chain_of_poset` instead of `is_chain` and as `_element_to_vertex` can be assumed to be a linear extension, this patch looks right. What would you think of removing the second implementation of `is_chain_of_posets` and merge it with the first one though ? The docstrings are mostly similar, the documentation too. It would be cool not to have copies of those.\n\nThe \"ordered\" version would be the same, and then you could just check for the existence of this `._element_to_vertex` attribute. Would it also be possible to add a comment like `# _element_to_vertex can be assumed to be a linear extension of the poset` just before the call to `sorted` ? I really wondered what was going on before remembering that this may be the case `:-)`\n\nOh, and also : you use `Poset.le` from time to time, and the docstring seem to indicate that it should be a `Poset.lt`. Plus in `is_antichain_of_poset` you copy some part of the list in the second loop (so manyyy many times) while you actually test `.gt` AND `.lt`.\n\nThis could be rewritten, I think more efficiently as :\n\n\n```\nreturn all(not self.lt(x,y) for x in o for y in o)\n```\n\n\n....\nAND BY THE WAY (angry voice, right after wondering how `Poset.gt` was implemented)\n\nit looks like `Poset.lt` and `Poset.gt` actually call `Poset.compare_elements`. And the code of `Poset.compare_elements` first checks if `x<y` THEN if `x>y`.\n\nAs a result : any call to `.gt` or to `.lt` totally determines the relationship between the two elements, and computing both `.lt` and `.gt` actually computes TWICE whether the two elements are incomparable. As they both call `.compare_elements`. When you compute if one is smaller than the other Sage also wonder if it is not the opposite, or whether they are incomparable. Only nobody asked it to.\n\nHence with the current implementation you should only call `.compare_elements()` directly and use the full information it returns (as `.lt` and `.gt` do the same and ignore some part of this information).\n\nAnd these `.gt` and `.lt` functions will have to be patches eventually to compute ONLY what they are asked to, and not twice as much.\n\nNathann",
    "created_at": "2013-10-26T08:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193371",
    "user": "ncohen"
}
```

Well, then if you insist on this `is_chain_of_poset` instead of `is_chain` and as `_element_to_vertex` can be assumed to be a linear extension, this patch looks right. What would you think of removing the second implementation of `is_chain_of_posets` and merge it with the first one though ? The docstrings are mostly similar, the documentation too. It would be cool not to have copies of those.

The "ordered" version would be the same, and then you could just check for the existence of this `._element_to_vertex` attribute. Would it also be possible to add a comment like `# _element_to_vertex can be assumed to be a linear extension of the poset` just before the call to `sorted` ? I really wondered what was going on before remembering that this may be the case `:-)`

Oh, and also : you use `Poset.le` from time to time, and the docstring seem to indicate that it should be a `Poset.lt`. Plus in `is_antichain_of_poset` you copy some part of the list in the second loop (so manyyy many times) while you actually test `.gt` AND `.lt`.

This could be rewritten, I think more efficiently as :


```
return all(not self.lt(x,y) for x in o for y in o)
```


....
AND BY THE WAY (angry voice, right after wondering how `Poset.gt` was implemented)

it looks like `Poset.lt` and `Poset.gt` actually call `Poset.compare_elements`. And the code of `Poset.compare_elements` first checks if `x<y` THEN if `x>y`.

As a result : any call to `.gt` or to `.lt` totally determines the relationship between the two elements, and computing both `.lt` and `.gt` actually computes TWICE whether the two elements are incomparable. As they both call `.compare_elements`. When you compute if one is smaller than the other Sage also wonder if it is not the opposite, or whether they are incomparable. Only nobody asked it to.

Hence with the current implementation you should only call `.compare_elements()` directly and use the full information it returns (as `.lt` and `.gt` do the same and ignore some part of this information).

And these `.gt` and `.lt` functions will have to be patches eventually to compute ONLY what they are asked to, and not twice as much.

Nathann



---

archive/issue_comments_193372.json:
```json
{
    "body": "Hi Nathann,\n\nvery good observation about the docstring indicating `lt` instead of `le`. I've changed this now (in the ordered version; the unordered one is right because it only refers to the set). Also I've added a comment on `_element_to_vertex` and added your improvement to the antichain code.\n\nI don't understand the issue with calling `compare_elements` (what file is that in?) and anyway the `compare_elements` method seems to exist only for finite posets. I have not merged the two `is_chain_of_poset` methods so far because IMHO using overshadowing by inheritance is nicer than `getattr` (and probably faster?).\n\nfor the **patchbots**\n\napply trac_15322-chains-and-antichains-dg.patch\u200b trac_15322-some-edits-dg.patch\u200b\n\nfor the **patchbot**\n\napply trac_15322-chains-and-antichains-dg.patch\u200b trac_15322-some-edits-dg.patch\u200b\n\nfor the **patchbots**:\n\napply trac_15322-chains-and-antichains-dg.patch\u200b trac_15322-some-edits-dg.patch\u200b\n\nfor the **patchbot**:\n\napply trac_15322-chains-and-antichains-dg.patch\u200b trac_15322-some-edits-dg.patch\u200b",
    "created_at": "2013-10-26T16:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193372",
    "user": "darij"
}
```

Hi Nathann,

very good observation about the docstring indicating `lt` instead of `le`. I've changed this now (in the ordered version; the unordered one is right because it only refers to the set). Also I've added a comment on `_element_to_vertex` and added your improvement to the antichain code.

I don't understand the issue with calling `compare_elements` (what file is that in?) and anyway the `compare_elements` method seems to exist only for finite posets. I have not merged the two `is_chain_of_poset` methods so far because IMHO using overshadowing by inheritance is nicer than `getattr` (and probably faster?).

for the **patchbots**

apply trac_15322-chains-and-antichains-dg.patch​ trac_15322-some-edits-dg.patch​

for the **patchbot**

apply trac_15322-chains-and-antichains-dg.patch​ trac_15322-some-edits-dg.patch​

for the **patchbots**:

apply trac_15322-chains-and-antichains-dg.patch​ trac_15322-some-edits-dg.patch​

for the **patchbot**:

apply trac_15322-chains-and-antichains-dg.patch​ trac_15322-some-edits-dg.patch​



---

archive/issue_comments_193373.json:
```json
{
    "body": "Hellooooooooo !!\n\n> very good observation about the docstring indicating `lt` instead of `le`. I've changed this now (in the ordered version; the unordered one is right because it only refers to the set). Also I've added a comment on `_element_to_vertex` and added your improvement to the antichain code.\n\nThaaaaaaaanks !\n\n> I don't understand the issue with calling `compare_elements` (what file is that in?) and anyway the `compare_elements` method seems to exist only for finite posets.\n\nIndeed, indeed. Well, I just typed \n\n\n```\nsage: P = Poset(); P.compare_elements\n```\n\n\nAnd the problem is that when you just want to know `Poset.lt(x,y)` it also computes `Poset.gt(x,y)` and though I'm totally willing to think of how graphs could be improved so that Posets get faster, if the Poset code is that not-optimized I'm just working for nothing. I'll write a patch for that.\n\n> I have not merged the two `is_chain_of_poset` methods so far because IMHO using overshadowing by inheritance is nicer than `getattr` (and probably faster?).\n\nHmmmmm... Okay. It's just that the docstring is 99% of that function's code, and that it ends up being copied as a result.\n\nI'll go check my pasta then give your new patch a final look !\n\nNathann",
    "created_at": "2013-10-26T19:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193373",
    "user": "ncohen"
}
```

Hellooooooooo !!

> very good observation about the docstring indicating `lt` instead of `le`. I've changed this now (in the ordered version; the unordered one is right because it only refers to the set). Also I've added a comment on `_element_to_vertex` and added your improvement to the antichain code.

Thaaaaaaaanks !

> I don't understand the issue with calling `compare_elements` (what file is that in?) and anyway the `compare_elements` method seems to exist only for finite posets.

Indeed, indeed. Well, I just typed 


```
sage: P = Poset(); P.compare_elements
```


And the problem is that when you just want to know `Poset.lt(x,y)` it also computes `Poset.gt(x,y)` and though I'm totally willing to think of how graphs could be improved so that Posets get faster, if the Poset code is that not-optimized I'm just working for nothing. I'll write a patch for that.

> I have not merged the two `is_chain_of_poset` methods so far because IMHO using overshadowing by inheritance is nicer than `getattr` (and probably faster?).

Hmmmmm... Okay. It's just that the docstring is 99% of that function's code, and that it ends up being copied as a result.

I'll go check my pasta then give your new patch a final look !

Nathann



---

archive/issue_comments_193374.json:
```json
{
    "body": "Ahem. Sorry but there is still something to add : this patch depends on #15283 and so it would be a pity to not call `is_antichain` from there.\n\nAaaaaaand that will be the end. Sorry for the slow review `:-P`\n\nNathann",
    "created_at": "2013-10-26T20:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193374",
    "user": "ncohen"
}
```

Ahem. Sorry but there is still something to add : this patch depends on #15283 and so it would be a pity to not call `is_antichain` from there.

Aaaaaaand that will be the end. Sorry for the slow review `:-P`

Nathann



---

archive/issue_comments_193375.json:
```json
{
    "body": "Attachment [trac_15322-some-edits-dg.patch](tarball://root/attachments/some-uuid/ticket15322/trac_15322-some-edits-dg.patch) by darij created at 2013-10-26 21:01:20\n\nHi Nathann,\n\ndone. I've also done the same to the order ideal checks. Positive review then?\n\nBest regards,\\\\\nDarij",
    "created_at": "2013-10-26T21:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193375",
    "user": "darij"
}
```

Attachment [trac_15322-some-edits-dg.patch](tarball://root/attachments/some-uuid/ticket15322/trac_15322-some-edits-dg.patch) by darij created at 2013-10-26 21:01:20

Hi Nathann,

done. I've also done the same to the order ideal checks. Positive review then?

Best regards,\\
Darij



---

archive/issue_comments_193376.json:
```json
{
    "body": "Yooooooooooo !\n\n> done. I've also done the same to the order ideal checks. Positive review then?\n\nTests pass, no problem, good to go ! `;-)`\n\nNathann",
    "created_at": "2013-10-26T21:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193376",
    "user": "ncohen"
}
```

Yooooooooooo !

> done. I've also done the same to the order ideal checks. Positive review then?

Tests pass, no problem, good to go ! `;-)`

Nathann



---

archive/issue_comments_193377.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-26T21:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193377",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_193378.json:
```json
{
    "body": "Thank youuuuuuuuuuuuu!",
    "created_at": "2013-10-26T21:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193378",
    "user": "darij"
}
```

Thank youuuuuuuuuuuuu!



---

archive/issue_comments_193379.json:
```json
{
    "body": "?... Well I *did* review that patch `:-P`",
    "created_at": "2013-10-26T21:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193379",
    "user": "ncohen"
}
```

?... Well I *did* review that patch `:-P`



---

archive/issue_comments_193380.json:
```json
{
    "body": "WTF, how did that come? Oh, I see -- I posted my comment using an obsolete form (had this ticket open in my browser before you set yourself to reviewer). Sorry. Is there a place to report trac bugs?",
    "created_at": "2013-10-26T21:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193380",
    "user": "darij"
}
```

WTF, how did that come? Oh, I see -- I posted my comment using an obsolete form (had this ticket open in my browser before you set yourself to reviewer). Sorry. Is there a place to report trac bugs?



---

archive/issue_comments_193381.json:
```json
{
    "body": "No idea.\n\nI am about to commit murder though. I am writing this patch to not compute twice what you need when comparing elements of a poset and I read code which is so WRONG it's f**** criminal.\n\n\n```\nsage: p = Poset(DiGraph({0:[1],2:[1]})); p.show(); print p.is_chain()\nTrue\n```\n\n\nNathann",
    "created_at": "2013-10-26T21:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193381",
    "user": "ncohen"
}
```

No idea.

I am about to commit murder though. I am writing this patch to not compute twice what you need when comparing elements of a poset and I read code which is so WRONG it's f**** criminal.


```
sage: p = Poset(DiGraph({0:[1],2:[1]})); p.show(); print p.is_chain()
True
```


Nathann



---

archive/issue_comments_193382.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-11-06T12:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15085#issuecomment-193382",
    "user": "jdemeyer"
}
```

Resolution: fixed
