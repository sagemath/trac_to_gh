# Issue 11863: `list_plot` should accept lists of complex numbers

Issue created by migration from Trac.

Original creator: ddrake

Original creation time: 2011-11-15 01:03:31

Assignee: jason, was

Keywords: list_plot, complex

If I do

```
list_plot([1+I, 2+I, 4-I])
```

it's totally obvious what I want. We should make `list_plot` accept lists of complex numbers.


---

Comment by ddrake created at 2011-11-15 03:46:56

Patch up, please review. I improved the docstring for `list_plot`. I would like feedback on my method for detecting complex numbers. Right now, I do:

```
from sage.rings.complex_field import ComplexField 
CC = ComplexField() 
from sage.rings.complex_number import is_ComplexNumber 
if any(abs(CC(z).imag()) > 0 or is_ComplexNumber(z) for z in data): 
    data = [(z.real(), z.imag()) for z in data]
```

But I have a couple concerns:

* do we need to worry about numerical noise? Will testing for `abs(imaginary part) > 0` suffice?

* are `ComplexField()` and `is_ComplexNumber` the right functions to use here? 

Also, we *do* need to figure this out in `list_plot`, and not in `xydata_from_point_list`, because `list_plot` needs to decide whether to turn the data into tuples of real and imaginary parts, or do `zip(range(len(data)), data)`.


---

Comment by ddrake created at 2011-11-15 03:46:56

Changing status from new to needs_review.


---

Comment by ddrake created at 2011-11-15 04:39:43

Updated patch. I edited the docstring a bit and improved (I think) the Sphinx markup.


---

Comment by kini created at 2011-11-15 06:28:23

Nice! All tests pass on `sage.math`. Patch looks good too, and seems to work fine. Positive review from me.


---

Comment by kini created at 2011-11-15 06:28:23

Changing status from needs_review to positive_review.


---

Comment by ddrake created at 2011-11-15 06:49:02

Keshav: on IRC you were worried about a slowdown, since we do potentially run `CC()` and `is_ComplexNumber` on every element of the list. Do you think this will be okay?


---

Comment by ddrake created at 2011-11-15 07:18:33

Changing status from positive_review to needs_work.


---

Comment by ddrake created at 2011-11-15 07:18:33

Oops: found a bug in my patch. This list doesn't work:

```
[int(1), CC(2+I),...]
```

because "'int' object is not callable". Improved patch in a moment.


---

Comment by ddrake created at 2011-11-15 07:30:30

Changing status from needs_work to needs_review.


---

Comment by kini created at 2011-11-15 08:05:36

Wow, that's ugly. I didn't even think of that... rerunning doctests just in case.


---

Comment by kini created at 2011-11-15 08:09:41

As for the slowdown, I wasn't really worried, just asking if you thought it was a problem. If you have some doubts about it, by all means, do post to sage-devel :) If so I'll wait before rereviewing this.


---

Comment by ddrake created at 2011-11-17 01:54:11

Okay, running `CC` on everything is a terrifically bad idea: here's the current (4.7.2) behavior:

```
sage: foo = [random() for _ in range(1000)]      
sage: %timeit p = list_plot(foo)                 
625 loops, best of 3: 596 Âµs per loop
sage: %timeit p = list_plot([CC(z) for z in foo])
125 loops, best of 3: 7.2 ms per loop
```

So, an order of magnitude slowdown. As suggested by William at https://groups.google.com/d/topic/sage-devel/UiKTG3FkRwY/discussion, the new patch (up shortly) just catches a TypeError, which preserves the current speed for real input and neatly avoids the problem with `[int(1), CC(2+I),...]`; complex input anywhere will throw the TypeError, which we catch.


---

Attachment

New patch up. Passes doctests, docs build with no warning. Please review.


---

Comment by kini created at 2011-12-03 10:32:18

Whoops, sorry. Positive review.


---

Comment by kini created at 2011-12-03 10:32:18

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-12-09 10:21:23

Resolution: fixed
