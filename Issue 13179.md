# Issue 13179: Cannot import sage.libs.lcalc.lcalc_Lfunction

Issue created by migration from https://trac.sagemath.org/ticket/13351

Original creator: jpflori

Original creation time: 2012-08-08 20:00:58

Assignee: tbd

CC:  kcrisman dimpase

Keywords: cygwin spkg lcalc

Cygchecking the package shows that it looks for an inexistent libLfunction.so.
Indeed, this file is moved to libLfunction.dll on Cygwin to let Sage build.
But at runtime, it is the original .so file which is looked for (surely some DT_SONAME equivalent).
Letting libLfunction.so in place and symlinking it from libLfunction.dll seems more functional.

A better solution would to tell lcalc to build directly a .dll file on Cygwin (and .dylib on Mac OS X, etc.).


---

Comment by jpflori created at 2012-08-08 21:26:14

Update lcalc spkg, modifying lot of the Makefile (that we already modify and which is not that nice) available at
http://perso.telecom-paristech.fr/~flori/sage/lcalc-1.23.p11.spkg

This will also need a Sage library patch.


---

Attachment

Spkg diff, for review only.


---

Comment by jpflori created at 2012-08-08 21:48:19

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-01-15 15:23:53

Does this fix #9165?


---

Comment by jpflori created at 2013-01-15 15:25:26

No idea :) give it a try.


---

Comment by jpflori created at 2013-02-27 22:43:35

I think its the last ticket needed to correctly build Sage and get a working version except for a few doctests.
It would be great to have it for 5.8, nobody wants to have a look?


---

Comment by kcrisman created at 2013-02-28 01:37:13

I'm sorry, Jean-Pierre - I agree, but I simply have had no time at work to deal with my XP box (esp. since the 32-bit issue apparently is preventing proper rebasing, as discussed somewhere).  I hope to try again over spring break in a couple weeks.


---

Comment by dimpase created at 2013-02-28 05:59:44

Replying to [comment:7 jpflori]:
> I think its the last ticket needed to correctly build Sage and get a working version except for a few doctests.
> It would be great to have it for 5.8, nobody wants to have a look?
I'm away at a conference, and don't have access to a WIndows machine, until Sunday. And then I'll have jetlag :-)
So it has to wait for few days, sorry.


---

Comment by jpflori created at 2013-02-28 07:51:29

No hurry, it's just that its been rottijg around for some monthes, so Id like to get it ressurected :)


---

Comment by dimpase created at 2013-03-04 07:59:13

I still get import problems:

```
$ ./sage -t -long devel/sage/sage/libs/lcalc/
sage -t -long "devel/sage/sage/libs/lcalc/lcalc_Lfunction.pyx"
**********************************************************************
File "/usr/local/src/sage/sage-5.7.beta2/devel/sage/sage/libs/lcalc/lcalc_Lfunction.pyx", l 55:
    sage: from sage.libs.lcalc.lcalc_Lfunction import *
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage/sage-5.7.beta2/local/bin/ncadoctest.py", line 1231, in run__test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.7.beta2/local/bin/sagedoctest.py", line 38, in run_oexample
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.7.beta2/local/bin/ncadoctest.py", line 1172, in run__example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[2]>", line 1, in <module>
        from sage.libs.lcalc.lcalc_Lfunction import *###line 55:
    sage: from sage.libs.lcalc.lcalc_Lfunction import *
    ImportError: No such file or directory

etc etc etc
```

indeed:

```
sage: import sage.libs.lcalc.lcalc_Lfunction
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-a629fe51f139> in <module>()
----> 1 import sage.libs.lcalc.lcalc_Lfunction

ImportError: No such file or directory
sage:
```

note that 

```
sage: import sage.libs.lcalc
```

works.


---

Comment by dimpase created at 2013-03-04 07:59:57

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2013-03-04 08:06:02

Replying to [comment:11 dimpase]:
> I still get import problems:
> {{{
> $ ./sage -t -long devel/sage/sage/libs/lcalc/
> sage -t -long "devel/sage/sage/libs/lcalc/lcalc_Lfunction.pyx"
> **********************************************************************
> File "/usr/local/src/sage/sage-5.7.beta2/devel/sage/sage/libs/lcalc/lcalc_Lfunction.pyx", l 55:
>     sage: from sage.libs.lcalc.lcalc_Lfunction import *
> Exception raised:
>     Traceback (most recent call last):
>       File "/usr/local/src/sage/sage-5.7.beta2/local/bin/ncadoctest.py", line 1231, in run__test
>         self.run_one_example(test, example, filename, compileflags)
>       File "/usr/local/src/sage/sage-5.7.beta2/local/bin/sagedoctest.py", line 38, in run_oexample
>         OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
>       File "/usr/local/src/sage/sage-5.7.beta2/local/bin/ncadoctest.py", line 1172, in run__example
>         compileflags, 1) in test.globs
>       File "<doctest __main__.example_1[2]>", line 1, in <module>
>         from sage.libs.lcalc.lcalc_Lfunction import *###line 55:
>     sage: from sage.libs.lcalc.lcalc_Lfunction import *
>     ImportError: No such file or directory
> 
> etc etc etc
> }}}
> indeed:
> {{{
> sage: import sage.libs.lcalc.lcalc_Lfunction
> ---------------------------------------------------------------------------
> ImportError                               Traceback (most recent call last)
> <ipython-input-1-a629fe51f139> in <module>()
> ----> 1 import sage.libs.lcalc.lcalc_Lfunction
> 
> ImportError: No such file or directory
> sage:
> }}}
Did you install the patch to the Sage library and rebuilt it as well?
> note that 
> {{{
> sage: import sage.libs.lcalc
> }}}
> works.
That's expected, this file is not touched and does not depend on the spkg.


---

Comment by dimpase created at 2013-03-04 08:12:42

yes, I certainly applied trac_13351.patch and ran sage -b. (on 5.7.beta2, but I guess it should not matter).


---

Comment by dimpase created at 2013-03-04 08:38:31

Changing status from needs_work to positive_review.


---

Comment by dimpase created at 2013-03-04 08:38:31

Replying to [comment:14 dimpase]:
> yes, I certainly applied trac_13351.patch and ran sage -b. (on 5.7.beta2, but I guess it should not matter).

what happened is that the Python extension didn't get rebuilt, as the patch didn't touch the corresponding pyx file! So I touched this file, and now everything works. Positive review.


---

Comment by kcrisman created at 2013-03-08 12:11:14

It works on XP too!


---

Comment by jdemeyer created at 2013-03-13 11:05:04

Resolution: fixed
