# Issue 22995: inject_shorthands for Symmetric functions: don't forget the forgotten + refactoring

Issue created by migration from https://trac.sagemath.org/ticket/23232

Original creator: nthiery

Original creation time: 2017-06-13 20:39:06

CC:  hivert tscrim saliola vivianepons zabrocki aschilling darij

This ticket:

- Let `SymmetricFunctions` use the generic implementation of
  `inject_shorthands` for consistency and duplication reduction.

- Side effect: the list of defined shorthands is printed out, as for
  quasi symmetric functions & the like, which is helpful for the user.

- Adds the forgotten symmetric functions to the shorthands.

- Suppresses the `redefining xxx` warnings. They were deemed annoying
  by many users, and somewhat redudant with the list of defined
  shorthands. This is also consistent with the behavior of
  `inject_variable` of polynomial rings,

- Changes the message from "Injecting shorthand ..." to "Defining
  shorthand ...": this is clearer for the user and consistent with
  the behavior of `inject_variable`.

- Adds an option `warn` to sage.misc.misc.inject_variable`

Altogether, this gives:

```
sage: SymmetricFunctions(QQ).inject_shorthands()
Defining e as shorthand for Symmetric Functions over Rational Field in the elementary basis
Defining f as shorthand for Symmetric Functions over Rational Field in the forgotten basis
Defining h as shorthand for Symmetric Functions over Rational Field in the homogeneous basis
Defining m as shorthand for Symmetric Functions over Rational Field in the monomial basis
Defining p as shorthand for Symmetric Functions over Rational Field in the powersum basis
Defining s as shorthand for Symmetric Functions over Rational Field in the Schur basis
```


Instead of:

```
sage: SymmetricFunctions(QQ).inject_shorthands()
/opt/sage-git/local/lib/python2.7/site-packages/sage/combinat/sf/sf.py:1416: RuntimeWarning: redefining global value `e`
  inject_variable(shorthand, getattr(self, shorthand)())
```


(ticket implemented after discussion with Viviane Pons, François
Bergeron, Florent Hivert, Franco Saliola).


---

Comment by nthiery created at 2017-06-13 21:45:32

New commits:


---

Comment by nthiery created at 2017-06-13 21:45:32

Changing status from new to needs_review.


---

Comment by nthiery created at 2017-06-13 21:47:39

For the record: I ran `make ptest`, and I believe there was no error (my `database_gap` package installation is screwed up, which triggers many errors; so I may have missed one).


---

Comment by tscrim created at 2017-06-14 04:20:57

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-06-14 04:20:57

+1 on all points.


---

Comment by kdilks created at 2017-06-14 14:09:21

If the forgotten basis is being included, shouldn't the Witt basis also be included? From reading the tutorial part of ( http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/sf/sf.html#sage.combinat.sf.sf.SymmetricFunctions ), I got the impression that forgotten (and Witt) weren't forgotten, but just deemed "non-classical".


---

Comment by kdilks created at 2017-06-14 14:09:21

Changing status from positive_review to needs_work.


---

Comment by nthiery created at 2017-06-14 15:22:00

I guess the documentation really just means that those are less well known. But yeah, why not be systematic; it's the occasion to advertise this basis (which I had forgotten :-)).
Patch on its way, unless someone raises an objection quickly!


---

Comment by zabrocki created at 2017-06-14 15:24:28

If you are going to be systematic, there are other bases. sp, o, st and ht.


---

Comment by git created at 2017-06-14 15:32:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-06-14 15:43:04

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2017-06-14 15:45:15

Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?


---

Comment by aschilling created at 2017-06-14 16:01:37

Replying to [comment:12 nthiery]:
> Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?

Why do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says "Further bases can be found here ...."


---

Comment by nthiery created at 2017-06-14 16:18:52

Replying to [comment:13 aschilling]:
> Why do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says "Further bases can be found here ...."

Thanks Anne for the feedback. I don't really have an opinion. It's a question of finding a reasonable balance, and I am just wondering if users could get annoyed to have their namespace filled up / polluted with shorthands they would not use that often. More feedback anyone? I'll ask around here over lunch.


---

Comment by kdilks created at 2017-06-14 16:22:06

I could see there being conflicts with people using f as a variable name for a function/polynomial/etc., and it being overwritten by the forgotten basis, which they may have never learned exists in the first place.

Right now, I believe there's an optional parameter that defaults to giving the classical bases, but you can also set it to give a specific set of bases to inject. Maybe that could be modified so the default gives the classical bases, there's an option like "All" that will inject all implemented bases, and the user could still specificy a specific set of bases they want injected. The default giving classical bases could have a message at the end saying "set parameter blah to all for all implemented bases" as Anne suggested.


---

Comment by nthiery created at 2017-06-14 18:55:26

Franco's opinion goes along the same line: by default, inject only the "classical" bases from (basically those from Macdonald's book), thus including forgotten but not witt. And have an "all" parameter.

This can be implemented reasonnably generically. So I'll proceed this way unless someone comments differently soon.


---

Comment by git created at 2017-06-14 20:07:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saliola created at 2017-06-14 21:09:05


```
--- a/src/sage/categories/sets_cat.py
+++ b/src/sage/categories/sets_cat.py
@@ -2582,6 +2582,7 @@ Please use, e.g., S.algebra(QQ, category=Semigroups())""".format(self))
                 INPUT:
 
                 - ``shorthands`` -- a list (or iterable) of strings (default: ``self._shorthands``)
+                  or ``"all"`` (for ``self.shorthands_all``)
                 - ``verbose`` -- boolean (default ``True``);
                    whether to print the defined shorthands
```

If you can change `shorthands_all` to `_shorthands_all`, then you can set it to positive review on my behalf.


---

Comment by git created at 2017-06-14 21:31:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-06-15 07:03:31

one doctest failure in 

```
sage -t --long --warn-long 79.3 src/sage/categories/sets_cat.py 
```



---

Comment by git created at 2017-06-15 12:21:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-06-15 12:26:35

Fixed trivial doctest failure reported by the patchbot + Frédéric.
My patchbot reported many other failures, but that's because it's not yet properly setup (ssl strikes back); to be ignored.

I am currently building the pdf doc. And then it can go to positive review.


---

Comment by nthiery created at 2017-06-15 13:32:09

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2017-06-15 13:32:09

PDF doc builds. Moving to positive review.

Thanks everyone for the feedback!


---

Comment by vbraun created at 2017-06-15 23:09:57

Resolution: fixed
