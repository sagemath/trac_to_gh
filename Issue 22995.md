# Issue 22995: inject_shorthands for Symmetric functions: don't forget the forgotten + refactoring

archive/issues_022995.json:
```json
{
    "body": "CC:  @hivert @tscrim @saliola vivianepons @zabrocki @anneschilling @darijgr\n\nThis ticket:\n\n- Let `SymmetricFunctions` use the generic implementation of\n  `inject_shorthands` for consistency and duplication reduction.\n\n- Side effect: the list of defined shorthands is printed out, as for\n  quasi symmetric functions & the like, which is helpful for the user.\n\n- Adds the forgotten symmetric functions to the shorthands.\n\n- Suppresses the `redefining xxx` warnings. They were deemed annoying\n  by many users, and somewhat redudant with the list of defined\n  shorthands. This is also consistent with the behavior of\n  `inject_variable` of polynomial rings,\n\n- Changes the message from \"Injecting shorthand ...\" to \"Defining\n  shorthand ...\": this is clearer for the user and consistent with\n  the behavior of `inject_variable`.\n\n- Adds an option `warn` to sage.misc.misc.inject_variable`\n\nAltogether, this gives:\n\n```\nsage: SymmetricFunctions(QQ).inject_shorthands()\nDefining e as shorthand for Symmetric Functions over Rational Field in the elementary basis\nDefining f as shorthand for Symmetric Functions over Rational Field in the forgotten basis\nDefining h as shorthand for Symmetric Functions over Rational Field in the homogeneous basis\nDefining m as shorthand for Symmetric Functions over Rational Field in the monomial basis\nDefining p as shorthand for Symmetric Functions over Rational Field in the powersum basis\nDefining s as shorthand for Symmetric Functions over Rational Field in the Schur basis\n```\n\n\nInstead of:\n\n```\nsage: SymmetricFunctions(QQ).inject_shorthands()\n/opt/sage-git/local/lib/python2.7/site-packages/sage/combinat/sf/sf.py:1416: RuntimeWarning: redefining global value `e`\n  inject_variable(shorthand, getattr(self, shorthand)())\n```\n\n\n(ticket implemented after discussion with Viviane Pons, Fran\u00e7ois\nBergeron, Florent Hivert, Franco Saliola).\n\nIssue created by migration from https://trac.sagemath.org/ticket/23232\n\n",
    "created_at": "2017-06-13T20:39:06Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "inject_shorthands for Symmetric functions: don't forget the forgotten + refactoring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22995",
    "user": "@nthiery"
}
```
CC:  @hivert @tscrim @saliola vivianepons @zabrocki @anneschilling @darijgr

This ticket:

- Let `SymmetricFunctions` use the generic implementation of
  `inject_shorthands` for consistency and duplication reduction.

- Side effect: the list of defined shorthands is printed out, as for
  quasi symmetric functions & the like, which is helpful for the user.

- Adds the forgotten symmetric functions to the shorthands.

- Suppresses the `redefining xxx` warnings. They were deemed annoying
  by many users, and somewhat redudant with the list of defined
  shorthands. This is also consistent with the behavior of
  `inject_variable` of polynomial rings,

- Changes the message from "Injecting shorthand ..." to "Defining
  shorthand ...": this is clearer for the user and consistent with
  the behavior of `inject_variable`.

- Adds an option `warn` to sage.misc.misc.inject_variable`

Altogether, this gives:

```
sage: SymmetricFunctions(QQ).inject_shorthands()
Defining e as shorthand for Symmetric Functions over Rational Field in the elementary basis
Defining f as shorthand for Symmetric Functions over Rational Field in the forgotten basis
Defining h as shorthand for Symmetric Functions over Rational Field in the homogeneous basis
Defining m as shorthand for Symmetric Functions over Rational Field in the monomial basis
Defining p as shorthand for Symmetric Functions over Rational Field in the powersum basis
Defining s as shorthand for Symmetric Functions over Rational Field in the Schur basis
```


Instead of:

```
sage: SymmetricFunctions(QQ).inject_shorthands()
/opt/sage-git/local/lib/python2.7/site-packages/sage/combinat/sf/sf.py:1416: RuntimeWarning: redefining global value `e`
  inject_variable(shorthand, getattr(self, shorthand)())
```


(ticket implemented after discussion with Viviane Pons, Fran√ßois
Bergeron, Florent Hivert, Franco Saliola).

Issue created by migration from https://trac.sagemath.org/ticket/23232





---

archive/issue_comments_321834.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-13T21:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321834",
    "user": "@nthiery"
}
```

New commits:



---

archive/issue_comments_321835.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-13T21:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321835",
    "user": "@nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321836.json:
```json
{
    "body": "For the record: I ran `make ptest`, and I believe there was no error (my `database_gap` package installation is screwed up, which triggers many errors; so I may have missed one).",
    "created_at": "2017-06-13T21:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321836",
    "user": "@nthiery"
}
```

For the record: I ran `make ptest`, and I believe there was no error (my `database_gap` package installation is screwed up, which triggers many errors; so I may have missed one).



---

archive/issue_comments_321837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-14T04:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321837",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321838.json:
```json
{
    "body": "+1 on all points.",
    "created_at": "2017-06-14T04:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321838",
    "user": "@tscrim"
}
```

+1 on all points.



---

archive/issue_comments_321839.json:
```json
{
    "body": "If the forgotten basis is being included, shouldn't the Witt basis also be included? From reading the tutorial part of ( http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/sf/sf.html#sage.combinat.sf.sf.SymmetricFunctions ), I got the impression that forgotten (and Witt) weren't forgotten, but just deemed \"non-classical\".",
    "created_at": "2017-06-14T14:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321839",
    "user": "@kevindilks"
}
```

If the forgotten basis is being included, shouldn't the Witt basis also be included? From reading the tutorial part of ( http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/sf/sf.html#sage.combinat.sf.sf.SymmetricFunctions ), I got the impression that forgotten (and Witt) weren't forgotten, but just deemed "non-classical".



---

archive/issue_comments_321840.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-14T14:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321840",
    "user": "@kevindilks"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_321841.json:
```json
{
    "body": "I guess the documentation really just means that those are less well known. But yeah, why not be systematic; it's the occasion to advertise this basis (which I had forgotten :-)).\nPatch on its way, unless someone raises an objection quickly!",
    "created_at": "2017-06-14T15:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321841",
    "user": "@nthiery"
}
```

I guess the documentation really just means that those are less well known. But yeah, why not be systematic; it's the occasion to advertise this basis (which I had forgotten :-)).
Patch on its way, unless someone raises an objection quickly!



---

archive/issue_comments_321842.json:
```json
{
    "body": "If you are going to be systematic, there are other bases. sp, o, st and ht.",
    "created_at": "2017-06-14T15:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321842",
    "user": "@zabrocki"
}
```

If you are going to be systematic, there are other bases. sp, o, st and ht.



---

archive/issue_comments_321843.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-14T15:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321843",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321844.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-14T15:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321844",
    "user": "@nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321845.json:
```json
{
    "body": "Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?",
    "created_at": "2017-06-14T15:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321845",
    "user": "@nthiery"
}
```

Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?



---

archive/issue_comments_321846.json:
```json
{
    "body": "Replying to [comment:12 nthiery]:\n> Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?\n\nWhy do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says \"Further bases can be found here ....\"",
    "created_at": "2017-06-14T16:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321846",
    "user": "@anneschilling"
}
```

Replying to [comment:12 nthiery]:
> Mmmh, thanks Mike for the feedback. That starts to be a lot. Opinions anyone on whether we want to include them all?

Why do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says "Further bases can be found here ...."



---

archive/issue_comments_321847.json:
```json
{
    "body": "Replying to [comment:13 aschilling]:\n> Why do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says \"Further bases can be found here ....\"\n\nThanks Anne for the feedback. I don't really have an opinion. It's a question of finding a reasonable balance, and I am just wondering if users could get annoyed to have their namespace filled up / polluted with shorthands they would not use that often. More feedback anyone? I'll ask around here over lunch.",
    "created_at": "2017-06-14T16:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321847",
    "user": "@nthiery"
}
```

Replying to [comment:13 aschilling]:
> Why do you have the inject_shorthands if not to give all implemented bases? But if you think it is too much, then perhaps there should be a message underneath the list of injected ones that says "Further bases can be found here ...."

Thanks Anne for the feedback. I don't really have an opinion. It's a question of finding a reasonable balance, and I am just wondering if users could get annoyed to have their namespace filled up / polluted with shorthands they would not use that often. More feedback anyone? I'll ask around here over lunch.



---

archive/issue_comments_321848.json:
```json
{
    "body": "I could see there being conflicts with people using f as a variable name for a function/polynomial/etc., and it being overwritten by the forgotten basis, which they may have never learned exists in the first place.\n\nRight now, I believe there's an optional parameter that defaults to giving the classical bases, but you can also set it to give a specific set of bases to inject. Maybe that could be modified so the default gives the classical bases, there's an option like \"All\" that will inject all implemented bases, and the user could still specificy a specific set of bases they want injected. The default giving classical bases could have a message at the end saying \"set parameter blah to all for all implemented bases\" as Anne suggested.",
    "created_at": "2017-06-14T16:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321848",
    "user": "@kevindilks"
}
```

I could see there being conflicts with people using f as a variable name for a function/polynomial/etc., and it being overwritten by the forgotten basis, which they may have never learned exists in the first place.

Right now, I believe there's an optional parameter that defaults to giving the classical bases, but you can also set it to give a specific set of bases to inject. Maybe that could be modified so the default gives the classical bases, there's an option like "All" that will inject all implemented bases, and the user could still specificy a specific set of bases they want injected. The default giving classical bases could have a message at the end saying "set parameter blah to all for all implemented bases" as Anne suggested.



---

archive/issue_comments_321849.json:
```json
{
    "body": "Franco's opinion goes along the same line: by default, inject only the \"classical\" bases from (basically those from Macdonald's book), thus including forgotten but not witt. And have an \"all\" parameter.\n\nThis can be implemented reasonnably generically. So I'll proceed this way unless someone comments differently soon.",
    "created_at": "2017-06-14T18:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321849",
    "user": "@nthiery"
}
```

Franco's opinion goes along the same line: by default, inject only the "classical" bases from (basically those from Macdonald's book), thus including forgotten but not witt. And have an "all" parameter.

This can be implemented reasonnably generically. So I'll proceed this way unless someone comments differently soon.



---

archive/issue_comments_321850.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-14T20:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321850",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321851.json:
```json
{
    "body": "\n```\n--- a/src/sage/categories/sets_cat.py\n+++ b/src/sage/categories/sets_cat.py\n@@ -2582,6 +2582,7 @@ Please use, e.g., S.algebra(QQ, category=Semigroups())\"\"\".format(self))\n                 INPUT:\n \n                 - ``shorthands`` -- a list (or iterable) of strings (default: ``self._shorthands``)\n+                  or ``\"all\"`` (for ``self.shorthands_all``)\n                 - ``verbose`` -- boolean (default ``True``);\n                    whether to print the defined shorthands\n```\n\nIf you can change `shorthands_all` to `_shorthands_all`, then you can set it to positive review on my behalf.",
    "created_at": "2017-06-14T21:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321851",
    "user": "@saliola"
}
```


```
--- a/src/sage/categories/sets_cat.py
+++ b/src/sage/categories/sets_cat.py
@@ -2582,6 +2582,7 @@ Please use, e.g., S.algebra(QQ, category=Semigroups())""".format(self))
                 INPUT:
 
                 - ``shorthands`` -- a list (or iterable) of strings (default: ``self._shorthands``)
+                  or ``"all"`` (for ``self.shorthands_all``)
                 - ``verbose`` -- boolean (default ``True``);
                    whether to print the defined shorthands
```

If you can change `shorthands_all` to `_shorthands_all`, then you can set it to positive review on my behalf.



---

archive/issue_comments_321852.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-14T21:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321852",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321853.json:
```json
{
    "body": "one doctest failure in \n\n```\nsage -t --long --warn-long 79.3 src/sage/categories/sets_cat.py \n```\n",
    "created_at": "2017-06-15T07:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321853",
    "user": "@fchapoton"
}
```

one doctest failure in 

```
sage -t --long --warn-long 79.3 src/sage/categories/sets_cat.py 
```




---

archive/issue_comments_321854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-15T12:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321855.json:
```json
{
    "body": "Fixed trivial doctest failure reported by the patchbot + Fr\u00e9d\u00e9ric.\nMy patchbot reported many other failures, but that's because it's not yet properly setup (ssl strikes back); to be ignored.\n\nI am currently building the pdf doc. And then it can go to positive review.",
    "created_at": "2017-06-15T12:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321855",
    "user": "@nthiery"
}
```

Fixed trivial doctest failure reported by the patchbot + Fr√©d√©ric.
My patchbot reported many other failures, but that's because it's not yet properly setup (ssl strikes back); to be ignored.

I am currently building the pdf doc. And then it can go to positive review.



---

archive/issue_comments_321856.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-15T13:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321856",
    "user": "@nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321857.json:
```json
{
    "body": "PDF doc builds. Moving to positive review.\n\nThanks everyone for the feedback!",
    "created_at": "2017-06-15T13:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321857",
    "user": "@nthiery"
}
```

PDF doc builds. Moving to positive review.

Thanks everyone for the feedback!



---

archive/issue_comments_321858.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-15T23:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22995#issuecomment-321858",
    "user": "@vbraun"
}
```

Resolution: fixed
