# Issue 25792: Missing spkg: polytopes_db_4d

Issue created by migration from https://trac.sagemath.org/ticket/26029

Original creator: embray

Original creation time: 2018-08-09 08:57:45

CC:  mkoeppe vbraun

This spkg is mentioned in #14467 and was apparently "huge" (and hence optional).  But it is no longer listed under `build/pkgs` nor does it appear to be available on the download mirrors.

A few options:

1) If someone has a copy of this package we can convert it to a new-style SPKG (we will probably need to upload the tarball somewhere with enough space to host it).

2) We don't make it available as a package at all (if it is too big for the mirrors to even host it).  Instead, assuming this data is available to download somewhere online that's stable, we provide built-in functionality to download it if needed.

3) We just deprecate and remove the code that uses it.  There are at least a handful of tests that require it.


---

Comment by slelievre created at 2018-08-09 15:09:17

Related discussions:

- [Ask Sage question 43179: Problem installing package](https://ask.sagemath.org/question/43179) (2018-07)
- [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/yMn3aXvFsFM/1sZ7gn2pBQAJ) (2018-08)


---

Comment by slelievre created at 2018-08-10 15:11:09

The package is listed at:

- http://files.sagemath.org/spkg/huge/


---

Comment by slelievre created at 2018-08-10 17:41:47

And it's available from each of the [SageMath](SageMath) download mirrors. E.g.

- LIP6 Paris: http://www-ftp.lip6.fr/pub/math/sagemath/spkg/huge/
- Riken Japan: ftp://ftp.riken.jp/sagemath/spkg/huge/index.html

etc.

The problems encountered with this huge package might instead have to do with
- [Sage Trac ticket 26011: Copying package files is really slow](https://trac.sagemath.org/ticket/26011)


---

Comment by embray created at 2018-08-14 18:17:54

As I wrote on sage-devel, we could keep supporting this package if it were repackaged as a `.tar.<whatever compression method works best>`, and we added an appropriate `build/pkgs/polytopes_db_4d` for it.  We would then want to move it to a standard location on the mirrors, not under "spkg/huge".  That, _or_ leave it under "spkg/huge" (if there is some advantage to that--can mirrors opt not to carry "huge" packages?) but modify `sage-download-file` to be able to find tarballs under that path on the mirrors.


---

Comment by slelievre created at 2018-11-04 10:38:51

The following shows sage can find packages in "huge":

```
$ sage --info polytopes_db_4d
Attempting to get on-line info for package polytopes_db_4d
>>> Checking online list of optional packages.
>>> Checking online list of experimental packages.
>>> Checking online list of huge packages.
>>> Found polytopes_db_4d-1.0
...
```


The package cannot be installed with `sage -i` because it is an "old-style SPKG"

```
$ sage -i polytopes_db_4d
...
Error: package 'polytopes_db_4d' not found
Note: if it is an old-style package, use -p instead of -i to install it
```

but `sage -p` can install "old-style spkg" packages that still work, including this one.

```
$ sage -p polytopes_db_4d
Attempting to download package polytopes_db_4d
>>> Checking online list of optional packages.
>>> Checking online list of experimental packages.
>>> Checking online list of huge packages.
>>> Found polytopes_db_4d-1.0
================================== NOTE ==================================
You are about to download and install an old-style package. While this
might still work fine, old-style packages are unmaintained and deprecated.

This package will be removed in future versions of SageMath. If you care
about this package, you should make a proper new-style package instead.
For more information about making Sage packages, see
http://doc.sagemath.org/html/en/developer/packaging.html
==========================================================================
Are you sure (automatically continuing in 30 seconds) [Y/n]?
```

Once this is done and after restarting Sage, one can follow the
[SageMath documentation on using the palp_database of reflexive Hodge 4-polytopes](http://doc.sagemath.org/html/en/reference/discrete_geometry/sage/geometry/polyhedron/palp_database.html).
I tried it in Sage 8.4 as installed on the "k8s" CoCalc server for development,
which currently runs Ubuntu 17.04.

```
sage: version()
'SageMath version 8.4, Release Date: 2018-10-17'
```


```
sage: from sage.geometry.polyhedron.palp_database import Reflexive4dHodge
sage: ref = Reflexive4dHodge(1, 101)
sage: next(iter(ref)).Vrepresentation()
(A vertex at (-1, -1, -1, -1),
 A vertex at (0, 0, 0, 1),
 A vertex at (0, 0, 1, 0),
 A vertex at (0, 1, 0, 0),
 A vertex at (1, 0, 0, 0))
```



---

Comment by embray created at 2018-12-28 14:10:15

Retargeting some of my tickets (somewhat optimistically for now).


---

Comment by embray created at 2019-03-25 10:44:36

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.


---

Comment by embray created at 2019-04-19 16:49:36

According to Andrey Novoseltev:

> Data originates from http://hep.itp.tuwien.ac.at/~kreuzer/CY/
> 
> The whole list can be generated using PALP (a standard package in Sage), but when they have done it first, it took about a year on multiple computers, so there is sense in just downloading these polytopes. Sage package contains precomputed data for Hodge numbers as well, allowing quick search for particular cases. Volker knows more about exact details, I was just happily using the result.
> 
> While we are at it: it would be awesome if installation of this package after upgrade was faster. "Installation" just means unpacking files and copying them somewhere, but it takes something like 45 minutes. Some time ago I asked to use parallel decompressor if it is available in the system, which helped a lot, but then it stopped again.

As I wrote on sage-devel, perhaps it would make sense to host this data (as well as the 3D polytopes; why not?) on an online database somewhere that can be easily queried (including by the code in Sage which uses this data)?  This way it is possible to use as-needed without downloading the entire, very large database (though perhaps with the possibility of pre-downloading/caching all or parts of it as needed).

It would be very easy to write a simple web service, and perhaps the data and service could be hosted on sagemath.org.  This might also be a good opportunity for some MitM synergy.  There is a workshop later this year on mathematical data, and frameworks and services for accessing them, so that might be a good opportunity to work on such a project (I would be happy to help, especially if someone can help me with the math end of things as I have no idea what a reflexive Hodge polytope is much less how it would be represented in a MitM framework): https://opendreamkit.org/2019/08/17/WorkshopOnDataInMathematics/


---

Comment by dimpase created at 2019-04-23 11:35:00

A reflexive polytope is a full-dimensional lattice polytope (i.e. the vertices have integer coordinates), containing the origin in the interior, so that its dual
is also a lattice polytope. All this is readily available in Sage.


---

Comment by novoselt created at 2019-04-23 16:16:20

3D polytopes take so little space, that there is no sense at all removing them from Sage in their current form. As for 4D, there are probably very few people who are using them and so there is a lack of effort to do something about them. On the other hand, since there are papers referring to the use of this package in Sage, it would be nice to support repeating those computations in some way, even if installation is "non-standard".


---

Comment by dimpase created at 2020-06-09 21:51:02

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-06-09 21:51:02

New commits:


---

Comment by tscrim created at 2020-06-10 00:50:19

Do we want this to be experimental or optional? I feel like optional would be the better option for this.


---

Comment by mkoeppe created at 2020-06-10 02:11:22

I also think it should be "optional"


---

Comment by git created at 2020-06-11 15:45:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-06-11 15:46:22

OK, done


---

Comment by tscrim created at 2020-06-13 03:28:36

Thanks. I am ready to set a positive review. Any objections?


---

Comment by mkoeppe created at 2020-06-13 03:55:35

No objection; I haven't tried it though because downloading was taking too long.


---

Comment by tscrim created at 2020-06-14 23:44:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-14 23:44:17

It built for me without any problems, so I am setting it to positive.


---

Comment by vbraun created at 2020-06-22 22:34:32

Resolution: fixed
