# Issue 14188: Domain error with tgammal when using FreeBSD

Issue created by migration from Trac.

Original creator: stephen

Original creation time: 2013-03-31 03:03:20

Assignee: pjeremy

CC:  jpflori

Keywords: cephes, FreeBSD

I tested sage-5.9.beta2 and got errors like this:

```
"sage -t devel/sage/sage/plot/plot.py"

**********************************************************************
File "devel/sage/sage/plot/plot.py", line 942, in sage.plot.plot.plot
Failed example:
    plot(gamma, (-3, 4), detect_poles = True).show(ymin = -5, ymax = 5)
Expected nothing
Got:
    <BLANKLINE>
    tgammal domain error
**********************************************************************
File "devel/sage/sage/plot/plot.py", line 946, in sage.plot.plot.plot
Failed example:
    plot(gamma, (-3, 4), detect_poles = 'show').show(ymin = -5, ymax = 5)
Expected nothing
Got:
    <BLANKLINE>
    tgammal domain error
```


This is because FreeBSD uses the cephes math libraries.  These output error messages to stdout when they shouldn't.

The following patch removes all the print statements from files called mtherror.c in cephes.


```
--- cephes-2.8.p1/spkg-install-orig     2013-03-30 20:48:35.000000000 +0000
+++ cephes-2.8.p1/spkg-install  2013-03-30 20:48:57.000000000 +0000
`@``@` -24,6 +24,8 `@``@`
     fi
 done

+sed -i .orig 's|.*printf|//&1|' */mtherr.c
+
 echo "Building Cephes..."
 $MAKE
 if [ $? -ne 0 ]; then
```



---

Comment by kcrisman created at 2013-04-02 01:53:40

I like this idea, but I'm not sure whether this is what we should do.   It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.


---

Comment by stephen created at 2013-04-02 02:05:05

I don't mind using an explicit patch.  I was just trying to indicate where the error took place.

In some sense it is a bandaid fix.  But then the whole cephes library is a bandaid fix.


---

Comment by kcrisman created at 2013-04-02 02:08:19

Great, perhaps I will get around to making this patch sometime.  You are right about cephes, I suppose, but numerical issues are somewhat beyond my ken.


---

Comment by jdemeyer created at 2013-04-03 14:08:01

Replying to [comment:1 kcrisman]:
> It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.
I agree. Document the `sed` script in `SPKG.txt`, but apply a patch in `spkg-install`.
