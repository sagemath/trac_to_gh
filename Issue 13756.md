# Issue 13756: nef.x segfaults on Cygwin

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2013-01-16 09:08:10

Assignee: tbd

CC:  kcrisman vbraun

Keywords: palp nef.x cygwin segfault

On my Windows 7 x64 install of 5.6.rc0 I get segfaults in nef.x.

After rebuilding with CFLAGS="-g -O0" I get the following backtrace

```
Program received signal SIGSEGV, Segmentation fault.
__chkstk_ms () at ../../../src/libgcc/config/i386/cygwin.S:173
173     ../../../src/libgcc/config/i386/cygwin.S: No such file or directory.
(gdb) bt
#0  __chkstk_ms () at ../../../src/libgcc/config/i386/cygwin.S:173
#1  0x004320e5 in part_nef (_P=0x686a0008, _V=0x20064a38, _E=0x20064b40,
    _OUT_PTL=0x6b470008, _codim=0x280c0c, _F=0x22fb7c) at Nefpart.c:774
#2  0x0042e421 in Make_E_Poly (outFILE=0x61187720, _W=0x280de8,
    _CP=0x7c1e0008, _CV=0x2003a0d0, _CE=0x2003a1d8, _codim=0x280c0c,
    _F=0x28ab70, _D=0x280c10) at E_Poly.c:1327
#3  0x00402061 in main (narg=2, fn=0x28ac40) at nef.c:291
```

on the file

```
$ cat ../nef.bug
3 6
 1  0  0 -1  0  0
 0  1  0  0 -1  0
 0  0  1  0  0 -1
```



---

Comment by jpflori created at 2013-01-16 09:23:52

It seems the stack is too small.
Recompiling with CFLAGS including -Wl,--stack,10000000 (so 10MB) makes the crash disappear.
I guess the best solution would to malloc the problematic stuff on the heap.


---

Comment by vbraun created at 2013-01-16 11:03:33

Thats a known issue in PALP, everything is done with static sizes for maximal speed.


---

Comment by jpflori created at 2013-01-16 16:28:04

Ok so we'll use the --stack fix.
Any suggestion on a sensible size?


---

Comment by vbraun created at 2013-01-16 16:32:11

Why isn't the Cygwin stack 8MB by default, this seems to be a pretty popular value in the Linux world.


---

Comment by jpflori created at 2013-01-16 16:59:36

No idea, I'll use 8MB then.


---

Comment by dimpase created at 2013-01-27 12:20:37

I've made the spkg where I put this 8MB stack fix for Cygwin in, please test!


---

Comment by dimpase created at 2013-01-27 12:20:37

Changing status from new to needs_review.


---

Comment by jpflori created at 2013-02-07 10:13:13

There is a typo in the hg commit message, and find funny the quoting you used in spkg-install when adding the necessary magic to CFLAGS.
Is that on purpose?


---

Comment by dimpase created at 2013-02-07 11:18:13

Replying to [comment:8 jpflori]:
> There is a typo in the hg commit message, and find funny the quoting you used in spkg-install when adding the necessary magic to CFLAGS.
> Is that on purpose?
none of it is intentional – but it works.


---

Comment by jpflori created at 2013-02-11 10:44:46

Spkg diff, for review only.


---

Attachment

Here comes a reviewer version of the spkg.
Fixed typos mentioned above, have tested this works as expected, everything looks clean.
I'm putting this as positive review.


---

Comment by jpflori created at 2013-02-11 10:48:53

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-02-17 22:43:39

Resolution: fixed
