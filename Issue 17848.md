# Issue 17848: Symbolic integration and SymPy

archive/issues_017848.json:
```json
{
    "body": "CC:  vdelecroix sstarosta kcrisman\n\nKeywords: sd66\n\nThe following integral cannot be evalueated by maxima:\n\n\n\n```\nsage: integrate(1/sqrt(1+x^3),x)\nintegrate(1/sqrt(x^3 + 1), x)\n```\n\n\n\nWith 'sympy' algorithm the computation fails:\n\n\n\n```\nsage: integrate(1/sqrt(1+x^3),x,algorithm='sympy')\n...\nAttributeError: 'gamma' object has no attribute '_sage_'\n```\n\n\n\nHowever, SymPy can compute the integral and gives the result in terms of gamma and hypergeometric functions:\n\n\n\n```\n>>> from sympy import *\n>>> x = Symbol('x')\n>>> integrate(1/sqrt(1+x**3), x)\nx*gamma(1/3)*hyper((1/3, 1/2), (4/3,), x**3*exp_polar(I*pi))/(3*gamma(4/3))\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18085\n\n",
    "created_at": "2015-03-30T09:40:29Z",
    "labels": [
        "symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Symbolic integration and SymPy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17848",
    "user": "kalvotom"
}
```
CC:  vdelecroix sstarosta kcrisman

Keywords: sd66

The following integral cannot be evalueated by maxima:



```
sage: integrate(1/sqrt(1+x^3),x)
integrate(1/sqrt(x^3 + 1), x)
```



With 'sympy' algorithm the computation fails:



```
sage: integrate(1/sqrt(1+x^3),x,algorithm='sympy')
...
AttributeError: 'gamma' object has no attribute '_sage_'
```



However, SymPy can compute the integral and gives the result in terms of gamma and hypergeometric functions:



```
>>> from sympy import *
>>> x = Symbol('x')
>>> integrate(1/sqrt(1+x**3), x)
x*gamma(1/3)*hyper((1/3, 1/2), (4/3,), x**3*exp_polar(I*pi))/(3*gamma(4/3))
```


Issue created by migration from https://trac.sagemath.org/ticket/18085





---

archive/issue_comments_239365.json:
```json
{
    "body": "The problem actually does occur in Sympy code...\n\n```\nsage: import sympy\nsage: s = sympy.gamma(1/3)\nsage: s._sage_()\nTraceback (most recent call last):\n...\nAttributeError: 'gamma' object has no attribute '_sage_'\n```\n\n\nWould you like to make a bug report in Sympy? Either on\n- the [mailing list](https://groups.google.com/forum/#!forum/sympy)\n- the [issue tracker](https://github.com/sympy/sympy/issues?utf8=%E2%9C%93&q=is%3Aopen)\n\nVincent",
    "created_at": "2015-03-30T11:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239365",
    "user": "vdelecroix"
}
```

The problem actually does occur in Sympy code...

```
sage: import sympy
sage: s = sympy.gamma(1/3)
sage: s._sage_()
Traceback (most recent call last):
...
AttributeError: 'gamma' object has no attribute '_sage_'
```


Would you like to make a bug report in Sympy? Either on
- the [mailing list](https://groups.google.com/forum/#!forum/sympy)
- the [issue tracker](https://github.com/sympy/sympy/issues?utf8=%E2%9C%93&q=is%3Aopen)

Vincent



---

archive/issue_comments_239366.json:
```json
{
    "body": "After some more digging it turned out the this is almost OK in the most recent git version of Sympy (not 0.7.6 which is shipped with Sage). Class Function [has a _sage_ method](https://github.com/sympy/sympy/blob/master/sympy/core/function.py#L679) and hypergeometric function `hyper` is also [correctly dealt with](https://github.com/sympy/sympy/blob/master/sympy/functions/special/hyper.py#L306).\n\nHowever, the example mentioned above still fails because Sage does not know `exp_polar` function. I have created [this pull request](https://github.com/sympy/sympy/pull/9224) which adds `_sage_` method to `exp_polar` and returns the usual exponential.\n\nTom\u00e1\u0161",
    "created_at": "2015-03-30T20:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239366",
    "user": "kalvotom"
}
```

After some more digging it turned out the this is almost OK in the most recent git version of Sympy (not 0.7.6 which is shipped with Sage). Class Function [has a _sage_ method](https://github.com/sympy/sympy/blob/master/sympy/core/function.py#L679) and hypergeometric function `hyper` is also [correctly dealt with](https://github.com/sympy/sympy/blob/master/sympy/functions/special/hyper.py#L306).

However, the example mentioned above still fails because Sage does not know `exp_polar` function. I have created [this pull request](https://github.com/sympy/sympy/pull/9224) which adds `_sage_` method to `exp_polar` and returns the usual exponential.

Tomáš



---

archive/issue_comments_239367.json:
```json
{
    "body": "I have commented on the pull request, https://github.com/sympy/sympy/pull/9224",
    "created_at": "2015-03-31T07:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239367",
    "user": "rws"
}
```

I have commented on the pull request, https://github.com/sympy/sympy/pull/9224



---

archive/issue_comments_239368.json:
```json
{
    "body": "If you want to do try your hands at it, see http://trac.sagemath.org/wiki/symbolics/functions for symbolic function tickets, and https://github.com/sagemath/sage/compare/develop...rwst:special for a collection of most recent code examples.",
    "created_at": "2015-04-02T07:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239368",
    "user": "rws"
}
```

If you want to do try your hands at it, see http://trac.sagemath.org/wiki/symbolics/functions for symbolic function tickets, and https://github.com/sagemath/sage/compare/develop...rwst:special for a collection of most recent code examples.



---

archive/issue_comments_239369.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-04T07:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239369",
    "user": "kalvotom"
}
```

New commits:



---

archive/issue_comments_239370.json:
```json
{
    "body": "I have doctested the function with git version of Sympy and all tests passed (especially the one with integration). I guess we have to wait for a new version of Sympy to arrive in Sage (probably Sympy 0.7.7).\n\nAnyway, this is my first attempt to contribute to Sage, so feel free to knitpick.\n\nI have one question. How complicated it would be to force Sage to perform simplifications like \n\n```\nsage: exp_polar(2 + 5*I)*exp_polar(5 - I)\nexp_polar(7 + 4*I)\n```\n\nMy current understanding is that such simplifications are taken care of by an external library ( Pynac ) and there is no way how to do this in Sage alone, am I right?",
    "created_at": "2015-04-04T07:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239370",
    "user": "kalvotom"
}
```

I have doctested the function with git version of Sympy and all tests passed (especially the one with integration). I guess we have to wait for a new version of Sympy to arrive in Sage (probably Sympy 0.7.7).

Anyway, this is my first attempt to contribute to Sage, so feel free to knitpick.

I have one question. How complicated it would be to force Sage to perform simplifications like 

```
sage: exp_polar(2 + 5*I)*exp_polar(5 - I)
exp_polar(7 + 4*I)
```

My current understanding is that such simplifications are taken care of by an external library ( Pynac ) and there is no way how to do this in Sage alone, am I right?



---

archive/issue_comments_239371.json:
```json
{
    "body": "Replying to [comment:9 kalvotom]:\n> I have doctested the function with git version of Sympy and all tests passed (especially the one with integration). I guess we have to wait for a new version of Sympy to arrive in Sage (probably Sympy 0.7.7).\nYes, other tickets are waiting for that too.\n> Anyway, this is my first attempt to contribute to Sage, so feel free to knitpick.\nWill get to it.\n> I have one question. How complicated it would be to force Sage to perform simplifications like \n> {{{\n> sage: exp_polar(2 + 5*I)*exp_polar(5 - I)\n> exp_polar(7 + 4*I)\n> }}}\n> My current understanding is that such simplifications are taken care of by an external library ( Pynac ) and there is no way how to do this in Sage alone, am I right?\nI think so, but I'm not much into Pynac. Anyway, it could be part of Python Sage by including a function that does it in one of the `Expression.simplify*` methods.",
    "created_at": "2015-04-04T08:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239371",
    "user": "rws"
}
```

Replying to [comment:9 kalvotom]:
> I have doctested the function with git version of Sympy and all tests passed (especially the one with integration). I guess we have to wait for a new version of Sympy to arrive in Sage (probably Sympy 0.7.7).
Yes, other tickets are waiting for that too.
> Anyway, this is my first attempt to contribute to Sage, so feel free to knitpick.
Will get to it.
> I have one question. How complicated it would be to force Sage to perform simplifications like 
> {{{
> sage: exp_polar(2 + 5*I)*exp_polar(5 - I)
> exp_polar(7 + 4*I)
> }}}
> My current understanding is that such simplifications are taken care of by an external library ( Pynac ) and there is no way how to do this in Sage alone, am I right?
I think so, but I'm not much into Pynac. Anyway, it could be part of Python Sage by including a function that does it in one of the `Expression.simplify*` methods.



---

archive/issue_comments_239372.json:
```json
{
    "body": "Thanks for your contribution. There were some minor problems requiring changes which I have added: removed the warning (because this ticket is pending Sympy-0.7.7 anyway), and adapted a bit to PEP 8. Documentation is fine, tests pass, so there is no reason to hold this back. If you agree with my changes you can set positive review.\n----\nNew commits:",
    "created_at": "2015-04-04T13:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239372",
    "user": "rws"
}
```

Thanks for your contribution. There were some minor problems requiring changes which I have added: removed the warning (because this ticket is pending Sympy-0.7.7 anyway), and adapted a bit to PEP 8. Documentation is fine, tests pass, so there is no reason to hold this back. If you agree with my changes you can set positive review.
----
New commits:



---

archive/issue_comments_239373.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-04T13:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239373",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_239374.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-04T19:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239374",
    "user": "kalvotom"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_239375.json:
```json
{
    "body": "Replying to [comment:12 rws]: Those changes are perfectly fine. Thanks.",
    "created_at": "2015-04-04T19:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239375",
    "user": "kalvotom"
}
```

Replying to [comment:12 rws]: Those changes are perfectly fine. Thanks.



---

archive/issue_comments_239376.json:
```json
{
    "body": "Why is this still sage-pending?",
    "created_at": "2016-01-02T19:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239376",
    "user": "vbraun"
}
```

Why is this still sage-pending?



---

archive/issue_comments_239377.json:
```json
{
    "body": "\"this ticket is pending Sympy-0.7.7\" (see In [comment:12 comment:12]) but\n\n```\nsage: import sympy\nsage: sympy.__version__\n'0.7.6.1'\n```\n",
    "created_at": "2016-01-02T19:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239377",
    "user": "vdelecroix"
}
```

"this ticket is pending Sympy-0.7.7" (see In [comment:12 comment:12]) but

```
sage: import sympy
sage: sympy.__version__
'0.7.6.1'
```




---

archive/issue_comments_239378.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-23T23:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17848#issuecomment-239378",
    "user": "vbraun"
}
```

Resolution: fixed
