# Issue 15814: fast_callable can return ipow with exponents in the base ring

archive/issues_015814.json:
```json
{
    "body": "Assignee: @bhutz\n\nfast_callable returns a string of operations. However, due to how caching\nof constants is done, the integer power function (ipow) can have constants\nin the base ring. This is because it checks the list of constants by comparing\nwith == without taking into consideration the parent/type.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16051\n\n",
    "closed_at": "2014-05-07T08:30:57Z",
    "created_at": "2014-04-03T11:45:12Z",
    "labels": [
        "component: misc",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "fast_callable can return ipow with exponents in the base ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15814",
    "user": "https://github.com/bhutz"
}
```
Assignee: @bhutz

fast_callable returns a string of operations. However, due to how caching
of constants is done, the integer power function (ipow) can have constants
in the base ring. This is because it checks the list of constants by comparing
with == without taking into consideration the parent/type.

Issue created by migration from https://trac.sagemath.org/ticket/16051





---

archive/issue_comments_204937.json:
```json
{
    "body": "Set assignee to @bhutz.",
    "created_at": "2014-04-03T11:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204937",
    "user": "https://github.com/bhutz"
}
```

Set assignee to @bhutz.



---

archive/issue_comments_204938.json:
```json
{
    "body": "Made the comparison to be by type and value instead of just value\n\n---\nNew commits:",
    "created_at": "2014-04-03T11:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204938",
    "user": "https://github.com/bhutz"
}
```

Made the comparison to be by type and value instead of just value

---
New commits:



---

archive/issue_comments_204939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-03T11:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204939",
    "user": "https://github.com/bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204940.json:
```json
{
    "body": "I think parent, when it is available, is a more reliable attribute to determine the mathematical identity of an element (and hence with what constants it can be folded). I think `sage.structure.parent` is the right routine to use, because it will fall back on `type` if `parent` is not available:\n\n```\nsage: parent(1)\nInteger Ring\nsage: parent(int(1))\n<type 'int'>\nsage: parent(ZZ)\n<type 'sage.rings.integer_ring.IntegerRing_class'>\n```\nOne example where going by `parent` is ostensibly better than going by `type` is:\n\n```\nsage: a=RealField(1000)(1)\nsage: b=RealField(200)(1)\nsage: a==b\nTrue\nsage: (type(a),a)==(type(b),b)\nTrue\nsage: (parent(a),a)==(parent(b),b)\nFalse\n```\nWe shouldn't be folding constants that have different precision.\n\nI don't have examples available, but it's certainly not ruled out that elements of different types could have the same parent (to allow for different representation methods in the same parent, for instance). I don't know if we should be folding constants in those cases.\n\nIn any of the cases where this matters other than to distinguish integer powers from from other constants one is really stretching the application domain of `fast_callable` anyway.",
    "created_at": "2014-04-03T15:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204940",
    "user": "https://github.com/nbruin"
}
```

I think parent, when it is available, is a more reliable attribute to determine the mathematical identity of an element (and hence with what constants it can be folded). I think `sage.structure.parent` is the right routine to use, because it will fall back on `type` if `parent` is not available:

```
sage: parent(1)
Integer Ring
sage: parent(int(1))
<type 'int'>
sage: parent(ZZ)
<type 'sage.rings.integer_ring.IntegerRing_class'>
```
One example where going by `parent` is ostensibly better than going by `type` is:

```
sage: a=RealField(1000)(1)
sage: b=RealField(200)(1)
sage: a==b
True
sage: (type(a),a)==(type(b),b)
True
sage: (parent(a),a)==(parent(b),b)
False
```
We shouldn't be folding constants that have different precision.

I don't have examples available, but it's certainly not ruled out that elements of different types could have the same parent (to allow for different representation methods in the same parent, for instance). I don't know if we should be folding constants in those cases.

In any of the cases where this matters other than to distinguish integer powers from from other constants one is really stretching the application domain of `fast_callable` anyway.



---

archive/issue_comments_204941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-03T16:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204942.json:
```json
{
    "body": "I wasn't aware of the instance of parent. That is definitely better, so I've changed it.\n\nThe instances I'm looking at is evaluating polynomials where the base ring can be something interesting like a powerseries ring, i.e. morphisms of projective space where base of projective space is something interesting. Mostly, when we implement fast evaluation for morphisms of projective space in #15920, we just don't want to break anything that currently works.",
    "created_at": "2014-04-03T16:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204942",
    "user": "https://github.com/bhutz"
}
```

I wasn't aware of the instance of parent. That is definitely better, so I've changed it.

The instances I'm looking at is evaluating polynomials where the base ring can be something interesting like a powerseries ring, i.e. morphisms of projective space where base of projective space is something interesting. Mostly, when we implement fast evaluation for morphisms of projective space in #15920, we just don't want to break anything that currently works.



---

archive/issue_comments_204943.json:
```json
{
    "body": "opps. I meant #15780.",
    "created_at": "2014-04-03T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204943",
    "user": "https://github.com/bhutz"
}
```

opps. I meant #15780.



---

archive/issue_comments_204944.json:
```json
{
    "body": "I have run the complete doctest against this ticket. \u00a0Everything is good.",
    "created_at": "2014-05-01T14:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204944",
    "user": "https://github.com/dillonmrose"
}
```

I have run the complete doctest against this ticket. Â Everything is good.



---

archive/issue_comments_204945.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-01T14:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204945",
    "user": "https://github.com/dillonmrose"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_047185.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15814#event-47185"
}
```



---

archive/issue_events_047186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-07T08:30:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15814#event-47186"
}
```



---

archive/issue_comments_204946.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-07T08:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15814#issuecomment-204946",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
