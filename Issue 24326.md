# Issue 24326: Workaround for small race condition in parallel doctest runner

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-01-19 09:15:17

CC:  jdemeyer

This is hard to reproduce reliably, but can happen if a worker process outlives its deadline and `w.kill()` is called, but the process has exited on its own by the time `killpg()` is called.

I've had this happen a few times on Cygwin where process shutdown tends to take a little longer.


---

Comment by embray created at 2018-01-19 09:15:26

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-01-19 21:25:50

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-01-19 21:25:50

Some of the calls to this `kill` method are wrapped already in a `try`/`except Exception` block. So it seems to be a feature that this would raise an exception if the worker is already dead. I would therefore prefer to just wrap the one remaining call to `kill` in a `try`/`except` block.


---

Comment by jdemeyer created at 2018-01-19 21:27:01

Maybe a better alternative solution: return a boolean from `kill()` to indicate whether or not `os.kill()` was successful in sending the signal.


---

Comment by embray created at 2018-01-22 13:32:21

Replying to [comment:3 jdemeyer]:
> Maybe a better alternative solution: return a boolean from `kill()` to indicate whether or not `os.kill()` was successful in sending the signal.

+1


---

Comment by embray created at 2018-01-22 13:34:19

~~Although maybe instead of "successful in sending the signal" it should be "successful in sending the signal or is already dead".  After all what I've written will allow other exceptions to be raised.~~

No, I changed my mind. I'll do it the way you suggested.


---

Comment by git created at 2018-01-22 13:58:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-01-22 13:59:37

New commits:


---

Comment by embray created at 2018-01-22 13:59:37

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-01-29 14:19:46

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-01-30 11:26:27

I like how nearly every patchbot is apparently broken...


---

Comment by vbraun created at 2018-02-01 19:13:26

Resolution: fixed
