# Issue 25591: Move OptionalExtension to features

archive/issues_025591.json:
```json
{
    "body": "CC:  jdemeyer arojas fbissey dimpase embray isuruf\n\nThe last remaining (after #25825) piece of code that uses `is_package_installed` is `OptionalExtension`. Since it only provides the `package` kwarg for convenience, I thought it would make sense to just move to `condition` and add feature checks to use in `module_list.py`.\n\nI tried that with one module for which a feature test is already available (bliss). The issue is that currently `Feature` depends on `cachefunc` and `UniqueRepresentation`, both of which are only available *after* the cythonizing step. That means we can't use them in `module_list.py`.\n\nI can think of two ways to solve this:\n\n- somehow make `Feature` work without those dependencies. They are not really essential at build-time: we can live without caching. However I'm not sure how to make those optional without losing caching at runtime. Maybe it is possible to add some kind of pure-python stub that is used while the cythonized version isn't available yet?\n\n- cythonize in two steps: first the core modules, then the optional ones\n\nI don't really know enough about the build system to decide which option is better and how best to implement them. Probably I missed some better option.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25828\n\n",
    "created_at": "2018-07-11T15:54:33Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Move OptionalExtension to features",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25591",
    "user": "@timokau"
}
```
CC:  jdemeyer arojas fbissey dimpase embray isuruf

The last remaining (after #25825) piece of code that uses `is_package_installed` is `OptionalExtension`. Since it only provides the `package` kwarg for convenience, I thought it would make sense to just move to `condition` and add feature checks to use in `module_list.py`.

I tried that with one module for which a feature test is already available (bliss). The issue is that currently `Feature` depends on `cachefunc` and `UniqueRepresentation`, both of which are only available *after* the cythonizing step. That means we can't use them in `module_list.py`.

I can think of two ways to solve this:

- somehow make `Feature` work without those dependencies. They are not really essential at build-time: we can live without caching. However I'm not sure how to make those optional without losing caching at runtime. Maybe it is possible to add some kind of pure-python stub that is used while the cythonized version isn't available yet?

- cythonize in two steps: first the core modules, then the optional ones

I don't really know enough about the build system to decide which option is better and how best to implement them. Probably I missed some better option.

Issue created by migration from https://trac.sagemath.org/ticket/25828





---

archive/issue_comments_360802.json:
```json
{
    "body": "Jeroen, according to `git log` you seem most experienced with what is going on in `setup.py` (second just to William Stein in number of commits). Do you have a opinion?",
    "created_at": "2018-07-11T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360802",
    "user": "@timokau"
}
```

Jeroen, according to `git log` you seem most experienced with what is going on in `setup.py` (second just to William Stein in number of commits). Do you have a opinion?



---

archive/issue_comments_360803.json:
```json
{
    "body": "I don't know. There is no obvious \"best\" solution.",
    "created_at": "2018-07-11T18:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360803",
    "user": "jdemeyer"
}
```

I don't know. There is no obvious "best" solution.



---

archive/issue_comments_360804.json:
```json
{
    "body": "I think #2 (two steps) would probably be the cleaner solution. Creating and then deleting a stub during installation would be pretty hacky.\n\nI tried implementing that but having basically no experience with distutils I'm confused. `ext_modules` is imported from `module_list` but then never used. Instead some magic `self.distribution.ext_modules` that appears out of nowhere is used.\n\nDo you think #1 is feasible?",
    "created_at": "2018-07-11T19:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360804",
    "user": "@timokau"
}
```

I think #2 (two steps) would probably be the cleaner solution. Creating and then deleting a stub during installation would be pretty hacky.

I tried implementing that but having basically no experience with distutils I'm confused. `ext_modules` is imported from `module_list` but then never used. Instead some magic `self.distribution.ext_modules` that appears out of nowhere is used.

Do you think #1 is feasible?



---

archive/issue_comments_360805.json:
```json
{
    "body": "Replying to [comment:4 gh-timokau]:\n> `ext_modules` is imported from `module_list` but then never used.\n\nPlease read the very last line of `src/setup.py`",
    "created_at": "2018-07-11T19:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360805",
    "user": "jdemeyer"
}
```

Replying to [comment:4 gh-timokau]:
> `ext_modules` is imported from `module_list` but then never used.

Please read the very last line of `src/setup.py`



---

archive/issue_comments_360806.json:
```json
{
    "body": "Oh right, thanks.\n\nSo `ext_modules` is a distutils concept and they expect one single list of modules? If that is the case some pretty ugly hacks would probably be needed to cythonize the extensions in two sets.",
    "created_at": "2018-07-11T20:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360806",
    "user": "@timokau"
}
```

Oh right, thanks.

So `ext_modules` is a distutils concept and they expect one single list of modules? If that is the case some pretty ugly hacks would probably be needed to cythonize the extensions in two sets.



---

archive/issue_comments_360807.json:
```json
{
    "body": "I'd suggest to use #28791 (Implement Feature without using sage.misc.cachefunc, sage.structure.unique_representation) - I have an implementation that does the caching by hand and implements a `TrivialUniqueRepresentation` in a few lines to remove the dependencies.",
    "created_at": "2019-11-23T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360807",
    "user": "mkoeppe"
}
```

I'd suggest to use #28791 (Implement Feature without using sage.misc.cachefunc, sage.structure.unique_representation) - I have an implementation that does the caching by hand and implements a `TrivialUniqueRepresentation` in a few lines to remove the dependencies.



---

archive/issue_comments_360808.json:
```json
{
    "body": "When implementing this ticket, one should watch out to preserve what was intended in #21288.",
    "created_at": "2019-11-23T19:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360808",
    "user": "mkoeppe"
}
```

When implementing this ticket, one should watch out to preserve what was intended in #21288.



---

archive/issue_comments_360809.json:
```json
{
    "body": "I don't currently have time to work on this, so if anyone wants to take over that would be great.",
    "created_at": "2019-11-24T19:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360809",
    "user": "@timokau"
}
```

I don't currently have time to work on this, so if anyone wants to take over that would be great.



---

archive/issue_comments_360810.json:
```json
{
    "body": "A move away to the current use of `is_package_installed` is welcome. My only issue with the current implementation example is that it is automagical. The extension is automatically built on detection. Packagers usually prefer enable and then check availability. The default position of sage has always been to build on presence but as a packager I want to be able to have some control mechanism where I can disable the feature even if the necessary bits are present.\n\nThis would be a major step in avoid sage's packaging system at build time. Testing time remains an issue as it calls `list_packages` but nothing short of an overall of the option system in doctest may be able to get rid of it.",
    "created_at": "2019-11-26T22:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360810",
    "user": "fbissey"
}
```

A move away to the current use of `is_package_installed` is welcome. My only issue with the current implementation example is that it is automagical. The extension is automatically built on detection. Packagers usually prefer enable and then check availability. The default position of sage has always been to build on presence but as a packager I want to be able to have some control mechanism where I can disable the feature even if the necessary bits are present.

This would be a major step in avoid sage's packaging system at build time. Testing time remains an issue as it calls `list_packages` but nothing short of an overall of the option system in doctest may be able to get rid of it.



---

archive/issue_comments_360811.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> My only issue with the current implementation example is that it is automagical. The extension is automatically built on detection. Packagers usually prefer enable and then check availability. The default position of sage has always been to build on presence but as a packager I want to be able to have some control mechanism where I can disable the feature even if the necessary bits are present.\n\nGreat point. We could add options to `setup.py build` such as `--require-feature=sage.features.bliss.BlissLibrary`. If this `setup.py build` is invoked with this option but the feature is not found, an error would be signaled.\n\n----\nNew commits:",
    "created_at": "2019-11-26T23:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360811",
    "user": "mkoeppe"
}
```

Replying to [comment:11 fbissey]:
> My only issue with the current implementation example is that it is automagical. The extension is automatically built on detection. Packagers usually prefer enable and then check availability. The default position of sage has always been to build on presence but as a packager I want to be able to have some control mechanism where I can disable the feature even if the necessary bits are present.

Great point. We could add options to `setup.py build` such as `--require-feature=sage.features.bliss.BlissLibrary`. If this `setup.py build` is invoked with this option but the feature is not found, an error would be signaled.

----
New commits:



---

archive/issue_comments_360812.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-27T00:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360812",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360813.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-27T01:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360813",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360814.json:
```json
{
    "body": "As a prototype it looks promising but the option is quite complicated. Even when adding proper documentation of the available features. We may want to have some kind of dictionary matching simple option names to features. But that has to come later when we add more stuff.",
    "created_at": "2019-11-27T01:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360814",
    "user": "fbissey"
}
```

As a prototype it looks promising but the option is quite complicated. Even when adding proper documentation of the available features. We may want to have some kind of dictionary matching simple option names to features. But that has to come later when we add more stuff.



---

archive/issue_comments_360815.json:
```json
{
    "body": "I would need help from a `distutils` expert on how to make the option --require-features also usable with `build`, rather than just `build_cython`.",
    "created_at": "2019-11-27T01:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360815",
    "user": "mkoeppe"
}
```

I would need help from a `distutils` expert on how to make the option --require-features also usable with `build`, rather than just `build_cython`.



---

archive/issue_comments_360816.json:
```json
{
    "body": "In the ticket description I have added an example `sage.features.databases.DatabaseCremona`, which is a `StaticFile` feature.\n\nSupporting `CythonFeature` (such as the previously mentioned `sage.features.bliss.BlissLibrary`) needs more work because it pulls in other modules that are not available at build time:\n\n```\nrunning build_cython\nEnabling Cython debugging support\n************************************************************************\nTraceback (most recent call last):\n  File \"setup.py\", line 887, in <module>\n    ext_modules = ext_modules)\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/core.py\", line 148, in setup\n    dist.run_commands()\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/dist.py\", line 966, in run_commands\n    self.run_command(cmd)\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/dist.py\", line 984, in run_command\n    cmd_obj.ensure_finalized()\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/cmd.py\", line 107, in ensure_finalized\n    self.finalize_options()\n  File \"setup.py\", line 296, in finalize_options\n    feature.require()\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py\", line 189, in require\n    presence = self.is_present()\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py\", line 161, in is_present\n    res = self._is_present()\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py\", line 551, in _is_present\n    with open(tmp_filename(ext=\".pyx\"), 'w') as pyx:\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/temporary_file.py\", line 149, in tmp_filename\n    from sage.misc.misc import SAGE_TMP\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/misc.py\", line 51, in <module>\n    import sage.misc.prandom as random\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/prandom.py\", line 58, in <module>\n    from sage.misc.randstate import current_randstate\nModuleNotFoundError: No module named 'sage.misc.randstate'\n```\n",
    "created_at": "2019-11-27T01:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360816",
    "user": "mkoeppe"
}
```

In the ticket description I have added an example `sage.features.databases.DatabaseCremona`, which is a `StaticFile` feature.

Supporting `CythonFeature` (such as the previously mentioned `sage.features.bliss.BlissLibrary`) needs more work because it pulls in other modules that are not available at build time:

```
running build_cython
Enabling Cython debugging support
************************************************************************
Traceback (most recent call last):
  File "setup.py", line 887, in <module>
    ext_modules = ext_modules)
  File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/core.py", line 148, in setup
    dist.run_commands()
  File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/dist.py", line 966, in run_commands
    self.run_command(cmd)
  File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/dist.py", line 984, in run_command
    cmd_obj.ensure_finalized()
  File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.7/distutils/cmd.py", line 107, in ensure_finalized
    self.finalize_options()
  File "setup.py", line 296, in finalize_options
    feature.require()
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py", line 189, in require
    presence = self.is_present()
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py", line 161, in is_present
    res = self._is_present()
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/features/__init__.py", line 551, in _is_present
    with open(tmp_filename(ext=".pyx"), 'w') as pyx:
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/temporary_file.py", line 149, in tmp_filename
    from sage.misc.misc import SAGE_TMP
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/misc.py", line 51, in <module>
    import sage.misc.prandom as random
  File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/prandom.py", line 58, in <module>
    from sage.misc.randstate import current_randstate
ModuleNotFoundError: No module named 'sage.misc.randstate'
```




---

archive/issue_comments_360817.json:
```json
{
    "body": "Replying to [comment:16 fbissey]:\n> As a prototype it looks promising but the option is quite complicated. Even when adding proper documentation of the available features. We may want to have some kind of dictionary matching simple option names to features. But that has to come later when we add more stuff.\nYes, I agree, of course we can make it more user-friendly later.",
    "created_at": "2019-11-27T01:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360817",
    "user": "mkoeppe"
}
```

Replying to [comment:16 fbissey]:
> As a prototype it looks promising but the option is quite complicated. Even when adding proper documentation of the available features. We may want to have some kind of dictionary matching simple option names to features. But that has to come later when we add more stuff.
Yes, I agree, of course we can make it more user-friendly later.



---

archive/issue_comments_360818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-11-28T19:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_360819.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-28T19:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360819",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_360820.json:
```json
{
    "body": "Replying to [comment:19 mkoeppe]:\n> Supporting `CythonFeature` (such as the previously mentioned `sage.features.bliss.BlissLibrary`) needs more work because it pulls in other modules that are not available at build time\nDone",
    "created_at": "2019-11-28T19:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360820",
    "user": "mkoeppe"
}
```

Replying to [comment:19 mkoeppe]:
> Supporting `CythonFeature` (such as the previously mentioned `sage.features.bliss.BlissLibrary`) needs more work because it pulls in other modules that are not available at build time
Done



---

archive/issue_comments_360821.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-25T16:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360821",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-01-13T02:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360822",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_360823.json:
```json
{
    "body": "Rebased on top of current beta.",
    "created_at": "2020-01-13T02:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360823",
    "user": "mkoeppe"
}
```

Rebased on top of current beta.



---

archive/issue_comments_360824.json:
```json
{
    "body": "I get an error while trying to build this branch, from scratch.\nSomething to do with `sage.misc.randstate` not ready at the moment `BlissLibrary().is_present()` is called:\n\n```\n...\ncp /home/scratch2/dimpase/sage/sage/src/ext/gap/sage.g /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/sage.g\ncp /home/scratch2/dimpase/sage/sage/src/ext/gap/joyner/hurwitz_crv_rr_sp.gap /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/joyner/hurwitz_crv_rr_sp.gap\ncp /home/scratch2/dimpase/sage/sage/src/ext/gap/joyner/modular_crv_rr_sp.gap /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/joyner/modular_crv_rr_sp.gap\nif [ -z \"$SAGE_INSTALL_FETCH_ONLY\" ]; then \\\n        cd /home/scratch2/dimpase/sage/sage/src && source bin/sage-env && \\\n        sage-logger -p 'time make sage' '/home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log'; \\\nfi\n[sagelib-9.1.beta0] make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/src'\n[sagelib-9.1.beta0] cd . && export                                    \\\n[sagelib-9.1.beta0]     SAGE_ROOT=/doesnotexist                               \\\n[sagelib-9.1.beta0]     SAGE_SRC=/doesnotexist                                \\\n[sagelib-9.1.beta0]     SAGE_SRC_ROOT=/doesnotexist                           \\\n[sagelib-9.1.beta0]     SAGE_DOC_SRC=/doesnotexist                            \\\n[sagelib-9.1.beta0]     SAGE_BUILD_DIR=/doesnotexist                          \\\n[sagelib-9.1.beta0]     SAGE_PKGS=/home/scratch2/dimpase/sage/sage/build/pkgs                \\\n[sagelib-9.1.beta0] && sage-python -u setup.py --no-user-cfg build install\n[sagelib-9.1.beta0] /home/scratch2/dimpase/sage/sage/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory\n[sagelib-9.1.beta0] Warning: overwriting SAGE_ROOT environment variable:\n[sagelib-9.1.beta0] Old SAGE_ROOT=/doesnotexist\n[sagelib-9.1.beta0] New SAGE_ROOT=\n[sagelib-9.1.beta0] ************************************************************************\n[sagelib-9.1.beta0] Traceback (most recent call last):\n[sagelib-9.1.beta0]   File \"setup.py\", line 72, in <module>\n[sagelib-9.1.beta0]     from module_list import ext_modules, library_order\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/module_list.py\", line 406, in <module>\n[sagelib-9.1.beta0]     condition = BlissLibrary().is_present()),\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/features/__init__.py\", line 161, in is_present\n[sagelib-9.1.beta0]     res = self._is_present()\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/features/__init__.py\", line 551, in _is_present\n[sagelib-9.1.beta0]     with open(tmp_filename(ext=\".pyx\"), 'w') as pyx:\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/misc/temporary_file.py\", line 149, in tmp_filename\n[sagelib-9.1.beta0]     from sage.misc.misc import SAGE_TMP\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/misc/misc.py\", line 51, in <module>\n[sagelib-9.1.beta0]     import sage.misc.prandom as random\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/misc/prandom.py\", line 58, in <module>\n[sagelib-9.1.beta0]     from sage.misc.randstate import current_randstate\n[sagelib-9.1.beta0] ModuleNotFoundError: No module named 'sage.misc.randstate'\n[sagelib-9.1.beta0] ************************************************************************\n[sagelib-9.1.beta0] Error building the Sage library\n[sagelib-9.1.beta0] ************************************************************************\n[sagelib-9.1.beta0] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[sagelib-9.1.beta0] explaining the problem and including the relevant part of the log file\n[sagelib-9.1.beta0]   /home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log\n[sagelib-9.1.beta0] Describe your computer, operating system, etc.\n[sagelib-9.1.beta0] ************************************************************************\n[sagelib-9.1.beta0] Error in atexit._run_exitfuncs:\n[sagelib-9.1.beta0] Traceback (most recent call last):\n[sagelib-9.1.beta0]   File \"<frozen importlib._bootstrap>\", line 983, in _find_and_load\n[sagelib-9.1.beta0]   File \"<frozen importlib._bootstrap>\", line 967, in _find_and_load_unlocked\n[sagelib-9.1.beta0]   File \"<frozen importlib._bootstrap>\", line 677, in _load_unlocked\n[sagelib-9.1.beta0]   File \"<frozen importlib._bootstrap_external>\", line 728, in exec_module\n[sagelib-9.1.beta0]   File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/misc/misc.py\", line 51, in <module>\n[sagelib-9.1.beta0]     import sage.misc.prandom as random\n[sagelib-9.1.beta0]   File \"/home/scratch2/dimpase/sage/sage/src/sage/misc/prandom.py\", line 58, in <module>\n[sagelib-9.1.beta0]     from sage.misc.randstate import current_randstate\n[sagelib-9.1.beta0] ModuleNotFoundError: No module named 'sage.misc.randstate'\n[sagelib-9.1.beta0] make[4]: *** [Makefile:33: sage] Error 1\n[sagelib-9.1.beta0] make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/src'\n[sagelib-9.1.beta0]\n[sagelib-9.1.beta0] real        0m0.369s\n[sagelib-9.1.beta0] user        0m0.313s\n[sagelib-9.1.beta0] sys 0m0.056s\nmake[3]: *** [Makefile:1981: sagelib] Error 2\nmake[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\nmake[2]: *** [Makefile:1842: all-start] Error 2\nmake[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\n```\n",
    "created_at": "2020-01-13T13:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360824",
    "user": "dimpase"
}
```

I get an error while trying to build this branch, from scratch.
Something to do with `sage.misc.randstate` not ready at the moment `BlissLibrary().is_present()` is called:

```
...
cp /home/scratch2/dimpase/sage/sage/src/ext/gap/sage.g /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/sage.g
cp /home/scratch2/dimpase/sage/sage/src/ext/gap/joyner/hurwitz_crv_rr_sp.gap /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/joyner/hurwitz_crv_rr_sp.gap
cp /home/scratch2/dimpase/sage/sage/src/ext/gap/joyner/modular_crv_rr_sp.gap /home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/joyner/modular_crv_rr_sp.gap
if [ -z "$SAGE_INSTALL_FETCH_ONLY" ]; then \
        cd /home/scratch2/dimpase/sage/sage/src && source bin/sage-env && \
        sage-logger -p 'time make sage' '/home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log'; \
fi
[sagelib-9.1.beta0] make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/src'
[sagelib-9.1.beta0] cd . && export                                    \
[sagelib-9.1.beta0]     SAGE_ROOT=/doesnotexist                               \
[sagelib-9.1.beta0]     SAGE_SRC=/doesnotexist                                \
[sagelib-9.1.beta0]     SAGE_SRC_ROOT=/doesnotexist                           \
[sagelib-9.1.beta0]     SAGE_DOC_SRC=/doesnotexist                            \
[sagelib-9.1.beta0]     SAGE_BUILD_DIR=/doesnotexist                          \
[sagelib-9.1.beta0]     SAGE_PKGS=/home/scratch2/dimpase/sage/sage/build/pkgs                \
[sagelib-9.1.beta0] && sage-python -u setup.py --no-user-cfg build install
[sagelib-9.1.beta0] /home/scratch2/dimpase/sage/sage/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory
[sagelib-9.1.beta0] Warning: overwriting SAGE_ROOT environment variable:
[sagelib-9.1.beta0] Old SAGE_ROOT=/doesnotexist
[sagelib-9.1.beta0] New SAGE_ROOT=
[sagelib-9.1.beta0] ************************************************************************
[sagelib-9.1.beta0] Traceback (most recent call last):
[sagelib-9.1.beta0]   File "setup.py", line 72, in <module>
[sagelib-9.1.beta0]     from module_list import ext_modules, library_order
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/module_list.py", line 406, in <module>
[sagelib-9.1.beta0]     condition = BlissLibrary().is_present()),
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/features/__init__.py", line 161, in is_present
[sagelib-9.1.beta0]     res = self._is_present()
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/features/__init__.py", line 551, in _is_present
[sagelib-9.1.beta0]     with open(tmp_filename(ext=".pyx"), 'w') as pyx:
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/misc/temporary_file.py", line 149, in tmp_filename
[sagelib-9.1.beta0]     from sage.misc.misc import SAGE_TMP
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/misc/misc.py", line 51, in <module>
[sagelib-9.1.beta0]     import sage.misc.prandom as random
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/misc/prandom.py", line 58, in <module>
[sagelib-9.1.beta0]     from sage.misc.randstate import current_randstate
[sagelib-9.1.beta0] ModuleNotFoundError: No module named 'sage.misc.randstate'
[sagelib-9.1.beta0] ************************************************************************
[sagelib-9.1.beta0] Error building the Sage library
[sagelib-9.1.beta0] ************************************************************************
[sagelib-9.1.beta0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[sagelib-9.1.beta0] explaining the problem and including the relevant part of the log file
[sagelib-9.1.beta0]   /home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log
[sagelib-9.1.beta0] Describe your computer, operating system, etc.
[sagelib-9.1.beta0] ************************************************************************
[sagelib-9.1.beta0] Error in atexit._run_exitfuncs:
[sagelib-9.1.beta0] Traceback (most recent call last):
[sagelib-9.1.beta0]   File "<frozen importlib._bootstrap>", line 983, in _find_and_load
[sagelib-9.1.beta0]   File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
[sagelib-9.1.beta0]   File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
[sagelib-9.1.beta0]   File "<frozen importlib._bootstrap_external>", line 728, in exec_module
[sagelib-9.1.beta0]   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/misc/misc.py", line 51, in <module>
[sagelib-9.1.beta0]     import sage.misc.prandom as random
[sagelib-9.1.beta0]   File "/home/scratch2/dimpase/sage/sage/src/sage/misc/prandom.py", line 58, in <module>
[sagelib-9.1.beta0]     from sage.misc.randstate import current_randstate
[sagelib-9.1.beta0] ModuleNotFoundError: No module named 'sage.misc.randstate'
[sagelib-9.1.beta0] make[4]: *** [Makefile:33: sage] Error 1
[sagelib-9.1.beta0] make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/src'
[sagelib-9.1.beta0]
[sagelib-9.1.beta0] real        0m0.369s
[sagelib-9.1.beta0] user        0m0.313s
[sagelib-9.1.beta0] sys 0m0.056s
make[3]: *** [Makefile:1981: sagelib] Error 2
make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'
make[2]: *** [Makefile:1842: all-start] Error 2
make[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'
```




---

archive/issue_comments_360825.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-13T13:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360825",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_360826.json:
```json
{
    "body": "Sorry, looks like I lost a number of commits in the rebase.",
    "created_at": "2020-01-13T14:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360826",
    "user": "mkoeppe"
}
```

Sorry, looks like I lost a number of commits in the rebase.



---

archive/issue_comments_360827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-01-13T15:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360827",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_360828.json:
```json
{
    "body": "is it ready now?",
    "created_at": "2020-01-14T09:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360828",
    "user": "dimpase"
}
```

is it ready now?



---

archive/issue_comments_360829.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-14T14:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360829",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_360830.json:
```json
{
    "body": "something does not work with the build (docs get built, but then sage won't start)\nThis is running `make ptest` (without bliss installed, I think)\n\n```\n...\n[dochtml] [thematic_] ... done (4882 js index entries)\n[dochtml] [thematic_] The HTML pages are in local/share/doc/sage/html/en/thematic_tutorials.\n[dochtml] Build finished. The built documents can be found in /home/scratch2/dimpase/sage/sage/local/share/doc/sage/html/en/thematic_tutorials\n[dochtml] Elapsed time: 486.8 seconds.\n[dochtml] Done building the documentation!\nmake[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\nmake -j12 '/home/scratch2/dimpase/sage/sage/local/etc/sage-started.txt'\nmake[3]: Entering directory '/home/scratch2/dimpase/sage/sage/build/make'\nmake[3]: warning: -jN forced in submake: disabling jobserver mode.\nif [ -z \"$SAGE_INSTALL_FETCH_ONLY\" ]; then \\\n        cd /home/scratch2/dimpase/sage/sage/src && source bin/sage-env && \\\n        sage-logger -p 'time make -j12 sage' '/home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log'; \\\nfi\n[sagelib-9.1.beta0] make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/src'\n[sagelib-9.1.beta0] make[4]: warning: -jN forced in submake: disabling jobserver mode.\n[sagelib-9.1.beta0] cd . && export                                    \\\n[sagelib-9.1.beta0]     SAGE_ROOT=/doesnotexist                               \\\n[sagelib-9.1.beta0]     SAGE_SRC=/doesnotexist                                \\\n[sagelib-9.1.beta0]     SAGE_SRC_ROOT=/doesnotexist                           \\\n[sagelib-9.1.beta0]     SAGE_DOC_SRC=/doesnotexist                            \\\n[sagelib-9.1.beta0]     SAGE_BUILD_DIR=/doesnotexist                          \\\n[sagelib-9.1.beta0]     SAGE_PKGS=/home/scratch2/dimpase/sage/sage/build/pkgs                \\\n[sagelib-9.1.beta0] && sage-python -u setup.py --no-user-cfg build install\n[sagelib-9.1.beta0] /home/scratch2/dimpase/sage/sage/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory\n[sagelib-9.1.beta0] Warning: overwriting SAGE_ROOT environment variable:\n[sagelib-9.1.beta0] Old SAGE_ROOT=/doesnotexist\n[sagelib-9.1.beta0] New SAGE_ROOT=\n[sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory\n[sagelib-9.1.beta0]  #include \"bliss/graph.hh\"\n[sagelib-9.1.beta0]           ^~~~~~~~~~~~~~~~\n[sagelib-9.1.beta0] compilation terminated.\n[sagelib-9.1.beta0] Discovering Python/Cython source code....\n[sagelib-9.1.beta0] Discovered Python/Cython sources, time: 0.01 seconds.\n[sagelib-9.1.beta0] running build\n[sagelib-9.1.beta0] Generating auto-generated sources\n[sagelib-9.1.beta0] Building interpreters for fast_callable\n[sagelib-9.1.beta0] running build_cython\n[sagelib-9.1.beta0] Enabling Cython debugging support\n[sagelib-9.1.beta0] Updating Cython code....\n[sagelib-9.1.beta0] Finished Cythonizing, time: 1.49 seconds.\n[sagelib-9.1.beta0] running build_py\n[sagelib-9.1.beta0] running build_ext\n[sagelib-9.1.beta0] Executing 0 commands (using 1 thread)\n[sagelib-9.1.beta0] Time to execute 0 commands: 0.11 seconds.\n[sagelib-9.1.beta0] Total time spent compiling C/C++ extensions: 0.14 seconds.\n[sagelib-9.1.beta0] running install\n[sagelib-9.1.beta0] running install_lib\n[sagelib-9.1.beta0] running install_egg_info\n[sagelib-9.1.beta0] Removing /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage-9.1.beta0-py3.7.egg-info\n[sagelib-9.1.beta0] Writing /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage-9.1.beta0-py3.7.egg-info\n[sagelib-9.1.beta0] Cleaning up stale installed files....\n[sagelib-9.1.beta0] - cleaning build/lib.linux-x86_64-3.7\n[sagelib-9.1.beta0] - cleaning /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages\n[sagelib-9.1.beta0] Finished cleaning, time: 0.15 seconds.\n[sagelib-9.1.beta0] if [ \"$UNAME\" = \"CYGWIN\" ]; then                         \\\n[sagelib-9.1.beta0]     sage-rebase.sh \"$SAGE_LOCAL\" 2>/dev/null;            \\\n[sagelib-9.1.beta0] fi\n[sagelib-9.1.beta0] make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/src'\n[sagelib-9.1.beta0]\n[sagelib-9.1.beta0] real        0m3.029s\n[sagelib-9.1.beta0] user        0m2.510s\n[sagelib-9.1.beta0] sys 0m0.419s\n\"/home/scratch2/dimpase/sage/sage/local/bin/sage-starts\"\n\nTesting that Sage starts...\n[2020-01-14 15:30:54] SageMath version 9.1.beta0, Release Date: 2020-01-10\nYes, Sage starts.\nmake[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\nmake[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\n\nreal    46m41.281s\nuser    276m31.335s\nsys     13m36.772s\nSage build/upgrade complete!\nmake[1]: Leaving directory '/home/scratch2/dimpase/sage/sage'\n./sage -t -p --all --logfile=logs/ptest.log\nTraceback (most recent call last):\n  File \"/home/scratch2/dimpase/sage/sage/src/bin/sage-runtests\", line 177, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/control.py\", line 33, in <module>\n    from .sources import FileDocTestSource, DictAsObject\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/sources.py\", line 33, in <module>\n    from .parsing import SageDocTestParser\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/parsing.py\", line 66, in <module>\n    from sage.all import RealIntervalField\nImportError: cannot import name 'RealIntervalField' from 'sage.all' (unknown location)\nmake: *** [Makefile:172: ptest] Error 1\n```\n\nI guess \n\n```\n[sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory\n```\n\npoints somewhere...",
    "created_at": "2020-01-14T17:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360830",
    "user": "dimpase"
}
```

something does not work with the build (docs get built, but then sage won't start)
This is running `make ptest` (without bliss installed, I think)

```
...
[dochtml] [thematic_] ... done (4882 js index entries)
[dochtml] [thematic_] The HTML pages are in local/share/doc/sage/html/en/thematic_tutorials.
[dochtml] Build finished. The built documents can be found in /home/scratch2/dimpase/sage/sage/local/share/doc/sage/html/en/thematic_tutorials
[dochtml] Elapsed time: 486.8 seconds.
[dochtml] Done building the documentation!
make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'
make -j12 '/home/scratch2/dimpase/sage/sage/local/etc/sage-started.txt'
make[3]: Entering directory '/home/scratch2/dimpase/sage/sage/build/make'
make[3]: warning: -jN forced in submake: disabling jobserver mode.
if [ -z "$SAGE_INSTALL_FETCH_ONLY" ]; then \
        cd /home/scratch2/dimpase/sage/sage/src && source bin/sage-env && \
        sage-logger -p 'time make -j12 sage' '/home/scratch2/dimpase/sage/sage/logs/pkgs/sagelib-9.1.beta0.log'; \
fi
[sagelib-9.1.beta0] make[4]: Entering directory '/home/scratch2/dimpase/sage/sage/src'
[sagelib-9.1.beta0] make[4]: warning: -jN forced in submake: disabling jobserver mode.
[sagelib-9.1.beta0] cd . && export                                    \
[sagelib-9.1.beta0]     SAGE_ROOT=/doesnotexist                               \
[sagelib-9.1.beta0]     SAGE_SRC=/doesnotexist                                \
[sagelib-9.1.beta0]     SAGE_SRC_ROOT=/doesnotexist                           \
[sagelib-9.1.beta0]     SAGE_DOC_SRC=/doesnotexist                            \
[sagelib-9.1.beta0]     SAGE_BUILD_DIR=/doesnotexist                          \
[sagelib-9.1.beta0]     SAGE_PKGS=/home/scratch2/dimpase/sage/sage/build/pkgs                \
[sagelib-9.1.beta0] && sage-python -u setup.py --no-user-cfg build install
[sagelib-9.1.beta0] /home/scratch2/dimpase/sage/sage/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory
[sagelib-9.1.beta0] Warning: overwriting SAGE_ROOT environment variable:
[sagelib-9.1.beta0] Old SAGE_ROOT=/doesnotexist
[sagelib-9.1.beta0] New SAGE_ROOT=
[sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory
[sagelib-9.1.beta0]  #include "bliss/graph.hh"
[sagelib-9.1.beta0]           ^~~~~~~~~~~~~~~~
[sagelib-9.1.beta0] compilation terminated.
[sagelib-9.1.beta0] Discovering Python/Cython source code....
[sagelib-9.1.beta0] Discovered Python/Cython sources, time: 0.01 seconds.
[sagelib-9.1.beta0] running build
[sagelib-9.1.beta0] Generating auto-generated sources
[sagelib-9.1.beta0] Building interpreters for fast_callable
[sagelib-9.1.beta0] running build_cython
[sagelib-9.1.beta0] Enabling Cython debugging support
[sagelib-9.1.beta0] Updating Cython code....
[sagelib-9.1.beta0] Finished Cythonizing, time: 1.49 seconds.
[sagelib-9.1.beta0] running build_py
[sagelib-9.1.beta0] running build_ext
[sagelib-9.1.beta0] Executing 0 commands (using 1 thread)
[sagelib-9.1.beta0] Time to execute 0 commands: 0.11 seconds.
[sagelib-9.1.beta0] Total time spent compiling C/C++ extensions: 0.14 seconds.
[sagelib-9.1.beta0] running install
[sagelib-9.1.beta0] running install_lib
[sagelib-9.1.beta0] running install_egg_info
[sagelib-9.1.beta0] Removing /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage-9.1.beta0-py3.7.egg-info
[sagelib-9.1.beta0] Writing /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage-9.1.beta0-py3.7.egg-info
[sagelib-9.1.beta0] Cleaning up stale installed files....
[sagelib-9.1.beta0] - cleaning build/lib.linux-x86_64-3.7
[sagelib-9.1.beta0] - cleaning /home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages
[sagelib-9.1.beta0] Finished cleaning, time: 0.15 seconds.
[sagelib-9.1.beta0] if [ "$UNAME" = "CYGWIN" ]; then                         \
[sagelib-9.1.beta0]     sage-rebase.sh "$SAGE_LOCAL" 2>/dev/null;            \
[sagelib-9.1.beta0] fi
[sagelib-9.1.beta0] make[4]: Leaving directory '/home/scratch2/dimpase/sage/sage/src'
[sagelib-9.1.beta0]
[sagelib-9.1.beta0] real        0m3.029s
[sagelib-9.1.beta0] user        0m2.510s
[sagelib-9.1.beta0] sys 0m0.419s
"/home/scratch2/dimpase/sage/sage/local/bin/sage-starts"

Testing that Sage starts...
[2020-01-14 15:30:54] SageMath version 9.1.beta0, Release Date: 2020-01-10
Yes, Sage starts.
make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'
make[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'

real    46m41.281s
user    276m31.335s
sys     13m36.772s
Sage build/upgrade complete!
make[1]: Leaving directory '/home/scratch2/dimpase/sage/sage'
./sage -t -p --all --logfile=logs/ptest.log
Traceback (most recent call last):
  File "/home/scratch2/dimpase/sage/sage/src/bin/sage-runtests", line 177, in <module>
    from sage.doctest.control import DocTestController
  File "/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/control.py", line 33, in <module>
    from .sources import FileDocTestSource, DictAsObject
  File "/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/sources.py", line 33, in <module>
    from .parsing import SageDocTestParser
  File "/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/sage/doctest/parsing.py", line 66, in <module>
    from sage.all import RealIntervalField
ImportError: cannot import name 'RealIntervalField' from 'sage.all' (unknown location)
make: *** [Makefile:172: ptest] Error 1
```

I guess 

```
[sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory
```

points somewhere...



---

archive/issue_comments_360831.json:
```json
{
    "body": "Thanks for testing! I'll investigate",
    "created_at": "2020-01-14T20:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360831",
    "user": "mkoeppe"
}
```

Thanks for testing! I'll investigate



---

archive/issue_comments_360832.json:
```json
{
    "body": "Replying to [comment:39 dimpase]:\n> something does not work with the build \n> {{{\n> ImportError: cannot import name 'RealIntervalField' from 'sage.all' (unknown location)\n> make: *** [Makefile:172: ptest] Error 1\n> }}}\n\nYes, I also end up with a broken build. I'll look into it more.\n\n> I guess \n> {{{\n> [sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory\n> }}}\n> points somewhere...\n\nNo, that is just the output of the feature test. I will try to make it look less scary.\n\n\n```\n$ ./sage -c 'from sage.features.bliss import BlissLibrary; print(BlissLibrary().is_present())'\n/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmp_sage_cython_featurempyw50ji/target/featuretest.cpp:653:10: fatal error: 'bliss/graph.hh' file not found\n#include \"bliss/graph.hh\"\n         ^~~~~~~~~~~~~~~~\n1 error generated.\nFeatureTestResult('Bliss', False)\n```\n",
    "created_at": "2020-01-16T03:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360832",
    "user": "mkoeppe"
}
```

Replying to [comment:39 dimpase]:
> something does not work with the build 
> {{{
> ImportError: cannot import name 'RealIntervalField' from 'sage.all' (unknown location)
> make: *** [Makefile:172: ptest] Error 1
> }}}

Yes, I also end up with a broken build. I'll look into it more.

> I guess 
> {{{
> [sagelib-9.1.beta0] /tmp/tmp_sage_cython_featuref0w8sij7/target/featuretest.cpp:652:10: fatal error: bliss/graph.hh: No such file or directory
> }}}
> points somewhere...

No, that is just the output of the feature test. I will try to make it look less scary.


```
$ ./sage -c 'from sage.features.bliss import BlissLibrary; print(BlissLibrary().is_present())'
/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmp_sage_cython_featurempyw50ji/target/featuretest.cpp:653:10: fatal error: 'bliss/graph.hh' file not found
#include "bliss/graph.hh"
         ^~~~~~~~~~~~~~~~
1 error generated.
FeatureTestResult('Bliss', False)
```




---

archive/issue_comments_360833.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-19T19:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360833",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_360834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T01:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360834",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360835.json:
```json
{
    "body": "`OptionalExtension` is no longer used. Let's close this ticket.",
    "created_at": "2020-10-30T23:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360835",
    "user": "mkoeppe"
}
```

`OptionalExtension` is no longer used. Let's close this ticket.



---

archive/issue_comments_360836.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-30T23:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360836",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_360837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-31T20:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360837",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_360838.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-11-08T18:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25591",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25591#issuecomment-360838",
    "user": "chapoton"
}
```

Resolution: invalid
