# Issue 23861: _S_hilbert_symbol() helper function to find integer with negative Hilbert symbol for primes in at set S

archive/issues_023861.json:
```json
{
    "body": "CC:  mroy sbrudzin jduque\n\nKeywords: #sd90\n\nThis is an implementation of algorithm 3.4.1 from Markus Kirschmer's \"Definite quadratic and hermitian forms with small class number.\"  Given a non-square b and a set of primes S, the function returns a number a which has negative Hilbert symbol with respect to b at precisely the primes in S.  \n\nThis is a helper functioning service to algorithm 3.4.3, quadratic_form_form_local_invariants(), ticket TK.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24098\n\n",
    "created_at": "2017-10-24T16:07:28Z",
    "labels": [
        "component: quadratic forms",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "_S_hilbert_symbol() helper function to find integer with negative Hilbert symbol for primes in at set S",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23861",
    "user": "https://github.com/annahaensch"
}
```
CC:  mroy sbrudzin jduque

Keywords: #sd90

This is an implementation of algorithm 3.4.1 from Markus Kirschmer's "Definite quadratic and hermitian forms with small class number."  Given a non-square b and a set of primes S, the function returns a number a which has negative Hilbert symbol with respect to b at precisely the primes in S.  

This is a helper functioning service to algorithm 3.4.3, quadratic_form_form_local_invariants(), ticket TK.

Issue created by migration from https://trac.sagemath.org/ticket/24098





---

archive/issue_comments_334074.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-25T00:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334074",
    "user": "https://github.com/annahaensch"
}
```

New commits:



---

archive/issue_comments_334075.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-25T00:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334075",
    "user": "https://github.com/annahaensch"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334076.json:
```json
{
    "body": "Changing component from quadratic forms to basic arithmetic.",
    "created_at": "2017-10-25T21:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334076",
    "user": "https://github.com/annahaensch"
}
```

Changing component from quadratic forms to basic arithmetic.



---

archive/issue_comments_334077.json:
```json
{
    "body": "Changing keywords from \"#sd90\" to \"sd90\".",
    "created_at": "2017-10-25T21:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334077",
    "user": "https://github.com/annahaensch"
}
```

Changing keywords from "#sd90" to "sd90".



---

archive/issue_comments_334078.json:
```json
{
    "body": "So here are some thoughts:\n\nThis is just a helper function so it should not pollute the global namespace.\nIs there a reason that you have implemented Markus algorithm just for `QQ`?\nThe beauty of Markus' work is that he did it directly for number fields.\nIt should not be too hard to do it for number fields.\nAll the necessary functions like class groups, ideals, hilbert symbols, places, are there:\n\n```\nsage: K.<a>=CyclotomicField(13)\nsage: P=K.primes_above(3)[0]\nsage: P\nFractional ideal (3, a^3 - a - 1)\nsage: K.hilbert_symbol(3,1+a,P)\n1\n```\n\nWe can define the function as a method of the number field. Just like the hilbert_symbol.\nMaybe the name S_hilbert_symbol is misleading? I would expect it to be the global hilbert_symbol of the localization at S or something like that. This function seems more like an inverse image?\nmaybe hilbert_symbol_inv_S?\n\nSome remarks for formatting:\nComments should be of the form (note the space)\n\n```\n# foo does bla\nfoo = 3 \n```\n\nSee https://www.python.org/dev/peps/pep-0008/#comments.\n\nYou are redefining V,W,vv in the while loop.\nBut really they stay constant. So they should not sit in the loop.\n\nUse the names of Markus if possible or more descriptive names.\nHH,PP etc. is not very descriptive. Same for i,j.\nI do not see the need to define H. Why hide everything in lists?\n\nEither use the verbose things or remove them.",
    "created_at": "2017-11-24T09:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334078",
    "user": "https://github.com/simonbrandhorst"
}
```

So here are some thoughts:

This is just a helper function so it should not pollute the global namespace.
Is there a reason that you have implemented Markus algorithm just for `QQ`?
The beauty of Markus' work is that he did it directly for number fields.
It should not be too hard to do it for number fields.
All the necessary functions like class groups, ideals, hilbert symbols, places, are there:

```
sage: K.<a>=CyclotomicField(13)
sage: P=K.primes_above(3)[0]
sage: P
Fractional ideal (3, a^3 - a - 1)
sage: K.hilbert_symbol(3,1+a,P)
1
```

We can define the function as a method of the number field. Just like the hilbert_symbol.
Maybe the name S_hilbert_symbol is misleading? I would expect it to be the global hilbert_symbol of the localization at S or something like that. This function seems more like an inverse image?
maybe hilbert_symbol_inv_S?

Some remarks for formatting:
Comments should be of the form (note the space)

```
# foo does bla
foo = 3 
```

See https://www.python.org/dev/peps/pep-0008/#comments.

You are redefining V,W,vv in the while loop.
But really they stay constant. So they should not sit in the loop.

Use the names of Markus if possible or more descriptive names.
HH,PP etc. is not very descriptive. Same for i,j.
I do not see the need to define H. Why hide everything in lists?

Either use the verbose things or remove them.



---

archive/issue_comments_334079.json:
```json
{
    "body": "It is good to test the error messages. But they belong to the\nTESTS:: block not the EXAMPLES:: block.\n-> they do not need to show up in the documentation.",
    "created_at": "2017-11-24T17:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334079",
    "user": "https://github.com/simonbrandhorst"
}
```

It is good to test the error messages. But they belong to the
TESTS:: block not the EXAMPLES:: block.
-> they do not need to show up in the documentation.



---

archive/issue_comments_334080.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-29T08:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334080",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_334081.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-01T21:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334081",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_334082.json:
```json
{
    "body": "How about `hilbert_conductor_inverse` as a name?\nProblem is this exists and is (allmost) the same function.\nIdeas? I would like to move it as a method of `QQ`.",
    "created_at": "2018-05-01T21:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334082",
    "user": "https://github.com/simonbrandhorst"
}
```

How about `hilbert_conductor_inverse` as a name?
Problem is this exists and is (allmost) the same function.
Ideas? I would like to move it as a method of `QQ`.



---

archive/issue_comments_334083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-02T06:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334084.json:
```json
{
    "body": "Replying to [comment:14 sbrandhorst]:\n> How about `hilbert_conductor_inverse` as a name?\n\nI'm not sure about that name, it already exists and means something else.  I am happy with S_hilbert_symbol since it's restricting the Hilbert symbol at a finite set of primes, it's pretty consistent with your initial interpretation in comment 9; a hilbert symbol taken at a finite number of localizations.  \n \n> Problem is this exists and is (allmost) the same function.\n> Ideas? I would like to move it as a method of `QQ`.\n\nEventually we can split this into two methods, one for QQ an one for number fields.  I've got the general number fields method queued up and ready to go as soon as tickets #25023 and #25029 are positively reviewed.",
    "created_at": "2018-05-03T20:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334084",
    "user": "https://github.com/annahaensch"
}
```

Replying to [comment:14 sbrandhorst]:
> How about `hilbert_conductor_inverse` as a name?

I'm not sure about that name, it already exists and means something else.  I am happy with S_hilbert_symbol since it's restricting the Hilbert symbol at a finite set of primes, it's pretty consistent with your initial interpretation in comment 9; a hilbert symbol taken at a finite number of localizations.  
 
> Problem is this exists and is (allmost) the same function.
> Ideas? I would like to move it as a method of `QQ`.

Eventually we can split this into two methods, one for QQ an one for number fields.  I've got the general number fields method queued up and ready to go as soon as tickets #25023 and #25029 are positively reviewed.



---

archive/issue_comments_334085.json:
```json
{
    "body": "Mhh I do not like the prefix S_. In methods like S_unit_group and S_class_group, the primes in S are inverted. But we are not inverting anything - we are working in fields anyways. So there is no relation to this kind of objects? Finally in these S-rings one can define a hilbert symbol and we are not computing it.\n\nFor `b` and `S` given our function computes `a` such that `hilbert_conductor(a,b) = prod(S)` plus a condition at infinity. So I think that it is pretty close. And I like the idea that if you type\n`hilbert` + autocompletion you get this method suggested. \nSo maybe \n\n- `hilbert_something`\n- `hilbert_conductor_something`\n- `hilbert_conductor_inverse` with optional argument `b`?\n- `hilbert_conductor_inverse_S`?\n\nooops I have the numberfield version ready as well",
    "created_at": "2018-05-04T05:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334085",
    "user": "https://github.com/simonbrandhorst"
}
```

Mhh I do not like the prefix S_. In methods like S_unit_group and S_class_group, the primes in S are inverted. But we are not inverting anything - we are working in fields anyways. So there is no relation to this kind of objects? Finally in these S-rings one can define a hilbert symbol and we are not computing it.

For `b` and `S` given our function computes `a` such that `hilbert_conductor(a,b) = prod(S)` plus a condition at infinity. So I think that it is pretty close. And I like the idea that if you type
`hilbert` + autocompletion you get this method suggested. 
So maybe 

- `hilbert_something`
- `hilbert_conductor_something`
- `hilbert_conductor_inverse` with optional argument `b`?
- `hilbert_conductor_inverse_S`?

ooops I have the numberfield version ready as well



---

archive/issue_comments_334086.json:
```json
{
    "body": "How about `hilbert_symbol_positive_at_S`?",
    "created_at": "2018-05-04T17:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334086",
    "user": "https://github.com/annahaensch"
}
```

How about `hilbert_symbol_positive_at_S`?



---

archive/issue_comments_334087.json:
```json
{
    "body": "i could settle for\nhilbert_symbol_negative_at_S\n\n:)",
    "created_at": "2018-05-05T10:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334087",
    "user": "https://github.com/simonbrandhorst"
}
```

i could settle for
hilbert_symbol_negative_at_S

:)



---

archive/issue_comments_334088.json:
```json
{
    "body": "Replying to [comment:21 sbrandhorst]:\n> i could settle for\n> hilbert_symbol_negative_at_S\n> \n> :)\n\nAh, yes, even better.  Let's go with that :)",
    "created_at": "2018-05-05T13:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334088",
    "user": "https://github.com/annahaensch"
}
```

Replying to [comment:21 sbrandhorst]:
> i could settle for
> hilbert_symbol_negative_at_S
> 
> :)

Ah, yes, even better.  Let's go with that :)



---

archive/issue_comments_334089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-10T21:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334090.json:
```json
{
    "body": "Would you review the number field version? Else we can split it off to another ticket.",
    "created_at": "2018-07-13T19:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334090",
    "user": "https://github.com/simonbrandhorst"
}
```

Would you review the number field version? Else we can split it off to another ticket.



---

archive/issue_comments_334091.json:
```json
{
    "body": "This ticket has been asleep for awhile, but let's try and finish it.  I just tried to run doctests on and got an error message \n\n```\nAttributeError: Values instance has no attribute 'gc'\n```\n\nAny ideas?",
    "created_at": "2019-05-10T14:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334091",
    "user": "https://github.com/annahaensch"
}
```

This ticket has been asleep for awhile, but let's try and finish it.  I just tried to run doctests on and got an error message 

```
AttributeError: Values instance has no attribute 'gc'
```

Any ideas?



---

archive/issue_comments_334092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-13T08:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334093.json:
```json
{
    "body": "should be okay now.",
    "created_at": "2019-05-13T08:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334093",
    "user": "https://github.com/simonbrandhorst"
}
```

should be okay now.



---

archive/issue_comments_334094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-13T08:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334095.json:
```json
{
    "body": "We have a green bot. Tests pass.",
    "created_at": "2019-05-16T07:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334095",
    "user": "https://github.com/simonbrandhorst"
}
```

We have a green bot. Tests pass.



---

archive/issue_comments_334096.json:
```json
{
    "body": "Replying to [comment:30 sbrandhorst]:\n> We have a green bot. Tests pass.\n\nAll tests pass!  I had just run them independently anyhow, but good to know :)",
    "created_at": "2019-05-16T15:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334096",
    "user": "https://github.com/annahaensch"
}
```

Replying to [comment:30 sbrandhorst]:
> We have a green bot. Tests pass.

All tests pass!  I had just run them independently anyhow, but good to know :)



---

archive/issue_comments_334097.json:
```json
{
    "body": "I fixed a few errors that I spotted in the reference manual build, everything else looks good.  What do you think? \n----\nNew commits:",
    "created_at": "2019-05-18T18:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334097",
    "user": "https://github.com/annahaensch"
}
```

I fixed a few errors that I spotted in the reference manual build, everything else looks good.  What do you think? 
----
New commits:



---

archive/issue_comments_334098.json:
```json
{
    "body": "Add your name as a reviewer, then we can set positive review.",
    "created_at": "2019-05-18T19:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334098",
    "user": "https://github.com/simonbrandhorst"
}
```

Add your name as a reviewer, then we can set positive review.



---

archive/issue_comments_334099.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-18T19:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334099",
    "user": "https://github.com/annahaensch"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022334.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-05-24T18:29:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23861#event-22334"
}
```



---

archive/issue_comments_334100.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-24T18:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23861#issuecomment-334100",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
