# Issue 23861: _S_hilbert_symbol() helper function to find integer with negative Hilbert symbol for primes in at set S

Issue created by migration from Trac.

Original creator: annahaensch

Original creation time: 2017-10-24 16:07:28

CC:  mroy sbrudzin jduque

Keywords: #sd90

This is an implementation of algorithm 3.4.1 from Markus Kirschmer's "Definite quadratic and hermitian forms with small class number."  Given a non-square b and a set of primes S, the function returns a number a which has negative Hilbert symbol with respect to b at precisely the primes in S.  

This is a helper functioning service to algorithm 3.4.3, quadratic_form_form_local_invariants(), ticket TK.


---

Comment by annahaensch created at 2017-10-25 00:17:09

New commits:


---

Comment by annahaensch created at 2017-10-25 00:17:09

Changing status from new to needs_review.


---

Comment by annahaensch created at 2017-10-25 21:02:10

Changing component from quadratic forms to basic arithmetic.


---

Comment by annahaensch created at 2017-10-25 21:04:31

Changing keywords from "#sd90" to "sd90".


---

Comment by sbrandhorst created at 2017-11-24 09:52:43

So here are some thoughts:

This is just a helper function so it should not pollute the global namespace.
Is there a reason that you have implemented Markus algorithm just for `QQ`?
The beauty of Markus' work is that he did it directly for number fields.
It should not be too hard to do it for number fields.
All the necessary functions like class groups, ideals, hilbert symbols, places, are there:

```
sage: K.<a>=CyclotomicField(13)
sage: P=K.primes_above(3)[0]
sage: P
Fractional ideal (3, a^3 - a - 1)
sage: K.hilbert_symbol(3,1+a,P)
1
```

We can define the function as a method of the number field. Just like the hilbert_symbol.
Maybe the name S_hilbert_symbol is misleading? I would expect it to be the global hilbert_symbol of the localization at S or something like that. This function seems more like an inverse image?
maybe hilbert_symbol_inv_S?

Some remarks for formatting:
Comments should be of the form (note the space)

```
# foo does bla
foo = 3 
```

See https://www.python.org/dev/peps/pep-0008/#comments.

You are redefining V,W,vv in the while loop.
But really they stay constant. So they should not sit in the loop.

Use the names of Markus if possible or more descriptive names.
HH,PP etc. is not very descriptive. Same for i,j.
I do not see the need to define H. Why hide everything in lists?

Either use the verbose things or remove them.


---

Comment by sbrandhorst created at 2017-11-24 17:25:03

It is good to test the error messages. But they belong to the
TESTS:: block not the EXAMPLES:: block.
-> they do not need to show up in the documentation.


---

Comment by sbrandhorst created at 2017-11-29 08:29:17

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2018-05-01 21:05:25

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-05-01 21:05:25

How about `hilbert_conductor_inverse` as a name?
Problem is this exists and is (allmost) the same function.
Ideas? I would like to move it as a method of `QQ`.


---

Comment by git created at 2018-05-02 06:10:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-05-03 20:16:35

Replying to [comment:14 sbrandhorst]:
> How about `hilbert_conductor_inverse` as a name?

I'm not sure about that name, it already exists and means something else.  I am happy with S_hilbert_symbol since it's restricting the Hilbert symbol at a finite set of primes, it's pretty consistent with your initial interpretation in comment 9; a hilbert symbol taken at a finite number of localizations.  
 
> Problem is this exists and is (allmost) the same function.
> Ideas? I would like to move it as a method of `QQ`.

Eventually we can split this into two methods, one for QQ an one for number fields.  I've got the general number fields method queued up and ready to go as soon as tickets #25023 and #25029 are positively reviewed.


---

Comment by sbrandhorst created at 2018-05-04 05:51:00

Mhh I do not like the prefix S_. In methods like S_unit_group and S_class_group, the primes in S are inverted. But we are not inverting anything - we are working in fields anyways. So there is no relation to this kind of objects? Finally in these S-rings one can define a hilbert symbol and we are not computing it.

For `b` and `S` given our function computes `a` such that `hilbert_conductor(a,b) = prod(S)` plus a condition at infinity. So I think that it is pretty close. And I like the idea that if you type
`hilbert` + autocompletion you get this method suggested. 
So maybe 

- `hilbert_something`
- `hilbert_conductor_something`
- `hilbert_conductor_inverse` with optional argument `b`?
- `hilbert_conductor_inverse_S`?

ooops I have the numberfield version ready as well


---

Comment by annahaensch created at 2018-05-04 17:59:52

How about `hilbert_symbol_positive_at_S`?


---

Comment by sbrandhorst created at 2018-05-05 10:31:20

i could settle for
hilbert_symbol_negative_at_S

:)


---

Comment by annahaensch created at 2018-05-05 13:48:26

Replying to [comment:21 sbrandhorst]:
> i could settle for
> hilbert_symbol_negative_at_S
> 
> :)

Ah, yes, even better.  Let's go with that :)


---

Comment by git created at 2018-05-10 21:07:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-07-13 19:35:46

Would you review the number field version? Else we can split it off to another ticket.


---

Comment by annahaensch created at 2019-05-10 14:50:17

This ticket has been asleep for awhile, but let's try and finish it.  I just tried to run doctests on and got an error message 

```
AttributeError: Values instance has no attribute 'gc'
```

Any ideas?


---

Comment by git created at 2019-05-13 08:17:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2019-05-13 08:17:58

should be okay now.


---

Comment by git created at 2019-05-13 08:22:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2019-05-16 07:10:55

We have a green bot. Tests pass.


---

Comment by annahaensch created at 2019-05-16 15:57:02

Replying to [comment:30 sbrandhorst]:
> We have a green bot. Tests pass.

All tests pass!  I had just run them independently anyhow, but good to know :)


---

Comment by annahaensch created at 2019-05-18 18:58:55

I fixed a few errors that I spotted in the reference manual build, everything else looks good.  What do you think? 
----
New commits:


---

Comment by sbrandhorst created at 2019-05-18 19:09:41

Add your name as a reviewer, then we can set positive review.


---

Comment by annahaensch created at 2019-05-18 19:58:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-24 18:29:46

Resolution: fixed
