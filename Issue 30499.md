# Issue 30499: replacing insecure git:// with secure https://

Issue created by migration from https://trac.sagemath.org/ticket/30736

Original creator: @Volker-Weissmann

Original creation time: 2020-10-06 23:59:59

CC:  vbraun mkoeppe embray saraedum




---

Comment by @Volker-Weissmann created at 2020-10-07 01:06:22

Changing type from PLEASE CHANGE to defect.


---

Comment by @Volker-Weissmann created at 2020-10-07 01:06:22

Changing keywords from "" to "security git trac".


---

Comment by @Volker-Weissmann created at 2020-10-07 01:06:22

Changing component from PLEASE CHANGE to scripts.


---

Comment by @Volker-Weissmann created at 2020-10-07 01:06:22

Changing status from new to needs_review.


---

Comment by @Volker-Weissmann created at 2020-10-07 01:06:22

Changing priority from major to critical.


---

Comment by @Volker-Weissmann created at 2020-10-07 01:07:34

See https://github.com/sagemath/git-trac-command/pull/49 for the second part of this ticket. (This ticket won't work without the git trac PR).


---

Comment by dimpase created at 2020-10-07 11:51:09

The PR has been merged. So I suppose it's waiting for a new release, to update build/pkgs/git_trac/package-version.txt etc?


---

Comment by @Volker-Weissmann created at 2020-10-07 23:45:59

Replying to [comment:4 dimpase]:
> So I suppose it's waiting for a new release, to update build/pkgs/git_trac/package-version.txt etc?
> 
I don't know what you are talking about. We don't touch build/pkgs/git_trac/package-version.txt .
----
New commits:


---

Comment by dimpase created at 2020-10-08 10:56:19

Replying to [comment:6 gh-Volker-Weissmann]:
> Replying to [comment:4 dimpase]:
> > So I suppose it's waiting for a new release, to update build/pkgs/git_trac/package-version.txt etc?
> > 
> I don't know what you are talking about. We don't touch build/pkgs/git_trac/package-version.txt 

Sage can install  git-trac as its optional package.
This ticket updates git-trac, so I thought it should update the optional package too.
However, the optional package looks abandoned, last touched in 2016.

Let's remove it here, it seems to be an oversight that it's not done years ago.


---

Comment by dimpase created at 2020-10-08 11:49:44

New commits:


---

Comment by dimpase created at 2020-10-08 11:49:44

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-10-08 11:51:51

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2020-10-08 11:56:21

I am not sure about changes to `docker/Dockerfile` - isn't it replacing anonymous access with authenticated?
Same for some scripts.


---

Comment by dimpase created at 2020-10-08 12:06:52

This looks wrong:

```diff
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -352,7 +352,7 @@ SINGULARPATH="$SAGE_LOCAL/share/singular" && export SINGULARPATH
 SINGULAR_EXECUTABLE="$SAGE_LOCAL/bin/Singular" && export SINGULAR_EXECUTABLE
 
 if [ -z "$SAGE_REPO_ANONYMOUS" ]; then
-    SAGE_REPO_ANONYMOUS="git://trac.sagemath.org/sage.git"
+    SAGE_REPO_ANONYMOUS="git@trac.sagemath.org:sage.git"
     export SAGE_REPO_ANONYMOUS
 fi
 if [ -z "$SAGE_REPO_AUTHENTICATED" ]; then
```

as this is anonymous access, as opposed to authenticated. So it should be left alone (as our git server does not provide `http(s):` access, only `git:` and `ssh:`.


---

Comment by dimpase created at 2020-10-08 13:55:19

on the other hand, `SAGE_REPO_ANONYMOUS` is only **used** in `build/bin/sage-clone-source` - a script that is currently not used, so it's OK to change it like this. 

But the dockerfile may be used by various bots, so it really matters that it's an anonymous access.
The proper fix would be to enable `https:` on Sage's git server, but I am so not looking forward to this exercise... Perhaps it might be easier to add a server-side post-commit hook to push changes to the github mirror https://github.com/sagemath/sagetrac-mirror, and use it for read access instead.


---

Comment by @Volker-Weissmann created at 2020-10-08 15:19:56

The problem with using git clone git://trac.sagemath.org/sage.git is that it does not check whether the cloned source code actually originates from sagemath.org.
If a hacker got control over e.g. the router, he could manipulate the cloned source code to include malware that gets executed once you build sagemath.
This is an unacceptable security vulnerability that needs to be fixed by either using https or ssh.

I tried https://trac.sagemath.org/sage.git, but this is not supported from server-site.
I don't see the problem with having git clone git`@`trac.sagemath.org:sage.git . A bot could do that, but maybe it would require setting the correct ssh fingerprint like in my other PR:

https://github.com/sagemath/git-trac-command/pull/49/commits/1cf840b144bb49a3948361cd3368db430b75deec


---

Comment by dimpase created at 2020-10-08 16:01:48

Replying to [comment:13 gh-Volker-Weissmann]:
> The problem with using git clone git://trac.sagemath.org/sage.git is that it does not check whether the cloned source code actually originates from sagemath.org.
> If a hacker got control over e.g. the router, he could manipulate the cloned source code to include malware that gets executed once you build sagemath.
> This is an unacceptable security vulnerability that needs to be fixed by either using https or ssh.
> 
> I tried https://trac.sagemath.org/sage.git, but this is not supported from server-site.

yes, I know, I have admin rights for the host running trac.sagemath.org, and setting https access seems to be a tricky task. I can't seem to be able to find a guide on how to do this, although I didn't try too hard. The Git Book only talks about http, not https.


> I don't see the problem with having git clone git`@`trac.sagemath.org:sage.git . A bot could do that, but maybe it would require setting the correct ssh fingerprint like in my other PR:

I don't see how this could be useful.
A typical bot would be, say, a host running [GitHub](GitHub) Actions task, and the problem of distributing the keys seems to be a rather tricky one. Indeed, we do not have a way to have a read-only access rights, and so uploading an ssh key-pair to a random host does breach our security just as well.


> 
> https://github.com/sagemath/git-trac-command/pull/49/commits/1cf840b144bb49a3948361cd3368db430b75deec 
>


---

Comment by @Volker-Weissmann created at 2020-10-08 18:04:35

Replying to [comment:14 dimpase]:

> I don't see how this could be useful.
> A typical bot would be, say, a host running [GitHub](GitHub) Actions task, and the problem of distributing the keys seems to be a rather tricky one. Indeed, we do not have a way to have a read-only access rights, and so uploading an ssh key-pair to a random host does breach our security just as well.
> 
> 
> > 
> > https://github.com/sagemath/git-trac-command/pull/49/commits/1cf840b144bb49a3948361cd3368db430b75deec 
> > 

Why does uploading an ssh key to a random host breach your security? Its a public key, its meant to be public. If you don't like hard-coded keys, and you can't manage to activate https on the git server, you could make a https site with the correct public ssh fingerprints. Then we could download the key using https and add them into the known_hosts file. If you don't like editing the ~/.ssh/known_hosts file, git clone can pass options to ssh and ssh has an option to use a different known_hosts file.

The only alternative I see is enabling https or switching from trac to a software that supports https.


---

Comment by dimpase created at 2020-10-08 18:30:43

Replying to [comment:15 gh-Volker-Weissmann]:
> Replying to [comment:14 dimpase]:
> 
> > I don't see how this could be useful.
> > A typical bot would be, say, a host running [GitHub](GitHub) Actions task, and the problem of distributing the keys seems to be a rather tricky one. Indeed, we do not have a way to have a read-only access rights, and so uploading an ssh key-pair to a random host does breach our security just as well.
> > 
> > 
> > > 
> > > https://github.com/sagemath/git-trac-command/pull/49/commits/1cf840b144bb49a3948361cd3368db430b75deec 
> > > 
> 
> Why does uploading an ssh key to a random host breach your security? Its a public key, its meant to be public.

no, the bot needs a key-pair to be able to pull via ssh, just as a normal user needs a key-pair.
Giving a pre-existing key-pair to the bot is not secure, and certainly a bot cannot generate a key-pair and upload the public key.


---

Comment by dimpase created at 2020-10-08 18:32:44

I've set up a post-commit hook on trac so that everything pushed gets immediatelly mirrored to https://github.com/sagemath/sagetrac-mirror - from which one can pull with https:.
So in the scripts one can replace trac with github.com/sagemath/sagetrac-mirror


---

Comment by @Volker-Weissmann created at 2020-10-08 18:33:55

Replying to [comment:16 dimpase]:
> Replying to [comment:15 gh-Volker-Weissmann]:
> > Replying to [comment:14 dimpase]:
> > 
> > > I don't see how this could be useful.
> > > A typical bot would be, say, a host running [GitHub](GitHub) Actions task, and the problem of distributing the keys seems to be a rather tricky one. Indeed, we do not have a way to have a read-only access rights, and so uploading an ssh key-pair to a random host does breach our security just as well.
> > > 
> > > 
> > > > 
> > > > https://github.com/sagemath/git-trac-command/pull/49/commits/1cf840b144bb49a3948361cd3368db430b75deec 
> > > > 
> > 
> > Why does uploading an ssh key to a random host breach your security? Its a public key, its meant to be public.
> 
> no, the bot needs a key-pair to be able to pull via ssh, just as a normal user needs a key-pair.
> Giving a pre-existing key-pair to the bot is not secure, and certainly a bot cannot generate a key-pair and upload the public key.
>  

If I set the correct public key in my .ssh/known_hosts file, I can just execute git clone git`@`trac.sagemath.org:sage.git
I don't know why the bot should not be able to do that.


---

Comment by dimpase created at 2020-10-08 19:04:54

Replying to [comment:18 gh-Volker-Weissmann]:

> If I set the correct public key in my .ssh/known_hosts file, I can just execute git clone git`@`trac.sagemath.org:sage.git
> I don't know why the bot should not be able to do that.

isn't it working because you have ssh-agent running, and your public key is already on trac?
IMHO git via ssh always does ssh authentication, even `git clone` - although I might be wrong here.


---

Comment by dimpase created at 2020-10-08 19:13:37

Well, yes, I am right, I did an experiment - created a new user, logged in, and

```
foo@hilbert ~ $ git clone git@github.com:sage/sage.git
Cloning into 'sage'...
The authenticity of host 'github.com (140.82.121.4)' can't be established.
RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'github.com,140.82.121.4' (RSA) to the list of known hosts.
git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
foo@hilbert ~ $ 
foo@hilbert ~ $ git clone git@github.com:sage/sage.git
Cloning into 'sage'...
git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
foo@hilbert ~ $ git clone git@trac.sagemath.org:sage.git
Cloning into 'sage'...
The authenticity of host 'trac.sagemath.org (104.197.143.230)' can't be established.
ECDSA key fingerprint is SHA256:4Op/q3b5792x+F1lHSKRi5UIORAPDlIFVA5cUq9YVXI.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'trac.sagemath.org,104.197.143.230' (ECDSA) to the list of known hosts.
git@trac.sagemath.org: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
foo@hilbert ~ $ git clone git@trac.sagemath.org:sage.git
Cloning into 'sage'...
git@trac.sagemath.org: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
```


Thus, well, no, it won't fly.


---

Comment by @Volker-Weissmann created at 2020-10-08 19:52:15

Replying to [comment:20 dimpase]:
> Well, yes, I am right, I did an experiment - created a new user, logged in, and
> {{{
> foo`@`hilbert ~ $ git clone git`@`github.com:sage/sage.git
> Cloning into 'sage'...
> The authenticity of host 'github.com (140.82.121.4)' can't be established.
> RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.
> Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
> Warning: Permanently added 'github.com,140.82.121.4' (RSA) to the list of known hosts.
> git`@`github.com: Permission denied (publickey).
> fatal: Could not read from remote repository.
> 
> Please make sure you have the correct access rights
> and the repository exists.
> foo`@`hilbert ~ $ 
> foo`@`hilbert ~ $ git clone git`@`github.com:sage/sage.git
> Cloning into 'sage'...
> git`@`github.com: Permission denied (publickey).
> fatal: Could not read from remote repository.
> 
> Please make sure you have the correct access rights
> and the repository exists.
> foo`@`hilbert ~ $ git clone git`@`trac.sagemath.org:sage.git
> Cloning into 'sage'...
> The authenticity of host 'trac.sagemath.org (104.197.143.230)' can't be established.
> ECDSA key fingerprint is SHA256:4Op/q3b5792x+F1lHSKRi5UIORAPDlIFVA5cUq9YVXI.
> Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
> Warning: Permanently added 'trac.sagemath.org,104.197.143.230' (ECDSA) to the list of known hosts.
> git`@`trac.sagemath.org: Permission denied (publickey).
> fatal: Could not read from remote repository.
> 
> Please make sure you have the correct access rights
> and the repository exists.
> foo`@`hilbert ~ $ git clone git`@`trac.sagemath.org:sage.git
> Cloning into 'sage'...
> git`@`trac.sagemath.org: Permission denied (publickey).
> fatal: Could not read from remote repository.
> 
> Please make sure you have the correct access rights
> and the repository exists.
> }}}
> 
> Thus, well, no, it won't fly.
> 
Oh no, that's not good, I didn't knew that.
I think you will have to setup https then.


---

Comment by git created at 2020-10-08 20:22:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-10-08 20:27:05

I suppose we can get away with github.com/sagemath/sagetrac-mirror.git repo (which does allow https) for all the Docker-related stuff and CI.
Now committing to git trac goes to  there, too. E.g. here is what I saw as I pushed the last commit:

```
$ git push trac HEAD
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 4 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 308 bytes | 308.00 KiB/s, done.
Total 3 (delta 2), reused 0 (delta 0), pack-reused 0
remote: Trac #30736: Commit changed to b69a57.
remote: To git@github.com:sagemath/sagetrac-mirror.git
remote:    c28adef..b69a573  u/dimpase/replacing_insecure_git____with_secure_https___ -> u/dimpase/replacing_insecure_git____with_secure_https___
To trac.sagemath.org:sage.git
   c28adeff5b..b69a573ec4  HEAD -> u/dimpase/replacing_insecure_git____with_secure_https___
```


the only drawback is that it's a bit slow (we can think for doing pushing to [GitHub](GitHub) in the background).


---

Comment by @Volker-Weissmann created at 2020-10-08 20:45:55

Seems like a good idea.


---

Comment by @Volker-Weissmann created at 2020-10-09 12:56:06

Replying to [comment:23 dimpase]:
> I suppose we can get away with github.com/sagemath/sagetrac-mirror.git repo (which does allow https) for all the Docker-related stuff and CI.
> Now committing to git trac goes to  there, too. E.g. here is what I saw as I pushed the last commit:
> {{{
> $ git push trac HEAD
> Enumerating objects: 5, done.
> Counting objects: 100% (5/5), done.
> Delta compression using up to 4 threads
> Compressing objects: 100% (3/3), done.
> Writing objects: 100% (3/3), 308 bytes | 308.00 KiB/s, done.
> Total 3 (delta 2), reused 0 (delta 0), pack-reused 0
> remote: Trac #30736: Commit changed to b69a57.
> remote: To git`@`github.com:sagemath/sagetrac-mirror.git
> remote:    c28adef..b69a573  u/dimpase/replacing_insecure_git____with_secure_https___ -> u/dimpase/replacing_insecure_git____with_secure_https___
> To trac.sagemath.org:sage.git
>    c28adeff5b..b69a573ec4  HEAD -> u/dimpase/replacing_insecure_git____with_secure_https___
> }}}
> 
> the only drawback is that it's a bit slow (we can think for doing pushing to [GitHub](GitHub) in the background).

Do you want to code that, or should I code that?


---

Comment by dimpase created at 2020-10-09 13:19:57

I broke the github.com/sagemath/sagetrac-mirror.git while playing with the commit hook, removed it, and for some reason cannot re-create it on github - looks like a github problem, direct pushing from trac server of a 300Mb repo with lots of refs ends with weird

```
...
! [remote failure]  9.2.beta9 -> 9.2.beta9 (remote failed to report status)
! [remote failure]  9.2.rc0 -> 9.2.rc0 (remote failed to report status)
error: failed to push some refs to 'git@github.com:sagemath/sagetrac-mirror.git'
```

If you have time please feel free to play with this (in your own [GitHub](GitHub) repo, you can always transfer the ownership later): clone the trac repo with --mirror option, then try to push it to [GitHub](GitHub).

--------------

The ticket is meanwhile good to go, as the affected by it Docker and script things are currently not in use.


---

Comment by dimpase created at 2020-10-09 13:19:57

Changing status from needs_review to positive_review.


---

Comment by @Volker-Weissmann created at 2020-10-09 14:15:10

Because you said, that the script is currently not in use, I just disabled it and added a link to this ticket.
----
New commits:


---

Comment by dimpase created at 2020-10-09 22:17:02

Oops, sorry, `sage-clone-source` is actually used in `sage-sdist`, which is, AFAIK, a part of Volker B.'s (vbraun) workflow to make distributions.
But we can assume that vbraun does use ssh authentication to pull from git trac, I suppose?
Volker?


---

Comment by dimpase created at 2020-10-09 22:17:02

Changing status from positive_review to needs_info.


---

Comment by mkoeppe created at 2020-10-10 00:21:14

Changing status from needs_info to needs_work.


---

Comment by mkoeppe created at 2020-10-10 00:21:14

`sage-sdist` is also used in CI - see `.github/workflows/tox.yml`, job `dist`.


---

Comment by dimpase created at 2020-10-10 00:37:48

Replying to [comment:30 mkoeppe]:
> `sage-sdist` is also used in CI - see `.github/workflows/tox.yml`, job `dist`.

but there it's not pulling from Sage's git repo, if I  understood you correctly, right?


---

Comment by mkoeppe created at 2020-10-10 01:00:01

I had forgotten about this particular one. This one uses `make dist`, which leads to the use of `SAGE_REPO_ANONYMOUS`.

The idea of `make dist` (`sage-clone-source`), by the way, is that the source distribution (like the binary packages) distributes a `.git` directory that has a git remote that is accessible to any user...


---

Comment by dimpase created at 2020-10-10 07:32:22

Replying to [comment:32 mkoeppe]:
> I had forgotten about this particular one. This one uses `make dist`, which leads to the use of `SAGE_REPO_ANONYMOUS`.
> 
> The idea of `make dist` (`sage-clone-source`), by the way, is that the source distribution (like the binary packages) distributes a `.git` directory that has a git remote that is accessible to any user...

What branches are meant to be exposed this way? Experimental ones? One way or another, using a mirror rather than the git trac server could be better also for scalability (also removes the need to set up https access on git trac, something I'm not keen on doing, as it seems to be dark art :-)).

I'm currenly building up a mirror on [GitLab](GitLab) - pushing all the branches one by one, otherwise it chokes up, so it should be ready in a day or two.


---

Comment by dimpase created at 2020-10-10 07:58:53

There is also already functional https://gitlab.com/sagemath/dev/trac.git - which does updates by pulling using `git://`, so that currently defeats its purpose, security-wise. It should be possible to make it use ssh (not sure if we're in a tier that allows this for free). As well, it does pull every 30 minutes (or even a bit less often), so there is a delay.


---

Comment by dimpase created at 2020-10-22 09:07:10

Finally I got a push mirror running on https://gitlab.com/sagemath/dev/tracmirror -
so this should be used whereever possible to reduce the load on our git server, and use `https:` in place of `git:`.

Sorry that it took so long.


---

Comment by dimpase created at 2020-10-22 09:43:40

New commits:


---

Comment by dimpase created at 2020-10-22 09:43:40

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-10-22 09:48:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-10-22 09:50:22

OK, so now it's as intended. Please review.


---

Comment by embray created at 2020-10-22 13:21:17

I don't understand how this is different from https://gitlab.com/sagemath/dev/trac which we already had.


---

Comment by dimpase created at 2020-10-22 14:12:43

Replying to [comment:40 embray]:
> I don't understand how this is different from https://gitlab.com/sagemath/dev/trac which we already had. 

the old one is a pull mirror, so there is a 30+ min delay in updating it, as opposed to the new one, which is a push mirror, updated immediately via push from trac git server (via a post-receive commit hook)


---

Comment by mkoeppe created at 2020-10-22 15:32:11

This change seems to have been made mechanically without checking whether the server exists

```
--- a/build/pkgs/tdlib/SPKG.rst
+++ b/build/pkgs/tdlib/SPKG.rst
@@ -24,7 +24,7 @@ Upstream Contact
 ----------------
 
 - Lukas Larisch (larisch@informatik.uni-frankfurt.de)
-- git-repo: git://pholia.tdi.cs.uni-frankfurt.de/git/tdlib
+- git-repo: https://pholia.tdi.cs.uni-frankfurt.de/git/tdlib
```



---

Comment by mkoeppe created at 2020-10-22 15:35:56


```
 if [ -z "$SAGE_REPO_ANONYMOUS" ]; then
-    SAGE_REPO_ANONYMOUS="git://trac.sagemath.org/sage.git"
+    SAGE_REPO_ANONYMOUS="https://gitlab.com/sagemath/dev/tracmirror.git"
     export SAGE_REPO_ANONYMOUS
 fi
```

This is the one that the source tarballs made using `make dist` will be referring to. Why is this one using gitlab instead of the new mirror?


---

Comment by mkoeppe created at 2020-10-22 15:37:40

Replying to [comment:43 mkoeppe]:
> {{{
>  if [ -z "$SAGE_REPO_ANONYMOUS" ]; then
> -    SAGE_REPO_ANONYMOUS="git://trac.sagemath.org/sage.git"
> +    SAGE_REPO_ANONYMOUS="https://gitlab.com/sagemath/dev/tracmirror.git"
>      export SAGE_REPO_ANONYMOUS
>  fi
> }}}
> This is the one that the source tarballs made using `make dist` will be referring to. Why is this one using gitlab instead of the new mirror?
> 

Sorry, I meant: Why is this one not using the github URL to match what is advertised in README?


---

Comment by dimpase created at 2020-10-22 17:05:10

Replying to [comment:44 mkoeppe]:
> Replying to [comment:43 mkoeppe]:
> > {{{
> >  if [ -z "$SAGE_REPO_ANONYMOUS" ]; then
> > -    SAGE_REPO_ANONYMOUS="git://trac.sagemath.org/sage.git"
> > +    SAGE_REPO_ANONYMOUS="https://gitlab.com/sagemath/dev/tracmirror.git"
> >      export SAGE_REPO_ANONYMOUS
> >  fi
> > }}}
> > This is the one that the source tarballs made using `make dist` will be referring to. Why is this one using gitlab instead of the new mirror?
> > 
> 
> Sorry, I meant: Why is this one not using the github URL to match what is advertised in README?
on github we now only have a repo with develop and master branches (and all the tags for betas/rcs, starting from 8.5.beta1)

the gitlab repo used on this ticket is a true push mirror, carrying all the branches, and only behind the git trac server by seconds.
(and as git trac does not allow https access, we use the gitlab repo, which does allow https)


---

Comment by mkoeppe created at 2020-10-22 17:08:24

That's great, thanks for the explanation.


---

Comment by mkoeppe created at 2020-10-22 17:11:01

I think `sage-clone-source` should be changed so that either the `push` URL is removed, or set to trac.


---

Comment by mkoeppe created at 2020-10-22 17:19:46

Replying to [comment:47 mkoeppe]:
> I think `sage-clone-source` should be changed so that either the `push` URL is removed, or set to trac.
Right now we have:

```
$ git remote -v
origin	https://gitlab.com/sagemath/dev/tracmirror.git (fetch)
origin	https://gitlab.com/sagemath/dev/tracmirror.git (push)
```



---

Comment by mkoeppe created at 2020-10-22 17:23:48


```
diff --git a/build/bin/sage-clone-source b/build/bin/sage-clone-source
index 6720ea7391..dbbf33a786 100755
--- a/build/bin/sage-clone-source
+++ b/build/bin/sage-clone-source
@@ -35,6 +35,7 @@ git clone "$SRC" "$DST"
 
 cd "$DST"
 git remote set-url origin "$SAGE_REPO_ANONYMOUS"
+git remote set-url --push origin "$SAGE_REPO_AUTHENTICATED"
 
 # Save space
 git gc --aggressive --prune=now
```



---

Comment by dimpase created at 2020-10-22 17:25:40

Replying to [comment:42 mkoeppe]:
> This change seems to have been made mechanically without checking whether the server exists

I agree. It seems that the current active upstream is at https://github.com/freetdi/tdlib
and the old servers are long gone.
(email is obsolete too, the current affiliation of Larisch appears to be KAUST:
https://cemse.kaust.edu.sa/cs/people/person/lukas-larisch)

I'll fix this.


---

Comment by dimpase created at 2020-10-22 17:31:17

I've opened #30813 to investigate a possibility to update tdlib.


---

Comment by git created at 2020-10-22 18:18:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-22 19:17:44

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-10-22 19:17:44

Changing priority from critical to blocker.


---

Comment by vbraun created at 2020-10-24 11:07:33

Changing priority from blocker to major.


---

Comment by vbraun created at 2020-10-24 11:07:33

Not a blocker


---

Comment by dimpase created at 2020-10-24 11:14:00

well, if you prefer leaving security holes open...


---

Comment by chapoton created at 2020-10-25 19:23:20

will this allow to fix our current docker hub problem ?

Apparently if fails on the following line in docker/Dockerfile:

```
git remote add trac git://trac.sagemath.org/sage.git
```


See https://gitlab.com/sagemath/sage/-/pipelines


---

Comment by vbraun created at 2020-11-01 00:42:52

Resolution: fixed
