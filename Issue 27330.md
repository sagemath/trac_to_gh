# Issue 27330: Add --with-system-<spkg> options to configure

archive/issues_027330.json:
```json
{
    "body": "CC:  @dimpase @jdemeyer @jhpalmieri\n\nAs discussed in other tickets, such as #27373 and #26899, it would sometimes be useful to be able to explicitly specify, at configure-time, whether or not a system package can be used to fulfill some SPKG dependency.\n\nWith the work being done for #27330, it is currently the case that if an SPKG has a `spkg-configure.m4`, and the checks performed for the system package succeed, then the system package will always be used whether you want to or not.\n\nThis is a problem because even of the configure-time checks succeed, there could be previously unknown or unanticipated problems with using a particular version of the system package or some package+platform combination.\n\nTherefore it is useful (if unfortunate) to be able to force use of the SPKG and disable checking for the system package.  In principle we would want to react to the broken package+platform combination as well, either by fixing it somehow or blacklisting that particular combination at configure-time.  However, by providing this option, we at least don't have to react immediately to such problems if/when they arise (e.g. #26899).\n\nThis ticket adds a `--with-system-<spkg>` flag to `configure`; e.g. `--with-system-zlib`.  By default this is enabled (the current behavior), but by passing `--with-system-zlib=no` or `--without-system-zlib` then the SPKG will be installed without checking the system for the dependency.\n\nThis also adds the option to pass `--with-system-zlib=force` meaning that if the dependency cannot be found on the system then configure will abort with an error message.\n\nThis would effectively replace #21538.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27567\n\n",
    "created_at": "2019-03-29T16:02:48Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Add --with-system-<spkg> options to configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27330",
    "user": "https://github.com/embray"
}
```
CC:  @dimpase @jdemeyer @jhpalmieri

As discussed in other tickets, such as #27373 and #26899, it would sometimes be useful to be able to explicitly specify, at configure-time, whether or not a system package can be used to fulfill some SPKG dependency.

With the work being done for #27330, it is currently the case that if an SPKG has a `spkg-configure.m4`, and the checks performed for the system package succeed, then the system package will always be used whether you want to or not.

This is a problem because even of the configure-time checks succeed, there could be previously unknown or unanticipated problems with using a particular version of the system package or some package+platform combination.

Therefore it is useful (if unfortunate) to be able to force use of the SPKG and disable checking for the system package.  In principle we would want to react to the broken package+platform combination as well, either by fixing it somehow or blacklisting that particular combination at configure-time.  However, by providing this option, we at least don't have to react immediately to such problems if/when they arise (e.g. #26899).

This ticket adds a `--with-system-<spkg>` flag to `configure`; e.g. `--with-system-zlib`.  By default this is enabled (the current behavior), but by passing `--with-system-zlib=no` or `--without-system-zlib` then the SPKG will be installed without checking the system for the dependency.

This also adds the option to pass `--with-system-zlib=force` meaning that if the dependency cannot be found on the system then configure will abort with an error message.

This would effectively replace #21538.

Issue created by migration from https://trac.sagemath.org/ticket/27567





---

archive/issue_comments_384851.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-29T16:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384851",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384852.json:
```json
{
    "body": "This would provide at least a partial workaround to #26899.  Knowing (as we do now) that using the system zlib is problematic on some OSX's (in this case due to a bug in *python*). With this feature we can at least tell users to run `make configure; ./configure --without-system-zlib` as a workaround.\n\nI think this *might* also be useful for resolving #27373, though I don't believe it's strictly necessary for that either.\n\nI'm certainly open to revisions on the concept, but I do believe that such a flag, however it's named, is useful.\n----\nNew commits:",
    "created_at": "2019-03-29T16:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384852",
    "user": "https://github.com/embray"
}
```

This would provide at least a partial workaround to #26899.  Knowing (as we do now) that using the system zlib is problematic on some OSX's (in this case due to a bug in *python*). With this feature we can at least tell users to run `make configure; ./configure --without-system-zlib` as a workaround.

I think this *might* also be useful for resolving #27373, though I don't believe it's strictly necessary for that either.

I'm certainly open to revisions on the concept, but I do believe that such a flag, however it's named, is useful.
----
New commits:



---

archive/issue_comments_384853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-03-29T16:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_384854.json:
```json
{
    "body": "for uniformity with mpir/gmp etc, I'd name it `--with-zlib=` which takes values\n`system/install`, and the default is `system`.",
    "created_at": "2019-03-29T16:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384854",
    "user": "https://github.com/dimpase"
}
```

for uniformity with mpir/gmp etc, I'd name it `--with-zlib=` which takes values
`system/install`, and the default is `system`.



---

archive/issue_comments_384855.json:
```json
{
    "body": "Replying to [comment:3 dimpase]:\n> for uniformity with mpir/gmp etc, I'd name it `--with-zlib=` which takes values\n> `system/install`, and the default is `system`.\n\nWe might need to modify some other macros (e.g. `AX_CHECK_ZLIB`) which already provides a `--with-zlib` option.",
    "created_at": "2019-03-29T16:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384855",
    "user": "https://github.com/embray"
}
```

Replying to [comment:3 dimpase]:
> for uniformity with mpir/gmp etc, I'd name it `--with-zlib=` which takes values
> `system/install`, and the default is `system`.

We might need to modify some other macros (e.g. `AX_CHECK_ZLIB`) which already provides a `--with-zlib` option.



---

archive/issue_comments_384856.json:
```json
{
    "body": "This is the relevant portion of what `./configure --help` currently looks like with this branch:\n\n\n```\nOptional Packages:\n  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]\n  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)\n  --with-python=2         build and use Python 2 (default)\n  --with-python=3         build and use Python 3\n  --with-mp=mpir          use MPIR as multiprecision library (default)\n  --with-mp=gmp           use GMP as multiprecision library\n  --with-blas=openblas    use OpenBLAS as BLAS library (default)\n  --with-blas=atlas       use ATLAS as BLAS library\n  --with-system-gcc       detect and use an existing system gcc (default\n                          is yes)\n  --with-system-gcc=force require use of an existing system gcc\n  --with-system-zeromq    detect and use an existing system zeromq (default\n                          is yes)\n  --with-system-zeromq=force\n                          require use of an existing system zeromq\n  --with-zmq=<prefix>     ZMQ prefix directory\n  --with-system-git       detect and use an existing system git (default\n                          is yes)\n  --with-system-git=force require use of an existing system git\n  --with-system-libffi    detect and use an existing system libffi (default\n                          is yes)\n  --with-system-libffi=force\n                          require use of an existing system libffi\n  --with-system-gf2x      detect and use an existing system gf2x (default\n                          is yes)\n  --with-system-gf2x=force\n                          require use of an existing system gf2x\n  --with-system-yasm      detect and use an existing system yasm (default\n                          is yes)\n  --with-system-yasm=force\n                          require use of an existing system yasm\n  --with-system-xz        detect and use an existing system xz (default\n                          is yes)\n  --with-system-xz=force  require use of an existing system xz\n  --with-lzma=DIR         root directory path of lzma installation [defaults to\n                          /usr/local or /usr if not found in /usr/local]\n  --without-lzma          to disable lzma usage completely\n  --with-system-bzip2     detect and use an existing system bzip2 (default\n                          is yes)\n  --with-system-bzip2=force\n                          require use of an existing system bzip2\n  --with-system-gfortran  detect and use an existing system gfortran (default\n                          is yes)\n  --with-system-gfortran=force\n                          require use of an existing system gfortran\n  --with-system-zlib      detect and use an existing system zlib (default\n                          is yes)\n  --with-system-zlib=force\n                          require use of an existing system zlib\n  --with-zlib=DIR         root directory path of zlib installation [defaults to\n                          /usr/local or /usr if not found in /usr/local]\n  --without-zlib          to disable zlib usage completely\n  --with-system-curl      detect and use an existing system curl (default\n                          is yes)\n  --with-system-curl=force\n                          require use of an existing system curl\n  --with-system-patch     detect and use an existing system patch (default\n                          is yes)\n  --with-system-patch=force\n                          require use of an existing system patch\n\n```\n",
    "created_at": "2019-03-29T16:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384856",
    "user": "https://github.com/embray"
}
```

This is the relevant portion of what `./configure --help` currently looks like with this branch:


```
Optional Packages:
  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
  --with-python=2         build and use Python 2 (default)
  --with-python=3         build and use Python 3
  --with-mp=mpir          use MPIR as multiprecision library (default)
  --with-mp=gmp           use GMP as multiprecision library
  --with-blas=openblas    use OpenBLAS as BLAS library (default)
  --with-blas=atlas       use ATLAS as BLAS library
  --with-system-gcc       detect and use an existing system gcc (default
                          is yes)
  --with-system-gcc=force require use of an existing system gcc
  --with-system-zeromq    detect and use an existing system zeromq (default
                          is yes)
  --with-system-zeromq=force
                          require use of an existing system zeromq
  --with-zmq=<prefix>     ZMQ prefix directory
  --with-system-git       detect and use an existing system git (default
                          is yes)
  --with-system-git=force require use of an existing system git
  --with-system-libffi    detect and use an existing system libffi (default
                          is yes)
  --with-system-libffi=force
                          require use of an existing system libffi
  --with-system-gf2x      detect and use an existing system gf2x (default
                          is yes)
  --with-system-gf2x=force
                          require use of an existing system gf2x
  --with-system-yasm      detect and use an existing system yasm (default
                          is yes)
  --with-system-yasm=force
                          require use of an existing system yasm
  --with-system-xz        detect and use an existing system xz (default
                          is yes)
  --with-system-xz=force  require use of an existing system xz
  --with-lzma=DIR         root directory path of lzma installation [defaults to
                          /usr/local or /usr if not found in /usr/local]
  --without-lzma          to disable lzma usage completely
  --with-system-bzip2     detect and use an existing system bzip2 (default
                          is yes)
  --with-system-bzip2=force
                          require use of an existing system bzip2
  --with-system-gfortran  detect and use an existing system gfortran (default
                          is yes)
  --with-system-gfortran=force
                          require use of an existing system gfortran
  --with-system-zlib      detect and use an existing system zlib (default
                          is yes)
  --with-system-zlib=force
                          require use of an existing system zlib
  --with-zlib=DIR         root directory path of zlib installation [defaults to
                          /usr/local or /usr if not found in /usr/local]
  --without-zlib          to disable zlib usage completely
  --with-system-curl      detect and use an existing system curl (default
                          is yes)
  --with-system-curl=force
                          require use of an existing system curl
  --with-system-patch     detect and use an existing system patch (default
                          is yes)
  --with-system-patch=force
                          require use of an existing system patch

```




---

archive/issue_comments_384857.json:
```json
{
    "body": "ah OK, it's fine then.",
    "created_at": "2019-03-29T16:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384857",
    "user": "https://github.com/dimpase"
}
```

ah OK, it's fine then.



---

archive/issue_comments_384858.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-01T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384858",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384859.json:
```json
{
    "body": "looks good to me.",
    "created_at": "2019-04-01T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384859",
    "user": "https://github.com/dimpase"
}
```

looks good to me.



---

archive/issue_comments_384860.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-03T18:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27330#issuecomment-384860",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
