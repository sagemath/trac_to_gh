# Issue 15284: Deprecations: default LP variables will become real instead of nonnegative

Issue created by migration from https://trac.sagemath.org/ticket/15521

Original creator: ncohen

Original creation time: 2013-12-15 18:58:06

CC:  dimpase vbraun dcoudert hartke wdj john_perry benjaminfjones

Following the discussion on Sage-devel [1], default LP variables will become "real" instead of nonnegative as it is the case at the moment.

The aim is to have 4 types available through `new_variable()` : binary, integer, nonnegative, and real. Right now, nonnegative does not exist, and "real" represents nonnegative variables.

What this ticket does:

- A warning has to be displayed when `new_variable()` is called without arguments, as the default behaviour will change. Users are advised to add `nonnegative=True` instead.

- A warning has to be displayed when `new_variable(real=True)` is called, for it represents nonnegative variables at the moment and will represent real variables later. Users are advised to switch to `nonnegative=True` instead.

Nathann

[1] https://groups.google.com/d/msg/sage-devel/3vrPzUqFpM4/hKFp0RjV8poJ


---

Comment by ncohen created at 2013-12-16 16:49:11

Heeeeeeere it is ! Warnings are displayed for each behaviour that will change in one year, and then we'll have something that makes sense AND does not lead anybody into a wall `:-)`

Nathann


---

Comment by ncohen created at 2013-12-16 16:49:11

Changing status from new to needs_review.


---

Comment by git created at 2013-12-16 16:54:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by benjaminfjones created at 2014-01-21 05:43:53

Just having a look at this. All the cleanup is a nice addition along with the deprecation warning.

In the diff around `@``@` -577,6 +584,14 `@``@` cdef class MixedIntegerLinearProgram(SageObject):

There is a new test labeled "Default behavior" that I don't quite see the point of. Was your intent just to document the current default behavior and have this test change when the deprecation period is up?


---

Comment by ncohen created at 2014-01-21 08:02:17

Helloooooooo !!!

> Just having a look at this. All the cleanup is a nice addition along with the deprecation warning.

Yep, but it did not apply on the latest 6.1.beta6. I just updated it `:-)`

> In the diff around `@``@` -577,6 +584,14 `@``@` cdef class MixedIntegerLinearProgram(SageObject):
> 
> There is a new test labeled "Default behavior" that I don't quite see the point of. Was your intent just to document the current default behavior and have this test change when the deprecation period is up?

Hmmm... Yep, looks like this one is just there to check that the patch had his effect, a bit like how we add a doctest when we fix a bug. I know I added some doctests just to bring attention to the method when the default behaviour will be changed, but this one looks innocent `;-)`

Nathann


---

Comment by git created at 2014-01-21 08:08:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-01-21 08:10:29

By the way it would be cool you could review #15489 and possibly this  ticket too, for otherwise writing patches changes nothing to Sage's actual code `:-P`

Nathann


---

Comment by benjaminfjones created at 2014-01-23 19:09:59

I can review #15489. Looks like it depends on #15482 (which has failing merge and doctests?) in turn.

On this ticket, your latest changes look good to me. I'm waiting for my local copy to build and test. How does the patchbot get triggered these days? Your latest commits didn't seem to get tested..


---

Comment by benjaminfjones created at 2014-01-25 01:15:27

I get 5 doctest failures from knapsack.py that all look like:


```
Failed example:
    knapsack( [(1,2), (1.5,1), (0.5,3)], max=2)
Exception raised:
    Traceback (most recent call last):
      File "/projects/9ac5a8ca-7dbf-4b27-adea-4709b0fb7105/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 48
0, in _run
        self.execute(example, compiled, test.globs)
      File "/projects/9ac5a8ca-7dbf-4b27-adea-4709b0fb7105/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 83
9, in execute
        exec compiled in globs
      File "<doctest sage.numerical.knapsack[1]>", line 1, in <module>
        knapsack( [(Integer(1),Integer(2)), (RealNumber('1.5'),Integer(1)), (RealNumber('0.5'),Integer(3))], max=Integer(2))
      File "/projects/9ac5a8ca-7dbf-4b27-adea-4709b0fb7105/sage/local/lib/python2.7/site-packages/sage/numerical/knapsack.py", lin
e 633, in knapsack
        p = MixedIntegerLinearProgram(solve=solver, maximization=True)
      File "mip.pyx", line 247, in sage.numerical.mip.MixedIntegerLinearProgram.__init__ (sage/numerical/mip.c:1692)
    TypeError: __init__() got an unexpected keyword argument 'solve'
```



---

Comment by git created at 2014-01-28 19:48:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-01-28 19:48:47

Sorryyyyyy ! It is now fixed.

Nathann


---

Comment by benjaminfjones created at 2014-02-05 19:50:01

Changing status from needs_review to positive_review.


---

Comment by benjaminfjones created at 2014-02-05 19:50:01

Ok, back from hiatus. Your latest rebase and minor changes look good and tests are passing now. I'll give a positive review and have a look at those other tickets you mentioned.


---

Comment by ncohen created at 2014-02-06 11:00:23

Thaaaaaanks !! I just rebased #15482 which is a dependency of this ticket.

Nathann


---

Comment by vbraun created at 2014-03-05 09:40:42

Please use full names for the !Author/Reviewer fields next time


---

Comment by vbraun created at 2014-03-05 09:44:38

Conflict, please merge in latest beta


---

Comment by git created at 2014-03-05 09:48:14

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-03-05 09:48:14

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2014-03-05 15:58:46

I am getting an error while building the relevant docs:

```
OSError: [numerical] docstring of sage.numerical.mip.MixedIntegerLinearProgram.set_binary:27: WARNING: Literal block expected; none found.
```



---

Comment by ncohen created at 2014-03-05 16:13:04

it is the same that appeared in #15489. So it will not happen when #15489 is applied.

Nathann


---

Comment by dimpase created at 2014-03-05 16:22:57

Replying to [comment:20 ncohen]:
> it is the same that appeared in #15489. So it will not happen when #15489 is applied.

Huh? Are we back to the hg-like patch quilt? How come "#15489 is not applied" when I check this one out? 

EDIT: I don't see how to make this consistent without a manual rebase: if I "apply" #15489 by checking it out, this "application" will be reversed upon checking out this ticket, isn't it?


---

Comment by ncohen created at 2014-03-05 16:37:24

> Huh? Are we back to the hg-like patch quilt? How come "#15489 is not applied" when I check this one out? 

git does not manage dependencies based on branch names. This "branch" does not depend on branch "15489". The first commit of this branch depends on the last commit of branch 15489 when it was created, but since that time I fixed the problem by adding another commit at the end of branch 15489, which is totally unrelated to this branch.

Thus, when you apply this branch, only the commits that actually depend on it are applied. Not the commit that were added later on that branch. Then again, git does not do anything based on branch names. Commit is the only thing that it sees.

> EDIT: I don't see how to make this consistent without a manual rebase: if I "apply" #15489 by checking it out, this "application" will be reversed upon checking out this ticket, isn't it?

Indeed. If you want both, what you should do is :
1) checkout #15489
2) pull #15521

Pull is equivalent to "fetch + merge". So it will merge this branch atop of #15489. This way everything that is currently in #15489 will coexist with everything which is in #15521. This is what Volker does when he builds a release : he pulls patches one after the other starting from the previous release.

Note that there is a "clean" way out : I can checkout this branch, pull #15489 (which will merge with this branch all commits from #15489 which are not already part of it) then update this branch with it. It's just that my Sage is compiling at the moment and I can't do it right now, so if you are satisfied with this explanation... `:-P`

Nathann


---

Comment by dimpase created at 2014-03-05 17:56:25

Replying to [comment:22 ncohen]:

> > EDIT: I don't see how to make this consistent without a manual rebase: if I "apply" #15489 by checking it out, this "application" will be reversed upon checking out this ticket, isn't it?
> 
> Indeed. If you want both, what you should do is :
> 1) checkout #15489
> 2) pull #15521

this is what I get if I try this at branch 15489:


```

$ git merge 15521
Auto-merging src/sage/numerical/mip.pyx
Auto-merging src/sage/graphs/generic_graph.py
CONFLICT (content): Merge conflict in src/sage/graphs/generic_graph.py
Removing src/sage/combinat/sf/kschur.py
Removing build/pkgs/gap/patches/cflags.patch
Removing build/pkgs/cython/patches/gdbout.patch
Removing build/pkgs/cython/patches/build_dir.patch
Automatic merge failed; fix conflicts and then commit the result.

```

looks like an automatic clean merge won't fly...


---

Comment by git created at 2014-03-05 18:00:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-03-05 18:00:43

Done

Nathann


---

Comment by dimpase created at 2014-03-07 10:31:27

Looks good; tested with sage --dev scripts 

Just in case, note that somehow I was not able to make this to work using `git the hard way`, as I was getting bizarre docbuild errors, cf. my laments on sage-release regarding 6.2.beta3. (Perhaps it mattered that my system-wide git is older than the one packaged with Sage - this is one thing I didn't have time to check).


---

Comment by dimpase created at 2014-03-07 10:31:27

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-03-07 12:17:09

(but also probably because I slightly rewrote history once or twice, in order to change a commit message for instance)

Thanks for the review !

Nathann


---

Comment by dimpase created at 2014-03-07 13:27:53

Replying to [comment:27 ncohen]:
> (but also probably because I slightly rewrote history once or twice, in order to change a commit message for instance)

hopefully this won't cause problems when merging into the release.


---

Comment by ncohen created at 2014-03-07 13:30:41

Nono it does not. There  is nothing "wrong" with changing history. The only bad thing that happens is when you update some commits which have already been used by somebody else in another branch.  You end up with having two commits which are meant to do the same thing, one of them sligthly modified (a different commit message, for instance). That is a problem.

But you can rewrite history 10000 times on your own computer before pushing the branch, in the same way that we can rewrite history 10000 times on this ticket if we are confident that nobody used the commits before we changed them.

Nathann


---

Comment by vbraun created at 2014-03-13 02:38:42

Resolution: fixed


---

Comment by jdemeyer created at 2014-06-20 15:11:25

See #16504 for a follow-up.


---

Comment by jdemeyer created at 2015-11-04 16:32:56

Actually make the change: #19522
