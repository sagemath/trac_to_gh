# Issue 13027: Use FLINT to compute the partition function

Issue created by migration from https://trac.sagemath.org/ticket/13199

Original creator: fredrik.johansson

Original creation time: 2012-07-04 14:33:02

Assignee: sage-combinat

Before:


```
sage: %timeit number_of_partitions(1)   
625 loops, best of 3: 2.09 µs per loop
sage: %timeit number_of_partitions(10^3)
625 loops, best of 3: 197 µs per loop
sage: %timeit number_of_partitions(10^6)
25 loops, best of 3: 32.8 ms per loop
sage: %time number_of_partitions(10^9); 
CPU times: user 37.92 s, sys: 0.00 s, total: 37.92 s
Wall time: 37.93 s
```


After:


```
sage: %timeit number_of_partitions(1)
625 loops, best of 3: 1.94 µs per loop
sage: %timeit number_of_partitions(10^3)
625 loops, best of 3: 51.4 µs per loop
sage: %timeit number_of_partitions(10^6)
125 loops, best of 3: 2.66 ms per loop
sage: %time number_of_partitions(10^9); 
CPU times: user 0.47 s, sys: 0.00 s, total: 0.47 s
Wall time: 0.48 s
```


TODO: should add a 64-bit only test to check that evaluation works with n >= 2^32.


---

Attachment


---

Comment by chapoton created at 2012-07-13 11:55:08

Changing status from new to needs_review.


---

Comment by andrew.mathas created at 2012-10-22 03:03:40

I am happy to review this, although it is not clear to me what the status of #12173 is and until this patch is merged it seems rather cumbersome to load the current patch on top of #12173 in order play around with this patch and check to see that it actually works.

Assuming that it is OK, I would like to see some more explicit tests inside the new number_of_partitions to show that it is working. I'd suggest simply reusing the ones that are in sage.combinat.partition.number_of_partitions. That is, adding the following tests to the doc-string for your number_of_partitions:

```
        sage: from sage.combinat.partitions import number_of_partitions
        sage: number_of_partitions(3)
        3
        sage: number_of_partitions(10)
        42
        sage: number_of_partitions(40)
        37338
        sage: number_of_partitions(100)
        190569292
        sage: number_of_partitions(100000)
        27493510569775696512677516320986352688173429315980054758203125984302147328114964173055050741660736621590157844774296248940493063070200461792764493033510116079342457190155718943509725312466108452006369558934464248716828789832182345009262853831404597021307130674510624419227311238999702284408609370935531629697851569569892196108480158600569421098519

    TESTS::

        sage: n = 500 + randint(0,500)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1500 + randint(0,1500)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 1000000 + randint(0,1000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0
        True
        sage: n = 100000000 + randint(0,100000000)
        sage: number_of_partitions( n - (n % 385) + 369) % 385 == 0  # long time (4s on sage.math, 2011)
        True
```



---

Comment by andrew.mathas created at 2012-11-24 03:59:47

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2013-05-24 17:27:19

I removed the dependency to #12173, since this has been closed in 5.10.beta3, and since a dependency on spkg makes the bot unhappy.

for the bot:

apply flint_partition_function.patch


---

Comment by chapoton created at 2013-05-24 17:49:55

this needs to be rebased on 5.10beta4


---

Attachment

for the bot:

apply trac_13199_flint_partition_function_v2.patch

I have made a rebased patch, passing all tests.


---

Comment by chapoton created at 2013-06-09 18:54:38

Changing status from needs_work to needs_review.


---

Comment by andrew.mathas created at 2013-06-09 22:22:14

Hi. As I said on the ticket above, can you please add some more tests to the new partition function.


---

Comment by chapoton created at 2013-06-10 11:35:36

ok, I will add the tests. But there is an annoying doctest failure concerning cached functions, see bot report.


---

Comment by tscrim created at 2013-06-10 16:51:26

Here's a review patch which should fix the problem, which was the Bober's implementation was cached (since it was the default). I changed this to the FLINT.

```
sage -t ../misc/cachefunc.pyx
    [593 tests, 78.50 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 79.6 seconds
    cpu time: 8.1 seconds
    cumulative wall time: 78.5 seconds
```

I also added the additional tests Andrew wanted and fixed the docstrings.

For patchbot:

Apply: trac_13199_flint_partition_function_v2.patch, trac_13199-flint_partition-review-ts.patch


---

Comment by chapoton created at 2013-06-11 07:58:12

Looks good to me, but the bot complains about the new module. Is there a way to avoid that, or should we just forget this warning  ?


---

Comment by tscrim created at 2013-06-11 08:06:05

The new module can't really be avoided, plus it doesn't (significantly) add to the startup time, so I ignore these.


---

Comment by tscrim created at 2013-06-11 17:29:35

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-06-11 17:29:35

I'm going to set this to positive review now since I don't think either of you (Andrew, Frederic) have any other objections. Feel free to set this to needs work if I'm wrong.


---

Attachment


---

Comment by tscrim created at 2013-06-12 06:31:42

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2013-06-12 06:31:42

I've uploaded a new version of my review patch which removes the unneeded `include_dirs` from `module_list.py`.


---

Comment by tscrim created at 2013-06-12 06:32:21

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-06-12 06:32:21

Because of the type of change, this needs another (quick) review.


---

Comment by chapoton created at 2013-06-12 09:10:27

ok, looks good to me.


---

Comment by chapoton created at 2013-06-12 09:10:27

Changing status from needs_review to positive_review.


---

Comment by andrew.mathas created at 2013-06-14 06:50:36

Replying to [comment:17 chapoton]:

> ok, looks good to me.

Thanks Travis. I'm happy too.


---

Comment by jdemeyer created at 2013-06-15 12:21:15

Resolution: fixed
