# Issue 21359: Matrix charpoly(algorithm='flint') destroys the polynomial ring generator

Issue created by migration from https://trac.sagemath.org/ticket/21596

Original creator: bober

Original creation time: 2016-09-26 00:01:29

One line fix coming shortly, I hope.


---

Comment by bober created at 2016-09-26 02:56:27

I'm hoping to learn how to be a better "sage citizen" who can at least easily contribute small patches, but in case that doesn't happen in the next few days (or months, or years), I ought to actually record the fix:

in `src/sage/matrix/matrix_integer_dense.pyx`

the lines


```
        if algorithm == 'flint' or (algorithm == 'linbox' and not USE_LINBOX_POLY):
            g = PolynomialRing(ZZ,names = var).gen()
            sig_on()
            fmpz_mat_charpoly(g.__poly,self._matrix)
            sig_off()

```


should be something like


```
        if algorithm == 'flint' or (algorithm == 'linbox' and not USE_LINBOX_POLY):
            g = (<Polynomial_integer_dense_flint>(PolynomialRing(ZZ,names = var).gen()))._new()
            sig_on()
            fmpz_mat_charpoly(g.__poly,self._matrix)
            sig_off()
```


(There's also a misleading line in the docstring above which says that linbox isn't used for this on 64-bit systems.)


---

Comment by bober created at 2016-09-26 14:20:14

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2016-10-11 15:21:29

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2016-10-11 15:21:29

Looks good to me; thanks for the fix!


---

Comment by vbraun created at 2016-10-21 07:04:00

Resolution: fixed
