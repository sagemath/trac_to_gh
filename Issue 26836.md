# Issue 26836: py3: fix artificial exception test in sphinxbuild.py

Issue created by migration from https://trac.sagemath.org/ticket/27073

Original creator: jdemeyer

Original creation time: 2019-01-17 22:13:36

CC:  chapoton

This test is raising an exception and then it tries to display the traceback, long after the exception has been handled by the doctest framework. In Python 3 (and also after #24986), exceptions do not stay alive forever.


```
sage -t src/sage_setup/docbuild/sphinxbuild.py
**********************************************************************
File "src/sage_setup/docbuild/sphinxbuild.py", line 212, in sage_setup.docbuild.sphinxbuild.SageSphinxLogger._log_line
Failed example:
    for line in traceback.format_exc().split('\n'):
        logger._log_line(line)
Expected:
    [#25160   ] Traceback (most recent call last):
    [#25160   ]   File ...
    [#25160   ]     self.compile_and_execute(example, compiler, test.globs)
    [#25160   ]   File ...
    [#25160   ]     exec(compiled, globs)
    [#25160   ]   File ...
    [#25160   ]     raise Exception("artificial exception")
    [#25160   ] Exception: artificial exception
Got:
    [#25160   ] NoneType: None
**********************************************************************
```



---

Comment by embray created at 2019-01-18 12:42:54

That makes sense--I agree the test is not good in the first place.  Though I don't exactly understand why this changed.  Just because of the `sys.exc_clear()`?

It makes sense though--the Python 2 behavior of keeping exception objects and tracebacks around long past their applicability was not great to begin with.


---

Comment by jdemeyer created at 2019-01-18 13:02:02

Replying to [comment:2 embray]:
> Just because of the `sys.exc_clear()`?

Indeed. Python 3 effectively does `sys.exc_clear()` when leaving the `try`/`except` block.


---

Comment by git created at 2019-01-18 13:26:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2019-01-18 13:28:28

Changing status from new to needs_review.


---

Comment by embray created at 2019-01-18 14:06:30

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-01-18 14:06:30

Makes sense, thank you.


---

Comment by vbraun created at 2019-01-26 15:53:55

Resolution: fixed
