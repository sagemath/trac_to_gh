# Issue 16446: fast gray code for integer vectors

archive/issues_016446.json:
```json
{
    "body": "CC:  ncohen\n\nFor even more efficient generation of integer vectors... use Gray codes.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16683\n\n",
    "created_at": "2014-07-19T11:34:29Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "fast gray code for integer vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16446",
    "user": "vdelecroix"
}
```
CC:  ncohen

For even more efficient generation of integer vectors... use Gray codes.

Issue created by migration from https://trac.sagemath.org/ticket/16683





---

archive/issue_comments_216215.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-07-19T11:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216215",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_216216.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-19T11:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216216",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216217.json:
```json
{
    "body": "Hellooooo !!\n\nSorry for being unpleasant, but I've got two design questions `:-P`\n\n1) I guess that you wrote all this as a class because you need a malloc and that you can't call \"free\" whenever you need in an iterator function. This being said, do you think that using a `int *` is much better than a `cdef list` in this case ?\n\n2) Also, I wonder about the need of a gray iterator in the case of a cartesian product. If you do it naively (let's say like a addition in base 50 if you compute the cartesian product of k sets of size 50) then in 49/50 of the cases you will only do a +1 on the last element, and nothing else. And in 1/50*49/50 you will only need to change 2 elements. And in (1/50)^2(49/50) you will need to change 3.. I mean: the normal algorithm does not seem that far from the performances of a gray iterator. So you probably would not waste much if you do the normal operations of addition, and only update the coordinates of the current vector which changed. Most of the time, that will be very very few.\n\nNathann",
    "created_at": "2014-07-19T11:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216217",
    "user": "ncohen"
}
```

Hellooooo !!

Sorry for being unpleasant, but I've got two design questions `:-P`

1) I guess that you wrote all this as a class because you need a malloc and that you can't call "free" whenever you need in an iterator function. This being said, do you think that using a `int *` is much better than a `cdef list` in this case ?

2) Also, I wonder about the need of a gray iterator in the case of a cartesian product. If you do it naively (let's say like a addition in base 50 if you compute the cartesian product of k sets of size 50) then in 49/50 of the cases you will only do a +1 on the last element, and nothing else. And in 1/50*49/50 you will only need to change 2 elements. And in (1/50)^2(49/50) you will need to change 3.. I mean: the normal algorithm does not seem that far from the performances of a gray iterator. So you probably would not waste much if you do the normal operations of addition, and only update the coordinates of the current vector which changed. Most of the time, that will be very very few.

Nathann



---

archive/issue_comments_216218.json:
```json
{
    "body": "Hi Nathan,\n\nThanks for having a look!\n\nFor 1), what do you mean? There are plenty of `int *`. Actually I do not care at this stuff as a Cython class. With enough motivation I would write a pure C file. In concrete situation I have in mind, this will mostly be call through `set_next_switch` which gives me a pair of integers `(pos,incr)`.\n\nFor 2), I guess that the answer is no. The objective is **not** to iterate naively over integer vectors but to use it where the datastructure is complicated or huge and you want to minimize the number of changes (using the lexicographic enumeration would be a nightmare as you need to care about which entries did change). A concrete examples is given by echelon matrices:\n- you enumerate pivots (shoud be a gray code to)\n- for choice of pivots you iterate over all possibilities for certain entries. For that step, changing one entry at a time instead of all of them is definitely a gain!\n\nVincent",
    "created_at": "2014-07-19T12:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216218",
    "user": "vdelecroix"
}
```

Hi Nathan,

Thanks for having a look!

For 1), what do you mean? There are plenty of `int *`. Actually I do not care at this stuff as a Cython class. With enough motivation I would write a pure C file. In concrete situation I have in mind, this will mostly be call through `set_next_switch` which gives me a pair of integers `(pos,incr)`.

For 2), I guess that the answer is no. The objective is **not** to iterate naively over integer vectors but to use it where the datastructure is complicated or huge and you want to minimize the number of changes (using the lexicographic enumeration would be a nightmare as you need to care about which entries did change). A concrete examples is given by echelon matrices:
- you enumerate pivots (shoud be a gray code to)
- for choice of pivots you iterate over all possibilities for certain entries. For that step, changing one entry at a time instead of all of them is definitely a gain!

Vincent



---

archive/issue_comments_216219.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-07-19T14:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216219",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_216220.json:
```json
{
    "body": "I guess you are right... this does not need cythonisation.",
    "created_at": "2014-07-19T14:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216220",
    "user": "vdelecroix"
}
```

I guess you are right... this does not need cythonisation.



---

archive/issue_comments_216221.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-07-19T14:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216221",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_216222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-07-19T14:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216222",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_216223.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-07-19T14:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216223",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_216224.json:
```json
{
    "body": "If I make no mistake : \n\nWith a gray code that makes you change two coordinates for each vector, you need to do `2n^k` to enumerate the elements of `n^k`\n\nIf you just have an integer written on `k` digits and you want to go from 0000... to k-1,k-1,...,k-1 by adding 1 one it, how many changes occur ?\n\nThe leftmost coordinate is changed `n` times. The second is changed `n^2` times. The last is changed `n^k` times. What is the total ?\n\n`k+k<sup>2+...+k</sup>n=(1-k^n+1)/(1-k)-1`\n\nResult :\n\n\n```\nsage: 2*n^k # number of changes with a gray code\n1620000\nsage: (1-n^(k+1))/(1-n)-1 # number of changes with addition\n837930\n```\n\n\nThus if you really care about those changes, may you should build a function which outputs the changes that must be performed at each run, based on stupid addition ? Or did I make a mistake somewhere ?\n\nNathann",
    "created_at": "2014-07-19T14:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216224",
    "user": "ncohen"
}
```

If I make no mistake : 

With a gray code that makes you change two coordinates for each vector, you need to do `2n^k` to enumerate the elements of `n^k`

If you just have an integer written on `k` digits and you want to go from 0000... to k-1,k-1,...,k-1 by adding 1 one it, how many changes occur ?

The leftmost coordinate is changed `n` times. The second is changed `n^2` times. The last is changed `n^k` times. What is the total ?

`k+k<sup>2+...+k</sup>n=(1-k^n+1)/(1-k)-1`

Result :


```
sage: 2*n^k # number of changes with a gray code
1620000
sage: (1-n^(k+1))/(1-n)-1 # number of changes with addition
837930
```


Thus if you really care about those changes, may you should build a function which outputs the changes that must be performed at each run, based on stupid addition ? Or did I make a mistake somewhere ?

Nathann



---

archive/issue_comments_216225.json:
```json
{
    "body": "Replying to [comment:8 ncohen]:\n> If I make no mistake : \n\nYou did.\n \n> With a gray code that makes you change two coordinates for each vector, you need to do `2n^k` to enumerate the elements of `n^k`\n\nIt is only one change at a time. So it is `n^k`.\n\nResult : \n\n```\nsage: n^k # number of changes with a gray code\n810000\nsage: (1-n^(k+1))/(1-n)-1 # number of changes with addition\n837930\n```\n\n\n> Thus if you really care about those changes, may you should build a function which outputs the changes that must be performed at each run, based on stupid addition ? Or did I make a mistake somewhere ?\n\nThe point is not really the gain in the number of changes but rather the simplicity with which you can adapt more complicated stuff. If you have to iterate through the number of changes you need a for loop. With a gray code, you need nothing, just do your change!\n\nVincent",
    "created_at": "2014-07-19T15:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216225",
    "user": "vdelecroix"
}
```

Replying to [comment:8 ncohen]:
> If I make no mistake : 

You did.
 
> With a gray code that makes you change two coordinates for each vector, you need to do `2n^k` to enumerate the elements of `n^k`

It is only one change at a time. So it is `n^k`.

Result : 

```
sage: n^k # number of changes with a gray code
810000
sage: (1-n^(k+1))/(1-n)-1 # number of changes with addition
837930
```


> Thus if you really care about those changes, may you should build a function which outputs the changes that must be performed at each run, based on stupid addition ? Or did I make a mistake somewhere ?

The point is not really the gain in the number of changes but rather the simplicity with which you can adapt more complicated stuff. If you have to iterate through the number of changes you need a for loop. With a gray code, you need nothing, just do your change!

Vincent



---

archive/issue_comments_216226.json:
```json
{
    "body": "Yo !\n\n> You did.\n\nOkay, that's fair `:-D`\n\nNathann",
    "created_at": "2014-07-19T15:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216226",
    "user": "ncohen"
}
```

Yo !

> You did.

Okay, that's fair `:-D`

Nathann



---

archive/issue_comments_216227.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-21T07:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216227",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216228.json:
```json
{
    "body": "Changes as we discussed:\n- simplify the name of functions\n- make the doc clearer\n\nAnd bonus:\n- combinations work with n=infinity\n\nVincent",
    "created_at": "2014-07-21T07:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216228",
    "user": "vdelecroix"
}
```

Changes as we discussed:
- simplify the name of functions
- make the doc clearer

And bonus:
- combinations work with n=infinity

Vincent



---

archive/issue_comments_216229.json:
```json
{
    "body": "Hellooooooooooooooooooo !!\n\nIf the commit at public/16683 is okay for you, you can set this ticket to `positive_review` !\n\nNathann",
    "created_at": "2014-07-21T08:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216229",
    "user": "ncohen"
}
```

Hellooooooooooooooooooo !!

If the commit at public/16683 is okay for you, you can set this ticket to `positive_review` !

Nathann



---

archive/issue_comments_216230.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-21T10:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216230",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_216231.json:
```json
{
    "body": "Thanks. Great!\n\nVincent\n----\nNew commits:",
    "created_at": "2014-07-21T10:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216231",
    "user": "vdelecroix"
}
```

Thanks. Great!

Vincent
----
New commits:



---

archive/issue_comments_216232.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-22T16:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16446",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16446#issuecomment-216232",
    "user": "vbraun"
}
```

Resolution: fixed
