# Issue 28119: Enhanced new build_many to use on all platforms

Issue created by migration from https://trac.sagemath.org/ticket/28356

Original creator: embray

Original creation time: 2019-08-15 12:24:43

CC:  arojas jdemeyer fbissey dimpase saraedum

Keywords: docbuild parallel pari

In #27490 I hacked together a replacement for the `sage_setup.docbuild.build_many` function, which implements (blocking) parallel map() of sorts, which solved some problems with using `multiprocessing.Pool.map` that stems from its use of threads to fork new processes.

That solved a problem that was specific to older versions of Cygwin.  However, there is a similar problem, which affects all platforms, with PARI built with multi-threading support: #26608.

Although the PARI problem begs a more complete solution, at least for the docbuild we can get around it by using the `build_many` from #27490.

This ticket makes some fixes and enhancements to `build_many`, so that it can also return a result from the function it runs.  For the docbuild this feature is not strictly needed, except for the fact that it can also be used (as in `Pool.map`) to raise any exception that occurs in one of the worker processes.  Thus, it's closer in functionality, at least for the purposes of the docbuild, to `Pool.map`.


---

Comment by embray created at 2019-08-15 12:34:35

Changing status from new to needs_review.


---

Comment by slelievre created at 2019-08-25 21:39:17

Changing status from needs_review to needs_work.


---

Comment by slelievre created at 2019-08-25 21:39:17

Branch does not seem to merge.


---

Comment by embray created at 2019-08-26 14:56:13

Well it used to until a day ago...


---

Comment by dimpase created at 2019-08-28 22:57:55

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2019-08-28 22:57:55

rebased branch
----
New commits:


---

Comment by embray created at 2019-08-29 09:47:39

Anyone want to go ahead and try using this?


---

Comment by arojas created at 2019-08-29 10:33:28

Built docs on Arch against system packages including threaded pari, can confirm it no longer segfaults.


---

Comment by dimpase created at 2019-08-30 19:58:30

looks good to me.


---

Comment by dimpase created at 2019-08-30 19:58:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-09-05 21:33:09

Resolution: fixed
