# Issue 26043: py3: more trivial fixes to sage.rings.polynomial.polydict

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-09-14 10:16:32




---

Comment by embray created at 2018-09-14 10:16:41

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-09-15 05:30:24

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-09-15 05:30:24

LGTM.


---

Comment by vbraun created at 2018-09-15 22:41:32


```
File "src/sage/rings/polynomial/polydict.pyx", line 982, in sage.rings.polynomial.polydict.ETuple.__init__
Failed example:
    ETuple(iter([2, 3, 4]))
Expected:
    Traceback (most recent call last):
    ...
    TypeError: Error in ETuple((), <list... object at ...>, None)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.polydict.ETuple.__init__[3]>", line 1, in <module>
        ETuple(iter([Integer(2), Integer(3), Integer(4)]))
      File "sage/rings/polynomial/polydict.pyx", line 1007, in sage.rings.polynomial.polydict.ETuple.__init__ (build/cythonized/sage/rings/polynomial/polydict.c:13297)
        self._length = len(data)
    TypeError: object of type 'listiterator' has no len()
```



---

Comment by vbraun created at 2018-09-15 22:41:32

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-09-17 11:45:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-09-17 11:47:15

It seems Cython on Python 2 has some strange behaviors if you put `isinstance(..., range)`.  So I'm just going to drop that change until we have a better, consistent way to accept arbitrary sequence types in function arguments.


---

Comment by embray created at 2018-09-17 11:47:22

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2018-09-17 12:32:50

Replying to [comment:5 embray]:
> It seems Cython on Python 2 has some strange behaviors if you put `isinstance(..., range)`.  So I'm just going to drop that change until we have a better, consistent way to accept arbitrary sequence types in function arguments.

I would guess that comes from the fact that `range` on Cython is treated as special by the compiler as it can both be treated as `xrange` (e.g., in a `for` loop) and as a list:

```
sage: %%cython
....: def test(n):
....:     return range(n)
sage: test(5)
[0, 1, 2, 3, 4]
```



---

Comment by embray created at 2018-09-17 12:39:08

Well, yes, but I'm not sure how it translates a statement like `isinstance(..., range)` and I didn't bother to look, but it seems to get up to some funny business for sure.


---

Comment by vbraun created at 2018-09-19 07:52:39

Resolution: fixed
