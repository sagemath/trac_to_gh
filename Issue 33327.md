# Issue 33327: add one test in TestSuite of Coxeter groups

Issue created by migration from https://trac.sagemath.org/ticket/33564

Original creator: chapoton

Original creation time: 2022-03-25 20:22:45

CC:  tscrim

coming from affine permutations


---

Comment by chapoton created at 2022-03-25 20:23:18

New commits:


---

Comment by chapoton created at 2022-03-25 20:23:18

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-03-26 06:47:08

Hmm, fails for Weyl groups, it seems. Why ?

* maybe one should test that simple reflections are involutions ?

* and also commutation between reflection not linked in the Coxeter diagram ?


---

Comment by git created at 2022-03-26 07:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-26 07:19:15

so we have a problem with Weyl groups created from matrices:

```
sage: cm = CartanMatrix([[2,-5,0],[-2,2,-1],[0,-1,2]])
sage: W = WeylGroup(cm)
sage: TestSuite(W).run()
Failure in _test_coxeter_relations:
Traceback (most recent call last):
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
    test_method(tester=tester)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/coxeter_groups.py", line 1301, in _test_coxeter_relations
    cox_mat = self.coxeter_matrix()
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/weyl_groups.py", line 96, in coxeter_matrix
    return self.cartan_type().coxeter_matrix()
  File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13026)
    self.cache = f(self._instance)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/cartan_type.py", line 1177, in coxeter_matrix
    return CoxeterMatrix(self)
  File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1848)
    return cls.classcall(cls, *args, **kwds)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 194, in __classcall_private__
    return cls._from_coxetertype(coxeter_type)
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_matrix.py", line 390, in _from_coxetertype
    for (i, j, l) in coxeter_type.coxeter_graph().edge_iterator():
  File "/home/chapoton/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/combinat/root_system/coxeter_type.py", line 502, in coxeter_graph
    return self._cartan_type.coxeter_diagram()
TypeError: 'NotImplementedType' object is not callable
------------------------------------------------------------
The following tests failed: _test_coxeter_relations
```



---

Comment by chapoton created at 2022-03-26 07:22:48

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2022-03-26 17:52:47

not clear to me if "Weyl groups" associated with arbitrary Cartan matrices are always Coxeter groups..


---

Comment by tscrim created at 2022-03-27 05:14:40

Every Weyl group is a Coxeter group, but there are a number of restrictions. In particular, it must be crystallographic and when c<sub>ij</sub> c<sub>ji</sub> > 3, then the corresponding Weyl group has an infinite edge in the Coxeter diagram. Here, the issue seems to be just a lack of complete functionality: arbitrary Cartan matrices do not know how to construct the corresponding Coxeter matrix. The code is essentially already there, but just not at the place.

I will try to fix this today.


---

Comment by tscrim created at 2022-03-29 05:01:49

Here is a fix. I also fixed a bug with a mismatch between the Cartan matrix and Cartan type of a reducible type. This now passes the tests in categories, groups, and combinat for me.
----
New commits:


---

Comment by tscrim created at 2022-03-29 05:01:49

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-03-29 06:45:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-29 06:46:43

Thanks. I fixed a pyflakes warning. Now, this should be good to go.

If you agree, you can set to positive.


---

Comment by tscrim created at 2022-03-29 06:47:44

Thank you.


---

Comment by tscrim created at 2022-03-29 06:47:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-04-02 10:53:01

Resolution: fixed
