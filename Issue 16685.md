# Issue 16685: find_brouwer_van_rees_with_one_truncated_column

archive/issues_016685.json:
```json
{
    "body": "CC:  @videlec\n\nHere is what we have been waiting for. Removes a lot of '-', but in parts of the table that we do not see `:-P`\n\nIssue created by migration from https://trac.sagemath.org/ticket/16922\n\n",
    "created_at": "2014-09-02T16:33:51Z",
    "labels": [
        "combinatorial designs",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "find_brouwer_van_rees_with_one_truncated_column",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16685",
    "user": "@nathanncohen"
}
```
CC:  @videlec

Here is what we have been waiting for. Removes a lot of '-', but in parts of the table that we do not see `:-P`

Issue created by migration from https://trac.sagemath.org/ticket/16922





---

archive/issue_comments_220301.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-02T16:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220301",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_220302.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-09-02T16:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220302",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_220303.json:
```json
{
    "body": "Hi Nathann,\n\nI got a lot of segmentation error while running the tests with this branch! Do you know what happen?\n\nVincent",
    "created_at": "2014-10-26T12:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220303",
    "user": "@videlec"
}
```

Hi Nathann,

I got a lot of segmentation error while running the tests with this branch! Do you know what happen?

Vincent



---

archive/issue_comments_220304.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-26T12:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220304",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220305.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-26T12:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220305",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220306.json:
```json
{
    "body": "Sorry about that. Don't know where the segfaults came from, but when I solved the bug about the \"more than 4 values needed to unpack\" there was none left.\n\nAlso, I rewrote history to move this last commit above its dependencies (in which commits had been added in the meantime).\n\nThis should be better now.\n\nBy the way: the current implementation may look a bit \"hacky\". The thing is that it is 'a bit too early' to implement this construction, because at the moment there are no 'nice' functions to query the database of incomplete orthogonal arrays, and there is none yet because caching incomplete orthogonal arrays is much harder than caching orthogonal arrays (more parameters, mainly !). In the future we may even have find functions for incomplete orthogonal arrays and stuff.\n\nWell, I have to write that and because it is not exactly straightforward to get a good design (and because it requires a lot of 'administrative' code) I implemented that first.\n\nStill, it works and it is not so bad.\n\nWell, just know that I am not intending to leave that code in the current state. Though I tried to not make it too awful either, and of course the review is there to fix anything you will not like.\n\nBranch updated.\n\nNathann",
    "created_at": "2014-10-26T12:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220306",
    "user": "@nathanncohen"
}
```

Sorry about that. Don't know where the segfaults came from, but when I solved the bug about the "more than 4 values needed to unpack" there was none left.

Also, I rewrote history to move this last commit above its dependencies (in which commits had been added in the meantime).

This should be better now.

By the way: the current implementation may look a bit "hacky". The thing is that it is 'a bit too early' to implement this construction, because at the moment there are no 'nice' functions to query the database of incomplete orthogonal arrays, and there is none yet because caching incomplete orthogonal arrays is much harder than caching orthogonal arrays (more parameters, mainly !). In the future we may even have find functions for incomplete orthogonal arrays and stuff.

Well, I have to write that and because it is not exactly straightforward to get a good design (and because it requires a lot of 'administrative' code) I implemented that first.

Still, it works and it is not so bad.

Well, just know that I am not intending to leave that code in the current state. Though I tried to not make it too awful either, and of course the review is there to fix anything you will not like.

Branch updated.

Nathann



---

archive/issue_comments_220307.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-26T12:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220307",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-26T15:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220308",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220309.json:
```json
{
    "body": "Hi Nathann,\n\nI changed the complexity of `multiple` by one order. And we can win more by cutting some of the branches (if I got the value `v` in `m` steps then I can not be bigger than `v + (k-m) max_value` at the end).\n\nHave a look and tell me if it is worth it to add this cut.\n\nVincent",
    "created_at": "2014-10-26T15:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220309",
    "user": "@videlec"
}
```

Hi Nathann,

I changed the complexity of `multiple` by one order. And we can win more by cutting some of the branches (if I got the value `v` in `m` steps then I can not be bigger than `v + (k-m) max_value` at the end).

Have a look and tell me if it is worth it to add this cut.

Vincent



---

archive/issue_comments_220310.json:
```json
{
    "body": "> I changed the complexity of `multiple` by one order. \n\nTrue, True. Well done `O_o`\n\n> And we can win more by cutting some of the branches (if I got the value `v` in `m` steps then I can not be bigger than `v + (k-m) max_value` at the end).\n\nWell, technically can't we do it with `log(k)` iterations instead of `k` ?\n\nI mean, if you call `S^n={x_1+...+x_n: x_i \\in S}` then you can use the log algorithm to compute the power of a matrix, can't you ? And you can do even faster is you initialize `D` with `D = {r*x:tuple([x]*r) for x in S for r in tuple(range(cutoff/x+1))}`.\n\nKeep in mind that this function will change, somehow. I mean... If we want to be able to do the same for the Brouwer-van Rees decomposition with 2 truncated columns, the problem is very different: in each column you can have any combinations of 'allowed value', but you cannot have a multiplier x in column 1 and a multiplier y in column 2 unless you have an `OA(k,m+x+y)-OA(k,x)-OA(k,y)`.\n\nI still don't know how to write that nicely `T_T`\n\nNathann",
    "created_at": "2014-10-26T15:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220310",
    "user": "@nathanncohen"
}
```

> I changed the complexity of `multiple` by one order. 

True, True. Well done `O_o`

> And we can win more by cutting some of the branches (if I got the value `v` in `m` steps then I can not be bigger than `v + (k-m) max_value` at the end).

Well, technically can't we do it with `log(k)` iterations instead of `k` ?

I mean, if you call `S^n={x_1+...+x_n: x_i \in S}` then you can use the log algorithm to compute the power of a matrix, can't you ? And you can do even faster is you initialize `D` with `D = {r*x:tuple([x]*r) for x in S for r in tuple(range(cutoff/x+1))}`.

Keep in mind that this function will change, somehow. I mean... If we want to be able to do the same for the Brouwer-van Rees decomposition with 2 truncated columns, the problem is very different: in each column you can have any combinations of 'allowed value', but you cannot have a multiplier x in column 1 and a multiplier y in column 2 unless you have an `OA(k,m+x+y)-OA(k,x)-OA(k,y)`.

I still don't know how to write that nicely `T_T`

Nathann



---

archive/issue_comments_220311.json:
```json
{
    "body": "Yo !\n\n> Have a look and tell me if it is worth it to add this cut.\n\nIt is up to you. I am not sure that it is necessary at the moment: I hope that this will all be rewritten in not so long to handle two columns.\n\nNathann",
    "created_at": "2014-10-26T15:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220311",
    "user": "@nathanncohen"
}
```

Yo !

> Have a look and tell me if it is worth it to add this cut.

It is up to you. I am not sure that it is necessary at the moment: I hope that this will all be rewritten in not so long to handle two columns.

Nathann



---

archive/issue_comments_220312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-26T16:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220312",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220313.json:
```json
{
    "body": "All right. Done.\n\nI find it much clearer. Perhaps less nicer to make it works for two columns...\n\nVincent",
    "created_at": "2014-10-26T16:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220313",
    "user": "@videlec"
}
```

All right. Done.

I find it much clearer. Perhaps less nicer to make it works for two columns...

Vincent



---

archive/issue_comments_220314.json:
```json
{
    "body": "What is the point of making it decrease toward zero ? `O_o`\n\nTo have more meaningful comments like\n`if (vv > 0 and   # The new integer i is too big` ?\n\nHonestly I do not care, this will be rewritten soon anyway. But why would you do something like that ?\n\nYou even do `for j in range(k-1,-1,-1)` which is totally equivalent to `for j in range(k)` given that you do not use j. Only to make it more complicated ?...\n\nNathann",
    "created_at": "2014-10-26T22:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220314",
    "user": "@nathanncohen"
}
```

What is the point of making it decrease toward zero ? `O_o`

To have more meaningful comments like
`if (vv > 0 and   # The new integer i is too big` ?

Honestly I do not care, this will be rewritten soon anyway. But why would you do something like that ?

You even do `for j in range(k-1,-1,-1)` which is totally equivalent to `for j in range(k)` given that you do not use j. Only to make it more complicated ?...

Nathann



---

archive/issue_comments_220315.json:
```json
{
    "body": "Replying to [comment:12 ncohen]:\n> What is the point of making it decrease toward zero ? `O_o`\n> \n> To have more meaningful comments like\n> `if (vv > 0 and   # The new integer i is too big` ?\n> \n> Honestly I do not care, this will be rewritten soon anyway. But why would you do something like that ?\n> \n> You even do `for j in range(k-1,-1,-1)` which is totally equivalent to `for j in range(k)` given that you do not use j. Only to make it more complicated ?...\n\nHum. `j` **is** useful as it is the remaining number of steps and allow to cut branches when the maximum number of steps allowed (i.e. `k_max`) is relatively small.\n\n```\n+ if (vv > 0 and            # The new integer i is too big\n+     vv <= j*max_value and # The new integer i is too small\n+     vv not in D and       # We had it in D already\n+     vv not in new_D):     # We had it in new_D already\n```\n\n\nVincent",
    "created_at": "2014-10-27T11:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220315",
    "user": "@videlec"
}
```

Replying to [comment:12 ncohen]:
> What is the point of making it decrease toward zero ? `O_o`
> 
> To have more meaningful comments like
> `if (vv > 0 and   # The new integer i is too big` ?
> 
> Honestly I do not care, this will be rewritten soon anyway. But why would you do something like that ?
> 
> You even do `for j in range(k-1,-1,-1)` which is totally equivalent to `for j in range(k)` given that you do not use j. Only to make it more complicated ?...

Hum. `j` **is** useful as it is the remaining number of steps and allow to cut branches when the maximum number of steps allowed (i.e. `k_max`) is relatively small.

```
+ if (vv > 0 and            # The new integer i is too big
+     vv <= j*max_value and # The new integer i is too small
+     vv not in D and       # We had it in D already
+     vv not in new_D):     # We had it in new_D already
```


Vincent



---

archive/issue_comments_220316.json:
```json
{
    "body": "This code is awful.\n\nAnyway, I will rewrite it soon.\n\nNathann",
    "created_at": "2014-10-27T12:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220316",
    "user": "@nathanncohen"
}
```

This code is awful.

Anyway, I will rewrite it soon.

Nathann



---

archive/issue_comments_220317.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-27T13:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220317",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220318.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-29T10:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16685#issuecomment-220318",
    "user": "@vbraun"
}
```

Resolution: fixed
