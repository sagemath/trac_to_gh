# Issue 28647: spkg-configure for R

Issue created by migration from https://trac.sagemath.org/ticket/28884

Original creator: dimpase

Original creation time: 2019-12-15 00:45:05

CC:  tmonteil fbissey isuruf charpent embray

a minimum working on standard distros setup.


---

Comment by dimpase created at 2019-12-15 00:46:02

TODO: check that versions of R and libR match


---

Comment by dimpase created at 2019-12-15 00:52:17

Changing status from new to needs_review.


---

Comment by fbissey created at 2019-12-15 01:11:13

I guess we could check for matching versions with that kind of stuff

```
fbissey@moonloop ~ $ pkg-config --modversion libR
3.4.1
fbissey@moonloop ~ $ R --version
R version 3.4.1 (2017-06-30) -- "Single Candle"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the
GNU General Public License versions 2 or 3.
For more information about these matters see
http://www.gnu.org/licenses/.

```

Nice that libR comes with a .pc file.


---

Comment by dimpase created at 2019-12-15 01:54:34

I'll do the TODO as soon as the rest looks OK. I've done similar checks for pari...


---

Comment by charpent created at 2019-12-15 09:21:57

Does this install //on top// of #27870, includes (i. e. subsumes) #27870, or what ?


---

Comment by dimpase created at 2019-12-15 09:37:26

#27870 should have been listed as a dependency, sorry. Anyway, the branch here includes the branch of #27870, so you just need the branch `u/dimpase/packages/rconf`


---

Comment by charpent created at 2019-12-15 09:39:06

Replying to [comment:10 dimpase]:
> #27870 should have been listed as a dependency, sorry. Anyway, the branch here includes the branch of #27870, so you just need the branch `u/dimpase/packages/rconf`

Thanks ! Looking into it...


---

Comment by charpent created at 2019-12-15 09:54:56

LGTM:

* Sage -R works as expected. Superficial testing is OK.


```
charpent@zen-book-flip:/usr/local/sage-9$ sage -t --long src/sage/interfaces/r.py 
Running doctests with ID 2019-12-15-10-50-43-b4fc9d4c.
Git branch: t/28884/packages/rconf
Using --optional=build,dochtml,dot2tex,fricas,gap_packages,giacpy_sage,libsemigroups,memlimit,python2,sage,sagenb
Doctesting 1 file.
sage -t --long --warn-long 184.3 src/sage/interfaces/r.py
    [257 tests, 5.48 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5.7 seconds
    cpu time: 5.3 seconds
    cumulative wall time: 5.5 seconds
```



```
charpent@zen-book-flip:/usr/local/sage-9$ sage -t --long src/sage/stats/r.py 
Running doctests with ID 2019-12-15-10-51-20-adfb7e0b.
Git branch: t/28884/packages/rconf
Using --optional=build,dochtml,dot2tex,fricas,gap_packages,giacpy_sage,libsemigroups,memlimit,python2,sage,sagenb
Doctesting 1 file.
sage -t --long --warn-long 184.3 src/sage/stats/r.py
    [2 tests, 0.54 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.7 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
```


`make ptestalllong` underway...


---

Comment by git created at 2019-12-15 11:32:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-12-15 11:35:27

added forgotten commit https://git.sagemath.org/sage.git/commit/?id=634157628ac3f7292e7065eae462bb6b80db7aed from #27870 to this branch (should not matter, review-wise, I guess)


---

Comment by charpent created at 2019-12-15 12:05:04

Replying to [comment:12 charpent]:

[ Snip... ]

> `make ptestalllong` underway...

`ptestalllong` gets 6 transient and 3 permanent failures :

|                                              |                   |     |
|----------------------------------------------|-------------------|-----|
| File                                         | Result            | P/T |
| src/sage/plot/animate.py                     | 7 doctests failed | T   |
| src/sage/modular/ssmod/ssmod.py              | 2 doctests failed | T   |
| src/sage/misc/latex.py                       | 1 doctest failed  | T   |
| src/sage/numerical/backends/glpk_backend.pyx | 1 doctest failed  | P   |
| src/sage/repl/load.py                        | 1 doctest failed  | T   |
| src/sage/tests/gap_packages.py               | 1 doctest failed  | P   |
| src/sage/libs/glpk/error.pyx                 | 1 doctest failed  | P   |
| src/sage/combinat/designs/ext_rep.py         | 1 doctest failed  | T   |
| src/sage/databases/findstat.py               | 1 doctest failed  | T   |
All of these have already been reported for previous release(s) of Python 3-based Sage 9 betas, and therefore considered not to be related to this ticket.

==> `positive_review`

Given the importance of this ticket (a //large// headache off the shoulders of active Sage-R users...), I recommend tests on other platforms (Mac OS X and its shenanigans, Windows and the coexistence of Windows and Cygwin libraries...).


---

Comment by charpent created at 2019-12-15 12:05:04

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2019-12-15 12:07:01

Replying to [comment:14 dimpase]:
> added forgotten commit https://git.sagemath.org/sage.git/commit/?id=634157628ac3f7292e7065eae462bb6b80db7aed from #27870 to this branch (should not matter, review-wise, I guess)

Aaaarghhhh...

Another check may be worthy. But maybe after tests on other platforms... Please ask as neeeded.


---

Comment by git created at 2019-12-15 12:46:24

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-12-15 12:46:24

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by charpent created at 2019-12-15 15:09:13

Replying to [comment:18 git]:
> Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
> ||[3812f1c](https://git.sagemath.org/sage.git/commit/?id=3812f1ca8ecd0c15926c40d214fcb824996a5677)||`list more relevant system packages to install on Debian/Fedora`||

Similar results on this second pass. `positive review`. Same recommendation as before.


---

Comment by charpent created at 2019-12-15 15:09:13

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-12-15 18:52:12

I think we can weaken the version requirements, it still works fine with R 3.4.4 and openblas 0.2.20. 

This is what one has on Ubuntu 18.04 on 32-bit machine (arando buildbot) and on Fedora 26.


---

Comment by git created at 2019-12-15 19:21:14

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2019-12-15 19:21:14

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2019-12-15 19:23:21

setting it back to positive review, as it does only change version numbers


---

Comment by dimpase created at 2019-12-15 19:23:21

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-12-16 22:35:47

It works on MacOS 10.13.6 with Homebrew's R and openblas packages.

It doesn't work with R installed with standalone isntaller from R Project,
probably as there is some kind of library/compiler incompatibility - they don't build R with Xcode compiler, they use their "own"; more precisely, OpenMP-enabled
clang 8, see https://cran.r-project.org/bin/macosx/tools.
Somehow I see an error message while building rpy2, attempting to use `-fopenmp` switch with Xcode's clang.


---

Comment by vbraun created at 2019-12-20 22:45:56

Resolution: fixed


---

Comment by vbraun created at 2019-12-22 15:54:28

Changing status from closed to new.


---

Comment by vbraun created at 2019-12-22 15:54:28

More stuff that has #28883 merged in


---

Comment by vbraun created at 2019-12-22 15:54:28

Resolution changed from fixed to 


---

Comment by vbraun created at 2019-12-22 15:54:38

Changing status from new to needs_review.


---

Comment by vbraun created at 2019-12-22 15:54:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-12-22 16:07:03

New commits:


---

Comment by git created at 2019-12-28 07:56:04

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-12-28 07:56:04

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by dimpase created at 2019-12-28 07:57:27

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-12-28 07:57:27

routine rebase over updated #27870


---

Comment by vbraun created at 2020-01-09 23:44:27

Resolution: fixed
