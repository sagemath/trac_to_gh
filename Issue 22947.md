# Issue 22947: Use the right category for DefaultConvertMaps, rather than SetsWithPartialMaps

archive/issues_022947.json:
```json
{
    "body": "Currently, the category for `DefaultConvertMap`s is `SetsWithPartialMaps()`.\n\n```\nsage: type(QQ[['x']].coerce_map_from(QQ))\n<type 'sage.structure.coerce_maps.DefaultConvertMap_unique'>\nsage: QQ[['x']].coerce_map_from(QQ).category_for()\nCategory of sets with partial maps\n```\n\nIn contrast,\n\n```\nsage: QQ.hom(QQ[['x']]).category_for()\nCategory of euclidean domains\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23184\n\n",
    "created_at": "2017-06-09T01:02:07Z",
    "labels": [
        "coercion",
        "major",
        "enhancement"
    ],
    "title": "Use the right category for DefaultConvertMaps, rather than SetsWithPartialMaps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22947",
    "user": "roed"
}
```
Currently, the category for `DefaultConvertMap`s is `SetsWithPartialMaps()`.

```
sage: type(QQ[['x']].coerce_map_from(QQ))
<type 'sage.structure.coerce_maps.DefaultConvertMap_unique'>
sage: QQ[['x']].coerce_map_from(QQ).category_for()
Category of sets with partial maps
```

In contrast,

```
sage: QQ.hom(QQ[['x']]).category_for()
Category of euclidean domains
```


Issue created by migration from https://trac.sagemath.org/ticket/23184





---

archive/issue_comments_321052.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd86.5\".",
    "created_at": "2017-06-09T17:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321052",
    "user": "roed"
}
```

Changing keywords from "" to "sd86.5".



---

archive/issue_comments_321053.json:
```json
{
    "body": "Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.",
    "created_at": "2017-06-09T18:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321053",
    "user": "pbruin"
}
```

Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.



---

archive/issue_comments_321054.json:
```json
{
    "body": "I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.",
    "created_at": "2017-06-09T19:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321054",
    "user": "pbruin"
}
```

I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.



---

archive/issue_comments_321055.json:
```json
{
    "body": "Replying to [comment:2 pbruin]:\n> Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.\n\nMy plan is to only change the category for coercions, not conversions.  I can't think of any examples where coercions aren't morphisms in the meet of the categories of the parents involved.  All of the examples I see in #15618 are conversions, which this ticket won't affect.",
    "created_at": "2017-06-09T20:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321055",
    "user": "roed"
}
```

Replying to [comment:2 pbruin]:
> Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.

My plan is to only change the category for coercions, not conversions.  I can't think of any examples where coercions aren't morphisms in the meet of the categories of the parents involved.  All of the examples I see in #15618 are conversions, which this ticket won't affect.



---

archive/issue_comments_321056.json:
```json
{
    "body": "Replying to [comment:3 pbruin]:\n> I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.\n\nYou could fix it in this way, but that's a lot of work that would need to be duplicated over and over again for different examples of `DefaultConvertMap`s.",
    "created_at": "2017-06-09T20:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321056",
    "user": "roed"
}
```

Replying to [comment:3 pbruin]:
> I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.

You could fix it in this way, but that's a lot of work that would need to be duplicated over and over again for different examples of `DefaultConvertMap`s.



---

archive/issue_comments_321057.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321057",
    "user": "roed"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321058.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321058",
    "user": "roed"
}
```

New commits:



---

archive/issue_comments_321059.json:
```json
{
    "body": "All tests pass.",
    "created_at": "2017-06-10T17:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321059",
    "user": "roed"
}
```

All tests pass.



---

archive/issue_comments_321060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-11T00:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321061.json:
```json
{
    "body": "Looks good except for a few places where `S.category()` should be replaced with an appropriate meet. I'll fix that myself.",
    "created_at": "2017-06-11T03:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321061",
    "user": "saraedum"
}
```

Looks good except for a few places where `S.category()` should be replaced with an appropriate meet. I'll fix that myself.



---

archive/issue_comments_321062.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-11T05:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321062",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321063.json:
```json
{
    "body": "tests pass.",
    "created_at": "2017-06-11T05:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321063",
    "user": "saraedum"
}
```

tests pass.



---

archive/issue_comments_321064.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-11T05:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321064",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321065.json:
```json
{
    "body": "Looks good.",
    "created_at": "2017-06-11T05:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321065",
    "user": "roed"
}
```

Looks good.



---

archive/issue_comments_321066.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-12T18:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321066",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_321067.json:
```json
{
    "body": "you used a bad syntax for the trac role here :\n\n```\n+        We check that `trac`:23184 has been resolved::\n```\n\nit should have been\n\n```\n+        We check that :trac:`23184` has been resolved::\n```\n\nSo please review #23526",
    "created_at": "2017-07-23T09:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22947",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22947#issuecomment-321067",
    "user": "chapoton"
}
```

you used a bad syntax for the trac role here :

```
+        We check that `trac`:23184 has been resolved::
```

it should have been

```
+        We check that :trac:`23184` has been resolved::
```

So please review #23526
