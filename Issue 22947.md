# Issue 22947: Use the right category for DefaultConvertMaps, rather than SetsWithPartialMaps

Issue created by migration from https://trac.sagemath.org/ticket/23184

Original creator: roed

Original creation time: 2017-06-09 01:02:07

Currently, the category for `DefaultConvertMap`s is `SetsWithPartialMaps()`.

```
sage: type(QQ[['x']].coerce_map_from(QQ))
<type 'sage.structure.coerce_maps.DefaultConvertMap_unique'>
sage: QQ[['x']].coerce_map_from(QQ).category_for()
Category of sets with partial maps
```

In contrast,

```
sage: QQ.hom(QQ[['x']]).category_for()
Category of euclidean domains
```



---

Comment by roed created at 2017-06-09 17:02:36

Changing keywords from "" to "sd86.5".


---

Comment by pbruin created at 2017-06-09 18:47:34

Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.


---

Comment by pbruin created at 2017-06-09 19:21:04

I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.


---

Comment by roed created at 2017-06-09 20:14:08

Replying to [comment:2 pbruin]:
> Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.

My plan is to only change the category for coercions, not conversions.  I can't think of any examples where coercions aren't morphisms in the meet of the categories of the parents involved.  All of the examples I see in #15618 are conversions, which this ticket won't affect.


---

Comment by roed created at 2017-06-09 20:15:05

Replying to [comment:3 pbruin]:
> I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.

You could fix it in this way, but that's a lot of work that would need to be duplicated over and over again for different examples of `DefaultConvertMap`s.


---

Comment by roed created at 2017-06-10 16:53:07

Changing status from new to needs_review.


---

Comment by roed created at 2017-06-10 16:53:07

New commits:


---

Comment by roed created at 2017-06-10 17:04:38

All tests pass.


---

Comment by git created at 2017-06-11 00:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-06-11 03:14:51

Looks good except for a few places where `S.category()` should be replaced with an appropriate meet. I'll fix that myself.


---

Comment by git created at 2017-06-11 05:35:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by saraedum created at 2017-06-11 05:36:19

tests pass.


---

Comment by roed created at 2017-06-11 05:43:09

Changing status from needs_review to positive_review.


---

Comment by roed created at 2017-06-11 05:43:09

Looks good.


---

Comment by vbraun created at 2017-06-12 18:01:40

Resolution: fixed


---

Comment by chapoton created at 2017-07-23 09:10:59

you used a bad syntax for the trac role here :

```
+        We check that `trac`:23184 has been resolved::
```

it should have been

```
+        We check that :trac:`23184` has been resolved::
```

So please review #23526
