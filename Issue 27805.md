# Issue 27805: broken arithmetic over GF(p)

Issue created by migration from https://trac.sagemath.org/ticket/28042

Original creator: dimpase

Original creation time: 2019-06-21 15:37:37

CC:  cpernet


```
sage: p=193379
sage: K=GF(p)
sage: a=K(1)
sage: b=K(191495)
sage: c=K(109320)
sage: d=K(167667)
sage: e=103937
sage: a*c+b*d-e
102041
sage: vector([a,b])*vector([c,d])-e
-91339
sage: -91339+e
12598
sage: vector([a,b])*vector([c,d])
12599
```



---

Comment by vdelecroix created at 2019-06-21 18:52:29

New commits:


---

Comment by vdelecroix created at 2019-06-21 18:52:29

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2019-06-21 18:53:58

Changing keywords from "" to "days101".


---

Comment by dimpase created at 2019-06-21 19:24:36

is this also the reason for the crazy types shown in the meanwhile deleted part of the description?


---

Comment by vdelecroix created at 2019-06-21 19:50:55

Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.


---

Comment by vdelecroix created at 2019-06-21 19:51:29

Note that the added description explains what is the problem (somewhat briefly though).


---

Comment by dimpase created at 2019-06-21 19:56:20

I see, thanks. A nice bug it was...


---

Comment by cpernet created at 2019-06-21 20:30:18

Thanks Vincent and Dima, this is great! I confirm this fixes the issue on my side too.
I think I can positive review the ticket. I just wondered whether one should also worry on the second bug raised: the fact that once coerced to the integers the result was off by 1. Any thought on whether this should be handled in this ticket, or should we wait for a next ticket?


---

Comment by vdelecroix created at 2019-06-21 20:33:45

If you can reproduce your "second bug" on top of the branch provided then a ticket should definitely be opened. The return type of the dot product was simply wrong. I don't think there is any more coercion trouble now.


---

Comment by dimpase created at 2019-06-21 22:02:10

Replying to [comment:8 vdelecroix]:
> Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.

I gather that `IntegerMod_gmp` is not affected (as it's not handled , it's only these two "small" modn instances that got mixed up.


---

Comment by vbraun created at 2019-06-22 08:13:16

See patchbot


---

Comment by vbraun created at 2019-06-22 08:13:16

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2019-06-22 09:56:20

New commits:


---

Comment by git created at 2019-06-22 10:03:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2019-06-22 10:04:47

Changing status from needs_work to positive_review.


---

Comment by dimpase created at 2019-06-22 10:04:47

hopefully this is all what's needed here, over to bots.


---

Comment by vbraun created at 2019-06-23 10:16:07

Resolution: fixed
