# Issue 27805: broken arithmetic over GF(p)

archive/issues_027805.json:
```json
{
    "body": "CC:  cpernet\n\n\n```\nsage: p=193379\nsage: K=GF(p)\nsage: a=K(1)\nsage: b=K(191495)\nsage: c=K(109320)\nsage: d=K(167667)\nsage: e=103937\nsage: a*c+b*d-e\n102041\nsage: vector([a,b])*vector([c,d])-e\n-91339\nsage: -91339+e\n12598\nsage: vector([a,b])*vector([c,d])\n12599\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28042\n\n",
    "created_at": "2019-06-21T15:37:37Z",
    "labels": [
        "finite rings",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "broken arithmetic over GF(p)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27805",
    "user": "dimpase"
}
```
CC:  cpernet


```
sage: p=193379
sage: K=GF(p)
sage: a=K(1)
sage: b=K(191495)
sage: c=K(109320)
sage: d=K(167667)
sage: e=103937
sage: a*c+b*d-e
102041
sage: vector([a,b])*vector([c,d])-e
-91339
sage: -91339+e
12598
sage: vector([a,b])*vector([c,d])
12599
```


Issue created by migration from https://trac.sagemath.org/ticket/28042





---

archive/issue_comments_392771.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-21T18:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392771",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_392772.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-21T18:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392772",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_392773.json:
```json
{
    "body": "Changing keywords from \"\" to \"days101\".",
    "created_at": "2019-06-21T18:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392773",
    "user": "vdelecroix"
}
```

Changing keywords from "" to "days101".



---

archive/issue_comments_392774.json:
```json
{
    "body": "is this also the reason for the crazy types shown in the meanwhile deleted part of the description?",
    "created_at": "2019-06-21T19:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392774",
    "user": "dimpase"
}
```

is this also the reason for the crazy types shown in the meanwhile deleted part of the description?



---

archive/issue_comments_392775.json:
```json
{
    "body": "Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.",
    "created_at": "2019-06-21T19:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392775",
    "user": "vdelecroix"
}
```

Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.



---

archive/issue_comments_392776.json:
```json
{
    "body": "Note that the added description explains what is the problem (somewhat briefly though).",
    "created_at": "2019-06-21T19:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392776",
    "user": "vdelecroix"
}
```

Note that the added description explains what is the problem (somewhat briefly though).



---

archive/issue_comments_392777.json:
```json
{
    "body": "I see, thanks. A nice bug it was...",
    "created_at": "2019-06-21T19:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392777",
    "user": "dimpase"
}
```

I see, thanks. A nice bug it was...



---

archive/issue_comments_392778.json:
```json
{
    "body": "Thanks Vincent and Dima, this is great! I confirm this fixes the issue on my side too.\nI think I can positive review the ticket. I just wondered whether one should also worry on the second bug raised: the fact that once coerced to the integers the result was off by 1. Any thought on whether this should be handled in this ticket, or should we wait for a next ticket?",
    "created_at": "2019-06-21T20:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392778",
    "user": "cpernet"
}
```

Thanks Vincent and Dima, this is great! I confirm this fixes the issue on my side too.
I think I can positive review the ticket. I just wondered whether one should also worry on the second bug raised: the fact that once coerced to the integers the result was off by 1. Any thought on whether this should be handled in this ticket, or should we wait for a next ticket?



---

archive/issue_comments_392779.json:
```json
{
    "body": "If you can reproduce your \"second bug\" on top of the branch provided then a ticket should definitely be opened. The return type of the dot product was simply wrong. I don't think there is any more coercion trouble now.",
    "created_at": "2019-06-21T20:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392779",
    "user": "vdelecroix"
}
```

If you can reproduce your "second bug" on top of the branch provided then a ticket should definitely be opened. The return type of the dot product was simply wrong. I don't think there is any more coercion trouble now.



---

archive/issue_comments_392780.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.\n\nI gather that `IntegerMod_gmp` is not affected (as it's not handled , it's only these two \"small\" modn instances that got mixed up.",
    "created_at": "2019-06-21T22:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392780",
    "user": "dimpase"
}
```

Replying to [comment:8 vdelecroix]:
> Yes. For some reason, there are three implementations of modular arithmetic: `IntegerMod_gmp`, `IntegerMod_int` and `IntegerMod_int64` (see `rings.finite_rings.integer_mod`). When it turns to linear algebra one has to carefully use the correct type.

I gather that `IntegerMod_gmp` is not affected (as it's not handled , it's only these two "small" modn instances that got mixed up.



---

archive/issue_comments_392781.json:
```json
{
    "body": "See patchbot",
    "created_at": "2019-06-22T08:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392781",
    "user": "vbraun"
}
```

See patchbot



---

archive/issue_comments_392782.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-22T08:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392782",
    "user": "vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_392783.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-22T09:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392783",
    "user": "dimpase"
}
```

New commits:



---

archive/issue_comments_392784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-22T10:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392784",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_392785.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-06-22T10:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392785",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_392786.json:
```json
{
    "body": "hopefully this is all what's needed here, over to bots.",
    "created_at": "2019-06-22T10:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392786",
    "user": "dimpase"
}
```

hopefully this is all what's needed here, over to bots.



---

archive/issue_comments_392787.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-23T10:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27805#issuecomment-392787",
    "user": "vbraun"
}
```

Resolution: fixed
