# Issue 32875: some speedups in AdditiveAbelianGroupWrapper.discrete_log()

Issue created by migration from https://trac.sagemath.org/ticket/33112

Original creator: lorenz

Original creation time: 2022-01-03 08:03:22

CC:  vdelecroix

Currently, the `.discrete_log()` method for `AdditiveAbelianGroupWrapper`s contains several unnecessary calls to `.order()` for the underlying group elements. In some cases (e.g., elliptic curves over large finite fields), these calls incur significant overhead. We eliminate them and also apply some smaller performance tweaks while we're at it (such as using the exponent instead of the order and `isqrt` instead of `sqrt`).

Example:

```sage
sage: p = 4*prod(primes(3,117))-1
sage: E = EllipticCurve(GF(p^2),[1,0])
sage: A = E.abelian_group()
sage: %timeit A.discrete_log(E.random_point())
```


Result before this patch:

```
22.6 s ± 765 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```


Result after this patch:

```
3.74 s ± 78.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```



Changes not including the dependency: https://git.sagemath.org/sage.git/diff?id2=20d32835c7c3da63316f66d9dcd040f927d3d69d&id=43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c


---

Comment by lorenz created at 2022-01-03 08:04:42

Changing status from new to needs_review.


---

Comment by git created at 2022-02-08 08:04:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2022-02-15 06:49:29

I think the list comprehension is faster (in python) than using `map` with a `lambda` function.

I would make `_discrete_log_pgroup` into its own function rather than a ``@`staticmethod`. This can make it easier if you decide you want to Cythonize it too.


---

Comment by git created at 2022-02-15 08:59:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-02-15 08:59:30

Thank you, done.


---

Comment by tscrim created at 2022-02-27 00:51:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-02-27 00:51:38

Thank you. LGTM.


---

Comment by vbraun created at 2022-03-08 08:12:13

Resolution: fixed
