# Issue 32875: some speedups in AdditiveAbelianGroupWrapper.discrete_log()

archive/issues_032875.json:
```json
{
    "body": "CC:  @videlec\n\nCurrently, the `.discrete_log()` method for `AdditiveAbelianGroupWrapper`s contains several unnecessary calls to `.order()` for the underlying group elements. In some cases (e.g., elliptic curves over large finite fields), these calls incur significant overhead. We eliminate them and also apply some smaller performance tweaks while we're at it (such as using the exponent instead of the order and `isqrt` instead of `sqrt`).\n\nExample:\n\n```sage\nsage: p = 4*prod(primes(3,117))-1\nsage: E = EllipticCurve(GF(p^2),[1,0])\nsage: A = E.abelian_group()\nsage: %timeit A.discrete_log(E.random_point())\n```\n\n\nResult before this patch:\n\n```\n22.6 s \u00b1 765 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\n\nResult after this patch:\n\n```\n3.74 s \u00b1 78.2 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\n\n\nChanges not including the dependency: https://git.sagemath.org/sage.git/diff?id2=20d32835c7c3da63316f66d9dcd040f927d3d69d&id=43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c\n\nIssue created by migration from https://trac.sagemath.org/ticket/33112\n\n",
    "created_at": "2022-01-03T08:03:22Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "some speedups in AdditiveAbelianGroupWrapper.discrete_log()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32875",
    "user": "https://github.com/yyyyx4"
}
```
CC:  @videlec

Currently, the `.discrete_log()` method for `AdditiveAbelianGroupWrapper`s contains several unnecessary calls to `.order()` for the underlying group elements. In some cases (e.g., elliptic curves over large finite fields), these calls incur significant overhead. We eliminate them and also apply some smaller performance tweaks while we're at it (such as using the exponent instead of the order and `isqrt` instead of `sqrt`).

Example:

```sage
sage: p = 4*prod(primes(3,117))-1
sage: E = EllipticCurve(GF(p^2),[1,0])
sage: A = E.abelian_group()
sage: %timeit A.discrete_log(E.random_point())
```


Result before this patch:

```
22.6 s ± 765 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```


Result after this patch:

```
3.74 s ± 78.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```



Changes not including the dependency: https://git.sagemath.org/sage.git/diff?id2=20d32835c7c3da63316f66d9dcd040f927d3d69d&id=43c03e5cd3e5b17b68d875d1aad80a8dc1bce74c

Issue created by migration from https://trac.sagemath.org/ticket/33112





---

archive/issue_comments_468295.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-03T08:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468295",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_468296.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-08T08:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_468297.json:
```json
{
    "body": "I think the list comprehension is faster (in python) than using `map` with a `lambda` function.\n\nI would make `_discrete_log_pgroup` into its own function rather than a ``@`staticmethod`. This can make it easier if you decide you want to Cythonize it too.",
    "created_at": "2022-02-15T06:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468297",
    "user": "https://github.com/tscrim"
}
```

I think the list comprehension is faster (in python) than using `map` with a `lambda` function.

I would make `_discrete_log_pgroup` into its own function rather than a ``@`staticmethod`. This can make it easier if you decide you want to Cythonize it too.



---

archive/issue_comments_468298.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-15T08:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468299.json:
```json
{
    "body": "Thank you, done.",
    "created_at": "2022-02-15T08:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468299",
    "user": "https://github.com/yyyyx4"
}
```

Thank you, done.



---

archive/issue_comments_468300.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-27T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468300",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_468301.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2022-02-27T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468301",
    "user": "https://github.com/tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_468302.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-08T08:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32875#issuecomment-468302",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
