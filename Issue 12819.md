# Issue 12819: Don't doctest autogenerated rst files

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2012-05-22 20:31:08

Assignee: mvngu

When we build the Sage documentation, we create lots of files which look like the following (`SAGE_ROOT/devel/sage/doc/en/reference/sage/algebras/free_algebra_quotient_element.rst`):

```
.. _sage.algebras.free_algebra_quotient_element:

Free algebra quotient elements
==============================

.. This file has been autogenerated.


.. automodule:: sage.algebras.free_algebra_quotient_element
   :members:
   :undoc-members:
   :show-inheritance:
```

When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n', or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).


---

Attachment


---

Comment by jhpalmieri created at 2012-05-22 20:54:04

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-05-22 20:54:04

For the first approach, apply a patch like this to `SAGE_ROOT/local/bin`:

```diff
diff --git a/sage-ptest b/sage-ptest
--- a/sage-ptest
+++ b/sage-ptest
`@``@` -133,9 +133,11 `@``@` def skip(F):
         sys.stdout.flush()
         printmutex.release()
         return True
+    TEXT = open(G).read()
     filenm = os.path.split(F)[1]
     if (filenm[0] == '.' or (os.path.sep + '.' in G.lstrip(os.path.sep + '.'))
-        or 'nodoctest' in open(G).read()[:50]):
+        or 'nodoctest' in TEXT[:50]
+        or '\n.. This file has been autogenerated.\n' in TEXT):
         return True
     if G.find(os.path.join('doc', 'output')) != -1:
         return True
```



---

Comment by kini created at 2012-05-22 21:31:39

The approach of your patch (rather than your comment) seems to me to be the correct one. It also passes tests on 5.0.beta1, and the code looks reasonable, so positive review from me.


---

Comment by kini created at 2012-05-22 21:31:39

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-02 12:16:23

Resolution: fixed
