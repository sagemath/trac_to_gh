# Issue 23769: experimental: SymPy --> Sage conversion completely inside Sage

archive/issues_023769.json:
```json
{
    "body": "CC:  @EmmanuelCharpentier\n\nThere are 46 SymPy object member functions named `_sage_()` that comprise the SymPy-->Sage conversion facility. It turns out that automatic testing the code at the SymPy Travis never worked and is difficult to fix because of fitting Sage into Travis. Secondly, after initial work on it by SymPy authors work is now mainly motivated with Sage development where the maintenance of interdependent Sage and SymPy patches begins to be unwieldy and error-prone.\n\nThis branch contains experimental code that dynamically adds `sage()` methods on Sage startup to the relevant objects.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24006\n\n",
    "created_at": "2017-10-10T15:41:28Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "experimental: SymPy --> Sage conversion completely inside Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23769",
    "user": "https://github.com/rwst"
}
```
CC:  @EmmanuelCharpentier

There are 46 SymPy object member functions named `_sage_()` that comprise the SymPy-->Sage conversion facility. It turns out that automatic testing the code at the SymPy Travis never worked and is difficult to fix because of fitting Sage into Travis. Secondly, after initial work on it by SymPy authors work is now mainly motivated with Sage development where the maintenance of interdependent Sage and SymPy patches begins to be unwieldy and error-prone.

This branch contains experimental code that dynamically adds `sage()` methods on Sage startup to the relevant objects.

Issue created by migration from https://trac.sagemath.org/ticket/24006





---

archive/issue_comments_332635.json:
```json
{
    "body": "Proof of concept:\n\n```\nsage: from sympy import Symbol\n....: from sage.symbolic.ring import SR\n....: \n....: def _sympysage_symbol(self):\n....:     return SR.var(self.name)\n....: \n....: Symbol.sage = _sympysage_symbol\n....: \nsage: x._sympy_()\nx\nsage: type(_)\n<class 'sympy.core.symbol.Symbol'>\nsage: x._sympy_()\nx\nsage: _.sage()\nx\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\n",
    "created_at": "2017-10-10T16:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332635",
    "user": "https://github.com/rwst"
}
```

Proof of concept:

```
sage: from sympy import Symbol
....: from sage.symbolic.ring import SR
....: 
....: def _sympysage_symbol(self):
....:     return SR.var(self.name)
....: 
....: Symbol.sage = _sympysage_symbol
....: 
sage: x._sympy_()
x
sage: type(_)
<class 'sympy.core.symbol.Symbol'>
sage: x._sympy_()
x
sage: _.sage()
x
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```




---

archive/issue_comments_332636.json:
```json
{
    "body": "This naive attempt already works in first tests. Setting review in order to get startup timings from the patchbots.\n----\nNew commits:",
    "created_at": "2017-10-11T15:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332636",
    "user": "https://github.com/rwst"
}
```

This naive attempt already works in first tests. Setting review in order to get startup timings from the patchbots.
----
New commits:



---

archive/issue_comments_332637.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-11T15:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332637",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332638.json:
```json
{
    "body": "I get a ton of errors when ptesting it over 8.1.beta7+#23990. The resulting log file is too large to be uploaded (3,2 Mb gzipped, 332,2 Mb (!!!) uncompressed).\n\nI'll try `make distclean ; make ptestlong`, but don't hold your breath...\n\nNot changing status, pending second attempt to build.",
    "created_at": "2017-10-11T18:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332638",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

I get a ton of errors when ptesting it over 8.1.beta7+#23990. The resulting log file is too large to be uploaded (3,2 Mb gzipped, 332,2 Mb (!!!) uncompressed).

I'll try `make distclean ; make ptestlong`, but don't hold your breath...

Not changing status, pending second attempt to build.



---

archive/issue_comments_332639.json:
```json
{
    "body": "Don't waste CPU, I just wanted a patchbot on it, for the startup time. But I'm afraid already there is a 25% increase so this must be done lazily.  I haven't debugged it at all.",
    "created_at": "2017-10-11T19:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332639",
    "user": "https://github.com/rwst"
}
```

Don't waste CPU, I just wanted a patchbot on it, for the startup time. But I'm afraid already there is a 25% increase so this must be done lazily.  I haven't debugged it at all.



---

archive/issue_comments_332640.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-11T19:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332640",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332641.json:
```json
{
    "body": "Replying to [comment:7 rws]:\n> Don't waste CPU, I just wanted a patchbot on it, for the startup time. But I'm afraid already there is a 25% increase so this must be done lazily.  I haven't debugged it at all.\n\nAaaarghhh... I //did// waste CPU. For some (now unscrutable) reason, I have been unable to `make` sage : some plot used in the documentation refuses to build.\n\nCurrently ptesting 8.1.beta7+#23990 again to check that the problemis indeed with the present patch (and reinstalling my 434 or so R packages...).\n\nThe next time you position `needs_review` to get the attention of a patchbot, could you leave a note to potential reviewers ?",
    "created_at": "2017-10-12T04:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332641",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:7 rws]:
> Don't waste CPU, I just wanted a patchbot on it, for the startup time. But I'm afraid already there is a 25% increase so this must be done lazily.  I haven't debugged it at all.

Aaaarghhh... I //did// waste CPU. For some (now unscrutable) reason, I have been unable to `make` sage : some plot used in the documentation refuses to build.

Currently ptesting 8.1.beta7+#23990 again to check that the problemis indeed with the present patch (and reinstalling my 434 or so R packages...).

The next time you position `needs_review` to get the attention of a patchbot, could you leave a note to potential reviewers ?



---

archive/issue_comments_332642.json:
```json
{
    "body": "Replying to [comment:8 charpent]:\n> The next time you position `needs_review` to get the attention of a patchbot, could you leave a note to potential reviewers ?\n\nSorry I was not clear enough in comment:4",
    "created_at": "2017-10-12T04:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332642",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:8 charpent]:
> The next time you position `needs_review` to get the attention of a patchbot, could you leave a note to potential reviewers ?

Sorry I was not clear enough in comment:4



---

archive/issue_comments_332643.json:
```json
{
    "body": "Actually the code was really bad Python, one can see it is not the language I'm used to.",
    "created_at": "2017-10-12T06:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332643",
    "user": "https://github.com/rwst"
}
```

Actually the code was really bad Python, one can see it is not the language I'm used to.



---

archive/issue_comments_332644.json:
```json
{
    "body": "Also, we may have to adapt to the `_sage_` convention. Yes, all interfaces in `src/sage/interface` even Mma use it.",
    "created_at": "2017-10-12T07:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332644",
    "user": "https://github.com/rwst"
}
```

Also, we may have to adapt to the `_sage_` convention. Yes, all interfaces in `src/sage/interface` even Mma use it.



---

archive/issue_comments_332645.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-12T09:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332645",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-14T15:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332647.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-15T15:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332647",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332648.json:
```json
{
    "body": "This new branch is now ready for review. It already passes all symbolic tests. It may fail in other Sage parts where symbolics are used. Let's put the patchbots on it.\n----\nNew commits:",
    "created_at": "2017-10-15T15:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332648",
    "user": "https://github.com/rwst"
}
```

This new branch is now ready for review. It already passes all symbolic tests. It may fail in other Sage parts where symbolics are used. Let's put the patchbots on it.
----
New commits:



---

archive/issue_comments_332649.json:
```json
{
    "body": "Attachment [dochtml.log.gz](tarball://root/attachments/some-uuid/ticket24006/dochtml.log.gz) by @EmmanuelCharpentier created at 2017-10-15 19:23:48\n\nLog of a failed attempt to build the documentation.",
    "created_at": "2017-10-15T19:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332649",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Attachment [dochtml.log.gz](tarball://root/attachments/some-uuid/ticket24006/dochtml.log.gz) by @EmmanuelCharpentier created at 2017-10-15 19:23:48

Log of a failed attempt to build the documentation.



---

archive/issue_comments_332650.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-15T19:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332650",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332651.json:
```json
{
    "body": "On top of #24026 (which needs review ;-), I can't even build the documentation (hence no formal testing possible). See uploaded log.\n\nAnd yes, I did `./sage -f sympy` before `( make doc-clean && make ptestlong)`.\n\n==>`needs_work`",
    "created_at": "2017-10-15T19:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332651",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

On top of #24026 (which needs review ;-), I can't even build the documentation (hence no formal testing possible). See uploaded log.

And yes, I did `./sage -f sympy` before `( make doc-clean && make ptestlong)`.

==>`needs_work`



---

archive/issue_comments_332652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-16T14:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332653.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-16T14:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332653",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332654.json:
```json
{
    "body": "Apologies again, the main file was missing, and more changes.",
    "created_at": "2017-10-16T14:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332654",
    "user": "https://github.com/rwst"
}
```

Apologies again, the main file was missing, and more changes.



---

archive/issue_comments_332655.json:
```json
{
    "body": "Testing on top of #24026, `ptestlong` gives me two errors :\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/libs/gap/assigned_names.py  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/sha_tate.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nBoth are transient (i. e. both tests pass when ran standalone).\n\nAn example of possible usefulness :\n\n```\nsage: dgamma(y,k,theta)=y^(k-1)*e^(-y/theta)/(theta^k*gamma(k))\nsage: (dgamma(y,k,theta).laplace(y,x)^p).expand().canonicalize_radical().inverse\n....: _laplace(x,y)\nilt(1/((theta*x + 1)^(k*p)), x, y)\nsage: sympy.inverse_laplace_transform((dgamma(y,k,theta).laplace(y,x)^p).expand(\n....: ).canonicalize_radical(),x,y)._sage_()\nk*p*theta^(-k*p)*y^(k*p - 1)*e^(-y/theta)*heaviside(y)/gamma(k*p + 1)\n```\n\n\nI won't be able to test further right now. I'll try to find more examples (that could be useful doctests...).\n\nDid you translate Sympy's conditional expressions in your recent `cases` ?\n\nAnother thought : we might subclass `sage()` as a wrapper for `_sage_()` possibly allowing for further arguments, such as supplementary translation dictionaries, as originally intended for mathematica.sage() (but this does not seem to worl currently...). Another ticket ?\n\nOh, BTW : `positive_review`",
    "created_at": "2017-10-16T16:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332655",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Testing on top of #24026, `ptestlong` gives me two errors :

```
----------------------------------------------------------------------
sage -t --long src/sage/libs/gap/assigned_names.py  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py  # 1 doctest failed
----------------------------------------------------------------------
```

Both are transient (i. e. both tests pass when ran standalone).

An example of possible usefulness :

```
sage: dgamma(y,k,theta)=y^(k-1)*e^(-y/theta)/(theta^k*gamma(k))
sage: (dgamma(y,k,theta).laplace(y,x)^p).expand().canonicalize_radical().inverse
....: _laplace(x,y)
ilt(1/((theta*x + 1)^(k*p)), x, y)
sage: sympy.inverse_laplace_transform((dgamma(y,k,theta).laplace(y,x)^p).expand(
....: ).canonicalize_radical(),x,y)._sage_()
k*p*theta^(-k*p)*y^(k*p - 1)*e^(-y/theta)*heaviside(y)/gamma(k*p + 1)
```


I won't be able to test further right now. I'll try to find more examples (that could be useful doctests...).

Did you translate Sympy's conditional expressions in your recent `cases` ?

Another thought : we might subclass `sage()` as a wrapper for `_sage_()` possibly allowing for further arguments, such as supplementary translation dictionaries, as originally intended for mathematica.sage() (but this does not seem to worl currently...). Another ticket ?

Oh, BTW : `positive_review`



---

archive/issue_comments_332656.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-16T16:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332656",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332657.json:
```json
{
    "body": "Replying to [comment:19 charpent]:\n> Did you translate Sympy's conditional expressions in your recent `cases` ?\n\nSee #23923\n\n> Oh, BTW : `positive_review`\n\nThanks.",
    "created_at": "2017-10-17T06:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332657",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:19 charpent]:
> Did you translate Sympy's conditional expressions in your recent `cases` ?

See #23923

> Oh, BTW : `positive_review`

Thanks.



---

archive/issue_comments_332658.json:
```json
{
    "body": "Hello,\n\nI am trying to extend your interface to the function Subs:\n\n\n```\ndH = Subs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))\n```\n\n\nwhere h is an abstract function.\n\nI tried to add the function in src/interfaces/sympy.py :  \n\n\n```\ndef _sympysage_Subs(self):\n    \"\"\"\n    EXAMPLES::\n\n        sage: from sympy import Symbol\n        sage: from sympy.core.singleton import S\n    \"\"\"\n\n    args = self.args\n    func = args[0]\n    substi = [(args[1][i],args[2][i]) for i in range(len(args[1]))]\n\n    print (substi)\n    #s = args[0].subs(substi)\n    return s\n\n```\n\n\nBut I am experimenting recursion problems (for this reason s is commented).\nI tried to use the function Subs(...).doit() but it has no effect.",
    "created_at": "2017-10-17T14:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332658",
    "user": "https://github.com/man74cio"
}
```

Hello,

I am trying to extend your interface to the function Subs:


```
dH = Subs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))
```


where h is an abstract function.

I tried to add the function in src/interfaces/sympy.py :  


```
def _sympysage_Subs(self):
    """
    EXAMPLES::

        sage: from sympy import Symbol
        sage: from sympy.core.singleton import S
    """

    args = self.args
    func = args[0]
    substi = [(args[1][i],args[2][i]) for i in range(len(args[1]))]

    print (substi)
    #s = args[0].subs(substi)
    return s

```


But I am experimenting recursion problems (for this reason s is commented).
I tried to use the function Subs(...).doit() but it has no effect.



---

archive/issue_comments_332659.json:
```json
{
    "body": "On top of #20204 I get with your code (comment removed):\n\n```\nsage: from sympy import Subs, Derivative, Function, Symbol\nsage: _xi_1 = Symbol('_xi_1')\nsage: u = Symbol('u')\nsage: v = Symbol('v')\nsage: h = Function('h')\nsage: x._sympy_()\nx\nsage: dH = Subs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))\nsage: dH._sage_()\n[(_xi_1, u/2 + v/2)]\nSubs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))\n```\n\nUsing this code however:\n\n```\n    args = self.args\n    substi = dict([(args[1][i]._sage_(),args[2][i]._sage_()) for i in range(len(args[1]))])\n    s = args[0]._sage_().subs(substi)\n```\n\nI get:\n\n```\nsage: dH._sage_()\nD[0](h)(1/2*u + 1/2*v, 1/2*u - 1/2*v)\n```\n",
    "created_at": "2017-10-18T06:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332659",
    "user": "https://github.com/rwst"
}
```

On top of #20204 I get with your code (comment removed):

```
sage: from sympy import Subs, Derivative, Function, Symbol
sage: _xi_1 = Symbol('_xi_1')
sage: u = Symbol('u')
sage: v = Symbol('v')
sage: h = Function('h')
sage: x._sympy_()
x
sage: dH = Subs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))
sage: dH._sage_()
[(_xi_1, u/2 + v/2)]
Subs(Derivative(h(_xi_1, u/2 - v/2), _xi_1), (_xi_1,), (u/2 + v/2,))
```

Using this code however:

```
    args = self.args
    substi = dict([(args[1][i]._sage_(),args[2][i]._sage_()) for i in range(len(args[1]))])
    s = args[0]._sage_().subs(substi)
```

I get:

```
sage: dH._sage_()
D[0](h)(1/2*u + 1/2*v, 1/2*u - 1/2*v)
```




---

archive/issue_comments_332660.json:
```json
{
    "body": "So, doing the conversion to sage and then the substitution it works. \nFantastic. \nThe substitutions didn't work in sympy only.\nThanks",
    "created_at": "2017-10-18T08:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332660",
    "user": "https://github.com/man74cio"
}
```

So, doing the conversion to sage and then the substitution it works. 
Fantastic. 
The substitutions didn't work in sympy only.
Thanks



---

archive/issue_comments_332661.json:
```json
{
    "body": "There should be a change in the sympy patchlevel if you change patches (including removing them!)",
    "created_at": "2017-10-18T20:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332661",
    "user": "https://github.com/jdemeyer"
}
```

There should be a change in the sympy patchlevel if you change patches (including removing them!)



---

archive/issue_comments_332662.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-18T20:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332662",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_332663.json:
```json
{
    "body": "Sorry to spoil the party, but I don't think that it's good to require that the user does `sympy_init()` in order for Sympy -> Sage conversion to work. In my view, it would be much better to fix it upstream in sympy. Ideally, you should either fix sympy to fix the `_sage_()` method in sympy or to call `sympy_init()` whenever `sympy` is imported.",
    "created_at": "2017-10-18T20:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332663",
    "user": "https://github.com/jdemeyer"
}
```

Sorry to spoil the party, but I don't think that it's good to require that the user does `sympy_init()` in order for Sympy -> Sage conversion to work. In my view, it would be much better to fix it upstream in sympy. Ideally, you should either fix sympy to fix the `_sage_()` method in sympy or to call `sympy_init()` whenever `sympy` is imported.



---

archive/issue_comments_332664.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> ....or to call `sympy_init()` whenever `sympy` is imported.\n\nSo, how to do that? Note that #20204 already has positive review and it includes this ticket. I'm offering to implement your suggestion in another ticket which can be put on top of it all because there is no pressing need for it.",
    "created_at": "2017-10-19T05:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332664",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:25 jdemeyer]:
> ....or to call `sympy_init()` whenever `sympy` is imported.

So, how to do that? Note that #20204 already has positive review and it includes this ticket. I'm offering to implement your suggestion in another ticket which can be put on top of it all because there is no pressing need for it.



---

archive/issue_comments_332665.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-19T05:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332665",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332666.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> There should be a change in the sympy patchlevel if you change patches (including removing them!)\n\nThere is a change in patchlevel in #20204 which includes this ticket.",
    "created_at": "2017-10-19T05:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332666",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:24 jdemeyer]:
> There should be a change in the sympy patchlevel if you change patches (including removing them!)

There is a change in patchlevel in #20204 which includes this ticket.



---

archive/issue_comments_332667.json:
```json
{
    "body": "Replying to [comment:27 rws]:\n> Replying to [comment:24 jdemeyer]:\n> > There should be a change in the sympy patchlevel if you change patches (including removing them!)\n> \n> There is a change in patchlevel in #20204 which includes this ticket.\n\nThat is irrelevant. **This** ticket removes a patch so **this** ticket should increase the patchlevel of sympy.",
    "created_at": "2017-10-19T08:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332667",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 rws]:
> Replying to [comment:24 jdemeyer]:
> > There should be a change in the sympy patchlevel if you change patches (including removing them!)
> 
> There is a change in patchlevel in #20204 which includes this ticket.

That is irrelevant. **This** ticket removes a patch so **this** ticket should increase the patchlevel of sympy.



---

archive/issue_comments_332668.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-19T08:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332668",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332669.json:
```json
{
    "body": "Replying to [comment:26 rws]:\n> I'm offering to implement your suggestion in another ticket which can be put on top of it all because there is no pressing need for it.\n\nFine for me.\n\nMy suggestion was to patch sympy itself.",
    "created_at": "2017-10-19T08:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332669",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 rws]:
> I'm offering to implement your suggestion in another ticket which can be put on top of it all because there is no pressing need for it.

Fine for me.

My suggestion was to patch sympy itself.



---

archive/issue_comments_332670.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> My suggestion was to patch sympy itself.\n\nYou said '...you should either fix sympy to fix the _sage_() method in sympy or to call sympy_init() whenever sympy is imported.'",
    "created_at": "2017-10-19T09:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332670",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:29 jdemeyer]:
> My suggestion was to patch sympy itself.

You said '...you should either fix sympy to fix the _sage_() method in sympy or to call sympy_init() whenever sympy is imported.'



---

archive/issue_comments_332671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-19T13:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332672.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-19T14:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332672",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332673.json:
```json
{
    "body": "Okay the patchlevel is bumped here and the `sympy_init` call placed in `sympy/__init__` (see #24067). Please review.",
    "created_at": "2017-10-19T14:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332673",
    "user": "https://github.com/rwst"
}
```

Okay the patchlevel is bumped here and the `sympy_init` call placed in `sympy/__init__` (see #24067). Please review.



---

archive/issue_comments_332674.json:
```json
{
    "body": "Replying to [comment:30 rws]:\n> Replying to [comment:29 jdemeyer]:\n> > My suggestion was to patch sympy itself.\n> \n> You said '...you should either fix sympy to fix the _sage_() method in sympy or to call sympy_init() whenever sympy is imported.'\n\nExactly. I gave two possible solutions, both of which involve patching sympy.",
    "created_at": "2017-10-19T20:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332674",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:30 rws]:
> Replying to [comment:29 jdemeyer]:
> > My suggestion was to patch sympy itself.
> 
> You said '...you should either fix sympy to fix the _sage_() method in sympy or to call sympy_init() whenever sympy is imported.'

Exactly. I gave two possible solutions, both of which involve patching sympy.



---

archive/issue_comments_332675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-20T14:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332675",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332676.json:
```json
{
    "body": "Thanks.",
    "created_at": "2017-10-20T14:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332676",
    "user": "https://github.com/rwst"
}
```

Thanks.



---

archive/issue_comments_332677.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-21T19:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332677",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_332678.json:
```json
{
    "body": "Reviewer name",
    "created_at": "2017-10-21T19:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332678",
    "user": "https://github.com/vbraun"
}
```

Reviewer name



---

archive/issue_comments_332679.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-23T23:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332679",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_332680.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-29T10:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332680",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_332681.json:
```json
{
    "body": "I just noticed this:\n\n```\n################################################################\n#   Distributed under GNU GPL3, see www.gnu.org\n################################################################\n```\n\n\nThis is **not acceptable** for Sage, all files in the Sage library are supposed to be licensed under GPL version 2 or later.\n\nDo you agree to change this to GPL version 2 or later?",
    "created_at": "2017-12-07T10:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332681",
    "user": "https://github.com/jdemeyer"
}
```

I just noticed this:

```
################################################################
#   Distributed under GNU GPL3, see www.gnu.org
################################################################
```


This is **not acceptable** for Sage, all files in the Sage library are supposed to be licensed under GPL version 2 or later.

Do you agree to change this to GPL version 2 or later?



---

archive/issue_comments_332682.json:
```json
{
    "body": "Also, I find the names like `_sympysage_float` a bit awkward. If we want to upstream that, we should think about that. Is it OK to change to use names like `Float_sage` (with the same capitalisation as in Sympy)?",
    "created_at": "2017-12-07T10:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332682",
    "user": "https://github.com/jdemeyer"
}
```

Also, I find the names like `_sympysage_float` a bit awkward. If we want to upstream that, we should think about that. Is it OK to change to use names like `Float_sage` (with the same capitalisation as in Sympy)?



---

archive/issue_comments_332683.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> I just noticed this:\n> {{{\n> ################################################################\n> #   Distributed under GNU GPL3, see www.gnu.org\n> ################################################################\n> }}}\n> \n> This is **not acceptable** for Sage, all files in the Sage library are supposed to be licensed under GPL version 2 or later. \n> Do you agree to change this to GPL version 2 or later?\n\nAgree. Actually I intended 2.",
    "created_at": "2017-12-07T13:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332683",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:39 jdemeyer]:
> I just noticed this:
> {{{
> ################################################################
> #   Distributed under GNU GPL3, see www.gnu.org
> ################################################################
> }}}
> 
> This is **not acceptable** for Sage, all files in the Sage library are supposed to be licensed under GPL version 2 or later. 
> Do you agree to change this to GPL version 2 or later?

Agree. Actually I intended 2.



---

archive/issue_comments_332684.json:
```json
{
    "body": "Replying to [comment:40 jdemeyer]:\n> Also, I find the names like `_sympysage_float` a bit awkward. If we want to upstream that, we should think about that. Is it OK to change to use names like `Float_sage` (with the same capitalisation as in Sympy)?\n\nThat's fine. Please open a ticket for what you intend to be done.",
    "created_at": "2017-12-07T13:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332684",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:40 jdemeyer]:
> Also, I find the names like `_sympysage_float` a bit awkward. If we want to upstream that, we should think about that. Is it OK to change to use names like `Float_sage` (with the same capitalisation as in Sympy)?

That's fine. Please open a ticket for what you intend to be done.



---

archive/issue_comments_332685.json:
```json
{
    "body": "Replying to [comment:42 rws]:\n> That's fine. Please open a ticket for what you intend to be done.\n\nDone: #24067",
    "created_at": "2017-12-07T13:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23769#issuecomment-332685",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:42 rws]:
> That's fine. Please open a ticket for what you intend to be done.

Done: #24067
