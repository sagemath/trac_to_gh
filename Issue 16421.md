# Issue 16421: Random failure in hyperelliptic_finite_field.py

archive/issues_016421.json:
```json
{
    "body": "CC:  jantuitman jpflori @jbalakrishnan goncalves\n\nOn bsd: OSX 10.6\n\n```\nsage -t --long src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py\n**********************************************************************\nFile \"src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py\", line 424, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial\nFailed example:\n    H.frobenius_polynomial() # long time\nExpected:\n    x^2 - 15*x + 12167\nGot:\n    x^2 - 17*x + 12167\n**********************************************************************\n1 item had failures:\n   1 of  26 in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial\n    [293 tests, 1 failure, 166.72 s]\n```\n\nHappens rarely. Possibly due to #15148\n\nIssue created by migration from https://trac.sagemath.org/ticket/16658\n\n",
    "created_at": "2014-07-15T17:36:50Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Random failure in hyperelliptic_finite_field.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16421",
    "user": "@vbraun"
}
```
CC:  jantuitman jpflori @jbalakrishnan goncalves

On bsd: OSX 10.6

```
sage -t --long src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py
**********************************************************************
File "src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py", line 424, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial
Failed example:
    H.frobenius_polynomial() # long time
Expected:
    x^2 - 15*x + 12167
Got:
    x^2 - 17*x + 12167
**********************************************************************
1 item had failures:
   1 of  26 in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial
    [293 tests, 1 failure, 166.72 s]
```

Happens rarely. Possibly due to #15148

Issue created by migration from https://trac.sagemath.org/ticket/16658





---

archive/issue_comments_215676.json:
```json
{
    "body": "I'll have a quick look at it.\nIf the bug is in hypellfrob, we should ask David Harvey for help.\nBut David's code is usually bug free :)",
    "created_at": "2014-07-16T10:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215676",
    "user": "jpflori"
}
```

I'll have a quick look at it.
If the bug is in hypellfrob, we should ask David Harvey for help.
But David's code is usually bug free :)



---

archive/issue_comments_215677.json:
```json
{
    "body": "My bad, this only uses naive stuff, so nothing to do with David's code.",
    "created_at": "2014-07-16T14:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215677",
    "user": "jpflori"
}
```

My bad, this only uses naive stuff, so nothing to do with David's code.



---

archive/issue_comments_215678.json:
```json
{
    "body": "This is quite slow on bsd, done 200 iterations in one Sage interactive session and no failures yet.\nAny clue on how rarely this happens?\n\nThe only sensible things coming to my mind without looking back at the code is that there is some issue with the sqrt code which surely uses some randomness.\nAlso note that the naive code currently used is rewritten in a much more proper way at #11980, so reviewing it might fix this issue.",
    "created_at": "2014-07-16T15:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215678",
    "user": "jpflori"
}
```

This is quite slow on bsd, done 200 iterations in one Sage interactive session and no failures yet.
Any clue on how rarely this happens?

The only sensible things coming to my mind without looking back at the code is that there is some issue with the sqrt code which surely uses some randomness.
Also note that the naive code currently used is rewritten in a much more proper way at #11980, so reviewing it might fix this issue.



---

archive/issue_comments_215679.json:
```json
{
    "body": "Changing keywords from \"\" to \"random_fail\".",
    "created_at": "2014-07-25T05:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215679",
    "user": "@vbraun"
}
```

Changing keywords from "" to "random_fail".



---

archive/issue_comments_215680.json:
```json
{
    "body": "It might only happen during parallel doctests, did you try that?",
    "created_at": "2014-07-25T05:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215680",
    "user": "@vbraun"
}
```

It might only happen during parallel doctests, did you try that?



---

archive/issue_comments_215681.json:
```json
{
    "body": "I just saw this in a `make ptest` run:\n\n```\nsage -t src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py\n**********************************************************************\nFile \"src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py\", line 1242, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.zeta_function\nFailed example:\n    H.zeta_function()\nExpected:\n    (81*x^4 + 72*x^3 + 32*x^2 + 8*x + 1)/(9*x^2 - 10*x + 1)\nGot:\n    (81*x^4 + 54*x^3 + 18*x^2 + 6*x + 1)/(9*x^2 - 10*x + 1)\n**********************************************************************\n```\n",
    "created_at": "2014-09-07T18:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215681",
    "user": "@jdemeyer"
}
```

I just saw this in a `make ptest` run:

```
sage -t src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py
**********************************************************************
File "src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py", line 1242, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.zeta_function
Failed example:
    H.zeta_function()
Expected:
    (81*x^4 + 72*x^3 + 32*x^2 + 8*x + 1)/(9*x^2 - 10*x + 1)
Got:
    (81*x^4 + 54*x^3 + 18*x^2 + 6*x + 1)/(9*x^2 - 10*x + 1)
**********************************************************************
```




---

archive/issue_comments_215682.json:
```json
{
    "body": "Was it with or without the latest NTL/Sage fixes?",
    "created_at": "2014-09-08T08:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215682",
    "user": "jpflori"
}
```

Was it with or without the latest NTL/Sage fixes?



---

archive/issue_comments_215683.json:
```json
{
    "body": "Replying to [comment:7 jpflori]:\n> Was it with or without the latest NTL/Sage fixes?\nI have no idea what the \"latest NTL/Sage fixes\" are, so I guess without.",
    "created_at": "2014-09-08T08:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215683",
    "user": "@jdemeyer"
}
```

Replying to [comment:7 jpflori]:
> Was it with or without the latest NTL/Sage fixes?
I have no idea what the "latest NTL/Sage fixes" are, so I guess without.



---

archive/issue_comments_215684.json:
```json
{
    "body": "Sorry, I was thinking of #16885.",
    "created_at": "2014-09-08T08:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215684",
    "user": "jpflori"
}
```

Sorry, I was thinking of #16885.



---

archive/issue_comments_215685.json:
```json
{
    "body": "Can someone with the right setup confirm that this is still occurring? I haven't been able to reproduce it.",
    "created_at": "2016-03-21T17:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215685",
    "user": "@kedlaya"
}
```

Can someone with the right setup confirm that this is still occurring? I haven't been able to reproduce it.



---

archive/issue_comments_215686.json:
```json
{
    "body": "With #18916, there was some change to the backend here, so it would be good if someone can do some serious testing to see if this can still be reproduced.",
    "created_at": "2017-08-24T04:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215686",
    "user": "@kedlaya"
}
```

With #18916, there was some change to the backend here, so it would be good if someone can do some serious testing to see if this can still be reproduced.



---

archive/issue_comments_215687.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-06T18:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215687",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_215688.json:
```json
{
    "body": "Haven't seen this particular failure in a long time",
    "created_at": "2018-07-06T18:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16421#issuecomment-215688",
    "user": "@vbraun"
}
```

Haven't seen this particular failure in a long time
