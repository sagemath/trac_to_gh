# Issue 16421: Random failure in hyperelliptic_finite_field.py

Issue created by migration from https://trac.sagemath.org/ticket/16658

Original creator: vbraun

Original creation time: 2014-07-15 17:36:50

CC:  jantuitman jpflori jen goncalves

On bsd: OSX 10.6

```
sage -t --long src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py
**********************************************************************
File "src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py", line 424, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial
Failed example:
    H.frobenius_polynomial() # long time
Expected:
    x^2 - 15*x + 12167
Got:
    x^2 - 17*x + 12167
**********************************************************************
1 item had failures:
   1 of  26 in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.frobenius_polynomial
    [293 tests, 1 failure, 166.72 s]
```

Happens rarely. Possibly due to #15148


---

Comment by jpflori created at 2014-07-16 10:37:32

I'll have a quick look at it.
If the bug is in hypellfrob, we should ask David Harvey for help.
But David's code is usually bug free :)


---

Comment by jpflori created at 2014-07-16 14:49:00

My bad, this only uses naive stuff, so nothing to do with David's code.


---

Comment by jpflori created at 2014-07-16 15:10:27

This is quite slow on bsd, done 200 iterations in one Sage interactive session and no failures yet.
Any clue on how rarely this happens?

The only sensible things coming to my mind without looking back at the code is that there is some issue with the sqrt code which surely uses some randomness.
Also note that the naive code currently used is rewritten in a much more proper way at #11980, so reviewing it might fix this issue.


---

Comment by vbraun created at 2014-07-25 05:01:16

Changing keywords from "" to "random_fail".


---

Comment by vbraun created at 2014-07-25 05:01:16

It might only happen during parallel doctests, did you try that?


---

Comment by jdemeyer created at 2014-09-07 18:42:07

I just saw this in a `make ptest` run:

```
sage -t src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py
**********************************************************************
File "src/sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py", line 1242, in sage.schemes.hyperelliptic_curves.hyperelliptic_finite_field.HyperellipticCurve_finite_field.zeta_function
Failed example:
    H.zeta_function()
Expected:
    (81*x^4 + 72*x^3 + 32*x^2 + 8*x + 1)/(9*x^2 - 10*x + 1)
Got:
    (81*x^4 + 54*x^3 + 18*x^2 + 6*x + 1)/(9*x^2 - 10*x + 1)
**********************************************************************
```



---

Comment by jpflori created at 2014-09-08 08:28:21

Was it with or without the latest NTL/Sage fixes?


---

Comment by jdemeyer created at 2014-09-08 08:31:37

Replying to [comment:7 jpflori]:
> Was it with or without the latest NTL/Sage fixes?
I have no idea what the "latest NTL/Sage fixes" are, so I guess without.


---

Comment by jpflori created at 2014-09-08 08:42:04

Sorry, I was thinking of #16885.


---

Comment by kedlaya created at 2016-03-21 17:57:05

Can someone with the right setup confirm that this is still occurring? I haven't been able to reproduce it.


---

Comment by kedlaya created at 2017-08-24 04:24:09

With #18916, there was some change to the backend here, so it would be good if someone can do some serious testing to see if this can still be reproduced.


---

Comment by vbraun created at 2018-07-06 18:20:27

Resolution: fixed


---

Comment by vbraun created at 2018-07-06 18:20:27

Haven't seen this particular failure in a long time
