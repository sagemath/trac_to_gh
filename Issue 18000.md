# Issue 18000: upgrade to pynac-0.3.5

Issue created by migration from https://trac.sagemath.org/ticket/18237

Original creator: rws

Original creation time: 2015-04-17 07:54:52

We skip 0.3.3 (#18155) which couldn't be used because of a bug showing on OSX.

https://drive.google.com/folderview?id=0B4PmRyK1JXgHfmJmbWZ5NnVtMnNITTVHQ2hCci1WVnhLbC1PeC1YbzRQLUpidU9yY0x3Qjg&usp=sharing

```
* fixed the series expansion of zeta(s) around 1
* print_latex of wildcards
* clear the libtool versioning scheme
* sync with current GiNaC as much as possible
* revert GiNaC commit interfering with Pynac print order
* fix code that produced warnings
```

Upgrade will require a few doctests to adapt, see https://groups.google.com/d/topic/sage-devel/hwQXxFmutcU/discussion

Dependent tickets: #15047, #15846


---

Comment by rws created at 2015-04-17 07:57:16

New commits:


---

Comment by rws created at 2015-04-17 07:57:16

Changing status from new to needs_review.


---

Comment by behackl created at 2015-04-17 14:54:11

On it, currently doing some more doctesting on Arch Linux (kernel 3.19.3-3, i7, 12GB RAM); will be finished soon.

Meanwhile: I can confirm that the bug with the unstable output of `integrate(sec(x), (x, 0, pi/8))` on OSX (see https://github.com/pynac/pynac/issues/18) is gone. Thanks to Volker for access to the OSX buildslave!


---

Comment by behackl created at 2015-04-17 16:58:32

`MAKE="make -j4" make ptestlong` gives


```
----------------------------------------------------------------------
sage -t --long --warn-long 81.8 src/sage/combinat/dyck_word.py  # 1 doctest failed
----------------------------------------------------------------------
```


The doctest fails with


```
sage -t --long --warn-long 81.8 src/sage/combinat/dyck_word.py
**********************************************************************
File "src/sage/combinat/dyck_word.py", line 3501, in sage.combinat.dyck_word.DyckWords_size.__init__
Failed example:
    TestSuite(DyckWords(4,2)).run()
Expected nothing
Got:
    Failure in _test_enumerated_set_iter_cardinality:
    Traceback (most recent call last):
      File "/home/behackl/Programming/sage-6.7.beta1/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 282, in run
        test_method(tester = tester)
      File "/home/behackl/Programming/sage-6.7.beta1/local/lib/python2.7/site-packages/sage/categories/finite_enumerated_sets.py", line 462, in _test_enumerated_set_iter_cardinality
        tester.assert_(isinstance(card, Integer))
      File "/home/behackl/Programming/sage-6.7.beta1/local/lib/python/unittest/case.py", line 422, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
    ------------------------------------------------------------
    The following tests failed: _test_enumerated_set_iter_cardinality
**********************************************************************
1 item had failures:
   1 of   2 in sage.combinat.dyck_word.DyckWords_size.__init__
    [574 tests, 1 failure, 2.98 s]
```


This happened two times. However, when testing the respective file manually:

```
sage -t --long --warn-long 81.8 src/sage/combinat/dyck_word.py
    [574 tests, 0.95 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```


So this only seems to occur for `make ptestlong`. 

Additionally, as I've not run `make ptestlong` on a clean install of `6.7.beta1` yet, I'm not even sure if this is related to Pynac at all. I'll do so and report back...


---

Comment by behackl created at 2015-04-17 17:57:55

See https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/7BQPmEgfA8M -- until this is resolved, I can't review the new Pynac version reliably.


---

Comment by jkeitel created at 2015-04-17 18:47:55

I had the same doctest fail today on a clean `6.7beta1` install and, just like you, could not reproduce it when running this specific test again on the file, so I doubt that this is related to this ticket.


---

Comment by behackl created at 2015-04-17 19:28:59

I'm also quite sure that it has nothing to do with this ticket; especially after Vincent confirmed that this is happening for him too on both `6.7.beta0` and `6.7.beta1`. This discussion, however, belongs to the `sage-devel` thread.

Still, I don't like the idea of giving this `positive_review` when I don't have a passing `ptestlong`, regardless of why the doctest is failing. Currently, I'm compiling sage on two more machines; one of those should enable me to review this.


---

Comment by behackl created at 2015-04-17 21:50:25

Changing status from needs_review to positive_review.


---

Comment by behackl created at 2015-04-17 21:50:25

It seems that something went wrong when I upgraded sage from `6.6.rc2` to `6.7.beta1`. Completely rebuilding sage resolves everything, and `make ptestlong` passes without problems again for both, the clean install as well as this ticket (on all three machines I tested this; 2x Arch Linux, 1x Linux Mint). Therefore: `positive_review`. :-)


---

Comment by vbraun created at 2015-04-19 01:52:02

Resolution: fixed
