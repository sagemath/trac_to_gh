# Issue 23125: error message of rst2ipynb meaningless

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2017-07-04 09:18:58

CC:  nthiery tmonteil


```
$ rst2ipynb --kernel=sagemath markov.rst
Traceback (most recent call last):
  File "/opt/sage/local/bin/rst2ipynb-sageblock-filter", line 80, in <module>
    toJSONFilter(reformat_sage_block)
  File "/opt/sage/local/lib/python2.7/site-packages/pandocfilters.py", line 46, in toJSONFilter
    toJSONFilters([action])
  File "/opt/sage/local/lib/python2.7/site-packages/pandocfilters.py", line 76, in toJSONFilters
    altered = reduce(lambda x, action: walk(x, action, format, doc[0]['unMeta']), actions, doc)
  File "/opt/sage/local/lib/python2.7/site-packages/pandocfilters.py", line 76, in <lambda>
    altered = reduce(lambda x, action: walk(x, action, format, doc[0]['unMeta']), actions, doc)
KeyError: 0
pandoc: Error running filter /opt/sage/local/bin/rst2ipynb-sageblock-filter
Filter returned error status 1
pandoc failed: 83
```


see also #23361


---

Comment by nthiery created at 2017-07-04 13:19:36

Salut Vincent,

Please provide markov.rst!


---

Comment by vdelecroix created at 2017-07-04 14:57:19

Nothing to do with `markov.rst`. I can reproduce with any rst file.


---

Comment by vdelecroix created at 2017-07-04 14:57:33

(and Thierry can compile `markov.rst`)


---

Attachment


---

Comment by nthiery created at 2017-07-04 15:05:58

Then please provide steps to reproduce. Version of rst2ipynb. Installed through pip or the Sage package, running within sage -sh or not, ...


---

Comment by nthiery created at 2017-07-04 15:06:27

And what could possibly be the difference betwen your setup and Thierry.
Ah also: pandoc's version; how it's installed.


---

Comment by vdelecroix created at 2017-07-04 15:10:48

{{{ 
$ sage --version
SageMath version 8.0.rc0, Release Date: 2017-06-29
$ sage -sh
(sage-sh) $ pandoc --version
pandoc 1.19.2.1
Compiled with pandoc-types 1.17.0.5, texmath 0.9.4, skylighting 0.1.1.5
Default user data directory: /home/vincent/.pandoc
Copyright (C) 2006-2016 John MacFarlane
}}}

and ticket description updated


---

Comment by tmonteil created at 2017-07-13 22:18:26

Related : #23415


---

Comment by nthiery created at 2018-02-06 06:44:37

Good news (well, not for me), I am now getting the same error on my machine ...


---

Comment by nthiery created at 2018-02-08 15:58:01

Ah ah, sounds like upgraded pandocfilters from 1.3.0 to 1.4.2 fixes the issue.

I had a bunch of recent pandocfilters here and there (in conda envs or ~/.local); presumably one of them was overriding sage's one, which prevented me to reproduce the error.

I will now work on updating sage's pandocfilters spkg.


---

Comment by nthiery created at 2018-02-08 16:15:23

Vincent, in the mean time, could you upgrade by hand your pandocfilters with:

```
    sage -pip install --upgrade pandocfilters
```


and double check that this indeed fixes the problem for you?


---

Comment by nthiery created at 2018-02-08 16:44:58

Changing status from new to needs_review.


---

Comment by nthiery created at 2018-02-08 16:44:58

In fact Volker had already put work on upgrading pandocfilters to 1.4.2 in #24484, as a piece of a large still in progress work. So I just had to fetch the diffs from there. I had to fix the checksums though. It should be a trivial merge in #24484 and unlikely to be an additional burden there; nevertheless I asked confirmation to Volker and we should wait for his feedback before getting this merged.
----
New commits:


---

Comment by git created at 2018-02-09 13:55:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2018-02-09 14:02:03

We have a green light from Volker and the checksum disprecancy is now understood and resolved.

Needs review!


---

Comment by tmonteil created at 2018-02-09 20:56:31

Changing status from needs_review to positive_review.


---

Comment by tmonteil created at 2018-02-09 20:56:31

Successfully tested on some worksheets.


---

Comment by nthiery created at 2018-02-10 17:14:59

Thank you Thierry!


---

Comment by vbraun created at 2018-02-11 13:04:11

Resolution: fixed
