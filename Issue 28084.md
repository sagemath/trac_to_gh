# Issue 28084: rationals can not be initialized from a pair of big Python ints

Issue created by migration from https://trac.sagemath.org/ticket/28321

Original creator: vdelecroix

Original creation time: 2019-08-04 09:39:18


```
sage: QQ((2r**100,3r**100))
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)
<ipython-input-2-091103d07f87> in <module>()
----> 1 QQ((2**Integer(100),3**Integer(100)))

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9197)()
    898         if mor is not None:
    899             if no_extra_args:
--> 900                 return mor._call_(x)
    901             else:
    902                 return mor._call_with_args(x, args, kwds)

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4556)()
    160                 print(type(C), C)
    161                 print(type(C._element_constructor), C._element_constructor)
--> 162             raise
    163 
    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4448)()
    155         cdef Parent C = self._codomain
    156         try:
--> 157             return C._element_constructor(x)
    158         except Exception:
    159             if print_warnings:

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__init__ (build/cythonized/sage/rings/rational.c:6386)()
    520         """
    521         if x is not None:
--> 522             self.__set_value(x, base)
    523 
    524     def __reduce__(self):

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Rational.__set_value (build/cythonized/sage/rings/rational.c:7608)()
    615             if isinstance(num, int) and isinstance(denom, int):
    616                 if denom >= 0:
--> 617                     mpq_set_si(self.value, num, denom)
    618                 else:
    619                     mpq_set_si(self.value, -num, -denom)

OverflowError: Python int too large to convert to C long
```



---

Comment by vdelecroix created at 2019-08-04 09:46:40

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2019-08-04 09:46:40

New commits:


---

Comment by git created at 2019-08-04 13:54:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-08-04 20:18:27

Clarifying that this is a Python 3 issue.


---

Comment by jdemeyer created at 2019-08-04 20:18:27

Changing component from basic arithmetic to python3.


---

Comment by jdemeyer created at 2019-08-04 20:21:42

Positive review if this passes tests also on Python 2.


---

Comment by vdelecroix created at 2019-08-20 08:57:58

`mpz_set_pylong` with Python2 seems unhappy when providing `int`... do you have an idea on how to sort this out?

I just ran into this problem again with #28370.


---

Comment by jdemeyer created at 2019-08-20 09:26:16

The correct solution is to have separate cases for `long` and `int`, keeping in mind that the `long` type on Python 3 is actually called `int`.
----
New commits:


---

Comment by vdelecroix created at 2019-08-20 09:52:42

I see. Thanks!


---

Comment by vdelecroix created at 2019-08-20 11:34:56

Tests pass with your version!


---

Comment by vdelecroix created at 2019-08-20 11:34:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-21 22:27:42

Resolution: fixed
